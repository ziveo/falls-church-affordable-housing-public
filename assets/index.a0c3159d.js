(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const n of s)if(n.type==="childList")for(const o of n.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function r(s){const n={};return s.integrity&&(n.integrity=s.integrity),s.referrerpolicy&&(n.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?n.credentials="include":s.crossorigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function i(s){if(s.ep)return;s.ep=!0;const n=r(s);fetch(s.href,n)}})();function dNe(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var IC={exports:{}},qr={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var P$=Symbol.for("react.element"),pNe=Symbol.for("react.portal"),fNe=Symbol.for("react.fragment"),mNe=Symbol.for("react.strict_mode"),gNe=Symbol.for("react.profiler"),yNe=Symbol.for("react.provider"),vNe=Symbol.for("react.context"),_Ne=Symbol.for("react.forward_ref"),bNe=Symbol.for("react.suspense"),wNe=Symbol.for("react.memo"),xNe=Symbol.for("react.lazy"),Pne=Symbol.iterator;function TNe(e){return e===null||typeof e!="object"?null:(e=Pne&&e[Pne]||e["@@iterator"],typeof e=="function"?e:null)}var L0e={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},D0e=Object.assign,N0e={};function KA(e,t,r){this.props=e,this.context=t,this.refs=N0e,this.updater=r||L0e}KA.prototype.isReactComponent={};KA.prototype.setState=function(e,t){if(typeof e!="object"&&typeof e!="function"&&e!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")};KA.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")};function F0e(){}F0e.prototype=KA.prototype;function DJ(e,t,r){this.props=e,this.context=t,this.refs=N0e,this.updater=r||L0e}var NJ=DJ.prototype=new F0e;NJ.constructor=DJ;D0e(NJ,KA.prototype);NJ.isPureReactComponent=!0;var Ine=Array.isArray,k0e=Object.prototype.hasOwnProperty,FJ={current:null},U0e={key:!0,ref:!0,__self:!0,__source:!0};function V0e(e,t,r){var i,s={},n=null,o=null;if(t!=null)for(i in t.ref!==void 0&&(o=t.ref),t.key!==void 0&&(n=""+t.key),t)k0e.call(t,i)&&!U0e.hasOwnProperty(i)&&(s[i]=t[i]);var a=arguments.length-2;if(a===1)s.children=r;else if(1<a){for(var l=Array(a),c=0;c<a;c++)l[c]=arguments[c+2];s.children=l}if(e&&e.defaultProps)for(i in a=e.defaultProps,a)s[i]===void 0&&(s[i]=a[i]);return{$$typeof:P$,type:e,key:n,ref:o,props:s,_owner:FJ.current}}function SNe(e,t){return{$$typeof:P$,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}function kJ(e){return typeof e=="object"&&e!==null&&e.$$typeof===P$}function ENe(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(r){return t[r]})}var $ne=/\/+/g;function Q8(e,t){return typeof e=="object"&&e!==null&&e.key!=null?ENe(""+e.key):t.toString(36)}function y4(e,t,r,i,s){var n=typeof e;(n==="undefined"||n==="boolean")&&(e=null);var o=!1;if(e===null)o=!0;else switch(n){case"string":case"number":o=!0;break;case"object":switch(e.$$typeof){case P$:case pNe:o=!0}}if(o)return o=e,s=s(o),e=i===""?"."+Q8(o,0):i,Ine(s)?(r="",e!=null&&(r=e.replace($ne,"$&/")+"/"),y4(s,t,r,"",function(c){return c})):s!=null&&(kJ(s)&&(s=SNe(s,r+(!s.key||o&&o.key===s.key?"":(""+s.key).replace($ne,"$&/")+"/")+e)),t.push(s)),1;if(o=0,i=i===""?".":i+":",Ine(e))for(var a=0;a<e.length;a++){n=e[a];var l=i+Q8(n,a);o+=y4(n,t,r,l,s)}else if(l=TNe(e),typeof l=="function")for(e=l.call(e),a=0;!(n=e.next()).done;)n=n.value,l=i+Q8(n,a++),o+=y4(n,t,r,l,s);else if(n==="object")throw t=String(e),Error("Objects are not valid as a React child (found: "+(t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return o}function JL(e,t,r){if(e==null)return e;var i=[],s=0;return y4(e,i,"","",function(n){return t.call(r,n,s++)}),i}function CNe(e){if(e._status===-1){var t=e._result;t=t(),t.then(function(r){(e._status===0||e._status===-1)&&(e._status=1,e._result=r)},function(r){(e._status===0||e._status===-1)&&(e._status=2,e._result=r)}),e._status===-1&&(e._status=0,e._result=t)}if(e._status===1)return e._result.default;throw e._result}var hc={current:null},v4={transition:null},ANe={ReactCurrentDispatcher:hc,ReactCurrentBatchConfig:v4,ReactCurrentOwner:FJ};qr.Children={map:JL,forEach:function(e,t,r){JL(e,function(){t.apply(this,arguments)},r)},count:function(e){var t=0;return JL(e,function(){t++}),t},toArray:function(e){return JL(e,function(t){return t})||[]},only:function(e){if(!kJ(e))throw Error("React.Children.only expected to receive a single React element child.");return e}};qr.Component=KA;qr.Fragment=fNe;qr.Profiler=gNe;qr.PureComponent=DJ;qr.StrictMode=mNe;qr.Suspense=bNe;qr.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=ANe;qr.cloneElement=function(e,t,r){if(e==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var i=D0e({},e.props),s=e.key,n=e.ref,o=e._owner;if(t!=null){if(t.ref!==void 0&&(n=t.ref,o=FJ.current),t.key!==void 0&&(s=""+t.key),e.type&&e.type.defaultProps)var a=e.type.defaultProps;for(l in t)k0e.call(t,l)&&!U0e.hasOwnProperty(l)&&(i[l]=t[l]===void 0&&a!==void 0?a[l]:t[l])}var l=arguments.length-2;if(l===1)i.children=r;else if(1<l){a=Array(l);for(var c=0;c<l;c++)a[c]=arguments[c+2];i.children=a}return{$$typeof:P$,type:e.type,key:s,ref:n,props:i,_owner:o}};qr.createContext=function(e){return e={$$typeof:vNe,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},e.Provider={$$typeof:yNe,_context:e},e.Consumer=e};qr.createElement=V0e;qr.createFactory=function(e){var t=V0e.bind(null,e);return t.type=e,t};qr.createRef=function(){return{current:null}};qr.forwardRef=function(e){return{$$typeof:_Ne,render:e}};qr.isValidElement=kJ;qr.lazy=function(e){return{$$typeof:xNe,_payload:{_status:-1,_result:e},_init:CNe}};qr.memo=function(e,t){return{$$typeof:wNe,type:e,compare:t===void 0?null:t}};qr.startTransition=function(e){var t=v4.transition;v4.transition={};try{e()}finally{v4.transition=t}};qr.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")};qr.useCallback=function(e,t){return hc.current.useCallback(e,t)};qr.useContext=function(e){return hc.current.useContext(e)};qr.useDebugValue=function(){};qr.useDeferredValue=function(e){return hc.current.useDeferredValue(e)};qr.useEffect=function(e,t){return hc.current.useEffect(e,t)};qr.useId=function(){return hc.current.useId()};qr.useImperativeHandle=function(e,t,r){return hc.current.useImperativeHandle(e,t,r)};qr.useInsertionEffect=function(e,t){return hc.current.useInsertionEffect(e,t)};qr.useLayoutEffect=function(e,t){return hc.current.useLayoutEffect(e,t)};qr.useMemo=function(e,t){return hc.current.useMemo(e,t)};qr.useReducer=function(e,t,r){return hc.current.useReducer(e,t,r)};qr.useRef=function(e){return hc.current.useRef(e)};qr.useState=function(e){return hc.current.useState(e)};qr.useSyncExternalStore=function(e,t,r){return hc.current.useSyncExternalStore(e,t,r)};qr.useTransition=function(){return hc.current.useTransition()};qr.version="18.2.0";(function(e){e.exports=qr})(IC);const RNe=dNe(IC.exports);var AH={},z0e={exports:{}},Sh={},B0e={exports:{}},G0e={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(e){function t(N,V){var B=N.length;N.push(V);e:for(;0<B;){var W=B-1>>>1,Y=N[W];if(0<s(Y,V))N[W]=V,N[B]=Y,B=W;else break e}}function r(N){return N.length===0?null:N[0]}function i(N){if(N.length===0)return null;var V=N[0],B=N.pop();if(B!==V){N[0]=B;e:for(var W=0,Y=N.length,H=Y>>>1;W<H;){var ee=2*(W+1)-1,me=N[ee],be=ee+1,De=N[be];if(0>s(me,B))be<Y&&0>s(De,me)?(N[W]=De,N[be]=B,W=be):(N[W]=me,N[ee]=B,W=ee);else if(be<Y&&0>s(De,B))N[W]=De,N[be]=B,W=be;else break e}}return V}function s(N,V){var B=N.sortIndex-V.sortIndex;return B!==0?B:N.id-V.id}if(typeof performance=="object"&&typeof performance.now=="function"){var n=performance;e.unstable_now=function(){return n.now()}}else{var o=Date,a=o.now();e.unstable_now=function(){return o.now()-a}}var l=[],c=[],h=1,p=null,f=3,m=!1,g=!1,v=!1,w=typeof setTimeout=="function"?setTimeout:null,_=typeof clearTimeout=="function"?clearTimeout:null,T=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function x(N){for(var V=r(c);V!==null;){if(V.callback===null)i(c);else if(V.startTime<=N)i(c),V.sortIndex=V.expirationTime,t(l,V);else break;V=r(c)}}function E(N){if(v=!1,x(N),!g)if(r(l)!==null)g=!0,ne(C);else{var V=r(c);V!==null&&D(E,V.startTime-N)}}function C(N,V){g=!1,v&&(v=!1,_(I),I=-1),m=!0;var B=f;try{for(x(V),p=r(l);p!==null&&(!(p.expirationTime>V)||N&&!G());){var W=p.callback;if(typeof W=="function"){p.callback=null,f=p.priorityLevel;var Y=W(p.expirationTime<=V);V=e.unstable_now(),typeof Y=="function"?p.callback=Y:p===r(l)&&i(l),x(V)}else i(l);p=r(l)}if(p!==null)var H=!0;else{var ee=r(c);ee!==null&&D(E,ee.startTime-V),H=!1}return H}finally{p=null,f=B,m=!1}}var A=!1,P=null,I=-1,L=5,k=-1;function G(){return!(e.unstable_now()-k<L)}function z(){if(P!==null){var N=e.unstable_now();k=N;var V=!0;try{V=P(!0,N)}finally{V?X():(A=!1,P=null)}}else A=!1}var X;if(typeof T=="function")X=function(){T(z)};else if(typeof MessageChannel<"u"){var Z=new MessageChannel,ce=Z.port2;Z.port1.onmessage=z,X=function(){ce.postMessage(null)}}else X=function(){w(z,0)};function ne(N){P=N,A||(A=!0,X())}function D(N,V){I=w(function(){N(e.unstable_now())},V)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(N){N.callback=null},e.unstable_continueExecution=function(){g||m||(g=!0,ne(C))},e.unstable_forceFrameRate=function(N){0>N||125<N?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):L=0<N?Math.floor(1e3/N):5},e.unstable_getCurrentPriorityLevel=function(){return f},e.unstable_getFirstCallbackNode=function(){return r(l)},e.unstable_next=function(N){switch(f){case 1:case 2:case 3:var V=3;break;default:V=f}var B=f;f=V;try{return N()}finally{f=B}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(N,V){switch(N){case 1:case 2:case 3:case 4:case 5:break;default:N=3}var B=f;f=N;try{return V()}finally{f=B}},e.unstable_scheduleCallback=function(N,V,B){var W=e.unstable_now();switch(typeof B=="object"&&B!==null?(B=B.delay,B=typeof B=="number"&&0<B?W+B:W):B=W,N){case 1:var Y=-1;break;case 2:Y=250;break;case 5:Y=1073741823;break;case 4:Y=1e4;break;default:Y=5e3}return Y=B+Y,N={id:h++,callback:V,priorityLevel:N,startTime:B,expirationTime:Y,sortIndex:-1},B>W?(N.sortIndex=B,t(c,N),r(l)===null&&N===r(c)&&(v?(_(I),I=-1):v=!0,D(E,B-W))):(N.sortIndex=Y,t(l,N),g||m||(g=!0,ne(C))),N},e.unstable_shouldYield=G,e.unstable_wrapCallback=function(N){var V=f;return function(){var B=f;f=V;try{return N.apply(this,arguments)}finally{f=B}}}})(G0e);(function(e){e.exports=G0e})(B0e);/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var j0e=IC.exports,mh=B0e.exports;function ke(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,r=1;r<arguments.length;r++)t+="&args[]="+encodeURIComponent(arguments[r]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var H0e=new Set,DP={};function VT(e,t){$C(e,t),$C(e+"Capture",t)}function $C(e,t){for(DP[e]=t,e=0;e<t.length;e++)H0e.add(t[e])}var s0=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),RH=Object.prototype.hasOwnProperty,ONe=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,Lne={},Dne={};function MNe(e){return RH.call(Dne,e)?!0:RH.call(Lne,e)?!1:ONe.test(e)?Dne[e]=!0:(Lne[e]=!0,!1)}function PNe(e,t,r,i){if(r!==null&&r.type===0)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return i?!1:r!==null?!r.acceptsBooleans:(e=e.toLowerCase().slice(0,5),e!=="data-"&&e!=="aria-");default:return!1}}function INe(e,t,r,i){if(t===null||typeof t>"u"||PNe(e,t,r,i))return!0;if(i)return!1;if(r!==null)switch(r.type){case 3:return!t;case 4:return t===!1;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}function dc(e,t,r,i,s,n,o){this.acceptsBooleans=t===2||t===3||t===4,this.attributeName=i,this.attributeNamespace=s,this.mustUseProperty=r,this.propertyName=e,this.type=t,this.sanitizeURL=n,this.removeEmptyString=o}var Ma={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){Ma[e]=new dc(e,0,!1,e,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var t=e[0];Ma[t]=new dc(t,1,!1,e[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(e){Ma[e]=new dc(e,2,!1,e.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){Ma[e]=new dc(e,2,!1,e,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){Ma[e]=new dc(e,3,!1,e.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(e){Ma[e]=new dc(e,3,!0,e,null,!1,!1)});["capture","download"].forEach(function(e){Ma[e]=new dc(e,4,!1,e,null,!1,!1)});["cols","rows","size","span"].forEach(function(e){Ma[e]=new dc(e,6,!1,e,null,!1,!1)});["rowSpan","start"].forEach(function(e){Ma[e]=new dc(e,5,!1,e.toLowerCase(),null,!1,!1)});var UJ=/[\-:]([a-z])/g;function VJ(e){return e[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var t=e.replace(UJ,VJ);Ma[t]=new dc(t,1,!1,e,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var t=e.replace(UJ,VJ);Ma[t]=new dc(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(e){var t=e.replace(UJ,VJ);Ma[t]=new dc(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(e){Ma[e]=new dc(e,1,!1,e.toLowerCase(),null,!1,!1)});Ma.xlinkHref=new dc("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(e){Ma[e]=new dc(e,1,!1,e.toLowerCase(),null,!0,!0)});function zJ(e,t,r,i){var s=Ma.hasOwnProperty(t)?Ma[t]:null;(s!==null?s.type!==0:i||!(2<t.length)||t[0]!=="o"&&t[0]!=="O"||t[1]!=="n"&&t[1]!=="N")&&(INe(t,r,s,i)&&(r=null),i||s===null?MNe(t)&&(r===null?e.removeAttribute(t):e.setAttribute(t,""+r)):s.mustUseProperty?e[s.propertyName]=r===null?s.type===3?!1:"":r:(t=s.attributeName,i=s.attributeNamespace,r===null?e.removeAttribute(t):(s=s.type,r=s===3||s===4&&r===!0?"":""+r,i?e.setAttributeNS(i,t,r):e.setAttribute(t,r))))}var T0=j0e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,KL=Symbol.for("react.element"),dE=Symbol.for("react.portal"),pE=Symbol.for("react.fragment"),BJ=Symbol.for("react.strict_mode"),OH=Symbol.for("react.profiler"),q0e=Symbol.for("react.provider"),W0e=Symbol.for("react.context"),GJ=Symbol.for("react.forward_ref"),MH=Symbol.for("react.suspense"),PH=Symbol.for("react.suspense_list"),jJ=Symbol.for("react.memo"),a_=Symbol.for("react.lazy"),X0e=Symbol.for("react.offscreen"),Nne=Symbol.iterator;function DR(e){return e===null||typeof e!="object"?null:(e=Nne&&e[Nne]||e["@@iterator"],typeof e=="function"?e:null)}var Ks=Object.assign,J8;function oM(e){if(J8===void 0)try{throw Error()}catch(r){var t=r.stack.trim().match(/\n( *(at )?)/);J8=t&&t[1]||""}return`
`+J8+e}var K8=!1;function e9(e,t){if(!e||K8)return"";K8=!0;var r=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(t,[])}catch(c){var i=c}Reflect.construct(e,[],t)}else{try{t.call()}catch(c){i=c}e.call(t.prototype)}else{try{throw Error()}catch(c){i=c}e()}}catch(c){if(c&&i&&typeof c.stack=="string"){for(var s=c.stack.split(`
`),n=i.stack.split(`
`),o=s.length-1,a=n.length-1;1<=o&&0<=a&&s[o]!==n[a];)a--;for(;1<=o&&0<=a;o--,a--)if(s[o]!==n[a]){if(o!==1||a!==1)do if(o--,a--,0>a||s[o]!==n[a]){var l=`
`+s[o].replace(" at new "," at ");return e.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",e.displayName)),l}while(1<=o&&0<=a);break}}}finally{K8=!1,Error.prepareStackTrace=r}return(e=e?e.displayName||e.name:"")?oM(e):""}function $Ne(e){switch(e.tag){case 5:return oM(e.type);case 16:return oM("Lazy");case 13:return oM("Suspense");case 19:return oM("SuspenseList");case 0:case 2:case 15:return e=e9(e.type,!1),e;case 11:return e=e9(e.type.render,!1),e;case 1:return e=e9(e.type,!0),e;default:return""}}function IH(e){if(e==null)return null;if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case pE:return"Fragment";case dE:return"Portal";case OH:return"Profiler";case BJ:return"StrictMode";case MH:return"Suspense";case PH:return"SuspenseList"}if(typeof e=="object")switch(e.$$typeof){case W0e:return(e.displayName||"Context")+".Consumer";case q0e:return(e._context.displayName||"Context")+".Provider";case GJ:var t=e.render;return e=e.displayName,e||(e=t.displayName||t.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case jJ:return t=e.displayName||null,t!==null?t:IH(e.type)||"Memo";case a_:t=e._payload,e=e._init;try{return IH(e(t))}catch{}}return null}function LNe(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=t.render,e=e.displayName||e.name||"",t.displayName||(e!==""?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return IH(t);case 8:return t===BJ?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t}return null}function b1(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function Z0e(e){var t=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(t==="checkbox"||t==="radio")}function DNe(e){var t=Z0e(e)?"checked":"value",r=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),i=""+e[t];if(!e.hasOwnProperty(t)&&typeof r<"u"&&typeof r.get=="function"&&typeof r.set=="function"){var s=r.get,n=r.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return s.call(this)},set:function(o){i=""+o,n.call(this,o)}}),Object.defineProperty(e,t,{enumerable:r.enumerable}),{getValue:function(){return i},setValue:function(o){i=""+o},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}function eD(e){e._valueTracker||(e._valueTracker=DNe(e))}function Y0e(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var r=t.getValue(),i="";return e&&(i=Z0e(e)?e.checked?"true":"false":e.value),e=i,e!==r?(t.setValue(e),!0):!1}function $k(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}function $H(e,t){var r=t.checked;return Ks({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:r!=null?r:e._wrapperState.initialChecked})}function Fne(e,t){var r=t.defaultValue==null?"":t.defaultValue,i=t.checked!=null?t.checked:t.defaultChecked;r=b1(t.value!=null?t.value:r),e._wrapperState={initialChecked:i,initialValue:r,controlled:t.type==="checkbox"||t.type==="radio"?t.checked!=null:t.value!=null}}function Q0e(e,t){t=t.checked,t!=null&&zJ(e,"checked",t,!1)}function LH(e,t){Q0e(e,t);var r=b1(t.value),i=t.type;if(r!=null)i==="number"?(r===0&&e.value===""||e.value!=r)&&(e.value=""+r):e.value!==""+r&&(e.value=""+r);else if(i==="submit"||i==="reset"){e.removeAttribute("value");return}t.hasOwnProperty("value")?DH(e,t.type,r):t.hasOwnProperty("defaultValue")&&DH(e,t.type,b1(t.defaultValue)),t.checked==null&&t.defaultChecked!=null&&(e.defaultChecked=!!t.defaultChecked)}function kne(e,t,r){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var i=t.type;if(!(i!=="submit"&&i!=="reset"||t.value!==void 0&&t.value!==null))return;t=""+e._wrapperState.initialValue,r||t===e.value||(e.value=t),e.defaultValue=t}r=e.name,r!==""&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,r!==""&&(e.name=r)}function DH(e,t,r){(t!=="number"||$k(e.ownerDocument)!==e)&&(r==null?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+r&&(e.defaultValue=""+r))}var aM=Array.isArray;function YE(e,t,r,i){if(e=e.options,t){t={};for(var s=0;s<r.length;s++)t["$"+r[s]]=!0;for(r=0;r<e.length;r++)s=t.hasOwnProperty("$"+e[r].value),e[r].selected!==s&&(e[r].selected=s),s&&i&&(e[r].defaultSelected=!0)}else{for(r=""+b1(r),t=null,s=0;s<e.length;s++){if(e[s].value===r){e[s].selected=!0,i&&(e[s].defaultSelected=!0);return}t!==null||e[s].disabled||(t=e[s])}t!==null&&(t.selected=!0)}}function NH(e,t){if(t.dangerouslySetInnerHTML!=null)throw Error(ke(91));return Ks({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function Une(e,t){var r=t.value;if(r==null){if(r=t.children,t=t.defaultValue,r!=null){if(t!=null)throw Error(ke(92));if(aM(r)){if(1<r.length)throw Error(ke(93));r=r[0]}t=r}t==null&&(t=""),r=t}e._wrapperState={initialValue:b1(r)}}function J0e(e,t){var r=b1(t.value),i=b1(t.defaultValue);r!=null&&(r=""+r,r!==e.value&&(e.value=r),t.defaultValue==null&&e.defaultValue!==r&&(e.defaultValue=r)),i!=null&&(e.defaultValue=""+i)}function Vne(e){var t=e.textContent;t===e._wrapperState.initialValue&&t!==""&&t!==null&&(e.value=t)}function K0e(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function FH(e,t){return e==null||e==="http://www.w3.org/1999/xhtml"?K0e(t):e==="http://www.w3.org/2000/svg"&&t==="foreignObject"?"http://www.w3.org/1999/xhtml":e}var tD,eve=function(e){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(t,r,i,s){MSApp.execUnsafeLocalFunction(function(){return e(t,r,i,s)})}:e}(function(e,t){if(e.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in e)e.innerHTML=t;else{for(tD=tD||document.createElement("div"),tD.innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=tD.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}});function NP(e,t){if(t){var r=e.firstChild;if(r&&r===e.lastChild&&r.nodeType===3){r.nodeValue=t;return}}e.textContent=t}var I3={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},NNe=["Webkit","ms","Moz","O"];Object.keys(I3).forEach(function(e){NNe.forEach(function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),I3[t]=I3[e]})});function tve(e,t,r){return t==null||typeof t=="boolean"||t===""?"":r||typeof t!="number"||t===0||I3.hasOwnProperty(e)&&I3[e]?(""+t).trim():t+"px"}function rve(e,t){e=e.style;for(var r in t)if(t.hasOwnProperty(r)){var i=r.indexOf("--")===0,s=tve(r,t[r],i);r==="float"&&(r="cssFloat"),i?e.setProperty(r,s):e[r]=s}}var FNe=Ks({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function kH(e,t){if(t){if(FNe[e]&&(t.children!=null||t.dangerouslySetInnerHTML!=null))throw Error(ke(137,e));if(t.dangerouslySetInnerHTML!=null){if(t.children!=null)throw Error(ke(60));if(typeof t.dangerouslySetInnerHTML!="object"||!("__html"in t.dangerouslySetInnerHTML))throw Error(ke(61))}if(t.style!=null&&typeof t.style!="object")throw Error(ke(62))}}function UH(e,t){if(e.indexOf("-")===-1)return typeof t.is=="string";switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var VH=null;function HJ(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var zH=null,QE=null,JE=null;function zne(e){if(e=L$(e)){if(typeof zH!="function")throw Error(ke(280));var t=e.stateNode;t&&(t=Mz(t),zH(e.stateNode,e.type,t))}}function ive(e){QE?JE?JE.push(e):JE=[e]:QE=e}function sve(){if(QE){var e=QE,t=JE;if(JE=QE=null,zne(e),t)for(e=0;e<t.length;e++)zne(t[e])}}function nve(e,t){return e(t)}function ove(){}var t9=!1;function ave(e,t,r){if(t9)return e(t,r);t9=!0;try{return nve(e,t,r)}finally{t9=!1,(QE!==null||JE!==null)&&(ove(),sve())}}function FP(e,t){var r=e.stateNode;if(r===null)return null;var i=Mz(r);if(i===null)return null;r=i[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(i=!i.disabled)||(e=e.type,i=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!i;break e;default:e=!1}if(e)return null;if(r&&typeof r!="function")throw Error(ke(231,t,typeof r));return r}var BH=!1;if(s0)try{var NR={};Object.defineProperty(NR,"passive",{get:function(){BH=!0}}),window.addEventListener("test",NR,NR),window.removeEventListener("test",NR,NR)}catch{BH=!1}function kNe(e,t,r,i,s,n,o,a,l){var c=Array.prototype.slice.call(arguments,3);try{t.apply(r,c)}catch(h){this.onError(h)}}var $3=!1,Lk=null,Dk=!1,GH=null,UNe={onError:function(e){$3=!0,Lk=e}};function VNe(e,t,r,i,s,n,o,a,l){$3=!1,Lk=null,kNe.apply(UNe,arguments)}function zNe(e,t,r,i,s,n,o,a,l){if(VNe.apply(this,arguments),$3){if($3){var c=Lk;$3=!1,Lk=null}else throw Error(ke(198));Dk||(Dk=!0,GH=c)}}function zT(e){var t=e,r=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do t=e,(t.flags&4098)!==0&&(r=t.return),e=t.return;while(e)}return t.tag===3?r:null}function lve(e){if(e.tag===13){var t=e.memoizedState;if(t===null&&(e=e.alternate,e!==null&&(t=e.memoizedState)),t!==null)return t.dehydrated}return null}function Bne(e){if(zT(e)!==e)throw Error(ke(188))}function BNe(e){var t=e.alternate;if(!t){if(t=zT(e),t===null)throw Error(ke(188));return t!==e?null:e}for(var r=e,i=t;;){var s=r.return;if(s===null)break;var n=s.alternate;if(n===null){if(i=s.return,i!==null){r=i;continue}break}if(s.child===n.child){for(n=s.child;n;){if(n===r)return Bne(s),e;if(n===i)return Bne(s),t;n=n.sibling}throw Error(ke(188))}if(r.return!==i.return)r=s,i=n;else{for(var o=!1,a=s.child;a;){if(a===r){o=!0,r=s,i=n;break}if(a===i){o=!0,i=s,r=n;break}a=a.sibling}if(!o){for(a=n.child;a;){if(a===r){o=!0,r=n,i=s;break}if(a===i){o=!0,i=n,r=s;break}a=a.sibling}if(!o)throw Error(ke(189))}}if(r.alternate!==i)throw Error(ke(190))}if(r.tag!==3)throw Error(ke(188));return r.stateNode.current===r?e:t}function cve(e){return e=BNe(e),e!==null?uve(e):null}function uve(e){if(e.tag===5||e.tag===6)return e;for(e=e.child;e!==null;){var t=uve(e);if(t!==null)return t;e=e.sibling}return null}var hve=mh.unstable_scheduleCallback,Gne=mh.unstable_cancelCallback,GNe=mh.unstable_shouldYield,jNe=mh.unstable_requestPaint,Ln=mh.unstable_now,HNe=mh.unstable_getCurrentPriorityLevel,qJ=mh.unstable_ImmediatePriority,dve=mh.unstable_UserBlockingPriority,Nk=mh.unstable_NormalPriority,qNe=mh.unstable_LowPriority,pve=mh.unstable_IdlePriority,Cz=null,Um=null;function WNe(e){if(Um&&typeof Um.onCommitFiberRoot=="function")try{Um.onCommitFiberRoot(Cz,e,void 0,(e.current.flags&128)===128)}catch{}}var uf=Math.clz32?Math.clz32:YNe,XNe=Math.log,ZNe=Math.LN2;function YNe(e){return e>>>=0,e===0?32:31-(XNe(e)/ZNe|0)|0}var rD=64,iD=4194304;function lM(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return e&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function Fk(e,t){var r=e.pendingLanes;if(r===0)return 0;var i=0,s=e.suspendedLanes,n=e.pingedLanes,o=r&268435455;if(o!==0){var a=o&~s;a!==0?i=lM(a):(n&=o,n!==0&&(i=lM(n)))}else o=r&~s,o!==0?i=lM(o):n!==0&&(i=lM(n));if(i===0)return 0;if(t!==0&&t!==i&&(t&s)===0&&(s=i&-i,n=t&-t,s>=n||s===16&&(n&4194240)!==0))return t;if((i&4)!==0&&(i|=r&16),t=e.entangledLanes,t!==0)for(e=e.entanglements,t&=i;0<t;)r=31-uf(t),s=1<<r,i|=e[r],t&=~s;return i}function QNe(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function JNe(e,t){for(var r=e.suspendedLanes,i=e.pingedLanes,s=e.expirationTimes,n=e.pendingLanes;0<n;){var o=31-uf(n),a=1<<o,l=s[o];l===-1?((a&r)===0||(a&i)!==0)&&(s[o]=QNe(a,t)):l<=t&&(e.expiredLanes|=a),n&=~a}}function jH(e){return e=e.pendingLanes&-1073741825,e!==0?e:e&1073741824?1073741824:0}function fve(){var e=rD;return rD<<=1,(rD&4194240)===0&&(rD=64),e}function r9(e){for(var t=[],r=0;31>r;r++)t.push(e);return t}function I$(e,t,r){e.pendingLanes|=t,t!==536870912&&(e.suspendedLanes=0,e.pingedLanes=0),e=e.eventTimes,t=31-uf(t),e[t]=r}function KNe(e,t){var r=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var i=e.eventTimes;for(e=e.expirationTimes;0<r;){var s=31-uf(r),n=1<<s;t[s]=0,i[s]=-1,e[s]=-1,r&=~n}}function WJ(e,t){var r=e.entangledLanes|=t;for(e=e.entanglements;r;){var i=31-uf(r),s=1<<i;s&t|e[i]&t&&(e[i]|=t),r&=~s}}var Ui=0;function mve(e){return e&=-e,1<e?4<e?(e&268435455)!==0?16:536870912:4:1}var gve,XJ,yve,vve,_ve,HH=!1,sD=[],J_=null,K_=null,e1=null,kP=new Map,UP=new Map,w_=[],eFe="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function jne(e,t){switch(e){case"focusin":case"focusout":J_=null;break;case"dragenter":case"dragleave":K_=null;break;case"mouseover":case"mouseout":e1=null;break;case"pointerover":case"pointerout":kP.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":UP.delete(t.pointerId)}}function FR(e,t,r,i,s,n){return e===null||e.nativeEvent!==n?(e={blockedOn:t,domEventName:r,eventSystemFlags:i,nativeEvent:n,targetContainers:[s]},t!==null&&(t=L$(t),t!==null&&XJ(t)),e):(e.eventSystemFlags|=i,t=e.targetContainers,s!==null&&t.indexOf(s)===-1&&t.push(s),e)}function tFe(e,t,r,i,s){switch(t){case"focusin":return J_=FR(J_,e,t,r,i,s),!0;case"dragenter":return K_=FR(K_,e,t,r,i,s),!0;case"mouseover":return e1=FR(e1,e,t,r,i,s),!0;case"pointerover":var n=s.pointerId;return kP.set(n,FR(kP.get(n)||null,e,t,r,i,s)),!0;case"gotpointercapture":return n=s.pointerId,UP.set(n,FR(UP.get(n)||null,e,t,r,i,s)),!0}return!1}function bve(e){var t=hx(e.target);if(t!==null){var r=zT(t);if(r!==null){if(t=r.tag,t===13){if(t=lve(r),t!==null){e.blockedOn=t,_ve(e.priority,function(){yve(r)});return}}else if(t===3&&r.stateNode.current.memoizedState.isDehydrated){e.blockedOn=r.tag===3?r.stateNode.containerInfo:null;return}}}e.blockedOn=null}function _4(e){if(e.blockedOn!==null)return!1;for(var t=e.targetContainers;0<t.length;){var r=qH(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(r===null){r=e.nativeEvent;var i=new r.constructor(r.type,r);VH=i,r.target.dispatchEvent(i),VH=null}else return t=L$(r),t!==null&&XJ(t),e.blockedOn=r,!1;t.shift()}return!0}function Hne(e,t,r){_4(e)&&r.delete(t)}function rFe(){HH=!1,J_!==null&&_4(J_)&&(J_=null),K_!==null&&_4(K_)&&(K_=null),e1!==null&&_4(e1)&&(e1=null),kP.forEach(Hne),UP.forEach(Hne)}function kR(e,t){e.blockedOn===t&&(e.blockedOn=null,HH||(HH=!0,mh.unstable_scheduleCallback(mh.unstable_NormalPriority,rFe)))}function VP(e){function t(s){return kR(s,e)}if(0<sD.length){kR(sD[0],e);for(var r=1;r<sD.length;r++){var i=sD[r];i.blockedOn===e&&(i.blockedOn=null)}}for(J_!==null&&kR(J_,e),K_!==null&&kR(K_,e),e1!==null&&kR(e1,e),kP.forEach(t),UP.forEach(t),r=0;r<w_.length;r++)i=w_[r],i.blockedOn===e&&(i.blockedOn=null);for(;0<w_.length&&(r=w_[0],r.blockedOn===null);)bve(r),r.blockedOn===null&&w_.shift()}var KE=T0.ReactCurrentBatchConfig,kk=!0;function iFe(e,t,r,i){var s=Ui,n=KE.transition;KE.transition=null;try{Ui=1,ZJ(e,t,r,i)}finally{Ui=s,KE.transition=n}}function sFe(e,t,r,i){var s=Ui,n=KE.transition;KE.transition=null;try{Ui=4,ZJ(e,t,r,i)}finally{Ui=s,KE.transition=n}}function ZJ(e,t,r,i){if(kk){var s=qH(e,t,r,i);if(s===null)d9(e,t,i,Uk,r),jne(e,i);else if(tFe(s,e,t,r,i))i.stopPropagation();else if(jne(e,i),t&4&&-1<eFe.indexOf(e)){for(;s!==null;){var n=L$(s);if(n!==null&&gve(n),n=qH(e,t,r,i),n===null&&d9(e,t,i,Uk,r),n===s)break;s=n}s!==null&&i.stopPropagation()}else d9(e,t,i,null,r)}}var Uk=null;function qH(e,t,r,i){if(Uk=null,e=HJ(i),e=hx(e),e!==null)if(t=zT(e),t===null)e=null;else if(r=t.tag,r===13){if(e=lve(t),e!==null)return e;e=null}else if(r===3){if(t.stateNode.current.memoizedState.isDehydrated)return t.tag===3?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return Uk=e,null}function wve(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(HNe()){case qJ:return 1;case dve:return 4;case Nk:case qNe:return 16;case pve:return 536870912;default:return 16}default:return 16}}var P_=null,YJ=null,b4=null;function xve(){if(b4)return b4;var e,t=YJ,r=t.length,i,s="value"in P_?P_.value:P_.textContent,n=s.length;for(e=0;e<r&&t[e]===s[e];e++);var o=r-e;for(i=1;i<=o&&t[r-i]===s[n-i];i++);return b4=s.slice(e,1<i?1-i:void 0)}function w4(e){var t=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&t===13&&(e=13)):e=t,e===10&&(e=13),32<=e||e===13?e:0}function nD(){return!0}function qne(){return!1}function Eh(e){function t(r,i,s,n,o){this._reactName=r,this._targetInst=s,this.type=i,this.nativeEvent=n,this.target=o,this.currentTarget=null;for(var a in e)e.hasOwnProperty(a)&&(r=e[a],this[a]=r?r(n):n[a]);return this.isDefaultPrevented=(n.defaultPrevented!=null?n.defaultPrevented:n.returnValue===!1)?nD:qne,this.isPropagationStopped=qne,this}return Ks(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var r=this.nativeEvent;r&&(r.preventDefault?r.preventDefault():typeof r.returnValue!="unknown"&&(r.returnValue=!1),this.isDefaultPrevented=nD)},stopPropagation:function(){var r=this.nativeEvent;r&&(r.stopPropagation?r.stopPropagation():typeof r.cancelBubble!="unknown"&&(r.cancelBubble=!0),this.isPropagationStopped=nD)},persist:function(){},isPersistent:nD}),t}var eR={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},QJ=Eh(eR),$$=Ks({},eR,{view:0,detail:0}),nFe=Eh($$),i9,s9,UR,Az=Ks({},$$,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:JJ,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==UR&&(UR&&e.type==="mousemove"?(i9=e.screenX-UR.screenX,s9=e.screenY-UR.screenY):s9=i9=0,UR=e),i9)},movementY:function(e){return"movementY"in e?e.movementY:s9}}),Wne=Eh(Az),oFe=Ks({},Az,{dataTransfer:0}),aFe=Eh(oFe),lFe=Ks({},$$,{relatedTarget:0}),n9=Eh(lFe),cFe=Ks({},eR,{animationName:0,elapsedTime:0,pseudoElement:0}),uFe=Eh(cFe),hFe=Ks({},eR,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),dFe=Eh(hFe),pFe=Ks({},eR,{data:0}),Xne=Eh(pFe),fFe={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},mFe={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},gFe={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function yFe(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):(e=gFe[e])?!!t[e]:!1}function JJ(){return yFe}var vFe=Ks({},$$,{key:function(e){if(e.key){var t=fFe[e.key]||e.key;if(t!=="Unidentified")return t}return e.type==="keypress"?(e=w4(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?mFe[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:JJ,charCode:function(e){return e.type==="keypress"?w4(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?w4(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),_Fe=Eh(vFe),bFe=Ks({},Az,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Zne=Eh(bFe),wFe=Ks({},$$,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:JJ}),xFe=Eh(wFe),TFe=Ks({},eR,{propertyName:0,elapsedTime:0,pseudoElement:0}),SFe=Eh(TFe),EFe=Ks({},Az,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),CFe=Eh(EFe),AFe=[9,13,27,32],KJ=s0&&"CompositionEvent"in window,L3=null;s0&&"documentMode"in document&&(L3=document.documentMode);var RFe=s0&&"TextEvent"in window&&!L3,Tve=s0&&(!KJ||L3&&8<L3&&11>=L3),Yne=String.fromCharCode(32),Qne=!1;function Sve(e,t){switch(e){case"keyup":return AFe.indexOf(t.keyCode)!==-1;case"keydown":return t.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Eve(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var fE=!1;function OFe(e,t){switch(e){case"compositionend":return Eve(t);case"keypress":return t.which!==32?null:(Qne=!0,Yne);case"textInput":return e=t.data,e===Yne&&Qne?null:e;default:return null}}function MFe(e,t){if(fE)return e==="compositionend"||!KJ&&Sve(e,t)?(e=xve(),b4=YJ=P_=null,fE=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return Tve&&t.locale!=="ko"?null:t.data;default:return null}}var PFe={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Jne(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t==="input"?!!PFe[e.type]:t==="textarea"}function Cve(e,t,r,i){ive(i),t=Vk(t,"onChange"),0<t.length&&(r=new QJ("onChange","change",null,r,i),e.push({event:r,listeners:t}))}var D3=null,zP=null;function IFe(e){Fve(e,0)}function Rz(e){var t=yE(e);if(Y0e(t))return e}function $Fe(e,t){if(e==="change")return t}var Ave=!1;if(s0){var o9;if(s0){var a9="oninput"in document;if(!a9){var Kne=document.createElement("div");Kne.setAttribute("oninput","return;"),a9=typeof Kne.oninput=="function"}o9=a9}else o9=!1;Ave=o9&&(!document.documentMode||9<document.documentMode)}function eoe(){D3&&(D3.detachEvent("onpropertychange",Rve),zP=D3=null)}function Rve(e){if(e.propertyName==="value"&&Rz(zP)){var t=[];Cve(t,zP,e,HJ(e)),ave(IFe,t)}}function LFe(e,t,r){e==="focusin"?(eoe(),D3=t,zP=r,D3.attachEvent("onpropertychange",Rve)):e==="focusout"&&eoe()}function DFe(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return Rz(zP)}function NFe(e,t){if(e==="click")return Rz(t)}function FFe(e,t){if(e==="input"||e==="change")return Rz(t)}function kFe(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var yf=typeof Object.is=="function"?Object.is:kFe;function BP(e,t){if(yf(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;var r=Object.keys(e),i=Object.keys(t);if(r.length!==i.length)return!1;for(i=0;i<r.length;i++){var s=r[i];if(!RH.call(t,s)||!yf(e[s],t[s]))return!1}return!0}function toe(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function roe(e,t){var r=toe(e);e=0;for(var i;r;){if(r.nodeType===3){if(i=e+r.textContent.length,e<=t&&i>=t)return{node:r,offset:t-e};e=i}e:{for(;r;){if(r.nextSibling){r=r.nextSibling;break e}r=r.parentNode}r=void 0}r=toe(r)}}function Ove(e,t){return e&&t?e===t?!0:e&&e.nodeType===3?!1:t&&t.nodeType===3?Ove(e,t.parentNode):"contains"in e?e.contains(t):e.compareDocumentPosition?!!(e.compareDocumentPosition(t)&16):!1:!1}function Mve(){for(var e=window,t=$k();t instanceof e.HTMLIFrameElement;){try{var r=typeof t.contentWindow.location.href=="string"}catch{r=!1}if(r)e=t.contentWindow;else break;t=$k(e.document)}return t}function eK(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&(t==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||t==="textarea"||e.contentEditable==="true")}function UFe(e){var t=Mve(),r=e.focusedElem,i=e.selectionRange;if(t!==r&&r&&r.ownerDocument&&Ove(r.ownerDocument.documentElement,r)){if(i!==null&&eK(r)){if(t=i.start,e=i.end,e===void 0&&(e=t),"selectionStart"in r)r.selectionStart=t,r.selectionEnd=Math.min(e,r.value.length);else if(e=(t=r.ownerDocument||document)&&t.defaultView||window,e.getSelection){e=e.getSelection();var s=r.textContent.length,n=Math.min(i.start,s);i=i.end===void 0?n:Math.min(i.end,s),!e.extend&&n>i&&(s=i,i=n,n=s),s=roe(r,n);var o=roe(r,i);s&&o&&(e.rangeCount!==1||e.anchorNode!==s.node||e.anchorOffset!==s.offset||e.focusNode!==o.node||e.focusOffset!==o.offset)&&(t=t.createRange(),t.setStart(s.node,s.offset),e.removeAllRanges(),n>i?(e.addRange(t),e.extend(o.node,o.offset)):(t.setEnd(o.node,o.offset),e.addRange(t)))}}for(t=[],e=r;e=e.parentNode;)e.nodeType===1&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for(typeof r.focus=="function"&&r.focus(),r=0;r<t.length;r++)e=t[r],e.element.scrollLeft=e.left,e.element.scrollTop=e.top}}var VFe=s0&&"documentMode"in document&&11>=document.documentMode,mE=null,WH=null,N3=null,XH=!1;function ioe(e,t,r){var i=r.window===r?r.document:r.nodeType===9?r:r.ownerDocument;XH||mE==null||mE!==$k(i)||(i=mE,"selectionStart"in i&&eK(i)?i={start:i.selectionStart,end:i.selectionEnd}:(i=(i.ownerDocument&&i.ownerDocument.defaultView||window).getSelection(),i={anchorNode:i.anchorNode,anchorOffset:i.anchorOffset,focusNode:i.focusNode,focusOffset:i.focusOffset}),N3&&BP(N3,i)||(N3=i,i=Vk(WH,"onSelect"),0<i.length&&(t=new QJ("onSelect","select",null,t,r),e.push({event:t,listeners:i}),t.target=mE)))}function oD(e,t){var r={};return r[e.toLowerCase()]=t.toLowerCase(),r["Webkit"+e]="webkit"+t,r["Moz"+e]="moz"+t,r}var gE={animationend:oD("Animation","AnimationEnd"),animationiteration:oD("Animation","AnimationIteration"),animationstart:oD("Animation","AnimationStart"),transitionend:oD("Transition","TransitionEnd")},l9={},Pve={};s0&&(Pve=document.createElement("div").style,"AnimationEvent"in window||(delete gE.animationend.animation,delete gE.animationiteration.animation,delete gE.animationstart.animation),"TransitionEvent"in window||delete gE.transitionend.transition);function Oz(e){if(l9[e])return l9[e];if(!gE[e])return e;var t=gE[e],r;for(r in t)if(t.hasOwnProperty(r)&&r in Pve)return l9[e]=t[r];return e}var Ive=Oz("animationend"),$ve=Oz("animationiteration"),Lve=Oz("animationstart"),Dve=Oz("transitionend"),Nve=new Map,soe="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function q1(e,t){Nve.set(e,t),VT(t,[e])}for(var c9=0;c9<soe.length;c9++){var u9=soe[c9],zFe=u9.toLowerCase(),BFe=u9[0].toUpperCase()+u9.slice(1);q1(zFe,"on"+BFe)}q1(Ive,"onAnimationEnd");q1($ve,"onAnimationIteration");q1(Lve,"onAnimationStart");q1("dblclick","onDoubleClick");q1("focusin","onFocus");q1("focusout","onBlur");q1(Dve,"onTransitionEnd");$C("onMouseEnter",["mouseout","mouseover"]);$C("onMouseLeave",["mouseout","mouseover"]);$C("onPointerEnter",["pointerout","pointerover"]);$C("onPointerLeave",["pointerout","pointerover"]);VT("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));VT("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));VT("onBeforeInput",["compositionend","keypress","textInput","paste"]);VT("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));VT("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));VT("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var cM="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),GFe=new Set("cancel close invalid load scroll toggle".split(" ").concat(cM));function noe(e,t,r){var i=e.type||"unknown-event";e.currentTarget=r,zNe(i,t,void 0,e),e.currentTarget=null}function Fve(e,t){t=(t&4)!==0;for(var r=0;r<e.length;r++){var i=e[r],s=i.event;i=i.listeners;e:{var n=void 0;if(t)for(var o=i.length-1;0<=o;o--){var a=i[o],l=a.instance,c=a.currentTarget;if(a=a.listener,l!==n&&s.isPropagationStopped())break e;noe(s,a,c),n=l}else for(o=0;o<i.length;o++){if(a=i[o],l=a.instance,c=a.currentTarget,a=a.listener,l!==n&&s.isPropagationStopped())break e;noe(s,a,c),n=l}}}if(Dk)throw e=GH,Dk=!1,GH=null,e}function ms(e,t){var r=t[KH];r===void 0&&(r=t[KH]=new Set);var i=e+"__bubble";r.has(i)||(kve(t,e,2,!1),r.add(i))}function h9(e,t,r){var i=0;t&&(i|=4),kve(r,e,i,t)}var aD="_reactListening"+Math.random().toString(36).slice(2);function GP(e){if(!e[aD]){e[aD]=!0,H0e.forEach(function(r){r!=="selectionchange"&&(GFe.has(r)||h9(r,!1,e),h9(r,!0,e))});var t=e.nodeType===9?e:e.ownerDocument;t===null||t[aD]||(t[aD]=!0,h9("selectionchange",!1,t))}}function kve(e,t,r,i){switch(wve(t)){case 1:var s=iFe;break;case 4:s=sFe;break;default:s=ZJ}r=s.bind(null,t,r,e),s=void 0,!BH||t!=="touchstart"&&t!=="touchmove"&&t!=="wheel"||(s=!0),i?s!==void 0?e.addEventListener(t,r,{capture:!0,passive:s}):e.addEventListener(t,r,!0):s!==void 0?e.addEventListener(t,r,{passive:s}):e.addEventListener(t,r,!1)}function d9(e,t,r,i,s){var n=i;if((t&1)===0&&(t&2)===0&&i!==null)e:for(;;){if(i===null)return;var o=i.tag;if(o===3||o===4){var a=i.stateNode.containerInfo;if(a===s||a.nodeType===8&&a.parentNode===s)break;if(o===4)for(o=i.return;o!==null;){var l=o.tag;if((l===3||l===4)&&(l=o.stateNode.containerInfo,l===s||l.nodeType===8&&l.parentNode===s))return;o=o.return}for(;a!==null;){if(o=hx(a),o===null)return;if(l=o.tag,l===5||l===6){i=n=o;continue e}a=a.parentNode}}i=i.return}ave(function(){var c=n,h=HJ(r),p=[];e:{var f=Nve.get(e);if(f!==void 0){var m=QJ,g=e;switch(e){case"keypress":if(w4(r)===0)break e;case"keydown":case"keyup":m=_Fe;break;case"focusin":g="focus",m=n9;break;case"focusout":g="blur",m=n9;break;case"beforeblur":case"afterblur":m=n9;break;case"click":if(r.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":m=Wne;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":m=aFe;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":m=xFe;break;case Ive:case $ve:case Lve:m=uFe;break;case Dve:m=SFe;break;case"scroll":m=nFe;break;case"wheel":m=CFe;break;case"copy":case"cut":case"paste":m=dFe;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":m=Zne}var v=(t&4)!==0,w=!v&&e==="scroll",_=v?f!==null?f+"Capture":null:f;v=[];for(var T=c,x;T!==null;){x=T;var E=x.stateNode;if(x.tag===5&&E!==null&&(x=E,_!==null&&(E=FP(T,_),E!=null&&v.push(jP(T,E,x)))),w)break;T=T.return}0<v.length&&(f=new m(f,g,null,r,h),p.push({event:f,listeners:v}))}}if((t&7)===0){e:{if(f=e==="mouseover"||e==="pointerover",m=e==="mouseout"||e==="pointerout",f&&r!==VH&&(g=r.relatedTarget||r.fromElement)&&(hx(g)||g[n0]))break e;if((m||f)&&(f=h.window===h?h:(f=h.ownerDocument)?f.defaultView||f.parentWindow:window,m?(g=r.relatedTarget||r.toElement,m=c,g=g?hx(g):null,g!==null&&(w=zT(g),g!==w||g.tag!==5&&g.tag!==6)&&(g=null)):(m=null,g=c),m!==g)){if(v=Wne,E="onMouseLeave",_="onMouseEnter",T="mouse",(e==="pointerout"||e==="pointerover")&&(v=Zne,E="onPointerLeave",_="onPointerEnter",T="pointer"),w=m==null?f:yE(m),x=g==null?f:yE(g),f=new v(E,T+"leave",m,r,h),f.target=w,f.relatedTarget=x,E=null,hx(h)===c&&(v=new v(_,T+"enter",g,r,h),v.target=x,v.relatedTarget=w,E=v),w=E,m&&g)t:{for(v=m,_=g,T=0,x=v;x;x=lS(x))T++;for(x=0,E=_;E;E=lS(E))x++;for(;0<T-x;)v=lS(v),T--;for(;0<x-T;)_=lS(_),x--;for(;T--;){if(v===_||_!==null&&v===_.alternate)break t;v=lS(v),_=lS(_)}v=null}else v=null;m!==null&&ooe(p,f,m,v,!1),g!==null&&w!==null&&ooe(p,w,g,v,!0)}}e:{if(f=c?yE(c):window,m=f.nodeName&&f.nodeName.toLowerCase(),m==="select"||m==="input"&&f.type==="file")var C=$Fe;else if(Jne(f))if(Ave)C=FFe;else{C=DFe;var A=LFe}else(m=f.nodeName)&&m.toLowerCase()==="input"&&(f.type==="checkbox"||f.type==="radio")&&(C=NFe);if(C&&(C=C(e,c))){Cve(p,C,r,h);break e}A&&A(e,f,c),e==="focusout"&&(A=f._wrapperState)&&A.controlled&&f.type==="number"&&DH(f,"number",f.value)}switch(A=c?yE(c):window,e){case"focusin":(Jne(A)||A.contentEditable==="true")&&(mE=A,WH=c,N3=null);break;case"focusout":N3=WH=mE=null;break;case"mousedown":XH=!0;break;case"contextmenu":case"mouseup":case"dragend":XH=!1,ioe(p,r,h);break;case"selectionchange":if(VFe)break;case"keydown":case"keyup":ioe(p,r,h)}var P;if(KJ)e:{switch(e){case"compositionstart":var I="onCompositionStart";break e;case"compositionend":I="onCompositionEnd";break e;case"compositionupdate":I="onCompositionUpdate";break e}I=void 0}else fE?Sve(e,r)&&(I="onCompositionEnd"):e==="keydown"&&r.keyCode===229&&(I="onCompositionStart");I&&(Tve&&r.locale!=="ko"&&(fE||I!=="onCompositionStart"?I==="onCompositionEnd"&&fE&&(P=xve()):(P_=h,YJ="value"in P_?P_.value:P_.textContent,fE=!0)),A=Vk(c,I),0<A.length&&(I=new Xne(I,e,null,r,h),p.push({event:I,listeners:A}),P?I.data=P:(P=Eve(r),P!==null&&(I.data=P)))),(P=RFe?OFe(e,r):MFe(e,r))&&(c=Vk(c,"onBeforeInput"),0<c.length&&(h=new Xne("onBeforeInput","beforeinput",null,r,h),p.push({event:h,listeners:c}),h.data=P))}Fve(p,t)})}function jP(e,t,r){return{instance:e,listener:t,currentTarget:r}}function Vk(e,t){for(var r=t+"Capture",i=[];e!==null;){var s=e,n=s.stateNode;s.tag===5&&n!==null&&(s=n,n=FP(e,r),n!=null&&i.unshift(jP(e,n,s)),n=FP(e,t),n!=null&&i.push(jP(e,n,s))),e=e.return}return i}function lS(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5);return e||null}function ooe(e,t,r,i,s){for(var n=t._reactName,o=[];r!==null&&r!==i;){var a=r,l=a.alternate,c=a.stateNode;if(l!==null&&l===i)break;a.tag===5&&c!==null&&(a=c,s?(l=FP(r,n),l!=null&&o.unshift(jP(r,l,a))):s||(l=FP(r,n),l!=null&&o.push(jP(r,l,a)))),r=r.return}o.length!==0&&e.push({event:t,listeners:o})}var jFe=/\r\n?/g,HFe=/\u0000|\uFFFD/g;function aoe(e){return(typeof e=="string"?e:""+e).replace(jFe,`
`).replace(HFe,"")}function lD(e,t,r){if(t=aoe(t),aoe(e)!==t&&r)throw Error(ke(425))}function zk(){}var ZH=null,YH=null;function QH(e,t){return e==="textarea"||e==="noscript"||typeof t.children=="string"||typeof t.children=="number"||typeof t.dangerouslySetInnerHTML=="object"&&t.dangerouslySetInnerHTML!==null&&t.dangerouslySetInnerHTML.__html!=null}var JH=typeof setTimeout=="function"?setTimeout:void 0,qFe=typeof clearTimeout=="function"?clearTimeout:void 0,loe=typeof Promise=="function"?Promise:void 0,WFe=typeof queueMicrotask=="function"?queueMicrotask:typeof loe<"u"?function(e){return loe.resolve(null).then(e).catch(XFe)}:JH;function XFe(e){setTimeout(function(){throw e})}function p9(e,t){var r=t,i=0;do{var s=r.nextSibling;if(e.removeChild(r),s&&s.nodeType===8)if(r=s.data,r==="/$"){if(i===0){e.removeChild(s),VP(t);return}i--}else r!=="$"&&r!=="$?"&&r!=="$!"||i++;r=s}while(r);VP(t)}function t1(e){for(;e!=null;e=e.nextSibling){var t=e.nodeType;if(t===1||t===3)break;if(t===8){if(t=e.data,t==="$"||t==="$!"||t==="$?")break;if(t==="/$")return null}}return e}function coe(e){e=e.previousSibling;for(var t=0;e;){if(e.nodeType===8){var r=e.data;if(r==="$"||r==="$!"||r==="$?"){if(t===0)return e;t--}else r==="/$"&&t++}e=e.previousSibling}return null}var tR=Math.random().toString(36).slice(2),Mm="__reactFiber$"+tR,HP="__reactProps$"+tR,n0="__reactContainer$"+tR,KH="__reactEvents$"+tR,ZFe="__reactListeners$"+tR,YFe="__reactHandles$"+tR;function hx(e){var t=e[Mm];if(t)return t;for(var r=e.parentNode;r;){if(t=r[n0]||r[Mm]){if(r=t.alternate,t.child!==null||r!==null&&r.child!==null)for(e=coe(e);e!==null;){if(r=e[Mm])return r;e=coe(e)}return t}e=r,r=e.parentNode}return null}function L$(e){return e=e[Mm]||e[n0],!e||e.tag!==5&&e.tag!==6&&e.tag!==13&&e.tag!==3?null:e}function yE(e){if(e.tag===5||e.tag===6)return e.stateNode;throw Error(ke(33))}function Mz(e){return e[HP]||null}var eq=[],vE=-1;function W1(e){return{current:e}}function Es(e){0>vE||(e.current=eq[vE],eq[vE]=null,vE--)}function cs(e,t){vE++,eq[vE]=e.current,e.current=t}var w1={},fl=W1(w1),Yc=W1(!1),Yx=w1;function LC(e,t){var r=e.type.contextTypes;if(!r)return w1;var i=e.stateNode;if(i&&i.__reactInternalMemoizedUnmaskedChildContext===t)return i.__reactInternalMemoizedMaskedChildContext;var s={},n;for(n in r)s[n]=t[n];return i&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=s),s}function Qc(e){return e=e.childContextTypes,e!=null}function Bk(){Es(Yc),Es(fl)}function uoe(e,t,r){if(fl.current!==w1)throw Error(ke(168));cs(fl,t),cs(Yc,r)}function Uve(e,t,r){var i=e.stateNode;if(t=t.childContextTypes,typeof i.getChildContext!="function")return r;i=i.getChildContext();for(var s in i)if(!(s in t))throw Error(ke(108,LNe(e)||"Unknown",s));return Ks({},r,i)}function Gk(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||w1,Yx=fl.current,cs(fl,e),cs(Yc,Yc.current),!0}function hoe(e,t,r){var i=e.stateNode;if(!i)throw Error(ke(169));r?(e=Uve(e,t,Yx),i.__reactInternalMemoizedMergedChildContext=e,Es(Yc),Es(fl),cs(fl,e)):Es(Yc),cs(Yc,r)}var Ey=null,Pz=!1,f9=!1;function Vve(e){Ey===null?Ey=[e]:Ey.push(e)}function QFe(e){Pz=!0,Vve(e)}function X1(){if(!f9&&Ey!==null){f9=!0;var e=0,t=Ui;try{var r=Ey;for(Ui=1;e<r.length;e++){var i=r[e];do i=i(!0);while(i!==null)}Ey=null,Pz=!1}catch(s){throw Ey!==null&&(Ey=Ey.slice(e+1)),hve(qJ,X1),s}finally{Ui=t,f9=!1}}return null}var _E=[],bE=0,jk=null,Hk=0,fd=[],md=0,Qx=null,$y=1,Ly="";function qb(e,t){_E[bE++]=Hk,_E[bE++]=jk,jk=e,Hk=t}function zve(e,t,r){fd[md++]=$y,fd[md++]=Ly,fd[md++]=Qx,Qx=e;var i=$y;e=Ly;var s=32-uf(i)-1;i&=~(1<<s),r+=1;var n=32-uf(t)+s;if(30<n){var o=s-s%5;n=(i&(1<<o)-1).toString(32),i>>=o,s-=o,$y=1<<32-uf(t)+s|r<<s|i,Ly=n+e}else $y=1<<n|r<<s|i,Ly=e}function tK(e){e.return!==null&&(qb(e,1),zve(e,1,0))}function rK(e){for(;e===jk;)jk=_E[--bE],_E[bE]=null,Hk=_E[--bE],_E[bE]=null;for(;e===Qx;)Qx=fd[--md],fd[md]=null,Ly=fd[--md],fd[md]=null,$y=fd[--md],fd[md]=null}var oh=null,rh=null,Ps=!1,jp=null;function Bve(e,t){var r=Ad(5,null,null,0);r.elementType="DELETED",r.stateNode=t,r.return=e,t=e.deletions,t===null?(e.deletions=[r],e.flags|=16):t.push(r)}function doe(e,t){switch(e.tag){case 5:var r=e.type;return t=t.nodeType!==1||r.toLowerCase()!==t.nodeName.toLowerCase()?null:t,t!==null?(e.stateNode=t,oh=e,rh=t1(t.firstChild),!0):!1;case 6:return t=e.pendingProps===""||t.nodeType!==3?null:t,t!==null?(e.stateNode=t,oh=e,rh=null,!0):!1;case 13:return t=t.nodeType!==8?null:t,t!==null?(r=Qx!==null?{id:$y,overflow:Ly}:null,e.memoizedState={dehydrated:t,treeContext:r,retryLane:1073741824},r=Ad(18,null,null,0),r.stateNode=t,r.return=e,e.child=r,oh=e,rh=null,!0):!1;default:return!1}}function tq(e){return(e.mode&1)!==0&&(e.flags&128)===0}function rq(e){if(Ps){var t=rh;if(t){var r=t;if(!doe(e,t)){if(tq(e))throw Error(ke(418));t=t1(r.nextSibling);var i=oh;t&&doe(e,t)?Bve(i,r):(e.flags=e.flags&-4097|2,Ps=!1,oh=e)}}else{if(tq(e))throw Error(ke(418));e.flags=e.flags&-4097|2,Ps=!1,oh=e}}}function poe(e){for(e=e.return;e!==null&&e.tag!==5&&e.tag!==3&&e.tag!==13;)e=e.return;oh=e}function cD(e){if(e!==oh)return!1;if(!Ps)return poe(e),Ps=!0,!1;var t;if((t=e.tag!==3)&&!(t=e.tag!==5)&&(t=e.type,t=t!=="head"&&t!=="body"&&!QH(e.type,e.memoizedProps)),t&&(t=rh)){if(tq(e))throw Gve(),Error(ke(418));for(;t;)Bve(e,t),t=t1(t.nextSibling)}if(poe(e),e.tag===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(ke(317));e:{for(e=e.nextSibling,t=0;e;){if(e.nodeType===8){var r=e.data;if(r==="/$"){if(t===0){rh=t1(e.nextSibling);break e}t--}else r!=="$"&&r!=="$!"&&r!=="$?"||t++}e=e.nextSibling}rh=null}}else rh=oh?t1(e.stateNode.nextSibling):null;return!0}function Gve(){for(var e=rh;e;)e=t1(e.nextSibling)}function DC(){rh=oh=null,Ps=!1}function iK(e){jp===null?jp=[e]:jp.push(e)}var JFe=T0.ReactCurrentBatchConfig;function Dp(e,t){if(e&&e.defaultProps){t=Ks({},t),e=e.defaultProps;for(var r in e)t[r]===void 0&&(t[r]=e[r]);return t}return t}var qk=W1(null),Wk=null,wE=null,sK=null;function nK(){sK=wE=Wk=null}function oK(e){var t=qk.current;Es(qk),e._currentValue=t}function iq(e,t,r){for(;e!==null;){var i=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,i!==null&&(i.childLanes|=t)):i!==null&&(i.childLanes&t)!==t&&(i.childLanes|=t),e===r)break;e=e.return}}function eC(e,t){Wk=e,sK=wE=null,e=e.dependencies,e!==null&&e.firstContext!==null&&((e.lanes&t)!==0&&(jc=!0),e.firstContext=null)}function Dd(e){var t=e._currentValue;if(sK!==e)if(e={context:e,memoizedValue:t,next:null},wE===null){if(Wk===null)throw Error(ke(308));wE=e,Wk.dependencies={lanes:0,firstContext:e}}else wE=wE.next=e;return t}var dx=null;function aK(e){dx===null?dx=[e]:dx.push(e)}function jve(e,t,r,i){var s=t.interleaved;return s===null?(r.next=r,aK(t)):(r.next=s.next,s.next=r),t.interleaved=r,o0(e,i)}function o0(e,t){e.lanes|=t;var r=e.alternate;for(r!==null&&(r.lanes|=t),r=e,e=e.return;e!==null;)e.childLanes|=t,r=e.alternate,r!==null&&(r.childLanes|=t),r=e,e=e.return;return r.tag===3?r.stateNode:null}var l_=!1;function lK(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Hve(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function By(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function r1(e,t,r){var i=e.updateQueue;if(i===null)return null;if(i=i.shared,(di&2)!==0){var s=i.pending;return s===null?t.next=t:(t.next=s.next,s.next=t),i.pending=t,o0(e,r)}return s=i.interleaved,s===null?(t.next=t,aK(i)):(t.next=s.next,s.next=t),i.interleaved=t,o0(e,r)}function x4(e,t,r){if(t=t.updateQueue,t!==null&&(t=t.shared,(r&4194240)!==0)){var i=t.lanes;i&=e.pendingLanes,r|=i,t.lanes=r,WJ(e,r)}}function foe(e,t){var r=e.updateQueue,i=e.alternate;if(i!==null&&(i=i.updateQueue,r===i)){var s=null,n=null;if(r=r.firstBaseUpdate,r!==null){do{var o={eventTime:r.eventTime,lane:r.lane,tag:r.tag,payload:r.payload,callback:r.callback,next:null};n===null?s=n=o:n=n.next=o,r=r.next}while(r!==null);n===null?s=n=t:n=n.next=t}else s=n=t;r={baseState:i.baseState,firstBaseUpdate:s,lastBaseUpdate:n,shared:i.shared,effects:i.effects},e.updateQueue=r;return}e=r.lastBaseUpdate,e===null?r.firstBaseUpdate=t:e.next=t,r.lastBaseUpdate=t}function Xk(e,t,r,i){var s=e.updateQueue;l_=!1;var n=s.firstBaseUpdate,o=s.lastBaseUpdate,a=s.shared.pending;if(a!==null){s.shared.pending=null;var l=a,c=l.next;l.next=null,o===null?n=c:o.next=c,o=l;var h=e.alternate;h!==null&&(h=h.updateQueue,a=h.lastBaseUpdate,a!==o&&(a===null?h.firstBaseUpdate=c:a.next=c,h.lastBaseUpdate=l))}if(n!==null){var p=s.baseState;o=0,h=c=l=null,a=n;do{var f=a.lane,m=a.eventTime;if((i&f)===f){h!==null&&(h=h.next={eventTime:m,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});e:{var g=e,v=a;switch(f=t,m=r,v.tag){case 1:if(g=v.payload,typeof g=="function"){p=g.call(m,p,f);break e}p=g;break e;case 3:g.flags=g.flags&-65537|128;case 0:if(g=v.payload,f=typeof g=="function"?g.call(m,p,f):g,f==null)break e;p=Ks({},p,f);break e;case 2:l_=!0}}a.callback!==null&&a.lane!==0&&(e.flags|=64,f=s.effects,f===null?s.effects=[a]:f.push(a))}else m={eventTime:m,lane:f,tag:a.tag,payload:a.payload,callback:a.callback,next:null},h===null?(c=h=m,l=p):h=h.next=m,o|=f;if(a=a.next,a===null){if(a=s.shared.pending,a===null)break;f=a,a=f.next,f.next=null,s.lastBaseUpdate=f,s.shared.pending=null}}while(1);if(h===null&&(l=p),s.baseState=l,s.firstBaseUpdate=c,s.lastBaseUpdate=h,t=s.shared.interleaved,t!==null){s=t;do o|=s.lane,s=s.next;while(s!==t)}else n===null&&(s.shared.lanes=0);Kx|=o,e.lanes=o,e.memoizedState=p}}function moe(e,t,r){if(e=t.effects,t.effects=null,e!==null)for(t=0;t<e.length;t++){var i=e[t],s=i.callback;if(s!==null){if(i.callback=null,i=r,typeof s!="function")throw Error(ke(191,s));s.call(i)}}}var qve=new j0e.Component().refs;function sq(e,t,r,i){t=e.memoizedState,r=r(i,t),r=r==null?t:Ks({},t,r),e.memoizedState=r,e.lanes===0&&(e.updateQueue.baseState=r)}var Iz={isMounted:function(e){return(e=e._reactInternals)?zT(e)===e:!1},enqueueSetState:function(e,t,r){e=e._reactInternals;var i=Ql(),s=s1(e),n=By(i,s);n.payload=t,r!=null&&(n.callback=r),t=r1(e,n,s),t!==null&&(hf(t,e,s,i),x4(t,e,s))},enqueueReplaceState:function(e,t,r){e=e._reactInternals;var i=Ql(),s=s1(e),n=By(i,s);n.tag=1,n.payload=t,r!=null&&(n.callback=r),t=r1(e,n,s),t!==null&&(hf(t,e,s,i),x4(t,e,s))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var r=Ql(),i=s1(e),s=By(r,i);s.tag=2,t!=null&&(s.callback=t),t=r1(e,s,i),t!==null&&(hf(t,e,i,r),x4(t,e,i))}};function goe(e,t,r,i,s,n,o){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(i,n,o):t.prototype&&t.prototype.isPureReactComponent?!BP(r,i)||!BP(s,n):!0}function Wve(e,t,r){var i=!1,s=w1,n=t.contextType;return typeof n=="object"&&n!==null?n=Dd(n):(s=Qc(t)?Yx:fl.current,i=t.contextTypes,n=(i=i!=null)?LC(e,s):w1),t=new t(r,n),e.memoizedState=t.state!==null&&t.state!==void 0?t.state:null,t.updater=Iz,e.stateNode=t,t._reactInternals=e,i&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=s,e.__reactInternalMemoizedMaskedChildContext=n),t}function yoe(e,t,r,i){e=t.state,typeof t.componentWillReceiveProps=="function"&&t.componentWillReceiveProps(r,i),typeof t.UNSAFE_componentWillReceiveProps=="function"&&t.UNSAFE_componentWillReceiveProps(r,i),t.state!==e&&Iz.enqueueReplaceState(t,t.state,null)}function nq(e,t,r,i){var s=e.stateNode;s.props=r,s.state=e.memoizedState,s.refs=qve,lK(e);var n=t.contextType;typeof n=="object"&&n!==null?s.context=Dd(n):(n=Qc(t)?Yx:fl.current,s.context=LC(e,n)),s.state=e.memoizedState,n=t.getDerivedStateFromProps,typeof n=="function"&&(sq(e,t,n,r),s.state=e.memoizedState),typeof t.getDerivedStateFromProps=="function"||typeof s.getSnapshotBeforeUpdate=="function"||typeof s.UNSAFE_componentWillMount!="function"&&typeof s.componentWillMount!="function"||(t=s.state,typeof s.componentWillMount=="function"&&s.componentWillMount(),typeof s.UNSAFE_componentWillMount=="function"&&s.UNSAFE_componentWillMount(),t!==s.state&&Iz.enqueueReplaceState(s,s.state,null),Xk(e,r,s,i),s.state=e.memoizedState),typeof s.componentDidMount=="function"&&(e.flags|=4194308)}function VR(e,t,r){if(e=r.ref,e!==null&&typeof e!="function"&&typeof e!="object"){if(r._owner){if(r=r._owner,r){if(r.tag!==1)throw Error(ke(309));var i=r.stateNode}if(!i)throw Error(ke(147,e));var s=i,n=""+e;return t!==null&&t.ref!==null&&typeof t.ref=="function"&&t.ref._stringRef===n?t.ref:(t=function(o){var a=s.refs;a===qve&&(a=s.refs={}),o===null?delete a[n]:a[n]=o},t._stringRef=n,t)}if(typeof e!="string")throw Error(ke(284));if(!r._owner)throw Error(ke(290,e))}return e}function uD(e,t){throw e=Object.prototype.toString.call(t),Error(ke(31,e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function voe(e){var t=e._init;return t(e._payload)}function Xve(e){function t(_,T){if(e){var x=_.deletions;x===null?(_.deletions=[T],_.flags|=16):x.push(T)}}function r(_,T){if(!e)return null;for(;T!==null;)t(_,T),T=T.sibling;return null}function i(_,T){for(_=new Map;T!==null;)T.key!==null?_.set(T.key,T):_.set(T.index,T),T=T.sibling;return _}function s(_,T){return _=n1(_,T),_.index=0,_.sibling=null,_}function n(_,T,x){return _.index=x,e?(x=_.alternate,x!==null?(x=x.index,x<T?(_.flags|=2,T):x):(_.flags|=2,T)):(_.flags|=1048576,T)}function o(_){return e&&_.alternate===null&&(_.flags|=2),_}function a(_,T,x,E){return T===null||T.tag!==6?(T=w9(x,_.mode,E),T.return=_,T):(T=s(T,x),T.return=_,T)}function l(_,T,x,E){var C=x.type;return C===pE?h(_,T,x.props.children,E,x.key):T!==null&&(T.elementType===C||typeof C=="object"&&C!==null&&C.$$typeof===a_&&voe(C)===T.type)?(E=s(T,x.props),E.ref=VR(_,T,x),E.return=_,E):(E=R4(x.type,x.key,x.props,null,_.mode,E),E.ref=VR(_,T,x),E.return=_,E)}function c(_,T,x,E){return T===null||T.tag!==4||T.stateNode.containerInfo!==x.containerInfo||T.stateNode.implementation!==x.implementation?(T=x9(x,_.mode,E),T.return=_,T):(T=s(T,x.children||[]),T.return=_,T)}function h(_,T,x,E,C){return T===null||T.tag!==7?(T=$x(x,_.mode,E,C),T.return=_,T):(T=s(T,x),T.return=_,T)}function p(_,T,x){if(typeof T=="string"&&T!==""||typeof T=="number")return T=w9(""+T,_.mode,x),T.return=_,T;if(typeof T=="object"&&T!==null){switch(T.$$typeof){case KL:return x=R4(T.type,T.key,T.props,null,_.mode,x),x.ref=VR(_,null,T),x.return=_,x;case dE:return T=x9(T,_.mode,x),T.return=_,T;case a_:var E=T._init;return p(_,E(T._payload),x)}if(aM(T)||DR(T))return T=$x(T,_.mode,x,null),T.return=_,T;uD(_,T)}return null}function f(_,T,x,E){var C=T!==null?T.key:null;if(typeof x=="string"&&x!==""||typeof x=="number")return C!==null?null:a(_,T,""+x,E);if(typeof x=="object"&&x!==null){switch(x.$$typeof){case KL:return x.key===C?l(_,T,x,E):null;case dE:return x.key===C?c(_,T,x,E):null;case a_:return C=x._init,f(_,T,C(x._payload),E)}if(aM(x)||DR(x))return C!==null?null:h(_,T,x,E,null);uD(_,x)}return null}function m(_,T,x,E,C){if(typeof E=="string"&&E!==""||typeof E=="number")return _=_.get(x)||null,a(T,_,""+E,C);if(typeof E=="object"&&E!==null){switch(E.$$typeof){case KL:return _=_.get(E.key===null?x:E.key)||null,l(T,_,E,C);case dE:return _=_.get(E.key===null?x:E.key)||null,c(T,_,E,C);case a_:var A=E._init;return m(_,T,x,A(E._payload),C)}if(aM(E)||DR(E))return _=_.get(x)||null,h(T,_,E,C,null);uD(T,E)}return null}function g(_,T,x,E){for(var C=null,A=null,P=T,I=T=0,L=null;P!==null&&I<x.length;I++){P.index>I?(L=P,P=null):L=P.sibling;var k=f(_,P,x[I],E);if(k===null){P===null&&(P=L);break}e&&P&&k.alternate===null&&t(_,P),T=n(k,T,I),A===null?C=k:A.sibling=k,A=k,P=L}if(I===x.length)return r(_,P),Ps&&qb(_,I),C;if(P===null){for(;I<x.length;I++)P=p(_,x[I],E),P!==null&&(T=n(P,T,I),A===null?C=P:A.sibling=P,A=P);return Ps&&qb(_,I),C}for(P=i(_,P);I<x.length;I++)L=m(P,_,I,x[I],E),L!==null&&(e&&L.alternate!==null&&P.delete(L.key===null?I:L.key),T=n(L,T,I),A===null?C=L:A.sibling=L,A=L);return e&&P.forEach(function(G){return t(_,G)}),Ps&&qb(_,I),C}function v(_,T,x,E){var C=DR(x);if(typeof C!="function")throw Error(ke(150));if(x=C.call(x),x==null)throw Error(ke(151));for(var A=C=null,P=T,I=T=0,L=null,k=x.next();P!==null&&!k.done;I++,k=x.next()){P.index>I?(L=P,P=null):L=P.sibling;var G=f(_,P,k.value,E);if(G===null){P===null&&(P=L);break}e&&P&&G.alternate===null&&t(_,P),T=n(G,T,I),A===null?C=G:A.sibling=G,A=G,P=L}if(k.done)return r(_,P),Ps&&qb(_,I),C;if(P===null){for(;!k.done;I++,k=x.next())k=p(_,k.value,E),k!==null&&(T=n(k,T,I),A===null?C=k:A.sibling=k,A=k);return Ps&&qb(_,I),C}for(P=i(_,P);!k.done;I++,k=x.next())k=m(P,_,I,k.value,E),k!==null&&(e&&k.alternate!==null&&P.delete(k.key===null?I:k.key),T=n(k,T,I),A===null?C=k:A.sibling=k,A=k);return e&&P.forEach(function(z){return t(_,z)}),Ps&&qb(_,I),C}function w(_,T,x,E){if(typeof x=="object"&&x!==null&&x.type===pE&&x.key===null&&(x=x.props.children),typeof x=="object"&&x!==null){switch(x.$$typeof){case KL:e:{for(var C=x.key,A=T;A!==null;){if(A.key===C){if(C=x.type,C===pE){if(A.tag===7){r(_,A.sibling),T=s(A,x.props.children),T.return=_,_=T;break e}}else if(A.elementType===C||typeof C=="object"&&C!==null&&C.$$typeof===a_&&voe(C)===A.type){r(_,A.sibling),T=s(A,x.props),T.ref=VR(_,A,x),T.return=_,_=T;break e}r(_,A);break}else t(_,A);A=A.sibling}x.type===pE?(T=$x(x.props.children,_.mode,E,x.key),T.return=_,_=T):(E=R4(x.type,x.key,x.props,null,_.mode,E),E.ref=VR(_,T,x),E.return=_,_=E)}return o(_);case dE:e:{for(A=x.key;T!==null;){if(T.key===A)if(T.tag===4&&T.stateNode.containerInfo===x.containerInfo&&T.stateNode.implementation===x.implementation){r(_,T.sibling),T=s(T,x.children||[]),T.return=_,_=T;break e}else{r(_,T);break}else t(_,T);T=T.sibling}T=x9(x,_.mode,E),T.return=_,_=T}return o(_);case a_:return A=x._init,w(_,T,A(x._payload),E)}if(aM(x))return g(_,T,x,E);if(DR(x))return v(_,T,x,E);uD(_,x)}return typeof x=="string"&&x!==""||typeof x=="number"?(x=""+x,T!==null&&T.tag===6?(r(_,T.sibling),T=s(T,x),T.return=_,_=T):(r(_,T),T=w9(x,_.mode,E),T.return=_,_=T),o(_)):r(_,T)}return w}var NC=Xve(!0),Zve=Xve(!1),D$={},Vm=W1(D$),qP=W1(D$),WP=W1(D$);function px(e){if(e===D$)throw Error(ke(174));return e}function cK(e,t){switch(cs(WP,t),cs(qP,e),cs(Vm,D$),e=t.nodeType,e){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:FH(null,"");break;default:e=e===8?t.parentNode:t,t=e.namespaceURI||null,e=e.tagName,t=FH(t,e)}Es(Vm),cs(Vm,t)}function FC(){Es(Vm),Es(qP),Es(WP)}function Yve(e){px(WP.current);var t=px(Vm.current),r=FH(t,e.type);t!==r&&(cs(qP,e),cs(Vm,r))}function uK(e){qP.current===e&&(Es(Vm),Es(qP))}var js=W1(0);function Zk(e){for(var t=e;t!==null;){if(t.tag===13){var r=t.memoizedState;if(r!==null&&(r=r.dehydrated,r===null||r.data==="$?"||r.data==="$!"))return t}else if(t.tag===19&&t.memoizedProps.revealOrder!==void 0){if((t.flags&128)!==0)return t}else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var m9=[];function hK(){for(var e=0;e<m9.length;e++)m9[e]._workInProgressVersionPrimary=null;m9.length=0}var T4=T0.ReactCurrentDispatcher,g9=T0.ReactCurrentBatchConfig,Jx=0,Ys=null,So=null,Jo=null,Yk=!1,F3=!1,XP=0,KFe=0;function ka(){throw Error(ke(321))}function dK(e,t){if(t===null)return!1;for(var r=0;r<t.length&&r<e.length;r++)if(!yf(e[r],t[r]))return!1;return!0}function pK(e,t,r,i,s,n){if(Jx=n,Ys=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,T4.current=e===null||e.memoizedState===null?i4e:s4e,e=r(i,s),F3){n=0;do{if(F3=!1,XP=0,25<=n)throw Error(ke(301));n+=1,Jo=So=null,t.updateQueue=null,T4.current=n4e,e=r(i,s)}while(F3)}if(T4.current=Qk,t=So!==null&&So.next!==null,Jx=0,Jo=So=Ys=null,Yk=!1,t)throw Error(ke(300));return e}function fK(){var e=XP!==0;return XP=0,e}function bm(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Jo===null?Ys.memoizedState=Jo=e:Jo=Jo.next=e,Jo}function Nd(){if(So===null){var e=Ys.alternate;e=e!==null?e.memoizedState:null}else e=So.next;var t=Jo===null?Ys.memoizedState:Jo.next;if(t!==null)Jo=t,So=e;else{if(e===null)throw Error(ke(310));So=e,e={memoizedState:So.memoizedState,baseState:So.baseState,baseQueue:So.baseQueue,queue:So.queue,next:null},Jo===null?Ys.memoizedState=Jo=e:Jo=Jo.next=e}return Jo}function ZP(e,t){return typeof t=="function"?t(e):t}function y9(e){var t=Nd(),r=t.queue;if(r===null)throw Error(ke(311));r.lastRenderedReducer=e;var i=So,s=i.baseQueue,n=r.pending;if(n!==null){if(s!==null){var o=s.next;s.next=n.next,n.next=o}i.baseQueue=s=n,r.pending=null}if(s!==null){n=s.next,i=i.baseState;var a=o=null,l=null,c=n;do{var h=c.lane;if((Jx&h)===h)l!==null&&(l=l.next={lane:0,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null}),i=c.hasEagerState?c.eagerState:e(i,c.action);else{var p={lane:h,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null};l===null?(a=l=p,o=i):l=l.next=p,Ys.lanes|=h,Kx|=h}c=c.next}while(c!==null&&c!==n);l===null?o=i:l.next=a,yf(i,t.memoizedState)||(jc=!0),t.memoizedState=i,t.baseState=o,t.baseQueue=l,r.lastRenderedState=i}if(e=r.interleaved,e!==null){s=e;do n=s.lane,Ys.lanes|=n,Kx|=n,s=s.next;while(s!==e)}else s===null&&(r.lanes=0);return[t.memoizedState,r.dispatch]}function v9(e){var t=Nd(),r=t.queue;if(r===null)throw Error(ke(311));r.lastRenderedReducer=e;var i=r.dispatch,s=r.pending,n=t.memoizedState;if(s!==null){r.pending=null;var o=s=s.next;do n=e(n,o.action),o=o.next;while(o!==s);yf(n,t.memoizedState)||(jc=!0),t.memoizedState=n,t.baseQueue===null&&(t.baseState=n),r.lastRenderedState=n}return[n,i]}function Qve(){}function Jve(e,t){var r=Ys,i=Nd(),s=t(),n=!yf(i.memoizedState,s);if(n&&(i.memoizedState=s,jc=!0),i=i.queue,mK(t_e.bind(null,r,i,e),[e]),i.getSnapshot!==t||n||Jo!==null&&Jo.memoizedState.tag&1){if(r.flags|=2048,YP(9,e_e.bind(null,r,i,s,t),void 0,null),oa===null)throw Error(ke(349));(Jx&30)!==0||Kve(r,t,s)}return s}function Kve(e,t,r){e.flags|=16384,e={getSnapshot:t,value:r},t=Ys.updateQueue,t===null?(t={lastEffect:null,stores:null},Ys.updateQueue=t,t.stores=[e]):(r=t.stores,r===null?t.stores=[e]:r.push(e))}function e_e(e,t,r,i){t.value=r,t.getSnapshot=i,r_e(t)&&i_e(e)}function t_e(e,t,r){return r(function(){r_e(t)&&i_e(e)})}function r_e(e){var t=e.getSnapshot;e=e.value;try{var r=t();return!yf(e,r)}catch{return!0}}function i_e(e){var t=o0(e,1);t!==null&&hf(t,e,1,-1)}function _oe(e){var t=bm();return typeof e=="function"&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:ZP,lastRenderedState:e},t.queue=e,e=e.dispatch=r4e.bind(null,Ys,e),[t.memoizedState,e]}function YP(e,t,r,i){return e={tag:e,create:t,destroy:r,deps:i,next:null},t=Ys.updateQueue,t===null?(t={lastEffect:null,stores:null},Ys.updateQueue=t,t.lastEffect=e.next=e):(r=t.lastEffect,r===null?t.lastEffect=e.next=e:(i=r.next,r.next=e,e.next=i,t.lastEffect=e)),e}function s_e(){return Nd().memoizedState}function S4(e,t,r,i){var s=bm();Ys.flags|=e,s.memoizedState=YP(1|t,r,void 0,i===void 0?null:i)}function $z(e,t,r,i){var s=Nd();i=i===void 0?null:i;var n=void 0;if(So!==null){var o=So.memoizedState;if(n=o.destroy,i!==null&&dK(i,o.deps)){s.memoizedState=YP(t,r,n,i);return}}Ys.flags|=e,s.memoizedState=YP(1|t,r,n,i)}function boe(e,t){return S4(8390656,8,e,t)}function mK(e,t){return $z(2048,8,e,t)}function n_e(e,t){return $z(4,2,e,t)}function o_e(e,t){return $z(4,4,e,t)}function a_e(e,t){if(typeof t=="function")return e=e(),t(e),function(){t(null)};if(t!=null)return e=e(),t.current=e,function(){t.current=null}}function l_e(e,t,r){return r=r!=null?r.concat([e]):null,$z(4,4,a_e.bind(null,t,e),r)}function gK(){}function c_e(e,t){var r=Nd();t=t===void 0?null:t;var i=r.memoizedState;return i!==null&&t!==null&&dK(t,i[1])?i[0]:(r.memoizedState=[e,t],e)}function u_e(e,t){var r=Nd();t=t===void 0?null:t;var i=r.memoizedState;return i!==null&&t!==null&&dK(t,i[1])?i[0]:(e=e(),r.memoizedState=[e,t],e)}function h_e(e,t,r){return(Jx&21)===0?(e.baseState&&(e.baseState=!1,jc=!0),e.memoizedState=r):(yf(r,t)||(r=fve(),Ys.lanes|=r,Kx|=r,e.baseState=!0),t)}function e4e(e,t){var r=Ui;Ui=r!==0&&4>r?r:4,e(!0);var i=g9.transition;g9.transition={};try{e(!1),t()}finally{Ui=r,g9.transition=i}}function d_e(){return Nd().memoizedState}function t4e(e,t,r){var i=s1(e);if(r={lane:i,action:r,hasEagerState:!1,eagerState:null,next:null},p_e(e))f_e(t,r);else if(r=jve(e,t,r,i),r!==null){var s=Ql();hf(r,e,i,s),m_e(r,t,i)}}function r4e(e,t,r){var i=s1(e),s={lane:i,action:r,hasEagerState:!1,eagerState:null,next:null};if(p_e(e))f_e(t,s);else{var n=e.alternate;if(e.lanes===0&&(n===null||n.lanes===0)&&(n=t.lastRenderedReducer,n!==null))try{var o=t.lastRenderedState,a=n(o,r);if(s.hasEagerState=!0,s.eagerState=a,yf(a,o)){var l=t.interleaved;l===null?(s.next=s,aK(t)):(s.next=l.next,l.next=s),t.interleaved=s;return}}catch{}finally{}r=jve(e,t,s,i),r!==null&&(s=Ql(),hf(r,e,i,s),m_e(r,t,i))}}function p_e(e){var t=e.alternate;return e===Ys||t!==null&&t===Ys}function f_e(e,t){F3=Yk=!0;var r=e.pending;r===null?t.next=t:(t.next=r.next,r.next=t),e.pending=t}function m_e(e,t,r){if((r&4194240)!==0){var i=t.lanes;i&=e.pendingLanes,r|=i,t.lanes=r,WJ(e,r)}}var Qk={readContext:Dd,useCallback:ka,useContext:ka,useEffect:ka,useImperativeHandle:ka,useInsertionEffect:ka,useLayoutEffect:ka,useMemo:ka,useReducer:ka,useRef:ka,useState:ka,useDebugValue:ka,useDeferredValue:ka,useTransition:ka,useMutableSource:ka,useSyncExternalStore:ka,useId:ka,unstable_isNewReconciler:!1},i4e={readContext:Dd,useCallback:function(e,t){return bm().memoizedState=[e,t===void 0?null:t],e},useContext:Dd,useEffect:boe,useImperativeHandle:function(e,t,r){return r=r!=null?r.concat([e]):null,S4(4194308,4,a_e.bind(null,t,e),r)},useLayoutEffect:function(e,t){return S4(4194308,4,e,t)},useInsertionEffect:function(e,t){return S4(4,2,e,t)},useMemo:function(e,t){var r=bm();return t=t===void 0?null:t,e=e(),r.memoizedState=[e,t],e},useReducer:function(e,t,r){var i=bm();return t=r!==void 0?r(t):t,i.memoizedState=i.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},i.queue=e,e=e.dispatch=t4e.bind(null,Ys,e),[i.memoizedState,e]},useRef:function(e){var t=bm();return e={current:e},t.memoizedState=e},useState:_oe,useDebugValue:gK,useDeferredValue:function(e){return bm().memoizedState=e},useTransition:function(){var e=_oe(!1),t=e[0];return e=e4e.bind(null,e[1]),bm().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,r){var i=Ys,s=bm();if(Ps){if(r===void 0)throw Error(ke(407));r=r()}else{if(r=t(),oa===null)throw Error(ke(349));(Jx&30)!==0||Kve(i,t,r)}s.memoizedState=r;var n={value:r,getSnapshot:t};return s.queue=n,boe(t_e.bind(null,i,n,e),[e]),i.flags|=2048,YP(9,e_e.bind(null,i,n,r,t),void 0,null),r},useId:function(){var e=bm(),t=oa.identifierPrefix;if(Ps){var r=Ly,i=$y;r=(i&~(1<<32-uf(i)-1)).toString(32)+r,t=":"+t+"R"+r,r=XP++,0<r&&(t+="H"+r.toString(32)),t+=":"}else r=KFe++,t=":"+t+"r"+r.toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},s4e={readContext:Dd,useCallback:c_e,useContext:Dd,useEffect:mK,useImperativeHandle:l_e,useInsertionEffect:n_e,useLayoutEffect:o_e,useMemo:u_e,useReducer:y9,useRef:s_e,useState:function(){return y9(ZP)},useDebugValue:gK,useDeferredValue:function(e){var t=Nd();return h_e(t,So.memoizedState,e)},useTransition:function(){var e=y9(ZP)[0],t=Nd().memoizedState;return[e,t]},useMutableSource:Qve,useSyncExternalStore:Jve,useId:d_e,unstable_isNewReconciler:!1},n4e={readContext:Dd,useCallback:c_e,useContext:Dd,useEffect:mK,useImperativeHandle:l_e,useInsertionEffect:n_e,useLayoutEffect:o_e,useMemo:u_e,useReducer:v9,useRef:s_e,useState:function(){return v9(ZP)},useDebugValue:gK,useDeferredValue:function(e){var t=Nd();return So===null?t.memoizedState=e:h_e(t,So.memoizedState,e)},useTransition:function(){var e=v9(ZP)[0],t=Nd().memoizedState;return[e,t]},useMutableSource:Qve,useSyncExternalStore:Jve,useId:d_e,unstable_isNewReconciler:!1};function kC(e,t){try{var r="",i=t;do r+=$Ne(i),i=i.return;while(i);var s=r}catch(n){s=`
Error generating stack: `+n.message+`
`+n.stack}return{value:e,source:t,stack:s,digest:null}}function _9(e,t,r){return{value:e,source:null,stack:r!=null?r:null,digest:t!=null?t:null}}function oq(e,t){try{console.error(t.value)}catch(r){setTimeout(function(){throw r})}}var o4e=typeof WeakMap=="function"?WeakMap:Map;function g_e(e,t,r){r=By(-1,r),r.tag=3,r.payload={element:null};var i=t.value;return r.callback=function(){Kk||(Kk=!0,gq=i),oq(e,t)},r}function y_e(e,t,r){r=By(-1,r),r.tag=3;var i=e.type.getDerivedStateFromError;if(typeof i=="function"){var s=t.value;r.payload=function(){return i(s)},r.callback=function(){oq(e,t)}}var n=e.stateNode;return n!==null&&typeof n.componentDidCatch=="function"&&(r.callback=function(){oq(e,t),typeof i!="function"&&(i1===null?i1=new Set([this]):i1.add(this));var o=t.stack;this.componentDidCatch(t.value,{componentStack:o!==null?o:""})}),r}function woe(e,t,r){var i=e.pingCache;if(i===null){i=e.pingCache=new o4e;var s=new Set;i.set(t,s)}else s=i.get(t),s===void 0&&(s=new Set,i.set(t,s));s.has(r)||(s.add(r),e=b4e.bind(null,e,t,r),t.then(e,e))}function xoe(e){do{var t;if((t=e.tag===13)&&(t=e.memoizedState,t=t!==null?t.dehydrated!==null:!0),t)return e;e=e.return}while(e!==null);return null}function Toe(e,t,r,i,s){return(e.mode&1)===0?(e===t?e.flags|=65536:(e.flags|=128,r.flags|=131072,r.flags&=-52805,r.tag===1&&(r.alternate===null?r.tag=17:(t=By(-1,1),t.tag=2,r1(r,t,1))),r.lanes|=1),e):(e.flags|=65536,e.lanes=s,e)}var a4e=T0.ReactCurrentOwner,jc=!1;function zl(e,t,r,i){t.child=e===null?Zve(t,null,r,i):NC(t,e.child,r,i)}function Soe(e,t,r,i,s){r=r.render;var n=t.ref;return eC(t,s),i=pK(e,t,r,i,n,s),r=fK(),e!==null&&!jc?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~s,a0(e,t,s)):(Ps&&r&&tK(t),t.flags|=1,zl(e,t,i,s),t.child)}function Eoe(e,t,r,i,s){if(e===null){var n=r.type;return typeof n=="function"&&!SK(n)&&n.defaultProps===void 0&&r.compare===null&&r.defaultProps===void 0?(t.tag=15,t.type=n,v_e(e,t,n,i,s)):(e=R4(r.type,null,i,t,t.mode,s),e.ref=t.ref,e.return=t,t.child=e)}if(n=e.child,(e.lanes&s)===0){var o=n.memoizedProps;if(r=r.compare,r=r!==null?r:BP,r(o,i)&&e.ref===t.ref)return a0(e,t,s)}return t.flags|=1,e=n1(n,i),e.ref=t.ref,e.return=t,t.child=e}function v_e(e,t,r,i,s){if(e!==null){var n=e.memoizedProps;if(BP(n,i)&&e.ref===t.ref)if(jc=!1,t.pendingProps=i=n,(e.lanes&s)!==0)(e.flags&131072)!==0&&(jc=!0);else return t.lanes=e.lanes,a0(e,t,s)}return aq(e,t,r,i,s)}function __e(e,t,r){var i=t.pendingProps,s=i.children,n=e!==null?e.memoizedState:null;if(i.mode==="hidden")if((t.mode&1)===0)t.memoizedState={baseLanes:0,cachePool:null,transitions:null},cs(TE,Vu),Vu|=r;else{if((r&1073741824)===0)return e=n!==null?n.baseLanes|r:r,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,cs(TE,Vu),Vu|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},i=n!==null?n.baseLanes:r,cs(TE,Vu),Vu|=i}else n!==null?(i=n.baseLanes|r,t.memoizedState=null):i=r,cs(TE,Vu),Vu|=i;return zl(e,t,s,r),t.child}function b_e(e,t){var r=t.ref;(e===null&&r!==null||e!==null&&e.ref!==r)&&(t.flags|=512,t.flags|=2097152)}function aq(e,t,r,i,s){var n=Qc(r)?Yx:fl.current;return n=LC(t,n),eC(t,s),r=pK(e,t,r,i,n,s),i=fK(),e!==null&&!jc?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~s,a0(e,t,s)):(Ps&&i&&tK(t),t.flags|=1,zl(e,t,r,s),t.child)}function Coe(e,t,r,i,s){if(Qc(r)){var n=!0;Gk(t)}else n=!1;if(eC(t,s),t.stateNode===null)E4(e,t),Wve(t,r,i),nq(t,r,i,s),i=!0;else if(e===null){var o=t.stateNode,a=t.memoizedProps;o.props=a;var l=o.context,c=r.contextType;typeof c=="object"&&c!==null?c=Dd(c):(c=Qc(r)?Yx:fl.current,c=LC(t,c));var h=r.getDerivedStateFromProps,p=typeof h=="function"||typeof o.getSnapshotBeforeUpdate=="function";p||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==i||l!==c)&&yoe(t,o,i,c),l_=!1;var f=t.memoizedState;o.state=f,Xk(t,i,o,s),l=t.memoizedState,a!==i||f!==l||Yc.current||l_?(typeof h=="function"&&(sq(t,r,h,i),l=t.memoizedState),(a=l_||goe(t,r,a,i,f,l,c))?(p||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount()),typeof o.componentDidMount=="function"&&(t.flags|=4194308)):(typeof o.componentDidMount=="function"&&(t.flags|=4194308),t.memoizedProps=i,t.memoizedState=l),o.props=i,o.state=l,o.context=c,i=a):(typeof o.componentDidMount=="function"&&(t.flags|=4194308),i=!1)}else{o=t.stateNode,Hve(e,t),a=t.memoizedProps,c=t.type===t.elementType?a:Dp(t.type,a),o.props=c,p=t.pendingProps,f=o.context,l=r.contextType,typeof l=="object"&&l!==null?l=Dd(l):(l=Qc(r)?Yx:fl.current,l=LC(t,l));var m=r.getDerivedStateFromProps;(h=typeof m=="function"||typeof o.getSnapshotBeforeUpdate=="function")||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==p||f!==l)&&yoe(t,o,i,l),l_=!1,f=t.memoizedState,o.state=f,Xk(t,i,o,s);var g=t.memoizedState;a!==p||f!==g||Yc.current||l_?(typeof m=="function"&&(sq(t,r,m,i),g=t.memoizedState),(c=l_||goe(t,r,c,i,f,g,l)||!1)?(h||typeof o.UNSAFE_componentWillUpdate!="function"&&typeof o.componentWillUpdate!="function"||(typeof o.componentWillUpdate=="function"&&o.componentWillUpdate(i,g,l),typeof o.UNSAFE_componentWillUpdate=="function"&&o.UNSAFE_componentWillUpdate(i,g,l)),typeof o.componentDidUpdate=="function"&&(t.flags|=4),typeof o.getSnapshotBeforeUpdate=="function"&&(t.flags|=1024)):(typeof o.componentDidUpdate!="function"||a===e.memoizedProps&&f===e.memoizedState||(t.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===e.memoizedProps&&f===e.memoizedState||(t.flags|=1024),t.memoizedProps=i,t.memoizedState=g),o.props=i,o.state=g,o.context=l,i=c):(typeof o.componentDidUpdate!="function"||a===e.memoizedProps&&f===e.memoizedState||(t.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===e.memoizedProps&&f===e.memoizedState||(t.flags|=1024),i=!1)}return lq(e,t,r,i,n,s)}function lq(e,t,r,i,s,n){b_e(e,t);var o=(t.flags&128)!==0;if(!i&&!o)return s&&hoe(t,r,!1),a0(e,t,n);i=t.stateNode,a4e.current=t;var a=o&&typeof r.getDerivedStateFromError!="function"?null:i.render();return t.flags|=1,e!==null&&o?(t.child=NC(t,e.child,null,n),t.child=NC(t,null,a,n)):zl(e,t,a,n),t.memoizedState=i.state,s&&hoe(t,r,!0),t.child}function w_e(e){var t=e.stateNode;t.pendingContext?uoe(e,t.pendingContext,t.pendingContext!==t.context):t.context&&uoe(e,t.context,!1),cK(e,t.containerInfo)}function Aoe(e,t,r,i,s){return DC(),iK(s),t.flags|=256,zl(e,t,r,i),t.child}var cq={dehydrated:null,treeContext:null,retryLane:0};function uq(e){return{baseLanes:e,cachePool:null,transitions:null}}function x_e(e,t,r){var i=t.pendingProps,s=js.current,n=!1,o=(t.flags&128)!==0,a;if((a=o)||(a=e!==null&&e.memoizedState===null?!1:(s&2)!==0),a?(n=!0,t.flags&=-129):(e===null||e.memoizedState!==null)&&(s|=1),cs(js,s&1),e===null)return rq(t),e=t.memoizedState,e!==null&&(e=e.dehydrated,e!==null)?((t.mode&1)===0?t.lanes=1:e.data==="$!"?t.lanes=8:t.lanes=1073741824,null):(o=i.children,e=i.fallback,n?(i=t.mode,n=t.child,o={mode:"hidden",children:o},(i&1)===0&&n!==null?(n.childLanes=0,n.pendingProps=o):n=Nz(o,i,0,null),e=$x(e,i,r,null),n.return=t,e.return=t,n.sibling=e,t.child=n,t.child.memoizedState=uq(r),t.memoizedState=cq,e):yK(t,o));if(s=e.memoizedState,s!==null&&(a=s.dehydrated,a!==null))return l4e(e,t,o,i,a,s,r);if(n){n=i.fallback,o=t.mode,s=e.child,a=s.sibling;var l={mode:"hidden",children:i.children};return(o&1)===0&&t.child!==s?(i=t.child,i.childLanes=0,i.pendingProps=l,t.deletions=null):(i=n1(s,l),i.subtreeFlags=s.subtreeFlags&14680064),a!==null?n=n1(a,n):(n=$x(n,o,r,null),n.flags|=2),n.return=t,i.return=t,i.sibling=n,t.child=i,i=n,n=t.child,o=e.child.memoizedState,o=o===null?uq(r):{baseLanes:o.baseLanes|r,cachePool:null,transitions:o.transitions},n.memoizedState=o,n.childLanes=e.childLanes&~r,t.memoizedState=cq,i}return n=e.child,e=n.sibling,i=n1(n,{mode:"visible",children:i.children}),(t.mode&1)===0&&(i.lanes=r),i.return=t,i.sibling=null,e!==null&&(r=t.deletions,r===null?(t.deletions=[e],t.flags|=16):r.push(e)),t.child=i,t.memoizedState=null,i}function yK(e,t){return t=Nz({mode:"visible",children:t},e.mode,0,null),t.return=e,e.child=t}function hD(e,t,r,i){return i!==null&&iK(i),NC(t,e.child,null,r),e=yK(t,t.pendingProps.children),e.flags|=2,t.memoizedState=null,e}function l4e(e,t,r,i,s,n,o){if(r)return t.flags&256?(t.flags&=-257,i=_9(Error(ke(422))),hD(e,t,o,i)):t.memoizedState!==null?(t.child=e.child,t.flags|=128,null):(n=i.fallback,s=t.mode,i=Nz({mode:"visible",children:i.children},s,0,null),n=$x(n,s,o,null),n.flags|=2,i.return=t,n.return=t,i.sibling=n,t.child=i,(t.mode&1)!==0&&NC(t,e.child,null,o),t.child.memoizedState=uq(o),t.memoizedState=cq,n);if((t.mode&1)===0)return hD(e,t,o,null);if(s.data==="$!"){if(i=s.nextSibling&&s.nextSibling.dataset,i)var a=i.dgst;return i=a,n=Error(ke(419)),i=_9(n,i,void 0),hD(e,t,o,i)}if(a=(o&e.childLanes)!==0,jc||a){if(i=oa,i!==null){switch(o&-o){case 4:s=2;break;case 16:s=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:s=32;break;case 536870912:s=268435456;break;default:s=0}s=(s&(i.suspendedLanes|o))!==0?0:s,s!==0&&s!==n.retryLane&&(n.retryLane=s,o0(e,s),hf(i,e,s,-1))}return TK(),i=_9(Error(ke(421))),hD(e,t,o,i)}return s.data==="$?"?(t.flags|=128,t.child=e.child,t=w4e.bind(null,e),s._reactRetry=t,null):(e=n.treeContext,rh=t1(s.nextSibling),oh=t,Ps=!0,jp=null,e!==null&&(fd[md++]=$y,fd[md++]=Ly,fd[md++]=Qx,$y=e.id,Ly=e.overflow,Qx=t),t=yK(t,i.children),t.flags|=4096,t)}function Roe(e,t,r){e.lanes|=t;var i=e.alternate;i!==null&&(i.lanes|=t),iq(e.return,t,r)}function b9(e,t,r,i,s){var n=e.memoizedState;n===null?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:i,tail:r,tailMode:s}:(n.isBackwards=t,n.rendering=null,n.renderingStartTime=0,n.last=i,n.tail=r,n.tailMode=s)}function T_e(e,t,r){var i=t.pendingProps,s=i.revealOrder,n=i.tail;if(zl(e,t,i.children,r),i=js.current,(i&2)!==0)i=i&1|2,t.flags|=128;else{if(e!==null&&(e.flags&128)!==0)e:for(e=t.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&Roe(e,r,t);else if(e.tag===19)Roe(e,r,t);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;e.sibling===null;){if(e.return===null||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}i&=1}if(cs(js,i),(t.mode&1)===0)t.memoizedState=null;else switch(s){case"forwards":for(r=t.child,s=null;r!==null;)e=r.alternate,e!==null&&Zk(e)===null&&(s=r),r=r.sibling;r=s,r===null?(s=t.child,t.child=null):(s=r.sibling,r.sibling=null),b9(t,!1,s,r,n);break;case"backwards":for(r=null,s=t.child,t.child=null;s!==null;){if(e=s.alternate,e!==null&&Zk(e)===null){t.child=s;break}e=s.sibling,s.sibling=r,r=s,s=e}b9(t,!0,r,null,n);break;case"together":b9(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function E4(e,t){(t.mode&1)===0&&e!==null&&(e.alternate=null,t.alternate=null,t.flags|=2)}function a0(e,t,r){if(e!==null&&(t.dependencies=e.dependencies),Kx|=t.lanes,(r&t.childLanes)===0)return null;if(e!==null&&t.child!==e.child)throw Error(ke(153));if(t.child!==null){for(e=t.child,r=n1(e,e.pendingProps),t.child=r,r.return=t;e.sibling!==null;)e=e.sibling,r=r.sibling=n1(e,e.pendingProps),r.return=t;r.sibling=null}return t.child}function c4e(e,t,r){switch(t.tag){case 3:w_e(t),DC();break;case 5:Yve(t);break;case 1:Qc(t.type)&&Gk(t);break;case 4:cK(t,t.stateNode.containerInfo);break;case 10:var i=t.type._context,s=t.memoizedProps.value;cs(qk,i._currentValue),i._currentValue=s;break;case 13:if(i=t.memoizedState,i!==null)return i.dehydrated!==null?(cs(js,js.current&1),t.flags|=128,null):(r&t.child.childLanes)!==0?x_e(e,t,r):(cs(js,js.current&1),e=a0(e,t,r),e!==null?e.sibling:null);cs(js,js.current&1);break;case 19:if(i=(r&t.childLanes)!==0,(e.flags&128)!==0){if(i)return T_e(e,t,r);t.flags|=128}if(s=t.memoizedState,s!==null&&(s.rendering=null,s.tail=null,s.lastEffect=null),cs(js,js.current),i)break;return null;case 22:case 23:return t.lanes=0,__e(e,t,r)}return a0(e,t,r)}var S_e,hq,E_e,C_e;S_e=function(e,t){for(var r=t.child;r!==null;){if(r.tag===5||r.tag===6)e.appendChild(r.stateNode);else if(r.tag!==4&&r.child!==null){r.child.return=r,r=r.child;continue}if(r===t)break;for(;r.sibling===null;){if(r.return===null||r.return===t)return;r=r.return}r.sibling.return=r.return,r=r.sibling}};hq=function(){};E_e=function(e,t,r,i){var s=e.memoizedProps;if(s!==i){e=t.stateNode,px(Vm.current);var n=null;switch(r){case"input":s=$H(e,s),i=$H(e,i),n=[];break;case"select":s=Ks({},s,{value:void 0}),i=Ks({},i,{value:void 0}),n=[];break;case"textarea":s=NH(e,s),i=NH(e,i),n=[];break;default:typeof s.onClick!="function"&&typeof i.onClick=="function"&&(e.onclick=zk)}kH(r,i);var o;r=null;for(c in s)if(!i.hasOwnProperty(c)&&s.hasOwnProperty(c)&&s[c]!=null)if(c==="style"){var a=s[c];for(o in a)a.hasOwnProperty(o)&&(r||(r={}),r[o]="")}else c!=="dangerouslySetInnerHTML"&&c!=="children"&&c!=="suppressContentEditableWarning"&&c!=="suppressHydrationWarning"&&c!=="autoFocus"&&(DP.hasOwnProperty(c)?n||(n=[]):(n=n||[]).push(c,null));for(c in i){var l=i[c];if(a=s!=null?s[c]:void 0,i.hasOwnProperty(c)&&l!==a&&(l!=null||a!=null))if(c==="style")if(a){for(o in a)!a.hasOwnProperty(o)||l&&l.hasOwnProperty(o)||(r||(r={}),r[o]="");for(o in l)l.hasOwnProperty(o)&&a[o]!==l[o]&&(r||(r={}),r[o]=l[o])}else r||(n||(n=[]),n.push(c,r)),r=l;else c==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,a=a?a.__html:void 0,l!=null&&a!==l&&(n=n||[]).push(c,l)):c==="children"?typeof l!="string"&&typeof l!="number"||(n=n||[]).push(c,""+l):c!=="suppressContentEditableWarning"&&c!=="suppressHydrationWarning"&&(DP.hasOwnProperty(c)?(l!=null&&c==="onScroll"&&ms("scroll",e),n||a===l||(n=[])):(n=n||[]).push(c,l))}r&&(n=n||[]).push("style",r);var c=n;(t.updateQueue=c)&&(t.flags|=4)}};C_e=function(e,t,r,i){r!==i&&(t.flags|=4)};function zR(e,t){if(!Ps)switch(e.tailMode){case"hidden":t=e.tail;for(var r=null;t!==null;)t.alternate!==null&&(r=t),t=t.sibling;r===null?e.tail=null:r.sibling=null;break;case"collapsed":r=e.tail;for(var i=null;r!==null;)r.alternate!==null&&(i=r),r=r.sibling;i===null?t||e.tail===null?e.tail=null:e.tail.sibling=null:i.sibling=null}}function Ua(e){var t=e.alternate!==null&&e.alternate.child===e.child,r=0,i=0;if(t)for(var s=e.child;s!==null;)r|=s.lanes|s.childLanes,i|=s.subtreeFlags&14680064,i|=s.flags&14680064,s.return=e,s=s.sibling;else for(s=e.child;s!==null;)r|=s.lanes|s.childLanes,i|=s.subtreeFlags,i|=s.flags,s.return=e,s=s.sibling;return e.subtreeFlags|=i,e.childLanes=r,t}function u4e(e,t,r){var i=t.pendingProps;switch(rK(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Ua(t),null;case 1:return Qc(t.type)&&Bk(),Ua(t),null;case 3:return i=t.stateNode,FC(),Es(Yc),Es(fl),hK(),i.pendingContext&&(i.context=i.pendingContext,i.pendingContext=null),(e===null||e.child===null)&&(cD(t)?t.flags|=4:e===null||e.memoizedState.isDehydrated&&(t.flags&256)===0||(t.flags|=1024,jp!==null&&(_q(jp),jp=null))),hq(e,t),Ua(t),null;case 5:uK(t);var s=px(WP.current);if(r=t.type,e!==null&&t.stateNode!=null)E_e(e,t,r,i,s),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!i){if(t.stateNode===null)throw Error(ke(166));return Ua(t),null}if(e=px(Vm.current),cD(t)){i=t.stateNode,r=t.type;var n=t.memoizedProps;switch(i[Mm]=t,i[HP]=n,e=(t.mode&1)!==0,r){case"dialog":ms("cancel",i),ms("close",i);break;case"iframe":case"object":case"embed":ms("load",i);break;case"video":case"audio":for(s=0;s<cM.length;s++)ms(cM[s],i);break;case"source":ms("error",i);break;case"img":case"image":case"link":ms("error",i),ms("load",i);break;case"details":ms("toggle",i);break;case"input":Fne(i,n),ms("invalid",i);break;case"select":i._wrapperState={wasMultiple:!!n.multiple},ms("invalid",i);break;case"textarea":Une(i,n),ms("invalid",i)}kH(r,n),s=null;for(var o in n)if(n.hasOwnProperty(o)){var a=n[o];o==="children"?typeof a=="string"?i.textContent!==a&&(n.suppressHydrationWarning!==!0&&lD(i.textContent,a,e),s=["children",a]):typeof a=="number"&&i.textContent!==""+a&&(n.suppressHydrationWarning!==!0&&lD(i.textContent,a,e),s=["children",""+a]):DP.hasOwnProperty(o)&&a!=null&&o==="onScroll"&&ms("scroll",i)}switch(r){case"input":eD(i),kne(i,n,!0);break;case"textarea":eD(i),Vne(i);break;case"select":case"option":break;default:typeof n.onClick=="function"&&(i.onclick=zk)}i=s,t.updateQueue=i,i!==null&&(t.flags|=4)}else{o=s.nodeType===9?s:s.ownerDocument,e==="http://www.w3.org/1999/xhtml"&&(e=K0e(r)),e==="http://www.w3.org/1999/xhtml"?r==="script"?(e=o.createElement("div"),e.innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):typeof i.is=="string"?e=o.createElement(r,{is:i.is}):(e=o.createElement(r),r==="select"&&(o=e,i.multiple?o.multiple=!0:i.size&&(o.size=i.size))):e=o.createElementNS(e,r),e[Mm]=t,e[HP]=i,S_e(e,t,!1,!1),t.stateNode=e;e:{switch(o=UH(r,i),r){case"dialog":ms("cancel",e),ms("close",e),s=i;break;case"iframe":case"object":case"embed":ms("load",e),s=i;break;case"video":case"audio":for(s=0;s<cM.length;s++)ms(cM[s],e);s=i;break;case"source":ms("error",e),s=i;break;case"img":case"image":case"link":ms("error",e),ms("load",e),s=i;break;case"details":ms("toggle",e),s=i;break;case"input":Fne(e,i),s=$H(e,i),ms("invalid",e);break;case"option":s=i;break;case"select":e._wrapperState={wasMultiple:!!i.multiple},s=Ks({},i,{value:void 0}),ms("invalid",e);break;case"textarea":Une(e,i),s=NH(e,i),ms("invalid",e);break;default:s=i}kH(r,s),a=s;for(n in a)if(a.hasOwnProperty(n)){var l=a[n];n==="style"?rve(e,l):n==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,l!=null&&eve(e,l)):n==="children"?typeof l=="string"?(r!=="textarea"||l!=="")&&NP(e,l):typeof l=="number"&&NP(e,""+l):n!=="suppressContentEditableWarning"&&n!=="suppressHydrationWarning"&&n!=="autoFocus"&&(DP.hasOwnProperty(n)?l!=null&&n==="onScroll"&&ms("scroll",e):l!=null&&zJ(e,n,l,o))}switch(r){case"input":eD(e),kne(e,i,!1);break;case"textarea":eD(e),Vne(e);break;case"option":i.value!=null&&e.setAttribute("value",""+b1(i.value));break;case"select":e.multiple=!!i.multiple,n=i.value,n!=null?YE(e,!!i.multiple,n,!1):i.defaultValue!=null&&YE(e,!!i.multiple,i.defaultValue,!0);break;default:typeof s.onClick=="function"&&(e.onclick=zk)}switch(r){case"button":case"input":case"select":case"textarea":i=!!i.autoFocus;break e;case"img":i=!0;break e;default:i=!1}}i&&(t.flags|=4)}t.ref!==null&&(t.flags|=512,t.flags|=2097152)}return Ua(t),null;case 6:if(e&&t.stateNode!=null)C_e(e,t,e.memoizedProps,i);else{if(typeof i!="string"&&t.stateNode===null)throw Error(ke(166));if(r=px(WP.current),px(Vm.current),cD(t)){if(i=t.stateNode,r=t.memoizedProps,i[Mm]=t,(n=i.nodeValue!==r)&&(e=oh,e!==null))switch(e.tag){case 3:lD(i.nodeValue,r,(e.mode&1)!==0);break;case 5:e.memoizedProps.suppressHydrationWarning!==!0&&lD(i.nodeValue,r,(e.mode&1)!==0)}n&&(t.flags|=4)}else i=(r.nodeType===9?r:r.ownerDocument).createTextNode(i),i[Mm]=t,t.stateNode=i}return Ua(t),null;case 13:if(Es(js),i=t.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(Ps&&rh!==null&&(t.mode&1)!==0&&(t.flags&128)===0)Gve(),DC(),t.flags|=98560,n=!1;else if(n=cD(t),i!==null&&i.dehydrated!==null){if(e===null){if(!n)throw Error(ke(318));if(n=t.memoizedState,n=n!==null?n.dehydrated:null,!n)throw Error(ke(317));n[Mm]=t}else DC(),(t.flags&128)===0&&(t.memoizedState=null),t.flags|=4;Ua(t),n=!1}else jp!==null&&(_q(jp),jp=null),n=!0;if(!n)return t.flags&65536?t:null}return(t.flags&128)!==0?(t.lanes=r,t):(i=i!==null,i!==(e!==null&&e.memoizedState!==null)&&i&&(t.child.flags|=8192,(t.mode&1)!==0&&(e===null||(js.current&1)!==0?Po===0&&(Po=3):TK())),t.updateQueue!==null&&(t.flags|=4),Ua(t),null);case 4:return FC(),hq(e,t),e===null&&GP(t.stateNode.containerInfo),Ua(t),null;case 10:return oK(t.type._context),Ua(t),null;case 17:return Qc(t.type)&&Bk(),Ua(t),null;case 19:if(Es(js),n=t.memoizedState,n===null)return Ua(t),null;if(i=(t.flags&128)!==0,o=n.rendering,o===null)if(i)zR(n,!1);else{if(Po!==0||e!==null&&(e.flags&128)!==0)for(e=t.child;e!==null;){if(o=Zk(e),o!==null){for(t.flags|=128,zR(n,!1),i=o.updateQueue,i!==null&&(t.updateQueue=i,t.flags|=4),t.subtreeFlags=0,i=r,r=t.child;r!==null;)n=r,e=i,n.flags&=14680066,o=n.alternate,o===null?(n.childLanes=0,n.lanes=e,n.child=null,n.subtreeFlags=0,n.memoizedProps=null,n.memoizedState=null,n.updateQueue=null,n.dependencies=null,n.stateNode=null):(n.childLanes=o.childLanes,n.lanes=o.lanes,n.child=o.child,n.subtreeFlags=0,n.deletions=null,n.memoizedProps=o.memoizedProps,n.memoizedState=o.memoizedState,n.updateQueue=o.updateQueue,n.type=o.type,e=o.dependencies,n.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext}),r=r.sibling;return cs(js,js.current&1|2),t.child}e=e.sibling}n.tail!==null&&Ln()>UC&&(t.flags|=128,i=!0,zR(n,!1),t.lanes=4194304)}else{if(!i)if(e=Zk(o),e!==null){if(t.flags|=128,i=!0,r=e.updateQueue,r!==null&&(t.updateQueue=r,t.flags|=4),zR(n,!0),n.tail===null&&n.tailMode==="hidden"&&!o.alternate&&!Ps)return Ua(t),null}else 2*Ln()-n.renderingStartTime>UC&&r!==1073741824&&(t.flags|=128,i=!0,zR(n,!1),t.lanes=4194304);n.isBackwards?(o.sibling=t.child,t.child=o):(r=n.last,r!==null?r.sibling=o:t.child=o,n.last=o)}return n.tail!==null?(t=n.tail,n.rendering=t,n.tail=t.sibling,n.renderingStartTime=Ln(),t.sibling=null,r=js.current,cs(js,i?r&1|2:r&1),t):(Ua(t),null);case 22:case 23:return xK(),i=t.memoizedState!==null,e!==null&&e.memoizedState!==null!==i&&(t.flags|=8192),i&&(t.mode&1)!==0?(Vu&1073741824)!==0&&(Ua(t),t.subtreeFlags&6&&(t.flags|=8192)):Ua(t),null;case 24:return null;case 25:return null}throw Error(ke(156,t.tag))}function h4e(e,t){switch(rK(t),t.tag){case 1:return Qc(t.type)&&Bk(),e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 3:return FC(),Es(Yc),Es(fl),hK(),e=t.flags,(e&65536)!==0&&(e&128)===0?(t.flags=e&-65537|128,t):null;case 5:return uK(t),null;case 13:if(Es(js),e=t.memoizedState,e!==null&&e.dehydrated!==null){if(t.alternate===null)throw Error(ke(340));DC()}return e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 19:return Es(js),null;case 4:return FC(),null;case 10:return oK(t.type._context),null;case 22:case 23:return xK(),null;case 24:return null;default:return null}}var dD=!1,al=!1,d4e=typeof WeakSet=="function"?WeakSet:Set,ht=null;function xE(e,t){var r=e.ref;if(r!==null)if(typeof r=="function")try{r(null)}catch(i){fn(e,t,i)}else r.current=null}function dq(e,t,r){try{r()}catch(i){fn(e,t,i)}}var Ooe=!1;function p4e(e,t){if(ZH=kk,e=Mve(),eK(e)){if("selectionStart"in e)var r={start:e.selectionStart,end:e.selectionEnd};else e:{r=(r=e.ownerDocument)&&r.defaultView||window;var i=r.getSelection&&r.getSelection();if(i&&i.rangeCount!==0){r=i.anchorNode;var s=i.anchorOffset,n=i.focusNode;i=i.focusOffset;try{r.nodeType,n.nodeType}catch{r=null;break e}var o=0,a=-1,l=-1,c=0,h=0,p=e,f=null;t:for(;;){for(var m;p!==r||s!==0&&p.nodeType!==3||(a=o+s),p!==n||i!==0&&p.nodeType!==3||(l=o+i),p.nodeType===3&&(o+=p.nodeValue.length),(m=p.firstChild)!==null;)f=p,p=m;for(;;){if(p===e)break t;if(f===r&&++c===s&&(a=o),f===n&&++h===i&&(l=o),(m=p.nextSibling)!==null)break;p=f,f=p.parentNode}p=m}r=a===-1||l===-1?null:{start:a,end:l}}else r=null}r=r||{start:0,end:0}}else r=null;for(YH={focusedElem:e,selectionRange:r},kk=!1,ht=t;ht!==null;)if(t=ht,e=t.child,(t.subtreeFlags&1028)!==0&&e!==null)e.return=t,ht=e;else for(;ht!==null;){t=ht;try{var g=t.alternate;if((t.flags&1024)!==0)switch(t.tag){case 0:case 11:case 15:break;case 1:if(g!==null){var v=g.memoizedProps,w=g.memoizedState,_=t.stateNode,T=_.getSnapshotBeforeUpdate(t.elementType===t.type?v:Dp(t.type,v),w);_.__reactInternalSnapshotBeforeUpdate=T}break;case 3:var x=t.stateNode.containerInfo;x.nodeType===1?x.textContent="":x.nodeType===9&&x.documentElement&&x.removeChild(x.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(ke(163))}}catch(E){fn(t,t.return,E)}if(e=t.sibling,e!==null){e.return=t.return,ht=e;break}ht=t.return}return g=Ooe,Ooe=!1,g}function k3(e,t,r){var i=t.updateQueue;if(i=i!==null?i.lastEffect:null,i!==null){var s=i=i.next;do{if((s.tag&e)===e){var n=s.destroy;s.destroy=void 0,n!==void 0&&dq(t,r,n)}s=s.next}while(s!==i)}}function Lz(e,t){if(t=t.updateQueue,t=t!==null?t.lastEffect:null,t!==null){var r=t=t.next;do{if((r.tag&e)===e){var i=r.create;r.destroy=i()}r=r.next}while(r!==t)}}function pq(e){var t=e.ref;if(t!==null){var r=e.stateNode;switch(e.tag){case 5:e=r;break;default:e=r}typeof t=="function"?t(e):t.current=e}}function A_e(e){var t=e.alternate;t!==null&&(e.alternate=null,A_e(t)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(t=e.stateNode,t!==null&&(delete t[Mm],delete t[HP],delete t[KH],delete t[ZFe],delete t[YFe])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function R_e(e){return e.tag===5||e.tag===3||e.tag===4}function Moe(e){e:for(;;){for(;e.sibling===null;){if(e.return===null||R_e(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.flags&2||e.child===null||e.tag===4)continue e;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function fq(e,t,r){var i=e.tag;if(i===5||i===6)e=e.stateNode,t?r.nodeType===8?r.parentNode.insertBefore(e,t):r.insertBefore(e,t):(r.nodeType===8?(t=r.parentNode,t.insertBefore(e,r)):(t=r,t.appendChild(e)),r=r._reactRootContainer,r!=null||t.onclick!==null||(t.onclick=zk));else if(i!==4&&(e=e.child,e!==null))for(fq(e,t,r),e=e.sibling;e!==null;)fq(e,t,r),e=e.sibling}function mq(e,t,r){var i=e.tag;if(i===5||i===6)e=e.stateNode,t?r.insertBefore(e,t):r.appendChild(e);else if(i!==4&&(e=e.child,e!==null))for(mq(e,t,r),e=e.sibling;e!==null;)mq(e,t,r),e=e.sibling}var _a=null,kp=!1;function U0(e,t,r){for(r=r.child;r!==null;)O_e(e,t,r),r=r.sibling}function O_e(e,t,r){if(Um&&typeof Um.onCommitFiberUnmount=="function")try{Um.onCommitFiberUnmount(Cz,r)}catch{}switch(r.tag){case 5:al||xE(r,t);case 6:var i=_a,s=kp;_a=null,U0(e,t,r),_a=i,kp=s,_a!==null&&(kp?(e=_a,r=r.stateNode,e.nodeType===8?e.parentNode.removeChild(r):e.removeChild(r)):_a.removeChild(r.stateNode));break;case 18:_a!==null&&(kp?(e=_a,r=r.stateNode,e.nodeType===8?p9(e.parentNode,r):e.nodeType===1&&p9(e,r),VP(e)):p9(_a,r.stateNode));break;case 4:i=_a,s=kp,_a=r.stateNode.containerInfo,kp=!0,U0(e,t,r),_a=i,kp=s;break;case 0:case 11:case 14:case 15:if(!al&&(i=r.updateQueue,i!==null&&(i=i.lastEffect,i!==null))){s=i=i.next;do{var n=s,o=n.destroy;n=n.tag,o!==void 0&&((n&2)!==0||(n&4)!==0)&&dq(r,t,o),s=s.next}while(s!==i)}U0(e,t,r);break;case 1:if(!al&&(xE(r,t),i=r.stateNode,typeof i.componentWillUnmount=="function"))try{i.props=r.memoizedProps,i.state=r.memoizedState,i.componentWillUnmount()}catch(a){fn(r,t,a)}U0(e,t,r);break;case 21:U0(e,t,r);break;case 22:r.mode&1?(al=(i=al)||r.memoizedState!==null,U0(e,t,r),al=i):U0(e,t,r);break;default:U0(e,t,r)}}function Poe(e){var t=e.updateQueue;if(t!==null){e.updateQueue=null;var r=e.stateNode;r===null&&(r=e.stateNode=new d4e),t.forEach(function(i){var s=x4e.bind(null,e,i);r.has(i)||(r.add(i),i.then(s,s))})}}function ep(e,t){var r=t.deletions;if(r!==null)for(var i=0;i<r.length;i++){var s=r[i];try{var n=e,o=t,a=o;e:for(;a!==null;){switch(a.tag){case 5:_a=a.stateNode,kp=!1;break e;case 3:_a=a.stateNode.containerInfo,kp=!0;break e;case 4:_a=a.stateNode.containerInfo,kp=!0;break e}a=a.return}if(_a===null)throw Error(ke(160));O_e(n,o,s),_a=null,kp=!1;var l=s.alternate;l!==null&&(l.return=null),s.return=null}catch(c){fn(s,t,c)}}if(t.subtreeFlags&12854)for(t=t.child;t!==null;)M_e(t,e),t=t.sibling}function M_e(e,t){var r=e.alternate,i=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(ep(t,e),Rf(e),i&4){try{k3(3,e,e.return),Lz(3,e)}catch(v){fn(e,e.return,v)}try{k3(5,e,e.return)}catch(v){fn(e,e.return,v)}}break;case 1:ep(t,e),Rf(e),i&512&&r!==null&&xE(r,r.return);break;case 5:if(ep(t,e),Rf(e),i&512&&r!==null&&xE(r,r.return),e.flags&32){var s=e.stateNode;try{NP(s,"")}catch(v){fn(e,e.return,v)}}if(i&4&&(s=e.stateNode,s!=null)){var n=e.memoizedProps,o=r!==null?r.memoizedProps:n,a=e.type,l=e.updateQueue;if(e.updateQueue=null,l!==null)try{a==="input"&&n.type==="radio"&&n.name!=null&&Q0e(s,n),UH(a,o);var c=UH(a,n);for(o=0;o<l.length;o+=2){var h=l[o],p=l[o+1];h==="style"?rve(s,p):h==="dangerouslySetInnerHTML"?eve(s,p):h==="children"?NP(s,p):zJ(s,h,p,c)}switch(a){case"input":LH(s,n);break;case"textarea":J0e(s,n);break;case"select":var f=s._wrapperState.wasMultiple;s._wrapperState.wasMultiple=!!n.multiple;var m=n.value;m!=null?YE(s,!!n.multiple,m,!1):f!==!!n.multiple&&(n.defaultValue!=null?YE(s,!!n.multiple,n.defaultValue,!0):YE(s,!!n.multiple,n.multiple?[]:"",!1))}s[HP]=n}catch(v){fn(e,e.return,v)}}break;case 6:if(ep(t,e),Rf(e),i&4){if(e.stateNode===null)throw Error(ke(162));s=e.stateNode,n=e.memoizedProps;try{s.nodeValue=n}catch(v){fn(e,e.return,v)}}break;case 3:if(ep(t,e),Rf(e),i&4&&r!==null&&r.memoizedState.isDehydrated)try{VP(t.containerInfo)}catch(v){fn(e,e.return,v)}break;case 4:ep(t,e),Rf(e);break;case 13:ep(t,e),Rf(e),s=e.child,s.flags&8192&&(n=s.memoizedState!==null,s.stateNode.isHidden=n,!n||s.alternate!==null&&s.alternate.memoizedState!==null||(bK=Ln())),i&4&&Poe(e);break;case 22:if(h=r!==null&&r.memoizedState!==null,e.mode&1?(al=(c=al)||h,ep(t,e),al=c):ep(t,e),Rf(e),i&8192){if(c=e.memoizedState!==null,(e.stateNode.isHidden=c)&&!h&&(e.mode&1)!==0)for(ht=e,h=e.child;h!==null;){for(p=ht=h;ht!==null;){switch(f=ht,m=f.child,f.tag){case 0:case 11:case 14:case 15:k3(4,f,f.return);break;case 1:xE(f,f.return);var g=f.stateNode;if(typeof g.componentWillUnmount=="function"){i=f,r=f.return;try{t=i,g.props=t.memoizedProps,g.state=t.memoizedState,g.componentWillUnmount()}catch(v){fn(i,r,v)}}break;case 5:xE(f,f.return);break;case 22:if(f.memoizedState!==null){$oe(p);continue}}m!==null?(m.return=f,ht=m):$oe(p)}h=h.sibling}e:for(h=null,p=e;;){if(p.tag===5){if(h===null){h=p;try{s=p.stateNode,c?(n=s.style,typeof n.setProperty=="function"?n.setProperty("display","none","important"):n.display="none"):(a=p.stateNode,l=p.memoizedProps.style,o=l!=null&&l.hasOwnProperty("display")?l.display:null,a.style.display=tve("display",o))}catch(v){fn(e,e.return,v)}}}else if(p.tag===6){if(h===null)try{p.stateNode.nodeValue=c?"":p.memoizedProps}catch(v){fn(e,e.return,v)}}else if((p.tag!==22&&p.tag!==23||p.memoizedState===null||p===e)&&p.child!==null){p.child.return=p,p=p.child;continue}if(p===e)break e;for(;p.sibling===null;){if(p.return===null||p.return===e)break e;h===p&&(h=null),p=p.return}h===p&&(h=null),p.sibling.return=p.return,p=p.sibling}}break;case 19:ep(t,e),Rf(e),i&4&&Poe(e);break;case 21:break;default:ep(t,e),Rf(e)}}function Rf(e){var t=e.flags;if(t&2){try{e:{for(var r=e.return;r!==null;){if(R_e(r)){var i=r;break e}r=r.return}throw Error(ke(160))}switch(i.tag){case 5:var s=i.stateNode;i.flags&32&&(NP(s,""),i.flags&=-33);var n=Moe(e);mq(e,n,s);break;case 3:case 4:var o=i.stateNode.containerInfo,a=Moe(e);fq(e,a,o);break;default:throw Error(ke(161))}}catch(l){fn(e,e.return,l)}e.flags&=-3}t&4096&&(e.flags&=-4097)}function f4e(e,t,r){ht=e,P_e(e)}function P_e(e,t,r){for(var i=(e.mode&1)!==0;ht!==null;){var s=ht,n=s.child;if(s.tag===22&&i){var o=s.memoizedState!==null||dD;if(!o){var a=s.alternate,l=a!==null&&a.memoizedState!==null||al;a=dD;var c=al;if(dD=o,(al=l)&&!c)for(ht=s;ht!==null;)o=ht,l=o.child,o.tag===22&&o.memoizedState!==null?Loe(s):l!==null?(l.return=o,ht=l):Loe(s);for(;n!==null;)ht=n,P_e(n),n=n.sibling;ht=s,dD=a,al=c}Ioe(e)}else(s.subtreeFlags&8772)!==0&&n!==null?(n.return=s,ht=n):Ioe(e)}}function Ioe(e){for(;ht!==null;){var t=ht;if((t.flags&8772)!==0){var r=t.alternate;try{if((t.flags&8772)!==0)switch(t.tag){case 0:case 11:case 15:al||Lz(5,t);break;case 1:var i=t.stateNode;if(t.flags&4&&!al)if(r===null)i.componentDidMount();else{var s=t.elementType===t.type?r.memoizedProps:Dp(t.type,r.memoizedProps);i.componentDidUpdate(s,r.memoizedState,i.__reactInternalSnapshotBeforeUpdate)}var n=t.updateQueue;n!==null&&moe(t,n,i);break;case 3:var o=t.updateQueue;if(o!==null){if(r=null,t.child!==null)switch(t.child.tag){case 5:r=t.child.stateNode;break;case 1:r=t.child.stateNode}moe(t,o,r)}break;case 5:var a=t.stateNode;if(r===null&&t.flags&4){r=a;var l=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":l.autoFocus&&r.focus();break;case"img":l.src&&(r.src=l.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(t.memoizedState===null){var c=t.alternate;if(c!==null){var h=c.memoizedState;if(h!==null){var p=h.dehydrated;p!==null&&VP(p)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(ke(163))}al||t.flags&512&&pq(t)}catch(f){fn(t,t.return,f)}}if(t===e){ht=null;break}if(r=t.sibling,r!==null){r.return=t.return,ht=r;break}ht=t.return}}function $oe(e){for(;ht!==null;){var t=ht;if(t===e){ht=null;break}var r=t.sibling;if(r!==null){r.return=t.return,ht=r;break}ht=t.return}}function Loe(e){for(;ht!==null;){var t=ht;try{switch(t.tag){case 0:case 11:case 15:var r=t.return;try{Lz(4,t)}catch(l){fn(t,r,l)}break;case 1:var i=t.stateNode;if(typeof i.componentDidMount=="function"){var s=t.return;try{i.componentDidMount()}catch(l){fn(t,s,l)}}var n=t.return;try{pq(t)}catch(l){fn(t,n,l)}break;case 5:var o=t.return;try{pq(t)}catch(l){fn(t,o,l)}}}catch(l){fn(t,t.return,l)}if(t===e){ht=null;break}var a=t.sibling;if(a!==null){a.return=t.return,ht=a;break}ht=t.return}}var m4e=Math.ceil,Jk=T0.ReactCurrentDispatcher,vK=T0.ReactCurrentOwner,Pd=T0.ReactCurrentBatchConfig,di=0,oa=null,to=null,Aa=0,Vu=0,TE=W1(0),Po=0,QP=null,Kx=0,Dz=0,_K=0,U3=null,kc=null,bK=0,UC=1/0,yy=null,Kk=!1,gq=null,i1=null,pD=!1,I_=null,eU=0,V3=0,yq=null,C4=-1,A4=0;function Ql(){return(di&6)!==0?Ln():C4!==-1?C4:C4=Ln()}function s1(e){return(e.mode&1)===0?1:(di&2)!==0&&Aa!==0?Aa&-Aa:JFe.transition!==null?(A4===0&&(A4=fve()),A4):(e=Ui,e!==0||(e=window.event,e=e===void 0?16:wve(e.type)),e)}function hf(e,t,r,i){if(50<V3)throw V3=0,yq=null,Error(ke(185));I$(e,r,i),((di&2)===0||e!==oa)&&(e===oa&&((di&2)===0&&(Dz|=r),Po===4&&x_(e,Aa)),Jc(e,i),r===1&&di===0&&(t.mode&1)===0&&(UC=Ln()+500,Pz&&X1()))}function Jc(e,t){var r=e.callbackNode;JNe(e,t);var i=Fk(e,e===oa?Aa:0);if(i===0)r!==null&&Gne(r),e.callbackNode=null,e.callbackPriority=0;else if(t=i&-i,e.callbackPriority!==t){if(r!=null&&Gne(r),t===1)e.tag===0?QFe(Doe.bind(null,e)):Vve(Doe.bind(null,e)),WFe(function(){(di&6)===0&&X1()}),r=null;else{switch(mve(i)){case 1:r=qJ;break;case 4:r=dve;break;case 16:r=Nk;break;case 536870912:r=pve;break;default:r=Nk}r=U_e(r,I_e.bind(null,e))}e.callbackPriority=t,e.callbackNode=r}}function I_e(e,t){if(C4=-1,A4=0,(di&6)!==0)throw Error(ke(327));var r=e.callbackNode;if(tC()&&e.callbackNode!==r)return null;var i=Fk(e,e===oa?Aa:0);if(i===0)return null;if((i&30)!==0||(i&e.expiredLanes)!==0||t)t=tU(e,i);else{t=i;var s=di;di|=2;var n=L_e();(oa!==e||Aa!==t)&&(yy=null,UC=Ln()+500,Ix(e,t));do try{v4e();break}catch(a){$_e(e,a)}while(1);nK(),Jk.current=n,di=s,to!==null?t=0:(oa=null,Aa=0,t=Po)}if(t!==0){if(t===2&&(s=jH(e),s!==0&&(i=s,t=vq(e,s))),t===1)throw r=QP,Ix(e,0),x_(e,i),Jc(e,Ln()),r;if(t===6)x_(e,i);else{if(s=e.current.alternate,(i&30)===0&&!g4e(s)&&(t=tU(e,i),t===2&&(n=jH(e),n!==0&&(i=n,t=vq(e,n))),t===1))throw r=QP,Ix(e,0),x_(e,i),Jc(e,Ln()),r;switch(e.finishedWork=s,e.finishedLanes=i,t){case 0:case 1:throw Error(ke(345));case 2:Wb(e,kc,yy);break;case 3:if(x_(e,i),(i&130023424)===i&&(t=bK+500-Ln(),10<t)){if(Fk(e,0)!==0)break;if(s=e.suspendedLanes,(s&i)!==i){Ql(),e.pingedLanes|=e.suspendedLanes&s;break}e.timeoutHandle=JH(Wb.bind(null,e,kc,yy),t);break}Wb(e,kc,yy);break;case 4:if(x_(e,i),(i&4194240)===i)break;for(t=e.eventTimes,s=-1;0<i;){var o=31-uf(i);n=1<<o,o=t[o],o>s&&(s=o),i&=~n}if(i=s,i=Ln()-i,i=(120>i?120:480>i?480:1080>i?1080:1920>i?1920:3e3>i?3e3:4320>i?4320:1960*m4e(i/1960))-i,10<i){e.timeoutHandle=JH(Wb.bind(null,e,kc,yy),i);break}Wb(e,kc,yy);break;case 5:Wb(e,kc,yy);break;default:throw Error(ke(329))}}}return Jc(e,Ln()),e.callbackNode===r?I_e.bind(null,e):null}function vq(e,t){var r=U3;return e.current.memoizedState.isDehydrated&&(Ix(e,t).flags|=256),e=tU(e,t),e!==2&&(t=kc,kc=r,t!==null&&_q(t)),e}function _q(e){kc===null?kc=e:kc.push.apply(kc,e)}function g4e(e){for(var t=e;;){if(t.flags&16384){var r=t.updateQueue;if(r!==null&&(r=r.stores,r!==null))for(var i=0;i<r.length;i++){var s=r[i],n=s.getSnapshot;s=s.value;try{if(!yf(n(),s))return!1}catch{return!1}}}if(r=t.child,t.subtreeFlags&16384&&r!==null)r.return=t,t=r;else{if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}function x_(e,t){for(t&=~_K,t&=~Dz,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var r=31-uf(t),i=1<<r;e[r]=-1,t&=~i}}function Doe(e){if((di&6)!==0)throw Error(ke(327));tC();var t=Fk(e,0);if((t&1)===0)return Jc(e,Ln()),null;var r=tU(e,t);if(e.tag!==0&&r===2){var i=jH(e);i!==0&&(t=i,r=vq(e,i))}if(r===1)throw r=QP,Ix(e,0),x_(e,t),Jc(e,Ln()),r;if(r===6)throw Error(ke(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,Wb(e,kc,yy),Jc(e,Ln()),null}function wK(e,t){var r=di;di|=1;try{return e(t)}finally{di=r,di===0&&(UC=Ln()+500,Pz&&X1())}}function eT(e){I_!==null&&I_.tag===0&&(di&6)===0&&tC();var t=di;di|=1;var r=Pd.transition,i=Ui;try{if(Pd.transition=null,Ui=1,e)return e()}finally{Ui=i,Pd.transition=r,di=t,(di&6)===0&&X1()}}function xK(){Vu=TE.current,Es(TE)}function Ix(e,t){e.finishedWork=null,e.finishedLanes=0;var r=e.timeoutHandle;if(r!==-1&&(e.timeoutHandle=-1,qFe(r)),to!==null)for(r=to.return;r!==null;){var i=r;switch(rK(i),i.tag){case 1:i=i.type.childContextTypes,i!=null&&Bk();break;case 3:FC(),Es(Yc),Es(fl),hK();break;case 5:uK(i);break;case 4:FC();break;case 13:Es(js);break;case 19:Es(js);break;case 10:oK(i.type._context);break;case 22:case 23:xK()}r=r.return}if(oa=e,to=e=n1(e.current,null),Aa=Vu=t,Po=0,QP=null,_K=Dz=Kx=0,kc=U3=null,dx!==null){for(t=0;t<dx.length;t++)if(r=dx[t],i=r.interleaved,i!==null){r.interleaved=null;var s=i.next,n=r.pending;if(n!==null){var o=n.next;n.next=s,i.next=o}r.pending=i}dx=null}return e}function $_e(e,t){do{var r=to;try{if(nK(),T4.current=Qk,Yk){for(var i=Ys.memoizedState;i!==null;){var s=i.queue;s!==null&&(s.pending=null),i=i.next}Yk=!1}if(Jx=0,Jo=So=Ys=null,F3=!1,XP=0,vK.current=null,r===null||r.return===null){Po=1,QP=t,to=null;break}e:{var n=e,o=r.return,a=r,l=t;if(t=Aa,a.flags|=32768,l!==null&&typeof l=="object"&&typeof l.then=="function"){var c=l,h=a,p=h.tag;if((h.mode&1)===0&&(p===0||p===11||p===15)){var f=h.alternate;f?(h.updateQueue=f.updateQueue,h.memoizedState=f.memoizedState,h.lanes=f.lanes):(h.updateQueue=null,h.memoizedState=null)}var m=xoe(o);if(m!==null){m.flags&=-257,Toe(m,o,a,n,t),m.mode&1&&woe(n,c,t),t=m,l=c;var g=t.updateQueue;if(g===null){var v=new Set;v.add(l),t.updateQueue=v}else g.add(l);break e}else{if((t&1)===0){woe(n,c,t),TK();break e}l=Error(ke(426))}}else if(Ps&&a.mode&1){var w=xoe(o);if(w!==null){(w.flags&65536)===0&&(w.flags|=256),Toe(w,o,a,n,t),iK(kC(l,a));break e}}n=l=kC(l,a),Po!==4&&(Po=2),U3===null?U3=[n]:U3.push(n),n=o;do{switch(n.tag){case 3:n.flags|=65536,t&=-t,n.lanes|=t;var _=g_e(n,l,t);foe(n,_);break e;case 1:a=l;var T=n.type,x=n.stateNode;if((n.flags&128)===0&&(typeof T.getDerivedStateFromError=="function"||x!==null&&typeof x.componentDidCatch=="function"&&(i1===null||!i1.has(x)))){n.flags|=65536,t&=-t,n.lanes|=t;var E=y_e(n,a,t);foe(n,E);break e}}n=n.return}while(n!==null)}N_e(r)}catch(C){t=C,to===r&&r!==null&&(to=r=r.return);continue}break}while(1)}function L_e(){var e=Jk.current;return Jk.current=Qk,e===null?Qk:e}function TK(){(Po===0||Po===3||Po===2)&&(Po=4),oa===null||(Kx&268435455)===0&&(Dz&268435455)===0||x_(oa,Aa)}function tU(e,t){var r=di;di|=2;var i=L_e();(oa!==e||Aa!==t)&&(yy=null,Ix(e,t));do try{y4e();break}catch(s){$_e(e,s)}while(1);if(nK(),di=r,Jk.current=i,to!==null)throw Error(ke(261));return oa=null,Aa=0,Po}function y4e(){for(;to!==null;)D_e(to)}function v4e(){for(;to!==null&&!GNe();)D_e(to)}function D_e(e){var t=k_e(e.alternate,e,Vu);e.memoizedProps=e.pendingProps,t===null?N_e(e):to=t,vK.current=null}function N_e(e){var t=e;do{var r=t.alternate;if(e=t.return,(t.flags&32768)===0){if(r=u4e(r,t,Vu),r!==null){to=r;return}}else{if(r=h4e(r,t),r!==null){r.flags&=32767,to=r;return}if(e!==null)e.flags|=32768,e.subtreeFlags=0,e.deletions=null;else{Po=6,to=null;return}}if(t=t.sibling,t!==null){to=t;return}to=t=e}while(t!==null);Po===0&&(Po=5)}function Wb(e,t,r){var i=Ui,s=Pd.transition;try{Pd.transition=null,Ui=1,_4e(e,t,r,i)}finally{Pd.transition=s,Ui=i}return null}function _4e(e,t,r,i){do tC();while(I_!==null);if((di&6)!==0)throw Error(ke(327));r=e.finishedWork;var s=e.finishedLanes;if(r===null)return null;if(e.finishedWork=null,e.finishedLanes=0,r===e.current)throw Error(ke(177));e.callbackNode=null,e.callbackPriority=0;var n=r.lanes|r.childLanes;if(KNe(e,n),e===oa&&(to=oa=null,Aa=0),(r.subtreeFlags&2064)===0&&(r.flags&2064)===0||pD||(pD=!0,U_e(Nk,function(){return tC(),null})),n=(r.flags&15990)!==0,(r.subtreeFlags&15990)!==0||n){n=Pd.transition,Pd.transition=null;var o=Ui;Ui=1;var a=di;di|=4,vK.current=null,p4e(e,r),M_e(r,e),UFe(YH),kk=!!ZH,YH=ZH=null,e.current=r,f4e(r),jNe(),di=a,Ui=o,Pd.transition=n}else e.current=r;if(pD&&(pD=!1,I_=e,eU=s),n=e.pendingLanes,n===0&&(i1=null),WNe(r.stateNode),Jc(e,Ln()),t!==null)for(i=e.onRecoverableError,r=0;r<t.length;r++)s=t[r],i(s.value,{componentStack:s.stack,digest:s.digest});if(Kk)throw Kk=!1,e=gq,gq=null,e;return(eU&1)!==0&&e.tag!==0&&tC(),n=e.pendingLanes,(n&1)!==0?e===yq?V3++:(V3=0,yq=e):V3=0,X1(),null}function tC(){if(I_!==null){var e=mve(eU),t=Pd.transition,r=Ui;try{if(Pd.transition=null,Ui=16>e?16:e,I_===null)var i=!1;else{if(e=I_,I_=null,eU=0,(di&6)!==0)throw Error(ke(331));var s=di;for(di|=4,ht=e.current;ht!==null;){var n=ht,o=n.child;if((ht.flags&16)!==0){var a=n.deletions;if(a!==null){for(var l=0;l<a.length;l++){var c=a[l];for(ht=c;ht!==null;){var h=ht;switch(h.tag){case 0:case 11:case 15:k3(8,h,n)}var p=h.child;if(p!==null)p.return=h,ht=p;else for(;ht!==null;){h=ht;var f=h.sibling,m=h.return;if(A_e(h),h===c){ht=null;break}if(f!==null){f.return=m,ht=f;break}ht=m}}}var g=n.alternate;if(g!==null){var v=g.child;if(v!==null){g.child=null;do{var w=v.sibling;v.sibling=null,v=w}while(v!==null)}}ht=n}}if((n.subtreeFlags&2064)!==0&&o!==null)o.return=n,ht=o;else e:for(;ht!==null;){if(n=ht,(n.flags&2048)!==0)switch(n.tag){case 0:case 11:case 15:k3(9,n,n.return)}var _=n.sibling;if(_!==null){_.return=n.return,ht=_;break e}ht=n.return}}var T=e.current;for(ht=T;ht!==null;){o=ht;var x=o.child;if((o.subtreeFlags&2064)!==0&&x!==null)x.return=o,ht=x;else e:for(o=T;ht!==null;){if(a=ht,(a.flags&2048)!==0)try{switch(a.tag){case 0:case 11:case 15:Lz(9,a)}}catch(C){fn(a,a.return,C)}if(a===o){ht=null;break e}var E=a.sibling;if(E!==null){E.return=a.return,ht=E;break e}ht=a.return}}if(di=s,X1(),Um&&typeof Um.onPostCommitFiberRoot=="function")try{Um.onPostCommitFiberRoot(Cz,e)}catch{}i=!0}return i}finally{Ui=r,Pd.transition=t}}return!1}function Noe(e,t,r){t=kC(r,t),t=g_e(e,t,1),e=r1(e,t,1),t=Ql(),e!==null&&(I$(e,1,t),Jc(e,t))}function fn(e,t,r){if(e.tag===3)Noe(e,e,r);else for(;t!==null;){if(t.tag===3){Noe(t,e,r);break}else if(t.tag===1){var i=t.stateNode;if(typeof t.type.getDerivedStateFromError=="function"||typeof i.componentDidCatch=="function"&&(i1===null||!i1.has(i))){e=kC(r,e),e=y_e(t,e,1),t=r1(t,e,1),e=Ql(),t!==null&&(I$(t,1,e),Jc(t,e));break}}t=t.return}}function b4e(e,t,r){var i=e.pingCache;i!==null&&i.delete(t),t=Ql(),e.pingedLanes|=e.suspendedLanes&r,oa===e&&(Aa&r)===r&&(Po===4||Po===3&&(Aa&130023424)===Aa&&500>Ln()-bK?Ix(e,0):_K|=r),Jc(e,t)}function F_e(e,t){t===0&&((e.mode&1)===0?t=1:(t=iD,iD<<=1,(iD&130023424)===0&&(iD=4194304)));var r=Ql();e=o0(e,t),e!==null&&(I$(e,t,r),Jc(e,r))}function w4e(e){var t=e.memoizedState,r=0;t!==null&&(r=t.retryLane),F_e(e,r)}function x4e(e,t){var r=0;switch(e.tag){case 13:var i=e.stateNode,s=e.memoizedState;s!==null&&(r=s.retryLane);break;case 19:i=e.stateNode;break;default:throw Error(ke(314))}i!==null&&i.delete(t),F_e(e,r)}var k_e;k_e=function(e,t,r){if(e!==null)if(e.memoizedProps!==t.pendingProps||Yc.current)jc=!0;else{if((e.lanes&r)===0&&(t.flags&128)===0)return jc=!1,c4e(e,t,r);jc=(e.flags&131072)!==0}else jc=!1,Ps&&(t.flags&1048576)!==0&&zve(t,Hk,t.index);switch(t.lanes=0,t.tag){case 2:var i=t.type;E4(e,t),e=t.pendingProps;var s=LC(t,fl.current);eC(t,r),s=pK(null,t,i,e,s,r);var n=fK();return t.flags|=1,typeof s=="object"&&s!==null&&typeof s.render=="function"&&s.$$typeof===void 0?(t.tag=1,t.memoizedState=null,t.updateQueue=null,Qc(i)?(n=!0,Gk(t)):n=!1,t.memoizedState=s.state!==null&&s.state!==void 0?s.state:null,lK(t),s.updater=Iz,t.stateNode=s,s._reactInternals=t,nq(t,i,e,r),t=lq(null,t,i,!0,n,r)):(t.tag=0,Ps&&n&&tK(t),zl(null,t,s,r),t=t.child),t;case 16:i=t.elementType;e:{switch(E4(e,t),e=t.pendingProps,s=i._init,i=s(i._payload),t.type=i,s=t.tag=S4e(i),e=Dp(i,e),s){case 0:t=aq(null,t,i,e,r);break e;case 1:t=Coe(null,t,i,e,r);break e;case 11:t=Soe(null,t,i,e,r);break e;case 14:t=Eoe(null,t,i,Dp(i.type,e),r);break e}throw Error(ke(306,i,""))}return t;case 0:return i=t.type,s=t.pendingProps,s=t.elementType===i?s:Dp(i,s),aq(e,t,i,s,r);case 1:return i=t.type,s=t.pendingProps,s=t.elementType===i?s:Dp(i,s),Coe(e,t,i,s,r);case 3:e:{if(w_e(t),e===null)throw Error(ke(387));i=t.pendingProps,n=t.memoizedState,s=n.element,Hve(e,t),Xk(t,i,null,r);var o=t.memoizedState;if(i=o.element,n.isDehydrated)if(n={element:i,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},t.updateQueue.baseState=n,t.memoizedState=n,t.flags&256){s=kC(Error(ke(423)),t),t=Aoe(e,t,i,r,s);break e}else if(i!==s){s=kC(Error(ke(424)),t),t=Aoe(e,t,i,r,s);break e}else for(rh=t1(t.stateNode.containerInfo.firstChild),oh=t,Ps=!0,jp=null,r=Zve(t,null,i,r),t.child=r;r;)r.flags=r.flags&-3|4096,r=r.sibling;else{if(DC(),i===s){t=a0(e,t,r);break e}zl(e,t,i,r)}t=t.child}return t;case 5:return Yve(t),e===null&&rq(t),i=t.type,s=t.pendingProps,n=e!==null?e.memoizedProps:null,o=s.children,QH(i,s)?o=null:n!==null&&QH(i,n)&&(t.flags|=32),b_e(e,t),zl(e,t,o,r),t.child;case 6:return e===null&&rq(t),null;case 13:return x_e(e,t,r);case 4:return cK(t,t.stateNode.containerInfo),i=t.pendingProps,e===null?t.child=NC(t,null,i,r):zl(e,t,i,r),t.child;case 11:return i=t.type,s=t.pendingProps,s=t.elementType===i?s:Dp(i,s),Soe(e,t,i,s,r);case 7:return zl(e,t,t.pendingProps,r),t.child;case 8:return zl(e,t,t.pendingProps.children,r),t.child;case 12:return zl(e,t,t.pendingProps.children,r),t.child;case 10:e:{if(i=t.type._context,s=t.pendingProps,n=t.memoizedProps,o=s.value,cs(qk,i._currentValue),i._currentValue=o,n!==null)if(yf(n.value,o)){if(n.children===s.children&&!Yc.current){t=a0(e,t,r);break e}}else for(n=t.child,n!==null&&(n.return=t);n!==null;){var a=n.dependencies;if(a!==null){o=n.child;for(var l=a.firstContext;l!==null;){if(l.context===i){if(n.tag===1){l=By(-1,r&-r),l.tag=2;var c=n.updateQueue;if(c!==null){c=c.shared;var h=c.pending;h===null?l.next=l:(l.next=h.next,h.next=l),c.pending=l}}n.lanes|=r,l=n.alternate,l!==null&&(l.lanes|=r),iq(n.return,r,t),a.lanes|=r;break}l=l.next}}else if(n.tag===10)o=n.type===t.type?null:n.child;else if(n.tag===18){if(o=n.return,o===null)throw Error(ke(341));o.lanes|=r,a=o.alternate,a!==null&&(a.lanes|=r),iq(o,r,t),o=n.sibling}else o=n.child;if(o!==null)o.return=n;else for(o=n;o!==null;){if(o===t){o=null;break}if(n=o.sibling,n!==null){n.return=o.return,o=n;break}o=o.return}n=o}zl(e,t,s.children,r),t=t.child}return t;case 9:return s=t.type,i=t.pendingProps.children,eC(t,r),s=Dd(s),i=i(s),t.flags|=1,zl(e,t,i,r),t.child;case 14:return i=t.type,s=Dp(i,t.pendingProps),s=Dp(i.type,s),Eoe(e,t,i,s,r);case 15:return v_e(e,t,t.type,t.pendingProps,r);case 17:return i=t.type,s=t.pendingProps,s=t.elementType===i?s:Dp(i,s),E4(e,t),t.tag=1,Qc(i)?(e=!0,Gk(t)):e=!1,eC(t,r),Wve(t,i,s),nq(t,i,s,r),lq(null,t,i,!0,e,r);case 19:return T_e(e,t,r);case 22:return __e(e,t,r)}throw Error(ke(156,t.tag))};function U_e(e,t){return hve(e,t)}function T4e(e,t,r,i){this.tag=e,this.key=r,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=i,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Ad(e,t,r,i){return new T4e(e,t,r,i)}function SK(e){return e=e.prototype,!(!e||!e.isReactComponent)}function S4e(e){if(typeof e=="function")return SK(e)?1:0;if(e!=null){if(e=e.$$typeof,e===GJ)return 11;if(e===jJ)return 14}return 2}function n1(e,t){var r=e.alternate;return r===null?(r=Ad(e.tag,t,e.key,e.mode),r.elementType=e.elementType,r.type=e.type,r.stateNode=e.stateNode,r.alternate=e,e.alternate=r):(r.pendingProps=t,r.type=e.type,r.flags=0,r.subtreeFlags=0,r.deletions=null),r.flags=e.flags&14680064,r.childLanes=e.childLanes,r.lanes=e.lanes,r.child=e.child,r.memoizedProps=e.memoizedProps,r.memoizedState=e.memoizedState,r.updateQueue=e.updateQueue,t=e.dependencies,r.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext},r.sibling=e.sibling,r.index=e.index,r.ref=e.ref,r}function R4(e,t,r,i,s,n){var o=2;if(i=e,typeof e=="function")SK(e)&&(o=1);else if(typeof e=="string")o=5;else e:switch(e){case pE:return $x(r.children,s,n,t);case BJ:o=8,s|=8;break;case OH:return e=Ad(12,r,t,s|2),e.elementType=OH,e.lanes=n,e;case MH:return e=Ad(13,r,t,s),e.elementType=MH,e.lanes=n,e;case PH:return e=Ad(19,r,t,s),e.elementType=PH,e.lanes=n,e;case X0e:return Nz(r,s,n,t);default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case q0e:o=10;break e;case W0e:o=9;break e;case GJ:o=11;break e;case jJ:o=14;break e;case a_:o=16,i=null;break e}throw Error(ke(130,e==null?e:typeof e,""))}return t=Ad(o,r,t,s),t.elementType=e,t.type=i,t.lanes=n,t}function $x(e,t,r,i){return e=Ad(7,e,i,t),e.lanes=r,e}function Nz(e,t,r,i){return e=Ad(22,e,i,t),e.elementType=X0e,e.lanes=r,e.stateNode={isHidden:!1},e}function w9(e,t,r){return e=Ad(6,e,null,t),e.lanes=r,e}function x9(e,t,r){return t=Ad(4,e.children!==null?e.children:[],e.key,t),t.lanes=r,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function E4e(e,t,r,i,s){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=r9(0),this.expirationTimes=r9(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=r9(0),this.identifierPrefix=i,this.onRecoverableError=s,this.mutableSourceEagerHydrationData=null}function EK(e,t,r,i,s,n,o,a,l){return e=new E4e(e,t,r,a,l),t===1?(t=1,n===!0&&(t|=8)):t=0,n=Ad(3,null,null,t),e.current=n,n.stateNode=e,n.memoizedState={element:i,isDehydrated:r,cache:null,transitions:null,pendingSuspenseBoundaries:null},lK(n),e}function C4e(e,t,r){var i=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:dE,key:i==null?null:""+i,children:e,containerInfo:t,implementation:r}}function V_e(e){if(!e)return w1;e=e._reactInternals;e:{if(zT(e)!==e||e.tag!==1)throw Error(ke(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(Qc(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(t!==null);throw Error(ke(171))}if(e.tag===1){var r=e.type;if(Qc(r))return Uve(e,r,t)}return t}function z_e(e,t,r,i,s,n,o,a,l){return e=EK(r,i,!0,e,s,n,o,a,l),e.context=V_e(null),r=e.current,i=Ql(),s=s1(r),n=By(i,s),n.callback=t!=null?t:null,r1(r,n,s),e.current.lanes=s,I$(e,s,i),Jc(e,i),e}function Fz(e,t,r,i){var s=t.current,n=Ql(),o=s1(s);return r=V_e(r),t.context===null?t.context=r:t.pendingContext=r,t=By(n,o),t.payload={element:e},i=i===void 0?null:i,i!==null&&(t.callback=i),e=r1(s,t,o),e!==null&&(hf(e,s,o,n),x4(e,s,o)),o}function rU(e){if(e=e.current,!e.child)return null;switch(e.child.tag){case 5:return e.child.stateNode;default:return e.child.stateNode}}function Foe(e,t){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var r=e.retryLane;e.retryLane=r!==0&&r<t?r:t}}function CK(e,t){Foe(e,t),(e=e.alternate)&&Foe(e,t)}function A4e(){return null}var B_e=typeof reportError=="function"?reportError:function(e){console.error(e)};function AK(e){this._internalRoot=e}kz.prototype.render=AK.prototype.render=function(e){var t=this._internalRoot;if(t===null)throw Error(ke(409));Fz(e,t,null,null)};kz.prototype.unmount=AK.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var t=e.containerInfo;eT(function(){Fz(null,e,null,null)}),t[n0]=null}};function kz(e){this._internalRoot=e}kz.prototype.unstable_scheduleHydration=function(e){if(e){var t=vve();e={blockedOn:null,target:e,priority:t};for(var r=0;r<w_.length&&t!==0&&t<w_[r].priority;r++);w_.splice(r,0,e),r===0&&bve(e)}};function RK(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function Uz(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11&&(e.nodeType!==8||e.nodeValue!==" react-mount-point-unstable "))}function koe(){}function R4e(e,t,r,i,s){if(s){if(typeof i=="function"){var n=i;i=function(){var c=rU(o);n.call(c)}}var o=z_e(t,i,e,0,null,!1,!1,"",koe);return e._reactRootContainer=o,e[n0]=o.current,GP(e.nodeType===8?e.parentNode:e),eT(),o}for(;s=e.lastChild;)e.removeChild(s);if(typeof i=="function"){var a=i;i=function(){var c=rU(l);a.call(c)}}var l=EK(e,0,!1,null,null,!1,!1,"",koe);return e._reactRootContainer=l,e[n0]=l.current,GP(e.nodeType===8?e.parentNode:e),eT(function(){Fz(t,l,r,i)}),l}function Vz(e,t,r,i,s){var n=r._reactRootContainer;if(n){var o=n;if(typeof s=="function"){var a=s;s=function(){var l=rU(o);a.call(l)}}Fz(t,o,e,s)}else o=R4e(r,t,e,s,i);return rU(o)}gve=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var r=lM(t.pendingLanes);r!==0&&(WJ(t,r|1),Jc(t,Ln()),(di&6)===0&&(UC=Ln()+500,X1()))}break;case 13:eT(function(){var i=o0(e,1);if(i!==null){var s=Ql();hf(i,e,1,s)}}),CK(e,1)}};XJ=function(e){if(e.tag===13){var t=o0(e,134217728);if(t!==null){var r=Ql();hf(t,e,134217728,r)}CK(e,134217728)}};yve=function(e){if(e.tag===13){var t=s1(e),r=o0(e,t);if(r!==null){var i=Ql();hf(r,e,t,i)}CK(e,t)}};vve=function(){return Ui};_ve=function(e,t){var r=Ui;try{return Ui=e,t()}finally{Ui=r}};zH=function(e,t,r){switch(t){case"input":if(LH(e,r),t=r.name,r.type==="radio"&&t!=null){for(r=e;r.parentNode;)r=r.parentNode;for(r=r.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<r.length;t++){var i=r[t];if(i!==e&&i.form===e.form){var s=Mz(i);if(!s)throw Error(ke(90));Y0e(i),LH(i,s)}}}break;case"textarea":J0e(e,r);break;case"select":t=r.value,t!=null&&YE(e,!!r.multiple,t,!1)}};nve=wK;ove=eT;var O4e={usingClientEntryPoint:!1,Events:[L$,yE,Mz,ive,sve,wK]},BR={findFiberByHostInstance:hx,bundleType:0,version:"18.2.0",rendererPackageName:"react-dom"},M4e={bundleType:BR.bundleType,version:BR.version,rendererPackageName:BR.rendererPackageName,rendererConfig:BR.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:T0.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return e=cve(e),e===null?null:e.stateNode},findFiberByHostInstance:BR.findFiberByHostInstance||A4e,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.2.0-next-9e3b772b8-20220608"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var fD=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!fD.isDisabled&&fD.supportsFiber)try{Cz=fD.inject(M4e),Um=fD}catch{}}Sh.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=O4e;Sh.createPortal=function(e,t){var r=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!RK(t))throw Error(ke(200));return C4e(e,t,null,r)};Sh.createRoot=function(e,t){if(!RK(e))throw Error(ke(299));var r=!1,i="",s=B_e;return t!=null&&(t.unstable_strictMode===!0&&(r=!0),t.identifierPrefix!==void 0&&(i=t.identifierPrefix),t.onRecoverableError!==void 0&&(s=t.onRecoverableError)),t=EK(e,1,!1,null,null,r,!1,i,s),e[n0]=t.current,GP(e.nodeType===8?e.parentNode:e),new AK(t)};Sh.findDOMNode=function(e){if(e==null)return null;if(e.nodeType===1)return e;var t=e._reactInternals;if(t===void 0)throw typeof e.render=="function"?Error(ke(188)):(e=Object.keys(e).join(","),Error(ke(268,e)));return e=cve(t),e=e===null?null:e.stateNode,e};Sh.flushSync=function(e){return eT(e)};Sh.hydrate=function(e,t,r){if(!Uz(t))throw Error(ke(200));return Vz(null,e,t,!0,r)};Sh.hydrateRoot=function(e,t,r){if(!RK(e))throw Error(ke(405));var i=r!=null&&r.hydratedSources||null,s=!1,n="",o=B_e;if(r!=null&&(r.unstable_strictMode===!0&&(s=!0),r.identifierPrefix!==void 0&&(n=r.identifierPrefix),r.onRecoverableError!==void 0&&(o=r.onRecoverableError)),t=z_e(t,null,e,1,r!=null?r:null,s,!1,n,o),e[n0]=t.current,GP(e),i)for(e=0;e<i.length;e++)r=i[e],s=r._getVersion,s=s(r._source),t.mutableSourceEagerHydrationData==null?t.mutableSourceEagerHydrationData=[r,s]:t.mutableSourceEagerHydrationData.push(r,s);return new kz(t)};Sh.render=function(e,t,r){if(!Uz(t))throw Error(ke(200));return Vz(null,e,t,!1,r)};Sh.unmountComponentAtNode=function(e){if(!Uz(e))throw Error(ke(40));return e._reactRootContainer?(eT(function(){Vz(null,null,e,!1,function(){e._reactRootContainer=null,e[n0]=null})}),!0):!1};Sh.unstable_batchedUpdates=wK;Sh.unstable_renderSubtreeIntoContainer=function(e,t,r,i){if(!Uz(r))throw Error(ke(200));if(e==null||e._reactInternals===void 0)throw Error(ke(38));return Vz(e,t,r,!1,i)};Sh.version="18.2.0-next-9e3b772b8-20220608";(function(e){function t(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(t)}catch(r){console.error(r)}}t(),e.exports=Sh})(z0e);var Uoe=z0e.exports;AH.createRoot=Uoe.createRoot,AH.hydrateRoot=Uoe.hydrateRoot;function u(e,t,r,i){var s,n=arguments.length,o=n<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,r):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(e,t,r,i);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(n<3?s(o):n>3?s(t,r,o):s(t,r))||o);return n>3&&o&&Object.defineProperty(t,r,o),o}const P4e="modulepreload",I4e=function(e,t){return new URL(e,t).href},Voe={},ie=function(t,r,i){return!r||r.length===0?t():Promise.all(r.map(s=>{if(s=I4e(s,i),s in Voe)return;Voe[s]=!0;const n=s.endsWith(".css"),o=n?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${s}"]${o}`))return;const a=document.createElement("link");if(a.rel=n?"stylesheet":P4e,n||(a.as="script",a.crossOrigin=""),a.href=s,document.head.appendChild(a),n)return new Promise((l,c)=>{a.addEventListener("load",l),a.addEventListener("error",()=>c(new Error(`Unable to preload CSS for ${s}`)))})})).then(()=>t())};function $4e(e){return e&&e.release&&typeof e.release=="function"}function L4e(e){return e&&e.acquire&&typeof e.acquire=="function"}class Ls{constructor(t,r,i,s=1,n=0){if(this.ctor=t,this.acquireFunction=r,this.releaseFunction=i,this.allocationSize=s,this._pool=new Array(n),this._initialSize=n,this.ctor)for(let o=0;o<n;o++)this._pool[o]=new this.ctor;this.allocationSize=Math.max(s,1)}destroy(){this.prune(0)}acquire(...t){let r;if(Ls.test.disabled)r=new this.ctor;else{if(this._pool.length===0){const i=this.allocationSize;for(let s=0;s<i;s++)this._pool[s]=new this.ctor}r=this._pool.pop()}return this.acquireFunction?this.acquireFunction(r,...t):L4e(r)&&r.acquire(...t),r}release(t){t&&!Ls.test.disabled&&(this.releaseFunction?this.releaseFunction(t):$4e(t)&&t.release(),this._pool.push(t))}prune(t=this._initialSize){if(!(t>=this._pool.length)){for(let r=t;r<this._pool.length;++r){const i=this._pool[r];this._dispose(i)}this._pool.length=t}}_dispose(t){t.dispose&&typeof t.dispose=="function"&&t.dispose()}}Ls.test={disabled:!1};function D4e(e){e.length=0}class Uc{constructor(t=50,r=50){this._pool=new Ls(Array,void 0,D4e,r,t)}acquire(){return this._pool.acquire()}release(t){this._pool.release(t)}prune(){this._pool.prune(0)}static acquire(){return T9.acquire()}static release(t){return T9.release(t)}static prune(){T9.prune()}}const T9=new Uc(100);function jPt(e){const t=[];return function*(){yield*t;for(const r of e)t.push(r),yield r}}function HPt(e,t){for(const r of e)if(r!=null&&t(r))return r}function G_e(e){return e!=null&&typeof e[Symbol.iterator]=="function"}const Xb=null;function b(e){return e!=null}function R(e){return e==null}function mn(e,t){return b(e)?t(e):Xb}function qPt(e){return e}function N4e(e,t){if(R(e))throw new Error(t);return e}function _t(e,t){return b(e)?e:typeof t=="function"?t():t}function WPt(e,t){return b(e)?e:t}function ct(e){return b(e)&&e.destroy(),null}function Ye(e){return b(e)&&e.dispose(),null}function wn(e){return b(e)&&e.remove(),null}function Fd(e){return b(e)&&e.abort(),null}function ti(e){return b(e)&&e.release(),null}function F4e(e,t,r){return b(e)&&b(t)?b(r)?r(e,t):e.equals(t):e===t}function k4e(e){return null}function XPt(e,t){const r=new Array;return e.forEach(i=>{const s=t(i);b(s)&&r.push(s)}),r}function ZPt(e,t){const r=new Array;for(const i of e)r.push(Xu(i,null,t));return r}function YPt(e,t){for(const r of e)mn(r,t)}function Xu(e,t,r){return b(e)?r(e):t}function QPt(e){return e.filter(t=>b(t))}function ki(e,...t){let r=e;for(let i=0;i<t.length&&r;++i)r=r[t[i]];return r}function JPt(e){return e}function VC(e){return kd(()=>e.forEach(t=>b(t)&&t.remove()))}function kd(e){return{remove:()=>{e&&(e(),e=void 0)}}}function KPt(e){return kd(b(e)?()=>e.destroy():void 0)}function U4e(e,t){const r=setTimeout(e,t);return kd(()=>clearTimeout(r))}class gd{constructor(t=1){this._seed=t}set seed(t){this._seed=t==null?Math.random()*gd._m:t}getInt(){return this._seed=(gd._a*this._seed+gd._c)%gd._m,this._seed}getFloat(){return this.getInt()/(gd._m-1)}getIntRange(t,r){return Math.round(this.getFloatRange(t,r))}getFloatRange(t,r){const i=r-t;return t+this.getInt()/gd._m*i}}gd._m=2147483647,gd._a=48271,gd._c=0;function N$(e,t){return t?e.filter((r,i,s)=>s.findIndex(t.bind(null,r))===i):e.filter((r,i,s)=>s.indexOf(r)===i)}function x1(e,t,r){if(R(e)&&R(t))return!0;if(R(e)||R(t)||e.length!==t.length)return!1;if(r){for(let i=0;i<e.length;i++)if(!r(e[i],t[i]))return!1}else for(let i=0;i<e.length;i++)if(e[i]!==t[i])return!1;return!0}function OK(e,t){let r=e.length!==t.length;e.length=t.length;for(let i=0;i<t.length;++i)e[i]!==t[i]&&(e[i]=t[i],r=!0);return r}function V4e(e,t,r){let i,s;return r?(i=t.filter(n=>!e.some(o=>r(o,n))),s=e.filter(n=>!t.some(o=>r(o,n)))):(i=t.filter(n=>!e.includes(n)),s=e.filter(n=>!t.includes(n))),{added:i,removed:s}}function z4e(e){return e&&typeof e.length=="number"}function B4e(e,t){const r=e.length;if(r===0)return[];const i=[];for(let s=0;s<r;s+=t)i.push(e.slice(s,s+t));return i}const G4e=!!Array.prototype.fill;function eIt(e,t){if(G4e)return new Array(e).fill(t);const r=new Array(e);for(let i=0;i<e;i++)r[i]=t;return r}function j4e(e,t){t===void 0&&(t=e,e=0);const r=new Array(t-e);for(let i=e;i<t;i++)r[i-e]=i;return r}function j_e(e,t,r){const i=e.length;let s=0,n=i-1;for(;s<n;){const a=s+Math.floor((n-s)/2);t>e[a]?s=a+1:n=a}const o=e[s];return r?t>=e[i-1]?-1:o===t?s:s-1:o===t?s:-1}function H_e(e){return e.reduce((t,r)=>t.concat(r||[]),[])}class q_e{constructor(){this.last=0}}const W_e=new q_e;function X_e(e,t,r,i){i=i||W_e;const s=Math.max(0,i.last-10);for(let o=s;o<r;++o)if(e[o]===t)return i.last=o,o;const n=Math.min(s,r);for(let o=0;o<n;++o)if(e[o]===t)return i.last=o,o;return-1}function zz(e,t,r,i){const s=r==null?e.length:r,n=X_e(e,t,s,i);if(n!==-1)return e[n]=e[s-1],r==null&&e.pop(),t}const tp=new Set;function H4e(e,t,r=e.length,i=t.length,s,n){if(i===0||r===0)return r;tp.clear();for(let a=0;a<i;++a)tp.add(t[a]);s=s||W_e;const o=Math.max(0,s.last-10);for(let a=o;a<r;++a)if(tp.has(e[a])&&(n&&n.push(e[a]),tp.delete(e[a]),e[a]=e[r-1],--r,--a,tp.size===0||r===0))return tp.clear(),r;for(let a=0;a<o;++a)if(tp.has(e[a])&&(n&&n.push(e[a]),tp.delete(e[a]),e[a]=e[r-1],--r,--a,tp.size===0||r===0))return tp.clear(),r;return tp.clear(),r}function q4e(e){return e?(zoe.seed=e,()=>zoe.getFloat()):Math.random}function tIt(e,t){const r=q4e(t);for(let i=e.length-1;i>0;i--){const s=Math.floor(r()*(i+1)),n=e[i];e[i]=e[s],e[s]=n}return e}const zoe=new gd;function MK(e,t){const r=e.indexOf(t);return r!==-1?(e.splice(r,1),t):null}let $_;function he(e){return typeof $_[e]=="function"?$_[e]=$_[e](globalThis):$_[e]}var E0e,C0e,A0e,R0e;$_=((E0e=globalThis.dojoConfig)==null?void 0:E0e.has)||((C0e=globalThis.esriConfig)==null?void 0:C0e.has)?{...(A0e=globalThis.dojoConfig)==null?void 0:A0e.has,...(R0e=globalThis.esriConfig)==null?void 0:R0e.has}:{},he.add=(e,t,r,i)=>((i||$_[e]===void 0)&&($_[e]=t),r&&he(e)),he.cache=$_,he.add("esri-deprecation-warnings",!0),(()=>{var t;he.add("host-webworker",globalThis.WorkerGlobalScope!==void 0&&self instanceof globalThis.WorkerGlobalScope);const e=typeof window<"u"&&typeof location<"u"&&typeof document<"u"&&window.location===location&&window.document===document;if(he.add("host-browser",e),he.add("host-node",typeof globalThis.process=="object"&&((t=globalThis.process.versions)==null?void 0:t.node)&&globalThis.process.versions.v8),he.add("dom",e),he("host-browser")){const r=navigator,i=r.userAgent,s=r.appVersion,n=parseFloat(s);if(he.add("wp",parseFloat(i.split("Windows Phone")[1])||void 0),he.add("msapp",parseFloat(i.split("MSAppHost/")[1])||void 0),he.add("khtml",s.includes("Konqueror")?n:void 0),he.add("edge",parseFloat(i.split("Edge/")[1])||void 0),he.add("opr",parseFloat(i.split("OPR/")[1])||void 0),he.add("webkit",!he("wp")&&!he("edge")&&parseFloat(i.split("WebKit/")[1])||void 0),he.add("chrome",!he("edge")&&!he("opr")&&parseFloat(i.split("Chrome/")[1])||void 0),he.add("android",!he("wp")&&parseFloat(i.split("Android ")[1])||void 0),he.add("safari",!s.includes("Safari")||he("wp")||he("chrome")||he("android")||he("edge")||he("opr")?void 0:parseFloat(s.split("Version/")[1])),he.add("mac",s.includes("Macintosh")),!he("wp")&&i.match(/(iPhone|iPod|iPad)/)){const o=RegExp.$1.replace(/P/,"p"),a=i.match(/OS ([\d_]+)/)?RegExp.$1:"1",l=parseFloat(a.replace(/_/,".").replace(/_/g,""));he.add(o,l),he.add("ios",l)}he.add("trident",parseFloat(s.split("Trident/")[1])||void 0),he("webkit")||(!i.includes("Gecko")||he("wp")||he("khtml")||he("trident")||he("edge")||he.add("mozilla",n),he("mozilla")&&he.add("ff",parseFloat(i.split("Firefox/")[1]||i.split("Minefield/")[1])||void 0))}})(),(()=>{if(globalThis.navigator){const e=navigator.userAgent,t=/Android|webOS|iPhone|iPad|iPod|BlackBerry|Opera Mini|IEMobile/i.test(e),r=/iPhone/i.test(e);t&&he.add("esri-mobile",t),r&&he.add("esri-iPhone",r),he.add("esri-geolocation",!!navigator.geolocation)}he.add("esri-canvas-svg-support",!he("trident")),he.add("esri-wasm","WebAssembly"in globalThis),he.add("esri-shared-array-buffer",()=>{const e="SharedArrayBuffer"in globalThis,t=globalThis.crossOriginIsolated===!1;return e&&!t}),he.add("wasm-simd",()=>{const e=[0,97,115,109,1,0,0,0,1,5,1,96,0,1,123,3,2,1,0,10,10,1,8,0,65,0,253,15,253,98,11];return WebAssembly.validate(new Uint8Array(e))}),he.add("esri-atomics","Atomics"in globalThis),he.add("esri-workers","Worker"in globalThis),he.add("web-feat:cache","caches"in globalThis),he.add("esri-workers-arraybuffer-transfer",!he("safari")||Number(he("safari"))>=12),he.add("featurelayer-simplify-thresholds",[.5,.5,.5,.5]),he.add("featurelayer-simplify-payload-size-factors",[1,1,4]),he.add("featurelayer-snapshot-enabled",!0),he.add("featurelayer-snapshot-point-min-threshold",8e4),he.add("featurelayer-snapshot-point-max-threshold",4e5),he.add("featurelayer-snapshot-point-coverage",.1),he.add("featurelayer-advanced-symbols",!1),he.add("featurelayer-pbf",!0),he.add("featurelayer-pbf-statistics",!1),he.add("feature-layers-workers",!0),he.add("feature-polyline-generalization-factor",1),he.add("mapview-transitions-duration",200),he.add("mapview-srswitch-adjust-rotation-scale-threshold",24e6),he.add("mapserver-pbf-enabled",!1),he.add("mapimagelayer-popup-identify-max-tolerance",20),he.add("heatmap-allow-raster-fallback",!0),he.add("heatmap-force-raster",!1),he("host-webworker")||he("host-browser")&&(he.add("esri-csp-restrictions",()=>{try{new Function}catch{return!0}return!1}),he.add("esri-image-decode",()=>{if("decode"in new Image){const e=new Image;return e.src='data:image/svg+xml;charset=UTF-8,<svg version="1.1" xmlns="http://www.w3.org/2000/svg"></svg>',void e.decode().then(()=>{he.add("esri-image-decode",!0,!0,!0)}).catch(()=>{he.add("esri-image-decode",!1,!0,!0)})}return!1}),he.add("esri-url-encodes-apostrophe",()=>{const e=window.document.createElement("a");return e.href="?'",e.href.includes("?%27")}))})();function W4e(e,t){if(e.forEach)e.forEach(t);else for(let r=0;r<e.length;r++)t(e[r],r,e)}function PK(e,t,r){if(e.slice)return e.slice(t,r);t===void 0?t=0:(t<0&&(t+=e.length),t=Math.min(e.length,Math.max(0,t))),r===void 0?r=e.length:(r<0&&(r+=e.length),r=Math.min(e.length,Math.max(0,r)));const i=Math.max(0,r-t),s=new e.constructor(i);for(let n=0;n<i;n++)s[n]=e[t+n];return s}function GR(e){return e instanceof ArrayBuffer||e&&e.constructor&&e.constructor.name==="ArrayBuffer"}function X4e(e){return e instanceof Int8Array||e&&e.constructor&&e.constructor.name==="Int8Array"}function jw(e){return e instanceof Uint8Array||e&&e.constructor&&e.constructor.name==="Uint8Array"}function Z4e(e){return e instanceof Uint8ClampedArray||e&&e.constructor&&e.constructor.name==="Uint8ClampedArray"}function Z_e(e){return e instanceof Int16Array||e&&e.constructor&&e.constructor.name==="Int16Array"}function iU(e){return e instanceof Uint16Array||e&&e.constructor&&e.constructor.name==="Uint16Array"}function Y_e(e){return e instanceof Int32Array||e&&e.constructor&&e.constructor.name==="Int32Array"}function sU(e){return e instanceof Uint32Array||e&&e.constructor&&e.constructor.name==="Uint32Array"}function Q_e(e){return e instanceof Float32Array||e&&e.constructor&&e.constructor.name==="Float32Array"}function J_e(e){return e instanceof Float64Array||e&&e.constructor&&e.constructor.name==="Float64Array"}function Y4e(e){const t=new Array(e.length);for(let r=0;r<e.length;r++)t[r]=e[r];return t}function mD(e){return R(e)?0:128+e.buffer.byteLength+64}function K_e(e,t){let r;if(t)for(r in e)e.hasOwnProperty(r)&&(e[r]===void 0?delete e[r]:e[r]instanceof Object&&K_e(e[r],!0));else for(r in e)e.hasOwnProperty(r)&&e[r]===void 0&&delete e[r];return e}function re(e){if(!e||typeof e!="object"||typeof e=="function")return e;const t=i1e(e);if(b(t))return t;if(e1e(e))return e.clone();if(t1e(e))return e.map(re);if(r1e(e))return e.clone();const r={};for(const i of Object.getOwnPropertyNames(e))r[i]=re(e[i]);return r}function bq(e){if(!e||typeof e!="object"||typeof e=="function")return e;const t=i1e(e);if(b(t))return t;if(t1e(e)){let r=!0;const i=e.map(s=>{const n=bq(s);return s!=null&&n==null&&(r=!1),n});return r?i:null}if(e1e(e))return e.clone();if(!r1e(e)){const r=new(Object.getPrototypeOf(e)).constructor;for(const i of Object.getOwnPropertyNames(e)){const s=e[i],n=bq(s);if(s!=null&&n==null)return null;r[i]=n}return r}return null}function e1e(e){return typeof e.clone=="function"}function t1e(e){return typeof e.map=="function"&&typeof e.forEach=="function"}function r1e(e){return typeof e.notifyChange=="function"&&typeof e.watch=="function"}function Boe(e){if(Object.prototype.toString.call(e)!=="[object Object]")return!1;const t=Object.getPrototypeOf(e);return t===null||t===Object.prototype}function i1e(e){if(X4e(e)||jw(e)||Z4e(e)||Z_e(e)||iU(e)||Y_e(e)||sU(e)||Q_e(e)||J_e(e))return PK(e);if(e instanceof Date)return new Date(e.getTime());if(e instanceof ArrayBuffer)return e.slice(0,e.byteLength);if(e instanceof Map){const t=new Map;return e.forEach((r,i)=>{t.set(i,re(r))}),t}if(e instanceof Set){const t=new Set;return e.forEach(r=>{t.add(re(r))}),t}return null}function IK(e,t){return e===t||typeof e=="number"&&isNaN(e)&&typeof t=="number"&&isNaN(t)||typeof(e||{}).getTime=="function"&&typeof(t||{}).getTime=="function"&&e.getTime()===t.getTime()||!1}function Q4e(e,t){return e===t||(e==null||typeof e=="string"?e===t:typeof e=="number"?e===t||typeof t=="number"&&isNaN(e)&&isNaN(t):e instanceof Date?t instanceof Date&&e.getTime()===t.getTime():Array.isArray(e)?Array.isArray(t)&&x1(e,t):e instanceof Set?t instanceof Set&&K4e(e,t):e instanceof Map?t instanceof Map&&e5e(e,t):!!Boe(e)&&Boe(t)&&J4e(e,t))}function J4e(e,t){if(e===null||t===null)return!1;const r=Object.keys(e);if(t===null||Object.keys(t).length!==r.length)return!1;for(const i of r)if(e[i]!==t[i]||!Object.prototype.hasOwnProperty.call(t,i))return!1;return!0}function K4e(e,t){if(e.size!==t.size)return!1;for(const r of e)if(!t.has(r))return!1;return!0}function e5e(e,t){if(e.size!==t.size)return!1;for(const[r,i]of e){const s=t.get(r);if(s!==i||s===void 0&&!t.has(r))return!1}return!0}function Pa(e){return e?e.__accessor__?e.__accessor__:e.propertyInvalidated?e:null:null}function t5e(e,t){return e!=null&&e.metadatas&&e.metadatas[t]!=null}function O4(e,t,r){return r?nU(e,t,{policy:r,path:""}):nU(e,t,null)}function nU(e,t,r){return t?Object.keys(t).reduce((i,s)=>{let n=null,o="merge";if(r&&(n=r.path?`${r.path}.${s}`:s,o=r.policy(n)),o==="replace")return i[s]=t[s],i;if(i[s]===void 0)return i[s]=re(t[s]),i;let a=i[s],l=t[s];if(a===l)return i;if(Array.isArray(l)||Array.isArray(i))a=a?Array.isArray(a)?i[s]=a.concat():i[s]=[a]:i[s]=[],l&&(Array.isArray(l)||(l=[l]),l.forEach(c=>{a.includes(c)||a.push(c)}));else if(l&&typeof l=="object")if(r){const c=r.path;r.path=n,i[s]=nU(a,l,r),r.path=c}else i[s]=nU(a,l,null);else i.hasOwnProperty(s)&&!t.hasOwnProperty(s)||(i[s]=l);return i},e||{}):e}function s1e(e){return Array.isArray(e)?e:e.split(".")}function Goe(e){return e.includes(",")?e.split(",").map(t=>t.trim()):[e.trim()]}function r5e(e){if(Array.isArray(e)){const t=[];for(const r of e)t.push(...Goe(r));return t}return Goe(e)}function n1e(e,t,r,i){const s=r5e(t);if(s.length!==1){const n=s.map(o=>i(e,o,r));return VC(n)}return i(e,s[0],r)}function $K(e){let t=!1;return()=>{t||(t=!0,e())}}function o1e(e,t){const r=e[e.length-1]==="?"?e.slice(0,-1):e;if(t.getItemAt!=null||Array.isArray(t)){const s=parseInt(r,10);if(!isNaN(s))return Array.isArray(t)?t[s]:t.getItemAt(s)}const i=Pa(t);return t5e(i,r)?i.get(r):t[r]}function a1e(e,t,r){if(e==null)return e;const i=o1e(t[r],e);return!i&&r<t.length-1?void 0:r===t.length-1?i:a1e(i,t,r+1)}function F$(e,t,r=0){return typeof t!="string"||t.includes(".")?a1e(e,s1e(t),r):o1e(t,e)}function oU(e,t){return F$(e,t)}function joe(e,t){return F$(t,e)!==void 0}var Pm;(function(e){e[e.INITIALIZING=0]="INITIALIZING",e[e.CONSTRUCTING=1]="CONSTRUCTING",e[e.CONSTRUCTED=2]="CONSTRUCTED"})(Pm||(Pm={}));class Hoe{constructor(t){this.autoDestroy=!1,this.properties=t}}function k$(e){let t=e.constructor.__accessorMetadata__;const r=Object.prototype.hasOwnProperty.call(e.constructor,"__accessorMetadata__");if(t){if(!r){const i=Object.create(t.properties),s=t.autoDestroy;for(const n in i)i[n]=re(i[n]);t=new Hoe(i),t.autoDestroy=s,Object.defineProperty(e.constructor,"__accessorMetadata__",{value:t,enumerable:!1,configurable:!0,writable:!0})}}else t=new Hoe({}),Object.defineProperty(e.constructor,"__accessorMetadata__",{value:t,enumerable:!1,configurable:!0,writable:!0});return e.constructor.__accessorMetadata__}function i5e(e){return k$(e).properties}function U$(e,t){const r=i5e(e);let i=r[t];return i||(i=r[t]={}),i}function s5e(e,t){return O4(e,t,o5e)}const n5e=/^(?:[^.]+\.)?(?:value|type|(?:json\.type|json\.origins\.[^.]\.type))$/;function o5e(e){return n5e.test(e)?"replace":"merge"}function l1e(e,t,r=!1){return u1e(e,t,r)}function rR(e,t){if(t!=null)return t[e]||c1e(e.split("."),!1,t)}function ru(e,t,r){const i=e.split("."),s=i.pop(),n=c1e(i,!0,r);n&&s&&(n[s]=t)}function c1e(e,t,r){let i=r;for(const s of e){if(i==null)return;if(!(s in i)){if(!t)return;i[s]={}}i=i[s]}return i}function u1e(e,t,r){return t?Object.keys(t).reduce((i,s)=>{let n=i[s],o=t[s];return n===o?i:n===void 0?(i[s]=re(o),i):(Array.isArray(o)||Array.isArray(i)?(n=n?Array.isArray(n)?i[s]=n.concat():i[s]=[n]:i[s]=[],o&&(Array.isArray(o)||(o=[o]),r?o.forEach(a=>{n.includes(a)||n.push(a)}):i[s]=o.concat())):o&&typeof o=="object"?i[s]=u1e(n,o,r):i.hasOwnProperty(s)&&!t.hasOwnProperty(s)||(i[s]=o),i)},e||{}):e}var O0e;const Ur={apiKey:void 0,applicationUrl:(O0e=globalThis.location)==null?void 0:O0e.href,assetsPath:"",fontsUrl:"https://static.arcgis.com/fonts",geometryServiceUrl:"https://utility.arcgisonline.com/arcgis/rest/services/Geometry/GeometryServer",geoRSSServiceUrl:"https://utility.arcgis.com/sharing/rss",kmlServiceUrl:"https://utility.arcgis.com/sharing/kml",portalUrl:"https://www.arcgis.com",routeServiceUrl:"https://route-api.arcgis.com/arcgis/rest/services/World/Route/NAServer/Route_World",workers:{loaderConfig:{has:{},paths:{},map:{},packages:[]}},request:{crossOriginNoCorsDomains:null,httpsDomains:["arcgis.com","arcgisonline.com","esrikr.com","premiumservices.blackbridge.com","esripremium.accuweather.com","gbm.digitalglobe.com","firstlook.digitalglobe.com","msi.digitalglobe.com"],interceptors:[],maxUrlLength:2e3,priority:"high",proxyRules:[],proxyUrl:null,timeout:6e4,trustedServers:[],useIdentity:!0},log:{interceptors:[],level:null}};if(globalThis.esriConfig&&(l1e(Ur,globalThis.esriConfig,!0),delete Ur.has),!Ur.assetsPath){const e="4.24.7";Ur.assetsPath=`https://js.arcgis.com/${e.slice(0,-2)}/@arcgis/core/assets`}Ur.baseUrl&&console.warn("[esri.config]","baseUrl has been replaced by assetsPath"),Object.defineProperty(Ur,"baseUrl",{set(){console.warn("[esri.config]","baseUrl has been replaced by assetsPath")}}),Ur.request.corsEnabledServers=[],Ur.request.corsEnabledServers.push=function(){return console.warn("[esri.config]","request.corsEnabledServers is not supported and will be removed in a future release. See http://esriurl.com/cors8664"),0};const a5e=/\{([^\}]+)\}/g;function qoe(e){return e==null?"":e}function Zm(e,t){return e.replace(a5e,typeof t=="object"?(r,i)=>qoe(rR(i,t)):(r,i)=>qoe(t(i)))}function h1e(e,t){return e.replace(/([\.$?*|{}\(\)\[\]\\\/\+\-^])/g,r=>t&&t.includes(r)?r:`\\${r}`)}function LK(e){let t=0;for(let r=0;r<e.length;r++)t=(t<<5)-t+e.charCodeAt(r),t|=0;return t}function rIt(e){return new DOMParser().parseFromString(e||"","text/html").body.innerText||""}const Woe={info:0,warn:1,error:2,none:3};class fe{constructor(t){this.level=null,this._module="",this._parent=null,this.writer=null,this._loggedMessages={error:new Map,warn:new Map,info:new Map},t.level!=null&&(this.level=t.level),t.writer!=null&&(this.writer=t.writer),this._module=t.module,fe._loggers[this.module]=this;const r=this.module.lastIndexOf(".");r!==-1&&(this._parent=fe.getLogger(this.module.slice(0,r)))}get module(){return this._module}get parent(){return this._parent}error(...t){this._log("error","always",...t)}warn(...t){this._log("warn","always",...t)}info(...t){this._log("info","always",...t)}errorOnce(...t){this._log("error","once",...t)}warnOnce(...t){this._log("warn","once",...t)}infoOnce(...t){this._log("info","once",...t)}errorOncePerTick(...t){this._log("error","oncePerTick",...t)}warnOncePerTick(...t){this._log("warn","oncePerTick",...t)}infoOncePerTick(...t){this._log("info","oncePerTick",...t)}get test(){const t=this;return{loggedMessages:t._loggedMessages,clearLoggedWarnings:()=>t._loggedMessages.warn.clear()}}static get testSingleton(){return{resetLoggers(t={}){const r=fe._loggers;return fe._loggers=t,r},set throttlingDisabled(t){fe._throttlingDisabled=t}}}static getLogger(t){let r=fe._loggers[t];return r||(r=new fe({module:t})),r}_log(t,r,...i){if(!!this._matchLevel(t)){if(r!=="always"&&!fe._throttlingDisabled){const s=this._argsToKey(i),n=this._loggedMessages[t].get(s);if(r==="once"&&n!=null||r==="oncePerTick"&&n&&n>=fe._tickCounter)return;this._loggedMessages[t].set(s,fe._tickCounter),fe._scheduleTickCounterIncrement()}for(const s of Ur.log.interceptors)if(s(t,this.module,...i))return;this._inheritedWriter()(t,this.module,...i)}}_parentWithMember(t,r){let i=this;for(;b(i);){const s=i[t];if(b(s))return s;i=i.parent}return r}_inheritedWriter(){return this._parentWithMember("writer",this._consoleWriter)}_consoleWriter(t,r,...i){console[t](`[${r}]`,...i)}_matchLevel(t){const r=Ur.log.level?Ur.log.level:"warn";return Woe[this._parentWithMember("level",r)]<=Woe[t]}_argsToKey(...t){const r=(i,s)=>typeof s!="object"||Array.isArray(s)?s:"[Object]";return LK(JSON.stringify(t,r))}static _scheduleTickCounterIncrement(){fe._tickCounterScheduled||(fe._tickCounterScheduled=!0,Promise.resolve().then(()=>{fe._tickCounter++,fe._tickCounterScheduled=!1}))}}fe._loggers={},fe._tickCounter=0,fe._tickCounterScheduled=!1,fe._throttlingDisabled=!1;var Bt;(function(e){e[e.DEFAULTS=0]="DEFAULTS",e[e.COMPUTED=1]="COMPUTED",e[e.SERVICE=2]="SERVICE",e[e.PORTAL_ITEM=3]="PORTAL_ITEM",e[e.WEB_SCENE=4]="WEB_SCENE",e[e.WEB_MAP=5]="WEB_MAP",e[e.USER=6]="USER"})(Bt||(Bt={}));const wq=Bt.USER+1;function Dy(e){switch(e){case"defaults":return Bt.DEFAULTS;case"service":return Bt.SERVICE;case"portal-item":return Bt.PORTAL_ITEM;case"web-scene":return Bt.WEB_SCENE;case"web-map":return Bt.WEB_MAP;case"user":return Bt.USER}}function aU(e){switch(e){case Bt.DEFAULTS:return"defaults";case Bt.SERVICE:return"service";case Bt.PORTAL_ITEM:return"portal-item";case Bt.WEB_SCENE:return"web-scene";case Bt.WEB_MAP:return"web-map";case Bt.USER:return"user"}return void 0}function l5e(e){return aU(e)}var xi;(function(e){e[e.Dirty=1]="Dirty",e[e.Overriden=2]="Overriden",e[e.Computing=4]="Computing",e[e.NonNullable=8]="NonNullable",e[e.HasDefaultValue=16]="HasDefaultValue",e[e.DepTrackingInitialized=32]="DepTrackingInitialized",e[e.AutoTracked=64]="AutoTracked",e[e.ExplicitlyTracking=128]="ExplicitlyTracking"})(xi||(xi={}));let lU,uM=[];const c5e=fe.getLogger("esri.core.Accessor");function ir(e){lU!==void 0&&lU.onObservableAccessed(e)}let M4=!1,P4=!1;function l0(e,t,r){if(M4)return DK(e,t,r);d1e(e);const i=t.call(r);return p1e(),i}function u5e(e,t){return l0(void 0,e,t)}function DK(e,t,r){const i=M4;M4=!0,d1e(e);let s=null;try{s=t.call(r)}catch(n){P4&&c5e.error(n)}return p1e(),M4=i,s}function d1e(e){lU=e,uM.push(e)}function p1e(){const e=uM.pop();lU=uM.length>0?uM[uM.length-1]:void 0,e!==void 0&&e.onTrackingEnd()}function f1e(e,t){if(t.flags&xi.DepTrackingInitialized)return;const r=P4;P4=!1,t.flags&xi.AutoTracked?DK(t,t.metadata.get,e):m1e(e,t),P4=r}const h5e=[];function m1e(e,t){t.flags&xi.ExplicitlyTracking||(t.flags|=xi.ExplicitlyTracking,DK(t,()=>{const r=t.metadata.dependsOn||h5e;for(const i of r)if(typeof i!="string"||i.includes(".")){const s=s1e(i);for(let n=0,o=e;n<s.length&&o!=null&&typeof o=="object";++n)o=Xoe(o,s[n],n!==s.length-1)}else Xoe(e,i,!1)}),t.flags&=~xi.ExplicitlyTracking)}function Xoe(e,t,r){var n;const i=t[t.length-1]==="?"?t.slice(0,-1):t;if(e.getItemAt!=null||Array.isArray(e)){const o=parseInt(i,10);if(!isNaN(o))return Array.isArray(e)?e[o]:e.getItemAt(o)}const s=(n=Pa(e))==null?void 0:n.properties.get(i);return s&&(ir(s),f1e(e,s)),r?e[i]:void 0}class g1e{constructor(t,r){this._observers=t,this._observer=r}remove(){MK(this._observers,this._observer)}}class Zoe{constructor(t,r,i){this.properties=t,this.propertyName=r,this.metadata=i,this._observers=null,this._accessed=null,this._handles=null,this.flags=xi.Dirty|(i.nonNullable?xi.NonNullable:0)|(i.hasOwnProperty("value")?xi.HasDefaultValue:0)|(i.get===void 0?xi.DepTrackingInitialized:0)|(i.dependsOn===void 0?xi.AutoTracked:0)}destroy(){if(this.flags&xi.Dirty&&this._observers){const t=this._observers.slice();for(const r of t)r.onCommitted()}this._accessed=null,this._observers=null,this._clearObservationHandles()}getComputed(){ir(this);const t=this.properties.store,r=this.propertyName,i=this.flags,s=t.get(r);if(i&xi.Computing||~i&xi.Dirty&&t.has(r))return s;this.flags|=xi.Computing;const n=this.properties.host;let o;i&xi.AutoTracked?o=l0(this,this.metadata.get,n):(m1e(n,this),o=this.metadata.get.call(n)),t.set(r,o,Bt.COMPUTED);const a=t.get(r);return a===s?this.flags&=~xi.Dirty:u5e(this.commit,this),this.flags&=~xi.Computing,a}onObservableAccessed(t){t!==this&&(this._accessed===null&&(this._accessed=[]),this._accessed.includes(t)||this._accessed.push(t))}onTrackingEnd(){this._clearObservationHandles(),this.flags|=xi.DepTrackingInitialized;const t=this._accessed;if(t===null)return;let r=this._handles;r===null&&(r=this._handles=[]);for(let i=0;i<t.length;++i)r.push(t[i].observe(this));t.length=0}observe(t){return this._observers===null&&(this._observers=[]),this._observers.includes(t)||this._observers.push(t),new g1e(this._observers,t)}notifyChange(){this.onInvalidated(),this.onCommitted()}invalidate(){this.onInvalidated()}onInvalidated(){~this.flags&xi.Overriden&&(this.flags|=xi.Dirty);const t=this._observers;if(t!==null)for(let r=0;r<t.length;++r)t[r].onInvalidated()}commit(){this.flags&=~xi.Dirty,this.onCommitted()}onCommitted(){if(this._observers===null)return;const t=this._observers.slice();for(let r=0;r<t.length;++r)t[r].onCommitted()}_clearObservationHandles(){const t=this._handles;if(t!==null){for(let r=0;r<t.length;++r)t[r].remove();t.length=0}}}class NK{constructor(){this._values=new Map,this.multipleOriginsSupported=!1}clone(t){const r=new NK;return this._values.forEach((i,s)=>{t&&t.has(s)||r.set(s,re(i))}),r}get(t){return this._values.get(t)}originOf(){return Bt.USER}keys(){return[...this._values.keys()]}set(t,r){this._values.set(t,r)}delete(t){this._values.delete(t)}has(t){return this._values.has(t)}forEach(t){this._values.forEach(t)}}function gD(e,t,r){return e!==void 0}function Yoe(e,t,r,i){return e!==void 0&&(!(r==null&&e.flags&xi.NonNullable)||(i.lifecycle,Pm.INITIALIZING,!1))}function d5e(e){return e&&typeof e.destroy=="function"}fe.getLogger("esri.core.accessorSupport.Properties");class p5e{constructor(t){this.host=t,this.properties=new Map,this.ctorArgs=null,this.destroyed=!1,this.lifecycle=Pm.INITIALIZING,this.store=new NK,this._origin=Bt.USER;const r=this.host.constructor.__accessorMetadata__,i=r.properties;for(const s in i){const n=new Zoe(this,s,i[s]);this.properties.set(s,n)}this.metadatas=i,this._autoDestroy=r.autoDestroy}initialize(){this.lifecycle=Pm.CONSTRUCTING}constructed(){this.lifecycle=Pm.CONSTRUCTED}destroy(){if(this.destroyed=!0,this._autoDestroy)for(const[t,r]of this.properties){const i=this.internalGet(t);i&&d5e(i)&&(i.destroy(),~r.flags&xi.NonNullable&&this._internalSet(r,null)),r.destroy()}else for(const[t,r]of this.properties)r.destroy()}get initialized(){return this.lifecycle!==Pm.INITIALIZING}get(t){const r=this.properties.get(t);if(r.metadata.get)return r.getComputed();ir(r);const i=this.store;return i.has(t)?i.get(t):r.metadata.value}originOf(t){const r=this.store.originOf(t);if(r===void 0){const i=this.properties.get(t);if(i!==void 0&&i.flags&xi.HasDefaultValue)return"defaults"}return aU(r)}has(t){return!!this.properties.has(t)&&this.store.has(t)}keys(){return[...this.properties.keys()]}internalGet(t){const r=this.properties.get(t);if(gD(r))return this.store.has(t)?this.store.get(t):r.metadata.value}internalSet(t,r){const i=this.properties.get(t);gD(i)&&this._internalSet(i,r)}getDependsInfo(t,r,i){const s=this.properties.get(r);if(!gD(s))return"";const n=new Set,o=l0({onObservableAccessed:l=>n.add(l),onTrackingEnd:()=>{}},()=>{var l;return(l=s.metadata.get)==null?void 0:l.call(t)});let a=`${i}${t.declaredClass.split(".").pop()}.${r}: ${o}
`;if(n.size===0)return a;i+="  ";for(const l of n){if(!(l instanceof Zoe))continue;const c=l.properties.host,h=l.propertyName,p=Pa(c);a+=p?p.getDependsInfo(c,h,i):`${i}${h}: undefined
`}return a}setAtOrigin(t,r,i){const s=this.properties.get(t);if(gD(s))return this._setAtOrigin(s,r,i)}isOverridden(t){const r=this.properties.get(t);return r!==void 0&&!!(r.flags&xi.Overriden)}clearOverride(t){const r=this.properties.get(t);r!==void 0&&r.flags&xi.Overriden&&(r.flags&=~xi.Overriden,r.notifyChange())}override(t,r){const i=this.properties.get(t);if(!Yoe(i,t,r,this))return;const s=i.metadata.cast;if(s){const n=this._cast(s,r),{valid:o,value:a}=n;if(S9.release(n),!o)return;r=a}i.flags|=xi.Overriden,this._internalSet(i,r)}set(t,r){const i=this.properties.get(t);if(!Yoe(i,t,r,this))return;const s=i.metadata.cast;if(s){const o=this._cast(s,r),{valid:a,value:l}=o;if(S9.release(o),!a)return;r=l}const n=i.metadata.set;n?n.call(this.host,r):this._internalSet(i,r)}setDefaultOrigin(t){this._origin=Dy(t)}getDefaultOrigin(){return aU(this._origin)}notifyChange(t){const r=this.properties.get(t);r!==void 0&&r.notifyChange()}invalidate(t){const r=this.properties.get(t);r!==void 0&&r.invalidate()}commit(t){const r=this.properties.get(t);r!==void 0&&r.commit()}_internalSet(t,r){const i=this.lifecycle!==Pm.INITIALIZING?this._origin:Bt.DEFAULTS;this._setAtOrigin(t,r,i)}_setAtOrigin(t,r,i){const s=this.store,n=t.propertyName;s.has(n,i)&&IK(r,s.get(n))&&~t.flags&xi.Overriden&&i===s.originOf(n)||(t.invalidate(),s.set(n,r,i),t.commit(),f1e(this.host,t))}_cast(t,r){const i=S9.acquire();return i.valid=!0,i.value=r,t&&(i.value=t.call(this.host,r,i)),i}}class f5e{constructor(){this.value=null,this.valid=!0}acquire(){this.valid=!0}release(){this.value=null}}const S9=new Ls(f5e);function m5e(e,t){return e.replace(/\$\{([^\s\:\}]*)(?:\:([^\s\:\}]+))?\}/g,(r,i)=>{if(i==="")return"$";const s=rR(i,t),n=s==null?"":s;if(n===void 0)throw new Error(`could not find key "${i}" in template`);return n.toString()})}class Bz{constructor(t,r,i){this.name=t,this.details=i,this.message=void 0,this instanceof Bz&&(this.message=r&&m5e(r,i)||"")}toString(){return"["+this.name+"]: "+this.message}}class j extends Bz{constructor(t,r,i){if(super(t,r,i),!(this instanceof j))return new j(t,r,i)}toJSON(){if(this.details!=null)try{return{name:this.name,message:this.message,details:JSON.parse(JSON.stringify(this.details,(t,r)=>{if(r&&typeof r=="object"&&typeof r.toJSON=="function")return r;try{return re(r)}catch{return"[object]"}}))}}catch(t){throw fe.getLogger("esri.core.Error").error(t),t}return{name:this.name,message:this.message,details:this.details}}static fromJSON(t){return new j(t.name,t.message,t.details)}}j.prototype.type="error";function cU(e,t,r){if(e&&t)if(typeof t=="object")for(const i of Object.getOwnPropertyNames(t))cU(e,i,t[i]);else{if(t.includes(".")){const s=t.split("."),n=s.splice(s.length-1,1)[0];return void cU(oU(e,s),n,r)}const i=e.__accessor__;i!=null&&g5e(t,i),e[t]=r}}function g5e(e,t){if(he("esri-unknown-property-errors")&&!y5e(e,t))throw new j("set:unknown-property",v5e(e,t))}function y5e(e,t){return t.metadatas[e]!=null}function v5e(e,t){return"setting unknown property '"+e+"' on instance of "+t.host.declaredClass}fe.getLogger("esri.core.accessorSupport.set");class y1e extends Ls{constructor(){super(...arguments),this._set=new Set}destroy(){super.destroy(),this._set=k4e(this._set)}acquire(...t){const r=super.acquire(...t);return this._set.delete(r),r}release(t){t&&!this._set.has(t)&&(super.release(t),this._set.add(t))}_dispose(t){this._set.delete(t),super._dispose(t)}}const yD=[];function zC(e){yD.push(e),yD.length===1&&queueMicrotask(()=>{const t=yD.slice();yD.length=0;for(const r of t)r()})}const _5e=29;class o1{constructor(t,r=_5e){this.name=t,this._counter=0,this._items=new Array(r)}record(t){this._items[++this._counter%this._items.length]=t}get median(){return this._items.slice().sort((t,r)=>t-r)[Math.floor(this._items.length/2)]}get average(){return this._items.reduce((t,r)=>t+r,0)/this._items.length}get last(){return this._items[this._counter%this._items.length]}}var xq;(function(e){const t=(n,o,a,l)=>{let c=o,h=o;const p=a>>>1,f=n[c-1];for(;h<=p;){h=c<<1,h<a&&l(n[h-1],n[h])<0&&++h;const m=n[h-1];if(l(m,f)<=0)break;n[c-1]=m,c=h}n[c-1]=f},r=(n,o)=>n<o?-1:n>o?1:0;function i(n,o,a,l){o===void 0&&(o=0),a===void 0&&(a=n.length),l===void 0&&(l=r);for(let h=a>>>1;h>o;h--)t(n,h,a,l);const c=o+1;for(let h=a-1;h>o;h--){const p=n[o];n[o]=n[h],n[h]=p,t(n,c,h,l)}}function*s(n,o,a,l){o===void 0&&(o=0),a===void 0&&(a=n.length),l===void 0&&(l=r);for(let h=a>>>1;h>o;h--)t(n,h,a,l),yield;const c=o+1;for(let h=a-1;h>o;h--){const p=n[o];n[o]=n[h],n[h]=p,t(n,c,h,l),yield}}e.sort=i,e.iterableSort=s})(xq||(xq={}));const Qoe=xq,b5e=1.5,w5e=1.1;class Xt{constructor(t){this.data=[],this._length=0,this._allocator=void 0,this._deallocator=()=>null,this._shrink=()=>{},this._hint=new q_e,t&&(t.initialSize&&(this.data=new Array(t.initialSize)),t.allocator&&(this._allocator=t.allocator),t.deallocator!==void 0&&(this._deallocator=t.deallocator),t.shrink&&(this._shrink=()=>Joe(this)))}toArray(){return this.data.slice(0,this.length)}filter(t){const r=new Array;for(let i=0;i<this._length;i++){const s=this.data[i];t(s)&&r.push(s)}return r}getItemAt(t){if(!(t<0||t>=this._length))return this.data[t]}includes(t,r){const i=this.data.indexOf(t,r);return i!==-1&&i<this.length}get length(){return this._length}set length(t){if(t>this._length){if(this._allocator){for(;this._length<t;)this.data[this._length++]=this._allocator(this.data[this._length]);return}this._length=t}else{if(this._deallocator)for(let r=t;r<this._length;++r)this.data[r]=this._deallocator(this.data[r]);this._length=t,this._shrink()}}clear(){this.length=0}prune(){this.clear(),this.data=[]}push(t){this.data[this._length++]=t}pushArray(t,r=t.length){for(let i=0;i<r;i++)this.data[this._length++]=t[i]}fill(t,r){for(let i=0;i<r;i++)this.data[this._length++]=t}pushNew(){this._allocator&&(this.data[this.length]=this._allocator(this.data[this.length]));const t=this.data[this._length];return++this._length,t}unshift(t){this.data.unshift(t),this._length++,Joe(this)}pop(){if(this.length===0)return;const t=this.data[this.length-1];return this.length=this.length-1,this._shrink(),t}remove(t){const r=X_e(this.data,t,this.length,this._hint);if(r!==-1)return this.data.splice(r,1),this.length=this.length-1,t}removeUnordered(t){const r=zz(this.data,t,this.length,this._hint);return r!==void 0&&(this.length=this.length-1),this._shrink(),r}removeUnorderedIndex(t){if(!(t>=this.length||t<0))return this.swapElements(t,this.length-1),this.pop()}removeUnorderedMany(t,r=t.length,i){this.length=H4e(this.data,t,this.length,r,this._hint,i),this._shrink()}front(){if(this.length!==0)return this.data[0]}back(){if(this.length!==0)return this.data[this.length-1]}swapElements(t,r){t>=this.length||r>=this.length||t===r||([this.data[t],this.data[r]]=[this.data[r],this.data[t]])}sort(t){Qoe.sort(this.data,0,this.length,t)}iterableSort(t){return Qoe.iterableSort(this.data,0,this.length,t)}some(t,r){for(let i=0;i<this.length;++i)if(t.call(r,this.data[i],i,this.data))return!0;return!1}filterInPlace(t,r){let i=0;for(let s=0;s<this._length;++s){const n=this.data[s];t.call(r,n,s,this.data)&&(this.data[s]=this.data[i],this.data[i]=n,i++)}if(this._deallocator)for(let s=i;s<this._length;s++)this.data[s]=this._deallocator(this.data[s]);return this._length=i,this._shrink(),this}forAll(t,r){const i=this.length,s=this.data;for(let n=0;n<i;++n)t.call(r,s[n],n,s)}forEach(t,r){for(let i=0;i<this.length;++i)t.call(r,this.data[i],i,this.data)}map(t,r){const i=new Array(this.length);for(let s=0;s<this.length;++s)i[s]=t.call(r,this.data[s],s,this.data);return i}reduce(t,r){let i=r;for(let s=0;s<this.length;++s)i=t(i,this.data[s],s,this.data);return i}has(t){const r=this.length,i=this.data;for(let s=0;s<r;++s)if(i[s]===t)return!0;return!1}}function Joe(e){e.data.length>b5e*e.length&&(e.data.length=Math.floor(e.length*w5e))}function x5e(e){return{setTimeout:(t,r)=>{const i=e.setTimeout(t,r);return{remove:()=>e.clearTimeout(i)}}}}const Gz=x5e(globalThis),Koe=new Set;function T5e(e,t,r=!1){r&&Koe.has(t)||(r&&Koe.add(t),e.warn(`\u{1F6D1} DEPRECATED - ${t}`))}function S5e(e,t,r={}){if(he("esri-deprecation-warnings")){const{moduleName:i}=r;v1e(e,`Property: ${(i?i+"::":"")+t}`,r)}}function v1e(e,t,r={}){if(he("esri-deprecation-warnings")){const{replacement:i,version:s,see:n,warnOnce:o}=r;let a=t;i&&(a+=`
	\u{1F6E0}\uFE0F Replacement: ${i}`),s&&(a+=`
	\u2699\uFE0F Version: ${s}`),n&&(a+=`
	\u{1F517} See ${n} for more details.`),T5e(e,a,o)}}function jz(e){return e&&(typeof e.on=="function"||typeof e.addEventListener=="function")}function V$(e,t,r){if(!jz(e))throw new TypeError("target is not a Evented or EventTarget object");if("on"in e)return e.on(t,r);if(Array.isArray(t)){const i=t.slice();for(const s of i)e.addEventListener(s,r);return{remove(){for(const s of i)e.removeEventListener(s,r)}}}return e.addEventListener(t,r),{remove(){e.removeEventListener(t,r)}}}function _1e(e,t,r){if(!jz(e))throw new TypeError("target is not a Evented or EventTarget object");if("once"in e)return e.once(t,r);const i=V$(e,t,s=>{i.remove(),r.call(e,s)});return{remove(){i.remove()}}}const E5e={Win:"Meta",Scroll:"ScrollLock",Spacebar:" ",Down:"ArrowDown",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Del:"Delete",Apps:"ContextMenu",Esc:"Escape",Multiply:"*",Add:"+",Subtract:"-",Decimal:".",Divide:"/"};function Hw({key:e}){return E5e[e]||e}function gr(e="Aborted"){return new j("AbortError",e)}function Jt(e,t="Aborted"){if(gn(e))throw gr(t)}function Hz(e){return b(e)?"aborted"in e?e:e.signal:e}function gn(e){const t=Hz(e);return b(t)&&t.aborted}function ah(e){if(Vi(e))throw e}function Tq(e){if(!Vi(e))throw e}function Ia(e,t){const r=Hz(e);if(!R(r)){if(!r.aborted)return _1e(r,"abort",()=>t());t()}}function FK(e,t){const r=Hz(e);if(!R(r))return Jt(r),_1e(r,"abort",()=>t(gr()))}function C5e(e,t){const r=Hz(t);return R(r)?e:new Promise((i,s)=>{let n=Ia(t,()=>s(gr()));const o=()=>n=wn(n);e.then(o,o),e.then(i,s)})}function Vi(e){return e&&e.name==="AbortError"}async function Sq(e){try{return await e}catch(t){if(!Vi(t))throw t}}async function iIt(e,t=fe.getLogger("esri")){try{return await e}catch(r){Vi(r)||t.error(r)}}function T1(){let e=null;const t=new Promise((r,i)=>{e={promise:void 0,resolve:r,reject:i}});return e.promise=t,e}async function xs(e){if(!e)return;if(typeof e.forEach!="function"){const r=Object.keys(e),i=r.map(o=>e[o]),s=await xs(i),n={};return r.map((o,a)=>n[o]=s[a]),n}const t=e;return new Promise(r=>{const i=[];let s=t.length;s===0&&r(i),t.forEach(n=>{const o={promise:n||Promise.resolve(n)};i.push(o),o.promise.then(a=>{o.value=a}).catch(a=>{o.error=a}).then(()=>{--s,s===0&&r(i)})})})}async function A5e(e){return(await xs(e)).filter(t=>!!t.value).map(t=>t.value)}function BC(e,t,r){const i=new AbortController;return Ia(r,()=>i.abort()),new Promise((s,n)=>{let o=setTimeout(()=>{o=0,s(t)},e);Ia(i,()=>{o&&(clearTimeout(o),n(gr()))})})}function Ch(e){return e&&typeof e.then=="function"}function Eq(e){return Ch(e)?e:Promise.resolve(e)}function z$(e,t=-1){let r,i,s,n,o=null;const a=(...l)=>{if(r){i=l,n&&n.reject(gr()),n=T1();const f=n.promise;if(o){const m=o;o=null,m.abort()}return f}if(s=n||T1(),n=null,t>0){const f=new AbortController;r=Eq(e(...l,f.signal));const m=r;BC(t).then(()=>{r===m&&(n?f.abort():o=f)})}else r=1,r=Eq(e(...l));const c=()=>{const f=i;i=s=r=o=null,f!=null&&a(...f)},h=r,p=s;return h.then(c,c),h.then(p.resolve,p.reject),p.promise};return a}function vf(){let e,t;const r=new Promise((s,n)=>{e=s,t=n}),i=s=>{e(s)};return i.resolve=s=>e(s),i.reject=s=>t(s),i.timeout=(s,n)=>Gz.setTimeout(()=>i.reject(n),s),i.promise=r,i}function sIt(e,t){return e.then(t,t)}function B$(e,t){let r,i=new AbortController;const s=e(i.signal);let n={promise:s,finished:!1,abort:()=>{i&&(i.abort(),i=null)}};const o=()=>{n&&(n.finished=!0,n=null),b(r)&&(r.remove(),r=null),i=null};return s.then(o,o),r=Ia(t,()=>{b(n)&&n.abort()}),n}async function eae(e){await Promise.resolve(),Jt(e)}function b1e(e){return 1e3*e}function kK(e){return .001*e}class R5e{constructor(t){this.phases=t,this.paused=!1,this.ticks=-1,this.removed=!1}}class O5e{constructor(t){this.callback=t,this.isActive=!0}remove(){this.isActive=!1}}let Cq=0,Aq=0;const jR={time:0,deltaTime:0,elapsedFrameTime:0,frameDuration:0},Rq=["prepare","preRender","render","postRender","update","finish"],Oq=[],tT=new Xt;class M5e{constructor(t){this._task=t}remove(){this._task.removed=!0}pause(){this._task.paused=!0}resume(){this._task.paused=!1}}const uU={frameTasks:tT,willDispatch:!1,clearFrameTasks:P5e,dispatch:T1e,executeFrameTasks:$5e};function iR(e){const t=new O5e(e);return Oq.push(t),uU.willDispatch||(uU.willDispatch=!0,zC(T1e)),t}function rT(e){const t=new R5e(e);return tT.push(t),hU==null&&(Cq=performance.now(),hU=requestAnimationFrame(w1e)),new M5e(t)}let hU=null;function P5e(e=!1){tT.forAll(t=>{t.removed=!0}),e&&x1e()}function I5e(e){Aq=Math.max(0,e)}function w1e(){const e=performance.now();hU=null,hU=tT.length>0?requestAnimationFrame(w1e):null,uU.executeFrameTasks(e)}function $5e(e){const t=e-Cq;Cq=e;const r=Aq>0?Aq:1e3/60,i=Math.max(0,t-r);for(let s=0;s<Rq.length;s++){const n=performance.now(),o=Rq[s];tT.forAll(a=>{var l;a.paused||a.removed||(s===0&&a.ticks++,a.phases[o]&&(jR.time=e,jR.deltaTime=a.ticks===0?0:t,jR.elapsedFrameTime=performance.now()-e,jR.frameDuration=r-i,(l=a.phases[o])==null||l.call(a,jR)))}),L5e[s].record(performance.now()-n)}x1e(),D5e.record(performance.now()-e)}const vD=new Xt;function x1e(){tT.forAll(e=>{e.removed&&vD.push(e)}),tT.removeUnorderedMany(vD.data,vD.length),vD.clear()}function T1e(){for(;Oq.length;){const e=Oq.shift();e.isActive&&e.callback()}uU.willDispatch=!1}function nIt(e=1,t){const r=vf(),i=()=>{gn(t)?r.reject(gr()):e===0?r():(--e,zC(()=>i()))};return i(),r.promise}const L5e=Rq.map(e=>new o1(e)),D5e=new o1("total");function I4(e,t){for(const r of e.entries())if(t(r[0]))return!0;return!1}let N5e=0;const F5e=0;function Jl(){return++N5e}class qz{constructor(t){this._notify=t,this._accessed=[],this._handles=[],this._invalidCount=0}destroy(){this._accessed.length=0,this.clear()}onInvalidated(){this._invalidCount++}onCommitted(){const t=this._invalidCount;if(t===1)return this._invalidCount=0,void this._notify();this._invalidCount=t>0?t-1:0}onObservableAccessed(t){this._accessed.includes(t)||this._accessed.push(t)}onTrackingEnd(){const t=this._handles,r=this._accessed;for(let i=0;i<r.length;++i)t.push(r[i].observe(this));r.length=0}clear(){const t=this._handles;for(let r=0;r<t.length;++r)t[r].remove();t.length=0}}let rC=!1;const dU=[];function S1e(e,t){let r=new qz(n),i=null,s=!1;function n(){if(!r||s)return;if(rC)return void A1e(n);const a=i;r.clear(),rC=!0,s=!0,i=l0(r,e),s=!1,rC=!1,t(i,a),R1e()}function o(){r&&(r.destroy(),r=null,i=null)}return s=!0,i=l0(r,e),s=!1,{remove:o}}function E1e(e,t){let r=new qz(s),i=null;function s(){t(i,o)}function n(){r&&(r.destroy(),r=null),i=null}function o(){return r?(r.clear(),i=l0(r,e),i):null}return o(),{remove:n}}function C1e(e){let t=new qz(i),r=!1;function i(){t&&!r&&(rC?A1e(i):(t.clear(),rC=!0,r=!0,l0(t,e),r=!1,rC=!1,R1e()))}function s(){t&&(t.destroy(),t=null)}return r=!0,l0(t,e),r=!1,{remove:s}}function A1e(e){dU.includes(e)||dU.unshift(e)}function R1e(){for(;dU.length;)dU.pop()()}var z3;(function(e){e[e.Untracked=0]="Untracked",e[e.Tracked=1]="Tracked"})(z3||(z3={}));class JP{constructor(){this.uid=Jl(),this.removed=!1,this.type=null,this.oldValue=null,this.callback=null,this.getValue=null,this.target=null,this.path=null,this.equals=null}static acquireUntracked(t,r,i,s,n){return this.pool.acquire(z3.Untracked,t,r,i,s,n,IK)}static acquireTracked(t,r,i,s){return this.pool.acquire(z3.Tracked,t,r,i,null,null,s)}notify(t,r){this.type===z3.Untracked?this.callback.call(this.target,t,r,this.path,this.target):this.callback.call(null,t,r)}acquire(t,r,i,s,n,o,a){this.uid=Jl(),this.removed=!1,this.type=t,this.oldValue=r,this.callback=i,this.getValue=s,this.target=n,this.path=o,this.equals=a}release(){this.target=this.path=this.oldValue=this.callback=this.getValue=null,this.uid=Jl(),this.removed=!0}}JP.pool=new y1e(JP);const $4=new Uc,Gy=new Set;let pU;function fU(e){Gy.delete(e),Gy.add(e),pU||(pU=iR(V5e))}function k5e(e){if(e.removed)return;const t=e.oldValue,r=e.getValue();e.equals(t,r)||(e.oldValue=r,e.notify(r,t))}function U5e(e){for(const t of Gy.values())t.target===e&&(t.removed=!0)}function V5e(){let e=10;for(;pU&&e--;){pU=null;const t=z5e(),r=$4.acquire();for(const i of t){const s=i.uid;k5e(i),s===i.uid&&i.removed&&r.push(i)}for(const i of Gy)i.removed&&(r.push(i),Gy.delete(i));for(const i of r)JP.pool.release(i);$4.release(r),$4.release(t),Mq.forEach(i=>i())}}function z5e(){const e=$4.acquire();e.length=Gy.size;let t=0;for(const r of Gy)e[t]=r,++t;return Gy.clear(),e}const Mq=new Set;function O1e(e){return Mq.add(e),{remove(){Mq.delete(e)}}}function B5e(e,t,r){let i=n1e(e,t,r,(s,n,o)=>{let a,l,c=E1e(()=>F$(s,n),(h,p)=>{s.__accessor__.destroyed||a&&a.uid!==l?i.remove():(a||(a=JP.acquireUntracked(h,o,p,s,n),l=a.uid),fU(a))});return{remove:$K(()=>{c.remove(),a&&(a.uid!==l||a.removed||(a.removed=!0,fU(a)),a=null),i=c=null})}});return i}function G5e(e,t,r){const i=n1e(e,t,r,(s,n,o)=>{let a=!1;return S1e(()=>F$(s,n),(l,c)=>{s.__accessor__.destroyed?i.remove():a||(a=!0,IK(c,l)||o.call(s,l,c,n,s),a=!1)})});return i}function j5e(e,t,r,i=!1){return!e.__accessor__||e.__accessor__.destroyed?{remove(){}}:i?G5e(e,t,r):B5e(e,t,r)}function H5e(e,t,r){let i,s,n=E1e(e,(o,a)=>{i&&i.uid!==s?n.remove():(i||(i=JP.acquireTracked(o,t,a,r),s=i.uid),fU(i))});return{remove:$K(()=>{n.remove(),i&&(i.uid!==s||i.removed||(i.removed=!0,fU(i)),i=null),n=null})}}function q5e(e,t,r){let i=!1;return S1e(e,(s,n)=>{i||(i=!0,r(n,s)||t(s,n),i=!1)})}function W5e(e,t,r=!1,i=Q4e){return r?q5e(e,t,i):H5e(e,t,i)}function tae(e){return I4(Gy,t=>t.oldValue===e)}function yn(e,t){for(const[r,i]of e)if(t(i,r))return!0;return!1}function oIt(e,t){for(const[r,i]of e)if(t(i,r))return i;return null}function UK(e,t,r){const i=e.get(t);if(i!==void 0)return i;const s=r();return e.set(t,s),s}const iC=fe.getLogger("esri.core.Accessor");function X5e(e){return e==null?e:new Date(e)}function Z5e(e){return e==null?e:!!e}function G$(e){return e==null?e:e.toString()}function yd(e){return e==null?e:(e=parseFloat(e),isNaN(e)?0:e)}function VK(e){return e==null?e:Math.round(parseFloat(e))}function M1e(e){return e&&e.constructor&&e.constructor.__accessorMetadata__!==void 0}function mU(e,t){return t!=null&&e&&!(t instanceof e)}function P1e(e){return e&&"isCollection"in e}function rae(e){return e&&e.Type?typeof e.Type=="function"?e.Type:e.Type.base:null}function Y5e(e,t){if(!t||!t.constructor||!P1e(t.constructor))return Pq(e,t)?t:new e(t);const r=rae(e.prototype.itemType),i=rae(t.constructor.prototype.itemType);return r?i?r===i?t:r.prototype.isPrototypeOf(i.prototype)?new e(t):(Pq(e,t),t):new e(t):t}function Pq(e,t){return!!M1e(t)&&(iC.error("Accessor#set","Assigning an instance of '"+(t.declaredClass||"unknown")+"' which is not a subclass of '"+Wz(e)+"'"),!0)}function GC(e,t){return t==null?t:P1e(e)?Y5e(e,t):mU(e,t)?Pq(e,t)?t:new e(t):t}function Wz(e){return e&&e.prototype&&e.prototype.declaredClass||"unknown"}const Q5e=new WeakMap;function J5e(e){switch(e){case Number:return yd;case Wi:return VK;case Boolean:return Z5e;case String:return G$;case Date:return X5e;default:return UK(Q5e,e,()=>GC.bind(null,e))}}function en(e,t){const r=J5e(e);return arguments.length===1?r:r(t)}function KP(e,t,r){return arguments.length===1?KP.bind(null,e):t&&(Array.isArray(t)?t.map(i=>e(i,r)):[e(t,r)])}function K5e(e,t){return arguments.length===1?KP(en.bind(null,e)):KP(en.bind(null,e),t)}function I1e(e,t,r){return t!==0&&Array.isArray(r)?r.map(i=>I1e(e,t-1,i)):e(r)}function gU(e,t,r){if(arguments.length===2)return gU.bind(null,e,t);if(!r)return r;let i=t,s=r=I1e(e,t,r);for(;i>0&&Array.isArray(s);)i--,s=s[0];if(s!==void 0)for(let n=0;n<i;n++)r=[r];return r}function eke(e,t,r){return arguments.length===2?gU(en.bind(null,e),t):gU(en.bind(null,e),t,r)}function $1e(e){return!!Array.isArray(e)&&!e.some(t=>{const r=typeof t;return!(r==="string"||r==="number"||r==="function"&&e.length>1)})}function Iq(e,t){if(arguments.length===2)return Iq(e).call(null,t);const r=new Set,i=e.filter(a=>typeof a!="function"),s=e.filter(a=>typeof a=="function");for(const a of e)typeof a!="string"&&typeof a!="number"||r.add(a);let n=null,o=null;return(a,l)=>{if(a==null)return a;const c=typeof a,h=c==="string"||c==="number";return h&&(r.has(a)||s.some(p=>c==="string"&&p===String||c==="number"&&p===Number))||c==="object"&&s.some(p=>!mU(a,p))?a:(h&&i.length?(n||(n=i.map(p=>typeof p=="string"?`'${p}'`:`${p}`).join(", ")),iC.error("Accessor#set",`'${a}' is not a valid value for this property, only the following values are valid: ${n}`)):typeof a=="object"&&s.length?(o||(o=s.map(p=>Wz(p)).join(", ")),iC.error("Accessor#set",`'${a}' is not a valid value for this property, value must be one of ${o}`)):iC.error("Accessor#set",`'${a}' is not a valid value for this property`),l&&(l.valid=!1),null)}}function _f(e,t){if(arguments.length===2)return _f(e).call(null,t);const r={},i=[],s=[];for(const l in e.typeMap){const c=e.typeMap[l];r[l]=en(c),i.push(Wz(c)),s.push(l)}const n=()=>`'${i.join("', '")}'`,o=()=>`'${s.join("', '")}'`,a=typeof e.key=="string"?l=>l[e.key]:e.key;return l=>{if(e.base&&!mU(e.base,l)||l==null)return l;const c=a(l)||e.defaultKeyValue,h=r[c];if(!h)return iC.error("Accessor#set",`Invalid property value, value needs to be one of ${n()}, or a plain object that can autocast (having .type = ${o()})`),null;if(!mU(e.typeMap[c],l))return l;if(typeof e.key=="string"&&!M1e(l)){const p={};for(const f in l)f!==e.key&&(p[f]=l[f]);return h(p)}return h(l)}}class Wi{}const aIt={native:e=>({type:"native",value:e}),array:e=>({type:"array",value:e}),oneOf:e=>({type:"one-of",values:e})};function tke(e){if(!e||!("type"in e))return!1;switch(e.type){case"native":case"array":case"one-of":return!0}return!1}function L1e(e){switch(e.type){case"native":return en(e.value);case"array":return KP(L1e(e.value));case"one-of":return rke(e);default:return null}}function rke(e){let t=null;return(r,i)=>Lq(r,e)?r:(t==null&&(t=$q(e)),iC.error("Accessor#set",`Invalid property value, value needs to be of type ${t}`),i&&(i.valid=!1),null)}function $q(e){switch(e.type){case"native":switch(e.value){case Number:return"number";case String:return"string";case Boolean:return"boolean";case Wi:return"integer";case Date:return"date";default:return Wz(e.value)}case"array":return`array of ${$q(e.value)}`;case"one-of":{const t=e.values.map(r=>$q(r));return`one of ${t.slice(0,t.length-1)} or ${t[t.length-1]}`}}return"unknown"}function Lq(e,t){if(e==null)return!0;switch(t.type){case"native":switch(t.value){case Number:case Wi:return typeof e=="number";case Boolean:return typeof e=="boolean";case String:return typeof e=="string"}return e instanceof t.value;case"array":return!!Array.isArray(e)&&!e.some(r=>!Lq(r,t.value));case"one-of":return t.values.some(r=>Lq(e,r))}}function d(e={}){return(t,r)=>{if(t===Function.prototype)throw new Error(`Inappropriate use of @property() on a static field: ${t.name}.${r}. Accessor does not support static properties.`);const i=Object.getOwnPropertyDescriptor(t,r),s=U$(t,r);i&&(i.get||i.set?(s.get=i.get||s.get,s.set=i.set||s.set):"value"in i&&("value"in e&&fe.getLogger("esri.core.accessorSupport.decorators.property").warn(`@property() will redefine the value of "${r}" on "${t.constructor.name}" already defined in the metadata`,e),s.value=e.value=i.value)),e.readOnly!=null&&(s.readOnly=e.readOnly);const n=e.aliasOf;if(n){const l=typeof n=="string"?n:n.source,c=typeof n=="string"?null:n.overridable===!0;let h;s.dependsOn=[l],s.get=function(){let p=oU(this,l);if(typeof p=="function"){h||(h=l.split(".").slice(0,-1).join("."));const f=oU(this,h);f&&(p=p.bind(f))}return p},s.readOnly||(s.set=c?function(p){p!==void 0?this._override(r,p):this._clearOverride(r)}:function(p){cU(this,l,p)})}const o=e.type,a=e.types;s.cast||(o?s.cast=ike(o):a&&(Array.isArray(a)?s.cast=KP(_f(a[0])):s.cast=_f(a))),e.range&&(s.cast=ske(s.cast,e.range)),s5e(s,e)}}function zK(e,t,r){const i=U$(e,r);i.json||(i.json={});let s=i.json;return t!==void 0&&(s.origins||(s.origins={}),s.origins[t]||(s.origins[t]={}),s=s.origins[t]),s}function ike(e){let t=0,r=e;if(tke(e))return L1e(e);for(;Array.isArray(r)&&r.length===1&&typeof r[0]!="string"&&typeof r[0]!="number";)r=r[0],t++;const i=r;if($1e(i))return t===0?Iq(i):gU(Iq(i),t);if(t===1)return K5e(i);if(t>1)return eke(i,t);const s=e;return s.from?s.from:en(s)}function ske(e,t){return r=>{let i=+e(r);return t.step!=null&&(i=Math.round(i/t.step)*t.step),t.min!=null&&(i=Math.max(t.min,i)),t.max!=null&&(i=Math.min(t.max,i)),i}}function nke(e){if(e.json&&e.json.origins){const t=e.json.origins,r={"web-document":["web-scene","web-map"]};for(const i in r)if(t[i]){const s=t[i];r[i].forEach(n=>{t[n]=s}),delete t[i]}}}class ic extends Bz{constructor(t,r,i){if(super(t,r,i),!(this instanceof ic))return new ic(t,r,i)}}ic.prototype.type="warning";function D1e(e){return!!e&&e.prototype&&e.prototype.declaredClass&&e.prototype.declaredClass.indexOf("esri.core.Collection")===0}const Dq=fe.getLogger("esri.core.accessorSupport.extensions.serializableProperty.reader");function iae(e,t,r){var i,s;e&&(!r&&!t.read||((i=t.read)==null?void 0:i.reader)||((s=t.read)==null?void 0:s.enabled)===!1||lke(e)&&ru("read.reader",sR(e),t))}function sR(e){var r,i,s;const t=(r=e.ndimArray)!=null?r:0;if(t>1)return ake(e);if(t===1)return sae(e);if("type"in e&&F1e(e.type)){const n=(s=(i=e.type.prototype)==null?void 0:i.itemType)==null?void 0:s.Type,o=sae(typeof n=="function"?{type:n}:{types:n});return(a,l,c)=>{const h=o(a,l,c);return h&&new e.type(h)}}return BK(e)}function BK(e){return"type"in e?oke(e.type):cke(e.types)}function oke(e){return e.prototype.read?(t,r,i)=>{if(t==null)return t;const s=typeof t;if(s!=="object")return void Dq.error(`Expected JSON value of type 'object' to deserialize type '${e.prototype.declaredClass}', but got '${s}'`);const n=new e;return n.read(t,i),n}:e.fromJSON}function N1e(e,t,r,i){return i!==0&&Array.isArray(t)?t.map(s=>N1e(e,s,r,i-1)):e(t,void 0,r)}function ake(e){var s;const t=BK(e),r=N1e.bind(null,t),i=(s=e.ndimArray)!=null?s:0;return(n,o,a)=>{if(n==null)return n;n=r(n,a,i);let l=i,c=n;for(;l>0&&Array.isArray(c);)l--,c=c[0];if(c!==void 0)for(let h=0;h<l;h++)n=[n];return n}}function sae(e){const t=BK(e);return(r,i,s)=>{if(r==null)return r;if(Array.isArray(r)){const o=[];for(const a of r){const l=t(a,void 0,s);l!==void 0&&o.push(l)}return o}const n=t(r,void 0,s);return n!==void 0?[n]:void 0}}function F1e(e){if(!D1e(e))return!1;const t=e.prototype.itemType;return!(!t||!t.Type)&&(typeof t.Type=="function"?GK(t.Type):k1e(t.Type))}function lke(e){return"types"in e?k1e(e.types):GK(e.type)}function GK(e){return!Array.isArray(e)&&!!e&&e.prototype&&("read"in e.prototype||"fromJSON"in e||F1e(e))}function k1e(e){for(const t in e.typeMap)if(!GK(e.typeMap[t]))return!1;return!0}function cke(e){var i;let t=null;const r=(i=e.errorContext)!=null?i:"type";return(s,n,o)=>{if(s==null)return s;const a=typeof s;if(a!=="object")return void Dq.error(`Expected JSON value of type 'object' to deserialize, but got '${a}'`);t||(t=uke(e));const l=e.key;if(typeof l!="string")return;const c=s[l],h=c?t[c]:e.defaultKeyValue?e.typeMap[e.defaultKeyValue]:void 0;if(!h){const f=`Type '${c||"unknown"}' is not supported`;return o&&o.messages&&s&&o.messages.push(new ic(`${r}:unsupported`,f,{definition:s,context:o})),void Dq.error(f)}const p=new h;return p.read(s,o),p}}function uke(e){var r,i;const t={};for(const s in e.typeMap){const n=e.typeMap[s],o=k$(n.prototype);if(typeof e.key=="function")continue;const a=o.properties[e.key];if(!a)continue;((r=a.json)==null?void 0:r.type)&&Array.isArray(a.json.type)&&a.json.type.length===1&&typeof a.json.type[0]=="string"&&(t[a.json.type[0]]=n);const l=(i=a.json)==null?void 0:i.write;if(!l||!l.writer){t[s]=n;continue}const c=l.target,h=typeof c=="string"?c:e.key,p={};l.writer(s,p,h),p[h]&&(t[p[h]]=n)}return t}function hke(e){if(e.json||(e.json={}),oae(e.json),aae(e.json),nae(e.json),e.json.origins)for(const t in e.json.origins)oae(e.json.origins[t]),aae(e.json.origins[t]),nae(e.json.origins[t]);return!0}function nae(e){e.name&&(e.read&&typeof e.read=="object"?e.read.source===void 0&&(e.read.source=e.name):e.read={source:e.name},e.write&&typeof e.write=="object"?e.write.target===void 0&&(e.write.target=e.name):e.write={target:e.name})}function oae(e){typeof e.read=="boolean"?e.read={enabled:e.read}:typeof e.read=="function"?e.read={enabled:!0,reader:e.read}:e.read&&typeof e.read=="object"&&e.read.enabled===void 0&&(e.read.enabled=!0)}function aae(e){typeof e.write=="boolean"?e.write={enabled:e.write}:typeof e.write=="function"?e.write={enabled:!0,writer:e.write}:e.write&&typeof e.write=="object"&&e.write.enabled===void 0&&(e.write.enabled=!0)}const dke=fe.getLogger("esri.core.accessorSupport.extensions.serializableProperty.writer");function lae(e,t){var i;if(!t.write||t.write.writer||t.write.enabled===!1&&!t.write.overridePolicy)return;const r=(i=e==null?void 0:e.ndimArray)!=null?i:0;e&&(r===1||"type"in e&&D1e(e.type))?t.write.writer=mke:r>1?t.write.writer=gke(r):t.types?Array.isArray(t.types)?t.write.writer=fke(t.types[0]):t.write.writer=pke(t.types):t.write.writer=eI}function pke(e){return(t,r,i,s)=>t?U1e(t,e,s)?eI(t,r,i,s):void 0:eI(t,r,i,s)}function U1e(e,t,r){var i,s;for(const n in t.typeMap)if(e instanceof t.typeMap[n])return!0;if(r!=null&&r.messages){const n=(i=t.errorContext)!=null?i:"type",o=`Values of type '${(s=typeof t.key!="function"?e[t.key]:e.declaredClass)!=null?s:"Unknown"}' cannot be written`;r&&r.messages&&e&&r.messages.push(new j(`${n}:unsupported`,o,{definition:e,context:r})),dke.error(o)}return!1}function fke(e){return(t,r,i,s)=>!t||!Array.isArray(t)?eI(t,r,i,s):eI(t.filter(n=>U1e(n,e,s)),r,i,s)}function eI(e,t,r,i){ru(r,yU(e,i),t)}function yU(e,t){return e&&typeof e.write=="function"?e.write({},t):e&&typeof e.toJSON=="function"?e.toJSON():typeof e=="number"?vU(e):e}function vU(e){return e===-1/0?-Number.MAX_VALUE:e===1/0?Number.MAX_VALUE:isNaN(e)?null:e}function mke(e,t,r,i){let s;e===null?s=null:e&&typeof e.map=="function"?(s=e.map(n=>yU(n,i)),typeof s.toArray=="function"&&(s=s.toArray())):s=[yU(e,i)],ru(r,s,t)}function V1e(e,t,r){return r!==0&&Array.isArray(e)?e.map(i=>V1e(i,t,r-1)):yU(e,t)}function gke(e){return(t,r,i,s)=>{let n;if(t===null)n=null;else{n=V1e(t,s,e);let o=e,a=n;for(;o>0&&Array.isArray(a);)o--,a=a[0];if(a!==void 0)for(let l=0;l<o;l++)n=[n]}ru(i,n,r)}}function Nq(e,t){return jK(e,"read",t)}function z1e(e,t){return jK(e,"write",t)}function jK(e,t,r){let i=e&&e.json;if(e&&e.json&&e.json.origins&&r){const s=e.json.origins[r.origin];s&&(t==="any"||t in s)&&(i=s)}return i}function yke(e){const t=vke(e);if(e.json.origins)for(const r in e.json.origins){const i=e.json.origins[r],s=i.types?_ke(i):t;iae(s,i,!1),i.types&&!i.write&&e.json.write&&e.json.write.enabled&&(i.write={...e.json.write}),lae(s,i)}iae(t,e.json,!0),lae(t,e.json)}function vke(e){return e.json.types?Fq(e.json):e.type?B1e(e):Fq(e)}function _ke(e){return e.type?B1e(e):Fq(e)}function B1e(e){if(!e.type)return;let t=0,r=e.type;for(;Array.isArray(r)&&!$1e(r);)r=r[0],t++;return{type:r,ndimArray:t}}function Fq(e){if(!e.types)return;let t=0,r=e.types;for(;Array.isArray(r);)r=r[0],t++;return{types:r,ndimArray:t}}function bke(e){hke(e)&&(nke(e),yke(e))}const E9=new Set,C9=new Set;function $(e){return t=>{t.prototype.declaredClass=e,xke(t);const r=[],i=[];let s=t.prototype;for(;s;)s.hasOwnProperty("initialize")&&!E9.has(s.initialize)&&(E9.add(s.initialize),r.push(s.initialize)),s.hasOwnProperty("destroy")&&!C9.has(s.destroy)&&(C9.add(s.destroy),i.push(s.destroy)),s=Object.getPrototypeOf(s);E9.clear(),C9.clear();class n extends t{constructor(...a){if(super(...a),this.constructor===n&&typeof this.postscript=="function"){if(r.length&&Object.defineProperty(this,"initialize",{enumerable:!1,configurable:!0,value(){for(let l=r.length-1;l>=0;l--)r[l].call(this)}}),i.length){let l=!1;Object.defineProperty(this,"destroy",{enumerable:!1,configurable:!0,value(){if(!l){l=!0;for(let c=0;c<i.length;c++)i[c].call(this)}}})}this.postscript(...a)}}}return n.__accessorMetadata__=k$(t.prototype),n.prototype.declaredClass=e,n}}function wke(e,t){return t.get==null?function(){const r=this.__accessor__.properties.get(e);if(r===void 0)return;ir(r);const i=this.__accessor__.store;return i.has(e)?i.get(e):r.metadata.value}:function(){const r=this.__accessor__.properties.get(e);if(r!==void 0)return r.getComputed()}}function xke(e){const t=e.prototype,r=k$(t).properties,i={};for(const s of Object.getOwnPropertyNames(r)){const n=r[s];bke(n),i[s]={enumerable:!0,configurable:!0,get:wke(s,n),set(o){const a=this.__accessor__;if(a!==void 0){if(!Object.isFrozen(this)){if(a.initialized&&n.readOnly)throw new TypeError(`[accessor] cannot assign to read-only property '${s}' of ${this.declaredClass}`);if(a.lifecycle===Pm.CONSTRUCTED&&n.constructOnly)throw new TypeError(`[accessor] cannot assign to construct-only property '${s}' of ${this.declaredClass}`);a.set(s,o)}}else Object.defineProperty(this,s,{enumerable:!0,configurable:!0,writable:!0,value:o})}}}Object.defineProperties(e.prototype,i)}var G1e;function Tke(e){var t;if(e==null)return{value:e};if(Array.isArray(e))return{type:[e[0]],value:null};switch(typeof e){case"object":return((t=e.constructor)==null?void 0:t.__accessorMetadata__)||e instanceof Date?{type:e.constructor,value:e}:e;case"boolean":return{type:Boolean,value:e};case"string":return{type:String,value:e};case"number":return{type:Number,value:e};case"function":return{type:e,value:null};default:return}}const hM=Symbol("Accessor-Handles");class xe{constructor(...t){if(this[G1e]=null,this.constructor===xe)throw new Error("[accessor] cannot instantiate Accessor. This can be fixed by creating a subclass of Accessor");Object.defineProperty(this,"__accessor__",{enumerable:!1,value:new p5e(this)}),t.length>0&&this.normalizeCtorArgs&&(this.__accessor__.ctorArgs=this.normalizeCtorArgs.apply(this,t))}static createSubclass(t={}){if(Array.isArray(t))throw new Error("Multi-inheritance unsupported since 4.16");const{properties:r,declaredClass:i,constructor:s}=t;delete t.declaredClass,delete t.properties,delete t.constructor;const n=this;class o extends n{constructor(...l){super(...l),this.inherited=null,s&&s.apply(this,l)}}k$(o.prototype);for(const a in t){const l=t[a];o.prototype[a]=typeof l=="function"?function(...c){const h=this.inherited;let p;this.inherited=function(...f){if(n.prototype[a])return n.prototype[a].apply(this,f)};try{p=l.apply(this,c)}catch(f){throw this.inherited=h,f}return this.inherited=h,p}:t[a]}for(const a in r){const l=Tke(r[a]);d(l)(o.prototype,a)}return $(i)(o)}postscript(t){const r=this.__accessor__,i=r.ctorArgs||t;r.initialize(),i&&(this.set(i),r.ctorArgs=null),r.constructed(),this.initialize()}initialize(){}destroy(){this.destroyed||(mn(this[hM],t=>{t.forEach(r=>r.remove())}),this[hM]=null,U5e(this),this.__accessor__.destroy())}get initialized(){return this.__accessor__&&this.__accessor__.initialized||!1}get constructed(){return this.__accessor__&&this.__accessor__.lifecycle===Pm.CONSTRUCTED||!1}get destroyed(){return this.__accessor__&&this.__accessor__.destroyed||!1}commitProperty(t){this.get(t)}get(t){return oU(this,t)}hasOwnProperty(t){return this.__accessor__?this.__accessor__.has(t):Object.prototype.hasOwnProperty.call(this,t)}keys(){return this.__accessor__?this.__accessor__.keys():[]}set(t,r){return cU(this,t,r),this}watch(t,r,i){return j5e(this,t,r,i)}own(t){let r=this[hM];if(R(r)&&(r=this[hM]=new Set),G_e(t))for(const i of t)r.add(i);else r.add(t)}_clearOverride(t){return this.__accessor__.clearOverride(t)}_override(t,r){return this.__accessor__.override(t,r)}_isOverridden(t){return this.__accessor__.isOverridden(t)}notifyChange(t){this.__accessor__.notifyChange(t)}_get(t){return this.__accessor__.internalGet(t)}_set(t,r){return this.__accessor__.internalSet(t,r),this}}G1e=hM;class sC{constructor(){this._emitter=new sC.EventEmitter(this)}emit(t,r){return this._emitter.emit(t,r)}on(t,r){return this._emitter.on(t,r)}once(t,r){return this._emitter.once(t,r)}hasEventListener(t){return this._emitter.hasEventListener(t)}}(function(e){class t{constructor(s=null){this.target=s,this._listenersMap=null}clear(){this._listenersMap&&this._listenersMap.clear(),this._listenersMap=null}emit(s,n){const o=this._listenersMap&&this._listenersMap.get(s);if(!o)return!1;const a=this.target||this;return[...o].forEach(l=>{l.call(a,n)}),o.length>0}on(s,n){if(Array.isArray(s)){const a=s.map(l=>this.on(l,n));return VC(a)}if(s.includes(","))throw new TypeError("Evented.on() with a comma delimited string of event types is not supported");this._listenersMap||(this._listenersMap=new Map);const o=this._listenersMap.get(s)||[];return o.push(n),this._listenersMap.set(s,o),{remove:()=>{const a=this._listenersMap&&this._listenersMap.get(s)||[],l=a.indexOf(n);l>=0&&a.splice(l,1)}}}once(s,n){const o=this.on(s,a=>{o.remove(),n.call(null,a)});return o}hasEventListener(s){const n=this._listenersMap&&this._listenersMap.get(s);return n!=null&&n.length>0}}e.EventEmitter=t,e.EventedMixin=i=>{let s=class extends i{constructor(){super(...arguments),this._emitter=new t}destroy(){this._emitter.clear()}emit(n,o){return this._emitter.emit(n,o)}on(n,o){return this._emitter.on(n,o)}once(n,o){return this._emitter.once(n,o)}hasEventListener(n){return this._emitter.hasEventListener(n)}};return s=u([$("esri.core.Evented")],s),s};let r=class extends xe{constructor(){super(...arguments),this._emitter=new sC.EventEmitter(this)}destroy(){this._emitter.clear()}emit(i,s){return this._emitter.emit(i,s)}on(i,s){return this._emitter.on(i,s)}once(i,s){return this._emitter.once(i,s)}hasEventListener(i){return this._emitter.hasEventListener(i)}};r=u([$("esri.core.Evented")],r),e.EventedAccessor=r})(sC||(sC={}));const ds=sC;var Qr;(function(e){e[e.ADD=1]="ADD",e[e.REMOVE=2]="REMOVE",e[e.MOVE=4]="MOVE"})(Qr||(Qr={}));function HK(e){return(t,r)=>{t[r]=e}}class j1e{constructor(){this._observers=[]}observe(t){return this._observers.includes(t)||this._observers.push(t),new g1e(this._observers,t)}notify(){const t=this._observers.slice();for(let r=0;r<t.length;++r){const i=t[r];i.onInvalidated(),i.onCommitted()}}}var Cy;class Ske{constructor(){this.target=null,this.cancellable=!1,this.defaultPrevented=!1,this.item=void 0,this.type=void 0}preventDefault(){this.cancellable&&(this.defaultPrevented=!0)}reset(t){this.defaultPrevented=!1,this.item=t}}const Ph=new Ls(Ske,void 0,e=>{e.item=null,e.target=null,e.defaultPrevented=!1,e.cancellable=!1}),Eke=()=>{};function A9(e){return e?e instanceof qw?e.toArray():e.length?Array.prototype.slice.apply(e):[]:[]}function R9(e){if(e&&e.length)return e[0]}function Cke(e,t,r,i){const s=Math.min(e.length-r,t.length-i);let n=0;for(;n<s&&e[r+n]===t[i+n];)n++;return n}function H1e(e,t,r,i){t&&t.forEach((s,n,o)=>{e.push(s),H1e(e,r.call(i,s,n,o),r,i)})}const V0=new Set,z0=new Set,B0=new Set,O9=new Map;let Ake=0,qw=Cy=class extends ds.EventedAccessor{constructor(e){super(e),this._chgListeners=[],this._notifications=null,this._timer=null,this._observable=new j1e,this.length=0,this._items=[],Object.defineProperty(this,"uid",{value:Ake++})}static isCollection(e){return e!=null&&e instanceof Cy}normalizeCtorArgs(e){return e?Array.isArray(e)||e instanceof Cy?{items:e}:e:{}}destroy(){this.removeAll()}*[Symbol.iterator](){yield*this.items}get items(){return ir(this._observable),this._items}set items(e){this._emitBeforeChanges(Qr.ADD)||(this._splice(0,this.length,A9(e)),this._emitAfterChanges(Qr.ADD))}hasEventListener(e){return e==="change"?this._chgListeners.length>0:this._emitter.hasEventListener(e)}on(e,t){if(e==="change"){const r=this._chgListeners,i={removed:!1,callback:t};return r.push(i),this._notifications&&this._notifications.push({listeners:r.slice(),items:this._items.slice(),changes:[]}),{remove(){this.remove=Eke,i.removed=!0,r.splice(r.indexOf(i),1)}}}return this._emitter.on(e,t)}once(e,t){const r=this.on(e,t);return{remove(){r.remove()}}}add(e,t){if(ir(this._observable),this._emitBeforeChanges(Qr.ADD))return this;const r=this.getNextIndex(t!=null?t:null);return this._splice(r,0,[e]),this._emitAfterChanges(Qr.ADD),this}addMany(e,t=this._items.length){if(ir(this._observable),!e||!e.length)return this;if(this._emitBeforeChanges(Qr.ADD))return this;const r=this.getNextIndex(t);return this._splice(r,0,A9(e)),this._emitAfterChanges(Qr.ADD),this}at(e){if(ir(this._observable),(e=Math.trunc(e)||0)<0&&(e+=this.length),!(e<0||e>=this.length))return this._items[e]}removeAll(){if(ir(this._observable),!this.length||this._emitBeforeChanges(Qr.REMOVE))return[];const e=this._splice(0,this.length)||[];return this._emitAfterChanges(Qr.REMOVE),e}clone(){return ir(this._observable),this._createNewInstance({items:this._items.map(re)})}concat(...e){ir(this._observable);const t=e.map(A9);return this._createNewInstance({items:this._items.concat(...t)})}drain(e,t){if(ir(this._observable),!this.length||this._emitBeforeChanges(Qr.REMOVE))return;const r=this._splice(0,this.length),i=r.length;for(let s=0;s<i;s++)e.call(t,r[s],s,r);this._emitAfterChanges(Qr.REMOVE)}every(e,t){return ir(this._observable),this._items.every(e,t)}filter(e,t){let r;return ir(this._observable),r=arguments.length===2?this._items.filter(e,t):this._items.filter(e),this._createNewInstance({items:r})}find(e,t){return ir(this._observable),this._items.find(e,t)}findIndex(e,t){return ir(this._observable),this._items.findIndex(e,t)}flatten(e,t){ir(this._observable);const r=[];return H1e(r,this,e,t),new Cy(r)}forEach(e,t){return ir(this._observable),this._items.forEach(e,t)}getItemAt(e){return ir(this._observable),this._items[e]}getNextIndex(e){ir(this._observable);const t=this.length;return(e=e==null?t:e)<0?e=0:e>t&&(e=t),e}includes(e,t=0){return ir(this._observable),this._items.includes(e,t)}indexOf(e,t=0){return ir(this._observable),this._items.indexOf(e,t)}join(e=","){return ir(this._observable),this._items.join(e)}lastIndexOf(e,t=this.length-1){return ir(this._observable),this._items.lastIndexOf(e,t)}map(e,t){ir(this._observable);const r=this._items.map(e,t);return new Cy({items:r})}reorder(e,t=this.length-1){ir(this._observable);const r=this.indexOf(e);if(r!==-1){if(t<0?t=0:t>=this.length&&(t=this.length-1),r!==t){if(this._emitBeforeChanges(Qr.MOVE))return e;this._splice(r,1),this._splice(t,0,[e]),this._emitAfterChanges(Qr.MOVE)}return e}}pop(){if(ir(this._observable),!this.length||this._emitBeforeChanges(Qr.REMOVE))return;const e=R9(this._splice(this.length-1,1));return this._emitAfterChanges(Qr.REMOVE),e}push(...e){return ir(this._observable),this._emitBeforeChanges(Qr.ADD)||(this._splice(this.length,0,e),this._emitAfterChanges(Qr.ADD)),this.length}reduce(e,t){ir(this._observable);const r=this._items;return arguments.length===2?r.reduce(e,t):r.reduce(e)}reduceRight(e,t){ir(this._observable);const r=this._items;return arguments.length===2?r.reduceRight(e,t):r.reduceRight(e)}remove(e){return ir(this._observable),this.removeAt(this.indexOf(e))}removeAt(e){if(ir(this._observable),e<0||e>=this.length||this._emitBeforeChanges(Qr.REMOVE))return;const t=R9(this._splice(e,1));return this._emitAfterChanges(Qr.REMOVE),t}removeMany(e){if(ir(this._observable),!e||!e.length||this._emitBeforeChanges(Qr.REMOVE))return[];const t=e instanceof Cy?e.toArray():e,r=this._items,i=[],s=t.length;for(let n=0;n<s;n++){const o=t[n],a=r.indexOf(o);if(a>-1){const l=1+Cke(t,r,n+1,a+1),c=this._splice(a,l);c&&c.length>0&&i.push.apply(i,c),n+=l-1}}return this._emitAfterChanges(Qr.REMOVE),i}reverse(){if(ir(this._observable),this._emitBeforeChanges(Qr.MOVE))return this;const e=this._splice(0,this.length);return e&&(e.reverse(),this._splice(0,0,e)),this._emitAfterChanges(Qr.MOVE),this}shift(){if(ir(this._observable),!this.length||this._emitBeforeChanges(Qr.REMOVE))return;const e=R9(this._splice(0,1));return this._emitAfterChanges(Qr.REMOVE),e}slice(e=0,t=this.length){return ir(this._observable),this._createNewInstance({items:this._items.slice(e,t)})}some(e,t){return ir(this._observable),this._items.some(e,t)}sort(e){if(ir(this._observable),!this.length||this._emitBeforeChanges(Qr.MOVE))return this;const t=this._splice(0,this.length);return arguments.length?t.sort(e):t.sort(),this._splice(0,0,t),this._emitAfterChanges(Qr.MOVE),this}splice(e,t,...r){ir(this._observable);const i=(t?Qr.REMOVE:0)|(r.length?Qr.ADD:0);if(this._emitBeforeChanges(i))return[];const s=this._splice(e,t,r)||[];return this._emitAfterChanges(i),s}toArray(){return ir(this._observable),this._items.slice()}toJSON(){return ir(this._observable),this.toArray()}toLocaleString(){return ir(this._observable),this._items.toLocaleString()}toString(){return ir(this._observable),this._items.toString()}unshift(...e){return ir(this._observable),!e.length||this._emitBeforeChanges(Qr.ADD)||(this._splice(0,0,e),this._emitAfterChanges(Qr.ADD)),this.length}_createNewInstance(e){return new this.constructor(e)}_splice(e,t,r){const i=this._items,s=this.itemType;let n,o;if(!this._notifications&&this.hasEventListener("change")&&(this._notifications=[{listeners:this._chgListeners.slice(),items:this._items.slice(),changes:[]}],this._timer&&this._timer.remove(),this._timer=iR(()=>this._dispatchChange())),t){if(o=i.splice(e,t),this.hasEventListener("before-remove")){const a=Ph.acquire();a.target=this,a.cancellable=!0;for(let l=0,c=o.length;l<c;l++)n=o[l],a.reset(n),this.emit("before-remove",a),a.defaultPrevented&&(o.splice(l,1),i.splice(e,0,n),e+=1,l-=1,c-=1);Ph.release(a)}if(this.length=this._items.length,this.hasEventListener("after-remove")){const a=Ph.acquire();a.target=this,a.cancellable=!1;const l=o.length;for(let c=0;c<l;c++)a.reset(o[c]),this.emit("after-remove",a);Ph.release(a)}}if(r&&r.length){if(s){const h=[];for(const p of r){const f=s.ensureType(p);f==null&&p!=null||h.push(f)}r=h}const a=this.hasEventListener("before-add"),l=this.hasEventListener("after-add"),c=e===this.length;if(a||l){const h=Ph.acquire();h.target=this,h.cancellable=!0;const p=Ph.acquire();p.target=this,p.cancellable=!1;for(const f of r)a?(h.reset(f),this.emit("before-add",h),h.defaultPrevented||(c?i.push(f):i.splice(e++,0,f),this._set("length",i.length),l&&(p.reset(f),this.emit("after-add",p)))):(c?i.push(f):i.splice(e++,0,f),this._set("length",i.length),p.reset(f),this.emit("after-add",p));Ph.release(p),Ph.release(h)}else{if(c)for(const h of r)i.push(h);else i.splice(e,0,...r);this._set("length",i.length)}}return(r&&r.length||o&&o.length)&&this._notifyChangeEvent(r,o),o}_emitBeforeChanges(e){let t=!1;if(this.hasEventListener("before-changes")){const r=Ph.acquire();r.target=this,r.cancellable=!0,r.type=e,this.emit("before-changes",r),t=r.defaultPrevented,Ph.release(r)}return t}_emitAfterChanges(e){if(this.hasEventListener("after-changes")){const t=Ph.acquire();t.target=this,t.cancellable=!1,t.type=e,this.emit("after-changes",t),Ph.release(t)}this._observable.notify()}_notifyChangeEvent(e,t){this.hasEventListener("change")&&this._notifications&&this._notifications[this._notifications.length-1].changes.push({added:e,removed:t})}_dispatchChange(){if(this._timer&&(this._timer.remove(),this._timer=null),!this._notifications)return;const e=this._notifications;this._notifications=null;for(const t of e){const r=t.changes;V0.clear(),z0.clear(),B0.clear();for(const{added:l,removed:c}of r){if(l)if(B0.size===0&&z0.size===0)for(const h of l)V0.add(h);else for(const h of l)z0.has(h)?(B0.add(h),z0.delete(h)):B0.has(h)||V0.add(h);if(c)if(B0.size===0&&V0.size===0)for(const h of c)z0.add(h);else for(const h of c)V0.has(h)?V0.delete(h):(B0.delete(h),z0.add(h))}const i=Uc.acquire();V0.forEach(l=>{i.push(l)});const s=Uc.acquire();z0.forEach(l=>{s.push(l)});const n=this._items,o=t.items,a=Uc.acquire();if(B0.forEach(l=>{o.indexOf(l)!==n.indexOf(l)&&a.push(l)}),t.listeners&&(i.length||s.length||a.length)){const l={target:this,added:i,removed:s,moved:a},c=t.listeners.length;for(let h=0;h<c;h++){const p=t.listeners[h];p.removed||p.callback.call(this,l)}}Uc.release(i),Uc.release(s),Uc.release(a)}V0.clear(),z0.clear(),B0.clear()}};qw.ofType=e=>{if(!e)return Cy;if(O9.has(e))return O9.get(e);let t=null;if(typeof e=="function")t=e.prototype.declaredClass;else if(e.base)t=e.base.prototype.declaredClass;else for(const i in e.typeMap){const s=e.typeMap[i].prototype.declaredClass;t?t+=` | ${s}`:t=s}let r=class extends Cy{};return u([HK({Type:e,ensureType:typeof e=="function"?en(e):_f(e)})],r.prototype,"itemType",void 0),r=u([$(`esri.core.Collection<${t}>`)],r),O9.set(e,r),r},u([d()],qw.prototype,"length",void 0),u([d()],qw.prototype,"items",null),qw=Cy=u([$("esri.core.Collection")],qw);const ot=qw;function iT(e,t,r=ot){return t||(t=new r),t===e||(t.removeAll(),Rke(e)?t.addMany(e):e&&t.add(e)),t}function q1e(e){return e}function Rke(e){return e&&(Array.isArray(e)||"items"in e&&Array.isArray(e.items))}class qK{constructor(){this._values=new Map,this.multipleOriginsSupported=!1}clone(t){const r=new qK;return this._values.forEach((i,s)=>{t&&t.has(s)||r.set(s,re(i.value),i.origin)}),r}get(t,r){r=this._normalizeOrigin(r);const i=this._values.get(t);return r==null||(i==null?void 0:i.origin)===r?i==null?void 0:i.value:void 0}originOf(t){var r,i;return(i=(r=this._values.get(t))==null?void 0:r.origin)!=null?i:Bt.USER}keys(t){t=this._normalizeOrigin(t);const r=[...this._values.keys()];return t==null?r:r.filter(i=>{var s;return((s=this._values.get(i))==null?void 0:s.origin)===t})}set(t,r,i){if((i=this._normalizeOrigin(i))===Bt.DEFAULTS){const s=this._values.get(t);if(s&&s.origin!=null&&s.origin>i)return}this._values.set(t,new Oke(r,i))}delete(t,r){var i;(r=this._normalizeOrigin(r))!=null&&((i=this._values.get(t))==null?void 0:i.origin)!==r||this._values.delete(t)}has(t,r){var i;return(r=this._normalizeOrigin(r))!=null?((i=this._values.get(t))==null?void 0:i.origin)===r:this._values.has(t)}forEach(t){this._values.forEach(({value:r},i)=>t(r,i))}_normalizeOrigin(t){if(t!=null)return t===Bt.DEFAULTS?t:Bt.USER}}class Oke{constructor(t,r){this.value=t,this.origin=r}}function W1e(e,t,r){t.keys().forEach(s=>{r.set(s,t.get(s),Bt.DEFAULTS)});const i=e.metadatas;Object.keys(i).forEach(s=>{e.internalGet(s)&&r.set(s,e.internalGet(s),Bt.DEFAULTS)})}function Mke(e,t,r){if(!e||!e.read||e.read.enabled===!1||!e.read.source)return!1;const i=e.read.source;if(typeof i=="string"){if(i===t||i.includes(".")&&i.indexOf(t)===0&&joe(i,r))return!0}else for(const s of i)if(s===t||s.includes(".")&&s.indexOf(t)===0&&joe(s,r))return!0;return!1}function Pke(e){return e&&(!e.read||e.read.enabled!==!1&&!e.read.source)}function Ike(e,t,r,i,s){let n=Nq(t[r],s);Pke(n)&&(e[r]=!0);for(const o of Object.getOwnPropertyNames(t))n=Nq(t[o],s),Mke(n,r,i)&&(e[o]=!0)}function $ke(e,t,r,i){const s=r.metadatas,n=jK(s[t],"any",i),o=n&&n.default;if(o===void 0)return;const a=typeof o=="function"?o.call(e,t,i):o;a!==void 0&&r.set(t,a)}const X1e={origin:"service"};function Z1e(e,t,r=X1e){if(!t||typeof t!="object")return;const i=Pa(e),s=i.metadatas,n={};for(const o of Object.getOwnPropertyNames(t))Ike(n,s,o,t,r);i.setDefaultOrigin(r.origin);for(const o of Object.getOwnPropertyNames(n)){const a=Nq(s[o],r).read,l=a&&a.source;let c;c=l&&typeof l=="string"?F$(t,l):t[o],a&&a.reader&&(c=a.reader.call(e,c,t,r)),c!==void 0&&i.set(o,c)}if(!r||!r.ignoreDefaults){i.setDefaultOrigin("defaults");for(const o of Object.getOwnPropertyNames(s))n[o]||$ke(e,o,i,r)}i.setDefaultOrigin("user")}function Lke(e,t,r,i=X1e){var n;const s={...i,messages:[]};r(s),(n=s.messages)==null||n.forEach(o=>{o.type!=="warning"||e.loaded?i&&i.messages&&i.messages.push(o):e.loadWarnings.push(o)})}const Dke=fe.getLogger("esri.core.accessorSupport.write");function Nke(e,t,r,i,s){var o,a;const n={};return(a=(o=t.write)==null?void 0:o.writer)==null||a.call(e,i,n,r,s),n}function Y1e(e,t,r,i,s,n){if(!i||!i.write)return!1;const o=e.get(r);if(!s&&i.write.overridePolicy){const a=i.write.overridePolicy.call(e,o,r,n);a!==void 0&&(s=a)}if(s||(s=i.write),!s||s.enabled===!1)return!1;if((o===null&&!s.allowNull&&!s.writerEnsuresNonNull||o===void 0)&&s.isRequired){const a=new j("web-document-write:property-required",`Missing value for required property '${r}' on '${e.declaredClass}'`,{propertyName:r,target:e});return a&&n&&n.messages?n.messages.push(a):a&&!n&&Dke.error(a.name,a.message),!1}return!(o===void 0||o===null&&!s.allowNull&&!s.writerEnsuresNonNull||(!t.store.multipleOriginsSupported||t.store.originOf(r)===Bt.DEFAULTS)&&Fke(e,r,n,i,o)||!s.ignoreOrigin&&n&&n.origin&&t.store.multipleOriginsSupported&&t.store.originOf(r)<Dy(n.origin))}function Fke(e,t,r,i,s){const n=i.default;if(n===void 0)return!1;if(i.defaultEquals!=null)return i.defaultEquals(s);if(typeof n=="function"){if(Array.isArray(s)){const o=n.call(e,t,r);return x1(o,s)}return!1}return n===s}function kke(e,t,r,i){const s=Pa(e),n=s.metadatas,o=z1e(n[t],i);return!!o&&Y1e(e,s,t,o,r,i)}function Q1e(e,t,r){var n,o;if(e&&typeof e.toJSON=="function"&&(!e.toJSON.isDefaultToJSON||!e.write))return O4(t,e.toJSON(r));const i=Pa(e),s=i.metadatas;for(const a in s){const l=z1e(s[a],r);if(!Y1e(e,i,a,l,void 0,r))continue;const c=e.get(a),h=Nke(e,l,l.write&&typeof l.write.target=="string"?l.write.target:a,c,r);Object.keys(h).length>0&&(t=O4(t,h),(o=(n=r==null?void 0:r.resources)==null?void 0:n.pendingOperations)!=null&&o.length&&Promise.all(r.resources.pendingOperations).then(()=>O4(t,h)),r&&r.writtenProperties&&r.writtenProperties.push({target:e,propName:a,oldOrigin:l5e(i.store.originOf(a)),newOrigin:r.origin}))}return t}const nR=e=>{let t=class extends e{constructor(...r){super(...r);const i=Pa(this),s=i.store,n=new qK;i.store=n,W1e(i,s,n)}read(r,i){Z1e(this,r,i)}write(r={},i){return Q1e(this,r,i)}toJSON(r){return this.write({},r)}static fromJSON(r,i){return Uke.call(this,r,i)}};return t=u([$("esri.core.JSONSupport")],t),t.prototype.toJSON.isDefaultToJSON=!0,t};function Uke(e,t){if(!e)return null;if(e.declaredClass)throw new Error("JSON object is already hydrated");const r=new this;return r.read(e,t),r}let ye=class extends nR(xe){};ye=u([$("esri.core.JSONSupport")],ye);var c_;(function(e){e[e.PENDING=0]="PENDING",e[e.RESOLVED=1]="RESOLVED",e[e.REJECTED=2]="REJECTED"})(c_||(c_={}));class Vke{constructor(t){this.instance=t,this._resolver=T1(),this._status=c_.PENDING,this._resolvingPromises=[],this._resolver.promise.then(()=>{this._status=c_.RESOLVED,this._cleanUp()},()=>{this._status=c_.REJECTED,this._cleanUp()})}addResolvingPromise(t){this._resolvingPromises.push(t),this._tryResolve()}isResolved(){return this._status===c_.RESOLVED}isRejected(){return this._status===c_.REJECTED}isFulfilled(){return this._status!==c_.PENDING}abort(){this._resolver.reject(gr())}when(t,r){return this._resolver.promise.then(t,r)}_cleanUp(){this._allPromise=this._resolvingPromises=this._allPromise=null}_tryResolve(){if(this.isFulfilled())return;const t=T1(),r=[...this._resolvingPromises,t.promise],i=this._allPromise=Promise.all(r);i.then(()=>{this.isFulfilled()||this._allPromise!==i||this._resolver.resolve(this.instance)},s=>{this.isFulfilled()||this._allPromise!==i||Vi(s)||this._resolver.reject(s)}),t.resolve()}}const j$=e=>{let t=class extends e{constructor(...r){super(...r),this._promiseProps=new Vke(this),this.addResolvingPromise(Promise.resolve())}isResolved(){return this._promiseProps.isResolved()}isRejected(){return this._promiseProps.isRejected()}isFulfilled(){return this._promiseProps.isFulfilled()}when(r,i){return new Promise((s,n)=>{this._promiseProps.when(s,n)}).then(r,i)}catch(r){return this.when(null,r)}addResolvingPromise(r){r&&!this._promiseProps.isFulfilled()&&this._promiseProps.addResolvingPromise("_promiseProps"in r?r.when():r)}};return t=u([$("esri.core.Promise")],t),t};let _U=class extends j$(xe){};_U=u([$("esri.core.Promise")],_U);const zke="not-loaded",Bke="loading",Gke="failed",cae="loaded",J1e=e=>{let t=class extends e{constructor(...r){super(...r),this._loadController=null,this.loadError=null,this.loadStatus="not-loaded",this._set("loadWarnings",[]),this.addResolvingPromise(new Promise(i=>{const s=this.load.bind(this);this.load=n=>{const o=new Promise((a,l)=>{const c=FK(n,l);this.destroyed&&l(new j("load:instance-destroyed",`Instance of '${this.declaredClass||this.constructor.name}' is already destroyed`,{instance:this})),this._promiseProps.when(a,l).finally(()=>{c&&c.remove()})});if(this.loadStatus===zke){this._set("loadStatus",Bke);const a=this._loadController=new AbortController;s({signal:a.signal}),Ia(a.signal,()=>{this._promiseProps.abort()})}return i(),o}})),this.when(()=>{this._set("loadStatus",cae),this._loadController=null},i=>{this._set("loadStatus",Gke),this._set("loadError",i),this._loadController=null})}get loaded(){return this.loadStatus===cae}get loadWarnings(){return this._get("loadWarnings")}load(){return null}cancelLoad(){var r;return this.isFulfilled()||(this._set("loadError",new j("load:cancelled","Cancelled")),(r=this._loadController)==null||r.abort()),this}};return u([d({readOnly:!0})],t.prototype,"loaded",null),u([d({readOnly:!0})],t.prototype,"loadError",void 0),u([d({clonable:!1})],t.prototype,"loadStatus",void 0),u([d({type:[ic],readOnly:!0})],t.prototype,"loadWarnings",null),t=u([$("esri.core.Loadable")],t),t};let dM=class extends J1e(_U){};dM=u([$("esri.core.Loadable")],dM),function(e){function t(r){return!(!r||!r.load)}e.LoadableMixin=J1e,e.isLoadable=t}(dM||(dM={}));const gh=dM;function Xz(e,t,r){return xs(e.map((i,s)=>t.apply(r,[i,s])))}async function jke(e,t,r){return(await xs(e.map((i,s)=>t.apply(r,[i,s])))).map(i=>i.value)}async function yh(e){if(R(e))return{ok:!1,error:new Error("no promise provided")};try{return{ok:!0,value:await e}}catch(t){return{ok:!1,error:t}}}async function lIt(e){try{return{ok:!0,value:await e}}catch(t){return ah(t),{ok:!1,error:t}}}function cIt(e){if(e.ok===!0)return e.value;throw e.error}async function K1e(e,t){return await e.load(),Hke(e,t)}async function Hke(e,t){const r=[],i=(...n)=>{for(const o of n)R(o)||(Array.isArray(o)?i(...o):ot.isCollection(o)?o.forEach(a=>i(a)):gh.isLoadable(o)&&r.push(o))};t(i);let s=null;if(await jke(r,async n=>{(await yh(qke(n)?n.loadAll():n.load())).ok!==!1||s||(s=n)}),s)throw s.loadError;return e}function qke(e){return"loadAll"in e&&typeof e.loadAll=="function"}const Wke=fe.getLogger("esri.core.urlUtils"),oR=Ur.request,uae="esri/config: esriConfig.request.proxyUrl is not set.",ebe=/^\s*[a-z][a-z0-9-+.]*:(?![0-9])/i,tbe=/^\s*http:/i,Xke=/^\s*https:/i,Zke=/^\s*file:/i,Yke=/:\d+$/,Qke=/^https?:\/\/[^/]+\.arcgis.com\/sharing(\/|$)/i,Jke=new RegExp("^(([^:/?#]+):)?(//([^/?#]*))?([^?#]*)(\\?([^#]*))?(#(.*))?$"),Kke=new RegExp("^((([^\\[:]+):)?([^@]+)@)?(\\[([^\\]]+)\\]|([^\\[:]*))(:([0-9]+))?$");class nC{constructor(t=""){this.uri=t,this.scheme=null,this.authority=null,this.path=null,this.query=null,this.fragment=null,this.user=null,this.password=null,this.host=null,this.port=null;let r=this.uri.match(Jke);this.scheme=r[2]||(r[1]?"":null),this.authority=r[4]||(r[3]?"":null),this.path=r[5],this.query=r[7]||(r[6]?"":null),this.fragment=r[9]||(r[8]?"":null),this.authority!=null&&(r=this.authority.match(Kke),this.user=r[3]||null,this.password=r[4]||null,this.host=r[6]||r[7],this.port=r[9]||null)}toString(){return this.uri}}const _D={},eUe=new nC(Ur.applicationUrl);let cl=eUe;const tUe=rUe();let WK=tUe;const XK=()=>cl,uIt=()=>WK;function rUe(){const e=cl.path,t=e.substring(0,e.lastIndexOf(e.split("/")[e.split("/").length-1]));return`${`${cl.scheme}://${cl.host}${cl.port!=null?`:${cl.port}`:""}`}${t}`}function Ds(e){const t={path:null,query:null},r=new nC(e),i=e.indexOf("?");return r.query===null?t.path=e:(t.path=e.substring(0,i),t.query=rbe(r.query)),r.fragment&&(t.hash=r.fragment,r.query===null&&(t.path=t.path.substring(0,t.path.length-(r.fragment.length+1)))),t}function rbe(e){const t=e.split("&"),r={};for(const i of t){if(!i)continue;const s=i.indexOf("=");let n,o;s<0?(n=decodeURIComponent(i),o=""):(n=decodeURIComponent(i.slice(0,s)),o=decodeURIComponent(i.slice(s+1)));let a=r[n];typeof a=="string"&&(a=r[n]=[a]),Array.isArray(a)?a.push(o):r[n]=o}return r}function hae(e){return e&&typeof e=="object"&&"toJSON"in e&&typeof e.toJSON=="function"}function tI(e,t){return e?t&&typeof t=="function"?Object.keys(e).map(r=>encodeURIComponent(r)+"="+encodeURIComponent(t(r,e[r]))).join("&"):Object.keys(e).map(r=>{const i=e[r];if(i==null)return"";const s=encodeURIComponent(r)+"=",n=t&&t[r];return n?s+encodeURIComponent(n(i)):Array.isArray(i)?i.map(o=>hae(o)?s+encodeURIComponent(JSON.stringify(o)):s+encodeURIComponent(o)).join("&"):hae(i)?s+encodeURIComponent(JSON.stringify(i)):s+encodeURIComponent(i)}).filter(r=>r).join("&"):""}function iUe(e=!1){let t,r=oR.proxyUrl;if(typeof e=="string"){t=cUe(e);const i=Zz(e);i&&(r=i.proxyUrl)}else t=!!e;if(!r)throw Wke.warn(uae),new j("urlutils:proxy-not-set",uae);return t&&kq()&&(r=KK(r)),Ds(r)}function hIt(e){const t=Zz(e);let r,i;if(t){const s=ZK(t.proxyUrl);r=s.path,i=s.query?rbe(s.query):null}if(r){const s=Ds(e);e=r+"?"+s.path;const n=tI({...i,...s.query});n&&(e=`${e}?${n}`)}return e}const HR={path:"",query:""};function ZK(e){const t=e.indexOf("?");return t!==-1?(HR.path=e.slice(0,t),HR.query=e.slice(t+1)):(HR.path=e,HR.query=null),HR}function ibe(e){return e=(e=bU(e=fUe(e=ZK(e).path),!0)).toLowerCase()}function sUe(e){const t={proxyUrl:e.proxyUrl,urlPrefix:ibe(e.urlPrefix)},r=oR.proxyRules,i=t.urlPrefix;let s=r.length;for(let n=0;n<r.length;n++){const o=r[n].urlPrefix;if(i.indexOf(o)===0){if(i.length===o.length)return-1;s=n;break}o.indexOf(i)===0&&(s=n+1)}return r.splice(s,0,t),s}function Zz(e){const t=oR.proxyRules,r=ibe(e);for(let i=0;i<t.length;i++)if(r.indexOf(t[i].urlPrefix)===0)return t[i]}function sbe(e,t){return e=dae(e),t=dae(t),bU(e)===bU(t)}function dae(e){const t=(e=Id(e)).indexOf("/sharing");return t>0?e.substring(0,t):e.replace(/\/+$/,"")}function nbe(e){const t=i=>i==null||i instanceof RegExp&&i.test(e)||typeof i=="string"&&e.startsWith(i),r=oR.interceptors;if(r){for(const i of r)if(Array.isArray(i.urls)){if(i.urls.some(t))return i}else if(t(i.urls))return i}return null}function rI(e,t,r=!1){const i=Vq(e),s=Vq(t);return!(!r&&i.scheme!==s.scheme)&&i.host!=null&&s.host!=null&&i.host.toLowerCase()===s.host.toLowerCase()&&i.port===s.port}function YK(e){if(typeof e=="string"){if(!Kc(e))return!0;e=Vq(e)}if(rI(e,cl))return!0;const t=oR.trustedServers||[];for(let r=0;r<t.length;r++){const i=nUe(t[r]);for(let s=0;s<i.length;s++)if(rI(e,i[s]))return!0}return!1}function nUe(e){return _D[e]||(JK(e)||Ym(e)?_D[e]=[new nC(Rd(e))]:_D[e]=[new nC(`http://${e}`),new nC(`https://${e}`)]),_D[e]}function Rd(e,t=WK,r){return Ym(e)?r&&r.preserveProtocolRelative?e:cl.scheme==="http"&&cl.authority===df(e).slice(2)?`http:${e}`:`https:${e}`:JK(e)?e:sc(e[0]==="/"?pUe(t):t,e)}function QK(e,t=WK,r){if(!Kc(e))return e;const i=Id(e),s=i.toLowerCase(),n=Id(t).toLowerCase().replace(/\/+$/,""),o=r?Id(r).toLowerCase().replace(/\/+$/,""):null;if(o&&n.indexOf(o)!==0)return e;const a=(p,f,m)=>(m=p.indexOf(f,m))===-1?p.length:m;let l=a(s,"/",s.indexOf("//")+2),c=-1;for(;s.slice(0,l+1)===n.slice(0,l)+"/"&&(c=l+1,l!==s.length);)l=a(s,"/",l+1);if(c===-1||o&&c<o.length)return e;e=i.slice(c);const h=n.slice(c-1).replace(/[^/]+/g,"").length;if(h>0)for(let p=0;p<h;p++)e=`../${e}`;else e=`./${e}`;return e}function Id(e){return e=yUe(e=gUe(e=mUe(e=Rd(e=e.trim()))))}function sc(...e){const t=e.filter(b);if(!t||!t.length)return;const r=[];if(Kc(t[0])){const s=t[0],n=s.indexOf("//");n!==-1&&(r.push(s.slice(0,n+1)),hUe(t[0])&&(r[0]+="/"),t[0]=s.slice(n+2))}else t[0][0]==="/"&&r.push("");const i=t.reduce((s,n)=>n?s.concat(n.split("/")):s,[]);for(let s=0;s<i.length;s++){const n=i[s];n===".."&&r.length>0&&r[r.length-1]!==".."?r.pop():(!n&&s===i.length-1||n&&(n!=="."||r.length===0))&&r.push(n)}return r.join("/")}function df(e,t=!1){if(S1(e)||ug(e))return null;let r=e.indexOf("://");if(r===-1&&Ym(e))r=2;else{if(r===-1)return null;r+=3}const i=e.indexOf("/",r);return i!==-1&&(e=e.slice(0,i)),t&&(e=bU(e,!0)),e}function Kc(e){return Ym(e)||JK(e)}function S1(e){return e!=null&&e.slice(0,5)==="blob:"}function ug(e){return e.slice(0,5)==="data:"}function obe(e){const t=Yz(e);if(!t||!t.isBase64)return null;const r=atob(t.data),i=new Uint8Array(r.length);for(let s=0;s<r.length;s++)i[s]=r.charCodeAt(s);return i.buffer}function dIt(e){return btoa(String.fromCharCode.apply(null,e)).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}const oUe=/^data:(.*?)(;base64)?,(.*)$/;function Yz(e){const t=e.match(oUe);if(!t)return null;const[,r,i,s]=t;return{mediaType:r,isBase64:!!i,data:s}}function abe(e){return e.isBase64?`data:${e.mediaType};base64,${e.data}`:`data:${e.mediaType},${e.data}`}function pIt(e,t){aUe(e,t)||lUe(e,t)}function aUe(e,t){if(!e)return!1;const r=document.createElement("a");if(!("download"in r))return!1;const i=URL.createObjectURL(e);return r.download=t,r.href=i,r.style.display="none",document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(i),!0}function lUe(e,t){return!!window.navigator.msSaveOrOpenBlob&&window.navigator.msSaveOrOpenBlob(e,t)}function Ym(e){return e!=null&&e!==void 0&&e[0]==="/"&&e[1]==="/"}function JK(e){return ebe.test(e)}function cUe(e){return Xke.test(e)||cl.scheme==="https"&&Ym(e)}function uUe(e){return tbe.test(e)||cl.scheme==="http"&&Ym(e)}function hUe(e){return Zke.test(e)}function KK(e){return Ym(e)?`https:${e}`:e.replace(tbe,"https:")}function dUe(){return cl.scheme==="http"}function kq(){return cl.scheme==="https"}function bU(e,t=!1){return Ym(e)?e.slice(2):(e=e.replace(ebe,""),t&&e.length>1&&e[0]==="/"&&e[1]==="/"&&(e=e.slice(2)),e)}function pUe(e){const t=e.indexOf("//"),r=e.indexOf("/",t+2);return r===-1?e:e.slice(0,r)}function eee(e){let t=0;if(Kc(e)){const i=e.indexOf("//");i!==-1&&(t=i+2)}const r=e.lastIndexOf("/");return r<t?e:e.slice(0,r+1)}function fIt(e,t){if(!e)return"";const r=Ds(e).path.replace(/\/+$/,""),i=r.substring(r.lastIndexOf("/")+1);if(!(t!=null&&t.length))return i;const s=new RegExp(`.(${t.join("|")})$`,"ig");return i.replace(s,"")}function fUe(e){return e&&e[e.length-1]==="/"?e:`${e}/`}function lbe(e){return e.replace(/\/+$/,"")}function mUe(e){if(/^https?:\/\//i.test(e)){const t=ZK(e);e=(e=t.path.replace(/\/{2,}/g,"/")).replace("/","//"),t.query&&(e+=`?${t.query}`)}return e}function gUe(e){return e.replace(/^(https?:\/\/)(arcgis\.com)/i,"$1www.$2")}function yUe(e){const t=oR.httpsDomains;if(!uUe(e))return e;const r=e.indexOf("/",7);let i;if(i=r===-1?e:e.slice(0,r),i=i.toLowerCase().slice(7),Yke.test(i)){if(!i.endsWith(":80"))return e;i=i.slice(0,-3),e=e.replace(":80","")}return dUe()&&i===cl.authority&&!Qke.test(e)||(kq()&&i===cl.authority||t&&t.some(s=>i===s||i.endsWith(`.${s}`))||kq()&&!Zz(e))&&(e=KK(e)),e}function Uq(e,t,r){if(!(t&&r&&e&&Kc(e)))return e;const i=e.indexOf("//"),s=e.indexOf("/",i+2),n=e.indexOf(":",i+2),o=Math.min(s<0?e.length:s,n<0?e.length:n);return e.slice(i+2,o).toLowerCase()!==t.toLowerCase()?e:`${e.slice(0,i+2)}${r}${e.slice(o)}`}function Vq(e){return typeof e=="string"?new nC(Rd(e)):(e.scheme||(e.scheme=cl.scheme),e)}function tee(e){return _Ue.test(e)}function cbe(e,t){const r=Ds(e),i=Object.keys(r.query||{});return i.length>0&&t&&t.warn("removeQueryParameters()",`Url query parameters are not supported, the following parameters have been removed: ${i.join(", ")}.`),r.path}function ube(e,t,r){const i=Ds(e),s=i.query||{};return s[t]=String(r),`${i.path}?${tI(s)}`}function L4(e,t){const r=Ds(e),i=r.query||{};for(const n in t)i[n]=t[n];const s=tI(i);return s?`${r.path}?${s}`:r.path}function ree(e){if(R(e))return null;const t=e.match(vUe);return t?t[1]:null}const vUe=/.*?\.([^\/]*)$/,_Ue=/(^data:image\/svg|\.svg$)/i;function Xe(e,t,r){let i,s;return t===void 0?(s=e,i=[void 0]):typeof t!="string"?(s=e,i=[void 0],r=t):(s=t,i=Array.isArray(e)?e:[e]),(n,o)=>{const a=n.constructor.prototype;for(const l of i){const c=zK(n,l,s);c.write&&typeof c.write=="object"||(c.write={}),r&&(c.write.target=r),c.write.writer=a[o]}}}var Td;(function(e){e[e.CGCS2000=4490]="CGCS2000",e[e.GCSMARS2000=104971]="GCSMARS2000",e[e.GCSMARS2000_SPHERE=104905]="GCSMARS2000_SPHERE",e[e.GCSMOON2000=104903]="GCSMOON2000"})(Td||(Td={}));let y;const F={values:[1,.3048,.3048006096012192,.3047972654,.9143917962,.201166195164,.9143984146160287,.3047994715386762,20.11676512155263,20.11678249437587,.9143985307444408,.91439523,.3047997101815088,20.1168,20.116756,5e4,15e4],units:["Meter","Foot","Foot_US","Foot_Clarke","Yard_Clarke","Link_Clarke","Yard_Sears","Foot_Sears","Chain_Sears","Chain_Benoit_1895_B","Yard_Indian","Yard_Indian_1937","Foot_Gold_Coast","Chain","Chain_Sears_1922_Truncated","50_Kilometers","150_Kilometers"],2066:5,2136:12,2155:2,2157:0,2158:0,2159:12,2160:12,2204:2,2219:0,2220:0,2254:2,2255:2,2256:1,2265:1,2266:1,2267:2,2268:2,2269:1,2270:1,2271:2,2272:2,2273:1,2294:0,2295:0,2314:3,2899:2,2900:2,2901:1,2909:1,2910:1,2911:2,2912:2,2913:1,2914:1,2992:1,2993:0,2994:1,3080:1,3089:2,3090:0,3091:2,3102:2,3141:0,3142:0,3167:14,3359:2,3360:0,3361:1,3362:0,3363:2,3364:0,3365:2,3366:3,3404:2,3405:0,3406:0,3407:3,3439:0,3440:0,3479:1,3480:0,3481:1,3482:0,3483:1,3484:0,3485:2,3486:0,3487:2,3488:0,3489:0,3490:2,3491:0,3492:2,3493:0,3494:2,3495:0,3496:2,3497:0,3498:2,3499:0,3500:2,3501:0,3502:2,3503:0,3504:2,3505:0,3506:2,3507:0,3508:2,3509:0,3510:2,3511:0,3512:2,3513:0,3514:0,3515:2,3516:0,3517:2,3518:0,3519:2,3520:0,3521:2,3522:0,3523:2,3524:0,3525:2,3526:0,3527:2,3528:0,3529:2,3530:0,3531:2,3532:0,3533:2,3534:0,3535:2,3536:0,3537:2,3538:0,3539:2,3540:0,3541:2,3542:0,3543:2,3544:0,3545:2,3546:0,3547:2,3548:0,3549:2,3550:0,3551:2,3552:0,3553:2,3582:2,3583:0,3584:2,3585:0,3586:2,3587:0,3588:1,3589:0,3590:1,3591:0,3592:0,3593:1,3598:2,3599:0,3600:2,3605:1,3606:0,3607:0,3608:2,3609:0,3610:2,3611:0,3612:2,3613:0,3614:2,3615:0,3616:2,3617:0,3618:2,3619:0,3620:2,3621:0,3622:2,3623:0,3624:2,3625:0,3626:2,3627:0,3628:2,3629:0,3630:2,3631:0,3632:2,3633:0,3634:1,3635:0,3636:1,3640:2,3641:0,3642:2,3643:0,3644:1,3645:0,3646:1,3647:0,3648:1,3649:0,3650:2,3651:0,3652:2,3653:0,3654:2,3655:0,3656:1,3657:0,3658:2,3659:0,3660:2,3661:0,3662:2,3663:0,3664:2,3668:2,3669:0,3670:2,3671:0,3672:2,3673:0,3674:2,3675:0,3676:1,3677:2,3678:0,3679:1,3680:2,3681:0,3682:1,3683:2,3684:0,3685:0,3686:2,3687:0,3688:2,3689:0,3690:2,3691:0,3692:2,3696:2,3697:0,3698:2,3699:0,3700:2,3793:0,3794:0,3812:0,3854:0,3857:0,3920:0,3978:0,3979:0,3991:2,3992:2,4026:0,4037:0,4038:0,4071:0,4082:0,4083:0,4087:0,4088:0,4217:2,4414:0,4415:0,4417:0,4434:0,4437:0,4438:2,4439:2,4462:0,4467:0,4471:0,4474:0,4559:0,4647:0,4822:0,4826:0,4839:0,5018:0,5048:0,5167:0,5168:0,5221:0,5223:0,5234:0,5235:0,5243:0,5247:0,5266:0,5316:0,5320:0,5321:0,5325:0,5337:0,5361:0,5362:0,5367:0,5382:0,5383:0,5396:0,5456:0,5457:0,5469:0,5472:4,5490:0,5513:0,5514:0,5523:0,5559:0,5588:1,5589:3,5596:0,5627:0,5629:0,5641:0,5643:0,5644:0,5646:2,5654:2,5655:2,5659:0,5700:0,5825:0,5836:0,5837:0,5839:0,5842:0,5844:0,5858:0,5879:0,5880:0,5887:0,5890:0,6128:1,6129:1,6141:1,6204:0,6210:0,6211:0,6307:0,6312:0,6316:0,6362:0,6391:1,6405:1,6406:0,6407:1,6408:0,6409:1,6410:0,6411:2,6412:0,6413:2,6414:0,6415:0,6416:2,6417:0,6418:2,6419:0,6420:2,6421:0,6422:2,6423:0,6424:2,6425:0,6426:2,6427:0,6428:2,6429:0,6430:2,6431:0,6432:2,6433:0,6434:2,6435:0,6436:2,6437:0,6438:2,6439:0,6440:0,6441:2,6442:0,6443:2,6444:0,6445:2,6446:0,6447:2,6448:0,6449:2,6450:0,6451:2,6452:0,6453:2,6454:0,6455:2,6456:0,6457:2,6458:0,6459:2,6460:0,6461:2,6462:0,6463:2,6464:0,6465:2,6466:0,6467:2,6468:0,6469:2,6470:0,6471:2,6472:0,6473:2,6474:0,6475:2,6476:0,6477:2,6478:0,6479:2,6484:2,6485:0,6486:2,6487:0,6488:2,6489:0,6490:2,6491:0,6492:2,6493:0,6494:1,6495:0,6496:1,6497:0,6498:0,6499:1,6500:0,6501:2,6502:0,6503:2,6504:0,6505:2,6506:0,6507:2,6508:0,6509:0,6510:2,6515:1,6516:0,6518:0,6519:2,6520:0,6521:2,6522:0,6523:2,6524:0,6525:2,6526:0,6527:2,6528:0,6529:2,6530:0,6531:2,6532:0,6533:2,6534:0,6535:2,6536:0,6537:2,6538:0,6539:2,6540:0,6541:2,6542:0,6543:2,6544:0,6545:1,6546:0,6547:1,6548:0,6549:2,6550:0,6551:2,6552:0,6553:2,6554:0,6555:2,6556:0,6557:1,6558:0,6559:1,6560:0,6561:1,6562:0,6563:2,6564:0,6565:2,6566:0,6567:0,6568:2,6569:0,6570:1,6571:0,6572:2,6573:0,6574:2,6575:0,6576:2,6577:0,6578:2,6582:2,6583:0,6584:2,6585:0,6586:2,6587:0,6588:2,6589:0,6590:2,6591:0,6592:0,6593:2,6594:0,6595:2,6596:0,6597:2,6598:0,6599:2,6600:0,6601:2,6602:0,6603:2,6605:2,6606:0,6607:2,6608:0,6609:2,6610:0,6611:0,6612:2,6613:0,6614:2,6615:0,6616:2,6617:0,6618:2,6633:2,6646:0,6703:0,6784:0,6785:1,6786:0,6787:1,6788:0,6789:1,6790:0,6791:1,6792:0,6793:1,6794:0,6795:1,6796:0,6797:1,6798:0,6799:1,6800:0,6801:1,6802:0,6803:1,6804:0,6805:1,6806:0,6807:1,6808:0,6809:1,6810:0,6811:1,6812:0,6813:1,6814:0,6815:1,6816:0,6817:1,6818:0,6819:1,6820:0,6821:1,6822:0,6823:1,6824:0,6825:1,6826:0,6827:1,6828:0,6829:1,6830:0,6831:1,6832:0,6833:1,6834:0,6835:1,6836:0,6837:1,6838:0,6839:1,6840:0,6841:1,6842:0,6843:1,6844:0,6845:1,6846:0,6847:1,6848:0,6849:1,6850:0,6851:1,6852:0,6853:1,6854:0,6855:1,6856:0,6857:1,6858:0,6859:1,6860:0,6861:1,6862:0,6863:1,6867:0,6868:1,6870:0,6875:0,6876:0,6879:0,6880:2,6884:0,6885:1,6886:0,6887:1,6915:0,6922:0,6923:2,6924:0,6925:2,6962:0,6984:0,6991:0,7128:2,7131:0,7132:2,7142:0,7257:0,7258:2,7259:0,7260:2,7261:0,7262:2,7263:0,7264:2,7265:0,7266:2,7267:0,7268:2,7269:0,7270:2,7271:0,7272:2,7273:0,7274:2,7275:0,7276:2,7277:0,7278:2,7279:0,7280:2,7281:0,7282:2,7283:0,7284:2,7285:0,7286:2,7287:0,7288:2,7289:0,7290:2,7291:0,7292:2,7293:0,7294:2,7295:0,7296:2,7297:0,7298:2,7299:0,7300:2,7301:0,7302:2,7303:0,7304:2,7305:0,7306:2,7307:0,7308:2,7309:0,7310:2,7311:0,7312:2,7313:0,7314:2,7315:0,7316:2,7317:0,7318:2,7319:0,7320:2,7321:0,7322:2,7323:0,7324:2,7325:0,7326:2,7327:0,7328:2,7329:0,7330:2,7331:0,7332:2,7333:0,7334:2,7335:0,7336:2,7337:0,7338:2,7339:0,7340:2,7341:0,7342:2,7343:0,7344:2,7345:0,7346:2,7347:0,7348:2,7349:0,7350:2,7351:0,7352:2,7353:0,7354:2,7355:0,7356:2,7357:0,7358:2,7359:0,7360:2,7361:0,7362:2,7363:0,7364:2,7365:0,7366:2,7367:0,7368:2,7369:0,7370:2,7877:0,7878:0,7882:0,7883:0,7887:0,7899:0,7991:0,7992:0,8035:2,8036:2,8058:0,8059:0,8082:0,8083:0,8088:0,8090:0,8091:2,8092:0,8093:2,8095:0,8096:2,8097:0,8098:2,8099:0,8100:2,8101:0,8102:2,8103:0,8104:2,8105:0,8106:2,8107:0,8108:2,8109:0,8110:2,8111:0,8112:2,8113:0,8114:2,8115:0,8116:2,8117:0,8118:2,8119:0,8120:2,8121:0,8122:2,8123:0,8124:2,8125:0,8126:2,8127:0,8128:2,8129:0,8130:2,8131:0,8132:2,8133:0,8134:2,8135:0,8136:2,8137:0,8138:2,8139:0,8140:2,8141:0,8142:2,8143:0,8144:2,8145:0,8146:2,8147:0,8148:2,8149:0,8150:2,8151:0,8152:2,8153:0,8154:2,8155:0,8156:2,8157:0,8158:2,8159:0,8160:2,8161:0,8162:2,8163:0,8164:2,8165:0,8166:2,8167:0,8168:2,8169:0,8170:2,8171:0,8172:2,8173:0,8177:2,8179:0,8180:2,8181:0,8182:2,8184:0,8185:2,8187:0,8189:2,8191:0,8193:2,8196:0,8197:2,8198:0,8200:2,8201:0,8202:2,8203:0,8204:2,8205:0,8206:2,8207:0,8208:2,8209:0,8210:2,8212:0,8213:2,8214:0,8216:2,8218:0,8220:2,8222:0,8224:2,8225:0,8226:2,8311:0,8312:1,8313:0,8314:1,8315:0,8316:1,8317:0,8318:1,8319:0,8320:1,8321:0,8322:1,8323:0,8324:1,8325:0,8326:1,8327:0,8328:1,8329:0,8330:1,8331:0,8332:1,8333:0,8334:1,8335:0,8336:1,8337:0,8338:1,8339:0,8340:1,8341:0,8342:1,8343:0,8344:1,8345:0,8346:1,8347:0,8348:1,8352:0,8353:0,8379:0,8380:2,8381:0,8382:2,8383:0,8384:2,8385:0,8387:2,8391:0,8395:0,8433:0,8441:0,8455:0,8456:0,8531:2,8682:0,8686:0,8687:0,8692:0,8693:0,8826:0,8903:0,8950:0,8951:0,9039:0,9040:0,9141:0,9149:0,9150:0,9191:0,9221:0,9222:0,9249:0,9250:0,9252:0,9254:0,9265:0,9284:0,9285:0,9300:0,9354:0,9367:0,9373:0,9377:0,9387:0,9391:0,9456:0,9473:0,9498:0,9674:0,9678:0,9680:0,9709:0,9712:0,9713:0,9716:0,9741:0,9748:2,9749:2,9761:0,9766:0,20499:0,20538:0,20539:0,20790:0,20791:0,21291:0,21292:0,21500:0,21817:0,21818:0,22032:0,22033:0,22091:0,22092:0,22332:0,22391:0,22392:0,22700:0,22770:0,22780:0,22832:0,23090:0,23095:0,23239:0,23240:0,23433:0,23700:0,24047:0,24048:0,24100:3,24200:0,24305:0,24306:0,24382:10,24383:0,24500:0,24547:0,24548:0,24571:9,24600:0,25e3:0,25231:0,25884:0,25932:0,26237:0,26331:0,26332:0,26432:0,26591:0,26592:0,26632:0,26692:0,27120:0,27200:0,27291:6,27292:6,27429:0,27492:0,27493:0,27500:0,27700:0,28232:0,28600:0,28991:0,28992:0,29100:0,29101:0,29220:0,29221:0,29333:0,29635:0,29636:0,29701:0,29738:0,29739:0,29849:0,29850:0,29871:8,29872:7,29873:0,29874:0,30200:5,30339:0,30340:0,30591:0,30592:0,30791:0,30792:0,30800:0,31028:0,31121:0,31154:0,31170:0,31171:0,31370:0,31528:0,31529:0,31600:0,31700:0,31838:0,31839:0,31900:0,31901:0,32061:0,32062:0,32098:0,32099:2,32100:0,32104:0,32161:0,32766:0,53048:0,53049:0,54090:0,54091:0,65061:2,65062:2,65161:0,65163:0,102041:2,102064:11,102068:15,102069:16,102118:2,102119:1,102120:2,102121:2,102217:2,102218:0,102219:2,102220:2,102378:1,102379:1,102380:0,102381:1,102589:2,102599:2,102600:2,102604:2,102647:0,102704:2,102705:2,102706:0,102759:1,102760:1,102761:2,102762:0,102763:2,102764:0,102765:0,102766:2,102970:1,102974:2,102993:0,102994:0,102995:2,102996:2,103015:0,103016:2,103017:0,103018:2,103025:0,103026:0,103027:2,103028:2,103035:0,103036:0,103037:2,103038:2,103039:0,103040:0,103041:2,103042:2,103043:0,103044:0,103045:2,103046:2,103047:0,103048:0,103049:2,103050:2,103051:0,103052:2,103053:0,103054:2,103055:0,103056:2,103057:0,103058:0,103059:2,103060:2,103061:0,103062:0,103063:2,103064:2,103069:2,103070:0,103071:0,103072:2,103073:2,103086:0,103087:0,103088:2,103089:2,103094:1,103095:0,103096:2,103103:0,103104:2,103105:0,103106:2,103121:0,103122:2,103123:0,103124:0,103125:1,103126:1,103127:0,103128:0,103129:2,103130:2,103131:0,103132:0,103133:2,103134:2,103135:0,103136:0,103137:1,103138:1,103139:0,103140:2,103141:0,103142:2,103143:0,103144:2,103145:0,103146:1,103147:0,103148:0,103149:2,103150:2,103151:0,103152:2,103172:0,103173:2,103174:0,103175:0,103176:2,103177:2,103178:0,103179:0,103180:2,103181:2,103182:0,103183:0,103184:2,103185:2,103228:0,103229:0,103230:2,103231:2,103250:0,103251:2,103252:0,103253:2,103260:0,103261:0,103262:2,103263:2,103270:0,103271:0,103272:2,103273:2,103274:0,103275:0,103276:2,103277:2,103278:0,103279:0,103280:2,103281:2,103282:0,103283:0,103284:2,103285:2,103286:0,103287:2,103288:0,103289:2,103290:0,103291:2,103292:0,103293:0,103294:2,103295:2,103296:0,103297:0,103298:2,103299:2,103376:2,103377:0,103378:0,103379:2,103380:2,103393:0,103394:0,103395:2,103396:2,103472:0,103473:1,103474:0,103475:2,103482:0,103483:2,103484:0,103485:2,103500:0,103501:2,103502:0,103503:0,103504:1,103505:1,103506:0,103507:0,103508:2,103509:2,103510:0,103511:0,103512:2,103513:2,103514:0,103515:2,103516:0,103517:2,103518:0,103519:2,103520:0,103521:1,103522:0,103523:0,103524:2,103525:2,103526:0,103527:2,103561:2,103562:2,103563:0,103564:0,103565:2,103566:2,103567:0,103568:0,103569:2,103570:2,103584:0,103585:2,103586:0,103587:2,103588:1,103589:0,103590:2,103591:1,103592:0,103593:2,103594:1,103695:2};for(y=2e3;y<=2045;y++)F[y]=0;for(y=2056;y<=2065;y++)F[y]=0;for(y=2067;y<=2135;y++)F[y]=0;for(y=2137;y<=2154;y++)F[y]=0;for(y=2161;y<=2170;y++)F[y]=0;for(y=2172;y<=2193;y++)F[y]=0;for(y=2195;y<=2198;y++)F[y]=0;for(y=2200;y<=2203;y++)F[y]=0;for(y=2205;y<=2217;y++)F[y]=0;for(y=2222;y<=2224;y++)F[y]=1;for(y=2225;y<=2250;y++)F[y]=2;for(y=2251;y<=2253;y++)F[y]=1;for(y=2257;y<=2264;y++)F[y]=2;for(y=2274;y<=2279;y++)F[y]=2;for(y=2280;y<=2282;y++)F[y]=1;for(y=2283;y<=2289;y++)F[y]=2;for(y=2290;y<=2292;y++)F[y]=0;for(y=2308;y<=2313;y++)F[y]=0;for(y=2315;y<=2491;y++)F[y]=0;for(y=2494;y<=2866;y++)F[y]=0;for(y=2867;y<=2869;y++)F[y]=1;for(y=2870;y<=2888;y++)F[y]=2;for(y=2891;y<=2895;y++)F[y]=2;for(y=2896;y<=2898;y++)F[y]=1;for(y=2902;y<=2908;y++)F[y]=2;for(y=2915;y<=2920;y++)F[y]=2;for(y=2921;y<=2923;y++)F[y]=1;for(y=2924;y<=2930;y++)F[y]=2;for(y=2931;y<=2962;y++)F[y]=0;for(y=2964;y<=2968;y++)F[y]=2;for(y=2969;y<=2973;y++)F[y]=0;for(y=2975;y<=2991;y++)F[y]=0;for(y=2995;y<=3051;y++)F[y]=0;for(y=3054;y<=3079;y++)F[y]=0;for(y=3081;y<=3088;y++)F[y]=0;for(y=3092;y<=3101;y++)F[y]=0;for(y=3106;y<=3138;y++)F[y]=0;for(y=3146;y<=3151;y++)F[y]=0;for(y=3153;y<=3166;y++)F[y]=0;for(y=3168;y<=3172;y++)F[y]=0;for(y=3174;y<=3203;y++)F[y]=0;for(y=3294;y<=3358;y++)F[y]=0;for(y=3367;y<=3403;y++)F[y]=0;for(y=3408;y<=3416;y++)F[y]=0;for(y=3417;y<=3438;y++)F[y]=2;for(y=3441;y<=3446;y++)F[y]=2;for(y=3447;y<=3450;y++)F[y]=0;for(y=3451;y<=3459;y++)F[y]=2;for(y=3460;y<=3478;y++)F[y]=0;for(y=3554;y<=3559;y++)F[y]=0;for(y=3560;y<=3570;y++)F[y]=2;for(y=3571;y<=3581;y++)F[y]=0;for(y=3594;y<=3597;y++)F[y]=0;for(y=3601;y<=3604;y++)F[y]=0;for(y=3637;y<=3639;y++)F[y]=0;for(y=3665;y<=3667;y++)F[y]=0;for(y=3693;y<=3695;y++)F[y]=0;for(y=3701;y<=3727;y++)F[y]=0;for(y=3728;y<=3739;y++)F[y]=2;for(y=3740;y<=3751;y++)F[y]=0;for(y=3753;y<=3760;y++)F[y]=2;for(y=3761;y<=3773;y++)F[y]=0;for(y=3775;y<=3777;y++)F[y]=0;for(y=3779;y<=3781;y++)F[y]=0;for(y=3783;y<=3785;y++)F[y]=0;for(y=3788;y<=3791;y++)F[y]=0;for(y=3797;y<=3802;y++)F[y]=0;for(y=3814;y<=3816;y++)F[y]=0;for(y=3825;y<=3829;y++)F[y]=0;for(y=3832;y<=3841;y++)F[y]=0;for(y=3844;y<=3852;y++)F[y]=0;for(y=3873;y<=3885;y++)F[y]=0;for(y=3890;y<=3893;y++)F[y]=0;for(y=3907;y<=3912;y++)F[y]=0;for(y=3942;y<=3950;y++)F[y]=0;for(y=3968;y<=3970;y++)F[y]=0;for(y=3973;y<=3976;y++)F[y]=0;for(y=3986;y<=3989;y++)F[y]=0;for(y=3994;y<=3997;y++)F[y]=0;for(y=4048;y<=4051;y++)F[y]=0;for(y=4056;y<=4063;y++)F[y]=0;for(y=4093;y<=4096;y++)F[y]=0;for(y=4390;y<=4398;y++)F[y]=0;for(y=4399;y<=4413;y++)F[y]=2;for(y=4418;y<=4433;y++)F[y]=2;for(y=4455;y<=4457;y++)F[y]=2;for(y=4484;y<=4489;y++)F[y]=0;for(y=4491;y<=4554;y++)F[y]=0;for(y=4568;y<=4589;y++)F[y]=0;for(y=4652;y<=4656;y++)F[y]=0;for(y=4766;y<=4800;y++)F[y]=0;for(y=5014;y<=5016;y++)F[y]=0;for(y=5069;y<=5072;y++)F[y]=0;for(y=5105;y<=5130;y++)F[y]=0;for(y=5173;y<=5188;y++)F[y]=0;for(y=5253;y<=5259;y++)F[y]=0;for(y=5269;y<=5275;y++)F[y]=0;for(y=5292;y<=5311;y++)F[y]=0;for(y=5329;y<=5331;y++)F[y]=0;for(y=5343;y<=5349;y++)F[y]=0;for(y=5355;y<=5357;y++)F[y]=0;for(y=5387;y<=5389;y++)F[y]=0;for(y=5459;y<=5463;y++)F[y]=0;for(y=5479;y<=5482;y++)F[y]=0;for(y=5518;y<=5520;y++)F[y]=0;for(y=5530;y<=5539;y++)F[y]=0;for(y=5550;y<=5552;y++)F[y]=0;for(y=5562;y<=5583;y++)F[y]=0;for(y=5623;y<=5625;y++)F[y]=2;for(y=5631;y<=5639;y++)F[y]=0;for(y=5649;y<=5653;y++)F[y]=0;for(y=5663;y<=5680;y++)F[y]=0;for(y=5682;y<=5685;y++)F[y]=0;for(y=5875;y<=5877;y++)F[y]=0;for(y=5896;y<=5899;y++)F[y]=0;for(y=5921;y<=5940;y++)F[y]=0;for(y=6050;y<=6125;y++)F[y]=0;for(y=6244;y<=6275;y++)F[y]=0;for(y=6328;y<=6348;y++)F[y]=0;for(y=6350;y<=6356;y++)F[y]=0;for(y=6366;y<=6372;y++)F[y]=0;for(y=6381;y<=6387;y++)F[y]=0;for(y=6393;y<=6404;y++)F[y]=0;for(y=6480;y<=6483;y++)F[y]=0;for(y=6511;y<=6514;y++)F[y]=0;for(y=6579;y<=6581;y++)F[y]=0;for(y=6619;y<=6624;y++)F[y]=0;for(y=6625;y<=6627;y++)F[y]=2;for(y=6628;y<=6632;y++)F[y]=0;for(y=6634;y<=6637;y++)F[y]=0;for(y=6669;y<=6692;y++)F[y]=0;for(y=6707;y<=6709;y++)F[y]=0;for(y=6720;y<=6723;y++)F[y]=0;for(y=6732;y<=6738;y++)F[y]=0;for(y=6931;y<=6933;y++)F[y]=0;for(y=6956;y<=6959;y++)F[y]=0;for(y=7005;y<=7007;y++)F[y]=0;for(y=7057;y<=7070;y++)F[y]=2;for(y=7074;y<=7082;y++)F[y]=0;for(y=7109;y<=7118;y++)F[y]=0;for(y=7119;y<=7127;y++)F[y]=1;for(y=7374;y<=7376;y++)F[y]=0;for(y=7528;y<=7586;y++)F[y]=0;for(y=7587;y<=7645;y++)F[y]=2;for(y=7692;y<=7696;y++)F[y]=0;for(y=7755;y<=7787;y++)F[y]=0;for(y=7791;y<=7795;y++)F[y]=0;for(y=7799;y<=7801;y++)F[y]=0;for(y=7803;y<=7805;y++)F[y]=0;for(y=7825;y<=7831;y++)F[y]=0;for(y=7845;y<=7859;y++)F[y]=0;for(y=8013;y<=8032;y++)F[y]=0;for(y=8065;y<=8068;y++)F[y]=1;for(y=8518;y<=8529;y++)F[y]=2;for(y=8533;y<=8536;y++)F[y]=2;for(y=8538;y<=8540;y++)F[y]=2;for(y=8677;y<=8679;y++)F[y]=0;for(y=8836;y<=8840;y++)F[y]=0;for(y=8857;y<=8859;y++)F[y]=0;for(y=8908;y<=8910;y++)F[y]=0;for(y=9154;y<=9159;y++)F[y]=0;for(y=9205;y<=9218;y++)F[y]=0;for(y=9271;y<=9273;y++)F[y]=0;for(y=9295;y<=9297;y++)F[y]=0;for(y=9356;y<=9360;y++)F[y]=0;for(y=9404;y<=9407;y++)F[y]=0;for(y=9476;y<=9482;y++)F[y]=0;for(y=9487;y<=9494;y++)F[y]=0;for(y=9697;y<=9699;y++)F[y]=0;for(y=20002;y<=20032;y++)F[y]=0;for(y=20062;y<=20092;y++)F[y]=0;for(y=20135;y<=20138;y++)F[y]=0;for(y=20248;y<=20258;y++)F[y]=0;for(y=20348;y<=20358;y++)F[y]=0;for(y=20436;y<=20440;y++)F[y]=0;for(y=20822;y<=20824;y++)F[y]=0;for(y=20904;y<=20932;y++)F[y]=0;for(y=20934;y<=20936;y++)F[y]=0;for(y=21004;y<=21032;y++)F[y]=0;for(y=21035;y<=21037;y++)F[y]=0;for(y=21095;y<=21097;y++)F[y]=0;for(y=21148;y<=21150;y++)F[y]=0;for(y=21207;y<=21264;y++)F[y]=0;for(y=21307;y<=21364;y++)F[y]=0;for(y=21413;y<=21423;y++)F[y]=0;for(y=21453;y<=21463;y++)F[y]=0;for(y=21473;y<=21483;y++)F[y]=0;for(y=21780;y<=21782;y++)F[y]=0;for(y=21891;y<=21894;y++)F[y]=0;for(y=21896;y<=21899;y++)F[y]=0;for(y=22171;y<=22177;y++)F[y]=0;for(y=22181;y<=22187;y++)F[y]=0;for(y=22191;y<=22197;y++)F[y]=0;for(y=22234;y<=22236;y++)F[y]=0;for(y=22521;y<=22525;y++)F[y]=0;for(y=22991;y<=22994;y++)F[y]=0;for(y=23028;y<=23038;y++)F[y]=0;for(y=23830;y<=23853;y++)F[y]=0;for(y=23866;y<=23872;y++)F[y]=0;for(y=23877;y<=23884;y++)F[y]=0;for(y=23886;y<=23894;y++)F[y]=0;for(y=23946;y<=23948;y++)F[y]=0;for(y=24311;y<=24313;y++)F[y]=0;for(y=24342;y<=24347;y++)F[y]=0;for(y=24370;y<=24374;y++)F[y]=10;for(y=24375;y<=24381;y++)F[y]=0;for(y=24718;y<=24721;y++)F[y]=0;for(y=24817;y<=24821;y++)F[y]=0;for(y=24877;y<=24882;y++)F[y]=0;for(y=24891;y<=24893;y++)F[y]=0;for(y=25391;y<=25395;y++)F[y]=0;for(y=25828;y<=25838;y++)F[y]=0;for(y=26191;y<=26195;y++)F[y]=0;for(y=26391;y<=26393;y++)F[y]=0;for(y=26701;y<=26722;y++)F[y]=0;for(y=26729;y<=26799;y++)F[y]=2;for(y=26801;y<=26803;y++)F[y]=2;for(y=26811;y<=26813;y++)F[y]=2;for(y=26847;y<=26870;y++)F[y]=2;for(y=26891;y<=26899;y++)F[y]=0;for(y=26901;y<=26923;y++)F[y]=0;for(y=26929;y<=26946;y++)F[y]=0;for(y=26948;y<=26998;y++)F[y]=0;for(y=27037;y<=27040;y++)F[y]=0;for(y=27205;y<=27232;y++)F[y]=0;for(y=27258;y<=27260;y++)F[y]=0;for(y=27391;y<=27398;y++)F[y]=0;for(y=27561;y<=27564;y++)F[y]=0;for(y=27571;y<=27574;y++)F[y]=0;for(y=27581;y<=27584;y++)F[y]=0;for(y=27591;y<=27594;y++)F[y]=0;for(y=28191;y<=28193;y++)F[y]=0;for(y=28348;y<=28358;y++)F[y]=0;for(y=28402;y<=28432;y++)F[y]=0;for(y=28462;y<=28492;y++)F[y]=0;for(y=29118;y<=29122;y++)F[y]=0;for(y=29168;y<=29172;y++)F[y]=0;for(y=29177;y<=29185;y++)F[y]=0;for(y=29187;y<=29195;y++)F[y]=0;for(y=29900;y<=29903;y++)F[y]=0;for(y=30161;y<=30179;y++)F[y]=0;for(y=30491;y<=30494;y++)F[y]=0;for(y=30729;y<=30732;y++)F[y]=0;for(y=31251;y<=31259;y++)F[y]=0;for(y=31265;y<=31268;y++)F[y]=0;for(y=31275;y<=31279;y++)F[y]=0;for(y=31281;y<=31297;y++)F[y]=0;for(y=31461;y<=31469;y++)F[y]=0;for(y=31491;y<=31495;y++)F[y]=0;for(y=31917;y<=31922;y++)F[y]=0;for(y=31965;y<=32e3;y++)F[y]=0;for(y=32001;y<=32003;y++)F[y]=2;for(y=32005;y<=32031;y++)F[y]=2;for(y=32033;y<=32060;y++)F[y]=2;for(y=32064;y<=32067;y++)F[y]=2;for(y=32074;y<=32077;y++)F[y]=2;for(y=32081;y<=32086;y++)F[y]=0;for(y=32107;y<=32130;y++)F[y]=0;for(y=32133;y<=32158;y++)F[y]=0;for(y=32164;y<=32167;y++)F[y]=2;for(y=32180;y<=32199;y++)F[y]=0;for(y=32201;y<=32260;y++)F[y]=0;for(y=32301;y<=32360;y++)F[y]=0;for(y=32601;y<=32662;y++)F[y]=0;for(y=32664;y<=32667;y++)F[y]=2;for(y=32701;y<=32761;y++)F[y]=0;for(y=53001;y<=53004;y++)F[y]=0;for(y=53008;y<=53019;y++)F[y]=0;for(y=53021;y<=53032;y++)F[y]=0;for(y=53034;y<=53037;y++)F[y]=0;for(y=53042;y<=53046;y++)F[y]=0;for(y=53074;y<=53080;y++)F[y]=0;for(y=54001;y<=54004;y++)F[y]=0;for(y=54008;y<=54019;y++)F[y]=0;for(y=54021;y<=54032;y++)F[y]=0;for(y=54034;y<=54037;y++)F[y]=0;for(y=54042;y<=54046;y++)F[y]=0;for(y=54048;y<=54053;y++)F[y]=0;for(y=54074;y<=54080;y++)F[y]=0;for(y=54098;y<=54101;y++)F[y]=0;for(y=102001;y<=102040;y++)F[y]=0;for(y=102042;y<=102063;y++)F[y]=0;for(y=102065;y<=102067;y++)F[y]=0;for(y=102070;y<=102117;y++)F[y]=0;for(y=102122;y<=102216;y++)F[y]=0;for(y=102221;y<=102377;y++)F[y]=0;for(y=102382;y<=102388;y++)F[y]=0;for(y=102389;y<=102398;y++)F[y]=2;for(y=102399;y<=102444;y++)F[y]=0;for(y=102445;y<=102447;y++)F[y]=2;for(y=102448;y<=102458;y++)F[y]=0;for(y=102459;y<=102468;y++)F[y]=2;for(y=102469;y<=102499;y++)F[y]=0;for(y=102500;y<=102519;y++)F[y]=1;for(y=102520;y<=102524;y++)F[y]=0;for(y=102525;y<=102529;y++)F[y]=2;for(y=102530;y<=102588;y++)F[y]=0;for(y=102590;y<=102598;y++)F[y]=0;for(y=102601;y<=102603;y++)F[y]=0;for(y=102605;y<=102628;y++)F[y]=0;for(y=102629;y<=102646;y++)F[y]=2;for(y=102648;y<=102700;y++)F[y]=2;for(y=102701;y<=102703;y++)F[y]=0;for(y=102707;y<=102730;y++)F[y]=2;for(y=102733;y<=102758;y++)F[y]=2;for(y=102767;y<=102900;y++)F[y]=0;for(y=102901;y<=102933;y++)F[y]=2;for(y=102934;y<=102950;y++)F[y]=13;for(y=102951;y<=102955;y++)F[y]=0;for(y=102961;y<=102963;y++)F[y]=0;for(y=102965;y<=102969;y++)F[y]=0;for(y=102971;y<=102973;y++)F[y]=0;for(y=102975;y<=102989;y++)F[y]=0;for(y=102990;y<=102992;y++)F[y]=1;for(y=102997;y<=103002;y++)F[y]=0;for(y=103003;y<=103008;y++)F[y]=2;for(y=103009;y<=103011;y++)F[y]=0;for(y=103012;y<=103014;y++)F[y]=2;for(y=103019;y<=103021;y++)F[y]=0;for(y=103022;y<=103024;y++)F[y]=2;for(y=103029;y<=103031;y++)F[y]=0;for(y=103032;y<=103034;y++)F[y]=2;for(y=103065;y<=103068;y++)F[y]=0;for(y=103074;y<=103076;y++)F[y]=0;for(y=103077;y<=103079;y++)F[y]=1;for(y=103080;y<=103082;y++)F[y]=0;for(y=103083;y<=103085;y++)F[y]=2;for(y=103090;y<=103093;y++)F[y]=0;for(y=103097;y<=103099;y++)F[y]=0;for(y=103100;y<=103102;y++)F[y]=2;for(y=103107;y<=103109;y++)F[y]=0;for(y=103110;y<=103112;y++)F[y]=2;for(y=103113;y<=103116;y++)F[y]=0;for(y=103117;y<=103120;y++)F[y]=2;for(y=103153;y<=103157;y++)F[y]=0;for(y=103158;y<=103162;y++)F[y]=2;for(y=103163;y<=103165;y++)F[y]=0;for(y=103166;y<=103168;y++)F[y]=1;for(y=103169;y<=103171;y++)F[y]=2;for(y=103186;y<=103188;y++)F[y]=0;for(y=103189;y<=103191;y++)F[y]=2;for(y=103192;y<=103195;y++)F[y]=0;for(y=103196;y<=103199;y++)F[y]=2;for(y=103200;y<=103224;y++)F[y]=0;for(y=103225;y<=103227;y++)F[y]=1;for(y=103232;y<=103237;y++)F[y]=0;for(y=103238;y<=103243;y++)F[y]=2;for(y=103244;y<=103246;y++)F[y]=0;for(y=103247;y<=103249;y++)F[y]=2;for(y=103254;y<=103256;y++)F[y]=0;for(y=103257;y<=103259;y++)F[y]=2;for(y=103264;y<=103266;y++)F[y]=0;for(y=103267;y<=103269;y++)F[y]=2;for(y=103300;y<=103375;y++)F[y]=0;for(y=103381;y<=103383;y++)F[y]=0;for(y=103384;y<=103386;y++)F[y]=1;for(y=103387;y<=103389;y++)F[y]=0;for(y=103390;y<=103392;y++)F[y]=2;for(y=103397;y<=103399;y++)F[y]=0;for(y=103400;y<=103471;y++)F[y]=2;for(y=103476;y<=103478;y++)F[y]=0;for(y=103479;y<=103481;y++)F[y]=2;for(y=103486;y<=103488;y++)F[y]=0;for(y=103489;y<=103491;y++)F[y]=2;for(y=103492;y<=103495;y++)F[y]=0;for(y=103496;y<=103499;y++)F[y]=2;for(y=103528;y<=103543;y++)F[y]=0;for(y=103544;y<=103548;y++)F[y]=2;for(y=103549;y<=103551;y++)F[y]=0;for(y=103552;y<=103554;y++)F[y]=1;for(y=103555;y<=103557;y++)F[y]=2;for(y=103558;y<=103560;y++)F[y]=0;for(y=103571;y<=103573;y++)F[y]=0;for(y=103574;y<=103576;y++)F[y]=2;for(y=103577;y<=103580;y++)F[y]=0;for(y=103581;y<=103583;y++)F[y]=2;for(y=103595;y<=103694;y++)F[y]=0;for(y=103696;y<=103699;y++)F[y]=0;for(y=103700;y<=103793;y++)F[y]=2;for(y=103794;y<=103887;y++)F[y]=0;for(y=103900;y<=103971;y++)F[y]=2;const bUe={102113:!0,102100:!0,3857:!0,3785:!0},wUe={4326:!0,3785:!0,3857:!0,102113:!0,102100:!0,104905:!0,104971:!0},pae='PROJCS["WGS_1984_Web_Mercator_Auxiliary_Sphere",GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Mercator_Auxiliary_Sphere"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],PARAMETER["Standard_Parallel_1",0.0],PARAMETER["Auxiliary_Sphere_Type",0.0],UNIT["Meter",1.0]]',bD=[-20037508342788905e-9,20037508342788905e-9],wD=[-20037508342787e-6,20037508342787e-6],hbe={102113:{wkTemplate:'PROJCS["WGS_1984_Web_Mercator",GEOGCS["GCS_WGS_1984_Major_Auxiliary_Sphere",DATUM["D_WGS_1984_Major_Auxiliary_Sphere",SPHEROID["WGS_1984_Major_Auxiliary_Sphere",6378137.0,0.0]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Mercator"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],PARAMETER["Standard_Parallel_1",0.0],UNIT["Meter",1.0]]',valid:bD,origin:wD,dx:1e-5},102100:{wkTemplate:pae,valid:bD,origin:wD,dx:1e-5},3785:{wkTemplate:'PROJCS["WGS_1984_Web_Mercator",GEOGCS["GCS_WGS_1984_Major_Auxiliary_Sphere",DATUM["D_WGS_1984_Major_Auxiliary_Sphere",SPHEROID["WGS_1984_Major_Auxiliary_Sphere",6378137.0,0.0]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Mercator"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],PARAMETER["Standard_Parallel_1",0.0],UNIT["Meter",1.0]]',valid:bD,origin:wD,dx:1e-5},3857:{wkTemplate:pae,valid:bD,origin:wD,dx:1e-5},4326:{wkTemplate:'GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",{Central_Meridian}],UNIT["Degree",0.0174532925199433]]',altTemplate:'PROJCS["WGS_1984_Plate_Carree",GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Plate_Carree"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],UNIT["Degrees",111319.491]]',valid:[-180,180],origin:[-180,90],dx:1e-5},104971:{wkTemplate:'GEOGCS["Mars_2000_(Sphere)",DATUM["Mars_2000_(Sphere)",SPHEROID["Mars_2000_(Sphere)",3396190.0,0.0]],PRIMEM["Reference_Meridian",0.0],UNIT["Degree",0.0174532925199433]]',valid:[-180,180],origin:[-180,90],dx:1e-5},104905:{wkTemplate:'GEOGCS["GCS_Mars_2000",DATUM["D_Mars_2000",SPHEROID["Mars_2000_IAU_IAG",3396190.0,169.8944472236118]],PRIMEM["Reference_Meridian",0.0],UNIT["Degree",0.0174532925199433]]',valid:[-180,180],origin:[-180,90],dx:1e-5}};function ml(e,t){return!R(e)&&!R(t)&&(e===t||(e.wkid!=null||t.wkid!=null?e.wkid===t.wkid||sT(e)&&sT(t)||t.latestWkid!=null&&e.wkid===t.latestWkid||e.latestWkid!=null&&t.wkid===e.latestWkid:!(!e.wkt||!t.wkt)&&e.wkt.toUpperCase()===t.wkt.toUpperCase()))}function a1(e){return nc(e)&&e.wkid&&hbe[e.wkid]||null}function dbe(e){return!!nc(e)&&(e.wkid?F[e.wkid]==null:!!e.wkt&&!!/^\s*GEOGCS/i.test(e.wkt))}function iI(e){return!(hg(e)||dg(e))}function sI(e){return nc(e)&&e.wkid===4326}function pbe(e){return nc(e)&&e.wkid===Td.CGCS2000}function sT(e){return nc(e)&&e.wkid!=null&&bUe[e.wkid]===!0}function nI(e){return nc(e)&&e.wkid===32662}function iee(e){return e===Td.GCSMARS2000||e===Td.GCSMARS2000_SPHERE}function hg(e){return nc(e)&&e.wkid!=null&&iee(e.wkid)}function see(e){return e===Td.GCSMOON2000}function dg(e){return nc(e)&&e.wkid!=null&&see(e.wkid)}function xUe(e){return nc(e)&&e.wkid!=null&&wUe[e.wkid]===!0}function nc(e){return b(e)&&(e.wkid!=null&&e.wkid>=2e3||e.wkt!=null)}const TUe={wkid:4326,wkt:Zm(hbe[4326].wkTemplate,{Central_Meridian:"0.0"})},SUe={wkid:102100,latestWkid:3857},EUe={wkid:32662};var Zf;let Ai=Zf=class extends ye{constructor(e){super(e),this.latestWkid=null,this.wkid=null,this.wkt=null,this.vcsWkid=null,this.latestVcsWkid=null,this.imageCoordinateSystem=null}static fromJSON(e){if(!e)return null;if(e.wkid){if(e.wkid===102100)return Zf.WebMercator;if(e.wkid===4326)return Zf.WGS84}const t=new Zf;return t.read(e),t}normalizeCtorArgs(e){return e&&typeof e=="object"?e:{[typeof e=="string"?"wkt":"wkid"]:e}}get isWGS84(){return sI(this)}get isWebMercator(){return sT(this)}get isGeographic(){return dbe(this)}get isWrappable(){return xUe(this)}writeWkt(e,t){this.wkid||(t.wkt=e)}clone(){if(this===Zf.WGS84)return Zf.WGS84;if(this===Zf.WebMercator)return Zf.WebMercator;const e=new Zf;return this.wkid!=null?(e.wkid=this.wkid,this.latestWkid!=null&&(e.latestWkid=this.latestWkid),this.vcsWkid!=null&&(e.vcsWkid=this.vcsWkid),this.latestVcsWkid!=null&&(e.latestVcsWkid=this.latestVcsWkid)):this.wkt!=null&&(e.wkt=this.wkt),this.imageCoordinateSystem&&(e.imageCoordinateSystem=re(this.imageCoordinateSystem)),e}equals(e){if(e==null)return!1;if(this.imageCoordinateSystem||e.imageCoordinateSystem){if(this.imageCoordinateSystem==null||e.imageCoordinateSystem==null)return!1;const{id:t,referenceServiceName:r}=e.imageCoordinateSystem,{geodataXform:i}=e.imageCoordinateSystem,s=this.imageCoordinateSystem;return t==null||i?JSON.stringify(s)===JSON.stringify(e.imageCoordinateSystem):r?s.id===t&&s.referenceServiceName===r:s.id===t}return ml(this,e)}toJSON(e){return this.write(void 0,e)}};Ai.GCS_NAD_1927=null,Ai.WGS84=null,Ai.WebMercator=null,Ai.PlateCarree=null,u([d({readOnly:!0})],Ai.prototype,"isWGS84",null),u([d({readOnly:!0})],Ai.prototype,"isWebMercator",null),u([d({readOnly:!0})],Ai.prototype,"isGeographic",null),u([d({readOnly:!0})],Ai.prototype,"isWrappable",null),u([d({type:Wi,json:{write:!0}})],Ai.prototype,"latestWkid",void 0),u([d({type:Wi,json:{write:!0,origins:{"web-scene":{write:{overridePolicy(){return{isRequired:this.wkt===null}}}}}}})],Ai.prototype,"wkid",void 0),u([d({type:String,json:{origins:{"web-scene":{write:{overridePolicy(){return{isRequired:this.wkid===null}}}}}}})],Ai.prototype,"wkt",void 0),u([Xe("wkt"),Xe("web-scene","wkt")],Ai.prototype,"writeWkt",null),u([d({type:Wi,json:{write:!0}})],Ai.prototype,"vcsWkid",void 0),u([d({type:Wi,json:{write:!0}})],Ai.prototype,"latestVcsWkid",void 0),u([d()],Ai.prototype,"imageCoordinateSystem",void 0),Ai=Zf=u([$("esri.geometry.SpatialReference")],Ai),Ai.prototype.toJSON.isDefaultToJSON=!0,Ai.GCS_NAD_1927=new Ai({wkid:4267,wkt:'GEOGCS["GCS_North_American_1927",DATUM["D_North_American_1927",SPHEROID["Clarke_1866",6378206.4,294.9786982]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]]'}),Ai.WGS84=new Ai(TUe),Ai.WebMercator=new Ai(SUe),Ai.PlateCarree=new Ai(EUe),Object.freeze&&(Object.freeze(Ai.GCS_NAD_1927),Object.freeze(Ai.WGS84),Object.freeze(Ai.WebMercator));const Ze=Ai,fbe="20220708",mbe="7fd01dbc0e83d753fcf101c8ff2a8d215430252d",gbe="4.24",CUe={async request(e,t){var a;const{default:r}=await ie(()=>Promise.resolve().then(()=>wbe),void 0,import.meta.url),i=e.options,s=i.responseType;i.signal=t==null?void 0:t.signal,i.responseType=s==="native"||s==="native-request-init"?"native-request-init":["blob","json","text"].includes(s)&&((a=nbe(e.url))==null?void 0:a.after)?s:"array-buffer";const n=await r(e.url,i),o={data:n.data,ssl:n.ssl};switch(n.requestOptions.responseType){case"native-request-init":return delete o.data.signal,o;case"blob":o.data=await o.data.arrayBuffer();break;case"json":o.data=new TextEncoder().encode(JSON.stringify(o.data)).buffer;break;case"text":o.data=new TextEncoder().encode(o.data).buffer}return{result:o,transferList:[o.data]}}};let Xi;function mIt(e){Xi=e}function AUe(e){const t=Xi&&Xi.findCredential(e);return t&&t.token?ube(e,"token",t.token):e}he("host-webworker")||(he("edge")||he("trident"))&&console.warn("Deprecated browser - see http://esriurl.com/oldbrowser");const RUe=["elevation3d.arcgis.com","js.arcgis.com","jsdev.arcgis.com","jsqa.arcgis.com","static.arcgis.com"];function ybe(e){const t=df(e,!0);return t&&t.endsWith(".arcgis.com")&&!RUe.includes(t)&&!e.endsWith("/sharing/rest/generateToken")}function vbe(e,t,r=!1,i){return new Promise((s,n)=>{if(gn(i))return void n(fae());let o=()=>{c(),n(new Error(`Unable to load ${t}`))},a=()=>{const h=e;c(),s(h)},l=()=>{if(!e)return;const h=e;c(),h.src="",n(fae())};const c=()=>{he("esri-image-decode")||(e.removeEventListener("error",o),e.removeEventListener("load",a)),o=null,a=null,e=null,b(i)&&i.removeEventListener("abort",l),l=null,r&&URL.revokeObjectURL(t)};b(i)&&i.addEventListener("abort",l),he("esri-image-decode")?e.decode().then(a,o):(e.addEventListener("error",o),e.addEventListener("load",a))})}function fae(){try{return new DOMException("Aborted","AbortError")}catch{const e=new Error;return e.name="AbortError",e}}function OUe(e){Ur.request.crossOriginNoCorsDomains||(Ur.request.crossOriginNoCorsDomains={});const t=Ur.request.crossOriginNoCorsDomains;for(let r of e)r=r.toLowerCase(),/^https?:\/\//.test(r)?t[df(r)]=0:(t[df("http://"+r)]=0,t[df("https://"+r)]=0)}function MUe(e){const t=Ur.request.crossOriginNoCorsDomains;if(t){let r=df(e);if(r)return r=r.toLowerCase(),!rI(r,XK())&&t[r]<Date.now()-36e5}return!1}async function PUe(e){var i;const t=Ur.request.crossOriginNoCorsDomains;t&&(t[df(e).toLowerCase()]=Date.now());const r=Ds(e);e=r.path,((i=r.query)==null?void 0:i.f)==="json"&&(e+="?f=json");try{await fetch(e,{mode:"no-cors",credentials:"include"})}catch{}}async function er(e,t){var c;const r=ug(e),i=S1(e);i||r||(e=Id(e));const s={url:e,requestOptions:{...t}};let n=nbe(e);if(n){const h=await UUe(n,s);if(h!=null)return{data:h,getHeader:nee,requestOptions:s.requestOptions,url:s.url};n.after||n.error||(n=null)}if(e=s.url,(t=s.requestOptions).responseType==="image"){if(he("host-webworker")||he("host-node"))throw Jp("request:invalid-parameters",new Error("responseType 'image' is not supported in Web Workers or Node environment"),s)}else if(r)throw Jp("request:invalid-parameters",new Error("Data URLs are not supported for responseType = "+t.responseType),s);if(t.method==="head"){if(t.body)throw Jp("request:invalid-parameters",new Error("body parameter cannot be set when method is 'head'"),s);if(r||i)throw Jp("request:invalid-parameters",new Error("data and blob URLs are not supported for method 'head'"),s)}if(await NUe(),wU)return wU.execute(e,t);const o=new AbortController;Ia(t,()=>o.abort());const a={controller:o,credential:null,credentialToken:null,fetchOptions:null,hasToken:!1,interceptor:n,params:s,redoRequest:!1,useIdentity:Up.useIdentity,useProxy:!1,useSSL:!1,withCredentials:!1},l=await zUe(a);return(c=n==null?void 0:n.after)==null||c.call(n,l),l}let wU;const Up=Ur.request,_be="FormData"in globalThis,IUe=[499,498,403,401],$Ue=["COM_0056","COM_0057","SB_0008"],LUe=[/\/arcgis\/tokens/i,/\/sharing(\/rest)?\/generatetoken/i,/\/rest\/info/i],nee=()=>null,zq=Symbol();function DUe(e){const t=df(e);t&&!er._corsServers.includes(t)&&er._corsServers.push(t)}function mae(e){const t=df(e);return!t||t.endsWith(".arcgis.com")||er._corsServers.includes(t)||YK(t)}function Jp(e,t,r,i){let s="Error";const n={url:r.url,requestOptions:r.requestOptions,getHeader:nee,ssl:!1};if(t instanceof j)return t.details?(t.details=re(t.details),t.details.url=r.url,t.details.requestOptions=r.requestOptions):t.details=n,t;if(t){const o=i&&(c=>i.headers.get(c)),a=i&&i.status,l=t.message;l&&(s=l),o&&(n.getHeader=o),n.httpStatus=(t.httpCode!=null?t.httpCode:t.code)||a||0,n.subCode=t.subcode,n.messageCode=t.messageCode,typeof t.details=="string"?n.messages=[t.details]:n.messages=t.details,n.raw=zq in t?t[zq]:t}return Vi(t)?gr():new j(e,s,n)}async function NUe(){he("host-webworker")?wU||(wU=await ie(()=>import("./request.29cf424c.js"),[],import.meta.url)):er._abortableFetch||(er._abortableFetch=globalThis.fetch.bind(globalThis))}async function Bq(){Xi||await ie(()=>import("./IdentityManager.7a0350ff.js"),[],import.meta.url)}async function FUe(e){var a;const t=e.params.url,r=e.params.requestOptions,i=e.controller.signal,s=r.body;let n=null,o=null;if(_be&&"HTMLFormElement"in globalThis&&(s instanceof FormData?n=s:s instanceof HTMLFormElement&&(n=new FormData(s))),typeof s=="string"&&(o=s),e.fetchOptions={cache:r.cacheBust&&!er._abortableFetch.polyfill?"no-cache":"default",credentials:"same-origin",headers:r.headers||{},method:r.method==="head"?"HEAD":"GET",mode:"cors",priority:Up.priority,redirect:"follow",signal:i},(n||o)&&(e.fetchOptions.body=n||o),r.authMode==="anonymous"&&(e.useIdentity=!1),e.hasToken=!!(/token=/i.test(t)||((a=r.query)==null?void 0:a.token)||(n==null?void 0:n.get("token"))),!e.hasToken&&Ur.apiKey&&ybe(t)&&(r.query||(r.query={}),r.query.token=Ur.apiKey,e.hasToken=!0),e.useIdentity&&!e.hasToken&&!e.credentialToken&&!bbe(t)&&!gn(i)){let l;r.authMode==="immediate"?(await Bq(),l=await Xi.getCredential(t,{signal:i}),e.credential=l):r.authMode==="no-prompt"?(await Bq(),l=await Xi.getCredential(t,{prompt:!1,signal:i}).catch(()=>{}),e.credential=l):Xi&&(l=Xi.findCredential(t)),l&&(e.credentialToken=l.token,e.useSSL=!!l.ssl)}}function bbe(e){return LUe.some(t=>t.test(e))}async function kUe(e){let t=e.params.url;const r=e.params.requestOptions,i=e.fetchOptions,s=S1(t)||ug(t),n=r.responseType||"json",o=s?0:r.timeout!=null?r.timeout:Up.timeout;let a=!1;if(!s){e.useSSL&&(t=KK(t)),r.cacheBust&&i.cache==="default"&&(t=ube(t,"request.preventCache",Date.now()));let f={...r.query};e.credentialToken&&(f.token=e.credentialToken);let m=tI(f);he("esri-url-encodes-apostrophe")&&(m=m.replace(/'/g,"%27"));const g=t.length+1+m.length;let v;a=r.method==="delete"||r.method==="post"||r.method==="put"||!!r.body||g>Up.maxUrlLength;const w=r.useProxy||!!Zz(t);if(w){const _=iUe(t);v=_.path,!a&&v.length+1+g>Up.maxUrlLength&&(a=!0),_.query&&(f={..._.query,...f})}if(i.method==="HEAD"&&(a||w)){if(a)throw g>Up.maxUrlLength?Jp("request:invalid-parameters",new Error("URL exceeds maximum length"),e.params):Jp("request:invalid-parameters",new Error("cannot use POST request when method is 'head'"),e.params);if(w)throw Jp("request:invalid-parameters",new Error("cannot use proxy when method is 'head'"),e.params)}if(a?(i.method=r.method==="delete"?"DELETE":r.method==="put"?"PUT":"POST",r.body?t=L4(t,f):(i.body=tI(f),i.headers["Content-Type"]="application/x-www-form-urlencoded")):t=L4(t,f),w&&(e.useProxy=!0,t=`${v}?${t}`),f.token&&_be&&i.body instanceof FormData&&!/\/(sharing|usrsvcs)\/(appservices|servers)\//i.test(t)&&i.body.set("token",f.token),r.hasOwnProperty("withCredentials"))e.withCredentials=r.withCredentials;else if(!rI(t,XK())){if(YK(t))e.withCredentials=!0;else if(Xi){const _=Xi.findServerInfo(t);_&&_.webTierAuth&&(e.withCredentials=!0)}}e.withCredentials&&(i.credentials="include",MUe(t)&&await PUe(a?L4(t,f):t))}let l,c,h=0,p=!1;o>0&&(h=setTimeout(()=>{p=!0,e.controller.abort()},o));try{if(r.responseType==="native-request-init")c=i,c.url=t;else if(r.responseType!=="image"||i.cache!=="default"||i.method!=="GET"||a||VUe(r.headers)||!s&&!e.useProxy&&Up.proxyUrl&&!mae(t)){if(l=await er._abortableFetch(t,i),e.useProxy||DUe(t),r.responseType==="native")c=l;else if(i.method!=="HEAD")if(l.ok){switch(n){case"array-buffer":c=await l.arrayBuffer();break;case"blob":case"image":c=await l.blob();break;default:c=await l.text()}if(h&&(clearTimeout(h),h=0),n==="json"||n==="xml"||n==="document")if(c)switch(n){case"json":c=JSON.parse(c);break;case"xml":c=gae(c,"application/xml");break;case"document":c=gae(c,"text/html")}else c=null;if(c){if(n==="array-buffer"||n==="blob"){const f=l.headers.get("Content-Type");if(/application\/json|text\/plain/i.test(f)&&c[n==="blob"?"size":"byteLength"]<=750)try{const m=await new Response(c).json();m.error&&(c=m)}catch{}}n==="image"&&c instanceof Blob&&(c=await yae(URL.createObjectURL(c),e,!0))}}else c=await l.text()}else c=await yae(t,e)}catch(f){if(f.name==="AbortError")throw p?new Error("Timeout exceeded"):gr("Request canceled");if(!(!l&&f instanceof TypeError&&Up.proxyUrl)||r.body||r.method==="delete"||r.method==="head"||r.method==="post"||r.method==="put"||e.useProxy||mae(t))throw f;e.redoRequest=!0,sUe({proxyUrl:Up.proxyUrl,urlPrefix:df(t)})}finally{h&&clearTimeout(h)}return[l,c]}async function UUe(e,t){if(e.responseData!=null)return e.responseData;if(e.headers&&(t.requestOptions.headers={...t.requestOptions.headers,...e.headers}),e.query&&(t.requestOptions.query={...t.requestOptions.query,...e.query}),e.before){let r,i;try{i=await e.before(t)}catch(s){r=Jp("request:interceptor",s,t)}if((i instanceof Error||i instanceof j)&&(r=Jp("request:interceptor",i,t)),r)throw e.error&&e.error(r),r;return i}}function VUe(e){if(e){for(const t of Object.getOwnPropertyNames(e))if(e[t])return!0}return!1}function gae(e,t){let r;try{r=new DOMParser().parseFromString(e,t)}catch{}if(!r||r.getElementsByTagName("parsererror").length)throw new SyntaxError("XML Parse error");return r}async function zUe(e){var n;let t,r;await FUe(e);try{do[t,r]=await kUe(e);while(!await BUe(e,t,r))}catch(o){const a=Jp("request:server",o,e.params,t);throw a.details.ssl=e.useSSL,e.interceptor&&e.interceptor.error&&e.interceptor.error(a),a}const i=e.params.url;if(r&&/\/sharing\/rest\/(accounts|portals)\/self/i.test(i)){if(!e.hasToken&&!e.credentialToken&&((n=r.user)==null?void 0:n.username)&&!YK(i)){const o=df(i,!0);o&&Up.trustedServers.push(o)}Array.isArray(r.authorizedCrossOriginNoCorsDomains)&&OUe(r.authorizedCrossOriginNoCorsDomains)}const s=e.credential;if(s&&Xi){const o=Xi.findServerInfo(s.server);let a=o&&o.owningSystemUrl;if(a){a=a.replace(/\/?$/,"/sharing");const l=Xi.findCredential(a,s.userId);l&&Xi._getIdenticalSvcIdx(a,l)===-1&&l.resources.unshift(a)}}return{data:r,getHeader:t?o=>t.headers.get(o):nee,requestOptions:e.params.requestOptions,ssl:e.useSSL,url:e.params.url}}async function BUe(e,t,r){if(e.redoRequest)return e.redoRequest=!1,!1;const i=e.params.requestOptions;if(!t||i.responseType==="native"||i.responseType==="native-request-init")return!0;let s,n,o,a;if(!t.ok)throw s=new Error(`Unable to load ${t.url} status: ${t.status}`),s[zq]=r,s;r!=null&&r.error&&(s=r.error),s&&(n=Number(s.code),o=s.hasOwnProperty("subcode")?Number(s.subcode):null,a=s.messageCode,a=a&&a.toUpperCase());const l=i.authMode;if(n===403&&(o===4||s.message&&s.message.toLowerCase().includes("ssl")&&!s.message.toLowerCase().includes("permission"))){if(!e.useSSL)return e.useSSL=!0,!1}else if(!e.hasToken&&e.useIdentity&&(l!=="no-prompt"||n===498)&&IUe.includes(n)&&!bbe(e.params.url)&&(n!==403||!$Ue.includes(a)&&(o==null||o===2&&e.credentialToken))){await Bq();try{const c=await Xi.getCredential(e.params.url,{error:Jp("request:server",s,e.params),prompt:l!=="no-prompt",signal:e.controller.signal,token:e.credentialToken});return e.credential=c,e.credentialToken=c.token,e.useSSL=e.useSSL||c.ssl,!1}catch(c){if(l==="no-prompt")return e.credential=null,e.credentialToken=null,!1;s=c}}if(s)throw s;return!0}function yae(e,t,r=!1){const i=t.controller.signal,s=new Image;return t.withCredentials?s.crossOrigin="use-credentials":s.crossOrigin="anonymous",s.alt="",s.fetchPriority=Up.priority,s.src=e,vbe(s,e,r,i)}er._abortableFetch=null,er._corsServers=["https://server.arcgisonline.com","https://services.arcgisonline.com"];const wbe=Object.freeze(Object.defineProperty({__proto__:null,default:er},Symbol.toStringTag,{value:"Module"}));function $e(e,t,r){let i,s;return t===void 0||Array.isArray(t)?(s=e,r=t,i=[void 0]):(s=t,i=Array.isArray(e)?e:[e]),(n,o)=>{const a=n.constructor.prototype;i.forEach(l=>{const c=zK(n,l,s);c.read&&typeof c.read=="object"||(c.read={}),c.read.reader=a[o],r&&(c.read.source=(c.read.source||[]).concat(r))})}}let Yf=class extends ye{constructor(...e){super(...e),this.type=null,this.hasM=!1,this.hasZ=!1,this.spatialReference=Ze.WGS84}get cache(){return this.commitProperty("spatialReference"),{}}get extent(){return null}readSpatialReference(e,t){if(e instanceof Ze)return e;if(e!=null){const r=new Ze;return r.read(e,t),r}return e}clone(){return console.warn(".clone() is not implemented for "+this.declaredClass),null}clearCache(){this.notifyChange("cache")}getCacheValue(e){return this.cache[e]}setCacheValue(e,t){this.cache[e]=t}};u([d()],Yf.prototype,"type",void 0),u([d({readOnly:!0})],Yf.prototype,"cache",null),u([d({readOnly:!0})],Yf.prototype,"extent",null),u([d({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],Yf.prototype,"hasM",void 0),u([d({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],Yf.prototype,"hasZ",void 0),u([d({type:Ze,json:{write:!0}})],Yf.prototype,"spatialReference",void 0),u([$e("spatialReference")],Yf.prototype,"readSpatialReference",null),Yf=u([$("esri.geometry.Geometry")],Yf);const iu=Yf,GUe=Object.prototype.toString;function jUe(e){const t="__accessorMetadata__"in e?en(e):e;return function(...r){if(r.push(t),typeof r[2]=="number")throw new Error("Using @cast has parameter decorator is not supported since 4.16");return HUe.apply(this,r)}}function HUe(e,t,r,i){U$(e,t).cast=i}function qUe(e){return(t,r)=>{U$(t,e).cast=t[r]}}function qt(...e){if(e.length!==3||typeof e[1]!="string")return e.length===1&&GUe.call(e[0])==="[object Function]"?jUe(e[0]):e.length===1&&typeof e[0]=="string"?qUe(e[0]):void 0}function WUe(e,t,r,i){var s;return e.x=e.x+t,e.y=e.y+r,i!=null&&(e.z=((s=e.z)!=null?s:0)+i),e}function XUe(e,t){const r=e.x-t.x,i=e.y-t.y,s=e.hasZ&&t.hasZ?e.z-t.z:0;return Math.sqrt(r*r+i*i+s*s)}class oee{constructor(t,r,i,s){this.semiMajorAxis=t,this.flattening=r,this.outerAtmosphereRimWidth=i;const n=1-this.flattening;this.semiMinorAxis=this.semiMajorAxis*n,this.halfSemiMajorAxis=this.semiMajorAxis/2,this.halfCircumference=Math.PI*this.semiMajorAxis,this.metersPerDegree=this.halfCircumference/180,this.inverseFlattening=1/(1-this.flattening)-1,this.eccentricitySquared=s||2*this.flattening-this.flattening*this.flattening,this.meanRadiusSemiAxes=(2*this.semiMajorAxis+this.semiMinorAxis)/3}get radius(){return this.semiMajorAxis}}const $r=new oee(6378137,1/298.257223563,3e5,.006694379990137799),zm=new oee(3396190,1/169.8944472236118,23e4),c0=new oee(1737400,0,0),ZUe=57.29577951308232,YUe=.017453292519943;function vae(e){return e*ZUe}function _ae(e){return e*YUe}function bae(e){return e/$r.radius}function xU(e){return Math.PI/2-2*Math.atan(Math.exp(-e/$r.radius))}function Gq(e){return e.wkid!=null||e.wkt!=null}const M9=[0,0];function TU(e,t,r,i,s){const n=e,o=s;if(o.spatialReference=r,"x"in n&&"x"in o)[o.x,o.y]=t(n.x,n.y,M9,i);else if("xmin"in n&&"xmin"in o)[o.xmin,o.ymin]=t(n.xmin,n.ymin,M9,i),[o.xmax,o.ymax]=t(n.xmax,n.ymax,M9,i);else if("paths"in n&&"paths"in o||"rings"in n&&"rings"in o){const a="paths"in n?n.paths:n.rings,l=[];let c;for(let h=0;h<a.length;h++){const p=a[h];c=[],l.push(c);for(let f=0;f<p.length;f++)c.push(t(p[f][0],p[f][1],[0,0],i)),p[f].length>2&&c[f].push(p[f][2]),p[f].length>3&&c[f].push(p[f][3])}"paths"in o?o.paths=l:o.rings=l}else if("points"in n&&"points"in o){const a=n.points,l=[];for(let c=0;c<a.length;c++)l[c]=t(a[c][0],a[c][1],[0,0],i),a[c].length>2&&l[c].push(a[c][2]),a[c].length>3&&l[c].push(a[c][3]);o.points=l}return s}function l1(e,t){const r=e&&(Gq(e)?e:e.spatialReference),i=t&&(Gq(t)?t:t.spatialReference);return!(e&&"type"in e&&e.type==="mesh"||t&&"type"in t&&t.type==="mesh"||!r||!i)&&(!!ml(i,r)||sT(i)&&sI(r)||sT(r)&&sI(i))}function BT(e,t){if(R(e))return null;const r=e.spatialReference,i=t&&(Gq(t)?t:t.spatialReference);return l1(r,i)?ml(r,i)?re(e):sT(i)?TU(e,SE,Ze.WebMercator,!1,re(e)):sI(i)?TU(e,B3,Ze.WGS84,!1,re(e)):null:null}function SE(e,t,r=[0,0]){t>89.99999?t=89.99999:t<-89.99999&&(t=-89.99999);const i=_ae(t);return r[0]=_ae(e)*$r.radius,r[1]=$r.halfSemiMajorAxis*Math.log((1+Math.sin(i))/(1-Math.sin(i))),r}function B3(e,t,r=[0,0],i=!1){const s=vae(e/$r.radius);return r[0]=i?s:s-360*Math.floor((s+180)/360),r[1]=vae(Math.PI/2-2*Math.atan(Math.exp(-t/$r.radius))),r}function jy(e,t=!1,r=re(e)){return TU(e,SE,Ze.WebMercator,t,r)}function pM(e,t=!1,r=re(e)){return TU(e,B3,Ze.WGS84,t,r)}var D4;const qR=[0,0];function wae(e){return e&&(e.declaredClass==="esri.geometry.SpatialReference"||e.wkid!=null)}const xD=fe.getLogger("esri.geometry.Point");let Ml=D4=class extends iu{constructor(...e){super(...e),this.x=0,this.y=0,this.z=void 0,this.m=void 0,this.type="point"}static copy(e,t){t._set("x",e._get("x")),t._set("y",e._get("y")),t._set("z",e._get("z")),t._set("m",e._get("m"));const r=e._get("spatialReference");t._set("spatialReference",Object.isFrozen(r)?r:r.clone())}normalizeCtorArgs(e,t,r,i,s){let n;if(Array.isArray(e))n=e,s=t,e=n[0],t=n[1],r=n[2],i=n[3];else if(e&&typeof e=="object"){if(n=e,e=n.x!=null?n.x:n.longitude,t=n.y!=null?n.y:n.latitude,r=n.z,i=n.m,(s=n.spatialReference)&&s.declaredClass!=="esri.geometry.SpatialReference"&&(s=new Ze(s)),n.longitude!=null||n.latitude!=null){if(n.longitude==null)xD.warn(".longitude=","Latitude was defined without longitude");else if(n.latitude==null)xD.warn(".latitude=","Longitude was defined without latitude");else if(!n.declaredClass&&s&&s.isWebMercator){const a=SE(n.longitude,n.latitude,qR);e=a[0],t=a[1]}}}else wae(r)?(s=r,r=null):wae(i)&&(s=i,i=null);const o={x:e,y:t};return o.x==null&&o.y!=null?xD.warn(".y=","Y coordinate was defined without an X coordinate"):o.y==null&&o.x!=null&&xD.warn(".x=","X coordinate was defined without a Y coordinate"),s!=null&&(o.spatialReference=s),r!=null&&(o.z=r),i!=null&&(o.m=i),o}get cache(){return this.commitProperty("x"),this.commitProperty("y"),this.commitProperty("z"),this.commitProperty("m"),this.commitProperty("spatialReference"),{}}get hasM(){return this.m!==void 0}set hasM(e){e!==(this._get("m")!==void 0)&&(this._set("m",e?0:void 0),this._set("hasM",e))}get hasZ(){return this.z!==void 0}set hasZ(e){e!==(this._get("z")!==void 0)&&(this._set("z",e?0:void 0),this._set("hasZ",e))}get latitude(){const{spatialReference:e,x:t,y:r}=this;if(e){if(e.isWebMercator)return B3(t,r,qR)[1];if(e.isGeographic)return r}return null}set latitude(e){const{spatialReference:t,x:r}=this;t&&(t.isWebMercator?this._set("y",SE(r,e,qR)[1]):t.isGeographic&&this._set("y",e),this._set("latitude",e))}get longitude(){const{x:e,y:t,spatialReference:r}=this;if(r){if(r.isWebMercator)return B3(e,t,qR)[0];if(r.isGeographic)return e}return null}set longitude(e){const{y:t,spatialReference:r}=this;r&&(r.isWebMercator?this._set("x",SE(e,t,qR)[0]):r.isGeographic&&this._set("x",e),this._set("longitude",e))}writeX(e,t,r){t[r]=isNaN(e)?"NaN":e}readX(e){return typeof e=="string"?NaN:e}clone(){const e=new D4;return e.x=this.x,e.y=this.y,e.z=this.z,e.m=this.m,e.spatialReference=this.spatialReference,e}copy(e){return D4.copy(e,this),this}equals(e){if(R(e))return!1;const{x:t,y:r,z:i,m:s,spatialReference:n}=this,{z:o,m:a}=e;let{x:l,y:c,spatialReference:h}=e;if(!n.equals(h))if(n.isWebMercator&&h.isWGS84)[l,c]=SE(l,c),h=n;else{if(!n.isWGS84||!h.isWebMercator)return!1;[l,c]=B3(l,c),h=n}return t===l&&r===c&&i===o&&s===a&&n.wkid===h.wkid}offset(e,t,r){return WUe(this,e,t,r)}normalize(){if(!this.spatialReference)return this;const e=a1(this.spatialReference);if(!e)return this;let t=this.x;const[r,i]=e.valid,s=2*i;let n;return t>i?(n=Math.ceil(Math.abs(t-i)/s),t-=n*s):t<r&&(n=Math.ceil(Math.abs(t-r)/s),t+=n*s),this._set("x",t),this}distance(e){return XUe(this,e)}toArray(){const e=this.hasZ,t=this.hasM;return e&&t?[this.x,this.y,this.z,this.m]:e?[this.x,this.y,this.z]:t?[this.x,this.y,this.m]:[this.x,this.y]}toJSON(e){return this.write({},e)}};u([d({readOnly:!0})],Ml.prototype,"cache",null),u([d({type:Boolean,json:{read:!1,write:{enabled:!1,overridePolicy:null}}})],Ml.prototype,"hasM",null),u([d({type:Boolean,json:{read:!1,write:{enabled:!1,overridePolicy:null}}})],Ml.prototype,"hasZ",null),u([d({type:Number})],Ml.prototype,"latitude",null),u([d({type:Number})],Ml.prototype,"longitude",null),u([d({type:Number,json:{type:[Number,String],write:{isRequired:!0,allowNull:!0}}}),qt(e=>isNaN(e)?e:yd(e))],Ml.prototype,"x",void 0),u([Xe("x")],Ml.prototype,"writeX",null),u([$e("x")],Ml.prototype,"readX",null),u([d({type:Number,json:{write:!0}})],Ml.prototype,"y",void 0),u([d({type:Number,json:{write:{overridePolicy(){return{enabled:this.hasZ}}}}})],Ml.prototype,"z",void 0),u([d({type:Number,json:{write:{overridePolicy(){return{enabled:this.hasM}}}}})],Ml.prototype,"m",void 0),Ml=D4=u([$("esri.geometry.Point")],Ml),Ml.prototype.toJSON.isDefaultToJSON=!0;const at=Ml,P9=[0,0];function aee(e,t){return!!b(t)&&rl(e,t.x,t.y,t.z)}function gIt(e,t){if(!t.points||t.points.length)return!1;for(const r of t.points)if(!jC(e,r))return!1;return!0}function QUe(e,t){const{xmin:r,ymin:i,zmin:s,xmax:n,ymax:o,zmax:a}=t;return e.hasZ&&t.hasZ?rl(e,r,i,s)&&rl(e,r,o,s)&&rl(e,n,o,s)&&rl(e,n,i,s)&&rl(e,r,i,a)&&rl(e,r,o,a)&&rl(e,n,o,a)&&rl(e,n,i,a):rl(e,r,i)&&rl(e,r,o)&&rl(e,n,o)&&rl(e,n,i)}function jC(e,t){return rl(e,t[0],t[1])}function JUe(e,t){return rl(e,t[0],t[1],t[2])}function rl(e,t,r,i){return t>=e.xmin&&t<=e.xmax&&r>=e.ymin&&r<=e.ymax&&(i==null||!e.hasZ||i>=e.zmin&&i<=e.zmax)}function KUe(e,t){return P9[1]=t.y,P9[0]=t.x,eVe(e,P9)}function eVe(e,t){return xbe(e.rings,t)}function xbe(e,t){if(!e)return!1;if(tVe(e))return xae(!1,e,t);let r=!1;for(let i=0,s=e.length;i<s;i++)r=xae(r,e[i],t);return r}function tVe(e){return!Array.isArray(e[0][0])}function xae(e,t,r){const[i,s]=r;let n=e,o=0;for(let a=0,l=t.length;a<l;a++){o++,o===l&&(o=0);const[c,h]=t[a],[p,f]=t[o];(h<s&&f>=s||f<s&&h>=s)&&c+(s-h)/(f-h)*(p-c)<i&&(n=!n)}return n}function rVe(e,t){return aee(e,t)}function iVe(e,t){const r=e.hasZ&&t.hasZ;let i,s,n;if(e.xmin<=t.xmin){if(i=t.xmin,e.xmax<i)return!1}else if(i=e.xmin,t.xmax<i)return!1;if(e.ymin<=t.ymin){if(s=t.ymin,e.ymax<s)return!1}else if(s=e.ymin,t.ymax<s)return!1;if(r&&t.hasZ){if(e.zmin<=t.zmin){if(n=t.zmin,e.zmax<n)return!1}else if(n=e.zmin,t.zmax<n)return!1}return!0}function sVe(e,t){const{points:r,hasZ:i}=t,s=i?JUe:jC;for(const n of r)if(s(e,n))return!0;return!1}const nT=[0,0],oT=[0,0],aT=[0,0],lT=[0,0],nVe=[nT,oT,aT,lT],Tbe=[[aT,nT],[nT,oT],[oT,lT],[lT,aT]];function oVe(e,t){return aVe(e,t.rings)}function aVe(e,t){nT[0]=e.xmin,nT[1]=e.ymax,oT[0]=e.xmax,oT[1]=e.ymax,aT[0]=e.xmin,aT[1]=e.ymin,lT[0]=e.xmax,lT[1]=e.ymin;for(const r of nVe)if(xbe(t,r))return!0;for(const r of t){if(!r.length)continue;let i=r[0];if(jC(e,i))return!0;for(let s=1;s<r.length;s++){const n=r[s];if(jC(e,n)||Sbe(i,n,Tbe))return!0;i=n}}return!1}function lVe(e,t){nT[0]=e.xmin,nT[1]=e.ymax,oT[0]=e.xmax,oT[1]=e.ymax,aT[0]=e.xmin,aT[1]=e.ymin,lT[0]=e.xmax,lT[1]=e.ymin;const r=t.paths;for(const i of r){if(!r.length)continue;let s=i[0];if(jC(e,s))return!0;for(let n=1;n<i.length;n++){const o=i[n];if(jC(e,o)||Sbe(s,o,Tbe))return!0;s=o}}return!1}const Uo=[0,0];function cVe(e){for(let t=0;t<e.length;t++){const r=e[t];for(let s=0;s<r.length-1;s++){const n=r[s],o=r[s+1];for(let a=t+1;a<e.length;a++)for(let l=0;l<e[a].length-1;l++){const c=e[a][l],h=e[a][l+1];if(jq(n,o,c,h,Uo)&&!(Uo[0]===n[0]&&Uo[1]===n[1]||Uo[0]===c[0]&&Uo[1]===c[1]||Uo[0]===o[0]&&Uo[1]===o[1]||Uo[0]===h[0]&&Uo[1]===h[1]))return!0}}const i=r.length;if(!(i<=4))for(let s=0;s<i-3;s++){let n=i-1;s===0&&(n=i-2);const o=r[s],a=r[s+1];for(let l=s+2;l<n;l++){const c=r[l],h=r[l+1];if(jq(o,a,c,h,Uo)&&!(Uo[0]===o[0]&&Uo[1]===o[1]||Uo[0]===c[0]&&Uo[1]===c[1]||Uo[0]===a[0]&&Uo[1]===a[1]||Uo[0]===h[0]&&Uo[1]===h[1]))return!0}}}return!1}function Sbe(e,t,r){for(let i=0;i<r.length;i++)if(jq(e,t,r[i][0],r[i][1]))return!0;return!1}function jq(e,t,r,i,s){const[n,o]=e,[a,l]=t,[c,h]=r,[p,f]=i,m=p-c,g=n-c,v=a-n,w=f-h,_=o-h,T=l-o,x=w*v-m*T;if(x===0)return!1;const E=(m*_-w*g)/x,C=(v*_-T*g)/x;return E>=0&&E<=1&&C>=0&&C<=1&&(s&&(s[0]=n+E*(a-n),s[1]=o+E*(l-o)),!0)}function uVe(e){switch(e){case"esriGeometryEnvelope":case"extent":return iVe;case"esriGeometryMultipoint":case"multipoint":return sVe;case"esriGeometryPoint":case"point":return rVe;case"esriGeometryPolygon":case"polygon":return oVe;case"esriGeometryPolyline":case"polyline":return lVe}}var jh;function hVe(e){return e&&(e.declaredClass==="esri.geometry.SpatialReference"||e.wkid!=null)}function G0(e,t,r){return t==null?r:r==null?t:e(t,r)}let uo=jh=class extends iu{constructor(...e){super(...e),this.type="extent",this.xmin=0,this.ymin=0,this.mmin=void 0,this.zmin=void 0,this.xmax=0,this.ymax=0,this.mmax=void 0,this.zmax=void 0}normalizeCtorArgs(e,t,r,i,s){return hVe(e)?{spatialReference:e,xmin:0,ymin:0,xmax:0,ymax:0}:typeof e=="object"?(e.spatialReference=e.spatialReference==null?Ze.WGS84:e.spatialReference,e):{xmin:e,ymin:t,xmax:r,ymax:i,spatialReference:s==null?Ze.WGS84:s}}static fromBounds(e,t){return new jh({xmin:e[0],ymin:e[1],xmax:e[2],ymax:e[3],spatialReference:t})}static fromPoint(e){return new jh({xmin:e.x,ymin:e.y,zmin:e.z,xmax:e.x,ymax:e.y,zmax:e.z,spatialReference:e.spatialReference})}get cache(){return this.commitProperty("xmin"),this.commitProperty("ymin"),this.commitProperty("zmin"),this.commitProperty("mmin"),this.commitProperty("xmax"),this.commitProperty("ymax"),this.commitProperty("zmax"),this.commitProperty("mmax"),this.commitProperty("spatialReference"),{}}get center(){const e=new at({x:.5*(this.xmin+this.xmax),y:.5*(this.ymin+this.ymax),spatialReference:this.spatialReference});return this.hasZ&&(e.z=.5*(this.zmin+this.zmax)),this.hasM&&(e.m=.5*(this.mmin+this.mmax)),e}get extent(){return this.clone()}get hasM(){return this.mmin!=null&&this.mmax!=null}get hasZ(){return this.zmin!=null&&this.zmax!=null}get height(){return Math.abs(this.ymax-this.ymin)}get width(){return Math.abs(this.xmax-this.xmin)}centerAt(e){const t=this.center;return e.z!=null&&this.hasZ?this.offset(e.x-t.x,e.y-t.y,e.z-t.z):this.offset(e.x-t.x,e.y-t.y)}clone(){const e=new jh;return e.xmin=this.xmin,e.ymin=this.ymin,e.xmax=this.xmax,e.ymax=this.ymax,e.spatialReference=this.spatialReference,this.zmin!=null&&(e.zmin=this.zmin,e.zmax=this.zmax),this.mmin!=null&&(e.mmin=this.mmin,e.mmax=this.mmax),e}contains(e){if(!e)return!1;const t=this.spatialReference,r=e.spatialReference;return t&&r&&!t.equals(r)&&l1(t,r)&&(e=t.isWebMercator?jy(e):pM(e,!0)),e.type==="point"?aee(this,e):e.type==="extent"&&QUe(this,e)}equals(e){if(this===e)return!0;if(R(e))return!1;const t=this.spatialReference,r=e.spatialReference;return t&&r&&!t.equals(r)&&l1(t,r)&&(e=t.isWebMercator?jy(e):pM(e,!0)),this.xmin===e.xmin&&this.ymin===e.ymin&&this.zmin===e.zmin&&this.mmin===e.mmin&&this.xmax===e.xmax&&this.ymax===e.ymax&&this.zmax===e.zmax&&this.mmax===e.mmax}expand(e){const t=.5*(1-e),r=this.width*t,i=this.height*t;if(this.xmin+=r,this.ymin+=i,this.xmax-=r,this.ymax-=i,this.hasZ){const s=(this.zmax-this.zmin)*t;this.zmin+=s,this.zmax-=s}if(this.hasM){const s=(this.mmax-this.mmin)*t;this.mmin+=s,this.mmax-=s}return this}intersects(e){if(R(e))return!1;e.type==="mesh"&&(e=e.extent);const t=this.spatialReference,r=e.spatialReference;return t&&r&&!t.equals(r)&&l1(t,r)&&(e=t.isWebMercator?jy(e):pM(e,!0)),uVe(e.type)(this,e)}normalize(){const e=this._normalize(!1,!0);return Array.isArray(e)?e:[e]}offset(e,t,r){return this.xmin+=e,this.ymin+=t,this.xmax+=e,this.ymax+=t,r!=null&&(this.zmin+=r,this.zmax+=r),this}shiftCentralMeridian(){return this._normalize(!0)}union(e){return this===e||(this.xmin=Math.min(this.xmin,e.xmin),this.ymin=Math.min(this.ymin,e.ymin),this.xmax=Math.max(this.xmax,e.xmax),this.ymax=Math.max(this.ymax,e.ymax),(this.hasZ||e.hasZ)&&(this.zmin=G0(Math.min,this.zmin,e.zmin),this.zmax=G0(Math.max,this.zmax,e.zmax)),(this.hasM||e.hasM)&&(this.mmin=G0(Math.min,this.mmin,e.mmin),this.mmax=G0(Math.max,this.mmax,e.mmax))),this}intersection(e){return this===e?this:R(e)||!this.intersects(e)?null:(this.xmin=Math.max(this.xmin,e.xmin),this.ymin=Math.max(this.ymin,e.ymin),this.xmax=Math.min(this.xmax,e.xmax),this.ymax=Math.min(this.ymax,e.ymax),(this.hasZ||e.hasZ)&&(this.zmin=G0(Math.max,this.zmin,e.zmin),this.zmax=G0(Math.min,this.zmax,e.zmax)),(this.hasM||e.hasM)&&(this.mmin=G0(Math.max,this.mmin,e.mmin),this.mmax=G0(Math.min,this.mmax,e.mmax)),this)}toJSON(e){return this.write({},e)}_shiftCM(e=a1(this.spatialReference)){if(!e||!this.spatialReference)return this;const t=this.spatialReference,r=this._getCM(e);if(r){const i=t.isWebMercator?pM(r):r;this.xmin-=r.x,this.xmax-=r.x,t.isWebMercator||(i.x=this._normalizeX(i.x,e).x),this.spatialReference=new Ze(Zm(t.isWGS84?e.altTemplate:e.wkTemplate,{Central_Meridian:i.x}))}return this}_getCM(e){let t=null;const[r,i]=e.valid,s=this.xmin,n=this.xmax;return s>=r&&s<=i&&n>=r&&n<=i||(t=this.center),t}_normalize(e,t,r){const i=this.spatialReference;if(!i)return this;if(!(r=r||a1(i)))return this;const s=this._getParts(r).map(a=>a.extent);if(s.length<2)return s[0]||this;if(s.length>2)return e?this._shiftCM(r):this.set({xmin:r.valid[0],xmax:r.valid[1]});if(e)return this._shiftCM(r);if(t)return s;let n=!0,o=!0;return s.forEach(a=>{a.hasZ||(n=!1),a.hasM||(o=!1)}),{rings:s.map(a=>{const l=[[a.xmin,a.ymin],[a.xmin,a.ymax],[a.xmax,a.ymax],[a.xmax,a.ymin],[a.xmin,a.ymin]];if(n){const c=(a.zmax-a.zmin)/2;for(let h=0;h<l.length;h++)l[h].push(c)}if(o){const c=(a.mmax-a.mmin)/2;for(let h=0;h<l.length;h++)l[h].push(c)}return l}),hasZ:n,hasM:o,spatialReference:i}}_getParts(e){let t=this.cache._parts;if(!t){t=[];const{ymin:s,ymax:n,spatialReference:o}=this,a=this.width,l=this.xmin,c=this.xmax;let h;e=e||a1(o);const[p,f]=e.valid;h=this._normalizeX(this.xmin,e);const m=h.x,g=h.frameId;h=this._normalizeX(this.xmax,e);const v=h.x,w=h.frameId,_=m===v&&a>0;if(a>2*f){const T=new jh(l<c?m:v,s,f,n,o),x=new jh(p,s,l<c?v:m,n,o),E=new jh(0,s,f,n,o),C=new jh(p,s,0,n,o),A=[],P=[];T.contains(E)&&A.push(g),T.contains(C)&&P.push(g),x.contains(E)&&A.push(w),x.contains(C)&&P.push(w);for(let I=g+1;I<w;I++)A.push(I),P.push(I);t.push({extent:T,frameIds:[g]},{extent:x,frameIds:[w]},{extent:E,frameIds:A},{extent:C,frameIds:P})}else m>v||_?t.push({extent:new jh(m,s,f,n,o),frameIds:[g]},{extent:new jh(p,s,v,n,o),frameIds:[w]}):t.push({extent:new jh(m,s,v,n,o),frameIds:[g]});this.cache._parts=t}const r=this.hasZ,i=this.hasM;if(r||i){const s={};r&&(s.zmin=this.zmin,s.zmax=this.zmax),i&&(s.mmin=this.mmin,s.mmax=this.mmax);for(let n=0;n<t.length;n++)t[n].extent.set(s)}return t}_normalizeX(e,t){const[r,i]=t.valid,s=2*i;let n,o=0;return e>i?(n=Math.ceil(Math.abs(e-i)/s),e-=n*s,o=n):e<r&&(n=Math.ceil(Math.abs(e-r)/s),e+=n*s,o=-n),{x:e,frameId:o}}};u([d({readOnly:!0})],uo.prototype,"cache",null),u([d({readOnly:!0})],uo.prototype,"center",null),u([d({readOnly:!0})],uo.prototype,"extent",null),u([d({readOnly:!0,json:{write:{enabled:!1,overridePolicy:null}}})],uo.prototype,"hasM",null),u([d({readOnly:!0,json:{write:{enabled:!1,overridePolicy:null}}})],uo.prototype,"hasZ",null),u([d({readOnly:!0})],uo.prototype,"height",null),u([d({readOnly:!0})],uo.prototype,"width",null),u([d({type:Number,json:{type:[Number,String],write:{enabled:!0,allowNull:!0}}})],uo.prototype,"xmin",void 0),u([d({type:Number,json:{write:!0}})],uo.prototype,"ymin",void 0),u([d({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasM}}}}})],uo.prototype,"mmin",void 0),u([d({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasZ}}}}})],uo.prototype,"zmin",void 0),u([d({type:Number,json:{write:!0}})],uo.prototype,"xmax",void 0),u([d({type:Number,json:{write:!0}})],uo.prototype,"ymax",void 0),u([d({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasM}}}}})],uo.prototype,"mmax",void 0),u([d({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasZ}}}}})],uo.prototype,"zmax",void 0),uo=jh=u([$("esri.geometry.Extent")],uo),uo.prototype.toJSON.isDefaultToJSON=!0;const Kt=uo;let G3;var M0e,P0e,I0e;const I9=(I0e=(M0e=globalThis.esriConfig)==null?void 0:M0e.locale)!=null?I0e:(P0e=globalThis.dojoConfig)==null?void 0:P0e.locale;function Ebe(){var e,t;return(t=I9!=null?I9:(e=globalThis.navigator)==null?void 0:e.language)!=null?t:"en"}function lh(){return G3===void 0&&(G3=Ebe()),G3}const j3=[];function Cbe(e){return j3.push(e),{remove(){j3.splice(j3.indexOf(e),1)}}}const Hq=[];function lee(e){return Hq.push(e),{remove(){j3.splice(Hq.indexOf(e),1)}}}function dVe(){const e=Ebe();G3!==e&&(G3=e,[...Hq].forEach(t=>{t.call(null,e)}),[...j3].forEach(t=>{t.call(null,e)}))}var $0e;($0e=globalThis.addEventListener)==null||$0e.call(globalThis,"languagechange",dVe);class Tr{constructor(t,r={ignoreUnknown:!1,useNumericKeys:!1}){this.jsonToAPI=t,this.options=r,this.apiValues=[],this.jsonValues=[],this.apiToJSON=this._invertMap(t),this.apiValues=this._getKeysSorted(this.apiToJSON),this.jsonValues=this._getKeysSorted(this.jsonToAPI),this.read=i=>this.fromJSON(i),this.write=(i,s,n)=>{const o=this.toJSON(i);o!==void 0&&ru(n,o,s)},this.write.isJSONMapWriter=!0}toJSON(t){if(this.apiToJSON.hasOwnProperty(t)){const r=this.apiToJSON[t];return this.options.useNumericKeys?+r:r}return this.options.ignoreUnknown?void 0:t}fromJSON(t){return this.jsonToAPI.hasOwnProperty(t)?this.jsonToAPI[t]:this.options.ignoreUnknown?void 0:t}_invertMap(t){const r={};for(const i in t)r[t[i]]=i;return r}_getKeysSorted(t){const r=[];for(const i in t)r.push(i);return r.sort(),r}}function Da(){return function(e,t){return new Tr(e,{ignoreUnknown:!0,...t})}}var qq;const pVe=new Tr({avgRating:"avg-rating",numRatings:"num-ratings",numComments:"num-comments",numViews:"num-views"});let Hh=qq=class extends xe{constructor(e){super(e),this.categories=null,this.disableExtraQuery=!1,this.extent=null,this.filter=null,this.num=10,this.query=null,this.sortField=null,this.start=1}get sortOrder(){return this._get("sortOrder")||"asc"}set sortOrder(e){e!=="asc"&&e!=="desc"||this._set("sortOrder",e)}clone(){return new qq({categories:this.categories?re(this.categories):null,disableExtraQuery:this.disableExtraQuery,extent:this.extent?this.extent.clone():null,filter:this.filter,num:this.num,query:this.query,sortField:this.sortField,sortOrder:this.sortOrder,start:this.start})}toRequestOptions(e,t){let r,i;if(this.categories&&(r=this.categories.map(o=>Array.isArray(o)?JSON.stringify(o):o)),this.extent){const o=BT(this.extent,Ze.WGS84);b(o)&&(i=`${o.xmin},${o.ymin},${o.xmax},${o.ymax}`)}let s=this.query;!this.disableExtraQuery&&e.extraQuery&&(s="("+s+")"+e.extraQuery);const n={categories:r,bbox:i,q:s,filter:this.filter,num:this.num,sortField:null,sortOrder:null,start:this.start};return this.sortField&&(n.sortField=this.sortField.split(",").map(o=>pVe.toJSON(o.trim())).join(","),n.sortOrder=this.sortOrder),{query:{...t,...n}}}};u([d()],Hh.prototype,"categories",void 0),u([d()],Hh.prototype,"disableExtraQuery",void 0),u([d({type:Kt})],Hh.prototype,"extent",void 0),u([d()],Hh.prototype,"filter",void 0),u([d()],Hh.prototype,"num",void 0),u([d()],Hh.prototype,"query",void 0),u([d()],Hh.prototype,"sortField",void 0),u([d()],Hh.prototype,"sortOrder",null),u([d()],Hh.prototype,"start",void 0),Hh=qq=u([$("esri.portal.PortalQueryParams")],Hh);const Oy=Hh;let Zb=class extends xe{constructor(e){super(e),this.nextQueryParams=null,this.queryParams=null,this.results=null,this.total=null}};u([d()],Zb.prototype,"nextQueryParams",void 0),u([d()],Zb.prototype,"queryParams",void 0),u([d()],Zb.prototype,"results",void 0),u([d()],Zb.prototype,"total",void 0),Zb=u([$("esri.portal.PortalQueryResult")],Zb);const fVe=Zb;let Gg=class extends ye{constructor(e){super(e),this.created=null,this.id=null,this.portal=null,this.title=null,this.username=null}get url(){const e=this.get("portal.restUrl");return e?`${e}/content/users/${this.username}/${this.id}`:null}toJSON(){throw new j("internal:not-yet-implemented","PortalFolder.toJSON is not yet implemented")}};u([d({type:Date})],Gg.prototype,"created",void 0),u([d()],Gg.prototype,"id",void 0),u([d()],Gg.prototype,"portal",void 0),u([d()],Gg.prototype,"title",void 0),u([d({readOnly:!0})],Gg.prototype,"url",null),u([d()],Gg.prototype,"username",void 0),Gg=u([$("esri.portal.PortalFolder")],Gg);const mVe=Gg;let ho=class extends ye{constructor(e){super(e),this.access=null,this.created=null,this.description=null,this.id=null,this.isInvitationOnly=!1,this.modified=null,this.owner=null,this.portal=null,this.snippet=null,this.sortField=null,this.sortOrder=null,this.tags=null,this.title=null}get thumbnailUrl(){const e=this.url,t=this.thumbnail;return e&&t?this.portal._normalizeUrl(`${e}/info/${t}?f=json`):null}get url(){const e=this.get("portal.restUrl");return e?e+"/community/groups/"+this.id:null}fetchCategorySchema(e){return this.portal._request(this.url+"/categorySchema",e).then(t=>{const r=t.categorySchema||[];return r.some(i=>i.source==="contentCategorySetsGroupQuery.LivingAtlas")?this._fetchCategorySchemaSet("LivingAtlas",e):r})}fetchMembers(e){return this.portal._request(this.url+"/users",e)}getThumbnailUrl(e){let t=this.thumbnailUrl;return t&&e&&(t+=`&w=${e}`),t}toJSON(){throw new j("internal:not-yet-implemented","PortalGroup.toJSON is not yet implemented")}queryItems(e,t){let r=en(Oy,e);return parseFloat(this.portal.currentVersion)>5?(r=r||new Oy,this.portal._queryPortal(`/content/groups/${this.id}/search`,r,"PortalItem",t)):(r=r?r.clone():new Oy,r.query="group:"+this.id+(r.query?" "+r.query:""),this.portal.queryItems(r,t))}_fetchCategorySchemaSet(e,t){return this.portal._fetchSelf(this.portal.authMode,!0,t).then(r=>{const i=r.contentCategorySetsGroupQuery;if(i){const s=new Oy;return s.disableExtraQuery=!0,s.num=1,s.query=i,this.portal.queryGroups(s,t)}throw new j("portal-group:fetchCategorySchema","contentCategorySetsGroupQuery value not found")}).then(r=>{if(r.total){const i=r.results[0],s=new Oy;return s.num=1,s.query=`typekeywords:"${e}"`,i.queryItems(s,t)}throw new j("portal-group:fetchCategorySchema","contentCategorySetsGroupQuery group not found")}).then(r=>r.total?r.results[0].fetchData("json",t).then(i=>{const s=i&&i.categorySchema;return s&&s.length?s:[]}):[])}};u([d()],ho.prototype,"access",void 0),u([d({type:Date})],ho.prototype,"created",void 0),u([d()],ho.prototype,"description",void 0),u([d()],ho.prototype,"id",void 0),u([d()],ho.prototype,"isInvitationOnly",void 0),u([d({type:Date})],ho.prototype,"modified",void 0),u([d()],ho.prototype,"owner",void 0),u([d()],ho.prototype,"portal",void 0),u([d()],ho.prototype,"snippet",void 0),u([d()],ho.prototype,"sortField",void 0),u([d()],ho.prototype,"sortOrder",void 0),u([d()],ho.prototype,"tags",void 0),u([d()],ho.prototype,"thumbnail",void 0),u([d({readOnly:!0})],ho.prototype,"thumbnailUrl",null),u([d()],ho.prototype,"title",void 0),u([d({readOnly:!0})],ho.prototype,"url",null),ho=u([$("esri.portal.PortalGroup")],ho);const Wq=ho,gVe=Object.freeze(Object.defineProperty({__proto__:null,default:Wq},Symbol.toStringTag,{value:"Module"}));var Xq;let ns=Xq=class extends ye{constructor(...e){super(...e),this.access=null,this.created=null,this.culture=null,this.description=null,this.email=null,this.fullName=null,this.modified=null,this.orgId=null,this.portal=null,this.preferredView=null,this.privileges=null,this.region=null,this.role=null,this.roleId=null,this.sourceJSON=null,this.units=null,this.username=null,this.userType=null}get thumbnailUrl(){const e=this.url,t=this.thumbnail;return e&&t?this.portal._normalizeUrl(`${e}/info/${t}?f=json`):null}get userContentUrl(){const e=this.get("portal.restUrl");return e?`${e}/content/users/${this.username}`:null}get url(){const e=this.get("portal.restUrl");return e?`${e}/community/users/${this.username}`:null}addItem(e){const t=e&&e.item,r=e&&e.data,i=e&&e.folder,s={method:"post"};t&&(s.query=t.createPostQuery(),r!=null&&(typeof r=="string"?s.query.text=r:typeof r=="object"&&(s.query.text=JSON.stringify(r))));let n=this.userContentUrl;return i&&(n+="/"+(typeof i=="string"?i:i.id)),this.portal._request(n+"/addItem",s).then(o=>(t.id=o.id,t.portal=this.portal,t.loaded?t.reload():t.load()))}deleteItem(e){let t=this.userContentUrl;return e.ownerFolder&&(t+="/"+e.ownerFolder),this.portal._request(t+`/items/${e.id}/delete`,{method:"post"}).then(()=>{e.id=null,e.portal=null})}deleteItems(e){const t=this.userContentUrl+"/deleteItems",r=e.map(i=>i.id);if(r.length){const i={method:"post",query:{items:r.join(",")}};return this.portal._request(t,i).then(()=>{e.forEach(s=>{s.id=null,s.portal=null})})}return Promise.resolve(void 0)}fetchFolders(){const e={query:{num:1}};return this.portal._request(this.userContentUrl,e).then(t=>{let r;return r=t&&t.folders?t.folders.map(i=>{const s=mVe.fromJSON(i);return s.portal=this.portal,s}):[],r})}fetchGroups(){return this.portal._request(this.url).then(e=>{let t;return t=e&&e.groups?e.groups.map(r=>{const i=Wq.fromJSON(r);return i.portal=this.portal,i}):[],t})}fetchItems(e){e||(e={});let t,r=this.userContentUrl;return e.folder&&(r+="/"+e.folder.id),ie(()=>Promise.resolve().then(()=>Abe),void 0,import.meta.url).then(({default:i})=>{t=i;const s={folders:!1,num:e.num||10,start:e.start||1,sortField:e.sortField||"created",sortOrder:e.sortOrder||"asc"};return this.portal._request(r,{query:s})}).then(i=>{let s;return i&&i.items?(s=i.items.map(n=>{const o=t.fromJSON(n);return o.portal=this.portal,o}),Promise.all(s.map(n=>n.load())).catch(n=>n).then(()=>({items:s,nextStart:i.nextStart,total:i.total}))):{items:[],nextStart:-1,total:0}})}fetchTags(){return this.portal._request(this.url+"/tags").then(e=>e.tags)}getThumbnailUrl(e){let t=this.thumbnailUrl;return t&&e&&(t+=`&w=${e}`),t}queryFavorites(e){return this.favGroupId?(this._favGroup||(this._favGroup=new Wq({id:this.favGroupId,portal:this.portal})),this._favGroup.queryItems(e)):Promise.reject(new j("internal:unknown","Unknown internal error",{internalError:"Unknown favGroupId"}))}toJSON(){throw new j("internal:not-yet-implemented","PortalGroup.toJSON is not yet implemented")}static fromJSON(e){if(!e)return null;if(e.declaredClass)throw new Error("JSON object is already hydrated");const t=new Xq;return t.sourceJSON=e,t.read(e),t}};u([d()],ns.prototype,"access",void 0),u([d({type:Date})],ns.prototype,"created",void 0),u([d()],ns.prototype,"culture",void 0),u([d()],ns.prototype,"description",void 0),u([d()],ns.prototype,"email",void 0),u([d()],ns.prototype,"favGroupId",void 0),u([d()],ns.prototype,"fullName",void 0),u([d({type:Date})],ns.prototype,"modified",void 0),u([d()],ns.prototype,"orgId",void 0),u([d()],ns.prototype,"portal",void 0),u([d()],ns.prototype,"preferredView",void 0),u([d()],ns.prototype,"privileges",void 0),u([d()],ns.prototype,"region",void 0),u([d()],ns.prototype,"role",void 0),u([d()],ns.prototype,"roleId",void 0),u([d()],ns.prototype,"sourceJSON",void 0),u([d()],ns.prototype,"thumbnail",void 0),u([d({readOnly:!0})],ns.prototype,"thumbnailUrl",null),u([d()],ns.prototype,"units",void 0),u([d({readOnly:!0})],ns.prototype,"userContentUrl",null),u([d({readOnly:!0})],ns.prototype,"url",null),u([d()],ns.prototype,"username",void 0),u([d()],ns.prototype,"userType",void 0),ns=Xq=u([$("esri.portal.PortalUser")],ns);const cee=ns,yVe=Object.freeze(Object.defineProperty({__proto__:null,default:cee},Symbol.toStringTag,{value:"Module"}));var Eu;let $9;const Tae={PortalGroup:()=>ie(()=>Promise.resolve().then(()=>gVe),void 0,import.meta.url),PortalItem:()=>ie(()=>Promise.resolve().then(()=>Abe),void 0,import.meta.url),PortalUser:()=>ie(()=>Promise.resolve().then(()=>yVe),void 0,import.meta.url)};let Ge=Eu=class extends nR(gh){constructor(e){super(e),this.access=null,this.allSSL=!1,this.authMode="auto",this.authorizedCrossOriginDomains=null,this.basemapGalleryGroupQuery=null,this.bingKey=null,this.canListApps=!1,this.canListData=!1,this.canListPreProvisionedItems=!1,this.canProvisionDirectPurchase=!1,this.canSearchPublic=!0,this.canShareBingPublic=!1,this.canSharePublic=!1,this.canSignInArcGIS=!1,this.canSignInIDP=!1,this.colorSetsGroupQuery=null,this.commentsEnabled=!1,this.created=null,this.culture=null,this.customBaseUrl=null,this.defaultBasemap=null,this.defaultDevBasemap=null,this.defaultExtent=null,this.defaultVectorBasemap=null,this.description=null,this.devBasemapGalleryGroupQuery=null,this.eueiEnabled=null,this.featuredGroups=null,this.featuredItemsGroupQuery=null,this.galleryTemplatesGroupQuery=null,this.livingAtlasGroupQuery=null,this.hasCategorySchema=!1,this.helperServices=null,this.homePageFeaturedContent=null,this.homePageFeaturedContentCount=null,this.httpPort=null,this.httpsPort=null,this.id=null,this.ipCntryCode=null,this.isPortal=!1,this.isReadOnly=!1,this.layerTemplatesGroupQuery=null,this.maxTokenExpirationMinutes=null,this.modified=null,this.name=null,this.portalHostname=null,this.portalMode=null,this.portalProperties=null,this.region=null,this.rotatorPanels=null,this.showHomePageDescription=!1,this.sourceJSON=null,this.supportsHostedServices=!1,this.symbolSetsGroupQuery=null,this.templatesGroupQuery=null,this.units=null,this.url=Ur.portalUrl,this.urlKey=null,this.user=null,this.useStandardizedQuery=!1,this.useVectorBasemaps=!1,this.vectorBasemapGalleryGroupQuery=null}normalizeCtorArgs(e){return typeof e=="string"?{url:e}:e}destroy(){this._esriId_credentialCreateHandle&&(this._esriId_credentialCreateHandle.remove(),this._esriId_credentialCreateHandle=null)}readAuthorizedCrossOriginDomains(e){if(e)for(const t of e)Ur.request.trustedServers.includes(t)||Ur.request.trustedServers.push(t);return e}readDefaultBasemap(e){return this._readBasemap(e)}readDefaultDevBasemap(e){return this._readBasemap(e)}readDefaultVectorBasemap(e){return this._readBasemap(e)}get extraQuery(){const e=!(this.user&&this.user.orgId)||this.canSearchPublic;return this.id&&!e?` AND orgid:${this.id}`:null}get isOrganization(){return!!this.access}get restUrl(){let e=this.url;if(e){const t=e.indexOf("/sharing");e=t>0?e.substring(0,t):this.url.replace(/\/+$/,""),e+="/sharing/rest"}return e}get thumbnailUrl(){const e=this.restUrl,t=this.thumbnail;return e&&t?this._normalizeSSL(e+"/portals/self/resources/"+t):null}readUrlKey(e){return e&&e.toLowerCase()}readUser(e){let t=null;return e&&(t=cee.fromJSON(e),t.portal=this),t}load(e){const t=ie(()=>Promise.resolve().then(()=>NVe),void 0,import.meta.url).then(({default:r})=>{Jt(e),$9=r}).then(()=>this.sourceJSON?this.sourceJSON:this._fetchSelf(this.authMode,!1,e)).then(r=>{if(Xi){const i=Xi;this.credential=i.findCredential(this.restUrl),this.credential||this.authMode!==Eu.AUTH_MODE_AUTO||(this._esriId_credentialCreateHandle=i.on("credential-create",()=>{i.findCredential(this.restUrl)&&this._signIn()}))}this.sourceJSON=r,this.read(r)});return this.addResolvingPromise(t),Promise.resolve(this)}async createElevationLayers(){await this.load();const e=this._getHelperService("defaultElevationLayers"),t=(await ie(()=>import("./ElevationLayer.08897846.js"),["ElevationLayer.08897846.js","ArcGISCachedService.e877128c.js","TilemapCache.41ea2bd9.js"],import.meta.url)).default;return e?e.map(r=>new t({id:r.id,url:r.url})):[]}fetchBasemaps(e,t){const r=new Oy;return r.query=e||(Ur.apiKey&&ybe(this.url)?this.devBasemapGalleryGroupQuery:this.useVectorBasemaps?this.vectorBasemapGalleryGroupQuery:this.basemapGalleryGroupQuery),r.disableExtraQuery=!0,this.queryGroups(r,t).then(i=>{if(r.num=100,r.query='type:"Web Map" -type:"Web Application"',i.total){const s=i.results[0];return r.sortField=s.sortField||"name",r.sortOrder=s.sortOrder||"desc",s.queryItems(r,t)}return null}).then(i=>{let s;return s=i&&i.total?i.results.filter(n=>n.type==="Web Map").map(n=>new $9({portalItem:n})):[],s})}fetchCategorySchema(e){return this.hasCategorySchema?this._request(this.restUrl+"/portals/self/categorySchema",e).then(t=>t.categorySchema):gn(e)?Promise.reject(gr()):Promise.resolve([])}fetchFeaturedGroups(e){const t=this.featuredGroups,r=new Oy;if(r.num=100,r.sortField="title",t&&t.length){const i=[];for(const s of t)i.push(`(title:"${s.title}" AND owner:${s.owner})`);return r.query=i.join(" OR "),this.queryGroups(r,e).then(s=>s.results)}return gn(e)?Promise.reject(gr()):Promise.resolve([])}fetchRegions(e){var r;const t=((r=this.user)==null?void 0:r.culture)||this.culture||lh();return this._request(this.restUrl+"/portals/regions",{...e,query:{culture:t}})}fetchSettings(e){var r;const t=((r=this.user)==null?void 0:r.culture)||this.culture||lh();return this._request(this.restUrl+"/portals/self/settings",{...e,query:{culture:t}})}static getDefault(){return Eu._default&&!Eu._default.destroyed||(Eu._default=new Eu),Eu._default}queryGroups(e,t){return this._queryPortal("/community/groups",e,"PortalGroup",t)}queryItems(e,t){return this._queryPortal("/search",e,"PortalItem",t)}queryUsers(e,t){return e.sortField||(e.sortField="username"),this._queryPortal("/community/users",e,"PortalUser",t)}toJSON(){throw new j("internal:not-yet-implemented","Portal.toJSON is not yet implemented")}static fromJSON(e){if(!e)return null;if(e.declaredClass)throw new Error("JSON object is already hydrated");return new Eu({sourceJSON:e})}_getHelperService(e){const t=this.helperServices&&this.helperServices[e];if(!t)throw new j("portal:service-not-found",`The \`helperServices\` do not include an entry named "${e}"`);return t}_getHelperServiceUrl(e){const t=this._getHelperService(e);if(!t.url)throw new j("portal:service-url-not-found",`The \`helperServices\` entry "${e}" does not include a \`url\` value`);return t.url}_fetchSelf(e=this.authMode,t=!1,r){const i=this.restUrl+"/portals/self",s={authMode:e,query:{culture:lh().toLowerCase()},...r};return s.authMode==="auto"&&(s.authMode="no-prompt"),t&&(s.query.default=!0),this._request(i,s)}_queryPortal(e,t,r,i){const s=en(Oy,t),n=o=>this._request(this.restUrl+e,{...s.toRequestOptions(this),...i}).then(a=>{const l=s.clone();return l.start=a.nextStart,new fVe({nextQueryParams:l,queryParams:s,total:a.total,results:Eu._resultsToTypedArray(o,{portal:this},a,i)})}).then(a=>Promise.all(a.results.map(l=>typeof l.when=="function"?l.when():a)).then(()=>a,l=>(ah(l),a)));return r&&Tae[r]?Tae[r]().then(({default:o})=>(Jt(i),n(o))):n()}_signIn(){if(this.authMode===Eu.AUTH_MODE_ANONYMOUS)return Promise.reject(new j("portal:invalid-auth-mode",`Current "authMode"' is "${this.authMode}"`));if(this.loadStatus==="failed")return Promise.reject(this.loadError);const e=t=>Promise.resolve().then(()=>this.loadStatus==="not-loaded"?(t||(this.authMode="immediate"),this.load().then(()=>null)):this.loadStatus==="loading"?this.load().then(()=>this.credential?null:(this.credential=t,this._fetchSelf("immediate"))):this.user&&this.credential===t?null:(this.credential=t,this._fetchSelf("immediate"))).then(r=>{r&&(this.sourceJSON=r,this.read(r))});return Xi?Xi.getCredential(this.restUrl).then(t=>e(t)):e(this.credential)}_normalizeSSL(e){return e.replace(/^http:/i,"https:").replace(":7080",":7443")}_normalizeUrl(e){const t=this.credential&&this.credential.token;return this._normalizeSSL(t?e+(e.includes("?")?"&":"?")+"token="+t:e)}_requestToTypedArray(e,t,r){return this._request(e,t).then(i=>{const s=Eu._resultsToTypedArray(r,{portal:this},i);return Promise.all(s.map(n=>typeof n.when=="function"?n.when():i)).then(()=>s,()=>s)})}_readBasemap(e){if(e){const t=$9.fromJSON(e);return t.portalItem={portal:this},t}return null}_request(e,t={}){const r={f:"json",...t.query},{authMode:i=this.authMode===Eu.AUTH_MODE_ANONYMOUS?"anonymous":"auto",body:s=null,cacheBust:n=!1,method:o="auto",responseType:a="json",signal:l}=t,c={authMode:i,body:s,cacheBust:n,method:o,query:r,responseType:a,timeout:0,signal:l};return er(this._normalizeSSL(e),c).then(h=>h.data)}static _resultsToTypedArray(e,t,r,i){let s;if(r){const n=b(i)?i.signal:null;s=r.listings||r.notifications||r.userInvitations||r.tags||r.items||r.groups||r.comments||r.provisions||r.results||r.relatedItems||r,(e||t)&&(s=s.map(o=>{const a=Object.assign(e?e.fromJSON(o):o,t);return typeof a.load=="function"&&a.load(n),a}))}else s=[];return s}};Ge.AUTH_MODE_ANONYMOUS="anonymous",Ge.AUTH_MODE_AUTO="auto",Ge.AUTH_MODE_IMMEDIATE="immediate",u([d()],Ge.prototype,"access",void 0),u([d()],Ge.prototype,"allSSL",void 0),u([d()],Ge.prototype,"authMode",void 0),u([d()],Ge.prototype,"authorizedCrossOriginDomains",void 0),u([$e("authorizedCrossOriginDomains")],Ge.prototype,"readAuthorizedCrossOriginDomains",null),u([d()],Ge.prototype,"basemapGalleryGroupQuery",void 0),u([d()],Ge.prototype,"bingKey",void 0),u([d()],Ge.prototype,"canListApps",void 0),u([d()],Ge.prototype,"canListData",void 0),u([d()],Ge.prototype,"canListPreProvisionedItems",void 0),u([d()],Ge.prototype,"canProvisionDirectPurchase",void 0),u([d()],Ge.prototype,"canSearchPublic",void 0),u([d()],Ge.prototype,"canShareBingPublic",void 0),u([d()],Ge.prototype,"canSharePublic",void 0),u([d()],Ge.prototype,"canSignInArcGIS",void 0),u([d()],Ge.prototype,"canSignInIDP",void 0),u([d()],Ge.prototype,"colorSetsGroupQuery",void 0),u([d()],Ge.prototype,"commentsEnabled",void 0),u([d({type:Date})],Ge.prototype,"created",void 0),u([d()],Ge.prototype,"credential",void 0),u([d()],Ge.prototype,"culture",void 0),u([d()],Ge.prototype,"currentVersion",void 0),u([d()],Ge.prototype,"customBaseUrl",void 0),u([d()],Ge.prototype,"defaultBasemap",void 0),u([$e("defaultBasemap")],Ge.prototype,"readDefaultBasemap",null),u([d()],Ge.prototype,"defaultDevBasemap",void 0),u([$e("defaultDevBasemap")],Ge.prototype,"readDefaultDevBasemap",null),u([d({type:Kt})],Ge.prototype,"defaultExtent",void 0),u([d()],Ge.prototype,"defaultVectorBasemap",void 0),u([$e("defaultVectorBasemap")],Ge.prototype,"readDefaultVectorBasemap",null),u([d()],Ge.prototype,"description",void 0),u([d()],Ge.prototype,"devBasemapGalleryGroupQuery",void 0),u([d()],Ge.prototype,"eueiEnabled",void 0),u([d({readOnly:!0})],Ge.prototype,"extraQuery",null),u([d()],Ge.prototype,"featuredGroups",void 0),u([d()],Ge.prototype,"featuredItemsGroupQuery",void 0),u([d()],Ge.prototype,"galleryTemplatesGroupQuery",void 0),u([d()],Ge.prototype,"livingAtlasGroupQuery",void 0),u([d()],Ge.prototype,"hasCategorySchema",void 0),u([d()],Ge.prototype,"helpBase",void 0),u([d()],Ge.prototype,"helperServices",void 0),u([d()],Ge.prototype,"helpMap",void 0),u([d()],Ge.prototype,"homePageFeaturedContent",void 0),u([d()],Ge.prototype,"homePageFeaturedContentCount",void 0),u([d()],Ge.prototype,"httpPort",void 0),u([d()],Ge.prototype,"httpsPort",void 0),u([d()],Ge.prototype,"id",void 0),u([d()],Ge.prototype,"ipCntryCode",void 0),u([d({readOnly:!0})],Ge.prototype,"isOrganization",null),u([d()],Ge.prototype,"isPortal",void 0),u([d()],Ge.prototype,"isReadOnly",void 0),u([d()],Ge.prototype,"layerTemplatesGroupQuery",void 0),u([d()],Ge.prototype,"maxTokenExpirationMinutes",void 0),u([d({type:Date})],Ge.prototype,"modified",void 0),u([d()],Ge.prototype,"name",void 0),u([d()],Ge.prototype,"portalHostname",void 0),u([d()],Ge.prototype,"portalMode",void 0),u([d()],Ge.prototype,"portalProperties",void 0),u([d()],Ge.prototype,"region",void 0),u([d({readOnly:!0})],Ge.prototype,"restUrl",null),u([d()],Ge.prototype,"rotatorPanels",void 0),u([d()],Ge.prototype,"showHomePageDescription",void 0),u([d()],Ge.prototype,"sourceJSON",void 0),u([d()],Ge.prototype,"staticImagesUrl",void 0),u([d({json:{name:"2DStylesGroupQuery"}})],Ge.prototype,"stylesGroupQuery2d",void 0),u([d({json:{name:"stylesGroupQuery"}})],Ge.prototype,"stylesGroupQuery3d",void 0),u([d()],Ge.prototype,"supportsHostedServices",void 0),u([d()],Ge.prototype,"symbolSetsGroupQuery",void 0),u([d()],Ge.prototype,"templatesGroupQuery",void 0),u([d()],Ge.prototype,"thumbnail",void 0),u([d({readOnly:!0})],Ge.prototype,"thumbnailUrl",null),u([d()],Ge.prototype,"units",void 0),u([d()],Ge.prototype,"url",void 0),u([d()],Ge.prototype,"urlKey",void 0),u([$e("urlKey")],Ge.prototype,"readUrlKey",null),u([d()],Ge.prototype,"user",void 0),u([$e("user")],Ge.prototype,"readUser",null),u([d()],Ge.prototype,"useStandardizedQuery",void 0),u([d()],Ge.prototype,"useVectorBasemaps",void 0),u([d()],Ge.prototype,"vectorBasemapGalleryGroupQuery",void 0),Ge=Eu=u([$("esri.portal.Portal")],Ge);const Sn=Ge,vVe=fe.getLogger("esri.assets");function _Ve(e,t){return er(wr(e),t)}function wr(e){if(!Ur.assetsPath)throw vVe.errorOnce("The API assets location needs to be set using config.assetsPath. More information: https://arcg.is/1OzLe50"),new j("assets:path-not-set","config.assetsPath is not set");return sc(Ur.assetsPath,e)}const bVe=fe.getLogger("esri.portal.PortalItemResource");let Cv=class extends xe{constructor(e){super(e),this.portalItem=null}normalizeCtorArgs(e){return e&&e.portalItem&&e.path?{...e,path:this._normalizePath(e.path,e.portalItem)}:e}set path(e){b(e)&&Kc(e)?bVe.error("portalitemresource:invalid-path","A portal item resource path must be relative"):this._set("path",e)}_castPath(e){return this._normalizePath(e,this.portalItem)}get url(){return this.portalItem&&this.path?`${this.portalItem.itemUrl}/resources/${this.path}`:null}get itemRelativeUrl(){return this.portalItem&&this.path?`./resources/${this.path}`:null}fetch(e="json",t){const r=this.url;if(R(r))throw new j("portal-item-resource:fetch","Portal item resource does not refer to a valid item or path");return this.portalItem.portal._request(r,{responseType:e,query:{token:this.portalItem.apiKey},signal:ki(t,"signal")})}async update(e,t){return(await ie(()=>Promise.resolve().then(()=>C3),void 0,import.meta.url)).addOrUpdateResource(this,"update",e,t)}hasPath(){return b(this.path)}_normalizePath(e,t){return R(e)?e:(e=e.replace(/^\/+/,""),b(t)&&Kc(e)&&(e=QK(e,t.itemUrl)),e.replace(/^\/+/,"").replace(/^(\.\/)?resources\//,""))}};u([d()],Cv.prototype,"portalItem",void 0),u([d({type:String,value:null})],Cv.prototype,"path",null),u([qt("path")],Cv.prototype,"_castPath",null),u([d({type:String,readOnly:!0})],Cv.prototype,"url",null),u([d({type:String,readOnly:!0})],Cv.prototype,"itemRelativeUrl",null),Cv=u([$("esri.portal.PortalItemResource")],Cv);const wVe=Cv;let fM=class extends xe{constructor(e){super(e),this.created=null,this.rating=null}};u([d()],fM.prototype,"created",void 0),u([d()],fM.prototype,"rating",void 0),fM=u([$("esri.portal.PortalRating")],fM);const L9=fM;var y2;let hr=y2=class extends nR(gh){constructor(e){super(e),this.access=null,this.accessInformation=null,this.apiKey=null,this.applicationProxies=null,this.avgRating=null,this.categories=null,this.created=null,this.culture=null,this.description=null,this.extent=null,this.groupCategories=null,this.id=null,this.itemControl=null,this.licenseInfo=null,this.modified=null,this.name=null,this.numComments=null,this.numRatings=null,this.numViews=null,this.owner=null,this.ownerFolder=null,this.portal=null,this.screenshots=null,this.size=null,this.snippet=null,this.sourceJSON=null,this.spatialReference=null,this.tags=null,this.title=null,this.type=null,this.typeKeywords=null,this.url=null}static from(e){return GC(y2,e)}destroy(){this.portal=null}get displayName(){const e=this.type,t=this.typeKeywords||[];let r=e;return e==="Feature Service"||e==="Feature Collection"?r=t.includes("Table")?"Table":t.includes("Route Layer")?"Route Layer":t.includes("Markup")?"Markup":"Feature Layer":e==="Image Service"?r=t.includes("Elevation 3D Layer")?"Elevation Layer":t.includes("Tiled Imagery")?"Tiled Imagery Layer":"Imagery Layer":e==="Scene Service"?r="Scene Layer":e==="Video Service"?r="Video Layer":e==="Scene Package"?r="Scene Layer Package":e==="Stream Service"?r="Feature Layer":e==="Geoprocessing Service"&&this.portal&&this.portal.isPortal?r=t.includes("Web Tool")?"Tool":"Geoprocessing Service":e==="Geocoding Service"?r="Locator":e==="Geoenrichment Service"?r="GeoEnrichment Service":e==="Microsoft Powerpoint"?r="Microsoft PowerPoint":e==="GeoJson"?r="GeoJSON":e==="Globe Service"?r="Globe Layer":e==="Vector Tile Service"?r="Tile Layer":e==="netCDF"?r="NetCDF":e==="Map Service"?r=t.includes("Spatiotemporal")||!t.includes("Hosted Service")&&!t.includes("Tiled")||t.includes("Relational")?"Map Image Layer":"Tile Layer":e&&e.toLowerCase().includes("add in")?r=e.replace(/(add in)/gi,"Add-In"):e==="datastore catalog service"?r="Big Data File Share":e==="Compact Tile Package"?r="Tile Package (tpkx)":e==="OGCFeatureServer"?r="OGC Feature Layer":e==="web mapping application"&&t.includes("configurableApp")&&(r="Instant App"),r}readExtent(e){return e&&e.length?new Kt(e[0][0],e[0][1],e[1][0],e[1][1]):null}get iconUrl(){const e=this.type&&this.type.toLowerCase()||"",t=this.typeKeywords||[],r="esri/images/portal/",i="16";let s,n=!1,o=!1,a=!1,l=!1,c=!1,h=!1;return e.indexOf("service")>0||e==="feature collection"||e==="kml"||e==="wms"||e==="wmts"||e==="wfs"?(n=t.includes("Hosted Service"),e==="feature service"||e==="feature collection"||e==="kml"||e==="wfs"?(o=t.includes("Table"),a=t.includes("Route Layer"),l=t.includes("Markup"),c=t.includes("Spatiotemporal"),h=t.includes("UtilityNetwork"),s=c&&o?"spatiotemporaltable":o?"table":a?"routelayer":l?"markup":c?"spatiotemporal":n?"featureshosted":h?"utilitynetwork":"features"):s=e==="map service"||e==="wms"||e==="wmts"?n||t.includes("Tiled")||e==="wmts"?"maptiles":"mapimages":e==="scene service"?t.includes("Line")?"sceneweblayerline":t.includes("3DObject")?"sceneweblayermultipatch":t.includes("Point")?"sceneweblayerpoint":t.includes("IntegratedMesh")?"sceneweblayermesh":t.includes("PointCloud")?"sceneweblayerpointcloud":t.includes("Polygon")?"sceneweblayerpolygon":t.includes("Building")?"sceneweblayerbuilding":t.includes("Voxel")?"sceneweblayervoxel":"sceneweblayer":e==="image service"?t.includes("Elevation 3D Layer")?"elevationlayer":t.includes("Tiled Imagery")?"tiledimagerylayer":"imagery":e==="stream service"?"streamlayer":e==="video service"?"mediaservice":e==="vector tile service"?"vectortile":e==="datastore catalog service"?"datastorecollection":e==="geocoding service"?"geocodeservice":e==="geoprocessing service"?t.includes("Web Tool")&&this.portal&&this.portal.isPortal?"tool":"layers":e==="geodata service"?"geodataservice":"layers"):s=e==="web map"||e==="cityengine web scene"?"maps":e==="web scene"?t.includes("ViewingMode-Local")?"webscenelocal":"websceneglobal":e==="web mapping application"&&t.includes("configurableApp")?"instantapps":e==="web mapping application"||e==="mobile application"||e==="application"||e==="operation view"||e==="desktop application"?"apps":e==="map document"||e==="map package"||e==="published map"||e==="scene document"||e==="globe document"||e==="basemap package"||e==="mobile basemap package"||e==="mobile map package"||e==="project package"||e==="project template"||e==="pro map"||e==="layout"||e==="layer"&&t.includes("ArcGIS Pro")||e==="explorer map"&&t.indexOf("Explorer Document")?"mapsgray":e==="service definition"||e==="csv"||e==="shapefile"||e==="cad drawing"||e==="geojson"||e==="360 vr experience"||e==="netcdf"||e==="administrative report"?"datafiles":e==="explorer add in"||e==="desktop add in"||e==="windows viewer add in"||e==="windows viewer configuration"?"appsgray":e==="arcgis pro add in"||e==="arcgis pro configuration"?"addindesktop":e==="rule package"||e==="file geodatabase"||e==="sqlite geodatabase"||e==="csv collection"||e==="kml collection"||e==="windows mobile package"||e==="map template"||e==="desktop application template"||e==="gml"||e==="arcpad package"||e==="code sample"||e==="form"||e==="document link"||e==="earth configuration"||e==="operations dashboard add in"||e==="rules package"||e==="image"||e==="workflow manager package"||e==="explorer map"&&t.includes("Explorer Mapping Application")||t.includes("Document")?"datafilesgray":e==="network analysis service"||e==="geoprocessing service"||e==="geodata service"||e==="geometry service"||e==="geoprocessing package"||e==="locator package"||e==="geoprocessing sample"||e==="workflow manager service"?"toolsgray":e==="layer"||e==="layer package"||e==="explorer layer"?"layersgray":e==="scene package"?"scenepackage":e==="mobile scene package"?"mobilescenepackage":e==="tile package"||e==="compact tile package"?"tilepackage":e==="task file"?"taskfile":e==="report template"?"report-template":e==="statistical data collection"?"statisticaldatacollection":e==="insights workbook"?"workbook":e==="insights model"?"insightsmodel":e==="insights page"?"insightspage":e==="insights theme"?"insightstheme":e==="hub initiative"?"hubinitiative":e==="hubpage"?"hubpage":e==="hub event"?"hubevent":e==="hub site application"?"hubsite":e==="hub project"?"hubproject":e==="relational database connection"?"relationaldatabaseconnection":e==="big data file share"?"datastorecollection":e==="image collection"?"imagecollection":e==="style"?"style":e==="desktop style"?"desktopstyle":e==="dashboard"?"dashboard":e==="raster function template"?"rasterprocessingtemplate":e==="vector tile package"?"vectortilepackage":e==="ortho mapping project"?"orthomappingproject":e==="ortho mapping template"?"orthomappingtemplate":e==="solution"?"solutions":e==="geopackage"?"geopackage":e==="deep learning package"?"deeplearningpackage":e==="real time analytic"?"realtimeanalytics":e==="big data analytic"?"bigdataanalytics":e==="feed"?"feed":e==="excalibur imagery project"?"excaliburimageryproject":e==="notebook"?"notebook":e==="storymap"?"storymap":e==="survey123 add in"?"survey123addin":e==="mission"?"mission":e==="mission report"?"missionreport":e==="quickcapture project"?"quickcaptureproject":e==="pro report"?"proreport":e==="urban model"?"urbanmodel":e==="web experience"?"experiencebuilder":e==="web experience template"?"webexperiencetemplate":e==="experience builder widget"?"experiencebuilderwidget":e==="experience builder widget package"?"experiencebuilderwidgetpackage":e==="workflow"?"workflow":e==="insights script"?"insightsscript":e==="kernel gateway connection"?"kernelgatewayconnection":e==="hub initiative template"?"hubinitiativetemplate":e==="storymap theme"?"storymaptheme":e==="knowledge graph"?"knowledgegraph":e==="native application"?"nativeapp":e==="native application installer"?"nativeappinstaller":e==="link chart"?"linkchart":e==="investigation"?"investigation":e==="ogcfeatureserver"?"features":e==="pro project"?"proproject":e==="insights workbook package"?"insightsworkbookpackage":e==="apache parquet"?"apacheparquet":e==="notebook code snippets"?"notebookcodesnippets":e==="suitability model"?"suitabilitymodel":e==="esri classifier definition"?"classifierdefinition":e==="esri classification schema"?"classificationschema":e==="insights data engineering workbook"?"dataengineeringworkbook":e==="insights data engineering model"?"dataengineeringmodel":e==="deep learning studio project"?"deeplearningproject":"maps",s?wr(r+s+i+".png"):null}get isLayer(){return["Map Service","Feature Service","Feature Collection","Scene Service","Image Service","Stream Service","Vector Tile Service","WMTS","WMS"].includes(this.type)}get itemUrl(){const e=this.get("portal.restUrl");return e&&this.id?`${e}/content/items/${this.id}`:null}get thumbnailUrl(){const e=this.itemUrl,t=this.thumbnail;return e&&t?this.portal._normalizeUrl(`${e}/info/${t}?f=json`):null}get userItemUrl(){const e=this.get("portal.restUrl");if(!e)return null;const t=this.owner||this.get("portal.user.username");return t?`${e}/content/users/${this.ownerFolder?`${t}/${this.ownerFolder}`:t}/items/${this.id}`:null}load(e){this.portal||(this.portal=Sn.getDefault());const t=this.portal.load(e).then(()=>this.sourceJSON?this.sourceJSON:this.id&&this.itemUrl?this.portal._request(this.itemUrl,{signal:b(e)?e.signal:null,query:{token:this.apiKey}}):{}).then(r=>{this.sourceJSON=r,this.read(r)});return this.addResolvingPromise(t),Promise.resolve(this)}addRating(e){const t={method:"post",query:{}};return e instanceof L9&&(e=e.rating),isNaN(e)||typeof e!="number"||(t.query.rating=e),this.portal._request(this.itemUrl+"/addRating",t).then(()=>new L9({rating:e,created:new Date}))}clone(){const e={access:this.access,accessInformation:this.accessInformation,applicationProxies:re(this.applicationProxies),avgRating:this.avgRating,categories:re(this.categories),created:re(this.created),culture:this.culture,description:this.description,extent:re(this.extent),groupCategories:re(this.groupCategories),id:this.id,itemControl:this.itemControl,licenseInfo:this.licenseInfo,modified:re(this.modified),name:this.name,numComments:this.numComments,numRatings:this.numRatings,numViews:this.numViews,owner:this.owner,ownerFolder:this.ownerFolder,portal:this.portal,screenshots:re(this.screenshots),size:this.size,snippet:this.snippet,spatialReference:this.spatialReference,tags:re(this.tags),thumbnail:this.thumbnail,title:this.title,type:this.type,typeKeywords:re(this.typeKeywords),url:this.url};return this.loaded&&(e.loadStatus="loaded"),new y2({sourceJSON:this.sourceJSON}).set(e)}createPostQuery(){const e=this.toJSON();for(const r of["tags","typeKeywords","categories"])e[r]&&(e[r]=e[r].join(", "));const{extent:t}=e;return t&&(e.extent=JSON.stringify(t)),e}deleteRating(){return this.portal._request(this.itemUrl+"/deleteRating",{method:"post"}).then(()=>{})}fetchData(e="json",t){return this.portal._request(this.itemUrl+"/data",{responseType:e,...t,query:{token:this.apiKey}})}fetchRating(e){return this.portal._request(this.itemUrl+"/rating",{query:{token:this.apiKey},...e}).then(t=>t.rating!=null?(t.created=new Date(t.created),new L9(t)):null)}fetchRelatedItems(e,t){return this.portal._requestToTypedArray(this.itemUrl+"/relatedItems",{query:{...e,token:this.apiKey},...t},y2)}getThumbnailUrl(e){let t=this.thumbnailUrl;return t&&e&&(t+=`&w=${e}`),t}reload(){return this.portal._request(this.itemUrl,{cacheBust:!0,query:{token:this.apiKey}}).then(e=>(this.sourceJSON=e,this.read(e),this))}update(e){return this.id?this.load().then(()=>this.portal._signIn()).then(()=>{const t=e&&e.data,r={method:"post"};r.query=this.createPostQuery();for(const i in r.query)r.query[i]===null&&(r.query[i]="");return r.query.clearEmptyFields=!0,t!=null&&(typeof t=="string"?r.query.text=t:typeof t=="object"&&(r.query.text=JSON.stringify(t))),this.portal._request(`${this.userItemUrl}/update`,r).then(()=>this.reload())}):Promise.reject(new j("portal:item-does-not-exist","The item does not exist yet and cannot be updated"))}updateThumbnail(e){return this.id?this.load().then(()=>this.portal._signIn()).then(()=>{const t=e.thumbnail,r=e.filename,i={method:"post"};if(typeof t=="string")ug(t)?i.query={data:t}:i.query={url:Rd(t)},b(r)&&(i.query.filename=r);else{const s=new FormData;b(r)?s.append("file",t,r):s.append("file",t),i.body=s}return this.portal._request(`${this.userItemUrl}/updateThumbnail`,i).then(()=>this.reload())}):Promise.reject(new j("portal:item-does-not-exist","The item does not exist yet and cannot be updated"))}async fetchResources(e={},t){return(await ie(()=>Promise.resolve().then(()=>C3),void 0,import.meta.url)).fetchResources(this,e,t)}async addResource(e,t,r){const i=await ie(()=>Promise.resolve().then(()=>C3),void 0,import.meta.url);return e.portalItem=this,i.addOrUpdateResource(e,"add",t,r)}async removeResource(e,t){const r=await ie(()=>Promise.resolve().then(()=>C3),void 0,import.meta.url);if(e.portalItem&&e.portalItem.itemUrl!==this.itemUrl)throw new j("removeresource:portal-item-mismatch","The portal item associated with the provided resource does not match the item");return r.removeResource(this,e,t)}async removeAllResources(e){return(await ie(()=>Promise.resolve().then(()=>C3),void 0,import.meta.url)).removeAllResources(this,e)}resourceFromPath(e){return new wVe({portalItem:this,path:e})}toJSON(){const e=this.extent,t={accessInformation:this.accessInformation,categories:re(this.categories),created:this.created&&this.created.getTime(),description:this.description,extent:e&&[[e.xmin,e.ymin],[e.xmax,e.ymax]],id:this.id,licenseInfo:this.licenseInfo,modified:this.modified&&this.modified.getTime(),name:this.name,owner:this.owner,ownerFolder:this.ownerFolder,snippet:this.snippet,spatialReference:this.spatialReference,tags:re(this.tags),thumbnail:this.thumbnail,title:this.title,type:this.type,typeKeywords:re(this.typeKeywords),url:this.url};return K_e(t)}static fromJSON(e){if(!e)return null;if(e.declaredClass)throw new Error("JSON object is already hydrated");return new y2({sourceJSON:e})}_getPostQuery(){const e=this.toJSON();for(const t in e)t==="tags"&&e[t]!==null&&(e[t]=e[t].join(", ")),t==="typeKeywords"&&e[t]!==null&&(e[t]=e[t].join(", ")),t==="extent"&&e[t]&&(e[t]=JSON.stringify(e[t]));return e}};u([d({type:["private","shared","org","public"]})],hr.prototype,"access",void 0),u([d()],hr.prototype,"accessInformation",void 0),u([d({type:String})],hr.prototype,"apiKey",void 0),u([d({json:{read:{source:"appProxies"}}})],hr.prototype,"applicationProxies",void 0),u([d()],hr.prototype,"avgRating",void 0),u([d()],hr.prototype,"categories",void 0),u([d({type:Date})],hr.prototype,"created",void 0),u([d()],hr.prototype,"culture",void 0),u([d()],hr.prototype,"description",void 0),u([d({readOnly:!0})],hr.prototype,"displayName",null),u([d({type:Kt})],hr.prototype,"extent",void 0),u([$e("extent")],hr.prototype,"readExtent",null),u([d()],hr.prototype,"groupCategories",void 0),u([d({readOnly:!0})],hr.prototype,"iconUrl",null),u([d()],hr.prototype,"id",void 0),u([d({readOnly:!0})],hr.prototype,"isLayer",null),u([d()],hr.prototype,"itemControl",void 0),u([d({readOnly:!0})],hr.prototype,"itemUrl",null),u([d()],hr.prototype,"licenseInfo",void 0),u([d({type:Date})],hr.prototype,"modified",void 0),u([d()],hr.prototype,"name",void 0),u([d()],hr.prototype,"numComments",void 0),u([d()],hr.prototype,"numRatings",void 0),u([d()],hr.prototype,"numViews",void 0),u([d()],hr.prototype,"owner",void 0),u([d()],hr.prototype,"ownerFolder",void 0),u([d({type:Sn})],hr.prototype,"portal",void 0),u([d()],hr.prototype,"screenshots",void 0),u([d()],hr.prototype,"size",void 0),u([d()],hr.prototype,"snippet",void 0),u([d()],hr.prototype,"sourceJSON",void 0),u([d({type:String})],hr.prototype,"spatialReference",void 0),u([d()],hr.prototype,"tags",void 0),u([d()],hr.prototype,"thumbnail",void 0),u([d({readOnly:!0})],hr.prototype,"thumbnailUrl",null),u([d()],hr.prototype,"title",void 0),u([d()],hr.prototype,"type",void 0),u([d()],hr.prototype,"typeKeywords",void 0),u([d({type:String,json:{read(e,t){var i;if(t.type!=="KML")return e;const r=(i=this.portal)==null?void 0:i.restUrl;return e||(e=r&&this.id?`${r}/content/items/${this.id}/data`:null),e}}})],hr.prototype,"url",void 0),u([d({readOnly:!0})],hr.prototype,"userItemUrl",null),hr=y2=u([$("esri.portal.PortalItem")],hr);const HC=hr,Abe=Object.freeze(Object.defineProperty({__proto__:null,default:HC},Symbol.toStringTag,{value:"Module"})),Sae=/^([a-z]{2})(?:[-_]([A-Za-z]{2}))?$/,xVe={ar:!0,bg:!0,bs:!0,ca:!0,cs:!0,da:!0,de:!0,el:!0,en:!0,es:!0,et:!0,fi:!0,fr:!0,he:!0,hr:!0,hu:!0,id:!0,it:!0,ja:!0,ko:!0,lt:!0,lv:!0,nb:!0,nl:!0,pl:!0,"pt-BR":!0,"pt-PT":!0,ro:!0,ru:!0,sk:!0,sl:!0,sr:!0,sv:!0,th:!0,tr:!0,uk:!0,vi:!0,"zh-CN":!0,"zh-HK":!0,"zh-TW":!0};function Eae(e){var t;return(t=xVe[e])!=null?t:!1}const mM=[],oC=new Map;function Cae(e){for(const t of oC.keys())Obe(e.pattern,t)&&oC.delete(t)}function TVe(e){return mM.includes(e)||(Cae(e),mM.unshift(e)),{remove(){const t=mM.indexOf(e);t>-1&&(mM.splice(t,1),Cae(e))}}}async function Rbe(e){const t=lh();oC.has(e)||oC.set(e,EVe(e,t));const r=oC.get(e);return await CVe.add(r),r}function SVe(e){if(!Sae.test(e))return null;const[,t,r]=Sae.exec(e),i=t+(r?"-"+r.toUpperCase():"");return Eae(i)?i:Eae(t)?t:null}async function EVe(e,t){const r=[];for(const i of mM)if(Obe(i.pattern,e))try{return await i.fetchMessageBundle(e,t)}catch(s){r.push(s)}throw r.length?new j("intl:message-bundle-error",`Errors occurred while loading "${e}"`,{errors:r}):new j("intl:no-message-bundle-loader",`No loader found for message bundle "${e}"`)}function Obe(e,t){return typeof e=="string"?t.startsWith(e):e.test(t)}lee(()=>{oC.clear()});const CVe=new class{constructor(){this._numLoading=0}async waitForAll(){this._dfd&&await this._dfd.promise}add(e){return this._increase(),e.then(()=>this._decrease(),()=>this._decrease()),this.waitForAll()}_increase(){this._numLoading++,this._dfd||(this._dfd=T1())}_decrease(){this._numLoading=Math.max(this._numLoading-1,0),this._dfd&&this._numLoading===0&&(this._dfd.resolve(),this._dfd=null)}};async function AVe(e){if(!e)return;const t=e.includes("-vector")?e.slice(0,e.indexOf("-vector")):e,r=await Rbe("esri/t9n/basemaps");return r[e]||r[t]}const Zq={streets:{id:"streets",classic:!0,deprecated:!0,get thumbnailUrl(){return wr("esri/images/basemap/streets.jpg")},baseMapLayers:[{id:"streets-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Street_Map/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Street Map",showLegend:!1,visibility:!0,opacity:1}]},satellite:{id:"satellite",classic:!0,get thumbnailUrl(){return wr("esri/images/basemap/satellite.jpg")},baseMapLayers:[{id:"satellite-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Imagery",showLegend:!1,visibility:!0,opacity:1}]},hybrid:{id:"hybrid",classic:!0,get thumbnailUrl(){return wr("esri/images/basemap/hybrid.jpg")},baseMapLayers:[{id:"hybrid-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Imagery",showLegend:!1,visibility:!0,opacity:1},{id:"hybrid-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/30d6b8271e1849cd9c3042060001f425/resources/styles/root.json",layerType:"VectorTileLayer",title:"Hybrid Reference Layer",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},terrain:{id:"terrain",classic:!0,get thumbnailUrl(){return wr("esri/images/basemap/terrain.jpg")},baseMapLayers:[{id:"terrain-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Terrain_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Terrain Base",showLegend:!1,visibility:!0,opacity:1},{id:"terrain-reference-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Reference/World_Reference_Overlay/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Reference Overlay",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},topo:{id:"topo",classic:!0,deprecated:!0,get thumbnailUrl(){return wr("esri/images/basemap/topo.jpg")},baseMapLayers:[{id:"topo-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Topo_Map/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Topo Map",showLegend:!1,visibility:!0,opacity:1}]},gray:{id:"gray",classic:!0,deprecated:!0,get thumbnailUrl(){return wr("esri/images/basemap/gray.jpg")},baseMapLayers:[{id:"gray-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Light_Gray_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Light Gray Base",showLegend:!1,visibility:!0,opacity:1},{id:"gray-reference-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Light_Gray_Reference/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Light Gray Reference",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},"dark-gray":{id:"dark-gray",classic:!0,deprecated:!0,get thumbnailUrl(){return wr("esri/images/basemap/dark-gray.jpg")},baseMapLayers:[{id:"dark-gray-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Dark_Gray_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Dark Gray Base",showLegend:!1,visibility:!0,opacity:1},{id:"dark-gray-reference-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Dark_Gray_Reference/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Dark Gray Reference",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},oceans:{id:"oceans",classic:!0,get thumbnailUrl(){return wr("esri/images/basemap/oceans.jpg")},baseMapLayers:[{id:"oceans-base-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Ocean/World_Ocean_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Ocean Base",showLegend:!1,visibility:!0,opacity:1},{id:"oceans-reference-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Ocean/World_Ocean_Reference/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Ocean Reference",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},"national-geographic":{id:"national-geographic",classic:!0,deprecated:!0,get thumbnailUrl(){return wr("esri/images/basemap/national-geographic.jpg")},baseMapLayers:[{id:"national-geographic-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/NatGeo_World_Map/MapServer",title:"NatGeo World Map",showLegend:!1,layerType:"ArcGISTiledMapServiceLayer",visibility:!0,opacity:1}]},osm:{id:"osm",classic:!0,get thumbnailUrl(){return wr("esri/images/basemap/osm.jpg")},baseMapLayers:[{id:"osm-base-layer",layerType:"OpenStreetMap",title:"Open Street Map",showLegend:!1,visibility:!0,opacity:1}]},"dark-gray-vector":{id:"dark-gray-vector",classic:!0,get thumbnailUrl(){return wr("esri/images/basemap/dark-gray-vector.jpg")},baseMapLayers:[{id:"dark-gray-base-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/5e9b3685f4c24d8781073dd928ebda50/resources/styles/root.json",layerType:"VectorTileLayer",title:"Dark Gray Base",visibility:!0,opacity:1},{id:"dark-gray-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/747cb7a5329c478cbe6981076cc879c5/resources/styles/root.json",layerType:"VectorTileLayer",title:"Dark Gray Reference",isReference:!0,visibility:!0,opacity:1}]},"gray-vector":{id:"gray-vector",classic:!0,get thumbnailUrl(){return wr("esri/images/basemap/gray-vector.jpg")},baseMapLayers:[{id:"gray-base-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/291da5eab3a0412593b66d384379f89f/resources/styles/root.json",layerType:"VectorTileLayer",title:"Light Gray Base",visibility:!0,opacity:1},{id:"gray-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/1768e8369a214dfab4e2167d5c5f2454/resources/styles/root.json",layerType:"VectorTileLayer",title:"Light Gray Reference",isReference:!0,visibility:!0,opacity:1}]},"streets-vector":{id:"streets-vector",classic:!0,get thumbnailUrl(){return wr("esri/images/basemap/streets-vector.jpg")},baseMapLayers:[{id:"streets-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/de26a3cf4cc9451298ea173c4b324736/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets",visibility:!0,opacity:1}]},"topo-vector":{id:"topo-vector",classic:!0,get thumbnailUrl(){return wr("esri/images/basemap/topo-vector.jpg")},baseMapLayers:[{id:"world-hillshade-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Hillshade",showLegend:!1,visibility:!0,opacity:1},{id:"topo-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/7dc6cea0b1764a1f9af2e679f642f0f5/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Topo",visibility:!0,opacity:1}]},"streets-night-vector":{id:"streets-night-vector",classic:!0,get thumbnailUrl(){return wr("esri/images/basemap/streets-night.jpg")},baseMapLayers:[{id:"streets-night-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/86f556a2d1fd468181855a35e344567f/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets Night",visibility:!0,opacity:1}]},"streets-relief-vector":{id:"streets-relief-vector",classic:!0,get thumbnailUrl(){return wr("esri/images/basemap/streets-relief.jpg")},baseMapLayers:[{id:"world-hillshade-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Hillshade",showLegend:!1,visibility:!0,opacity:1},{id:"streets-relief-vector-base-layer",styleUrl:"//www.arcgis.com/sharing/rest/content/items/b266e6d17fc345b498345613930fbd76/resources/styles/root.json",title:"World Streets Relief",layerType:"VectorTileLayer",visibility:!0,opacity:1}]},"streets-navigation-vector":{id:"streets-navigation-vector",classic:!0,get thumbnailUrl(){return wr("esri/images/basemap/streets-navigation.jpg")},baseMapLayers:[{id:"streets-navigation-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/63c47b7177f946b49902c24129b87252/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets Navigation",visibility:!0,opacity:1}]},"arcgis-imagery":{get thumbnailUrl(){return wr("esri/images/basemap/hybrid.jpg")},title:"Imagery Hybrid",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Imagery",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/World_Imagery/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Imagery:Labels",title:"Hybrid Reference Layer",isReference:!0}]},"arcgis-imagery-standard":{get thumbnailUrl(){return wr("esri/images/basemap/satellite.jpg")},title:"Imagery",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Imagery",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/World_Imagery/MapServer"}]},"arcgis-imagery-labels":{title:"Hybrid [Reference]",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Imagery:Labels",title:"Hybrid Reference Layer",isReference:!0}]},"arcgis-light-gray":{get thumbnailUrl(){return wr("esri/images/basemap/gray-vector.jpg")},title:"Light Gray Canvas",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:LightGray:Base",title:"Light Gray Canvas Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:LightGray:Labels",title:"Light Gray Canvas Labels",isReference:!0}]},"arcgis-dark-gray":{get thumbnailUrl(){return wr("esri/images/basemap/dark-gray.jpg")},title:"Dark Gray Canvas",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:DarkGray:Base",title:"Dark Gray Canvas Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:DarkGray:Labels",title:"Dark Gray Canvas Labels",isReference:!0}]},"arcgis-navigation":{get thumbnailUrl(){return wr("esri/images/basemap/streets-navigation.jpg")},title:"Navigation",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Navigation",title:"World Navigation Map"}]},"arcgis-navigation-night":{title:"Navigation (Dark Mode)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:NavigationNight",title:"World Navigation Map (Dark Mode)"}]},"arcgis-streets":{get thumbnailUrl(){return wr("esri/images/basemap/streets-vector.jpg")},title:"Streets",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Streets",title:"World Street Map"}]},"arcgis-streets-night":{get thumbnailUrl(){return wr("esri/images/basemap/streets-night.jpg")},title:"Streets (Night)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:StreetsNight",title:"World Street Map (Night)"}]},"arcgis-streets-relief":{get thumbnailUrl(){return wr("esri/images/basemap/streets-relief.jpg")},title:"Streets (with Relief)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:StreetsRelief:Base",title:"World Street Map (with Relief)"}]},"arcgis-topographic":{get thumbnailUrl(){return wr("esri/images/basemap/topo.jpg")},title:"Topographic",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Topographic:Base",title:"World Topographic Map"}]},"arcgis-oceans":{get thumbnailUrl(){return wr("esri/images/basemap/oceans.jpg")},title:"Oceans",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Ocean Base",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Ocean/World_Ocean_Base/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Oceans:Labels",title:"World Ocean Reference",isReference:!0}]},"osm-standard":{title:"OpenStreetMap",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:Standard",title:"OpenStreetMap"}]},"osm-standard-relief":{title:"OpenStreetMap (with relief)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:StandardRelief:Base",layerType:"VectorTileLayer",title:"OpenStreetMap Relief Base"}]},"osm-streets":{title:"OpenStreetMap (Streets)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:Streets",title:"OpenStreetMap (Streets)"}]},"osm-streets-relief":{title:"OpenStreetMap (Streets with relief)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:StreetsRelief:Base",layerType:"VectorTileLayer",title:"OpenStreetMap Relief Base"}]},"osm-light-gray":{title:"OpenStreetMap (Light Gray Canvas)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:LightGray:Base",title:"OSM (Light Gray Base)"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:LightGray:Labels",title:"OSM (Light Gray Reference)",isReference:!0}]},"osm-dark-gray":{title:"OpenStreetMap (Dark Gray Canvas)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:DarkGray:Base",title:"OSM (Dark Gray Base)"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:DarkGray:Labels",title:"OSM (Dark Gray Reference)",isReference:!0}]},"arcgis-terrain":{title:"Terrain with Labels",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Terrain:Base",title:"World Terrain Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Terrain:Detail",title:"World Terrain Reference",isReference:!0}]},"arcgis-community":{title:"Community",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Community",title:"Community"}]},"arcgis-charted-territory":{title:"Charted Territory",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:ChartedTerritory:Base",title:"Charted Territory"}]},"arcgis-colored-pencil":{title:"Colored Pencil",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:ColoredPencil",title:"Colored Pencil"}]},"arcgis-nova":{title:"Nova",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Nova",title:"Nova"}]},"arcgis-modern-antique":{title:"Modern Antique",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:ModernAntique:Base",title:"Modern Antique"}]},"arcgis-midcentury":{title:"Mid-Century",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Midcentury",title:"Mid-Century"}]},"arcgis-newspaper":{title:"Newspaper",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Newspaper",title:"Newspaper"}]},"arcgis-hillshade-light":{title:"Hillshade",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"}]},"arcgis-hillshade-dark":{title:"Hillshade (Dark)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade (Dark)",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade_Dark/MapServer"}]}};function Aae(e){const t=e==null?void 0:e.type;return t==="imagery-tile"||t==="tile"||t==="open-street-map"||t==="vector-tile"||t==="web-tile"||t==="wmts"}function aC(e){const t=e==null?void 0:e.type;return t==="base-tile"||t==="tile"||t==="elevation"||t==="imagery-tile"||t==="base-elevation"||t==="open-street-map"||t==="wcs"||t==="web-tile"||t==="wmts"||t==="vector-tile"}function Rae(e){return(e==null?void 0:e.type)==="voxel"}function Oae(e){return(e==null?void 0:e.type)==="imagery-tile"}function Mbe(e){var t;return((t=e.parent)==null?void 0:t.declaredClass)==="esri.Basemap"&&e.parent.baseLayers.includes(e)}function uee(e){var t;return(e==null?void 0:e.type)==="feature"&&!e.url&&((t=e.source)==null?void 0:t.type)==="memory"}function yIt(e){var t;return(e==null?void 0:e.type)==="feature"&&((t=e.source)==null?void 0:t.type)==="feature-layer"}function Yq(e){return e.labelsVisible===!0&&e.labelingInfo!=null&&e.labelingInfo.length>0}function RVe(e){if(e.activeLayer){const t=e.activeLayer.tileMatrixSet;if(t)return t;const r=e.activeLayer.tileMatrixSets;if(r)return r}return null}const OVe=new Set(["bing-maps","imagery","imagery-tile","map-image","open-street-map","tile","unknown","unsupported","vector-tile","web-tile","wms","wmts"]),MVe=new Set(["csv","feature","geo-rss","geojson","group","imagery","imagery-tile","kml","map-image","map-notes","ogc-feature","route","tile","unknown","unsupported","vector-tile","web-tile","wfs","wms","wmts"]);function PVe(e){return e.layerContainerType==="basemap"?OVe:e.layerContainerType==="operational-layers"?MVe:null}function IVe(e,t){if(t.restrictedWebMapWriting){const r=PVe(t);return!b(r)||r.has(e.type)&&!uee(e)}return!0}function $Ve(e,t){if(uee(e)){const r=rR("featureCollection.layers",t),i=r&&r[0]&&r[0].layerDefinition;i&&D9(e,i)}else e.type==="stream"?D9(e,t.layerDefinition=t.layerDefinition||{}):e.type!=="group"&&D9(e,t)}function D9(e,t){"maxScale"in e&&(t.maxScale=vU(e.maxScale)),"minScale"in e&&(t.minScale=vU(e.minScale))}function LVe(e,t){if($Ve(e,t),"blendMode"in e&&(t.blendMode=e.blendMode,t.blendMode==="normal"&&delete t.blendMode),t.opacity=vU(e.opacity),t.title=e.title||"Layer",t.visibility=e.visible,"legendEnabled"in e&&e.type!=="wmts")if(uee(e)){const r=t.featureCollection;r&&(r.showLegend=e.legendEnabled)}else t.showLegend=e.legendEnabled}function Mae(e,t,r){if(!("write"in e)||!e.write)return r&&r.messages&&r.messages.push(new j("layer:unsupported",`Layers (${e.title}, ${e.id}) of type '${e.declaredClass}' cannot be persisted`,{layer:e})),null;if(IVe(e,r)){const i={};return e.write(i,r)?i:null}return b(t)&&LVe(e,t=re(t)),t}var N4;let DVe=0;const N9=fe.getLogger("esri.Basemap");let qh=N4=class extends nR(gh){constructor(e){super(e),this.id=null,this.portalItem=null,this.spatialReference=null,this.thumbnailUrl=null,this.title="Basemap",this.id=Date.now().toString(16)+"-basemap-"+DVe++,this.baseLayers=new ot,this.referenceLayers=new ot;const t=i=>{i.parent&&i.parent!==this&&"remove"in i.parent&&i.parent.remove(i),i.parent=this,i.type==="elevation"&&N9.error(`Layer '${i.title}, id:${i.id}' of type '${i.type}' is not supported as a basemap layer and will therefore be ignored.`)},r=i=>{i.parent=null};this.baseLayers.on("after-add",i=>t(i.item)),this.referenceLayers.on("after-add",i=>t(i.item)),this.baseLayers.on("after-remove",i=>r(i.item)),this.referenceLayers.on("after-remove",i=>r(i.item))}initialize(){this.when().catch(e=>{N9.error("#load()",`Failed to load basemap (title: '${this.title}', id: '${this.id}')`,e)}),this.resourceInfo&&this.read(this.resourceInfo.data,this.resourceInfo.context)}destroy(){var r;const e=this.baseLayers.removeAll();for(const i of e)i.destroy();const t=this.referenceLayers.removeAll();for(const i of t)i.destroy();this.baseLayers.destroy(),this.referenceLayers.destroy(),(r=this.portalItem)==null||r.destroy(),this.portalItem=null}normalizeCtorArgs(e){return e&&"resourceInfo"in e&&(this._set("resourceInfo",e.resourceInfo),delete(e={...e}).resourceInfo),e}set baseLayers(e){this._set("baseLayers",iT(e,this._get("baseLayers")))}_writeBaseLayers(e,t,r){const i=[];e&&(r={...r,layerContainerType:"basemap"},this.baseLayers.forEach(s=>{const n=Mae(s,r.webmap?r.webmap.getLayerJSONFromResourceInfo(s):null,r);b(n)&&i.push(n)}),this.referenceLayers.forEach(s=>{const n=Mae(s,r.webmap?r.webmap.getLayerJSONFromResourceInfo(s):null,r);b(n)&&(n.isReference=!0,i.push(n))})),t.baseMapLayers=i}set referenceLayers(e){this._set("referenceLayers",iT(e,this._get("referenceLayers")))}writeTitle(e,t){t.title=e||"Basemap"}load(e){return this.addResolvingPromise(this._loadFromSource(e)),Promise.resolve(this)}loadAll(){return K1e(this,e=>{e(this.baseLayers,this.referenceLayers)})}clone(){const e={id:this.id,title:this.title,portalItem:this.portalItem,baseLayers:this.baseLayers.slice(),referenceLayers:this.referenceLayers.slice()};return this.loaded&&(e.loadStatus="loaded"),new N4({resourceInfo:this.resourceInfo}).set(e)}read(e,t){this.resourceInfo||this._set("resourceInfo",{data:e,context:t}),super.read(e,t)}write(e,t){return e=e||{},t&&t.origin||(t={origin:"web-map",...t}),super.write(e,t),!this.loaded&&this.resourceInfo&&this.resourceInfo.data.baseMapLayers&&(e.baseMapLayers=this.resourceInfo.data.baseMapLayers.map(r=>{const i=re(r);return i.url&&Ym(i.url)&&(i.url=`https:${i.url}`),i.templateUrl&&Ym(i.templateUrl)&&(i.templateUrl=`https:${i.templateUrl}`),i})),e}async _loadFromSource(e){const{resourceInfo:t,portalItem:r}=this;Jt(e);const i=[];if(t){const s=t.context?t.context.url:null;if(i.push(this._loadLayersFromJSON(t.data,s,e)),t.data.id&&!t.data.title){const n=t.data.id;i.push(AVe(n).then(o=>{o&&this.read({title:o},t.context)}))}}else r&&i.push(this._loadFromItem(r,e));await Promise.all(i)}async _loadLayersFromJSON(e,t,r){const i=this.resourceInfo&&this.resourceInfo.context,s=this.portalItem&&this.portalItem.portal||i&&i.portal||null,n=i&&i.origin==="web-scene"?"web-scene":"web-map",{populateOperationalLayers:o}=await ie(()=>import("./layersCreator.596089ee.js"),["layersCreator.596089ee.js","lazyLayerLoader.fb403b9c.js","portalLayers.19863727.js","layersLoader.55238685.js","jsonContext.a084d534.js","portalItemUtils.13c3070b.js"],import.meta.url),a=[];if(Jt(r),e.baseMapLayers&&Array.isArray(e.baseMapLayers)){const l={context:{origin:n,url:t,portal:s,layerContainerType:"basemap"},defaultLayerType:"DefaultTileLayer"},c=o(this.baseLayers,e.baseMapLayers.filter(p=>!p.isReference),l);a.push(c);const h=o(this.referenceLayers,e.baseMapLayers.filter(p=>p.isReference),l);a.push(h)}await xs(a)}async _loadFromItem(e,t){const r=await e.load(t),i=await r.fetchData("json",t),s=Ds(e.itemUrl);return this._set("resourceInfo",{data:i.baseMap,context:{origin:"web-map",portal:e.portal||Sn.getDefault(),url:s}}),this.read(this.resourceInfo.data,this.resourceInfo.context),this.read({spatialReference:i.spatialReference},this.resourceInfo.context),this.read({title:e.title,thumbnailUrl:e.thumbnailUrl},{origin:"portal-item",portal:e.portal||Sn.getDefault(),url:s}),this._loadLayersFromJSON(this.resourceInfo.data,s,t)}static fromId(e){const t=Zq[e];if(t){if(t.deprecated){let r=null;e==="dark-gray"?r="dark-gray-vector":e==="gray"?r="gray-vector":e==="streets"?r="streets-vector":e==="topo"&&(r="topo-vector"),v1e(N9,`The ${e} basemap has entered mature support and is no longer being updated.`,{replacement:r,see:"https://arcg.is/1iq8aD",warnOnce:!0})}return N4.fromJSON(t)}return null}};u([d({json:{write:{ignoreOrigin:!0,target:"baseMapLayers",writer(e,t,r,i){this._writeBaseLayers(e,t,i)}},origins:{"web-scene":{write:{ignoreOrigin:!0,target:{baseMapLayers:{type:ot}},writer(e,t,r,i){this._writeBaseLayers(e,t,i)}}}}}})],qh.prototype,"baseLayers",null),u([d({type:String,json:{origins:{"web-scene":{write:!0}}}})],qh.prototype,"id",void 0),u([d({type:HC})],qh.prototype,"portalItem",void 0),u([d()],qh.prototype,"referenceLayers",null),u([d({readOnly:!0})],qh.prototype,"resourceInfo",void 0),u([d({type:Ze})],qh.prototype,"spatialReference",void 0),u([d()],qh.prototype,"thumbnailUrl",void 0),u([d({type:String,json:{origins:{"web-scene":{write:{isRequired:!0}}}}})],qh.prototype,"title",void 0),u([Xe("title")],qh.prototype,"writeTitle",null),qh=N4=u([$("esri.Basemap")],qh);const Bm=qh,NVe=Object.freeze(Object.defineProperty({__proto__:null,default:Bm},Symbol.toStringTag,{value:"Module"})),SU={transparent:[0,0,0,0],black:[0,0,0,1],silver:[192,192,192,1],gray:[128,128,128,1],white:[255,255,255,1],maroon:[128,0,0,1],red:[255,0,0,1],purple:[128,0,128,1],fuchsia:[255,0,255,1],green:[0,128,0,1],lime:[0,255,0,1],olive:[128,128,0,1],yellow:[255,255,0,1],navy:[0,0,128,1],blue:[0,0,255,1],teal:[0,128,128,1],aqua:[0,255,255,1],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],blanchedalmond:[255,235,205,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],oldlace:[253,245,230,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],rebeccapurple:[102,51,153,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],whitesmoke:[245,245,245,1],yellowgreen:[154,205,50,1]};function Pbe(e){return SU[e]||SU[e.toLowerCase()]}function hee(e){var t;return(t=SU[e])!=null?t:SU[e.toLowerCase()]}function FVe(e){return[...hee(e)]}function F9(e,t,r){r<0&&++r,r>1&&--r;const i=6*r;return i<1?e+(t-e)*i:2*r<1?t:3*r<2?e+(t-e)*(2/3-r)*6:e}function Ibe(e,t,r,i=1){const s=(e%360+360)%360/360,n=r<=.5?r*(t+1):r+t-r*t,o=2*r-n;return[Math.round(255*F9(o,n,s+1/3)),Math.round(255*F9(o,n,s)),Math.round(255*F9(o,n,s-1/3)),i]}function kVe(e){const t=e.length>5,r=t?8:4,i=(1<<r)-1,s=t?1:17,n=t?e.length===9:e.length===5;let o=Number("0x"+e.substr(1));if(isNaN(o))return null;const a=[0,0,0,1];let l;return n&&(l=o&i,o>>=r,a[3]=s*l/255),l=o&i,o>>=r,a[2]=s*l,l=o&i,o>>=r,a[1]=s*l,l=o&i,o>>=r,a[0]=s*l,a}function M(){return[0,0,0]}function Qs(e){return[e[0],e[1],e[2]]}function Ue(e,t,r){return[e,t,r]}function Bl(e){const t=M(),r=Math.min(3,e.length);for(let i=0;i<r;++i)t[i]=e[i];return t}function dee(e,t){return new Float64Array(e,t,3)}function $be(){return M()}function Lbe(){return Ue(1,1,1)}function Dbe(){return Ue(1,0,0)}function Nbe(){return Ue(0,1,0)}function pee(){return Ue(0,0,1)}const dl=$be(),Nm=Lbe(),UVe=Dbe(),VVe=Nbe(),Fbe=pee();Object.freeze(Object.defineProperty({__proto__:null,create:M,clone:Qs,fromValues:Ue,fromArray:Bl,createView:dee,zeros:$be,ones:Lbe,unitX:Dbe,unitY:Nbe,unitZ:pee,ZEROS:dl,ONES:Nm,UNIT_X:UVe,UNIT_Y:VVe,UNIT_Z:Fbe},Symbol.toStringTag,{value:"Module"}));const At=1e-6,Kp=Math.random,zVe=Math.PI/180,BVe=180/Math.PI;function Qz(e){return e*zVe}function GVe(e){return e*BVe}function jVe(e,t){return Math.abs(e-t)<=At*Math.max(1,Math.abs(e),Math.abs(t))}Object.freeze(Object.defineProperty({__proto__:null,EPSILON:At,RANDOM:Kp,toRadian:Qz,toDegree:GVe,equals:jVe},Symbol.toStringTag,{value:"Module"}));function Re(e){const t=e[0],r=e[1],i=e[2];return Math.sqrt(t*t+r*r+i*i)}function ae(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function se(e,t,r,i){return e[0]=t,e[1]=r,e[2]=i,e}function de(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e}function pe(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e}function Jz(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e[2]=t[2]*r[2],e}function EU(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e[2]=t[2]/r[2],e}function HVe(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e}function qVe(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e}function Qq(e,t){return e[0]=Math.abs(t[0]),e[1]=Math.abs(t[1]),e[2]=Math.abs(t[2]),e}function kbe(e,t){return e[0]=Math.sign(t[0]),e[1]=Math.sign(t[1]),e[2]=Math.sign(t[2]),e}function Ube(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e[2]=Math.min(t[2],r[2]),e}function WVe(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e[2]=Math.max(t[2],r[2]),e}function XVe(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e}function le(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e}function fx(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e[2]=t[2]+r[2]*i,e}function pi(e,t){const r=t[0]-e[0],i=t[1]-e[1],s=t[2]-e[2];return Math.sqrt(r*r+i*i+s*s)}function Fn(e,t){const r=t[0]-e[0],i=t[1]-e[1],s=t[2]-e[2];return r*r+i*i+s*s}function ul(e){const t=e[0],r=e[1],i=e[2];return t*t+r*r+i*i}function Ra(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e}function ZVe(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e}function we(e,t){const r=t[0],i=t[1],s=t[2];let n=r*r+i*i+s*s;return n>0&&(n=1/Math.sqrt(n),e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n),e}function Te(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function ut(e,t,r){const i=t[0],s=t[1],n=t[2],o=r[0],a=r[1],l=r[2];return e[0]=s*l-n*a,e[1]=n*o-i*l,e[2]=i*a-s*o,e}function En(e,t,r,i){const s=t[0],n=t[1],o=t[2];return e[0]=s+i*(r[0]-s),e[1]=n+i*(r[1]-n),e[2]=o+i*(r[2]-o),e}function YVe(e,t,r,i,s,n){const o=n*n,a=o*(2*n-3)+1,l=o*(n-2)+n,c=o*(n-1),h=o*(3-2*n);return e[0]=t[0]*a+r[0]*l+i[0]*c+s[0]*h,e[1]=t[1]*a+r[1]*l+i[1]*c+s[1]*h,e[2]=t[2]*a+r[2]*l+i[2]*c+s[2]*h,e}function QVe(e,t,r,i,s,n){const o=1-n,a=o*o,l=n*n,c=a*o,h=3*n*a,p=3*l*o,f=l*n;return e[0]=t[0]*c+r[0]*h+i[0]*p+s[0]*f,e[1]=t[1]*c+r[1]*h+i[1]*p+s[1]*f,e[2]=t[2]*c+r[2]*h+i[2]*p+s[2]*f,e}function JVe(e,t){t=t||1;const r=2*Kp()*Math.PI,i=2*Kp()-1,s=Math.sqrt(1-i*i)*t;return e[0]=Math.cos(r)*s,e[1]=Math.sin(r)*s,e[2]=i*t,e}function Ve(e,t,r){const i=t[0],s=t[1],n=t[2];return e[0]=r[0]*i+r[4]*s+r[8]*n+r[12],e[1]=r[1]*i+r[5]*s+r[9]*n+r[13],e[2]=r[2]*i+r[6]*s+r[10]*n+r[14],e}function Hc(e,t,r){const i=t[0],s=t[1],n=t[2];return e[0]=i*r[0]+s*r[3]+n*r[6],e[1]=i*r[1]+s*r[4]+n*r[7],e[2]=i*r[2]+s*r[5]+n*r[8],e}function ch(e,t,r){const i=r[0],s=r[1],n=r[2],o=r[3],a=t[0],l=t[1],c=t[2];let h=s*c-n*l,p=n*a-i*c,f=i*l-s*a,m=s*f-n*p,g=n*h-i*f,v=i*p-s*h;const w=2*o;return h*=w,p*=w,f*=w,m*=2,g*=2,v*=2,e[0]=a+h+m,e[1]=l+p+g,e[2]=c+f+v,e}function KVe(e,t,r,i){const s=[],n=[];return s[0]=t[0]-r[0],s[1]=t[1]-r[1],s[2]=t[2]-r[2],n[0]=s[0],n[1]=s[1]*Math.cos(i)-s[2]*Math.sin(i),n[2]=s[1]*Math.sin(i)+s[2]*Math.cos(i),e[0]=n[0]+r[0],e[1]=n[1]+r[1],e[2]=n[2]+r[2],e}function eze(e,t,r,i){const s=[],n=[];return s[0]=t[0]-r[0],s[1]=t[1]-r[1],s[2]=t[2]-r[2],n[0]=s[2]*Math.sin(i)+s[0]*Math.cos(i),n[1]=s[1],n[2]=s[2]*Math.cos(i)-s[0]*Math.sin(i),e[0]=n[0]+r[0],e[1]=n[1]+r[1],e[2]=n[2]+r[2],e}function tze(e,t,r,i){const s=[],n=[];return s[0]=t[0]-r[0],s[1]=t[1]-r[1],s[2]=t[2]-r[2],n[0]=s[0]*Math.cos(i)-s[1]*Math.sin(i),n[1]=s[0]*Math.sin(i)+s[1]*Math.cos(i),n[2]=s[2],e[0]=n[0]+r[0],e[1]=n[1]+r[1],e[2]=n[2]+r[2],e}function rze(e,t){ae(TD,e),ae(SD,t),we(TD,TD),we(SD,SD);const r=Te(TD,SD);return r>1?0:r<-1?Math.PI:Math.acos(r)}const TD=M(),SD=M();function ize(e){return"vec3("+e[0]+", "+e[1]+", "+e[2]+")"}function Xl(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]}function cT(e,t){if(e===t)return!0;const r=e[0],i=e[1],s=e[2],n=t[0],o=t[1],a=t[2];return Math.abs(r-n)<=At*Math.max(1,Math.abs(r),Math.abs(n))&&Math.abs(i-o)<=At*Math.max(1,Math.abs(i),Math.abs(o))&&Math.abs(s-a)<=At*Math.max(1,Math.abs(s),Math.abs(a))}function S0(e,t,r){const i=r[0]-t[0],s=r[1]-t[1],n=r[2]-t[2];let o=i*i+s*s+n*n;return o>0?(o=1/Math.sqrt(o),e[0]=i*o,e[1]=s*o,e[2]=n*o,e):(e[0]=0,e[1]=0,e[2]=0,e)}const su=pe,sze=Jz,nze=EU,fee=pi,mee=Fn,gee=Re,Jq=ul,Pae=Object.freeze(Object.defineProperty({__proto__:null,length:Re,copy:ae,set:se,add:de,subtract:pe,multiply:Jz,divide:EU,ceil:HVe,floor:qVe,abs:Qq,sign:kbe,min:Ube,max:WVe,round:XVe,scale:le,scaleAndAdd:fx,distance:pi,squaredDistance:Fn,squaredLength:ul,negate:Ra,inverse:ZVe,normalize:we,dot:Te,cross:ut,lerp:En,hermite:YVe,bezier:QVe,random:JVe,transformMat4:Ve,transformMat3:Hc,transformQuat:ch,rotateX:KVe,rotateY:eze,rotateZ:tze,angle:rze,str:ize,exactEquals:Xl,equals:cT,direction:S0,sub:su,mul:sze,div:nze,dist:fee,sqrDist:mee,len:gee,sqrLen:Jq},Symbol.toStringTag,{value:"Module"}));function ef(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function Kr(e,t,r,i,s){return e[0]=t,e[1]=r,e[2]=i,e[3]=s,e}function yee(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e}function Vbe(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e}function zbe(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e[2]=t[2]*r[2],e[3]=t[3]*r[3],e}function Bbe(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e[2]=t[2]/r[2],e[3]=t[3]/r[3],e}function oze(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e[3]=Math.ceil(t[3]),e}function aze(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e[3]=Math.floor(t[3]),e}function lze(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e[2]=Math.min(t[2],r[2]),e[3]=Math.min(t[3],r[3]),e}function cze(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e[2]=Math.max(t[2],r[2]),e[3]=Math.max(t[3],r[3]),e}function uze(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e[3]=Math.round(t[3]),e}function H$(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e}function hze(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e[2]=t[2]+r[2]*i,e[3]=t[3]+r[3]*i,e}function Gbe(e,t){const r=t[0]-e[0],i=t[1]-e[1],s=t[2]-e[2],n=t[3]-e[3];return Math.sqrt(r*r+i*i+s*s+n*n)}function CU(e,t){const r=t[0]-e[0],i=t[1]-e[1],s=t[2]-e[2],n=t[3]-e[3];return r*r+i*i+s*s+n*n}function vee(e){const t=e[0],r=e[1],i=e[2],s=e[3];return Math.sqrt(t*t+r*r+i*i+s*s)}function _ee(e){const t=e[0],r=e[1],i=e[2],s=e[3];return t*t+r*r+i*i+s*s}function dze(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e}function pze(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e[3]=1/t[3],e}function jbe(e,t){const r=t[0],i=t[1],s=t[2],n=t[3];let o=r*r+i*i+s*s+n*n;return o>0&&(o=1/Math.sqrt(o),e[0]=r*o,e[1]=i*o,e[2]=s*o,e[3]=n*o),e}function Hbe(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]}function Kz(e,t,r,i){const s=t[0],n=t[1],o=t[2],a=t[3];return e[0]=s+i*(r[0]-s),e[1]=n+i*(r[1]-n),e[2]=o+i*(r[2]-o),e[3]=a+i*(r[3]-a),e}function fze(e,t){let r,i,s,n,o,a;t=t||1;do r=2*Kp()-1,i=2*Kp()-1,o=r*r+i*i;while(o>=1);do s=2*Kp()-1,n=2*Kp()-1,a=s*s+n*n;while(a>=1);const l=Math.sqrt((1-o)/a);return e[0]=t*r,e[1]=t*i,e[2]=t*s*l,e[3]=t*n*l,e}function ih(e,t,r){const i=t[0],s=t[1],n=t[2],o=t[3];return e[0]=r[0]*i+r[4]*s+r[8]*n+r[12]*o,e[1]=r[1]*i+r[5]*s+r[9]*n+r[13]*o,e[2]=r[2]*i+r[6]*s+r[10]*n+r[14]*o,e[3]=r[3]*i+r[7]*s+r[11]*n+r[15]*o,e}function mze(e,t,r){const i=t[0],s=t[1],n=t[2],o=r[0],a=r[1],l=r[2],c=r[3],h=c*i+a*n-l*s,p=c*s+l*i-o*n,f=c*n+o*s-a*i,m=-o*i-a*s-l*n;return e[0]=h*c+m*-o+p*-l-f*-a,e[1]=p*c+m*-a+f*-o-h*-l,e[2]=f*c+m*-l+h*-a-p*-o,e[3]=t[3],e}function gze(e){return"vec4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}function oI(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]}function qbe(e,t){const r=e[0],i=e[1],s=e[2],n=e[3],o=t[0],a=t[1],l=t[2],c=t[3];return Math.abs(r-o)<=At*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(i-a)<=At*Math.max(1,Math.abs(i),Math.abs(a))&&Math.abs(s-l)<=At*Math.max(1,Math.abs(s),Math.abs(l))&&Math.abs(n-c)<=At*Math.max(1,Math.abs(n),Math.abs(c))}const yze=Vbe,vze=zbe,_ze=Bbe,bze=Gbe,wze=CU,xze=vee,Tze=_ee,Wbe=Object.freeze(Object.defineProperty({__proto__:null,copy:ef,set:Kr,add:yee,subtract:Vbe,multiply:zbe,divide:Bbe,ceil:oze,floor:aze,min:lze,max:cze,round:uze,scale:H$,scaleAndAdd:hze,distance:Gbe,squaredDistance:CU,length:vee,squaredLength:_ee,negate:dze,inverse:pze,normalize:jbe,dot:Hbe,lerp:Kz,random:fze,transformMat4:ih,transformQuat:mze,str:gze,exactEquals:oI,equals:qbe,sub:yze,mul:vze,div:_ze,dist:bze,sqrDist:wze,len:xze,sqrLen:Tze},Symbol.toStringTag,{value:"Module"})),Iae=new Float32Array(1);function qC(e){--e;for(let t=1;t<32;t<<=1)e|=e>>t;return e+1}function Le(e,t,r){return Math.min(Math.max(e,t),r)}function WC(e){return(e&e-1)==0}function vIt(e){return e--,e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,e|=e>>16,++e}function _It(e){return 10**Math.ceil(Math.LOG10E*Math.log(e))}function Yt(e,t,r){return e+(t-e)*r}function Ft(e){return e*Math.PI/180}function nu(e){return 180*e/Math.PI}function Kq(e,t=1e-6){return(e<0?-1:1)/Math.max(Math.abs(e),t)}function Cn(e){return Math.acos(Le(e,-1,1))}function bf(e){return Math.asin(Le(e,-1,1))}function Sze(e,t,r=1e-6){if(isNaN(e)||isNaN(t))return!1;if(e===t)return!0;const i=Math.abs(e-t),s=Math.abs(e),n=Math.abs(t);if(e===0||t===0||s<1e-12&&n<1e-12){if(i>.01*r)return!1}else if(i/(s+n)>r)return!1;return!0}function lC(e,t,r=1e-6){return isNaN(e)||isNaN(t)?!1:(e>t?e-t:t-e)<=r}function Eze(e){return Xbe(Math.max(-eW,Math.min(e,eW)))}function Xbe(e){return Iae[0]=e,Iae[0]}function XC(e,t,r){const i=Le((r-e)/(t-e),0,1);return i*i*(3-2*i)}function $ae(e,t){const r=Re(e),i=bf(e[2]/r),s=Math.atan2(e[1]/r,e[0]/r);return se(t,r,i,s),t}function bIt(e,t,r){return Kr(e,t[0],t[1],t[2],t[3]*r)}function wIt(e){const t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],r=e[3]*e[3]+e[4]*e[4]+e[5]*e[5],i=e[6]*e[6]+e[7]*e[7]+e[8]*e[8];return!(lC(t,1)&&lC(r,1)&&lC(i,1))}const eW=Xbe(34028234663852886e22);function ED(e){return Le(VK(e),0,255)}function CD(e,t,r){return e=Number(e),isNaN(e)?r:e<t?t:e>r?r:e}class Pn{constructor(t){this.r=255,this.g=255,this.b=255,this.a=1,t&&this.setColor(t)}static blendColors(t,r,i,s=new Pn){return s.r=Math.round(t.r+(r.r-t.r)*i),s.g=Math.round(t.g+(r.g-t.g)*i),s.b=Math.round(t.b+(r.b-t.b)*i),s.a=t.a+(r.a-t.a)*i,s._sanitize()}static fromRgb(t,r){const i=t.toLowerCase().match(/^(rgba?|hsla?)\(([\s\.\-,%0-9]+)\)/);if(i){const s=i[2].split(/\s*,\s*/),n=i[1];if(n==="rgb"&&s.length===3||n==="rgba"&&s.length===4){const o=s[0];if(o.charAt(o.length-1)==="%"){const a=s.map(l=>2.56*parseFloat(l));return s.length===4&&(a[3]=parseFloat(s[3])),Pn.fromArray(a,r)}return Pn.fromArray(s.map(a=>parseFloat(a)),r)}if(n==="hsl"&&s.length===3||n==="hsla"&&s.length===4)return Pn.fromArray(Ibe(parseFloat(s[0]),parseFloat(s[1])/100,parseFloat(s[2])/100,parseFloat(s[3])),r)}return null}static fromHex(t,r=new Pn){if(t.length!==4&&t.length!==7||t[0]!=="#")return null;const i=t.length===4?4:8,s=(1<<i)-1;let n=Number("0x"+t.substr(1));return isNaN(n)?null:(["b","g","r"].forEach(o=>{const a=n&s;n>>=i,r[o]=i===4?17*a:a}),r.a=1,r)}static fromArray(t,r=new Pn){return r._set(Number(t[0]),Number(t[1]),Number(t[2]),Number(t[3])),isNaN(r.a)&&(r.a=1),r._sanitize()}static fromString(t,r){const i=Pbe(t)?hee(t):null;return i&&Pn.fromArray(i,r)||Pn.fromRgb(t,r)||Pn.fromHex(t,r)}static fromJSON(t){return t&&new Pn([t[0],t[1],t[2],t[3]/255])}static toUnitRGB(t){return b(t)?[t.r/255,t.g/255,t.b/255]:null}static toUnitRGBA(t){return b(t)?[t.r/255,t.g/255,t.b/255,t.a!=null?t.a:1]:null}get isBright(){return .299*this.r+.587*this.g+.114*this.b>=127}setColor(t){var r,i,s,n;return typeof t=="string"?Pn.fromString(t,this):Array.isArray(t)?Pn.fromArray(t,this):(this._set((r=t.r)!=null?r:0,(i=t.g)!=null?i:0,(s=t.b)!=null?s:0,(n=t.a)!=null?n:1),t instanceof Pn||this._sanitize()),this}toRgb(){return[this.r,this.g,this.b]}toRgba(){return[this.r,this.g,this.b,this.a]}toHex(){const t=this.r.toString(16),r=this.g.toString(16),i=this.b.toString(16);return`#${t.length<2?"0"+t:t}${r.length<2?"0"+r:r}${i.length<2?"0"+i:i}`}toCss(t=!1){const r=this.r+", "+this.g+", "+this.b;return t?`rgba(${r}, ${this.a})`:`rgb(${r})`}toString(){return this.toCss(!0)}toJSON(){return this.toArray()}toArray(t=Pn.AlphaMode.ALWAYS){const r=ED(this.r),i=ED(this.g),s=ED(this.b);return t===Pn.AlphaMode.ALWAYS||this.a!==1?[r,i,s,ED(255*this.a)]:[r,i,s]}clone(){return new Pn(this.toRgba())}hash(){return this.r<<24|this.g<<16|this.b<<8|255*this.a}equals(t){return b(t)&&t.r===this.r&&t.g===this.g&&t.b===this.b&&t.a===this.a}_sanitize(){return this.r=Math.round(CD(this.r,0,255)),this.g=Math.round(CD(this.g,0,255)),this.b=Math.round(CD(this.b,0,255)),this.a=CD(this.a,0,1),this}_set(t,r,i,s){this.r=t,this.g=r,this.b=i,this.a=s}}Pn.prototype.declaredClass="esri.Color",function(e){var t;(t=e.AlphaMode||(e.AlphaMode={}))[t.ALWAYS=0]="ALWAYS",t[t.UNLESS_OPAQUE=1]="UNLESS_OPAQUE"}(Pn||(Pn={}));const Me=Pn;function xIt(e){}function Cze(e){return()=>e}function lt(e,t={}){var s;const r=e instanceof Tr?e:new Tr(e,t),i={type:(s=t==null?void 0:t.ignoreUnknown)==null||s?r.apiValues:String,json:{type:r.jsonValues,read:!(t!=null&&t.readOnly)&&{reader:r.read},write:{writer:r.write}}};return(t==null?void 0:t.readOnly)!==void 0&&(i.readOnly=!!t.readOnly),(t==null?void 0:t.default)!==void 0&&(i.json.default=t.default),(t==null?void 0:t.name)!==void 0&&(i.json.name=t.name),d(i)}var tW;let F4=tW=class extends ye{constructor(e){super(e),this.type="none"}clone(){return new tW({type:this.type})}};u([lt({none:"none",stayAbove:"stay-above"})],F4.prototype,"type",void 0),F4=tW=u([$("esri.ground.NavigationConstraint")],F4);function e6(e){const t=VK(100*(1-e));return Math.max(0,Math.min(t,100))}function ZC(e){const t=1-e/100;return Math.max(0,Math.min(t,1))}var rW;const Lae=fe.getLogger("esri.Ground");let jg=rW=class extends nR(gh){constructor(e){super(e),this.opacity=1,this.surfaceColor=null,this.navigationConstraint=null,this.layers=new ot;const t=i=>{i.parent&&i.parent!==this&&"remove"in i.parent&&i.parent.remove(i),i.parent=this,i.type!=="elevation"&&i.type!=="base-elevation"&&Lae.error(`Layer '${i.title}, id:${i.id}' of type '${i.type}' is not supported as a ground layer and will therefore be ignored. Only layers of type 'elevation' are supported.`)},r=i=>{i.parent=null};this.layers.on("after-add",i=>t(i.item)),this.layers.on("after-remove",i=>r(i.item))}initialize(){this.when().catch(e=>{Lae.error("#load()","Failed to load ground",e)}),this.resourceInfo&&this.read(this.resourceInfo.data,this.resourceInfo.context)}destroy(){const e=this.layers.removeAll();for(const t of e)t.destroy();this.layers.destroy()}normalizeCtorArgs(e){return e&&"resourceInfo"in e&&(this._set("resourceInfo",e.resourceInfo),delete(e={...e}).resourceInfo),e}set layers(e){this._set("layers",iT(e,this._get("layers")))}writeLayers(e,t,r,i){const s=[];e&&(i={...i,layerContainerType:"ground"},e.forEach(n=>{if("write"in n){const o={};Cze(n)().write(o,i)&&s.push(o)}else i&&i.messages&&i.messages.push(new j("layer:unsupported",`Layers (${n.title}, ${n.id}) of type '${n.declaredClass}' cannot be persisted in the ground`,{layer:n}))})),t.layers=s}load(e){return this.addResolvingPromise(this._loadFromSource(e)),Promise.resolve(this)}loadAll(){return K1e(this,e=>{e(this.layers)})}async queryElevation(e,t){await this.load({signal:t==null?void 0:t.signal});const{ElevationQuery:r}=await ie(()=>import("./ElevationQuery.929c253a.js"),[],import.meta.url);Jt(t);const i=new r,s=this.layers.filter(Dae).toArray();return i.queryAll(s,e,t)}async createElevationSampler(e,t){await this.load({signal:t==null?void 0:t.signal});const{ElevationQuery:r}=await ie(()=>import("./ElevationQuery.929c253a.js"),[],import.meta.url);Jt(t);const i=new r,s=this.layers.filter(Dae).toArray();return i.createSamplerAll(s,e,t)}clone(){const e={opacity:this.opacity,surfaceColor:re(this.surfaceColor),navigationConstraint:re(this.navigationConstraint),layers:this.layers.slice()};return this.loaded&&(e.loadStatus="loaded"),new rW({resourceInfo:this.resourceInfo}).set(e)}read(e,t){this.resourceInfo||this._set("resourceInfo",{data:e,context:t}),super.read(e,t)}_loadFromSource(e){const t=this.resourceInfo;return t?this._loadLayersFromJSON(t.data,t.context,e):Promise.resolve(null)}_loadLayersFromJSON(e,t,r){const i=t&&t.origin||"web-scene",s=t&&t.portal||null,n=t&&t.url||null;return ie(()=>import("./layersCreator.596089ee.js"),["layersCreator.596089ee.js","lazyLayerLoader.fb403b9c.js","portalLayers.19863727.js","layersLoader.55238685.js","jsonContext.a084d534.js","portalItemUtils.13c3070b.js"],import.meta.url).then(({populateOperationalLayers:o})=>{Jt(r);const a=[];if(e.layers&&Array.isArray(e.layers)){const l={context:{origin:i,url:n,portal:s,layerContainerType:"ground"},defaultLayerType:"ArcGISTiledElevationServiceLayer"};a.push(o(this.layers,e.layers,l))}return xs(a)}).then(()=>{})}};function Aze(e){return e&&"createElevationSampler"in e}function Dae(e){return e.type==="elevation"||Aze(e)}u([d({json:{read:!1}})],jg.prototype,"layers",null),u([Xe("layers")],jg.prototype,"writeLayers",null),u([d({readOnly:!0})],jg.prototype,"resourceInfo",void 0),u([d({type:Number,nonNullable:!0,range:{min:0,max:1},json:{type:Wi,read:{reader:ZC,source:"transparency"},write:{writer:(e,t)=>{t.transparency=e6(e)},target:"transparency"}}})],jg.prototype,"opacity",void 0),u([d({type:Me,json:{type:[Wi],write:(e,t)=>{t.surfaceColor=e.toJSON().slice(0,3)}}})],jg.prototype,"surfaceColor",void 0),u([d({type:F4,json:{write:!0}})],jg.prototype,"navigationConstraint",void 0),jg=rW=u([$("esri.Ground")],jg);const AU=jg;let k4=class extends xe{constructor(e){super(e),this._groups=new Map}destroy(){this.removeAll()}get size(){let e=0;return this._groups.forEach(t=>{e+=t.length}),e}add(e,t){if(!this._isHandle(e)&&!Array.isArray(e)&&!ot.isCollection(e))return this;const r=this._getOrCreateGroup(t);return Array.isArray(e)||ot.isCollection(e)?e.forEach(i=>this._isHandle(i)&&r.push(i)):r.push(e),this.notifyChange("size"),this}forEach(e,t){if(typeof e=="function")this._groups.forEach(r=>r.forEach(e));else{const r=this._getGroup(e);r&&t&&r.forEach(t)}}has(e){return this._groups.has(this._ensureGroupKey(e))}remove(e){if(Array.isArray(e)||ot.isCollection(e))return e.forEach(this.remove,this),this;if(!this.has(e))return this;const t=this._getGroup(e);for(let r=0;r<t.length;r++)t[r].remove();return this._deleteGroup(e),this.notifyChange("size"),this}removeAll(){return this._groups.forEach(e=>{for(let t=0;t<e.length;t++)e[t].remove()}),this._groups.clear(),this.notifyChange("size"),this}_isHandle(e){return e&&!!e.remove}_getOrCreateGroup(e){if(this.has(e))return this._getGroup(e);const t=[];return this._groups.set(this._ensureGroupKey(e),t),t}_getGroup(e){return this._groups.get(this._ensureGroupKey(e))}_deleteGroup(e){return this._groups.delete(this._ensureGroupKey(e))}_ensureGroupKey(e){return e||"_default_"}};u([d({readOnly:!0})],k4.prototype,"size",null),k4=u([$("esri.core.Handles")],k4);const Dt=k4;function te(e,t,r={}){return bee(e,t,r,Zbe)}function Lo(e,t,r={}){return bee(e,t,r,Ybe)}function bee(e,t,r={},i){let s=null;const n=r.once?(o,a)=>{i(o)&&(wn(s),t(o,a))}:(o,a)=>{i(o)&&t(o,a)};if(s=W5e(e,n,r.sync,r.equals),r.initial){const o=e();n(o,o)}return s}function rs(e,t,r,i={}){let s=null,n=null,o=null;function a(){var h;s&&n&&(n.remove(),(h=i.onListenerRemove)==null||h.call(i,s),s=null,n=null)}function l(h){i.once&&i.once&&wn(o),r(h)}const c=te(e,(h,p)=>{var f;a(),jz(h)&&(s=h,n=V$(h,t,l),(f=i.onListenerAdd)==null||f.call(i,h))},{sync:i.sync,initial:!0});return o=kd(()=>{c.remove(),a()}),o}function E1(e,t){return Rze(e,Ybe,t)}function Rze(e,t,r){if(gn(r))return Promise.reject(gr());const i=e();if(t!=null&&t(i))return Promise.resolve(i);let s=null;function n(){s=wn(s)}return new Promise((o,a)=>{s=VC([Ia(r,()=>{n(),a(gr())}),bee(e,l=>{n(),o(l)},{sync:!1,once:!0},t!=null?t:Zbe)])})}function Zbe(e){return!0}function Ybe(e){return!!e}function Oze(e,t,r={}){let i=!1;const s=te(e,(n,o)=>{i||t(n,o)},r);return{remove(){s.remove()},pause(){i=!0},resume(){i=!1}}}const ei={sync:!0},Rt={initial:!0},Xs={sync:!0,initial:!0};let Gm=class extends xe{constructor(){super(...arguments),this.updating=!1,this.handleId=0,this.handles=new Dt,this.scheduleHandleId=0,this.pendingPromises=new Set}destroy(){this.removeAll(),this.handles.destroy()}add(e,t,r={}){return this._installWatch(e,t,r,te)}addWhen(e,t,r={}){return this._installWatch(e,t,r,Lo)}addOnCollectionChange(e,t,{initial:r=!1,final:i=!1}={}){const s=++this.handleId;return this.handles.add([rs(e,"after-changes",this._createSyncUpdatingCallback(),ei),rs(e,"change",t,{onListenerAdd:r?n=>t({added:n.toArray(),removed:[]}):void 0,onListenerRemove:i?n=>t({added:[],removed:n.toArray()}):void 0})],s),{remove:()=>this.handles.remove(s)}}addPromise(e){if(R(e))return e;const t=++this.handleId;this.handles.add({remove:()=>{this.pendingPromises.delete(e)&&(this.pendingPromises.size!==0||this.handles.has(AD)||this._set("updating",!1))}},t),this.pendingPromises.add(e),this._set("updating",!0);const r=()=>this.handles.remove(t);return e.then(r,r),e}removeAll(){this.pendingPromises.clear(),this.handles.removeAll(),this._set("updating",!1)}_installWatch(e,t,r={},i){const s=++this.handleId;r.sync||this._installSyncUpdatingWatch(e,s);const n=i(e,t,r);return this.handles.add(n,s),{remove:()=>this.handles.remove(s)}}_installSyncUpdatingWatch(e,t){const r=this._createSyncUpdatingCallback(),i=te(e,r,{sync:!0,equals:()=>!1});return this.handles.add(i,t),i}_createSyncUpdatingCallback(){return()=>{this.handles.remove(AD),++this.scheduleHandleId;const e=this.scheduleHandleId;this._get("updating")||this._set("updating",!0),this.handles.add(iR(()=>{e===this.scheduleHandleId&&(this._set("updating",this.pendingPromises.size>0),this.handles.remove(AD))}),AD)}}};u([d({readOnly:!0})],Gm.prototype,"updating",void 0),Gm=u([$("esri.core.support.WatchUpdatingTracking")],Gm);const AD=-42;var Nae;(function(e){e[e.NONE=0]="NONE",e[e.SYNC=1]="SYNC",e[e.INIT=2]="INIT"})(Nae||(Nae={}));const pg=e=>{let t=class extends e{destroy(){var r,i;this.destroyed||((r=this._get("handles"))==null||r.destroy(),(i=this._get("updatingHandles"))==null||i.destroy())}get handles(){return this._get("handles")||new Dt}get updatingHandles(){return this._get("updatingHandles")||new Gm}};return u([d({readOnly:!0})],t.prototype,"handles",null),u([d({readOnly:!0})],t.prototype,"updatingHandles",null),t=u([$("esri.core.HandleOwner")],t),t};let YC=class extends pg(xe){};YC=u([$("esri.core.HandleOwner")],YC);let v2=class extends pg(ot){constructor(e){super(e),this.getCollections=null}initialize(){this.handles.add(C1e(()=>this._refresh()))}destroy(){this.getCollections=null}_refresh(){const e=b(this.getCollections)?this.getCollections():null;if(R(e))return void this.removeAll();let t=0;for(const r of e)b(r)&&(t=this._processCollection(t,r));this.splice(t,this.length)}_createNewInstance(e){return new ot(e)}_processCollection(e,t){if(!t)return e;const r=this.itemFilterFunction?this.itemFilterFunction:i=>!!i;for(const i of t)if(i){if(r(i)){const s=this.indexOf(i,e);s>=0?s!==e&&this.reorder(i,e):this.add(i,e),++e}if(this.getChildrenFunction){const s=this.getChildrenFunction(i);if(Array.isArray(s))for(const n of s)e=this._processCollection(e,n);else e=this._processCollection(e,s)}}return e}};u([d()],v2.prototype,"getCollections",void 0),u([d()],v2.prototype,"getChildrenFunction",void 0),u([d()],v2.prototype,"itemFilterFunction",void 0),v2=u([$("esri.core.CollectionFlattener")],v2);const QC=v2;function Mze(e){var t;return!!(e&&e.loaded&&"capabilities"in e&&((t=e==null?void 0:e.capabilities)==null?void 0:t.operations)&&"supportsEditing"in e.capabilities.operations&&e.capabilities.operations.supportsEditing===!0)&&!("editingEnabled"in e&&!e.editingEnabled)}const Fae=fe.getLogger("esri.support.basemapUtils");function Pze(){return{}}function Ize(e){for(const t in e){const r=e[t];(r==null?void 0:r.destroyed)===!1&&r.destroy(),delete e[t]}}function $ze(e,t){let r;if(typeof e=="string"){if(!(e in Zq)){const i=Object.entries(Zq).filter(([s,n])=>Ur.apiKey&&!n.classic||!Ur.apiKey&&n.classic&&!n.deprecated).map(([s])=>`"${s}"`).join(", ");return Fae.warn(`Unable to find basemap definition for: ${e}. Try one of these: ${i}`),null}t&&(r=t[e]),r||(r=Bm.fromId(e),t&&(t[e]=r))}else r=en(Bm,e);return r!=null&&r.destroyed&&(Fae.warn("The provided basemap is already destroyed",{basemap:r}),r=null),r}function Lze(e,t){return e===t?!0:Uze(kae(e),kae(t),{mustMatchReferences:!0})==="equal"}function Dze(e,t){var s,n,o;if(R(t)||R(e))return{spatialReference:null,updating:!1};if(t.loadStatus==="not-loaded")return t.load(),{spatialReference:null,updating:!0};if(t.spatialReference)return{spatialReference:t.spatialReference,updating:!1};if(t.baseLayers.length===0)return{spatialReference:null,updating:!1};const r=t.baseLayers.getItemAt(0);switch(r.loadStatus){case"not-loaded":r.load();case"loading":return{spatialReference:null,updating:!0};case"failed":return{spatialReference:null,updating:!1}}const i=(("supportedSpatialReferences"in r?r.supportedSpatialReferences:null)||["tileInfo"in r?(s=r.tileInfo)==null?void 0:s.spatialReference:r.spatialReference]).filter(Boolean);return e.spatialReference?{spatialReference:(o=(n=i.find(a=>e.spatialReference.equals(a)))!=null?n:i[0])!=null?o:null,updating:!1}:{spatialReference:i[0],updating:!1}}function kae(e){return e?!e.loaded&&e.resourceInfo?Fze(e.resourceInfo.data):{baseLayers:Uae(e.baseLayers),referenceLayers:Uae(e.referenceLayers)}:null}function Uae(e){return(ot.isCollection(e)?e.toArray():e).map(Nze)}function Nze(e){var t,r;return{type:e.type,url:Qbe("urlTemplate"in e&&e.urlTemplate||e.url||"styleUrl"in e&&e.styleUrl),minScale:"minScale"in e&&e.minScale!=null?e.minScale:0,maxScale:"maxScale"in e&&e.maxScale!=null?e.maxScale:0,opacity:e.opacity!=null?e.opacity:1,visible:e.visible==null||!!e.visible,sublayers:e.type!=="map-image"&&e.type!=="wms"||!b(e.sublayers)||(t=e.sublayers)==null?void 0:t.map(i=>({id:i.id,visible:i.visible})),activeLayerId:e.type==="wmts"?(r=e.activeLayer)==null?void 0:r.id:void 0}}function Fze(e){return e?{baseLayers:Vae(e.baseMapLayers.filter(t=>!t.isReference)),referenceLayers:Vae(e.baseMapLayers.filter(t=>t.isReference))}:null}function Vae(e){return e.map(t=>kze(t))}function kze(e){let t;switch(e.layerType){case"VectorTileLayer":t="vector-tile";break;case"ArcGISTiledMapServiceLayer":t="tile";break;default:t="unknown"}return{type:t,url:Qbe(e.templateUrl||e.urlTemplate||e.styleUrl||e.url),minScale:e.minScale!=null?e.minScale:0,maxScale:e.maxScale!=null?e.maxScale:0,opacity:e.opacity!=null?e.opacity:1,visible:e.visibility==null||!!e.visibility,sublayers:void 0,activeLayerId:void 0}}function Uze(e,t,r){return e!=null!=(t!=null)?"not-equal":e?zae(e.baseLayers,t.baseLayers)?zae(e.referenceLayers,t.referenceLayers)?"equal":r.mustMatchReferences?"not-equal":"base-layers-equal":"not-equal":"equal"}function zae(e,t){if(e.length!==t.length)return!1;for(let r=0;r<e.length;r++)if(!Vze(e[r],t[r]))return!1;return!0}function Vze(e,t){if(e.type!==t.type||e.url!==t.url||e.minScale!==t.minScale||e.maxScale!==t.maxScale||e.visible!==t.visible||e.opacity!==t.opacity)return!1;if(b(e.activeLayerId)||b(t.activeLayerId))return e.activeLayerId===t.activeLayerId;if(b(e.sublayers)||b(t.sublayers)){if(R(e.sublayers)||R(t.sublayers)||e.sublayers.length!==t.sublayers.length)return!1;for(let r=0;r<e.sublayers.length;r++){const i=e.sublayers.at(r),s=t.sublayers.at(r);if(i.id!==s.id||i.visible!==s.visible)return!1}}return!0}function Qbe(e){return e?Id(e).replace(/^\s*https?:/i,"").toLowerCase():""}function zze(e){return new QC({getCollections:()=>[e.tables,e.layers],getChildrenFunction:t=>{const r=[];return"tables"in t&&r.push(t.tables),"layers"in t&&r.push(t.layers),r},itemFilterFunction:t=>{const r=t.parent;return r&&"tables"in r&&r.tables.includes(t)}})}const Bze=fe.getLogger("esri.support.groundUtils"),Bae={"world-elevation":{id:"worldElevation",url:"//elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/Terrain3D/ImageServer",layerType:"ArcGISTiledElevationServiceLayer"},"world-topobathymetry":{id:"worldTopoBathymetry",url:"//elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/TopoBathy3D/ImageServer",layerType:"ArcGISTiledElevationServiceLayer"}};function Gze(e){let t=null;if(typeof e=="string")if(e in Bae){const r=Bae[e];t=new AU({resourceInfo:{data:{layers:[r]}}})}else Bze.warn(`Unable to find ground definition for: ${e}. Try "world-elevation"`);else t=en(AU,e);return t}function JC(e,t,r=!1){let{hasM:i,hasZ:s}=e;Array.isArray(t)?t.length!==4||i||s?t.length===3&&r&&!i?(s=!0,i=!1):t.length===3&&i&&s&&(i=!1,s=!1):(i=!0,s=!0):(s=!s&&t.hasZ&&(!i||t.hasM),i=!i&&t.hasM&&(!s||t.hasZ)),e.hasZ=s,e.hasM=i}var iW;function Gae(e){return(t,r)=>t==null?r:r==null?t:e(t,r)}function jze(e){return e&&(e.declaredClass==="esri.geometry.SpatialReference"||e.wkid!=null)}let Av=iW=class extends iu{constructor(...e){super(...e),this.points=[],this.type="multipoint"}normalizeCtorArgs(e,t){if(!e&&!t)return null;const r={};Array.isArray(e)?(r.points=e,r.spatialReference=t):jze(e)?r.spatialReference=e:(e.points&&(r.points=e.points),e.spatialReference&&(r.spatialReference=e.spatialReference),e.hasZ&&(r.hasZ=e.hasZ),e.hasM&&(r.hasM=e.hasM));const i=r.points&&r.points[0];return i&&(r.hasZ===void 0&&r.hasM===void 0?(r.hasZ=i.length>2,r.hasM=!1):r.hasZ===void 0?r.hasZ=i.length>3:r.hasM===void 0&&(r.hasM=i.length>3)),r}get cache(){return this.commitProperty("points"),this.commitProperty("hasZ"),this.commitProperty("hasM"),this.commitProperty("spatialReference"),{}}get extent(){const e=this.points;if(!e.length)return null;const t=new Kt,r=this.hasZ,i=this.hasM,s=r?3:2,n=e[0],o=Gae(Math.min),a=Gae(Math.max);let l,c,h,p,[f,m]=n,[g,v]=n;for(let w=0,_=e.length;w<_;w++){const T=e[w],[x,E]=T;if(f=o(f,x),m=o(m,E),g=a(g,x),v=a(v,E),r&&T.length>2){const C=T[2];l=o(l,C),h=a(h,C)}if(i&&T.length>s){const C=T[s];c=o(c,C),p=a(p,C)}}return t.xmin=f,t.ymin=m,t.xmax=g,t.ymax=v,t.spatialReference=this.spatialReference,r?(t.zmin=l,t.zmax=h):(t.zmin=null,t.zmax=null),i?(t.mmin=c,t.mmax=p):(t.mmin=null,t.mmax=null),t}writePoints(e,t){t.points=re(this.points)}addPoint(e){return JC(this,e),Array.isArray(e)?this.points.push(e):this.points.push(e.toArray()),this.notifyChange("points"),this}clone(){const e={points:re(this.points),spatialReference:this.spatialReference};return this.hasZ&&(e.hasZ=!0),this.hasM&&(e.hasM=!0),new iW(e)}getPoint(e){if(!this._validateInputs(e))return null;const t=this.points[e],r={x:t[0],y:t[1],spatialReference:this.spatialReference};let i=2;return this.hasZ&&(r.z=t[2],i=3),this.hasM&&(r.m=t[i]),new at(r)}removePoint(e){if(!this._validateInputs(e))return null;const t=new at(this.points.splice(e,1)[0],this.spatialReference);return this.notifyChange("points"),t}setPoint(e,t){return this._validateInputs(e)?(JC(this,t),Array.isArray(t)||(t=t.toArray()),this.points[e]=t,this.notifyChange("points"),this):this}toJSON(e){return this.write({},e)}_validateInputs(e){return e!=null&&e>=0&&e<this.points.length}};u([d({readOnly:!0})],Av.prototype,"cache",null),u([d()],Av.prototype,"extent",null),u([d({type:[[Number]],json:{write:{isRequired:!0}}})],Av.prototype,"points",void 0),u([Xe("points")],Av.prototype,"writePoints",null),Av=iW=u([$("esri.geometry.Multipoint")],Av),Av.prototype.toJSON.isDefaultToJSON=!0;const GT=Av;function wee(e,t){const r=t[0]-e[0],i=t[1]-e[1];if(e.length>2&&t.length>2){const s=e[2]-t[2];return Math.sqrt(r*r+i*i+s*s)}return Math.sqrt(r*r+i*i)}function Jbe(e,t,r){const i=e[0]+r*(t[0]-e[0]),s=e[1]+r*(t[1]-e[1]);return e.length>2&&t.length>2?[i,s,e[2]+r*(t[2]-e[2])]:[i,s]}function Hze(e,t){return Jbe(e,t,.5)}function Kbe(e){const t=e.length;let r=0;for(let i=0;i<t-1;++i)r+=wee(e[i],e[i+1]);return r}function ewe(e,t){if(t<=0)return e[0];const r=e.length;let i=0;for(let s=0;s<r-1;++s){const n=wee(e[s],e[s+1]);if(t-i<n){const o=(t-i)/n;return Jbe(e[s],e[s+1],o)}i+=n}return e[r-1]}function xee(e,t,r){const i=e.length;let s=0,n=0,o=0;for(let a=0;a<i;a++){const l=e[a],c=e[(a+1)%i];let h=2;s+=l[0]*c[1]-c[0]*l[1],l.length>2&&c.length>2&&r&&(n+=l[0]*c[2]-c[0]*l[2],h=3),l.length>h&&c.length>h&&t&&(o+=l[0]*c[h]-c[0]*l[h])}return s<=0&&n<=0&&o<=0}function TIt(e){if("rings"in e)for(const t of e.rings)t.length<3||t[0][0]===t[t.length-1][0]&&t[0][1]===t[t.length-1][1]||t.push([t[0][0],t[0][1]])}function SIt(e){return e?e.hasZ?[e.xmax-e.xmin/2,e.ymax-e.ymin/2,e.zmax-e.zmin/2]:[e.xmax-e.xmin/2,e.ymax-e.ymin/2]:null}function qze(e){return e?twe(e.rings,e.hasZ):null}function twe(e,t){if(!e||!e.length)return null;const r=[],i=[],s=t?[1/0,-1/0,1/0,-1/0,1/0,-1/0]:[1/0,-1/0,1/0,-1/0];for(let n=0,o=e.length;n<o;n++){const a=Wze(e[n],t,s);a&&i.push(a)}if(i.sort((n,o)=>{let a=n[2]-o[2];return a===0&&t&&(a=n[4]-o[4]),a}),i.length&&(r[0]=i[0][0],r[1]=i[0][1],t&&(r[2]=i[0][3]),(r[0]<s[0]||r[0]>s[1]||r[1]<s[2]||r[1]>s[3]||t&&(r[2]<s[4]||r[2]>s[5]))&&(r.length=0)),!r.length){const n=e[0]&&e[0].length?Xze(e[0],t):null;if(!n)return null;r[0]=n[0],r[1]=n[1],t&&n.length>2&&(r[2]=n[2])}return r}function Wze(e,t,r){let i=0,s=0,n=0,o=0,a=0;const l=e.length?e[0][0]:0,c=e.length?e[0][1]:0,h=e.length&&t?e[0][2]:0;for(let f=0;f<e.length;f++){const m=e[f],g=e[(f+1)%e.length],[v,w,_]=m,T=v-l,x=w-c,E=t?_-h:void 0,[C,A,P]=g,I=C-l,L=A-c,k=t?P-h:void 0,G=T*L-I*x;if(o+=G,i+=(T+I)*G,s+=(x+L)*G,t&&m.length>2&&g.length>2){const z=T*k-I*E;n+=(E+k)*z,a+=z}v<r[0]&&(r[0]=v),v>r[1]&&(r[1]=v),w<r[2]&&(r[2]=w),w>r[3]&&(r[3]=w),t&&(_<r[4]&&(r[4]=_),_>r[5]&&(r[5]=_))}if(o>0&&(o*=-1),a>0&&(a*=-1),!o)return null;o*=.5,a*=.5;const p=[i/(6*o)+l,s/(6*o)+c,o];return t&&(r[4]===r[5]||a===0?(p[3]=(r[4]+r[5])/2,p[4]=0):(p[3]=n/(6*a)+h,p[4]=a)),p}function Xze(e,t){const r=t?[0,0,0]:[0,0],i=t?[0,0,0]:[0,0];let s=0,n=0,o=0,a=0;for(let l=0,c=e.length;l<c-1;l++){const h=e[l],p=e[l+1];if(h&&p){r[0]=h[0],r[1]=h[1],i[0]=p[0],i[1]=p[1],t&&h.length>2&&p.length>2&&(r[2]=h[2],i[2]=p[2]);const f=wee(r,i);if(f){s+=f;const m=Hze(h,p);n+=f*m[0],o+=f*m[1],t&&m.length>2&&(a+=f*m[2])}}}return s>0?t?[n/s,o/s,a/s]:[n/s,o/s]:e.length?e[0]:null}function rwe(e){return e.xmin!==void 0&&e.ymin!==void 0&&e.xmax!==void 0&&e.ymax!==void 0}function iwe(e){return e.points!==void 0}function swe(e){return e.x!==void 0&&e.y!==void 0}function nwe(e){return e.paths!==void 0}function owe(e){return e.rings!==void 0}function awe(e){return(t,r)=>t==null?r:r==null?t:e(t,r)}const L_=awe(Math.min),D_=awe(Math.max);function EIt(e,t){return nwe(t)?KC(e,t.paths,!1,!1):owe(t)?KC(e,t.rings,!1,!1):iwe(t)?Tee(e,t.points,!1,!1,!1,!1):rwe(t)?lwe(e,t):(swe(t)&&(e[0]=t.x,e[1]=t.y,e[2]=t.x,e[3]=t.y),e)}function CIt(e,t){return nwe(t)?KC(e,t.paths,!0,!1):owe(t)?KC(e,t.rings,!0,!1):iwe(t)?Tee(e,t.points,!0,!1,!0,!1):rwe(t)?lwe(e,t,!0,!1,!0,!1):(swe(t)&&(e[0]=t.x,e[1]=t.y,e[2]=t.z,e[3]=t.x,e[4]=t.y,e[5]=t.z),e)}function KC(e,t,r,i){const s=r?3:2;if(!t.length||!t[0].length)return null;let n,o,a,l,[c,h]=t[0][0],[p,f]=t[0][0];for(let m=0;m<t.length;m++){const g=t[m];for(let v=0;v<g.length;v++){const w=g[v],[_,T]=w;if(c=L_(c,_),h=L_(h,T),p=D_(p,_),f=D_(f,T),r&&w.length>2){const x=w[2];n=L_(n,x),o=D_(o,x)}if(i&&w.length>s){const x=w[s];a=L_(n,x),l=D_(o,x)}}}return r?i?(e[0]=c,e[1]=h,e[2]=n,e[3]=a,e[4]=p,e[5]=f,e[6]=o,e[7]=l,e.length=8,e):(e[0]=c,e[1]=h,e[2]=n,e[3]=p,e[4]=f,e[5]=o,e.length=6,e):i?(e[0]=c,e[1]=h,e[2]=a,e[3]=p,e[4]=f,e[5]=l,e.length=6,e):(e[0]=c,e[1]=h,e[2]=p,e[3]=f,e.length=4,e)}function lwe(e,t,r,i,s,n){const o=t.xmin,a=t.xmax,l=t.ymin,c=t.ymax;let h=t.zmin,p=t.zmax,f=t.mmin,m=t.mmax;return s?(h=h||0,p=p||0,n?(f=f||0,m=m||0,e[0]=o,e[1]=l,e[2]=h,e[3]=f,e[4]=a,e[5]=c,e[6]=p,e[7]=m,e):(e[0]=o,e[1]=l,e[2]=h,e[3]=a,e[4]=c,e[5]=p,e)):n?(f=f||0,m=m||0,e[0]=o,e[1]=l,e[2]=f,e[3]=a,e[4]=c,e[5]=m,e):(e[0]=o,e[1]=l,e[2]=a,e[3]=c,e)}function Tee(e,t,r,i,s,n){const o=r?3:2,a=i&&n,l=r&&s;if(!t.length||!t[0].length)return null;let c,h,p,f,[m,g]=t[0],[v,w]=t[0];for(let _=0;_<t.length;_++){const T=t[_],[x,E]=T;if(m=L_(m,x),g=L_(g,E),v=D_(v,x),w=D_(w,E),l&&T.length>2){const C=T[2];c=L_(c,C),h=D_(h,C)}if(a&&T.length>o){const C=T[o];p=L_(c,C),f=D_(h,C)}}return s?(c=c||0,h=h||0,n?(p=p||0,f=f||0,e[0]=m,e[1]=g,e[2]=c,e[3]=p,e[4]=v,e[5]=w,e[6]=h,e[7]=f,e):(e[0]=m,e[1]=g,e[2]=c,e[3]=v,e[4]=w,e[5]=h,e)):n?(p=p||0,f=f||0,e[0]=m,e[1]=g,e[2]=p,e[3]=v,e[4]=w,e[5]=f,e):(e[0]=m,e[1]=g,e[2]=v,e[3]=w,e)}function Zze(e){return e.xmin!==void 0&&e.ymin!==void 0&&e.xmax!==void 0&&e.ymax!==void 0}function Yze(e){return e.points!==void 0}function Qze(e){return e.x!==void 0&&e.y!==void 0}function Jze(e){return e.paths!==void 0}function Kze(e){return e.rings!==void 0}const See=[];function cwe(e,t,r,i){return{xmin:e,ymin:t,xmax:r,ymax:i}}function uwe(e,t,r,i,s,n){return{xmin:e,ymin:t,zmin:r,xmax:i,ymax:s,zmax:n}}function hwe(e,t,r,i,s,n){return{xmin:e,ymin:t,mmin:r,xmax:i,ymax:s,mmax:n}}function dwe(e,t,r,i,s,n,o,a){return{xmin:e,ymin:t,zmin:r,mmin:i,xmax:s,ymax:n,zmax:o,mmax:a}}function Eee(e,t=!1,r=!1){return t?r?dwe(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7]):uwe(e[0],e[1],e[2],e[3],e[4],e[5]):r?hwe(e[0],e[1],e[2],e[3],e[4],e[5]):cwe(e[0],e[1],e[2],e[3])}function AIt(e){return e?Zze(e)?e:Qze(e)?t6e(e):Kze(e)?pwe(e):Jze(e)?fwe(e):Yze(e)?e6e(e):null:null}function e6e(e){const{hasZ:t,hasM:r,points:i}=e;return Eee(Tee(See,i,t,r),t,r)}function t6e(e){const{x:t,y:r,z:i,m:s}=e,n=s!=null;return i!=null?n?dwe(t,r,i,s,t,r,i,s):uwe(t,r,i,t,r,i):n?hwe(t,r,s,t,r,s):cwe(t,r,t,r)}function pwe(e){const{hasZ:t,hasM:r,rings:i}=e,s=KC(See,i,t,r);return s?Eee(s,t,r):null}function fwe(e){const{hasZ:t,hasM:r,paths:i}=e,s=KC(See,i,t,r);return s?Eee(s,t,r):null}var U4;function jae(e){return!Array.isArray(e[0])}let Qf=U4=class extends iu{constructor(...e){super(...e),this.rings=[],this.type="polygon"}static fromExtent(e){const t=e.clone().normalize(),r=e.spatialReference;let i=!1,s=!1;for(const o of t)o.hasZ&&(i=!0),o.hasM&&(s=!0);const n={rings:t.map(o=>{const a=[[o.xmin,o.ymin],[o.xmin,o.ymax],[o.xmax,o.ymax],[o.xmax,o.ymin],[o.xmin,o.ymin]];if(i&&o.hasZ){const l=o.zmin+.5*(o.zmax-o.zmin);for(let c=0;c<a.length;c++)a[c].push(l)}if(s&&o.hasM){const l=o.mmin+.5*(o.mmax-o.mmin);for(let c=0;c<a.length;c++)a[c].push(l)}return a}),spatialReference:r};return i&&(n.hasZ=!0),s&&(n.hasM=!0),new U4(n)}normalizeCtorArgs(e,t){let r,i,s=null,n=null;return e&&!Array.isArray(e)?(s=e.rings?e.rings:null,t||(e.spatialReference?t=e.spatialReference:e.rings||(t=e)),r=e.hasZ,i=e.hasM):s=e,s=s||[],t=t||Ze.WGS84,s.length&&s[0]&&s[0][0]!=null&&typeof s[0][0]=="number"&&(s=[s]),n=s[0]&&s[0][0],n&&(r===void 0&&i===void 0?(r=n.length>2,i=n.length>3):r===void 0?r=i?n.length>3:n.length>2:i===void 0&&(i=r?n.length>3:n.length>2)),{rings:s,spatialReference:t,hasZ:r,hasM:i}}get cache(){return this.commitProperty("rings"),this.commitProperty("hasZ"),this.commitProperty("hasM"),this.commitProperty("spatialReference"),{}}get centroid(){const e=qze(this);if(!e||isNaN(e[0])||isNaN(e[1])||this.hasZ&&isNaN(e[2]))return null;const t=new at;return t.x=e[0],t.y=e[1],t.spatialReference=this.spatialReference,this.hasZ&&(t.z=e[2]),t}get extent(){const{spatialReference:e}=this,t=pwe(this);if(!t)return null;const r=new Kt(t);return r.spatialReference=e,r}get isSelfIntersecting(){return cVe(this.rings)}writeRings(e,t){t.rings=re(this.rings)}addRing(e){if(!e)return;const t=this.rings,r=t.length;if(jae(e)){const i=[];for(let s=0,n=e.length;s<n;s++)i[s]=e[s].toArray();t[r]=i}else t[r]=e.concat();return this.notifyChange("rings"),this}clone(){const e=new U4;return e.spatialReference=this.spatialReference,e.rings=re(this.rings),e.hasZ=this.hasZ,e.hasM=this.hasM,e}equals(e){if(this===e)return!0;if(R(e))return!1;const t=this.spatialReference,r=e.spatialReference;if(b(t)!==b(r)||b(t)&&b(r)&&!t.equals(r)||this.rings.length!==e.rings.length)return!1;const i=([s,n,o,a],[l,c,h,p])=>s===l&&n===c&&(o==null&&h==null||o===h)&&(a==null&&p==null||a===p);for(let s=0;s<this.rings.length;s++){const n=this.rings[s],o=e.rings[s];if(!x1(n,o,i))return!1}return!0}contains(e){if(!e)return!1;const t=BT(e,this.spatialReference);return KUe(this,b(t)?t:e)}isClockwise(e){let t;return t=jae(e)?e.map(r=>this.hasZ?this.hasM?[r.x,r.y,r.z,r.m]:[r.x,r.y,r.z]:[r.x,r.y]):e,xee(t,this.hasM,this.hasZ)}getPoint(e,t){if(!this._validateInputs(e,t))return null;const r=this.rings[e][t],i=this.hasZ,s=this.hasM;return i&&!s?new at(r[0],r[1],r[2],void 0,this.spatialReference):s&&!i?new at(r[0],r[1],void 0,r[2],this.spatialReference):i&&s?new at(r[0],r[1],r[2],r[3],this.spatialReference):new at(r[0],r[1],this.spatialReference)}insertPoint(e,t,r){return this._validateInputs(e,t,!0)?(JC(this,r),Array.isArray(r)||(r=r.toArray()),this.rings[e].splice(t,0,r),this.notifyChange("rings"),this):this}removePoint(e,t){if(!this._validateInputs(e,t))return null;const r=new at(this.rings[e].splice(t,1)[0],this.spatialReference);return this.notifyChange("rings"),r}removeRing(e){if(!this._validateInputs(e,null))return null;const t=this.rings.splice(e,1)[0],r=this.spatialReference,i=t.map(s=>new at(s,r));return this.notifyChange("rings"),i}setPoint(e,t,r){return this._validateInputs(e,t)?(JC(this,r),Array.isArray(r)||(r=r.toArray()),this.rings[e][t]=r,this.notifyChange("rings"),this):this}_validateInputs(e,t,r=!1){if(e==null||e<0||e>=this.rings.length)return!1;if(t!=null){const i=this.rings[e];if(r&&(t<0||t>i.length)||!r&&(t<0||t>=i.length))return!1}return!0}toJSON(e){return this.write({},e)}};u([d({readOnly:!0})],Qf.prototype,"cache",null),u([d({readOnly:!0})],Qf.prototype,"centroid",null),u([d({readOnly:!0})],Qf.prototype,"extent",null),u([d({readOnly:!0})],Qf.prototype,"isSelfIntersecting",null),u([d({type:[[[Number]]],json:{write:{isRequired:!0}}})],Qf.prototype,"rings",void 0),u([Xe("rings")],Qf.prototype,"writeRings",null),Qf=U4=u([$("esri.geometry.Polygon")],Qf),Qf.prototype.toJSON.isDefaultToJSON=!0;const Oa=Qf;var sW;function r6e(e){return!Array.isArray(e[0])}let Rv=sW=class extends iu{constructor(...e){super(...e),this.paths=[],this.type="polyline"}normalizeCtorArgs(e,t){let r,i,s=null,n=null;return e&&!Array.isArray(e)?(s=e.paths?e.paths:null,t||(e.spatialReference?t=e.spatialReference:e.paths||(t=e)),r=e.hasZ,i=e.hasM):s=e,s=s||[],t=t||Ze.WGS84,s.length&&s[0]&&s[0][0]!=null&&typeof s[0][0]=="number"&&(s=[s]),n=s[0]&&s[0][0],n&&(r===void 0&&i===void 0?(r=n.length>2,i=!1):r===void 0?r=!i&&n.length>3:i===void 0&&(i=!r&&n.length>3)),{paths:s,spatialReference:t,hasZ:r,hasM:i}}get cache(){return this.commitProperty("paths"),this.commitProperty("hasZ"),this.commitProperty("hasM"),this.commitProperty("spatialReference"),{}}get extent(){const{spatialReference:e}=this,t=fwe(this);if(!t)return null;const r=new Kt(t);return r.spatialReference=e,r}writePaths(e,t){t.paths=re(this.paths)}addPath(e){if(!e)return;const t=this.paths,r=t.length;if(r6e(e)){const i=[];for(let s=0,n=e.length;s<n;s++)i[s]=e[s].toArray();t[r]=i}else t[r]=e.concat();return this.notifyChange("paths"),this}clone(){const e=new sW;return e.spatialReference=this.spatialReference,e.paths=re(this.paths),e.hasZ=this.hasZ,e.hasM=this.hasM,e}getPoint(e,t){if(!this._validateInputs(e,t))return null;const r=this.paths[e][t],i=this.hasZ,s=this.hasM;return i&&!s?new at(r[0],r[1],r[2],void 0,this.spatialReference):s&&!i?new at(r[0],r[1],void 0,r[2],this.spatialReference):i&&s?new at(r[0],r[1],r[2],r[3],this.spatialReference):new at(r[0],r[1],this.spatialReference)}insertPoint(e,t,r){return this._validateInputs(e,t,!0)?(JC(this,r),Array.isArray(r)||(r=r.toArray()),this.paths[e].splice(t,0,r),this.notifyChange("paths"),this):this}removePath(e){if(!this._validateInputs(e,null))return null;const t=this.paths.splice(e,1)[0],r=this.spatialReference,i=t.map(s=>new at(s,r));return this.notifyChange("paths"),i}removePoint(e,t){if(!this._validateInputs(e,t))return null;const r=new at(this.paths[e].splice(t,1)[0],this.spatialReference);return this.notifyChange("paths"),r}setPoint(e,t,r){return this._validateInputs(e,t)?(JC(this,r),Array.isArray(r)||(r=r.toArray()),this.paths[e][t]=r,this.notifyChange("paths"),this):this}_validateInputs(e,t,r=!1){if(e==null||e<0||e>=this.paths.length)return!1;if(t!=null){const i=this.paths[e];if(r&&(t<0||t>i.length)||!r&&(t<0||t>=i.length))return!1}return!0}toJSON(e){return this.write({},e)}};u([d({readOnly:!0})],Rv.prototype,"cache",null),u([d({readOnly:!0})],Rv.prototype,"extent",null),u([d({type:[[[Number]]],json:{write:{isRequired:!0}}})],Rv.prototype,"paths",void 0),u([Xe("paths")],Rv.prototype,"writePaths",null),Rv=sW=u([$("esri.geometry.Polyline")],Rv),Rv.prototype.toJSON.isDefaultToJSON=!0;const sh=Rv,t6=Da()({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon"}),Hae=Da()({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryEnvelope:"extent",mesh:"mesh"});function mwe(e){return e.xmin!==void 0&&e.ymin!==void 0&&e.xmax!==void 0&&e.ymax!==void 0}function Cee(e){return e.points!==void 0}function Aee(e){return e.x!==void 0&&e.y!==void 0}function Ree(e){return e.paths!==void 0}function Lx(e){return e.rings!==void 0}function u0(e){return R(e)?null:e instanceof iu?e:Aee(e)?at.fromJSON(e):Ree(e)?sh.fromJSON(e):Lx(e)?Oa.fromJSON(e):Cee(e)?GT.fromJSON(e):mwe(e)?Kt.fromJSON(e):null}function aR(e){return e?Aee(e)?"esriGeometryPoint":Ree(e)?"esriGeometryPolyline":Lx(e)?"esriGeometryPolygon":mwe(e)?"esriGeometryEnvelope":Cee(e)?"esriGeometryMultipoint":null:null}const i6e={esriGeometryPoint:at,esriGeometryPolyline:sh,esriGeometryPolygon:Oa,esriGeometryEnvelope:Kt,esriGeometryMultipoint:GT};function gwe(e){return e&&i6e[e]||null}const jT={base:iu,key:"type",typeMap:{extent:Kt,multipoint:GT,point:at,polyline:sh,polygon:Oa}};_f(jT);let s6e=0;const Oee=e=>{let t=class extends e{constructor(...r){super(...r),Object.defineProperty(this,"uid",{writable:!1,configurable:!1,value:Date.now().toString(16)+"-object-"+s6e++})}};return t=u([$("esri.core.Identifiable")],t),t};let qae=class extends Oee(class{}){};qae=u([$("esri.core.Identifiable")],qae);const n6e=fe.getLogger("esri.layers.support.fromPortalItem");async function o6e(e){const t="portalItem"in e?e:{portalItem:e},r=await ie(()=>import("./portalLayers.19863727.js"),["portalLayers.19863727.js","lazyLayerLoader.fb403b9c.js","layersLoader.55238685.js","jsonContext.a084d534.js","portalItemUtils.13c3070b.js"],import.meta.url);try{return await r.fromItem(t)}catch(i){const s=t&&t.portalItem,n=s&&s.id||"unset",o=s&&s.portal&&s.portal.url||Ur.portalUrl;throw n6e.error("#fromPortalItem()","Failed to create layer from portal item (portal: '"+o+"', id: '"+n+"')",i),i}}let a6e=0,po=class extends ds.EventedMixin(Oee(gh)){constructor(){super(...arguments),this.attributionDataUrl=null,this.fullExtent=new Kt(-180,-90,180,90,Ze.WGS84),this.id=Date.now().toString(16)+"-layer-"+a6e++,this.legendEnabled=!0,this.listMode="show",this.opacity=1,this.parent=null,this.popupEnabled=!0,this.attributionVisible=!0,this.spatialReference=Ze.WGS84,this.title=null,this.type=null,this.url=null,this.visible=!0}static async fromArcGISServerUrl(e){const t=typeof e=="string"?{url:e}:e;return(await ie(()=>import("./arcgisLayers.c4cc8e09.js"),["arcgisLayers.c4cc8e09.js","lazyLayerLoader.fb403b9c.js"],import.meta.url)).fromUrl(t)}static fromPortalItem(e){return o6e(e)}initialize(){this.when().catch(e=>{var t,r;Vi(e)||fe.getLogger(this.declaredClass).error("#load()",`Failed to load layer (title: '${(t=this.title)!=null?t:"no title"}', id: '${(r=this.id)!=null?r:"no id"}')`,{error:e})})}destroy(){if(this.parent){const e=this,t=this.parent;"layers"in t&&t.layers.includes(e)?t.layers.remove(e):"tables"in t&&t.tables.includes(e)?t.tables.remove(e):"baseLayers"in t&&t.baseLayers.includes(e)?t.baseLayers.remove(e):"baseLayers"in t&&t.referenceLayers.includes(e)&&t.referenceLayers.remove(e)}}get hasAttributionData(){return this.attributionDataUrl!=null}get parsedUrl(){const e=this.url;return e?Ds(e):null}async fetchAttributionData(){const e=this.attributionDataUrl;if(this.hasAttributionData&&e)return(await er(e,{query:{f:"json"},responseType:"json"})).data;throw new j("layer:no-attribution-data","Layer does not have attribution data")}};u([d({type:String})],po.prototype,"attributionDataUrl",void 0),u([d({type:Kt})],po.prototype,"fullExtent",void 0),u([d({readOnly:!0})],po.prototype,"hasAttributionData",null),u([d({type:String,clonable:!1})],po.prototype,"id",void 0),u([d({type:Boolean,nonNullable:!0})],po.prototype,"legendEnabled",void 0),u([d({type:["show","hide","hide-children"]})],po.prototype,"listMode",void 0),u([d({type:Number,range:{min:0,max:1},nonNullable:!0})],po.prototype,"opacity",void 0),u([d({clonable:!1})],po.prototype,"parent",void 0),u([d({readOnly:!0})],po.prototype,"parsedUrl",null),u([d({type:Boolean})],po.prototype,"popupEnabled",void 0),u([d({type:Boolean})],po.prototype,"attributionVisible",void 0),u([d({type:Ze})],po.prototype,"spatialReference",void 0),u([d({type:String})],po.prototype,"title",void 0),u([d({readOnly:!0,json:{read:!1}})],po.prototype,"type",void 0),u([d()],po.prototype,"url",void 0),u([d({type:Boolean,nonNullable:!0})],po.prototype,"visible",void 0),po=u([$("esri.layers.Layer")],po);const eA=po;function nW(e,t,r){let i,s;if(e)for(let n=0,o=e.length;n<o;n++){if(i=e.getItemAt(n),i[t]===r)return i;if((i==null?void 0:i.type)==="group"&&(s=nW(i.layers,t,r),s))return s}}const Wae=fe.getLogger("esri.support.LayersMixin"),l6e=e=>{let t=class extends e{constructor(...r){super(...r),this.layers=new ot;const i=o=>{o.parent&&"remove"in o.parent&&o.parent.remove(o)},s=o=>{o.parent=this,this.layerAdded(o),o.type!=="elevation"&&o.type!=="base-elevation"||Wae.error(`Layer 'title:${o.title}, id:${o.id}' of type '${o.type}' is not supported as an operational layer and will therefore be ignored.`)},n=o=>{o.parent=null,this.layerRemoved(o)};this.layers.on("before-add",o=>i(o.item)),this.layers.on("after-add",o=>s(o.item)),this.layers.on("after-remove",o=>n(o.item))}destroy(){const r=this.layers.removeAll();for(const i of r)this.layerRemoved(i),i.destroy();this.layers.destroy()}set layers(r){this._set("layers",iT(r,this._get("layers")))}add(r,i){const s=this.layers;if(i=s.getNextIndex(i),r instanceof eA){const n=r;n.parent===this?this.reorder(n,i):s.add(n,i)}else Ch(r)?r.then(n=>{this.destroyed||this.add(n,i)}):Wae.error("#add()","The item being added is not a Layer or a Promise that resolves to a Layer.")}addMany(r,i){const s=this.layers;i=s.getNextIndex(i),r.slice().forEach(n=>{n.parent!==this?(s.add(n,i),i+=1):this.reorder(n,i)})}findLayerById(r){return nW(this.layers,"id",r)}findLayerByUid(r){return nW(this.layers,"uid",r)}remove(r){return this.layers.remove(r)}removeMany(r){return this.layers.removeMany(r)}removeAll(){return this.layers.removeAll()}reorder(r,i){return this.layers.reorder(r,i)}layerAdded(r){}layerRemoved(r){}};return u([d()],t.prototype,"layers",null),t=u([$("esri.support.LayersMixin")],t),t},ywe="esri.support.TablesMixin",c6e=fe.getLogger(ywe);function oW(e,t,r){if(e)for(let i=0,s=e.length;i<s;i++){const n=e.getItemAt(i);if(n[t]===r)return n;if((n==null?void 0:n.type)==="group"){const o=oW(n.tables,t,r);if(o)return o}}}const u6e=e=>{let t=class extends e{constructor(...r){super(...r),this.tables=new ot,this.tables.on("after-add",i=>{const s=i.item;s.parent&&s.parent!==this&&"tables"in s.parent&&s.parent.tables.remove(s),s.parent=this,s.type!=="feature"&&c6e.error(`Layer 'title:${s.title}, id:${s.id}' of type '${s.type}' is not supported as a table and will therefore be ignored.`)}),this.tables.on("after-remove",i=>{i.item.parent=null})}destroy(){const r=this.tables.removeAll();for(const i of r)i.destroy();this.tables.destroy()}set tables(r){this._set("tables",iT(r,this._get("tables")))}findTableById(r){return oW(this.tables,"id",r)}findTableByUid(r){return oW(this.tables,"uid",r)}};return u([d()],t.prototype,"tables",null),t=u([$(ywe)],t),t};let Jf=class extends u6e(l6e(ds.EventedMixin(xe))){constructor(e){super(e),this.allLayers=new QC({getCollections:()=>{var t,r,i;return[(t=this.basemap)==null?void 0:t.baseLayers,(r=this.ground)==null?void 0:r.layers,this.layers,(i=this.basemap)==null?void 0:i.referenceLayers]},getChildrenFunction:t=>"layers"in t?t.layers:null}),this.allTables=zze(this),this.basemap=null,this.editableLayers=new QC({getCollections:()=>[this.allLayers],itemFilterFunction:Mze}),this.ground=new AU,this._basemapCache=Pze()}destroy(){var e,t;this.allLayers.destroy(),this.allTables.destroy(),this.editableLayers.destroy(),(e=this.ground)==null||e.destroy(),(t=this.basemap)==null||t.destroy(),Ize(this._basemapCache),this._basemapCache=null}castBasemap(e){return $ze(e,this._basemapCache)}castGround(e){const t=Gze(e);return R(t)?this._get("ground"):t}findLayerById(e){return this.allLayers.find(t=>t.id===e)}findTableById(e){return this.allTables.find(t=>t.id===e)}};u([d({readOnly:!0,dependsOn:[]})],Jf.prototype,"allLayers",void 0),u([d({readOnly:!0})],Jf.prototype,"allTables",void 0),u([d({type:Bm})],Jf.prototype,"basemap",void 0),u([qt("basemap")],Jf.prototype,"castBasemap",null),u([d({readOnly:!0})],Jf.prototype,"editableLayers",void 0),u([d({type:AU,nonNullable:!0})],Jf.prototype,"ground",void 0),u([qt("ground")],Jf.prototype,"castGround",null),Jf=u([$("esri.Map")],Jf);const vwe=Jf;fe.getLogger("esri.core.Clonable");const au=e=>{let t=class extends e{clone(){var l;const r=N4e(Pa(this),"unable to clone instance of non-accessor class"),i=r.metadatas,s=r.store,n={},o=new Map;for(const c in i){const h=i[c],p=s==null?void 0:s.originOf(c),f=h.clonable;if(h.readOnly||f===!1||p!==Bt.USER&&p!==Bt.DEFAULTS&&p!==Bt.WEB_MAP&&p!==Bt.WEB_SCENE)continue;const m=this[c];let g=null;g=typeof f=="function"?f(m):f==="reference"?m:bq(m),m!=null&&g==null||(p===Bt.DEFAULTS?o.set(c,g):n[c]=g)}const a=new(Object.getPrototypeOf(this)).constructor(n);if(o.size){const c=(l=Pa(a))==null?void 0:l.store;if(c)for(const[h,p]of o)c.set(h,p,Bt.DEFAULTS)}return a}};return t=u([$("esri.core.Clonable")],t),t};let Xae=class extends au(xe){};Xae=u([$("esri.core.Clonable")],Xae);class C1{constructor(t,r){this.min=t,this.max=r,this.range=r-t}ndiff(t,r=0){return Math.ceil((t-r)/this.range)*this.range+r}_normalize(t,r,i,s=0,n=!1){return(i-=s)<t?i+=this.ndiff(t-i):i>r&&(i-=this.ndiff(i-r)),n&&i===r&&(i=t),i+s}normalize(t,r=0,i=!1){return this._normalize(this.min,this.max,t,r,i)}clamp(t,r=0){return Le(t-r,this.min,this.max)+r}monotonic(t,r,i){return t<r?r:r+this.ndiff(t-r,i)}minimalMonotonic(t,r,i){return this._normalize(t,t+this.range,r,i)}center(t,r,i){return r=this.monotonic(t,r,i),this.normalize((t+r)/2,i)}diff(t,r,i){return this.monotonic(t,r,i)-t}shortestSignedDiff(t,r){t=this.normalize(t);const i=(r=this.normalize(r))-t,s=r<t?this.minimalMonotonic(t,r)-t:r-this.minimalMonotonic(r,t);return Math.abs(i)<Math.abs(s)?i:s}contains(t,r,i){return r=this.minimalMonotonic(t,r),(i=this.minimalMonotonic(t,i))>t&&i<r}}function Mee(e){for(const t in e){const r=e[t];r instanceof Function&&(e[t]=r.bind(e))}return e}const h6e=Mee(new C1(0,2*Math.PI)),A1=Mee(new C1(-Math.PI,Math.PI)),Pee=Mee(new C1(0,360));let Hg=class extends au(ye){constructor(...e){super(...e),this.position=new at([0,0,0]),this.heading=0,this.tilt=0,this.fov=55}normalizeCtorArgs(e,t,r,i){if(e&&typeof e=="object"&&("x"in e||Array.isArray(e))){const s={position:e};return t!=null&&(s.heading=t),r!=null&&(s.tilt=r),i!=null&&(s.fov=i),s}return e}writePosition(e,t,r,i){const s=e.clone();s.x=yd(e.x||0),s.y=yd(e.y||0),s.z=e.hasZ?yd(e.z||0):e.z,t[r]=s.write({},i)}readPosition(e,t){const r=new at;return r.read(e,t),r.x=yd(r.x||0),r.y=yd(r.y||0),r.z=r.hasZ?yd(r.z||0):r.z,r}equals(e){return!!e&&this.tilt===e.tilt&&this.heading===e.heading&&this.fov===e.fov&&this.position.equals(e.position)}};u([d({type:at,json:{write:{isRequired:!0}}})],Hg.prototype,"position",void 0),u([Xe("position")],Hg.prototype,"writePosition",null),u([$e("position")],Hg.prototype,"readPosition",null),u([d({type:Number,nonNullable:!0,json:{write:{isRequired:!0}}}),qt(e=>Pee.normalize(yd(e)))],Hg.prototype,"heading",void 0),u([d({type:Number,nonNullable:!0,json:{write:{isRequired:!0}}}),qt(e=>Le(yd(e),-180,180))],Hg.prototype,"tilt",void 0),u([d({type:Number,nonNullable:!0,json:{read:!1,write:!1}})],Hg.prototype,"fov",void 0),Hg=u([$("esri.Camera")],Hg);const ou=Hg;var tA;function d6e(e,t){switch(e.type){case"range":{const r="range"in e?e.range[0]:e.minValue,i="range"in e?e.range[1]:e.maxValue;if(+t<r||+t>i)return tA.VALUE_OUT_OF_RANGE;break}case"coded-value":case"codedValue":if(e.codedValues==null||e.codedValues.every(r=>r==null||r.code!==t))return tA.INVALID_CODED_VALUE}return null}(function(e){e.VALUE_OUT_OF_RANGE="domain-validation-error::value-out-of-range",e.INVALID_CODED_VALUE="domain-validation-error::invalid-coded-value"})(tA||(tA={}));let k9;function Qm(){return k9||(k9=(async()=>{const e=await ie(()=>import("./arcadeUtils.b0959288.js").then(t=>t.t),[],import.meta.url);return{arcade:e.arcade,arcadeUtils:e,Dictionary:e.Dictionary,Feature:e.arcadeFeature}})()),k9}const p6e=(e,t,r)=>q$.create(e,t,r,null,["$feature"]),f6e=(e,t,r)=>q$.create(e,t,r,null,["$feature","$view"]),m6e=(e,t,r,i)=>q$.create(e,t,r,i,["$feature","$view"]);class q${constructor(t,r,i,s,n,o,a,l){this.script=t,this.evaluate=n;const c=Array.isArray(a)?a:a.fields;this.fields=c,this._syntaxTree=s,this._arcade=r,this._arcadeDictionary=i,this._arcadeFeature=o,this._spatialReference=l,this._referencesGeometry=r.scriptTouchesGeometry(this._syntaxTree),this._referencesScale=this._arcade.referencesMember(this._syntaxTree,"scale")}static async create(t,r,i,s,n,o){const{arcade:a,Feature:l,Dictionary:c}=await Qm(),h=Ze.fromJSON(r),p=a.parseScript(t,o),f=n.reduce((C,A)=>({...C,[A]:null}),{});let m=null;b(s)&&(m=new c(s),m.immutable=!0,f.$config=null);const g=a.scriptUsesGeometryEngine(p)&&a.enableGeometrySupport(),v=a.scriptUsesFeatureSet(p)&&a.enableFeatureSetSupport(),w=a.scriptIsAsync(p)&&a.enableAsyncSupport(),_={vars:f,spatialReference:h,useAsync:!!w},T=new c;T.immutable=!1,T.setField("scale",0);const x=a.compileScript(p,_),E=C=>("$view"in C&&C.$view&&(T.setField("scale",C.$view.scale),C.$view=T),m&&(C.$config=m),x({vars:C,spatialReference:h}));return await Promise.all([g,v,w]),new q$(t,a,c,p,E,new l,i,h)}repurposeFeature(t){return t.geometry&&!t.geometry.spatialReference&&(t.geometry.spatialReference=this._spatialReference),this._arcadeFeature.repurposeFromGraphicLikeObject(t.geometry,t.attributes,{fields:this.fields}),this._arcadeFeature}createDictionary(){return new this._arcadeDictionary}referencesMember(t){return this._arcade.referencesMember(this._syntaxTree,t)}referencesFunction(t){return this._arcade.referencesFunction(this._syntaxTree,t)}referencesGeometry(){return this._referencesGeometry}referencesScale(){return this._referencesScale}extractFieldLiterals(){return this._arcade.extractExpectedFieldLiterals(this._syntaxTree)}}const g6e=["field","field2","field3","normalizationField","rotationInfo.field","proportionalSymbolInfo.field","proportionalSymbolInfo.normalizationField","colorInfo.field","colorInfo.normalizationField"],y6e=["field","normalizationField"];function rA(e,t){if(e!=null&&t!=null){for(const r of Array.isArray(e)?e:[e])if(Zae(g6e,r,t),"visualVariables"in r&&r.visualVariables)for(const i of r.visualVariables)Zae(y6e,i,t)}}function Zae(e,t,r){if(e)for(const i of e){const s=rR(i,t),n=s&&typeof s!="function"&&r.get(s);n&&ru(i,n.name,t)}}function Iee(e,t){if(e!=null&&(t==null?void 0:t.fields.length))if("startField"in e){const r=t.get(e.startField),i=t.get(e.endField);e.startField=r&&r.name||null,e.endField=i&&i.name||null}else{const r=t.get(e.startTimeField),i=t.get(e.endTimeField);e.startTimeField=r&&r.name||null,e.endTimeField=i&&i.name||null}}const U9=new Set;function _we(e,t){return e&&t?(U9.clear(),aI(U9,e,t),Array.from(U9).sort()):[]}function aI(e,t,r){var i;if(r)if((i=t==null?void 0:t.fields)!=null&&i.length)if(r.includes("*"))for(const{name:s}of t.fields)e.add(s);else for(const s of r)$d(e,t,s);else{if(r.includes("*"))return e.clear(),void e.add("*");for(const s of r)e.add(s)}}function $d(e,t,r){if(typeof r=="string")if(t){const i=t.get(r);i&&e.add(i.name)}else e.add(r)}function RIt(e,t){return R(t)||R(e)?[]:t.includes("*")?e.fields.map(r=>r.name):t}async function oc(e,t,r){var n;if(!r)return;const{arcadeUtils:i}=await Qm(),s=i.extractFieldNames(r,(n=t==null?void 0:t.fields)==null?void 0:n.map(o=>o.name));for(const o of s)$d(e,t,o)}async function bwe(e,t,r){if(r&&r!=="1=1"){const i=(await ie(()=>import("./WhereClause.c395dc79.js"),[],import.meta.url)).WhereClause.create(r,t);if(!i.isStandardized)throw new j("fieldUtils:collectFilterFields","Where clause is not standardized",{where:r});aI(e,t,i.fieldNames)}}function v6e({displayField:e,fields:t}){return e||(t&&t.length?V9(t,"name-or-title")||V9(t,"unique-identifier")||V9(t,"type-or-category")||_6e(t):null)}function _6e(e){for(const t of e){if(!t||!t.name)continue;const r=t.name.toLowerCase();if(r.includes("name")||r.includes("title"))return t.name}return null}function V9(e,t){for(const r of e)if(r&&r.valueType&&r.valueType===t)return r.name;return null}async function OIt(e,t){if(!t)return;const r=rR("elevationInfo.featureExpressionInfo",t);return r?r.collectRequiredFields(e,t.fieldsIndex):void 0}async function b6e(e,t,r){r.outStatistic.onStatisticValueExpression?oc(e,t,r.outStatistic.onStatisticValueExpression):e.add(r.outStatistic.onStatisticField)}async function MIt(e,t,r){var s,n;if(!t||!r||!("fields"in r))return;const i=[];if((s=r.popupTemplate)!=null&&s.expressionInfos&&i.push(...r.popupTemplate.expressionInfos.map(o=>oc(e,t.fieldsIndex,o.expression))),Array.isArray((n=r.popupTemplate)==null?void 0:n.content)){const o=r.popupTemplate.content;for(const a of o)a.type==="expression"&&a.expressionInfo&&i.push(oc(e,t.fieldsIndex,a.expressionInfo.expression))}r.fields&&i.push(...r.fields.map(o=>b6e(e,t.fieldsIndex,o))),await Promise.all(i)}async function PIt(e,t,r){t&&(t.timeInfo&&b(r)&&r.timeExtent&&aI(e,t.fieldsIndex,[t.timeInfo.startField,t.timeInfo.endField]),t.floorInfo&&aI(e,t.fieldsIndex,[t.floorInfo.floorField]),b(r)&&b(r.where)&&await bwe(e,t.fieldsIndex,r.where))}async function IIt(e,t,r){t&&r&&await Promise.all(r.map(i=>w6e(e,t,i)))}async function w6e(e,t,r){t&&r&&(r.valueExpression?await oc(e,t.fieldsIndex,r.valueExpression):r.field&&$d(e,t.fieldsIndex,r.field))}function $It(e){if(!e)return[];const t="editFieldsInfo"in e&&e.editFieldsInfo;return t?_we(e.fieldsIndex,[t&&t.creatorField,t&&t.creationDateField,t&&t.editorField,t&&t.editDateField]):[]}async function LIt(e,t){const{labelingInfo:r,fieldsIndex:i}=t;r&&r.length&&await Promise.all(r.map(s=>x6e(e,i,s)))}async function x6e(e,t,r){if(!r)return;const i=r.getLabelExpression(),s=r.where;if(i.type==="arcade")await oc(e,t,i.expression);else{const n=i.expression.match(/{[^}]*}/g);n&&n.forEach(o=>{$d(e,t,o.slice(1,-1))})}await bwe(e,t,s)}function T6e(e){const t=e.defaultValue;return t!==void 0&&Twe(e,t)?t:e.nullable?null:void 0}function wwe(e){return typeof e=="number"&&!isNaN(e)&&isFinite(e)}function S6e(e){return e===null||wwe(e)}const $ee="isInteger"in Number?Number.isInteger:e=>typeof e=="number"&&isFinite(e)&&Math.floor(e)===e;function E6e(e){return e===null||$ee(e)}function xwe(e){return e!=null&&typeof e=="string"}function C6e(e){return e===null||xwe(e)}function A6e(){return!0}function Twe(e,t){let r;switch(e.type){case"date":case"integer":case"long":case"small-integer":case"esriFieldTypeDate":case"esriFieldTypeInteger":case"esriFieldTypeLong":case"esriFieldTypeSmallInteger":r=e.nullable?E6e:$ee;break;case"double":case"single":case"esriFieldTypeSingle":case"esriFieldTypeDouble":r=e.nullable?S6e:wwe;break;case"string":case"esriFieldTypeString":r=e.nullable?C6e:xwe;break;default:r=A6e}return arguments.length===1?r:r(t)}const R6e=["integer","small-integer","single","double"],O6e=new Set([...R6e,"esriFieldTypeInteger","esriFieldTypeSmallInteger","esriFieldTypeSingle","esriFieldTypeDouble"]);function r6(e){return e!=null&&O6e.has(e.type)}function DIt(e){return e!=null&&(e.type==="string"||e.type==="esriFieldTypeString")}function M6e(e){return e!=null&&(e.type==="date"||e.type==="esriFieldTypeDate")}var RU,OU;function NIt(e){return e==null||typeof e=="number"&&isNaN(e)?null:e}function FIt(e,t){return e.nullable&&t===null?null:r6(e)&&!P6e(e.type,Number(t))?RU.OUT_OF_RANGE:Twe(e,t)?e.domain?d6e(e.domain,t):null:OU.INVALID_TYPE}function P6e(e,t){const r=typeof e=="string"?Swe(e):e;return!!r&&(r.isInteger?$ee(t)&&t>=r.min&&t<=r.max:t>=r.min&&t<=r.max)}function Swe(e){switch(e){case"esriFieldTypeSmallInteger":case"small-integer":return I6e;case"esriFieldTypeInteger":case"integer":return $6e;case"esriFieldTypeSingle":case"single":return L6e;case"esriFieldTypeDouble":case"double":return D6e}}(function(e){e.OUT_OF_RANGE="numeric-range-validation-error::out-of-range"})(RU||(RU={})),function(e){e.INVALID_TYPE="type-validation-error::invalid-type"}(OU||(OU={}));const I6e={min:-32768,max:32767,isInteger:!0},$6e={min:-2147483648,max:2147483647,isInteger:!0},L6e={min:-34e37,max:12e37,isInteger:!1},D6e={min:-Number.MAX_VALUE,max:Number.MAX_VALUE,isInteger:!1};function kIt(e,t,r){switch(e){case tA.INVALID_CODED_VALUE:return`Value ${r} is not in the coded domain - field: ${t.name}, domain: ${JSON.stringify(t.domain)}`;case tA.VALUE_OUT_OF_RANGE:return`Value ${r} is out of the range of valid values - field: ${t.name}, domain: ${JSON.stringify(t.domain)}`;case OU.INVALID_TYPE:return`Value ${r} is not a valid value for the field type - field: ${t.name}, type: ${t.type}, nullable: ${t.nullable}`;case RU.OUT_OF_RANGE:{const{min:i,max:s}=Swe(t.type);return`Value ${r} is out of range for the number type - field: ${t.name}, type: ${t.type}, value range is ${i} to ${s}`}}}function N6e(e,t){return!F6e(e,t,null)}function F6e(e,t,r){if(!t||!t.attributes||!e){if(b(r))for(const n of e)r.add(n);return!0}const i=t.attributes;let s=!1;for(const n of e)if(!(n in i)){if(s=!0,!b(r))break;r.add(n)}return s}function Ewe(e){return["raster.itempixelvalue","raster.servicepixelvalue"].some(t=>e.toLowerCase().startsWith(t))}let V4=class extends ye{constructor(e){super(e),this.type=null}};u([d({type:["attachments","custom","fields","media","text","expression"],readOnly:!0,json:{read:!1,write:!0}})],V4.prototype,"type",void 0),V4=u([$("esri.popup.content.Content")],V4);const HT=V4;var aW;let Yb=aW=class extends HT{constructor(e){super(e),this.description=null,this.displayType="auto",this.title=null,this.type="attachments"}clone(){return new aW({description:this.description,displayType:this.displayType,title:this.title})}};u([d({type:String,json:{write:!0}})],Yb.prototype,"description",void 0),u([d({type:["auto","preview","list"],json:{write:!0}})],Yb.prototype,"displayType",void 0),u([d({type:String,json:{write:!0}})],Yb.prototype,"title",void 0),u([d({type:["attachments"],readOnly:!0,json:{read:!1,write:!0}})],Yb.prototype,"type",void 0),Yb=aW=u([$("esri.popup.content.AttachmentsContent")],Yb);const lI=Yb;var lW;let Qb=lW=class extends HT{constructor(e){super(e),this.creator=null,this.destroyer=null,this.outFields=null,this.type="custom"}clone(){return new lW({creator:this.creator,destroyer:this.destroyer,outFields:Array.isArray(this.outFields)?re(this.outFields):null})}};u([d()],Qb.prototype,"creator",void 0),u([d()],Qb.prototype,"destroyer",void 0),u([d()],Qb.prototype,"outFields",void 0),u([d({type:["custom"],readOnly:!0})],Qb.prototype,"type",void 0),Qb=lW=u([$("esri.popup.content.CustomContent")],Qb);const k6e=Qb;var cW;let _2=cW=class extends ye{constructor(e){super(e),this.title=null,this.expression=null,this.returnType="dictionary"}clone(){return new cW({title:this.title,expression:this.expression})}};u([d({type:String,json:{write:!0}})],_2.prototype,"title",void 0),u([d({type:String,json:{write:!0}})],_2.prototype,"expression",void 0),u([d({type:["dictionary"],readOnly:!0,json:{read:!1,write:!0}})],_2.prototype,"returnType",void 0),_2=cW=u([$("esri.popup.ElementExpressionInfo")],_2);const Cwe=_2;var uW;let gM=uW=class extends HT{constructor(e){super(e),this.expressionInfo=null,this.type="expression"}clone(){var e;return new uW({expressionInfo:(e=this.expressionInfo)==null?void 0:e.clone()})}};u([d({type:Cwe,json:{write:!0}})],gM.prototype,"expressionInfo",void 0),u([d({type:["expression"],readOnly:!0,json:{read:!1,write:!0}})],gM.prototype,"type",void 0),gM=uW=u([$("esri.popup.content.ExpressionContent")],gM);const Lee=gM,cI=Da()({shortDate:"short-date",shortDateShortTime:"short-date-short-time",shortDateShortTime24:"short-date-short-time-24",shortDateLongTime:"short-date-long-time",shortDateLongTime24:"short-date-long-time-24",shortDateLE:"short-date-le",shortDateLEShortTime:"short-date-le-short-time",shortDateLEShortTime24:"short-date-le-short-time-24",shortDateLELongTime:"short-date-le-long-time",shortDateLELongTime24:"short-date-le-long-time-24",longMonthDayYear:"long-month-day-year",longMonthDayYearShortTime:"long-month-day-year-short-time",longMonthDayYearShortTime24:"long-month-day-year-short-time-24",longMonthDayYearLongTime:"long-month-day-year-long-time",longMonthDayYearLongTime24:"long-month-day-year-long-time-24",dayShortMonthYear:"day-short-month-year",dayShortMonthYearShortTime:"day-short-month-year-short-time",dayShortMonthYearShortTime24:"day-short-month-year-short-time-24",dayShortMonthYearLongTime:"day-short-month-year-long-time",dayShortMonthYearLongTime24:"day-short-month-year-long-time-24",longDate:"long-date",longDateShortTime:"long-date-short-time",longDateShortTime24:"long-date-short-time-24",longDateLongTime:"long-date-long-time",longDateLongTime24:"long-date-long-time-24",longMonthYear:"long-month-year",shortMonthYear:"short-month-year",year:"year"});cI.toJSON.bind(cI);cI.fromJSON.bind(cI);const Of={year:"numeric",month:"numeric",day:"numeric"},WR={year:"numeric",month:"long",day:"numeric"},XR={year:"numeric",month:"short",day:"numeric"},ZR={year:"numeric",month:"long",weekday:"long",day:"numeric"},Wh={hour:"numeric",minute:"numeric"},rp={...Wh,second:"numeric"},Dee={"short-date":Of,"short-date-short-time":{...Of,...Wh},"short-date-short-time-24":{...Of,...Wh,hour12:!1},"short-date-long-time":{...Of,...rp},"short-date-long-time-24":{...Of,...rp,hour12:!1},"short-date-le":Of,"short-date-le-short-time":{...Of,...Wh},"short-date-le-short-time-24":{...Of,...Wh,hour12:!1},"short-date-le-long-time":{...Of,...rp},"short-date-le-long-time-24":{...Of,...rp,hour12:!1},"long-month-day-year":WR,"long-month-day-year-short-time":{...WR,...Wh},"long-month-day-year-short-time-24":{...WR,...Wh,hour12:!1},"long-month-day-year-long-time":{...WR,...rp},"long-month-day-year-long-time-24":{...WR,...rp,hour12:!1},"day-short-month-year":XR,"day-short-month-year-short-time":{...XR,...Wh},"day-short-month-year-short-time-24":{...XR,...Wh,hour12:!1},"day-short-month-year-long-time":{...XR,...rp},"day-short-month-year-long-time-24":{...XR,...rp,hour12:!1},"long-date":ZR,"long-date-short-time":{...ZR,...Wh},"long-date-short-time-24":{...ZR,...Wh,hour12:!1},"long-date-long-time":{...ZR,...rp},"long-date-long-time-24":{...ZR,...rp,hour12:!1},"long-month-year":{month:"long",year:"numeric"},"short-month-year":{month:"short",year:"numeric"},year:{year:"numeric"},"short-time":Wh,"long-time":rp},uI=Da()({shortDate:"short-date",shortDateShortTime:"short-date-short-time",shortDateShortTime24:"short-date-short-time-24",shortDateLongTime:"short-date-long-time",shortDateLongTime24:"short-date-long-time-24",shortDateLE:"short-date-le",shortDateLEShortTime:"short-date-le-short-time",shortDateLEShortTime24:"short-date-le-short-time-24",shortDateLELongTime:"short-date-le-long-time",shortDateLELongTime24:"short-date-le-long-time-24",longMonthDayYear:"long-month-day-year",longMonthDayYearShortTime:"long-month-day-year-short-time",longMonthDayYearShortTime24:"long-month-day-year-short-time-24",longMonthDayYearLongTime:"long-month-day-year-long-time",longMonthDayYearLongTime24:"long-month-day-year-long-time-24",dayShortMonthYear:"day-short-month-year",dayShortMonthYearShortTime:"day-short-month-year-short-time",dayShortMonthYearShortTime24:"day-short-month-year-short-time-24",dayShortMonthYearLongTime:"day-short-month-year-long-time",dayShortMonthYearLongTime24:"day-short-month-year-long-time-24",longDate:"long-date",longDateShortTime:"long-date-short-time",longDateShortTime24:"long-date-short-time-24",longDateLongTime:"long-date-long-time",longDateLongTime24:"long-date-long-time-24",longMonthYear:"long-month-year",shortMonthYear:"short-month-year",year:"year"});uI.apiValues;uI.toJSON.bind(uI);uI.fromJSON.bind(uI);const U6e={ar:"ar-u-nu-latn-ca-gregory"};let z4=new WeakMap,Awe=Dee["short-date-short-time"];function V6e(e){const t=e||Awe;if(!z4.has(t)){const r=lh(),i=U6e[lh()]||r;z4.set(t,new Intl.DateTimeFormat(i,t))}return z4.get(t)}function i6(e){return Dee[e]||null}function Jm(e,t){return V6e(t).format(e)}lee(()=>{z4=new WeakMap,Awe=Dee["short-date-short-time"]});const z6e={ar:"ar-u-nu-latn"};let B4=new WeakMap,Rwe={};function B6e(e){const t=e||Rwe;if(!B4.has(t)){const r=lh(),i=z6e[lh()]||r;B4.set(t,new Intl.NumberFormat(i,e))}return B4.get(t)}function Owe(e={}){const t={};return e.digitSeparator!=null&&(t.useGrouping=e.digitSeparator),e.places!=null&&(t.minimumFractionDigits=t.maximumFractionDigits=e.places),t}function Ud(e,t){return e===-0&&(e=0),B6e(t).format(e)}lee(()=>{B4=new WeakMap,Rwe={}});var hW;let Jb=hW=class extends ye{constructor(e){super(e),this.dateFormat=null,this.dateTimeFormatOptions=null,this.digitSeparator=!1,this.places=null}clone(){return new hW({dateFormat:this.dateFormat,digitSeparator:this.digitSeparator,places:this.places})}format(e){return this.dateFormat?Jm(e,{...i6(this.dateFormat),...this.dateTimeFormatOptions}):Ud(e,Owe(this))}formatRasterPixelValue(e){let t,r;return e.trim().includes(",")?(t=",",r=t+" ",this._formatDelimitedString(e,t,r,this)):e.trim().includes(";")?(t=";",r=t+" ",this._formatDelimitedString(e,t,r,this)):e.trim().includes(" ")?(t=r=" ",this._formatDelimitedString(e,t,r,this)):this.format(Number(e))}_formatDelimitedString(e,t,r,i){return e&&t&&r&&i?e.trim().split(t).map(s=>this.format(Number(s))).join(r):e}};u([lt(cI)],Jb.prototype,"dateFormat",void 0),u([d({type:Object,json:{read:!1}})],Jb.prototype,"dateTimeFormatOptions",void 0),u([d({type:Boolean,json:{write:!0}})],Jb.prototype,"digitSeparator",void 0),u([d({type:Wi,json:{write:!0}})],Jb.prototype,"places",void 0),Jb=hW=u([$("esri.popup.support.FieldInfoFormat")],Jb);const EE=Jb;var dW;let dp=dW=class extends ye{constructor(e){super(e),this.fieldName=null,this.format=null,this.isEditable=!1,this.label=null,this.stringFieldOption="text-box",this.statisticType=null,this.tooltip=null,this.visible=!0}clone(){return new dW({fieldName:this.fieldName,format:this.format?re(this.format):null,isEditable:this.isEditable,label:this.label,stringFieldOption:this.stringFieldOption,statisticType:this.statisticType,tooltip:this.tooltip,visible:this.visible})}};u([d({type:String,json:{write:!0}})],dp.prototype,"fieldName",void 0),u([d({type:EE,json:{write:!0}})],dp.prototype,"format",void 0),u([d({type:Boolean,json:{write:!0,default:!1}})],dp.prototype,"isEditable",void 0),u([d({type:String,json:{write:!0}})],dp.prototype,"label",void 0),u([lt(new Tr({richtext:"rich-text",textarea:"text-area",textbox:"text-box"}),{default:"text-box"})],dp.prototype,"stringFieldOption",void 0),u([d({type:["count","sum","min","max","avg","stddev","var"],json:{write:!0}})],dp.prototype,"statisticType",void 0),u([d({type:String,json:{write:!0}})],dp.prototype,"tooltip",void 0),u([d({type:Boolean,json:{write:!0}})],dp.prototype,"visible",void 0),dp=dW=u([$("esri.popup.FieldInfo")],dp);const W$=dp;var pW;let qg=pW=class extends HT{constructor(e){super(e),this.attributes=null,this.description=null,this.fieldInfos=null,this.title=null,this.type="fields"}writeFieldInfos(e,t){t.fieldInfos=e&&e.map(r=>r.toJSON())}clone(){return new pW(re({attributes:this.attributes,description:this.description,fieldInfos:this.fieldInfos,title:this.title}))}};u([d({type:Object,json:{write:!0}})],qg.prototype,"attributes",void 0),u([d({type:String,json:{write:!0}})],qg.prototype,"description",void 0),u([d({type:[W$]})],qg.prototype,"fieldInfos",void 0),u([Xe("fieldInfos")],qg.prototype,"writeFieldInfos",null),u([d({type:String,json:{write:!0}})],qg.prototype,"title",void 0),u([d({type:["fields"],readOnly:!0,json:{read:!1,write:!0}})],qg.prototype,"type",void 0),qg=pW=u([$("esri.popup.content.FieldsContent")],qg);const iA=qg;let Kb=class extends ye{constructor(e){super(e),this.altText=null,this.caption="",this.title="",this.type=null}};u([d({type:String,json:{write:!0}})],Kb.prototype,"altText",void 0),u([d({type:String,json:{write:!0}})],Kb.prototype,"caption",void 0),u([d({type:String,json:{write:!0}})],Kb.prototype,"title",void 0),u([d({type:["image","bar-chart","column-chart","line-chart","pie-chart"],readOnly:!0,json:{read:!1,write:!0}})],Kb.prototype,"type",void 0),Kb=u([$("esri.popup.content.mixins.MediaInfo")],Kb);const Nee=Kb;var fW;let b2=fW=class extends xe{constructor(e){super(e),this.fieldName=null,this.tooltip=null,this.value=null}clone(){return new fW({fieldName:this.fieldName,tooltip:this.tooltip,value:this.value})}};u([d()],b2.prototype,"fieldName",void 0),u([d()],b2.prototype,"tooltip",void 0),u([d()],b2.prototype,"value",void 0),b2=fW=u([$("esri.popup.content.support.ChartMediaInfoValueSeries")],b2);const Mwe=b2;var mW;let ew=mW=class extends ye{constructor(e){super(e),this.fields=[],this.normalizeField=null,this.series=[],this.tooltipField=null}clone(){return new mW({fields:re(this.fields),normalizeField:this.normalizeField,tooltipField:this.tooltipField})}};u([d({type:[String],json:{write:!0}})],ew.prototype,"fields",void 0),u([d({type:String,json:{write:!0}})],ew.prototype,"normalizeField",void 0),u([d({type:[Mwe],json:{read:!1}})],ew.prototype,"series",void 0),u([d({type:String,json:{write:!0}})],ew.prototype,"tooltipField",void 0),ew=mW=u([$("esri.popup.content.support.ChartMediaInfoValue")],ew);const G6e=ew;let yM=class extends Nee{constructor(e){super(e),this.type=null,this.value=null}};u([d({type:["bar-chart","column-chart","line-chart","pie-chart"],readOnly:!0,json:{read:!1,write:!0}})],yM.prototype,"type",void 0),u([d({type:G6e,json:{write:!0}})],yM.prototype,"value",void 0),yM=u([$("esri.popup.content.mixins.ChartMediaInfo")],yM);const s6=yM,n6=Da()({barchart:"bar-chart",columnchart:"column-chart",linechart:"line-chart",piechart:"pie-chart"});var gW;let G4=gW=class extends s6{constructor(e){super(e),this.type="bar-chart"}clone(){return new gW({altText:this.altText,title:this.title,caption:this.caption,value:this.value?this.value.clone():null})}};u([d({type:["bar-chart"],readOnly:!0,json:{type:["barchart"],read:!1,write:n6.write}})],G4.prototype,"type",void 0),G4=gW=u([$("esri.popup.content.BarChartMediaInfo")],G4);const Pwe=G4;var yW;let j4=yW=class extends s6{constructor(e){super(e),this.type="column-chart"}clone(){return new yW({altText:this.altText,title:this.title,caption:this.caption,value:this.value?this.value.clone():null})}};u([d({type:["column-chart"],readOnly:!0,json:{type:["columnchart"],read:!1,write:n6.write}})],j4.prototype,"type",void 0),j4=yW=u([$("esri.popup.content.ColumnChartMediaInfo")],j4);const Iwe=j4;var vW;let vM=vW=class extends ye{constructor(e){super(e),this.linkURL=null,this.sourceURL=null}clone(){return new vW({linkURL:this.linkURL,sourceURL:this.sourceURL})}};u([d({type:String,json:{write:!0}})],vM.prototype,"linkURL",void 0),u([d({type:String,json:{write:!0}})],vM.prototype,"sourceURL",void 0),vM=vW=u([$("esri.popup.content.support.ImageMediaInfoValue")],vM);const j6e=vM;var _W;let w2=_W=class extends Nee{constructor(e){super(e),this.refreshInterval=null,this.type="image",this.value=null}clone(){return new _W({altText:this.altText,title:this.title,caption:this.caption,refreshInterval:this.refreshInterval,value:this.value?this.value.clone():null})}};u([d({type:Number,json:{write:!0}})],w2.prototype,"refreshInterval",void 0),u([d({type:["image"],readOnly:!0,json:{read:!1,write:!0}})],w2.prototype,"type",void 0),u([d({type:j6e,json:{write:!0}})],w2.prototype,"value",void 0),w2=_W=u([$("esri.popup.content.ImageMediaInfo")],w2);const $we=w2;var bW;let H4=bW=class extends s6{constructor(e){super(e),this.type="line-chart"}clone(){return new bW({altText:this.altText,title:this.title,caption:this.caption,value:this.value?this.value.clone():null})}};u([d({type:["line-chart"],readOnly:!0,json:{type:["linechart"],read:!1,write:n6.write}})],H4.prototype,"type",void 0),H4=bW=u([$("esri.popup.content.LineChartMediaInfo")],H4);const Lwe=H4;var wW;let q4=wW=class extends s6{constructor(e){super(e),this.type="pie-chart"}clone(){return new wW({altText:this.altText,title:this.title,caption:this.caption,value:this.value?this.value.clone():null})}};u([d({type:["pie-chart"],readOnly:!0,json:{type:["piechart"],read:!1,write:n6.write}})],q4.prototype,"type",void 0),q4=wW=u([$("esri.popup.content.PieChartMediaInfo")],q4);const Dwe=q4,Nwe={base:Nee,key:"type",defaultKeyValue:"image",typeMap:{"bar-chart":Pwe,"column-chart":Iwe,"line-chart":Lwe,"pie-chart":Dwe,image:$we}};var xW;let pp=xW=class extends HT{constructor(e){super(e),this.activeMediaInfoIndex=null,this.attributes=null,this.description=null,this.mediaInfos=null,this.title=null,this.type="media"}readMediaInfos(e){return e&&e.map(t=>t.type==="image"?$we.fromJSON(t):t.type==="barchart"?Pwe.fromJSON(t):t.type==="columnchart"?Iwe.fromJSON(t):t.type==="linechart"?Lwe.fromJSON(t):t.type==="piechart"?Dwe.fromJSON(t):void 0).filter(Boolean)}writeMediaInfos(e,t){t.mediaInfos=e&&e.map(r=>r.toJSON())}clone(){return new xW(re({activeMediaInfoIndex:this.activeMediaInfoIndex,attributes:this.attributes,description:this.description,mediaInfos:this.mediaInfos,title:this.title}))}};u([d()],pp.prototype,"activeMediaInfoIndex",void 0),u([d({type:Object,json:{write:!0}})],pp.prototype,"attributes",void 0),u([d({type:String,json:{write:!0}})],pp.prototype,"description",void 0),u([d({types:[Nwe]})],pp.prototype,"mediaInfos",void 0),u([$e("mediaInfos")],pp.prototype,"readMediaInfos",null),u([Xe("mediaInfos")],pp.prototype,"writeMediaInfos",null),u([d({type:String,json:{write:!0}})],pp.prototype,"title",void 0),u([d({type:["media"],readOnly:!0,json:{read:!1,write:!0}})],pp.prototype,"type",void 0),pp=xW=u([$("esri.popup.content.MediaContent")],pp);const hI=pp;var TW;let _M=TW=class extends HT{constructor(e){super(e),this.text=null,this.type="text"}clone(){return new TW({text:this.text})}};u([d({type:String,json:{write:!0}})],_M.prototype,"text",void 0),u([d({type:["text"],readOnly:!0,json:{read:!1,write:!0}})],_M.prototype,"type",void 0),_M=TW=u([$("esri.popup.content.TextContent")],_M);const sA=_M,H6e={base:null,key:"type",typeMap:{attachment:lI,media:hI,text:sA,expression:Lee,field:iA}};var SW;let tw=SW=class extends ye{constructor(e){super(e),this.name=null,this.title=null,this.expression=null,this.returnType=null}clone(){return new SW({name:this.name,title:this.title,expression:this.expression,returnType:this.returnType})}};u([d({type:String,json:{write:!0}})],tw.prototype,"name",void 0),u([d({type:String,json:{write:!0}})],tw.prototype,"title",void 0),u([d({type:String,json:{write:!0}})],tw.prototype,"expression",void 0),u([d({type:["string","number"],json:{write:!0}})],tw.prototype,"returnType",void 0),tw=SW=u([$("esri.popup.ExpressionInfo")],tw);const Fwe=tw;var EW;let bM=EW=class extends ye{constructor(e){super(e),this.returnTopmostRaster=null,this.showNoDataRecords=null}clone(){return new EW({showNoDataRecords:this.showNoDataRecords,returnTopmostRaster:this.returnTopmostRaster})}};u([d({type:Boolean,json:{write:!0}})],bM.prototype,"returnTopmostRaster",void 0),u([d({type:Boolean,json:{write:!0}})],bM.prototype,"showNoDataRecords",void 0),bM=EW=u([$("esri.popup.LayerOptions")],bM);const q6e=bM;var CW;let wM=CW=class extends ye{constructor(e){super(e),this.field=null,this.order=null}clone(){return new CW({field:this.field,order:this.order})}};u([d({type:String,json:{write:!0}})],wM.prototype,"field",void 0),u([d({type:["asc","desc"],json:{write:!0}})],wM.prototype,"order",void 0),wM=CW=u([$("esri.popup.support.RelatedRecordsInfoFieldOrder")],wM);const kwe=wM;var AW;let xM=AW=class extends ye{constructor(e){super(e),this.showRelatedRecords=null,this.orderByFields=null}clone(){return new AW({showRelatedRecords:this.showRelatedRecords,orderByFields:this.orderByFields?re(this.orderByFields):null})}};u([d({type:Boolean,json:{write:!0}})],xM.prototype,"showRelatedRecords",void 0),u([d({type:[kwe],json:{write:!0}})],xM.prototype,"orderByFields",void 0),xM=AW=u([$("esri.popup.RelatedRecordsInfo")],xM);const W6e=xM;var RW;let fp=RW=class extends Oee(xe){constructor(e){super(e),this.active=!1,this.className=null,this.disabled=!1,this.id=null,this.indicator=!1,this.title=null,this.type=null,this.visible=!0}clone(){return new RW({active:this.active,className:this.className,disabled:this.disabled,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible})}};u([d()],fp.prototype,"active",void 0),u([d()],fp.prototype,"className",void 0),u([d()],fp.prototype,"disabled",void 0),u([d()],fp.prototype,"id",void 0),u([d()],fp.prototype,"indicator",void 0),u([d()],fp.prototype,"title",void 0),u([d()],fp.prototype,"type",void 0),u([d()],fp.prototype,"visible",void 0),fp=RW=u([$("esri.support.actions.ActionBase")],fp);const o6=fp;var OW;let W4=OW=class extends o6{constructor(e){super(e),this.image=null,this.type="button"}clone(){return new OW({active:this.active,className:this.className,disabled:this.disabled,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible,image:this.image})}};u([d()],W4.prototype,"image",void 0),W4=OW=u([$("esri.support.Action.ActionButton")],W4);const lR=W4;var MW;let TM=MW=class extends o6{constructor(e){super(e),this.image=null,this.type="toggle",this.value=!1}clone(){return new MW({active:this.active,className:this.className,disabled:this.disabled,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible,image:this.image,value:this.value})}};u([d()],TM.prototype,"image",void 0),u([d()],TM.prototype,"value",void 0),TM=MW=u([$("esri.support.Action.ActionToggle")],TM);const Uwe=TM;var PW;const X6e=ot.ofType({key:"type",defaultKeyValue:"button",base:o6,typeMap:{button:lR,toggle:Uwe}}),Z6e={base:HT,key:"type",typeMap:{media:hI,custom:k6e,text:sA,attachments:lI,fields:iA,expression:Lee}},Vwe="esri.PopupTemplate",Y6e=fe.getLogger(Vwe),Q6e=["attachments","fields","media","text","expression"];let Bn=PW=class extends ye{constructor(){super(...arguments),this.actions=null,this.content="",this.expressionInfos=null,this.fieldInfos=null,this.layerOptions=null,this.lastEditInfoEnabled=!0,this.outFields=null,this.overwriteActions=!1,this.returnGeometry=!1,this.title="",this.relatedRecordsInfo=null}castContent(e){return Array.isArray(e)?e.map(t=>_f(Z6e,t)):typeof e=="string"||typeof e=="function"||e instanceof HTMLElement||Ch(e)?e:(Y6e.error("content error","unsupported content value",{value:e}),null)}readContent(e,t){const{popupElements:r}=t;return Array.isArray(r)&&r.length>0?this._readPopupInfoElements(t):this._readPopupInfo(t)}writeContent(e,t,r,i){typeof e!="string"?Array.isArray(e)&&(t.popupElements=e.filter(s=>Q6e.includes(s.type)).map(s=>s&&s.toJSON(i)),t.popupElements.forEach(s=>{s.type==="attachments"?this._writeAttachmentContent(t):s.type==="media"?this._writeMediaContent(s,t):s.type==="text"&&this._writeTextContent(s,t)})):t.description=e}writeFieldInfos(e,t,r,i){const{content:s}=this,n=Array.isArray(s)?s:null;if(e){const o=n?n.filter(l=>l.type==="fields"):[],a=o.length&&o.every(l=>{var c;return(c=l.fieldInfos)==null?void 0:c.length});t.fieldInfos=e.filter(Boolean).map(l=>{const c=l.toJSON(i);return a&&(c.visible=!1),c})}if(n)for(const o of n)o.type==="fields"&&this._writeFieldsContent(o,t)}writeLayerOptions(e,t,r,i){t[r]=!e||e.showNoDataRecords===null&&e.returnTopmostRaster===null?null:e.toJSON(i)}writeTitle(e,t){t.title=e||""}clone(){const{actions:e}=this,t=e?re(e.toArray()):[];return new PW({actions:t,content:Array.isArray(this.content)?re(this.content):this.content,expressionInfos:Array.isArray(this.expressionInfos)?re(this.expressionInfos):null,fieldInfos:Array.isArray(this.fieldInfos)?re(this.fieldInfos):null,layerOptions:this.layerOptions?re(this.layerOptions):null,lastEditInfoEnabled:this.lastEditInfoEnabled,outFields:Array.isArray(this.outFields)?re(this.outFields):null,overwriteActions:this.overwriteActions,returnGeometry:this.returnGeometry,title:this.title,relatedRecordsInfo:this.relatedRecordsInfo?re(this.relatedRecordsInfo):null})}async collectRequiredFields(e,t){const r=this.expressionInfos||[];await this._collectExpressionInfoFields(e,t,[...r,...this._getContentExpressionInfos(this.content,r)]),aI(e,t,[...this.outFields||[],...this._getActionsFields(this.actions),...this._getTitleFields(this.title),...this._getContentFields(this.content)])}async getRequiredFields(e){const t=new Set;return await this.collectRequiredFields(t,e),[...t].sort()}_writeFieldsContent(e,t){if(!Array.isArray(e.fieldInfos)||!e.fieldInfos.length)return;const r=re(e.fieldInfos);Array.isArray(t.fieldInfos)?r.forEach(i=>{const s=t.fieldInfos.find(n=>n.fieldName.toLowerCase()===i.fieldName.toLowerCase());s?s.visible=!0:t.fieldInfos.push(i)}):t.fieldInfos=r}_writeAttachmentContent(e){e.showAttachments||(e.showAttachments=!0)}_writeTextContent(e,t){!t.description&&e.text&&(t.description=e.text)}_writeMediaContent(e,t){if(!Array.isArray(e.mediaInfos)||!e.mediaInfos.length)return;const r=re(e.mediaInfos);Array.isArray(t.mediaInfos)?t.mediaInfos=[...t.mediaInfos,...r]:t.mediaInfos=r}_readPopupInfoElements({description:e,mediaInfos:t,popupElements:r}){const i={description:!1,mediaInfos:!1};return r.map(s=>s.type==="media"?(s.mediaInfos||!t||i.mediaInfos||(s.mediaInfos=t,i.mediaInfos=!0),hI.fromJSON(s)):s.type==="text"?(s.text||!e||i.description||(s.text=e,i.description=!0),sA.fromJSON(s)):s.type==="attachments"?lI.fromJSON(s):s.type==="fields"?iA.fromJSON(s):s.type==="expression"?Lee.fromJSON(s):void 0).filter(Boolean)}_readPopupInfo({description:e,mediaInfos:t,showAttachments:r}){const i=[];return e?i.push(new sA({text:e})):i.push(new iA),Array.isArray(t)&&t.length&&i.push(hI.fromJSON({mediaInfos:t})),r&&i.push(lI.fromJSON({displayType:"auto"})),i.length?i:e}_getContentElementFields(e){const t=e==null?void 0:e.type;if(t==="attachments")return[...this._extractFieldNames(e.title),...this._extractFieldNames(e.description)];if(t==="custom")return e.outFields||[];if(t==="fields")return[...this._extractFieldNames(e.title),...this._extractFieldNames(e.description),...this._getFieldInfoFields(e.fieldInfos||this.fieldInfos)];if(t==="media"){const r=e.mediaInfos||[];return[...this._extractFieldNames(e.title),...this._extractFieldNames(e.description),...r.reduce((i,s)=>[...i,...this._getMediaInfoFields(s)],[])]}return t==="text"?this._extractFieldNames(e.text):[]}_getMediaInfoFields(e){const{caption:t,title:r,value:i}=e,s=i||{},{fields:n=[],normalizeField:o,tooltipField:a,sourceURL:l,linkURL:c}=s,h=[...this._extractFieldNames(r),...this._extractFieldNames(t),...this._extractFieldNames(l),...this._extractFieldNames(c),...n];return o&&h.push(o),a&&h.push(a),h}_getContentExpressionInfos(e,t){return Array.isArray(e)?e.reduce((r,i)=>[...r,...i.type==="expression"&&i.expressionInfo?[i.expressionInfo]:[]],t):[]}_getContentFields(e){return typeof e=="string"?this._extractFieldNames(e):Array.isArray(e)?e.reduce((t,r)=>[...t,...this._getContentElementFields(r)],[]):[]}async _collectExpressionInfoFields(e,t,r){r&&await Promise.all(r.map(i=>oc(e,t,i.expression)))}_getFieldInfoFields(e){return e?e.filter(t=>t.visible===void 0||!!t.visible).map(t=>t.fieldName).filter(t=>!t.includes("relationships/")&&!t.includes("expression/")):[]}_getActionsFields(e){return e?e.toArray().reduce((t,r)=>[...t,...this._getActionFields(r)],[]):[]}_getActionFields(e){const{className:t,title:r,type:i}=e,s=i==="button"||i==="toggle"?e.image:"";return[...this._extractFieldNames(r),...this._extractFieldNames(t),...this._extractFieldNames(s)]}_getTitleFields(e){return typeof e=="string"?this._extractFieldNames(e):[]}_extractFieldNames(e){if(!e||typeof e!="string")return[];const t=/{[^}]*}/g,r=e.match(t);if(!r)return[];const i=/\{(\w+):.+\}/,s=r.filter(n=>!(n.indexOf("{relationships/")===0||n.indexOf("{expression/")===0)).map(n=>n.replace(i,"{$1}"));return s?s.map(n=>n.slice(1,-1)):[]}};u([d({type:X6e})],Bn.prototype,"actions",void 0),u([d()],Bn.prototype,"content",void 0),u([qt("content")],Bn.prototype,"castContent",null),u([$e("content",["description","fieldInfos","popupElements","mediaInfos","showAttachments"])],Bn.prototype,"readContent",null),u([Xe("content",{popupElements:{type:ot.ofType(H6e)},showAttachments:{type:Boolean},mediaInfos:{type:ot.ofType(Nwe)},description:{type:String}})],Bn.prototype,"writeContent",null),u([d({type:[Fwe],json:{write:!0}})],Bn.prototype,"expressionInfos",void 0),u([d({type:[W$]})],Bn.prototype,"fieldInfos",void 0),u([Xe("fieldInfos")],Bn.prototype,"writeFieldInfos",null),u([d({type:q6e})],Bn.prototype,"layerOptions",void 0),u([Xe("layerOptions")],Bn.prototype,"writeLayerOptions",null),u([d({type:Boolean,json:{read:{source:"showLastEditInfo"},write:{target:"showLastEditInfo"},default:!0}})],Bn.prototype,"lastEditInfoEnabled",void 0),u([d()],Bn.prototype,"outFields",void 0),u([d()],Bn.prototype,"overwriteActions",void 0),u([d()],Bn.prototype,"returnGeometry",void 0),u([d({json:{type:String}})],Bn.prototype,"title",void 0),u([Xe("title")],Bn.prototype,"writeTitle",null),u([d({type:W6e,json:{write:!0}})],Bn.prototype,"relatedRecordsInfo",void 0),Bn=PW=u([$(Vwe)],Bn);const qT=Bn,Yae=new Tr({esriSMS:"simple-marker",esriPMS:"picture-marker",esriSLS:"simple-line",esriSFS:"simple-fill",esriPFS:"picture-fill",esriTS:"text",esriSHD:"shield-label-symbol",PointSymbol3D:"point-3d",LineSymbol3D:"line-3d",PolygonSymbol3D:"polygon-3d",WebStyleSymbol:"web-style",MeshSymbol3D:"mesh-3d",LabelSymbol3D:"label-3d",CIMSymbolReference:"cim"});let J6e=0,x2=class extends ye{constructor(e){super(e),this.id="sym"+J6e++,this.type=null,this.color=new Me([0,0,0,1])}readColor(e){return e&&e[0]!=null?[e[0],e[1],e[2],e[3]/255]:e}async collectRequiredFields(e,t){}hash(){return JSON.stringify(this.toJSON())}clone(){}};u([d({type:Yae.apiValues,readOnly:!0,json:{read:!1,write:{ignoreOrigin:!0,writer:Yae.write}}})],x2.prototype,"type",void 0),u([d({type:Me,json:{write:{allowNull:!0}}})],x2.prototype,"color",void 0),u([$e("color")],x2.prototype,"readColor",null),x2=u([$("esri.symbols.Symbol")],x2);const lu=x2;var IW;let Ov=IW=class extends lu{constructor(e){super(e),this.data=null,this.type="cim"}readData(e,t){return t}writeData(e,t){if(e)for(const r in e)t[r]=e[r]}async collectRequiredFields(e,t){if(this.data.type==="CIMSymbolReference"){const r=this.data.primitiveOverrides;if(r){const i=r.map(s=>{const n=s.valueExpressionInfo;return oc(e,t,n.expression)});await Promise.all(i)}}}clone(){return new IW({data:re(this.data)})}hash(){return LK(JSON.stringify(this.data)).toString()}};u([d({json:{write:!1}})],Ov.prototype,"color",void 0),u([d({json:{write:!0}})],Ov.prototype,"data",void 0),u([$e("data",["symbol"])],Ov.prototype,"readData",null),u([Xe("data",{})],Ov.prototype,"writeData",null),u([lt({CIMSymbolReference:"cim"},{readOnly:!0})],Ov.prototype,"type",void 0),Ov=IW=u([$("esri.symbols.CIMSymbol")],Ov);const cR=Ov;let T2=class extends ye{constructor(e){super(e),this.enabled=!0,this.type=null}writeEnabled(e,t,r){e||(t[r]=e)}};u([d({type:Boolean,json:{read:{source:"enable"},write:{target:"enable"}}})],T2.prototype,"enabled",void 0),u([Xe("enabled")],T2.prototype,"writeEnabled",null),u([d({type:["icon","object","line","path","fill","water","extrude","text"],readOnly:!0})],T2.prototype,"type",void 0),T2=u([$("esri.symbols.Symbol3DLayer")],T2);const fg=T2,K6e=/^-?(\d+(\.\d+)?)\s*((px)|(pt))?$/i,eBe="screenUtils.toPt: input not recognized!",zwe=96;function yr(e){return e?e/72*zwe:0}function ac(e){return e?72*e/zwe:0}function si(e){if(typeof e=="string"){const t=e.match(K6e);if(t){const r=Number(t[1]),i=t[3]&&t[3].toLowerCase(),s=e.charAt(0)==="-",n=i==="px"?ac(r):r;return s?-n:n}return console.warn(eBe),null}return e}function wf(e=0,t=0){return{x:e,y:t}}function ts(e=0,t=0){return[e,t]}function tBe(e=0,t=0){return[e,t]}function ea(e=0,t=0,r=0){return[e,t,r]}function UIt(e){return e}function VIt(e){return e}function zIt(e){return e}function My(e,t){return t?(t[0]=e.x,t[1]=e.y,t.length>2&&(t[2]=0),t):[e.x,e.y]}function rBe(e,t){const r=t.transparency!=null?ZC(t.transparency):1,i=t.color;return i&&Array.isArray(i)?new Me([i[0]||0,i[1]||0,i[2]||0,r]):null}function iBe(e,t){t.color=e.toJSON().slice(0,3);const r=e6(e.a);r!==0&&(t.transparency=r)}const E0={type:Me,json:{type:[Wi],default:null,read:{source:["color","transparency"],reader:rBe},write:{target:{color:{type:[Wi]},transparency:{type:Wi}},writer:iBe}}},Km={type:Number,cast:si,json:{write:!0}};let rw=class extends ye{constructor(e){super(e),this.color=new Me([0,0,0,1]),this.extensionLength=0,this.size=ac(1)}clone(){}cloneProperties(){return{color:re(this.color),size:this.size,extensionLength:this.extensionLength}}};u([d({type:["solid","sketch"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],rw.prototype,"type",void 0),u([d(E0)],rw.prototype,"color",void 0),u([d({...Km,json:{write:{overridePolicy:e=>({enabled:!!e})}}})],rw.prototype,"extensionLength",void 0),u([d(Km)],rw.prototype,"size",void 0),rw=u([$("esri.symbols.edges.Edges3D")],rw);const Fee=rw;var $W;let X4=$W=class extends Fee{constructor(e){super(e),this.type="sketch"}clone(){return new $W(this.cloneProperties())}};u([lt({sketch:"sketch"},{readOnly:!0})],X4.prototype,"type",void 0),X4=$W=u([$("esri.symbols.edges.SketchEdges3D")],X4);const sBe=X4;var LW;let Z4=LW=class extends Fee{constructor(e){super(e),this.type="solid"}clone(){return new LW(this.cloneProperties())}};u([lt({solid:"solid"},{readOnly:!0})],Z4.prototype,"type",void 0),Z4=LW=u([$("esri.symbols.support.SolidEdges3D")],Z4);const nBe=Z4,Bwe={types:{key:"type",base:Fee,typeMap:{solid:nBe,sketch:sBe}},json:{write:!0}};var DW;let uh=DW=class extends ye{constructor(e){super(e),this.color=null}clone(){const e={color:b(this.color)?this.color.clone():null};return new DW(e)}};u([d(E0)],uh.prototype,"color",void 0),uh=DW=u([$("esri.symbols.support.Symbol3DMaterial")],uh);var NW;let Mv=NW=class extends fg{constructor(e){super(e),this.type="extrude",this.size=1,this.material=null,this.castShadows=!0,this.edges=null}clone(){return new NW({edges:this.edges&&this.edges.clone(),enabled:this.enabled,material:b(this.material)?this.material.clone():null,castShadows:this.castShadows,size:this.size})}};u([lt({Extrude:"extrude"},{readOnly:!0})],Mv.prototype,"type",void 0),u([d({type:Number,json:{write:{enabled:!0,isRequired:!0}},nonNullable:!0})],Mv.prototype,"size",void 0),u([d({type:uh,json:{write:!0}})],Mv.prototype,"material",void 0),u([d({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],Mv.prototype,"castShadows",void 0),u([d(Bwe)],Mv.prototype,"edges",void 0),Mv=NW=u([$("esri.symbols.ExtrudeSymbol3DLayer")],Mv);const Gwe=Mv;let SM=class extends lu{constructor(e){super(e),this.type="simple-line",this.width=.75}hash(){return`${this.type}.${this.width}`}};u([lt({esriSLS:"simple-line"},{readOnly:!0})],SM.prototype,"type",void 0),u([d({type:Number,cast:si,json:{write:!0}})],SM.prototype,"width",void 0),SM=u([$("esri.symbols.LineSymbol")],SM);const oBe=SM,aBe=["begin","end","begin-end"],jwe=["arrow","circle","square","diamond","cross","x"];var FW;let Kf=FW=class extends ye{constructor(e){super(e),this.placement="begin-end",this.type="line-marker",this.style="arrow"}writeStyle(e,t,r,i){t[r]=(i==null?void 0:i.origin)==="web-map"?"arrow":e}set color(e){this._set("color",e)}readColor(e){return e&&e[0]!=null?[e[0],e[1],e[2],e[3]/255]:e}writeColor(e,t,r,i){(i==null?void 0:i.origin)==="web-map"||(t[r]=e)}clone(){return new FW({color:re(this.color),placement:this.placement,style:this.style})}hash(){var e;return`${this.placement}.${(e=this.color)==null?void 0:e.hash()}.${this.style}`}};u([d({type:["begin","end","begin-end"],json:{write:!0}})],Kf.prototype,"placement",void 0),u([lt({"line-marker":"line-marker"},{readOnly:!0}),d({json:{origins:{"web-map":{write:!1}}}})],Kf.prototype,"type",void 0),u([d({type:jwe})],Kf.prototype,"style",void 0),u([Xe("style")],Kf.prototype,"writeStyle",null),u([d({type:Me,value:null,json:{write:{allowNull:!0}}})],Kf.prototype,"color",null),u([$e("color")],Kf.prototype,"readColor",null),u([Xe("color")],Kf.prototype,"writeColor",null),Kf=FW=u([$("esri.symbols.LineSymbolMarker")],Kf);const lBe=Kf;var kW;const z9=new Tr({esriSLSSolid:"solid",esriSLSDash:"dash",esriSLSDot:"dot",esriSLSDashDot:"dash-dot",esriSLSDashDotDot:"long-dash-dot-dot",esriSLSNull:"none",esriSLSInsideFrame:"inside-frame",esriSLSShortDash:"short-dash",esriSLSShortDot:"short-dot",esriSLSShortDashDot:"short-dash-dot",esriSLSShortDashDotDot:"short-dash-dot-dot",esriSLSLongDash:"long-dash",esriSLSLongDashDot:"long-dash-dot"});let Wg=kW=class extends oBe{constructor(...e){super(...e),this.type="simple-line",this.style="solid",this.cap="round",this.join="round",this.marker=null,this.miterLimit=2}normalizeCtorArgs(e,t,r,i,s,n){if(e&&typeof e!="string")return e;const o={};return e!=null&&(o.style=e),t!=null&&(o.color=t),r!=null&&(o.width=si(r)),i!=null&&(o.cap=i),s!=null&&(o.join=s),n!=null&&(o.miterLimit=si(n)),o}clone(){var e;return new kW({color:re(this.color),style:this.style,width:this.width,cap:this.cap,join:this.join,miterLimit:this.miterLimit,marker:(e=this.marker)==null?void 0:e.clone()})}hash(){var e,t;return`${super.hash()}.${(e=this.color)==null?void 0:e.hash()}.${this.style}.${this.cap}.${this.join}.${this.miterLimit}.${(t=this.marker)==null?void 0:t.hash()}`}};u([lt({esriSLS:"simple-line"},{readOnly:!0})],Wg.prototype,"type",void 0),u([d({type:z9.apiValues,json:{read:z9.read,write:z9.write}})],Wg.prototype,"style",void 0),u([d({type:["butt","round","square"],json:{write:{overridePolicy:(e,t,r)=>({enabled:e!=="round"&&(r==null||r.origin==null)})}}})],Wg.prototype,"cap",void 0),u([d({type:["miter","round","bevel"],json:{write:{overridePolicy:(e,t,r)=>({enabled:e!=="round"&&(r==null||r.origin==null)})}}})],Wg.prototype,"join",void 0),u([d({types:{key:"type",base:null,defaultKeyValue:"line-marker",typeMap:{"line-marker":lBe}},json:{write:!0,origins:{"web-scene":{write:!1}}}})],Wg.prototype,"marker",void 0),u([d({type:Number,json:{read:!1,write:!1}})],Wg.prototype,"miterLimit",void 0),Wg=kW=u([$("esri.symbols.SimpleLineSymbol")],Wg);const cu=Wg;let EM=class extends lu{constructor(e){super(e),this.outline=null,this.type=null}hash(){return`${this.type}.${this.outline&&this.outline.hash()}`}};u([d({types:{key:"type",base:null,defaultKeyValue:"simple-line",typeMap:{"simple-line":cu}},json:{default:null,write:!0}})],EM.prototype,"outline",void 0),u([d({type:["simple-fill","picture-fill"],readOnly:!0})],EM.prototype,"type",void 0),EM=u([$("esri.symbols.FillSymbol")],EM);const Hwe=EM;let Y4=class extends ye{constructor(e){super(e)}clone(){}};u([d({type:["style"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],Y4.prototype,"type",void 0),Y4=u([$("esri.symbols.patterns.LinePattern3D")],Y4);const qwe=Y4,cBe=["dash","dash-dot","dot","long-dash","long-dash-dot","long-dash-dot-dot","none","short-dash","short-dash-dot","short-dash-dot-dot","short-dot","solid"];var UW;const uBe=Da()({dash:"dash","dash-dot":"dash-dot","dash-dot-dot":"long-dash-dot-dot",dot:"dot","long-dash":"long-dash","long-dash-dot":"long-dash-dot",null:"none","short-dash":"short-dash","short-dash-dot":"short-dash-dot","short-dash-dot-dot":"short-dash-dot-dot","short-dot":"short-dot",solid:"solid"});let CM=UW=class extends qwe{constructor(e){super(e),this.type="style",this.style="solid"}clone(){const e={style:this.style};return new UW(e)}};u([d({type:["style"]})],CM.prototype,"type",void 0),u([lt(uBe),d({type:cBe})],CM.prototype,"style",void 0),CM=UW=u([$("esri.symbols.patterns.LineStylePattern3D")],CM);const kee=CM;let Q4=class extends ye{constructor(e){super(e)}clone(){}};u([d({type:["style"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],Q4.prototype,"type",void 0),Q4=u([$("esri.symbols.patterns.Pattern3D")],Q4);const Wwe=Q4,hBe=["backward-diagonal","cross","diagonal-cross","forward-diagonal","horizontal","none","solid","vertical"];var VW;let AM=VW=class extends Wwe{constructor(e){super(e),this.type="style",this.style="solid"}clone(){const e={style:this.style};return new VW(e)}};u([d({type:["style"]})],AM.prototype,"type",void 0),u([d({type:hBe,json:{read:!0,write:!0}})],AM.prototype,"style",void 0),AM=VW=u([$("esri.symbols.patterns.StylePattern3D")],AM);const Xwe=AM,dBe={types:{key:"type",base:Wwe,typeMap:{style:Xwe}},json:{write:!0}},Zwe={types:{key:"type",base:qwe,typeMap:{style:kee}},json:{write:!0}},H3=new Me("white");new Me("black");const pBe=new Me([255,255,255,0]);function fBe(e){return e.r===0&&e.g===0&&e.b===0}var zW;let q3=zW=class extends uh{constructor(e){super(e),this.colorMixMode=null}clone(){const e={color:b(this.color)?this.color.clone():null,colorMixMode:this.colorMixMode};return new zW(e)}};u([lt({multiply:"multiply",replace:"replace",tint:"tint"})],q3.prototype,"colorMixMode",void 0),q3=zW=u([$("esri.symbols.support.Symbol3DFillMaterial")],q3);function Ut(e=vBe){return[e[0],e[1],e[2],e[3]]}function BIt(e){return[e[0],e[1],e[2],e[3]]}function h0(e,t){return e!==t&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3]),e}function Uee(e,t,r,i,s=Ut()){return s[0]=e,s[1]=t,s[2]=r,s[3]=i,s}function Ywe(e,t=Ut()){return t[0]=e.xmin,t[1]=e.ymin,t[2]=e.xmax,t[3]=e.ymax,t}function a6(e,t){return new Kt({xmin:e[0],ymin:e[1],xmax:e[2],ymax:e[3],spatialReference:t})}function cC(e,t){t[0]<e[0]&&(e[0]=t[0]),t[0]>e[2]&&(e[2]=t[0]),t[1]<e[1]&&(e[1]=t[1]),t[1]>e[3]&&(e[3]=t[1])}function Dx(e,t,r){if(R(t))h0(r,e);else if("length"in t)GW(t)?(r[0]=Math.min(e[0],t[0]),r[1]=Math.min(e[1],t[1]),r[2]=Math.max(e[2],t[2]),r[3]=Math.max(e[3],t[3])):t.length!==2&&t.length!==3||(r[0]=Math.min(e[0],t[0]),r[1]=Math.min(e[1],t[1]),r[2]=Math.max(e[2],t[0]),r[3]=Math.max(e[3],t[1]));else switch(t.type){case"extent":r[0]=Math.min(e[0],t.xmin),r[1]=Math.min(e[1],t.ymin),r[2]=Math.max(e[2],t.xmax),r[3]=Math.max(e[3],t.ymax);break;case"point":r[0]=Math.min(e[0],t.x),r[1]=Math.min(e[1],t.y),r[2]=Math.max(e[2],t.x),r[3]=Math.max(e[3],t.y)}}function B9(e,t,r=e){const i=t.length;let s=e[0],n=e[1],o=e[2],a=e[3];for(let l=0;l<i;l++){const c=t[l];s=Math.min(s,c[0]),n=Math.min(n,c[1]),o=Math.max(o,c[0]),a=Math.max(a,c[1])}return r[0]=s,r[1]=n,r[2]=o,r[3]=a,r}function BW(e){for(let t=0;t<4;t++)if(!isFinite(e[t]))return!1;return!0}function Ju(e){return R(e)||e[0]>=e[2]?0:e[2]-e[0]}function xf(e){return e[1]>=e[3]?0:e[3]-e[1]}function Qwe(e){return Ju(e)*xf(e)}function Vee(e,t=[0,0]){return t[0]=(e[0]+e[2])/2,t[1]=(e[1]+e[3])/2,t}function Jwe(e,t){return zee(e,t[0],t[1])}function Qae(e,t){const r=t[3],i=.5*(e[0]+e[2]),s=Math.abs(t[0]-i),n=.5*(e[2]-e[0]);if(s>r+n)return!1;const o=.5*(e[1]+e[3]),a=.5*(e[3]-e[1]),l=Math.abs(t[1]-o);if(l>r+a)return!1;if(s<n||l<a)return!0;const c=s-n,h=l-a;return c*c+h*h<=r*r}function GIt(e,t,r){const i=e[0],s=e[1],n=e[2],o=e[3],{x:a,y:l}=t,{x:c,y:h}=r,p=(w,_)=>(h-l)*w+(a-c)*_+(c*l-a*h)<0,f=p(i,o),m=p(n,o),g=p(n,s),v=p(i,s);return!(f===m&&m===g&&g===v&&v===f||a<i&&c<i||a>n&&c>n||l>o&&h>o||l<s&&h<s)}function jIt(e,t){return zee(e,t.x,t.y)}function zee(e,t,r){return t>=e[0]&&r>=e[1]&&t<=e[2]&&r<=e[3]}function RM(e,t,r,i){return t>=e[0]-i&&r>=e[1]-i&&t<=e[2]+i&&r<=e[3]+i}function mBe(e,t,r){return t[0]>=e[0]-r&&t[1]>=e[1]-r&&t[0]<=e[2]+r&&t[1]<=e[3]+r}function X$(e,t){return Math.max(t[0],e[0])<=Math.min(t[2],e[2])&&Math.max(t[1],e[1])<=Math.min(t[3],e[3])}function Jae(e,t){return t[0]>=e[0]&&t[2]<=e[2]&&t[1]>=e[1]&&t[3]<=e[3]}function J4(e,t,r){if(R(t))return h0(r,e);const i=t[0],s=t[1],n=t[2],o=t[3];return r[0]=Le(e[0],i,n),r[1]=Le(e[1],s,o),r[2]=Le(e[2],i,n),r[3]=Le(e[3],s,o),r}function gBe(e,t){const r=(e[0]+e[2])/2,i=(e[1]+e[3])/2,s=Math.max(Math.abs(t[0]-r)-Ju(e)/2,0),n=Math.max(Math.abs(t[1]-i)-xf(e)/2,0);return Math.sqrt(s*s+n*n)}function MU(e,t,r,i=e){return i[0]=e[0]+t,i[1]=e[1]+r,i[2]=e[2]+t,i[3]=e[3]+r,i}function vh(e){return e?h0(e,jW):Ut(jW)}function GW(e){return e!=null&&e.length===4}function yBe(e){return!(Ju(e)!==0&&isFinite(e[0])||xf(e)!==0&&isFinite(e[1]))}function Nx(e,t){return GW(e)&&GW(t)?e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]:e===t}const HIt=[-1/0,-1/0,1/0,1/0],jW=[1/0,1/0,-1/0,-1/0],vBe=[0,0,0,0];function tn(e=ixe){return[e[0],e[1],e[2],e[3],e[4],e[5]]}function uT(e,t,r,i,s,n,o=tn()){return o[0]=e,o[1]=t,o[2]=r,o[3]=i,o[4]=s,o[5]=n,o}function qIt(e,t){const r=isFinite(e[2])||isFinite(e[5]);return new Kt(r?{xmin:e[0],xmax:e[3],ymin:e[1],ymax:e[4],zmin:e[2],zmax:e[5],spatialReference:t}:{xmin:e[0],xmax:e[3],ymin:e[1],ymax:e[4],spatialReference:t})}function nA(e,t){e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[2]=Math.min(e[2],t[2]),e[3]=Math.max(e[3],t[3]),e[4]=Math.max(e[4],t[4]),e[5]=Math.max(e[5],t[5])}function _Be(e,t){e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[3]=Math.max(e[3],t[2]),e[4]=Math.max(e[4],t[3])}function eg(e,t){e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[2]=Math.min(e[2],t[2]),e[3]=Math.max(e[3],t[0]),e[4]=Math.max(e[4],t[1]),e[5]=Math.max(e[5],t[2])}function nh(e,t,r=0,i=t.length/3){let s=e[0],n=e[1],o=e[2],a=e[3],l=e[4],c=e[5];for(let h=0;h<i;h++)s=Math.min(s,t[r+3*h]),n=Math.min(n,t[r+3*h+1]),o=Math.min(o,t[r+3*h+2]),a=Math.max(a,t[r+3*h]),l=Math.max(l,t[r+3*h+1]),c=Math.max(c,t[r+3*h+2]);e[0]=s,e[1]=n,e[2]=o,e[3]=a,e[4]=l,e[5]=c}function G9(e,t,r){const i=t.length;let s=e[0],n=e[1],o=e[2],a=e[3],l=e[4],c=e[5];if(r)for(let h=0;h<i;h++){const p=t[h];s=Math.min(s,p[0]),n=Math.min(n,p[1]),o=Math.min(o,p[2]),a=Math.max(a,p[0]),l=Math.max(l,p[1]),c=Math.max(c,p[2])}else for(let h=0;h<i;h++){const p=t[h];s=Math.min(s,p[0]),n=Math.min(n,p[1]),a=Math.max(a,p[0]),l=Math.max(l,p[1])}e[0]=s,e[1]=n,e[2]=o,e[3]=a,e[4]=l,e[5]=c}function bBe(e){for(let t=0;t<6;t++)if(!isFinite(e[t]))return!1;return!0}function WT(e){return e[0]>=e[3]?0:e[3]-e[0]}function XT(e){return e[1]>=e[4]?0:e[4]-e[1]}function Z1(e){return e[2]>=e[5]?0:e[5]-e[2]}function Kwe(e){const t=WT(e),r=Z1(e),i=XT(e);return Math.sqrt(t*t+r*r+i*i)}function tf(e,t=[0,0,0]){return t[0]=e[0]+WT(e)/2,t[1]=e[1]+XT(e)/2,t[2]=e[2]+Z1(e)/2,t}function RD(e,t=[0,0,0]){return t[0]=WT(e),t[1]=XT(e),t[2]=Z1(e),t}function wBe(e){return Math.max(WT(e),Z1(e),XT(e))}function Bee(e,t){return t[0]>=e[0]&&t[1]>=e[1]&&t[2]>=e[2]&&t[0]<=e[3]&&t[1]<=e[4]&&t[2]<=e[5]}function WIt(e,t){return t[0]>=e[0]&&t[1]>=e[1]&&t[2]>=e[2]&&t[3]<=e[3]&&t[4]<=e[4]&&t[5]<=e[5]}function xBe(e,t){return Math.max(t[0],e[0])<=Math.min(t[3],e[3])&&Math.max(t[1],e[1])<=Math.min(t[4],e[4])&&Math.max(t[2],e[2])<=Math.min(t[5],e[5])}function rf(e,t){return!!R(t)||xBe(e,t)}function exe(e,t,r,i,s=e){return s[0]=e[0]+t,s[1]=e[1]+r,s[2]=e[2]+i,s[3]=e[3]+t,s[4]=e[4]+r,s[5]=e[5]+i,s}function XIt(e,t,r=e){const i=e[0]+WT(e)/2,s=e[1]+XT(e)/2,n=e[2]+Z1(e)/2;return r[0]=i+(e[0]-i)*t,r[1]=s+(e[1]-s)*t,r[2]=n+(e[2]-n)*t,r[3]=i+(e[3]-i)*t,r[4]=s+(e[4]-s)*t,r[5]=n+(e[5]-n)*t,r}function txe(e,t,r=e){return r[0]=t[0],r[1]=t[1],r[2]=t[2],r!==e&&(r[3]=e[3],r[4]=e[4],r[5]=e[5]),r}function rxe(e,t,r=e){return r[3]=t[0],r[4]=t[1],r[5]=t[2],r!==e&&(r[0]=e[0],r[1]=e[1],r[2]=e[2]),e}function l6(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e}function vi(e){return e?l6(e,ele):tn(ele)}function Gee(e,t){return t||(t=Ut()),t[0]=e[0],t[1]=e[1],t[2]=e[3],t[3]=e[4],t}function ZIt(e,t){return e[0]=t[0],e[1]=t[1],e[2]=Number.NEGATIVE_INFINITY,e[3]=t[2],e[4]=t[3],e[5]=Number.POSITIVE_INFINITY,e}function Kae(e){return e.length===6}function c6(e){return WT(e)===0&&XT(e)===0&&Z1(e)===0}function YIt(e,t,r){if(R(e)||R(t))return e===t;if(!Kae(e)||!Kae(t))return!1;if(r){for(let i=0;i<e.length;i++)if(!r(e[i],t[i]))return!1}else for(let i=0;i<e.length;i++)if(e[i]!==t[i])return!1;return!0}function TBe(e,t,r,i,s,n){return uT(e,t,r,i,s,n,SBe)}const QIt=[-1/0,-1/0,-1/0,1/0,1/0,1/0],ele=[1/0,1/0,1/0,-1/0,-1/0,-1/0],ixe=[0,0,0,0,0,0],SBe=tn();function j9(e,{isPrimitive:t,width:r,depth:i,height:s}){const n=t?10:1;if(r==null&&s==null&&i==null)return[n*e[0],n*e[1],n*e[2]];const o=Ue(r,i,s);let a;for(let l=0;l<3;l++){const c=o[l];if(c!=null){a=c/e[l];break}}for(let l=0;l<3;l++)o[l]==null&&(o[l]=e[l]*a);return o}const EBe=uT(-.5,-.5,-.5,.5,.5,.5),CBe=uT(-.5,-.5,0,.5,.5,1),ABe=uT(-.5,-.5,0,.5,.5,.5);function RBe(e){switch(e){case"sphere":case"cube":case"diamond":return EBe;case"cylinder":case"cone":case"inverted-cone":return CBe;case"tetrahedron":return ABe;default:return}}const jee=["butt","square","round"],OBe=[...jee,"none"],sxe=["miter","bevel","round"];var HW;let iw=HW=class extends ye{constructor(e){super(e),this.color=new Me([0,0,0,1]),this.size=ac(1),this.pattern=null,this.patternCap="butt"}clone(){const e={color:b(this.color)?this.color.clone():null,size:this.size,pattern:b(this.pattern)?this.pattern.clone():null,patternCap:this.patternCap};return new HW(e)}};u([d(E0)],iw.prototype,"color",void 0),u([d(Km)],iw.prototype,"size",void 0),u([d(Zwe)],iw.prototype,"pattern",void 0),u([d({type:jee,json:{default:"butt",write:{overridePolicy(){return{enabled:b(this.pattern)}}}}})],iw.prototype,"patternCap",void 0),iw=HW=u([$("esri.symbols.support.Symbol3DOutline")],iw);var K4;let Xg=K4=class extends fg{constructor(e){super(e),this.type="fill",this.material=null,this.pattern=null,this.castShadows=!0,this.outline=null,this.edges=null}clone(){const e={edges:b(this.edges)?this.edges.clone():null,enabled:this.enabled,material:b(this.material)?this.material.clone():null,pattern:b(this.pattern)?this.pattern.clone():null,castShadows:this.castShadows,outline:b(this.outline)?this.outline.clone():null};return new K4(e)}static fromSimpleFillSymbol(e){var i,s,n,o,a,l;const t=e.outline&&e.outline.style&&e.outline.style!=="inside-frame"&&e.outline.style!=="solid"?new kee({style:e.outline.style}):null,r={size:(s=(i=e.outline)==null?void 0:i.width)!=null?s:0,color:((o=(n=e.outline)==null?void 0:n.color)!=null?o:H3).clone(),pattern:t};return t&&((a=e.outline)==null?void 0:a.cap)&&(r.patternCap=e.outline.cap),new K4({material:new q3({color:((l=e.color)!=null?l:pBe).clone()}),pattern:e.style&&e.style!=="solid"?new Xwe({style:e.style}):null,outline:r})}};u([lt({Fill:"fill"},{readOnly:!0})],Xg.prototype,"type",void 0),u([d({type:q3,json:{write:!0}})],Xg.prototype,"material",void 0),u([d(dBe)],Xg.prototype,"pattern",void 0),u([d({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],Xg.prototype,"castShadows",void 0),u([d({type:iw,json:{write:!0}})],Xg.prototype,"outline",void 0),u([d(Bwe)],Xg.prototype,"edges",void 0),Xg=K4=u([$("esri.symbols.FillSymbol3DLayer")],Xg);const u6=Xg,MBe=["none","underline","line-through"],PBe=["normal","italic","oblique"],IBe=["normal","lighter","bold","bolder"],nxe={type:Number,cast:e=>{const t=yd(e);return t===0?1:Le(t,.1,4)},nonNullable:!0},$Be=["left","right","center"],LBe=["baseline","top","middle","bottom"],oxe={type:$Be,nonNullable:!0},axe={type:LBe,nonNullable:!0};var qW;let Zg=qW=class extends ye{constructor(e){super(e),this.decoration="none",this.family="sans-serif",this.size=9,this.style="normal",this.weight="normal"}castSize(e){return si(e)}clone(){return new qW({decoration:this.decoration,family:this.family,size:this.size,style:this.style,weight:this.weight})}hash(){return`${this.decoration}.${this.family}.${this.size}.${this.style}.${this.weight}`}};u([d({type:MBe,json:{default:"none",write:!0}})],Zg.prototype,"decoration",void 0),u([d({type:String,json:{write:!0}})],Zg.prototype,"family",void 0),u([d({type:Number,json:{write:{overridePolicy:(e,t,r)=>({enabled:!r||!r.textSymbol3D})}}})],Zg.prototype,"size",void 0),u([qt("size")],Zg.prototype,"castSize",null),u([d({type:PBe,json:{default:"normal",write:!0}})],Zg.prototype,"style",void 0),u([d({type:IBe,json:{default:"normal",write:!0}})],Zg.prototype,"weight",void 0),Zg=qW=u([$("esri.symbols.Font")],Zg);const h6=Zg;function d0(e,t){const r=t&&t.url&&t.url.path;if(e&&r&&(e=Rd(e,r,{preserveProtocolRelative:!0}),t.portalItem&&t.readResourcePaths)){const i=QK(e,t.portalItem.itemUrl);NBe.test(i)&&t.readResourcePaths.push(t.portalItem.resourceFromPath(i).path)}return WW(e,t&&t.portal)}function p0(e,t,r=oA.YES){if(!e)return e;!Kc(e)&&t&&t.blockedRelativeUrls&&t.blockedRelativeUrls.push(e);let i=Rd(e);if(t){const s=t.verifyItemRelativeUrls&&t.verifyItemRelativeUrls.rootPath||t.url&&t.url.path;if(s){const n=WW(s,t.portal);i=QK(WW(i,t.portal),n,n),i!==e&&t.verifyItemRelativeUrls&&t.verifyItemRelativeUrls.writtenUrls.push(i)}}return i=cxe(i,t&&t.portal),Kc(i)&&(i=Id(i)),(t==null?void 0:t.resources)&&(t==null?void 0:t.portalItem)&&!Kc(i)&&!ug(i)&&r===oA.YES&&t.resources.toKeep.push({resource:t.portalItem.resourceFromPath(i)}),i}function d6(e,t,r){return d0(e,r)}function R1(e,t,r,i){const s=p0(e,i);s!==void 0&&(t[r]=s)}const DBe=/\/items\/([^\/]+)\/resources\//,NBe=/^\.\/resources\//;function lxe(e){const t=b(e)?e.match(DBe):null;return b(t)?t[1]:null}function cxe(e,t){return t&&!t.isPortal&&t.urlKey&&t.customBaseUrl?Uq(e,`${t.urlKey}.${t.customBaseUrl}`,t.portalHostname):e}function WW(e,t){if(!t||t.isPortal||!t.urlKey||!t.customBaseUrl)return e;const r=`${t.urlKey}.${t.customBaseUrl}`,i=XK();return rI(i,`${i.scheme}://${r}`)?Uq(e,t.portalHostname,r):Uq(e,r,t.portalHostname)}var oA;(function(e){e[e.YES=0]="YES",e[e.NO=1]="NO"})(oA||(oA={}));const FBe=Object.freeze(Object.defineProperty({__proto__:null,fromJSON:d0,toJSON:p0,read:d6,write:R1,itemIdFromResourceUrl:lxe,ensureMainOnlineDomain:cxe,get MarkKeep(){return oA}},Symbol.toStringTag,{value:"Module"}));var XW;const kBe=Da()({circle:"circle",square:"square",cross:"cross",x:"x",kite:"kite",triangle:"triangle"});let sw=XW=class extends ye{constructor(e){super(e)}readHref(e,t,r){return e?d0(e,r):t.dataURI}writeHref(e,t,r,i){e&&(ug(e)?t.dataURI=e:(t.href=p0(e,i),Kc(t.href)&&(t.href=Id(t.href))))}clone(){return new XW({href:this.href,primitive:this.primitive})}};u([d({type:String,json:{write:!0,read:{source:["href","dataURI"]}}})],sw.prototype,"href",void 0),u([$e("href")],sw.prototype,"readHref",null),u([Xe("href",{href:{type:String},dataURI:{type:String}})],sw.prototype,"writeHref",null),u([lt(kBe)],sw.prototype,"primitive",void 0),sw=XW=u([$("esri.symbols.support.IconSymbol3DLayerResource")],sw);const uxe="circle";var ZW;let CE=ZW=class extends xe{constructor(){super(...arguments),this.x=0,this.y=0}clone(){return new ZW({x:this.x,y:this.y})}};u([d({type:Number})],CE.prototype,"x",void 0),u([d({type:Number})],CE.prototype,"y",void 0),CE=ZW=u([$("esri.symbols.support.Symbol3DAnchorPosition2D")],CE);var YW;let OM=YW=class extends ye{constructor(e){super(e),this.color=new Me([0,0,0,1]),this.size=ac(1)}clone(){const e={color:b(this.color)?this.color.clone():null,size:this.size};return new YW(e)}};u([d(E0)],OM.prototype,"color",void 0),u([d(Km)],OM.prototype,"size",void 0),OM=YW=u([$("esri.symbols.support.Symbol3DIconOutline")],OM);var S2;const UBe=fe.getLogger("esri.symbols.IconSymbol3DLayer");let em=S2=class extends fg{constructor(e){super(e),this.material=null,this.resource=null,this.type="icon",this.size=12,this.anchor="center",this.anchorPosition=void 0,this.outline=void 0}clone(){return new S2({anchor:this.anchor,anchorPosition:this.anchorPosition&&this.anchorPosition.clone(),enabled:this.enabled,material:b(this.material)?this.material.clone():null,outline:b(this.outline)?this.outline.clone():null,resource:this.resource&&this.resource.clone(),size:this.size})}static fromSimpleMarkerSymbol(e){const t=e.color||H3,r=tle(e),i=e.outline&&e.outline.width>0?{size:e.outline.width,color:(e.outline.color||H3).clone()}:null;return new S2({size:e.size,resource:{primitive:zBe(e.style)},material:{color:t},outline:i,anchor:r?"relative":void 0,anchorPosition:r})}static fromPictureMarkerSymbol(e){const t=!e.color||fBe(e.color)?H3:e.color,r=tle(e);return new S2({size:e.width<=e.height?e.height:e.width,resource:{href:e.url},material:{color:t.clone()},anchor:r?"relative":void 0,anchorPosition:r})}static fromCIMSymbol(e){return new S2({resource:{href:abe({mediaType:"application/json",data:JSON.stringify(e.data)})}})}};function tle(e){const t="width"in e?e.width:e.size,r="height"in e?e.height:e.size,i=rle(e.xoffset),s=rle(e.yoffset);return(i||s)&&t&&r?{x:-i/t,y:s/r}:null}function rle(e){return isFinite(e)?e:0}u([d({type:uh,json:{write:!0}})],em.prototype,"material",void 0),u([d({type:sw,json:{write:!0}})],em.prototype,"resource",void 0),u([lt({Icon:"icon"},{readOnly:!0})],em.prototype,"type",void 0),u([d(Km)],em.prototype,"size",void 0),u([lt({center:"center",left:"left",right:"right",top:"top",bottom:"bottom",topLeft:"top-left",topRight:"top-right",bottomLeft:"bottom-left",bottomRight:"bottom-right",relative:"relative"}),d({json:{default:"center"}})],em.prototype,"anchor",void 0),u([d({type:CE,json:{type:[Number],read:{reader:e=>new CE({x:e[0],y:e[1]})},write:{writer:(e,t)=>{t.anchorPosition=[e.x,e.y]},overridePolicy(){return{enabled:this.anchor==="relative"}}}}})],em.prototype,"anchorPosition",void 0),u([d({type:OM,json:{write:!0}})],em.prototype,"outline",void 0),em=S2=u([$("esri.symbols.IconSymbol3DLayer")],em);const VBe={circle:"circle",cross:"cross",diamond:"kite",square:"square",x:"x",triangle:"triangle",path:null};function zBe(e){return VBe[e]||(UBe.warn(`${e} cannot be mapped to Icon symbol. Fallback to "circle"`),"circle")}const N_=em;let nw=class extends au(ye){constructor(e){super(e),this.type="style",this.placement="begin-end",this.style="arrow",this.color=null}equals(e){return b(e)&&e.placement===this.placement&&e.style===this.style&&(R(this.color)&&R(e.color)||b(this.color)&&b(e.color)&&this.color.toJSON()===e.color.toJSON())}};u([d({type:["style"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],nw.prototype,"type",void 0),u([d({type:aBe,json:{default:"begin-end",write:!0}})],nw.prototype,"placement",void 0),u([d({type:jwe,json:{default:"arrow",write:!0}})],nw.prototype,"style",void 0),u([d({type:Me,json:{type:[Wi],default:null,write:!0}})],nw.prototype,"color",void 0),nw=u([$("esri.symbols.LineStyleMarker3D")],nw);const QW=nw;var e5;let tm=e5=class extends fg{constructor(e){super(e),this.material=null,this.type="line",this.join="miter",this.cap="butt",this.size=ac(1),this.pattern=null,this.marker=null}clone(){const e={enabled:this.enabled,material:b(this.material)?this.material.clone():null,size:this.size,join:this.join,cap:this.cap,pattern:b(this.pattern)?this.pattern.clone():null,marker:b(this.marker)?this.marker.clone():null};return new e5(e)}static fromSimpleLineSymbol(e){var r,i,s;const t={enabled:!0,size:(r=e.width)!=null?r:ac(1),cap:e.cap||"butt",join:e.join||"miter",pattern:e.style&&e.style!=="inside-frame"?new kee({style:e.style}):null,material:new uh({color:(e.color||H3).clone()}),marker:e.marker?new QW({placement:e.marker.placement,style:e.marker.style,color:(s=(i=e.marker.color)==null?void 0:i.clone())!=null?s:null}):null};return new e5(t)}};u([d({type:uh,json:{write:!0}})],tm.prototype,"material",void 0),u([lt({Line:"line"},{readOnly:!0})],tm.prototype,"type",void 0),u([d({type:sxe,json:{write:!0,default:"miter"}})],tm.prototype,"join",void 0),u([d({type:jee,json:{write:!0,default:"butt"}})],tm.prototype,"cap",void 0),u([d(Km)],tm.prototype,"size",void 0),u([d(Zwe)],tm.prototype,"pattern",void 0),u([d({types:{key:"type",base:QW,typeMap:{style:QW}},json:{write:!0}})],tm.prototype,"marker",void 0),tm=e5=u([$("esri.symbols.LineSymbol3DLayer")],tm);const Z$=tm;var JW;const BBe=Da()({sphere:"sphere",cylinder:"cylinder",cube:"cube",cone:"cone",diamond:"diamond",tetrahedron:"tetrahedron",invertedCone:"inverted-cone"});let MM=JW=class extends ye{clone(){return new JW({href:this.href,primitive:this.primitive})}};u([d({type:String,json:{read:d6,write:R1}})],MM.prototype,"href",void 0),u([lt(BBe)],MM.prototype,"primitive",void 0),MM=JW=u([$("esri.symbols.support.ObjectSymbol3DLayerResource")],MM);const Hee="sphere";var KW;let Ww=KW=class extends xe{constructor(){super(...arguments),this.x=0,this.y=0,this.z=0}clone(){return new KW({x:this.x,y:this.y,z:this.z})}};u([d({type:Number})],Ww.prototype,"x",void 0),u([d({type:Number})],Ww.prototype,"y",void 0),u([d({type:Number})],Ww.prototype,"z",void 0),Ww=KW=u([$("esri.symbols.support.Symbol3DAnchorPosition3D")],Ww);var eX;let ja=eX=class extends fg{constructor(e){super(e),this.material=null,this.castShadows=!0,this.resource=null,this.type="object",this.width=void 0,this.height=void 0,this.depth=void 0,this.anchor=void 0,this.anchorPosition=void 0,this.heading=void 0,this.tilt=void 0,this.roll=void 0}clone(){return new eX({heading:this.heading,tilt:this.tilt,roll:this.roll,anchor:this.anchor,anchorPosition:this.anchorPosition&&this.anchorPosition.clone(),depth:this.depth,enabled:this.enabled,height:this.height,material:b(this.material)?this.material.clone():null,castShadows:this.castShadows,resource:this.resource&&this.resource.clone(),width:this.width})}get isPrimitive(){return!this.resource||typeof this.resource.href!="string"}};u([d({type:uh,json:{write:!0}})],ja.prototype,"material",void 0),u([d({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],ja.prototype,"castShadows",void 0),u([d({type:MM,json:{write:!0}})],ja.prototype,"resource",void 0),u([lt({Object:"object"},{readOnly:!0})],ja.prototype,"type",void 0),u([d({type:Number,json:{write:!0}})],ja.prototype,"width",void 0),u([d({type:Number,json:{write:!0}})],ja.prototype,"height",void 0),u([d({type:Number,json:{write:!0}})],ja.prototype,"depth",void 0),u([lt({center:"center",top:"top",bottom:"bottom",origin:"origin",relative:"relative"}),d({json:{default:"origin"}})],ja.prototype,"anchor",void 0),u([d({type:Ww,json:{type:[Number],read:{reader:e=>new Ww({x:e[0],y:e[1],z:e[2]})},write:{writer:(e,t)=>{t.anchorPosition=[e.x,e.y,e.z]},overridePolicy(){return{enabled:this.anchor==="relative"}}}}})],ja.prototype,"anchorPosition",void 0),u([d({type:Number,json:{write:!0}})],ja.prototype,"heading",void 0),u([d({type:Number,json:{write:!0}})],ja.prototype,"tilt",void 0),u([d({type:Number,json:{write:!0}})],ja.prototype,"roll",void 0),u([d({readOnly:!0})],ja.prototype,"isPrimitive",null),ja=eX=u([$("esri.symbols.ObjectSymbol3DLayer")],ja);const qee=ja;var tX;let Pl=tX=class extends fg{constructor(e){super(e),this.material=null,this.castShadows=!0,this.type="path",this.profile="circle",this.join="miter",this.cap="butt",this.width=void 0,this.height=void 0,this.anchor="center",this.profileRotation="all"}readWidth(e,t){return e!=null?e:t.height==null&&t.size!=null?t.size:void 0}readHeight(e,t){return e!=null?e:t.width==null&&t.size!=null?t.size:void 0}clone(){return new tX({enabled:this.enabled,material:b(this.material)?this.material.clone():null,castShadows:this.castShadows,profile:this.profile,join:this.join,cap:this.cap,width:this.width,height:this.height,profileRotation:this.profileRotation,anchor:this.anchor})}};u([d({type:uh,json:{write:!0}})],Pl.prototype,"material",void 0),u([d({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],Pl.prototype,"castShadows",void 0),u([lt({Path:"path"},{readOnly:!0})],Pl.prototype,"type",void 0),u([d({type:["circle","quad"],json:{write:!0,default:"circle"}})],Pl.prototype,"profile",void 0),u([d({type:sxe,json:{write:!0,default:"miter"}})],Pl.prototype,"join",void 0),u([d({type:OBe,json:{write:!0,default:"butt"}})],Pl.prototype,"cap",void 0),u([d({type:Number,json:{write:{enabled:!0,target:{width:{type:Number},size:{type:Number}}}}})],Pl.prototype,"width",void 0),u([$e("width",["width","size","height"])],Pl.prototype,"readWidth",null),u([d({type:Number,json:{write:!0}})],Pl.prototype,"height",void 0),u([$e("height",["height","size","width"])],Pl.prototype,"readHeight",null),u([d({type:["center","bottom","top"],json:{write:!0,default:"center"}})],Pl.prototype,"anchor",void 0),u([d({type:["heading","all"],json:{write:!0,default:"all"}})],Pl.prototype,"profileRotation",void 0),Pl=tX=u([$("esri.symbols.PathSymbol3DLayer")],Pl);const Wee=Pl;var rX;let AE=rX=class extends ye{constructor(){super(...arguments),this.color=new Me([0,0,0,1]),this.size=0}clone(){const e={color:re(this.color),size:this.size};return new rX(e)}};u([d(E0)],AE.prototype,"color",void 0),u([d(Km)],AE.prototype,"size",void 0),AE=rX=u([$("esri.symbols.support.Symbol3DHalo")],AE);let W3=class extends au(ye){constructor(e){super(e),this.color=null}};u([d(E0)],W3.prototype,"color",void 0),W3=u([$("esri.symbols.support.Symbol3DTextBackground")],W3);var t5;let bc=t5=class extends fg{constructor(e){super(e),this._userSize=void 0,this.halo=null,this.horizontalAlignment="center",this.lineHeight=1,this.material=null,this.background=null,this.text=null,this.type="text",this.verticalAlignment="baseline"}get font(){return this._get("font")||null}set font(e){b(e)&&b(this._userSize)&&(e.size=this._userSize),this._set("font",e)}writeFont(e,t,r,i){const s={...i,textSymbol3D:!0};t.font=e.write({},s),delete t.font.size}get size(){return b(this._userSize)?this._userSize:b(this.font)&&this.font.size!=null?this.font.size:9}set size(e){this._userSize=e,b(this.font)&&(this.font.size=this._userSize),this.notifyChange("size")}clone(){const e=new t5({enabled:this.enabled,font:this.font&&re(this.font),halo:this.halo&&re(this.halo),horizontalAlignment:this.horizontalAlignment,lineHeight:this.lineHeight,material:b(this.material)?this.material.clone():null,text:this.text,verticalAlignment:this.verticalAlignment,background:re(this.background)});return e._userSize=this._userSize,e}static fromTextSymbol(e){return new t5({font:b(e.font)?e.font.clone():new h6,halo:GBe(e.haloColor,e.haloSize),horizontalAlignment:e.horizontalAlignment,lineHeight:e.lineHeight,material:e.color?new uh({color:e.color.clone()}):null,text:e.text,verticalAlignment:e.verticalAlignment,background:e.backgroundColor?new W3({color:e.backgroundColor.clone()}):null})}};function GBe(e,t){return e&&t>0?new AE({color:re(e),size:t}):null}u([d({type:h6,json:{write:!0}})],bc.prototype,"font",null),u([Xe("font")],bc.prototype,"writeFont",null),u([d({type:AE,json:{write:!0}})],bc.prototype,"halo",void 0),u([d({...oxe,json:{default:"center",write:!0}})],bc.prototype,"horizontalAlignment",void 0),u([d({...nxe,json:{default:1,write:!0}})],bc.prototype,"lineHeight",void 0),u([d({type:uh,json:{write:!0}})],bc.prototype,"material",void 0),u([d({type:W3,json:{write:!0}})],bc.prototype,"background",void 0),u([d(Km)],bc.prototype,"size",null),u([d({type:String,json:{write:!0}})],bc.prototype,"text",void 0),u([lt({Text:"text"},{readOnly:!0})],bc.prototype,"type",void 0),u([d({...axe,json:{default:"baseline",write:!0}})],bc.prototype,"verticalAlignment",void 0),bc=t5=u([$("esri.symbols.TextSymbol3DLayer")],bc);const ZT=bc;var iX;let Pv=iX=class extends fg{constructor(e){super(e),this.color=sX.clone(),this.type="water",this.waterbodySize="medium",this.waveDirection=null,this.waveStrength="moderate"}clone(){return new iX({color:re(this.color),waterbodySize:this.waterbodySize,waveDirection:this.waveDirection,waveStrength:this.waveStrength})}};u([d({type:Me,nonNullable:!0,json:{type:[Wi],write:(e,t,r)=>t[r]=e.toArray(Me.AlphaMode.UNLESS_OPAQUE),default:()=>sX.clone(),defaultEquals:e=>e.toCss(!0)===sX.toCss(!0)}})],Pv.prototype,"color",void 0),u([lt({Water:"water"},{readOnly:!0})],Pv.prototype,"type",void 0),u([d({type:["small","medium","large"],json:{write:!0,default:"medium"}})],Pv.prototype,"waterbodySize",void 0),u([d({type:Number,json:{write:!0,default:null}})],Pv.prototype,"waveDirection",void 0),u([d({type:["calm","rippled","slight","moderate"],json:{write:!0,default:"moderate"}})],Pv.prototype,"waveStrength",void 0),Pv=iX=u([$("esri.symbols.WaterSymbol3DLayer")],Pv);const sX=new Me([0,119,190]),hxe=Pv;var nX;let ow=nX=class extends xe{constructor(){super(...arguments),this.portal=null}clone(){return new nX({name:this.name,styleUrl:this.styleUrl,styleName:this.styleName,portal:this.portal})}};u([d({type:String})],ow.prototype,"name",void 0),u([d({type:String})],ow.prototype,"styleUrl",void 0),u([d({type:String})],ow.prototype,"styleName",void 0),u([d({type:Sn})],ow.prototype,"portal",void 0),ow=nX=u([$("esri.symbols.support.StyleOrigin")],ow);const dI=ow;var oX;let Fx=oX=class extends xe{clone(){return new oX({url:this.url})}};u([d({type:String})],Fx.prototype,"url",void 0),Fx=oX=u([$("esri.symbols.support.Thumbnail")],Fx);const dxe={icon:N_,object:qee,line:Z$,path:Wee,fill:u6,extrude:Gwe,text:ZT,water:hxe},jBe=ot.ofType({base:fg,key:"type",typeMap:dxe,errorContext:"symbol-layer"}),HBe=fe.getLogger("esri.symbols.Symbol3D");let rm=class extends lu{constructor(e){super(e),this.styleOrigin=null,this.thumbnail=null,this.type=null;const t=this.__accessor__&&this.__accessor__.metadatas&&this.__accessor__.metadatas.symbolLayers,r=t&&t.type||ot;this._set("symbolLayers",new r)}get color(){return null}set color(e){this.initialized&&HBe.error("Symbol3D does not support colors on the symbol level. Colors may be set on individual symbol layer materials instead.")}set symbolLayers(e){iT(e,this._get("symbolLayers"))}readStyleOrigin(e,t,r){if(e.styleUrl&&e.name){const i=d0(e.styleUrl,r);return new dI({styleUrl:i,name:e.name})}if(e.styleName&&e.name)return new dI({portal:r&&r.portal||Sn.getDefault(),styleName:e.styleName,name:e.name});r&&r.messages&&r.messages.push(new ic("symbol3d:incomplete-style-origin","Style origin requires either a 'styleUrl' or 'styleName' and a 'name' property",{context:r,definition:e}))}writeStyleOrigin(e,t,r,i){if(e.styleUrl&&e.name){let s=p0(e.styleUrl,i);Kc(s)&&(s=Id(s)),t.styleOrigin={styleUrl:s,name:e.name}}else e.styleName&&e.name&&(e.portal&&i&&i.portal&&!sbe(e.portal.restUrl,i.portal.restUrl)?i&&i.messages&&i.messages.push(new ic("symbol:cross-portal","The symbol style origin cannot be persisted because it refers to an item on a different portal than the one being saved to.",{symbol:this})):t.styleOrigin={styleName:e.styleName,name:e.name})}normalizeCtorArgs(e){return e instanceof fg||e&&dxe[e.type]?{symbolLayers:[e]}:Array.isArray(e)?{symbolLayers:e}:e}};u([d({json:{read:!1,write:!1}})],rm.prototype,"color",null),u([d({type:jBe,nonNullable:!0,json:{write:!0}}),qt(q1e)],rm.prototype,"symbolLayers",null),u([d({type:dI})],rm.prototype,"styleOrigin",void 0),u([$e("styleOrigin")],rm.prototype,"readStyleOrigin",null),u([Xe("styleOrigin",{"styleOrigin.styleUrl":{type:String},"styleOrigin.styleName":{type:String},"styleOrigin.name":{type:String}})],rm.prototype,"writeStyleOrigin",null),u([d({type:Fx,json:{read:!1}})],rm.prototype,"thumbnail",void 0),u([d({type:["point-3d","line-3d","polygon-3d","mesh-3d","label-3d"],readOnly:!0})],rm.prototype,"type",void 0),rm=u([$("esri.symbols.Symbol3D")],rm);const uR=rm;let PM=class extends ye{constructor(e){super(e),this.visible=!0}clone(){}};u([d({type:["line"],readOnly:!0,json:{read:!1,write:{ignoreOrigin:!0}}})],PM.prototype,"type",void 0),u([d({readOnly:!0})],PM.prototype,"visible",void 0),PM=u([$("esri.symbols.callouts.Callout3D")],PM);const pxe=PM;var aX;let r5=aX=class extends ye{constructor(){super(...arguments),this.color=new Me("white")}clone(){return new aX({color:re(this.color)})}};u([d(E0)],r5.prototype,"color",void 0),r5=aX=u([$("esri.symbols.callouts.LineCallout3DBorder")],r5);const fxe=r5;Object.freeze(Object.defineProperty({__proto__:null,default:fxe},Symbol.toStringTag,{value:"Module"}));var lX;let Iv=lX=class extends pxe{constructor(e){super(e),this.type="line",this.color=new Me([0,0,0,1]),this.size=ac(1),this.border=null}get visible(){return this.size>0&&b(this.color)&&this.color.a>0}clone(){return new lX({color:re(this.color),size:this.size,border:re(this.border)})}};u([lt({line:"line"},{readOnly:!0})],Iv.prototype,"type",void 0),u([d(E0)],Iv.prototype,"color",void 0),u([d(Km)],Iv.prototype,"size",void 0),u([d({type:fxe,json:{write:!0}})],Iv.prototype,"border",void 0),u([d({readOnly:!0})],Iv.prototype,"visible",null),Iv=lX=u([$("esri.symbols.callouts.LineCallout3D")],Iv);const qBe=Iv;function Xee(e){if(!e)return!1;const t=e.verticalOffset;return!!t&&!(t.screenLength<=0||t.maxWorldLength<=0)}function mxe(e){if(!e||!e.supportsCallout||!e.supportsCallout())return!1;const t=e.callout;return!!t&&!!t.visible&&!!Xee(e)}function Zee(e){return e.type==="point-3d"||e.type==="label-3d"}function gxe(e){return e.horizontalAlignment==="center"}const yxe={types:{key:"type",base:pxe,typeMap:{line:qBe}},json:{write:!0}};var cX;let Xw=cX=class extends ye{constructor(){super(...arguments),this.screenLength=0,this.minWorldLength=0}clone(){return new cX({screenLength:this.screenLength,minWorldLength:this.minWorldLength,maxWorldLength:this.maxWorldLength})}};u([d(Km)],Xw.prototype,"screenLength",void 0),u([d({type:Number,json:{write:!0,default:0}})],Xw.prototype,"minWorldLength",void 0),u([d({type:Number,json:{write:!0}})],Xw.prototype,"maxWorldLength",void 0),Xw=cX=u([$("esri.symbols.support.Symbol3DVerticalOffset")],Xw);var i5;const vxe=ot.ofType({base:null,key:"type",typeMap:{text:ZT}});let $v=i5=class extends uR{constructor(e){super(e),this.verticalOffset=null,this.callout=null,this.styleOrigin=null,this.symbolLayers=new vxe,this.type="label-3d"}supportsCallout(){return!0}hasVisibleCallout(){return mxe(this)}hasVisibleVerticalOffset(){return Xee(this)}clone(){return new i5({styleOrigin:re(this.styleOrigin),symbolLayers:re(this.symbolLayers),thumbnail:re(this.thumbnail),callout:re(this.callout),verticalOffset:re(this.verticalOffset)})}static fromTextSymbol(e){return new i5({symbolLayers:[ZT.fromTextSymbol(e)]})}};u([d({type:Xw,json:{write:!0}})],$v.prototype,"verticalOffset",void 0),u([d(yxe)],$v.prototype,"callout",void 0),u([d({json:{read:!1,write:!1}})],$v.prototype,"styleOrigin",void 0),u([d({type:vxe})],$v.prototype,"symbolLayers",void 0),u([lt({LabelSymbol3D:"label-3d"},{readOnly:!0})],$v.prototype,"type",void 0),$v=i5=u([$("esri.symbols.LabelSymbol3D")],$v);const p6=$v;var s5;const _xe=ot.ofType({base:null,key:"type",typeMap:{line:Z$,path:Wee}}),WBe=ot.ofType({base:null,key:"type",typeMap:{line:Z$,path:Wee}});let IM=s5=class extends uR{constructor(e){super(e),this.symbolLayers=new _xe,this.type="line-3d"}clone(){return new s5({styleOrigin:re(this.styleOrigin),symbolLayers:re(this.symbolLayers),thumbnail:re(this.thumbnail)})}static fromSimpleLineSymbol(e){return new s5({symbolLayers:[Z$.fromSimpleLineSymbol(e)]})}};u([d({type:_xe,json:{type:WBe}})],IM.prototype,"symbolLayers",void 0),u([lt({LineSymbol3D:"line-3d"},{readOnly:!0})],IM.prototype,"type",void 0),IM=s5=u([$("esri.symbols.LineSymbol3D")],IM);const f6=IM;let Lv=class extends lu{constructor(e){super(e),this.angle=0,this.type=null,this.xoffset=0,this.yoffset=0,this.size=9}hash(){return`${this.type}.${this.angle}.${this.size}.${this.xoffset}.${this.yoffset}`}};u([d({type:Number,json:{read:e=>e&&-1*e,write:(e,t)=>t.angle=e&&-1*e}})],Lv.prototype,"angle",void 0),u([d({type:["simple-marker","picture-marker"],readOnly:!0})],Lv.prototype,"type",void 0),u([d({type:Number,cast:si,json:{write:!0}})],Lv.prototype,"xoffset",void 0),u([d({type:Number,cast:si,json:{write:!0}})],Lv.prototype,"yoffset",void 0),u([d({type:Number,cast:e=>e==="auto"?e:si(e),json:{write:!0}})],Lv.prototype,"size",void 0),Lv=u([$("esri.symbols.MarkerSymbol")],Lv);const bxe=Lv;var uX;const wxe=ot.ofType({base:null,key:"type",typeMap:{fill:u6}});let $M=uX=class extends uR{constructor(e){super(e),this.symbolLayers=new wxe,this.type="mesh-3d"}clone(){return new uX({styleOrigin:re(this.styleOrigin),symbolLayers:re(this.symbolLayers),thumbnail:re(this.thumbnail)})}};u([d({type:wxe})],$M.prototype,"symbolLayers",void 0),u([lt({MeshSymbol3D:"mesh-3d"},{readOnly:!0})],$M.prototype,"type",void 0),$M=uX=u([$("esri.symbols.MeshSymbol3D")],$M);const Yee=$M;function XBe(e,t,r){return t.imageData?abe({mediaType:t.contentType||"image/png",isBase64:!0,data:t.imageData}):xxe(t.url,r)}function xxe(e,t){return YBe(t)&&!Kc(e)&&t.layer.parsedUrl?sc(t.layer.parsedUrl.path,"images",e):d0(e,t)}function ZBe(e,t,r,i){if(ug(e)){const s=Yz(e);t.contentType=s.mediaType,t.imageData=s.data,r&&r.imageData===t.imageData&&r.url&&R1(r.url,t,"url",i)}else R1(e,t,"url",i)}const Txe={json:{read:{source:["imageData","url"],reader:XBe},write:{writer(e,t,r,i){ZBe(e,t,this.source,i)}}}},Sxe={readOnly:!0,json:{read:{source:["imageData","url"],reader(e,t,r){const i={};return t.imageData&&(i.imageData=t.imageData),t.contentType&&(i.contentType=t.contentType),t.url&&(i.url=xxe(t.url,r)),i}}}};function YBe(e){return e&&(e.origin==="service"||e.origin==="portal-item")&&e.layer&&(e.layer.type==="feature"||e.layer.type==="stream")}var hX;let Xh=hX=class extends Hwe{constructor(...e){super(...e),this.type="picture-fill",this.url=null,this.xscale=1,this.yscale=1,this.width=12,this.height=12,this.xoffset=0,this.yoffset=0,this.source=null}normalizeCtorArgs(e,t,r,i){if(e&&typeof e!="string"&&e.imageData==null)return e;const s={};return e&&(s.url=e),t&&(s.outline=t),r!=null&&(s.width=si(r)),i!=null&&(s.height=si(i)),s}clone(){const e=new hX({color:re(this.color),height:this.height,outline:this.outline&&this.outline.clone(),url:this.url,width:this.width,xoffset:this.xoffset,xscale:this.xscale,yoffset:this.yoffset,yscale:this.yscale});return e._set("source",re(this.source)),e}hash(){var e;return`${super.hash()}.${(e=this.color)==null?void 0:e.hash()}.${this.height}.${this.url}.${this.width}.${this.xoffset}.${this.xscale}.${this.yoffset}.${this.yscale}`}};u([lt({esriPFS:"picture-fill"},{readOnly:!0})],Xh.prototype,"type",void 0),u([d(Txe)],Xh.prototype,"url",void 0),u([d({type:Number,json:{write:!0}})],Xh.prototype,"xscale",void 0),u([d({type:Number,json:{write:!0}})],Xh.prototype,"yscale",void 0),u([d({type:Number,cast:si,json:{write:!0}})],Xh.prototype,"width",void 0),u([d({type:Number,cast:si,json:{write:!0}})],Xh.prototype,"height",void 0),u([d({type:Number,cast:si,json:{write:!0}})],Xh.prototype,"xoffset",void 0),u([d({type:Number,cast:si,json:{write:!0}})],Xh.prototype,"yoffset",void 0),u([d(Sxe)],Xh.prototype,"source",void 0),Xh=hX=u([$("esri.symbols.PictureFillSymbol")],Xh);const Exe=Xh;var dX;let mp=dX=class extends bxe{constructor(...e){super(...e),this.color=null,this.type="picture-marker",this.url=null,this.source=null,this.height=12,this.width=12,this.size=null}normalizeCtorArgs(e,t,r){if(e&&typeof e!="string"&&e.imageData==null)return e;const i={};return e&&(i.url=e),t!=null&&(i.width=si(t)),r!=null&&(i.height=si(r)),i}readHeight(e,t){return t.size||e}readWidth(e,t){return t.size||e}clone(){const e=new dX({angle:this.angle,height:this.height,url:this.url,width:this.width,xoffset:this.xoffset,yoffset:this.yoffset});return e._set("source",re(this.source)),e}hash(){return`${super.hash()}.${this.height}.${this.url}.${this.width}`}};u([d({json:{write:!1}})],mp.prototype,"color",void 0),u([lt({esriPMS:"picture-marker"},{readOnly:!0})],mp.prototype,"type",void 0),u([d(Txe)],mp.prototype,"url",void 0),u([d(Sxe)],mp.prototype,"source",void 0),u([d({type:Number,cast:si,json:{write:!0}})],mp.prototype,"height",void 0),u([$e("height",["height","size"])],mp.prototype,"readHeight",null),u([d({type:Number,cast:si,json:{write:!0}})],mp.prototype,"width",void 0),u([d({json:{write:!1}})],mp.prototype,"size",void 0),mp=dX=u([$("esri.symbols.PictureMarkerSymbol")],mp);const m6=mp;var Dv;const Cxe=ot.ofType({base:null,key:"type",typeMap:{icon:N_,object:qee,text:ZT}});let aw=Dv=class extends uR{constructor(e){super(e),this.verticalOffset=null,this.callout=null,this.symbolLayers=new Cxe,this.type="point-3d"}supportsCallout(){if((this.symbolLayers?this.symbolLayers.length:0)<1)return!1;for(const e of this.symbolLayers.items)switch(e.type){case"icon":case"text":case"object":continue;default:return!1}return!0}hasVisibleCallout(){return mxe(this)}hasVisibleVerticalOffset(){return Xee(this)}clone(){return new Dv({verticalOffset:re(this.verticalOffset),callout:re(this.callout),styleOrigin:re(this.styleOrigin),symbolLayers:re(this.symbolLayers),thumbnail:re(this.thumbnail)})}static fromSimpleMarkerSymbol(e){return new Dv({symbolLayers:[N_.fromSimpleMarkerSymbol(e)]})}static fromPictureMarkerSymbol(e){return new Dv({symbolLayers:[N_.fromPictureMarkerSymbol(e)]})}static fromCIMSymbol(e){var r,i;return((i=(r=e.data)==null?void 0:r.symbol)==null?void 0:i.type)!=="CIMPointSymbol"?null:e.data.symbol.callout?new Dv({symbolLayers:[N_.fromCIMSymbol(e)],callout:{type:"line",size:.5,color:[0,0,0]},verticalOffset:{screenLength:40}}):new Dv({symbolLayers:[N_.fromCIMSymbol(e)]})}static fromTextSymbol(e){return new Dv({symbolLayers:[ZT.fromTextSymbol(e)]})}};u([d({type:Xw,json:{write:!0}})],aw.prototype,"verticalOffset",void 0),u([d(yxe)],aw.prototype,"callout",void 0),u([d({type:Cxe,json:{origins:{"web-scene":{write:!0}}}})],aw.prototype,"symbolLayers",void 0),u([lt({PointSymbol3D:"point-3d"},{readOnly:!0})],aw.prototype,"type",void 0),aw=Dv=u([$("esri.symbols.PointSymbol3D")],aw);const F_=aw;var LM;const Axe=ot.ofType({base:null,key:"type",typeMap:{extrude:Gwe,fill:u6,icon:N_,line:Z$,object:qee,text:ZT,water:hxe}});let DM=LM=class extends uR{constructor(e){super(e),this.symbolLayers=new Axe,this.type="polygon-3d"}clone(){return new LM({styleOrigin:re(this.styleOrigin),symbolLayers:re(this.symbolLayers),thumbnail:re(this.thumbnail)})}static fromJSON(e){const t=new LM;if(t.read(e),t.symbolLayers.length===2&&t.symbolLayers.getItemAt(0).type==="fill"&&t.symbolLayers.getItemAt(1).type==="line"){const r=t.symbolLayers.getItemAt(0),i=t.symbolLayers.getItemAt(1);!i.enabled||e.symbolLayers&&e.symbolLayers[1]&&e.symbolLayers[1].enable===!1||(r.outline={size:i.size,color:b(i.material)?i.material.color:null}),t.symbolLayers.removeAt(1)}return t}static fromSimpleFillSymbol(e){return new LM({symbolLayers:[u6.fromSimpleFillSymbol(e)]})}};u([d({type:Axe,json:{write:!0}})],DM.prototype,"symbolLayers",void 0),u([lt({PolygonSymbol3D:"polygon-3d"},{readOnly:!0})],DM.prototype,"type",void 0),DM=LM=u([$("esri.symbols.PolygonSymbol3D")],DM);const Y$=DM;var pX;const H9=new Tr({esriSFSSolid:"solid",esriSFSNull:"none",esriSFSHorizontal:"horizontal",esriSFSVertical:"vertical",esriSFSForwardDiagonal:"forward-diagonal",esriSFSBackwardDiagonal:"backward-diagonal",esriSFSCross:"cross",esriSFSDiagonalCross:"diagonal-cross"});let lw=pX=class extends Hwe{constructor(...e){super(...e),this.color=new Me([0,0,0,.25]),this.outline=new cu,this.type="simple-fill",this.style="solid"}normalizeCtorArgs(e,t,r){if(e&&typeof e!="string")return e;const i={};return e&&(i.style=e),t&&(i.outline=t),r&&(i.color=r),i}clone(){return new pX({color:re(this.color),outline:this.outline&&this.outline.clone(),style:this.style})}hash(){return`${super.hash()}${this.style}.${this.color&&this.color.hash()}`}};u([d()],lw.prototype,"color",void 0),u([d()],lw.prototype,"outline",void 0),u([lt({esriSFS:"simple-fill"},{readOnly:!0})],lw.prototype,"type",void 0),u([d({type:H9.apiValues,json:{read:H9.read,write:H9.write}})],lw.prototype,"style",void 0),lw=pX=u([$("esri.symbols.SimpleFillSymbol")],lw);const mg=lw;var fX;const q9=new Tr({esriSMSCircle:"circle",esriSMSSquare:"square",esriSMSCross:"cross",esriSMSX:"x",esriSMSDiamond:"diamond",esriSMSTriangle:"triangle",esriSMSPath:"path"});let im=fX=class extends bxe{constructor(...e){super(...e),this.color=new Me([255,255,255,.25]),this.type="simple-marker",this.size=12,this.style="circle",this.outline=new cu}normalizeCtorArgs(e,t,r,i){if(e&&typeof e!="string")return e;const s={};return e&&(s.style=e),t!=null&&(s.size=si(t)),r&&(s.outline=r),i&&(s.color=i),s}writeColor(e,t){e&&this.style!=="x"&&this.style!=="cross"&&(t.color=e.toJSON()),e===null&&(t.color=null)}set path(e){this.style="path",this._set("path",e)}clone(){return new fX({angle:this.angle,color:re(this.color),outline:this.outline&&this.outline.clone(),path:this.path,size:this.size,style:this.style,xoffset:this.xoffset,yoffset:this.yoffset})}hash(){var e;return`${super.hash()}.${this.color&&this.color.hash()}.${this.path}.${this.style}.${(e=this.outline)==null?void 0:e.hash()}`}};u([d()],im.prototype,"color",void 0),u([Xe("color")],im.prototype,"writeColor",null),u([lt({esriSMS:"simple-marker"},{readOnly:!0})],im.prototype,"type",void 0),u([d()],im.prototype,"size",void 0),u([d({type:q9.apiValues,json:{read:q9.read,write:q9.write}})],im.prototype,"style",void 0),u([d({type:String,json:{write:!0}})],im.prototype,"path",null),u([d({types:{key:"type",base:null,defaultKeyValue:"simple-line",typeMap:{"simple-line":cu}},json:{default:null,write:!0}})],im.prototype,"outline",void 0),im=fX=u([$("esri.symbols.SimpleMarkerSymbol")],im);const eu=im;var mX;let gs=mX=class extends lu{constructor(...e){super(...e),this.backgroundColor=null,this.borderLineColor=null,this.borderLineSize=null,this.font=new h6,this.horizontalAlignment="center",this.kerning=!0,this.haloColor=null,this.haloSize=null,this.rightToLeft=null,this.rotated=!1,this.text="",this.type="text",this.verticalAlignment="baseline",this.xoffset=0,this.yoffset=0,this.angle=0,this.width=null,this.lineWidth=192,this.lineHeight=1}normalizeCtorArgs(e,t,r){if(e&&typeof e!="string")return e;const i={};return e&&(i.text=e),t&&(i.font=t),r&&(i.color=r),i}writeLineWidth(e,t,r,i){i&&typeof i!="string"?i.origin:t[r]=e}castLineWidth(e){return si(e)}writeLineHeight(e,t,r,i){i&&typeof i!="string"?i.origin:t[r]=e}clone(){return new mX({angle:this.angle,backgroundColor:re(this.backgroundColor),borderLineColor:re(this.borderLineColor),borderLineSize:this.borderLineSize,color:re(this.color),font:this.font&&this.font.clone(),haloColor:re(this.haloColor),haloSize:this.haloSize,horizontalAlignment:this.horizontalAlignment,kerning:this.kerning,lineHeight:this.lineHeight,lineWidth:this.lineWidth,rightToLeft:this.rightToLeft,rotated:this.rotated,text:this.text,verticalAlignment:this.verticalAlignment,width:this.width,xoffset:this.xoffset,yoffset:this.yoffset})}hash(){return`${this.backgroundColor&&this.backgroundColor.hash()}.${this.borderLineColor}.${this.borderLineSize}.${this.color.hash()}.${this.font&&this.font.hash()}.${this.haloColor&&this.haloColor.hash()}.${this.haloSize}.${this.horizontalAlignment}.${this.kerning}.${this.rightToLeft}.${this.rotated}.${this.text}.${this.verticalAlignment}.${this.width}.${this.xoffset}.${this.yoffset}.${this.lineHeight}.${this.lineWidth}.${this.angle}`}};u([d({type:Me,json:{write:!0}})],gs.prototype,"backgroundColor",void 0),u([d({type:Me,json:{write:!0}})],gs.prototype,"borderLineColor",void 0),u([d({type:Number,json:{write:!0}})],gs.prototype,"borderLineSize",void 0),u([d({type:h6,json:{write:!0}})],gs.prototype,"font",void 0),u([d({...oxe,json:{write:!0}})],gs.prototype,"horizontalAlignment",void 0),u([d({type:Boolean,json:{write:!0}})],gs.prototype,"kerning",void 0),u([d({type:Me,json:{write:!0}})],gs.prototype,"haloColor",void 0),u([d({type:Number,cast:si,json:{write:!0}})],gs.prototype,"haloSize",void 0),u([d({type:Boolean,json:{write:!0}})],gs.prototype,"rightToLeft",void 0),u([d({type:Boolean,json:{write:!0}})],gs.prototype,"rotated",void 0),u([d({type:String,json:{write:!0}})],gs.prototype,"text",void 0),u([lt({esriTS:"text"},{readOnly:!0})],gs.prototype,"type",void 0),u([d({...axe,json:{write:!0}})],gs.prototype,"verticalAlignment",void 0),u([d({type:Number,cast:si,json:{write:!0}})],gs.prototype,"xoffset",void 0),u([d({type:Number,cast:si,json:{write:!0}})],gs.prototype,"yoffset",void 0),u([d({type:Number,json:{read:e=>e&&-1*e,write:(e,t)=>t.angle=e&&-1*e}})],gs.prototype,"angle",void 0),u([d({type:Number,json:{write:!0}})],gs.prototype,"width",void 0),u([d({type:Number})],gs.prototype,"lineWidth",void 0),u([Xe("lineWidth")],gs.prototype,"writeLineWidth",null),u([qt("lineWidth")],gs.prototype,"castLineWidth",null),u([d(nxe)],gs.prototype,"lineHeight",void 0),u([Xe("lineHeight")],gs.prototype,"writeLineHeight",null),gs=mX=u([$("esri.symbols.TextSymbol")],gs);const hR=gs;var gX;const QBe=fe.getLogger("esri.symbols.WebStyleSymbol");let gp=gX=class extends lu{constructor(e){super(e),this.styleName=null,this.portal=null,this.styleUrl=null,this.thumbnail=null,this.name=null,this.type="web-style"}get fetchCacheKey(){const e=b(this.portal)?this.portal:Sn.getDefault(),t=e.user?e.user.username:null;return`${this.styleName}:${this.styleUrl}:${this.name}:${t}:${e.url}`}read(e,t){this.portal=t?t.portal:void 0,super.read(e,t)}clone(){return new gX({name:this.name,styleUrl:this.styleUrl,styleName:this.styleName,portal:this.portal})}fetchSymbol(e){return this._fetchSymbol("webRef",e)}fetchCIMSymbol(e){return this._fetchSymbol("cimRef",e)}async _fetchSymbol(e,t){const r=b(t)?t.cache:null,i=r?this.fetchCacheKey:null;if(b(r)){const a=r.get(i);if(a)return a.clone()}const s=await JBe();Jt(t);const n=s.resolveWebStyleSymbol(this,{portal:this.portal},e,t);n.catch(a=>{QBe.error("#fetchSymbol()","Failed to create symbol from style",a)});const o=await n;return e==="webRef"&&o.type==="point-3d"||e==="cimRef"&&o.type==="cim"?(b(r)&&r.set(i,o.clone()),o):null}};function JBe(){return ie(()=>Promise.resolve().then(()=>TMt),void 0,import.meta.url)}u([d({json:{write:!1}})],gp.prototype,"color",void 0),u([d({type:String,json:{write:!0}})],gp.prototype,"styleName",void 0),u([d({type:Sn,json:{write:!1}})],gp.prototype,"portal",void 0),u([d({type:String,json:{read:d6,write:R1}})],gp.prototype,"styleUrl",void 0),u([d({type:Fx,json:{read:!1}})],gp.prototype,"thumbnail",void 0),u([d({type:String,json:{write:!0}})],gp.prototype,"name",void 0),u([lt({styleSymbolReference:"web-style"},{readOnly:!0})],gp.prototype,"type",void 0),u([d()],gp.prototype,"fetchCacheKey",null),gp=gX=u([$("esri.symbols.WebStyleSymbol")],gp);const YT=gp;function g6(e){if(!e)return!1;switch(e.type){case"picture-fill":case"picture-marker":case"simple-fill":case"simple-line":case"simple-marker":case"text":case"cim":return!0;default:return!1}}function tg(e){if(!e)return!1;switch(e.type){case"label-3d":case"line-3d":case"mesh-3d":case"point-3d":case"polygon-3d":return!0;default:return!1}}const kx={base:lu,key:"type",typeMap:{"simple-fill":mg,"picture-fill":Exe,"picture-marker":m6,"simple-line":cu,"simple-marker":eu,text:hR,"label-3d":p6,"line-3d":f6,"mesh-3d":Yee,"point-3d":F_,"polygon-3d":Y$,"web-style":YT,cim:cR},errorContext:"symbol"},KBe={base:lu,key:"type",typeMap:{"picture-marker":m6,"simple-marker":eu,text:hR,"web-style":YT,cim:cR},errorContext:"symbol"},e8e=sR({types:kx}),Rxe={base:lu,key:"type",typeMap:{"simple-fill":mg,"picture-fill":Exe,"picture-marker":m6,"simple-line":cu,"simple-marker":eu,text:hR,"line-3d":f6,"mesh-3d":Yee,"point-3d":F_,"polygon-3d":Y$,"web-style":YT,cim:cR},errorContext:"symbol"},t8e={base:lu,key:"type",typeMap:{text:hR,"label-3d":p6},errorContext:"symbol"},ile={base:lu,key:"type",typeMap:{"line-3d":f6,"mesh-3d":Yee,"point-3d":F_,"polygon-3d":Y$,"web-style":YT,cim:cR},errorContext:"symbol"},r8e={base:lu,key:"type",typeMap:{"label-3d":p6},errorContext:"symbol"},Oxe=_f(kx);function i8e(e){if(!e)return null;const t={};for(const r in e){const i=u0(e[r]);i&&(t[r]=i)}return Object.keys(t).length!==0?t:null}function s8e(e){if(!b(e))return null;const t={};for(const r in e){const i=e[r];i&&(t[r]=i.toJSON())}return Object.keys(t).length!==0?t:null}let wc=class extends au(ye){constructor(...e){super(...e),this.isAggregate=!1,this.layer=null,this.popupTemplate=null,this.sourceLayer=null,Object.defineProperty(this,"uid",{value:Jl(),configurable:!0})}normalizeCtorArgs(e,t,r,i){return e&&!e.declaredClass?e:{geometry:e,symbol:t,attributes:r,popupTemplate:i}}set aggregateGeometries(e){const t=this._get("aggregateGeometries");JSON.stringify(t)!==JSON.stringify(e)&&this._set("aggregateGeometries",e)}set attributes(e){const t=this._get("attributes");t!==e&&(this._set("attributes",e),this._notifyLayer("attributes",t,e))}set geometry(e){const t=this._get("geometry");t!==e&&(this._set("geometry",e),this._notifyLayer("geometry",t,e))}set symbol(e){const t=this._get("symbol");t!==e&&(this._set("symbol",e),this._notifyLayer("symbol",t,e))}set visible(e){const t=this._get("visible");t!==e&&(this._set("visible",e),this._notifyLayer("visible",t,e))}getEffectivePopupTemplate(e=!1){if(this.popupTemplate)return this.popupTemplate;for(const t of[this.sourceLayer,this.layer])if(t){if("popupTemplate"in t&&t.popupTemplate)return t.popupTemplate;if(e&&"defaultPopupTemplate"in t&&b(t.defaultPopupTemplate))return t.defaultPopupTemplate}return null}getAttribute(e){return this.attributes&&this.attributes[e]}setAttribute(e,t){if(this.attributes){const r=this.getAttribute(e);this.attributes[e]=t,this._notifyLayer("attributes",r,t,e)}else this.attributes={[e]:t},this._notifyLayer("attributes",void 0,t,e)}getObjectId(){return this.sourceLayer&&"objectIdField"in this.sourceLayer&&this.sourceLayer.objectIdField?this.getAttribute(this.sourceLayer.objectIdField):null}toJSON(){return{aggregateGeometries:s8e(this.aggregateGeometries),geometry:b(this.geometry)?this.geometry.toJSON():null,symbol:b(this.symbol)?this.symbol.toJSON():null,attributes:{...this.attributes},popupTemplate:this.popupTemplate&&this.popupTemplate.toJSON()}}notifyGeometryChanged(){this._notifyLayer("geometry",this.geometry,this.geometry)}notifyMeshTransformChanged(){b(this.geometry)&&this.geometry.type==="mesh"&&this._notifyLayer("transform",this.geometry.transform,this.geometry.transform)}_notifyLayer(e,t,r,i){if(!this.layer||!("graphicChanged"in this.layer))return;const s={graphic:this,property:e,oldValue:t,newValue:r};e==="attributes"&&(s.attributeName=i),this.layer.graphicChanged(s)}};u([d({value:null,json:{read:i8e}})],wc.prototype,"aggregateGeometries",null),u([d({value:null})],wc.prototype,"attributes",null),u([d({value:null,types:jT,json:{read:u0}})],wc.prototype,"geometry",null),u([d({type:Boolean})],wc.prototype,"isAggregate",void 0),u([d({clonable:"reference"})],wc.prototype,"layer",void 0),u([d({type:qT})],wc.prototype,"popupTemplate",void 0),u([d({clonable:"reference"})],wc.prototype,"sourceLayer",void 0),u([d({value:null,types:kx})],wc.prototype,"symbol",null),u([d({type:Boolean,value:!0})],wc.prototype,"visible",null),wc=u([$("esri.Graphic")],wc),function(e){e.generateUID=Jl}(wc||(wc={}));const gl=wc;var yX;let Nv=yX=class extends ye{constructor(e){super(e),this.rotation=0,this.scale=0,this.targetGeometry=null,this.camera=null}castRotation(e){return(e%=360)<0&&(e+=360),e}clone(){return new yX({rotation:this.rotation,scale:this.scale,targetGeometry:b(this.targetGeometry)?this.targetGeometry.clone():null,camera:b(this.camera)?this.camera.clone():null})}};function W9(){return{enabled:!this.camera}}u([d({type:Number,json:{write:!0,origins:{"web-map":{default:0,write:!0},"web-scene":{write:{overridePolicy:W9}}}}})],Nv.prototype,"rotation",void 0),u([qt("rotation")],Nv.prototype,"castRotation",null),u([d({type:Number,json:{write:!0,origins:{"web-map":{default:0,write:!0},"web-scene":{write:{overridePolicy:W9}}}}})],Nv.prototype,"scale",void 0),u([d({types:jT,json:{read:u0,write:!0,origins:{"web-scene":{read:u0,write:{overridePolicy:W9}}}}})],Nv.prototype,"targetGeometry",void 0),u([d({type:ou,json:{write:!0}})],Nv.prototype,"camera",void 0),Nv=yX=u([$("esri.Viewpoint")],Nv);const Vd=Nv;function y6(e){return typeof e=="string"?document.getElementById(e):e}function Mxe(e){for(;e.hasChildNodes();)e.removeChild(e.firstChild)}function sle(e,t){const r=t.parentNode;r&&r.insertBefore(e,t)}function nle(e,t){for(;;){const r=e.firstChild;if(!r)break;t.appendChild(r)}}class vX{constructor(t=r=>r.values().next().value){this._peeker=t,this._items=new Set}get length(){return this._items.size}clear(){this._items.clear()}last(){if(this._items.size===0)return;let t;for(t of this._items);return t}peek(){if(this._items.size!==0)return this._peeker(this._items)}push(t){this.contains(t)||this._items.add(t)}contains(t){return this._items.has(t)}pop(){if(this.length===0)return;const t=this.peek();return this._items.delete(t),t}popLast(){if(this.length===0)return;const t=this.last();return this._items.delete(t),t}remove(t){this._items.delete(t)}filter(t){return this._items.forEach(r=>{t(r)||this._items.delete(r)}),this}}var Kl;(function(e){e[e.HANDSHAKE=0]="HANDSHAKE",e[e.OPEN=1]="OPEN",e[e.OPENED=2]="OPENED",e[e.RESPONSE=3]="RESPONSE",e[e.INVOKE=4]="INVOKE",e[e.ABORT=5]="ABORT",e[e.CLOSE=6]="CLOSE",e[e.OPEN_PORT=7]="OPEN_PORT",e[e.ON=8]="ON"})(Kl||(Kl={}));let n8e=0;function Pxe(){return n8e++}function o8e(e){return e&&typeof e=="object"&&("result"in e||"transferList"in e)}function PU(e){return e?typeof e=="string"?JSON.stringify({name:"message",message:e}):e.toJSON?JSON.stringify(e):JSON.stringify({name:e.name,message:e.message,details:e.details||{stack:e.stack}}):null}function Ixe(e,t,r,i){if(t.type===Kl.OPEN_PORT)return void e.postMessage(t,[t.port]);if(t.type!==Kl.INVOKE&&t.type!==Kl.RESPONSE)return void e.postMessage(t);let s;o8e(r)?(s=ole(r.transferList),t.data=r.result):(s=ole(i),t.data=r),s?e.postMessage(t,s):e.postMessage(t)}function pI(e){if(!e)return null;const t=e.data;return t?typeof t=="string"?JSON.parse(t):t:null}function ole(e){if(!e||!e.length)return null;if(he("esri-workers-arraybuffer-transfer"))return e;const t=e.filter(r=>!a8e(r));return t.length?t:null}function a8e(e){return e instanceof ArrayBuffer||e&&e.constructor&&e.constructor.name==="ArrayBuffer"}const l8e={statsWorker:()=>ie(()=>import("./statsWorker.d92b66a5.js"),["statsWorker.d92b66a5.js","utils.5e3fd577.js","ClassBreaksDefinition.c5cbbd6d.js"],import.meta.url),geometryEngineWorker:()=>ie(()=>import("./geometryEngineWorker.06591522.js"),["geometryEngineWorker.06591522.js","geometryEngineJSON.5a1f200e.js","geometryEngineBase.0f0d7ecf.js","json.8bd707cf.js"],import.meta.url),CSVSourceWorker:()=>ie(()=>import("./CSVSourceWorker.e43519c7.js"),["CSVSourceWorker.e43519c7.js","json.8bd707cf.js","FeatureStore.4f146d77.js","PooledRBush.240e2876.js","quickselect.bb286034.js","optimizedFeatureQueryEngineAdapter.ccd4095f.js","centroid.b6fe1cdb.js","QueryEngineResult.9885fa73.js","WhereClause.c395dc79.js","utils.5e3fd577.js","ClassBreaksDefinition.c5cbbd6d.js","QueryEngine.b68da516.js"],import.meta.url),EdgeProcessingWorker:()=>ie(()=>Promise.resolve().then(()=>zCt),void 0,import.meta.url),ElevationSamplerWorker:()=>ie(()=>import("./ElevationSamplerWorker.917e3f94.js"),["ElevationSamplerWorker.917e3f94.js","PooledRBush.240e2876.js","quickselect.bb286034.js","georeference.7d411cd4.js"],import.meta.url),FeatureServiceSnappingSourceWorker:()=>ie(()=>import("./FeatureServiceSnappingSourceWorker.0935cd1a.js"),["FeatureServiceSnappingSourceWorker.0935cd1a.js","FeatureStore.4f146d77.js","PooledRBush.240e2876.js","quickselect.bb286034.js","optimizedFeatureQueryEngineAdapter.ccd4095f.js","centroid.b6fe1cdb.js","QueryEngine.b68da516.js","QueryEngineResult.9885fa73.js","WhereClause.c395dc79.js","utils.5e3fd577.js","ClassBreaksDefinition.c5cbbd6d.js","json.8bd707cf.js"],import.meta.url),GeoJSONSourceWorker:()=>ie(()=>import("./GeoJSONSourceWorker.c583b722.js"),["GeoJSONSourceWorker.c583b722.js","FeatureStore.4f146d77.js","PooledRBush.240e2876.js","quickselect.bb286034.js","optimizedFeatureQueryEngineAdapter.ccd4095f.js","centroid.b6fe1cdb.js","QueryEngineResult.9885fa73.js","WhereClause.c395dc79.js","utils.5e3fd577.js","ClassBreaksDefinition.c5cbbd6d.js","json.8bd707cf.js","QueryEngine.b68da516.js","geojson.06a0f01a.js","sourceUtils.419de772.js"],import.meta.url),LercWorker:()=>ie(()=>import("./LercWorker.7048ab2d.js"),[],import.meta.url),MemorySourceWorker:()=>ie(()=>import("./MemorySourceWorker.f2caa51f.js"),["MemorySourceWorker.f2caa51f.js","objectIdUtils.5d771dff.js","FeatureStore.4f146d77.js","PooledRBush.240e2876.js","quickselect.bb286034.js","optimizedFeatureQueryEngineAdapter.ccd4095f.js","centroid.b6fe1cdb.js","QueryEngineResult.9885fa73.js","WhereClause.c395dc79.js","utils.5e3fd577.js","ClassBreaksDefinition.c5cbbd6d.js","json.8bd707cf.js","QueryEngine.b68da516.js","sourceUtils.419de772.js"],import.meta.url),PBFDecoderWorker:()=>ie(()=>import("./PBFDecoderWorker.2b9619d2.js"),[],import.meta.url),Pipeline:()=>ie(()=>import("./Pipeline.0dc38ec9.js").then(e=>e.P),["Pipeline.0dc38ec9.js","QueryEngine.b68da516.js","QueryEngineResult.9885fa73.js","WhereClause.c395dc79.js","utils.5e3fd577.js","ClassBreaksDefinition.c5cbbd6d.js","json.8bd707cf.js","createConnection.b247cd1a.js","quickselect.bb286034.js","centroid.b6fe1cdb.js","ogcFeatureUtils.4629e4c7.js","geojson.06a0f01a.js","enums.4de5fe56.js","Utils.34c984b0.js","number.6e30c64a.js"],import.meta.url),PointCloudWorker:()=>ie(()=>import("./PointCloudWorker.9ab8b541.js"),["PointCloudWorker.9ab8b541.js","PointCloudWorkerUtil.18a1e061.js","PointCloudUniqueValueRenderer.5b4c7434.js"],import.meta.url),RasterWorker:()=>ie(()=>import("./RasterWorker.f7431a15.js"),["RasterWorker.f7431a15.js","PixelBlock.a3ab9bb3.js","dataUtils.d0b1523a.js","rasterProjectionHelper.636b7cf7.js","utils.97f4f99c.js"],import.meta.url),SceneLayerSnappingSourceWorker:()=>ie(()=>import("./SceneLayerSnappingSourceWorker.08a81aac.js"),["SceneLayerSnappingSourceWorker.08a81aac.js","QueryEngineResult.9885fa73.js","WhereClause.c395dc79.js","utils.5e3fd577.js","ClassBreaksDefinition.c5cbbd6d.js","json.8bd707cf.js"],import.meta.url),SceneLayerWorker:()=>ie(()=>import("./SceneLayerWorker.cb4f9617.js").then(e=>e.S),["SceneLayerWorker.cb4f9617.js","I3SNode.08c44e8c.js"],import.meta.url),WFSSourceWorker:()=>ie(()=>import("./WFSSourceWorker.bbd2c466.js"),["WFSSourceWorker.bbd2c466.js","FeatureStore.4f146d77.js","PooledRBush.240e2876.js","quickselect.bb286034.js","optimizedFeatureQueryEngineAdapter.ccd4095f.js","centroid.b6fe1cdb.js","QueryEngineResult.9885fa73.js","WhereClause.c395dc79.js","utils.5e3fd577.js","ClassBreaksDefinition.c5cbbd6d.js","json.8bd707cf.js","QueryEngine.b68da516.js","geojson.06a0f01a.js","sourceUtils.419de772.js","wfsUtils.d493fd07.js","xmlUtils.fe1322c5.js"],import.meta.url),WorkerTileHandler:()=>ie(()=>import("./WorkerTileHandler.c334729a.js"),["WorkerTileHandler.c334729a.js","StyleRepository.759ba6c0.js","enums.4de5fe56.js","Geometry.f2d62961.js","GeometryUtils.2547656a.js","TileClipper.88ed37ba.js","BidiEngine.210f7ff8.js"],import.meta.url)},{CLOSE:ale,ABORT:lle,INVOKE:cle,RESPONSE:YR,OPEN_PORT:ule,ON:c8e}=Kl,u8e=2;class h8e{constructor(t){this._timer=null,this._cancelledJobIds=new Set,this._invokeMessages=[],this._invoke=t,this._timer=null,this._process=this._process.bind(this)}push(t){t.type===Kl.ABORT?this._cancelledJobIds.add(t.jobId):(this._invokeMessages.push(t),this._timer===null&&(this._timer=setTimeout(this._process,0)))}clear(){this._invokeMessages.length=0,this._cancelledJobIds.clear(),this._timer=null}_process(){this._timer=null;for(const t of this._invokeMessages)this._cancelledJobIds.has(t.jobId)||this._invoke(t);this._cancelledJobIds.clear(),this._invokeMessages.length=0}}class zc{constructor(t,r,i){this._port=t,this._getNextJob=i,this._outJobs=new Map,this._inJobs=new Map,this._invokeQueue=new h8e(s=>this._onInvokeMessage(s)),this._client=r.client,this._onMessage=this._onMessage.bind(this),this._channel=r.channel,this._schedule=r.schedule,this._port.addEventListener("message",this._onMessage),this._port.start()}static connect(t){const r=new MessageChannel;let i;i=typeof t=="function"?new t:"default"in t&&typeof t.default=="function"?new t.default:t;const s=new zc(r.port1,{channel:r,client:i},()=>null);return typeof i=="object"&&"remoteClient"in i&&(i.remoteClient=s),zc.clients.set(s,i),r.port2}static loadWorker(t){const r=l8e[t];return r?r():Promise.resolve(null)}close(){this._post({type:ale}),this._close()}isBusy(){return this._outJobs.size>0}invoke(t,r,i){const s=i&&i.signal,n=i&&i.transferList;if(!this._port)return Promise.reject(new j("worker:port-closed",`Cannot call invoke('${t}'), port is closed`,{methodName:t,data:r}));const o=Pxe();return new Promise((a,l)=>{if(gn(s))return this._processWork(),void l(gr());const c=Ia(s,()=>{const p=this._outJobs.get(o);p&&(this._outJobs.delete(o),this._processWork(),wn(p.abortHandle),this._post({type:lle,jobId:o}),l(gr()))}),h={resolve:a,reject:l,abortHandle:c,debugInfo:t};this._outJobs.set(o,h),this._post({type:cle,jobId:o,methodName:t,abortable:s!=null},r,n)})}on(t,r){const i=new MessageChannel;function s(n){r(n.data)}return this._port.postMessage({type:Kl.ON,eventType:t,port:i.port2},[i.port2]),i.port1.addEventListener("message",s),i.port1.start(),{remove(){i.port1.postMessage({type:Kl.CLOSE}),i.port1.close(),i.port1.removeEventListener("message",s)}}}jobAdded(){this._processWork()}openPort(){const t=new MessageChannel;return this._post({type:ule,port:t.port2}),t.port1}_processWork(){if(this._outJobs.size>=u8e)return;const t=this._getNextJob();if(!t)return;const{methodName:r,data:i,invokeOptions:s,deferred:n}=t;this.invoke(r,i,s).then(o=>n.resolve(o)).catch(o=>n.reject(o))}_close(){this._channel&&(this._channel=null),this._port.removeEventListener("message",this._onMessage),this._port.close(),this._outJobs.forEach(t=>{wn(t.abortHandle),t.reject(gr(`Worker closing, aborting job calling '${t.debugInfo}'`))}),this._inJobs.clear(),this._outJobs.clear(),this._invokeQueue.clear(),this._port=this._client=this._schedule=null}_onMessage(t){b(this._schedule)?this._schedule(()=>this._processMessage(t)):this._processMessage(t)}_processMessage(t){const r=pI(t);if(r)switch(r.type){case YR:this._onResponseMessage(r);break;case cle:this._invokeQueue.push(r);break;case lle:this._onAbortMessage(r);break;case ale:this._onCloseMessage();break;case ule:this._onOpenPortMessage(r);break;case c8e:this._onOnMessage(r)}}_onAbortMessage(t){const r=this._inJobs,i=t.jobId,s=r.get(i);this._invokeQueue.push(t),s&&(s.controller&&s.controller.abort(),r.delete(i))}_onCloseMessage(){const t=this._client;this._close(),t&&"destroy"in t&&zc.clients.get(this)===t&&t.destroy(),zc.clients.delete(this),t&&t.remoteClient&&(t.remoteClient=null)}_onInvokeMessage(t){const{methodName:r,jobId:i,data:s,abortable:n}=t,o=n?new AbortController:null,a=this._inJobs;let l,c=this._client,h=c[r];try{if(!h&&r&&r.includes(".")){const p=r.split(".");for(let f=0;f<p.length-1;f++)c=c[p[f]],h=c[p[f+1]]}if(typeof h!="function")throw new TypeError(`${r} is not a function`);l=h.call(c,s,{client:this,signal:o?o.signal:null})}catch(p){return void this._post({type:YR,jobId:i,error:PU(p)})}Ch(l)?(a.set(i,{controller:o,promise:l}),l.then(p=>{a.has(i)&&(a.delete(i),this._post({type:YR,jobId:i},p))},p=>{a.has(i)&&(a.delete(i),Vi(p)||this._post({type:YR,jobId:i,error:PU(p||{message:`Error encountered at method ${r}`})}))})):this._post({type:YR,jobId:i},l)}_onOpenPortMessage(t){new zc(t.port,{client:this._client},()=>null)}_onOnMessage(t){const{port:r}=t,i=this._client.on(t.eventType,n=>{r.postMessage(n)}),s=V$(t.port,"message",n=>{pI(n).type===Kl.CLOSE&&(s.remove(),i.remove(),r.close())})}_onResponseMessage(t){const{jobId:r,error:i,data:s}=t,n=this._outJobs;if(!n.has(r))return;const o=n.get(r);this._processWork(),n.delete(r),wn(o.abortHandle),i?o.reject(j.fromJSON(JSON.parse(i))):o.resolve(s)}_post(t,r,i){return Ixe(this._port,t,r,i)}}zc.kernelInfo={revision:mbe,version:gbe,buildDate:fbe},zc.clients=new Map;const d8e=fe.getLogger("esri.core.workers.Connection");class p8e{constructor(){this._inUseClients=new Array,this._clients=new Array,this._clientPromises=new Array,this._ongoingJobsQueue=new vX}destroy(){this.close()}get closed(){return!this._clients||!this._clients.length}open(t,r){return new Promise((i,s)=>{let n=!0;const o=a=>{Jt(r.signal),n&&(n=!1,a())};this._clients.length=t.length,this._clientPromises.length=t.length,this._inUseClients.length=t.length;for(let a=0;a<t.length;++a){const l=t[a];Ch(l)?this._clientPromises[a]=l.then(c=>(this._clients[a]=new zc(c,r,()=>this._ongoingJobsQueue.pop()),o(i),this._clients[a]),()=>(o(s),null)):(this._clients[a]=new zc(l,r,()=>this._ongoingJobsQueue.pop()),this._clientPromises[a]=Promise.resolve(this._clients[a]),o(i))}})}broadcast(t,r,i){const s=new Array(this._clientPromises.length);for(let n=0;n<this._clientPromises.length;++n){const o=this._clientPromises[n];s[n]=o.then(a=>a.invoke(t,r,i))}return s}close(){let t;for(;t=this._ongoingJobsQueue.pop();)t.deferred.reject(gr(`Worker closing, aborting job calling '${t.methodName}'`));for(const r of this._clientPromises)r.then(i=>i.close());this._clients.length=0,this._clientPromises.length=0}invoke(t,r,i){let s=null;Array.isArray(i)?(d8e.warn("invoke()","The transferList parameter is deprecated, use the options object instead"),s={transferList:i}):s=i;const n=T1();this._ongoingJobsQueue.push({methodName:t,data:r,invokeOptions:s,deferred:n});for(let o=0;o<this._clientPromises.length;o++){const a=this._clients[o];a?a.jobAdded():this._clientPromises[o].then(l=>l.jobAdded())}return n.promise}on(t,r){return Promise.all(this._clientPromises).then(()=>VC(this._clients.map(i=>i.on(t,r))))}openPorts(){return new Promise(t=>{const r=new Array(this._clientPromises.length);let i=r.length;for(let s=0;s<this._clientPromises.length;++s)this._clientPromises[s].then(n=>{r[s]=n.openPort(),--i==0&&t(r)})})}get test(){return{numClients:this._clients.length}}}const $xe=fe.getLogger("esri.intl");function nd(e,t,r={}){const{format:i={}}=r;return Zm(e,s=>f8e(s,t,i))}function f8e(e,t,r){let i,s;const n=e.indexOf(":");if(n===-1?i=e.trim():(i=e.slice(0,n).trim(),s=e.slice(n+1).trim()),!i)return"";const o=rR(i,t);if(o==null)return"";const a=r[s]||r[i];return a?m8e(o,a):s?g8e(o,s):Qee(o)}function m8e(e,t){switch(t.type){case"date":return Jm(e,t.intlOptions);case"number":return Ud(e,t.intlOptions);default:return $xe.warn("missing format descriptor for key {key}"),Qee(e)}}function g8e(e,t){switch(t.toLowerCase()){case"dateformat":return Jm(e);case"numberformat":return Ud(e);default:return $xe.warn(`inline format is unsupported since 4.12: ${t}`),/^(dateformat|datestring)/i.test(t)?Jm(e):/^numberformat/i.test(t)?Ud(e):Qee(e)}}function Qee(e){switch(typeof e){case"string":return e;case"number":return Ud(e);case"boolean":return""+e;default:return e instanceof Date?Jm(e):""}}async function y8e(e,t,r,i){const s=t.exec(r);if(!s)throw new j("esri-intl:invalid-bundle",`Bundle id "${r}" is not compatible with the pattern "${t}"`);const n=s[1]?`${s[1]}/`:"",o=s[2],a=SVe(i),l=`${n}${o}.json`,c=a?`${n}${o}_${a}.json`:l;let h;try{h=await hle(e(c))}catch(p){if(c===l)throw new j("intl:unknown-bundle",`Bundle "${r}" cannot be loaded`,{error:p});try{h=await hle(e(l))}catch(f){throw new j("intl:unknown-bundle",`Bundle "${r}" cannot be loaded`,{error:f})}}return h}async function hle(e){if(b(dle.fetchBundleAsset))return dle.fetchBundleAsset(e);const t=await er(e,{responseType:"text"});return JSON.parse(t.data)}class v8e{constructor({base:t="",pattern:r,location:i=new URL(window.location.href)}){let s;s=typeof i=="string"?n=>new URL(n,new URL(i,window.location.href)).href:i instanceof URL?n=>new URL(n,i).href:i,this.pattern=typeof r=="string"?new RegExp(`^${r}`):r,this.getAssetUrl=s,t=t?t.endsWith("/")?t:t+"/":"",this.matcher=new RegExp(`^${t}(?:(.*)/)?(.*)$`)}fetchMessageBundle(t,r){return y8e(this.getAssetUrl,this.matcher,t,r)}}function _8e(e){return new v8e(e)}const dle={};TVe(_8e({pattern:"esri/",location:wr}));const ple={};function b8e(e,t){for(const r of e)if(r.name===t.name)return;e.push(t)}function w8e(e){var r;const t={async:e.async,isDebug:e.isDebug,locale:e.locale,baseUrl:e.baseUrl,has:{...e.has},map:{...e.map},packages:e.packages&&e.packages.concat()||[],paths:{...e.paths}};return e.hasOwnProperty("async")||(t.async=!0),e.hasOwnProperty("isDebug")||(t.isDebug=!1),e.baseUrl||(t.baseUrl=ple.baseUrl),(r=ple.packages)==null||r.forEach(i=>{b8e(t.packages,i)}),t}class x8e{constructor(){const t=document.createDocumentFragment();["addEventListener","dispatchEvent","removeEventListener"].forEach(r=>{this[r]=(...i)=>t[r](...i)})}}class n5{constructor(){this._dispatcher=new x8e,this._workerPostMessage({type:Kl.HANDSHAKE})}terminate(){}get onmessage(){return this._onmessageHandler}set onmessage(t){this._onmessageHandler&&this.removeEventListener("message",this._onmessageHandler),this._onmessageHandler=t,t&&this.addEventListener("message",t)}get onmessageerror(){return this._onmessageerrorHandler}set onmessageerror(t){this._onmessageerrorHandler&&this.removeEventListener("messageerror",this._onmessageerrorHandler),this._onmessageerrorHandler=t,t&&this.addEventListener("messageerror",t)}get onerror(){return this._onerrorHandler}set onerror(t){this._onerrorHandler&&this.removeEventListener("error",this._onerrorHandler),this._onerrorHandler=t,t&&this.addEventListener("error",t)}postMessage(t){zC(()=>{this._workerMessageHandler(new MessageEvent("message",{data:t}))})}dispatchEvent(t){return this._dispatcher.dispatchEvent(t)}addEventListener(t,r,i){this._dispatcher.addEventListener(t,r,i)}removeEventListener(t,r,i){this._dispatcher.removeEventListener(t,r,i)}_workerPostMessage(t){zC(()=>{this.dispatchEvent(new MessageEvent("message",{data:t}))})}async _workerMessageHandler(t){const r=pI(t);if(r&&r.type===Kl.OPEN){const{modulePath:i,jobId:s}=r;let n=await zc.loadWorker(i);n||(n=await ie(()=>import(i),[],import.meta.url));const o=zc.connect(n);this._workerPostMessage({type:Kl.OPENED,jobId:s,data:o})}}}const _X=fe.getLogger("esri.core.workers"),{HANDSHAKE:T8e}=Kl,S8e='let globalId=0;const outgoing=new Map,configuration=JSON.parse("{CONFIGURATION}");self.esriConfig=configuration.esriConfig;const workerPath=self.esriConfig.workers.workerPath,HANDSHAKE=0,OPEN=1,OPENED=2,RESPONSE=3,INVOKE=4,ABORT=5;function createAbortError(){const e=new Error("Aborted");return e.name="AbortError",e}function receiveMessage(e){return e&&e.data?"string"==typeof e.data?JSON.parse(e.data):e.data:null}function invokeStaticMessage(e,o,r){const t=r&&r.signal,n=globalId++;return new Promise(((r,i)=>{if(t){if(t.aborted)return i(createAbortError());t.addEventListener("abort",(()=>{outgoing.get(n)&&(outgoing.delete(n),self.postMessage({type:5,jobId:n}),i(createAbortError()))}))}outgoing.set(n,{resolve:r,reject:i}),self.postMessage({type:4,jobId:n,methodName:e,abortable:null!=t,data:o})}))}let workerRevisionChecked=!1;function checkWorkerRevision(e){if(!workerRevisionChecked&&e.kernelInfo){workerRevisionChecked=!0;const{revision:o,buildDate:r,version:t}=configuration.kernelInfo,{revision:n,buildDate:i,version:s}=e.kernelInfo;o!==n&&console.warn(`[esri.core.workers] Version mismatch detected between ArcGIS API for JavaScript and assets:\\nAPI version: ${t} [Date: ${r}, Revision: ${o.slice(0,8)}]\nAssets version: ${s} [Date: ${i}, Revision: ${n.slice(0,8)}]`)}}function messageHandler(e){const o=receiveMessage(e);if(!o)return;const r=o.jobId;switch(o.type){case 1:let e;function t(o){const t=e.connect(o);self.postMessage({type:2,jobId:r,data:t},[t])}"function"==typeof define&&define.amd?require([workerPath],(r=>{e=r.default||r,checkWorkerRevision(e),e.loadWorker(o.modulePath).then((e=>e||new Promise((e=>{require([o.modulePath],e)})))).then(t)})):"System"in self&&"function"==typeof System.import?System.import(workerPath).then((r=>(e=r.default,checkWorkerRevision(e),e.loadWorker(o.modulePath)))).then((e=>e||System.import(o.modulePath))).then(t):esriConfig.workers.useDynamicImport?import(workerPath).then((r=>{e=r.default||r,checkWorkerRevision(e),e.loadWorker(o.modulePath).then((e=>e||import(o.modulePath))).then(t)})):(self.RemoteClient||importScripts(workerPath),e=self.RemoteClient.default||self.RemoteClient,checkWorkerRevision(e),e.loadWorker(o.modulePath).then(t));break;case 3:if(outgoing.has(r)){const e=outgoing.get(r);outgoing.delete(r),o.error?e.reject(JSON.parse(o.error)):e.resolve(o.data)}}}self.dojoConfig=configuration.loaderConfig,esriConfig.workers.loaderUrl&&(self.importScripts(esriConfig.workers.loaderUrl),"function"==typeof require&&"function"==typeof require.config&&require.config(configuration.loaderConfig)),self.addEventListener("message",messageHandler),self.postMessage({type:0});';let OD,MD;const fle="Failed to create Worker. Fallback to execute module in main thread";async function E8e(){if(!he("esri-workers")||(he("mozilla"),0))return mle(new n5);if(!OD&&!MD)try{const t=S8e.replace('"{CONFIGURATION}"',`'${C8e()}'`);OD=URL.createObjectURL(new Blob([t],{type:"text/javascript"}))}catch(t){MD=t||{}}let e;if(OD)try{e=new Worker(OD,{name:"esri-worker-"+A8e++})}catch{_X.warn(fle,MD),e=new n5}else _X.warn(fle,MD),e=new n5;return mle(e)}async function mle(e){return new Promise(t=>{function r(s){const n=pI(s);n&&n.type===T8e&&(e.removeEventListener("message",r),e.removeEventListener("error",i),t(e))}function i(s){s.preventDefault(),e.removeEventListener("message",r),e.removeEventListener("error",i),_X.warn("Failed to create Worker. Fallback to execute module in main thread",s),(e=new n5).addEventListener("message",r),e.addEventListener("error",i)}e.addEventListener("message",r),e.addEventListener("error",i)})}function C8e(){let e;if(Ur.default!=null){const s={...Ur};delete s.default,e=JSON.parse(JSON.stringify(s))}else e=JSON.parse(JSON.stringify(Ur));e.assetsPath=Rd(e.assetsPath),e.request.interceptors=[],e.log.interceptors=[],e.locale=lh(),e.has={"esri-csp-restrictions":he("esri-csp-restrictions"),"esri-2d-debug":!1,"esri-2d-update-debug":he("esri-2d-update-debug"),"esri-2d-query-centroid-enabled":he("esri-2d-query-centroid-enabled"),"featurelayer-pbf":he("featurelayer-pbf"),"featurelayer-simplify-thresholds":he("featurelayer-simplify-thresholds"),"featurelayer-simplify-payload-size-factors":he("featurelayer-simplify-payload-size-factors"),"featurelayer-simplify-mobile-factor":he("featurelayer-simplify-mobile-factor"),"esri-atomics":he("esri-atomics"),"esri-shared-array-buffer":he("esri-shared-array-buffer"),"esri-tiles-debug":he("esri-tiles-debug"),"esri-workers-arraybuffer-transfer":he("esri-workers-arraybuffer-transfer"),"feature-polyline-generalization-factor":he("feature-polyline-generalization-factor"),"host-webworker":1},e.workers.loaderUrl&&(e.workers.loaderUrl=Rd(e.workers.loaderUrl)),e.workers.workerPath?e.workers.workerPath=Rd(e.workers.workerPath):e.workers.workerPath=Rd(wr("esri/core/workers/RemoteClient.js")),e.workers.useDynamicImport=!1;const t=Ur.workers.loaderConfig,r=w8e({baseUrl:t==null?void 0:t.baseUrl,locale:lh(),has:{"csp-restrictions":1,"dojo-test-sniff":0,"host-webworker":1,...t==null?void 0:t.has},map:{...t==null?void 0:t.map},paths:{...t==null?void 0:t.paths},packages:(t==null?void 0:t.packages)||[]}),i={version:gbe,buildDate:fbe,revision:mbe};return JSON.stringify({esriConfig:e,loaderConfig:r,kernelInfo:i})}let A8e=0;const R8e=fe.getLogger("esri.core.workers"),{ABORT:gle,INVOKE:O8e,OPEN:M8e,OPENED:P8e,RESPONSE:QR}=Kl;class Jee{constructor(t,r){this._outJobs=new Map,this._inJobs=new Map,this.worker=t,this.id=r,t.addEventListener("message",this._onMessage.bind(this)),t.addEventListener("error",i=>{i.preventDefault(),R8e.error(i)})}static async create(t){const r=await E8e();return new Jee(r,t)}terminate(){this.worker.terminate()}async open(t,r={}){const{signal:i}=r,s=Pxe();return new Promise((n,o)=>{const a={resolve:n,reject:o,abortHandle:FK(i,()=>{this._outJobs.delete(s),this._post({type:gle,jobId:s})})};this._outJobs.set(s,a),this._post({type:M8e,jobId:s,modulePath:t})})}_onMessage(t){const r=pI(t);if(r)switch(r.type){case P8e:this._onOpenedMessage(r);break;case QR:this._onResponseMessage(r);break;case gle:this._onAbortMessage(r);break;case O8e:this._onInvokeMessage(r)}}_onAbortMessage(t){const r=this._inJobs,i=t.jobId,s=r.get(i);s&&(s.controller&&s.controller.abort(),r.delete(i))}_onInvokeMessage(t){const{methodName:r,jobId:i,data:s,abortable:n}=t,o=n?new AbortController:null,a=this._inJobs,l=CUe[r];let c;try{if(typeof l!="function")throw new TypeError(`${r} is not a function`);c=l.call(null,s,{signal:o?o.signal:null})}catch(h){return void this._post({type:QR,jobId:i,error:PU(h)})}Ch(c)?(a.set(i,{controller:o,promise:c}),c.then(h=>{a.has(i)&&(a.delete(i),this._post({type:QR,jobId:i},h))},h=>{a.has(i)&&(a.delete(i),h||(h={message:"Error encountered at method"+r}),Vi(h)||this._post({type:QR,jobId:i,error:PU(h||{message:`Error encountered at method ${r}`})}))})):this._post({type:QR,jobId:i},c)}_onOpenedMessage(t){const{jobId:r,data:i}=t,s=this._outJobs.get(r);s&&(this._outJobs.delete(r),wn(s.abortHandle),s.resolve(i))}_onResponseMessage(t){const{jobId:r,error:i,data:s}=t,n=this._outJobs.get(r);n&&(this._outJobs.delete(r),wn(n.abortHandle),i?n.reject(j.fromJSON(JSON.parse(i))):n.resolve(s))}_post(t,r,i){return Ixe(this.worker,t,r,i)}}let mx=he("esri-workers-debug")?1:he("host-browser")?navigator.hardwareConcurrency-1:0;mx||(mx=he("safari")&&he("mac")||he("trident")?7:2);let yle=0;const o5=[];function I8e(){Lxe()}async function PD(e,t){const r=new p8e;return await r.open(e,t),r}async function Kee(e,t={}){if(typeof e!="string")throw new j("workers:undefined-module","modulePath is missing");let r=t.strategy||"distributed";if(he("host-webworker")&&!he("esri-workers")&&(r="local"),r==="local"){let i=await zc.loadWorker(e);i||(i=await ie(()=>import(e),[],import.meta.url)),Jt(t.signal);const s=t.client||i;return PD([zc.connect(i)],{...t,client:s})}if(await Lxe(),Jt(t.signal),r==="dedicated"){const i=yle++%mx;return PD([await o5[i].open(e,t)],t)}if(t.maxNumWorkers&&t.maxNumWorkers>0){const i=Math.min(t.maxNumWorkers,mx);if(i<mx){const s=new Array(i);for(let n=0;n<i;++n){const o=yle++%mx;s[n]=o5[o].open(e,t)}return PD(s,t)}}return PD(o5.map(i=>i.open(e,t)),t)}let ID=null;async function Lxe(){if(ID)return ID;new AbortController;const e=[];for(let t=0;t<mx;t++){const r=Jee.create(t).then(i=>(o5[t]=i,i));e.push(r)}return ID=Promise.all(e),ID}fe.getLogger("esri.core.support.OwningCollection");let X3=class extends pg(ot){constructor(e){super(e),this.handles.add([this.on("before-add",t=>{R(t.item)&&t.preventDefault()}),this.on("after-add",t=>this._own(t.item)),this.on("after-remove",t=>this._release(t.item))])}get owner(){return this._get("owner")}set owner(e){e!==this._get("owner")&&(this._releaseAll(),this._set("owner",e),this._ownAll())}_ownAll(){for(const e of this.items)this._own(e)}_releaseAll(){for(const e of this.items)this._release(e)}_createNewInstance(e){return this.itemType?new(ot.ofType(this.itemType.Type))(e):new ot(e)}};function bX(e,t){return{type:e,cast:q1e,set(r){const i=iT(r,this._get(t),e);i.owner=this,this._set(t,i)}}}u([d()],X3.prototype,"owner",null),X3=u([$("esri.core.support.OwningCollection")],X3);function ete(e){return new Ze({wkt:`GEOCCS["Spherical geocentric",
    DATUM["Not specified",
      SPHEROID["Sphere",${e.radius},0]],
    PRIMEM["Greenwich",0.0,
      AUTHORITY["EPSG","8901"]],
    UNIT["m",1.0],
    AXIS["Geocentric X",OTHER],
    AXIS["Geocentric Y",EAST],
    AXIS["Geocentric Z",NORTH]
  ]`})}const Dxe=ete($r),IU=ete(zm),$U=ete(c0),$8e=new Ze({wkt:`GEOCCS["WGS 84",
  DATUM["WGS_1984",
    SPHEROID["WGS 84",${$r.radius},298.257223563,
      AUTHORITY["EPSG","7030"]],
    AUTHORITY["EPSG","6326"]],
  PRIMEM["Greenwich",0,
    AUTHORITY["EPSG","8901"]],
  UNIT["m",1.0,
    AUTHORITY["EPSG","9001"]],
  AXIS["Geocentric X",OTHER],
  AXIS["Geocentric Y",OTHER],
  AXIS["Geocentric Z",NORTH],
  AUTHORITY["EPSG","4978"]
]`});function rg(e){return e&&(hg(e)||e===IU)?IU:e&&(dg(e)||e===$U)?$U:Dxe}function Ar(e){return e&&(hg(e)||e===IU)?zm:e&&(dg(e)||e===$U)?c0:$r}function JIt(e){return iee(e)?zm:see(e)?c0:$r}const Nxe=39.37,L8e=$r.radius*Math.PI/200,Fxe=/UNIT\[([^\]]+)\]\]$/i,Ux=F,kxe=/UNIT\[([^\]]+)\]/i,D8e=new Set([4261,4305,4807,4810,4811,4812,4816,4819,4821,4901,4902,37225,104139,104140]),N8e=Da()({meter:"meters",foot:"feet",foot_us:"us-feet",foot_clarke:"clarke-feet",yard_clarke:"clarke-yards",link_clarke:"clarke-links",yard_sears:"sears-yards",foot_sears:"sears-feet",chain_sears:"sears-chains",chain_benoit_1895_b:"benoit-1895-b-chains",yard_indian:"indian-yards",yard_indian_1937:"indian-1937-yards",foot_gold_coast:"gold-coast-feet",chain_sears_1922_truncated:"sears-1922-truncated-chains","50_kilometers":"50-kilometers","150_kilometers":"150-kilometers"}),Mf=e=>e*e,j0=e=>e*e*e,fI={length:{baseUnit:"meters",units:{millimeters:{inBaseUnits:.001},centimeters:{inBaseUnits:.01},decimeters:{inBaseUnits:.1},meters:{inBaseUnits:1},kilometers:{inBaseUnits:1e3},inches:{inBaseUnits:.0254},feet:{inBaseUnits:.3048},yards:{inBaseUnits:.9144},miles:{inBaseUnits:1609.344},"nautical-miles":{inBaseUnits:1852},"us-feet":{inBaseUnits:1200/3937}}},area:{baseUnit:"square-meters",units:{"square-millimeters":{inBaseUnits:Mf(.001)},"square-centimeters":{inBaseUnits:Mf(.01)},"square-decimeters":{inBaseUnits:Mf(.1)},"square-meters":{inBaseUnits:1},"square-kilometers":{inBaseUnits:Mf(1e3)},"square-inches":{inBaseUnits:Mf(.0254)},"square-feet":{inBaseUnits:Mf(.3048)},"square-yards":{inBaseUnits:Mf(.9144)},"square-miles":{inBaseUnits:Mf(1609.344)},"square-us-feet":{inBaseUnits:Mf(1200/3937)},acres:{inBaseUnits:.0015625*Mf(1609.344)},ares:{inBaseUnits:100},hectares:{inBaseUnits:1e4}}},volume:{baseUnit:"liters",units:{liters:{inBaseUnits:1},"cubic-millimeters":{inBaseUnits:1e3*j0(.001)},"cubic-centimeters":{inBaseUnits:1e3*j0(.01)},"cubic-decimeters":{inBaseUnits:1e3*j0(.1)},"cubic-meters":{inBaseUnits:1e3},"cubic-kilometers":{inBaseUnits:1e3*j0(1e3)},"cubic-inches":{inBaseUnits:1e3*j0(.0254)},"cubic-feet":{inBaseUnits:1e3*j0(.3048)},"cubic-yards":{inBaseUnits:1e3*j0(.9144)},"cubic-miles":{inBaseUnits:1e3*j0(1609.344)}}},angle:{baseUnit:"radians",units:{radians:{inBaseUnits:1},degrees:{inBaseUnits:Math.PI/180}}}},F8e=(()=>{const e={};for(const t in fI)for(const r in fI[t].units)e[r]=t;return e})();function k8e(e,t,r){return e*fI[r].units[t].inBaseUnits}function U8e(e,t,r){return e/fI[r].units[t].inBaseUnits}const V8e=["metric","imperial","inches","feet","yards","miles","nautical-miles","us-feet","meters","kilometers"];function wX(e){const t=F8e[e];if(!t)throw new Error("unknown type");return t}function vle(e,t=null){return t=t||wX(e),fI[t].baseUnit===e}function pn(e,t,r){if(t===r)return e;const i=wX(t);if(i!==wX(r))throw new Error("incompatible units");const s=vle(t,i)?e:k8e(e,t,i);return vle(r,i)?s:U8e(s,r,i)}function z8e(e,t){const r=pn(e,t,"meters");return Math.abs(r)<3e3?"meters":"kilometers"}function B8e(e,t){const r=pn(e,t,"meters");return Math.abs(r)<1e5?"meters":"kilometers"}function G8e(e,t){const r=pn(e,t,"feet");return Math.abs(r)<1e3?"feet":"miles"}function j8e(e,t){const r=pn(e,t,"feet");return Math.abs(r)<1e5?"feet":"miles"}function KIt(e,t){const r=pn(e,t,"square-meters");return Math.abs(r)<3e6?"square-meters":"square-kilometers"}function e$t(e,t){const r=pn(e,t,"square-feet");return Math.abs(r)<1e6?"square-feet":"square-miles"}function H8e(e,t,r){return pn(e,t,"meters")/(r*Math.PI/180)}function Uxe(e){return N8e.fromJSON(e.toLowerCase())||null}function aA(e){if(e&&typeof e=="object"&&!iI(e))return 1;const t=uu(e);return t>1e5?1:t}function q8e(e){return uu(e)>=(e instanceof Ze?Ar(e).metersPerDegree:1e5)?"meters":tte(e)}function uu(e,t=$r.metersPerDegree){return _t(W8e(e,!0),t)}function W8e(e,t=!1){let r,i,s=null;if(e!=null&&(typeof e=="object"?(r=e.wkid,i=e.wkt):typeof e=="number"?r=e:typeof e=="string"&&(i=e)),r){if(iee(r))return zm.metersPerDegree;if(see(r))return c0.metersPerDegree;s=Ux.values[Ux[r]],!s&&t&&D8e.has(r)&&(s=L8e)}else i&&(Bxe(i)?s=_le(Fxe.exec(i),s):zxe(i)&&(s=_le(kxe.exec(i),s)));return s}function _le(e,t){return e&&e[1]?Vxe(e[1]):t}function Vxe(e){return parseFloat(e.split(",")[1])}function tte(e){let t,r,i=null;if(e!=null&&(typeof e=="object"?(t=e.wkid,r=e.wkt):typeof e=="number"?t=e:typeof e=="string"&&(r=e)),t)i=Ux.units[Ux[t]];else if(r){const s=Bxe(r)?Fxe:zxe(r)?kxe:null;if(s){const n=s.exec(r);n&&n[1]&&(i=Z8e(n[1]))}}return b(i)?Uxe(i):null}function t$t(e){const t=tte(e);return R(t)||!V8e.includes(t)?null:t}function zxe(e){return/^GEOCCS/i.test(e)}function Bxe(e){return/^PROJCS/i.test(e)}const X8e=1e-7;function Z8e(e){const t=/[\\"\\']{1}([^\\"\\']+)/.exec(e);let r=t&&t[1];if(!r||!Ux.units.includes(r)){const i=Vxe(e);r=null;const s=Ux.values;for(let n=0;n<s.length;++n)if(Math.abs(i-s[n])<X8e){r=Ux.units[n];break}}return r}function Y8e(e){const t=tte(e);if(R(t))return null;switch(t){case"feet":case"us-feet":case"clarke-feet":case"clarke-yards":case"clarke-links":case"sears-yards":case"sears-feet":case"sears-chains":case"benoit-1895-b-chains":case"indian-yards":case"indian-1937-yards":case"gold-coast-feet":case"sears-1922-truncated-chains":return"imperial";case"50-kilometers":case"150-kilometers":case"meters":return"metric"}return null}function r$t(e){var s,n,o;const t="metric";if(R(e))return t;const r=e.map,i=r&&"portalItem"in r?(s=r.portalItem)==null?void 0:s.portal:null;if(i)switch((o=(n=i==null?void 0:i.user)==null?void 0:n.units)!=null?o:i.units){case t:return t;case"english":return"imperial"}return _t(Y8e(e.spatialReference),t)}const Gxe={esriAcres:"acres",esriAres:"ares",esriHectares:"hectares",esriSquareCentimeters:"square-centimeters",esriSquareDecimeters:"square-decimeters",esriSquareFeet:"square-feet",esriSquareInches:"square-inches",esriSquareKilometers:"square-kilometers",esriSquareMeters:"square-meters",esriSquareMiles:"square-miles",esriSquareMillimeters:"square-millimeters",esriSquareUsFeet:"square-us-feet",esriSquareYards:"square-yards"},jxe={esriCentimeters:"centimeters",esriDecimeters:"decimeters",esriFeet:"feet",esriInches:"inches",esriKilometers:"kilometers",esriMeters:"meters",esriMiles:"miles",esriMillimeters:"millimeters",esriNauticalMiles:"nautical-miles",esriYards:"yards"},Q8e=Da()(Gxe),J8e=Da()(jxe);Da()({...Gxe,...jxe});var NM;const LU=Da()({orthometric:"gravity-related-height",gravity_related_height:"gravity-related-height",ellipsoidal:"ellipsoidal"}),Hxe=LU.jsonValues.slice();zz(Hxe,"orthometric");const Z3=Da()({meter:"meters",foot:"feet","us-foot":"us-feet","clarke-foot":"clarke-feet","clarke-yard":"clarke-yards","clarke-link":"clarke-links","sears-yard":"sears-yards","sears-foot":"sears-feet","sears-chain":"sears-chains","benoit-1895-b-chain":"benoit-1895-b-chains","indian-yard":"indian-yards","indian-1937-yard":"indian-1937-yards","gold-coast-foot":"gold-coast-feet","sears-1922-truncated-chain":"sears-1922-truncated-chains","50-kilometers":"50-kilometers","150-kilometers":"150-kilometers"});let yp=NM=class extends ye{constructor(e){super(e),this.heightModel="gravity-related-height",this.heightUnit="meters",this.vertCRS=null}writeHeightModel(e,t,r){return LU.write(e,t,r)}readHeightModel(e,t,r){return LU.read(e)||(r&&r.messages&&r.messages.push(K8e(e,{context:r})),null)}readHeightUnit(e,t,r){return Z3.read(e)||(r&&r.messages&&r.messages.push(ble(e,{context:r})),null)}readHeightUnitService(e,t,r){return Uxe(e)||Z3.read(e)||(r&&r.messages&&r.messages.push(ble(e,{context:r})),null)}readVertCRS(e,t){return t.vertCRS||t.ellipsoid||t.geoid}clone(){return new NM({heightModel:this.heightModel,heightUnit:this.heightUnit,vertCRS:this.vertCRS})}equals(e){return!!e&&(this===e||this.heightModel===e.heightModel&&this.heightUnit===e.heightUnit&&this.vertCRS===e.vertCRS)}static deriveUnitFromSR(e,t){const r=q8e(t);return new NM({heightModel:e.heightModel,heightUnit:r,vertCRS:e.vertCRS})}write(e,t){return t={origin:"web-scene",...t},super.write(e,t)}static fromJSON(e){if(!e)return null;const t=new NM;return t.read(e,{origin:"web-scene"}),t}};function ble(e,t){return new ic("height-unit:unsupported",`Height unit of value '${e}' is not supported`,t)}function K8e(e,t){return new ic("height-model:unsupported",`Height model of value '${e}' is not supported`,t)}u([d({type:LU.apiValues,constructOnly:!0,json:{origins:{"web-scene":{type:Hxe,default:"ellipsoidal"}}}})],yp.prototype,"heightModel",void 0),u([Xe("web-scene","heightModel")],yp.prototype,"writeHeightModel",null),u([$e(["web-scene","service"],"heightModel")],yp.prototype,"readHeightModel",null),u([d({type:Z3.apiValues,constructOnly:!0,json:{origins:{"web-scene":{type:Z3.jsonValues,write:Z3.write}}}})],yp.prototype,"heightUnit",void 0),u([$e("web-scene","heightUnit")],yp.prototype,"readHeightUnit",null),u([$e("service","heightUnit")],yp.prototype,"readHeightUnitService",null),u([d({type:String,constructOnly:!0,json:{origins:{"web-scene":{write:!0}}}})],yp.prototype,"vertCRS",void 0),u([$e("service","vertCRS",["vertCRS","ellipsoid","geoid"])],yp.prototype,"readVertCRS",null),yp=NM=u([$("esri.geometry.HeightModelInfo")],yp);const QT=yp;function Is(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function gg(e,t,r,i,s,n,o,a,l,c,h,p,f,m,g,v,w){return e[0]=t,e[1]=r,e[2]=i,e[3]=s,e[4]=n,e[5]=o,e[6]=a,e[7]=l,e[8]=c,e[9]=h,e[10]=p,e[11]=f,e[12]=m,e[13]=g,e[14]=v,e[15]=w,e}function ig(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function lc(e,t){if(e===t){const r=t[1],i=t[2],s=t[3],n=t[6],o=t[7],a=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=r,e[6]=t[9],e[7]=t[13],e[8]=i,e[9]=n,e[11]=t[14],e[12]=s,e[13]=o,e[14]=a}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e}function Cs(e,t){const r=t[0],i=t[1],s=t[2],n=t[3],o=t[4],a=t[5],l=t[6],c=t[7],h=t[8],p=t[9],f=t[10],m=t[11],g=t[12],v=t[13],w=t[14],_=t[15],T=r*a-i*o,x=r*l-s*o,E=r*c-n*o,C=i*l-s*a,A=i*c-n*a,P=s*c-n*l,I=h*v-p*g,L=h*w-f*g,k=h*_-m*g,G=p*w-f*v,z=p*_-m*v,X=f*_-m*w;let Z=T*X-x*z+E*G+C*k-A*L+P*I;return Z?(Z=1/Z,e[0]=(a*X-l*z+c*G)*Z,e[1]=(s*z-i*X-n*G)*Z,e[2]=(v*P-w*A+_*C)*Z,e[3]=(f*A-p*P-m*C)*Z,e[4]=(l*k-o*X-c*L)*Z,e[5]=(r*X-s*k+n*L)*Z,e[6]=(w*E-g*P-_*x)*Z,e[7]=(h*P-f*E+m*x)*Z,e[8]=(o*z-a*k+c*I)*Z,e[9]=(i*k-r*z-n*I)*Z,e[10]=(g*A-v*E+_*T)*Z,e[11]=(p*E-h*A-m*T)*Z,e[12]=(a*L-o*G-l*I)*Z,e[13]=(r*G-i*L+s*I)*Z,e[14]=(v*x-g*C-w*T)*Z,e[15]=(h*C-p*x+f*T)*Z,e):null}function e9e(e,t){const r=t[0],i=t[1],s=t[2],n=t[3],o=t[4],a=t[5],l=t[6],c=t[7],h=t[8],p=t[9],f=t[10],m=t[11],g=t[12],v=t[13],w=t[14],_=t[15];return e[0]=a*(f*_-m*w)-p*(l*_-c*w)+v*(l*m-c*f),e[1]=-(i*(f*_-m*w)-p*(s*_-n*w)+v*(s*m-n*f)),e[2]=i*(l*_-c*w)-a*(s*_-n*w)+v*(s*c-n*l),e[3]=-(i*(l*m-c*f)-a*(s*m-n*f)+p*(s*c-n*l)),e[4]=-(o*(f*_-m*w)-h*(l*_-c*w)+g*(l*m-c*f)),e[5]=r*(f*_-m*w)-h*(s*_-n*w)+g*(s*m-n*f),e[6]=-(r*(l*_-c*w)-o*(s*_-n*w)+g*(s*c-n*l)),e[7]=r*(l*m-c*f)-o*(s*m-n*f)+h*(s*c-n*l),e[8]=o*(p*_-m*v)-h*(a*_-c*v)+g*(a*m-c*p),e[9]=-(r*(p*_-m*v)-h*(i*_-n*v)+g*(i*m-n*p)),e[10]=r*(a*_-c*v)-o*(i*_-n*v)+g*(i*c-n*a),e[11]=-(r*(a*m-c*p)-o*(i*m-n*p)+h*(i*c-n*a)),e[12]=-(o*(p*w-f*v)-h*(a*w-l*v)+g*(a*f-l*p)),e[13]=r*(p*w-f*v)-h*(i*w-s*v)+g*(i*f-s*p),e[14]=-(r*(a*w-l*v)-o*(i*w-s*v)+g*(i*l-s*a)),e[15]=r*(a*f-l*p)-o*(i*f-s*p)+h*(i*l-s*a),e}function t9e(e){const t=e[0],r=e[1],i=e[2],s=e[3],n=e[4],o=e[5],a=e[6],l=e[7],c=e[8],h=e[9],p=e[10],f=e[11],m=e[12],g=e[13],v=e[14],w=e[15];return(t*o-r*n)*(p*w-f*v)-(t*a-i*n)*(h*w-f*g)+(t*l-s*n)*(h*v-p*g)+(r*a-i*o)*(c*w-f*m)-(r*l-s*o)*(c*v-p*m)+(i*l-s*a)*(c*g-h*m)}function Yi(e,t,r){const i=t[0],s=t[1],n=t[2],o=t[3],a=t[4],l=t[5],c=t[6],h=t[7],p=t[8],f=t[9],m=t[10],g=t[11],v=t[12],w=t[13],_=t[14],T=t[15];let x=r[0],E=r[1],C=r[2],A=r[3];return e[0]=x*i+E*a+C*p+A*v,e[1]=x*s+E*l+C*f+A*w,e[2]=x*n+E*c+C*m+A*_,e[3]=x*o+E*h+C*g+A*T,x=r[4],E=r[5],C=r[6],A=r[7],e[4]=x*i+E*a+C*p+A*v,e[5]=x*s+E*l+C*f+A*w,e[6]=x*n+E*c+C*m+A*_,e[7]=x*o+E*h+C*g+A*T,x=r[8],E=r[9],C=r[10],A=r[11],e[8]=x*i+E*a+C*p+A*v,e[9]=x*s+E*l+C*f+A*w,e[10]=x*n+E*c+C*m+A*_,e[11]=x*o+E*h+C*g+A*T,x=r[12],E=r[13],C=r[14],A=r[15],e[12]=x*i+E*a+C*p+A*v,e[13]=x*s+E*l+C*f+A*w,e[14]=x*n+E*c+C*m+A*_,e[15]=x*o+E*h+C*g+A*T,e}function yl(e,t,r){const i=r[0],s=r[1],n=r[2];if(t===e)e[12]=t[0]*i+t[4]*s+t[8]*n+t[12],e[13]=t[1]*i+t[5]*s+t[9]*n+t[13],e[14]=t[2]*i+t[6]*s+t[10]*n+t[14],e[15]=t[3]*i+t[7]*s+t[11]*n+t[15];else{const o=t[0],a=t[1],l=t[2],c=t[3],h=t[4],p=t[5],f=t[6],m=t[7],g=t[8],v=t[9],w=t[10],_=t[11];e[0]=o,e[1]=a,e[2]=l,e[3]=c,e[4]=h,e[5]=p,e[6]=f,e[7]=m,e[8]=g,e[9]=v,e[10]=w,e[11]=_,e[12]=o*i+h*s+g*n+t[12],e[13]=a*i+p*s+v*n+t[13],e[14]=l*i+f*s+w*n+t[14],e[15]=c*i+m*s+_*n+t[15]}return e}function v6(e,t,r){const i=r[0],s=r[1],n=r[2];return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e[4]=t[4]*s,e[5]=t[5]*s,e[6]=t[6]*s,e[7]=t[7]*s,e[8]=t[8]*n,e[9]=t[9]*n,e[10]=t[10]*n,e[11]=t[11]*n,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function qc(e,t,r,i){let s,n,o,a,l,c,h,p,f,m,g,v,w,_,T,x,E,C,A,P,I,L,k,G,z=i[0],X=i[1],Z=i[2],ce=Math.sqrt(z*z+X*X+Z*Z);return ce<At?null:(ce=1/ce,z*=ce,X*=ce,Z*=ce,s=Math.sin(r),n=Math.cos(r),o=1-n,a=t[0],l=t[1],c=t[2],h=t[3],p=t[4],f=t[5],m=t[6],g=t[7],v=t[8],w=t[9],_=t[10],T=t[11],x=z*z*o+n,E=X*z*o+Z*s,C=Z*z*o-X*s,A=z*X*o-Z*s,P=X*X*o+n,I=Z*X*o+z*s,L=z*Z*o+X*s,k=X*Z*o-z*s,G=Z*Z*o+n,e[0]=a*x+p*E+v*C,e[1]=l*x+f*E+w*C,e[2]=c*x+m*E+_*C,e[3]=h*x+g*E+T*C,e[4]=a*A+p*P+v*I,e[5]=l*A+f*P+w*I,e[6]=c*A+m*P+_*I,e[7]=h*A+g*P+T*I,e[8]=a*L+p*k+v*G,e[9]=l*L+f*k+w*G,e[10]=c*L+m*k+_*G,e[11]=h*L+g*k+T*G,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e)}function lA(e,t,r){const i=Math.sin(r),s=Math.cos(r),n=t[4],o=t[5],a=t[6],l=t[7],c=t[8],h=t[9],p=t[10],f=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=n*s+c*i,e[5]=o*s+h*i,e[6]=a*s+p*i,e[7]=l*s+f*i,e[8]=c*s-n*i,e[9]=h*s-o*i,e[10]=p*s-a*i,e[11]=f*s-l*i,e}function _6(e,t,r){const i=Math.sin(r),s=Math.cos(r),n=t[0],o=t[1],a=t[2],l=t[3],c=t[8],h=t[9],p=t[10],f=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=n*s-c*i,e[1]=o*s-h*i,e[2]=a*s-p*i,e[3]=l*s-f*i,e[8]=n*i+c*s,e[9]=o*i+h*s,e[10]=a*i+p*s,e[11]=l*i+f*s,e}function cA(e,t,r){const i=Math.sin(r),s=Math.cos(r),n=t[0],o=t[1],a=t[2],l=t[3],c=t[4],h=t[5],p=t[6],f=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=n*s+c*i,e[1]=o*s+h*i,e[2]=a*s+p*i,e[3]=l*s+f*i,e[4]=c*s-n*i,e[5]=h*s-o*i,e[6]=p*s-a*i,e[7]=f*s-l*i,e}function b6(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e}function r9e(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function _h(e,t,r){let i,s,n,o=r[0],a=r[1],l=r[2],c=Math.sqrt(o*o+a*a+l*l);return c<At?null:(c=1/c,o*=c,a*=c,l*=c,i=Math.sin(t),s=Math.cos(t),n=1-s,e[0]=o*o*n+s,e[1]=a*o*n+l*i,e[2]=l*o*n-a*i,e[3]=0,e[4]=o*a*n-l*i,e[5]=a*a*n+s,e[6]=l*a*n+o*i,e[7]=0,e[8]=o*l*n+a*i,e[9]=a*l*n-o*i,e[10]=l*l*n+s,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)}function qxe(e,t){const r=Math.sin(t),i=Math.cos(t);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=i,e[6]=r,e[7]=0,e[8]=0,e[9]=-r,e[10]=i,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function i9e(e,t){const r=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=0,e[2]=-r,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=r,e[9]=0,e[10]=i,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Wxe(e,t){const r=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=r,e[2]=0,e[3]=0,e[4]=-r,e[5]=i,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Xxe(e,t,r){const i=t[0],s=t[1],n=t[2],o=t[3],a=i+i,l=s+s,c=n+n,h=i*a,p=i*l,f=i*c,m=s*l,g=s*c,v=n*c,w=o*a,_=o*l,T=o*c;return e[0]=1-(m+v),e[1]=p+T,e[2]=f-_,e[3]=0,e[4]=p-T,e[5]=1-(h+v),e[6]=g+w,e[7]=0,e[8]=f+_,e[9]=g-w,e[10]=1-(h+m),e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}function s9e(e,t){const r=n9e,i=-t[0],s=-t[1],n=-t[2],o=t[3],a=t[4],l=t[5],c=t[6],h=t[7],p=i*i+s*s+n*n+o*o;return p>0?(r[0]=2*(a*o+h*i+l*n-c*s)/p,r[1]=2*(l*o+h*s+c*i-a*n)/p,r[2]=2*(c*o+h*n+a*s-l*i)/p):(r[0]=2*(a*o+h*i+l*n-c*s),r[1]=2*(l*o+h*s+c*i-a*n),r[2]=2*(c*o+h*n+a*s-l*i)),Xxe(e,t,r),e}const n9e=M();function o9e(e,t){return e[0]=t[12],e[1]=t[13],e[2]=t[14],e}function Zxe(e,t){const r=t[0],i=t[1],s=t[2],n=t[4],o=t[5],a=t[6],l=t[8],c=t[9],h=t[10];return e[0]=Math.sqrt(r*r+i*i+s*s),e[1]=Math.sqrt(n*n+o*o+a*a),e[2]=Math.sqrt(l*l+c*c+h*h),e}function a9e(e,t){const r=t[0]+t[5]+t[10];let i=0;return r>0?(i=2*Math.sqrt(r+1),e[3]=.25*i,e[0]=(t[6]-t[9])/i,e[1]=(t[8]-t[2])/i,e[2]=(t[1]-t[4])/i):t[0]>t[5]&&t[0]>t[10]?(i=2*Math.sqrt(1+t[0]-t[5]-t[10]),e[3]=(t[6]-t[9])/i,e[0]=.25*i,e[1]=(t[1]+t[4])/i,e[2]=(t[8]+t[2])/i):t[5]>t[10]?(i=2*Math.sqrt(1+t[5]-t[0]-t[10]),e[3]=(t[8]-t[2])/i,e[0]=(t[1]+t[4])/i,e[1]=.25*i,e[2]=(t[6]+t[9])/i):(i=2*Math.sqrt(1+t[10]-t[0]-t[5]),e[3]=(t[1]-t[4])/i,e[0]=(t[8]+t[2])/i,e[1]=(t[6]+t[9])/i,e[2]=.25*i),e}function l9e(e,t,r,i){const s=t[0],n=t[1],o=t[2],a=t[3],l=s+s,c=n+n,h=o+o,p=s*l,f=s*c,m=s*h,g=n*c,v=n*h,w=o*h,_=a*l,T=a*c,x=a*h,E=i[0],C=i[1],A=i[2];return e[0]=(1-(g+w))*E,e[1]=(f+x)*E,e[2]=(m-T)*E,e[3]=0,e[4]=(f-x)*C,e[5]=(1-(p+w))*C,e[6]=(v+_)*C,e[7]=0,e[8]=(m+T)*A,e[9]=(v-_)*A,e[10]=(1-(p+g))*A,e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}function c9e(e,t,r,i,s){const n=t[0],o=t[1],a=t[2],l=t[3],c=n+n,h=o+o,p=a+a,f=n*c,m=n*h,g=n*p,v=o*h,w=o*p,_=a*p,T=l*c,x=l*h,E=l*p,C=i[0],A=i[1],P=i[2],I=s[0],L=s[1],k=s[2],G=(1-(v+_))*C,z=(m+E)*C,X=(g-x)*C,Z=(m-E)*A,ce=(1-(f+_))*A,ne=(w+T)*A,D=(g+x)*P,N=(w-T)*P,V=(1-(f+v))*P;return e[0]=G,e[1]=z,e[2]=X,e[3]=0,e[4]=Z,e[5]=ce,e[6]=ne,e[7]=0,e[8]=D,e[9]=N,e[10]=V,e[11]=0,e[12]=r[0]+I-(G*I+Z*L+D*k),e[13]=r[1]+L-(z*I+ce*L+N*k),e[14]=r[2]+k-(X*I+ne*L+V*k),e[15]=1,e}function u9e(e,t){const r=t[0],i=t[1],s=t[2],n=t[3],o=r+r,a=i+i,l=s+s,c=r*o,h=i*o,p=i*a,f=s*o,m=s*a,g=s*l,v=n*o,w=n*a,_=n*l;return e[0]=1-p-g,e[1]=h+_,e[2]=f-w,e[3]=0,e[4]=h-_,e[5]=1-c-g,e[6]=m+v,e[7]=0,e[8]=f+w,e[9]=m-v,e[10]=1-c-p,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Yxe(e,t,r,i,s,n,o){const a=1/(r-t),l=1/(s-i),c=1/(n-o);return e[0]=2*n*a,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=2*n*l,e[6]=0,e[7]=0,e[8]=(r+t)*a,e[9]=(s+i)*l,e[10]=(o+n)*c,e[11]=-1,e[12]=0,e[13]=0,e[14]=o*n*2*c,e[15]=0,e}function h9e(e,t,r,i,s){const n=1/Math.tan(t/2);let o;return e[0]=n/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=n,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,s!=null&&s!==1/0?(o=1/(i-s),e[10]=(s+i)*o,e[14]=2*s*i*o):(e[10]=-1,e[14]=-2*i),e}function d9e(e,t,r,i){const s=Math.tan(t.upDegrees*Math.PI/180),n=Math.tan(t.downDegrees*Math.PI/180),o=Math.tan(t.leftDegrees*Math.PI/180),a=Math.tan(t.rightDegrees*Math.PI/180),l=2/(o+a),c=2/(s+n);return e[0]=l,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=c,e[6]=0,e[7]=0,e[8]=-(o-a)*l*.5,e[9]=(s-n)*c*.5,e[10]=i/(r-i),e[11]=-1,e[12]=0,e[13]=0,e[14]=i*r/(r-i),e[15]=0,e}function rte(e,t,r,i,s,n,o){const a=1/(t-r),l=1/(i-s),c=1/(n-o);return e[0]=-2*a,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*l,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*c,e[11]=0,e[12]=(t+r)*a,e[13]=(s+i)*l,e[14]=(o+n)*c,e[15]=1,e}function w6(e,t,r,i){let s,n,o,a,l,c,h,p,f,m;const g=t[0],v=t[1],w=t[2],_=i[0],T=i[1],x=i[2],E=r[0],C=r[1],A=r[2];return Math.abs(g-E)<At&&Math.abs(v-C)<At&&Math.abs(w-A)<At?ig(e):(h=g-E,p=v-C,f=w-A,m=1/Math.sqrt(h*h+p*p+f*f),h*=m,p*=m,f*=m,s=T*f-x*p,n=x*h-_*f,o=_*p-T*h,m=Math.sqrt(s*s+n*n+o*o),m?(m=1/m,s*=m,n*=m,o*=m):(s=0,n=0,o=0),a=p*o-f*n,l=f*s-h*o,c=h*n-p*s,m=Math.sqrt(a*a+l*l+c*c),m?(m=1/m,a*=m,l*=m,c*=m):(a=0,l=0,c=0),e[0]=s,e[1]=a,e[2]=h,e[3]=0,e[4]=n,e[5]=l,e[6]=p,e[7]=0,e[8]=o,e[9]=c,e[10]=f,e[11]=0,e[12]=-(s*g+n*v+o*w),e[13]=-(a*g+l*v+c*w),e[14]=-(h*g+p*v+f*w),e[15]=1,e)}function Qxe(e,t,r,i){const s=t[0],n=t[1],o=t[2],a=i[0],l=i[1],c=i[2];let h=s-r[0],p=n-r[1],f=o-r[2],m=h*h+p*p+f*f;m>0&&(m=1/Math.sqrt(m),h*=m,p*=m,f*=m);let g=l*f-c*p,v=c*h-a*f,w=a*p-l*h;return m=g*g+v*v+w*w,m>0&&(m=1/Math.sqrt(m),g*=m,v*=m,w*=m),e[0]=g,e[1]=v,e[2]=w,e[3]=0,e[4]=p*w-f*v,e[5]=f*g-h*w,e[6]=h*v-p*g,e[7]=0,e[8]=h,e[9]=p,e[10]=f,e[11]=0,e[12]=s,e[13]=n,e[14]=o,e[15]=1,e}function p9e(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"}function f9e(e){return Math.sqrt(e[0]**2+e[1]**2+e[2]**2+e[3]**2+e[4]**2+e[5]**2+e[6]**2+e[7]**2+e[8]**2+e[9]**2+e[10]**2+e[11]**2+e[12]**2+e[13]**2+e[14]**2+e[15]**2)}function m9e(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e[4]=t[4]+r[4],e[5]=t[5]+r[5],e[6]=t[6]+r[6],e[7]=t[7]+r[7],e[8]=t[8]+r[8],e[9]=t[9]+r[9],e[10]=t[10]+r[10],e[11]=t[11]+r[11],e[12]=t[12]+r[12],e[13]=t[13]+r[13],e[14]=t[14]+r[14],e[15]=t[15]+r[15],e}function Jxe(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e[4]=t[4]-r[4],e[5]=t[5]-r[5],e[6]=t[6]-r[6],e[7]=t[7]-r[7],e[8]=t[8]-r[8],e[9]=t[9]-r[9],e[10]=t[10]-r[10],e[11]=t[11]-r[11],e[12]=t[12]-r[12],e[13]=t[13]-r[13],e[14]=t[14]-r[14],e[15]=t[15]-r[15],e}function g9e(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=t[7]*r,e[8]=t[8]*r,e[9]=t[9]*r,e[10]=t[10]*r,e[11]=t[11]*r,e[12]=t[12]*r,e[13]=t[13]*r,e[14]=t[14]*r,e[15]=t[15]*r,e}function y9e(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e[2]=t[2]+r[2]*i,e[3]=t[3]+r[3]*i,e[4]=t[4]+r[4]*i,e[5]=t[5]+r[5]*i,e[6]=t[6]+r[6]*i,e[7]=t[7]+r[7]*i,e[8]=t[8]+r[8]*i,e[9]=t[9]+r[9]*i,e[10]=t[10]+r[10]*i,e[11]=t[11]+r[11]*i,e[12]=t[12]+r[12]*i,e[13]=t[13]+r[13]*i,e[14]=t[14]+r[14]*i,e[15]=t[15]+r[15]*i,e}function v9e(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]&&e[9]===t[9]&&e[10]===t[10]&&e[11]===t[11]&&e[12]===t[12]&&e[13]===t[13]&&e[14]===t[14]&&e[15]===t[15]}function Kxe(e,t){if(e===t)return!0;const r=e[0],i=e[1],s=e[2],n=e[3],o=e[4],a=e[5],l=e[6],c=e[7],h=e[8],p=e[9],f=e[10],m=e[11],g=e[12],v=e[13],w=e[14],_=e[15],T=t[0],x=t[1],E=t[2],C=t[3],A=t[4],P=t[5],I=t[6],L=t[7],k=t[8],G=t[9],z=t[10],X=t[11],Z=t[12],ce=t[13],ne=t[14],D=t[15];return Math.abs(r-T)<=At*Math.max(1,Math.abs(r),Math.abs(T))&&Math.abs(i-x)<=At*Math.max(1,Math.abs(i),Math.abs(x))&&Math.abs(s-E)<=At*Math.max(1,Math.abs(s),Math.abs(E))&&Math.abs(n-C)<=At*Math.max(1,Math.abs(n),Math.abs(C))&&Math.abs(o-A)<=At*Math.max(1,Math.abs(o),Math.abs(A))&&Math.abs(a-P)<=At*Math.max(1,Math.abs(a),Math.abs(P))&&Math.abs(l-I)<=At*Math.max(1,Math.abs(l),Math.abs(I))&&Math.abs(c-L)<=At*Math.max(1,Math.abs(c),Math.abs(L))&&Math.abs(h-k)<=At*Math.max(1,Math.abs(h),Math.abs(k))&&Math.abs(p-G)<=At*Math.max(1,Math.abs(p),Math.abs(G))&&Math.abs(f-z)<=At*Math.max(1,Math.abs(f),Math.abs(z))&&Math.abs(m-X)<=At*Math.max(1,Math.abs(m),Math.abs(X))&&Math.abs(g-Z)<=At*Math.max(1,Math.abs(g),Math.abs(Z))&&Math.abs(v-ce)<=At*Math.max(1,Math.abs(v),Math.abs(ce))&&Math.abs(w-ne)<=At*Math.max(1,Math.abs(w),Math.abs(ne))&&Math.abs(_-D)<=At*Math.max(1,Math.abs(_),Math.abs(D))}function ite(e){const t=At,r=e[0],i=e[1],s=e[2],n=e[4],o=e[5],a=e[6],l=e[8],c=e[9],h=e[10];return Math.abs(1-(r*r+n*n+l*l))<=t&&Math.abs(1-(i*i+o*o+c*c))<=t&&Math.abs(1-(s*s+a*a+h*h))<=t}const _9e=Yi,b9e=Jxe;Object.freeze(Object.defineProperty({__proto__:null,copy:Is,set:gg,identity:ig,transpose:lc,invert:Cs,adjoint:e9e,determinant:t9e,multiply:Yi,translate:yl,scale:v6,rotate:qc,rotateX:lA,rotateY:_6,rotateZ:cA,fromTranslation:b6,fromScaling:r9e,fromRotation:_h,fromXRotation:qxe,fromYRotation:i9e,fromZRotation:Wxe,fromRotationTranslation:Xxe,fromQuat2:s9e,getTranslation:o9e,getScaling:Zxe,getRotation:a9e,fromRotationTranslationScale:l9e,fromRotationTranslationScaleOrigin:c9e,fromQuat:u9e,frustum:Yxe,perspective:h9e,perspectiveFromFieldOfView:d9e,ortho:rte,lookAt:w6,targetTo:Qxe,str:p9e,frob:f9e,add:m9e,subtract:Jxe,multiplyScalar:g9e,multiplyScalarAndAdd:y9e,exactEquals:v9e,equals:Kxe,isOrthoNormal:ite,mul:_9e,sub:b9e},Symbol.toStringTag,{value:"Module"}));let X9,oe=null;function eTe(){return!!oe}function w9e(){return!!he("esri-wasm")}function tTe(){return X9||(X9=ie(()=>import("./pe-wasm.9649c26b.js"),[],import.meta.url).then(e=>e.p).then(({default:e})=>e({locateFile:t=>wr(`esri/geometry/support/${t}`)})).then(e=>{iTe(e)}),X9)}var xX,vs,TX;(function(e){function t(n,o,a){oe.ensureCache.prepare();const l=Zw(a),c=a===l,h=oe.ensureFloat64(l),p=oe._pe_geog_to_proj(oe.getPointer(n),o,h);return p&&T_(a,o,h,c),p}function r(n,o,a,l){switch(l){case vs.PE_TRANSFORM_P_TO_G:return i(n,o,a);case vs.PE_TRANSFORM_G_TO_P:return t(n,o,a)}return 0}function i(n,o,a){return s(n,o,a,0)}function s(n,o,a,l){oe.ensureCache.prepare();const c=Zw(a),h=a===c,p=oe.ensureFloat64(c),f=oe._pe_proj_to_geog_center(oe.getPointer(n),o,p,l);return f&&T_(a,o,p,h),f}e.geogToProj=t,e.projGeog=r,e.projToGeog=i,e.projToGeogCenter=s})(xX||(xX={})),function(e){function t(){e.PE_BUFFER_MAX=oe.PeDefs.prototype.PE_BUFFER_MAX,e.PE_NAME_MAX=oe.PeDefs.prototype.PE_NAME_MAX,e.PE_MGRS_MAX=oe.PeDefs.prototype.PE_MGRS_MAX,e.PE_USNG_MAX=oe.PeDefs.prototype.PE_USNG_MAX,e.PE_DD_MAX=oe.PeDefs.prototype.PE_DD_MAX,e.PE_DDM_MAX=oe.PeDefs.prototype.PE_DDM_MAX,e.PE_DMS_MAX=oe.PeDefs.prototype.PE_DMS_MAX,e.PE_UTM_MAX=oe.PeDefs.prototype.PE_UTM_MAX,e.PE_PARM_MAX=oe.PeDefs.prototype.PE_PARM_MAX,e.PE_TYPE_NONE=oe.PeDefs.prototype.PE_TYPE_NONE,e.PE_TYPE_GEOGCS=oe.PeDefs.prototype.PE_TYPE_GEOGCS,e.PE_TYPE_PROJCS=oe.PeDefs.prototype.PE_TYPE_PROJCS,e.PE_TYPE_GEOGTRAN=oe.PeDefs.prototype.PE_TYPE_GEOGTRAN,e.PE_TYPE_COORDSYS=oe.PeDefs.prototype.PE_TYPE_COORDSYS,e.PE_TYPE_UNIT=oe.PeDefs.prototype.PE_TYPE_UNIT,e.PE_TYPE_LINUNIT=oe.PeDefs.prototype.PE_TYPE_LINUNIT,e.PE_STR_OPTS_NONE=oe.PeDefs.prototype.PE_STR_OPTS_NONE,e.PE_STR_AUTH_NONE=oe.PeDefs.prototype.PE_STR_AUTH_NONE,e.PE_STR_AUTH_TOP=oe.PeDefs.prototype.PE_STR_AUTH_TOP,e.PE_STR_NAME_CANON=oe.PeDefs.prototype.PE_STR_NAME_CANON,e.PE_PARM_X0=oe.PeDefs.prototype.PE_PARM_X0,e.PE_PARM_ND=oe.PeDefs.prototype.PE_PARM_ND,e.PE_TRANSFORM_1_TO_2=oe.PeDefs.prototype.PE_TRANSFORM_1_TO_2,e.PE_TRANSFORM_2_TO_1=oe.PeDefs.prototype.PE_TRANSFORM_2_TO_1,e.PE_TRANSFORM_P_TO_G=oe.PeDefs.prototype.PE_TRANSFORM_P_TO_G,e.PE_TRANSFORM_G_TO_P=oe.PeDefs.prototype.PE_TRANSFORM_G_TO_P,e.PE_HORIZON_RECT=oe.PeDefs.prototype.PE_HORIZON_RECT,e.PE_HORIZON_POLY=oe.PeDefs.prototype.PE_HORIZON_POLY,e.PE_HORIZON_LINE=oe.PeDefs.prototype.PE_HORIZON_LINE,e.PE_HORIZON_DELTA=oe.PeDefs.prototype.PE_HORIZON_DELTA}e.init=t}(vs||(vs={})),function(e){const t={},r={},i=m=>{if(m){const g=m.getType();switch(g){case vs.PE_TYPE_GEOGCS:m=oe.castObject(m,oe.PeGeogcs);break;case vs.PE_TYPE_PROJCS:m=oe.castObject(m,oe.PeProjcs);break;case vs.PE_TYPE_GEOGTRAN:m=oe.castObject(m,oe.PeGeogtran);break;default:g&vs.PE_TYPE_UNIT&&(m=oe.castObject(m,oe.PeUnit))}}return m};function s(){oe.PeFactory.prototype.initialize(null)}function n(m){return o(vs.PE_TYPE_COORDSYS,m)}function o(m,g){let v=null,w=t[m];if(w||(w={},t[m]=w),w.hasOwnProperty(String(g)))v=w[g];else{const _=oe.PeFactory.prototype.factoryByType(m,g);oe.compare(_,oe.NULL)||(v=_,w[g]=v)}return v=i(v),v}function a(m,g){let v=null,w=r[m];if(w||(w={},r[m]=w),w.hasOwnProperty(g))v=w[g];else{const _=oe.PeFactory.prototype.fromString(m,g);oe.compare(_,oe.NULL)||(v=_,w[g]=v)}return v=i(v),v}function l(m){return o(vs.PE_TYPE_GEOGCS,m)}function c(m){return o(vs.PE_TYPE_GEOGTRAN,m)}function h(m){return oe.PeFactory.prototype.getCode(m)}function p(m){return o(vs.PE_TYPE_PROJCS,m)}function f(m){return o(vs.PE_TYPE_UNIT,m)}e.initialize=s,e.coordsys=n,e.factoryByType=o,e.fromString=a,e.geogcs=l,e.geogtran=c,e.getCode=h,e.projcs=p,e.unit=f}(TX||(TX={}));let rTe=null;var DU,SX,EX,CX,NU,AX,FU,kU,RX;function iTe(e){function t(n,o,a){n[o]=a(n[o])}oe=e,vs.init(),DU.init(),NU.init(),FU.init(),kU.init(),rTe=class extends oe.PeGCSExtent{destroy(){oe.destroy(this)}};const r=[oe.PeDatum,oe.PeGeogcs,oe.PeGeogtran,oe.PeObject,oe.PeParameter,oe.PePrimem,oe.PeProjcs,oe.PeSpheroid,oe.PeUnit];for(const n of r)t(n.prototype,"getName",o=>function(){return o.call(this,new Array(vs.PE_NAME_MAX))});for(const n of[oe.PeGeogtran,oe.PeProjcs])t(n.prototype,"getParameters",o=>function(){const a=new Array(vs.PE_PARM_MAX);let l=o.call(this);for(let c=0;c<a.length;c++){const h=oe.getValue(l,"*");a[c]=h?oe.wrapPointer(h,oe.PeParameter):null,l+=Int32Array.BYTES_PER_ELEMENT}return a});t(oe.PeHorizon.prototype,"getCoord",n=>function(){const o=this.getSize();if(!o)return null;const a=[];return T_(a,o,n.call(this)),a}),t(oe.PeGTlistExtendedEntry.prototype,"getEntries",n=>{const o=oe._pe_getPeGTlistExtendedGTsSize();return function(){let a=null;const l=n.call(this);if(!oe.compare(l,oe.NULL)){a=[l];const c=this.getSteps();if(c>1){const h=oe.getPointer(l);for(let p=1;p<c;p++)a.push(oe.wrapPointer(h+o*p,oe.PeGTlistExtendedGTs))}}return a}});const i=oe._pe_getPeHorizonSize(),s=n=>function(){let o=this._cache;if(o||(o=new Map,this._cache=o),o.has(n))return o.get(n);let a=null;const l=n.call(this);if(!oe.compare(l,oe.NULL)){a=[l];const c=l.getNump();if(c>1){const h=oe.getPointer(l);for(let p=1;p<c;p++)a.push(oe.wrapPointer(h+i*p,oe.PeHorizon))}}return o.set(n,a),a};t(oe.PeProjcs.prototype,"horizonGcsGenerate",s),t(oe.PeProjcs.prototype,"horizonPcsGenerate",s),oe.PeObject.prototype.toString=function(n=vs.PE_STR_OPTS_NONE){oe.ensureCache.prepare();const o=oe.getPointer(this),a=oe.ensureInt8(new Array(vs.PE_BUFFER_MAX));return oe.UTF8ToString(oe._pe_object_to_string_ext(o,n,a))}}function Cg(e){if(!e)return;const t=oe.getClass(e);if(!t)return;const r=oe.getCache(t);if(!r)return;const i=oe.getPointer(e);i&&delete r[i]}function $D(e,t){const r=[],i=new Array(t);for(let s=0;s<e;s++)r.push(oe.ensureInt8(i));return r}function Zw(e){let t;return Array.isArray(e[0])?(t=[],e.forEach(r=>{t.push(r[0],r[1])})):t=e,t}function T_(e,t,r,i=!1){if(i)for(let s=0;s<2*t;s++)e[s]=oe.getValue(r+s*Float64Array.BYTES_PER_ELEMENT,"double");else{const s=e.length===0;for(let n=0;n<t;n++)s&&(e[n]=new Array(2)),e[n][0]=oe.getValue(r,"double"),e[n][1]=oe.getValue(r+Float64Array.BYTES_PER_ELEMENT,"double"),r+=2*Float64Array.BYTES_PER_ELEMENT}}(function(e){let t;function r(){e.PE_GTLIST_OPTS_COMMON=oe.PeGTlistExtended.prototype.PE_GTLIST_OPTS_COMMON,t=oe._pe_getPeGTlistExtendedEntrySize()}function i(s,n,o,a,l,c){let h=null;const p=new oe.PeInteger(c);try{const f=oe.PeGTlistExtended.prototype.getGTlist(s,n,o,a,l,p);if((c=p.val)&&(h=[f],c>1)){const m=oe.getPointer(f);for(let g=1;g<c;g++)h.push(oe.wrapPointer(m+t*g,oe.PeGTlistExtendedEntry))}}finally{oe.destroy(p)}return h}e.init=r,e.getGTlist=i})(DU||(DU={})),function(e){function t(r){if(r&&r.length){for(const i of r)Cg(i),i.getEntries().forEach(s=>{Cg(s);const n=s.getGeogtran();Cg(n),n.getParameters().forEach(Cg),[n.getGeogcs1(),n.getGeogcs2()].forEach(o=>{Cg(o);const a=o.getDatum();Cg(a),Cg(a.getSpheroid()),Cg(o.getPrimem()),Cg(o.getUnit())})});oe.PeGTlistExtendedEntry.prototype.Delete(r[0])}}e.destroy=t}(SX||(SX={})),function(e){function t(r,i,s,n,o){oe.ensureCache.prepare();const a=Zw(s),l=s===a,c=oe.ensureFloat64(a);let h=0;n&&(h=oe.ensureFloat64(n));const p=oe._pe_geog_to_geog(oe.getPointer(r),i,c,h,o);return p&&T_(s,i,c,l),p}e.geogToGeog=t}(EX||(EX={})),function(e){const t=(c,h,p,f,m,g)=>{let v,w;switch(oe.ensureCache.prepare(),c){case"dd":v=oe._pe_geog_to_dd,w=vs.PE_DD_MAX;break;case"ddm":v=oe._pe_geog_to_ddm,w=vs.PE_DDM_MAX;break;case"dms":v=oe._pe_geog_to_dms,w=vs.PE_DMS_MAX}let _=0;h&&(_=oe.getPointer(h));const T=Zw(f),x=oe.ensureFloat64(T),E=$D(p,w),C=v(_,p,x,m,oe.ensureInt32(E));if(C)for(let A=0;A<p;A++)g[A]=oe.UTF8ToString(E[A]);return C},r=(c,h,p,f,m)=>{let g;switch(oe.ensureCache.prepare(),c){case"dd":g=oe._pe_dd_to_geog;break;case"ddm":g=oe._pe_ddm_to_geog;break;case"dms":g=oe._pe_dms_to_geog}let v=0;h&&(v=oe.getPointer(h));const w=f.map(E=>oe.ensureString(E)),_=oe.ensureInt32(w),T=oe.ensureFloat64(new Array(2*p)),x=g(v,p,_,T);return x&&T_(m,p,T),x};function i(c,h,p,f,m){return t("dms",c,h,p,f,m)}function s(c,h,p,f){return r("dms",c,h,p,f)}function n(c,h,p,f,m){return t("ddm",c,h,p,f,m)}function o(c,h,p,f){return r("ddm",c,h,p,f)}function a(c,h,p,f,m){return t("dd",c,h,p,f,m)}function l(c,h,p,f){return r("dd",c,h,p,f)}e.geogToDms=i,e.dmsToGeog=s,e.geogToDdm=n,e.ddmToGeog=o,e.geogToDd=a,e.ddToGeog=l}(CX||(CX={})),function(e){function t(){e.PE_MGRS_STYLE_NEW=oe.PeNotationMgrs.prototype.PE_MGRS_STYLE_NEW,e.PE_MGRS_STYLE_OLD=oe.PeNotationMgrs.prototype.PE_MGRS_STYLE_OLD,e.PE_MGRS_STYLE_AUTO=oe.PeNotationMgrs.prototype.PE_MGRS_STYLE_AUTO,e.PE_MGRS_180_ZONE_1_PLUS=oe.PeNotationMgrs.prototype.PE_MGRS_180_ZONE_1_PLUS,e.PE_MGRS_ADD_SPACES=oe.PeNotationMgrs.prototype.PE_MGRS_ADD_SPACES}function r(s,n,o,a,l,c,h){oe.ensureCache.prepare();let p=0;s&&(p=oe.getPointer(s));const f=Zw(o),m=oe.ensureFloat64(f),g=$D(n,vs.PE_MGRS_MAX),v=oe.ensureInt32(g),w=oe._pe_geog_to_mgrs_extended(p,n,m,a,l,c,v);if(w)for(let _=0;_<n;_++)h[_]=oe.UTF8ToString(g[_]);return w}function i(s,n,o,a,l){oe.ensureCache.prepare();let c=0;s&&(c=oe.getPointer(s));const h=o.map(g=>oe.ensureString(g)),p=oe.ensureInt32(h),f=oe.ensureFloat64(new Array(2*n)),m=oe._pe_mgrs_to_geog_extended(c,n,p,a,f);return m&&T_(l,n,f),m}e.init=t,e.geogToMgrsExtended=r,e.mgrsToGeogExtended=i}(NU||(NU={})),function(e){function t(i,s,n,o,a,l,c){oe.ensureCache.prepare();let h=0;i&&(h=oe.getPointer(i));const p=Zw(n),f=oe.ensureFloat64(p),m=$D(s,vs.PE_MGRS_MAX),g=oe.ensureInt32(m),v=oe._pe_geog_to_usng(h,s,f,o,a,l,g);if(v)for(let w=0;w<s;w++)c[w]=oe.UTF8ToString(m[w]);return v}function r(i,s,n,o){oe.ensureCache.prepare();let a=0;i&&(a=oe.getPointer(i));const l=n.map(f=>oe.ensureString(f)),c=oe.ensureInt32(l),h=oe.ensureFloat64(new Array(2*s)),p=oe._pe_usng_to_geog(a,s,c,h);return p&&T_(o,s,h),p}e.geogToUsng=t,e.usngToGeog=r}(AX||(AX={})),function(e){function t(){e.PE_UTM_OPTS_NONE=oe.PeNotationUtm.prototype.PE_UTM_OPTS_NONE,e.PE_UTM_OPTS_ADD_SPACES=oe.PeNotationUtm.prototype.PE_UTM_OPTS_ADD_SPACES,e.PE_UTM_OPTS_NS=oe.PeNotationUtm.prototype.PE_UTM_OPTS_NS}function r(s,n,o,a,l){oe.ensureCache.prepare();let c=0;s&&(c=oe.getPointer(s));const h=Zw(o),p=oe.ensureFloat64(h),f=$D(n,vs.PE_UTM_MAX),m=oe.ensureInt32(f),g=oe._pe_geog_to_utm(c,n,p,a,m);if(g)for(let v=0;v<n;v++)l[v]=oe.UTF8ToString(f[v]);return g}function i(s,n,o,a,l){oe.ensureCache.prepare();let c=0;s&&(c=oe.getPointer(s));const h=o.map(g=>oe.ensureString(g)),p=oe.ensureInt32(h),f=oe.ensureFloat64(new Array(2*n)),m=oe._pe_utm_to_geog(c,n,p,a,f);return m&&T_(l,n,f),m}e.init=t,e.geogToUtm=r,e.utmToGeog=i}(FU||(FU={})),function(e){const t=new Map;function r(){e.PE_PCSINFO_OPTION_NONE=oe.PePCSInfo.prototype.PE_PCSINFO_OPTION_NONE,e.PE_PCSINFO_OPTION_DOMAIN=oe.PePCSInfo.prototype.PE_PCSINFO_OPTION_DOMAIN,e.PE_POLE_OUTSIDE_BOUNDARY=oe.PePCSInfo.prototype.PE_POLE_OUTSIDE_BOUNDARY,e.PE_POLE_POINT=oe.PePCSInfo.prototype.PE_POLE_POINT}function i(s,n=e.PE_PCSINFO_OPTION_DOMAIN){let o,a;return t.has(s)&&(a=t.get(s),a[n]&&(o=a[n])),o||(o=oe.PePCSInfo.prototype.generate(s,n),a||(a=[],t.set(s,a)),a[n]=o),o}e.init=r,e.generate=i}(kU||(kU={})),function(e){function t(){return oe.PeVersion.prototype.version_string()}e.versionString=t}(RX||(RX={}));const x9e=Object.freeze(Object.defineProperty({__proto__:null,get _pe(){return oe},isLoaded:eTe,isSupported:w9e,load:tTe,get PeCSTransformations(){return xX},get PeDefs(){return vs},get PeFactory(){return TX},get PeGCSExtent(){return rTe},get PeGTlistExtended(){return DU},get PeGTlistExtendedEntry(){return SX},get PeGTTransformations(){return EX},get PeNotationDms(){return CX},get PeNotationMgrs(){return NU},get PeNotationUsng(){return AX},get PeNotationUtm(){return FU},get PePCSInfo(){return kU},get PeVersion(){return RX},_init:iTe},Symbol.toStringTag,{value:"Module"})),i$t=Math.PI/180,s$t=/SPHEROID\[([^\]]+)]/i,H0=$r.radius,ip=$r.eccentricitySquared,T9e={a1:H0*ip,a2:H0*ip*H0*ip,a3:H0*ip*ip/2,a4:H0*ip*H0*ip*2.5,a5:H0*ip+H0*ip*ip/2,a6:1-ip},n$t={4267:{a:63782064e-1,f:1/294.9786982},4269:{a:6378137,f:1/298.257222101},4326:{a:$r.radius,f:$r.flattening},104900:{a:2439700,f:0},104901:{a:6051e3,f:0},104902:{a:6051800,f:0},104903:{a:c0.radius,f:c0.flattening},104904:{a:3393400,f:1/192.0430107526882},104905:{a:zm.radius,f:zm.flattening},104906:{a:6200,f:0},104907:{a:11100,f:0},104908:{a:71492e3,f:.06487439154031222},104909:{a:8200,f:0},104910:{a:83500,f:0},104911:{a:1e4,f:0},104912:{a:2409300,f:0},104913:{a:15e3,f:0},104914:{a:4e4,f:0},104915:{a:1562090,f:0},104916:{a:2632345,f:0},104917:{a:85e3,f:0},104918:{a:1821460,f:0},104919:{a:5e3,f:0},104920:{a:12e3,f:0},104921:{a:3e4,f:3},104922:{a:18e3,f:0},104923:{a:14e3,f:0},104924:{a:49300,f:0},104925:{a:60268e3,f:1/10.2079945799458},104926:{a:16e3,f:0},104927:{a:9500,f:0},104928:{a:56e4,f:0},104929:{a:249400,f:0},104930:{a:59500,f:0},104931:{a:16e3,f:0},104932:{a:133e3,f:0},104933:{a:718e3,f:0},104934:{a:888e3,f:0},104935:{a:1986300,f:0},104936:{a:1e4,f:0},104937:{a:41900,f:0},104938:{a:11e4,f:0},104939:{a:50100,f:0},104940:{a:764e3,f:0},104941:{a:11e3,f:0},104942:{a:529800,f:0},104943:{a:2575e3,f:0},104944:{a:25559e3,f:1/43.61604095563141},104945:{a:578900,f:0},104946:{a:33e3,f:0},104947:{a:21e3,f:0},104948:{a:13e3,f:0},104949:{a:31e3,f:0},104950:{a:27e3,f:0},104951:{a:42e3,f:0},104952:{a:235800,f:0},104953:{a:761400,f:0},104954:{a:15e3,f:0},104955:{a:54e3,f:0},104956:{a:77e3,f:0},104957:{a:27e3,f:0},104958:{a:788900,f:0},104959:{a:584700,f:0},104960:{a:24764e3,f:.01708124697141011},104961:{a:74e3,f:0},104962:{a:79e3,f:0},104963:{a:104e3,f:.14423076923076922},104964:{a:29e3,f:0},104965:{a:17e4,f:0},104966:{a:208e3,f:0},104967:{a:4e4,f:0},104968:{a:1352600,f:0},104969:{a:1195e3,f:0},104970:{a:593e3,f:0},104971:{a:zm.radius,f:0},104972:{a:47e4,f:0},104973:{a:255e3,f:0},104974:{a:2439400,f:0}};let LD=0;class uC{constructor(t=null){this.uid=LD++,t?(this._wkt=t.wkt!==void 0?t.wkt:null,this._wkid=t.wkid!==void 0?t.wkid:-1,this._isInverse=t.isInverse!==void 0&&t.isInverse===!0):(this._wkt=null,this._wkid=-1,this._isInverse=!1)}static fromGE(t){const r=new uC;return r._wkt=t.wkt,r._wkid=t.wkid,r._isInverse=t.isInverse,r}get wkt(){return this._wkt}set wkt(t){this._wkt=t,this.uid=LD++}get wkid(){return this._wkid}set wkid(t){this._wkid=t,this.uid=LD++}get isInverse(){return this._isInverse}set isInverse(t){this._isInverse=t,this.uid=LD++}getInverse(){const t=new uC;return t._wkt=this.wkt,t._wkid=this._wkid,t._isInverse=!this.isInverse,t}}class k_{constructor(t){if(this.steps=[],this._cached_projection={},this._chain="",this._gtlistentry=null,t&&t.steps)for(const r of t.steps)r instanceof uC?this.steps.push(r):this.steps.push(new uC({wkid:r.wkid,wkt:r.wkt,isInverse:r.isInverse}))}static cacheKey(t,r){return[t.wkid!==void 0&&t.wkid!==null?t.wkid.toString():"-1",t.wkt!==void 0&&t.wkt!==null?t.wkt.toString():"",r.wkid!==void 0&&r.wkid!==null?r.wkid.toString():"-1",r.wkt!==void 0&&r.wkt!==null?r.wkt.toString():""].join(",")}static fromGE(t){const r=new k_;let i="";for(const s of t.steps){const n=uC.fromGE(s);r.steps.push(n),i+=n.uid.toString()+","}return r._cached_projection={},r._gtlistentry=null,r._chain=i,r}getInverse(){const t=new k_;t.steps=[];for(let r=this.steps.length-1;r>=0;r--){const i=this.steps[r];t.steps.push(i.getInverse())}return t}getGTListEntry(){let t="";for(const r of this.steps)t+=r.uid.toString()+",";return t!==this._chain&&(this._gtlistentry=null,this._cached_projection={},this._chain=t),this._gtlistentry}assignCachedGe(t,r,i){this._cached_projection[k_.cacheKey(t,r)]=i}getCachedGeTransformation(t,r){let i="";for(const n of this.steps)i+=n.uid.toString()+",";i!==this._chain&&(this._gtlistentry=null,this._cached_projection={},this._chain=i);const s=this._cached_projection[k_.cacheKey(t,r)];return s===void 0?null:s}}function sTe(e,t,r){if(R(t)||R(r)||r.vcsWkid||ml(t,r))return null;const i=aA(t)/aA(r);if(i===1)return null;switch(e){case"point":case"esriGeometryPoint":return s=>S9e(s,i);case"polyline":case"esriGeometryPolyline":return s=>C9e(s,i);case"polygon":case"esriGeometryPolygon":return s=>E9e(s,i);case"multipoint":case"esriGeometryMultipoint":return s=>A9e(s,i);case"extent":case"esriGeometryExtent":return s=>R9e(s,i);default:return null}}function S9e(e,t){e&&e.z!=null&&(e.z*=t)}function E9e(e,t){if(e)for(const r of e.rings)for(const i of r)i.length>2&&(i[2]*=t)}function C9e(e,t){if(e)for(const r of e.paths)for(const i of r)i.length>2&&(i[2]*=t)}function A9e(e,t){if(e)for(const r of e.points)r.length>2&&(r[2]*=t)}function R9e(e,t){e&&e.zmin!=null&&e.zmax!=null&&(e.zmin*=t,e.zmax*=t)}let c1=null,UU=null,Z9=null,Y9={};const nTe=new j1e;function x6(){return!!c1&&eTe()}function mI(e){return R(Z9)&&(Z9=Promise.all([tTe(),ie(()=>import("./geometryEngineBase.0f0d7ecf.js"),[],import.meta.url).then(t=>t.g),ie(()=>import("./hydrated.c9acaaf8.js"),[],import.meta.url)])),Z9.then(([,t,{hydratedAdapter:r}])=>{Jt(e),UU=r,c1=t.default,c1._enableProjection(x9e),nTe.notify()})}function Q$(e,t,r=null,i=null){return Array.isArray(e)?e.length===0?[]:wle(UU,e,e[0].spatialReference,t,r,i):wle(UU,[e],e.spatialReference,t,r,i)[0]}function wle(e,t,r,i,s=null,n=null){if(R(r)||R(i))return t;if(sg(r,i,s))return t.map(o=>oTe(o,r,i));if(R(s)){const o=k_.cacheKey(r,i);Y9[o]!==void 0?s=Y9[o]:(s=O9e(r,i,null),R(s)&&(s=new k_),Y9[o]=s)}if(R(c1))throw new ste;return b(n)?c1._project(e,t,r,i,s,n):c1._project(e,t,r,i,s)}function o$t(e,t){return R(e)?{pending:null,geometry:null}:ml(e.spatialReference,t)?{pending:null,geometry:e}:nc(e.spatialReference)&&nc(t)?sg(e.spatialReference,t)||x6()?{pending:null,geometry:M9e(e,t)}:(ir(nTe),{pending:mI(),geometry:null}):{pending:null,geometry:null}}function O9e(e,t,r=null){if(R(c1))throw new ste;if(R(e)||R(t))return null;const i=c1._getTransformation(UU,e,t,r,r==null?void 0:r.spatialReference);return i!==null?k_.fromGE(i):null}class ste extends j{constructor(){super("projection:not-loaded","projection engine not fully loaded yet, please call load()")}}var J;(function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.SPHERICAL_ECEF=1]="SPHERICAL_ECEF",e[e.WGS84=2]="WGS84",e[e.WEB_MERCATOR=3]="WEB_MERCATOR",e[e.WGS84_ECEF=4]="WGS84_ECEF",e[e.CGCS2000=5]="CGCS2000",e[e.WGS84_COMPARABLE_LON_LAT=6]="WGS84_COMPARABLE_LON_LAT",e[e.SPHERICAL_MARS_PCPF=7]="SPHERICAL_MARS_PCPF",e[e.GCSMARS2000=8]="GCSMARS2000",e[e.SPHERICAL_MOON_PCPF=9]="SPHERICAL_MOON_PCPF",e[e.GCSMOON2000=10]="GCSMOON2000",e[e.LON_LAT=11]="LON_LAT",e[e.PLATE_CARREE=12]="PLATE_CARREE"})(J||(J={}));function M9e(e,t){try{const r=Q$(e,t);if(r==null)return null;"xmin"in e&&"xmin"in r&&(r.zmin=e.zmin,r.zmax=e.zmax);const i=sTe(r.type,e.spatialReference,t);return b(i)&&i(r),r}catch(r){if(!(r instanceof ste))throw r;return null}}function sg(e,t,r){return!r&&(!!ml(e,t)||nc(e)&&nc(t)&&!!lte(e,t,ute))}async function a$t(e,t,r,i){if(x6())return eae(i);if(Array.isArray(e)){for(const{source:s,dest:n,geographicTransformation:o}of e)if(!sg(s,n,o))return mI(i)}else if(!sg(e,t,r))return mI(i);return eae(i)}function l$t(e,t){switch(lte(e,t,ute)){case wi:return"copy3";case V_:return"wgs84ToSphericalECEF";case hT:return"wgs84ToWebMercator";case U_:return"wgs84ToPlateCarree";case B_:return"wgs84ToWGS84ECEF";case Vx:return"webMercatorToWGS84";case dTe:return"webMercatorToSphericalECEF";case pTe:return"webMercatorToWGS84ECEF";case fTe:return"webMercatorToPlateCarree";case G_:return"wgs84ECEFToWGS84";case yTe:return"wgs84ECEFToSphericalECEF";case vTe:return"wgs84ECEFToWebMercator";case z_:return"sphericalECEFToWGS84";case mTe:return"sphericalECEFToWebMercator";case IX:return"sphericalMarsPCPFToMars2000";case PX:return"sphericalMoonPCPFToMoon2000";case gTe:return"sphericalECEFToWGS84ECEF";case MX:return"mars2000ToSphericalPCPF";case OX:return"moon2000ToSphericalPCPF";default:return null}}function oTe(e,t,r){return e?"x"in e?aTe(e,t,new at,r,0):"xmin"in e?D9e(e,t,new Kt,r,0):"rings"in e?lTe(e,t,new Oa,r,0):"paths"in e?$9e(e,t,new sh,r,0):"points"in e?I9e(e,t,new GT,r,0):null:null}function P9e(e,t,r=t.spatialReference,i=0){return!R(r)&&b(aTe(e,e.spatialReference,t,r,i))}function aTe(e,t,r,i,s){Hr[0]=e.x,Hr[1]=e.y;const n=e.z;return Hr[2]=n!==void 0?n:s,mi(Hr,t,0,Hr,i,0,1)?(r.x=Hr[0],r.y=Hr[1],r.spatialReference=i,n===void 0?(r.z=void 0,r.hasZ=!1):(r.z=Hr[2],r.hasZ=!0),e.m===void 0?(r.m=void 0,r.hasM=!1):(r.m=e.m,r.hasM=!0),r):null}function I9e(e,t,r,i,s){const{points:n,hasZ:o,hasM:a}=e,l=[],c=n.length,h=[];for(const p of n)h.push(p[0],p[1],o?p[2]:s);if(!mi(h,t,0,h,i,0,c))return null;for(let p=0;p<c;++p){const f=3*p,m=h[f],g=h[f+1];o&&a?l.push([m,g,h[f+2],n[p][3]]):o?l.push([m,g,h[f+2]]):a?l.push([m,g,n[p][2]]):l.push([m,g])}return r.points=l,r.spatialReference=i,r.hasZ=o,r.hasM=a,r}function $9e(e,t,r,i,s){const{paths:n,hasZ:o,hasM:a}=e,l=[];return uTe(n,o,a,t,l,i,s)?(r.paths=l,r.spatialReference=i,r.hasZ=o,r.hasM=a,r):null}function L9e(e,t,r=t.spatialReference,i=0){return b(r)&&b(lTe(e,e.spatialReference,t,r,i))}function lTe(e,t,r,i,s){const{rings:n,hasZ:o,hasM:a}=e,l=[];return uTe(n,o,a,t,l,i,s)?(r.rings=l,r.spatialReference=i,r.hasZ=o,r.hasM=a,r):null}function D9e(e,t,r,i,s){const{xmin:n,ymin:o,xmax:a,ymax:l,hasZ:c,hasM:h}=e;return xle(n,o,c?e.zmin:s,t,Hr,i)?(r.xmin=Hr[0],r.ymin=Hr[1],c&&(r.zmin=Hr[2]),xle(a,l,c?e.zmax:s,t,Hr,i)?(r.xmax=Hr[0],r.ymax=Hr[1],c&&(r.zmax=Hr[2]),h&&(r.mmin=e.mmin,r.mmax=e.mmax),r.spatialReference=i,r):null):null}function O1(e,t,r){if(R(t)||R(r))return null;const i=new at({spatialReference:r});return mi(e,t,0,Hr,r,0,1)?(i.x=Hr[0],i.y=Hr[1],i.z=Hr[2],i):null}function cTe(e,t,r){return mi(e,t,0,Hr,r.spatialReference,0,1)?(r.x=Hr[0],r.y=Hr[1],r.z=Hr[2],r):null}function so(e,t,r,i=0){Hr[0]=e.x,Hr[1]=e.y;const s=e.z;return Hr[2]=s!==void 0?s:i,mi(Hr,e.spatialReference,0,t,r,0,1)}function xle(e,t,r,i,s,n){return es[0]=e,es[1]=t,es[2]=r,mi(es,i,0,s,n,0,1)}function xn(e,t,r,i){return!(R(t)||R(i)||e.length<2)&&(e.length===2&&(es[0]=e[0],es[1]=e[1],es[2]=0,e=es),mi(e,t,0,r,i,0,1))}function N9e(e,t){Hr[0]=e.x,Hr[1]=e.y;const r=e.z;return Hr[2]=r!==void 0?r:0,F9e(Hr,e.spatialReference,t)}function F9e(e,t,r){return k9e(e,t,r)}function k9e(e,t,r){if(R(t))return!1;const i=M1(t,S6),s=Fm[i][J.WGS84_COMPARABLE_LON_LAT];return!R(s)&&(s(e,0,es,0),r!==es&&(r[0]=es[0],r[1]=es[1],r.length>2&&(r[2]=es[2])),!0)}function mi(e,t,r,i,s,n,o=1){const a=lte(t,s,ute);if(R(a))return!1;if(a===wi){if(e===i&&r===n)return!0;const c=r+3*o;for(let h=r,p=n;h<c;h++,p++)i[p]=e[h];return!0}const l=r+3*o;for(let c=r,h=n;c<l;c+=3,h+=3)a(e,c,i,h);return!0}function c$t(e,t,r,i,s){ae(Hr,e),de(DD,e,t),xn(Hr,r,Hr,s),xn(DD,r,DD,s),pe(i,DD,Hr),we(i,i)}function uTe(e,t,r,i,s,n,o=0){const a=new Array;for(const c of e)for(const h of c)a.push(h[0],h[1],t?h[2]:o);if(!mi(a,i,0,a,n,0,a.length/3))return!1;let l=0;s.length=0;for(const c of e){const h=new Array;for(const p of c)t&&r?h.push([a[l++],a[l++],a[l++],p[3]]):t?h.push([a[l++],a[l++],a[l++]]):r?(h.push([a[l++],a[l++],p[2]]),l++):(h.push([a[l++],a[l++]]),l++);s.push(h)}return!0}function U9e(e,t,r,i){if(R(t)||R(i))return!1;const s=_Te(t,i,W9e);if(s.projector===wi)return r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],!0;if(R(s.projector))return!1;const{source:n,dest:o}=s;if(o.spatialReferenceId===J.WEB_MERCATOR){const a=Fm[n.spatialReferenceId][J.WGS84];return!R(a)&&(a(e,0,Np,0),hT(Np,0,r,0),r[3]=Tle(Np[1],e[2],e[3],$r.radius),!0)}if(n.spatialReferenceId!==J.WGS84&&n.spatialReferenceId!==J.CGCS2000||o.spatialReferenceId!==J.PLATE_CARREE)s.projector(e,0,r,0),r[3]=e[3]*n.metersPerUnit/o.metersPerUnit;else{const a=Fm[n.spatialReferenceId][J.SPHERICAL_ECEF],l=Fm[J.SPHERICAL_ECEF][J.PLATE_CARREE];let c=e[3];b(a)&&b(l)&&(c=Tle(e[1],e[2],e[3],$r.radius)),s.projector(e,0,r,0),r[3]=c}return!0}function Tle(e,t,r,i){const s=i+t;if(s<i/2||r>s)return Number.MAX_VALUE;const n=Math.abs(sf*e)+Math.asin(r/s);return n>=Math.PI/2?Number.MAX_VALUE:r/Math.cos(n)}function T6(e,t,r,i){return e!=null&&(ml(t,i)?(h0(r,e),!0):(es[0]=e[0],es[1]=e[1],es[2]=0,!!mi(es,t,0,es,i,0,1)&&(r[0]=es[0],r[1]=es[1],es[0]=e[2],es[1]=e[3],es[2]=0,!!mi(es,t,0,es,i,0,1)&&(r[2]=es[0],r[3]=es[1],!0))))}function u$t(e,t,r,i){if(R(t)||R(i))return!1;const s=M1(t,S6),n=M1(i,bTe);if(s===n&&s!==J.UNKNOWN||ml(t,i))return r[0]=1,r[1]=1,r[2]=1,!0;if(s===J.SPHERICAL_ECEF){const o=Re(e),a=o/Math.sqrt(e[0]*e[0]+e[1]*e[1]),l=o/$r.radius;if(n===J.WEB_MERCATOR)return r[0]=a*l,r[1]=a*l,r[2]=1,!0;if(n===J.WGS84||n===J.CGCS2000){const c=Y3;return r[0]=c*a*l,r[1]=c*l,r[2]=1,!0}}else if(s===J.PLATE_CARREE){if(n===J.WGS84||n===J.CGCS2000)return r[0]=Y3,r[1]=Y3,r[2]=1,!0;if(n===J.WEB_MERCATOR){const o=e[1]/$r.radius;return r[0]=1,r[1]=1/Math.cos(o),r[2]=1,!0}}return!1}function bh(e,t,r,i){if(R(e)||R(i))return!1;const s=M1(e,S6),n=M1(i,bTe);if(s===n&&!Sle(n)&&(s!==J.UNKNOWN||ml(e,i)))return b6(r,t),!0;if(Sle(n)){const o=Fm[s][J.LON_LAT],a=Fm[J.LON_LAT][n];return!R(o)&&!R(a)&&(o(t,0,Np,0),a(Np,0,q0,0),hTe(sf*Np[0],sf*Np[1],r),r[12]=q0[0],r[13]=q0[1],r[14]=q0[2],!0)}if((n===J.WEB_MERCATOR||n===J.PLATE_CARREE)&&(s===J.WGS84||s===J.CGCS2000&&n===J.PLATE_CARREE||s===J.SPHERICAL_ECEF||s===J.WEB_MERCATOR)){const o=Fm[s][J.LON_LAT],a=Fm[J.LON_LAT][n];return!R(o)&&!R(a)&&(o(t,0,Np,0),a(Np,0,q0,0),s===J.SPHERICAL_ECEF?V9e(sf*Np[0],sf*Np[1],r):ig(r),r[12]=q0[0],r[13]=q0[1],r[14]=q0[2],!0)}return!1}function Sle(e){return e===J.SPHERICAL_ECEF||e===J.SPHERICAL_MARS_PCPF||e===J.SPHERICAL_MOON_PCPF}function hTe(e,t,r){const i=Math.sin(e),s=Math.cos(e),n=Math.sin(t),o=Math.cos(t),a=r;return a[0]=-i,a[4]=-n*s,a[8]=o*s,a[12]=0,a[1]=s,a[5]=-n*i,a[9]=o*i,a[13]=0,a[2]=0,a[6]=o,a[10]=n,a[14]=0,a[3]=0,a[7]=0,a[11]=0,a[15]=1,a}function V9e(e,t,r){return hTe(e,t,r),lc(r,r),r}function M1(e,t){return t.spatialReference===e?t.spatialReferenceId:(t.spatialReference=e,"metersPerUnit"in t&&(t.metersPerUnit=uu(e,1)),e.wkt===Dxe.wkt?t.spatialReferenceId=J.SPHERICAL_ECEF:sI(e)?t.spatialReferenceId=J.WGS84:sT(e)?t.spatialReferenceId=J.WEB_MERCATOR:nI(e)?t.spatialReferenceId=J.PLATE_CARREE:e.wkt===$8e.wkt?t.spatialReferenceId=J.WGS84_ECEF:e.wkid===Td.CGCS2000?t.spatialReferenceId=J.CGCS2000:e.wkt===IU.wkt?t.spatialReferenceId=J.SPHERICAL_MARS_PCPF:e.wkt===$U.wkt?t.spatialReferenceId=J.SPHERICAL_MOON_PCPF:hg(e)?t.spatialReferenceId=J.GCSMARS2000:dg(e)?t.spatialReferenceId=J.GCSMOON2000:t.spatialReferenceId=J.UNKNOWN)}function wi(e,t,r,i){e!==r&&(r[i++]=e[t++],r[i++]=e[t++],r[i]=e[t])}function Vx(e,t,r,i){r[i++]=uA*(e[t++]/$r.radius),r[i++]=uA*(Math.PI/2-2*Math.atan(Math.exp(-e[t++]/$r.radius))),r[i]=e[t]}function dTe(e,t,r,i){Vx(e,t,r,i),V_(r,i,r,i)}function pTe(e,t,r,i){Vx(e,t,r,i),B_(r,i,r,i)}function nte(e,t,r,i,s){const n=.4999999*Math.PI,o=Le(sf*e[t+1],-n,n),a=Math.sin(o);r[i++]=sf*e[t]*s.radius,r[i++]=s.halfSemiMajorAxis*Math.log((1+a)/(1-a)),r[i]=e[t+2]}function hT(e,t,r,i){nte(e,t,r,i,$r)}const Ele=$r.radius*Math.PI/180,Y3=180/($r.radius*Math.PI);function U_(e,t,r,i){r[i]=e[t]*Ele,r[i+1]=e[t+1]*Ele,r[i+2]=e[t+2]}function gx(e,t,r,i){r[i]=e[t]*Y3,r[i+1]=e[t+1]*Y3,r[i+2]=e[t+2]}function fTe(e,t,r,i){Vx(e,t,r,i),U_(r,i,r,i)}function z9e(e,t,r,i){G_(e,t,r,i),U_(r,i,r,i)}function B9e(e,t,r,i){z_(e,t,r,i),U_(r,i,r,i)}function G9e(e,t,r,i){gx(e,t,r,i),V_(r,i,r,i)}function j9e(e,t,r,i){gx(e,t,r,i),hT(r,i,r,i)}function H9e(e,t,r,i){gx(e,t,r,i),B_(r,i,r,i)}function dT(e){if(R(e))return!1;const t=M1(e,S6);return!!Fm[t][J.WGS84_COMPARABLE_LON_LAT]}function JR(e,t,r,i){const s=Math.cos(r);e[0]=Math.cos(t)*s*i,e[1]=Math.sin(t)*s*i,e[2]=Math.sin(r)*i}function ote(e,t,r,i,s){const n=s+e[t+2],o=sf*e[t+1],a=sf*e[t],l=Math.cos(o);r[i++]=Math.cos(a)*l*n,r[i++]=Math.sin(a)*l*n,r[i]=Math.sin(o)*n}function OX(e,t,r,i){ote(e,t,r,i,c0.radius)}function MX(e,t,r,i){ote(e,t,r,i,zm.radius)}function V_(e,t,r,i){ote(e,t,r,i,$r.radius)}function ate(e,t,r,i,s){const n=e[t],o=e[t+1],a=e[t+2],l=Math.sqrt(n*n+o*o+a*a),c=bf(a/(l===0?1:l)),h=Math.atan2(o,n);r[i++]=uA*h,r[i++]=uA*c,r[i]=l-s}function PX(e,t,r,i){ate(e,t,r,i,c0.radius)}function IX(e,t,r,i){ate(e,t,r,i,zm.radius)}function z_(e,t,r,i){ate(e,t,r,i,$r.radius)}function mTe(e,t,r,i){z_(e,t,r,i),hT(r,i,r,i)}function gTe(e,t,r,i){z_(e,t,r,i),B_(r,i,r,i)}function q9e(e,t,r,i,s){const n=sf*e[t],o=sf*e[t+1],a=e[t+2],l=Math.sin(o),c=Math.cos(o),h=s.radius/Math.sqrt(1-s.eccentricitySquared*l*l);r[i++]=(h+a)*c*Math.cos(n),r[i++]=(h+a)*c*Math.sin(n),r[i++]=(h*(1-s.eccentricitySquared)+a)*l}function B_(e,t,r,i){q9e(e,t,r,i,$r)}function G_(e,t,r,i){const s=T9e,n=e[t],o=e[t+1],a=e[t+2];let l,c,h,p,f,m,g,v,w,_,T,x,E,C,A,P,I,L,k,G,z;l=Math.abs(a),c=n*n+o*o,h=Math.sqrt(c),p=c+a*a,f=Math.sqrt(p),G=Math.atan2(o,n),m=a*a/p,g=c/p,C=s.a2/f,A=s.a3-s.a4/f,g>.3?(v=l/f*(1+g*(s.a1+C+m*A)/f),k=Math.asin(v),_=v*v,w=Math.sqrt(1-_)):(w=h/f*(1-m*(s.a5-C-g*A)/f),k=Math.acos(w),_=1-w*w,v=Math.sqrt(_)),T=1-$r.eccentricitySquared*_,x=$r.radius/Math.sqrt(T),E=s.a6*x,C=h-x*w,A=l-E*v,I=w*C+v*A,P=w*A-v*C,L=P/(E/T+I),k+=L,z=I+P*L/2,a<0&&(k=-k),r[i++]=uA*G,r[i++]=uA*k,r[i]=z}function yTe(e,t,r,i){G_(e,t,r,i),V_(r,i,r,i)}function vTe(e,t,r,i){G_(e,t,r,i),hT(r,i,r,i)}const Fm={[J.WGS84]:{[J.CGCS2000]:null,[J.GCSMARS2000]:null,[J.GCSMOON2000]:null,[J.LON_LAT]:wi,[J.WGS84_COMPARABLE_LON_LAT]:wi,[J.SPHERICAL_ECEF]:V_,[J.SPHERICAL_MARS_PCPF]:null,[J.SPHERICAL_MOON_PCPF]:null,[J.UNKNOWN]:null,[J.WEB_MERCATOR]:hT,[J.PLATE_CARREE]:U_,[J.WGS84]:wi,[J.WGS84_ECEF]:B_},[J.CGCS2000]:{[J.CGCS2000]:wi,[J.GCSMARS2000]:null,[J.GCSMOON2000]:null,[J.LON_LAT]:wi,[J.WGS84_COMPARABLE_LON_LAT]:wi,[J.SPHERICAL_ECEF]:V_,[J.SPHERICAL_MARS_PCPF]:null,[J.SPHERICAL_MOON_PCPF]:null,[J.UNKNOWN]:null,[J.WEB_MERCATOR]:null,[J.PLATE_CARREE]:U_,[J.WGS84]:null,[J.WGS84_ECEF]:B_},[J.GCSMARS2000]:{[J.CGCS2000]:null,[J.GCSMARS2000]:wi,[J.GCSMOON2000]:null,[J.LON_LAT]:wi,[J.WGS84_COMPARABLE_LON_LAT]:null,[J.SPHERICAL_ECEF]:null,[J.SPHERICAL_MARS_PCPF]:MX,[J.SPHERICAL_MOON_PCPF]:null,[J.UNKNOWN]:null,[J.WEB_MERCATOR]:null,[J.PLATE_CARREE]:null,[J.WGS84]:null,[J.WGS84_ECEF]:null},[J.GCSMOON2000]:{[J.CGCS2000]:null,[J.GCSMARS2000]:null,[J.GCSMOON2000]:wi,[J.LON_LAT]:wi,[J.WGS84_COMPARABLE_LON_LAT]:null,[J.SPHERICAL_ECEF]:null,[J.SPHERICAL_MARS_PCPF]:null,[J.SPHERICAL_MOON_PCPF]:OX,[J.UNKNOWN]:null,[J.WEB_MERCATOR]:null,[J.PLATE_CARREE]:null,[J.WGS84]:null,[J.WGS84_ECEF]:null},[J.WEB_MERCATOR]:{[J.CGCS2000]:null,[J.GCSMARS2000]:null,[J.GCSMOON2000]:null,[J.LON_LAT]:Vx,[J.WGS84_COMPARABLE_LON_LAT]:Vx,[J.SPHERICAL_ECEF]:dTe,[J.SPHERICAL_MARS_PCPF]:null,[J.SPHERICAL_MOON_PCPF]:null,[J.UNKNOWN]:null,[J.WEB_MERCATOR]:wi,[J.PLATE_CARREE]:fTe,[J.WGS84]:Vx,[J.WGS84_ECEF]:pTe},[J.WGS84_ECEF]:{[J.CGCS2000]:G_,[J.GCSMARS2000]:null,[J.GCSMOON2000]:null,[J.LON_LAT]:G_,[J.WGS84_COMPARABLE_LON_LAT]:G_,[J.SPHERICAL_ECEF]:yTe,[J.SPHERICAL_MARS_PCPF]:null,[J.SPHERICAL_MOON_PCPF]:null,[J.UNKNOWN]:null,[J.WEB_MERCATOR]:vTe,[J.PLATE_CARREE]:z9e,[J.WGS84]:G_,[J.WGS84_ECEF]:wi},[J.SPHERICAL_ECEF]:{[J.CGCS2000]:z_,[J.GCSMARS2000]:null,[J.GCSMOON2000]:null,[J.LON_LAT]:z_,[J.WGS84_COMPARABLE_LON_LAT]:z_,[J.SPHERICAL_ECEF]:wi,[J.SPHERICAL_MARS_PCPF]:null,[J.SPHERICAL_MOON_PCPF]:null,[J.UNKNOWN]:null,[J.WEB_MERCATOR]:mTe,[J.PLATE_CARREE]:B9e,[J.WGS84]:z_,[J.WGS84_ECEF]:gTe},[J.SPHERICAL_MARS_PCPF]:{[J.CGCS2000]:null,[J.GCSMARS2000]:IX,[J.GCSMOON2000]:null,[J.LON_LAT]:IX,[J.WGS84_COMPARABLE_LON_LAT]:null,[J.SPHERICAL_ECEF]:null,[J.SPHERICAL_MARS_PCPF]:wi,[J.SPHERICAL_MOON_PCPF]:null,[J.UNKNOWN]:null,[J.WEB_MERCATOR]:null,[J.PLATE_CARREE]:null,[J.WGS84]:null,[J.WGS84_ECEF]:null},[J.SPHERICAL_MOON_PCPF]:{[J.CGCS2000]:null,[J.GCSMARS2000]:null,[J.GCSMOON2000]:PX,[J.LON_LAT]:PX,[J.WGS84_COMPARABLE_LON_LAT]:null,[J.SPHERICAL_ECEF]:null,[J.SPHERICAL_MARS_PCPF]:null,[J.SPHERICAL_MOON_PCPF]:wi,[J.UNKNOWN]:null,[J.WEB_MERCATOR]:null,[J.PLATE_CARREE]:null,[J.WGS84]:null,[J.WGS84_ECEF]:null},[J.UNKNOWN]:{[J.CGCS2000]:null,[J.GCSMARS2000]:null,[J.GCSMOON2000]:null,[J.LON_LAT]:null,[J.WGS84_COMPARABLE_LON_LAT]:null,[J.SPHERICAL_ECEF]:null,[J.SPHERICAL_MARS_PCPF]:null,[J.SPHERICAL_MOON_PCPF]:null,[J.UNKNOWN]:wi,[J.WEB_MERCATOR]:null,[J.PLATE_CARREE]:null,[J.WGS84]:null,[J.WGS84_ECEF]:null},[J.LON_LAT]:{[J.CGCS2000]:wi,[J.GCSMARS2000]:wi,[J.GCSMOON2000]:wi,[J.LON_LAT]:wi,[J.WGS84_COMPARABLE_LON_LAT]:wi,[J.SPHERICAL_ECEF]:V_,[J.SPHERICAL_MARS_PCPF]:MX,[J.SPHERICAL_MOON_PCPF]:OX,[J.UNKNOWN]:null,[J.WEB_MERCATOR]:hT,[J.PLATE_CARREE]:U_,[J.WGS84]:wi,[J.WGS84_ECEF]:B_},[J.WGS84_COMPARABLE_LON_LAT]:{[J.CGCS2000]:null,[J.GCSMARS2000]:null,[J.GCSMOON2000]:null,[J.LON_LAT]:wi,[J.WGS84_COMPARABLE_LON_LAT]:wi,[J.SPHERICAL_ECEF]:V_,[J.SPHERICAL_MARS_PCPF]:null,[J.SPHERICAL_MOON_PCPF]:null,[J.UNKNOWN]:null,[J.WEB_MERCATOR]:null,[J.PLATE_CARREE]:U_,[J.WGS84]:wi,[J.WGS84_ECEF]:B_},[J.PLATE_CARREE]:{[J.CGCS2000]:gx,[J.GCSMARS2000]:null,[J.GCSMOON2000]:null,[J.LON_LAT]:gx,[J.WGS84_COMPARABLE_LON_LAT]:gx,[J.SPHERICAL_ECEF]:G9e,[J.SPHERICAL_MARS_PCPF]:null,[J.SPHERICAL_MOON_PCPF]:null,[J.UNKNOWN]:null,[J.WEB_MERCATOR]:j9e,[J.PLATE_CARREE]:wi,[J.WGS84]:gx,[J.WGS84_ECEF]:H9e}};function lte(e,t,r=cte()){return R(e)||R(t)?null:_Te(e,t,r).projector}function _Te(e,t,r){if(R(e)||R(t)||r.source.spatialReference===e&&r.dest.spatialReference===t)return r;const i=M1(e,r.source),s=M1(t,r.dest);return i===J.UNKNOWN&&s===J.UNKNOWN?ml(e,t)?r.projector=wi:r.projector=null:r.projector=Fm[i][s],r}function cte(){return{source:{spatialReference:null,spatialReferenceId:J.UNKNOWN,metersPerUnit:1},dest:{spatialReference:null,spatialReferenceId:J.UNKNOWN,metersPerUnit:1},projector:wi}}const S6={spatialReference:null,spatialReferenceId:J.UNKNOWN},bTe={spatialReference:null,spatialReferenceId:J.UNKNOWN},ute=cte(),W9e=cte(),sf=Ft(1),uA=nu(1),es=M(),Np=M(),q0=M(),Hr=M(),DD=M();class C0{constructor(t){this.allocator=t,this._items=[],this._itemsPtr=0,this._grow()}get(){return this._itemsPtr===0&&zC(()=>this._reset()),this._itemsPtr===this._items.length&&this._grow(),this._items[this._itemsPtr++]}_reset(){const t=Math.min(3*Math.max(8,this._itemsPtr),this._itemsPtr+3*Cle);this._items.length=Math.min(t,this._items.length),this._itemsPtr=0}_grow(){for(let t=0;t<Math.max(8,Math.min(this._items.length,Cle));t++)this._items.push(this.allocator())}}const Cle=1024;function Ce(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function zx(e){return[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15]]}function hte(e,t,r,i,s,n,o,a,l,c,h,p,f,m,g,v){return[e,t,r,i,s,n,o,a,l,c,h,p,f,m,g,v]}function wTe(e,t){return new Float64Array(e,t,16)}const Tn=Ce();Object.freeze(Object.defineProperty({__proto__:null,create:Ce,clone:zx,fromValues:hte,createView:wTe,IDENTITY:Tn},Symbol.toStringTag,{value:"Module"}));var hh;(function(e){e[e.X=0]="X",e[e.Y=1]="Y",e[e.Z=2]="Z"})(hh||(hh={}));function X9e(e){return 32+e.length}function Z9e(){return 16}function xTe(e){if(!e)return 0;let t=32;for(const r in e)if(e.hasOwnProperty(r)){const i=e[r];switch(typeof i){case"string":t+=X9e(i);break;case"number":t+=Z9e();break;case"boolean":t+=4}}return t}function h$t(e,t){return 32+e.length*t}var hA;(function(e){e[e.KILOBYTES=1024]="KILOBYTES",e[e.MEGABYTES=1048576]="MEGABYTES",e[e.GIGABYTES=1073741824]="GIGABYTES"})(hA||(hA={}));function $i(){return[1,0,0,0,1,0,0,0,1]}function Y9e(e){return[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8]]}function Q9e(e,t,r,i,s,n,o,a,l){return[e,t,r,i,s,n,o,a,l]}function TTe(e,t){return new Float64Array(e,t,9)}Object.freeze(Object.defineProperty({__proto__:null,create:$i,clone:Y9e,fromValues:Q9e,createView:TTe},Symbol.toStringTag,{value:"Module"}));function A0(){return[0,0,0,1]}function J9e(e){return[e[0],e[1],e[2],e[3]]}function K9e(e,t,r,i){return[e,t,r,i]}function STe(e,t){return new Float64Array(e,t,4)}const eGe=A0();Object.freeze(Object.defineProperty({__proto__:null,create:A0,clone:J9e,fromValues:K9e,createView:STe,IDENTITY:eGe},Symbol.toStringTag,{value:"Module"}));function rt(){return[0,0]}function FM(e){return[e[0],e[1]]}function Fr(e,t){return[e,t]}function ETe(e){const t=rt(),r=Math.min(2,e.length);for(let i=0;i<r;++i)t[i]=e[i];return t}function CTe(e,t){return new Float64Array(e,t,2)}function ATe(){return rt()}function RTe(){return Fr(1,1)}function OTe(){return Fr(1,0)}function MTe(){return Fr(0,1)}const zd=ATe(),PTe=RTe(),tGe=OTe(),rGe=MTe();Object.freeze(Object.defineProperty({__proto__:null,create:rt,clone:FM,fromValues:Fr,fromArray:ETe,createView:CTe,zeros:ATe,ones:RTe,unitX:OTe,unitY:MTe,ZEROS:zd,ONES:PTe,UNIT_X:tGe,UNIT_Y:rGe},Symbol.toStringTag,{value:"Module"}));function Zt(){return[0,0,0,0]}function E6(e){return[e[0],e[1],e[2],e[3]]}function xr(e,t,r,i){return[e,t,r,i]}function dte(e){const t=Zt(),r=Math.min(4,e.length);for(let i=0;i<r;++i)t[i]=e[i];return t}function ITe(e,t){return new Float64Array(e,t,4)}function $Te(){return Zt()}function LTe(){return xr(1,1,1,1)}function DTe(){return xr(1,0,0,0)}function NTe(){return xr(0,1,0,0)}function FTe(){return xr(0,0,1,0)}function kTe(){return xr(0,0,0,1)}const jm=$Te(),Sd=LTe(),iGe=DTe(),sGe=NTe(),nGe=FTe(),oGe=kTe();Object.freeze(Object.defineProperty({__proto__:null,create:Zt,clone:E6,fromValues:xr,fromArray:dte,createView:ITe,zeros:$Te,ones:LTe,unitX:DTe,unitY:NTe,unitZ:FTe,unitW:kTe,ZEROS:jm,ONES:Sd,UNIT_X:iGe,UNIT_Y:sGe,UNIT_Z:nGe,UNIT_W:oGe},Symbol.toStringTag,{value:"Module"}));class Zu{constructor(t,r,i){this.itemByteSize=t,this.itemCreate=r,this._buffers=new Array,this._items=new Array,this._itemsPtr=0,this._itemsPerBuffer=Math.ceil(i/this.itemByteSize)}get(){this._itemsPtr===0&&zC(()=>this._reset());const t=Math.floor(this._itemsPtr/this._itemsPerBuffer);for(;this._buffers.length<=t;){const r=new ArrayBuffer(this._itemsPerBuffer*this.itemByteSize);for(let i=0;i<this._itemsPerBuffer;++i)this._items.push(this.itemCreate(r,i*this.itemByteSize));this._buffers.push(r)}return this._items[this._itemsPtr++]}_reset(){const t=2*(Math.floor(this._itemsPtr/this._itemsPerBuffer)+1);for(;this._buffers.length>t;)this._buffers.pop(),this._items.length=this._buffers.length*this._itemsPerBuffer;this._itemsPtr=0}static createVec2f64(t=cS){return new Zu(16,CTe,t)}static createVec3f64(t=cS){return new Zu(24,dee,t)}static createVec4f64(t=cS){return new Zu(32,ITe,t)}static createMat3f64(t=cS){return new Zu(72,TTe,t)}static createMat4f64(t=cS){return new Zu(128,wTe,t)}static createQuatf64(t=cS){return new Zu(32,STe,t)}get test(){return{size:this._buffers.length*this._itemsPerBuffer*this.itemByteSize}}}const cS=4*hA.KILOBYTES,d$t=Zu.createVec2f64(),He=Zu.createVec3f64(),pte=Zu.createVec4f64();Zu.createMat3f64();const fte=Zu.createMat4f64(),p$t=Zu.createQuatf64();function yg(e){return e?{origin:Qs(e.origin),vector:Qs(e.vector)}:{origin:M(),vector:M()}}function aGe(e,t){const r=cGe.get();return r.origin=e,r.vector=t,r}function f$t(e,t=yg()){return lGe(e.origin,e.vector,t)}function lGe(e,t,r=yg()){return ae(r.origin,e),ae(r.vector,t),r}function Bx(e,t,r=yg()){return ae(r.origin,e),pe(r.vector,t,e),r}function mte(e,t){const r=pe(He.get(),t,e.origin),i=Te(e.vector,r),s=Te(e.vector,e.vector),n=Le(i/s,0,1),o=pe(He.get(),le(He.get(),e.vector,n),r);return Te(o,o)}function m$t(e,t,r){return $X(e,t,0,1,r)}function g$t(e,t,r){return de(r,e.origin,le(r,e.vector,t))}function $X(e,t,r,i,s){const{vector:n,origin:o}=e,a=pe(He.get(),t,o),l=Te(n,a)/ul(n);return le(s,n,Le(l,r,i)),de(s,s,e.origin)}function y$t(e,t){if(VTe(e,aGe(t.origin,t.direction),!1,VU)){const{tA:r,pB:i,distance2:s}=VU;if(r>=0&&r<=1)return s;if(r<0)return Fn(e.origin,i);if(r>1)return Fn(de(He.get(),e.origin,e.vector),i)}return null}function UTe(e,t,r){return!!VTe(e,t,!0,VU)&&(ae(r,VU.pA),!0)}function VTe(e,t,r,i){const n=e.origin,o=de(He.get(),n,e.vector),a=t.origin,l=de(He.get(),a,t.vector),c=He.get(),h=He.get();if(c[0]=n[0]-a[0],c[1]=n[1]-a[1],c[2]=n[2]-a[2],h[0]=l[0]-a[0],h[1]=l[1]-a[1],h[2]=l[2]-a[2],Math.abs(h[0])<1e-6&&Math.abs(h[1])<1e-6&&Math.abs(h[2])<1e-6)return!1;const p=He.get();if(p[0]=o[0]-n[0],p[1]=o[1]-n[1],p[2]=o[2]-n[2],Math.abs(p[0])<1e-6&&Math.abs(p[1])<1e-6&&Math.abs(p[2])<1e-6)return!1;const f=c[0]*h[0]+c[1]*h[1]+c[2]*h[2],m=h[0]*p[0]+h[1]*p[1]+h[2]*p[2],g=c[0]*p[0]+c[1]*p[1]+c[2]*p[2],v=h[0]*h[0]+h[1]*h[1]+h[2]*h[2],w=(p[0]*p[0]+p[1]*p[1]+p[2]*p[2])*v-m*m;if(Math.abs(w)<1e-6)return!1;let _=(f*m-g*v)/w,T=(f+m*_)/v;r&&(_=Le(_,0,1),T=Le(T,0,1));const x=He.get(),E=He.get();return x[0]=n[0]+_*p[0],x[1]=n[1]+_*p[1],x[2]=n[2]+_*p[2],E[0]=a[0]+T*h[0],E[1]=a[1]+T*h[1],E[2]=a[2]+T*h[2],i.tA=_,i.tB=T,i.pA=x,i.pB=E,i.distance2=Fn(x,E),!0}const VU={tA:0,tB:0,pA:M(),pB:M(),distance2:0},cGe=new C0(()=>({origin:null,vector:null}));function Ro(e){return e?{origin:Qs(e.origin),direction:Qs(e.direction)}:{origin:M(),direction:M()}}function v$t(e,t){return x1(e.origin,t.origin)&&x1(e.direction,t.direction)}function wh(e,t){const r=fGe.get();return r.origin=e,r.direction=t,r}function zU(e,t=Ro()){return zTe(e.origin,e.direction,t)}function uGe(e,t,r=Ro()){return ae(r.origin,e),pe(r.direction,t,e),r}function zTe(e,t,r=Ro()){return ae(r.origin,e),ae(r.direction,t),r}function hGe(e,t){const r=ut(He.get(),we(He.get(),e.direction),pe(He.get(),t,e.origin));return Te(r,r)}function dGe(e,t,r){const i=Te(e.direction,pe(r,t,e.origin));return de(r,e.origin,le(r,e.direction,i)),r}function pGe(){return{origin:null,direction:null}}const fGe=new C0(pGe);function Q3(e,t){return Te(e,t)/Re(e)}function gte(e,t){const r=Te(e,t)/(Re(e)*Re(t));return-Cn(r)}function mGe(e,t,r){we(ND,e),we(Q9,t);const i=Te(ND,Q9),s=Cn(i),n=ut(ND,ND,Q9);return Te(n,r)<0?2*Math.PI-s:s}const ND=M(),Q9=M(),gGe=fe.getLogger("esri.geometry.support.sphere");function kn(){return Zt()}function dA(e,t=kn()){return ef(t,e)}function BTe(e,t){return xr(e[0],e[1],e[2],t)}function yGe(e){return e}function GTe(e){e[0]=e[1]=e[2]=e[3]=0}function C6(e,t){return e[0]=e[1]=e[2]=0,e[3]=t,e}function Hy(e){return e[3]}function vGe(e){return e}function jTe(e,t,r,i){return xr(e,t,r,i)}function _Ge(e,t,r){return e!==r&&ae(r,e),r[3]=e[3]+t,r}function bGe(e,t,r){return gGe.error("sphere.setExtent is not yet supported"),e===r?r:dA(e,r)}function Y1(e,t,r){if(R(t))return!1;const{origin:i,direction:s}=t,n=wGe;n[0]=i[0]-e[0],n[1]=i[1]-e[1],n[2]=i[2]-e[2];const o=s[0]*s[0]+s[1]*s[1]+s[2]*s[2],a=2*(s[0]*n[0]+s[1]*n[1]+s[2]*n[2]),l=a*a-4*o*(n[0]*n[0]+n[1]*n[1]+n[2]*n[2]-e[3]*e[3]);if(l<0)return!1;const c=Math.sqrt(l);let h=(-a-c)/(2*o);const p=(-a+c)/(2*o);return(h<0||p<h&&p>0)&&(h=p),!(h<0)&&(r&&(r[0]=i[0]+s[0]*h,r[1]=i[1]+s[1]*h,r[2]=i[2]+s[2]*h),!0)}const wGe=M();function LX(e,t){return Y1(e,t,null)}function xGe(e,t,r){if(Y1(e,t,r))return r;const i=dR(e,t,He.get());return de(r,t.origin,le(He.get(),t.direction,pi(t.origin,i)/Re(t.direction))),r}function dR(e,t,r){const i=He.get(),s=fte.get();ut(i,t.origin,t.direction);const n=Hy(e);ut(r,i,t.origin),le(r,r,1/Re(r)*n);const o=WTe(e,t.origin),a=gte(t.origin,r);return _h(s,a+o,i),Ve(r,r,s),r}function TGe(e,t,r){return Y1(e,t,r)?r:(dGe(t,e,r),HTe(e,r,r))}function HTe(e,t,r){const i=pe(He.get(),t,e),s=le(He.get(),i,e[3]/Re(i));return de(r,s,e)}function qTe(e,t){const r=pe(He.get(),t,e),i=ul(r),s=e[3]*e[3];return Math.sqrt(Math.abs(i-s))}function WTe(e,t){const r=pe(He.get(),t,e),i=Re(r),s=Hy(e),n=s+Math.abs(s-i);return Cn(s/n)}const J9=M();function XTe(e,t,r,i){const s=pe(J9,t,e);switch(r){case hh.X:{const n=$ae(s,J9)[2];return se(i,-Math.sin(n),Math.cos(n),0)}case hh.Y:{const n=$ae(s,J9),o=n[1],a=n[2],l=Math.sin(o);return se(i,-l*Math.cos(a),-l*Math.sin(a),Math.cos(o))}case hh.Z:return we(i,s);default:return}}function ZTe(e,t){const r=pe(DX,t,e);return Re(r)-e[3]}function SGe(e,t,r,i){const s=ZTe(e,t),n=XTe(e,t,hh.Z,DX),o=le(DX,n,r-s);return de(i,t,o)}function EGe(e,t){const r=Fn(e,t),i=Hy(e);return r<=i*i}const DX=M(),A6=kn(),CGe=Object.freeze(Object.defineProperty({__proto__:null,create:kn,copy:dA,fromCenterAndRadius:BTe,wrap:yGe,clear:GTe,fromRadius:C6,getRadius:Hy,getCenter:vGe,fromValues:jTe,elevate:_Ge,setExtent:bGe,intersectRay:Y1,intersectsRay:LX,intersectRayClosestSilhouette:xGe,closestPointOnSilhouette:dR,closestPoint:TGe,projectPoint:HTe,distanceToSilhouette:qTe,angleToSilhouette:WTe,axisAt:XTe,altitudeAt:ZTe,setAltitudeAt:SGe,containsPoint:EGe,tmpSphere:A6},Symbol.toStringTag,{value:"Module"}));function pT(e){const t=e[0]*e[0]+e[4]*e[4]+e[8]*e[8],r=e[1]*e[1]+e[5]*e[5]+e[9]*e[9],i=e[2]*e[2]+e[6]*e[6]+e[10]*e[10];return Math.sqrt(Math.max(t,r,i))}function AGe(e,t){const r=Math.sqrt(t[0]*t[0]+t[4]*t[4]+t[8]*t[8]),i=Math.sqrt(t[1]*t[1]+t[5]*t[5]+t[9]*t[9]),s=Math.sqrt(t[2]*t[2]+t[6]*t[6]+t[10]*t[10]);return se(e,r,i,s),e}function _$t(e,t,r){r=r||e;const i=Te(e,t);se(r,e[0]-i*t[0],e[1]-i*t[1],e[2]-i*t[2]),we(r,r)}function b$t(e,t,r){Math.abs(e[0])>Math.abs(e[1])?se(t,0,1,0):se(t,1,0,0),ut(r,e,t),we(t,t),ut(t,r,e),we(r,r)}function FD(e,t,r,i,s,n){const o=e+(t-e)*s;return o+(r+(i-r)*s-o)*n}function RGe(e,t,r,i=M()){const s=Re(e),n=Re(t),o=Te(e,t)/(s*n);if(o<.9999999999999999){const a=Math.acos(o),l=((1-r)*s+r*n)/Math.sin(a),c=l/s*Math.sin((1-r)*a),h=l/n*Math.sin(r*a);return le(yx,e,c),le(vx,t,h),de(i,yx,vx)}return En(i,e,t,r)}function w$t(e,t,r,i=M(),s=M()){const n=Re(e),o=Re(t),a=Te(e,t)/(n*o);if(a<.9999999999999999){const l=Math.acos(a),c=Math.sin(l),h=Math.sin(r*l),p=Math.sin((1-r)*l),f=(1-r)*n+r*o;{const m=f/c,g=m/o*h;le(yx,e,m/n*p),le(vx,t,g),de(i,yx,vx)}{const m=1/n*(-Math.cos((1-r)*l)*l*f+p*(-n+o));le(yx,e,m);const g=1/o*(Math.cos(r*l)*l*f+h*(-n+o));le(vx,t,g),de(s,yx,vx),le(s,s,1/c)}return s}return En(i,e,t,r),pe(s,t,e),we(s,s),s}function a5(e,t,r){e=we(yx,e),t=we(vx,t);const i=Cn(Te(e,t));if(r){const s=ut(OGe,e,t);if(Te(s,r)<0)return-i}return i}function l5(e){const t=e.length;return r=>{if(r<=e[0][0])return e[0][1];if(r>=e[t-1][0])return e[t-1][1];let i=1;for(;r>e[i][0];)i++;const s=e[i-1][0],n=e[i][0],o=(n-r)/(n-s);return o*e[i-1][1]+(1-o)*e[i][1]}}function x$t(e,t,r,i){pe(Ale,t,e),pe(Rle,r,e),ut(i,Ale,Rle),we(i,i),i[3]=-Te(e,i)}const Ale=M(),Rle=M(),OGe=M(),yx=M(),vx=M();function Er(e=kM){return[e[0],e[1],e[2],e[3]]}function MGe(e=kM[0],t=kM[1],r=kM[2],i=kM[3]){return yte(e,t,r,i,pte.get())}function R6(e,t){return yte(t[0],t[1],t[2],t[3],e)}function yte(e,t,r,i,s=Er()){return s[0]=e,s[1]=t,s[2]=r,s[3]=i,s}function YTe(e,t,r){return ae(r,e),r[3]=t,r}function pA(e,t,r){const i=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],s=Math.abs(i-1)>1e-5&&i>1e-12?1/Math.sqrt(i):1;return r[0]=t[0]*s,r[1]=t[1]*s,r[2]=t[2]*s,r[3]=-(r[0]*e[0]+r[1]*e[1]+r[2]*e[2]),r}function xa(e,t,r,i=Er()){const s=r[0]-t[0],n=r[1]-t[1],o=r[2]-t[2],a=e[0]-t[0],l=e[1]-t[1],c=e[2]-t[2],h=n*c-o*l,p=o*a-s*c,f=s*l-n*a,m=h*h+p*p+f*f,g=Math.abs(m-1)>1e-5&&m>1e-12?1/Math.sqrt(m):1;return i[0]=h*g,i[1]=p*g,i[2]=f*g,i[3]=-(i[0]*e[0]+i[1]*e[1]+i[2]*e[2]),i}function QTe(e,t,r,i,s){if(e.count<3)return!1;e.getVec(r,KR);let n=i,o=!1;for(;n<e.count-1&&!o;)e.getVec(n,uS),n++,o=!Xl(KR,uS);if(!o)return!1;for(n=Math.max(n,s),o=!1;n<e.count&&!o;)e.getVec(n,Yw),n++,pe(kD,KR,uS),we(kD,kD),pe(UD,uS,Yw),we(UD,UD),o=!Xl(KR,Yw)&&!Xl(uS,Yw)&&Math.abs(Te(kD,UD))<PGe;return o?(xa(KR,uS,Yw,t),!0):(r!==0||i!==1||s!==2)&&QTe(e,t,0,1,2)}const PGe=.99619469809,KR=M(),uS=M(),Yw=M(),kD=M(),UD=M();function NX(e,t,r){return t!==e&&R6(e,t),e[3]=-Te(e,r),e}function FX(e,t){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t}function gI(e,t,r,i){return ut(Yw,t,e),pA(r,Yw,i)}function T$t(e,t,r,i){return O6(e,t,pe(He.get(),r,t),kGe,i)}function JT(e,t,r){return!!b(t)&&O6(e,t.origin,t.direction,UGe,r)}function IGe(e,t,r){return O6(e,t.origin,t.vector,Hm.NONE,r)}function $Ge(e,t,r){return O6(e,t.origin,t.vector,Hm.CLAMP,r)}function JTe(e,t){return ui(e,t)>=0}function LGe(e,t){const r=t[0],i=t[1],s=t[2],n=t[3],o=t[4],a=t[5];return e[0]*(e[0]>0?r:n)+e[1]*(e[1]>0?i:o)+e[2]*(e[2]>0?s:a)+e[3]>=0}function DGe(e,t){const r=Te(e,t.ray.direction),i=-ui(e,t.ray.origin);if(i<0&&r>=0)return!1;if(r>-1e-6&&r<1e-6)return i>0;if((i<0||r<0)&&!(i<0&&r<0))return!0;const s=i/r;return r>0?s<t.c1&&(t.c1=s):s>t.c0&&(t.c0=s),t.c0<=t.c1}function NGe(e,t){const r=Te(e,t.ray.direction),i=-ui(e,t.ray.origin);if(r>-1e-6&&r<1e-6)return i>0;const s=i/r;return r>0?s<t.c1&&(t.c1=s):s>t.c0&&(t.c0=s),t.c0<=t.c1}function FGe(e,t,r){const i=le(He.get(),e,-e[3]),s=kX(e,pe(He.get(),t,i),He.get());return de(r,s,i),r}function kX(e,t,r){const i=le(He.get(),e,Te(e,t));return pe(r,t,i),r}function ui(e,t){return Te(e,t)+e[3]}function O6(e,t,r,i,s){const n=Te(e,r);if(n===0)return!1;let o=-(Te(e,t)+e[3])/n;return i&Hm.CLAMP&&(o=Le(o,0,1)),!(!(i&Hm.INFINITE_MIN)&&o<0||!(i&Hm.INFINITE_MAX)&&o>1)&&(de(s,t,le(s,r,o)),!0)}function S$t(e){return e}const kM=[0,0,1,0];var Hm;(function(e){e[e.NONE=0]="NONE",e[e.CLAMP=1]="CLAMP",e[e.INFINITE_MIN=4]="INFINITE_MIN",e[e.INFINITE_MAX=8]="INFINITE_MAX"})(Hm||(Hm={}));const kGe=Hm.INFINITE_MIN|Hm.INFINITE_MAX,UGe=Hm.INFINITE_MAX,K9=fe.getLogger("esri.views.3d.support.geometryUtils.boundedPlane");class KTe{constructor(){this.plane=Er(),this.origin=M(),this.basis1=M(),this.basis2=M()}}function Q1(e=uSe){return{plane:Er(e.plane),origin:Qs(e.origin),basis1:Qs(e.basis1),basis2:Qs(e.basis2)}}function VGe(e,t,r){const i=JGe.get();return i.origin=e,i.basis1=t,i.basis2=r,i.plane=MGe(0,0,0,0),M6(i),i}function KT(e,t=Q1()){return vte(e.origin,e.basis1,e.basis2,t)}function zGe(e,t){ae(t.origin,e.origin),ae(t.basis1,e.basis1),ae(t.basis2,e.basis2),R6(t.plane,e.plane)}function vte(e,t,r,i=Q1()){return ae(i.origin,e),ae(i.basis1,t),ae(i.basis2,r),M6(i),YGe(i,"fromValues()"),i}function M6(e){gI(e.basis2,e.basis1,e.origin,e.plane)}function eSe(e,t,r){e!==r&&KT(e,r);const i=le(He.get(),f0(e),t);return de(r.origin,r.origin,i),r.plane[3]-=t,r}function BGe(e,t,r){return tSe(t,r),eSe(r,xte(e,e.origin),r),r}function tSe(e,t=Q1()){const r=(e[2]-e[0])/2,i=(e[3]-e[1])/2;return se(t.origin,e[0]+r,e[1]+i,0),se(t.basis1,r,0,0),se(t.basis2,0,i,0),yte(0,0,1,0,t.plane),t}function _te(e,t,r){return!!JT(e.plane,t,r)&&lSe(e,r)}function GGe(e,t,r){if(_te(e,t,r))return r;const i=rSe(e,t,He.get());return de(r,t.origin,le(He.get(),t.direction,pi(t.origin,i)/Re(t.direction))),r}function rSe(e,t,r){const i=BU.get();cSe(e,t,i,BU.get());let s=Number.POSITIVE_INFINITY;for(const n of Ste){const o=Tte(e,n,P6.get()),a=He.get();if(IGe(i,o,a)){const l=S0(He.get(),t.origin,a),c=Math.abs(Cn(Te(t.direction,l)));c<s&&(s=c,ae(r,a))}}return s===Number.POSITIVE_INFINITY?iSe(e,t,r):r}function iSe(e,t,r){if(_te(e,t,r))return r;const i=BU.get(),s=BU.get();cSe(e,t,i,s);let n=Number.POSITIVE_INFINITY;for(const o of Ste){const a=Tte(e,o,P6.get()),l=He.get();if($Ge(i,a,l)){const c=hGe(t,l);if(!JTe(s,l))continue;c<n&&(n=c,ae(r,l))}}return bte(e,t.origin)<n&&sSe(e,t.origin,r),r}function sSe(e,t,r){const i=FGe(e.plane,t,He.get()),s=$X(Ole(e,e.basis1),i,-1,1,He.get()),n=$X(Ole(e,e.basis2),i,-1,1,He.get());return pe(r,de(He.get(),s,n),e.origin),r}function nSe(e,t,r){const{origin:i,basis1:s,basis2:n}=e,o=pe(He.get(),t,i),a=Q3(s,o),l=Q3(n,o),c=Q3(f0(e),o);return se(r,a,l,c)}function bte(e,t){const r=nSe(e,t,He.get()),{basis1:i,basis2:s}=e,n=Re(i),o=Re(s),a=Math.max(Math.abs(r[0])-n,0),l=Math.max(Math.abs(r[1])-o,0),c=r[2];return a*a+l*l+c*c}function jGe(e,t){return Math.sqrt(bte(e,t))}function HGe(e,t){let r=Number.NEGATIVE_INFINITY;for(const i of Ste){const s=Tte(e,i,P6.get()),n=mte(s,t);n>r&&(r=n)}return Math.sqrt(r)}function wte(e,t){return JTe(e.plane,t)&&lSe(e,t)}function qGe(e,t,r,i){return ZGe(e,r,i)}function xte(e,t){const r=-e.plane[3];return Q3(f0(e),t)-r}function WGe(e,t,r,i){const s=xte(e,t),n=le(QGe,f0(e),r-s);return de(i,t,n),i}function oSe(e,t){return Xl(e.basis1,t.basis1)&&Xl(e.basis2,t.basis2)&&Xl(e.origin,t.origin)}function aSe(e,t,r){return e!==r&&KT(e,r),Cs(hS,t),lc(hS,hS),Ve(r.basis1,e.basis1,hS),Ve(r.basis2,e.basis2,hS),Ve(r.plane,e.plane,hS),Ve(r.origin,e.origin,t),NX(r.plane,r.plane,r.origin),r}function XGe(e,t,r,i){return e!==i&&KT(e,i),_h(eG,t,r),Ve(i.basis1,e.basis1,eG),Ve(i.basis2,e.basis2,eG),M6(i),i}function f0(e){return e.plane}function ZGe(e,t,r){switch(t){case hh.X:ae(r,e.basis1),we(r,r);break;case hh.Y:ae(r,e.basis2),we(r,r);break;case hh.Z:ae(r,f0(e))}return r}function lSe(e,t){const r=pe(He.get(),t,e.origin),i=ul(e.basis1),s=ul(e.basis2),n=Te(e.basis1,r),o=Te(e.basis2,r);return-n-i<0&&n-i<0&&-o-s<0&&o-s<0}function Ole(e,t){const r=P6.get();return ae(r.origin,e.origin),ae(r.vector,t),r}function Tte(e,t,r){const{basis1:i,basis2:s,origin:n}=e,o=le(He.get(),i,t.origin[0]),a=le(He.get(),s,t.origin[1]);de(r.origin,o,a),de(r.origin,r.origin,n);const l=le(He.get(),i,t.direction[0]),c=le(He.get(),s,t.direction[1]);return le(r.vector,de(l,l,c),2),r}function YGe(e,t){Math.abs(Te(e.basis1,e.basis2)/(Re(e.basis1)*Re(e.basis2)))>1e-6&&K9.warn(t,"Provided basis vectors are not perpendicular"),Math.abs(Te(e.basis1,f0(e)))>1e-6&&K9.warn(t,"Basis vectors and plane normal are not perpendicular"),Math.abs(-Te(f0(e),e.origin)-e.plane[3])>1e-6&&K9.warn(t,"Plane offset is not consistent with plane origin")}function cSe(e,t,r,i){const s=f0(e);gI(s,t.direction,t.origin,r),gI(r,s,t.origin,i)}const uSe={plane:Er(),origin:Ue(0,0,0),basis1:Ue(1,0,0),basis2:Ue(0,1,0)},BU=new C0(Er),P6=new C0(yg),QGe=M(),JGe=new C0(()=>({origin:null,basis1:null,basis2:null,plane:null})),Ste=[{origin:[-1,-1],direction:[1,0]},{origin:[1,-1],direction:[0,1]},{origin:[1,1],direction:[-1,0]},{origin:[-1,1],direction:[0,-1]}],hS=Ce(),eG=Ce(),KGe=Object.freeze(Object.defineProperty({__proto__:null,BoundedPlaneClass:KTe,create:Q1,wrap:VGe,copy:KT,copyWithoutVerify:zGe,fromValues:vte,updateUnboundedPlane:M6,elevate:eSe,setExtent:BGe,fromAABoundingRect:tSe,intersectRay:_te,intersectRayClosestSilhouette:GGe,closestPointOnSilhouette:rSe,closestPoint:iSe,projectPoint:sSe,projectPointLocal:nSe,distance2:bte,distance:jGe,distanceToSilhouette:HGe,extrusionContainsPoint:wte,axisAt:qGe,altitudeAt:xte,setAltitudeAt:WGe,equals:oSe,transform:aSe,rotate:XGe,normal:f0,UP:uSe},Symbol.toStringTag,{value:"Module"}));function e7e(e){const{value:t,operations:r}=e;return{operations:r,value:r.create(t)}}function t7e(e,t,r){return e.operations.setExtent(e.value,t,r.value),r}function r7e(e){return{operations:e,value:e.create()}}function hSe(e,t,r=r7e(e)){return r.operations=e,e.copy(t,r.value),r}function i7e(e){return hSe(CGe,jTe(0,0,0,Ar(e).radius))}const Mle=2**50;function s7e(){return hSe(KGe,vte([0,0,0],[Mle,0,0],[0,Mle,0]))}function n7e(e,t,r){return e.operations.axisAt(e.value,t,hh.Z,r)}function o7e(e,t,r,i){return e.operations.axisAt(e.value,t,r,i)}function a7e(e,t,r){return e.operations.intersectRay(e.value,t,r)}function l7e(e,t,r){return e.operations.intersectRayClosestSilhouette(e.value,t,r)}function c7e(e,t){return e.operations.altitudeAt(e.value,t)}function dSe(e,t,r,i){return e.operations.setAltitudeAt(e.value,t,r,i)}function u7e(e,t,r,i){return t!==i&&Is(i,t),se(dS,i[12],i[13],i[14]),dSe(e,dS,r,dS),i[12]=dS[0],i[13]=dS[1],i[14]=dS[2],i}function tG(e,t,r){return e.operations.elevate(e.value,t,r.value)}const dS=M();function Ple(e,t,r,i,s){return s[0]=Te(e,t),s[1]=Te(e,r),s[2]=Te(e,i),s}function UX(e,t,r,i,s){ae(r,e),ae(VD,t),we(VD,VD),ut(i,VD,r),ut(s,i,r)}function pSe(e,t){return e?rg(t):t.isGeographic?Ze.PlateCarree:t}const VD=M(),fSe=96;function E$t(e,t){const r=t||e.extent,i=e.width,s=uu(r&&r.spatialReference);return r&&i?r.width/i*s*Nxe*fSe:0}function mSe(e,t){return e/(uu(t)*Nxe*fSe)}const h7e=fe.getLogger("esri.support.AnalysesCollection");let fA=class extends X3{constructor(e){super(e),this.handles.add(this.on("before-add",t=>{R(t.item)||t.item.parent===this.owner&&(h7e.warn("Analysis inside the collection must be unique. Not adding this element again."),t.preventDefault())}))}_own(e){e.parent=this.owner}_release(e){e.parent=null}};fA=u([$("esri.support.AnalysesCollection")],fA);const c5={widthBreakpoint:{getValue(e){const t=e.viewSize[0],r=e.breakpoints,i=this.values;return t<=r.xsmall?i.xsmall:t<=r.small?i.small:t<=r.medium?i.medium:t<=r.large?i.large:i.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-width-xsmall esri-view-width-less-than-small esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",small:"esri-view-width-small esri-view-width-greater-than-xsmall esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",medium:"esri-view-width-medium esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-less-than-large esri-view-width-less-than-xlarge",large:"esri-view-width-large esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-less-than-xlarge",xlarge:"esri-view-width-xlarge esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-greater-than-large"}},heightBreakpoint:{getValue(e){const t=e.viewSize[1],r=e.breakpoints,i=this.values;return t<=r.xsmall?i.xsmall:t<=r.small?i.small:t<=r.medium?i.medium:t<=r.large?i.large:i.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-height-xsmall esri-view-height-less-than-small esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",small:"esri-view-height-small esri-view-height-greater-than-xsmall esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",medium:"esri-view-height-medium esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-less-than-large esri-view-height-less-than-xlarge",large:"esri-view-height-large esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-less-than-xlarge",xlarge:"esri-view-height-xlarge esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-greater-than-large"}},orientation:{getValue(e){const t=e.viewSize,r=t[0],i=t[1],s=this.values;return i>=r?s.portrait:s.landscape},values:{portrait:"portrait",landscape:"landscape"},valueToClassName:{portrait:"esri-view-orientation-portrait",landscape:"esri-view-orientation-landscape"}}},rG={xsmall:544,small:768,medium:992,large:1200};function d7e(e){const t=e;return t&&t.xsmall<t.small&&t.small<t.medium&&t.medium<t.large}function iG(e,t){return t?c5[e].valueToClassName[t].split(" "):[]}const p7e=e=>{let t=class extends e{constructor(...r){super(...r),this._breakpointsHandles=new Dt,this.orientation=null,this.widthBreakpoint=null,this.heightBreakpoint=null,this.breakpoints=rG}initialize(){this._breakpointsHandles.add(te(()=>[this.breakpoints,this.size],()=>this._updateClassNames(),Rt))}destroy(){this.destroyed||(this._removeActiveClassNames(),this._breakpointsHandles=ct(this._breakpointsHandles))}set breakpoints(r){if(r===this._get("breakpoints"))return;const i=d7e(r);if(!i){const s=JSON.stringify(rG,null,2);console.warn("provided breakpoints are not valid, using defaults:"+s)}r=i?r:rG,this._set("breakpoints",{...r})}_updateClassNames(){if(!this.container)return;const r=Uc.acquire(),i=Uc.acquire();let s,n=!1;for(s in c5){const o=this[s],a=c5[s].getValue({viewSize:this.size,breakpoints:this.breakpoints});o!==a&&(n=!0,this[s]=a,iG(s,o).forEach(l=>i.push(l)),iG(s,a).forEach(l=>r.push(l)))}n&&(this._applyClassNameChanges(r,i),Uc.release(r),Uc.release(i))}_applyClassNameChanges(r,i){const s=this.container;s&&(i.forEach(n=>s.classList.remove(n)),r.forEach(n=>s.classList.add(n)))}_removeActiveClassNames(){const r=this.container;if(!r)return;let i;for(i in c5)iG(i,this[i]).forEach(s=>r.classList.remove(s))}};return u([d()],t.prototype,"breakpoints",null),u([d()],t.prototype,"orientation",void 0),u([d()],t.prototype,"widthBreakpoint",void 0),u([d()],t.prototype,"heightBreakpoint",void 0),t=u([$("esri.views.BreakpointsOwner")],t),t};/*!
 * @esri/arcgis-html-sanitizer - v2.10.0 - Tue Mar 15 2022 16:38:25 GMT-0400 (Eastern Daylight Time)
 * Copyright (c) 2022 - Environmental Systems Research Institute, Inc.
 * Apache-2.0
 * 
 * js-xss
 * Copyright (c) 2012-2017 Zongmin Lei() <leizongmin@gmail.com>
 * http://ucdok.com
 * MIT License, see https://github.com/leizongmin/js-xss/blob/master/LICENSE for details
 * 
 * Lodash/isPlainObject
 * Copyright (c) JS Foundation and other contributors <https://js.foundation/>
 * MIT License, see https://raw.githubusercontent.com/lodash/lodash/4.17.10-npm/LICENSE for details
 */var f7e="[object Object]";function m7e(e){var t=!1;if(e!=null&&typeof e.toString!="function")try{t=!!(e+"")}catch{}return t}function g7e(e,t){return function(r){return e(t(r))}}var y7e=Function.prototype,gSe=Object.prototype,ySe=y7e.toString,v7e=gSe.hasOwnProperty,_7e=ySe.call(Object),b7e=gSe.toString,w7e=g7e(Object.getPrototypeOf,Object);function x7e(e){return!!e&&typeof e=="object"}function T7e(e){if(!x7e(e)||b7e.call(e)!=f7e||m7e(e))return!1;var t=w7e(e);if(t===null)return!0;var r=v7e.call(t,"constructor")&&t.constructor;return typeof r=="function"&&r instanceof r&&ySe.call(r)==_7e}var S7e=T7e,Qw={exports:{}},sn={},yI={exports:{}},eS={};function vSe(){var e={};return e["align-content"]=!1,e["align-items"]=!1,e["align-self"]=!1,e["alignment-adjust"]=!1,e["alignment-baseline"]=!1,e.all=!1,e["anchor-point"]=!1,e.animation=!1,e["animation-delay"]=!1,e["animation-direction"]=!1,e["animation-duration"]=!1,e["animation-fill-mode"]=!1,e["animation-iteration-count"]=!1,e["animation-name"]=!1,e["animation-play-state"]=!1,e["animation-timing-function"]=!1,e.azimuth=!1,e["backface-visibility"]=!1,e.background=!0,e["background-attachment"]=!0,e["background-clip"]=!0,e["background-color"]=!0,e["background-image"]=!0,e["background-origin"]=!0,e["background-position"]=!0,e["background-repeat"]=!0,e["background-size"]=!0,e["baseline-shift"]=!1,e.binding=!1,e.bleed=!1,e["bookmark-label"]=!1,e["bookmark-level"]=!1,e["bookmark-state"]=!1,e.border=!0,e["border-bottom"]=!0,e["border-bottom-color"]=!0,e["border-bottom-left-radius"]=!0,e["border-bottom-right-radius"]=!0,e["border-bottom-style"]=!0,e["border-bottom-width"]=!0,e["border-collapse"]=!0,e["border-color"]=!0,e["border-image"]=!0,e["border-image-outset"]=!0,e["border-image-repeat"]=!0,e["border-image-slice"]=!0,e["border-image-source"]=!0,e["border-image-width"]=!0,e["border-left"]=!0,e["border-left-color"]=!0,e["border-left-style"]=!0,e["border-left-width"]=!0,e["border-radius"]=!0,e["border-right"]=!0,e["border-right-color"]=!0,e["border-right-style"]=!0,e["border-right-width"]=!0,e["border-spacing"]=!0,e["border-style"]=!0,e["border-top"]=!0,e["border-top-color"]=!0,e["border-top-left-radius"]=!0,e["border-top-right-radius"]=!0,e["border-top-style"]=!0,e["border-top-width"]=!0,e["border-width"]=!0,e.bottom=!1,e["box-decoration-break"]=!0,e["box-shadow"]=!0,e["box-sizing"]=!0,e["box-snap"]=!0,e["box-suppress"]=!0,e["break-after"]=!0,e["break-before"]=!0,e["break-inside"]=!0,e["caption-side"]=!1,e.chains=!1,e.clear=!0,e.clip=!1,e["clip-path"]=!1,e["clip-rule"]=!1,e.color=!0,e["color-interpolation-filters"]=!0,e["column-count"]=!1,e["column-fill"]=!1,e["column-gap"]=!1,e["column-rule"]=!1,e["column-rule-color"]=!1,e["column-rule-style"]=!1,e["column-rule-width"]=!1,e["column-span"]=!1,e["column-width"]=!1,e.columns=!1,e.contain=!1,e.content=!1,e["counter-increment"]=!1,e["counter-reset"]=!1,e["counter-set"]=!1,e.crop=!1,e.cue=!1,e["cue-after"]=!1,e["cue-before"]=!1,e.cursor=!1,e.direction=!1,e.display=!0,e["display-inside"]=!0,e["display-list"]=!0,e["display-outside"]=!0,e["dominant-baseline"]=!1,e.elevation=!1,e["empty-cells"]=!1,e.filter=!1,e.flex=!1,e["flex-basis"]=!1,e["flex-direction"]=!1,e["flex-flow"]=!1,e["flex-grow"]=!1,e["flex-shrink"]=!1,e["flex-wrap"]=!1,e.float=!1,e["float-offset"]=!1,e["flood-color"]=!1,e["flood-opacity"]=!1,e["flow-from"]=!1,e["flow-into"]=!1,e.font=!0,e["font-family"]=!0,e["font-feature-settings"]=!0,e["font-kerning"]=!0,e["font-language-override"]=!0,e["font-size"]=!0,e["font-size-adjust"]=!0,e["font-stretch"]=!0,e["font-style"]=!0,e["font-synthesis"]=!0,e["font-variant"]=!0,e["font-variant-alternates"]=!0,e["font-variant-caps"]=!0,e["font-variant-east-asian"]=!0,e["font-variant-ligatures"]=!0,e["font-variant-numeric"]=!0,e["font-variant-position"]=!0,e["font-weight"]=!0,e.grid=!1,e["grid-area"]=!1,e["grid-auto-columns"]=!1,e["grid-auto-flow"]=!1,e["grid-auto-rows"]=!1,e["grid-column"]=!1,e["grid-column-end"]=!1,e["grid-column-start"]=!1,e["grid-row"]=!1,e["grid-row-end"]=!1,e["grid-row-start"]=!1,e["grid-template"]=!1,e["grid-template-areas"]=!1,e["grid-template-columns"]=!1,e["grid-template-rows"]=!1,e["hanging-punctuation"]=!1,e.height=!0,e.hyphens=!1,e.icon=!1,e["image-orientation"]=!1,e["image-resolution"]=!1,e["ime-mode"]=!1,e["initial-letters"]=!1,e["inline-box-align"]=!1,e["justify-content"]=!1,e["justify-items"]=!1,e["justify-self"]=!1,e.left=!1,e["letter-spacing"]=!0,e["lighting-color"]=!0,e["line-box-contain"]=!1,e["line-break"]=!1,e["line-grid"]=!1,e["line-height"]=!1,e["line-snap"]=!1,e["line-stacking"]=!1,e["line-stacking-ruby"]=!1,e["line-stacking-shift"]=!1,e["line-stacking-strategy"]=!1,e["list-style"]=!0,e["list-style-image"]=!0,e["list-style-position"]=!0,e["list-style-type"]=!0,e.margin=!0,e["margin-bottom"]=!0,e["margin-left"]=!0,e["margin-right"]=!0,e["margin-top"]=!0,e["marker-offset"]=!1,e["marker-side"]=!1,e.marks=!1,e.mask=!1,e["mask-box"]=!1,e["mask-box-outset"]=!1,e["mask-box-repeat"]=!1,e["mask-box-slice"]=!1,e["mask-box-source"]=!1,e["mask-box-width"]=!1,e["mask-clip"]=!1,e["mask-image"]=!1,e["mask-origin"]=!1,e["mask-position"]=!1,e["mask-repeat"]=!1,e["mask-size"]=!1,e["mask-source-type"]=!1,e["mask-type"]=!1,e["max-height"]=!0,e["max-lines"]=!1,e["max-width"]=!0,e["min-height"]=!0,e["min-width"]=!0,e["move-to"]=!1,e["nav-down"]=!1,e["nav-index"]=!1,e["nav-left"]=!1,e["nav-right"]=!1,e["nav-up"]=!1,e["object-fit"]=!1,e["object-position"]=!1,e.opacity=!1,e.order=!1,e.orphans=!1,e.outline=!1,e["outline-color"]=!1,e["outline-offset"]=!1,e["outline-style"]=!1,e["outline-width"]=!1,e.overflow=!1,e["overflow-wrap"]=!1,e["overflow-x"]=!1,e["overflow-y"]=!1,e.padding=!0,e["padding-bottom"]=!0,e["padding-left"]=!0,e["padding-right"]=!0,e["padding-top"]=!0,e.page=!1,e["page-break-after"]=!1,e["page-break-before"]=!1,e["page-break-inside"]=!1,e["page-policy"]=!1,e.pause=!1,e["pause-after"]=!1,e["pause-before"]=!1,e.perspective=!1,e["perspective-origin"]=!1,e.pitch=!1,e["pitch-range"]=!1,e["play-during"]=!1,e.position=!1,e["presentation-level"]=!1,e.quotes=!1,e["region-fragment"]=!1,e.resize=!1,e.rest=!1,e["rest-after"]=!1,e["rest-before"]=!1,e.richness=!1,e.right=!1,e.rotation=!1,e["rotation-point"]=!1,e["ruby-align"]=!1,e["ruby-merge"]=!1,e["ruby-position"]=!1,e["shape-image-threshold"]=!1,e["shape-outside"]=!1,e["shape-margin"]=!1,e.size=!1,e.speak=!1,e["speak-as"]=!1,e["speak-header"]=!1,e["speak-numeral"]=!1,e["speak-punctuation"]=!1,e["speech-rate"]=!1,e.stress=!1,e["string-set"]=!1,e["tab-size"]=!1,e["table-layout"]=!1,e["text-align"]=!0,e["text-align-last"]=!0,e["text-combine-upright"]=!0,e["text-decoration"]=!0,e["text-decoration-color"]=!0,e["text-decoration-line"]=!0,e["text-decoration-skip"]=!0,e["text-decoration-style"]=!0,e["text-emphasis"]=!0,e["text-emphasis-color"]=!0,e["text-emphasis-position"]=!0,e["text-emphasis-style"]=!0,e["text-height"]=!0,e["text-indent"]=!0,e["text-justify"]=!0,e["text-orientation"]=!0,e["text-overflow"]=!0,e["text-shadow"]=!0,e["text-space-collapse"]=!0,e["text-transform"]=!0,e["text-underline-position"]=!0,e["text-wrap"]=!0,e.top=!1,e.transform=!1,e["transform-origin"]=!1,e["transform-style"]=!1,e.transition=!1,e["transition-delay"]=!1,e["transition-duration"]=!1,e["transition-property"]=!1,e["transition-timing-function"]=!1,e["unicode-bidi"]=!1,e["vertical-align"]=!1,e.visibility=!1,e["voice-balance"]=!1,e["voice-duration"]=!1,e["voice-family"]=!1,e["voice-pitch"]=!1,e["voice-range"]=!1,e["voice-rate"]=!1,e["voice-stress"]=!1,e["voice-volume"]=!1,e.volume=!1,e["white-space"]=!1,e.widows=!1,e.width=!0,e["will-change"]=!1,e["word-break"]=!0,e["word-spacing"]=!0,e["word-wrap"]=!0,e["wrap-flow"]=!1,e["wrap-through"]=!1,e["writing-mode"]=!1,e["z-index"]=!1,e}function E7e(e,t,r){}function C7e(e,t,r){}var A7e=/javascript\s*\:/img;function R7e(e,t){return A7e.test(t)?"":t}eS.whiteList=vSe();eS.getDefaultWhiteList=vSe;eS.onAttr=E7e;eS.onIgnoreAttr=C7e;eS.safeAttrValue=R7e;var O7e={indexOf:function(e,t){var r,i;if(Array.prototype.indexOf)return e.indexOf(t);for(r=0,i=e.length;r<i;r++)if(e[r]===t)return r;return-1},forEach:function(e,t,r){var i,s;if(Array.prototype.forEach)return e.forEach(t,r);for(i=0,s=e.length;i<s;i++)t.call(r,e[i],i,e)},trim:function(e){return String.prototype.trim?e.trim():e.replace(/(^\s*)|(\s*$)/g,"")},trimRight:function(e){return String.prototype.trimRight?e.trimRight():e.replace(/(\s*$)/g,"")}},eO=O7e;function M7e(e,t){e=eO.trimRight(e),e[e.length-1]!==";"&&(e+=";");var r=e.length,i=!1,s=0,n=0,o="";function a(){if(!i){var h=eO.trim(e.slice(s,n)),p=h.indexOf(":");if(p!==-1){var f=eO.trim(h.slice(0,p)),m=eO.trim(h.slice(p+1));if(f){var g=t(s,o.length,f,m,h);g&&(o+=g+"; ")}}}s=n+1}for(;n<r;n++){var l=e[n];if(l==="/"&&e[n+1]==="*"){var c=e.indexOf("*/",n+2);if(c===-1)break;n=c+1,s=n+1,i=!1}else l==="("?i=!0:l===")"?i=!1:l===";"?i||a():l===`
`&&a()}return eO.trim(o)}var P7e=M7e,zD=eS,I7e=P7e;function Ile(e){return e==null}function $7e(e){var t={};for(var r in e)t[r]=e[r];return t}function _Se(e){e=$7e(e||{}),e.whiteList=e.whiteList||zD.whiteList,e.onAttr=e.onAttr||zD.onAttr,e.onIgnoreAttr=e.onIgnoreAttr||zD.onIgnoreAttr,e.safeAttrValue=e.safeAttrValue||zD.safeAttrValue,this.options=e}_Se.prototype.process=function(e){if(e=e||"",e=e.toString(),!e)return"";var t=this,r=t.options,i=r.whiteList,s=r.onAttr,n=r.onIgnoreAttr,o=r.safeAttrValue,a=I7e(e,function(l,c,h,p,f){var m=i[h],g=!1;if(m===!0?g=m:typeof m=="function"?g=m(p):m instanceof RegExp&&(g=m.test(p)),g!==!0&&(g=!1),p=o(h,p),!!p){var v={position:c,sourcePosition:l,source:f,isWhite:g};if(g){var w=s(h,p,v);return Ile(w)?h+":"+p:w}else{var w=n(h,p,v);if(!Ile(w))return w}}});return a};var L7e=_Se;(function(e,t){var r=eS,i=L7e;function s(o,a){var l=new i(a);return l.process(o)}t=e.exports=s,t.FilterCSS=i;for(var n in r)t[n]=r[n]})(yI,yI.exports);var Ete={indexOf:function(e,t){var r,i;if(Array.prototype.indexOf)return e.indexOf(t);for(r=0,i=e.length;r<i;r++)if(e[r]===t)return r;return-1},forEach:function(e,t,r){var i,s;if(Array.prototype.forEach)return e.forEach(t,r);for(i=0,s=e.length;i<s;i++)t.call(r,e[i],i,e)},trim:function(e){return String.prototype.trim?e.trim():e.replace(/(^\s*)|(\s*$)/g,"")},spaceIndex:function(e){var t=/\s|\n|\t/,r=t.exec(e);return r?r.index:-1}},D7e=yI.exports.FilterCSS,N7e=yI.exports.getDefaultWhiteList,GU=Ete;function bSe(){return{a:["target","href","title"],abbr:["title"],address:[],area:["shape","coords","href","alt"],article:[],aside:[],audio:["autoplay","controls","crossorigin","loop","muted","preload","src"],b:[],bdi:["dir"],bdo:["dir"],big:[],blockquote:["cite"],br:[],caption:[],center:[],cite:[],code:[],col:["align","valign","span","width"],colgroup:["align","valign","span","width"],dd:[],del:["datetime"],details:["open"],div:[],dl:[],dt:[],em:[],figcaption:[],figure:[],font:["color","size","face"],footer:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],header:[],hr:[],i:[],img:["src","alt","title","width","height"],ins:["datetime"],li:[],mark:[],nav:[],ol:[],p:[],pre:[],s:[],section:[],small:[],span:[],sub:[],summary:[],sup:[],strong:[],strike:[],table:["width","border","align","valign"],tbody:["align","valign"],td:["width","rowspan","colspan","align","valign"],tfoot:["align","valign"],th:["width","rowspan","colspan","align","valign"],thead:["align","valign"],tr:["rowspan","align","valign"],tt:[],u:[],ul:[],video:["autoplay","controls","crossorigin","loop","muted","playsinline","poster","preload","src","height","width"]}}var wSe=new D7e;function F7e(e,t,r){}function k7e(e,t,r){}function U7e(e,t,r){}function V7e(e,t,r){}function xSe(e){return e.replace(B7e,"&lt;").replace(G7e,"&gt;")}function z7e(e,t,r,i){if(r=RSe(r),t==="href"||t==="src"){if(r=GU.trim(r),r==="#")return"#";if(!(r.substr(0,7)==="http://"||r.substr(0,8)==="https://"||r.substr(0,7)==="mailto:"||r.substr(0,4)==="tel:"||r.substr(0,11)==="data:image/"||r.substr(0,6)==="ftp://"||r.substr(0,2)==="./"||r.substr(0,3)==="../"||r[0]==="#"||r[0]==="/"))return""}else if(t==="background"){if(BD.lastIndex=0,BD.test(r))return""}else if(t==="style"){if($le.lastIndex=0,$le.test(r)||(Lle.lastIndex=0,Lle.test(r)&&(BD.lastIndex=0,BD.test(r))))return"";i!==!1&&(i=i||wSe,r=i.process(r))}return r=OSe(r),r}var B7e=/</g,G7e=/>/g,j7e=/"/g,H7e=/&quot;/g,q7e=/&#([a-zA-Z0-9]*);?/gim,W7e=/&colon;?/gim,X7e=/&newline;?/gim,BD=/((j\s*a\s*v\s*a|v\s*b|l\s*i\s*v\s*e)\s*s\s*c\s*r\s*i\s*p\s*t\s*|m\s*o\s*c\s*h\s*a)\:/gi,$le=/e\s*x\s*p\s*r\s*e\s*s\s*s\s*i\s*o\s*n\s*\(.*/gi,Lle=/u\s*r\s*l\s*\(.*/gi;function TSe(e){return e.replace(j7e,"&quot;")}function SSe(e){return e.replace(H7e,'"')}function ESe(e){return e.replace(q7e,function(r,i){return i[0]==="x"||i[0]==="X"?String.fromCharCode(parseInt(i.substr(1),16)):String.fromCharCode(parseInt(i,10))})}function CSe(e){return e.replace(W7e,":").replace(X7e," ")}function ASe(e){for(var t="",r=0,i=e.length;r<i;r++)t+=e.charCodeAt(r)<32?" ":e.charAt(r);return GU.trim(t)}function RSe(e){return e=SSe(e),e=ESe(e),e=CSe(e),e=ASe(e),e}function OSe(e){return e=TSe(e),e=xSe(e),e}function Z7e(){return""}function Y7e(e,t){typeof t!="function"&&(t=function(){});var r=!Array.isArray(e);function i(o){return r?!0:GU.indexOf(e,o)!==-1}var s=[],n=!1;return{onIgnoreTag:function(o,a,l){if(i(o))if(l.isClosing){var c="[/removed]",h=l.position+c.length;return s.push([n!==!1?n:l.position,h]),n=!1,c}else return n||(n=l.position),"[removed]";else return t(o,a,l)},remove:function(o){var a="",l=0;return GU.forEach(s,function(c){a+=o.slice(l,c[0]),l=c[1]}),a+=o.slice(l),a}}}function Q7e(e){for(var t="",r=0;r<e.length;){var i=e.indexOf("<!--",r);if(i===-1){t+=e.slice(r);break}t+=e.slice(r,i);var s=e.indexOf("-->",i);if(s===-1)break;r=s+3}return t}function J7e(e){var t=e.split("");return t=t.filter(function(r){var i=r.charCodeAt(0);return i===127?!1:i<=31?i===10||i===13:!0}),t.join("")}sn.whiteList=bSe();sn.getDefaultWhiteList=bSe;sn.onTag=F7e;sn.onIgnoreTag=k7e;sn.onTagAttr=U7e;sn.onIgnoreTagAttr=V7e;sn.safeAttrValue=z7e;sn.escapeHtml=xSe;sn.escapeQuote=TSe;sn.unescapeQuote=SSe;sn.escapeHtmlEntities=ESe;sn.escapeDangerHtml5Entities=CSe;sn.clearNonPrintableCharacter=ASe;sn.friendlyAttrValue=RSe;sn.escapeAttrValue=OSe;sn.onIgnoreTagStripAll=Z7e;sn.StripTagBody=Y7e;sn.stripCommentTag=Q7e;sn.stripBlankChar=J7e;sn.cssFilter=wSe;sn.getDefaultCSSWhiteList=N7e;var I6={},u_=Ete;function K7e(e){var t=u_.spaceIndex(e);if(t===-1)var r=e.slice(1,-1);else var r=e.slice(1,t+1);return r=u_.trim(r).toLowerCase(),r.slice(0,1)==="/"&&(r=r.slice(1)),r.slice(-1)==="/"&&(r=r.slice(0,-1)),r}function eje(e){return e.slice(0,2)==="</"}function tje(e,t,r){var i="",s=0,n=!1,o=!1,a=0,l=e.length,c="",h="";e:for(a=0;a<l;a++){var p=e.charAt(a);if(n===!1){if(p==="<"){n=a;continue}}else if(o===!1){if(p==="<"){i+=r(e.slice(s,a)),n=a,s=a;continue}if(p===">"){i+=r(e.slice(s,n)),h=e.slice(n,a+1),c=K7e(h),i+=t(n,i.length,c,h,eje(h)),s=a+1,n=!1;continue}if(p==='"'||p==="'")for(var f=1,m=e.charAt(a-f);m.trim()===""||m==="=";){if(m==="="){o=p;continue e}m=e.charAt(a-++f)}}else if(p===o){o=!1;continue}}return s<e.length&&(i+=r(e.substr(s))),i}var rje=/[^a-zA-Z0-9_:\.\-]/gim;function ije(e,t){var r=0,i=[],s=!1,n=e.length;function o(p,f){if(p=u_.trim(p),p=p.replace(rje,"").toLowerCase(),!(p.length<1)){var m=t(p,f||"");m&&i.push(m)}}for(var a=0;a<n;a++){var l=e.charAt(a),c,h;if(s===!1&&l==="="){s=e.slice(r,a),r=a+1;continue}if(s!==!1&&a===r&&(l==='"'||l==="'")&&e.charAt(a-1)==="="){if(h=e.indexOf(l,a+1),h===-1)break;c=u_.trim(e.slice(r+1,h)),o(s,c),s=!1,a=h,r=a+1;continue}if(/\s|\n|\t/.test(l))if(e=e.replace(/\s|\n|\t/g," "),s===!1)if(h=sje(e,a),h===-1){c=u_.trim(e.slice(r,a)),o(c),s=!1,r=a+1;continue}else{a=h-1;continue}else if(h=nje(e,a-1),h===-1){c=u_.trim(e.slice(r,a)),c=Dle(c),o(s,c),s=!1,r=a+1;continue}else continue}return r<e.length&&(s===!1?o(e.slice(r)):o(s,Dle(u_.trim(e.slice(r))))),u_.trim(i.join(" "))}function sje(e,t){for(;t<e.length;t++){var r=e[t];if(r!==" ")return r==="="?t:-1}}function nje(e,t){for(;t>0;t--){var r=e[t];if(r!==" ")return r==="="?t:-1}}function oje(e){return e[0]==='"'&&e[e.length-1]==='"'||e[0]==="'"&&e[e.length-1]==="'"}function Dle(e){return oje(e)?e.substr(1,e.length-2):e}I6.parseTag=tje;I6.parseAttr=ije;var aje=yI.exports.FilterCSS,Fp=sn,MSe=I6,lje=MSe.parseTag,cje=MSe.parseAttr,u5=Ete;function GD(e){return e==null}function uje(e){var t=u5.spaceIndex(e);if(t===-1)return{html:"",closing:e[e.length-2]==="/"};e=u5.trim(e.slice(t+1,-1));var r=e[e.length-1]==="/";return r&&(e=u5.trim(e.slice(0,-1))),{html:e,closing:r}}function hje(e){var t={};for(var r in e)t[r]=e[r];return t}function PSe(e){e=hje(e||{}),e.stripIgnoreTag&&(e.onIgnoreTag&&console.error('Notes: cannot use these two options "stripIgnoreTag" and "onIgnoreTag" at the same time'),e.onIgnoreTag=Fp.onIgnoreTagStripAll),e.whiteList=e.whiteList||e.allowList||Fp.whiteList,e.onTag=e.onTag||Fp.onTag,e.onTagAttr=e.onTagAttr||Fp.onTagAttr,e.onIgnoreTag=e.onIgnoreTag||Fp.onIgnoreTag,e.onIgnoreTagAttr=e.onIgnoreTagAttr||Fp.onIgnoreTagAttr,e.safeAttrValue=e.safeAttrValue||Fp.safeAttrValue,e.escapeHtml=e.escapeHtml||Fp.escapeHtml,this.options=e,e.css===!1?this.cssFilter=!1:(e.css=e.css||{},this.cssFilter=new aje(e.css))}PSe.prototype.process=function(e){if(e=e||"",e=e.toString(),!e)return"";var t=this,r=t.options,i=r.whiteList,s=r.onTag,n=r.onIgnoreTag,o=r.onTagAttr,a=r.onIgnoreTagAttr,l=r.safeAttrValue,c=r.escapeHtml,h=t.cssFilter;r.stripBlankChar&&(e=Fp.stripBlankChar(e)),r.allowCommentTag||(e=Fp.stripCommentTag(e));var p=!1;if(r.stripIgnoreTagBody){var p=Fp.StripTagBody(r.stripIgnoreTagBody,n);n=p.onIgnoreTag}var f=lje(e,function(m,g,v,w,_){var T={sourcePosition:m,position:g,isClosing:_,isWhite:i.hasOwnProperty(v)},x=s(v,w,T);if(!GD(x))return x;if(T.isWhite){if(T.isClosing)return"</"+v+">";var E=uje(w),C=i[v],A=cje(E.html,function(I,L){var k=u5.indexOf(C,I)!==-1,G=o(v,I,L,k);if(!GD(G))return G;if(k)return L=l(v,I,L,h),L?I+'="'+L+'"':I;var G=a(v,I,L,k);return GD(G)?void 0:G}),w="<"+v;return A&&(w+=" "+A),E.closing&&(w+=" /"),w+=">",w}else{var x=n(v,w,T);return GD(x)?c(w):x}},c);return p&&(f=p.remove(f)),f};var dje=PSe;(function(e,t){var r=sn,i=I6,s=dje;function n(l,c){var h=new s(c);return h.process(l)}t=e.exports=n,t.filterXSS=n,t.FilterXSS=s;for(var o in r)t[o]=r[o];for(var o in i)t[o]=i[o];function a(){return typeof self<"u"&&typeof DedicatedWorkerGlobalScope<"u"&&self instanceof DedicatedWorkerGlobalScope}a()&&(self.filterXSS=e.exports)})(Qw,Qw.exports);var pje=function(){function e(t,r){var i=this;this.arcgisWhiteList={a:["href","style","target"],abbr:["title"],audio:["autoplay","controls","loop","muted","preload"],b:[],br:[],dd:["style"],div:["align","style"],dl:["style"],dt:["style"],em:[],figcaption:["style"],figure:["style"],font:["color","face","size","style"],h1:["style"],h2:["style"],h3:["style"],h4:["style"],h5:["style"],h6:["style"],hr:[],i:[],img:["alt","border","height","src","style","width"],li:[],ol:[],p:["style"],source:["media","src","type"],span:["style"],strong:[],sub:["style"],sup:["style"],table:["border","cellpadding","cellspacing","height","style","width"],tbody:[],tr:["align","height","style","valign"],td:["align","colspan","height","nowrap","rowspan","style","valign","width"],th:["align","colspan","height","nowrap","rowspan","style","valign","width"],u:[],ul:[],video:["autoplay","controls","height","loop","muted","poster","preload","width"]},this.allowedProtocols=["http","https","mailto","iform","tel","flow","lfmobile","arcgis-navigator","arcgis-appstudio-player","arcgis-survey123","arcgis-collector","arcgis-workforce","arcgis-explorer","arcgis-trek2there","arcgis-quickcapture","mspbi","comgooglemaps","pdfefile","pdfehttp","pdfehttps","boxapp","boxemm","awb","awbs","gropen","radarscope"],this.arcgisFilterOptions={allowCommentTag:!0,safeAttrValue:function(n,o,a,l){return n==="a"&&o==="href"||(n==="img"||n==="source")&&o==="src"?i.sanitizeUrl(a):Qw.exports.safeAttrValue(n,o,a,l)}};var s;t&&!r?s=t:t&&r?(s=Object.create(this.arcgisFilterOptions),Object.keys(t).forEach(function(n){n==="whiteList"?s.whiteList=i._extendObjectOfArrays([i.arcgisWhiteList,t.whiteList||{}]):s[n]=t[n]})):(s=Object.create(this.arcgisFilterOptions),s.whiteList=this.arcgisWhiteList),this.xssFilterOptions=s,this._xssFilter=new Qw.exports.FilterXSS(s)}return e.prototype.sanitize=function(t,r){switch(r===void 0&&(r={}),typeof t){case"number":return isNaN(t)||!isFinite(t)?null:t;case"boolean":return t;case"string":return this._xssFilter.process(t);case"object":return this._iterateOverObject(t,r);default:return r.allowUndefined&&typeof t>"u"?void 0:null}},e.prototype.sanitizeUrl=function(t,r){var i=(r!=null?r:{}).isProtocolRequired,s=i===void 0?!0:i,n=this._trim(t.substring(0,t.indexOf(":"))),o=t==="/",a=/^#/.test(t),l=n&&this.allowedProtocols.indexOf(n.toLowerCase())>-1;return o||a||l?Qw.exports.escapeAttrValue(t):!n&&!s?Qw.exports.escapeAttrValue("https://".concat(t)):""},e.prototype.sanitizeHTMLAttribute=function(t,r,i,s){return typeof this.xssFilterOptions.safeAttrValue=="function"?this.xssFilterOptions.safeAttrValue(t,r,i,s):Qw.exports.safeAttrValue(t,r,i,s)},e.prototype.validate=function(t,r){r===void 0&&(r={});var i=this.sanitize(t,r);return{isValid:t===i,sanitized:i}},e.prototype._extendObjectOfArrays=function(t){var r={};return t.forEach(function(i){Object.keys(i).forEach(function(s){Array.isArray(i[s])&&Array.isArray(r[s])?r[s]=r[s].concat(i[s]):r[s]=i[s]})}),r},e.prototype._iterateOverObject=function(t,r){var i=this;r===void 0&&(r={});try{var s=!1,n=void 0;if(Array.isArray(t))n=t.reduce(function(a,l){var c=i.validate(l,r);return c.isValid?a.concat([l]):(s=!0,a.concat([c.sanitized]))},[]);else if(S7e(t)){var o=Object.keys(t);n=o.reduce(function(a,l){var c=t[l],h=i.validate(c,r);return h.isValid?a[l]=c:(s=!0,a[l]=h.sanitized),a},{})}else return r.allowUndefined&&typeof t>"u"?void 0:null;return s?n:t}catch{return null}},e.prototype._trim=function(t){return String.prototype.trim?t.trim():t.replace(/(^\s*)|(\s*$)/g,"")},e}();const $6=new Map;function ISe(){$6.clear()}function fje(e){return $6.get(e)}function mje(e,t){$6.set(e,t)}function sG(e){$6.delete(e)}var fT,mA,gje=function(e){if("WebkitTransition"in e.style)fT="webkitTransitionEnd",mA="webkitAnimationEnd";else{if(!("transition"in e.style))throw new Error("Your browser is not supported!");fT="transitionend",mA="animationend"}},$Se=function(e){fT||gje(e)},yje=function(e,t){return t===void 0&&(t=e+"-active"),function(r){$Se(r);var i=!1,s=function(n){i||(i=!0,r.removeEventListener(fT,s),r.removeEventListener(mA,s),r.classList.remove(e),r.classList.remove(t))};r.classList.add(e),r.addEventListener(fT,s),r.addEventListener(mA,s),requestAnimationFrame(function(){r.classList.add(t)})}},vje=function(e,t){return t===void 0&&(t=e+"-active"),function(r,i){$Se(r);var s=!1,n=function(o){s||(s=!0,r.removeEventListener(fT,n),r.removeEventListener(mA,n),i())};r.classList.add(e),r.addEventListener(fT,n),r.addEventListener(mA,n),requestAnimationFrame(function(){r.classList.add(t)})}};const _je=fe.getLogger("esri.widgets.support.widgetUtils");function RE(e){const t=Uc.acquire();for(let i=0;i<arguments.length;i++){const s=arguments[i],n=typeof s;if(n==="string")t.push(s);else if(Array.isArray(s))t.push.apply(t,s);else if(n==="object")for(const o in s)s[o]&&t.push(o)}const r=t.join(" ");return Uc.release(t),r}(()=>{const e=new Map,t=new ResizeObserver(r=>{ISe();for(const i of r)e.get(i.target)(i)});return(r,i,s)=>(e.has(r)&&_je.error("Already observing element",r),e.set(r,i),t.observe(r,s),kd(()=>{t.unobserve(r),e.delete(r)}))})();function nf(e){const t=e==null?void 0:e.closest("[dir]");return t!==null&&t instanceof HTMLElement&&t.dir==="rtl"||document.dir==="rtl"}function Nle(e){const t="data-node-ref";this[e.getAttribute(t)]=null}function VX(e){const t="data-node-ref";this[e.getAttribute(t)]=e}function bje(e,t){return(e==="enter"?yje:vje)(t)}const wje=["dd","dl","dt","h1","h2","h3","h4","h5","h6","sub","sup","animate","animatetransform","circle","clippath","defs","ellipse","g","image","line","lineargradient","marker","mask","path","pattern","polygon","polyline","radialgradient","rect","stop","svg","switch","symbol","text","textpath","tspan","use"],xje=wje.reduce((e,t)=>(e[t]=[],e),{}),Tje=["align","alink","alt","bgcolor","border","cellpadding","cellspacing","class","color","cols","colspan","coords","d","dir","face","height","hspace","ismap","lang","marginheight","marginwidth","multiple","nohref","noresize","noshade","nowrap","ref","rel","rev","rows","rowspan","scrolling","shape","span","summary","tabindex","title","usemap","valign","value","vlink","vspace","width"],LSe=new pje({whiteList:xje,onTagAttr:(e,t,r)=>{const i=`${t}="${r}"`;if(Tje.includes(t))return i},stripIgnoreTag:!0,stripIgnoreTagBody:["script","style"]},!0);function Sje(e){return e==="Enter"||e===" "}const DSe="http://www.w3.org/",L6=`${DSe}2000/svg`,NSe=`${DSe}1999/xlink`;let jU,Fle=[],Cte=(e,t)=>{let r={};return Object.keys(e).forEach(i=>{r[i]=e[i]}),t&&Object.keys(t).forEach(i=>{r[i]=t[i]}),r},Ate=(e,t)=>e.vnodeSelector===t.vnodeSelector&&(e.properties&&t.properties?e.properties.key===t.properties.key&&e.properties.bind===t.properties.bind:!e.properties&&!t.properties),FSe=e=>{if(typeof e!="string")throw new Error("Style values must be strings")},Eje=(e,t,r)=>{if(t.vnodeSelector!==""){for(let i=r;i<e.length;i++)if(Ate(e[i],t))return i}return-1},nG=(e,t,r,i)=>{let s=e[t];if(s.vnodeSelector==="")return;let n=s.properties;if(!(n&&(n.key===void 0?n.bind:n.key))){for(let o=0;o<e.length;o++)if(o!==t){let a=e[o];if(Ate(a,s))throw new Error(`${r.vnodeSelector} had a ${s.vnodeSelector} child ${i==="added"?i:"removed"}, but there is now more than one. You must add unique key properties to make them distinguishable.`)}}},Cje=e=>{if(e.properties){let t=e.properties.enterAnimation;t&&t(e.domNode,e.properties)}},zX=[],BX=!1,kSe=e=>{(e.children||[]).forEach(kSe),e.properties&&e.properties.afterRemoved&&e.properties.afterRemoved.apply(e.properties.bind||e.properties,[e.domNode])},kle=()=>{BX=!1,zX.forEach(kSe),zX.length=0},Ule=e=>{zX.push(e),BX||(BX=!0,typeof window<"u"&&"requestIdleCallback"in window?window.requestIdleCallback(kle,{timeout:16}):setTimeout(kle,16))},Vle=e=>{let t=e.domNode;if(e.properties){let r=e.properties.exitAnimation;if(r)return t.style.pointerEvents="none",void r(t,()=>{t.parentNode&&(t.parentNode.removeChild(t),Ule(e))},e.properties)}t.parentNode&&(t.parentNode.removeChild(t),Ule(e))},Aje=(e,t,r)=>{if(!t)return;let i=r.eventHandlerInterceptor,s=Object.keys(t),n=s.length;for(let o=0;o<n;o++){let a=s[o],l=t[a];if(a==="className")throw new Error('Property "className" is not supported, use "class".');if(a==="class")GX(e,l,!0);else if(a==="classes"){let c=Object.keys(l),h=c.length;for(let p=0;p<h;p++){let f=c[p];l[f]&&e.classList.add(f)}}else if(a==="styles"){let c=Object.keys(l),h=c.length;for(let p=0;p<h;p++){let f=c[p],m=l[f];m&&(FSe(m),r.styleApplyer(e,f,m))}}else if(a!=="key"&&l!=null){let c=typeof l;c==="function"?(a.lastIndexOf("on",0)===0&&(i&&(l=i(a,l,e,t)),a==="oninput"&&function(){let h=l;l=function(p){h.apply(this,[p]),p.target["oninput-value"]=p.target.value}}()),e[a]=l):r.namespace===L6?a==="href"?e.setAttributeNS(NSe,a,l):e.setAttribute(a,l):c==="string"&&a!=="value"?a==="innerHTML"?e[a]=LSe.sanitize(l):e.setAttribute(a,l):e[a]=l}}},Rje=(e,t,r)=>{if(t)for(let i of t)OE(i,e,void 0,r)},USe=(e,t,r)=>{Rje(e,t.children,r),t.text&&(e.textContent=t.text),Aje(e,t.properties,r),t.properties&&t.properties.afterCreate&&t.properties.afterCreate.apply(t.properties.bind||t.properties,[e,r,t.vnodeSelector,t.properties,t.children])},OE=(e,t,r,i)=>{let s,n=0,o=e.vnodeSelector,a=t.ownerDocument;if(o==="")s=e.domNode=a.createTextNode(e.text),r!==void 0?t.insertBefore(s,r):t.appendChild(s);else{for(let l=0;l<=o.length;++l){let c=o.charAt(l);if(l===o.length||c==="."||c==="#"){let h=o.charAt(n-1),p=o.slice(n,l);h==="."?s.classList.add(p):h==="#"?s.id=p:(p==="svg"&&(i=Cte(i,{namespace:L6})),i.namespace!==void 0?s=e.domNode=a.createElementNS(i.namespace,p):(s=e.domNode=e.domNode||a.createElement(p),p==="input"&&e.properties&&e.properties.type!==void 0&&s.setAttribute("type",e.properties.type)),r!==void 0?t.insertBefore(s,r):s.parentNode!==t&&t.appendChild(s)),n=l+1}}USe(s,e,i)}},GX=(e,t,r)=>{t&&t.split(" ").forEach(i=>{i&&e.classList.toggle(i,r)})},Oje=(e,t,r,i)=>{if(!r)return;let s=!1,n=Object.keys(r),o=n.length;for(let a=0;a<o;a++){let l=n[a],c=r[l],h=t[l];if(l==="class")h!==c&&(GX(e,h,!1),GX(e,c,!0));else if(l==="classes"){let p=e.classList,f=Object.keys(c),m=f.length;for(let g=0;g<m;g++){let v=f[g],w=!!c[v];w!==!!h[v]&&(s=!0,w?p.add(v):p.remove(v))}}else if(l==="styles"){let p=Object.keys(c),f=p.length;for(let m=0;m<f;m++){let g=p[m],v=c[g];v!==h[g]&&(s=!0,v?(FSe(v),i.styleApplyer(e,g,v)):i.styleApplyer(e,g,""))}}else if(c||typeof h!="string"||(c=""),l==="value"){let p=e[l];p!==c&&(e["oninput-value"]?p===e["oninput-value"]:c!==h)&&(e[l]=c,e["oninput-value"]=void 0),c!==h&&(s=!0)}else if(c!==h){let p=typeof c;p==="function"&&i.eventHandlerInterceptor||(i.namespace===L6?l==="href"?e.setAttributeNS(NSe,l,c):e.setAttribute(l,c):p==="string"?l==="innerHTML"?e[l]=LSe.sanitize(c):l==="role"&&c===""?e.removeAttribute(l):e.setAttribute(l,c):e[l]!==c&&(e[l]=c),s=!0)}}return s},Mje=(e,t,r,i,s)=>{if(r===i)return!1;i=i||Fle;let n,o=(r=r||Fle).length,a=i.length,l=0,c=0,h=!1;for(;c<a;){let p=l<o?r[l]:void 0,f=i[c];if(p!==void 0&&Ate(p,f))h=jU(p,f,s)||h,l++;else{let m=Eje(r,f,l+1);if(m>=0){for(n=l;n<m;n++)Vle(r[n]),nG(r,n,e,"removed");h=jU(r[m],f,s)||h,l=m+1}else OE(f,t,l<o?r[l].domNode:void 0,s),Cje(f),nG(i,c,e,"added")}c++}if(o>l)for(n=l;n<o;n++)Vle(r[n]),nG(r,n,e,"removed");return h};jU=(e,t,r)=>{let i=e.domNode,s=!1;if(e===t)return!1;let n=!1;if(t.vnodeSelector===""){if(t.text!==e.text){let o=i.ownerDocument.createTextNode(t.text);return i.parentNode.replaceChild(o,i),t.domNode=o,s=!0,s}t.domNode=i}else t.vnodeSelector.lastIndexOf("svg",0)===0&&(r=Cte(r,{namespace:L6})),e.text!==t.text&&(n=!0,t.text===void 0?i.removeChild(i.firstChild):i.textContent=t.text),t.domNode=i,n=Mje(t,i,e.children,t.children,r)||n,n=Oje(i,e.properties,t.properties,r)||n,t.properties&&t.properties.afterUpdate&&t.properties.afterUpdate.apply(t.properties.bind||t.properties,[i,r,t.vnodeSelector,t.properties,t.children]);return n&&t.properties&&t.properties.updateAnimation&&t.properties.updateAnimation(i,t.properties,e.properties),s};let tO=(e,t)=>({getLastRender:()=>e,update:r=>{if(e.vnodeSelector!==r.vnodeSelector)throw new Error("The selector for the root VNode may not be changed. (consider using dom.merge and add one extra level to the virtual DOM)");let i=e;e=r,jU(i,r,t)},domNode:e.domNode});const Pje={namespace:void 0,performanceLogger:()=>{},eventHandlerInterceptor:void 0,styleApplyer:(e,t,r)=>{t.charAt(0)==="-"?e.style.setProperty(t,r):e.style[t]=r}};let E2=e=>Cte(Pje,e),j_={create:(e,t)=>(t=E2(t),OE(e,document.createElement("div"),void 0,t),tO(e,t)),append:(e,t,r)=>(r=E2(r),OE(t,e,void 0,r),tO(t,r)),insertBefore:(e,t,r)=>(r=E2(r),OE(t,e.parentNode,e,r),tO(t,r)),merge:(e,t,r)=>(r=E2(r),t.domNode=e,USe(e,t,r),tO(t,r)),replace:(e,t,r)=>(r=E2(r),OE(t,e.parentNode,e,r),e.parentNode.removeChild(e),tO(t,r))},VSe,Ije=(e,t)=>{let r=[];for(;e&&e!==t;)r.push(e),e=e.parentNode;return r};VSe=Array.prototype.find?(e,t)=>e.find(t):(e,t)=>e.filter(t)[0];let $je=(e,t)=>{let r=e;return t.forEach(i=>{r=r&&r.children?VSe(r.children,s=>s.domNode===i):void 0}),r},Lje=(e,t,r)=>{let i=function(s){r("domEvent",s);let n=t(),o=Ije(s.currentTarget,n.domNode);o.reverse();let a,l=$je(n.getLastRender(),o);return e.scheduleRender(),l&&(a=l.properties[`on${s.type}`].apply(l.properties.bind||this,arguments)),r("domEventProcessed",s),a};return(s,n,o,a)=>i},HU=e=>{let t,r,i=E2(e),s=i.performanceLogger,n=!0,o=!1,a=[],l=[],c=(p,f,m)=>{let g,v=()=>g;i.eventHandlerInterceptor=Lje(t,v,s),g=p(f,m(),i),a.push(g),l.push(m)},h=()=>{if(r=void 0,n){n=!1,s("renderStart",void 0);for(let p=0;p<a.length;p++){let f=l[p]();s("rendered",void 0),a[p].update(f),s("patched",void 0)}s("renderDone",void 0),n=!0}};return t={renderNow:h,scheduleRender:()=>{r||o||(r=requestAnimationFrame(h))},stop:()=>{r&&(cancelAnimationFrame(r),r=void 0),o=!0},resume:()=>{o=!1,n=!0,t.scheduleRender()},append:(p,f)=>{c(j_.append,p,f)},insertBefore:(p,f)=>{c(j_.insertBefore,p,f)},merge:(p,f)=>{c(j_.merge,p,f)},replace:(p,f)=>{c(j_.replace,p,f)},detach:p=>{for(let f=0;f<l.length;f++)if(l[f]===p)return l.splice(f,1),a.splice(f,1)[0];throw new Error("renderFunction was not found")}},t},Fv=class extends xe{constructor(){super(...arguments),this.items=new ot,this._watchUpdatingTracking=new Gm,this._callbacks=new Map,this._projector=HU(),this._hiddenProjector=HU()}get needsRender(){return this.items.length>0}initialize(){const e=document.createElement("div");e.className="esri-overlay-surface",this._set("surface",e),this._hiddenSurface=document.createElement("div"),this._hiddenSurface.setAttribute("style","visibility: hidden;"),e.appendChild(this._hiddenSurface),this._watchUpdatingTracking.addOnCollectionChange(()=>this.items,t=>{for(const r of t.added){const i=()=>r.render();this._callbacks.set(r,i),this._projector.append(this.surface,i)}for(const r of t.removed){const i=this._projector.detach(this._callbacks.get(r));this.surface.removeChild(i.domNode),this._callbacks.delete(r)}})}addItem(e){this.items.add(e)}removeItem(e){this.items.remove(e)}destroy(){this.items.removeAll(),this._callbacks.forEach(e=>this._projector.detach(e)),this._callbacks=null,this._projector=null,this._watchUpdatingTracking.destroy()}render(){this._projector.renderNow()}computeBoundingRect(e){const t=this._hiddenSurface,r=this._hiddenProjector;let i=null;const s=()=>(i=e.render(),i);r.append(t,s),r.renderNow();const n={left:0,top:0,right:0,bottom:0};if(i&&i.domNode){const o=i.domNode.getBoundingClientRect();n.left=o.left,n.top=o.top,n.right=o.right,n.bottom=o.bottom}for(r.detach(s);t.firstChild;)t.removeChild(t.firstChild);return n}overlaps(e,t){const r=this.computeBoundingRect(e),i=this.computeBoundingRect(t);return Math.max(r.left,i.left)<=Math.min(r.right,i.right)&&Math.max(r.top,i.top)<=Math.min(r.bottom,i.bottom)}get hasVisibleItems(){return this.items.some(e=>e.visible)}renderCanvas(e){if(!this.items.some(r=>r.visible))return;const t=e.getContext("2d");t.save(),t.font=`10px ${getComputedStyle(this.surface).fontFamily}`,this.items.forEach(r=>{t.save(),r.renderCanvas(t),t.restore()}),t.restore()}};u([d({readOnly:!0})],Fv.prototype,"surface",void 0),u([d({readOnly:!0})],Fv.prototype,"items",void 0),u([d({readOnly:!0})],Fv.prototype,"needsRender",null),u([d({readOnly:!0})],Fv.prototype,"_watchUpdatingTracking",void 0),u([d({readOnly:!0,aliasOf:"_watchUpdatingTracking.updating"})],Fv.prototype,"updating",void 0),Fv=u([$("esri.views.overlay.ViewOverlay")],Fv);const zle=Fv;function Rte(e,t,r,i){let s=null,n=1e3;typeof t=="number"?(n=t,i=r):(s=t!=null?t:null,n=r);let o,a=0;const l=()=>{a=0,e.apply(i,o)},c=(...h)=>{s&&s.apply(i,h),o=h,n?a||(a=setTimeout(l,n)):l()};return c.remove=()=>{a&&(clearTimeout(a),a=0)},c.forceUpdate=()=>{a&&(clearTimeout(a),l())},c.hasPendingUpdates=()=>!!a,c}function We(e,t){const r=t?{...t,source:e}:e;return d({aliasOf:r})}const Dje="randomUUID"in crypto;function Ote(){if(Dje)return crypto.randomUUID();const e=crypto.getRandomValues(new Uint16Array(8));e[3]=4095&e[3]|16384,e[4]=16383&e[4]|32768;const t=r=>e[r].toString(16);return t(0)+t(1)+"-"+t(2)+"-"+t(3)+"-"+t(4)+"-"+t(5)+t(6)+t(7)}const Nje={handleInterceptedEvent:(e,t,r,i)=>(e.scheduleRender(),t.properties[`on${i.type}`].apply(t.properties.bind||r,[i]))},Fje={namespace:void 0,performanceLogger:()=>{},eventHandlerInterceptor:void 0,styleApplyer:(e,t,r)=>{e.style[t]=r}},kje=e=>({...Fje,...e}),Uje=(e,t)=>{const r=[];for(;e&&e!==t;)r.push(e),e=e.parentNode;return r},Vje=(e,t)=>e.find(t),Ble=(e,t,r=!1)=>{let i=e;return t.forEach((s,n)=>{const o=i!=null&&i.children?Vje(i.children,a=>a.domNode===s):void 0;r&&!o&&n!==t.length-1||(i=o)}),i},zje=e=>{let t;const r={...Nje,...e},i=kje(r),s=i.performanceLogger;let n,o=!0,a=!1;const l=[],c=[],h=(f,m,g)=>{var _;let v;i.eventHandlerInterceptor=(T,x,E,C)=>function(A){let P;s("domEvent",A);const I=Uje(A.currentTarget,v.domNode),L=I.some(G=>{var z;return customElements.get((z=G==null?void 0:G.tagName)==null?void 0:z.toLowerCase())});if(A.eventPhase===Event.CAPTURING_PHASE||!L)I.reverse(),P=Ble(v.getLastRender(),I);else{const G=A.composedPath(),z=G.slice(G.indexOf(A.currentTarget),G.indexOf(v.domNode)).filter(X=>X.getRootNode()===X.ownerDocument).reverse();P=Ble(v.getLastRender(),z,!0)}let k;return P&&(k=r.handleInterceptedEvent(t,P,this,A)),s("domEventProcessed",A),k},(_=r.postProcessProjectionOptions)==null||_.call(r,i);const w=g();v=f(m,w,i),l.push(v),c.push(g),r.afterFirstVNodeRendered&&r.afterFirstVNodeRendered(v,w)};let p=()=>{if(n=void 0,o){o=!1,s("renderStart",void 0);for(let f=0;f<l.length;f++){const m=c[f]();s("rendered",void 0),l[f].update(m),s("patched",void 0)}s("renderDone",void 0),o=!0}};return r.modifyDoRenderImplementation&&(p=r.modifyDoRenderImplementation(p,l,c)),t={renderNow:p,scheduleRender:()=>{n||a||(n=requestAnimationFrame(p))},stop:()=>{n&&(cancelAnimationFrame(n),n=void 0),a=!0},resume:()=>{a=!1,o=!0,t.scheduleRender()},append:(f,m)=>{h(j_.append,f,m)},insertBefore:(f,m)=>{h(j_.insertBefore,f,m)},merge:(f,m)=>{h(j_.merge,f,m)},replace:(f,m)=>{h(j_.replace,f,m)},detach:f=>{for(let m=0;m<c.length;m++)if(c[m]===f)return c.splice(m,1),l.splice(m,1)[0];throw new Error("renderFunction was not found")}},t},Ir={allRenderFn:!1,cmpDidLoad:!0,cmpDidUnload:!1,cmpDidUpdate:!0,cmpDidRender:!0,cmpWillLoad:!0,cmpWillUpdate:!0,cmpWillRender:!0,connectedCallback:!0,disconnectedCallback:!0,element:!0,event:!0,hasRenderFn:!0,lifecycle:!0,hostListener:!0,hostListenerTargetWindow:!0,hostListenerTargetDocument:!0,hostListenerTargetBody:!0,hostListenerTargetParent:!1,hostListenerTarget:!0,member:!0,method:!0,mode:!0,observeAttribute:!0,prop:!0,propMutable:!0,reflect:!0,scoped:!0,shadowDom:!0,slot:!0,cssAnnotations:!0,state:!0,style:!0,svg:!0,updatable:!0,vdomAttribute:!0,vdomXlink:!0,vdomClass:!0,vdomFunctional:!0,vdomKey:!0,vdomListener:!0,vdomRef:!0,vdomPropOrAttr:!0,vdomRender:!0,vdomStyle:!0,vdomText:!0,watchCallback:!0,taskQueue:!0,hotModuleReplacement:!1,isDebug:!1,isDev:!1,isTesting:!1,hydrateServerSide:!1,hydrateClientSide:!1,lifecycleDOMEvents:!1,lazyLoad:!1,profile:!1,slotRelocation:!0,appendChildSlotFix:!1,cloneNodeFix:!1,hydratedAttribute:!1,hydratedClass:!0,safari10:!1,scriptDataOpts:!1,scopedSlotTextContentFix:!1,shadowDomShim:!1,slotChildNodesFix:!1,invisiblePrehydration:!0,propBoolean:!0,propNumber:!0,propString:!0,cssVarShim:!1,constructableCSS:!0,cmpShouldUpdate:!0,devTools:!1,dynamicImportShim:!1,shadowDelegatesFocus:!0,initializeNextTick:!1,asyncLoading:!1,asyncQueue:!1,transformTagName:!1,attachStyles:!0};let C2,zSe,D6,BSe=!1,qU=!1,Mte=!1,zu=!1,Gle=null,jX=!1;const pR=typeof window<"u"?window:{};Ir.cssVarShim&&pR.CSS;const pf=pR.document||{head:{}},C$t=pR.HTMLElement||class{},$a={$flags$:0,$resourcesUrl$:"",jmp:e=>e(),raf:e=>requestAnimationFrame(e),ael:(e,t,r,i)=>e.addEventListener(t,r,i),rel:(e,t,r,i)=>e.removeEventListener(t,r,i),ce:(e,t)=>new CustomEvent(e,t)},WU=Ir.shadowDomShim&&Ir.shadowDom?(()=>(pf.head.attachShadow+"").indexOf("[native")>-1)():!0,Bje=(()=>{let e=!1;try{pf.addEventListener("e",null,Object.defineProperty({},"passive",{get(){e=!0}}))}catch{}return e})(),Gje=e=>Promise.resolve(e),jje=Ir.constructableCSS?(()=>{try{return new CSSStyleSheet,typeof new CSSStyleSheet().replace=="function"}catch{}return!1})():!1,GSe=(e,t,r,i)=>{r&&r.map(([s,n,o])=>{const a=qje(e,s),l=Hje(t,o),c=Wje(s);$a.ael(a,n,l,c),(t.$rmListeners$=t.$rmListeners$||[]).push(()=>$a.rel(a,n,l,c))})},Hje=(e,t)=>r=>{try{Ir.lazyLoad||e.$hostElement$[t](r)}catch(i){J$(i)}},qje=(e,t)=>t&4?pf:t&8?pR:t&16?pf.body:e,Wje=e=>Bje?{passive:(e&1)!==0,capture:(e&2)!==0}:(e&2)!==0,jle="http://www.w3.org/1999/xlink",mT=(e,t="")=>()=>{},Hle=new WeakMap,Xje=(e,t,r)=>{let i=YU.get(e);jje&&r?(i=i||new CSSStyleSheet,i.replace(t)):i=t,YU.set(e,i)},Zje=(e,t,r,i)=>{let s=jSe(t,r),n=YU.get(s);if(e=e.nodeType===11?e:pf,n)if(typeof n=="string"){e=e.head||e;let o=Hle.get(e),a;o||Hle.set(e,o=new Set),o.has(s)||(a=pf.createElement("style"),a.innerHTML=n,e.insertBefore(a,e.querySelector("link")),o&&o.add(s))}else e.adoptedStyleSheets.includes(n)||(e.adoptedStyleSheets=[...e.adoptedStyleSheets,n]);return s},Yje=e=>{const t=e.$cmpMeta$,r=e.$hostElement$,i=t.$flags$,s=mT("attachStyles",t.$tagName$),n=Zje(WU&&r.shadowRoot?r.shadowRoot:r.getRootNode(),t,e.$modeName$);i&10&&(r["s-sc"]=n,r.classList.add(n+"-h"),i&2&&r.classList.add(n+"-s")),s()},jSe=(e,t)=>"sc-"+(t&&e.$flags$&32?e.$tagName$+"-"+t:e.$tagName$),Qje=e=>AHe.map(t=>t(e)).find(t=>!!t),qle={},Jje="http://www.w3.org/2000/svg",Kje="http://www.w3.org/1999/xhtml",eHe=e=>e!=null,Pte=e=>(e=typeof e,e==="object"||e==="function"),HSe=(e,t,...r)=>{let i=null,s=null,n=null,o=!1,a=!1,l=[];const c=p=>{for(let f=0;f<p.length;f++)i=p[f],Array.isArray(i)?c(i):i!=null&&typeof i!="boolean"&&((o=typeof e!="function"&&!Pte(i))&&(i=String(i)),o&&a?l[l.length-1].$text$+=i:l.push(o?XU(null,i):i),a=o)};if(c(r),t&&(Ir.isDev&&e==="input"&&sHe(t),Ir.vdomKey&&t.key&&(s=t.key),Ir.slotRelocation&&t.name&&(n=t.name),Ir.vdomClass)){const p=t.className||t.class;p&&(t.class=typeof p!="object"?p:Object.keys(p).filter(f=>p[f]).join(" "))}if(Ir.isDev&&l.some(qSe)&&CHe(`The <Host> must be the single root component. Make sure:
- You are NOT using hostData() and <Host> in the same component.
- <Host> is used once, and it's the single root component of the render() function.`),Ir.vdomFunctional&&typeof e=="function")return e(t===null?{}:t,l,rHe);const h=XU(e,null);return h.$attrs$=t,l.length>0&&(h.$children$=l),Ir.vdomKey&&(h.$key$=s),Ir.slotRelocation&&(h.$name$=n),h},XU=(e,t)=>{const r={$flags$:0,$tag$:e,$text$:t,$elm$:null,$children$:null};return Ir.vdomAttribute&&(r.$attrs$=null),Ir.vdomKey&&(r.$key$=null),Ir.slotRelocation&&(r.$name$=null),r},tHe={},qSe=e=>e&&e.$tag$===tHe,rHe={forEach:(e,t)=>e.map(Wle).forEach(t),map:(e,t)=>e.map(Wle).map(t).map(iHe)},Wle=e=>({vattrs:e.$attrs$,vchildren:e.$children$,vkey:e.$key$,vname:e.$name$,vtag:e.$tag$,vtext:e.$text$}),iHe=e=>{if(typeof e.vtag=="function"){const r=Object.assign({},e.vattrs);return e.vkey&&(r.key=e.vkey),e.vname&&(r.name=e.vname),HSe(e.vtag,r,...e.vchildren||[])}const t=XU(e.vtag,e.vtext);return t.$attrs$=e.vattrs,t.$children$=e.vchildren,t.$key$=e.vkey,t.$name$=e.vname,t},sHe=e=>{const t=Object.keys(e),r=t.indexOf("value");if(r===-1)return;const i=t.indexOf("type"),s=t.indexOf("min"),n=t.indexOf("max"),o=t.indexOf("step");(r<i||r<s||r<n||r<o)&&r2e('The "value" prop of <input> should be set after "min", "max", "type" and "step"')},Xle=(e,t,r,i,s,n)=>{if(r!==i){let o=Jle(e,t),a=t.toLowerCase();if(t==="class"){const l=e.classList,c=Zle(r),h=Zle(i);l.remove(...c.filter(p=>p&&!h.includes(p))),l.add(...h.filter(p=>p&&!c.includes(p)))}else if(t==="style"){for(const l in r)(!i||i[l]==null)&&(l.includes("-")?e.style.removeProperty(l):e.style[l]="");for(const l in i)(!r||i[l]!==r[l])&&(l.includes("-")?e.style.setProperty(l,i[l]):e.style[l]=i[l])}else if(t!=="key")if(t==="ref")i&&i(e);else if(!e.__lookupSetter__(t)&&t[0]==="o"&&t[1]==="n")t[2]==="-"?t=t.slice(3):Jle(pR,a)?t=a.slice(2):t=a[2]+t.slice(3),r&&$a.rel(e,t,r,!1),i&&$a.ael(e,t,i,!1);else{const l=Pte(i);if((o||l&&i!==null)&&!s)try{if(e.tagName.includes("-"))e[t]=i;else{let h=i==null?"":i;t==="list"?o=!1:(r==null||e[t]!=h)&&(e[t]=h)}}catch{}let c=!1;a!==(a=a.replace(/^xlink\:?/,""))&&(t=a,c=!0),i==null||i===!1?(i!==!1||e.getAttribute(t)==="")&&(c?e.removeAttributeNS(jle,t):e.removeAttribute(t)):(!o||n&4||s)&&!l&&(i=i===!0?"":i,c?e.setAttributeNS(jle,t,i):e.setAttribute(t,i))}}},nHe=/\s/,Zle=e=>e?e.split(nHe):[],WSe=(e,t,r,i)=>{const s=t.$elm$.nodeType===11&&t.$elm$.host?t.$elm$.host:t.$elm$,n=e&&e.$attrs$||qle,o=t.$attrs$||qle;for(i in n)i in o||Xle(s,i,n[i],void 0,r,t.$flags$);for(i in o)Xle(s,i,n[i],o[i],r,t.$flags$)},ZU=(e,t,r,i)=>{let s=t.$children$[r],n=0,o,a,l;if(BSe||(Mte=!0,s.$tag$==="slot"&&(C2&&i.classList.add(C2+"-s"),s.$flags$|=s.$children$?2:1)),s.$text$!==null)o=s.$elm$=pf.createTextNode(s.$text$);else if(s.$flags$&1)o=s.$elm$=pf.createTextNode("");else{if(zu||(zu=s.$tag$==="svg"),o=s.$elm$=pf.createElementNS(zu?Jje:Kje,s.$flags$&2?"slot-fb":s.$tag$),zu&&s.$tag$==="foreignObject"&&(zu=!1),WSe(null,s,zu),eHe(C2)&&o["s-si"]!==C2&&o.classList.add(o["s-si"]=C2),s.$children$)for(n=0;n<s.$children$.length;++n)a=ZU(e,s,n,o),a&&o.appendChild(a);s.$tag$==="svg"?zu=!1:o.tagName==="foreignObject"&&(zu=!0)}return o["s-hn"]=D6,s.$flags$&3&&(o["s-sr"]=!0,o["s-cr"]=zSe,o["s-sn"]=s.$name$||"",l=e&&e.$children$&&e.$children$[r],l&&l.$tag$===s.$tag$&&e.$elm$&&vI(e.$elm$,!1)),o},vI=(e,t)=>{$a.$flags$|=1;const r=e.childNodes;for(let i=r.length-1;i>=0;i--){const s=r[i];s["s-hn"]!==D6&&s["s-ol"]&&(YSe(s).insertBefore(s,Ite(s)),s["s-ol"].remove(),s["s-ol"]=void 0,Mte=!0),t&&vI(s,t)}$a.$flags$&=-2},XSe=(e,t,r,i,s,n)=>{let o=e["s-cr"]&&e["s-cr"].parentNode||e,a;for(o.shadowRoot&&o.tagName===D6&&(o=o.shadowRoot);s<=n;++s)i[s]&&(a=ZU(null,r,s,e),a&&(i[s].$elm$=a,o.insertBefore(a,Ite(t))))},ZSe=(e,t,r,i,s)=>{for(;t<=r;++t)(i=e[t])&&(s=i.$elm$,KSe(i),qU=!0,s["s-ol"]?s["s-ol"].remove():vI(s,!0),s.remove())},oHe=(e,t,r,i)=>{let s=0,n=0,o=0,a=0,l=t.length-1,c=t[0],h=t[l],p=i.length-1,f=i[0],m=i[p],g,v;for(;s<=l&&n<=p;)if(c==null)c=t[++s];else if(h==null)h=t[--l];else if(f==null)f=i[++n];else if(m==null)m=i[--p];else if(jD(c,f))A2(c,f),c=t[++s],f=i[++n];else if(jD(h,m))A2(h,m),h=t[--l],m=i[--p];else if(jD(c,m))(c.$tag$==="slot"||m.$tag$==="slot")&&vI(c.$elm$.parentNode,!1),A2(c,m),e.insertBefore(c.$elm$,h.$elm$.nextSibling),c=t[++s],m=i[--p];else if(jD(h,f))(c.$tag$==="slot"||m.$tag$==="slot")&&vI(h.$elm$.parentNode,!1),A2(h,f),e.insertBefore(h.$elm$,c.$elm$),h=t[--l],f=i[++n];else{for(o=-1,a=s;a<=l;++a)if(t[a]&&t[a].$key$!==null&&t[a].$key$===f.$key$){o=a;break}o>=0?(v=t[o],v.$tag$!==f.$tag$?g=ZU(t&&t[n],r,o,e):(A2(v,f),t[o]=void 0,g=v.$elm$),f=i[++n]):(g=ZU(t&&t[n],r,n,e),f=i[++n]),g&&YSe(c.$elm$).insertBefore(g,Ite(c.$elm$))}s>l?XSe(e,i[p+1]==null?null:i[p+1].$elm$,r,i,n,p):n>p&&ZSe(t,s,l)},jD=(e,t)=>e.$tag$===t.$tag$?e.$tag$==="slot"?e.$name$===t.$name$:e.$key$===t.$key$:!1,Ite=e=>e&&e["s-ol"]||e,YSe=e=>(e["s-ol"]?e["s-ol"]:e).parentNode,A2=(e,t)=>{const r=t.$elm$=e.$elm$,i=e.$children$,s=t.$children$,n=t.$tag$,o=t.$text$;let a;o===null?(zu=n==="svg"?!0:n==="foreignObject"?!1:zu,n==="slot"||WSe(e,t,zu),i!==null&&s!==null?oHe(r,i,t,s):s!==null?(e.$text$!==null&&(r.textContent=""),XSe(r,null,t,s,0,s.length-1)):i!==null&&ZSe(i,0,i.length-1),zu&&n==="svg"&&(zu=!1)):(a=r["s-cr"])?a.parentNode.textContent=o:e.$text$!==o&&(r.data=o)},QSe=e=>{let t=e.childNodes,r,i,s,n,o,a;for(i=0,s=t.length;i<s;i++)if(r=t[i],r.nodeType===1){if(r["s-sr"]){for(o=r["s-sn"],r.hidden=!1,n=0;n<s;n++)if(a=t[n].nodeType,t[n]["s-hn"]!==r["s-hn"]||o!==""){if(a===1&&o===t[n].getAttribute("slot")){r.hidden=!0;break}}else if(a===1||a===3&&t[n].textContent.trim()!==""){r.hidden=!0;break}}QSe(r)}},Hp=[],JSe=e=>{let t,r,i,s,n,o,a=0,l=e.childNodes,c=l.length;for(;a<c;a++){if(t=l[a],t["s-sr"]&&(r=t["s-cr"])&&r.parentNode)for(i=r.parentNode.childNodes,s=t["s-sn"],o=i.length-1;o>=0;o--)r=i[o],!r["s-cn"]&&!r["s-nr"]&&r["s-hn"]!==t["s-hn"]&&(Yle(r,s)?(n=Hp.find(h=>h.$nodeToRelocate$===r),qU=!0,r["s-sn"]=r["s-sn"]||s,n?n.$slotRefNode$=t:Hp.push({$slotRefNode$:t,$nodeToRelocate$:r}),r["s-sr"]&&Hp.map(h=>{Yle(h.$nodeToRelocate$,r["s-sn"])&&(n=Hp.find(p=>p.$nodeToRelocate$===r),n&&!h.$slotRefNode$&&(h.$slotRefNode$=n.$slotRefNode$))})):Hp.some(h=>h.$nodeToRelocate$===r)||Hp.push({$nodeToRelocate$:r}));t.nodeType===1&&JSe(t)}},Yle=(e,t)=>e.nodeType===1?e.getAttribute("slot")===null&&t===""||e.getAttribute("slot")===t:e["s-sn"]===t?!0:t==="",KSe=e=>{e.$attrs$&&e.$attrs$.ref&&e.$attrs$.ref(null),e.$children$&&e.$children$.map(KSe)},aHe=(e,t)=>{const r=e.$hostElement$,i=e.$cmpMeta$,s=e.$vnode$||XU(null,null),n=qSe(t)?t:HSe(null,null,t);D6=r.tagName,i.$attrsToReflect$&&(n.$attrs$=n.$attrs$||{},i.$attrsToReflect$.map(([o,a])=>n.$attrs$[a]=r[o])),n.$tag$=null,n.$flags$|=4,e.$vnode$=n,n.$elm$=s.$elm$=r.shadowRoot||r,C2=r["s-sc"],zSe=r["s-cr"],BSe=WU&&(i.$flags$&1)!==0,qU=!1,A2(s,n);{if($a.$flags$|=1,Mte){JSe(n.$elm$);let o,a,l,c,h,p,f=0;for(;f<Hp.length;f++)o=Hp[f],a=o.$nodeToRelocate$,a["s-ol"]||(l=pf.createTextNode(""),l["s-nr"]=a,a.parentNode.insertBefore(a["s-ol"]=l,a));for(f=0;f<Hp.length;f++)if(o=Hp[f],a=o.$nodeToRelocate$,o.$slotRefNode$){for(c=o.$slotRefNode$.parentNode,h=o.$slotRefNode$.nextSibling,l=a["s-ol"];l=l.previousSibling;)if(p=l["s-nr"],p&&p["s-sn"]===a["s-sn"]&&c===p.parentNode&&(p=p.nextSibling,!p||!p["s-nr"])){h=p;break}(!h&&c!==a.parentNode||a.nextSibling!==h)&&a!==h&&(!a["s-hn"]&&a["s-ol"]&&(a["s-hn"]=a["s-ol"].parentNode.nodeName),c.insertBefore(a,h))}else a.nodeType===1&&(a.hidden=!0)}qU&&QSe(n.$elm$),$a.$flags$&=-2,Hp.length=0}},lHe=e=>Ir.lazyLoad?fR(e).$hostElement$:e,A$t=(e,t,r)=>{const i=lHe(e);return{emit:s=>(Ir.isDev&&!i.isConnected&&r2e(`The "${t}" event was emitted, but the dispatcher node is no longer connected to the dom.`),cHe(i,t,{bubbles:!!(r&4),composed:!!(r&2),cancelable:!!(r&1),detail:s}))}},cHe=(e,t,r)=>{const i=$a.ce(t,r);return e.dispatchEvent(i),i},uHe=(e,t)=>{},$te=(e,t)=>(e.$flags$|=16,uHe(e,e.$ancestorComponent$),MHe(()=>hHe(e,t))),hHe=(e,t)=>{const r=e.$hostElement$,i=mT("scheduleUpdate",e.$cmpMeta$.$tagName$),s=r;let n;return t?n=hC(s,"componentWillLoad"):n=hC(s,"componentWillUpdate"),n=Qle(n,()=>hC(s,"componentWillRender")),i(),Qle(n,()=>dHe(e,s,t))},dHe=async(e,t,r)=>{const i=e.$hostElement$,s=mT("update",e.$cmpMeta$.$tagName$);i["s-rc"],r&&Yje(e);const n=mT("render",e.$cmpMeta$.$tagName$);pHe(e,t,i),n(),s(),fHe(e)},pHe=(e,t,r)=>{try{Gle=t,t=t.render&&t.render(),e.$flags$&=-17,e.$flags$|=2,(Ir.hasRenderFn||Ir.reflect)&&(Ir.vdomRender||Ir.reflect)&&(Ir.hydrateServerSide||aHe(e,t))}catch(a){J$(a,e.$hostElement$)}return Gle=null,null},fHe=e=>{const t=e.$cmpMeta$.$tagName$,r=e.$hostElement$,i=mT("postUpdate",t),s=r;e.$ancestorComponent$,hC(s,"componentDidRender"),e.$flags$&64?(hC(s,"componentDidUpdate"),i()):(e.$flags$|=64,hC(s,"componentDidLoad"),i())},R$t=e=>{if(Ir.updatable){const t=fR(e),r=t.$hostElement$.isConnected;return r&&(t.$flags$&18)===2&&$te(t,!1),r}return!1},hC=(e,t,r)=>{if(e&&e[t])try{return e[t](r)}catch(i){J$(i)}},Qle=(e,t)=>e&&e.then?e.then(t):t(),mHe=(e,t)=>e!=null&&!Pte(e)?t&4?e==="false"?!1:e===""||!!e:t&2?parseFloat(e):t&1?String(e):e:e,gHe=(e,t)=>fR(e).$instanceValues$.get(t),yHe=(e,t,r,i)=>{const s=fR(e),n=e,o=s.$instanceValues$.get(t),a=s.$flags$,l=n;r=mHe(r,i.$members$[t][0]);const c=Number.isNaN(o)&&Number.isNaN(r);if(r!==o&&!c){s.$instanceValues$.set(t,r);{if(i.$watchers$&&a&128){const p=i.$watchers$[t];p&&p.map(f=>{try{l[f](r,o,t)}catch(m){J$(m,n)}})}if((a&18)===2){if(l.componentShouldUpdate&&l.componentShouldUpdate(r,o,t)===!1)return;$te(s,!1)}}}},vHe=(e,t,r)=>{if(t.$members$){e.watchers&&(t.$watchers$=e.watchers);const i=Object.entries(t.$members$),s=e.prototype;i.map(([n,[o]])=>{(o&31||o&32)&&Object.defineProperty(s,n,{get(){return gHe(this,n)},set(a){yHe(this,n,a,t)},configurable:!0,enumerable:!0})});{const n=new Map;s.attributeChangedCallback=function(o,a,l){$a.jmp(()=>{const c=n.get(o);if(this.hasOwnProperty(c))l=this[c],delete this[c];else if(s.hasOwnProperty(c)&&typeof this[c]=="number"&&this[c]==l)return;this[c]=l===null&&typeof this[c]=="boolean"?!1:l})},e.observedAttributes=i.filter(([o,a])=>a[0]&15).map(([o,a])=>{const l=a[1]||o;return n.set(l,o),a[0]&512&&t.$attrsToReflect$.push([o,l]),l})}}return e},_He=async(e,t,r,i,s)=>{if((t.$flags$&32)===0&&(s=e.constructor,t.$flags$|=32,customElements.whenDefined(r.$tagName$).then(()=>t.$flags$|=128),s.style)){let o=s.style;typeof o!="string"&&(o=o[t.$modeName$=Qje(e)]);const a=jSe(r,t.$modeName$);if(!YU.has(a)){const l=mT("registerStyles",r.$tagName$);Xje(a,o,!!(r.$flags$&1)),l()}}t.$ancestorComponent$,(()=>$te(t,!0))()},bHe=e=>{},wHe=e=>{if(($a.$flags$&1)===0){const t=fR(e),r=t.$cmpMeta$,i=mT("connectedCallback",r.$tagName$);t.$flags$&1?(GSe(e,t,r.$listeners$),bHe(t.$lazyInstance$)):(t.$flags$|=1,r.$flags$&12&&xHe(e),r.$members$&&Object.entries(r.$members$).map(([s,[n]])=>{if(n&31&&e.hasOwnProperty(s)){const o=e[s];delete e[s],e[s]=o}}),_He(e,t,r)),i()}},xHe=e=>{const t=e["s-cr"]=pf.createComment("");t["s-cn"]=!0,e.insertBefore(t,e.firstChild)},THe=e=>{if(($a.$flags$&1)===0){const t=fR(e);t.$rmListeners$&&(t.$rmListeners$.map(r=>r()),t.$rmListeners$=void 0)}},O$t=(e,t)=>{const r={$flags$:t[0],$tagName$:t[1]};Ir.member&&(r.$members$=t[2]),Ir.hostListener&&(r.$listeners$=t[3]),Ir.watchCallback&&(r.$watchers$=e.$watchers$),Ir.reflect&&(r.$attrsToReflect$=[]),Ir.shadowDom&&!WU&&r.$flags$&1&&(r.$flags$|=8);const i=e.prototype.connectedCallback,s=e.prototype.disconnectedCallback;return Object.assign(e.prototype,{__registerHost(){EHe(this,r)},connectedCallback(){wHe(this),Ir.connectedCallback&&i&&i.call(this)},disconnectedCallback(){THe(this),Ir.disconnectedCallback&&s&&s.call(this)},__attachShadow(){WU?Ir.shadowDelegatesFocus?this.attachShadow({mode:"open",delegatesFocus:!!(r.$flags$&16)}):this.attachShadow({mode:"open"}):this.shadowRoot=this}}),e.is=r.$tagName$,vHe(e,r)},M$t=e=>{const t=new URL(e,$a.$resourcesUrl$);return t.origin!==pR.location.origin?t.href:t.pathname},SHe=e=>$a.$resourcesUrl$=e,e2e=new WeakMap,fR=e=>e2e.get(e),EHe=(e,t)=>{const r={$flags$:0,$hostElement$:e,$cmpMeta$:t,$instanceValues$:new Map};return Ir.isDev&&(r.$renderCount$=0),Ir.method&&Ir.lazyLoad&&(r.$onInstancePromise$=new Promise(i=>r.$onInstanceResolve$=i)),Ir.asyncLoading&&(r.$onReadyPromise$=new Promise(i=>r.$onReadyResolve$=i),e["s-p"]=[],e["s-rc"]=[]),GSe(e,r,t.$listeners$),e2e.set(e,r)},Jle=(e,t)=>t in e,J$=(e,t)=>(0,console.error)(e,t),t2e=Ir.isTesting?["STENCIL:"]:["%cstencil","color: white;background:#4c47ff;font-weight: bold; font-size:10px; padding:2px 6px; border-radius: 5px"],CHe=(...e)=>console.error(...t2e,...e),r2e=(...e)=>console.warn(...t2e,...e),YU=new Map,AHe=[],Kle=[],i2e=[],RHe=(e,t)=>r=>{e.push(r),jX||(jX=!0,t&&$a.$flags$&4?OHe(HX):$a.raf(HX))},ece=e=>{for(let t=0;t<e.length;t++)try{e[t](performance.now())}catch(r){J$(r)}e.length=0},HX=()=>{ece(Kle),ece(i2e),(jX=Kle.length>0)&&$a.raf(HX)},OHe=e=>Gje().then(e),MHe=RHe(i2e,!0),P$t={isDev:!!Ir.isDev,isBrowser:!0,isServer:!1,isTesting:!!Ir.isTesting};let s2e;function PHe(){SHe(Rd(wr(s2e)))}s2e="components/assets";const n2e=Symbol("widget"),IHe=[],$He={},QU=new WeakMap;function o2e(e,t){let r=t.children;if(r&&r.length)for(let s=0;s<r.length;++s)r[s]=o2e(e,r[s]);else r=IHe;const i=t.vnodeSelector;if(Lte(i)){const s=t.properties||$He,n=s.key||i;return{vnodeSelector:"div",properties:{key:n,afterCreate:LHe,afterUpdate:DHe,afterRemoved:a2e,parentWidget:e,widgetConstructor:i,widgetProperties:{...s,key:n,children:r}},children:void 0,text:void 0,domNode:null}}return t}function LHe(e,t,r,{parentWidget:i,widgetConstructor:s,widgetProperties:n}){var a;const o=new s(n);o.container=e,QU.set(e,o),(a=o.afterCreate)==null||a.call(o,o,e),i._internalHandles.add(kd(()=>a2e(e)))}function DHe(e,t,r,{widgetProperties:i}){var n;const s=QU.get(e);s&&(s.set(i),(n=s.afterUpdate)==null||n.call(s,s,e))}function a2e(e){const t=QU.get(e);t&&(t.destroy(),QU.delete(e))}function Lte(e){return typeof e=="function"&&e[n2e]}const tce=new Set;function NHe(e){tce.add(e),e.finally(()=>tce.delete(e))}const l2e="esri.widgets.Widget",FHe=fe.getLogger(l2e);let kHe=0;const UHe={widgetIcon:"esri-icon-checkbox-unchecked"};function c2e(e,t){for(const r in t)e[r]!=null&&(typeof e[r]=="object"&&typeof t[r]=="object"?c2e(e[r],t[r]):e[r]=t[r]);return e}const VHe=zje({postProcessProjectionOptions(e){const t=e.eventHandlerInterceptor,r=/capture$/i;e.eventHandlerInterceptor=(i,s,n,o)=>{const a=t(i,s,n,o),l=r.test(i);if(!((i=i.replace(r,"")).toLowerCase()in n)||l){const c=i[2].toLowerCase()+i.slice(3),h=m=>a.call(n,m);n.addEventListener(c,h,l);const p=()=>n.removeEventListener(c,h,l),f=o.afterRemoved;o.afterRemoved=m=>{f==null||f(m),p()}}return a}},handleInterceptedEvent(e,t,r,i){const{eventPhase:s,type:n}=i,o=s===Event.CAPTURING_PHASE;let a=`on${n}${o?"capture":""}`;const l=t.properties;(a in l||(a=`on${n[0].toUpperCase()}${n.slice(1)}${o?"Capture":""}`,a in l))&&(ISe(),e.scheduleRender(),l[a].call(l.bind||r,i))}});let oG=!1,Gn=class extends j$(ds.EventedAccessor){constructor(e,t){super(e,t),this._attached=!1,this._internalHandles=new Dt,this._projector=VHe,this._readyForTrueRender=!1,this.domNode=null,this.iconClass=UHe.widgetIcon,this.label=this.declaredClass.split(".").pop(),this.visible=!0,this.key=this,this._loadLocale=z$(async()=>{if(this._messageBundleProps&&this._messageBundleProps.length){const n=await xs(this._messageBundleProps.map(async({bundlePath:o,propertyName:a})=>{let l=await Rbe(o);this.uiStrings&&Object.keys(this.uiStrings)&&(l=c2e(re(l),this.uiStrings)),this[a]=l}));for(const o of n)o.error&&FHe.error("widget-intl:locale-error",this.declaredClass,o.error)}await this.loadLocale()}),PHe();const r="esri-widget-uid-"+Ote(),i=this.render.bind(this);this._trackingTarget=new qz(()=>this.scheduleRender());const s=()=>{var h;if(!this._readyForTrueRender||this.destroyed)return null;if(!this.visible)return{vnodeSelector:"div",properties:{key:r,class:"",styles:{display:"none"}},domNode:void 0,children:void 0,text:void 0};const n=i();let{properties:o}=n;o||(n.properties=o={});let{key:a,styles:l}=o;a||(o.key=r),l||(o.styles=l={}),l.display||(l.display="");let c=0;return(h=n.children)==null||h.forEach(p=>{if(Lte(p.vnodeSelector))return;let{properties:f}=p;f||(p.properties=f={}),f.key||(f.key=`${this.id}--${c++}`)}),o2e(this,n)};this.render=()=>{if(oG)return s();let n=fje(this);if(n)return n;this._trackingTarget.clear(),oG=!0;try{n=l0(this._trackingTarget,s)}catch(o){throw console.error(o),o}finally{oG=!1}return mje(this,n),n},this.addResolvingPromise(this._resourcesFetch=this.beforeFirstRender().then(()=>{this._readyForTrueRender=!0,this._postInitialize()})),NHe(this._resourcesFetch)}normalizeCtorArgs(e,t){const r={...e};return t&&(r.container=t),r}postInitialize(){}beforeFirstRender(){return Promise.all([this.loadDependencies(),this._loadLocale()]).then(()=>{}).catch(Tq)}async loadDependencies(){}async loadLocale(){}destroy(){this.destroyed||(ct(this._trackingTarget),ct(this.viewModel),this._detach(this.container),this._set("container",null),this._internalHandles.destroy(),this._emitter.clear(),this.render=()=>null,this._projector=null,sG(this))}set container(e){this._get("container")||this._set("container",e)}castContainer(e){return y6(e)}get id(){return this._get("id")||this.get("container.id")||Date.now().toString(16)+"-widget-"+kHe++}set id(e){e&&this._set("id",e)}get renderable(){return this._resourcesFetch}get test(){return{projector:this._projector}}render(){throw new Error("not implemented")}scheduleRender(){this.destroyed||(sG(this),this._projector.scheduleRender())}classes(...e){return RE.apply(this,e)}renderNow(){sG(this),this._projector.renderNow()}_postInitialize(){var t;if(this.destroyed)return;this.scheduleRender(),(t=this._delegatedEventNames)!=null&&t.length&&this._internalHandles.add(te(()=>this.viewModel,(r,i)=>{i&&this._internalHandles.remove("delegated-events"),r&&jz(r)&&this._internalHandles.add(this._delegatedEventNames.map(s=>V$(r,s,n=>{this.emit(s,n)})),"delegated-events")},Rt)),this.postInitialize();const e=async()=>{await this._loadLocale().catch(Tq),this.scheduleRender()};this._internalHandles.add([Cbe(e),te(()=>this.uiStrings,e),Lo(()=>this.container,r=>{this.destroyed||this._attach(r)},{initial:!0,once:!0})])}_attach(e){e&&(this._projector.merge(e,this.render),this._attached=!0)}_detach(e){e&&this._attached&&(this._projector.detach(this.render),e.parentNode&&e.parentNode.removeChild(e),this._attached=!1)}};Gn[n2e]=!0,u([d()],Gn.prototype,"_readyForTrueRender",void 0),u([d({value:null})],Gn.prototype,"container",null),u([qt("container")],Gn.prototype,"castContainer",null),u([d({aliasOf:"container"})],Gn.prototype,"domNode",void 0),u([d()],Gn.prototype,"iconClass",void 0),u([d()],Gn.prototype,"id",null),u([d()],Gn.prototype,"label",void 0),u([d()],Gn.prototype,"renderable",null),u([d()],Gn.prototype,"uiStrings",void 0),u([d()],Gn.prototype,"viewModel",void 0),u([d()],Gn.prototype,"visible",void 0),u([d()],Gn.prototype,"key",void 0),u([d()],Gn.prototype,"children",void 0),u([d()],Gn.prototype,"afterCreate",void 0),u([d()],Gn.prototype,"afterUpdate",void 0),u([d()],Gn.prototype,"afterRemoved",void 0),Gn=u([$(l2e)],Gn);const Un=Gn;function zHe(e,t,r){return e.units[t][r]}function N6(e,t,r,i=2,s="abbr"){return`${Ud(t,{minimumFractionDigits:i,maximumFractionDigits:i})} ${zHe(e,r,s)}`}function I$t(e,t,r,i=2,s="abbr"){const n=z8e(t,r);return N6(e,pn(t,r,n),n,i,s)}function $$t(e,t,r,i=2,s="abbr"){const n=B8e(t,r);return N6(e,pn(t,r,n),n,i,s)}function L$t(e,t,r,i=2,s="abbr"){const n=G8e(t,r);return N6(e,pn(t,r,n),n,i,s)}function D$t(e,t,r,i=2,s="abbr"){const n=j8e(t,r);return N6(e,pn(t,r,n),n,i,s)}const rce=["B","kB","MB","GB","TB"];function BHe(e,t){let r=t===0?0:Math.floor(Math.log(t)/Math.log(hA.KILOBYTES));r=Le(r,0,rce.length-1);const i=Ud(t/hA.KILOBYTES**r,{maximumFractionDigits:2});return Zm(e.units.bytes[rce[r]],{fileSize:i})}function GHe(e){const{exifInfo:t,exifName:r,tagName:i}=e;if(!t||!r||!i)return null;const s=t.find(n=>n.name===r);return s?jHe({tagName:i,tags:s.tags}):null}function jHe(e){const{tagName:t,tags:r}=e;if(!r||!t)return null;const i=r.find(s=>s.name===t);return i&&i.value||null}var qX;const HHe={1:{id:1,rotation:0,mirrored:!1},2:{id:2,rotation:0,mirrored:!0},3:{id:3,rotation:180,mirrored:!1},4:{id:4,rotation:180,mirrored:!0},5:{id:5,rotation:-90,mirrored:!0},6:{id:6,rotation:90,mirrored:!1},7:{id:7,rotation:90,mirrored:!0},8:{id:8,rotation:-90,mirrored:!1}};let xc=qX=class extends ye{constructor(e){super(e),this.contentType=null,this.exifInfo=null,this.id=null,this.globalId=null,this.keywords=null,this.name=null,this.parentGlobalId=null,this.parentObjectId=null,this.size=null,this.url=null}get orientationInfo(){const{exifInfo:e}=this,t=GHe({exifName:"Exif IFD0",tagName:"Orientation",exifInfo:e});return HHe[t]||null}clone(){return new qX({contentType:this.contentType,exifInfo:this.exifInfo,id:this.id,globalId:this.globalId,keywords:this.keywords,name:this.name,parentGlobalId:this.parentGlobalId,parentObjectId:this.parentObjectId,size:this.size,url:this.url})}};u([d({type:String})],xc.prototype,"contentType",void 0),u([d()],xc.prototype,"exifInfo",void 0),u([d({readOnly:!0})],xc.prototype,"orientationInfo",null),u([d({type:Wi})],xc.prototype,"id",void 0),u([d({type:String})],xc.prototype,"globalId",void 0),u([d({type:String})],xc.prototype,"keywords",void 0),u([d({type:String})],xc.prototype,"name",void 0),u([d({json:{read:!1}})],xc.prototype,"parentGlobalId",void 0),u([d({json:{read:!1}})],xc.prototype,"parentObjectId",void 0),u([d({type:Wi})],xc.prototype,"size",void 0),u([d({json:{read:!1}})],xc.prototype,"url",void 0),xc=qX=u([$("esri.layers.support.AttachmentInfo")],xc);const qHe=xc;var WX;let jo=WX=class extends ye{constructor(e){super(e),this.attachmentTypes=null,this.attachmentsWhere=null,this.cacheHint=void 0,this.keywords=null,this.globalIds=null,this.name=null,this.num=null,this.objectIds=null,this.returnMetadata=!1,this.size=null,this.start=null,this.where=null}writeStart(e,t){t.resultOffset=this.start,t.resultRecordCount=this.num||10}clone(){return new WX(re({attachmentTypes:this.attachmentTypes,attachmentsWhere:this.attachmentsWhere,cacheHint:this.cacheHint,keywords:this.keywords,where:this.where,globalIds:this.globalIds,name:this.name,num:this.num,objectIds:this.objectIds,returnMetadata:this.returnMetadata,size:this.size,start:this.start}))}};u([d({type:[String],json:{write:!0}})],jo.prototype,"attachmentTypes",void 0),u([d({type:String,json:{read:{source:"attachmentsDefinitionExpression"},write:{target:"attachmentsDefinitionExpression"}}})],jo.prototype,"attachmentsWhere",void 0),u([d({type:Boolean,json:{write:!0}})],jo.prototype,"cacheHint",void 0),u([d({type:[String],json:{write:!0}})],jo.prototype,"keywords",void 0),u([d({type:[Number],json:{write:!0}})],jo.prototype,"globalIds",void 0),u([d({json:{write:!0}})],jo.prototype,"name",void 0),u([d({type:Number,json:{read:{source:"resultRecordCount"}}})],jo.prototype,"num",void 0),u([d({type:[Number],json:{write:!0}})],jo.prototype,"objectIds",void 0),u([d({type:Boolean,json:{default:!1,write:!0}})],jo.prototype,"returnMetadata",void 0),u([d({type:[Number],json:{write:!0}})],jo.prototype,"size",void 0),u([d({type:Number,json:{read:{source:"resultOffset"}}})],jo.prototype,"start",void 0),u([Xe("start"),Xe("num")],jo.prototype,"writeStart",null),u([d({type:String,json:{read:{source:"definitionExpression"},write:{target:"definitionExpression"}}})],jo.prototype,"where",void 0),jo=WX=u([$("esri.rest.support.AttachmentQuery")],jo),jo.from=en(jo);const XX=jo,WHe="esri.widgets.Feature.support.featureUtils",ice=fe.getLogger(WHe),XHe=/href=(""|'')/gi,ZHe=/(\{([^\{\r\n]+)\})/g,YHe=/\'/g,u2e=/^\s*expression\//i,QHe=/(\n)/gi,JHe=/[\u00A0-\u9999<>\&]/gim,KHe=/href\s*=\s*(?:\"([^\"]+)\"|\'([^\']+)\')/gi,eqe=/^(?:mailto:|tel:)/,h2e="relationships/",ZX=i6("short-date-short-time");function d2e(e){if(!R(e))return e.get("sourceLayer")||e.get("layer")}async function JU(e,t){return typeof e=="function"?e.call(null,t):e}function p2e(e=""){if(e)return!eqe.test(e.trim().toLowerCase())}function f2e(e){return!!e&&u2e.test(e)}function tqe(e,t){if(!f2e(t)||!e)return null;const r=t.replace(u2e,"").toLowerCase();let i;return e.some(s=>s.name.toLowerCase()===r&&(i=s,!0)),i}function m2e(e,t){const r=tqe(t,e==null?void 0:e.fieldName);return r?r.title||null:e?e.label||e.fieldName:null}function rqe(e,t){const r=t.get(e.toLowerCase());return`{${r&&r.fieldName||e}}`}function iqe(e){return e.replace(XHe,"")}function KU(e,t){const r=Dte(t,e);return r?r.name:e}function sqe(e,t){return e&&e.map(r=>KU(r,t))}function Dte(e,t){return e&&typeof e.getField=="function"?e.getField(t):null}function g2e(e){return`${e}`.trim()}function _x({attributes:e,globalAttributes:t,layer:r,text:i,expressionAttributes:s,fieldInfoMap:n}){return i?YX({formattedAttributes:t,template:lqe(i,{...t,...s,...e},r),fieldInfoMap:n}):""}function YX({formattedAttributes:e,template:t,fieldInfoMap:r}){return g2e(iqe(Zm(Zm(t,i=>rqe(i,r)),e)))}function nqe(e,t,r=!1){const i=t[e];if(typeof i=="string"){const s="%27",n=(r?encodeURIComponent(i):i).replace(YHe,s);t[e]=n}}function oqe(e,t=!1){const r={...e};return Object.keys(r).forEach(i=>nqe(i,r,t)),r}function aqe(e,t,r){const i=(t=g2e(t))&&t[0]!=="{";return Zm(e,oqe(r,i))}function QX(e,t){return e.replace(ZHe,(r,i,s)=>{const n=Dte(t,s);return n?`{${n.name}}`:i})}function lqe(e,t,r){const i=QX(e,r);return i&&i.replace(KHe,(s,n,o)=>aqe(s,n||o,t))}function cqe(e,t){if(typeof e=="string"&&t&&t.dateFormat==null&&(t.places!=null||t.digitSeparator!=null)){const r=Number(e);if(!isNaN(r))return r}return e}function uqe(e){return(e==null?void 0:e.type)==="feature"}function sce(e){return!!(e!=null&&e.layer)}function hqe(e){return(e==null?void 0:e.type)==="map-image"}function dqe(e,t){var c;const r=t.fieldInfos,i=t.fieldName,s=(c=y2e(r,i))==null?void 0:c.clone(),n=t.preventPlacesFormatting,o=t.layer,a=Dte(o,i);if(s&&(a==null?void 0:a.type)==="date"){const h=s.format||new EE;h.dateFormat=h.dateFormat||"short-date-short-time",h.dateTimeFormatOptions=!sce(o)&&uqe(o)&&o.datesInUnknownTimezone||sce(o)&&hqe(o.layer)&&o.layer.datesInUnknownTimezone?{timeZone:"UTC"}:null,s.format=h}const l=s&&s.format;return typeof e=="string"&&Ewe(i)&&l?l.formatRasterPixelValue(e):typeof(e=cqe(e,l))=="string"||e==null||l==null?K$(e):n?Ud(e,{...Owe(l),minimumFractionDigits:0,maximumFractionDigits:20}):l.format(e)}function y2e(e,t){if(!e||!e.length||!t)return;const r=t.toLowerCase();let i;return e.some(s=>!(!s.fieldName||s.fieldName.toLowerCase()!==r)&&(i=s,!0)),i}function pqe({fieldName:e,graphic:t,layer:r}){if(Ny(e)||!r||typeof r.getFeatureType!="function")return null;const{typeIdField:i}=r;if(!i||e!==i)return null;const s=r.getFeatureType(t);return s?s.name:null}function fqe({fieldName:e,value:t,graphic:r,layer:i}){if(Ny(e)||!i||typeof i.getFieldDomain!="function")return null;const s=i.getFieldDomain(e,{feature:r});return s&&s.type==="coded-value"?s.getName(t):null}function mqe(e,t){const{creatorField:r,creationDateField:i,editorField:s,editDateField:n}=e;if(!t)return;const o=t[n];if(typeof o=="number"){const l=t[s];return{type:"edit",date:Jm(o,ZX),user:l}}const a=t[i];if(typeof a=="number"){const l=t[r];return{type:"create",date:Jm(a,ZX),user:l}}return null}function gqe(e,t){const r=new Map;return e&&e.forEach(i=>{const s=KU(i.fieldName,t);i.fieldName=s,r.set(s.toLowerCase(),i)}),r}function nce(e){const t=[];if(!e)return t;const{fieldInfos:r,content:i}=e;return r&&t.push(...r),i&&Array.isArray(i)&&i.forEach(s=>{if(s.type==="fields"){const n=s&&s.fieldInfos;n&&t.push(...n)}}),t}function Nte(e){return e.replace(JHe,t=>`&#${t.charCodeAt(0)};`)}function K$(e){return typeof e=="string"?e.replace(QHe,'<br class="esri-text-new-line" />'):e}function v2e(e){const{value:t,fieldName:r,fieldInfos:i,fieldInfoMap:s,layer:n,graphic:o}=e;if(t==null)return"";const a=fqe({fieldName:r,value:t,graphic:o,layer:n});if(a)return a;const l=pqe({fieldName:r,graphic:o,layer:n});if(l)return l;if(s.get(r.toLowerCase()))return dqe(t,{fieldInfos:i||Array.from(s.values()),fieldName:r,layer:n});const c=n&&n.fieldsIndex;return c&&c.isDateField(r)?Jm(t,ZX):K$(t)}function aG({fieldInfos:e,attributes:t,layer:r,graphic:i,fieldInfoMap:s,relatedInfos:n}){const o={};return n==null||n.forEach(a=>wqe({attributes:o,relatedInfo:a,fieldInfoMap:s,fieldInfos:e,layer:r})),Object.keys(t).forEach(a=>{const l=t[a];o[a]=v2e({fieldName:a,fieldInfos:e,fieldInfoMap:s,layer:r,value:l,graphic:i})}),o}async function yqe(e,t){var h,p;const{layer:r,graphic:i,outFields:s,objectIds:n,returnGeometry:o,spatialReference:a}=e,l=n[0];if(typeof l!="number"&&typeof l!="string"){const f="Could not query required fields for the specified feature. The feature's ID is invalid.",m={layer:r,graphic:i,objectId:l,requiredFields:s};return ice.warn(f,m),null}if(!((p=(h=r.capabilities)==null?void 0:h.operations)!=null&&p.supportsQuery)){const f="The specified layer cannot be queried. The following fields will not be available.",m={layer:r,graphic:i,requiredFields:s,returnGeometry:o};return ice.warn(f,m),null}const c=r.createQuery();return c.objectIds=n,c.outFields=s!=null&&s.length?s:[r.objectIdField],c.returnGeometry=!!o,c.returnZ=!!o,c.returnM=!!o,c.outSpatialReference=a,(await r.queryFeatures(c,t)).features[0]}async function vqe(e){var i;if(!((i=e.expressionInfos)!=null&&i.length))return!1;const t=await Qm(),{arcadeUtils:{hasGeometryFunctions:r}}=t;return r(e)}async function _qe({graphic:e,popupTemplate:t,layer:r,spatialReference:i},s){if(!r||!t||(typeof r.load=="function"&&await r.load(s),!e.attributes))return;const n=e.attributes[r.objectIdField];if(n==null)return;const o=[n],a=await t.getRequiredFields(r.fieldsIndex),l=N6e(a,e),c=l?[]:a,h=t.returnGeometry||await vqe(t);if(l&&!h)return;const p=await yqe({layer:r,graphic:e,outFields:c,objectIds:o,returnGeometry:h,spatialReference:i},s);p&&(p.geometry&&(e.geometry=p.geometry),p.attributes&&(e.attributes={...e.attributes,...p.attributes}))}function Ny(e=""){return!!e&&e.includes(h2e)}function bqe(e){return e?`${h2e}${e.layerId}/${e.fieldName}`:""}function oce({attributes:e,graphic:t,relatedInfo:r,fieldInfos:i,fieldInfoMap:s,layer:n}){e&&t&&r&&Object.keys(t.attributes).forEach(o=>{const a=bqe({layerId:r.relation.id.toString(),fieldName:o}),l=t.attributes[o];e[a]=v2e({fieldName:a,fieldInfos:i,fieldInfoMap:s,layer:n,value:l,graphic:t})})}function wqe({attributes:e,relatedInfo:t,fieldInfoMap:r,fieldInfos:i,layer:s}){e&&t&&(t.relatedFeatures&&t.relatedFeatures&&t.relatedFeatures.forEach(n=>oce({attributes:e,graphic:n,relatedInfo:t,fieldInfoMap:r,fieldInfos:i,layer:s})),t.relatedStatsFeatures&&t.relatedStatsFeatures&&t.relatedStatsFeatures.forEach(n=>oce({attributes:e,graphic:n,relatedInfo:t,fieldInfoMap:r,fieldInfos:i,layer:s})))}const ace=e=>{if(!e)return!1;const t=e.toUpperCase();return t.includes("CURRENT_TIMESTAMP")||t.includes("CURRENT_DATE")||t.includes("CURRENT_TIME")},_2e=({layer:e,method:t,query:r,definitionExpression:i})=>{var o,a;if(!((a=(o=e.capabilities)==null?void 0:o.query)!=null&&a.supportsCacheHint)||t==="attachments")return;const s=b(r.where)&&r.where,n=b(r.geometry)&&r.geometry;ace(i)||ace(s)||(n==null?void 0:n.type)==="extent"||r.resultType==="tile"||(r.cacheHint=!0)},xqe=({query:e,layer:t,method:r})=>{_2e({layer:t,method:r,query:e,definitionExpression:`${t.definitionExpression} ${t.serviceDefinitionExpression}`})},Tqe=({queryPayload:e,layer:t,method:r})=>{_2e({layer:t,method:r,query:e,definitionExpression:`${t.definitionExpression} ${t.serviceDefinitionExpression}`})},lce={editing:!1,operations:{add:!0,update:!0,delete:!0}},b2e=ot.ofType(qHe),Sqe="graphic.layer.capabilities.operations.supportsResizeAttachments";let vp=class extends xe{constructor(e){super(e),this._getAttachmentsPromise=null,this._attachmentLayer=null,this.abilities={...lce},this.activeAttachmentInfo=null,this.attachmentInfos=new b2e,this.graphic=null,this.mode="view",this.own(te(()=>this.graphic,()=>this._graphicChanged(),Rt))}destroy(){this._attachmentLayer=null,this.graphic=null}castAbilities(e){return{...lce,...e}}get state(){return this._getAttachmentsPromise?"loading":this.graphic?"ready":"disabled"}get supportsResizeAttachments(){return this.get(Sqe)||!1}async getAttachments(){const{_attachmentLayer:e,attachmentInfos:t}=this;if(!e||typeof e.queryAttachments!="function")throw new j("invalid-layer","getAttachments(): A valid layer is required.");const r=this._getFeatureId(),i=new XX({objectIds:[r],returnMetadata:!0}),s=[],n=e.queryAttachments(i).then(a=>a[r]||s).catch(()=>s);this._getAttachmentsPromise=n,this.notifyChange("state");const o=await n;return t.removeAll(),o.length&&t.addMany(o),this._getAttachmentsPromise=null,this.notifyChange("state"),o}async addAttachment(e){const{_attachmentLayer:t,attachmentInfos:r,graphic:i,abilities:s}=this;if(!e)throw new j("invalid-attachment","addAttachment(): An attachment is required.",{attachment:e});if(!s.operations.add)throw new j("invalid-abilities","addAttachment(): add abilities are required.");if(!t||typeof t.addAttachment!="function")throw new j("invalid-layer","addAttachment(): A valid layer is required.");const n=t.addAttachment(i,e).then(a=>this._queryAttachment(a.objectId)),o=await n;return r.add(o),o}async deleteAttachment(e){const{_attachmentLayer:t,attachmentInfos:r,graphic:i,abilities:s}=this;if(!e)throw new j("invalid-attachment-info","deleteAttachment(): An attachmentInfo is required.",{attachmentInfo:e});if(!s.operations.delete)throw new j("invalid-abilities","deleteAttachment(): delete abilities are required.");if(!t||typeof t.deleteAttachments!="function")throw new j("invalid-layer","deleteAttachment(): A valid layer is required.");const n=t.deleteAttachments(i,[e.id]).then(()=>e),o=await n;return r.remove(o),o}async updateAttachment(e,t=this.activeAttachmentInfo){const{_attachmentLayer:r,attachmentInfos:i,graphic:s,abilities:n}=this;if(!e)throw new j("invalid-attachment","updateAttachment(): An attachment is required.",{attachment:e});if(!t)throw new j("invalid-attachment-info","updateAttachment(): An attachmentInfo is required.",{attachmentInfo:t});if(!n.operations.update)throw new j("invalid-abilities","updateAttachment(): Update abilities are required.");const o=i.findIndex(c=>c===t);if(!r||typeof r.updateAttachment!="function")throw new j("invalid-layer","updateAttachment(): A valid layer is required.");const a=r.updateAttachment(s,t.id,e).then(c=>this._queryAttachment(c.objectId)),l=await a;return i.splice(o,1,l),l}async _queryAttachment(e){if(!e)throw new j("invalid-attachment-id","Could not query attachment.");const{_attachmentLayer:t}=this,r=this._getFeatureId(),i=new XX({objectIds:[r],attachmentsWhere:`AttachmentId=${e}`,returnMetadata:!0});return t.queryAttachments(i).then(s=>s[r][0])}_getFeatureId(){const{_attachmentLayer:e,graphic:t}=this;if(!e||!t)return null;const{objectIdField:r}=e,{attributes:i}=t;return i&&i[r]}_graphicChanged(){this.graphic&&(this._setAttachmentLayer(),this.getAttachments().catch(()=>{}))}_setAttachmentLayer(){const{graphic:e}=this,t=d2e(e);this._attachmentLayer=t?t.type==="scene"&&b(t.associatedLayer)?t.associatedLayer:t:null}};u([d()],vp.prototype,"abilities",void 0),u([qt("abilities")],vp.prototype,"castAbilities",null),u([d()],vp.prototype,"activeAttachmentInfo",void 0),u([d({readOnly:!0,type:b2e})],vp.prototype,"attachmentInfos",void 0),u([d({type:gl})],vp.prototype,"graphic",void 0),u([d()],vp.prototype,"mode",void 0),u([d({readOnly:!0})],vp.prototype,"state",null),u([d({readOnly:!0})],vp.prototype,"supportsResizeAttachments",null),vp=u([$("esri.widgets.Attachments.AttachmentsViewModel")],vp);const Fte=vp;function Eqe(e){const t=e.toLowerCase();return t==="image/bmp"||t==="image/emf"||t==="image/exif"||t==="image/gif"||t==="image/x-icon"||t==="image/jpeg"||t==="image/png"||t==="image/tiff"||t==="image/x-wmf"}function Cqe(e){const t=wr("esri/themes/base/images/files/");return e?e==="text/plain"?`${t}text-32.svg`:e==="application/pdf"?`${t}pdf-32.svg`:e==="text/csv"?`${t}csv-32.svg`:e==="application/gpx+xml"?`${t}gpx-32.svg`:e==="application/x-dwf"?`${t}cad-32.svg`:e==="application/postscript"||e==="application/json"||e==="text/xml"||e==="model/vrml"?`${t}code-32.svg`:e==="application/x-zip-compressed"||e==="application/x-7z-compressed"||e==="application/x-gzip"||e==="application/x-tar"||e==="application/x-gtar"||e==="application/x-bzip2"||e==="application/gzip"||e==="application/x-compress"||e==="application/x-apple-diskimage"||e==="application/x-rar-compressed"||e==="application/zip"?`${t}zip-32.svg`:e.includes("image/")?`${t}image-32.svg`:e.includes("audio/")?`${t}sound-32.svg`:e.includes("video/")?`${t}video-32.svg`:e.includes("msexcel")||e.includes("ms-excel")||e.includes("spreadsheetml")?`${t}excel-32.svg`:e.includes("msword")||e.includes("ms-word")||e.includes("wordprocessingml")?`${t}word-32.svg`:e.includes("powerpoint")||e.includes("presentationml")?`${t}report-32.svg`:`${t}generic-32.svg`:`${t}generic-32.svg`}function Js(e){return(t,r)=>{t.hasOwnProperty("_messageBundleProps")||(t._messageBundleProps=t._messageBundleProps?t._messageBundleProps.slice():[]),t._messageBundleProps.push({bundlePath:e,propertyName:r})}}var Aqe=function(e){return{vnodeSelector:"",properties:void 0,children:void 0,text:e.toString(),domNode:null}},w2e=function(e,t){for(var r=0,i=e.length;r<i;r++){var s=e[r];Array.isArray(s)?w2e(s,t):s!=null&&s!==!1&&(s.hasOwnProperty("vnodeSelector")||(s=Aqe(s)),t.push(s))}},Rqe=function(e,t){for(var r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];if(r.length===1&&typeof r[0]=="string")return{vnodeSelector:e,properties:t||void 0,children:void 0,text:r[0],domNode:null};var s=[];return w2e(r,s),{vnodeSelector:e,properties:t||void 0,children:s,text:void 0,domNode:null}};function U(e,t,...r){return typeof e!="function"||Lte(e)?Rqe(e,t,...r):e(t,...r)}const cce={addButton:!0,addSubmitButton:!0,cancelAddButton:!0,cancelUpdateButton:!0,deleteButton:!0,errorMessage:!0,progressBar:!0,updateButton:!0},tt={base:"esri-attachments",loaderContainer:"esri-attachments__loader-container",loader:"esri-attachments__loader",fadeIn:"esri-attachments--fade-in",container:"esri-attachments__container",containerList:"esri-attachments__container--list",containerPreview:"esri-attachments__container--preview",actions:"esri-attachments__actions",deleteButton:"esri-attachments__delete-button",addAttachmentButton:"esri-attachments__add-attachment-button",errorMessage:"esri-attachments__error-message",items:"esri-attachments__items",item:"esri-attachments__item",itemButton:"esri-attachments__item-button",itemMask:"esri-attachments__item-mask",itemMaskIcon:"esri-attachments__item-mask--icon",itemImage:"esri-attachments__image",itemImageResizable:"esri-attachments__image--resizable",itemLabel:"esri-attachments__label",itemFilename:"esri-attachments__filename",itemChevronIcon:"esri-attachments__item-chevron-icon",itemLink:"esri-attachments__item-link",itemLinkOverlay:"esri-attachments__item-link-overlay",itemLinkOverlayIcon:"esri-attachments__item-link-overlay-icon",itemEditIcon:"esri-attachments__item-edit-icon",itemAddIcon:"esri-attachments__item-add-icon",itemAddButton:"esri-attachments__item-add-button",formNode:"esri-attachments__form-node",fileFieldset:"esri-attachments__file-fieldset",fileLabel:"esri-attachments__file-label",fileName:"esri-attachments__file-name",fileInput:"esri-attachments__file-input",metadata:"esri-attachments__metadata",metadataFieldset:"esri-attachments__metadata-fieldset",progressBar:"esri-attachments__progress-bar",esriWidget:"esri-widget",esriButton:"esri-button",buttonDisabled:"esri-button--disabled",esriButtonSecondary:"esri-button--secondary",esriButtonTertiary:"esri-button--tertiary",esriButtonThird:"esri-button--third",esriButtonSmall:"esri-button--small",esriButtonHalf:"esri-button--half",empty:"esri-widget__content--empty",iconExternalLink:"esri-icon-link-external",iconEdit:"esri-icon-edit",iconRight:"esri-icon-right",iconLeft:"esri-icon-left",iconPlus:"esri-icon-plus"},lG=window.CSS;let Ha=class extends Un{constructor(e,t){super(e,t),this.abilities=null,this.displayType="auto",this.graphic=null,this.label=void 0,this.messages=null,this.messagesUnits=null,this.selectedFile=null,this.submitting=!1,this.viewModel=new Fte,this.visibleElements={...cce},this._supportsImageOrientation=lG&&lG.supports&&lG.supports("image-orientation","from-image"),this._addAttachmentForm=null,this._updateAttachmentForm=null}initialize(){this.own([rs(()=>{var e;return(e=this.viewModel)==null?void 0:e.attachmentInfos},"change",()=>this.scheduleRender()),te(()=>{var e;return(e=this.viewModel)==null?void 0:e.mode},()=>this._modeChanged(),Rt)])}get effectiveDisplayType(){const{displayType:e}=this;return e&&e!=="auto"?e:this.viewModel.supportsResizeAttachments?"preview":"list"}castVisibleElements(e){return{...cce,...e}}addAttachment(){const{_addAttachmentForm:e,viewModel:t}=this;return this._set("submitting",!0),this._set("error",null),t.addAttachment(e).then(r=>(this._set("submitting",!1),this._set("error",null),t.mode="view",r)).catch(r=>{throw this._set("submitting",!1),this._set("error",new j("attachments:add-attachment",this.messages.addErrorMessage,r)),r})}deleteAttachment(e){const{viewModel:t}=this;return this._set("submitting",!0),this._set("error",null),t.deleteAttachment(e).then(r=>(this._set("submitting",!1),this._set("error",null),t.mode="view",r)).catch(r=>{throw this._set("submitting",!1),this._set("error",new j("attachments:delete-attachment",this.messages.deleteErrorMessage,r)),r})}updateAttachment(){const{viewModel:e}=this,{_updateAttachmentForm:t}=this;return this._set("submitting",!0),this._set("error",null),e.updateAttachment(t).then(r=>(this._set("submitting",!1),this._set("error",null),e.mode="view",r)).catch(r=>{throw this._set("submitting",!1),this._set("error",new j("attachments:update-attachment",this.messages.updateErrorMessage,r)),r})}render(){const{submitting:e,viewModel:t}=this,{state:r}=t;return U("div",{class:this.classes(tt.base,tt.esriWidget)},e?this.renderProgressBar():null,r==="loading"?this.renderLoading():this.renderAttachments(),this.renderErrorMessage())}renderErrorMessage(){const{error:e,visibleElements:t}=this;return e&&t.errorMessage?U("div",{key:"error-message",class:tt.errorMessage},e.message):null}renderAttachments(){const{mode:e,activeAttachmentInfo:t}=this.viewModel;return e==="add"?this.renderAddForm():e==="edit"?this.renderDetailsForm(t):this.renderAttachmentContainer()}renderLoading(){return U("div",{class:tt.loaderContainer,key:"loader"},U("div",{class:tt.loader}))}renderProgressBar(){return this.visibleElements.progressBar?U("div",{class:tt.progressBar,key:"progress-bar"}):null}renderAddForm(){const{submitting:e,selectedFile:t}=this,r=e||!t,i=this.visibleElements.cancelAddButton?U("button",{type:"button",bind:this,disabled:e,onclick:this._cancelForm,class:this.classes(tt.esriButton,tt.esriButtonTertiary,tt.esriButtonSmall,tt.esriButtonHalf,e&&tt.buttonDisabled)},this.messages.cancel):null,s=this.visibleElements.addSubmitButton?U("button",{type:"submit",disabled:r,class:this.classes(tt.esriButton,tt.esriButtonSecondary,tt.esriButtonSmall,tt.esriButtonHalf,{[tt.buttonDisabled]:r})},this.messages.add):null,n=t?U("span",{key:"file-name",class:tt.fileName},t.name):null,o=U("form",{bind:this,afterCreate:VX,afterRemoved:Nle,"data-node-ref":"_addAttachmentForm",onsubmit:this._submitAddAttachment},U("fieldset",{class:tt.fileFieldset},n,U("label",{class:this.classes(tt.fileLabel,tt.esriButton,tt.esriButtonSecondary)},t?this.messages.changeFile:this.messages.selectFile,U("input",{class:tt.fileInput,type:"file",name:"attachment",bind:this,onchange:this._handleFileInputChange}))),s,i);return U("div",{key:"add-form-container",class:tt.formNode},o)}renderDetailsForm(e){const{visibleElements:t,viewModel:r,selectedFile:i,submitting:s}=this,{contentType:n,size:o,url:a}=e,{abilities:l}=r,c=s||!i,h=l.editing&&l.operations.delete&&t.deleteButton?U("button",{key:"delete-button",type:"button",disabled:s,bind:this,onclick:T=>this._submitDeleteAttachment(T,e),class:this.classes(tt.esriButton,tt.esriButtonSmall,tt.esriButtonTertiary,tt.deleteButton,{[tt.buttonDisabled]:s})},this.messages.delete):null,p=l.editing&&l.operations.update&&t.updateButton?U("button",{disabled:c,key:"update-button",type:"submit",class:this.classes(tt.esriButton,tt.esriButtonSmall,tt.esriButtonThird,{[tt.buttonDisabled]:c})},this.messages.update):null,f=this.visibleElements.cancelUpdateButton?U("button",{disabled:s,key:"cancel-button",type:"button",bind:this,onclick:this._cancelForm,class:this.classes(tt.esriButton,tt.esriButtonSmall,tt.esriButtonTertiary,tt.esriButtonThird,{[tt.buttonDisabled]:s})},this.messages.cancel):null,m=i?U("span",{key:"file-name",class:tt.fileName},i.name):null,g=l.editing&&l.operations.update?U("fieldset",{key:"file",class:tt.fileFieldset},m,U("label",{class:this.classes(tt.fileLabel,tt.esriButton,tt.esriButtonSecondary)},this.messages.changeFile,U("input",{class:tt.fileInput,type:"file",name:"attachment",bind:this,onchange:this._handleFileInputChange}))):null,v=U("fieldset",{key:"size",class:tt.metadataFieldset},U("label",null,BHe(this.messagesUnits,o))),w=U("fieldset",{key:"content-type",class:tt.metadataFieldset},U("label",null,n)),_=U("form",{bind:this,afterCreate:VX,afterRemoved:Nle,"data-node-ref":"_updateAttachmentForm",onsubmit:this._submitUpdateAttachment},U("div",{class:tt.metadata},v,w),g,U("div",{class:tt.actions},h,f,p));return U("div",{key:"edit-form-container",class:tt.formNode},U("a",{class:tt.itemLink,href:a,rel:"noreferrer",target:"_blank"},this.renderImageMask({attachmentInfo:e,size:400}),U("div",{class:tt.itemLinkOverlay},U("span",{class:tt.itemLinkOverlayIcon},U("svg",{xmlns:"http://www.w3.org/2000/svg",width:"32",height:"32",viewBox:"0 0 32 32"},U("path",{d:"M28 13h1v16H3V3h16v1H4v24h24zm-5-9h4.293L15.646 15.638l.707.707L28 4.707V9h1V3h-6z"}),U("path",{fill:"none",d:"M0 0h32v32H0z"}))))),_)}renderImageMask({attachmentInfo:e,size:t}){const{supportsResizeAttachments:r}=this.viewModel,{contentType:i,name:s,url:n}=e,o=r&&Eqe(i),a=this._getCSSTransform(e,o),l=a?{transform:a,"image-orientation":"none"}:{},c=n.includes("?")?"&":"?",h=o?`${n}${c}w=${t}`:Cqe(i),p={[tt.itemMaskIcon]:!o},f={[tt.itemImageResizable]:r};return U("div",{class:this.classes(p,tt.itemMask)},U("img",{styles:l,alt:s,src:h,class:this.classes(f,tt.itemImage)}))}renderAttachmentInfo({attachmentInfo:e,displayType:t}){const{viewModel:r}=this,{abilities:i}=r,{name:s,url:n}=e,o=this.renderImageMask({attachmentInfo:e,size:t==="list"?48:400}),a=i.editing?U("span",{"aria-hidden":"true",class:this.classes(tt.itemChevronIcon,nf(this.container)?tt.iconLeft:tt.iconRight)}):null,l=[o,U("label",{class:tt.itemLabel},U("span",{class:tt.itemFilename},s||this.messages.noTitle),a)],c=i.editing?U("button",{key:"details-button",bind:this,class:tt.itemButton,title:this.messages.attachmentDetails,"aria-label":this.messages.attachmentDetails,"data-attachment-info-id":e.id,onclick:()=>this._startEditAttachment(e),type:"button"},l):U("a",{key:"details-link",class:tt.itemButton,href:n,target:"_blank"},l);return U("li",{class:tt.item,key:e},c)}renderAttachmentContainer(){const{effectiveDisplayType:e,viewModel:t,visibleElements:r}=this,{attachmentInfos:i,abilities:s}=t,n=i&&i.length,o={[tt.containerList]:e!=="preview",[tt.containerPreview]:e==="preview"},a=s.editing&&s.operations.add&&r.addButton?U("button",{bind:this,onclick:()=>this._startAddAttachment(),class:this.classes(tt.esriButton,tt.esriButtonTertiary,tt.addAttachmentButton),type:"button"},U("span",{"aria-hidden":"true",class:this.classes(tt.itemAddIcon,tt.iconPlus)}),this.messages.add):null,l=n?U("ul",{class:tt.items},i.toArray().map(c=>this.renderAttachmentInfo({attachmentInfo:c,displayType:e}))):U("div",{class:tt.empty},this.messages.noAttachments);return U("div",{key:"attachments-container",class:this.classes(tt.container,o)},l,a)}_modeChanged(){this._set("error",null),this._set("selectedFile",null)}_handleFileInputChange(e){const t=e.target,r=t&&t.files&&t.files.item(0);this._set("selectedFile",r)}_submitDeleteAttachment(e,t){e.preventDefault(),this.deleteAttachment(t)}_submitAddAttachment(e){e.preventDefault(),this.addAttachment()}_submitUpdateAttachment(e){e.preventDefault(),this.updateAttachment()}_startEditAttachment(e){const{viewModel:t}=this;t.activeAttachmentInfo=e,t.mode="edit"}_startAddAttachment(){this.viewModel.mode="add"}_cancelForm(e){e.preventDefault(),this.viewModel.mode="view"}_getCSSTransform(e,t){const{orientationInfo:r}=e;return!this._supportsImageOrientation&&t&&r?[r.rotation?`rotate(${r.rotation}deg)`:"",r.mirrored?"scaleX(-1)":""].join(" "):""}};u([We("viewModel.abilities")],Ha.prototype,"abilities",void 0),u([d()],Ha.prototype,"displayType",void 0),u([d({readOnly:!0})],Ha.prototype,"effectiveDisplayType",null),u([We("viewModel.graphic")],Ha.prototype,"graphic",void 0),u([d({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],Ha.prototype,"label",void 0),u([d(),Js("esri/widgets/Attachments/t9n/Attachments")],Ha.prototype,"messages",void 0),u([d(),Js("esri/core/t9n/Units")],Ha.prototype,"messagesUnits",void 0),u([d({readOnly:!0})],Ha.prototype,"selectedFile",void 0),u([d({readOnly:!0})],Ha.prototype,"submitting",void 0),u([d({readOnly:!0})],Ha.prototype,"error",void 0),u([d({type:Fte})],Ha.prototype,"viewModel",void 0),u([d()],Ha.prototype,"visibleElements",void 0),u([qt("visibleElements")],Ha.prototype,"castVisibleElements",null),Ha=u([$("esri.widgets.Attachments")],Ha);const Oqe=Ha;let UM=class extends Fte{constructor(e){super(e),this.description=null,this.title=null}};u([d()],UM.prototype,"description",void 0),u([d()],UM.prototype,"title",void 0),UM=u([$("esri.widgets.Feature.FeatureAttachments.FeatureAttachmentsViewModel")],UM);const kte=UM,Mqe={heading:"esri-widget__heading"};function u1(e,t){const r=x2e(e.level),i=`h${r}`;return delete e.level,U(i,{...e,class:RE(Mqe.heading,e.class),role:"heading","aria-level":String(r)},t)}function x2e(e){return Le(Math.ceil(e),1,6)}function Pqe(e,t=1){return x2e(e+t)}const cG={base:"esri-feature-element-info",title:"esri-feature-element-info__title",description:"esri-feature-element-info__description"};let R2=class extends Un{constructor(e,t){super(e,t),this.description=null,this.headingLevel=2,this.title=null}render(){return U("div",{class:cG.base},this.renderTitle(),this.renderDescription())}renderTitle(){const{title:e}=this;return e?U(u1,{level:this.headingLevel,class:cG.title},e):null}renderDescription(){const{description:e}=this;return e?U("div",{key:"description",class:cG.description},e):null}};u([d()],R2.prototype,"description",void 0),u([d()],R2.prototype,"headingLevel",void 0),u([d()],R2.prototype,"title",void 0),R2=u([$("esri.widgets.Feature.support.FeatureElementInfo")],R2);const Ute=R2,Iqe={base:"esri-feature-attachments"};let sm=class extends Un{constructor(e,t){super(e,t),this._featureElementInfo=null,this.attachmentsWidget=new Oqe,this.description=null,this.displayType=null,this.graphic=null,this.headingLevel=2,this.title=null,this.viewModel=new kte}initialize(){this._featureElementInfo=new Ute,this.own([te(()=>{var e,t;return[(e=this.viewModel)==null?void 0:e.description,(t=this.viewModel)==null?void 0:t.title,this.headingLevel]},()=>this._setupFeatureElementInfo(),Rt),te(()=>{var e;return(e=this.viewModel)==null?void 0:e.graphic},e=>this.attachmentsWidget.graphic=e,Rt)])}destroy(){this.attachmentsWidget.destroy(),this._featureElementInfo.destroy()}render(){var t;const{attachmentsWidget:e}=this;return U("div",{class:Iqe.base},(t=this._featureElementInfo)==null?void 0:t.render(),e==null?void 0:e.render())}_setupFeatureElementInfo(){const{description:e,title:t,headingLevel:r}=this;this._featureElementInfo.set({description:e,title:t,headingLevel:r})}};u([d({readOnly:!0})],sm.prototype,"attachmentsWidget",void 0),u([We("viewModel.description")],sm.prototype,"description",void 0),u([We("attachmentsWidget.displayType")],sm.prototype,"displayType",void 0),u([We("viewModel.graphic")],sm.prototype,"graphic",void 0),u([d()],sm.prototype,"headingLevel",void 0),u([We("viewModel.title")],sm.prototype,"title",void 0),u([d({type:kte})],sm.prototype,"viewModel",void 0),sm=u([$("esri.widgets.Feature.FeatureAttachments")],sm);const $qe=sm;let kv=class extends pg(xe){constructor(e){super(e),this._loadingPromise=null,this.created=null,this.creator=null,this.destroyer=null,this.graphic=null,this.handles.add(te(()=>this.creator,t=>{this._destroyContent(),this._createContent(t)},Rt))}destroy(){this._destroyContent()}get state(){return this._loadingPromise?"loading":"ready"}_destroyContent(){const{created:e,graphic:t,destroyer:r}=this;e&&(JU(r,{graphic:t}).catch(()=>null),this._set("created",null))}async _createContent(e){const{graphic:t}=this,r=JU(e,{graphic:t}).catch(()=>null);this._loadingPromise=r,this.notifyChange("state");const i=await r;r===this._loadingPromise&&(this._loadingPromise=null,this.notifyChange("state"),this._set("created",i))}};u([d({readOnly:!0})],kv.prototype,"created",void 0),u([d()],kv.prototype,"creator",void 0),u([d()],kv.prototype,"destroyer",void 0),u([d({type:gl})],kv.prototype,"graphic",void 0),u([d({readOnly:!0})],kv.prototype,"state",null),kv=u([$("esri.widgets.Feature.FeatureContent.FeatureContentViewModel")],kv);const eV=kv;function sl(){return function(e,t){if(!e[t])throw new TypeError(`Cannot auto bind undefined function '${t}'`);return{value:Dqe(e[t])}}}function Lqe(e){const{type:t}=e;return e instanceof KeyboardEvent||t==="keyup"||t==="keydown"||t==="keypress"}function Dqe(e){return function(t,...r){Lqe(t)?Sje(t.key)&&(t.preventDefault(),t.stopPropagation(),t.target.click()):e.call(this,t,...r)}}function Nqe(e){return e.split(",").map(t=>t.trim())}function T2e(e){return t=>{t.hasOwnProperty("_delegatedEventNames")||(t._delegatedEventNames=t._delegatedEventNames?t._delegatedEventNames.slice():[]);const r=t._delegatedEventNames,i=Array.isArray(e)?e:Nqe(e);r.push(...i)}}const S2e="calcite-theme-";function Fqe(){return getComputedStyle(document.body).getPropertyValue("--esri-calcite-theme-name").replace(/\s|'|"/g,"")}function Vte(){return Fqe().startsWith("dark")}function kqe(){return`${S2e}${Vte()?"dark":"light"}`}function Uqe(e){Vqe(e),e.classList.add(kqe())}function Vqe(e){Array.from(e.classList).forEach(t=>{t.startsWith(S2e)&&e.classList.remove(t)})}function tV(e){return e&&typeof e.render=="function"}function E2e(e){return e&&typeof e.postMixInProperties=="function"&&typeof e.buildRendering=="function"&&typeof e.postCreate=="function"&&typeof e.startup=="function"}const uG={base:"esri-feature-content",loaderContainer:"esri-feature-content__loader-container",loader:"esri-feature-content__loader"};let O2=class extends Un{constructor(e,t){super(e,t),this.creator=null,this.graphic=null,this.viewModel=null,this._addTargetToAnchors=r=>{Array.from(r.querySelectorAll("a")).forEach(i=>{p2e(i.href)&&!i.hasAttribute("target")&&i.setAttribute("target","_blank")})}}renderLoading(){return U("div",{class:uG.loaderContainer,key:"loader"},U("div",{class:uG.loader}))}renderCreated(){var t;const e=(t=this.viewModel)==null?void 0:t.created;return e?e instanceof HTMLElement?U("div",{key:e,bind:e,afterCreate:this._attachToNode}):tV(e)?U("div",{key:e},!e.destroyed&&e.render()):U("div",{key:e,innerHTML:e,afterCreate:this._addTargetToAnchors}):null}render(){var t;const e=(t=this.viewModel)==null?void 0:t.state;return U("div",{class:uG.base},e==="loading"?this.renderLoading():this.renderCreated())}_attachToNode(e){const t=this;e.appendChild(t)}};u([We("viewModel.creator")],O2.prototype,"creator",void 0),u([We("viewModel.graphic")],O2.prototype,"graphic",void 0),u([d({type:eV})],O2.prototype,"viewModel",void 0),O2=u([$("esri.widgets.Feature.FeatureContent")],O2);const h5=O2;let Yg=class extends xe{constructor(e){super(e),this.attributes=null,this.expressionInfos=null,this.description=null,this.fieldInfos=null,this.title=null}get formattedFieldInfos(){const{expressionInfos:e,fieldInfos:t}=this,r=[];return t==null||t.forEach(i=>{if(!(!i.hasOwnProperty("visible")||i.visible))return;const s=i.clone();s.label=m2e(s,e),r.push(s)}),r}};u([d()],Yg.prototype,"attributes",void 0),u([d({type:[Fwe]})],Yg.prototype,"expressionInfos",void 0),u([d()],Yg.prototype,"description",void 0),u([d({type:[W$]})],Yg.prototype,"fieldInfos",void 0),u([d({readOnly:!0})],Yg.prototype,"formattedFieldInfos",null),u([d()],Yg.prototype,"title",void 0),Yg=u([$("esri.widgets.Feature.FeatureFields.FeatureFieldsViewModel")],Yg);const F6=Yg,zqe=[{pattern:/^\s*(https?:\/\/([^\s]+))\s*$/i,target:"_blank",label:"{messages.view}"},{pattern:/^\s*(tel:([^\s]+))\s*$/i,label:"{hierPart}"},{pattern:/^\s*(mailto:([^\s]+))\s*$/i,label:"{hierPart}"},{pattern:/^\s*(arcgis-appstudio-player:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"App Studio Player"},{pattern:/^\s*(arcgis-collector:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Collector"},{pattern:/^\s*(arcgis-explorer:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Explorer"},{pattern:/^\s*(arcgis-navigator:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Navigator"},{pattern:/^\s*(arcgis-survey123:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Survey123"},{pattern:/^\s*(arcgis-trek2there:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Trek2There"},{pattern:/^\s*(arcgis-workforce:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Workforce"},{pattern:/^\s*(iform:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"iForm"},{pattern:/^\s*(flow:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"FlowFinity"},{pattern:/^\s*(lfmobile:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Laserfische"},{pattern:/^\s*(mspbi:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Microsoft Power Bi"}];function Bqe(e){let t=null;return zqe.some(r=>(r.pattern.test(e)&&(t=r),!!t)),t}function Gqe(e,t){if(typeof t!="string"||!t)return t;const r=Bqe(t);if(!r)return t;const i=t.match(r.pattern),s=i&&i[2],n=Zm(Zm(r.label,{messages:e,hierPart:s}),{appName:r.appName}),o=r.target?` target="${r.target}"`:"",a=r.target==="_blank"?' rel="noreferrer"':"";return t.replace(r.pattern,`<a${o} href="$1"${a}>${n}</a>`)}const rO={base:"esri-feature-fields",fieldHeader:"esri-feature-fields__field-header",fieldData:"esri-feature-fields__field-data",fieldDataDate:"esri-feature-fields__field-data--date",esriTable:"esri-widget__table"};let _p=class extends Un{constructor(e,t){super(e,t),this._featureElementInfo=null,this.attributes=null,this.description=null,this.expressionInfos=null,this.fieldInfos=null,this.title=null,this.viewModel=new F6,this.messages=null,this.messagesURIUtils=null}initialize(){this._featureElementInfo=new Ute,this.own(te(()=>{var e,t;return[(e=this.viewModel)==null?void 0:e.description,(t=this.viewModel)==null?void 0:t.title]},()=>this._setupFeatureElementInfo(),Rt))}destroy(){this._featureElementInfo.destroy()}renderFieldInfo(e,t){const{attributes:r}=this.viewModel,i=e.fieldName,s=e.label||i,n=r?r[i]==null?"":r[i]:"",o=!(!e.format||!e.format.dateFormat),a=typeof n=="number"&&!o?this._forceLTR(n):Gqe(this.messagesURIUtils,n),l={[rO.fieldDataDate]:o};return U("tr",{key:`fields-element-info-row-${i}-${t}`},U("th",{key:`fields-element-info-row-header-${i}-${t}`,class:rO.fieldHeader,innerHTML:s}),U("td",{key:`fields-element-info-row-data-${i}-${t}`,class:this.classes(rO.fieldData,l),innerHTML:a}))}renderFields(){const{formattedFieldInfos:e}=this.viewModel;return e!=null&&e.length?U("table",{class:rO.esriTable,summary:this.messages.fieldsSummary},U("tbody",null,e.map((t,r)=>this.renderFieldInfo(t,r)))):null}render(){var e;return U("div",{class:rO.base},(e=this._featureElementInfo)==null?void 0:e.render(),this.renderFields())}_setupFeatureElementInfo(){const{description:e,title:t}=this;this._featureElementInfo.set({description:e,title:t})}_forceLTR(e){return`&lrm;${e}`}};u([We("viewModel.attributes")],_p.prototype,"attributes",void 0),u([We("viewModel.description")],_p.prototype,"description",void 0),u([We("viewModel.expressionInfos")],_p.prototype,"expressionInfos",void 0),u([We("viewModel.fieldInfos")],_p.prototype,"fieldInfos",void 0),u([We("viewModel.title")],_p.prototype,"title",void 0),u([d({type:F6})],_p.prototype,"viewModel",void 0),u([d(),Js("esri/widgets/Feature/t9n/Feature")],_p.prototype,"messages",void 0),u([d(),Js("esri/widgets/support/t9n/uriUtils")],_p.prototype,"messagesURIUtils",void 0),_p=u([$("esri.widgets.Feature.FeatureFields")],_p);const C2e=_p,jqe=/^-?(\d+)(\.(\d+))?$/i;function Hqe(e,t){return e-t}function qqe(e,t){let r,i;return r=Number(e.toFixed(t)),r<e?i=r+1/10**t:(i=r,r-=1/10**t),r=Number(r.toFixed(t)),i=Number(i.toFixed(t)),[r,i]}function Wqe(e,t,r,i,s){const n=d5(e,t,r,i),o=n.previous==null||n.previous<=s,a=n.next==null||n.next<=s;return o&&a||n.previous+n.next<=2*s}function rV(e){const t=String(e),r=t.match(jqe);if(r&&r[1])return{integer:r[1].split("").length,fractional:r[3]?r[3].split("").length:0};if(t.toLowerCase().includes("e")){const i=t.split("e"),s=i[0],n=i[1];if(s&&n){const o=Number(s);let a=Number(n);const l=a>0;l||(a=Math.abs(a));const c=rV(o);return l?(c.integer+=a,a>c.fractional?c.fractional=0:c.fractional-=a):(c.fractional+=a,a>c.integer?c.integer=1:c.integer-=a),c}}return{integer:0,fractional:0}}function d5(e,t,r,i){const s={previous:null,next:null};if(r!=null){const n=e-r,o=t-r-n;s.previous=Math.floor(Math.abs(100*o/n))}if(i!=null){const n=i-e,o=i-t-n;s.next=Math.floor(Math.abs(100*o/n))}return s}function iV(e,t={}){const r=e.slice(0),{tolerance:i=2,strictBounds:s=!1,indexes:n=r.map((o,a)=>a)}=t;n.sort(Hqe);for(let o=0;o<n.length;o++){const a=n[o],l=r[a],c=a===0?null:r[a-1],h=a===r.length-1?null:r[a+1],p=rV(l).fractional;if(p){let f,m=0,g=!1;for(;m<=p&&!g;){const v=qqe(l,m);f=s&&o===0?v[1]:v[0],g=Wqe(l,f,c,h,i),m++}g&&(r[a]=f)}}return r}const Xqe={maximumFractionDigits:20};function Zqe(e){return Ud(e,Xqe)}var JX;let cw=JX=class extends ye{constructor(e){super(e),this.color=null,this.label=null,this.value=null}writeValue(e,t,r){t[r]=e==null?0:e}clone(){return new JX({color:this.color&&this.color.clone(),label:this.label,value:this.value})}};u([d({type:Me,json:{type:[Wi],write:!0}})],cw.prototype,"color",void 0),u([d({type:String,json:{write:!0}})],cw.prototype,"label",void 0),u([d({type:Number,json:{write:{writerEnsuresNonNull:!0}}})],cw.prototype,"value",void 0),u([Xe("value")],cw.prototype,"writeValue",null),cw=JX=u([$("esri.renderers.visualVariables.support.ColorStop")],cw);const Yqe=cw;function eL(){const e=new Float32Array(16);return e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function Qqe(e){const t=new Float32Array(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function Jqe(e,t,r,i,s,n,o,a,l,c,h,p,f,m,g,v){const w=new Float32Array(16);return w[0]=e,w[1]=t,w[2]=r,w[3]=i,w[4]=s,w[5]=n,w[6]=o,w[7]=a,w[8]=l,w[9]=c,w[10]=h,w[11]=p,w[12]=f,w[13]=m,w[14]=g,w[15]=v,w}function Kqe(e,t){return new Float32Array(e,t,16)}const eWe=eL();Object.freeze(Object.defineProperty({__proto__:null,create:eL,clone:Qqe,fromValues:Jqe,createView:Kqe,IDENTITY:eWe},Symbol.toStringTag,{value:"Module"}));const tWe=(e,t)=>{const r=gg(e,t,0,0,0,0,t,0,0,0,0,t,0,0,0,0,1);return lc(r,r)},rWe=(e,t)=>{const r=gg(e,t,0,0,.5-.5*t,0,t,0,.5-.5*t,0,0,t,.5-.5*t,0,0,0,1);return lc(r,r)},iWe=(e,t)=>{const r=1-t,i=gg(e,.2126+.7874*r,.7152-.7152*r,.0722-.0722*r,0,.2126-.2126*r,.7152+.2848*r,.0722-.0722*r,0,.2126-.2126*r,.7152-.7152*r,.0722+.9278*r,0,0,0,0,1);return lc(i,i)},sWe=(e,t)=>{const r=Math.sin(t*Math.PI/180),i=Math.cos(t*Math.PI/180),s=gg(e,.213+.787*i-.213*r,.715-.715*i-.715*r,.072-.072*i+.928*r,0,.213-.213*i+.143*r,.715+.285*i+.14*r,.072-.072*i-.283*r,0,.213-.213*i-.787*r,.715-.715*i+.715*r,.072+.928*i+.072*r,0,0,0,0,1);return lc(s,s)},nWe=(e,t)=>{const r=1-2*t,i=gg(e,r,0,0,t,0,r,0,t,0,0,r,t,0,0,0,1);return lc(i,i)},oWe=(e,t)=>{const r=gg(e,.213+.787*t,.715-.715*t,.072-.072*t,0,.213-.213*t,.715+.285*t,.072-.072*t,0,.213-.213*t,.715-.715*t,.072+.928*t,0,0,0,0,1);return lc(r,r)},aWe=(e,t)=>{const r=1-t,i=gg(e,.393+.607*r,.769-.769*r,.189-.189*r,0,.349-.349*r,.686+.314*r,.168-.168*r,0,.272-.272*r,.534-.534*r,.131+.869*r,0,0,0,0,1);return lc(i,i)};class k6{constructor(t,r,i){this.strength=t,this.radius=r,this.threshold=i,this.type="bloom"}interpolate(t,r,i){this.strength=Dc(t.strength,r.strength,i),this.radius=Dc(t.radius,r.radius,i),this.threshold=Dc(t.threshold,r.threshold,i)}clone(){return new k6(this.strength,this.radius,this.threshold)}toJSON(){return{type:"bloom",radius:J3(this.radius),strength:this.strength,threshold:this.threshold}}}class U6{constructor(t){this.radius=t,this.type="blur"}interpolate(t,r,i){this.radius=Math.round(Dc(t.radius,r.radius,i))}clone(){return new U6(this.radius)}toJSON(){return{type:"blur",radius:J3(this.radius)}}}class _I{constructor(t,r){this.type=t,this.amount=r,this.type!=="invert"&&this.type!=="grayscale"&&this.type!=="sepia"||(this.amount=Math.min(this.amount,1))}get colorMatrix(){return this._colorMatrix||this._updateMatrix(),this._colorMatrix}interpolate(t,r,i){this.amount=Dc(t.amount,r.amount,i),this._updateMatrix()}clone(){return new _I(this.type,this.amount)}toJSON(){return{type:this.type,amount:this.amount}}_updateMatrix(){const t=this._colorMatrix||eL();switch(this.type){case"brightness":this._colorMatrix=tWe(t,this.amount);break;case"contrast":this._colorMatrix=rWe(t,this.amount);break;case"grayscale":this._colorMatrix=iWe(t,this.amount);break;case"invert":this._colorMatrix=nWe(t,this.amount);break;case"saturate":this._colorMatrix=oWe(t,this.amount);break;case"sepia":this._colorMatrix=aWe(t,this.amount)}}}class V6{constructor(t,r,i,s){this.offsetX=t,this.offsetY=r,this.blurRadius=i,this.color=s,this.type="drop-shadow"}interpolate(t,r,i){this.offsetX=Dc(t.offsetX,r.offsetX,i),this.offsetY=Dc(t.offsetY,r.offsetY,i),this.blurRadius=Dc(t.blurRadius,r.blurRadius,i),this.color[0]=Math.round(Dc(t.color[0],r.color[0],i)),this.color[1]=Math.round(Dc(t.color[1],r.color[1],i)),this.color[2]=Math.round(Dc(t.color[2],r.color[2],i)),this.color[3]=Dc(t.color[3],r.color[3],i)}clone(){return new V6(this.offsetX,this.offsetY,this.blurRadius,[...this.color])}toJSON(){const t=[...this.color];return t[3]*=255,{type:"drop-shadow",xoffset:J3(this.offsetX),yoffset:J3(this.offsetY),blurRadius:J3(this.blurRadius),color:t}}}class z6{constructor(t){this.angle=t,this.type="hue-rotate"}get colorMatrix(){return this._colorMatrix||this._updateMatrix(),this._colorMatrix}interpolate(t,r,i){this.angle=Dc(t.angle,r.angle,i),this._updateMatrix()}clone(){return new z6(this.angle)}toJSON(){return{type:"hue-rotate",angle:this.angle}}_updateMatrix(){const t=this._colorMatrix||eL();this._colorMatrix=sWe(t,this.angle)}}class B6{constructor(t){this.amount=t,this.type="opacity",this.amount=Math.min(this.amount,1)}interpolate(t,r,i){this.amount=Dc(t.amount,r.amount,i)}clone(){return new B6(this.amount)}toJSON(){return{type:"opacity",amount:this.amount}}}function Dc(e,t,r){return e+(t-e)*r}function J3(e){return Math.round(1e3*ac(e))/1e3}function lWe(e){switch(e.type){case"grayscale":case"sepia":case"invert":return new _I(e.type,0);case"saturate":case"brightness":case"contrast":return new _I(e.type,1);case"opacity":return new B6(1);case"hue-rotate":return new z6(0);case"blur":return new U6(0);case"drop-shadow":return new V6(0,0,0,[...hee("transparent")]);case"bloom":return new k6(0,0,1)}}function A2e(e,t){const r=e.length>t.length?e:t;return(e.length>t.length?t:e).every((i,s)=>i.type===r[s].type)}function R2e(e,t){const r=e.length>t.length?e:t,i=e.length>t.length?t:e;for(let s=i.length;s<r.length;s++)i.push(lWe(r[s]))}function cWe(e){const t=e[0];return!!t&&"type"in t}var uce,hce,O2e={exports:{}};function zte(e){if(!e||e.length===0)return null;if(typeof e=="string"){const r=dce(e);return r&&r.length!==0?r:null}const t=e.map(r=>{if(!Number.isFinite(r.scale)||r.scale<=0)throw new j("effect:invalid-scale","scale must be finite and greater than 0",{stop:r});return{scale:r.scale,effects:dce(r.value)}});t.sort((r,i)=>i.effects.length-r.effects.length);for(let r=0;r<t.length-1;r++){if(!A2e(t[r].effects,t[r+1].effects))throw new j("effect:interpolation-impossible","Cannot interpolate by scale between 2 lists of mixed effects",{a:t[r].effects,b:t[r+1].effects});R2e(t[r].effects,t[r+1].effects)}return t.sort((r,i)=>i.scale-r.scale),t}function dce(e){let t;if(!e)return[];try{t=O2e.exports.parse(e)}catch(r){throw new j("effect:invalid-syntax","Invalid effect syntax",{value:e,error:r})}return t.map(r=>uWe(r))}function uWe(e){try{switch(e.name){case"grayscale":case"sepia":case"saturate":case"invert":case"brightness":case"contrast":return hWe(e);case"opacity":return dWe(e);case"hue-rotate":return pWe(e);case"blur":return fWe(e);case"drop-shadow":return mWe(e);case"bloom":return gWe(e)}}catch(t){throw t.details.filter=e,t}throw new j("effect:unknown-effect",`Effect '${e.name}' is not supported`,{effect:e})}function hWe(e){let t=1;return mR(e.parameters,1),e.parameters.length===1&&(t=Vp(e.parameters[0])),new _I(e.name,t)}function dWe(e){let t=1;return mR(e.parameters,1),e.parameters.length===1&&(t=Vp(e.parameters[0])),new B6(t)}function pWe(e){let t=0;return mR(e.parameters,1),e.parameters.length===1&&(t=xWe(e.parameters[0])),new z6(t)}function fWe(e){let t=0;return mR(e.parameters,1),e.parameters.length===1&&(t=jte(e.parameters[0]),tL(t,e.parameters[0])),new U6(t)}function mWe(e){const t=[];let r=null;for(const i of e.parameters)if(i.type==="color"){if(t.length&&Object.freeze(t),r)throw new j("effect:type-error","Accepts only one color",{});r=TWe(i)}else{const s=jte(i);if(Object.isFrozen(t))throw new j("effect:type-error","<length> parameters not consecutive",{lengths:t});t.push(s),t.length===3&&tL(s,i)}if(t.length<2||t.length>3)throw new j("effect:type-error",`Expected <length>{2,3}, Actual: <length>{${t.length}}`,{lengths:t});return new V6(t[0],t[1],t[2]||0,r||M2e("black"))}function gWe(e){let t=1,r=0,i=0;return mR(e.parameters,3),e.parameters[0]&&(t=Vp(e.parameters[0])),e.parameters[1]&&(r=jte(e.parameters[1]),tL(r,e.parameters[1])),e.parameters[2]&&(i=Vp(e.parameters[2])),new k6(t,r,i)}function mR(e,t){if(e.length>t)throw new j("effect:type-error",`Function supports up to ${t} parameters, Actual: ${e.length}`,{parameters:e})}function G6(e){if(e.type==="color")return"<color>";if(e.unit){if(Gte[e.unit])return"<length>";if(Bte[e.unit])return"<angle>";if(e.unit==="%")return"<percentage>"}return"<double>"}function tL(e,t){if(e<0)throw new j("effect:type-error",`Negative values are not allowed, Actual: ${e}`,{term:t})}function yWe(e){if(e.type!=="quantity"||e.unit!==null)throw new j("effect:type-error",`Expected <double>, Actual: ${G6(e)}`,{term:e})}function vWe(e){if(e.type!=="quantity"||e.unit!==null&&e.unit!=="%")throw new j("effect:type-error",`Expected <double> or <percentage>, Actual: ${G6(e)}`,{term:e})}hce=function(){function e(s,n){function o(){this.constructor=s}o.prototype=n.prototype,s.prototype=new o}function t(s,n,o,a){var l=Error.call(this,s);return Object.setPrototypeOf&&Object.setPrototypeOf(l,t.prototype),l.expected=n,l.found=o,l.location=a,l.name="SyntaxError",l}function r(s,n,o){return o=o||" ",s.length>n?s:(n-=s.length,s+(o+=o.repeat(n)).slice(0,n))}function i(s,n){var o,a={},l=(n=n!==void 0?n:{}).grammarSource,c={start:One},h=One,p="none",f=")",m=",",g="(",v="%",w="px",_="cm",T="mm",x="in",E="pt",C="pc",A="deg",P="rad",I="grad",L="turn",k="#",G=".",z="e",X=/^[ \t\n\r]/,Z=/^[a-z\-]/,ce=/^[0-9a-fA-F]/,ne=/^[+\-]/,D=/^[0-9]/,N=Kd("none"),V=Vn("none",!1),B=Vn(")",!1),W=Vn(",",!1),Y=Kd("whitespace"),H=ab([" ","	",`
`,"\r"],!1,!1),ee=Kd("function"),me=Vn("(",!1),be=Kd("identifier"),De=ab([["a","z"],"-"],!1,!1),ve=Kd("percentage"),ge=Vn("%",!1),Ee=Kd("length"),Fe=Vn("px",!1),Nr=Vn("cm",!1),Br=Vn("mm",!1),ur=Vn("in",!1),Gr=Vn("pt",!1),pr=Vn("pc",!1),jr=Kd("angle"),Qi=Vn("deg",!1),fs=Vn("rad",!1),st=Vn("grad",!1),Li=Vn("turn",!1),ao=Kd("number"),bl=Kd("color"),Na=Vn("#",!1),Qd=ab([["0","9"],["a","f"],["A","F"]],!1,!1),Jd=ab(["+","-"],!1,!1),Fa=ab([["0","9"]],!1,!1),ib=Vn(".",!1),G8=Vn("e",!1),j8=function(){return[]},kL=function(Q,_e){return{type:"function",name:Q,parameters:_e||[]}},UL=function(Q,_e){return _e.length>0?hNe(Q,_e,3):[Q]},VL=function(Q){return{type:"quantity",value:Q.value,unit:Q.unit}},zL=function(Q){return{type:"color",colorType:Q.type,value:Q.value}},H8=function(Q){return Q},q8=function(){return ob()},W8=function(Q){return{value:Q,unit:"%"}},X8=function(Q){return{value:Q,unit:"px"}},$R=function(Q){return{value:Q,unit:"cm"}},BL=function(Q){return{value:Q,unit:"mm"}},GL=function(Q){return{value:Q,unit:"in"}},jL=function(Q){return{value:Q,unit:"pt"}},Lr=function(Q){return{value:Q,unit:"pc"}},la=function(Q){return{value:Q,unit:"deg"}},Fo=function(Q){return{value:Q,unit:"rad"}},pc=function(Q){return{value:Q,unit:"grad"}},sb=function(Q){return{value:Q,unit:"turn"}},HL=function(Q){return{value:Q,unit:null}},qL=function(){return{type:"hex",value:ob()}},WL=function(Q){return{type:"function",value:Q}},XL=function(){return{type:"named",value:ob()}},Af=function(){return parseFloat(ob())},ue=0,Di=0,aS=[{line:1,column:1}],Rh=0,nb=[],dt=0;if("startRule"in n){if(!(n.startRule in c))throw new Error(`Can't start parsing from rule "`+n.startRule+'".');h=c[n.startRule]}function ob(){return s.substring(Di,ue)}function Vn(Q,_e){return{type:"literal",text:Q,ignoreCase:_e}}function ab(Q,_e,Oe){return{type:"class",parts:Q,inverted:_e,ignoreCase:Oe}}function ZL(){return{type:"end"}}function Kd(Q){return{type:"other",description:Q}}function LR(Q){var _e,Oe=aS[Q];if(Oe)return Oe;for(_e=Q-1;!aS[_e];)_e--;for(Oe={line:(Oe=aS[_e]).line,column:Oe.column};_e<Q;)s.charCodeAt(_e)===10?(Oe.line++,Oe.column=1):Oe.column++,_e++;return aS[Q]=Oe,Oe}function YL(Q,_e){var Oe=LR(Q),br=LR(_e);return{source:l,start:{offset:Q,line:Oe.line,column:Oe.column},end:{offset:_e,line:br.line,column:br.column}}}function tr(Q){ue<Rh||(ue>Rh&&(Rh=ue,nb=[]),nb.push(Q))}function eNe(Q,_e,Oe){return new t(t.buildMessage(Q,_e),Q,_e,Oe)}function One(){var Q;return(Q=tNe())===a&&(Q=rNe()),Q}function tNe(){var Q,_e;return dt++,Q=ue,ko(),s.substr(ue,4)===p?(_e=p,ue+=4):(_e=a,dt===0&&tr(V)),_e!==a?(ko(),Di=Q,Q=j8()):(ue=Q,Q=a),dt--,Q===a&&dt===0&&tr(N),Q}function rNe(){var Q,_e;if(Q=[],(_e=Z8())!==a)for(;_e!==a;)Q.push(_e),_e=Z8();else Q=a;return Q}function Z8(){var Q,_e,Oe,br;return Q=ue,ko(),(_e=sNe())!==a?(ko(),(Oe=iNe())===a&&(Oe=null),ko(),s.charCodeAt(ue)===41?(br=f,ue++):(br=a,dt===0&&tr(B)),br!==a?(ko(),Di=Q,Q=kL(_e,Oe)):(ue=Q,Q=a)):(ue=Q,Q=a),Q}function iNe(){var Q,_e,Oe,br,ca,Fs,Mh,QL;if(Q=ue,(_e=Y8())!==a){for(Oe=[],br=ue,ca=ko(),s.charCodeAt(ue)===44?(Fs=m,ue++):(Fs=a,dt===0&&tr(W)),Fs===a&&(Fs=null),Mh=ko(),(QL=Y8())!==a?br=ca=[ca,Fs,Mh,QL]:(ue=br,br=a);br!==a;)Oe.push(br),br=ue,ca=ko(),s.charCodeAt(ue)===44?(Fs=m,ue++):(Fs=a,dt===0&&tr(W)),Fs===a&&(Fs=null),Mh=ko(),(QL=Y8())!==a?br=ca=[ca,Fs,Mh,QL]:(ue=br,br=a);Di=Q,Q=UL(_e,Oe)}else ue=Q,Q=a;return Q}function Y8(){var Q,_e;return Q=ue,(_e=nNe())===a&&(_e=oNe())===a&&(_e=aNe())===a&&(_e=lNe()),_e!==a&&(Di=Q,_e=VL(_e)),(Q=_e)===a&&(Q=ue,(_e=cNe())!==a&&(Di=Q,_e=zL(_e)),Q=_e),Q}function ko(){var Q,_e;for(dt++,Q=[],X.test(s.charAt(ue))?(_e=s.charAt(ue),ue++):(_e=a,dt===0&&tr(H));_e!==a;)Q.push(_e),X.test(s.charAt(ue))?(_e=s.charAt(ue),ue++):(_e=a,dt===0&&tr(H));return dt--,_e=a,dt===0&&tr(Y),Q}function sNe(){var Q,_e,Oe;return dt++,Q=ue,(_e=Mne())!==a?(s.charCodeAt(ue)===40?(Oe=g,ue++):(Oe=a,dt===0&&tr(me)),Oe!==a?(Di=Q,Q=H8(_e)):(ue=Q,Q=a)):(ue=Q,Q=a),dt--,Q===a&&(_e=a,dt===0&&tr(ee)),Q}function Mne(){var Q,_e,Oe;if(dt++,Q=ue,_e=[],Z.test(s.charAt(ue))?(Oe=s.charAt(ue),ue++):(Oe=a,dt===0&&tr(De)),Oe!==a)for(;Oe!==a;)_e.push(Oe),Z.test(s.charAt(ue))?(Oe=s.charAt(ue),ue++):(Oe=a,dt===0&&tr(De));else _e=a;return _e!==a&&(Di=Q,_e=q8()),dt--,(Q=_e)===a&&(_e=a,dt===0&&tr(be)),Q}function nNe(){var Q,_e,Oe;return dt++,Q=ue,ko(),(_e=Oh())!==a?(s.charCodeAt(ue)===37?(Oe=v,ue++):(Oe=a,dt===0&&tr(ge)),Oe!==a?(Di=Q,Q=W8(_e)):(ue=Q,Q=a)):(ue=Q,Q=a),dt--,Q===a&&dt===0&&tr(ve),Q}function oNe(){var Q,_e,Oe;return dt++,Q=ue,ko(),(_e=Oh())!==a?(s.substr(ue,2)===w?(Oe=w,ue+=2):(Oe=a,dt===0&&tr(Fe)),Oe!==a?(Di=Q,Q=X8(_e)):(ue=Q,Q=a)):(ue=Q,Q=a),Q===a&&(Q=ue,ko(),(_e=Oh())!==a?(s.substr(ue,2)===_?(Oe=_,ue+=2):(Oe=a,dt===0&&tr(Nr)),Oe!==a?(Di=Q,Q=$R(_e)):(ue=Q,Q=a)):(ue=Q,Q=a),Q===a&&(Q=ue,ko(),(_e=Oh())!==a?(s.substr(ue,2)===T?(Oe=T,ue+=2):(Oe=a,dt===0&&tr(Br)),Oe!==a?(Di=Q,Q=BL(_e)):(ue=Q,Q=a)):(ue=Q,Q=a),Q===a&&(Q=ue,ko(),(_e=Oh())!==a?(s.substr(ue,2)===x?(Oe=x,ue+=2):(Oe=a,dt===0&&tr(ur)),Oe!==a?(Di=Q,Q=GL(_e)):(ue=Q,Q=a)):(ue=Q,Q=a),Q===a&&(Q=ue,ko(),(_e=Oh())!==a?(s.substr(ue,2)===E?(Oe=E,ue+=2):(Oe=a,dt===0&&tr(Gr)),Oe!==a?(Di=Q,Q=jL(_e)):(ue=Q,Q=a)):(ue=Q,Q=a),Q===a&&(Q=ue,ko(),(_e=Oh())!==a?(s.substr(ue,2)===C?(Oe=C,ue+=2):(Oe=a,dt===0&&tr(pr)),Oe!==a?(Di=Q,Q=Lr(_e)):(ue=Q,Q=a)):(ue=Q,Q=a)))))),dt--,Q===a&&dt===0&&tr(Ee),Q}function aNe(){var Q,_e,Oe;return dt++,Q=ue,(_e=Oh())!==a?(s.substr(ue,3)===A?(Oe=A,ue+=3):(Oe=a,dt===0&&tr(Qi)),Oe!==a?(Di=Q,Q=la(_e)):(ue=Q,Q=a)):(ue=Q,Q=a),Q===a&&(Q=ue,(_e=Oh())!==a?(s.substr(ue,3)===P?(Oe=P,ue+=3):(Oe=a,dt===0&&tr(fs)),Oe!==a?(Di=Q,Q=Fo(_e)):(ue=Q,Q=a)):(ue=Q,Q=a),Q===a&&(Q=ue,(_e=Oh())!==a?(s.substr(ue,4)===I?(Oe=I,ue+=4):(Oe=a,dt===0&&tr(st)),Oe!==a?(Di=Q,Q=pc(_e)):(ue=Q,Q=a)):(ue=Q,Q=a),Q===a&&(Q=ue,(_e=Oh())!==a?(s.substr(ue,4)===L?(Oe=L,ue+=4):(Oe=a,dt===0&&tr(Li)),Oe!==a?(Di=Q,Q=sb(_e)):(ue=Q,Q=a)):(ue=Q,Q=a)))),dt--,Q===a&&(_e=a,dt===0&&tr(jr)),Q}function lNe(){var Q,_e;return dt++,Q=ue,ko(),(_e=Oh())!==a?(Di=Q,Q=HL(_e)):(ue=Q,Q=a),dt--,Q===a&&dt===0&&tr(ao),Q}function cNe(){var Q,_e,Oe,br;if(dt++,Q=ue,s.charCodeAt(ue)===35?(_e=k,ue++):(_e=a,dt===0&&tr(Na)),_e!==a){if(Oe=[],ce.test(s.charAt(ue))?(br=s.charAt(ue),ue++):(br=a,dt===0&&tr(Qd)),br!==a)for(;br!==a;)Oe.push(br),ce.test(s.charAt(ue))?(br=s.charAt(ue),ue++):(br=a,dt===0&&tr(Qd));else Oe=a;Oe!==a?(Di=Q,Q=qL()):(ue=Q,Q=a)}else ue=Q,Q=a;return Q===a&&(Q=ue,(_e=Z8())!==a&&(Di=Q,_e=WL(_e)),(Q=_e)===a&&(Q=ue,(_e=Mne())!==a&&(Di=Q,_e=XL()),Q=_e)),dt--,Q===a&&(_e=a,dt===0&&tr(bl)),Q}function Oh(){var Q,_e,Oe,br,ca,Fs,Mh;for(Q=ue,ne.test(s.charAt(ue))?(s.charAt(ue),ue++):dt===0&&tr(Jd),_e=ue,Oe=[],D.test(s.charAt(ue))?(br=s.charAt(ue),ue++):(br=a,dt===0&&tr(Fa));br!==a;)Oe.push(br),D.test(s.charAt(ue))?(br=s.charAt(ue),ue++):(br=a,dt===0&&tr(Fa));if(s.charCodeAt(ue)===46?(br=G,ue++):(br=a,dt===0&&tr(ib)),br!==a){if(ca=[],D.test(s.charAt(ue))?(Fs=s.charAt(ue),ue++):(Fs=a,dt===0&&tr(Fa)),Fs!==a)for(;Fs!==a;)ca.push(Fs),D.test(s.charAt(ue))?(Fs=s.charAt(ue),ue++):(Fs=a,dt===0&&tr(Fa));else ca=a;ca!==a?_e=Oe=[Oe,br,ca]:(ue=_e,_e=a)}else ue=_e,_e=a;if(_e===a)if(_e=[],D.test(s.charAt(ue))?(Oe=s.charAt(ue),ue++):(Oe=a,dt===0&&tr(Fa)),Oe!==a)for(;Oe!==a;)_e.push(Oe),D.test(s.charAt(ue))?(Oe=s.charAt(ue),ue++):(Oe=a,dt===0&&tr(Fa));else _e=a;if(_e!==a){if(Oe=ue,s.charCodeAt(ue)===101?(br=z,ue++):(br=a,dt===0&&tr(G8)),br!==a){if(ne.test(s.charAt(ue))?(ca=s.charAt(ue),ue++):(ca=a,dt===0&&tr(Jd)),ca===a&&(ca=null),Fs=[],D.test(s.charAt(ue))?(Mh=s.charAt(ue),ue++):(Mh=a,dt===0&&tr(Fa)),Mh!==a)for(;Mh!==a;)Fs.push(Mh),D.test(s.charAt(ue))?(Mh=s.charAt(ue),ue++):(Mh=a,dt===0&&tr(Fa));else Fs=a;Fs!==a?Oe=br=[br,ca,Fs]:(ue=Oe,Oe=a)}else ue=Oe,Oe=a;Oe===a&&(Oe=null),Di=Q,Q=Af()}else ue=Q,Q=a;return Q}function uNe(Q,_e){return Q.map(function(Oe){return Oe[_e]})}function hNe(Q,_e,Oe){return[Q].concat(uNe(_e,Oe))}if((o=h())!==a&&ue===s.length)return o;throw o!==a&&ue<s.length&&tr(ZL()),eNe(nb,Rh<s.length?s.charAt(Rh):null,Rh<s.length?YL(Rh,Rh+1):YL(Rh,Rh))}return e(t,Error),t.prototype.format=function(s){var n="Error: "+this.message;if(this.location){var o,a=null;for(o=0;o<s.length;o++)if(s[o].source===this.location.source){a=s[o].text.split(/\r\n|\n|\r/g);break}var l=this.location.start,c=this.location.source+":"+l.line+":"+l.column;if(a){var h=this.location.end,p=r("",l.line.toString().length),f=a[l.line-1],m=l.line===h.line?h.column:f.length+1;n+=`
 --> `+c+`
`+p+` |
`+l.line+" | "+f+`
`+p+" | "+r("",l.column-1)+r("",m-l.column,"^")}else n+=`
 at `+c}return n},t.buildMessage=function(s,n){var o={literal:function(m){return'"'+l(m.text)+'"'},class:function(m){var g=m.parts.map(function(v){return Array.isArray(v)?c(v[0])+"-"+c(v[1]):c(v)});return"["+(m.inverted?"^":"")+g+"]"},any:function(){return"any character"},end:function(){return"end of input"},other:function(m){return m.description}};function a(m){return m.charCodeAt(0).toString(16).toUpperCase()}function l(m){return m.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(g){return"\\x0"+a(g)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(g){return"\\x"+a(g)})}function c(m){return m.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(g){return"\\x0"+a(g)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(g){return"\\x"+a(g)})}function h(m){return o[m.type](m)}function p(m){var g,v,w=m.map(h);if(w.sort(),w.length>0){for(g=1,v=1;g<w.length;g++)w[g-1]!==w[g]&&(w[v]=w[g],v++);w.length=v}switch(w.length){case 1:return w[0];case 2:return w[0]+" or "+w[1];default:return w.slice(0,-1).join(", ")+", or "+w[w.length-1]}}function f(m){return m?'"'+l(m)+'"':"end of input"}return"Expected "+p(s)+" but "+f(n)+" found."},{SyntaxError:t,parse:i}},(uce=O2e).exports&&(uce.exports=hce());const Bte={deg:1,grad:.9,rad:180/Math.PI,turn:360};function _We(e){if(e.type!=="quantity"||!(e.value===0&&e.unit===null||e.unit&&Bte[e.unit]!=null))throw new j("effect:type-error",`Expected <angle>, Actual: ${G6(e)}`,{term:e})}const Gte={px:1,cm:96/2.54,mm:96/2.54/10,in:96,pc:16,pt:96/72};function bWe(e){if(e.type!=="quantity"||!(e.value===0&&e.unit===null||e.unit&&Gte[e.unit]!=null))throw new j("effect:type-error",`Expected <length>, Actual: ${G6(e)}`,{term:e})}function Vp(e){vWe(e);const t=e.value;return tL(t,e),e.unit==="%"?.01*t:t}function wWe(e){return yWe(e),tL(e.value,e),e.value}function xWe(e){return _We(e),e.value*Bte[e.unit]||0}function jte(e){return bWe(e),e.value*Gte[e.unit]||0}function TWe(e){switch(e.colorType){case"hex":return kVe(e.value);case"named":return M2e(e.value);case"function":return CWe(e.value)}}function M2e(e){if(!Pbe(e))throw new j("effect:unknown-color",`color '${e}' isn't valid`,{namedColor:e});return FVe(e)}const SWe=/^rgba?/i,EWe=/^hsla?/i;function CWe(e){if(mR(e.parameters,4),SWe.test(e.name))return[Vp(e.parameters[0]),Vp(e.parameters[1]),Vp(e.parameters[2]),e.parameters[3]?Vp(e.parameters[3]):1];if(EWe.test(e.name))return Ibe(wWe(e.parameters[0]),Vp(e.parameters[1]),Vp(e.parameters[2]),e.parameters[3]?Vp(e.parameters[3]):1);throw new j("effect:syntax-error",`Invalid color function '${e.name}'`,{colorFunction:e})}function Hte(e,t,r){var i;try{return RWe(e)}catch(s){(i=r==null?void 0:r.messages)==null||i.push(s)}return null}function qte(e,t,r,i){try{const s=AWe(e);ru(r,s,t)}catch(s){i.messages&&i.messages.push(s)}}function AWe(e){const t=zte(e);return t?cWe(t)?t.map(r=>r.toJSON()):t.map(({scale:r,effects:i})=>({scale:r,value:i.map(s=>s.toJSON())})):null}function RWe(e){if(!e||e.length===0)return null;if(OWe(e)){const t=[];for(const r of e)t.push({scale:r.scale,value:sV(r.value)});return t}return sV(e)}function OWe(e){const t=e[0];return!!t&&"scale"in t}function sV(e){if(!e||!e.length)return"";const t=[];for(const r of e){let i=[];switch(r.type){case"grayscale":case"sepia":case"saturate":case"invert":case"brightness":case"contrast":case"opacity":i=[Ag(r,"amount")];break;case"blur":i=[Ag(r,"radius","pt")];break;case"hue-rotate":i=[Ag(r,"angle","deg")];break;case"drop-shadow":i=[Ag(r,"xoffset","pt"),Ag(r,"yoffset","pt"),Ag(r,"blurRadius","pt"),MWe(r,"color")];break;case"bloom":i=[Ag(r,"strength"),Ag(r,"radius","pt"),Ag(r,"threshold")]}const s=`${r.type}(${i.filter(Boolean).join(" ")})`;zte(s),t.push(s)}return t.join(" ")}function Ag(e,t,r){if(e[t]==null)throw new j("effect:missing-parameter",`Missing parameter '${t}' in ${e.type} effect`,{effect:e});return r?e[t]+r:""+e[t]}function MWe(e,t){if(e[t]==null)throw new j("effect:missing-parameter",`Missing parameter '${t}' in ${e.type} effect`,{effect:e});const r=e[t];return`rgba(${r[0]||0}, ${r[1]||0}, ${r[2]||0}, ${r[3]/255||0})`}const p5=-3;var Ay;(function(e){e[e.ALL=0]="ALL",e[e.SOME=1]="SOME"})(Ay||(Ay={}));class PWe{constructor(t,r,i){this._namespace=t,this._storage=r,this._removeFunc=!1,this._hit=0,this._miss=0,this._storage.register(this),this._namespace+=":",i&&(this._storage.registerRemoveFunc(this._namespace,i),this._removeFunc=!0)}destroy(){this._storage.clear(this._namespace),this._removeFunc&&this._storage.deregisterRemoveFunc(this._namespace),this._storage.deregister(this),this._storage=null}get namespace(){return this._namespace.slice(0,-1)}get hitRate(){return this._hit/(this._hit+this._miss)}get size(){return this._storage.size}get maxSize(){return this._storage.maxSize}resetHitRate(){this._hit=this._miss=0}put(t,r,i,s=0){this._storage.put(this._namespace+t,r,i,s)}get(t){const r=this._storage.get(this._namespace+t);return r===void 0?++this._miss:++this._hit,r}pop(t){const r=this._storage.pop(this._namespace+t);return r===void 0?++this._miss:++this._hit,r}updateSize(t,r,i){this._storage.updateSize(this._namespace+t,r,i)}clear(){this._storage.clear(this._namespace)}clearAll(){this._storage.clearAll()}getStats(){return this._storage.getStats()}resetStats(){this._storage.resetStats()}}class Wte{constructor(t=10485760){this._maxSize=t,this._db=new Map,this._size=0,this._hit=0,this._miss=0,this._removeFuncs=new Xt,this._users=new Xt}destroy(){this.clearAll(),this._removeFuncs.clear(),this._users.clear(),this._db=null}register(t){this._users.push(t)}deregister(t){this._users.removeUnordered(t)}registerRemoveFunc(t,r){this._removeFuncs.push([t,r])}deregisterRemoveFunc(t){this._removeFuncs.filterInPlace(r=>r[0]!==t)}get size(){return this._size}get maxSize(){return this._maxSize}set maxSize(t){this._maxSize=Math.max(t,0),this._checkSizeLimit()}put(t,r,i,s){const n=this._db.get(t);if(n&&(this._size-=n.size,this._db.delete(t),n.entry!==r&&this._notifyRemove(t,n.entry,Ay.ALL)),i>this._maxSize)return void this._notifyRemove(t,r,Ay.ALL);if(r===void 0)return void console.warn("Refusing to cache undefined entry ");if(!i||i<0)return void console.warn("Refusing to cache entry with invalid size "+i);const o=1+Math.max(s,p5)-p5;this._db.set(t,{entry:r,size:i,lifetime:o,lives:o}),this._size+=i,this._checkSizeLimit()}updateSize(t,r,i){const s=this._db.get(t);if(s&&s.entry===r){for(this._size-=s.size;i>this._maxSize;){const n=this._notifyRemove(t,r,Ay.SOME);if(!(b(n)&&n>0))return void this._db.delete(t);i=n}s.size=i,this._size+=i,this._checkSizeLimit()}}pop(t){const r=this._db.get(t);if(r)return this._size-=r.size,this._db.delete(t),++this._hit,r.entry;++this._miss}get(t){const r=this._db.get(t);if(r!==void 0)return this._db.delete(t),r.lives=r.lifetime,this._db.set(t,r),++this._hit,r.entry;++this._miss}getStats(){const t={Size:Math.round(this._size/1048576)+"/"+Math.round(this._maxSize/1048576)+"MB","Hit rate":Math.round(100*this._getHitRate())+"%",Entries:this._db.size.toString()},r={},i=new Array;this._db.forEach((o,a)=>{const l=o.lifetime;i[l]=(i[l]||0)+o.size,this._users.forAll(c=>{const h=c.namespace;if(a.startsWith(h)){const p=r[h]||0;r[h]=p+o.size}})});const s={};this._users.forAll(o=>{const a=o.namespace;if(!isNaN(o.hitRate)&&o.hitRate>0){const l=r[a]||0;r[a]=l,s[a]=Math.round(100*o.hitRate)+"%"}else s[a]="0%"});const n=Object.keys(r);n.sort((o,a)=>r[a]-r[o]),n.forEach(o=>t[o]=Math.round(r[o]/2**20)+"MB / "+s[o]);for(let o=i.length-1;o>=0;--o){const a=i[o];a&&(t["Priority "+(o+p5-1)]=Math.round(a/this.size*100)+"%")}return t}resetStats(){this._hit=this._miss=0,this._users.forAll(t=>t.resetHitRate())}clear(t){this._db.forEach((r,i)=>{i.startsWith(t)&&(this._size-=r.size,this._db.delete(i),this._notifyRemove(i,r.entry,Ay.ALL))})}clearAll(){this._db.forEach((t,r)=>this._notifyRemove(r,t.entry,Ay.ALL)),this._size=0,this._db.clear()}_getHitRate(){return this._hit/(this._hit+this._miss)}_notifyRemove(t,r,i){let s;return this._removeFuncs.some(n=>{if(t.startsWith(n[0])){const o=n[1](r,i);return typeof o=="number"&&(s=o),!0}return!1}),s}_checkSizeLimit(){if(!(this._size<=this._maxSize))for(const[t,r]of this._db){if(this._db.delete(t),r.lives<=1){this._size-=r.size;const i=this._notifyRemove(t,r.entry,Ay.SOME);b(i)&&i>0&&(this._size+=i,r.lives=r.lifetime,r.size=i,this._db.set(t,r))}else--r.lives,this._db.set(t,r);if(this._size<=.9*this.maxSize)return}}}class IWe{constructor(t,r){this._storage=new Wte,this._storage.maxSize=t,r&&this._storage.registerRemoveFunc("",r)}put(t,r){this._storage.put(t,r,1,1)}pop(t){return this._storage.pop(t)}get(t){return this._storage.get(t)}clear(){this._storage.clearAll()}destroy(){this._storage.destroy()}}function $We(e){return typeof e=="function"}function N$t(e,t,r,i){return $We(e)?e(t,r,i):e}function F$t(e){return[e.r,e.g,e.b,e.a]}function k$t(e,t,r){const i=` /-,
`,s=l=>{let c=l.length;for(;c--;)if(!i.includes(l.charAt(c)))return!1;return!0},n=[];let o=0,a=-1;do if(a=t.indexOf("[",o),a>=o){if(a>o){const l=t.substr(o,a-o);n.push([l,null,s(l)])}if(o=a+1,a=t.indexOf("]",o),a>=o){if(a>o){const l=e[t.substr(o,a-o)];l&&n.push([null,l,!1])}o=a+1}}while(a!==-1);if(o<t.length-1){const l=t.substr(o);n.push([l,null,s(l)])}return l=>{let c="",h=null;for(const p of n){const[f,m,g]=p;if(f)g?h=f:(h&&(c+=h,h=null),c+=f);else{const v=l.attributes[m];v&&(h&&(c+=h,h=null),c+=v)}}return LWe(c,r)}}function LWe(e,t){switch(typeof e!="string"&&(e=String(e)),t){case"LowerCase":return e.toLowerCase();case"Allcaps":return e.toUpperCase();default:return e}}function U$t(e,t,r,i,s,n,o=!0){const a=t/s,l=r/n,c=Math.ceil(a/2),h=Math.ceil(l/2);for(let p=0;p<n;p++)for(let f=0;f<s;f++){const m=4*(f+(o?n-p-1:p)*s);let g=0,v=0,w=0,_=0,T=0,x=0,E=0;const C=(p+.5)*l;for(let A=Math.floor(p*l);A<(p+1)*l;A++){const P=Math.abs(C-(A+.5))/h,I=(f+.5)*a,L=P*P;for(let k=Math.floor(f*a);k<(f+1)*a;k++){let G=Math.abs(I-(k+.5))/c;const z=Math.sqrt(L+G*G);z>=-1&&z<=1&&(g=2*z*z*z-3*z*z+1,g>0&&(G=4*(k+A*t),E+=g*e[G+3],w+=g,e[G+3]<255&&(g=g*e[G+3]/250),_+=g*e[G],T+=g*e[G+1],x+=g*e[G+2],v+=g))}}i[m]=_/v,i[m+1]=T/v,i[m+2]=x/v,i[m+3]=E/w}}function DWe(e){return e?{r:e[0],g:e[1],b:e[2],a:e[3]/255}:{r:0,g:0,b:0,a:0}}function j6(e){var t;return(t=e.data)==null?void 0:t.symbol}function nV(e){return e.type==="CIMVectorMarker"||e.type==="CIMPictureMarker"||e.type==="CIMBarChartMarker"||e.type==="CIMCharacterMarker"||e.type==="CIMPieChartMarker"||e.type==="CIMStackedBarChartMarker"}function oV(e){return e.type==="CIMGradientStroke"||e.type==="CIMPictureStroke"||e.type==="CIMSolidStroke"}function P2e(e){return e.type==="CIMGradientFill"||e.type==="CIMHatchFill"||e.type==="CIMPictureFill"||e.type==="CIMSolidFill"||e.type==="CIMWaterFill"}function aV(e){return e.type==="CIMMarkerPlacementAlongLineRandomSize"||e.type==="CIMMarkerPlacementAlongLineSameSize"||e.type==="CIMMarkerPlacementAlongLineVariableSize"||e.type==="CIMMarkerPlacementAtExtremities"||e.type==="CIMMarkerPlacementAtMeasuredUnits"||e.type==="CIMMarkerPlacementAtRatioPositions"||e.type==="CIMMarkerPlacementOnLine"||e.type==="CIMMarkerPlacementOnVertices"}const V$t=e=>isNaN(e)||!e?0:e,z$t=e=>{if(!e)return!1;for(const t of e)switch(t.type){case"CIMGeometricEffectBuffer":case"CIMGeometricEffectOffset":return!0}return!1};function B$t(){return ie(()=>import("./geometryEngineJSON.ba1441a3.js"),["geometryEngineJSON.ba1441a3.js","geometryEngineBase.0f0d7ecf.js","geometryEngineJSON.5a1f200e.js","json.8bd707cf.js"],import.meta.url)}function NWe(e){const t=j6(e);if(t.type==="CIMTextSymbol")return t.height;let r=0;if(t.symbolLayers)for(const i of t.symbolLayers)nV(i)&&i.size>r?r=i.size:oV(i)&&i.width>r?r=i.width:P2e(i);return r}function G$t(e,t,r){const i=j6(e),s=NWe(e);if(s===0)return void FWe(i,t);Xte(i,t/s,!1,r)}function FWe(e,t){if(e.type!=="CIMTextSymbol"){if(e.symbolLayers)for(const r of e.symbolLayers)switch(r.type){case"CIMPictureMarker":case"CIMVectorMarker":r.size=t;break;case"CIMPictureStroke":case"CIMSolidStroke":r.width=t}}else e.height=t}function Xte(e,t,r,i){if(e.type!=="CIMTextSymbol"){if(r&&e.effects)for(const s of e.effects)VWe(s,t);if(e.symbolLayers)for(const s of e.symbolLayers)switch(s.type){case"CIMPictureMarker":case"CIMVectorMarker":kWe(s,t,i);break;case"CIMPictureStroke":case"CIMSolidStroke":!(i!=null&&i.preserveOutlineWidth)&&s.width&&(s.width*=t);break;case"CIMPictureFill":s.height&&(s.height*=t),s.offsetX&&(s.offsetX*=t),s.offsetY&&(s.offsetY*=t);break;case"CIMHatchFill":Xte(s.lineSymbol,t,!0,{...i,preserveOutlineWidth:!1}),s.offsetX&&(s.offsetX*=t),s.offsetY&&(s.offsetY*=t),s.separation&&(s.separation*=t)}}else e.height*=t}function kWe(e,t,r){if(e.markerPlacement&&UWe(e.markerPlacement,t),e.offsetX&&(e.offsetX*=t),e.offsetY&&(e.offsetY*=t),e.anchorPoint&&e.anchorPointUnits==="Absolute"&&(e.anchorPoint={x:e.anchorPoint.x*t,y:e.anchorPoint.y*t}),e.size*=t,e.type==="CIMVectorMarker"&&e.markerGraphics)for(const i of e.markerGraphics)e.scaleSymbolsProportionally||Xte(i.symbol,t,!0,r)}function UWe(e,t){switch(aV(e)&&e.offset&&(e.offset*=t),e.type){case"CIMMarkerPlacementAlongLineRandomSize":case"CIMMarkerPlacementAlongLineSameSize":if(e.customEndingOffset&&(e.customEndingOffset*=t),e.offsetAlongLine&&(e.offsetAlongLine*=t),e.placementTemplate&&e.placementTemplate.length){const r=e.placementTemplate.map(i=>i*t);e.placementTemplate=r}break;case"CIMMarkerPlacementAlongLineVariableSize":if(e.maxRandomOffset&&(e.maxRandomOffset*=t),e.placementTemplate&&e.placementTemplate.length){const r=e.placementTemplate.map(i=>i*t);e.placementTemplate=r}break;case"CIMMarkerPlacementOnLine":e.startPointOffset&&(e.startPointOffset*=t);break;case"CIMMarkerPlacementAtExtremities":e.offsetAlongLine&&(e.offsetAlongLine*=t);break;case"CIMMarkerPlacementAtMeasuredUnits":case"CIMMarkerPlacementOnVertices":break;case"CIMMarkerPlacementAtRatioPositions":e.beginPosition&&(e.beginPosition*=t),e.endPosition&&(e.endPosition*=t);break;case"CIMMarkerPlacementPolygonCenter":e.offsetX&&(e.offsetX*=t),e.offsetY&&(e.offsetY*=t);break;case"CIMMarkerPlacementInsidePolygon":e.offsetX&&(e.offsetX*=t),e.offsetY&&(e.offsetY*=t),e.stepX&&(e.stepX*=t),e.stepY&&(e.stepY*=t)}}function VWe(e,t){switch(e.type){case"CIMGeometricEffectArrow":case"CIMGeometricEffectDonut":e.width&&(e.width*=t);break;case"CIMGeometricEffectBuffer":e.size&&(e.size*=t);break;case"CIMGeometricEffectCut":e.beginCut&&(e.beginCut*=t),e.endCut&&(e.endCut*=t),e.middleCut&&(e.middleCut*=t);break;case"CIMGeometricEffectDashes":if(e.customEndingOffset&&(e.customEndingOffset*=t),e.offsetAlongLine&&(e.offsetAlongLine*=t),e.dashTemplate&&e.dashTemplate.length){const r=e.dashTemplate.map(i=>i*t);e.dashTemplate=r}break;case"CIMGeometricEffectExtension":case"CIMGeometricEffectJog":case"CIMGeometricEffectRadial":e.length&&(e.length*=t);break;case"CIMGeometricEffectMove":e.offsetX&&(e.offsetX*=t),e.offsetY&&(e.offsetY*=t);break;case"CIMGeometricEffectOffset":case"CIMGeometricEffectOffsetTangent":e.offset&&(e.offset*=t);break;case"CIMGeometricEffectRegularPolygon":e.radius&&(e.radius*=t);break;case"CIMGeometricEffectTaperedPolygon":e.fromWidth&&(e.fromWidth*=t),e.length&&(e.length*=t),e.toWidth&&(e.toWidth*=t);break;case"CIMGeometricEffectWave":e.amplitude&&(e.amplitude*=t),e.period&&(e.period*=t)}}function zWe(e){const t=[];return KX(j6(e),t),t.length?new Me(DWe(t[0])):null}function KX(e,t){let r;r=e.type==="CIMTextSymbol"?e.symbol:e;const i=e.type==="CIMPolygonSymbol";if(r.symbolLayers){for(const s of r.symbolLayers)if(!(s.colorLocked||i&&(oV(s)||nV(s)&&s.markerPlacement&&aV(s.markerPlacement))))switch(s.type){case"CIMPictureMarker":case"CIMPictureStroke":case"CIMPictureFill":s.tintColor&&pce(t,s.tintColor);break;case"CIMVectorMarker":s.markerGraphics.forEach(n=>{KX(n.symbol,t)});break;case"CIMSolidStroke":case"CIMSolidFill":pce(t,s.color);break;case"CIMHatchFill":KX(s.lineSymbol,t)}}}function pce(e,t){for(const r of e)if(r.join(".")===t.join("."))return;e.push(t)}function I2e(e,t,r){t instanceof Me||(t=new Me(t));const i=j6(e);i&&eZ(i,t,r)}function eZ(e,t,r){let i;i=e.type==="CIMTextSymbol"?e.symbol:e;const s=i.type==="CIMPolygonSymbol";if(i.symbolLayers)for(const n of i.symbolLayers){if(n.colorLocked)continue;if(s){if(r){const{layersToColor:a}=r;if((oV(n)||nV(n)&&n.markerPlacement&&aV(n.markerPlacement))&&a==="fill"||P2e(n)&&a==="outline")continue}else if(oV(n)||nV(n)&&n.markerPlacement&&aV(n.markerPlacement))continue}const o=t.toArray();switch(n.type){case"CIMPictureMarker":case"CIMPictureStroke":case"CIMPictureFill":n.tintColor=o;break;case"CIMVectorMarker":n.markerGraphics.forEach(a=>{eZ(a.symbol,t,r)});break;case"CIMSolidStroke":case"CIMSolidFill":n.color=o;break;case"CIMHatchFill":eZ(n.lineSymbol,t,r)}}}const $2e="picture-fill",L2e="simple-fill",BWe="simple-line",D2e="simple-marker",GWe="text",jWe="cim",hG=new IWe(1e3);function HWe(e){const t=e.style;let r=null;if(e)switch(e.type){case D2e:t!=="cross"&&t!=="x"&&(r=e.color);break;case L2e:t==="solid"?r=e.color:t!=="none"&&(r={type:"pattern",x:0,y:0,src:wr(`esri/symbols/patterns/${t}.png`),width:5,height:5});break;case $2e:r={type:"pattern",src:e.url,width:yr(e.width)*e.xscale,height:yr(e.height)*e.yscale,x:yr(e.xoffset),y:yr(e.yoffset)};break;case GWe:r=e.color;break;case jWe:r=zWe(e)}return r}function qWe(e,t){const r=e+"-"+t;return hG.get(r)!==void 0?Promise.resolve(hG.get(r)):er(e,{responseType:"image"}).then(i=>{const s=i.data,n=s.naturalWidth,o=s.naturalHeight,a=document.createElement("canvas");a.width=n,a.height=o;const l=a.getContext("2d");l.fillStyle=t,l.fillRect(0,0,n,o),l.globalCompositeOperation="destination-in",l.drawImage(s,0,0);const c=a.toDataURL();return hG.put(r,c),c})}function bI(e){if(!e)return null;let t;switch(e.type){case L2e:case $2e:case D2e:t=bI(e.outline);break;case BWe:{const r=yr(e.width);e.style!=="none"&&r!==0&&(t={color:e.color,style:Zte(e.style),width:r,cap:e.cap,join:e.join==="miter"?yr(e.miterLimit):e.join});break}default:t=null}return t}const Zte=(()=>{const e={};return t=>{if(e[t])return e[t];const r=t.replace(/-/g,"");return e[t]=r,r}})(),WWe=new Me([128,128,128]),fce=/\/resource\/(.*?)\.svg$/,XWe=new Me("white");function ZWe(e){const t=e.symbolLayers&&e.symbolLayers.length;if(!t)return;const r=e.symbolLayers.getItemAt(t-1);return"outline"in r?ki(r,"outline","size"):void 0}function YWe(e){if(!e)return 0;if(tg(e)){const r=ZWe(e);return b(r)?r:0}const t=bI(e);return t&&ac(t.width)||0}function H6(e){if(R(e)||!("symbolLayers"in e)||R(e.symbolLayers))return!1;switch(e.type){case"point-3d":return e.symbolLayers.some(t=>t.type==="object");case"line-3d":return e.symbolLayers.some(t=>t.type==="path");case"polygon-3d":return e.symbolLayers.some(t=>t.type==="object"||t.type==="extrude");default:return!1}}function N2e(e,t){const r=t.resource.href;return!he("esri-canvas-svg-support")&&e.styleOrigin&&fce.test(r)?r.replace(fce,"/resource/png/$1.png"):r}function pS(e,t){if(!e)return null;let r=null;return tg(e)?r=QWe(e):g6(e)&&(r=e.color?new Me(e.color):null),r?wI(r,t):null}function QWe(e){const t=e.symbolLayers;if(!t)return null;let r=null;return t.forEach(i=>{i.type==="object"&&i.resource.href!=null||(r=i.type==="water"?i.color:b(i.material)?i.material.color:null)}),r?new Me(r):null}function wI(e,t){if(t==null)return e;const r=e.toRgba();return r[3]=r[3]*t,new Me(r)}function JWe(e,t,r){const i=e.symbolLayers;if(!i)return;const s=n=>{const o=b(n)?n:null;return wI(t=t||o||r!=null&&XWe,r)};i.forEach(n=>{if(n.type!=="object"||n.resource.href==null||t)if(n.type==="water")n.color=s(n.color);else{const o=b(n.material)?n.material.color:null,a=s(o);R(n.material)?n.material=new uh({color:a}):n.material.color=a,r!=null&&"outline"in n&&b(n.outline)&&b(n.outline.color)&&(n.outline.color=wI(n.outline.color,r))}})}function KWe(e,t,r){(t=t||e.color)&&(e.color=wI(t,r)),r!=null&&"outline"in e&&e.outline&&e.outline.color&&(e.outline.color=wI(e.outline.color,r))}function dG(e,t,r){e&&(t||r!=null)&&(t&&(t=new Me(t)),tg(e)?JWe(e,t,r):g6(e)&&KWe(e,t,r))}async function eXe(e,t){const r=e.symbolLayers;r&&await Xz(r,async i=>tXe(i,t))}async function tXe(e,t){switch(e.type){case"extrude":iXe(e,t);break;case"icon":case"line":case"text":rXe(e,t);break;case"path":nXe(e,t);break;case"object":await sXe(e,t)}}function rXe(e,t){const r=F2e(t);b(r)&&(e.size=r)}function F2e(e){for(const t of e)if(typeof t=="number")return t;return null}function iXe(e,t){e.size=typeof t[2]=="number"?t[2]:0}async function sXe(e,t){const{resourceSize:r,symbolSize:i}=await oXe(e),s=k2e(t,r,i);e.width=K3(t[0],i[0],r[0],s),e.depth=K3(t[1],i[1],r[1],s),e.height=K3(t[2],i[2],r[2],s)}function nXe(e,t){const r=k2e(t,Nm,[e.width,void 0,e.height]);e.width=K3(t[0],e.width,1,r),e.height=K3(t[2],e.height,1,r)}function k2e(e,t,r){for(let i=0;i<3;i++){const s=e[i];switch(s){case"symbol-value":return r[i]!=null?r[i]/t[i]:1;case"proportional":break;default:if(s&&t[i])return s/t[i]}}return 1}async function oXe(e){const t=await ie(()=>import("./symbolLayerUtils.fb49c276.js"),[],import.meta.url),r=await t.computeObjectLayerResourceSize(e,10),{width:i,height:s,depth:n}=e,o=[i,n,s];let a=1;for(let l=0;l<3;l++)if(o[l]!=null){a=o[l]/r[l];break}for(let l=0;l<3;l++)o[l]==null&&(o[l]=r[l]*a);return{resourceSize:r,symbolSize:o}}function K3(e,t,r,i){switch(e){case"proportional":return r*i;case"symbol-value":return t!=null?t:r;default:return e}}function aXe(e,t){const r=F2e(t);if(!R(r))switch(e.type){case"simple-marker":e.size=r;break;case"picture-marker":{const i=e.width/e.height;i>1?(e.width=r,e.height=r*i):(e.width=r*i,e.height=r);break}case"simple-line":e.width=r;break;case"text":e.font.size=r}}async function lXe(e,t){if(e&&t)return tg(e)?eXe(e,t):void(g6(e)&&aXe(e,t))}function cXe(e,t,r){if(e&&t!=null)if(tg(e)){const i=e.symbolLayers;i&&i.forEach(s=>{if(s&&s.type==="object")switch(r){case"tilt":s.tilt=t;break;case"roll":s.roll=t;break;default:s.heading=t}})}else g6(e)&&(e.type!=="simple-marker"&&e.type!=="picture-marker"&&e.type!=="text"||(e.angle=t))}function xI(e){if(!e)return null;const t=e.effects.filter(r=>r.type!=="bloom").map(r=>r.toJSON());return sV(t)}const U2e="<",V2e=">",uXe=i6("short-date");function z2e(e,t,r,i){let s="";t===0?s=`${U2e} `:t===r&&(s=`${V2e} `);let n=null;return n=i?Jm(e,uXe):Zqe(e),s+n}const hXe=["data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAAAAAAAAAHqZRakAAAANUlEQVQ4jWPMy8v7z0BFwMLAwMAwcdIkqhiWn5fHwEQVk5DAqIGjBo4aOGrgqIEQwEjtKgAATl0Hu6JrzFUAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAAAAAAAAAHqZRakAAAANUlEQVQ4jWPMy8v7z0BFwMLAwMAwaeIkqhiWl5/HwEQVk5DAqIGjBo4aOGrgqIEQwEjtKgAATl0Hu6sKxboAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAAAAAAAAAHqZRakAAAANUlEQVQ4jWPMy8v7z0BFwMLAwMAwadJEqhiWl5fPwEQVk5DAqIGjBo4aOGrgqIEQwEjtKgAATl0Hu75+IUcAAAAASUVORK5CYII="];async function tZ(e){if(!("visualVariables"in e)||!e.visualVariables)return null;const t=e.visualVariables.find(o=>o.type==="color");if(!t)return null;let r=null,i=null;if(t.stops){if(t.stops.length===1)return t.stops[0].color;r=t.stops[0].value,i=t.stops[t.stops.length-1].value}const s=r+(i-r)/2,{getColor:n}=await ie(()=>Promise.resolve().then(()=>iS),void 0,import.meta.url);return n(t,s)}async function B2e(e,t){const r=e.trailCap,i=e.trailWidth||1,s=t||await tZ(e)||e.color;return new cu({cap:r,color:s,width:i})}const dXe=new Me([64,64,64]);function G2e(e,t){const r=[],i=e.length-1;return e.length===5?r.push(0,2,4):r.push(0,i),e.map((s,n)=>r.includes(n)?z2e(s,n,i,t):null)}async function rZ(e,t,r){let i=!1,s=[],n=[];if(e.stops){const c=e.stops;s=c.map(h=>h.value),i=c.some(h=>!!h.label),i&&(n=c.map(h=>h.label))}const o=s[0],a=s[s.length-1];if(o==null&&a==null)return null;const l=i?null:G2e(s,r);return(await Promise.all(s.map(async(c,h)=>({value:c,color:e.type==="opacity"?await pXe(c,e,t):(await ie(()=>Promise.resolve().then(()=>iS),void 0,import.meta.url)).getColor(e,c),label:i?n[h]:l[h]})))).reverse()}async function pXe(e,t,r=dXe){const i=new Me(r),s=(await ie(()=>Promise.resolve().then(()=>iS),void 0,import.meta.url)).getOpacity(t,e);return s!=null&&(i.a=s),i}function fXe(e){let t=!1,r=[],i=[];r=e.map(a=>a.value),t=e.some(a=>!!a.label),t&&(i=e.map(a=>a.label));const s=r[0],n=r[r.length-1];if(s==null&&n==null)return null;const o=t?null:G2e(r,!1);return r.map((a,l)=>({value:a,color:j2e(a,e),label:t?i[l]:o[l]})).reverse()}function j2e(e,t){const{startIndex:r,endIndex:i,weight:s}=mXe(e,t);if(r===i)return t[r].color;const n=Me.blendColors(t[r].color,t[i].color,s);return new Me(n)}function mXe(e,t){let r=0,i=t.length-1;return t.some((s,n)=>e<s.value?(i=n,!0):(r=n,!1)),{startIndex:r,endIndex:i,weight:(e-t[r].value)/(t[i].value-t[r].value)}}function gXe(e,t){let r=[];if(e&&e.type==="multipart")e.colorRamps.reverse().forEach((i,s)=>{s===0?r.push({value:t.max,color:new Me(i.toColor),label:"high"}):r.push({value:null,color:new Me(i.toColor),label:""}),s===e.colorRamps.length-1?r.push({value:t.min,color:new Me(i.fromColor),label:"low"}):r.push({value:null,color:new Me(i.fromColor),label:""})});else{let i,s;e&&e.type==="algorithmic"?(i=e.fromColor,s=e.toColor):(i=[0,0,0,1],s=[255,255,255,1]),r=[{value:t.max,color:new Me(s),label:"high"},{value:t.min,color:new Me(i),label:"low"}]}return r}var iZ;let VM=iZ=class extends ye{constructor(e){super(e),this.color=null,this.ratio=null}clone(){return new iZ({color:this.color,ratio:this.ratio})}};u([d({type:Me,json:{type:[Wi],default:null,write:!0}})],VM.prototype,"color",void 0),u([d({type:Number,json:{write:!0}})],VM.prototype,"ratio",void 0),VM=iZ=u([$("esri.renderers.support.HeatmapColorStop")],VM);const eP=VM;function H2e(e){if(!e.colorStops)return[];const t=[...e.colorStops].filter(i=>{var s;return((s=i.color)==null?void 0:s.a)>0});let r=t.length-1;if(t&&t[0]){const i=t[r];i&&i.ratio!==1&&(t.push(new eP({ratio:1,color:i.color})),r++)}return t.map((i,s)=>{var o,a;let n="";return s===0?n=((o=e.legendOptions)==null?void 0:o.minLabel)||"low":s===r&&(n=((a=e.legendOptions)==null?void 0:a.maxLabel)||"high"),{color:i.color,label:n,ratio:i.ratio}}).reverse()}fe.getLogger("esri.renderers.support.utils");function pu(e,t,r){UK(e,t,()=>[]).push(...r)}async function yXe(e){var r,i;const t=new Map;if("visualVariables"in e&&e.visualVariables){const s=e.visualVariables.filter(n=>n.type==="color");for(const n of s){const o=n.field||n.valueExpression,a=(await rZ(n)).map(l=>l.color);pu(t,o,a)}}if(e.type==="heatmap"){const s=H2e(e).map(n=>n.color);pu(t,e.field,s)}else if(e.type==="pie-chart"){for(const s of e.attributes)pu(t,s.field,[s.color]);pu(t,null,[(r=e==null?void 0:e.othersCategory)==null?void 0:r.color,pS(e.backgroundFillSymbol,null)])}else if(e.type==="dot-density"){for(const s of e.attributes)pu(t,s.field,[s.color]);pu(t,null,[e.backgroundColor])}else if(e.type==="unique-value")if(((i=e.authoringInfo)==null?void 0:i.type)==="predominance")for(const s of e.uniqueValueInfos)pu(t,s.value.toString(),[pS(s.symbol,null)]);else{const s=e.uniqueValueInfos.map(c=>pS(c.symbol,null)),{field:n,field2:o,field3:a,valueExpression:l}=e;(n||l)&&pu(t,n||l,s),o&&pu(t,o,s),a&&pu(t,a,s)}else if(e.type==="class-breaks"){const s=e.classBreakInfos.map(n=>pS(n.symbol,null));pu(t,e.field||e.valueExpression,s)}else e.type==="simple"&&pu(t,null,[pS(e.symbol,null)]);return"defaultSymbol"in e&&e.defaultSymbol&&pu(t,null,[pS(e.defaultSymbol,null)]),t.forEach((s,n)=>{const o=N$(s.filter(Boolean),(a,l)=>JSON.stringify(a)===JSON.stringify(l));t.set(n,o)}),t}var sZ;let zM=sZ=class extends ye{constructor(e){super(e),this.name=null,this.code=null}clone(){return new sZ({name:this.name,code:this.code})}};u([d({type:String,json:{write:!0}})],zM.prototype,"name",void 0),u([d({type:[String,Number],json:{write:!0}})],zM.prototype,"code",void 0),zM=sZ=u([$("esri.layers.support.CodedValue")],zM);const vXe=new Tr({inherited:"inherited",codedValue:"coded-value",range:"range"});let BM=class extends ye{constructor(e){super(e),this.name=null,this.type=null}};u([d({type:String,json:{write:!0}})],BM.prototype,"name",void 0),u([lt(vXe)],BM.prototype,"type",void 0),BM=u([$("esri.layers.support.Domain")],BM);const q6=BM;var nZ;let GM=nZ=class extends q6{constructor(e){super(e),this.codedValues=null,this.type="coded-value"}getName(e){let t=null;if(this.codedValues){const r=String(e);this.codedValues.some(i=>(String(i.code)===r&&(t=i.name),!!t))}return t}clone(){return new nZ({codedValues:re(this.codedValues),name:this.name})}};u([d({type:[zM],json:{write:!0}})],GM.prototype,"codedValues",void 0),u([lt({codedValue:"coded-value"})],GM.prototype,"type",void 0),GM=nZ=u([$("esri.layers.support.CodedValueDomain")],GM);const q2e=GM;var oZ;let f5=oZ=class extends q6{constructor(e){super(e),this.type="inherited"}clone(){return new oZ}};u([lt({inherited:"inherited"})],f5.prototype,"type",void 0),f5=oZ=u([$("esri.layers.support.InheritedDomain")],f5);const W2e=f5;var aZ;let M2=aZ=class extends q6{constructor(e){super(e),this.maxValue=null,this.minValue=null,this.type="range"}clone(){return new aZ({maxValue:this.maxValue,minValue:this.minValue,name:this.name})}};u([d({type:Number,json:{type:[Number],read:{source:"range",reader:(e,t)=>t.range&&t.range[1]},write:{enabled:!1,overridePolicy(){return{enabled:this.maxValue!=null&&this.minValue==null}},target:"range",writer(e,t,r){t[r]=[this.minValue||0,e]}}}})],M2.prototype,"maxValue",void 0),u([d({type:Number,json:{type:[Number],read:{source:"range",reader:(e,t)=>t.range&&t.range[0]},write:{target:"range",writer(e,t,r){t[r]=[e,this.maxValue||0]}}}})],M2.prototype,"minValue",void 0),u([lt({range:"range"})],M2.prototype,"type",void 0),M2=aZ=u([$("esri.layers.support.RangeDomain")],M2);const X2e=M2,Z2e={key:"type",base:q6,typeMap:{range:X2e,"coded-value":q2e,inherited:W2e}};function Yte(e){if(!e||!e.type)return null;switch(e.type){case"range":return X2e.fromJSON(e);case"codedValue":return q2e.fromJSON(e);case"inherited":return W2e.fromJSON(e)}return null}const _Xe=new Tr({esriFieldTypeSmallInteger:"small-integer",esriFieldTypeInteger:"integer",esriFieldTypeSingle:"single",esriFieldTypeDouble:"double",esriFieldTypeLong:"long",esriFieldTypeString:"string",esriFieldTypeDate:"date",esriFieldTypeOID:"oid",esriFieldTypeGeometry:"geometry",esriFieldTypeBlob:"blob",esriFieldTypeRaster:"raster",esriFieldTypeGUID:"guid",esriFieldTypeGlobalID:"global-id",esriFieldTypeXML:"xml"});var lZ;const bXe=new Tr({binary:"binary",coordinate:"coordinate",countOrAmount:"count-or-amount",dateAndTime:"date-and-time",description:"description",locationOrPlaceName:"location-or-place-name",measurement:"measurement",nameOrTitle:"name-or-title",none:"none",orderedOrRanked:"ordered-or-ranked",percentageOrRatio:"percentage-or-ratio",typeOrCategory:"type-or-category",uniqueIdentifier:"unique-identifier"});let Il=lZ=class extends ye{constructor(e){super(e),this.alias=null,this.defaultValue=void 0,this.description=null,this.domain=null,this.editable=!0,this.length=-1,this.name=null,this.nullable=!0,this.type=null,this.valueType=null}readDescription(e,{description:t}){let r;try{r=JSON.parse(t)}catch{}return r?r.value:null}readValueType(e,{description:t}){let r;try{r=JSON.parse(t)}catch{}return r?bXe.fromJSON(r.fieldValueType):null}clone(){return new lZ({alias:this.alias,defaultValue:this.defaultValue,description:this.description,domain:this.domain&&this.domain.clone()||null,editable:this.editable,length:this.length,name:this.name,nullable:this.nullable,type:this.type,valueType:this.valueType})}};u([d({type:String,json:{write:!0}})],Il.prototype,"alias",void 0),u([d({type:[String,Number],json:{write:{allowNull:!0}}})],Il.prototype,"defaultValue",void 0),u([d()],Il.prototype,"description",void 0),u([$e("description")],Il.prototype,"readDescription",null),u([d({types:Z2e,json:{read:{reader:Yte},write:!0}})],Il.prototype,"domain",void 0),u([d({type:Boolean,json:{write:!0}})],Il.prototype,"editable",void 0),u([d({type:Wi,json:{write:!0}})],Il.prototype,"length",void 0),u([d({type:String,json:{write:!0}})],Il.prototype,"name",void 0),u([d({type:Boolean,json:{write:!0}})],Il.prototype,"nullable",void 0),u([lt(_Xe)],Il.prototype,"type",void 0),u([d()],Il.prototype,"valueType",void 0),u([$e("valueType",["description"])],Il.prototype,"readValueType",null),Il=lZ=u([$("esri.layers.support.Field")],Il);const gR=Il;var cZ;let P2=cZ=class extends ye{constructor(e){super(e),this.type="map-layer"}clone(){const{mapLayerId:e,gdbVersion:t}=this;return new cZ({mapLayerId:e,gdbVersion:t})}};u([lt({mapLayer:"map-layer"})],P2.prototype,"type",void 0),u([d({type:Wi,json:{write:!0}})],P2.prototype,"mapLayerId",void 0),u([d({type:String,json:{write:!0}})],P2.prototype,"gdbVersion",void 0),P2=cZ=u([$("esri.layers.support.source.MapLayerSource")],P2);var uZ;let Qg=uZ=class extends ye{constructor(e){super(e),this.type="query-table"}clone(){var o;const{workspaceId:e,query:t,oidFields:r,spatialReference:i,geometryType:s}=this,n={workspaceId:e,query:t,oidFields:r,spatialReference:(o=i==null?void 0:i.clone())!=null?o:void 0,geometryType:s};return new uZ(n)}};u([lt({queryTable:"query-table"})],Qg.prototype,"type",void 0),u([d({type:String,json:{write:!0}})],Qg.prototype,"workspaceId",void 0),u([d({type:String,json:{write:!0}})],Qg.prototype,"query",void 0),u([d({type:String,json:{write:!0}})],Qg.prototype,"oidFields",void 0),u([d({type:Ze,json:{write:!0}})],Qg.prototype,"spatialReference",void 0),u([lt(t6)],Qg.prototype,"geometryType",void 0),Qg=uZ=u([$("esri.layers.support.source.QueryTableDataSource")],Qg);var hZ;let I2=hZ=class extends ye{constructor(e){super(e),this.type="raster"}clone(){const{workspaceId:e,dataSourceName:t}=this;return new hZ({workspaceId:e,dataSourceName:t})}};u([lt({raster:"raster"})],I2.prototype,"type",void 0),u([d({type:String,json:{write:!0}})],I2.prototype,"dataSourceName",void 0),u([d({type:String,json:{write:!0}})],I2.prototype,"workspaceId",void 0),I2=hZ=u([$("esri.layers.support.source.RasterDataSource")],I2);var dZ;let uw=dZ=class extends ye{constructor(e){super(e),this.type="table"}clone(){const{workspaceId:e,gdbVersion:t,dataSourceName:r}=this;return new dZ({workspaceId:e,gdbVersion:t,dataSourceName:r})}};u([lt({table:"table"})],uw.prototype,"type",void 0),u([d({type:String,json:{write:!0}})],uw.prototype,"workspaceId",void 0),u([d({type:String,json:{write:!0}})],uw.prototype,"gdbVersion",void 0),u([d({type:String,json:{write:!0}})],uw.prototype,"dataSourceName",void 0),uw=dZ=u([$("esri.layers.support.source.TableDataSource")],uw);var pZ,fZ;const wXe=Da()({esriLeftInnerJoin:"left-inner-join",esriLeftOuterJoin:"left-outer-join"});let Cu=pZ=class extends ye{constructor(e){super(e),this.type="join-table"}readLeftTableSource(e,t,r){return mce()(e,t,r)}castLeftTableSource(e){return _f(mZ(),e)}readRightTableSource(e,t,r){return mce()(e,t,r)}castRightTableSource(e){return _f(mZ(),e)}clone(){var o,a;const{leftTableKey:e,rightTableKey:t,leftTableSource:r,rightTableSource:i,joinType:s}=this,n={leftTableKey:e,rightTableKey:t,leftTableSource:(o=r==null?void 0:r.clone())!=null?o:void 0,rightTableSource:(a=i==null?void 0:i.clone())!=null?a:void 0,joinType:s};return new pZ(n)}};u([lt({joinTable:"join-table"})],Cu.prototype,"type",void 0),u([d({type:String,json:{write:!0}})],Cu.prototype,"leftTableKey",void 0),u([d({type:String,json:{write:!0}})],Cu.prototype,"rightTableKey",void 0),u([d({json:{write:!0}})],Cu.prototype,"leftTableSource",void 0),u([$e("leftTableSource")],Cu.prototype,"readLeftTableSource",null),u([qt("leftTableSource")],Cu.prototype,"castLeftTableSource",null),u([d({json:{write:!0}})],Cu.prototype,"rightTableSource",void 0),u([$e("rightTableSource")],Cu.prototype,"readRightTableSource",null),u([qt("rightTableSource")],Cu.prototype,"castRightTableSource",null),u([lt(wXe)],Cu.prototype,"joinType",void 0),Cu=pZ=u([$("esri.layers.support.source.JoinTableDataSource")],Cu);let pG=null;function mce(){return pG||(pG=sR({types:mZ()})),pG}let fG=null;function mZ(){return fG||(fG={key:"type",base:null,typeMap:{"data-layer":zp,"map-layer":P2}}),fG}const xXe={key:"type",base:null,typeMap:{"join-table":Cu,"query-table":Qg,raster:I2,table:uw}};let zp=fZ=class extends ye{constructor(e){super(e),this.type="data-layer"}clone(){const{fields:e,dataSource:t}=this;return new fZ({fields:e,dataSource:t})}};u([lt({dataLayer:"data-layer"})],zp.prototype,"type",void 0),u([d({type:[gR],json:{write:!0}})],zp.prototype,"fields",void 0),u([d({types:xXe,json:{write:!0}})],zp.prototype,"dataSource",void 0),zp=fZ=u([$("esri.layers.support.source.DataLayerSource")],zp),zp.from=en(zp);function TXe(e,t){return t?{...t,query:{...e,...t.query}}:{query:e}}function Y2e(e){return typeof e=="string"?Ds(e):re(e)}function SXe(e,t,r){const i={};for(const s in e){if(s==="declaredClass")continue;const n=e[s];if(n!=null&&typeof n!="function")if(Array.isArray(n)){i[s]=[];for(let o=0;o<n.length;o++)i[s][o]=SXe(n[o])}else if(typeof n=="object")if(n.toJSON){const o=n.toJSON(r&&r[s]);i[s]=t?o:JSON.stringify(o)}else i[s]=t?n:JSON.stringify(n);else i[s]=n}return i}const HD={102100:{maxX:20037508342788905e-9,minX:-20037508342788905e-9,plus180Line:new sh({paths:[[[20037508342788905e-9,-20037508342788905e-9],[20037508342788905e-9,20037508342788905e-9]]],spatialReference:Ze.WebMercator}),minus180Line:new sh({paths:[[[-20037508342788905e-9,-20037508342788905e-9],[-20037508342788905e-9,20037508342788905e-9]]],spatialReference:Ze.WebMercator})},4326:{maxX:180,minX:-180,plus180Line:new sh({paths:[[[180,-180],[180,180]]],spatialReference:Ze.WGS84}),minus180Line:new sh({paths:[[[-180,-180],[-180,180]]],spatialReference:Ze.WGS84})}};function bx(e,t){return Math.ceil((e-t)/(2*t))}function Q2e(e,t){const r=tP(e);for(const i of r)for(const s of i)s[0]+=t;return e}function tP(e){return Lx(e)?e.rings:e.paths}async function EXe(e,t,r,i){const s=typeof e=="string"?Ds(e):e,n=t[0].spatialReference,o={...i,query:{...s.query,f:"json",sr:JSON.stringify(n),target:JSON.stringify({geometryType:aR(t[0]),geometries:t}),cutter:JSON.stringify(r)}},a=await er(s.path+"/cut",o),{cutIndexes:l,geometries:c=[]}=a.data;return{cutIndexes:l,geometries:c.map(h=>{const p=u0(h);return p.spatialReference=n,p})}}async function CXe(e,t,r){const i=typeof e=="string"?Ds(e):e,s=t[0].spatialReference,n=aR(t[0]),o={...r,query:{...i.query,f:"json",sr:s.wkid?s.wkid:JSON.stringify(s),geometries:JSON.stringify(AXe(t))}};return RXe((await er(i.path+"/simplify",o)).data,n,s)}function AXe(e){return{geometryType:aR(e[0]),geometries:e.map(t=>t.toJSON())}}function RXe(e,t,r){const i=gwe(t);return e.map(s=>{const n=i.fromJSON(s);return n.spatialReference=r,n})}const J2e=fe.getLogger("esri.geometry.support.normalizeUtils");function OXe(e){return e.type==="polygon"}function MXe(e){return e[0].type==="polygon"}function PXe(e){return e[0].type==="polyline"}function IXe(e,t){if(!(e instanceof sh||e instanceof Oa)){const s="straightLineDensify: the input geometry is neither polyline nor polygon";throw J2e.error(s),new j(s)}const r=tP(e),i=[];for(const s of r){const n=[];i.push(n),n.push([s[0][0],s[0][1]]);for(let o=0;o<s.length-1;o++){const a=s[o][0],l=s[o][1],c=s[o+1][0],h=s[o+1][1],p=Math.sqrt((c-a)*(c-a)+(h-l)*(h-l)),f=(h-l)/p,m=(c-a)/p,g=p/t;if(g>1){for(let T=1;T<=g-1;T++){const x=T*t,E=m*x+a,C=f*x+l;n.push([E,C])}const v=(p+Math.floor(g-1)*t)/2,w=m*v+a,_=f*v+l;n.push([w,_])}n.push([c,h])}}return OXe(e)?new Oa({rings:i,spatialReference:e.spatialReference}):new sh({paths:i,spatialReference:e.spatialReference})}function gce(e,t,r){if(t){const i=IXe(e,1e6);e=pM(i,!0)}return r&&(e=Q2e(e,r)),e}function yce(e,t,r){if(Array.isArray(e)){const i=e[0];if(i>t){const s=bx(i,t);e[0]=i+s*(-2*t)}else if(i<r){const s=bx(i,r);e[0]=i+s*(-2*r)}}else{const i=e.x;if(i>t){const s=bx(i,t);e=e.clone().offset(s*(-2*t),0)}else if(i<r){const s=bx(i,r);e=e.clone().offset(s*(-2*r),0)}}return e}function $Xe(e,t){let r=-1;for(let i=0;i<t.cutIndexes.length;i++){const s=t.cutIndexes[i],n=t.geometries[i],o=tP(n);for(let a=0;a<o.length;a++){const l=o[a];l.some(c=>{if(c[0]<180)return!0;{let h=0;for(let f=0;f<l.length;f++){const m=l[f][0];h=m>h?m:h}h=Number(h.toFixed(9));const p=-360*bx(h,180);for(let f=0;f<l.length;f++){const m=n.getPoint(a,f);n.setPoint(a,f,m.clone().offset(p,0))}return!0}})}if(s===r){if(MXe(e))for(const a of tP(n))e[s]=e[s].addRing(a);else if(PXe(e))for(const a of tP(n))e[s]=e[s].addPath(a)}else r=s,e[s]=n}return e}async function K2e(e,t,r){var E;if(!Array.isArray(e))return K2e([e],t);t&&typeof t!="string"&&J2e.warn("normalizeCentralMeridian()","The url object is deprecated, use the url string instead");const i=typeof t=="string"?t:(E=t==null?void 0:t.url)!=null?E:Ur.geometryServiceUrl;let s,n,o,a,l,c,h,p,f=0;const m=[],g=[];for(const C of e)if(R(C))g.push(C);else if(s||(s=C.spatialReference,n=a1(s),o=s.isWebMercator,c=o?102100:4326,a=HD[c].maxX,l=HD[c].minX,h=HD[c].plus180Line,p=HD[c].minus180Line),n)if(C.type==="mesh")g.push(C);else if(C.type==="point")g.push(yce(C.clone(),a,l));else if(C.type==="multipoint"){const A=C.clone();A.points=A.points.map(P=>yce(P,a,l)),g.push(A)}else if(C.type==="extent"){const A=C.clone()._normalize(!1,!1,n);g.push(A.rings?new Oa(A):A)}else if(C.extent){const A=C.extent,P=bx(A.xmin,l)*(2*a);let I=P===0?C.clone():Q2e(C.clone(),P);A.offset(P,0),A.intersects(h)&&A.xmax!==a?(f=A.xmax>f?A.xmax:f,I=gce(I,o),m.push(I),g.push("cut")):A.intersects(p)&&A.xmin!==l?(f=A.xmax*(2*a)>f?A.xmax*(2*a):f,I=gce(I,o,360),m.push(I),g.push("cut")):g.push(I)}else g.push(C.clone());else g.push(C);let v=bx(f,a),w=-90;const _=v,T=new sh;for(;v>0;){const C=360*v-180;T.addPath([[C,w],[C,-1*w]]),w*=-1,v--}if(m.length>0&&_>0){const C=$Xe(m,await EXe(i,m,T,r)),A=[],P=[];for(let k=0;k<g.length;k++){const G=g[k];if(G!=="cut")P.push(G);else{const z=C.shift(),X=e[k];b(X)&&X.type==="polygon"&&X.rings&&X.rings.length>1&&z.rings.length>=X.rings.length?(A.push(z),P.push("simplify")):P.push(o?jy(z):z)}}if(!A.length)return P;const I=await CXe(i,A,r),L=[];for(let k=0;k<P.length;k++){const G=P[k];G!=="simplify"?L.push(G):L.push(o?jy(I.shift()):I.shift())}return L}const x=[];for(let C=0;C<g.length;C++){const A=g[C];if(A!=="cut")x.push(A);else{const P=m.shift();x.push(o===!0?jy(P):P)}}return x}function eEe(e){const t={};for(const r in e){if(r==="declaredClass")continue;const i=e[r];if(i!=null&&typeof i!="function")if(Array.isArray(i)){t[r]=[];for(let s=0;s<i.length;s++)t[r][s]=eEe(i[s])}else typeof i=="object"?i.toJSON&&(t[r]=JSON.stringify(i)):t[r]=i}return t}var h_;(function(e){e[e.varint=0]="varint",e[e.fixed64=1]="fixed64",e[e.delimited=2]="delimited",e[e.fixed32=5]="fixed32",e[e.unknown=99]="unknown"})(h_||(h_={}));const vce=4294967296,LXe=new TextDecoder("utf-8"),DXe=he("safari")||he("ios")?6:he("ff")?12:32;class Gx{constructor(t,r,i=0,s=t?t.byteLength:0){this._tag=0,this._dataType=h_.unknown,this._init(t,r,i,s)}_init(t,r,i,s){this._data=t,this._dataView=r,this._pos=i,this._end=s}clone(){return new Gx(this._data,this._dataView,this._pos,this._end)}pos(){return this._pos}move(t){this._pos=t}nextTag(t){for(;;){if(this._pos===this._end)return!1;const r=this._decodeVarint();if(this._tag=r>>3,this._dataType=7&r,!t||t===this._tag)break;this.skip()}return!0}next(){if(this._pos===this._end)return!1;const t=this._decodeVarint();return this._tag=t>>3,this._dataType=7&t,!0}empty(){return this._pos>=this._end}tag(){return this._tag}getInt32(){return this._decodeVarint()}getInt64(){return this._decodeVarint()}getUInt32(){let t=4294967295;return t=(127&this._data[this._pos])>>>0,this._data[this._pos++]<128?t:(t=(t|(127&this._data[this._pos])<<7)>>>0,this._data[this._pos++]<128?t:(t=(t|(127&this._data[this._pos])<<14)>>>0,this._data[this._pos++]<128?t:(t=(t|(127&this._data[this._pos])<<21)>>>0,this._data[this._pos++]<128?t:(t=(t|(15&this._data[this._pos])<<28)>>>0,this._data[this._pos++]<128?t:void 0))))}getUInt64(){return this._decodeVarint()}getSInt32(){const t=this.getUInt32();return t>>>1^-(1&t)|0}getSInt64(){return this._decodeSVarint()}getBool(){const t=this._data[this._pos]!==0;return this._skip(1),t}getEnum(){return this._decodeVarint()}getFixed64(){const t=this._dataView,r=this._pos,i=t.getUint32(r,!0)+t.getUint32(r+4,!0)*vce;return this._skip(8),i}getSFixed64(){const t=this._dataView,r=this._pos,i=t.getUint32(r,!0)+t.getInt32(r+4,!0)*vce;return this._skip(8),i}getDouble(){const t=this._dataView.getFloat64(this._pos,!0);return this._skip(8),t}getFixed32(){const t=this._dataView.getUint32(this._pos,!0);return this._skip(4),t}getSFixed32(){const t=this._dataView.getInt32(this._pos,!0);return this._skip(4),t}getFloat(){const t=this._dataView.getFloat32(this._pos,!0);return this._skip(4),t}getString(){const t=this._getLength(),r=this._pos,i=this._toString(this._data,r,r+t);return this._skip(t),i}getBytes(){const t=this._getLength(),r=this._pos,i=this._toBytes(this._data,r,r+t);return this._skip(t),i}getLength(){return this._getLengthUnsafe()}processMessageWithArgs(t,r,i,s){const n=this.getMessage(),o=t(n,r,i,s);return n.release(),o}processMessage(t){const r=this.getMessage(),i=t(r);return r.release(),i}getMessage(){const t=this._getLength(),r=Gx.pool.acquire();return r._init(this._data,this._dataView,this._pos,this._pos+t),this._skip(t),r}release(){Gx.pool.release(this)}dataType(){return this._dataType}skip(){switch(this._dataType){case h_.varint:this._decodeVarint();break;case h_.fixed64:this._skip(8);break;case h_.delimited:this._skip(this._getLength());break;case h_.fixed32:this._skip(4);break;default:throw new Error("Invalid data type!")}}skipLen(t){this._skip(t)}_skip(t){if(this._pos+t>this._end)throw new Error("Attempt to skip past the end of buffer!");this._pos+=t}_decodeVarint(){const t=this._data;let r,i=this._pos,s=0;if(this._end-i>=10)do{if(r=t[i++],s|=127&r,(128&r)==0||(r=t[i++],s|=(127&r)<<7,(128&r)==0)||(r=t[i++],s|=(127&r)<<14,(128&r)==0)||(r=t[i++],s|=(127&r)<<21,(128&r)==0)||(r=t[i++],s+=268435456*(127&r),(128&r)==0)||(r=t[i++],s+=34359738368*(127&r),(128&r)==0)||(r=t[i++],s+=4398046511104*(127&r),(128&r)==0)||(r=t[i++],s+=562949953421312*(127&r),(128&r)==0)||(r=t[i++],s+=72057594037927940*(127&r),(128&r)==0)||(r=t[i++],s+=9223372036854776e3*(127&r),(128&r)==0))break;throw new Error("Varint too long!")}while(0);else{let n=1;for(;i!==this._end&&(r=t[i],(128&r)!=0);)++i,s+=(127&r)*n,n*=128;if(i===this._end)throw new Error("Varint overrun!");++i,s+=r*n}return this._pos=i,s}_decodeSVarint(){const t=this._decodeVarint();return t%2?-(t+1)/2:t/2}_getLength(){if(this._dataType!==h_.delimited)throw new Error("Not a delimited data type!");return this._decodeVarint()}_getLengthUnsafe(){return this.getUInt32()}_toString(t,r,i){if((i=Math.min(this._end,i))-r>DXe){const o=t.subarray(r,i);return LXe.decode(o)}let s="",n="";for(let o=r;o<i;++o){const a=t[o];128&a?n+="%"+a.toString(16):(s+=decodeURIComponent(n)+String.fromCharCode(a),n="")}return n.length&&(s+=decodeURIComponent(n)),s}_toBytes(t,r,i){return i=Math.min(this._end,i),new Uint8Array(t.buffer,r,i-r)}}Gx.pool=new Ls(Gx,null,e=>{e._data=null,e._dataView=null});class ec{constructor(t=[],r=[],i=!1){this.lengths=t!=null?t:[],this.coords=r!=null?r:[],this.hasIndeterminateRingOrder=i}static fromRect(t){const[r,i,s,n]=t,o=s-r,a=n-i;return new ec([5],[r,i,o,0,0,a,-o,0,0,-a])}get isPoint(){return this.lengths.length===0}get maxLength(){return Math.max(...this.lengths)}get size(){return this.lengths.reduce((t,r)=>t+r)}forEachVertex(t){let r=0;this.lengths.length||t(this.coords[0],this.coords[1]);for(let i=0;i<this.lengths.length;i++){const s=this.lengths[i];for(let n=0;n<s;n++)t(this.coords[2*(n+r)],this.coords[2*(n+r)+1]);r+=s}}clone(t){return t?(t.set(this.coords),new ec(this.lengths.slice(),t,this.hasIndeterminateRingOrder)):new ec(this.lengths.slice(),this.coords.slice(),this.hasIndeterminateRingOrder)}}class ng{constructor(t=null,r={},i,s){this.geometry=t,this.attributes=r,this.centroid=i,this.objectId=s,this.displayId=0,this.geohashX=0,this.geohashY=0}weakClone(){const t=new ng(this.geometry,this.attributes,this.centroid,this.objectId);return t.displayId=this.displayId,t.geohashX=this.geohashX,t.geohashY=this.geohashY,t}}function NXe(e){return!(R(e.geometry)||!e.geometry.coords||!e.geometry.coords.length)}class j$t extends ng{}class W6{constructor(){this.objectIdFieldName=null,this.globalIdFieldName=null,this.geohashFieldName=null,this.geometryProperties=null,this.geometryType=null,this.spatialReference=null,this.hasZ=!1,this.hasM=!1,this.features=[],this.fields=[],this.transform=null,this.exceededTransferLimit=!1,this.uniqueIdField=null,this.queryGeometryType=null,this.queryGeometry=null}weakClone(){const t=new W6;return t.objectIdFieldName=this.objectIdFieldName,t.globalIdFieldName=this.globalIdFieldName,t.geohashFieldName=this.geohashFieldName,t.geometryProperties=this.geometryProperties,t.geometryType=this.geometryType,t.spatialReference=this.spatialReference,t.hasZ=this.hasZ,t.hasM=this.hasM,t.features=this.features,t.fields=this.fields,t.transform=this.transform,t.exceededTransferLimit=this.exceededTransferLimit,t.uniqueIdField=this.uniqueIdField,t.queryGeometry=this.queryGeometry,t.queryGeometryType=this.queryGeometryType,t}}const tEe=["esriGeometryPoint","esriGeometryMultipoint","esriGeometryPolyline","esriGeometryPolygon"];class H$t{constructor(t){this.options=t,this.geometryTypes=tEe,this._coordinatePtr=0,this._vertexDimension=0}createFeatureResult(){return new W6}prepareFeatures(t){this._vertexDimension=2,t.hasZ&&this._vertexDimension++,t.hasM&&this._vertexDimension++}finishFeatureResult(t){if(!t||!t.features||!t.hasZ||!this.options.sourceSpatialReference||!t.spatialReference||ml(t.spatialReference,this.options.sourceSpatialReference)||t.spatialReference.vcsWkid)return;const r=aA(this.options.sourceSpatialReference)/aA(t.spatialReference);if(r!==1)for(const i of t.features){if(!NXe(i))continue;const s=i.geometry.coords;for(let n=2;n<s.length;n+=3)s[n]*=r}}addFeature(t,r){t.features.push(r)}createFeature(){return new ng}createSpatialReference(){return{wkid:0}}createGeometry(){return new ec}addField(t,r){t.fields.push(r)}allocateCoordinates(t){t.coords.length=t.lengths.reduce((r,i)=>r+i,0)*this._vertexDimension,this._coordinatePtr=0}addCoordinate(t,r){t.coords[this._coordinatePtr++]=r}addCoordinatePoint(t,r){t.coords.push(r)}addLength(t,r){t.lengths.push(r)}addQueryGeometry(t,r){t.queryGeometry=r.queryGeometry,t.queryGeometryType=r.queryGeometryType}createPointGeometry(){return new ec}}const _ce=["esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble","esriFieldTypeString","esriFieldTypeDate","esriFieldTypeOID","esriFieldTypeGeometry","esriFieldTypeBlob","esriFieldTypeRaster","esriFieldTypeGUID","esriFieldTypeGlobalID","esriFieldTypeXML"],bce=["sqlTypeBigInt","sqlTypeBinary","sqlTypeBit","sqlTypeChar","sqlTypeDate","sqlTypeDecimal","sqlTypeDouble","sqlTypeFloat","sqlTypeGeometry","sqlTypeGUID","sqlTypeInteger","sqlTypeLongNVarchar","sqlTypeLongVarbinary","sqlTypeLongVarchar","sqlTypeNChar","sqlTypeNVarchar","sqlTypeOther","sqlTypeReal","sqlTypeSmallInt","sqlTypeSqlXml","sqlTypeTime","sqlTypeTimestamp","sqlTypeTimestamp2","sqlTypeTinyInt","sqlTypeVarbinary","sqlTypeVarchar"],wce=["upperLeft","lowerLeft"];function xce(e){return e>=_ce.length?null:_ce[e]}function FXe(e){return e>=bce.length?null:bce[e]}function Tce(e){return e>=wce.length?null:wce[e]}function Sce(e,t){return t>=e.geometryTypes.length?null:e.geometryTypes[t]}function kXe(e,t,r){const s=t.createPointGeometry(r);for(;e.next();)switch(e.tag()){case 3:{const n=e.getUInt32(),o=e.pos()+n;let a=0;for(;e.pos()<o;)t.addCoordinatePoint(s,e.getSInt64(),a++);break}default:e.skip()}return s}function UXe(e,t,r){const n=t.createGeometry(r),o=2+(r.hasZ?1:0)+(r.hasM?1:0);for(;e.next();)switch(e.tag()){case 2:{const a=e.getUInt32(),l=e.pos()+a;let c=0;for(;e.pos()<l;)t.addLength(n,e.getUInt32(),c++);break}case 3:{const a=e.getUInt32(),l=e.pos()+a;let c=0;for(t.allocateCoordinates(n);e.pos()<l;)t.addCoordinate(n,e.getSInt64(),c),c++,c===o&&(c=0);break}default:e.skip()}return n}function VXe(e){const s=new ec;let n="esriGeometryPoint";for(;e.next();)switch(e.tag()){case 2:{const o=e.getUInt32(),a=e.pos()+o;for(;e.pos()<a;)s.lengths.push(e.getUInt32());break}case 3:{const o=e.getUInt32(),a=e.pos()+o;for(;e.pos()<a;)s.coords.push(e.getSInt64());break}case 1:n=tEe[e.getEnum()];break;default:e.skip()}return{queryGeometry:s,queryGeometryType:n}}function zXe(e){for(;e.next();)switch(e.tag()){case 1:return e.getString();case 2:return e.getFloat();case 3:return e.getDouble();case 4:return e.getSInt32();case 5:return e.getUInt32();case 6:return e.getInt64();case 7:return e.getUInt64();case 8:return e.getSInt64();case 9:return e.getBool();default:return e.skip(),null}return null}function BXe(e){const a={type:xce(0)};for(;e.next();)switch(e.tag()){case 1:a.name=e.getString();break;case 2:a.type=xce(e.getEnum());break;case 3:a.alias=e.getString();break;case 4:a.sqlType=FXe(e.getEnum());break;case 5:e.skip();break;case 6:a.defaultValue=e.getString();break;default:e.skip()}return a}function GXe(e){const i={};for(;e.next();)switch(e.tag()){case 1:i.name=e.getString();break;case 2:i.isSystemMaintained=e.getBool();break;default:e.skip()}return i}function jXe(e,t,r,i){const a=t.createFeature(r);let l=0;for(;e.next();)switch(e.tag()){case 1:{const c=i[l++].name;a.attributes[c]=e.processMessage(zXe);break}case 2:a.geometry=e.processMessageWithArgs(UXe,t,r);break;case 4:a.centroid=e.processMessageWithArgs(kXe,t,r);break;default:e.skip()}return a}function HXe(e){const n=[1,1,1,1];for(;e.next();)switch(e.tag()){case 1:n[0]=e.getDouble();break;case 2:n[1]=e.getDouble();break;case 4:n[2]=e.getDouble();break;case 3:n[3]=e.getDouble();break;default:e.skip()}return n}function qXe(e){const n=[0,0,0,0];for(;e.next();)switch(e.tag()){case 1:n[0]=e.getDouble();break;case 2:n[1]=e.getDouble();break;case 4:n[2]=e.getDouble();break;case 3:n[3]=e.getDouble();break;default:e.skip()}return n}function WXe(e){const s={originPosition:Tce(0)};for(;e.next();)switch(e.tag()){case 1:s.originPosition=Tce(e.getEnum());break;case 2:s.scale=e.processMessage(HXe);break;case 3:s.translate=e.processMessage(qXe);break;default:e.skip()}return s}function XXe(e){const s={};for(;e.next();)switch(e.tag()){case 1:s.shapeAreaFieldName=e.getString();break;case 2:s.shapeLengthFieldName=e.getString();break;case 3:s.units=e.getString();break;default:e.skip()}return s}function ZXe(e,t){const a=t.createSpatialReference();for(;e.next();)switch(e.tag()){case 1:a.wkid=e.getUInt32();break;case 5:a.wkt=e.getString();break;case 2:a.latestWkid=e.getUInt32();break;case 3:a.vcsWkid=e.getUInt32();break;case 4:a.latestVcsWkid=e.getUInt32();break;default:e.skip()}return a}function YXe(e,t){const v=t.createFeatureResult();v.geometryType=Sce(t,0);let w=!1;for(;e.next();)switch(e.tag()){case 1:v.objectIdFieldName=e.getString();break;case 3:v.globalIdFieldName=e.getString();break;case 4:v.geohashFieldName=e.getString();break;case 5:v.geometryProperties=e.processMessage(XXe);break;case 7:v.geometryType=Sce(t,e.getEnum());break;case 8:v.spatialReference=e.processMessageWithArgs(ZXe,t);break;case 10:v.hasZ=e.getBool();break;case 11:v.hasM=e.getBool();break;case 12:v.transform=e.processMessage(WXe);break;case 9:{const _=e.getBool();v.exceededTransferLimit=_;break}case 13:t.addField(v,e.processMessage(BXe));break;case 15:w||(t.prepareFeatures(v),w=!0),t.addFeature(v,e.processMessageWithArgs(jXe,t,v,v.fields));break;case 2:v.uniqueIdField=e.processMessage(GXe);break;default:e.skip()}return t.finishFeatureResult(v),v}function QXe(e,t){const s={};let n=null;for(;e.next();)switch(e.tag()){case 4:n=e.processMessageWithArgs(VXe);break;case 1:s.featureResult=e.processMessageWithArgs(YXe,t);break;default:e.skip()}return b(n)&&s.featureResult&&t.addQueryGeometry(s,n),s}function JXe(e,t){try{const i=new Gx(new Uint8Array(e),new DataView(e)),s={};for(;i.next();)i.tag()===2?s.queryResult=i.processMessageWithArgs(QXe,t):i.skip();return s}catch(r){throw new j("query:parsing-pbf","Error while parsing FeatureSet PBF payload",{error:r})}}function KXe(e,t){const r=JXe(e,t),i=r.queryResult.featureResult,s=r.queryResult.queryGeometry,n=r.queryResult.queryGeometryType;if(i&&i.features&&i.features.length&&i.objectIdFieldName){const o=i.objectIdFieldName;for(const a of i.features)a.attributes&&(a.objectId=a.attributes[o])}return i&&(i.queryGeometry=s,i.queryGeometryType=n),i}function gZ(e,t,r){if(!r||!r.features||!r.hasZ)return;const i=sTe(r.geometryType,t,e.outSpatialReference);if(!R(i))for(const s of r.features)i(s.geometry)}const Ece="Layer does not support extent calculation.";function rEe(e,t){if(t&&e.type==="extent")return`${e.xmin},${e.ymin},${e.xmax},${e.ymax}`;if(t&&e.type==="point")return`${e.x},${e.y}`;const r=e.toJSON();return delete r.spatialReference,JSON.stringify(r)}function iEe(e,t){const r=e.geometry,i=e.toJSON();delete i.compactGeometryEnabled,delete i.defaultSpatialReferenceEnabled;const s=i;let n,o,a;if(b(r)&&(o=r.spatialReference,a=r.spatialReference.wkid||JSON.stringify(r.spatialReference),s.geometryType=aR(r),s.geometry=rEe(r,e.compactGeometryEnabled),s.inSR=a),i.groupByFieldsForStatistics&&(s.groupByFieldsForStatistics=i.groupByFieldsForStatistics.join(",")),i.objectIds&&(s.objectIds=i.objectIds.join(",")),i.orderByFields&&(s.orderByFields=i.orderByFields.join(",")),!i.outFields||!i.returnDistinctValues&&((t==null?void 0:t.returnCountOnly)||(t==null?void 0:t.returnExtentOnly)||(t==null?void 0:t.returnIdsOnly))?delete s.outFields:i.outFields.includes("*")?s.outFields="*":s.outFields=i.outFields.join(","),i.outSR?(s.outSR=i.outSR.wkid||JSON.stringify(i.outSR),n=e.outSpatialReference):r&&(i.returnGeometry||i.returnCentroid)&&(s.outSR=s.inSR,n=o),i.returnGeometry&&delete i.returnGeometry,i.outStatistics&&(s.outStatistics=JSON.stringify(i.outStatistics)),i.pixelSize&&(s.pixelSize=JSON.stringify(i.pixelSize)),i.quantizationParameters&&(e.defaultSpatialReferenceEnabled&&b(o)&&b(e.quantizationParameters)&&b(e.quantizationParameters.extent)&&o.equals(e.quantizationParameters.extent.spatialReference)&&delete i.quantizationParameters.extent.spatialReference,s.quantizationParameters=JSON.stringify(i.quantizationParameters)),i.parameterValues&&(s.parameterValues=JSON.stringify(i.parameterValues)),i.rangeValues&&(s.rangeValues=JSON.stringify(i.rangeValues)),i.dynamicDataSource&&(s.layer=JSON.stringify({source:i.dynamicDataSource}),delete i.dynamicDataSource),i.timeExtent){const l=i.timeExtent,{start:c,end:h}=l;c==null&&h==null||(s.time=c===h?c:`${c==null?"null":c},${h==null?"null":h}`),delete i.timeExtent}return e.defaultSpatialReferenceEnabled&&b(o)&&b(n)&&o.equals(n)&&(s.defaultSR=s.inSR,delete s.inSR,delete s.outSR),s}async function sEe(e,t,r,i){const s=b(t.timeExtent)&&t.timeExtent.isEmpty?{data:{features:[]}}:await yR(e,t,"json",i);return gZ(t,r,s.data),s}async function eZe(e,t,r,i){if(b(t.timeExtent)&&t.timeExtent.isEmpty)return{data:r.createFeatureResult()};const s=await nEe(e,t,i),n=s;return n.data=KXe(s.data,r),n}function nEe(e,t,r){return yR(e,t,"pbf",r)}function tZe(e,t,r){return b(t.timeExtent)&&t.timeExtent.isEmpty?Promise.resolve({data:{objectIds:[]}}):yR(e,t,"json",r,{returnIdsOnly:!0})}function rZe(e,t,r){return b(t.timeExtent)&&t.timeExtent.isEmpty?Promise.resolve({data:{count:0}}):yR(e,t,"json",r,{returnIdsOnly:!0,returnCountOnly:!0})}function iZe(e,t,r){return b(t.timeExtent)&&t.timeExtent.isEmpty?Promise.resolve({data:{count:0,extent:null}}):yR(e,t,"json",r,{returnExtentOnly:!0,returnCountOnly:!0}).then(i=>{const s=i.data;if(s.hasOwnProperty("extent"))return i;if(s.features)throw new Error(Ece);if(s.hasOwnProperty("count"))throw new Error(Ece);return i})}function yR(e,t,r,i={},s={}){const n=typeof e=="string"?Ds(e):e,o=t.geometry?[t.geometry]:[];return i.responseType=r==="pbf"?"array-buffer":"json",K2e(o,null,i).then(a=>{const l=a&&a[0];b(l)&&((t=t.clone()).geometry=l);const c=eEe({...n.query,f:r,...s,...iEe(t,s)});return er(sc(n.path,"query"),{...i,query:{...c,...i.query}})})}const q$t=Object.freeze(Object.defineProperty({__proto__:null,encodeGeometry:rEe,executeQuery:sEe,executeQueryForCount:rZe,executeQueryForExtent:iZe,executeQueryForIds:tZe,executeQueryPBF:eZe,executeQueryPBFBuffer:nEe,queryToQueryStringParameters:iEe,runQuery:yR},Symbol.toStringTag,{value:"Module"}));var yZ;const vZ=new Tr({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryEnvelope:"extent",mesh:"mesh","":null});let Ho=yZ=class extends ye{constructor(e){super(e),this.displayFieldName=null,this.exceededTransferLimit=!1,this.features=[],this.fields=null,this.geometryType=null,this.hasM=!1,this.hasZ=!1,this.queryGeometry=null,this.spatialReference=null}readFeatures(e,t){var s;const r=Ze.fromJSON(t.spatialReference),i=[];for(let n=0;n<e.length;n++){const o=e[n],a=gl.fromJSON(o),l=o.geometry&&o.geometry.spatialReference;b(a.geometry)&&!l&&(a.geometry.spatialReference=r);const c=o.aggregateGeometries,h=a.aggregateGeometries;if(c&&b(h))for(const p in h){const f=h[p],m=(s=c[p])==null?void 0:s.spatialReference;b(f)&&!m&&(f.spatialReference=r)}i.push(a)}return i}writeGeometryType(e,t,r,i){if(e)return void vZ.write(e,t,r,i);const{features:s}=this;if(s){for(const n of s)if(n&&b(n.geometry))return void vZ.write(n.geometry.type,t,r,i)}}readQueryGeometry(e,t){if(!e)return null;const r=!!e.spatialReference,i=u0(e);return!r&&t.spatialReference&&(i.spatialReference=Ze.fromJSON(t.spatialReference)),i}writeSpatialReference(e,t){if(e)return void(t.spatialReference=e.toJSON());const{features:r}=this;if(r){for(const i of r)if(i&&b(i.geometry)&&i.geometry.spatialReference)return void(t.spatialReference=i.geometry.spatialReference.toJSON())}}clone(){return new yZ(this.cloneProperties())}cloneProperties(){return re({displayFieldName:this.displayFieldName,exceededTransferLimit:this.exceededTransferLimit,features:this.features,fields:this.fields,geometryType:this.geometryType,hasM:this.hasM,hasZ:this.hasZ,queryGeometry:this.queryGeometry,spatialReference:this.spatialReference,transform:this.transform})}toJSON(e){const t=this.write();if(t.features&&Array.isArray(e)&&e.length>0)for(let r=0;r<t.features.length;r++){const i=t.features[r];if(i.geometry){const s=e&&e[r];i.geometry=s&&s.toJSON()||i.geometry}}return t}quantize(e){const{scale:[t,r],translate:[i,s]}=e,n=c=>Math.round((c-i)/t),o=c=>Math.round((s-c)/r),a=this.features,l=this._getQuantizationFunction(this.geometryType,n,o);for(let c=0,h=a.length;c<h;c++)l(a[c].geometry)||(a.splice(c,1),c--,h--);return this.transform=e,this}unquantize(){const{geometryType:e,features:t,transform:r}=this;if(!r)return this;const{translate:[i,s],scale:[n,o]}=r,a=h=>h*n+i,l=h=>s-h*o,c=this._getHydrationFunction(e,a,l);for(const{geometry:h}of t)b(h)&&c(h);return this.transform=null,this}_quantizePoints(e,t,r){let i,s;const n=[];for(let o=0,a=e.length;o<a;o++){const l=e[o];if(o>0){const c=t(l[0]),h=r(l[1]);c===i&&h===s||(n.push([c-i,h-s]),i=c,s=h)}else i=t(l[0]),s=r(l[1]),n.push([i,s])}return n.length>0?n:null}_getQuantizationFunction(e,t,r){return e==="point"?i=>(i.x=t(i.x),i.y=r(i.y),i):e==="polyline"||e==="polygon"?i=>{const s=Lx(i)?i.rings:i.paths,n=[];for(let o=0,a=s.length;o<a;o++){const l=s[o],c=this._quantizePoints(l,t,r);c&&n.push(c)}return n.length>0?(Lx(i)?i.rings=n:i.paths=n,i):null}:e==="multipoint"?i=>{const s=this._quantizePoints(i.points,t,r);return s.length>0?(i.points=s,i):null}:e==="extent"?i=>i:null}_getHydrationFunction(e,t,r){return e==="point"?i=>{i.x=t(i.x),i.y=r(i.y)}:e==="polyline"||e==="polygon"?i=>{const s=Lx(i)?i.rings:i.paths;let n,o;for(let a=0,l=s.length;a<l;a++){const c=s[a];for(let h=0,p=c.length;h<p;h++){const f=c[h];h>0?(n+=f[0],o+=f[1]):(n=f[0],o=f[1]),f[0]=t(n),f[1]=r(o)}}}:e==="extent"?i=>{i.xmin=t(i.xmin),i.ymin=r(i.ymin),i.xmax=t(i.xmax),i.ymax=r(i.ymax)}:e==="multipoint"?i=>{const s=i.points;let n,o;for(let a=0,l=s.length;a<l;a++){const c=s[a];a>0?(n+=c[0],o+=c[1]):(n=c[0],o=c[1]),c[0]=t(n),c[1]=r(o)}}:void 0}};u([d({type:String,json:{write:!0}})],Ho.prototype,"displayFieldName",void 0),u([d({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],Ho.prototype,"exceededTransferLimit",void 0),u([d({type:[gl],json:{write:!0}})],Ho.prototype,"features",void 0),u([$e("features")],Ho.prototype,"readFeatures",null),u([d({type:[gR],json:{write:!0}})],Ho.prototype,"fields",void 0),u([d({type:["point","multipoint","polyline","polygon","extent","mesh"],json:{read:{reader:vZ.read}}})],Ho.prototype,"geometryType",void 0),u([Xe("geometryType")],Ho.prototype,"writeGeometryType",null),u([d({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],Ho.prototype,"hasM",void 0),u([d({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],Ho.prototype,"hasZ",void 0),u([d({types:jT,json:{write:!0}})],Ho.prototype,"queryGeometry",void 0),u([$e("queryGeometry")],Ho.prototype,"readQueryGeometry",null),u([d({type:Ze,json:{write:!0}})],Ho.prototype,"spatialReference",void 0),u([Xe("spatialReference")],Ho.prototype,"writeSpatialReference",null),u([d({json:{write:!0}})],Ho.prototype,"transform",void 0),Ho=yZ=u([$("esri.rest.support.FeatureSet")],Ho),Ho.prototype.toJSON.isDefaultToJSON=!0;const rL=Ho,W$t=Object.freeze(Object.defineProperty({__proto__:null,default:rL},Symbol.toStringTag,{value:"Module"})),Cce={milliseconds:1,seconds:1e3,minutes:6e4,hours:36e5,days:864e5,weeks:6048e5,months:26784e5,years:31536e6,decades:31536e7,centuries:31536e8},sZe={milliseconds:{getter:"getMilliseconds",setter:"setMilliseconds",multiplier:1},seconds:{getter:"getSeconds",setter:"setSeconds",multiplier:1},minutes:{getter:"getMinutes",setter:"setMinutes",multiplier:1},hours:{getter:"getHours",setter:"setHours",multiplier:1},days:{getter:"getDate",setter:"setDate",multiplier:1},weeks:{getter:"getDate",setter:"setDate",multiplier:7},months:{getter:"getMonth",setter:"setMonth",multiplier:1},years:{getter:"getFullYear",setter:"setFullYear",multiplier:1},decades:{getter:"getFullYear",setter:"setFullYear",multiplier:10},centuries:{getter:"getFullYear",setter:"setFullYear",multiplier:100}};function nZe(e,t){const r=new Date(e,t+1,1);return r.setDate(0),r.getDate()}function jx(e,t,r){const i=new Date(e.getTime());if(t&&r){const s=sZe[r],{getter:n,setter:o,multiplier:a}=s;if(r==="months"){const l=nZe(i.getFullYear(),i.getMonth()+t);i.getDate()>l&&i.setDate(l)}i[o](i[n]()+t*a)}return i}function Ace(e,t){switch(t){case"milliseconds":return new Date(e.getTime());case"seconds":return new Date(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds());case"minutes":return new Date(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes());case"hours":return new Date(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours());case"days":return new Date(e.getFullYear(),e.getMonth(),e.getDate());case"weeks":return new Date(e.getFullYear(),e.getMonth(),e.getDate()-e.getDay());case"months":return new Date(e.getFullYear(),e.getMonth(),1);case"years":return new Date(e.getFullYear(),0,1);case"decades":return new Date(e.getFullYear()-e.getFullYear()%10,0,1);case"centuries":return new Date(e.getFullYear()-e.getFullYear()%100,0,1);default:return new Date}}function oZe(e,t,r){return e===0?0:e*Cce[t]/Cce[r]}var bp;let ku=bp=class extends ye{constructor(e){super(e),this.end=null,this.start=null}static get allTime(){return Rce}static get empty(){return aZe}readEnd(e,t){return t.end!=null?new Date(t.end):null}writeEnd(e,t){t.end=e?e.getTime():null}get isAllTime(){return this.equals(bp.allTime)}get isEmpty(){return this.equals(bp.empty)}readStart(e,t){return t.start!=null?new Date(t.start):null}writeStart(e,t){t.start=e?e.getTime():null}clone(){return new bp({end:this.end,start:this.start})}equals(e){if(!e)return!1;const t=b(this.start)?this.start.getTime():this.start,r=b(this.end)?this.end.getTime():this.end,i=b(e.start)?e.start.getTime():e.start,s=b(e.end)?e.end.getTime():e.end;return t===i&&r===s}expandTo(e){if(this.isEmpty||this.isAllTime)return this.clone();const t=mn(this.start,i=>Ace(i,e)),r=mn(this.end,i=>jx(Ace(i,e),1,e));return new bp({start:t,end:r})}intersection(e){if(!e)return this.clone();if(this.isEmpty||e.isEmpty)return bp.empty;if(this.isAllTime)return e.clone();if(e.isAllTime)return this.clone();const t=Xu(this.start,-1/0,a=>a.getTime()),r=Xu(this.end,1/0,a=>a.getTime()),i=Xu(e.start,-1/0,a=>a.getTime()),s=Xu(e.end,1/0,a=>a.getTime());let n,o;if(i>=t&&i<=r?n=i:t>=i&&t<=s&&(n=t),r>=i&&r<=s?o=r:s>=t&&s<=r&&(o=s),!isNaN(n)&&!isNaN(o)){const a=new bp;return a.start=n===-1/0?null:new Date(n),a.end=o===1/0?null:new Date(o),a}return bp.empty}offset(e,t){if(this.isEmpty||this.isAllTime)return this.clone();const r=new bp,{start:i,end:s}=this;return b(i)&&(r.start=jx(i,e,t)),b(s)&&(r.end=jx(s,e,t)),r}union(e){if(!e||e.isEmpty)return this.clone();if(this.isEmpty)return e.clone();if(this.isAllTime||e.isAllTime)return Rce.clone();const t=b(this.start)&&b(e.start)?new Date(Math.min(this.start.getTime(),e.start.getTime())):null,r=b(this.end)&&b(e.end)?new Date(Math.max(this.end.getTime(),e.end.getTime())):null;return new bp({start:t,end:r})}};u([d({type:Date,json:{write:{allowNull:!0}}})],ku.prototype,"end",void 0),u([$e("end")],ku.prototype,"readEnd",null),u([Xe("end")],ku.prototype,"writeEnd",null),u([d({readOnly:!0,json:{read:!1}})],ku.prototype,"isAllTime",null),u([d({readOnly:!0,json:{read:!1}})],ku.prototype,"isEmpty",null),u([d({type:Date,json:{write:{allowNull:!0}}})],ku.prototype,"start",void 0),u([$e("start")],ku.prototype,"readStart",null),u([Xe("start")],ku.prototype,"writeStart",null),ku=bp=u([$("esri.TimeExtent")],ku);const Rce=new ku,aZe=new ku({start:void 0,end:void 0}),vg=ku;var _Z;const Oce=new Tr({upperLeft:"upper-left",lowerLeft:"lower-left"});let hw=_Z=class extends ye{constructor(e){super(e),this.extent=null,this.mode="view",this.originPosition="upper-left",this.tolerance=1}clone(){return new _Z(re({extent:this.extent,mode:this.mode,originPosition:this.originPosition,tolerance:this.tolerance}))}};u([d({type:Kt,json:{write:{overridePolicy(){return{enabled:this.mode==="view"}}}}})],hw.prototype,"extent",void 0),u([d({type:["view","edit"],json:{write:!0}})],hw.prototype,"mode",void 0),u([d({type:String,json:{read:Oce.read,write:Oce.write}})],hw.prototype,"originPosition",void 0),u([d({type:Number,json:{write:{overridePolicy(){return{enabled:this.mode==="view"}}}}})],hw.prototype,"tolerance",void 0),hw=_Z=u([$("esri.rest.support.QuantizationParameters")],hw);const lZe=hw;var bZ;const Mce=new Tr({count:"count",sum:"sum",min:"min",max:"max",avg:"avg",stddev:"stddev",var:"var",exceedslimit:"exceedslimit",percentile_cont:"percentile-continuous",percentile_disc:"percentile-discrete",EnvelopeAggregate:"envelope-aggregate",CentroidAggregate:"centroid-aggregate",ConvexHullAggregate:"convex-hull-aggregate"});let wp=bZ=class extends ye{constructor(e){super(e),this.maxPointCount=void 0,this.maxRecordCount=void 0,this.maxVertexCount=void 0,this.onStatisticField=null,this.outStatisticFieldName=null,this.statisticType=null,this.statisticParameters=null}writeStatisticParameters(e,t){this.statisticType!=="percentile-continuous"&&this.statisticType!=="percentile-discrete"||(t.statisticParameters=re(e))}clone(){return new bZ({maxPointCount:this.maxPointCount,maxRecordCount:this.maxRecordCount,maxVertexCount:this.maxVertexCount,onStatisticField:this.onStatisticField,outStatisticFieldName:this.outStatisticFieldName,statisticType:this.statisticType,statisticParameters:re(this.statisticParameters)})}};u([d({type:Number,json:{write:!0}})],wp.prototype,"maxPointCount",void 0),u([d({type:Number,json:{write:!0}})],wp.prototype,"maxRecordCount",void 0),u([d({type:Number,json:{write:!0}})],wp.prototype,"maxVertexCount",void 0),u([d({type:String,json:{write:!0}})],wp.prototype,"onStatisticField",void 0),u([d({type:String,json:{write:!0}})],wp.prototype,"outStatisticFieldName",void 0),u([d({type:String,json:{read:{source:"statisticType",reader:Mce.read},write:{target:"statisticType",writer:Mce.write}}})],wp.prototype,"statisticType",void 0),u([d({type:Object})],wp.prototype,"statisticParameters",void 0),u([Xe("statisticParameters")],wp.prototype,"writeStatisticParameters",null),wp=bZ=u([$("esri.rest.support.StatisticDefinition")],wp);const oEe=wp;var dC;const cZe=new Tr({esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"envelope-intersects",esriSpatialRelIndexIntersects:"index-intersects",esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:"relation"}),uZe=new Tr({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"});let Mt=dC=class extends ye{constructor(e){super(e),this.aggregateIds=null,this.cacheHint=void 0,this.compactGeometryEnabled=!1,this.datumTransformation=null,this.defaultSpatialReferenceEnabled=!1,this.distance=void 0,this.dynamicDataSource=void 0,this.formatOf3DObjects=null,this.gdbVersion=null,this.geometry=null,this.geometryPrecision=void 0,this.groupByFieldsForStatistics=null,this.having=null,this.historicMoment=null,this.maxAllowableOffset=void 0,this.maxRecordCountFactor=1,this.multipatchOption=null,this.num=void 0,this.objectIds=null,this.orderByFields=null,this.outFields=null,this.outSpatialReference=null,this.outStatistics=null,this.parameterValues=null,this.pixelSize=null,this.quantizationParameters=null,this.rangeValues=null,this.relationParameter=null,this.resultType=null,this.returnCentroid=!1,this.returnDistinctValues=!1,this.returnExceededLimitFeatures=!0,this.returnGeometry=!1,this.returnQueryGeometry=!1,this.returnM=void 0,this.returnZ=void 0,this.sourceSpatialReference=null,this.spatialRelationship="intersects",this.start=void 0,this.sqlFormat=null,this.text=null,this.timeExtent=null,this.timeReferenceUnknownClient=!1,this.units=null,this.where=null}static from(e){return GC(dC,e)}castDatumTransformation(e){return typeof e=="number"||typeof e=="object"?e:null}writeHistoricMoment(e,t){t.historicMoment=e&&e.getTime()}writeParameterValues(e,t){if(e){const r={};for(const i in e){const s=e[i];Array.isArray(s)?r[i]=s.map(n=>n instanceof Date?n.getTime():n):s instanceof Date?r[i]=s.getTime():r[i]=s}t.parameterValues=r}}writeStart(e,t){t.resultOffset=this.start,t.resultRecordCount=this.num||10,t.where="1=1"}writeWhere(e,t){t.where=e||"1=1"}clone(){return new dC(re({aggregateIds:this.aggregateIds,cacheHint:this.cacheHint,compactGeometryEnabled:this.compactGeometryEnabled,datumTransformation:this.datumTransformation,defaultSpatialReferenceEnabled:this.defaultSpatialReferenceEnabled,distance:this.distance,gdbVersion:this.gdbVersion,geometry:this.geometry,geometryPrecision:this.geometryPrecision,groupByFieldsForStatistics:this.groupByFieldsForStatistics,having:this.having,historicMoment:b(this.historicMoment)?new Date(this.historicMoment.getTime()):null,maxAllowableOffset:this.maxAllowableOffset,maxRecordCountFactor:this.maxRecordCountFactor,multipatchOption:this.multipatchOption,num:this.num,objectIds:this.objectIds,orderByFields:this.orderByFields,outFields:this.outFields,outSpatialReference:this.outSpatialReference,outStatistics:this.outStatistics,parameterValues:this.parameterValues,pixelSize:this.pixelSize,quantizationParameters:this.quantizationParameters,rangeValues:this.rangeValues,relationParameter:this.relationParameter,resultType:this.resultType,returnDistinctValues:this.returnDistinctValues,returnGeometry:this.returnGeometry,returnCentroid:this.returnCentroid,returnExceededLimitFeatures:this.returnExceededLimitFeatures,returnQueryGeometry:this.returnQueryGeometry,returnM:this.returnM,returnZ:this.returnZ,dynamicDataSource:this.dynamicDataSource,sourceSpatialReference:this.sourceSpatialReference,spatialRelationship:this.spatialRelationship,start:this.start,sqlFormat:this.sqlFormat,text:this.text,timeExtent:this.timeExtent,timeReferenceUnknownClient:this.timeReferenceUnknownClient,units:this.units,where:this.where}))}};Mt.MAX_MAX_RECORD_COUNT_FACTOR=5,u([d({json:{write:!0}})],Mt.prototype,"aggregateIds",void 0),u([d({type:Boolean,json:{write:!0}})],Mt.prototype,"cacheHint",void 0),u([d({type:Boolean,json:{default:!1,write:!0}})],Mt.prototype,"compactGeometryEnabled",void 0),u([d({json:{write:!0}})],Mt.prototype,"datumTransformation",void 0),u([qt("datumTransformation")],Mt.prototype,"castDatumTransformation",null),u([d({type:Boolean,json:{default:!1,write:!0}})],Mt.prototype,"defaultSpatialReferenceEnabled",void 0),u([d({type:Number,json:{write:{overridePolicy:e=>({enabled:e>0})}}})],Mt.prototype,"distance",void 0),u([d({type:zp,json:{write:!0}})],Mt.prototype,"dynamicDataSource",void 0),u([d({type:String,json:{write:!0}})],Mt.prototype,"formatOf3DObjects",void 0),u([d({type:String,json:{write:!0}})],Mt.prototype,"gdbVersion",void 0),u([d({types:jT,json:{read:u0,write:!0}})],Mt.prototype,"geometry",void 0),u([d({type:Number,json:{write:!0}})],Mt.prototype,"geometryPrecision",void 0),u([d({type:[String],json:{write:!0}})],Mt.prototype,"groupByFieldsForStatistics",void 0),u([d({type:String,json:{write:!0}})],Mt.prototype,"having",void 0),u([d({type:Date})],Mt.prototype,"historicMoment",void 0),u([Xe("historicMoment")],Mt.prototype,"writeHistoricMoment",null),u([d({type:Number,json:{write:!0}})],Mt.prototype,"maxAllowableOffset",void 0),u([d({type:Number,cast:e=>e<1?1:e>dC.MAX_MAX_RECORD_COUNT_FACTOR?dC.MAX_MAX_RECORD_COUNT_FACTOR:e,json:{write:{overridePolicy:e=>({enabled:e>1})}}})],Mt.prototype,"maxRecordCountFactor",void 0),u([d({type:["xyFootprint"],json:{write:!0}})],Mt.prototype,"multipatchOption",void 0),u([d({type:Number,json:{read:{source:"resultRecordCount"}}})],Mt.prototype,"num",void 0),u([d({json:{write:!0}})],Mt.prototype,"objectIds",void 0),u([d({type:[String],json:{write:!0}})],Mt.prototype,"orderByFields",void 0),u([d({type:[String],json:{write:!0}})],Mt.prototype,"outFields",void 0),u([d({type:Ze,json:{name:"outSR",write:!0}})],Mt.prototype,"outSpatialReference",void 0),u([d({type:[oEe],json:{write:{enabled:!0,overridePolicy(){return{enabled:b(this.outStatistics)&&this.outStatistics.length>0}}}}})],Mt.prototype,"outStatistics",void 0),u([d({json:{write:!0}})],Mt.prototype,"parameterValues",void 0),u([Xe("parameterValues")],Mt.prototype,"writeParameterValues",null),u([d({type:at,json:{write:!0}})],Mt.prototype,"pixelSize",void 0),u([d({type:lZe,json:{write:!0}})],Mt.prototype,"quantizationParameters",void 0),u([d({type:[Object],json:{write:!0}})],Mt.prototype,"rangeValues",void 0),u([d({type:String,json:{read:{source:"relationParam"},write:{target:"relationParam",overridePolicy(){return{enabled:this.spatialRelationship==="relation"}}}}})],Mt.prototype,"relationParameter",void 0),u([d({type:String,json:{write:!0}})],Mt.prototype,"resultType",void 0),u([d({type:Boolean,json:{default:!1,write:!0}})],Mt.prototype,"returnCentroid",void 0),u([d({type:Boolean,json:{default:!1,write:!0}})],Mt.prototype,"returnDistinctValues",void 0),u([d({type:Boolean,json:{default:!0,write:!0}})],Mt.prototype,"returnExceededLimitFeatures",void 0),u([d({type:Boolean,json:{write:!0}})],Mt.prototype,"returnGeometry",void 0),u([d({type:Boolean,json:{default:!1,write:!0}})],Mt.prototype,"returnQueryGeometry",void 0),u([d({type:Boolean,json:{default:!1,write:!0}})],Mt.prototype,"returnM",void 0),u([d({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],Mt.prototype,"returnZ",void 0),u([d({type:Ze,json:{write:!0}})],Mt.prototype,"sourceSpatialReference",void 0),u([lt(cZe,{ignoreUnknown:!1,name:"spatialRel"})],Mt.prototype,"spatialRelationship",void 0),u([d({type:Number,json:{read:{source:"resultOffset"}}})],Mt.prototype,"start",void 0),u([Xe("start"),Xe("num")],Mt.prototype,"writeStart",null),u([d({type:String,json:{write:!0}})],Mt.prototype,"sqlFormat",void 0),u([d({type:String,json:{write:!0}})],Mt.prototype,"text",void 0),u([d({type:vg,json:{write:!0}})],Mt.prototype,"timeExtent",void 0),u([d({type:Boolean,json:{default:!1,write:!0}})],Mt.prototype,"timeReferenceUnknownClient",void 0),u([lt(uZe,{ignoreUnknown:!1}),d({json:{write:{overridePolicy(e){return{enabled:e&&this.distance>0}}}}})],Mt.prototype,"units",void 0),u([d({type:String,json:{write:{overridePolicy(e){return{enabled:e!=null||this.start>0}}}}})],Mt.prototype,"where",void 0),u([Xe("where")],Mt.prototype,"writeWhere",null),Mt=dC=u([$("esri.rest.support.Query")],Mt);const Sa=Mt;async function mG(e,t,r){const i=await hZe(e,t,r);return rL.fromJSON(i)}async function hZe(e,t,r){const i=Y2e(e),s={...r},n=Sa.from(t),{data:o}=await sEe(i,n,n.sourceSpatialReference,s);return o}function La(e,t){return e?t?4:3:t?3:2}const iL=fe.getLogger("esri.layers.graphics.featureConversionUtils"),aEe={esriGeometryPoint:0,esriGeometryPolyline:2,esriGeometryPolygon:3,esriGeometryMultipoint:0},lEe=(e,t,r,i,s,n)=>{e[r]=s,e[r+1]=n},lV=(e,t,r,i,s,n)=>{e[r]=s,e[r+1]=n,e[r+2]=t[i+2]},dZe=(e,t,r,i,s,n)=>{e[r]=s,e[r+1]=n,e[r+2]=t[i+3]},cEe=(e,t,r,i,s,n)=>{e[r]=s,e[r+1]=n,e[r+2]=t[i+2],e[r+3]=t[i+3]};function Qte(e,t,r,i){if(e){if(r)return t&&i?cEe:lV;if(t&&i)return dZe}else if(t&&i)return lV;return lEe}function gG({scale:e,translate:t},r){return Math.round((r-t[0])/e[0])}function yG({scale:e,translate:t},r){return Math.round((t[1]-r)/e[1])}function Pce({scale:e,translate:t},r){return r*e[0]+t[0]}function Ice({scale:e,translate:t},r){return t[1]-r*e[1]}function X$t(e,t,r){return e?t?r?ere(e):Jte(e):r?Kte(e):X6(e):null}function X6(e){const t=e.coords;return{x:t[0],y:t[1]}}function uEe(e,t){return e.coords[0]=t.x,e.coords[1]=t.y,e}function Jte(e){const t=e.coords;return{x:t[0],y:t[1],z:t[2]}}function pZe(e,t){return e.coords[0]=t.x,e.coords[1]=t.y,e.coords[2]=t.z,e}function Kte(e){const t=e.coords;return{x:t[0],y:t[1],m:t[2]}}function fZe(e,t){return e.coords[0]=t.x,e.coords[1]=t.y,e.coords[2]=t.m,e}function ere(e){const t=e.coords;return{x:t[0],y:t[1],z:t[2],m:t[3]}}function mZe(e,t){return e.coords[0]=t.x,e.coords[1]=t.y,e.coords[2]=t.z,e.coords[3]=t.m,e}function gZe(e,t,r,i){let s=X6;r&&i?s=ere:r?s=Jte:i&&(s=Kte);for(const n of t){const{geometry:o,attributes:a}=n,l=b(o)?s(o):null;e.push({attributes:a,geometry:l})}return e}function tre(e,t){return e&&t?mZe:e?pZe:t?fZe:uEe}function yZe(e,t,r,i,s){const n=tre(r,i);for(const o of t){const{geometry:a,attributes:l}=o;let c;a&&(c=n(new ec,a)),e.push(new ng(c,l,null,l[s]))}return e}function Z$t(e,t,r=tre(t.z!=null,t.m!=null)){return r(e,t)}function vZe(e,t,r,i){for(const s of t){const{geometry:n,attributes:o}=s;let a;n&&(a=hEe(n,r,i)),e.push({attributes:o,geometry:a})}return e}function hEe(e,t,r){if(R(e))return null;const i=La(t,r),s=[];for(let n=0;n<e.coords.length;n+=i){const o=[];for(let a=0;a<i;a++)o.push(e.coords[n+a]);s.push(o)}return t?r?{points:s,hasZ:t,hasM:r}:{points:s,hasZ:t}:r?{points:s,hasM:r}:{points:s}}function _Ze(e,t,r,i,s){const n=La(r,i);for(const o of t){const a=o.geometry,l=o.attributes;let c;a&&(c=dEe(new ec,a,n)),e.push(new ng(c,l,null,l[s]))}return e}function dEe(e,t,r=La(t.hasZ,t.hasM)){e.lengths[0]=t.points.length;const i=e.coords;let s=0;for(const n of t.points)for(let o=0;o<r;o++)i[s++]=n[o];return e}function bZe(e,t,r,i){for(const s of t){const{geometry:n,attributes:o}=s;let a;b(n)&&(a=pEe(n,r,i)),e.push({attributes:o,geometry:a})}return e}function pEe(e,t,r){if(!e)return null;const i=La(t,r),{coords:s,lengths:n}=e,o=[];let a=0;for(const l of n){const c=[];for(let h=0;h<l;h++){const p=[];for(let f=0;f<i;f++)p.push(s[a++]);c.push(p)}o.push(c)}return t?r?{paths:o,hasZ:t,hasM:r}:{paths:o,hasZ:t}:r?{paths:o,hasM:r}:{paths:o}}function wZe(e,t,r,i,s){const n=La(r,i);for(const o of t){const a=o.geometry,l=o.attributes;let c;a&&(c=fEe(new ec,a,n)),e.push(new ng(c,l,null,l[s]))}return e}function fEe(e,t,r=La(t.hasZ,t.hasM)){const{lengths:i,coords:s}=e;let n=0;for(const o of t.paths){for(const a of o)for(let l=0;l<r;l++)s[n++]=a[l];i.push(o.length)}return e}function xZe(e,t,r,i){for(const s of t){const{geometry:n,attributes:o,centroid:a}=s;let l;if(b(n)&&(l=mEe(n,r,i)),b(a)){const c=X6(a);e.push({attributes:o,centroid:c,geometry:l})}else e.push({attributes:o,geometry:l})}return e}function mEe(e,t,r){if(!e)return null;const i=La(t,r),{coords:s,lengths:n}=e,o=[];let a=0;for(const l of n){const c=[];for(let h=0;h<l;h++){const p=[];for(let f=0;f<i;f++)p.push(s[a++]);c.push(p)}o.push(c)}return t?r?{rings:o,hasZ:t,hasM:r}:{rings:o,hasZ:t}:r?{rings:o,hasM:r}:{rings:o}}function TZe(e,t,r,i,s){for(const n of t){const o=n.geometry,a=n.centroid,l=n.attributes;let c;o&&(c=gEe(new ec,o,r,i)),b(a)?e.push(new ng(c,l,uEe(new ec,a),l[s])):e.push(new ng(c,l,null,l[s]))}return e}function gEe(e,t,r=t.hasZ,i=t.hasM){return SZe(e,t.rings,r,i),e}function SZe(e,t,r,i){const s=La(r,i),{lengths:n,coords:o}=e;let a=0;n.length=o.length=0;for(const l of t){for(const c of l)for(let h=0;h<s;h++)o[a++]=c[h];n.push(l.length)}return e}const pC=[],rP=[];function Y$t(e,t,r,i,s){pC[0]=e;const[n]=yEe(rP,pC,t,r,i,s);return pC.length=rP.length=0,n}function yEe(e,t,r,i,s,n){if(e.length=0,!r){for(const o of t){const a=o.attributes[n];e.push(new ng(null,o.attributes,null,a))}return e}switch(r){case"esriGeometryPoint":return yZe(e,t,i,s,n);case"esriGeometryMultipoint":return _Ze(e,t,i,s,n);case"esriGeometryPolyline":return wZe(e,t,i,s,n);case"esriGeometryPolygon":return TZe(e,t,i,s,n);default:iL.error("convertToFeatureSet:unknown-geometry",new j(`Unable to parse unknown geometry type '${r}'`)),e.length=0}return e}function Q$t(e,t,r,i){rP[0]=e,vEe(pC,rP,t,r,i);const s=pC[0];return pC.length=rP.length=0,s}function EZe(e,t,r){if(R(e))return null;const i=new ec;return"hasZ"in e&&t==null&&(t=e.hasZ),"hasM"in e&&r==null&&(r=e.hasM),Aee(e)?tre(t!=null?t:e.z!=null,r!=null?r:e.m!=null)(i,e):Lx(e)?gEe(i,e,t,r):Ree(e)?fEe(i,e,La(t,r)):Cee(e)?dEe(i,e,La(t,r)):void iL.error("convertFromGeometry:unknown-geometry",new j(`Unable to parse unknown geometry type '${e}'`))}function CZe(e,t,r,i){const s=e&&("coords"in e?e:e.geometry);if(R(s))return null;switch(t){case"esriGeometryPoint":{let n=X6;return r&&i?n=ere:r?n=Jte:i&&(n=Kte),n(s)}case"esriGeometryMultipoint":return hEe(s,r,i);case"esriGeometryPolyline":return pEe(s,r,i);case"esriGeometryPolygon":return mEe(s,r,i);default:return void iL.error("convertToGeometry:unknown-geometry",new j(`Unable to parse unknown geometry type '${t}'`))}}function AZe(e,t){for(const r of t)e.push({attributes:r.attributes});return e}function vEe(e,t,r,i,s){if(e.length=0,R(r))return AZe(e,t);switch(r){case"esriGeometryPoint":return gZe(e,t,i,s);case"esriGeometryMultipoint":return vZe(e,t,i,s);case"esriGeometryPolyline":return bZe(e,t,i,s);case"esriGeometryPolygon":return xZe(e,t,i,s);default:iL.error("convertToFeatureSet:unknown-geometry",new j(`Unable to parse unknown geometry type '${r}'`))}return e}function J$t(e){const{objectIdFieldName:t,spatialReference:r,transform:i,fields:s,hasM:n,hasZ:o,features:a,geometryType:l,exceededTransferLimit:c,uniqueIdField:h,queryGeometry:p,queryGeometryType:f}=e,m={features:vEe([],a,l,o,n),fields:s,geometryType:l,objectIdFieldName:t,spatialReference:r,uniqueIdField:h,queryGeometry:CZe(p,f,!1,!1)};return i&&(m.transform=i),c&&(m.exceededTransferLimit=c),n&&(m.hasM=n),o&&(m.hasZ=o),m}function K$t(e,t){const r=new W6,{hasM:i,hasZ:s,features:n,objectIdFieldName:o,spatialReference:a,geometryType:l,exceededTransferLimit:c,transform:h,fields:p}=e;return p&&(r.fields=p),r.geometryType=l,r.objectIdFieldName=o||t,r.spatialReference=a,r.objectIdFieldName?(n&&yEe(r.features,n,l,s,i,r.objectIdFieldName),c&&(r.exceededTransferLimit=c),i&&(r.hasM=i),s&&(r.hasZ=s),h&&(r.transform=h),r):(iL.error(new j("optimized-features:invalid-objectIdFieldName","objectIdFieldName is missing")),r)}function eLt(e){const{transform:t,features:r,hasM:i,hasZ:s}=e;if(!t)return e;for(const n of r)b(n.geometry)&&Lce(n.geometry,n.geometry,i,s,t),b(n.centroid)&&Lce(n.centroid,n.centroid,i,s,t);return e.transform=null,e}function tLt(e,t){const{geometryType:r,features:i,hasM:s,hasZ:n}=t;if(!e)return t;for(let o=0;o<i.length;o++){const a=i[o],l=a.weakClone();l.geometry=new ec,$ce(l.geometry,a.geometry,s,n,r,e),a.centroid&&(l.centroid=new ec,$ce(l.centroid,a.centroid,s,n,"esriGeometryPoint",e)),i[o]=l}return t.transform=e,t}function $ce(e,t,r,i,s,n,o=r,a=i){if(e.lengths.length&&(e.lengths.length=0),e.coords.length&&(e.coords.length=0),R(t)||!t.coords.length)return null;const l=aEe[s],{coords:c,lengths:h}=t,p=La(r,i),f=La(r&&o,i&&a),m=Qte(r,i,o,a);if(!h.length)return m(e.coords,c,0,0,gG(n,c[0]),yG(n,c[1])),e.lengths.length&&(e.lengths.length=0),e.coords.length=p,e;let g,v,w,_,T=0,x=0,E=x;for(const C of h){if(C<l)continue;let A=0;x=E,w=g=gG(n,c[T]),_=v=yG(n,c[T+1]),m(e.coords,c,x,T,w,_),A++,T+=p,x+=f;for(let P=1;P<C;P++,T+=p)w=gG(n,c[T]),_=yG(n,c[T+1]),w===g&&_===v||(m(e.coords,c,x,T,w-g,_-v),x+=f,A++,g=w,v=_);A>=l&&(e.lengths.push(A),E=x)}return e.coords.length=E,e.coords.length?e:null}function rLt(e,t,r,i,s,n,o=r,a=i){if(e.lengths.length&&(e.lengths.length=0),e.coords.length&&(e.coords.length=0),!t||!t.coords.length)return null;const l=aEe[s],{coords:c,lengths:h}=t,p=La(r,i),f=La(r&&o,i&&a),m=Qte(r,i,o,a);if(!h.length)return m(e.coords,c,0,0,c[0],c[1]),e.lengths.length&&(e.lengths.length=0),e.coords.length=p,e;let g=0;const v=n*n;for(const w of h){if(w<l){g+=w*p;continue}const _=e.coords.length/f,T=g,x=g+(w-1)*p;m(e.coords,c,e.coords.length,T,c[T],c[T+1]),wZ(e.coords,c,p,v,m,T,x),m(e.coords,c,e.coords.length,x,c[x],c[x+1]);const E=e.coords.length/f-_;E>=l?e.lengths.push(E):e.coords.length=_*f,g+=w*p}return e.coords.length?e:null}function RZe(e,t,r,i){const s=e[t],n=e[t+1],o=e[r],a=e[r+1],l=e[i],c=e[i+1];let h=o,p=a,f=l-h,m=c-p;if(f!==0||m!==0){const g=((s-h)*f+(n-p)*m)/(f*f+m*m);g>1?(h=l,p=c):g>0&&(h+=f*g,p+=m*g)}return f=s-h,m=n-p,f*f+m*m}function wZ(e,t,r,i,s,n,o){let a,l=i,c=0;for(let h=n+r;h<o;h+=r)a=RZe(t,h,n,o),a>l&&(c=h,l=a);l>i&&(c-n>r&&wZ(e,t,r,i,s,n,c),s(e,t,e.length,c,t[c],t[c+1]),o-c>r&&wZ(e,t,r,i,s,c,o))}function iLt(e,t,r,i){if(R(t)||!t.coords||!t.coords.length)return null;const s=La(r,i);let n=Number.POSITIVE_INFINITY,o=Number.POSITIVE_INFINITY,a=Number.NEGATIVE_INFINITY,l=Number.NEGATIVE_INFINITY;if(t&&t.coords){const c=t.coords;for(let h=0;h<c.length;h+=s){const p=c[h],f=c[h+1];n=Math.min(n,p),a=Math.max(a,p),o=Math.min(o,f),l=Math.max(l,f)}}return e[0]=n,e[1]=o,e[2]=a,e[3]=l,e}function Lce(e,t,r,i,s){const{coords:n,lengths:o}=t,a=r?i?cEe:lV:i?lV:lEe,l=La(r,i);if(!n.length)return e!==t&&(e.lengths.length=0,e.coords.length=0),e;if(!o.length)return a(e.coords,n,0,0,Pce(s,n[0]),Ice(s,n[1])),e!==t&&(e.lengths.length=0,e.coords.length=l),e;const[c,h]=s.scale;let p=0;for(let f=0;f<o.length;f++){const m=o[f];e.lengths[f]=m;let g=Pce(s,n[p]),v=Ice(s,n[p+1]);a(e.coords,n,p,p,g,v),p+=l;for(let w=1;w<m;w++,p+=l)g+=n[p]*c,v-=n[p+1]*h,a(e.coords,n,p,p,g,v)}return e!==t&&(e.lengths.length=o.length,e.coords.length=n.length),e}function sLt(e,t,r,i,s,n){const o=La(r,i),a=Qte(r,i,s,n),l=t.coords;e.coords.length=0,e.lengths.length=0,e.lengths.push(...t.lengths);for(let c=0;c<l.length;c+=o)a(e.coords,l,e.coords.length,c,l[c],l[c+1]);return e}function OZe(e,t,r,i){let s=0,n=e[i*t],o=e[i*(t+1)];for(let a=1;a<r;a++){const l=n+e[i*(t+a)],c=o+e[i*(t+a)+1],h=(l-n)*(c+o);n=l,o=c,s+=h}return .5*s}function nLt(e,t){const{coords:r,lengths:i}=e;let s=0,n=0;for(let o=0;o<i.length;o++)n+=OZe(r,s,i[o],t),s+=o;return Math.abs(n)}function oLt(e,t){if(R(e))return null;const r=e.clone(),i=e.coords,s=e.lengths;let n=0;for(let o=0;o<s.length;o++){const a=s[o];let l=i[t*n],c=i[t*n+1];for(let h=1;h<a;h++){const p=l+i[t*(n+h)],f=c+i[t*(n+h)+1];r.coords[t*(n+h)]=p,r.coords[t*(n+h)+1]=f,l=p,c=f}n+=a}return r}var xZ;let As=xZ=class extends ye{constructor(e){super(e),this.cacheHint=void 0,this.dynamicDataSource=void 0,this.gdbVersion=null,this.geometryPrecision=void 0,this.historicMoment=null,this.maxAllowableOffset=void 0,this.objectIds=null,this.orderByFields=null,this.outFields=null,this.outSpatialReference=null,this.relationshipId=void 0,this.start=void 0,this.num=void 0,this.returnGeometry=!1,this.returnM=void 0,this.returnZ=void 0,this.where=null}_writeHistoricMoment(e,t){t.historicMoment=e&&e.getTime()}writeStart(e,t){t.resultOffset=this.start,t.resultRecordCount=this.num||10,this.start>0&&this.where==null&&(t.definitionExpression="1=1")}clone(){return new xZ(re({cacheHint:this.cacheHint,dynamicDataSource:this.dynamicDataSource,gdbVersion:this.gdbVersion,geometryPrecision:this.geometryPrecision,historicMoment:this.historicMoment&&new Date(this.historicMoment.getTime()),maxAllowableOffset:this.maxAllowableOffset,objectIds:this.objectIds,orderByFields:this.orderByFields,outFields:this.outFields,outSpatialReference:this.outSpatialReference,relationshipId:this.relationshipId,start:this.start,num:this.num,returnGeometry:this.returnGeometry,where:this.where,returnZ:this.returnZ,returnM:this.returnM}))}};u([d({type:Boolean,json:{write:!0}})],As.prototype,"cacheHint",void 0),u([d({type:zp,json:{write:!0}})],As.prototype,"dynamicDataSource",void 0),u([d({type:String,json:{write:!0}})],As.prototype,"gdbVersion",void 0),u([d({type:Number,json:{write:!0}})],As.prototype,"geometryPrecision",void 0),u([d({type:Date})],As.prototype,"historicMoment",void 0),u([Xe("historicMoment")],As.prototype,"_writeHistoricMoment",null),u([d({type:Number,json:{write:!0}})],As.prototype,"maxAllowableOffset",void 0),u([d({type:[Number],json:{write:!0}})],As.prototype,"objectIds",void 0),u([d({type:[String],json:{write:!0}})],As.prototype,"orderByFields",void 0),u([d({type:[String],json:{write:!0}})],As.prototype,"outFields",void 0),u([d({type:Ze,json:{read:{source:"outSR"},write:{target:"outSR"}}})],As.prototype,"outSpatialReference",void 0),u([d({json:{write:!0}})],As.prototype,"relationshipId",void 0),u([d({type:Number,json:{read:{source:"resultOffset"}}})],As.prototype,"start",void 0),u([Xe("start"),Xe("num")],As.prototype,"writeStart",null),u([d({type:Number,json:{read:{source:"resultRecordCount"}}})],As.prototype,"num",void 0),u([d({json:{write:!0}})],As.prototype,"returnGeometry",void 0),u([d({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],As.prototype,"returnM",void 0),u([d({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],As.prototype,"returnZ",void 0),u([d({type:String,json:{read:{source:"definitionExpression"},write:{target:"definitionExpression"}}})],As.prototype,"where",void 0),As=xZ=u([$("esri.rest.support.RelationshipQuery")],As),As.from=en(As);const TZ=As;var SZ;let $2=SZ=class extends ye{constructor(e){super(e),this.groupByFields=void 0,this.topCount=void 0,this.orderByFields=void 0}clone(){return new SZ({groupByFields:this.groupByFields,topCount:this.topCount,orderByFields:this.orderByFields})}};u([d({type:[String],json:{write:!0}})],$2.prototype,"groupByFields",void 0),u([d({type:Number,json:{write:!0}})],$2.prototype,"topCount",void 0),u([d({type:[String],json:{write:!0}})],$2.prototype,"orderByFields",void 0),$2=SZ=u([$("esri.rest.support.TopFilter")],$2);const MZe=$2;var EZ;const Dce=new Tr({esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"envelope-intersects",esriSpatialRelIndexIntersects:"index-intersects",esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:"relation"}),Nce=new Tr({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"});let os=EZ=class extends ye{constructor(e){super(e),this.cacheHint=void 0,this.distance=void 0,this.geometry=null,this.geometryPrecision=void 0,this.maxAllowableOffset=void 0,this.num=void 0,this.objectIds=null,this.orderByFields=null,this.outFields=null,this.outSpatialReference=null,this.resultType=null,this.returnGeometry=!1,this.returnM=void 0,this.returnZ=void 0,this.start=void 0,this.spatialRelationship="intersects",this.timeExtent=null,this.topFilter=void 0,this.units=null,this.where="1=1"}writeStart(e,t){t.resultOffset=this.start,t.resultRecordCount=this.num||10}clone(){return new EZ(re({cacheHint:this.cacheHint,distance:this.distance,geometry:this.geometry,geometryPrecision:this.geometryPrecision,maxAllowableOffset:this.maxAllowableOffset,num:this.num,objectIds:this.objectIds,orderByFields:this.orderByFields,outFields:this.outFields,outSpatialReference:this.outSpatialReference,resultType:this.resultType,returnGeometry:this.returnGeometry,returnZ:this.returnZ,returnM:this.returnM,start:this.start,spatialRelationship:this.spatialRelationship,timeExtent:this.timeExtent,topFilter:this.topFilter,units:this.units,where:this.where}))}};u([d({type:Boolean,json:{write:!0}})],os.prototype,"cacheHint",void 0),u([d({type:Number,json:{write:{overridePolicy:e=>({enabled:e>0})}}})],os.prototype,"distance",void 0),u([d({types:jT,json:{read:u0,write:!0}})],os.prototype,"geometry",void 0),u([d({type:Number,json:{write:!0}})],os.prototype,"geometryPrecision",void 0),u([d({type:Number,json:{write:!0}})],os.prototype,"maxAllowableOffset",void 0),u([d({type:Number,json:{read:{source:"resultRecordCount"}}})],os.prototype,"num",void 0),u([d({json:{write:!0}})],os.prototype,"objectIds",void 0),u([d({type:[String],json:{write:!0}})],os.prototype,"orderByFields",void 0),u([d({type:[String],json:{write:!0}})],os.prototype,"outFields",void 0),u([d({type:Ze,json:{read:{source:"outSR"},write:{target:"outSR"}}})],os.prototype,"outSpatialReference",void 0),u([d({type:String,json:{write:!0}})],os.prototype,"resultType",void 0),u([d({json:{write:!0}})],os.prototype,"returnGeometry",void 0),u([d({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],os.prototype,"returnM",void 0),u([d({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],os.prototype,"returnZ",void 0),u([d({type:Number,json:{read:{source:"resultOffset"}}})],os.prototype,"start",void 0),u([Xe("start"),Xe("num")],os.prototype,"writeStart",null),u([d({type:String,json:{read:{source:"spatialRel",reader:Dce.read},write:{target:"spatialRel",writer:Dce.write}}})],os.prototype,"spatialRelationship",void 0),u([d({type:vg,json:{write:!0}})],os.prototype,"timeExtent",void 0),u([d({type:MZe,json:{write:!0}})],os.prototype,"topFilter",void 0),u([d({type:String,json:{read:Nce.read,write:{writer:Nce.write,overridePolicy(e){return{enabled:e&&this.distance>0}}}}})],os.prototype,"units",void 0),u([d({type:String,json:{write:!0}})],os.prototype,"where",void 0),os=EZ=u([$("esri.rest.support.TopFeaturesQuery")],os),os.from=en(os);const qD=os,PZe="esri.widgets.Feature.support.relatedFeatureUtils",Fce=fe.getLogger(PZe),kce=new Map;function CZ(e){if(!Ny(e))return null;const[t,r]=e.split("/").slice(1);return{layerId:t,fieldName:r}}function IZe(e,t){if(!t.relationships)return null;let r=null;const{relationships:i}=t;return i.some(s=>s.id===parseInt(e,10)&&(r=s,!0)),r}function $Ze({originRelationship:e,relationships:t,layerId:r}){let i;return t&&t.some(s=>(`${s.relatedTableId}`===r&&s.id===e.id&&(i=s),!!i)),i}function LZe(e,t){const r=t.toLowerCase();for(const i in e)if(i.toLowerCase()===r)return e[i];return null}function DZe(e,t){const r=IZe(e,t);if(!!r)return{url:`${t.url}/${r.relatedTableId}`,sourceSpatialReference:t.spatialReference,relation:r,relatedFields:[],outStatistics:[]}}function NZe(e,t){if(!t||!e)return;const{features:r,statsFeatures:i}=e,s=r&&r.value;t.relatedFeatures=s?s.features:[];const n=i&&i.value;t.relatedStatsFeatures=n?n.features:[]}function FZe(e,t,r,i){const s=new TZ;return s.outFields=["*"],s.relationshipId=typeof t.id=="number"?t.id:parseInt(t.id,10),s.objectIds=[e.attributes[r.objectIdField]],r.queryRelatedFeatures(s,i)}function kZe(e,t,r){let i=0;const s=[];for(;i<t.length;)s.push(`${e} IN (${t.slice(i,r+i)})`),i+=r;return s.join(" OR ")}async function UZe(e,t,r,i){const s=r.layerId.toString(),{layerInfo:n,relation:o,relatedFields:a,outStatistics:l,url:c,sourceSpatialReference:h}=t,p=$Ze({originRelationship:o,relationships:n.relationships,layerId:s});if(p.relationshipTableId&&p.keyFieldInRelationshipTable){const m=(await FZe(e,p,r,i))[e.attributes[r.objectIdField]];if(!m)return null;const g=m.features.map(v=>v.attributes[n.objectIdField]);if((l==null?void 0:l.length)>0&&n.supportsStatistics){const v=new Sa;v.where=kZe(n.objectIdField,g,1e3),v.outFields=a,v.outStatistics=l,v.sourceSpatialReference=h;const w={features:Promise.resolve(m),statsFeatures:mG(c,v)};return xs(w)}}const f=p==null?void 0:p.keyField;if(f){const m=r6(jZe(n.fields,f)),g=LZe(e.attributes,o.keyField),v=m?`${f}=${g}`:`${f}='${g}'`,w=mG(c,new Sa({where:v,outFields:t.relatedFields,sourceSpatialReference:h}),i),_=t.outStatistics&&t.outStatistics.length>0&&n.supportsStatistics?mG(c,new Sa({where:v,outFields:t.relatedFields,outStatistics:t.outStatistics,sourceSpatialReference:h}),i):null,T={features:w};return _&&(T.statsFeatures=_),xs(T)}return null}function VZe(e,t){return er(e,{query:{f:"json"},signal:t&&t.signal})}function zZe({relatedInfos:e,layer:t},r){const i={};return e.forEach((s,n)=>{const{relation:o}=s;if(!o){const p=new j("relation-required","A relation is required on a layer to retrieve related records.");throw Fce.error(p),p}const{relatedTableId:a}=o;if(typeof a!="number"){const p=new j("A related table ID is required on a layer to retrieve related records.");throw Fce.error(p),p}const l=`${t.url}/${a}`,c=kce.get(l),h=c||VZe(l,r);c||kce.set(l,h),i[n]=h}),xs(i)}function BZe({graphic:e,relatedInfos:t,layer:r},i){const s={};return t.forEach((n,o)=>{n.layerInfo&&(s[o]=UZe(e,n,r,i))}),xs(s)}function GZe({relatedInfo:e,fieldName:t,fieldInfo:r}){if(e.relatedFields.push(t),r.statisticType){const i=new oEe({statisticType:r.statisticType,onStatisticField:t,outStatisticFieldName:t});e.outStatistics.push(i)}}function jZe(e,t){if(e!=null){t=t.toLowerCase();for(const r of e)if(r&&r.name.toLowerCase()===t)return r}return null}const Uce={chartAnimation:!0};let fo=class extends xe{constructor(e){super(e),this.abilities={...Uce},this.activeMediaInfoIndex=0,this.attributes=null,this.description=null,this.fieldInfoMap=null,this.formattedAttributes=null,this.expressionAttributes=null,this.layer=null,this.mediaInfos=null,this.popupTemplate=null,this.relatedInfos=null,this.title=null}castAbilities(e){return{...Uce,...e}}get activeMediaInfo(){return this.formattedMediaInfos[this.activeMediaInfoIndex]||null}get formattedMediaInfos(){return this._formatMediaInfos()||[]}get formattedMediaInfoCount(){return this.formattedMediaInfos.length}setActiveMedia(e){this._setContentElementMedia(e)}next(){this._pageContentElementMedia(1)}previous(){this._pageContentElementMedia(-1)}_setContentElementMedia(e){const{formattedMediaInfoCount:t}=this,r=(e+t)%t;this.activeMediaInfoIndex=r}_pageContentElementMedia(e){const{activeMediaInfoIndex:t}=this,r=t+e;this._setContentElementMedia(r)}_formatMediaInfos(){const{attributes:e,mediaInfos:t,formattedAttributes:r,expressionAttributes:i,fieldInfoMap:s,layer:n}=this;return t==null?void 0:t.map(o=>{const a=o==null?void 0:o.clone();if(!a)return null;if(a.title=_x({attributes:e,fieldInfoMap:s,globalAttributes:r,expressionAttributes:i,layer:n,text:a.title}),a.caption=_x({attributes:e,fieldInfoMap:s,globalAttributes:r,expressionAttributes:i,layer:n,text:a.caption}),a.altText=_x({attributes:e,fieldInfoMap:s,globalAttributes:r,expressionAttributes:i,layer:n,text:a.altText}),a.type==="image"){const{value:l}=a;return this._setImageValue({value:l,formattedAttributes:r,layer:n}),a.value.sourceURL?a:void 0}if(a.type==="pie-chart"||a.type==="line-chart"||a.type==="column-chart"||a.type==="bar-chart"){const{value:l}=a;return this._setChartValue({value:l,chartType:a.type,attributes:e,formattedAttributes:r,layer:n}),a}return null}).filter(Boolean)}_setImageValue(e){const{fieldInfoMap:t}=this,{value:r,formattedAttributes:i,layer:s}=e,{linkURL:n,sourceURL:o}=r;if(o){const a=QX(o,s);r.sourceURL=YX({formattedAttributes:i,template:a,fieldInfoMap:t})}if(n){const a=QX(n,s);r.linkURL=YX({formattedAttributes:i,template:a,fieldInfoMap:t})}}_setChartValue(e){const{value:t,attributes:r,formattedAttributes:i,chartType:s,layer:n}=e,{popupTemplate:o,relatedInfos:a}=this,{fields:l,normalizeField:c}=t;if(t.fields=sqe(l,n),c&&(t.normalizeField=KU(c,n)),!l.some(p=>!!(i[p]!=null||Ny(p)&&a.size)))return;const h=o==null?void 0:o.fieldInfos;l.forEach(p=>{if(Ny(p))return void(t.series=[...t.series,...this._getRelatedChartInfos({fieldInfos:h,fieldName:p,formattedAttributes:i,chartType:s,value:t})]);const f=this._getChartOption({value:t,attributes:r,chartType:s,formattedAttributes:i,fieldName:p,fieldInfos:h});t.series.push(f)})}_getRelatedChartInfos(e){var g;const{fieldInfos:t,fieldName:r,formattedAttributes:i,chartType:s,value:n}=e,o=[],a=CZ(r),{layerId:l,fieldName:c}=a,h=(g=this.relatedInfos)==null?void 0:g.get(l.toString());if(!h)return o;const{relatedFeatures:p,relation:f}=h;if(!f||!p)return o;const{cardinality:m}=f;return p.forEach(v=>{const{attributes:w}=v;w&&Object.keys(w).forEach(_=>{_===c&&o.push(this._getChartOption({value:n,attributes:w,formattedAttributes:i,fieldName:r,chartType:s,relatedFieldName:_,fieldInfos:t}))})}),m==="one-to-many"||m==="many-to-many"?o:[o[0]]}_getTooltip({label:e,value:t,chartType:r}){return r==="pie-chart"?`${e}`:`${e}: ${t}`}_getChartOption(e){var x,E,C,A,P,I;const{value:t,attributes:r,formattedAttributes:i,fieldName:s,relatedFieldName:n,fieldInfos:o,chartType:a}=e,{layer:l,fieldInfoMap:c}=this,{normalizeField:h,tooltipField:p}=t,f=h?Ny(h)?r[CZ(h).fieldName]:r[h]:null,m=n&&r[n]!==void 0?r[n]:r[s]!==void 0?r[s]:i[s],g=new Mwe({fieldName:s,value:m===void 0?null:m&&f?m/f:m});if(Ny(s)){const L=c.get(s.toLowerCase()),k=c.get(p.toLowerCase()),G=(x=L==null?void 0:L.fieldName)!=null?x:s,z=(P=(A=(C=i[(E=k==null?void 0:k.fieldName)!=null?E:p])!=null?C:L==null?void 0:L.label)!=null?A:L==null?void 0:L.fieldName)!=null?P:n,X=i[G];return g.tooltip=this._getTooltip({label:z,value:X,chartType:a}),g}const v=y2e(o,s),w=KU(s,l),_=p&&i[p]!==void 0?i[p]:m2e(v||new W$({fieldName:w}),(I=this.popupTemplate)==null?void 0:I.expressionInfos),T=i[w];return g.tooltip=this._getTooltip({label:_,value:T,chartType:a}),g}};u([d()],fo.prototype,"abilities",void 0),u([qt("abilities")],fo.prototype,"castAbilities",null),u([d()],fo.prototype,"activeMediaInfoIndex",void 0),u([d({readOnly:!0})],fo.prototype,"activeMediaInfo",null),u([d()],fo.prototype,"attributes",void 0),u([d()],fo.prototype,"description",void 0),u([d()],fo.prototype,"fieldInfoMap",void 0),u([d()],fo.prototype,"formattedAttributes",void 0),u([d()],fo.prototype,"expressionAttributes",void 0),u([d({readOnly:!0})],fo.prototype,"formattedMediaInfos",null),u([d()],fo.prototype,"layer",void 0),u([d({readOnly:!0})],fo.prototype,"formattedMediaInfoCount",null),u([d()],fo.prototype,"mediaInfos",void 0),u([d()],fo.prototype,"popupTemplate",void 0),u([d()],fo.prototype,"relatedInfos",void 0),u([d()],fo.prototype,"title",void 0),fo=u([$("esri.widgets.Feature.FeatureMedia.FeatureMediaViewModel")],fo);const wx=fo;var Vce=["#ffffff","#858585","#ffbebe","#ffebbe","#ffebaf","#ffffbe","#e9ffbe","#d3ffbe","#beffe8","#bee8ff","#bed2ff","#e8beff","#ffbee8","#ebebeb","#707070","#ff7f7f","#ffa77f","#ffd37f","#ffff73","#d1ff73","#a3ff73","#73ffdf","#73dfff","#73b2ff","#df73ff","#ff73df","#d6d6d6","#5c5c5c","#ff0000","#ff5500","#ffaa00","#ffff00","#aaff00","#55ff00","#00ffc5","#00c5ff","#0070ff","#c500ff","#ff00c5","#c2c2c2","#474747","#e60000","#e64c00","#e69800","#e6e600","#98e600","#4ce600","#00e6a9","#00a9e6","#005ce6","#a900e6","#e600a9","#adadad","#242424","#a80000","#a83800","#a87000","#a8a800","#70a800","#38a800","#00a884","#0084a8","#004da8","#8400a8","#a80084","#999999","#1a1a1a","#730000","#732600","#734c00","#737300","#4c7300","#267300","#00734c","#004c73","#002673","#4c0073","#73004"],HZe=[].concat(Vce.slice(30,39),Vce.slice(28,30).reverse()),qZe=[{name:"default",colors:HZe},{name:"cat-dark",colors:["#ed5151","#149ece","#a7c636","#9e559c","#fc921f","#ffde3e","#f789d8","#b7814a","#3caf99","#6b6bd6","#b54779","#7f7f7f"]},{name:"tropical-bliss",colors:["#fce138","#ff9399","#fcd27e","#f1983c","#a553b7","#b1a9d0","#6ecffc","#4c81cd","#fc6f84","#fc3e5a","#6af689","#48885c"]},{name:"desert-blooms",colors:["#102432","#144d59","#ffc730","#ed9310","#a64f1b","#661510","#d9351a","#b31515","#4a0932","#8c213f","#18382e","#2c6954"]},{name:"under-the-sea",colors:["#bf9727","#607100","#00734c","#704489","#01acca","#024e76","#f09100","#ea311f","#c6004b","#7570b3","#666666","#333333"]},{name:"vibrant-rainbow",colors:["#fffb00","#f5cb11","#9fd40c","#46e39c","#32b8a6","#7ff2fa","#ac08cc","#dd33ff","#eb7200","#e8a784","#bf2e2e","#6c7000"]},{name:"ocean-bay",colors:["#191921","#11495c","#78b1c2","#454f4b","#8f8f82","#9be0c0","#87b051","#f7ec88","#ebdcc1","#dbb658","#c43541","#75351e"]},{name:"prairie-summer",colors:["#332424","#751555","#d47013","#d68989","#211173","#82aad6","#7bfaeb","#6ec9a8","#6b6408","#eada40","#ccc54a","#1fc235"]},{name:"pastel-chalk",colors:["#fffd99","#f5e6a4","#c1d48c","#b8e3d0","#a0b8b5","#cbf7fa","#d791f2","#dfc1eb","#f2b983","#e8c4b2","#bf8e8e","#94995c"]},{name:"seq-yellow-orange-red-bright",colors:["#910000","#b1260b","#c0370f","#e05919","#ef6a1d","#ff7b22","#ffa143","#ffb454","#ffda74","#ffed85"]},{name:"seq-reds-bright",colors:["#57453b","#7b4238","#9f4036","#c23d33","#d7483c","#ec5244","#f3696c","#f9816c","#ffc4ae","#fff0dc"]},{name:"seq-purples-bright",colors:["#4e465c","#5a4a78","#695291","#775baa","#8663c3","#946bdc","#aa89e8","#c1a6f3","#d7c4ff","#e6e1ff"]},{name:"seq-blues-bright",colors:["#404d54","#435c6c","#48799d","#4b88b6","#4d96ce","#50a5e7","#74bbed","#98d0f3","#bce6f9","#e6faff"]},{name:"seq-greens-bright",colors:["#39544c","#386757","#368165","#359b73","#33b581","#4bc392","#64d2a2","#7ce0b3","#cbf6d9","#f4ffea"]},{name:"seq-browns-bright",colors:["#524834","#715b38","#8f6e3c","#ae8140","#cc9444","#eba748","#eeb664","#f0c47f","#f9e0b7","#fff8eb"]}];const zce="en-us",rre=new Map([["ar",()=>ie(()=>import("./ar.4dc6191a.js"),["ar.4dc6191a.js","commonjsHelpers.ce2b5698.js"],import.meta.url).then(e=>e.a)],["bg-bg",()=>ie(()=>import("./bg_BG.c52f2d3f.js"),["bg_BG.c52f2d3f.js","commonjsHelpers.ce2b5698.js"],import.meta.url).then(e=>e.b)],["bs-ba",()=>ie(()=>import("./bs_BA.dea32ce5.js"),["bs_BA.dea32ce5.js","commonjsHelpers.ce2b5698.js"],import.meta.url).then(e=>e.b)],["ca-es",()=>ie(()=>import("./ca_ES.20b19104.js"),["ca_ES.20b19104.js","commonjsHelpers.ce2b5698.js"],import.meta.url).then(e=>e.c)],["cs-cz",()=>ie(()=>import("./cs_CZ.30f0a0dc.js"),["cs_CZ.30f0a0dc.js","commonjsHelpers.ce2b5698.js"],import.meta.url).then(e=>e.c)],["da-dk",()=>ie(()=>import("./da_DK.b8d0e7ac.js"),["da_DK.b8d0e7ac.js","commonjsHelpers.ce2b5698.js"],import.meta.url).then(e=>e.d)],["de-de",()=>ie(()=>import("./de_DE.08196323.js"),["de_DE.08196323.js","commonjsHelpers.ce2b5698.js"],import.meta.url).then(e=>e.d)],["de-ch",()=>ie(()=>import("./de_CH.5d6685a9.js"),["de_CH.5d6685a9.js","commonjsHelpers.ce2b5698.js"],import.meta.url).then(e=>e.d)],["el-gr",()=>ie(()=>import("./el_GR.c34c39c2.js"),["el_GR.c34c39c2.js","commonjsHelpers.ce2b5698.js"],import.meta.url).then(e=>e.e)],["en-us",()=>ie(()=>import("./en_US.58fb12c0.js"),["en_US.58fb12c0.js","commonjsHelpers.ce2b5698.js"],import.meta.url).then(e=>e.e)],["en-ca",()=>ie(()=>import("./en_CA.bf2bc83b.js"),["en_CA.bf2bc83b.js","commonjsHelpers.ce2b5698.js"],import.meta.url).then(e=>e.e)],["es-es",()=>ie(()=>import("./es_ES.990a5784.js"),["es_ES.990a5784.js","commonjsHelpers.ce2b5698.js"],import.meta.url).then(e=>e.e)],["et-ee",()=>ie(()=>import("./et_EE.3eaec652.js"),["et_EE.3eaec652.js","commonjsHelpers.ce2b5698.js"],import.meta.url).then(e=>e.e)],["fi-fi",()=>ie(()=>import("./fi_FI.5397a92e.js"),["fi_FI.5397a92e.js","commonjsHelpers.ce2b5698.js"],import.meta.url).then(e=>e.f)],["fr-fr",()=>ie(()=>import("./fr_FR.1735cff8.js"),["fr_FR.1735cff8.js","commonjsHelpers.ce2b5698.js"],import.meta.url).then(e=>e.f)],["he-il",()=>ie(()=>import("./he_IL.fa6085be.js"),["he_IL.fa6085be.js","commonjsHelpers.ce2b5698.js"],import.meta.url).then(e=>e.h)],["hr-hr",()=>ie(()=>import("./hr_HR.e9361751.js"),["hr_HR.e9361751.js","commonjsHelpers.ce2b5698.js"],import.meta.url).then(e=>e.h)],["hu-hu",()=>ie(()=>import("./hu_HU.37349893.js"),["hu_HU.37349893.js","commonjsHelpers.ce2b5698.js"],import.meta.url).then(e=>e.h)],["id-id",()=>ie(()=>import("./id_ID.935d8150.js"),["id_ID.935d8150.js","commonjsHelpers.ce2b5698.js"],import.meta.url).then(e=>e.i)],["it-it",()=>ie(()=>import("./it_IT.c73e8e5e.js"),["it_IT.c73e8e5e.js","commonjsHelpers.ce2b5698.js"],import.meta.url).then(e=>e.i)],["ja-jp",()=>ie(()=>import("./ja_JP.17363a69.js"),["ja_JP.17363a69.js","commonjsHelpers.ce2b5698.js"],import.meta.url).then(e=>e.j)],["ko-kr",()=>ie(()=>import("./ko_KR.b3c8049f.js"),["ko_KR.b3c8049f.js","commonjsHelpers.ce2b5698.js"],import.meta.url).then(e=>e.k)],["lt-lt",()=>ie(()=>import("./lt_LT.520661ee.js"),["lt_LT.520661ee.js","commonjsHelpers.ce2b5698.js"],import.meta.url).then(e=>e.l)],["lv-lv",()=>ie(()=>import("./lv_LV.c2022ffc.js"),["lv_LV.c2022ffc.js","commonjsHelpers.ce2b5698.js"],import.meta.url).then(e=>e.l)],["nb-no",()=>ie(()=>import("./nb_NO.b81af806.js"),["nb_NO.b81af806.js","commonjsHelpers.ce2b5698.js"],import.meta.url).then(e=>e.n)],["nl-nl",()=>ie(()=>import("./nl_NL.b5e4e1f8.js"),["nl_NL.b5e4e1f8.js","commonjsHelpers.ce2b5698.js"],import.meta.url).then(e=>e.n)],["pl-pl",()=>ie(()=>import("./pl_PL.47a9df4a.js"),["pl_PL.47a9df4a.js","commonjsHelpers.ce2b5698.js"],import.meta.url).then(e=>e.p)],["pt-br",()=>ie(()=>import("./pt_BR.512ff419.js"),["pt_BR.512ff419.js","commonjsHelpers.ce2b5698.js"],import.meta.url).then(e=>e.p)],["pt-pt",()=>ie(()=>import("./pt_PT.89c766b3.js"),["pt_PT.89c766b3.js","commonjsHelpers.ce2b5698.js"],import.meta.url).then(e=>e.p)],["ro-ro",()=>ie(()=>import("./ro_RO.cdb10687.js"),["ro_RO.cdb10687.js","commonjsHelpers.ce2b5698.js"],import.meta.url).then(e=>e.r)],["ru-ru",()=>ie(()=>import("./ru_RU.fb5ffe9b.js"),["ru_RU.fb5ffe9b.js","commonjsHelpers.ce2b5698.js"],import.meta.url).then(e=>e.r)],["sk-sk",()=>ie(()=>import("./sk_SK.c690c7d2.js"),["sk_SK.c690c7d2.js","commonjsHelpers.ce2b5698.js"],import.meta.url).then(e=>e.s)],["sl-sl",()=>ie(()=>import("./sl_SL.b6513f33.js"),["sl_SL.b6513f33.js","commonjsHelpers.ce2b5698.js"],import.meta.url).then(e=>e.s)],["sr-rs",()=>ie(()=>import("./sr_RS.71408a7c.js"),["sr_RS.71408a7c.js","commonjsHelpers.ce2b5698.js"],import.meta.url).then(e=>e.s)],["sv-se",()=>ie(()=>import("./sv_SE.5f00a442.js"),["sv_SE.5f00a442.js","commonjsHelpers.ce2b5698.js"],import.meta.url).then(e=>e.s)],["th-th",()=>ie(()=>import("./th_TH.e8c3ff07.js"),["th_TH.e8c3ff07.js","commonjsHelpers.ce2b5698.js"],import.meta.url).then(e=>e.t)],["tr-tr",()=>ie(()=>import("./tr_TR.0d292c66.js"),["tr_TR.0d292c66.js","commonjsHelpers.ce2b5698.js"],import.meta.url).then(e=>e.t)],["uk-ua",()=>ie(()=>import("./uk_UA.f4a29cdf.js"),["uk_UA.f4a29cdf.js","commonjsHelpers.ce2b5698.js"],import.meta.url).then(e=>e.u)],["vi-vn",()=>ie(()=>import("./vi_VN.806d0c36.js"),["vi_VN.806d0c36.js","commonjsHelpers.ce2b5698.js"],import.meta.url).then(e=>e.v)],["zh-cn",()=>ie(()=>import("./zh_Hans.a407cf98.js"),["zh_Hans.a407cf98.js","commonjsHelpers.ce2b5698.js"],import.meta.url).then(e=>e.z)],["zh-hk",()=>ie(()=>import("./zh_Hant.7e13eee4.js"),["zh_Hant.7e13eee4.js","commonjsHelpers.ce2b5698.js"],import.meta.url).then(e=>e.z)],["zh-tw",()=>ie(()=>import("./zh_Hant.7e13eee4.js"),["zh_Hant.7e13eee4.js","commonjsHelpers.ce2b5698.js"],import.meta.url).then(e=>e.z)]]);function WZe(e){const t=e.split("-")[0].toLowerCase();let r=null;for(const i of rre.keys())if(i.startsWith(t)){r=i;break}return r}function XZe(e){return e?rre.has(e.toLowerCase())?e.toLowerCase():WZe(e)||zce:zce}let fS,iO;async function ZZe(e=lh()){if(e=XZe(e),fS&&e===iO)return fS;fS=ie(()=>import("./index.80c6615c.js"),["index.80c6615c.js","commonjsHelpers.ce2b5698.js"],import.meta.url).then(t=>t.i),iO=e;try{const[t,r]=await Promise.all([fS,rre.get(iO)()]);iO===e&&(t.am4core.options.defaultLocale=r.default),t.am4core.options.suppressWarnings=!0,t.am4core.options.autoDispose=!0}catch{return fS=null,iO=null,null}return fS}function YZe(e,t="default"){const r=qZe.find(i=>i.name===t);return r?r.colors.map(i=>e.color(i)):null}const ks={base:"esri-feature-media",mediaContainer:"esri-feature-media__container",mediaItemContainer:"esri-feature-media__item-container",mediaItem:"esri-feature-media__item",mediaItemTitle:"esri-feature-media__item-title",mediaItemCaption:"esri-feature-media__item-caption",mediaPrevious:"esri-feature-media__previous",mediaPreviousIconLTR:"esri-feature-media__previous-icon",mediaPreviousIconRTL:"esri-feature-media__previous-icon--rtl",mediaNext:"esri-feature-media__next",mediaNextIconLTR:"esri-feature-media__next-icon",mediaNextIconRTL:"esri-feature-media__next-icon--rtl",mediaChart:"esri-feature-media__chart",mediaButton:"esri-feature-media__button",mediaIcon:"esri-feature-media__icon",iconLeftTriangleArrow:"esri-icon-left-triangle-arrow",iconRightTriangleArrow:"esri-icon-right-triangle-arrow"},vG=.05,_G=.95,bG=15,Rg="color",W0="tooltip",sO="value",Bce="default-line-value";let Tc=class extends Un{constructor(e,t){super(e,t),this._refreshTimer=null,this._refreshIntervalInfo=null,this._featureElementInfo=null,this.attributes=null,this.activeMediaInfoIndex=null,this.description=null,this.fieldInfoMap=null,this.layer=null,this.mediaInfos=null,this.popupTemplate=null,this.relatedInfos=null,this.title=null,this.viewModel=new wx,this.messages=null,this._getChartDependencies=async r=>{const i=await ZZe(),{destroyed:s,viewModel:n}=this;if(s||!n||!r)return;const{activeMediaInfo:o}=n,a=await this._getRendererColors(i);this._renderChart({chartDiv:r,mediaInfo:o,chartsModule:i,colorMap:a})}}initialize(){this._featureElementInfo=new Ute,this.own([te(()=>{var e,t;return[(e=this.viewModel)==null?void 0:e.activeMediaInfo,(t=this.viewModel)==null?void 0:t.activeMediaInfoIndex]},()=>this._setupMediaRefreshTimer(),Rt),te(()=>{var e,t;return[(e=this.viewModel)==null?void 0:e.description,(t=this.viewModel)==null?void 0:t.title]},()=>this._setupFeatureElementInfo(),Rt)])}destroy(){this._clearMediaRefreshTimer(),this._featureElementInfo.destroy()}render(){var e;return U("div",{bind:this,class:ks.base,onkeyup:this._handleMediaKeyup},(e=this._featureElementInfo)==null?void 0:e.render(),this.renderMedia())}renderMedia(){const{formattedMediaInfoCount:e}=this.viewModel;return e?U("div",{key:"media-element-container",class:ks.mediaContainer},this.renderMediaPageButton("previous"),this.renderMediaInfo(),this.renderMediaPageButton("next")):null}renderImageMediaInfo(e){const{_refreshIntervalInfo:t}=this,{activeMediaInfoIndex:r,formattedMediaInfoCount:i}=this.viewModel,{value:s,refreshInterval:n,altText:o,title:a,type:l}=e,{sourceURL:c,linkURL:h}=s,p=p2e(h)?"_blank":"_self",f=p==="_blank"?"noreferrer":"",m=n?t:null,g=m?m.timestamp:0,v=m?m.sourceURL:c,w=U("img",{alt:o||a,key:`media-${l}-${r}-${i}-${g}`,src:v});return(h?U("a",{title:a,href:h,rel:f,target:p},w):null)||w}renderChartMediaInfo(e){const{activeMediaInfoIndex:t,formattedMediaInfoCount:r}=this.viewModel;return U("div",{key:`media-${e.type}-${t}-${r}`,bind:this,class:ks.mediaChart,afterCreate:this._getChartDependencies})}renderMediaInfoType(){const{activeMediaInfo:e}=this.viewModel;return e?e.type==="image"?this.renderImageMediaInfo(e):e.type.includes("chart")?this.renderChartMediaInfo(e):null:null}renderMediaInfo(){const{activeMediaInfo:e}=this.viewModel;if(!e)return null;const t=e.title?U("div",{key:"media-title",class:ks.mediaItemTitle,innerHTML:e.title}):null,r=e.caption?U("div",{key:"media-caption",class:ks.mediaItemCaption,innerHTML:e.caption}):null;return U("div",{key:"media-container",class:ks.mediaItemContainer},U("div",{key:"media-item-container",class:ks.mediaItem},this.renderMediaInfoType()),t,r)}renderMediaPageButton(e){if(this.viewModel.formattedMediaInfoCount<2)return null;const t=e==="previous",r=t?this.messages.previous:this.messages.next,i=t?this.classes(ks.mediaButton,ks.mediaPrevious):this.classes(ks.mediaButton,ks.mediaNext),s=t?this.classes(ks.mediaIcon,ks.mediaPreviousIconLTR,ks.iconLeftTriangleArrow):this.classes(ks.mediaIcon,ks.mediaNextIconLTR,ks.iconRightTriangleArrow),n=t?this.classes(ks.mediaIcon,ks.mediaPreviousIconRTL,ks.iconRightTriangleArrow):this.classes(ks.mediaIcon,ks.mediaNextIconRTL,ks.iconLeftTriangleArrow),o=t?"media-previous":"media-next",a=t?this._previous:this._next;return U("button",{type:"button",key:o,title:r,"aria-label":r,tabIndex:0,class:i,bind:this,onclick:a},U("span",{"aria-hidden":"true",class:s}),U("span",{"aria-hidden":"true",class:n}))}_setupFeatureElementInfo(){const{description:e,title:t}=this;this._featureElementInfo.set({description:e,title:t})}_next(){this.viewModel.next()}_previous(){this.viewModel.previous()}async _getRendererColors(e){var n;const{am4core:t}=e,r=(n=this.viewModel)==null?void 0:n.layer,i=new Map;if(!r)return i;const s=await yXe(r.renderer);return s.delete(null),Array.from(s.values()).every(o=>(o==null?void 0:o.length)===1)&&(i.set(Bce,t.color({r:50,g:50,b:50,a:1})),Array.from(s.keys()).forEach(o=>{o&&i.set(o,t.color(s.get(o)[0].toCss(!0)))})),i}_handleMediaKeyup(e){const t=Hw(e);t==="ArrowLeft"&&(e.stopPropagation(),this.viewModel.previous()),t==="ArrowRight"&&(e.stopPropagation(),this.viewModel.next())}_renderChart(e){const{abilities:t}=this.viewModel,{chartsModule:r,chartDiv:i,mediaInfo:s,colorMap:n}=e,{value:o,type:a}=s,{am4core:l}=r,c=YZe(l);function h(m){m instanceof l.ColorSet&&c&&(m.list=c)}Vte()&&l.useTheme(r.am4themes_dark);const p=window.matchMedia("(prefers-reduced-motion: reduce)");t.chartAnimation&&!p.matches?l.useTheme(r.am4themes_animated):l.unuseTheme(r.am4themes_animated),l.useTheme(h);const f=a==="pie-chart"?this._createPieChart(e):this._createXYChart(e);i.setAttribute("aria-label",s.altText||s.title),f.data=o.series.map(m=>({[W0]:m.tooltip,[sO]:m.value,[Rg]:n.get(m.fieldName)})).filter(m=>a!=="pie-chart"||m.value>0)}_customizeChartTooltip(e,t){e.label.wrap=!0,e.label.maxWidth=200,e.autoTextColor=!1,e.getFillFromObject=!1,e.label.fill=t.color("#ffffff"),e.background.fill=t.color({r:0,g:0,b:0,a:.7})}_createPieChart(e){const{chartDiv:t,chartsModule:r}=e,{am4core:i,am4charts:s}=r,n=i.create(t,s.PieChart);n.rtl=nf(this.container);const o=n.series.push(new s.PieSeries);return o.labels.template.disabled=!0,o.ticks.template.disabled=!0,o.dataFields.value=sO,o.dataFields.category=W0,this._customizeChartTooltip(o.tooltip,i),o.slices.template.tooltipText=n.rtl?"{category}: %{value.percent.formatNumber('#.0')}":"{category}: {value.percent.formatNumber('#.0')}%",o.slices.template.propertyFields.fill=Rg,o.slices.template.propertyFields.stroke=Rg,n}_getMinSeriesValue(e){let t=0;return e.forEach(r=>t=Math.min(r.value,t)),t}_createColumnChart(e,t){const{chartsModule:r,mediaInfo:i}=t,{value:s}=i,{am4core:n,am4charts:o}=r,a=e.xAxes.push(new o.CategoryAxis);a.dataFields.category=W0,a.renderer.labels.template.disabled=!0,this._customizeChartTooltip(a.tooltip,n),a.tooltip.events.on("sizechanged",()=>{a.tooltip.dy=-a.tooltip.contentHeight});const l=e.yAxes.push(new o.ValueAxis),c=l.renderer.labels.template;l.renderer.minLabelPosition=vG,l.renderer.maxLabelPosition=_G,l.min=this._getMinSeriesValue(s.series),this._customizeChartTooltip(l.tooltip,n),c.wrap=!0;const h=e.series.push(new o.ColumnSeries);h.dataFields.valueY=sO,h.dataFields.categoryX=W0,h.columns.template.propertyFields.fill=Rg,h.columns.template.propertyFields.stroke=Rg,e.cursor=new o.XYCursor,s.series.length>bG&&(e.scrollbarX=new n.Scrollbar)}_createBarChart(e,t){const{chartsModule:r,mediaInfo:i}=t,{value:s}=i,{am4core:n,am4charts:o}=r,a=e.yAxes.push(new o.CategoryAxis);a.dataFields.category=W0,a.renderer.inversed=!0,a.renderer.labels.template.disabled=!0,this._customizeChartTooltip(a.tooltip,n),a.tooltip.events.on("sizechanged",()=>{a.tooltip.dx=a.tooltip.contentWidth});const l=e.xAxes.push(new o.ValueAxis),c=l.renderer.labels.template;l.renderer.minLabelPosition=vG,l.renderer.maxLabelPosition=_G,l.min=this._getMinSeriesValue(s.series),this._customizeChartTooltip(l.tooltip,n),c.wrap=!0;const h=e.series.push(new o.ColumnSeries);h.dataFields.valueX=sO,h.dataFields.categoryY=W0,h.columns.template.propertyFields.fill=Rg,h.columns.template.propertyFields.stroke=Rg,e.cursor=new o.XYCursor,s.series.length>bG&&(e.scrollbarY=new n.Scrollbar)}_createLineChart(e,t){const{chartsModule:r,mediaInfo:i,colorMap:s}=t,{value:n}=i,{am4core:o,am4charts:a}=r,l=e.xAxes.push(new a.CategoryAxis);l.dataFields.category=W0,l.renderer.labels.template.disabled=!0,this._customizeChartTooltip(l.tooltip,o),l.tooltip.events.on("sizechanged",()=>{l.tooltip.dy=-l.tooltip.contentHeight});const c=e.yAxes.push(new a.ValueAxis),h=c.renderer.labels.template;c.renderer.minLabelPosition=vG,c.renderer.maxLabelPosition=_G,c.min=this._getMinSeriesValue(n.series),this._customizeChartTooltip(c.tooltip,o),h.wrap=!0;const p=e.series.push(new a.LineSeries);p.dataFields.categoryX=W0,p.dataFields.valueY=sO,p.strokeWidth=1;const f=s.get(Bce);f&&(p.stroke=f);const m=p.bullets.push(new a.CircleBullet);m.propertyFields.fill=Rg,m.propertyFields.stroke=Rg,e.cursor=new a.XYCursor,n.series.length>bG&&(e.scrollbarX=new o.Scrollbar)}_createXYChart(e){const{chartDiv:t,chartsModule:r,mediaInfo:i}=e,{type:s}=i,{am4core:n,am4charts:o}=r,a=n.create(t,o.XYChart);return a.rtl=nf(this.container),s==="column-chart"&&this._createColumnChart(a,e),s==="bar-chart"&&this._createBarChart(a,e),s==="line-chart"&&this._createLineChart(a,e),a}_clearMediaRefreshTimer(){const{_refreshTimer:e}=this;e&&(clearTimeout(e),this._refreshTimer=null)}_updateMediaInfoTimestamp(e){const t=Date.now();this._refreshIntervalInfo={timestamp:t,sourceURL:this._getImageSource(e,t)},this.scheduleRender()}_setupMediaRefreshTimer(){this._clearMediaRefreshTimer();const{activeMediaInfo:e}=this.viewModel;e&&e.type==="image"&&e.refreshInterval&&this._setRefreshTimeout(e)}_setRefreshTimeout(e){const{refreshInterval:t,value:r}=e;if(!t)return;const i=6e4*t;this._updateMediaInfoTimestamp(r.sourceURL);const s=setInterval(()=>{this._updateMediaInfoTimestamp(r.sourceURL)},i);this._refreshTimer=s}_getImageSource(e,t){const r=e.includes("?")?"&":"?",[i,s=""]=e.split("#");return`${i}${r}timestamp=${t}${s?"#":""}${s}`}};u([We("viewModel.attributes")],Tc.prototype,"attributes",void 0),u([We("viewModel.activeMediaInfoIndex")],Tc.prototype,"activeMediaInfoIndex",void 0),u([We("viewModel.description")],Tc.prototype,"description",void 0),u([We("viewModel.fieldInfoMap")],Tc.prototype,"fieldInfoMap",void 0),u([We("viewModel.layer")],Tc.prototype,"layer",void 0),u([We("viewModel.mediaInfos")],Tc.prototype,"mediaInfos",void 0),u([We("viewModel.popupTemplate")],Tc.prototype,"popupTemplate",void 0),u([We("viewModel.relatedInfos")],Tc.prototype,"relatedInfos",void 0),u([We("viewModel.title")],Tc.prototype,"title",void 0),u([d({type:wx})],Tc.prototype,"viewModel",void 0),u([d(),Js("esri/widgets/Feature/t9n/Feature")],Tc.prototype,"messages",void 0),Tc=u([$("esri.widgets.Feature.FeatureMedia")],Tc);const _Ee=Tc;class QZe{constructor(t,r){this.definition=null,this.context=null,this.definition=t,this.context=r}}class _g{constructor(t=[]){this._elements=t}length(){return this._elements.length}get(t){return this._elements[t]}toArray(){const t=[];for(let r=0;r<this.length();r++)t.push(this.get(r));return t}}class tS extends _g{constructor(t,r,i,s,n,o){super(t),this._lazyPt=[],this._hasZ=!1,this._hasM=!1,this._spRef=r,this._hasZ=i,this._hasM=s,this._cacheId=n,this._partId=o}get(t){if(this._lazyPt[t]===void 0){const r=this._elements[t];if(r===void 0)return;const i=this._hasZ,s=this._hasM;let n=null;n=i&&!s?new at(r[0],r[1],r[2],void 0,this._spRef):s&&!i?new at(r[0],r[1],void 0,r[2],this._spRef):i&&s?new at(r[0],r[1],r[2],r[3],this._spRef):new at(r[0],r[1],this._spRef),n.cache._arcadeCacheId=this._cacheId.toString()+"-"+this._partId.toString()+"-"+t.toString(),this._lazyPt[t]=n}return this._lazyPt[t]}equalityTest(t){return t===this||t!==null&&t instanceof tS&&t.getUniqueHash()===this.getUniqueHash()}getUniqueHash(){return this._cacheId.toString()+"-"+this._partId.toString()}}class ire extends _g{constructor(t,r,i,s,n){super(t),this._lazyPath=[],this._hasZ=!1,this._hasM=!1,this._hasZ=i,this._hasM=s,this._spRef=r,this._cacheId=n}get(t){if(this._lazyPath[t]===void 0){const r=this._elements[t];if(r===void 0)return;this._lazyPath[t]=new tS(r,this._spRef,this._hasZ,this._hasM,this._cacheId,t)}return this._lazyPath[t]}equalityTest(t){return t===this||t!==null&&t instanceof ire&&t.getUniqueHash()===this.getUniqueHash()}getUniqueHash(){return this._cacheId.toString()}}class rS extends Error{}class JZe extends rS{constructor(t){super(`Invalid DateTime: ${t.toMessage()}`)}}class KZe extends rS{constructor(t){super(`Invalid Interval: ${t.toMessage()}`)}}class eYe extends rS{constructor(t){super(`Invalid Duration: ${t.toMessage()}`)}}class jM extends rS{}class bEe extends rS{constructor(t){super(`Invalid unit ${t}`)}}class vd extends rS{}class X0 extends rS{constructor(){super("Zone is an abstract class")}}const Qe="numeric",Tf="short",dh="long",AZ={year:Qe,month:Qe,day:Qe},wEe={year:Qe,month:Tf,day:Qe},tYe={year:Qe,month:Tf,day:Qe,weekday:Tf},xEe={year:Qe,month:dh,day:Qe},TEe={year:Qe,month:dh,day:Qe,weekday:dh},SEe={hour:Qe,minute:Qe},EEe={hour:Qe,minute:Qe,second:Qe},CEe={hour:Qe,minute:Qe,second:Qe,timeZoneName:Tf},AEe={hour:Qe,minute:Qe,second:Qe,timeZoneName:dh},REe={hour:Qe,minute:Qe,hourCycle:"h23"},OEe={hour:Qe,minute:Qe,second:Qe,hourCycle:"h23"},MEe={hour:Qe,minute:Qe,second:Qe,hourCycle:"h23",timeZoneName:Tf},PEe={hour:Qe,minute:Qe,second:Qe,hourCycle:"h23",timeZoneName:dh},IEe={year:Qe,month:Qe,day:Qe,hour:Qe,minute:Qe},$Ee={year:Qe,month:Qe,day:Qe,hour:Qe,minute:Qe,second:Qe},LEe={year:Qe,month:Tf,day:Qe,hour:Qe,minute:Qe},DEe={year:Qe,month:Tf,day:Qe,hour:Qe,minute:Qe,second:Qe},rYe={year:Qe,month:Tf,day:Qe,weekday:Tf,hour:Qe,minute:Qe},NEe={year:Qe,month:dh,day:Qe,hour:Qe,minute:Qe,timeZoneName:Tf},FEe={year:Qe,month:dh,day:Qe,hour:Qe,minute:Qe,second:Qe,timeZoneName:Tf},kEe={year:Qe,month:dh,day:Qe,weekday:dh,hour:Qe,minute:Qe,timeZoneName:dh},UEe={year:Qe,month:dh,day:Qe,weekday:dh,hour:Qe,minute:Qe,second:Qe,timeZoneName:dh};function Jr(e){return typeof e>"u"}function Hx(e){return typeof e=="number"}function Z6(e){return typeof e=="number"&&e%1===0}function iYe(e){return typeof e=="string"}function sYe(e){return Object.prototype.toString.call(e)==="[object Date]"}function VEe(){try{return typeof Intl<"u"&&!!Intl.RelativeTimeFormat}catch{return!1}}function nYe(e){return Array.isArray(e)?e:[e]}function Gce(e,t,r){if(e.length!==0)return e.reduce((i,s)=>{const n=[t(s),s];return i&&r(i[0],n[0])===i[0]?i:n},null)[1]}function oYe(e,t){return t.reduce((r,i)=>(r[i]=e[i],r),{})}function gA(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function Fy(e,t,r){return Z6(e)&&e>=t&&e<=r}function aYe(e,t){return e-t*Math.floor(e/t)}function Kn(e,t=2){const r=e<0;let i;return r?i="-"+(""+-e).padStart(t,"0"):i=(""+e).padStart(t,"0"),i}function d_(e){if(!(Jr(e)||e===null||e===""))return parseInt(e,10)}function lb(e){if(!(Jr(e)||e===null||e===""))return parseFloat(e)}function sre(e){if(!(Jr(e)||e===null||e==="")){const t=parseFloat("0."+e)*1e3;return Math.floor(t)}}function nre(e,t,r=!1){const i=10**t;return(r?Math.trunc:Math.round)(e*i)/i}function sL(e){return e%4===0&&(e%100!==0||e%400===0)}function iP(e){return sL(e)?366:365}function cV(e,t){const r=aYe(t-1,12)+1,i=e+(t-r)/12;return r===2?sL(i)?29:28:[31,null,31,30,31,30,31,31,30,31,30,31][r-1]}function ore(e){let t=Date.UTC(e.year,e.month-1,e.day,e.hour,e.minute,e.second,e.millisecond);return e.year<100&&e.year>=0&&(t=new Date(t),t.setUTCFullYear(t.getUTCFullYear()-1900)),+t}function uV(e){const t=(e+Math.floor(e/4)-Math.floor(e/100)+Math.floor(e/400))%7,r=e-1,i=(r+Math.floor(r/4)-Math.floor(r/100)+Math.floor(r/400))%7;return t===4||i===3?53:52}function RZ(e){return e>99?e:e>60?1900+e:2e3+e}function zEe(e,t,r,i=null){const s=new Date(e),n={hourCycle:"h23",year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"};i&&(n.timeZone=i);const o={timeZoneName:t,...n},a=new Intl.DateTimeFormat(r,o).formatToParts(s).find(l=>l.type.toLowerCase()==="timezonename");return a?a.value:null}function Y6(e,t){let r=parseInt(e,10);Number.isNaN(r)&&(r=0);const i=parseInt(t,10)||0,s=r<0||Object.is(r,-0)?-i:i;return r*60+s}function BEe(e){const t=Number(e);if(typeof e=="boolean"||e===""||Number.isNaN(t))throw new vd(`Invalid unit value ${e}`);return t}function hV(e,t){const r={};for(const i in e)if(gA(e,i)){const s=e[i];if(s==null)continue;r[t(i)]=BEe(s)}return r}function sP(e,t){const r=Math.trunc(Math.abs(e/60)),i=Math.trunc(Math.abs(e%60)),s=e>=0?"+":"-";switch(t){case"short":return`${s}${Kn(r,2)}:${Kn(i,2)}`;case"narrow":return`${s}${r}${i>0?`:${i}`:""}`;case"techie":return`${s}${Kn(r,2)}${Kn(i,2)}`;default:throw new RangeError(`Value format ${t} is out of range for property format`)}}function Q6(e){return oYe(e,["hour","minute","second","millisecond"])}const GEe=/[A-Za-z_+-]{1,256}(?::?\/[A-Za-z0-9_+-]{1,256}(?:\/[A-Za-z0-9_+-]{1,256})?)?/,lYe=["January","February","March","April","May","June","July","August","September","October","November","December"],jEe=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],cYe=["J","F","M","A","M","J","J","A","S","O","N","D"];function HEe(e){switch(e){case"narrow":return[...cYe];case"short":return[...jEe];case"long":return[...lYe];case"numeric":return["1","2","3","4","5","6","7","8","9","10","11","12"];case"2-digit":return["01","02","03","04","05","06","07","08","09","10","11","12"];default:return null}}const qEe=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],WEe=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],uYe=["M","T","W","T","F","S","S"];function XEe(e){switch(e){case"narrow":return[...uYe];case"short":return[...WEe];case"long":return[...qEe];case"numeric":return["1","2","3","4","5","6","7"];default:return null}}const ZEe=["AM","PM"],hYe=["Before Christ","Anno Domini"],dYe=["BC","AD"],pYe=["B","A"];function YEe(e){switch(e){case"narrow":return[...pYe];case"short":return[...dYe];case"long":return[...hYe];default:return null}}function fYe(e){return ZEe[e.hour<12?0:1]}function mYe(e,t){return XEe(t)[e.weekday-1]}function gYe(e,t){return HEe(t)[e.month-1]}function yYe(e,t){return YEe(t)[e.year<0?0:1]}function vYe(e,t,r="always",i=!1){const s={years:["year","yr."],quarters:["quarter","qtr."],months:["month","mo."],weeks:["week","wk."],days:["day","day","days"],hours:["hour","hr."],minutes:["minute","min."],seconds:["second","sec."]},n=["hours","minutes","seconds"].indexOf(e)===-1;if(r==="auto"&&n){const p=e==="days";switch(t){case 1:return p?"tomorrow":`next ${s[e][0]}`;case-1:return p?"yesterday":`last ${s[e][0]}`;case 0:return p?"today":`this ${s[e][0]}`}}const o=Object.is(t,-0)||t<0,a=Math.abs(t),l=a===1,c=s[e],h=i?l?c[1]:c[2]||c[1]:l?s[e][0]:e;return o?`${a} ${h} ago`:`in ${a} ${h}`}function jce(e,t){let r="";for(const i of e)i.literal?r+=i.val:r+=t(i.val);return r}const _Ye={D:AZ,DD:wEe,DDD:xEe,DDDD:TEe,t:SEe,tt:EEe,ttt:CEe,tttt:AEe,T:REe,TT:OEe,TTT:MEe,TTTT:PEe,f:IEe,ff:LEe,fff:NEe,ffff:kEe,F:$Ee,FF:DEe,FFF:FEe,FFFF:UEe};class Wc{static create(t,r={}){return new Wc(t,r)}static parseFormat(t){let r=null,i="",s=!1;const n=[];for(let o=0;o<t.length;o++){const a=t.charAt(o);a==="'"?(i.length>0&&n.push({literal:s,val:i}),r=null,i="",s=!s):s||a===r?i+=a:(i.length>0&&n.push({literal:!1,val:i}),i=a,r=a)}return i.length>0&&n.push({literal:s,val:i}),n}static macroTokenToFormatOpts(t){return _Ye[t]}constructor(t,r){this.opts=r,this.loc=t,this.systemLoc=null}formatWithSystemDefault(t,r){return this.systemLoc===null&&(this.systemLoc=this.loc.redefaultToSystem()),this.systemLoc.dtFormatter(t,{...this.opts,...r}).format()}formatDateTime(t,r={}){return this.loc.dtFormatter(t,{...this.opts,...r}).format()}formatDateTimeParts(t,r={}){return this.loc.dtFormatter(t,{...this.opts,...r}).formatToParts()}resolvedOptions(t,r={}){return this.loc.dtFormatter(t,{...this.opts,...r}).resolvedOptions()}num(t,r=0){if(this.opts.forceSimple)return Kn(t,r);const i={...this.opts};return r>0&&(i.padTo=r),this.loc.numberFormatter(i).format(t)}formatDateTimeFromString(t,r){const i=this.loc.listingMode()==="en",s=this.loc.outputCalendar&&this.loc.outputCalendar!=="gregory",n=(m,g)=>this.loc.extract(t,m,g),o=m=>t.isOffsetFixed&&t.offset===0&&m.allowZ?"Z":t.isValid?t.zone.formatOffset(t.ts,m.format):"",a=()=>i?fYe(t):n({hour:"numeric",hourCycle:"h12"},"dayperiod"),l=(m,g)=>i?gYe(t,m):n(g?{month:m}:{month:m,day:"numeric"},"month"),c=(m,g)=>i?mYe(t,m):n(g?{weekday:m}:{weekday:m,month:"long",day:"numeric"},"weekday"),h=m=>{const g=Wc.macroTokenToFormatOpts(m);return g?this.formatWithSystemDefault(t,g):m},p=m=>i?yYe(t,m):n({era:m},"era"),f=m=>{switch(m){case"S":return this.num(t.millisecond);case"u":case"SSS":return this.num(t.millisecond,3);case"s":return this.num(t.second);case"ss":return this.num(t.second,2);case"uu":return this.num(Math.floor(t.millisecond/10),2);case"uuu":return this.num(Math.floor(t.millisecond/100));case"m":return this.num(t.minute);case"mm":return this.num(t.minute,2);case"h":return this.num(t.hour%12===0?12:t.hour%12);case"hh":return this.num(t.hour%12===0?12:t.hour%12,2);case"H":return this.num(t.hour);case"HH":return this.num(t.hour,2);case"Z":return o({format:"narrow",allowZ:this.opts.allowZ});case"ZZ":return o({format:"short",allowZ:this.opts.allowZ});case"ZZZ":return o({format:"techie",allowZ:this.opts.allowZ});case"ZZZZ":return t.zone.offsetName(t.ts,{format:"short",locale:this.loc.locale});case"ZZZZZ":return t.zone.offsetName(t.ts,{format:"long",locale:this.loc.locale});case"z":return t.zoneName;case"a":return a();case"d":return s?n({day:"numeric"},"day"):this.num(t.day);case"dd":return s?n({day:"2-digit"},"day"):this.num(t.day,2);case"c":return this.num(t.weekday);case"ccc":return c("short",!0);case"cccc":return c("long",!0);case"ccccc":return c("narrow",!0);case"E":return this.num(t.weekday);case"EEE":return c("short",!1);case"EEEE":return c("long",!1);case"EEEEE":return c("narrow",!1);case"L":return s?n({month:"numeric",day:"numeric"},"month"):this.num(t.month);case"LL":return s?n({month:"2-digit",day:"numeric"},"month"):this.num(t.month,2);case"LLL":return l("short",!0);case"LLLL":return l("long",!0);case"LLLLL":return l("narrow",!0);case"M":return s?n({month:"numeric"},"month"):this.num(t.month);case"MM":return s?n({month:"2-digit"},"month"):this.num(t.month,2);case"MMM":return l("short",!1);case"MMMM":return l("long",!1);case"MMMMM":return l("narrow",!1);case"y":return s?n({year:"numeric"},"year"):this.num(t.year);case"yy":return s?n({year:"2-digit"},"year"):this.num(t.year.toString().slice(-2),2);case"yyyy":return s?n({year:"numeric"},"year"):this.num(t.year,4);case"yyyyyy":return s?n({year:"numeric"},"year"):this.num(t.year,6);case"G":return p("short");case"GG":return p("long");case"GGGGG":return p("narrow");case"kk":return this.num(t.weekYear.toString().slice(-2),2);case"kkkk":return this.num(t.weekYear,4);case"W":return this.num(t.weekNumber);case"WW":return this.num(t.weekNumber,2);case"o":return this.num(t.ordinal);case"ooo":return this.num(t.ordinal,3);case"q":return this.num(t.quarter);case"qq":return this.num(t.quarter,2);case"X":return this.num(Math.floor(t.ts/1e3));case"x":return this.num(t.ts);default:return h(m)}};return jce(Wc.parseFormat(r),f)}formatDurationFromString(t,r){const i=l=>{switch(l[0]){case"S":return"millisecond";case"s":return"second";case"m":return"minute";case"h":return"hour";case"d":return"day";case"w":return"week";case"M":return"month";case"y":return"year";default:return null}},s=l=>c=>{const h=i(c);return h?this.num(l.get(h),c.length):c},n=Wc.parseFormat(r),o=n.reduce((l,{literal:c,val:h})=>c?l:l.concat(h),[]),a=t.shiftTo(...o.map(i).filter(l=>l));return jce(n,s(a))}}class of{constructor(t,r){this.reason=t,this.explanation=r}toMessage(){return this.explanation?`${this.reason}: ${this.explanation}`:this.reason}}class nL{get type(){throw new X0}get name(){throw new X0}get ianaName(){return this.name}get isUniversal(){throw new X0}offsetName(t,r){throw new X0}formatOffset(t,r){throw new X0}offset(t){throw new X0}equals(t){throw new X0}get isValid(){throw new X0}}let wG=null;class are extends nL{static get instance(){return wG===null&&(wG=new are),wG}get type(){return"system"}get name(){return new Intl.DateTimeFormat().resolvedOptions().timeZone}get isUniversal(){return!1}offsetName(t,{format:r,locale:i}){return zEe(t,r,i)}formatOffset(t,r){return sP(this.offset(t),r)}offset(t){return-new Date(t).getTimezoneOffset()}equals(t){return t.type==="system"}get isValid(){return!0}}let m5={};function bYe(e){return m5[e]||(m5[e]=new Intl.DateTimeFormat("en-US",{hour12:!1,timeZone:e,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",era:"short"})),m5[e]}const wYe={year:0,month:1,day:2,era:3,hour:4,minute:5,second:6};function xYe(e,t){const r=e.format(t).replace(/\u200E/g,""),i=/(\d+)\/(\d+)\/(\d+) (AD|BC),? (\d+):(\d+):(\d+)/.exec(r),[,s,n,o,a,l,c,h]=i;return[o,s,n,a,l,c,h]}function TYe(e,t){const r=e.formatToParts(t),i=[];for(let s=0;s<r.length;s++){const{type:n,value:o}=r[s],a=wYe[n];n==="era"?i[a]=o:Jr(a)||(i[a]=parseInt(o,10))}return i}let WD={};class m0 extends nL{static create(t){return WD[t]||(WD[t]=new m0(t)),WD[t]}static resetCache(){WD={},m5={}}static isValidSpecifier(t){return this.isValidZone(t)}static isValidZone(t){if(!t)return!1;try{return new Intl.DateTimeFormat("en-US",{timeZone:t}).format(),!0}catch{return!1}}constructor(t){super(),this.zoneName=t,this.valid=m0.isValidZone(t)}get type(){return"iana"}get name(){return this.zoneName}get isUniversal(){return!1}offsetName(t,{format:r,locale:i}){return zEe(t,r,i,this.name)}formatOffset(t,r){return sP(this.offset(t),r)}offset(t){const r=new Date(t);if(isNaN(r))return NaN;const i=bYe(this.name);let[s,n,o,a,l,c,h]=i.formatToParts?TYe(i,r):xYe(i,r);a==="BC"&&(s=-Math.abs(s)+1);const f=ore({year:s,month:n,day:o,hour:l===24?0:l,minute:c,second:h,millisecond:0});let m=+r;const g=m%1e3;return m-=g>=0?g:1e3+g,(f-m)/(60*1e3)}equals(t){return t.type==="iana"&&t.name===this.name}get isValid(){return this.valid}}let xG=null;class Zl extends nL{static get utcInstance(){return xG===null&&(xG=new Zl(0)),xG}static instance(t){return t===0?Zl.utcInstance:new Zl(t)}static parseSpecifier(t){if(t){const r=t.match(/^utc(?:([+-]\d{1,2})(?::(\d{2}))?)?$/i);if(r)return new Zl(Y6(r[1],r[2]))}return null}constructor(t){super(),this.fixed=t}get type(){return"fixed"}get name(){return this.fixed===0?"UTC":`UTC${sP(this.fixed,"narrow")}`}get ianaName(){return this.fixed===0?"Etc/UTC":`Etc/GMT${sP(-this.fixed,"narrow")}`}offsetName(){return this.name}formatOffset(t,r){return sP(this.fixed,r)}get isUniversal(){return!0}offset(){return this.fixed}equals(t){return t.type==="fixed"&&t.fixed===this.fixed}get isValid(){return!0}}class SYe extends nL{constructor(t){super(),this.zoneName=t}get type(){return"invalid"}get name(){return this.zoneName}get isUniversal(){return!1}offsetName(){return null}formatOffset(){return""}offset(){return NaN}equals(){return!1}get isValid(){return!1}}function S_(e,t){if(Jr(e)||e===null)return t;if(e instanceof nL)return e;if(iYe(e)){const r=e.toLowerCase();return r==="local"||r==="system"?t:r==="utc"||r==="gmt"?Zl.utcInstance:Zl.parseSpecifier(r)||m0.create(e)}else return Hx(e)?Zl.instance(e):typeof e=="object"&&e.offset&&typeof e.offset=="number"?e:new SYe(e)}let Hce=()=>Date.now(),qce="system",Wce=null,Xce=null,Zce=null,Yce;class xo{static get now(){return Hce}static set now(t){Hce=t}static set defaultZone(t){qce=t}static get defaultZone(){return S_(qce,are.instance)}static get defaultLocale(){return Wce}static set defaultLocale(t){Wce=t}static get defaultNumberingSystem(){return Xce}static set defaultNumberingSystem(t){Xce=t}static get defaultOutputCalendar(){return Zce}static set defaultOutputCalendar(t){Zce=t}static get throwOnInvalid(){return Yce}static set throwOnInvalid(t){Yce=t}static resetCaches(){qs.resetCache(),m0.resetCache()}}let Qce={};function EYe(e,t={}){const r=JSON.stringify([e,t]);let i=Qce[r];return i||(i=new Intl.ListFormat(e,t),Qce[r]=i),i}let OZ={};function MZ(e,t={}){const r=JSON.stringify([e,t]);let i=OZ[r];return i||(i=new Intl.DateTimeFormat(e,t),OZ[r]=i),i}let PZ={};function CYe(e,t={}){const r=JSON.stringify([e,t]);let i=PZ[r];return i||(i=new Intl.NumberFormat(e,t),PZ[r]=i),i}let IZ={};function AYe(e,t={}){const{base:r,...i}=t,s=JSON.stringify([e,i]);let n=IZ[s];return n||(n=new Intl.RelativeTimeFormat(e,t),IZ[s]=n),n}let HM=null;function RYe(){return HM||(HM=new Intl.DateTimeFormat().resolvedOptions().locale,HM)}function OYe(e){const t=e.indexOf("-u-");if(t===-1)return[e];{let r;const i=e.substring(0,t);try{r=MZ(e).resolvedOptions()}catch{r=MZ(i).resolvedOptions()}const{numberingSystem:s,calendar:n}=r;return[i,s,n]}}function MYe(e,t,r){return(r||t)&&(e+="-u",r&&(e+=`-ca-${r}`),t&&(e+=`-nu-${t}`)),e}function PYe(e){const t=[];for(let r=1;r<=12;r++){const i=nr.utc(2016,r,1);t.push(e(i))}return t}function IYe(e){const t=[];for(let r=1;r<=7;r++){const i=nr.utc(2016,11,13+r);t.push(e(i))}return t}function XD(e,t,r,i,s){const n=e.listingMode(r);return n==="error"?null:n==="en"?i(t):s(t)}function $Ye(e){return e.numberingSystem&&e.numberingSystem!=="latn"?!1:e.numberingSystem==="latn"||!e.locale||e.locale.startsWith("en")||new Intl.DateTimeFormat(e.intl).resolvedOptions().numberingSystem==="latn"}class LYe{constructor(t,r,i){this.padTo=i.padTo||0,this.floor=i.floor||!1;const{padTo:s,floor:n,...o}=i;if(!r||Object.keys(o).length>0){const a={useGrouping:!1,...i};i.padTo>0&&(a.minimumIntegerDigits=i.padTo),this.inf=CYe(t,a)}}format(t){if(this.inf){const r=this.floor?Math.floor(t):t;return this.inf.format(r)}else{const r=this.floor?Math.floor(t):nre(t,3);return Kn(r,this.padTo)}}}class DYe{constructor(t,r,i){this.opts=i;let s;if(t.zone.isUniversal){const o=-1*(t.offset/60),a=o>=0?`Etc/GMT+${o}`:`Etc/GMT${o}`;t.offset!==0&&m0.create(a).valid?(s=a,this.dt=t):(s="UTC",i.timeZoneName?this.dt=t:this.dt=t.offset===0?t:nr.fromMillis(t.ts+t.offset*60*1e3))}else t.zone.type==="system"?this.dt=t:(this.dt=t,s=t.zone.name);const n={...this.opts};s&&(n.timeZone=s),this.dtf=MZ(r,n)}format(){return this.dtf.format(this.dt.toJSDate())}formatToParts(){return this.dtf.formatToParts(this.dt.toJSDate())}resolvedOptions(){return this.dtf.resolvedOptions()}}class NYe{constructor(t,r,i){this.opts={style:"long",...i},!r&&VEe()&&(this.rtf=AYe(t,i))}format(t,r){return this.rtf?this.rtf.format(t,r):vYe(r,t,this.opts.numeric,this.opts.style!=="long")}formatToParts(t,r){return this.rtf?this.rtf.formatToParts(t,r):[]}}class qs{static fromOpts(t){return qs.create(t.locale,t.numberingSystem,t.outputCalendar,t.defaultToEN)}static create(t,r,i,s=!1){const n=t||xo.defaultLocale,o=n||(s?"en-US":RYe()),a=r||xo.defaultNumberingSystem,l=i||xo.defaultOutputCalendar;return new qs(o,a,l,n)}static resetCache(){HM=null,OZ={},PZ={},IZ={}}static fromObject({locale:t,numberingSystem:r,outputCalendar:i}={}){return qs.create(t,r,i)}constructor(t,r,i,s){const[n,o,a]=OYe(t);this.locale=n,this.numberingSystem=r||o||null,this.outputCalendar=i||a||null,this.intl=MYe(this.locale,this.numberingSystem,this.outputCalendar),this.weekdaysCache={format:{},standalone:{}},this.monthsCache={format:{},standalone:{}},this.meridiemCache=null,this.eraCache={},this.specifiedLocale=s,this.fastNumbersCached=null}get fastNumbers(){return this.fastNumbersCached==null&&(this.fastNumbersCached=$Ye(this)),this.fastNumbersCached}listingMode(){const t=this.isEnglish(),r=(this.numberingSystem===null||this.numberingSystem==="latn")&&(this.outputCalendar===null||this.outputCalendar==="gregory");return t&&r?"en":"intl"}clone(t){return!t||Object.getOwnPropertyNames(t).length===0?this:qs.create(t.locale||this.specifiedLocale,t.numberingSystem||this.numberingSystem,t.outputCalendar||this.outputCalendar,t.defaultToEN||!1)}redefaultToEN(t={}){return this.clone({...t,defaultToEN:!0})}redefaultToSystem(t={}){return this.clone({...t,defaultToEN:!1})}months(t,r=!1,i=!0){return XD(this,t,i,HEe,()=>{const s=r?{month:t,day:"numeric"}:{month:t},n=r?"format":"standalone";return this.monthsCache[n][t]||(this.monthsCache[n][t]=PYe(o=>this.extract(o,s,"month"))),this.monthsCache[n][t]})}weekdays(t,r=!1,i=!0){return XD(this,t,i,XEe,()=>{const s=r?{weekday:t,year:"numeric",month:"long",day:"numeric"}:{weekday:t},n=r?"format":"standalone";return this.weekdaysCache[n][t]||(this.weekdaysCache[n][t]=IYe(o=>this.extract(o,s,"weekday"))),this.weekdaysCache[n][t]})}meridiems(t=!0){return XD(this,void 0,t,()=>ZEe,()=>{if(!this.meridiemCache){const r={hour:"numeric",hourCycle:"h12"};this.meridiemCache=[nr.utc(2016,11,13,9),nr.utc(2016,11,13,19)].map(i=>this.extract(i,r,"dayperiod"))}return this.meridiemCache})}eras(t,r=!0){return XD(this,t,r,YEe,()=>{const i={era:t};return this.eraCache[t]||(this.eraCache[t]=[nr.utc(-40,1,1),nr.utc(2017,1,1)].map(s=>this.extract(s,i,"era"))),this.eraCache[t]})}extract(t,r,i){const s=this.dtFormatter(t,r),n=s.formatToParts(),o=n.find(a=>a.type.toLowerCase()===i);return o?o.value:null}numberFormatter(t={}){return new LYe(this.intl,t.forceSimple||this.fastNumbers,t)}dtFormatter(t,r={}){return new DYe(t,this.intl,r)}relFormatter(t={}){return new NYe(this.intl,this.isEnglish(),t)}listFormatter(t={}){return EYe(this.intl,t)}isEnglish(){return this.locale==="en"||this.locale.toLowerCase()==="en-us"||new Intl.DateTimeFormat(this.intl).resolvedOptions().locale.startsWith("en-us")}equals(t){return this.locale===t.locale&&this.numberingSystem===t.numberingSystem&&this.outputCalendar===t.outputCalendar}}function vR(...e){const t=e.reduce((r,i)=>r+i.source,"");return RegExp(`^${t}$`)}function _R(...e){return t=>e.reduce(([r,i,s],n)=>{const[o,a,l]=n(t,s);return[{...r,...o},a||i,l]},[{},null,1]).slice(0,2)}function bR(e,...t){if(e==null)return[null,null];for(const[r,i]of t){const s=r.exec(e);if(s)return i(s)}return[null,null]}function QEe(...e){return(t,r)=>{const i={};let s;for(s=0;s<e.length;s++)i[e[s]]=d_(t[r+s]);return[i,null,r+s]}}const JEe=/(?:(Z)|([+-]\d\d)(?::?(\d\d))?)/,FYe=`(?:${JEe.source}?(?:\\[(${GEe.source})\\])?)?`,lre=/(\d\d)(?::?(\d\d)(?::?(\d\d)(?:[.,](\d{1,30}))?)?)?/,KEe=RegExp(`${lre.source}${FYe}`),cre=RegExp(`(?:T${KEe.source})?`),kYe=/([+-]\d{6}|\d{4})(?:-?(\d\d)(?:-?(\d\d))?)?/,UYe=/(\d{4})-?W(\d\d)(?:-?(\d))?/,VYe=/(\d{4})-?(\d{3})/,zYe=QEe("weekYear","weekNumber","weekDay"),BYe=QEe("year","ordinal"),GYe=/(\d{4})-(\d\d)-(\d\d)/,eCe=RegExp(`${lre.source} ?(?:${JEe.source}|(${GEe.source}))?`),jYe=RegExp(`(?: ${eCe.source})?`);function fC(e,t,r){const i=e[t];return Jr(i)?r:d_(i)}function HYe(e,t){return[{year:fC(e,t),month:fC(e,t+1,1),day:fC(e,t+2,1)},null,t+3]}function wR(e,t){return[{hours:fC(e,t,0),minutes:fC(e,t+1,0),seconds:fC(e,t+2,0),milliseconds:sre(e[t+3])},null,t+4]}function oL(e,t){const r=!e[t]&&!e[t+1],i=Y6(e[t+1],e[t+2]),s=r?null:Zl.instance(i);return[{},s,t+3]}function aL(e,t){const r=e[t]?m0.create(e[t]):null;return[{},r,t+1]}const qYe=RegExp(`^T?${lre.source}$`),WYe=/^-?P(?:(?:(-?\d{1,9}(?:\.\d{1,9})?)Y)?(?:(-?\d{1,9}(?:\.\d{1,9})?)M)?(?:(-?\d{1,9}(?:\.\d{1,9})?)W)?(?:(-?\d{1,9}(?:\.\d{1,9})?)D)?(?:T(?:(-?\d{1,9}(?:\.\d{1,9})?)H)?(?:(-?\d{1,9}(?:\.\d{1,9})?)M)?(?:(-?\d{1,20})(?:[.,](-?\d{1,9}))?S)?)?)$/;function XYe(e){const[t,r,i,s,n,o,a,l,c]=e,h=t[0]==="-",p=l&&l[0]==="-",f=(m,g=!1)=>m!==void 0&&(g||m&&h)?-m:m;return[{years:f(lb(r)),months:f(lb(i)),weeks:f(lb(s)),days:f(lb(n)),hours:f(lb(o)),minutes:f(lb(a)),seconds:f(lb(l),l==="-0"),milliseconds:f(sre(c),p)}]}const ZYe={GMT:0,EDT:-4*60,EST:-5*60,CDT:-5*60,CST:-6*60,MDT:-6*60,MST:-7*60,PDT:-7*60,PST:-8*60};function ure(e,t,r,i,s,n,o){const a={year:t.length===2?RZ(d_(t)):d_(t),month:jEe.indexOf(r)+1,day:d_(i),hour:d_(s),minute:d_(n)};return o&&(a.second=d_(o)),e&&(a.weekday=e.length>3?qEe.indexOf(e)+1:WEe.indexOf(e)+1),a}const YYe=/^(?:(Mon|Tue|Wed|Thu|Fri|Sat|Sun),\s)?(\d{1,2})\s(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s(\d{2,4})\s(\d\d):(\d\d)(?::(\d\d))?\s(?:(UT|GMT|[ECMP][SD]T)|([Zz])|(?:([+-]\d\d)(\d\d)))$/;function QYe(e){const[,t,r,i,s,n,o,a,l,c,h,p]=e,f=ure(t,s,i,r,n,o,a);let m;return l?m=ZYe[l]:c?m=0:m=Y6(h,p),[f,new Zl(m)]}function JYe(e){return e.replace(/\([^)]*\)|[\n\t]/g," ").replace(/(\s\s+)/g," ").trim()}const KYe=/^(Mon|Tue|Wed|Thu|Fri|Sat|Sun), (\d\d) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) (\d{4}) (\d\d):(\d\d):(\d\d) GMT$/,eQe=/^(Monday|Tuesday|Wedsday|Thursday|Friday|Saturday|Sunday), (\d\d)-(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)-(\d\d) (\d\d):(\d\d):(\d\d) GMT$/,tQe=/^(Mon|Tue|Wed|Thu|Fri|Sat|Sun) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) ( \d|\d\d) (\d\d):(\d\d):(\d\d) (\d{4})$/;function Jce(e){const[,t,r,i,s,n,o,a]=e;return[ure(t,s,i,r,n,o,a),Zl.utcInstance]}function rQe(e){const[,t,r,i,s,n,o,a]=e;return[ure(t,a,r,i,s,n,o),Zl.utcInstance]}const iQe=vR(kYe,cre),sQe=vR(UYe,cre),nQe=vR(VYe,cre),oQe=vR(KEe),tCe=_R(HYe,wR,oL,aL),aQe=_R(zYe,wR,oL,aL),lQe=_R(BYe,wR,oL,aL),cQe=_R(wR,oL,aL);function uQe(e){return bR(e,[iQe,tCe],[sQe,aQe],[nQe,lQe],[oQe,cQe])}function hQe(e){return bR(JYe(e),[YYe,QYe])}function dQe(e){return bR(e,[KYe,Jce],[eQe,Jce],[tQe,rQe])}function pQe(e){return bR(e,[WYe,XYe])}const fQe=_R(wR);function mQe(e){return bR(e,[qYe,fQe])}const gQe=vR(GYe,jYe),yQe=vR(eCe),vQe=_R(wR,oL,aL);function _Qe(e){return bR(e,[gQe,tCe],[yQe,vQe])}const bQe="Invalid Duration",rCe={weeks:{days:7,hours:7*24,minutes:7*24*60,seconds:7*24*60*60,milliseconds:7*24*60*60*1e3},days:{hours:24,minutes:24*60,seconds:24*60*60,milliseconds:24*60*60*1e3},hours:{minutes:60,seconds:60*60,milliseconds:60*60*1e3},minutes:{seconds:60,milliseconds:60*1e3},seconds:{milliseconds:1e3}},wQe={years:{quarters:4,months:12,weeks:52,days:365,hours:365*24,minutes:365*24*60,seconds:365*24*60*60,milliseconds:365*24*60*60*1e3},quarters:{months:3,weeks:13,days:91,hours:91*24,minutes:91*24*60,seconds:91*24*60*60,milliseconds:91*24*60*60*1e3},months:{weeks:4,days:30,hours:30*24,minutes:30*24*60,seconds:30*24*60*60,milliseconds:30*24*60*60*1e3},...rCe},Ih=146097/400,mS=146097/4800,xQe={years:{quarters:4,months:12,weeks:Ih/7,days:Ih,hours:Ih*24,minutes:Ih*24*60,seconds:Ih*24*60*60,milliseconds:Ih*24*60*60*1e3},quarters:{months:3,weeks:Ih/28,days:Ih/4,hours:Ih*24/4,minutes:Ih*24*60/4,seconds:Ih*24*60*60/4,milliseconds:Ih*24*60*60*1e3/4},months:{weeks:mS/7,days:mS,hours:mS*24,minutes:mS*24*60,seconds:mS*24*60*60,milliseconds:mS*24*60*60*1e3},...rCe},dw=["years","quarters","months","weeks","days","hours","minutes","seconds","milliseconds"],TQe=dw.slice(0).reverse();function cb(e,t,r=!1){const i={values:r?t.values:{...e.values,...t.values||{}},loc:e.loc.clone(t.loc),conversionAccuracy:t.conversionAccuracy||e.conversionAccuracy};return new li(i)}function SQe(e){return e<0?Math.floor(e):Math.ceil(e)}function iCe(e,t,r,i,s){const n=e[s][r],o=t[r]/n,a=Math.sign(o)===Math.sign(i[s]),l=!a&&i[s]!==0&&Math.abs(o)<=1?SQe(o):Math.trunc(o);i[s]+=l,t[r]-=l*n}function EQe(e,t){TQe.reduce((r,i)=>Jr(t[i])?r:(r&&iCe(e,t,r,t,i),i),null)}class li{constructor(t){const r=t.conversionAccuracy==="longterm"||!1;this.values=t.values,this.loc=t.loc||qs.create(),this.conversionAccuracy=r?"longterm":"casual",this.invalid=t.invalid||null,this.matrix=r?xQe:wQe,this.isLuxonDuration=!0}static fromMillis(t,r){return li.fromObject({milliseconds:t},r)}static fromObject(t,r={}){if(t==null||typeof t!="object")throw new vd(`Duration.fromObject: argument expected to be an object, got ${t===null?"null":typeof t}`);return new li({values:hV(t,li.normalizeUnit),loc:qs.fromObject(r),conversionAccuracy:r.conversionAccuracy})}static fromDurationLike(t){if(Hx(t))return li.fromMillis(t);if(li.isDuration(t))return t;if(typeof t=="object")return li.fromObject(t);throw new vd(`Unknown duration argument ${t} of type ${typeof t}`)}static fromISO(t,r){const[i]=pQe(t);return i?li.fromObject(i,r):li.invalid("unparsable",`the input "${t}" can't be parsed as ISO 8601`)}static fromISOTime(t,r){const[i]=mQe(t);return i?li.fromObject(i,r):li.invalid("unparsable",`the input "${t}" can't be parsed as ISO 8601`)}static invalid(t,r=null){if(!t)throw new vd("need to specify a reason the Duration is invalid");const i=t instanceof of?t:new of(t,r);if(xo.throwOnInvalid)throw new eYe(i);return new li({invalid:i})}static normalizeUnit(t){const r={year:"years",years:"years",quarter:"quarters",quarters:"quarters",month:"months",months:"months",week:"weeks",weeks:"weeks",day:"days",days:"days",hour:"hours",hours:"hours",minute:"minutes",minutes:"minutes",second:"seconds",seconds:"seconds",millisecond:"milliseconds",milliseconds:"milliseconds"}[t&&t.toLowerCase()];if(!r)throw new bEe(t);return r}static isDuration(t){return t&&t.isLuxonDuration||!1}get locale(){return this.isValid?this.loc.locale:null}get numberingSystem(){return this.isValid?this.loc.numberingSystem:null}toFormat(t,r={}){const i={...r,floor:r.round!==!1&&r.floor!==!1};return this.isValid?Wc.create(this.loc,i).formatDurationFromString(this,t):bQe}toHuman(t={}){const r=dw.map(i=>{const s=this.values[i];return Jr(s)?null:this.loc.numberFormatter({style:"unit",unitDisplay:"long",...t,unit:i.slice(0,-1)}).format(s)}).filter(i=>i);return this.loc.listFormatter({type:"conjunction",style:t.listStyle||"narrow",...t}).format(r)}toObject(){return this.isValid?{...this.values}:{}}toISO(){if(!this.isValid)return null;let t="P";return this.years!==0&&(t+=this.years+"Y"),(this.months!==0||this.quarters!==0)&&(t+=this.months+this.quarters*3+"M"),this.weeks!==0&&(t+=this.weeks+"W"),this.days!==0&&(t+=this.days+"D"),(this.hours!==0||this.minutes!==0||this.seconds!==0||this.milliseconds!==0)&&(t+="T"),this.hours!==0&&(t+=this.hours+"H"),this.minutes!==0&&(t+=this.minutes+"M"),(this.seconds!==0||this.milliseconds!==0)&&(t+=nre(this.seconds+this.milliseconds/1e3,3)+"S"),t==="P"&&(t+="T0S"),t}toISOTime(t={}){if(!this.isValid)return null;const r=this.toMillis();if(r<0||r>=864e5)return null;t={suppressMilliseconds:!1,suppressSeconds:!1,includePrefix:!1,format:"extended",...t};const i=this.shiftTo("hours","minutes","seconds","milliseconds");let s=t.format==="basic"?"hhmm":"hh:mm";(!t.suppressSeconds||i.seconds!==0||i.milliseconds!==0)&&(s+=t.format==="basic"?"ss":":ss",(!t.suppressMilliseconds||i.milliseconds!==0)&&(s+=".SSS"));let n=i.toFormat(s);return t.includePrefix&&(n="T"+n),n}toJSON(){return this.toISO()}toString(){return this.toISO()}toMillis(){return this.as("milliseconds")}valueOf(){return this.toMillis()}plus(t){if(!this.isValid)return this;const r=li.fromDurationLike(t),i={};for(const s of dw)(gA(r.values,s)||gA(this.values,s))&&(i[s]=r.get(s)+this.get(s));return cb(this,{values:i},!0)}minus(t){if(!this.isValid)return this;const r=li.fromDurationLike(t);return this.plus(r.negate())}mapUnits(t){if(!this.isValid)return this;const r={};for(const i of Object.keys(this.values))r[i]=BEe(t(this.values[i],i));return cb(this,{values:r},!0)}get(t){return this[li.normalizeUnit(t)]}set(t){if(!this.isValid)return this;const r={...this.values,...hV(t,li.normalizeUnit)};return cb(this,{values:r})}reconfigure({locale:t,numberingSystem:r,conversionAccuracy:i}={}){const s=this.loc.clone({locale:t,numberingSystem:r}),n={loc:s};return i&&(n.conversionAccuracy=i),cb(this,n)}as(t){return this.isValid?this.shiftTo(t).get(t):NaN}normalize(){if(!this.isValid)return this;const t=this.toObject();return EQe(this.matrix,t),cb(this,{values:t},!0)}shiftTo(...t){if(!this.isValid)return this;if(t.length===0)return this;t=t.map(o=>li.normalizeUnit(o));const r={},i={},s=this.toObject();let n;for(const o of dw)if(t.indexOf(o)>=0){n=o;let a=0;for(const c in i)a+=this.matrix[c][o]*i[c],i[c]=0;Hx(s[o])&&(a+=s[o]);const l=Math.trunc(a);r[o]=l,i[o]=(a*1e3-l*1e3)/1e3;for(const c in s)dw.indexOf(c)>dw.indexOf(o)&&iCe(this.matrix,s,c,r,o)}else Hx(s[o])&&(i[o]=s[o]);for(const o in i)i[o]!==0&&(r[n]+=o===n?i[o]:i[o]/this.matrix[n][o]);return cb(this,{values:r},!0).normalize()}negate(){if(!this.isValid)return this;const t={};for(const r of Object.keys(this.values))t[r]=this.values[r]===0?0:-this.values[r];return cb(this,{values:t},!0)}get years(){return this.isValid?this.values.years||0:NaN}get quarters(){return this.isValid?this.values.quarters||0:NaN}get months(){return this.isValid?this.values.months||0:NaN}get weeks(){return this.isValid?this.values.weeks||0:NaN}get days(){return this.isValid?this.values.days||0:NaN}get hours(){return this.isValid?this.values.hours||0:NaN}get minutes(){return this.isValid?this.values.minutes||0:NaN}get seconds(){return this.isValid?this.values.seconds||0:NaN}get milliseconds(){return this.isValid?this.values.milliseconds||0:NaN}get isValid(){return this.invalid===null}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}equals(t){if(!this.isValid||!t.isValid||!this.loc.equals(t.loc))return!1;function r(i,s){return i===void 0||i===0?s===void 0||s===0:i===s}for(const i of dw)if(!r(this.values[i],t.values[i]))return!1;return!0}}const nO="Invalid Interval";function CQe(e,t){return!e||!e.isValid?cn.invalid("missing or invalid start"):!t||!t.isValid?cn.invalid("missing or invalid end"):t<e?cn.invalid("end before start",`The end of an interval must be after its start, but you had start=${e.toISO()} and end=${t.toISO()}`):null}class cn{constructor(t){this.s=t.start,this.e=t.end,this.invalid=t.invalid||null,this.isLuxonInterval=!0}static invalid(t,r=null){if(!t)throw new vd("need to specify a reason the Interval is invalid");const i=t instanceof of?t:new of(t,r);if(xo.throwOnInvalid)throw new KZe(i);return new cn({invalid:i})}static fromDateTimes(t,r){const i=lO(t),s=lO(r),n=CQe(i,s);return n==null?new cn({start:i,end:s}):n}static after(t,r){const i=li.fromDurationLike(r),s=lO(t);return cn.fromDateTimes(s,s.plus(i))}static before(t,r){const i=li.fromDurationLike(r),s=lO(t);return cn.fromDateTimes(s.minus(i),s)}static fromISO(t,r){const[i,s]=(t||"").split("/",2);if(i&&s){let n,o;try{n=nr.fromISO(i,r),o=n.isValid}catch{o=!1}let a,l;try{a=nr.fromISO(s,r),l=a.isValid}catch{l=!1}if(o&&l)return cn.fromDateTimes(n,a);if(o){const c=li.fromISO(s,r);if(c.isValid)return cn.after(n,c)}else if(l){const c=li.fromISO(i,r);if(c.isValid)return cn.before(a,c)}}return cn.invalid("unparsable",`the input "${t}" can't be parsed as ISO 8601`)}static isInterval(t){return t&&t.isLuxonInterval||!1}get start(){return this.isValid?this.s:null}get end(){return this.isValid?this.e:null}get isValid(){return this.invalidReason===null}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}length(t="milliseconds"){return this.isValid?this.toDuration(t).get(t):NaN}count(t="milliseconds"){if(!this.isValid)return NaN;const r=this.start.startOf(t),i=this.end.startOf(t);return Math.floor(i.diff(r,t).get(t))+1}hasSame(t){return this.isValid?this.isEmpty()||this.e.minus(1).hasSame(this.s,t):!1}isEmpty(){return this.s.valueOf()===this.e.valueOf()}isAfter(t){return this.isValid?this.s>t:!1}isBefore(t){return this.isValid?this.e<=t:!1}contains(t){return this.isValid?this.s<=t&&this.e>t:!1}set({start:t,end:r}={}){return this.isValid?cn.fromDateTimes(t||this.s,r||this.e):this}splitAt(...t){if(!this.isValid)return[];const r=t.map(lO).filter(o=>this.contains(o)).sort(),i=[];let{s}=this,n=0;for(;s<this.e;){const o=r[n]||this.e,a=+o>+this.e?this.e:o;i.push(cn.fromDateTimes(s,a)),s=a,n+=1}return i}splitBy(t){const r=li.fromDurationLike(t);if(!this.isValid||!r.isValid||r.as("milliseconds")===0)return[];let{s:i}=this,s=1,n;const o=[];for(;i<this.e;){const a=this.start.plus(r.mapUnits(l=>l*s));n=+a>+this.e?this.e:a,o.push(cn.fromDateTimes(i,n)),i=n,s+=1}return o}divideEqually(t){return this.isValid?this.splitBy(this.length()/t).slice(0,t):[]}overlaps(t){return this.e>t.s&&this.s<t.e}abutsStart(t){return this.isValid?+this.e==+t.s:!1}abutsEnd(t){return this.isValid?+t.e==+this.s:!1}engulfs(t){return this.isValid?this.s<=t.s&&this.e>=t.e:!1}equals(t){return!this.isValid||!t.isValid?!1:this.s.equals(t.s)&&this.e.equals(t.e)}intersection(t){if(!this.isValid)return this;const r=this.s>t.s?this.s:t.s,i=this.e<t.e?this.e:t.e;return r>=i?null:cn.fromDateTimes(r,i)}union(t){if(!this.isValid)return this;const r=this.s<t.s?this.s:t.s,i=this.e>t.e?this.e:t.e;return cn.fromDateTimes(r,i)}static merge(t){const[r,i]=t.sort((s,n)=>s.s-n.s).reduce(([s,n],o)=>n?n.overlaps(o)||n.abutsStart(o)?[s,n.union(o)]:[s.concat([n]),o]:[s,o],[[],null]);return i&&r.push(i),r}static xor(t){let r=null,i=0;const s=[],n=t.map(l=>[{time:l.s,type:"s"},{time:l.e,type:"e"}]),o=Array.prototype.concat(...n),a=o.sort((l,c)=>l.time-c.time);for(const l of a)i+=l.type==="s"?1:-1,i===1?r=l.time:(r&&+r!=+l.time&&s.push(cn.fromDateTimes(r,l.time)),r=null);return cn.merge(s)}difference(...t){return cn.xor([this].concat(t)).map(r=>this.intersection(r)).filter(r=>r&&!r.isEmpty())}toString(){return this.isValid?`[${this.s.toISO()} \u2013 ${this.e.toISO()})`:nO}toISO(t){return this.isValid?`${this.s.toISO(t)}/${this.e.toISO(t)}`:nO}toISODate(){return this.isValid?`${this.s.toISODate()}/${this.e.toISODate()}`:nO}toISOTime(t){return this.isValid?`${this.s.toISOTime(t)}/${this.e.toISOTime(t)}`:nO}toFormat(t,{separator:r=" \u2013 "}={}){return this.isValid?`${this.s.toFormat(t)}${r}${this.e.toFormat(t)}`:nO}toDuration(t,r){return this.isValid?this.e.diff(this.s,t,r):li.invalid(this.invalidReason)}mapEndpoints(t){return cn.fromDateTimes(t(this.s),t(this.e))}}class ZD{static hasDST(t=xo.defaultZone){const r=nr.now().setZone(t).set({month:12});return!t.isUniversal&&r.offset!==r.set({month:6}).offset}static isValidIANAZone(t){return m0.isValidZone(t)}static normalizeZone(t){return S_(t,xo.defaultZone)}static months(t="long",{locale:r=null,numberingSystem:i=null,locObj:s=null,outputCalendar:n="gregory"}={}){return(s||qs.create(r,i,n)).months(t)}static monthsFormat(t="long",{locale:r=null,numberingSystem:i=null,locObj:s=null,outputCalendar:n="gregory"}={}){return(s||qs.create(r,i,n)).months(t,!0)}static weekdays(t="long",{locale:r=null,numberingSystem:i=null,locObj:s=null}={}){return(s||qs.create(r,i,null)).weekdays(t)}static weekdaysFormat(t="long",{locale:r=null,numberingSystem:i=null,locObj:s=null}={}){return(s||qs.create(r,i,null)).weekdays(t,!0)}static meridiems({locale:t=null}={}){return qs.create(t).meridiems()}static eras(t="short",{locale:r=null}={}){return qs.create(r,null,"gregory").eras(t)}static features(){return{relative:VEe()}}}function Kce(e,t){const r=s=>s.toUTC(0,{keepLocalTime:!0}).startOf("day").valueOf(),i=r(t)-r(e);return Math.floor(li.fromMillis(i).as("days"))}function AQe(e,t,r){const i=[["years",(a,l)=>l.year-a.year],["quarters",(a,l)=>l.quarter-a.quarter],["months",(a,l)=>l.month-a.month+(l.year-a.year)*12],["weeks",(a,l)=>{const c=Kce(a,l);return(c-c%7)/7}],["days",Kce]],s={};let n,o;for(const[a,l]of i)if(r.indexOf(a)>=0){n=a;let c=l(e,t);o=e.plus({[a]:c}),o>t?(e=e.plus({[a]:c-1}),c-=1):e=o,s[a]=c}return[e,s,o,n]}function RQe(e,t,r,i){let[s,n,o,a]=AQe(e,t,r);const l=t-s,c=r.filter(p=>["hours","minutes","seconds","milliseconds"].indexOf(p)>=0);c.length===0&&(o<t&&(o=s.plus({[a]:1})),o!==s&&(n[a]=(n[a]||0)+l/(o-s)));const h=li.fromObject(n,i);return c.length>0?li.fromMillis(l,i).shiftTo(...c).plus(h):h}const hre={arab:"[\u0660-\u0669]",arabext:"[\u06F0-\u06F9]",bali:"[\u1B50-\u1B59]",beng:"[\u09E6-\u09EF]",deva:"[\u0966-\u096F]",fullwide:"[\uFF10-\uFF19]",gujr:"[\u0AE6-\u0AEF]",hanidec:"[\u3007|\u4E00|\u4E8C|\u4E09|\u56DB|\u4E94|\u516D|\u4E03|\u516B|\u4E5D]",khmr:"[\u17E0-\u17E9]",knda:"[\u0CE6-\u0CEF]",laoo:"[\u0ED0-\u0ED9]",limb:"[\u1946-\u194F]",mlym:"[\u0D66-\u0D6F]",mong:"[\u1810-\u1819]",mymr:"[\u1040-\u1049]",orya:"[\u0B66-\u0B6F]",tamldec:"[\u0BE6-\u0BEF]",telu:"[\u0C66-\u0C6F]",thai:"[\u0E50-\u0E59]",tibt:"[\u0F20-\u0F29]",latn:"\\d"},eue={arab:[1632,1641],arabext:[1776,1785],bali:[6992,7001],beng:[2534,2543],deva:[2406,2415],fullwide:[65296,65303],gujr:[2790,2799],khmr:[6112,6121],knda:[3302,3311],laoo:[3792,3801],limb:[6470,6479],mlym:[3430,3439],mong:[6160,6169],mymr:[4160,4169],orya:[2918,2927],tamldec:[3046,3055],telu:[3174,3183],thai:[3664,3673],tibt:[3872,3881]},OQe=hre.hanidec.replace(/[\[|\]]/g,"").split("");function MQe(e){let t=parseInt(e,10);if(isNaN(t)){t="";for(let r=0;r<e.length;r++){const i=e.charCodeAt(r);if(e[r].search(hre.hanidec)!==-1)t+=OQe.indexOf(e[r]);else for(const s in eue){const[n,o]=eue[s];i>=n&&i<=o&&(t+=i-n)}}return parseInt(t,10)}else return t}function sp({numberingSystem:e},t=""){return new RegExp(`${hre[e||"latn"]}${t}`)}const PQe="missing Intl.DateTimeFormat.formatToParts support";function bi(e,t=r=>r){return{regex:e,deser:([r])=>t(MQe(r))}}const IQe=String.fromCharCode(160),sCe=`[ ${IQe}]`,nCe=new RegExp(sCe,"g");function $Qe(e){return e.replace(/\./g,"\\.?").replace(nCe,sCe)}function tue(e){return e.replace(/\./g,"").replace(nCe," ").toLowerCase()}function np(e,t){return e===null?null:{regex:RegExp(e.map($Qe).join("|")),deser:([r])=>e.findIndex(i=>tue(r)===tue(i))+t}}function rue(e,t){return{regex:e,deser:([,r,i])=>Y6(r,i),groups:t}}function TG(e){return{regex:e,deser:([t])=>t}}function LQe(e){return e.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function DQe(e,t){const r=sp(t),i=sp(t,"{2}"),s=sp(t,"{3}"),n=sp(t,"{4}"),o=sp(t,"{6}"),a=sp(t,"{1,2}"),l=sp(t,"{1,3}"),c=sp(t,"{1,6}"),h=sp(t,"{1,9}"),p=sp(t,"{2,4}"),f=sp(t,"{4,6}"),m=w=>({regex:RegExp(LQe(w.val)),deser:([_])=>_,literal:!0}),v=(w=>{if(e.literal)return m(w);switch(w.val){case"G":return np(t.eras("short",!1),0);case"GG":return np(t.eras("long",!1),0);case"y":return bi(c);case"yy":return bi(p,RZ);case"yyyy":return bi(n);case"yyyyy":return bi(f);case"yyyyyy":return bi(o);case"M":return bi(a);case"MM":return bi(i);case"MMM":return np(t.months("short",!0,!1),1);case"MMMM":return np(t.months("long",!0,!1),1);case"L":return bi(a);case"LL":return bi(i);case"LLL":return np(t.months("short",!1,!1),1);case"LLLL":return np(t.months("long",!1,!1),1);case"d":return bi(a);case"dd":return bi(i);case"o":return bi(l);case"ooo":return bi(s);case"HH":return bi(i);case"H":return bi(a);case"hh":return bi(i);case"h":return bi(a);case"mm":return bi(i);case"m":return bi(a);case"q":return bi(a);case"qq":return bi(i);case"s":return bi(a);case"ss":return bi(i);case"S":return bi(l);case"SSS":return bi(s);case"u":return TG(h);case"uu":return TG(a);case"uuu":return bi(r);case"a":return np(t.meridiems(),0);case"kkkk":return bi(n);case"kk":return bi(p,RZ);case"W":return bi(a);case"WW":return bi(i);case"E":case"c":return bi(r);case"EEE":return np(t.weekdays("short",!1,!1),1);case"EEEE":return np(t.weekdays("long",!1,!1),1);case"ccc":return np(t.weekdays("short",!0,!1),1);case"cccc":return np(t.weekdays("long",!0,!1),1);case"Z":case"ZZ":return rue(new RegExp(`([+-]${a.source})(?::(${i.source}))?`),2);case"ZZZ":return rue(new RegExp(`([+-]${a.source})(${i.source})?`),2);case"z":return TG(/[a-z_+-/]{1,256}?/i);default:return m(w)}})(e)||{invalidReason:PQe};return v.token=e,v}const NQe={year:{"2-digit":"yy",numeric:"yyyyy"},month:{numeric:"M","2-digit":"MM",short:"MMM",long:"MMMM"},day:{numeric:"d","2-digit":"dd"},weekday:{short:"EEE",long:"EEEE"},dayperiod:"a",dayPeriod:"a",hour:{numeric:"h","2-digit":"hh"},minute:{numeric:"m","2-digit":"mm"},second:{numeric:"s","2-digit":"ss"}};function FQe(e,t,r){const{type:i,value:s}=e;if(i==="literal")return{literal:!0,val:s};const n=r[i];let o=NQe[i];if(typeof o=="object"&&(o=o[n]),o)return{literal:!1,val:o}}function kQe(e){return[`^${e.map(r=>r.regex).reduce((r,i)=>`${r}(${i.source})`,"")}$`,e]}function UQe(e,t,r){const i=e.match(t);if(i){const s={};let n=1;for(const o in r)if(gA(r,o)){const a=r[o],l=a.groups?a.groups+1:1;!a.literal&&a.token&&(s[a.token.val[0]]=a.deser(i.slice(n,n+l))),n+=l}return[i,s]}else return[i,{}]}function VQe(e){const t=n=>{switch(n){case"S":return"millisecond";case"s":return"second";case"m":return"minute";case"h":case"H":return"hour";case"d":return"day";case"o":return"ordinal";case"L":case"M":return"month";case"y":return"year";case"E":case"c":return"weekday";case"W":return"weekNumber";case"k":return"weekYear";case"q":return"quarter";default:return null}};let r=null,i;return Jr(e.z)||(r=m0.create(e.z)),Jr(e.Z)||(r||(r=new Zl(e.Z)),i=e.Z),Jr(e.q)||(e.M=(e.q-1)*3+1),Jr(e.h)||(e.h<12&&e.a===1?e.h+=12:e.h===12&&e.a===0&&(e.h=0)),e.G===0&&e.y&&(e.y=-e.y),Jr(e.u)||(e.S=sre(e.u)),[Object.keys(e).reduce((n,o)=>{const a=t(o);return a&&(n[a]=e[o]),n},{}),r,i]}let SG=null;function zQe(){return SG||(SG=nr.fromMillis(1555555555555)),SG}function BQe(e,t){if(e.literal)return e;const r=Wc.macroTokenToFormatOpts(e.val);if(!r)return e;const n=Wc.create(t,r).formatDateTimeParts(zQe()).map(o=>FQe(o,t,r));return n.includes(void 0)?e:n}function GQe(e,t){return Array.prototype.concat(...e.map(r=>BQe(r,t)))}function oCe(e,t,r){const i=GQe(Wc.parseFormat(r),e),s=i.map(o=>DQe(o,e)),n=s.find(o=>o.invalidReason);if(n)return{input:t,tokens:i,invalidReason:n.invalidReason};{const[o,a]=kQe(s),l=RegExp(o,"i"),[c,h]=UQe(t,l,a),[p,f,m]=h?VQe(h):[null,null,void 0];if(gA(h,"a")&&gA(h,"H"))throw new jM("Can't include meridiem when specifying 24-hour format");return{input:t,tokens:i,regex:l,rawMatches:c,matches:h,result:p,zone:f,specificOffset:m}}}function jQe(e,t,r){const{result:i,zone:s,specificOffset:n,invalidReason:o}=oCe(e,t,r);return[i,s,n,o]}const aCe=[0,31,59,90,120,151,181,212,243,273,304,334],lCe=[0,31,60,91,121,152,182,213,244,274,305,335];function Od(e,t){return new of("unit out of range",`you specified ${t} (of type ${typeof t}) as a ${e}, which is invalid`)}function cCe(e,t,r){const i=new Date(Date.UTC(e,t-1,r));e<100&&e>=0&&i.setUTCFullYear(i.getUTCFullYear()-1900);const s=i.getUTCDay();return s===0?7:s}function uCe(e,t,r){return r+(sL(e)?lCe:aCe)[t-1]}function hCe(e,t){const r=sL(e)?lCe:aCe,i=r.findIndex(n=>n<t),s=t-r[i];return{month:i+1,day:s}}function $Z(e){const{year:t,month:r,day:i}=e,s=uCe(t,r,i),n=cCe(t,r,i);let o=Math.floor((s-n+10)/7),a;return o<1?(a=t-1,o=uV(a)):o>uV(t)?(a=t+1,o=1):a=t,{weekYear:a,weekNumber:o,weekday:n,...Q6(e)}}function iue(e){const{weekYear:t,weekNumber:r,weekday:i}=e,s=cCe(t,1,4),n=iP(t);let o=r*7+i-s-3,a;o<1?(a=t-1,o+=iP(a)):o>n?(a=t+1,o-=iP(t)):a=t;const{month:l,day:c}=hCe(a,o);return{year:a,month:l,day:c,...Q6(e)}}function EG(e){const{year:t,month:r,day:i}=e,s=uCe(t,r,i);return{year:t,ordinal:s,...Q6(e)}}function sue(e){const{year:t,ordinal:r}=e,{month:i,day:s}=hCe(t,r);return{year:t,month:i,day:s,...Q6(e)}}function HQe(e){const t=Z6(e.weekYear),r=Fy(e.weekNumber,1,uV(e.weekYear)),i=Fy(e.weekday,1,7);return t?r?i?!1:Od("weekday",e.weekday):Od("week",e.week):Od("weekYear",e.weekYear)}function qQe(e){const t=Z6(e.year),r=Fy(e.ordinal,1,iP(e.year));return t?r?!1:Od("ordinal",e.ordinal):Od("year",e.year)}function dCe(e){const t=Z6(e.year),r=Fy(e.month,1,12),i=Fy(e.day,1,cV(e.year,e.month));return t?r?i?!1:Od("day",e.day):Od("month",e.month):Od("year",e.year)}function pCe(e){const{hour:t,minute:r,second:i,millisecond:s}=e,n=Fy(t,0,23)||t===24&&r===0&&i===0&&s===0,o=Fy(r,0,59),a=Fy(i,0,59),l=Fy(s,0,999);return n?o?a?l?!1:Od("millisecond",s):Od("second",i):Od("minute",r):Od("hour",t)}const CG="Invalid DateTime",nue=864e13;function YD(e){return new of("unsupported zone",`the zone "${e.name}" is not supported`)}function AG(e){return e.weekData===null&&(e.weekData=$Z(e.c)),e.weekData}function oO(e,t){const r={ts:e.ts,zone:e.zone,c:e.c,o:e.o,loc:e.loc,invalid:e.invalid};return new nr({...r,...t,old:r})}function fCe(e,t,r){let i=e-t*60*1e3;const s=r.offset(i);if(t===s)return[i,t];i-=(s-t)*60*1e3;const n=r.offset(i);return s===n?[i,s]:[e-Math.min(s,n)*60*1e3,Math.max(s,n)]}function oue(e,t){e+=t*60*1e3;const r=new Date(e);return{year:r.getUTCFullYear(),month:r.getUTCMonth()+1,day:r.getUTCDate(),hour:r.getUTCHours(),minute:r.getUTCMinutes(),second:r.getUTCSeconds(),millisecond:r.getUTCMilliseconds()}}function g5(e,t,r){return fCe(ore(e),t,r)}function aue(e,t){const r=e.o,i=e.c.year+Math.trunc(t.years),s=e.c.month+Math.trunc(t.months)+Math.trunc(t.quarters)*3,n={...e.c,year:i,month:s,day:Math.min(e.c.day,cV(i,s))+Math.trunc(t.days)+Math.trunc(t.weeks)*7},o=li.fromObject({years:t.years-Math.trunc(t.years),quarters:t.quarters-Math.trunc(t.quarters),months:t.months-Math.trunc(t.months),weeks:t.weeks-Math.trunc(t.weeks),days:t.days-Math.trunc(t.days),hours:t.hours,minutes:t.minutes,seconds:t.seconds,milliseconds:t.milliseconds}).as("milliseconds"),a=ore(n);let[l,c]=fCe(a,r,e.zone);return o!==0&&(l+=o,c=e.zone.offset(l)),{ts:l,o:c}}function aO(e,t,r,i,s,n){const{setZone:o,zone:a}=r;if(e&&Object.keys(e).length!==0){const l=t||a,c=nr.fromObject(e,{...r,zone:l,specificOffset:n});return o?c:c.setZone(a)}else return nr.invalid(new of("unparsable",`the input "${s}" can't be parsed as ${i}`))}function QD(e,t,r=!0){return e.isValid?Wc.create(qs.create("en-US"),{allowZ:r,forceSimple:!0}).formatDateTimeFromString(e,t):null}function RG(e,t){const r=e.c.year>9999||e.c.year<0;let i="";return r&&e.c.year>=0&&(i+="+"),i+=Kn(e.c.year,r?6:4),t?(i+="-",i+=Kn(e.c.month),i+="-",i+=Kn(e.c.day)):(i+=Kn(e.c.month),i+=Kn(e.c.day)),i}function lue(e,t,r,i,s,n){let o=Kn(e.c.hour);return t?(o+=":",o+=Kn(e.c.minute),(e.c.second!==0||!r)&&(o+=":")):o+=Kn(e.c.minute),(e.c.second!==0||!r)&&(o+=Kn(e.c.second),(e.c.millisecond!==0||!i)&&(o+=".",o+=Kn(e.c.millisecond,3))),s&&(e.isOffsetFixed&&e.offset===0&&!n?o+="Z":e.o<0?(o+="-",o+=Kn(Math.trunc(-e.o/60)),o+=":",o+=Kn(Math.trunc(-e.o%60))):(o+="+",o+=Kn(Math.trunc(e.o/60)),o+=":",o+=Kn(Math.trunc(e.o%60)))),n&&(o+="["+e.zone.ianaName+"]"),o}const mCe={month:1,day:1,hour:0,minute:0,second:0,millisecond:0},WQe={weekNumber:1,weekday:1,hour:0,minute:0,second:0,millisecond:0},XQe={ordinal:1,hour:0,minute:0,second:0,millisecond:0},gCe=["year","month","day","hour","minute","second","millisecond"],ZQe=["weekYear","weekNumber","weekday","hour","minute","second","millisecond"],YQe=["year","ordinal","hour","minute","second","millisecond"];function cue(e){const t={year:"year",years:"year",month:"month",months:"month",day:"day",days:"day",hour:"hour",hours:"hour",minute:"minute",minutes:"minute",quarter:"quarter",quarters:"quarter",second:"second",seconds:"second",millisecond:"millisecond",milliseconds:"millisecond",weekday:"weekday",weekdays:"weekday",weeknumber:"weekNumber",weeksnumber:"weekNumber",weeknumbers:"weekNumber",weekyear:"weekYear",weekyears:"weekYear",ordinal:"ordinal"}[e.toLowerCase()];if(!t)throw new bEe(e);return t}function uue(e,t){const r=S_(t.zone,xo.defaultZone),i=qs.fromObject(t),s=xo.now();let n,o;if(Jr(e.year))n=s;else{for(const c of gCe)Jr(e[c])&&(e[c]=mCe[c]);const a=dCe(e)||pCe(e);if(a)return nr.invalid(a);const l=r.offset(s);[n,o]=g5(e,l,r)}return new nr({ts:n,zone:r,loc:i,o})}function hue(e,t,r){const i=Jr(r.round)?!0:r.round,s=(o,a)=>(o=nre(o,i||r.calendary?0:2,!0),t.loc.clone(r).relFormatter(r).format(o,a)),n=o=>r.calendary?t.hasSame(e,o)?0:t.startOf(o).diff(e.startOf(o),o).get(o):t.diff(e,o).get(o);if(r.unit)return s(n(r.unit),r.unit);for(const o of r.units){const a=n(o);if(Math.abs(a)>=1)return s(a,o)}return s(e>t?-0:0,r.units[r.units.length-1])}function due(e){let t={},r;return e.length>0&&typeof e[e.length-1]=="object"?(t=e[e.length-1],r=Array.from(e).slice(0,e.length-1)):r=Array.from(e),[t,r]}class nr{constructor(t){const r=t.zone||xo.defaultZone;let i=t.invalid||(Number.isNaN(t.ts)?new of("invalid input"):null)||(r.isValid?null:YD(r));this.ts=Jr(t.ts)?xo.now():t.ts;let s=null,n=null;if(!i)if(t.old&&t.old.ts===this.ts&&t.old.zone.equals(r))[s,n]=[t.old.c,t.old.o];else{const a=r.offset(this.ts);s=oue(this.ts,a),i=Number.isNaN(s.year)?new of("invalid input"):null,s=i?null:s,n=i?null:a}this._zone=r,this.loc=t.loc||qs.create(),this.invalid=i,this.weekData=null,this.c=s,this.o=n,this.isLuxonDateTime=!0}static now(){return new nr({})}static local(){const[t,r]=due(arguments),[i,s,n,o,a,l,c]=r;return uue({year:i,month:s,day:n,hour:o,minute:a,second:l,millisecond:c},t)}static utc(){const[t,r]=due(arguments),[i,s,n,o,a,l,c]=r;return t.zone=Zl.utcInstance,uue({year:i,month:s,day:n,hour:o,minute:a,second:l,millisecond:c},t)}static fromJSDate(t,r={}){const i=sYe(t)?t.valueOf():NaN;if(Number.isNaN(i))return nr.invalid("invalid input");const s=S_(r.zone,xo.defaultZone);return s.isValid?new nr({ts:i,zone:s,loc:qs.fromObject(r)}):nr.invalid(YD(s))}static fromMillis(t,r={}){if(Hx(t))return t<-nue||t>nue?nr.invalid("Timestamp out of range"):new nr({ts:t,zone:S_(r.zone,xo.defaultZone),loc:qs.fromObject(r)});throw new vd(`fromMillis requires a numerical input, but received a ${typeof t} with value ${t}`)}static fromSeconds(t,r={}){if(Hx(t))return new nr({ts:t*1e3,zone:S_(r.zone,xo.defaultZone),loc:qs.fromObject(r)});throw new vd("fromSeconds requires a numerical input")}static fromObject(t,r={}){t=t||{};const i=S_(r.zone,xo.defaultZone);if(!i.isValid)return nr.invalid(YD(i));const s=xo.now(),n=Jr(r.specificOffset)?i.offset(s):r.specificOffset,o=hV(t,cue),a=!Jr(o.ordinal),l=!Jr(o.year),c=!Jr(o.month)||!Jr(o.day),h=l||c,p=o.weekYear||o.weekNumber,f=qs.fromObject(r);if((h||a)&&p)throw new jM("Can't mix weekYear/weekNumber units with year/month/day or ordinals");if(c&&a)throw new jM("Can't mix ordinal dates with month/day");const m=p||o.weekday&&!h;let g,v,w=oue(s,n);m?(g=ZQe,v=WQe,w=$Z(w)):a?(g=YQe,v=XQe,w=EG(w)):(g=gCe,v=mCe);let _=!1;for(const I of g){const L=o[I];Jr(L)?_?o[I]=v[I]:o[I]=w[I]:_=!0}const T=m?HQe(o):a?qQe(o):dCe(o),x=T||pCe(o);if(x)return nr.invalid(x);const E=m?iue(o):a?sue(o):o,[C,A]=g5(E,n,i),P=new nr({ts:C,zone:i,o:A,loc:f});return o.weekday&&h&&t.weekday!==P.weekday?nr.invalid("mismatched weekday",`you can't specify both a weekday of ${o.weekday} and a date of ${P.toISO()}`):P}static fromISO(t,r={}){const[i,s]=uQe(t);return aO(i,s,r,"ISO 8601",t)}static fromRFC2822(t,r={}){const[i,s]=hQe(t);return aO(i,s,r,"RFC 2822",t)}static fromHTTP(t,r={}){const[i,s]=dQe(t);return aO(i,s,r,"HTTP",r)}static fromFormat(t,r,i={}){if(Jr(t)||Jr(r))throw new vd("fromFormat requires an input string and a format");const{locale:s=null,numberingSystem:n=null}=i,o=qs.fromOpts({locale:s,numberingSystem:n,defaultToEN:!0}),[a,l,c,h]=jQe(o,t,r);return h?nr.invalid(h):aO(a,l,i,`format ${r}`,t,c)}static fromString(t,r,i={}){return nr.fromFormat(t,r,i)}static fromSQL(t,r={}){const[i,s]=_Qe(t);return aO(i,s,r,"SQL",t)}static invalid(t,r=null){if(!t)throw new vd("need to specify a reason the DateTime is invalid");const i=t instanceof of?t:new of(t,r);if(xo.throwOnInvalid)throw new JZe(i);return new nr({invalid:i})}static isDateTime(t){return t&&t.isLuxonDateTime||!1}get(t){return this[t]}get isValid(){return this.invalid===null}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}get locale(){return this.isValid?this.loc.locale:null}get numberingSystem(){return this.isValid?this.loc.numberingSystem:null}get outputCalendar(){return this.isValid?this.loc.outputCalendar:null}get zone(){return this._zone}get zoneName(){return this.isValid?this.zone.name:null}get year(){return this.isValid?this.c.year:NaN}get quarter(){return this.isValid?Math.ceil(this.c.month/3):NaN}get month(){return this.isValid?this.c.month:NaN}get day(){return this.isValid?this.c.day:NaN}get hour(){return this.isValid?this.c.hour:NaN}get minute(){return this.isValid?this.c.minute:NaN}get second(){return this.isValid?this.c.second:NaN}get millisecond(){return this.isValid?this.c.millisecond:NaN}get weekYear(){return this.isValid?AG(this).weekYear:NaN}get weekNumber(){return this.isValid?AG(this).weekNumber:NaN}get weekday(){return this.isValid?AG(this).weekday:NaN}get ordinal(){return this.isValid?EG(this.c).ordinal:NaN}get monthShort(){return this.isValid?ZD.months("short",{locObj:this.loc})[this.month-1]:null}get monthLong(){return this.isValid?ZD.months("long",{locObj:this.loc})[this.month-1]:null}get weekdayShort(){return this.isValid?ZD.weekdays("short",{locObj:this.loc})[this.weekday-1]:null}get weekdayLong(){return this.isValid?ZD.weekdays("long",{locObj:this.loc})[this.weekday-1]:null}get offset(){return this.isValid?+this.o:NaN}get offsetNameShort(){return this.isValid?this.zone.offsetName(this.ts,{format:"short",locale:this.locale}):null}get offsetNameLong(){return this.isValid?this.zone.offsetName(this.ts,{format:"long",locale:this.locale}):null}get isOffsetFixed(){return this.isValid?this.zone.isUniversal:null}get isInDST(){return this.isOffsetFixed?!1:this.offset>this.set({month:1,day:1}).offset||this.offset>this.set({month:5}).offset}get isInLeapYear(){return sL(this.year)}get daysInMonth(){return cV(this.year,this.month)}get daysInYear(){return this.isValid?iP(this.year):NaN}get weeksInWeekYear(){return this.isValid?uV(this.weekYear):NaN}resolvedLocaleOptions(t={}){const{locale:r,numberingSystem:i,calendar:s}=Wc.create(this.loc.clone(t),t).resolvedOptions(this);return{locale:r,numberingSystem:i,outputCalendar:s}}toUTC(t=0,r={}){return this.setZone(Zl.instance(t),r)}toLocal(){return this.setZone(xo.defaultZone)}setZone(t,{keepLocalTime:r=!1,keepCalendarTime:i=!1}={}){if(t=S_(t,xo.defaultZone),t.equals(this.zone))return this;if(t.isValid){let s=this.ts;if(r||i){const n=t.offset(this.ts),o=this.toObject();[s]=g5(o,n,t)}return oO(this,{ts:s,zone:t})}else return nr.invalid(YD(t))}reconfigure({locale:t,numberingSystem:r,outputCalendar:i}={}){const s=this.loc.clone({locale:t,numberingSystem:r,outputCalendar:i});return oO(this,{loc:s})}setLocale(t){return this.reconfigure({locale:t})}set(t){if(!this.isValid)return this;const r=hV(t,cue),i=!Jr(r.weekYear)||!Jr(r.weekNumber)||!Jr(r.weekday),s=!Jr(r.ordinal),n=!Jr(r.year),o=!Jr(r.month)||!Jr(r.day),a=n||o,l=r.weekYear||r.weekNumber;if((a||s)&&l)throw new jM("Can't mix weekYear/weekNumber units with year/month/day or ordinals");if(o&&s)throw new jM("Can't mix ordinal dates with month/day");let c;i?c=iue({...$Z(this.c),...r}):Jr(r.ordinal)?(c={...this.toObject(),...r},Jr(r.day)&&(c.day=Math.min(cV(c.year,c.month),c.day))):c=sue({...EG(this.c),...r});const[h,p]=g5(c,this.o,this.zone);return oO(this,{ts:h,o:p})}plus(t){if(!this.isValid)return this;const r=li.fromDurationLike(t);return oO(this,aue(this,r))}minus(t){if(!this.isValid)return this;const r=li.fromDurationLike(t).negate();return oO(this,aue(this,r))}startOf(t){if(!this.isValid)return this;const r={},i=li.normalizeUnit(t);switch(i){case"years":r.month=1;case"quarters":case"months":r.day=1;case"weeks":case"days":r.hour=0;case"hours":r.minute=0;case"minutes":r.second=0;case"seconds":r.millisecond=0;break}if(i==="weeks"&&(r.weekday=1),i==="quarters"){const s=Math.ceil(this.month/3);r.month=(s-1)*3+1}return this.set(r)}endOf(t){return this.isValid?this.plus({[t]:1}).startOf(t).minus(1):this}toFormat(t,r={}){return this.isValid?Wc.create(this.loc.redefaultToEN(r)).formatDateTimeFromString(this,t):CG}toLocaleString(t=AZ,r={}){return this.isValid?Wc.create(this.loc.clone(r),t).formatDateTime(this):CG}toLocaleParts(t={}){return this.isValid?Wc.create(this.loc.clone(t),t).formatDateTimeParts(this):[]}toISO({format:t="extended",suppressSeconds:r=!1,suppressMilliseconds:i=!1,includeOffset:s=!0,extendedZone:n=!1}={}){if(!this.isValid)return null;const o=t==="extended";let a=RG(this,o);return a+="T",a+=lue(this,o,r,i,s,n),a}toISODate({format:t="extended"}={}){return this.isValid?RG(this,t==="extended"):null}toISOWeekDate(){return QD(this,"kkkk-'W'WW-c")}toISOTime({suppressMilliseconds:t=!1,suppressSeconds:r=!1,includeOffset:i=!0,includePrefix:s=!1,extendedZone:n=!1,format:o="extended"}={}){return this.isValid?(s?"T":"")+lue(this,o==="extended",r,t,i,n):null}toRFC2822(){return QD(this,"EEE, dd LLL yyyy HH:mm:ss ZZZ",!1)}toHTTP(){return QD(this.toUTC(),"EEE, dd LLL yyyy HH:mm:ss 'GMT'")}toSQLDate(){return this.isValid?RG(this,!0):null}toSQLTime({includeOffset:t=!0,includeZone:r=!1,includeOffsetSpace:i=!0}={}){let s="HH:mm:ss.SSS";return(r||t)&&(i&&(s+=" "),r?s+="z":t&&(s+="ZZ")),QD(this,s,!0)}toSQL(t={}){return this.isValid?`${this.toSQLDate()} ${this.toSQLTime(t)}`:null}toString(){return this.isValid?this.toISO():CG}valueOf(){return this.toMillis()}toMillis(){return this.isValid?this.ts:NaN}toSeconds(){return this.isValid?this.ts/1e3:NaN}toUnixInteger(){return this.isValid?Math.floor(this.ts/1e3):NaN}toJSON(){return this.toISO()}toBSON(){return this.toJSDate()}toObject(t={}){if(!this.isValid)return{};const r={...this.c};return t.includeConfig&&(r.outputCalendar=this.outputCalendar,r.numberingSystem=this.loc.numberingSystem,r.locale=this.loc.locale),r}toJSDate(){return new Date(this.isValid?this.ts:NaN)}diff(t,r="milliseconds",i={}){if(!this.isValid||!t.isValid)return li.invalid("created by diffing an invalid DateTime");const s={locale:this.locale,numberingSystem:this.numberingSystem,...i},n=nYe(r).map(li.normalizeUnit),o=t.valueOf()>this.valueOf(),a=o?this:t,l=o?t:this,c=RQe(a,l,n,s);return o?c.negate():c}diffNow(t="milliseconds",r={}){return this.diff(nr.now(),t,r)}until(t){return this.isValid?cn.fromDateTimes(this,t):this}hasSame(t,r){if(!this.isValid)return!1;const i=t.valueOf(),s=this.setZone(t.zone,{keepLocalTime:!0});return s.startOf(r)<=i&&i<=s.endOf(r)}equals(t){return this.isValid&&t.isValid&&this.valueOf()===t.valueOf()&&this.zone.equals(t.zone)&&this.loc.equals(t.loc)}toRelative(t={}){if(!this.isValid)return null;const r=t.base||nr.fromObject({},{zone:this.zone}),i=t.padding?this<r?-t.padding:t.padding:0;let s=["years","months","days","hours","minutes","seconds"],n=t.unit;return Array.isArray(t.unit)&&(s=t.unit,n=void 0),hue(r,this.plus(i),{...t,numeric:"always",units:s,unit:n})}toRelativeCalendar(t={}){return this.isValid?hue(t.base||nr.fromObject({},{zone:this.zone}),this,{...t,numeric:"auto",units:["years","months","days"],calendary:!0}):null}static min(...t){if(!t.every(nr.isDateTime))throw new vd("min requires all arguments be DateTimes");return Gce(t,r=>r.valueOf(),Math.min)}static max(...t){if(!t.every(nr.isDateTime))throw new vd("max requires all arguments be DateTimes");return Gce(t,r=>r.valueOf(),Math.max)}static fromFormatExplain(t,r,i={}){const{locale:s=null,numberingSystem:n=null}=i,o=qs.fromOpts({locale:s,numberingSystem:n,defaultToEN:!0});return oCe(o,t,r)}static fromStringExplain(t,r,i={}){return nr.fromFormatExplain(t,r,i)}static get DATE_SHORT(){return AZ}static get DATE_MED(){return wEe}static get DATE_MED_WITH_WEEKDAY(){return tYe}static get DATE_FULL(){return xEe}static get DATE_HUGE(){return TEe}static get TIME_SIMPLE(){return SEe}static get TIME_WITH_SECONDS(){return EEe}static get TIME_WITH_SHORT_OFFSET(){return CEe}static get TIME_WITH_LONG_OFFSET(){return AEe}static get TIME_24_SIMPLE(){return REe}static get TIME_24_WITH_SECONDS(){return OEe}static get TIME_24_WITH_SHORT_OFFSET(){return MEe}static get TIME_24_WITH_LONG_OFFSET(){return PEe}static get DATETIME_SHORT(){return IEe}static get DATETIME_SHORT_WITH_SECONDS(){return $Ee}static get DATETIME_MED(){return LEe}static get DATETIME_MED_WITH_SECONDS(){return DEe}static get DATETIME_MED_WITH_WEEKDAY(){return rYe}static get DATETIME_FULL(){return NEe}static get DATETIME_FULL_WITH_SECONDS(){return FEe}static get DATETIME_HUGE(){return kEe}static get DATETIME_HUGE_WITH_SECONDS(){return UEe}}function lO(e){if(nr.isDateTime(e))return e;if(e&&e.valueOf&&Hx(e.valueOf()))return nr.fromJSDate(e);if(e&&typeof e=="object")return nr.fromObject(e);throw new vd(`Unknown datetime argument: ${e}, of type ${typeof e}`)}const OG={ar:[".",","],bg:[",","\xA0"],bs:[",","."],ca:[",","."],cs:[",","\xA0"],da:[",","."],de:[",","."],"de-ch":[".","\u2019"],el:[",","."],en:[".",","],"en-au":[".",","],es:[",","."],"es-mx":[".",","],et:[",","\xA0"],fi:[",","\xA0"],fr:[",","\u202F"],"fr-ch":[",","\u202F"],he:[".",","],hi:[".",",","#,##,##0.###"],hr:[",","."],hu:[",","\xA0"],id:[",","."],it:[",","."],"it-ch":[".","\u2019"],ja:[".",","],ko:[".",","],lt:[",","\xA0"],lv:[",","\xA0"],mk:[",","."],nb:[",","\xA0"],nl:[",","."],pl:[",","\xA0"],pt:[",","."],"pt-pt":[",","\xA0"],ro:[",","."],ru:[",","\xA0"],sk:[",","\xA0"],sl:[",","."],sr:[",","."],sv:[",","\xA0"],th:[".",","],tr:[",","."],uk:[",","\xA0"],vi:[",","."],zh:[".",","]};function yCe(e){e||(e=lh());let t=e in OG;if(!t){const n=e.split("-");n.length>1&&n[0]in OG&&(e=n[0],t=!0),t||(e="en")}const[r,i,s="#,##0.###"]=OG[e];return{decimal:r,group:i,pattern:s}}function QQe(e,t){const r=yCe((t={...t}).locale);t.customs=r;const i=t.pattern||r.pattern;return isNaN(e)||Math.abs(e)===1/0?null:JQe(e,i,t)}const vCe=/[#0,]*[#0](?:\.0*#*)?/;function JQe(e,t,r){const i=(r=r||{}).customs.group,s=r.customs.decimal,n=t.split(";"),o=n[0];if((t=n[e<0?1:0]||"-"+o).includes("%"))e*=100;else if(t.includes("\u2030"))e*=1e3;else{if(t.includes("\xA4"))throw new Error("currency notation not supported");if(t.includes("E"))throw new Error("exponential notation not supported")}const a=vCe,l=o.match(a);if(!l)throw new Error("unable to find a number expression in pattern: "+t);return r.fractional===!1&&(r.places=0),t.replace(a,KQe(e,l[0],{decimal:s,group:i,places:r.places,round:r.round}))}function KQe(e,t,r){(r=r||{}).places===!0&&(r.places=0),r.places===1/0&&(r.places=6);const i=t.split("."),s=typeof r.places=="string"&&r.places.indexOf(",");let n=r.places;s?n=r.places.substring(s+1):n>=0||(n=(i[1]||[]).length),r.round<0||(e=Number(e.toFixed(Number(n))));const o=String(Math.abs(e)).split("."),a=o[1]||"";if(i[1]||r.places){s&&(r.places=r.places.substring(0,s));const g=r.places!==void 0?r.places:i[1]&&i[1].lastIndexOf("0")+1;g>a.length&&(o[1]=a.padEnd(Number(g),"0")),n<a.length&&(o[1]=a.substr(0,Number(n)))}else o[1]&&o.pop();const l=i[0].replace(",","");let c=l.indexOf("0");c!==-1&&(c=l.length-c,c>o[0].length&&(o[0]=o[0].padStart(c,"0")),l.includes("#")||(o[0]=o[0].substr(o[0].length-c)));let h,p,f=i[0].lastIndexOf(",");if(f!==-1){h=i[0].length-f-1;const g=i[0].substr(0,f);f=g.lastIndexOf(","),f!==-1&&(p=g.length-f-1)}const m=[];for(let g=o[0];g;){const v=g.length-h;m.push(v>0?g.substr(v):g),g=v>0?g.slice(0,v):"",p&&(h=p,p=void 0)}return o[0]=m.reverse().join(r.group||","),o.join(r.decimal||".")}function eJe(e){const t=yCe((e=e||{}).locale),r=e.pattern||t.pattern,i=t.group,s=t.decimal;let n=1;if(r.includes("%"))n/=100;else if(r.includes("\u2030"))n/=1e3;else if(r.includes("\xA4"))throw new Error("currency notation not supported");const o=r.split(";");return o.length===1&&o.push("-"+o[0]),{regexp:TI(o,l=>(l="(?:"+h1e(l,".")+")").replace(vCe,c=>{const h={signed:!1,separator:e.strict?i:[i,""],fractional:e.fractional,decimal:s,exponent:!1},p=c.split(".");let f=e.places;p.length===1&&n!==1&&(p[1]="###"),p.length===1||f===0?h.fractional=!1:(f===void 0&&(f=e.pattern?p[1].lastIndexOf("0")+1:1/0),f&&e.fractional==null&&(h.fractional=!0),!e.places&&f<p[1].length&&(f+=","+p[1].length),h.places=f);const m=p[0].split(",");return m.length>1&&(h.groupSize=m.pop().length,m.length>1&&(h.groupSize2=m.pop().length)),"("+rJe(h)+")"}),!0).replace(/[\xa0 ]/g,"[\\s\\xa0]"),group:i,decimal:s,factor:n}}function tJe(e,t){const r=eJe(t),i=new RegExp("^"+r.regexp+"$").exec(e);if(!i)return NaN;let s=i[1];if(!i[1]){if(!i[2])return NaN;s=i[2],r.factor*=-1}return s=s.replace(new RegExp("["+r.group+"\\s\\xa0]","g"),"").replace(r.decimal,"."),Number(s)*r.factor}function rJe(e){"places"in(e=e||{})||(e.places=1/0),typeof e.decimal!="string"&&(e.decimal="."),"fractional"in e&&!/^0/.test(String(e.places))||(e.fractional=[!0,!1]),"exponent"in e||(e.exponent=[!0,!1]),"eSigned"in e||(e.eSigned=[!0,!1]);const t=pue(e),r=TI(e.fractional,s=>{let n="";return s&&e.places!==0&&(n="\\"+e.decimal,e.places===1/0?n="(?:"+n+"\\d+)?":n+="\\d{"+e.places+"}"),n},!0);let i=t+r;return r&&(i="(?:(?:"+i+")|(?:"+r+"))"),i+TI(e.exponent,s=>s?"([eE]"+pue({signed:e.eSigned})+")":"")}function pue(e){return"signed"in(e=e||{})||(e.signed=[!0,!1]),"separator"in e?"groupSize"in e||(e.groupSize=3):e.separator="",TI(e.signed,t=>t?"[-+]":"",!0)+TI(e.separator,t=>{if(!t)return"(?:\\d+)";(t=h1e(t))===" "?t="\\s":t==="\xA0"&&(t="\\s\\xa0");const r=e.groupSize,i=e.groupSize2;if(i){const s="(?:0|[1-9]\\d{0,"+(i-1)+"}(?:["+t+"]\\d{"+i+"})*["+t+"]\\d{"+r+"})";return r-i>0?"(?:"+s+"|(?:0|[1-9]\\d{0,"+(r-1)+"}))":s}return"(?:0|[1-9]\\d{0,"+(r-1)+"}(?:["+t+"]\\d{"+r+"})*)"},!0)}const TI=(e,t,r)=>{if(!(e instanceof Array))return t(e);const i=[];for(let s=0;s<e.length;s++)i.push(t(e[s]));return iJe(i.join("|"),r)},iJe=(e,t)=>"("+(t?"?:":"")+e+")";var fue,mue;function aLt(e){return gR.fromJSON(e.toJSON())}function sJe(e){return e.toJSON?e.toJSON():e}function lLt(e){return typeof e=="string"||e instanceof String}function cLt(e){return typeof e=="number"}function gue(e){return e instanceof Date}function uLt(e,t){return e===t||!(!gue(e)||!gue(t))&&e.getTime()===t.getTime()}function hLt(e){if(e===void 0)return null;if(typeof e=="number")return e;switch(e.toLowerCase()){case"meters":case"meter":return 109404;case"miles":case"mile":return 109413;case"kilometers":case"kilometer":case"km":return 109414}return null}function dLt(e){if(e===null)return null;switch(e.type){case"polygon":case"multipoint":case"polyline":return e.extent;case"point":return new Kt({xmin:e.x,ymin:e.y,xmax:e.x,ymax:e.y,spatialReference:e.spatialReference});case"extent":return e}return null}function pLt(e){if(e===void 0)return null;if(typeof e=="number"||typeof e=="number")return e;switch(e.toLowerCase()){case"meters":case"meter":return 9001;case"miles":case"mile":return 9035;case"kilometers":case"kilometer":case"km":return 9036}return null}(function(e){e[e.Standardised=0]="Standardised",e[e.StandardisedNoInterval=1]="StandardisedNoInterval",e[e.SqlServer=2]="SqlServer",e[e.Oracle=3]="Oracle",e[e.Postgres=4]="Postgres",e[e.PGDB=5]="PGDB",e[e.FILEGDB=6]="FILEGDB",e[e.NotEvaluated=7]="NotEvaluated"})(fue||(fue={})),function(e){e[e.InFeatureSet=0]="InFeatureSet",e[e.NotInFeatureSet=1]="NotInFeatureSet",e[e.Unknown=2]="Unknown"}(mue||(mue={}));const fLt=1e3,mLt={point:"point",polygon:"polygon",polyline:"polyline",multipoint:"multipoint",extent:"extent",esriGeometryPoint:"point",esriGeometryPolygon:"polygon",esriGeometryPolyline:"polyline",esriGeometryMultipoint:"multipoint",esriGeometryEnvelope:"extent",envelope:"extent"},yue={point:"esriGeometryPoint",polygon:"esriGeometryPolygon",polyline:"esriGeometryPolyline",multipoint:"esriGeometryMultipoint",extent:"esriGeometryEnvelope",esriGeometryPoint:"esriGeometryPoint",esriGeometryPolygon:"esriGeometryPolygon",esriGeometryPolyline:"esriGeometryPolyline",esriGeometryMultipoint:"esriGeometryMultipoint",esriGeometryEnvelope:"esriGeometryEnvelope",envelope:"esriGeometryEnvelope"},gLt={"small-integer":"esriFieldTypeSmallInteger",integer:"esriFieldTypeInteger",long:"esriFieldTypeLong",single:"esriFieldTypeSingle",double:"esriFieldTypeDouble",string:"esriFieldTypeString",date:"esriFieldTypeDate",oid:"esriFieldTypeOID",geometry:"esriFieldTypeGeometry",blob:"esriFieldTypeBlob",raster:"esriFieldTypeRaster",guid:"esriFieldTypeGUID","global-id":"esriFieldTypeGlobalID",xml:"eesriFieldTypeXML",esriFieldTypeSmallInteger:"esriFieldTypeSmallInteger",esriFieldTypeInteger:"esriFieldTypeInteger",esriFieldTypeLong:"esriFieldTypeLong",esriFieldTypeSingle:"esriFieldTypeSingle",esriFieldTypeDouble:"esriFieldTypeDouble",esriFieldTypeString:"esriFieldTypeString",esriFieldTypeDate:"esriFieldTypeDate",esriFieldTypeOID:"esriFieldTypeOID",esriFieldTypeGeometry:"esriFieldTypeGeometry",esriFieldTypeBlob:"esriFieldTypeBlob",esriFieldTypeRaster:"esriFieldTypeRaster",esriFieldTypeGUID:"esriFieldTypeGUID",esriFieldTypeGlobalID:"esriFieldTypeGlobalID",esriFieldTypeXML:"eesriFieldTypeXML"};function yLt(e){return e===void 0?"":e=(e=(e=e.replace(/\/featureserver\/[0-9]*/i,"/FeatureServer")).replace(/\/mapserver\/[0-9]*/i,"/MapServer")).split("?")[0]}function vLt(e,t){t||(t={}),typeof t=="function"&&(t={cmp:t});const r=typeof t.cycles=="boolean"&&t.cycles,i=t.cmp&&(s=t.cmp,function(o){return function(a,l){const c={key:a,value:o[a]},h={key:l,value:o[l]};return s(c,h)}});var s;const n=[];return function o(a){if(a&&a.toJSON&&typeof a.toJSON=="function"&&(a=a.toJSON()),a===void 0)return;if(typeof a=="number")return isFinite(a)?""+a:"null";if(typeof a!="object")return JSON.stringify(a);let l,c;if(Array.isArray(a)){for(c="[",l=0;l<a.length;l++)l&&(c+=","),c+=o(a[l])||"null";return c+"]"}if(a===null)return"null";if(n.includes(a)){if(r)return JSON.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}const h=n.push(a)-1,p=Object.keys(a).sort(i&&i(a));for(c="",l=0;l<p.length;l++){const f=p[l],m=o(a[f]);m&&(c&&(c+=","),c+=JSON.stringify(f)+":"+m)}return n.splice(h,1),"{"+c+"}"}(e)}class _Ce{constructor(t){this.value=t}}class bCe{constructor(t){this.value=t}}class dre{constructor(t){this.fn=t}}class pre{constructor(t,r){this.paramCount=r,this.fn=t}}const nJe=dre,oJe=bCe,aJe=_Ce,lJe=pre,qu={type:"VOID"},cJe={type:"BREAK"},uJe={type:"CONTINUE"};function SI(e,t,r){return t===""||t==null||t===r||t===r?e:e=e.split(t).join(r)}function fre(e){return e instanceof dre||e instanceof QZe||e instanceof pre}function dV(e){return!!wa(e)||!!jl(e)||!!nl(e)||!!Gl(e)||e===null||e===qu||typeof e=="number"}function hJe(e,t){return e===void 0?t:e}function wa(e){return typeof e=="string"||e instanceof String}function Gl(e){return typeof e=="boolean"}function jl(e){return typeof e=="number"}function dJe(e){return typeof e=="number"&&isFinite(e)&&Math.floor(e)===e}function Bd(e){return e instanceof Array}function pJe(e){return(e==null?void 0:e.arcadeDeclaredClass)==="esri.arcade.Feature"}function fJe(e){return(e&&e.declaredRootClass&&e.declaredRootClass==="esri.arcade.featureset.support.FeatureSet")===!0}function mJe(e){return(e&&e.declaredRootClass&&e.declaredRootClass==="esri.arcade.featureSetCollection")===!0}function gT(e){return e instanceof _g}function nl(e){return e instanceof Date}function gJe(e,t,r){if(e.length<t||e.length>r)throw new Error("Function called with wrong number of Parameters")}function yJe(e){return e<0?-Math.round(-e):Math.round(e)}function vJe(){let e=Date.now();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){const r=(e+16*Math.random())%16|0;return e=Math.floor(e/16),(t==="x"?r:3&r|8).toString(16)})}function mre(e,t){return isNaN(e)===!1?t==null||t===""?e.toString():(t=SI(t,"\u2030",""),t=SI(t,"\xA4",""),QQe(e,{pattern:t})):e.toString()}function J6(e,t){const r=nr.fromJSDate(e);return t==null||t===""?r.toISO({suppressMilliseconds:!0}):r.toFormat(wCe(t),{locale:lh(),numberingSystem:"latn"})}function wCe(e){e=e.replace(/LTS|LT|LL?L?L?|l{1,4}/g,"[$&]");let t="";const r=/(\[[^\[]*\])|(\\)?([Hh]mm(ss)?|Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|Qo?|N{1,5}|YYYYYY|YYYYY|YYYY|YY|y{2,4}|yo?|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|kk?|mm?|ss?|S{1,9}|x|X|zz?|ZZ?|.)/g;for(const i of e.match(r))switch(i){case"D":t+="d";break;case"DD":t+="dd";break;case"DDD":t+="o";break;case"d":t+="c";break;case"ddd":t+="ccc";break;case"dddd":t+="cccc";break;case"M":t+="L";break;case"MM":t+="LL";break;case"MMM":t+="LLL";break;case"MMMM":t+="LLLL";break;case"YY":t+="yy";break;case"Y":case"YYYY":t+="yyyy";break;case"Q":t+="q";break;case"Z":t+="ZZ";break;case"ZZ":t+="ZZZ";break;case"S":t+="'S'";break;case"SS":t+="'SS'";break;case"SSS":t+="u";break;case"A":case"a":t+="a";break;case"m":case"mm":case"h":case"hh":case"H":case"HH":case"s":case"ss":case"X":case"x":t+=i;break;default:i.length>=2&&i.slice(0,1)==="["&&i.slice(-1)==="]"?t+=`'${i.slice(1,-1)}'`:t+=`'${i}'`}return t}function Ci(e,t,r){switch(r){case">":return e>t;case"<":return e<t;case">=":return e>=t;case"<=":return e<=t}return!1}function _Je(e,t,r){if(e===null){if(t===null||t===qu)return Ci(null,null,r);if(jl(t))return Ci(0,t,r);if(wa(t)||Gl(t))return Ci(0,Gs(t),r);if(nl(t))return Ci(0,t.getTime(),r)}if(e===qu){if(t===null||t===qu)return Ci(null,null,r);if(jl(t))return Ci(0,t,r);if(wa(t)||Gl(t))return Ci(0,Gs(t),r);if(nl(t))return Ci(0,t.getTime(),r)}else if(jl(e)){if(jl(t))return Ci(e,t,r);if(Gl(t))return Ci(e,Gs(t),r);if(t===null||t===qu)return Ci(e,0,r);if(wa(t))return Ci(e,Gs(t),r);if(nl(t))return Ci(e,t.getTime(),r)}else if(wa(e)){if(wa(t))return Ci(h1(e),h1(t),r);if(nl(t))return Ci(Gs(e),t.getTime(),r);if(jl(t))return Ci(Gs(e),t,r);if(t===null||t===qu)return Ci(Gs(e),0,r);if(Gl(t))return Ci(Gs(e),Gs(t),r)}else if(nl(e)){if(nl(t))return Ci(e,t,r);if(t===null||t===qu)return Ci(e.getTime(),0,r);if(jl(t))return Ci(e.getTime(),t,r);if(Gl(t)||wa(t))return Ci(e.getTime(),Gs(t),r)}else if(Gl(e)){if(Gl(t))return Ci(e,t,r);if(jl(t))return Ci(Gs(e),Gs(t),r);if(nl(t))return Ci(Gs(e),t.getTime(),r);if(t===null||t===qu)return Ci(Gs(e),0,r);if(wa(t))return Ci(Gs(e),Gs(t),r)}return!!xCe(e,t)&&(r==="<="||r===">=")}function xCe(e,t){if(e===t||e===null&&t===qu||t===null&&e===qu)return!0;if(nl(e)&&nl(t))return e.getTime()===t.getTime();if(e instanceof ire||e instanceof tS)return e.equalityTest(t);if(e instanceof at&&t instanceof at){const r=e.cache._arcadeCacheId,i=t.cache._arcadeCacheId;if(r!=null)return r===i}return e!==void 0&&t!==void 0&&e!==null&&t!==null&&typeof e=="object"&&typeof t=="object"&&(e._arcadeCacheId===t._arcadeCacheId&&e._arcadeCacheId!==void 0&&e._arcadeCacheId!==null||e._underlyingGraphic===t._underlyingGraphic&&e._underlyingGraphic!==void 0&&e._underlyingGraphic!==null)}function h1(e,t){if(wa(e))return e;if(e===null)return"";if(jl(e))return mre(e,t);if(Gl(e))return e.toString();if(nl(e))return J6(e,t);if(e instanceof iu)return JSON.stringify(e.toJSON());if(Bd(e)){const r=[];for(let i=0;i<e.length;i++)r[i]=pV(e[i]);return"["+r.join(",")+"]"}if(e instanceof _g){const r=[];for(let i=0;i<e.length();i++)r[i]=pV(e.get(i));return"["+r.join(",")+"]"}return e!==null&&typeof e=="object"&&e.castToText!==void 0?e.castToText():fre(e)?"object, Function":""}function bJe(e){const t=[];if(Bd(e)===!1)return null;if(e instanceof _g){for(let r=0;r<e.length();r++)t[r]=Gs(e.get(r));return t}for(let r=0;r<e.length;r++)t[r]=Gs(e[r]);return t}function y5(e,t){if(wa(e))return e;if(e===null)return"";if(jl(e))return mre(e,t);if(Gl(e))return e.toString();if(nl(e))return J6(e,t);if(e instanceof iu)return e instanceof Kt?'{"xmin":'+e.xmin.toString()+',"ymin":'+e.ymin.toString()+","+(e.hasZ?'"zmin":'+e.zmin.toString()+",":"")+(e.hasM?'"mmin":'+e.mmin.toString()+",":"")+'"xmax":'+e.xmax.toString()+',"ymax":'+e.ymax.toString()+","+(e.hasZ?'"zmax":'+e.zmax.toString()+",":"")+(e.hasM?'"mmax":'+e.mmax.toString()+",":"")+'"spatialReference":'+LZ(e.spatialReference)+"}":LZ(e.toJSON(),(r,i)=>r.key===i.key?0:r.key==="spatialReference"?1:i.key==="spatialReference"||r.key<i.key?-1:r.key>i.key?1:0);if(Bd(e)){const r=[];for(let i=0;i<e.length;i++)r[i]=pV(e[i]);return"["+r.join(",")+"]"}if(e instanceof _g){const r=[];for(let i=0;i<e.length();i++)r[i]=pV(e.get(i));return"["+r.join(",")+"]"}return e!==null&&typeof e=="object"&&e.castToText!==void 0?e.castToText():fre(e)?"object, Function":""}function pV(e){if(e===null)return"null";if(Gl(e)||jl(e)||wa(e))return JSON.stringify(e);if(e instanceof iu||e instanceof _g||e instanceof Array)return y5(e);if(e instanceof Date)return JSON.stringify(J6(e,""));if(e!==null&&typeof e=="object"){if(e.castToText!==void 0)return e.castToText()}else if(e===qu)return"null";return"null"}function Gs(e,t){return jl(e)?e:e===null||e===""?0:nl(e)?NaN:Gl(e)?e?1:0:Bd(e)||e===""||e===void 0?NaN:t!==void 0&&wa(e)?(t=SI(t,"\u2030",""),t=SI(t,"\xA4",""),tJe(e,{pattern:t})):e===qu?0:Number(e)}function wJe(e){if(nl(e))return e;if(wa(e)){const t=TCe(e);if(t)return t.toJSDate()}return null}function xJe(e){return nl(e)?nr.fromJSDate(e):wa(e)?TCe(e):null}function TCe(e){const t=/ (\d\d)/;let r=nr.fromISO(e);return r.isValid||t.test(e)&&(e=e.replace(t,"T$1"),r=nr.fromISO(e),r.isValid)?r:null}function TJe(e){return Gl(e)?e:wa(e)?(e=e.toLowerCase())==="true":!!jl(e)&&e!==0&&!isNaN(e)}function SJe(e,t){return R(e)?null:(e.spatialReference!==null&&e.spatialReference!==void 0||(e.spatialReference=t),e)}function EJe(e){if(e===null)return null;if(e instanceof at)return e.x==="NaN"||e.x===null||isNaN(e.x)?null:e;if(e instanceof Oa){if(e.rings.length===0)return null;for(const t of e.rings)if(t.length>0)return e;return null}if(e instanceof sh){if(e.paths.length===0)return null;for(const t of e.paths)if(t.length>0)return e;return null}return e instanceof GT?e.points.length===0?null:e:e instanceof Kt?e.xmin==="NaN"||e.xmin===null||isNaN(e.xmin)?null:e:null}function SCe(e,t){if(!e||!e.domain)return t;let r=null;if(e.field.type==="string"||e.field.type==="esriFieldTypeString")t=h1(t);else{if(t==null)return null;if(t==="")return t;t=Gs(t)}for(let i=0;i<e.domain.codedValues.length;i++){const s=e.domain.codedValues[i];s.code===t&&(r=s)}return r===null?t:r.name}function ECe(e,t){if(!e||!e.domain)return t;let r=null;t=h1(t);for(let i=0;i<e.domain.codedValues.length;i++){const s=e.domain.codedValues[i];s.name===t&&(r=s)}return r===null?t:r.code}function K6(e,t,r=null,i=null){if(!t||!t.fields)return null;let s,n,o=null;for(let a=0;a<t.fields.length;a++){const l=t.fields[a];l.name.toLowerCase()===e.toString().toLowerCase()&&(o=l)}if(o===null)throw new Error("Field not found");return i===null&&r&&t.typeIdField&&(i=r.hasField(t.typeIdField)?r.field(t.typeIdField):null),i!=null&&t.types.some(function(a){return a.id===i&&(s=a.domains&&a.domains[o.name],s&&s.type==="inherited"&&(s=vue(o.name,t),n=!0),!0)}),n||s||(s=vue(e,t)),{field:o,domain:s}}function vue(e,t){let r;return t.fields.some(function(i){return i.name.toLowerCase()===e.toLowerCase()&&(r=i.domain),!!r}),r}function LZ(e,t){t||(t={}),typeof t=="function"&&(t={cmp:t});const r=typeof t.cycles=="boolean"&&t.cycles,i=t.cmp&&(s=t.cmp,function(o){return function(a,l){const c={key:a,value:o[a]},h={key:l,value:o[l]};return s(c,h)}});var s;const n=[];return function o(a){if(a&&a.toJSON&&typeof a.toJSON=="function"&&(a=a.toJSON()),a===void 0)return;if(typeof a=="number")return isFinite(a)?""+a:"null";if(typeof a!="object")return JSON.stringify(a);let l,c;if(Array.isArray(a)){for(c="[",l=0;l<a.length;l++)l&&(c+=","),c+=o(a[l])||"null";return c+"]"}if(a===null)return"null";if(n.includes(a)){if(r)return JSON.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}const h=n.push(a)-1,p=Object.keys(a).sort(i&&i(a));for(c="",l=0;l<p.length;l++){const f=p[l],m=o(a[f]);m&&(c&&(c+=","),c+=JSON.stringify(f)+":"+m)}return n.splice(h,1),"{"+c+"}"}(e)}function CJe(e){if(e===null)return null;const t=[];for(const r of e)r&&r.arcadeDeclaredClass&&r.arcadeDeclaredClass==="esri.arcade.Feature"?t.push(r.geometry()):t.push(r);return t}function yA(e,t){if(!(t instanceof at))throw new Error("Invalid Argument");e.push(t.hasZ?t.hasM?[t.x,t.y,t.z,t.m]:[t.x,t.y,t.z]:[t.x,t.y])}function AJe(e,t){if(Bd(e)||gT(e)){let r=!1,i=!1,s=[],n=t;if(Bd(e)){for(const o of e)yA(s,o);s.length>0&&(n=e[0].spatialReference,r=e[0].hasZ,i=e[0].hasM)}else if(e instanceof tS)s=e._elements,s.length>0&&(r=e._hasZ,i=e._hasM,n=e.get(0).spatialReference);else{if(!gT(e))throw new Error("Invalid Argument");for(const o of e.toArray())yA(s,o);s.length>0&&(n=e.get(0).spatialReference,r=e.get(0).hasZ===!0,i=e.get(0).hasM===!0)}return s.length===0?null:(xee(s,i,r)===!1&&(s=s.slice(0).reverse()),new Oa({rings:[s],spatialReference:n,hasZ:r,hasM:i}))}return e}function RJe(e,t){if(Bd(e)||gT(e)){let r=!1,i=!1,s=[],n=t;if(Bd(e)){for(const o of e)yA(s,o);s.length>0&&(n=e[0].spatialReference,r=e[0].hasZ===!0,i=e[0].hasM===!0)}else if(e instanceof tS)s=e._elements,s.length>0&&(r=e._hasZ,i=e._hasM,n=e.get(0).spatialReference);else if(gT(e)){for(const o of e.toArray())yA(s,o);s.length>0&&(n=e.get(0).spatialReference,r=e.get(0).hasZ===!0,i=e.get(0).hasM===!0)}return s.length===0?null:new sh({paths:[s],spatialReference:n,hasZ:r,hasM:i})}return e}function OJe(e,t){if(Bd(e)||gT(e)){let r=!1,i=!1,s=[],n=t;if(Bd(e)){for(const o of e)yA(s,o);s.length>0&&(n=e[0].spatialReference,r=e[0].hasZ===!0,i=e[0].hasM===!0)}else if(e instanceof tS)s=e._elements,s.length>0&&(r=e._hasZ,i=e._hasM,n=e.get(0).spatialReference);else if(gT(e)){for(const o of e.toArray())yA(s,o);s.length>0&&(n=e.get(0).spatialReference,r=e.get(0).hasZ===!0,i=e.get(0).hasM===!0)}return s.length===0?null:new GT({points:s,spatialReference:n,hasZ:r,hasM:i})}return e}function MJe(e,t=!1){const r=[];if(e===null)return r;if(Bd(e)===!0){for(let i=0;i<e.length;i++){const s=h1(e[i]);s===""&&t!==!0||r.push(s)}return r}if(e instanceof _g){for(let i=0;i<e.length();i++){const s=h1(e.get(i));s===""&&t!==!0||r.push(s)}return r}if(dV(e)){const i=h1(e);return i===""&&t!==!0||r.push(i),r}return[]}let MG=0;function PJe(e){return MG++,MG%100==0?(MG=0,new Promise(t=>{setTimeout(()=>{t(e)},0)})):e}function IJe(e,t,r){switch(r){case"&":return e&t;case"|":return e|t;case"^":return e^t;case"<<":return e<<t;case">>":return e>>t;case">>>":return e>>>t}}function EI(e,t=null){return e==null?null:Gl(e)||jl(e)||wa(e)?e:e instanceof iu?(t==null?void 0:t.keepGeometryType)===!0?e:e.toJSON():e instanceof _g?e.toArray().map(r=>EI(r,t)):e instanceof Array?e.map(r=>EI(r,t)):e instanceof Date?e:e!==null&&typeof e=="object"&&e.castAsJson!==void 0?e.castAsJson(t):null}async function $Je(e,t,r,i,s){const n=await gre(e,t,r);s[i]=n}async function gre(e,t=null,r=null){if(e instanceof _g&&(e=e.toArray()),e==null)return null;if(dV(e)||e instanceof iu||e instanceof Date)return EI(e,r);if(e instanceof Array){const i=[],s=[];for(const n of e)n===null||dV(n)||n instanceof iu||n instanceof Date?s.push(EI(n,r)):(s.push(null),i.push($Je(n,t,r,s.length-1,s)));return i.length>0&&await Promise.all(i),s}return e!==null&&typeof e=="object"&&e.castAsJsonAsync!==void 0?e.castAsJsonAsync(t,r):null}function LJe(e,t,r){const i=e.fullSchema();return i===null||!i.fields?null:K6(t,i,e,r)}function DJe(e){const t=e.fullSchema();return t===null?null:t.fields&&t.typeIdField?{subtypeField:t.typeIdField,subtypes:t.types?t.types.map(r=>({name:r.name,code:r.id})):[]}:null}function NJe(e,t,r,i){const s=e.fullSchema();if(s===null||!s.fields)return null;const n=K6(t,s,e,i);if(r===void 0)try{r=e.field(t)}catch{return null}return SCe(n,r)}function FJe(e,t,r,i){const s=e.fullSchema();if(s===null||!s.fields)return null;if(r===void 0){try{r=e.field(t)}catch{return null}return r}return ECe(K6(t,s,e,i),r)}function kJe(e){const t=e.fullSchema();if(t===null||!t.fields)return null;const r=[];for(const i of t.fields)r.push(sJe(i));return{objectIdField:t.objectIdField,globalIdField:t.globalIdField,geometryType:yue[t.geometryType]===void 0?"":yue[t.geometryType],fields:r}}const _Lt=Object.freeze(Object.defineProperty({__proto__:null,ReturnResultE:_Ce,ImplicitResultE:bCe,NativeFunctionE:dre,SizzleFunctionE:pre,NativeFunction:nJe,ImplicitResult:oJe,ReturnResult:aJe,SizzleFunction:lJe,voidOperation:qu,breakResult:cJe,continueResult:uJe,multiReplace:SI,isFunctionParameter:fre,isSimpleType:dV,defaultUndefined:hJe,isString:wa,isBoolean:Gl,isNumber:jl,isInteger:dJe,isArray:Bd,isFeature:pJe,isFeatureSet:fJe,isFeatureSetCollection:mJe,isImmutableArray:gT,isDate:nl,pcCheck:gJe,absRound:yJe,generateUUID:vJe,formatNumber:mre,formatDate:J6,standardiseDateFormat:wCe,greaterThanLessThan:_Je,equalityTest:xCe,toString:h1,toNumberArray:bJe,toStringExplicit:y5,toNumber:Gs,toDate:wJe,toDateTime:xJe,toBoolean:TJe,fixSpatialReference:SJe,fixNullGeometry:EJe,getDomainValue:SCe,getDomainCode:ECe,getDomain:K6,stableStringify:LZ,autoCastFeatureToGeometry:CJe,autoCastArrayOfPointsToPolygon:AJe,autoCastArrayOfPointsToPolyline:RJe,autoCastArrayOfPointsToMultiPoint:OJe,toStringArray:MJe,tick:PJe,binaryOperator:IJe,castAsJson:EI,castAsJsonAsync:gre,featureFullDomain:LJe,featureSubtypes:DJe,featureDomainValueLookup:NJe,featureDomainCodeLookup:FJe,featureSchema:kJe},Symbol.toStringTag,{value:"Module"}));var DZ;let qM=DZ=class extends ye{constructor(e){super(e),this.minValue=0,this.maxValue=0}clone(){return new DZ({minValue:this.minValue,maxValue:this.maxValue})}};u([d({type:Number,json:{write:!0}})],qM.prototype,"minValue",void 0),u([d({type:Number,json:{write:!0}})],qM.prototype,"maxValue",void 0),qM=DZ=u([$("esri.renderer.support.AuthoringInfoClassBreakInfo")],qM);var NZ;let p_=NZ=class extends ye{constructor(e){super(e),this.field="",this.normalizationField="",this.label="",this.classBreakInfos=[]}clone(){return new NZ({field:this.field,normalizationField:this.normalizationField,label:this.label,classBreakInfos:re(this.classBreakInfos)})}};u([d({type:String,json:{write:!0}})],p_.prototype,"field",void 0),u([d({type:String,json:{write:!0}})],p_.prototype,"normalizationField",void 0),u([d({type:String,json:{write:!0}})],p_.prototype,"label",void 0),u([d({type:[qM],json:{write:!0}})],p_.prototype,"classBreakInfos",void 0),p_=NZ=u([$("esri.renderers.support.AuthoringInfoFieldInfo")],p_);var FZ;const JD=new Tr({percentTotal:"percent-of-total",ratio:"ratio",percent:"percent"}),KD=new Tr({sizeInfo:"size",colorInfo:"color",transparencyInfo:"opacity",rotationInfo:"rotation"}),_ue={key:e=>typeof e=="number"?"number":"string",typeMap:{number:Number,string:String},base:null},bue=["high-to-low","above-and-below","centered-on","extremes"],wue=[...new Set(["high-to-low","above-and-below","centered-on","extremes","90-10","above","below","high-to-low","above-and-below","90-10","above","below"])],xue=["seconds","minutes","hours","days","months","years"];let Sc=FZ=class extends ye{constructor(e){super(e),this.endTime=null,this.field=null,this.maxSliderValue=null,this.minSliderValue=null,this.startTime=null,this.type=null,this.units=null}castEndTime(e){return typeof e=="string"||typeof e=="number"?e:null}castStartTime(e){return typeof e=="string"||typeof e=="number"?e:null}get style(){return this.type==="color"?this._get("style"):null}set style(e){this._set("style",e)}get theme(){return this.type==="color"||this.type==="size"?this._get("theme")||"high-to-low":null}set theme(e){this._set("theme",e)}clone(){return new FZ({endTime:this.endTime,field:this.field,maxSliderValue:this.maxSliderValue,minSliderValue:this.minSliderValue,startTime:this.startTime,style:this.style,theme:this.theme,type:this.type,units:this.units})}};u([d({types:_ue,json:{write:!0}})],Sc.prototype,"endTime",void 0),u([qt("endTime")],Sc.prototype,"castEndTime",null),u([d({type:String,json:{write:!0}})],Sc.prototype,"field",void 0),u([d({type:Number,json:{write:!0}})],Sc.prototype,"maxSliderValue",void 0),u([d({type:Number,json:{write:!0}})],Sc.prototype,"minSliderValue",void 0),u([d({types:_ue,json:{write:!0}})],Sc.prototype,"startTime",void 0),u([qt("startTime")],Sc.prototype,"castStartTime",null),u([d({type:JD.apiValues,value:null,json:{type:JD.jsonValues,read:JD.read,write:JD.write}})],Sc.prototype,"style",null),u([d({type:wue,value:null,json:{type:wue,origins:{"web-scene":{type:bue,write:{writer:(e,t)=>{bue.includes(e)&&(t.theme=e)}}}},write:!0}})],Sc.prototype,"theme",null),u([d({type:KD.apiValues,json:{type:KD.jsonValues,read:KD.read,write:KD.write}})],Sc.prototype,"type",void 0),u([d({type:xue,json:{type:xue,write:!0}})],Sc.prototype,"units",void 0),Sc=FZ=u([$("esri.renderers.support.AuthoringInfoVisualVariable")],Sc);const UJe=Sc;let v5=class extends ye{constructor(e){super(e),this.type=null}};u([d({readOnly:!0,json:{read:!1,write:!0}})],v5.prototype,"type",void 0),v5=u([$("esri.rest.support.ColorRamp")],v5);const yre=v5;var kZ;let pw=kZ=class extends yre{constructor(e){super(e),this.algorithm=null,this.fromColor=null,this.toColor=null,this.type="algorithmic"}clone(){return new kZ({fromColor:re(this.fromColor),toColor:re(this.toColor),algorithm:this.algorithm})}};u([lt({esriCIELabAlgorithm:"cie-lab",esriHSVAlgorithm:"hsv",esriLabLChAlgorithm:"lab-lch"})],pw.prototype,"algorithm",void 0),u([d({type:Me,json:{type:[Wi],write:!0}})],pw.prototype,"fromColor",void 0),u([d({type:Me,json:{type:[Wi],write:!0}})],pw.prototype,"toColor",void 0),u([d({type:["algorithmic"]})],pw.prototype,"type",void 0),pw=kZ=u([$("esri.rest.support.AlgorithmicColorRamp")],pw);const vre=pw;var UZ;let WM=UZ=class extends yre{constructor(e){super(e),this.colorRamps=null,this.type="multipart"}clone(){return new UZ({colorRamps:re(this.colorRamps)})}};u([d({type:[vre],json:{write:!0}})],WM.prototype,"colorRamps",void 0),u([d({type:["multipart"]})],WM.prototype,"type",void 0),WM=UZ=u([$("esri.rest.support.MultipartColorRamp")],WM);const CCe=WM,VJe={key:"type",base:yre,typeMap:{algorithmic:vre,multipart:CCe}};function zJe(e){return e&&e.type?e.type==="algorithmic"?vre.fromJSON(e):e.type==="multipart"?CCe.fromJSON(e):null:null}var VZ;const ub=new Tr({esriClassifyDefinedInterval:"defined-interval",esriClassifyEqualInterval:"equal-interval",esriClassifyManual:"manual",esriClassifyNaturalBreaks:"natural-breaks",esriClassifyQuantile:"quantile",esriClassifyStandardDeviation:"standard-deviation"}),eN=new Tr({pieChart:"pie-chart",classedSize:"class-breaks-size",classedColor:"class-breaks-color",univariateColorSize:"univariate-color-size",relationship:"relationship",predominance:"predominance",dotDensity:"dot-density",flow:"flow"}),Tue=new Tr({classedSize:"class-breaks-size",classedColor:"class-breaks-color",univariateColorSize:"univariate-color-size",relationship:"relationship",predominance:"predominance",dotDensity:"dot-density"}),Sue=["inches","feet","yards","miles","nautical-miles","millimeters","centimeters","decimeters","meters","kilometers","decimal-degrees"],BJe=["high-to-low","above-and-below","above","below","90-10"],GJe=["flow-line","wave-front"],jJe=["caret","circle-caret","arrow","circle-arrow","plus-minus","circle-plus-minus","square","circle","triangle","happy-sad","thumb","custom"];let On=VZ=class extends ye{constructor(e){super(e),this.colorRamp=null,this.lengthUnit=null,this.maxSliderValue=null,this.minSliderValue=null,this.visualVariables=null}get classificationMethod(){const e=this._get("classificationMethod"),t=this.type;return t&&t!=="relationship"?t==="class-breaks-size"||t==="class-breaks-color"?e||"manual":null:e}set classificationMethod(e){this._set("classificationMethod",e)}readColorRamp(e){if(e)return zJe(e)}get fields(){return this.type&&this.type!=="predominance"?null:this._get("fields")}set fields(e){this._set("fields",e)}get field1(){return this.type&&this.type!=="relationship"?null:this._get("field1")}set field1(e){this._set("field1",e)}get field2(){return this.type&&this.type!=="relationship"?null:this._get("field2")}set field2(e){this._set("field2",e)}get flowTheme(){return this.type==="flow"?this._get("flowTheme"):null}set flowTheme(e){this._set("flowTheme",e)}get focus(){return this.type&&this.type!=="relationship"?null:this._get("focus")}set focus(e){this._set("focus",e)}get numClasses(){return this.type&&this.type!=="relationship"?null:this._get("numClasses")}set numClasses(e){this._set("numClasses",e)}get statistics(){return this.type==="univariate-color-size"&&this.univariateTheme==="above-and-below"?this._get("statistics"):null}set statistics(e){this._set("statistics",e)}get standardDeviationInterval(){const e=this.type;return e&&e!=="relationship"&&e!=="class-breaks-size"&&e!=="class-breaks-color"||this.classificationMethod&&this.classificationMethod!=="standard-deviation"?null:this._get("standardDeviationInterval")}set standardDeviationInterval(e){this._set("standardDeviationInterval",e)}get type(){return this._get("type")}set type(e){let t=e;e==="classed-size"?t="class-breaks-size":e==="classed-color"&&(t="class-breaks-color"),this._set("type",t)}get univariateSymbolStyle(){return this.type==="univariate-color-size"&&this.univariateTheme==="above-and-below"?this._get("univariateSymbolStyle"):null}set univariateSymbolStyle(e){this._set("univariateSymbolStyle",e)}get univariateTheme(){return this.type==="univariate-color-size"?this._get("univariateTheme"):null}set univariateTheme(e){this._set("univariateTheme",e)}clone(){return new VZ({classificationMethod:this.classificationMethod,colorRamp:re(this.colorRamp),fields:this.fields&&this.fields.slice(0),field1:re(this.field1),field2:re(this.field2),focus:this.focus,numClasses:this.numClasses,maxSliderValue:this.maxSliderValue,minSliderValue:this.minSliderValue,lengthUnit:this.lengthUnit,statistics:this.statistics,standardDeviationInterval:this.standardDeviationInterval,type:this.type,visualVariables:this.visualVariables&&this.visualVariables.map(e=>e.clone()),univariateSymbolStyle:this.univariateSymbolStyle,univariateTheme:this.univariateTheme,flowTheme:this.flowTheme})}};u([d({type:ub.apiValues,value:null,json:{type:ub.jsonValues,read:ub.read,write:ub.write,origins:{"web-document":{default:"manual",type:ub.jsonValues,read:ub.read,write:ub.write}}}})],On.prototype,"classificationMethod",null),u([d({types:VJe,json:{write:!0}})],On.prototype,"colorRamp",void 0),u([$e("colorRamp")],On.prototype,"readColorRamp",null),u([d({type:[String],value:null,json:{write:!0}})],On.prototype,"fields",null),u([d({type:p_,value:null,json:{write:!0}})],On.prototype,"field1",null),u([d({type:p_,value:null,json:{write:!0}})],On.prototype,"field2",null),u([d({type:GJe,value:null,json:{write:!0,origins:{"web-scene":{write:!1}}}})],On.prototype,"flowTheme",null),u([d({type:["HH","HL","LH","LL"],value:null,json:{write:!0}})],On.prototype,"focus",null),u([d({type:Number,value:null,json:{type:Wi,write:!0}})],On.prototype,"numClasses",null),u([d({type:Sue,json:{type:Sue,read:!1,write:!1,origins:{"web-scene":{read:!0,write:!0}}}})],On.prototype,"lengthUnit",void 0),u([d({type:Number,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],On.prototype,"maxSliderValue",void 0),u([d({type:Number,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],On.prototype,"minSliderValue",void 0),u([d({type:Object,value:null,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],On.prototype,"statistics",null),u([d({type:[.25,.33,.5,1],value:null,json:{type:[.25,.33,.5,1],write:!0}})],On.prototype,"standardDeviationInterval",null),u([d({type:eN.apiValues,value:null,json:{type:eN.jsonValues,read:eN.read,write:eN.write,origins:{"web-scene":{type:Tue.jsonValues,write:{writer:Tue.write,overridePolicy:e=>({enabled:e!=="flow"})}}}}})],On.prototype,"type",null),u([d({type:[UJe],json:{write:!0}})],On.prototype,"visualVariables",void 0),u([d({type:jJe,value:null,json:{write:!0,origins:{"web-scene":{write:!1}}}})],On.prototype,"univariateSymbolStyle",null),u([d({type:BJe,value:null,json:{write:!0,origins:{"web-scene":{write:!1}}}})],On.prototype,"univariateTheme",null),On=VZ=u([$("esri.renderers.support.AuthoringInfo")],On);const ACe=On,PG=new Tr({simple:"simple",uniqueValue:"unique-value",classBreaks:"class-breaks",heatmap:"heatmap",dotDensity:"dot-density",dictionary:"dictionary",pieChart:"pie-chart"},{ignoreUnknown:!0});let XM=class extends ye{constructor(e){super(e),this.authoringInfo=null,this.type=null}async getRequiredFields(e){if(!this.collectRequiredFields)return[];const t=new Set;return await this.collectRequiredFields(t,e),Array.from(t).sort()}getSymbol(e,t){}async getSymbolAsync(e,t){}getSymbols(){return[]}getAttributeHash(){return JSON.stringify(this)}getMeshHash(){return JSON.stringify(this)}};u([d({type:ACe,json:{write:!0}})],XM.prototype,"authoringInfo",void 0),u([d({type:PG.apiValues,readOnly:!0,json:{type:PG.jsonValues,read:!1,write:{writer:PG.write,ignoreOrigin:!0}}})],XM.prototype,"type",void 0),XM=u([$("esri.renderers.Renderer")],XM);const R0=XM;var zZ;let mC=zZ=class extends ye{constructor(){super(...arguments),this.title=null}clone(){return new zZ({title:this.title})}};u([d({type:String,json:{write:!0}})],mC.prototype,"title",void 0),mC=zZ=u([$("esri.renderers.support.LegendOptions")],mC);var BZ;let _5=BZ=class extends mC{constructor(){super(...arguments),this.showLegend=null}clone(){return new BZ({title:this.title,showLegend:this.showLegend})}};u([d({type:Boolean,json:{write:!0}})],_5.prototype,"showLegend",void 0),_5=BZ=u([$("esri.renderers.visualVariables.support.VisualVariableLegendOptions")],_5);const RCe=_5,HJe=fe.getLogger("esri.renderers.visualVariables.VisualVariable"),IG=new Tr({colorInfo:"color",transparencyInfo:"opacity",rotationInfo:"rotation",sizeInfo:"size"});let xp=class extends ye{constructor(e){super(e),this.index=null,this.type=null,this.field=null,this.valueExpression=null,this.valueExpressionTitle=null,this.legendOptions=null}castField(e){return e==null?e:typeof e=="function"?(HJe.error(".field: field must be a string value"),null):G$(e)}get arcadeRequired(){return!!this.valueExpression}clone(){}getAttributeHash(){return`${this.type}-${this.field}-${this.valueExpression}`}};u([d()],xp.prototype,"index",void 0),u([d({type:IG.apiValues,readOnly:!0,json:{read:IG.read,write:IG.write}})],xp.prototype,"type",void 0),u([d({type:String,json:{write:!0}})],xp.prototype,"field",void 0),u([qt("field")],xp.prototype,"castField",null),u([d({type:String,json:{write:!0}})],xp.prototype,"valueExpression",void 0),u([d({type:String,json:{write:!0}})],xp.prototype,"valueExpressionTitle",void 0),u([d({readOnly:!0})],xp.prototype,"arcadeRequired",null),u([d({type:RCe,json:{write:!0}})],xp.prototype,"legendOptions",void 0),xp=u([$("esri.renderers.visualVariables.VisualVariable")],xp);const lL=xp;var GZ;let fw=GZ=class extends lL{constructor(e){super(e),this.type="color",this.normalizationField=null}get cache(){return{ipData:this._interpolateData(),hasExpression:!!this.valueExpression,compiledFunc:null}}set stops(e){e&&Array.isArray(e)&&(e=e.filter(t=>!!t)).sort((t,r)=>t.value-r.value),this._set("stops",e)}clone(){return new GZ({field:this.field,normalizationField:this.normalizationField,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,stops:this.stops&&this.stops.map(e=>e.clone()),legendOptions:this.legendOptions&&this.legendOptions.clone()})}getAttributeHash(){return`${super.getAttributeHash()}-${this.normalizationField}`}_interpolateData(){return this.stops&&this.stops.map(e=>e.value||0)}};u([d({readOnly:!0})],fw.prototype,"cache",null),u([d({type:["color"],json:{type:["colorInfo"]}})],fw.prototype,"type",void 0),u([d({type:String,json:{write:!0}})],fw.prototype,"normalizationField",void 0),u([d({type:[Yqe],json:{write:!0}})],fw.prototype,"stops",null),fw=GZ=u([$("esri.renderers.visualVariables.ColorVariable")],fw);const OCe=fw;var jZ;let Uv=jZ=class extends ye{constructor(e){super(e),this.label=null,this.opacity=null,this.value=null}readOpacity(e,t){return ZC(t.transparency)}writeOpacity(e,t,r){t[r]=e6(e)}clone(){return new jZ({label:this.label,opacity:this.opacity,value:this.value})}};u([d({type:String,json:{write:!0}})],Uv.prototype,"label",void 0),u([d({type:Number,json:{type:Wi,write:{target:"transparency"}}})],Uv.prototype,"opacity",void 0),u([$e("opacity",["transparency"])],Uv.prototype,"readOpacity",null),u([Xe("opacity")],Uv.prototype,"writeOpacity",null),u([d({type:Number,json:{write:!0}})],Uv.prototype,"value",void 0),Uv=jZ=u([$("esri.renderers.visualVariables.support.OpacityStop")],Uv);const qJe=Uv;var HZ;let mw=HZ=class extends lL{constructor(e){super(e),this.type="opacity",this.normalizationField=null}get cache(){return{ipData:this._interpolateData(),hasExpression:!!this.valueExpression,compiledFunc:null}}set stops(e){e&&Array.isArray(e)&&(e=e.filter(t=>!!t)).sort((t,r)=>t.value-r.value),this._set("stops",e)}clone(){return new HZ({field:this.field,normalizationField:this.normalizationField,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,stops:this.stops&&this.stops.map(e=>e.clone()),legendOptions:this.legendOptions&&this.legendOptions.clone()})}getAttributeHash(){return`${super.getAttributeHash()}-${this.normalizationField}`}_interpolateData(){return this.stops&&this.stops.map(e=>e.value||0)}};u([d({readOnly:!0})],mw.prototype,"cache",null),u([d({type:["opacity"],json:{type:["transparencyInfo"]}})],mw.prototype,"type",void 0),u([d({type:String,json:{write:!0}})],mw.prototype,"normalizationField",void 0),u([d({type:[qJe],json:{write:!0}})],mw.prototype,"stops",null),mw=HZ=u([$("esri.renderers.visualVariables.OpacityVariable")],mw);const MCe=mw;var qZ;let Jg=qZ=class extends lL{constructor(e){super(e),this.axis=null,this.type="rotation",this.rotationType="geographic",this.valueExpressionTitle=null}get cache(){return{hasExpression:!!this.valueExpression,compiledFunc:null}}writeValueExpressionTitleWebScene(e,t,r,i){if(i&&i.messages){const s=`visualVariables[${this.index}]`;i.messages.push(new j("property:unsupported",this.type+"VisualVariable.valueExpressionTitle is not supported in Web Scene. Please remove this property to save the Web Scene.",{instance:this,propertyName:s+".valueExpressionTitle",context:i}))}}clone(){return new qZ({axis:this.axis,rotationType:this.rotationType,field:this.field,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,legendOptions:this.legendOptions&&this.legendOptions.clone()})}};u([d({readOnly:!0})],Jg.prototype,"cache",null),u([d({type:["heading","tilt","roll"],json:{origins:{"web-scene":{default:"heading",write:!0}}}})],Jg.prototype,"axis",void 0),u([d({type:["rotation"],json:{type:["rotationInfo"]}})],Jg.prototype,"type",void 0),u([d({type:["geographic","arithmetic"],json:{write:!0,origins:{"web-document":{write:!0,default:"geographic"}}}})],Jg.prototype,"rotationType",void 0),u([d({type:String,json:{write:!0}})],Jg.prototype,"valueExpressionTitle",void 0),u([Xe("web-scene","valueExpressionTitle")],Jg.prototype,"writeValueExpressionTitleWebScene",null),Jg=qZ=u([$("esri.renderers.visualVariables.RotationVariable")],Jg);const PCe=Jg;var WZ;let L2=WZ=class extends ye{constructor(e){super(e),this.label=null,this.size=null,this.value=null}clone(){return new WZ({label:this.label,size:this.size,value:this.value})}};u([d({type:String,json:{write:!0}})],L2.prototype,"label",void 0),u([d({type:Number,cast:si,json:{write:!0}})],L2.prototype,"size",void 0),u([d({type:Number,json:{write:!0}})],L2.prototype,"value",void 0),L2=WZ=u([$("esri.renderers.visualVariables.support.SizeStop")],L2);const WJe=L2;var XZ;let b5=XZ=class extends RCe{constructor(){super(...arguments),this.customValues=null}clone(){return new XZ({title:this.title,showLegend:this.showLegend,customValues:this.customValues&&this.customValues.slice(0)})}};u([d({type:[Number],json:{write:!0}})],b5.prototype,"customValues",void 0),b5=XZ=u([$("esri.renderers.visualVariables.support.SizeVariableLegendOptions")],b5);const ICe=b5;var qy,Eo;function ME(e){return e&&e.declaredClass==="esri.renderers.visualVariables.SizeVariable"}function CI(e){return e!=null&&!isNaN(e)&&isFinite(e)}function $Ce(e){return e.valueExpression?qy.Expression:e.field&&typeof e.field=="string"?qy.Field:qy.Unknown}function XJe(e,t){const r=t||$Ce(e),i=e.valueUnit||"unknown";return r===qy.Unknown?Eo.Constant:e.stops?Eo.Stops:e.minSize!=null&&e.maxSize!=null&&e.minDataValue!=null&&e.maxDataValue!=null?Eo.ClampedLinear:i==="unknown"?e.minSize!=null&&e.minDataValue!=null?e.minSize&&e.minDataValue?Eo.Proportional:Eo.Additive:Eo.Identity:Eo.RealWorldSize}(function(e){e.Unknown="unknown",e.Expression="expression",e.Field="field"})(qy||(qy={})),function(e){e.Unknown="unknown",e.Stops="stops",e.ClampedLinear="clamped-linear",e.Proportional="proportional",e.Additive="additive",e.Constant="constant",e.Identity="identity",e.RealWorldSize="real-world-size"}(Eo||(Eo={}));const vA={inches:pn(1,"meters","inches"),feet:pn(1,"meters","feet"),"us-feet":pn(1,"meters","us-feet"),yards:pn(1,"meters","yards"),miles:pn(1,"meters","miles"),"nautical-miles":pn(1,"meters","nautical-miles"),millimeters:pn(1,"meters","millimeters"),centimeters:pn(1,"meters","centimeters"),decimeters:pn(1,"meters","decimeters"),meters:pn(1,"meters","meters"),kilometers:pn(1,"meters","kilometers"),"decimal-degrees":1/H8e(1,"meters",$r.radius)},P1=fe.getLogger("esri.renderers.visualVariables.support.visualVariableUtils"),Eue=new gl,w5=Math.PI,LCe=/^\s*(return\s+)?\$view\.scale\s*(;)?\s*$/i;function DCe(e,t,r){const i="visualVariables"in e&&e.visualVariables?e.visualVariables.find(g=>g.type==="color"):e;if(!i)return;if(i.declaredClass!=="esri.renderers.visualVariables.ColorVariable")return void P1.warn("The visualVariable should be an instance of esri.renderers.visualVariables.ColorVariable");const s=typeof t=="number",n=s?null:t,o=n&&n.attributes;let a=s?t:null;const l=i.field,{ipData:c,hasExpression:h}=i.cache;let p=i.cache.compiledFunc;if(!l&&!h){const g=i.stops;return g&&g[0]&&g[0].color}if(typeof a!="number")if(h){if(R(r)||R(r.arcade))return void P1.error("Use of arcade expressions requires an arcade context");const g={viewingMode:r.viewingMode,scale:r.scale,spatialReference:r.spatialReference},v=r.arcade.arcadeUtils,w=v.getViewInfo(g),_=v.createExecContext(n,w);if(!p){const T=v.createSyntaxTree(i.valueExpression);p=v.createFunction(T),i.cache.compiledFunc=p}a=v.executeFunction(p,_)}else o&&(a=o[l]);const f=i.normalizationField,m=o?parseFloat(o[f]):void 0;if(a!=null&&(!f||s||!isNaN(m)&&m!==0)){isNaN(m)||s||(a/=m);const g=bre(a,c);if(g){const v=g[0],w=g[1],_=v===w?i.stops[v].color:Me.blendColors(i.stops[v].color,i.stops[w].color,g[2],b(r)?r.color:void 0);return new Me(_)}}}function NCe(e,t,r){const i="visualVariables"in e&&e.visualVariables?e.visualVariables.find(g=>g.type==="opacity"):e;if(!i)return;if(i.declaredClass!=="esri.renderers.visualVariables.OpacityVariable")return void P1.warn("The visualVariable should be an instance of esri.renderers.visualVariables.OpacityVariable");const s=typeof t=="number",n=s?null:t,o=n&&n.attributes;let a=s?t:null;const l=i.field,{ipData:c,hasExpression:h}=i.cache;let p=i.cache.compiledFunc;if(!l&&!h){const g=i.stops;return g&&g[0]&&g[0].opacity}if(typeof a!="number")if(h){if(R(r)||R(r.arcade))return void P1.error("Use of arcade expressions requires an arcade context");const g={viewingMode:r.viewingMode,scale:r.scale,spatialReference:r.spatialReference},v=r.arcade.arcadeUtils,w=v.getViewInfo(g),_=v.createExecContext(n,w);if(!p){const T=v.createSyntaxTree(i.valueExpression);p=v.createFunction(T),i.cache.compiledFunc=p}a=v.executeFunction(p,_)}else o&&(a=o[l]);const f=i.normalizationField,m=o?parseFloat(o[f]):void 0;if(a!=null&&(!f||s||!isNaN(m)&&m!==0)){isNaN(m)||s||(a/=m);const g=bre(a,c);if(g){const v=g[0],w=g[1];if(v===w)return i.stops[v].opacity;{const _=i.stops[v].opacity;return _+(i.stops[w].opacity-_)*g[2]}}}}function FCe(e,t,r){const i="visualVariables"in e&&e.visualVariables?e.visualVariables.find(m=>m.type==="rotation"):e;if(!i)return;if(i.declaredClass!=="esri.renderers.visualVariables.RotationVariable")return void P1.warn("The visualVariable should be an instance of esri.renderers.visualVariables.RotationVariable");const s=i.axis||"heading",n=s==="heading"&&i.rotationType==="arithmetic"?90:0,o=s==="heading"&&i.rotationType==="arithmetic"?-1:1,a=typeof t=="number"?null:t,l=a&&a.attributes,c=i.field,{hasExpression:h}=i.cache;let p=i.cache.compiledFunc,f=0;if(!c&&!h)return f;if(h){if(R(r)||R(r.arcade))return void P1.error("Use of arcade expressions requires an arcade context");const m={viewingMode:r.viewingMode,scale:r.scale,spatialReference:r.spatialReference},g=r.arcade.arcadeUtils,v=g.getViewInfo(m),w=g.createExecContext(a,v);if(!p){const _=g.createSyntaxTree(i.valueExpression);p=g.createFunction(_),i.cache.compiledFunc=p}f=g.executeFunction(p,w)}else l&&(f=l[c]||0);return f=typeof f!="number"||isNaN(f)?null:n+o*f,f}function ZJe(e,t,r){const i=typeof t=="number",s=i?null:t,n=s&&s.attributes;let o=i?t:null;const{isScaleDriven:a}=e.cache;let l=e.cache.compiledFunc;if(a){const h=b(r)?r.scale:void 0,p=b(r)?r.view:void 0;o=h==null||p==="3d"?YJe(e):h}else if(!i)switch(e.inputValueType){case qy.Expression:{if(R(r)||R(r.arcade))return void P1.error("Use of arcade expressions requires an arcade context");const h={viewingMode:r.viewingMode,scale:r.scale,spatialReference:r.spatialReference},p=r.arcade.arcadeUtils,f=p.getViewInfo(h),m=p.createExecContext(s,f);if(!l){const g=p.createSyntaxTree(e.valueExpression);l=p.createFunction(g),e.cache.compiledFunc=l}o=p.executeFunction(l,m);break}case qy.Field:n&&(o=n[e.field]);break;case qy.Unknown:o=null}if(!CI(o))return null;if(i||!e.normalizationField)return o;const c=n?parseFloat(n[e.normalizationField]):null;return CI(c)&&c!==0?o/c:null}function YJe(e){let t=null,r=null;const i=e.stops;return i?(t=i[0].value,r=i[i.length-1].value):(t=e.minDataValue||0,r=e.maxDataValue||0),(t+r)/2}function eB(e,t,r){const i="visualVariables"in e&&e.visualVariables?e.visualVariables.find(n=>n.type==="size"):e;if(!i)return;if(i.declaredClass!=="esri.renderers.visualVariables.SizeVariable")return void P1.warn("The visualVariable should be an instance of esri.renderers.visualVariables.SizeVariable");const s=UCe(ZJe(i,t,r),i,t,r,i.cache.ipData);return s==null||isNaN(s)?0:s}function tu(e,t,r){return e==null?null:ME(e)?eB(e,t,r):CI(e)?e:null}function kCe(e,t,r){return CI(r)&&e>r?r:CI(t)&&e<t?t:e}function QJe(e,t,r,i){return e+(tu(t.minSize,r,i)||t.minDataValue)}function JJe(e,t,r){const i=e.stops;let s=i&&i.length&&i[0].size;return s==null&&(s=e.minSize),tu(s,t,r)}function KJe(e,t,r,i){const s=(e-t.minDataValue)/(t.maxDataValue-t.minDataValue),n=tu(t.minSize,r,i),o=tu(t.maxSize,r,i),a=b(i)?i.shape:void 0;if(e<=t.minDataValue)return n;if(e>=t.maxDataValue)return o;if(t.scaleBy==="area"&&a){const l=a==="circle",c=l?w5*(n/2)**2:n*n,h=c+s*((l?w5*(o/2)**2:o*o)-c);return l?2*Math.sqrt(h/w5):Math.sqrt(h)}return n+s*(o-n)}function eKe(e,t,r,i){const s=b(i)?i.shape:void 0,n=e/t.minDataValue,o=tu(t.minSize,r,i),a=tu(t.maxSize,r,i);let l=null;return l=s==="circle"?2*Math.sqrt(n*(o/2)**2):s==="square"||s==="diamond"||s==="image"?Math.sqrt(n*o**2):n*o,kCe(l,o,a)}function tKe(e,t,r,i,s){const[n,o,a]=bre(e,s);if(n===o)return tu(t.stops[n].size,r,i);{const l=tu(t.stops[n].size,r,i);return l+(tu(t.stops[o].size,r,i)-l)*a}}function rKe(e,t,r,i){const s=(b(i)&&i.resolution?i.resolution:1)*vA[t.valueUnit],n=tu(t.minSize,r,i),o=tu(t.maxSize,r,i),{valueRepresentation:a}=t;let l=null;return l=a==="area"?2*Math.sqrt(e/w5)/s:a==="radius"||a==="distance"?2*e/s:e/s,kCe(l,n,o)}function UCe(e,t,r,i,s){switch(t.transformationType){case Eo.Additive:return QJe(e,t,r,i);case Eo.Constant:return JJe(t,r,i);case Eo.ClampedLinear:return KJe(e,t,r,i);case Eo.Proportional:return eKe(e,t,r,i);case Eo.Stops:return tKe(e,t,r,i,s);case Eo.RealWorldSize:return rKe(e,t,r,i);case Eo.Identity:return e;case Eo.Unknown:return null}}function iKe(e,t,r){const{isScaleDriven:i}=e.cache;if(!(i&&r==="3d"||t))return null;const s={scale:t,view:r};let n=tu(e.minSize,Eue,s),o=tu(e.maxSize,Eue,s);if(n!=null||o!=null){if(n>o){const a=o;o=n,n=a}return{minSize:n,maxSize:o}}}function _re(e,t,r){if(!e.visualVariables)return;const i=[],s=[],n=[],o=[],a=[];for(const l of e.visualVariables)switch(l.type){case"color":s.push(l);break;case"opacity":n.push(l);break;case"rotation":a.push(l);break;case"size":o.push(l)}return s.forEach(l=>{const c=DCe(l,t,r);i.push({variable:l,value:c})}),n.forEach(l=>{const c=NCe(l,t,r);i.push({variable:l,value:c})}),a.forEach(l=>{const c=FCe(l,t,r);i.push({variable:l,value:c})}),o.forEach(l=>{const c=eB(l,t,r);i.push({variable:l,value:c})}),i.filter(l=>l.value!=null)}function bre(e,t){if(!t)return;let r=0,i=t.length-1;return t.some((s,n)=>e<s?(i=n,!0):(r=n,!1)),[r,i,(e-t[r])/(t[i]-t[r])]}function sKe(e,t,r){const i=["proportional","proportional","proportional"];for(const s of e){const n=s.useSymbolValue?"symbol-value":eB(s,t,r);switch(s.axis){case"width":i[0]=n;break;case"depth":i[1]=n;break;case"height":i[2]=n;break;case"width-and-depth":i[0]=n,i[1]=n;break;case"all":case void 0:case null:i[0]=n,i[1]=n,i[2]=n;break;default:s.axis}}return i}const iS=Object.freeze(Object.defineProperty({__proto__:null,getAllSizes:sKe,getColor:DCe,getOpacity:NCe,getRotationAngle:FCe,getSize:eB,getSizeForValue:UCe,getSizeFromNumberOrVariable:tu,getSizeRangeAtScale:iKe,getVisualVariableValues:_re,viewScaleRE:LCe},Symbol.toStringTag,{value:"Module"}));var ZZ;const gS=fe.getLogger("esri.renderers.visualVariables.SizeVariable"),tN=new Tr({width:"width",depth:"depth",height:"height",widthAndDepth:"width-and-depth",all:"all"}),YZ=new Tr({unknown:"unknown",inch:"inches",foot:"feet",yard:"yards",mile:"miles","nautical-mile":"nautical-miles",millimeter:"millimeters",centimeter:"centimeters",decimeter:"decimeters",meter:"meters",kilometer:"kilometers","decimal-degree":"decimal-degrees"});function Cue(e){if(e!=null)return typeof e=="string"||typeof e=="number"?si(e):e.type==="size"?ME(e)?e:(delete(e={...e}).type,new ai(e)):void 0}function Aue(e,t,r){if(typeof e!="object")return e;const i=new ai;return i.read(e,r),i}let ai=ZZ=class extends lL{constructor(e){super(e),this.axis=null,this.legendOptions=null,this.normalizationField=null,this.scaleBy=null,this.target=null,this.type="size",this.useSymbolValue=null,this.valueExpression=null,this.valueRepresentation=null,this.valueUnit=null}get cache(){return{ipData:this._interpolateData(),hasExpression:!!this.valueExpression,compiledFunc:null,isScaleDriven:LCe.test(this.valueExpression)}}set expression(e){gS.warn("'expression' is deprecated since version 4.2. Use 'valueExpression' instead. The only supported expression is 'view.scale'."),e==="view.scale"?(this.valueExpression="$view.scale",this._set("expression",e)):this._set("expression",null)}set index(e){ME(this.maxSize)&&(this.maxSize.index=`visualVariables[${e}].maxSize`),ME(this.minSize)&&(this.minSize.index=`visualVariables[${e}].minSize`),this._set("index",e)}get inputValueType(){return $Ce(this)}set maxDataValue(e){e&&this.stops&&(gS.warn("cannot set maxDataValue when stops is not null."),e=null),this._set("maxDataValue",e)}set maxSize(e){e&&this.stops&&(gS.warn("cannot set maxSize when stops is not null."),e=null),this._set("maxSize",e)}castMaxSize(e){return Cue(e)}readMaxSize(e,t,r){return Aue(e,t,r)}set minDataValue(e){e&&this.stops&&(gS.warn("cannot set minDataValue when stops is not null."),e=null),this._set("minDataValue",e)}set minSize(e){e&&this.stops&&(gS.warn("cannot set minSize when stops is not null."),e=null),this._set("minSize",e)}castMinSize(e){return Cue(e)}readMinSize(e,t,r){return Aue(e,t,r)}get arcadeRequired(){return!!this.valueExpression||this.minSize&&typeof this.minSize=="object"&&this.minSize.arcadeRequired||this.maxSize&&typeof this.maxSize=="object"&&this.maxSize.arcadeRequired}set stops(e){this.minDataValue==null&&this.maxDataValue==null&&this.minSize==null&&this.maxSize==null?e&&Array.isArray(e)&&(e=e.filter(t=>!!t)).sort((t,r)=>t.value-r.value):e&&(gS.warn("cannot set stops when one of minDataValue, maxDataValue, minSize or maxSize is not null."),e=null),this._set("stops",e)}get transformationType(){return XJe(this,this.inputValueType)}readValueExpression(e,t){return e||t.expression&&"$view.scale"}writeValueExpressionWebScene(e,t,r,i){if(e==="$view.scale"){if(i&&i.messages){const s=this.index,n=typeof s=="string"?s:`visualVariables[${s}]`;i.messages.push(new j("property:unsupported",this.type+"VisualVariable.valueExpression = '$view.scale' is not supported in Web Scene. Please remove this property to save the Web Scene.",{instance:this,propertyName:n+".valueExpression",context:i}))}}else t[r]=e}readValueUnit(e){return e?YZ.read(e):null}clone(){return new ZZ({axis:this.axis,field:this.field,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,maxDataValue:this.maxDataValue,maxSize:ME(this.maxSize)?this.maxSize.clone():this.maxSize,minDataValue:this.minDataValue,minSize:ME(this.minSize)?this.minSize.clone():this.minSize,normalizationField:this.normalizationField,stops:this.stops&&this.stops.map(e=>e.clone()),target:this.target,useSymbolValue:this.useSymbolValue,valueRepresentation:this.valueRepresentation,valueUnit:this.valueUnit,legendOptions:this.legendOptions&&this.legendOptions.clone()})}flipSizes(){if(this.transformationType===Eo.ClampedLinear){const{minSize:e,maxSize:t}=this;return this.minSize=t,this.maxSize=e,this}if(this.transformationType===Eo.Stops){const e=this.stops,t=e.map(i=>i.size).reverse(),r=e.length;for(let i=0;i<r;i++)e[i].size=t[i];return this}return this}getAttributeHash(){return`${super.getAttributeHash()}-${this.target}-${this.normalizationField}`}_interpolateData(){return this.stops&&this.stops.map(e=>e.value||0)}};u([d({readOnly:!0})],ai.prototype,"cache",null),u([d({type:tN.apiValues,json:{type:tN.jsonValues,origins:{"web-map":{read:!1}},read:tN.read,write:tN.write}})],ai.prototype,"axis",void 0),u([d({type:String,value:null,json:{read:!1}})],ai.prototype,"expression",null),u([d()],ai.prototype,"index",null),u([d({type:String,readOnly:!0})],ai.prototype,"inputValueType",null),u([d({type:ICe,json:{write:!0}})],ai.prototype,"legendOptions",void 0),u([d({type:Number,value:null,json:{write:!0}})],ai.prototype,"maxDataValue",null),u([d({type:Number,value:null,json:{write:!0}})],ai.prototype,"maxSize",null),u([qt("maxSize")],ai.prototype,"castMaxSize",null),u([$e("maxSize")],ai.prototype,"readMaxSize",null),u([d({type:Number,value:null,json:{write:!0}})],ai.prototype,"minDataValue",null),u([d({type:Number,value:null,json:{write:!0}})],ai.prototype,"minSize",null),u([qt("minSize")],ai.prototype,"castMinSize",null),u([$e("minSize")],ai.prototype,"readMinSize",null),u([d({type:String,json:{write:!0}})],ai.prototype,"normalizationField",void 0),u([d({readOnly:!0})],ai.prototype,"arcadeRequired",null),u([d({type:String})],ai.prototype,"scaleBy",void 0),u([d({type:[WJe],value:null,json:{write:!0}})],ai.prototype,"stops",null),u([d({type:["outline"],json:{write:!0}})],ai.prototype,"target",void 0),u([d({type:String,readOnly:!0})],ai.prototype,"transformationType",null),u([d({type:["size"],json:{type:["sizeInfo"]}})],ai.prototype,"type",void 0),u([d({type:Boolean,json:{write:!0,origins:{"web-map":{read:!1}}}})],ai.prototype,"useSymbolValue",void 0),u([d({type:String,json:{write:!0}})],ai.prototype,"valueExpression",void 0),u([$e("valueExpression",["valueExpression","expression"])],ai.prototype,"readValueExpression",null),u([Xe("web-scene","valueExpression")],ai.prototype,"writeValueExpressionWebScene",null),u([d({type:["radius","diameter","area","width","distance"],json:{write:!0}})],ai.prototype,"valueRepresentation",void 0),u([d({type:YZ.apiValues,json:{write:YZ.write,origins:{"web-map":{read:!1},"web-scene":{write:!0}}}})],ai.prototype,"valueUnit",void 0),u([$e("valueUnit")],ai.prototype,"readValueUnit",null),ai=ZZ=u([$("esri.renderers.visualVariables.SizeVariable")],ai);const wre=ai,nKe=fe.getLogger("esri.renderers.visualVariables.VisualVariableFactory"),oKe={color:OCe,size:wre,opacity:MCe,rotation:PCe},aKe=new Tr({colorInfo:"color",transparencyInfo:"opacity",rotationInfo:"rotation",sizeInfo:"size"}),lKe=/^\[([^\]]+)\]$/i;let x5=class extends xe{constructor(){super(...arguments),this.colorVariables=null,this.opacityVariables=null,this.rotationVariables=null,this.sizeVariables=null}set visualVariables(e){if(this._resetVariables(),(e=e&&e.filter(t=>!!t))&&e.length){for(const t of e)switch(t.type){case"color":this.colorVariables.push(t);break;case"opacity":this.opacityVariables.push(t);break;case"rotation":this.rotationVariables.push(t);break;case"size":this.sizeVariables.push(t)}this.sizeVariables.length&&this.sizeVariables.some(t=>!!t.target)&&e.sort((t,r)=>{let i=null;return i=t.target===r.target?0:t.target?1:-1,i});for(let t=0;t<e.length;t++)e[t].index=t;this._set("visualVariables",e)}else this._set("visualVariables",e)}readVariables(e,t,r){const{rotationExpression:i,rotationType:s}=t,n=i&&i.match(lKe),o=n&&n[1];if(o&&(e||(e=[]),e.push({type:"rotationInfo",rotationType:s,field:o})),e)return e.map(a=>{const l=aKe.read(a.type),c=oKe[l];c||(nKe.warn(`Unknown variable type: ${l}`),r&&r.messages&&r.messages.push(new ic("visual-variable:unsupported",`visualVariable of type '${l}' is not supported`,{definition:a,context:r})));const h=new c;return h.read(a,r),h})}writeVariables(e,t){const r=[];for(const i of e){const s=i.toJSON(t);s&&r.push(s)}return r}_resetVariables(){this.colorVariables=[],this.opacityVariables=[],this.rotationVariables=[],this.sizeVariables=[]}};u([d()],x5.prototype,"visualVariables",null),x5=u([$("esri.renderers.visualVariables.VisualVariableFactory")],x5);const cKe=x5,uKe={base:lL,key:"type",typeMap:{opacity:MCe,color:OCe,rotation:PCe,size:wre}},xR=e=>{let t=class extends e{constructor(){super(...arguments),this._vvFactory=new cKe}set visualVariables(r){this._vvFactory.visualVariables=r,this._set("visualVariables",this._vvFactory.visualVariables)}readVisualVariables(r,i,s){return this._vvFactory.readVariables(r,i,s)}writeVisualVariables(r,i,s,n){i[s]=this._vvFactory.writeVariables(r,n)}get arcadeRequiredForVisualVariables(){if(!this.visualVariables)return!1;for(const r of this.visualVariables)if(r.arcadeRequired)return!0;return!1}hasVisualVariables(r,i){return r?this.getVisualVariablesForType(r,i).length>0:this.getVisualVariablesForType("size",i).length>0||this.getVisualVariablesForType("color",i).length>0||this.getVisualVariablesForType("opacity",i).length>0||this.getVisualVariablesForType("rotation",i).length>0}getVisualVariablesForType(r,i){const s=this.visualVariables;return s?s.filter(n=>n.type===r&&(typeof i=="string"?n.target===i:i!==!1||!n.target)):[]}async collectVVRequiredFields(r,i){let s=[];this.visualVariables&&(s=s.concat(this.visualVariables));for(const n of s)n&&(n.field&&$d(r,i,n.field),n.normalizationField&&$d(r,i,n.normalizationField),n.valueExpression&&await oc(r,i,n.valueExpression))}};return u([d({types:[uKe],value:null,json:{write:!0}})],t.prototype,"visualVariables",null),u([$e("visualVariables",["visualVariables","rotationType","rotationExpression"])],t.prototype,"readVisualVariables",null),u([Xe("visualVariables")],t.prototype,"writeVisualVariables",null),t=u([$("esri.renderers.mixins.VisualVariablesMixin")],t),t},cO={retainId:!1,ignoreDrivers:!1,hasLabelingContext:!0};function _A(e,t=cO){var a,l;if(!e)return{symbol:null};const{retainId:r=cO.retainId,ignoreDrivers:i=cO.ignoreDrivers,hasLabelingContext:s=cO.hasLabelingContext,retainCIM:n=cO.retainCIM}=t;let o;if(tg(e)||e instanceof YT)o=e.clone();else if(e.type==="cim"){const c=(l=(a=e.data)==null?void 0:a.symbol)==null?void 0:l.type;if(c!=="CIMPointSymbol")return{error:new j("symbol-conversion:unsupported-cim-symbol",`CIM symbol of type '${c||"unknown"}' is unsupported in 3D`,{symbol:e})};o=n?e.clone():F_.fromCIMSymbol(e)}else if(e instanceof cu)o=f6.fromSimpleLineSymbol(e);else if(e instanceof eu)o=F_.fromSimpleMarkerSymbol(e);else if(e instanceof m6)o=F_.fromPictureMarkerSymbol(e);else if(e instanceof mg)o=Y$.fromSimpleFillSymbol(e);else{if(!(e instanceof hR))return{error:new j("symbol-conversion:unsupported-2d-symbol",`2D symbol of type '${e.type||e.declaredClass}' is unsupported in 3D`,{symbol:e})};o=s?p6.fromTextSymbol(e):F_.fromTextSymbol(e)}if(r&&o.type!=="cim"&&(o.id=e.id),i&&tg(o))for(let c=0;c<o.symbolLayers.length;++c)o.symbolLayers.getItemAt(c)._ignoreDrivers=!0;return{symbol:o}}const hKe=["building-scene","integrated-mesh","point-cloud","scene"];function fV(e,t,r,i){const s=VCe(e,{},{context:i,isLabelSymbol:!1});b(s)&&(t[r]=s)}function Rue(e,t,r,i){const s=VCe(e,{},{context:i,isLabelSymbol:!0});b(s)&&(t[r]=s)}function Oue(e){return e instanceof uR||e instanceof YT}function VCe(e,t,r){var a;if(R(e))return null;const{context:i,isLabelSymbol:s}=r,n=i==null?void 0:i.origin,o=i==null?void 0:i.messages;if(n==="web-scene"&&!Oue(e)){const l=_A(e,{retainCIM:!0,hasLabelingContext:s});return b(l.symbol)?l.symbol.write(t,i):(o==null||o.push(new j("symbol:unsupported",`Symbols of type '${e.declaredClass}' are not supported in scenes. Use 3D symbology instead when working with WebScene and SceneView`,{symbol:e,context:i,error:l.error})),null)}return(n==="web-map"||n==="portal-item"&&!hKe.includes((a=i==null?void 0:i.layer)==null?void 0:a.type))&&Oue(e)?(o==null||o.push(new j("symbol:unsupported",`Symbols of type '${e.declaredClass}' are not supported in web maps and portal items. Use 2D symbology and CIMSymbol instead when working with MapView`,{symbol:e,context:i})),null):e.write(t,i)}function zCe(e,t){return e8e(e,null,t)}const cL={types:Rxe,json:{write:{writer:fV},origins:{"web-scene":{types:ile,write:{writer:fV},read:{reader:sR({types:ile})}}}}},BCe={types:{base:lu,key:"type",typeMap:{"simple-fill":kx.typeMap["simple-fill"],"picture-fill":kx.typeMap["picture-fill"],"polygon-3d":kx.typeMap["polygon-3d"]}},json:{write:{writer:fV},origins:{"web-scene":{type:Y$,write:{writer:fV}}}}};var QZ;let Vv=QZ=class extends ye{constructor(e){super(e),this.description=null,this.label=null,this.minValue=null,this.maxValue=0,this.symbol=null}clone(){return new QZ({description:this.description,label:this.label,minValue:this.minValue,maxValue:this.maxValue,symbol:this.symbol?this.symbol.clone():null})}getMeshHash(){const e=JSON.stringify(this.symbol);return`${this.minValue}.${this.maxValue}.${e}`}};u([d({type:String,json:{write:!0}})],Vv.prototype,"description",void 0),u([d({type:String,json:{write:!0}})],Vv.prototype,"label",void 0),u([d({type:Number,json:{read:{source:"classMinValue"},write:{target:"classMinValue"}}})],Vv.prototype,"minValue",void 0),u([d({type:Number,json:{read:{source:"classMaxValue"},write:{target:"classMaxValue"}}})],Vv.prototype,"maxValue",void 0),u([d(cL)],Vv.prototype,"symbol",void 0),Vv=QZ=u([$("esri.renderers.support.ClassBreakInfo")],Vv);const mV=Vv;var JZ;const rN=fe.getLogger("esri.renderers.ClassBreaksRenderer"),GCe="log",T5="percent-of-total",S5="field",iN=new Tr({esriNormalizeByLog:GCe,esriNormalizeByPercentOfTotal:T5,esriNormalizeByField:S5}),dKe=en(mV);let jn=JZ=class extends xR(R0){constructor(e){super(e),this._compiledValueExpression={valueExpression:null,compiledFunction:null},this.backgroundFillSymbol=null,this.classBreakInfos=null,this.defaultLabel=null,this.defaultSymbol=null,this.field=null,this.isMaxInclusive=!0,this.legendOptions=null,this.normalizationField=null,this.normalizationTotal=null,this.type="class-breaks",this.valueExpression=null,this.valueExpressionTitle=null,this._set("classBreakInfos",[])}readClassBreakInfos(e,t,r){if(!Array.isArray(e))return;let i=t.minValue;return e.map(s=>{const n=new mV;return n.read(s,r),n.minValue==null&&(n.minValue=i),n.maxValue==null&&(n.maxValue=n.minValue),i=n.maxValue,n})}writeClassBreakInfos(e,t,r,i){const s=e.map(n=>n.write({},i));this._areClassBreaksConsecutive()&&s.forEach(n=>delete n.classMinValue),t[r]=s}castField(e){return e==null?e:typeof e=="function"?(rN.error(".field: field must be a string value"),null):G$(e)}get minValue(){return this.classBreakInfos&&this.classBreakInfos[0]&&this.classBreakInfos[0].minValue||0}get normalizationType(){let e=this._get("normalizationType");const t=!!this.normalizationField,r=this.normalizationTotal!=null;return t||r?(e=t&&S5||r&&T5||null,t&&r&&rN.warn("warning: both normalizationField and normalizationTotal are set!")):e!==S5&&e!==T5||(e=null),e}set normalizationType(e){this._set("normalizationType",e)}addClassBreakInfo(e,t,r){let i=null;i=typeof e=="number"?new mV({minValue:e,maxValue:t,symbol:Oxe(r)}):dKe(re(e)),this.classBreakInfos.push(i),this.classBreakInfos.length===1&&this.notifyChange("minValue")}removeClassBreakInfo(e,t){const r=this.classBreakInfos.length;for(let i=0;i<r;i++){const s=[this.classBreakInfos[i].minValue,this.classBreakInfos[i].maxValue];if(s[0]===e&&s[1]===t){this.classBreakInfos.splice(i,1);break}}}getBreakIndex(e,t){return this.valueExpression&&(R(t)||R(t.arcade))&&rN.warn(""),this.valueExpression?this._getBreakIndexForExpression(e,t):this._getBreakIndexForField(e)}async getClassBreakInfo(e,t){let r=t;this.valueExpression&&(R(t)||R(t.arcade))&&(r={...r,arcade:await Qm()});const i=this.getBreakIndex(e,r);return i!==-1?this.classBreakInfos[i]:null}getSymbol(e,t){if(this.valueExpression&&(R(t)||R(t.arcade)))return void rN.error("#getSymbol()","Please use getSymbolAsync if valueExpression is used");const r=this.getBreakIndex(e,t);return r>-1?this.classBreakInfos[r].symbol:this.defaultSymbol}async getSymbolAsync(e,t){let r=t;if(this.valueExpression&&(R(t)||R(t.arcade))){const s=await Qm(),{arcadeUtils:n}=s;n.hasGeometryOperations(this.valueExpression)&&await n.enableGeometryOperations(),r={...r,arcade:s}}const i=this.getBreakIndex(e,r);return i>-1?this.classBreakInfos[i].symbol:this.defaultSymbol}getSymbols(){const e=[];return this.classBreakInfos.forEach(t=>{t.symbol&&e.push(t.symbol)}),this.defaultSymbol&&e.push(this.defaultSymbol),e}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce((e,t)=>e+t.getAttributeHash(),"")}getMeshHash(){const e=JSON.stringify(this.backgroundFillSymbol),t=JSON.stringify(this.defaultSymbol),r=`${this.normalizationField}.${this.normalizationType}.${this.normalizationTotal}`;return`${e}.${t}.${this.classBreakInfos.reduce((i,s)=>i+s.getMeshHash(),"")}.${r}.${this.field}.${this.valueExpression}`}get arcadeRequired(){return this.arcadeRequiredForVisualVariables||!!this.valueExpression}clone(){return new JZ({field:this.field,backgroundFillSymbol:this.backgroundFillSymbol&&this.backgroundFillSymbol.clone(),defaultLabel:this.defaultLabel,defaultSymbol:this.defaultSymbol&&this.defaultSymbol.clone(),valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,classBreakInfos:re(this.classBreakInfos),isMaxInclusive:this.isMaxInclusive,normalizationField:this.normalizationField,normalizationTotal:this.normalizationTotal,normalizationType:this.normalizationType,visualVariables:re(this.visualVariables),legendOptions:re(this.legendOptions),authoringInfo:this.authoringInfo&&this.authoringInfo.clone()})}async collectRequiredFields(e,t){const r=[this.collectVVRequiredFields(e,t),this.collectSymbolFields(e,t)];await Promise.all(r)}async collectSymbolFields(e,t){const r=[...this.getSymbols().map(i=>i.collectRequiredFields(e,t)),oc(e,t,this.valueExpression)];$d(e,t,this.field),$d(e,t,this.normalizationField),await Promise.all(r)}_getBreakIndexForExpression(e,t){const{viewingMode:r,scale:i,spatialReference:s,arcade:n}=_t(t,{});let o=this._compiledValueExpression.valueExpression===this.valueExpression?this._compiledValueExpression.compiledFunction:null;const a=n.arcadeUtils;if(!o){const c=a.createSyntaxTree(this.valueExpression);o=a.createFunction(c),this._compiledValueExpression.compiledFunction=o}this._compiledValueExpression.valueExpression=this.valueExpression;const l=a.executeFunction(o,a.createExecContext(e,a.getViewInfo({viewingMode:r,scale:i,spatialReference:s})));return this._getBreakIndexfromInfos(l)}_getBreakIndexForField(e){const t=this.field,r=e.attributes,i=this.normalizationType;let s=parseFloat(r[t]);if(i){const n=this.normalizationTotal,o=parseFloat(r[this.normalizationField]);if(i===GCe)s=Math.log(s)*Math.LOG10E;else if(i!==T5||isNaN(n)){if(i===S5&&!isNaN(o)){if(isNaN(s)||isNaN(o))return-1;s/=o}}else s=s/n*100}return this._getBreakIndexfromInfos(s)}_getBreakIndexfromInfos(e){const t=this.isMaxInclusive;if(e!=null&&typeof e=="number"&&!isNaN(e))for(let r=0;r<this.classBreakInfos.length;r++){const i=[this.classBreakInfos[r].minValue,this.classBreakInfos[r].maxValue];if(i[0]<=e&&(t?e<=i[1]:e<i[1]))return r}return-1}_areClassBreaksConsecutive(){const e=this.classBreakInfos,t=e.length;for(let r=1;r<t;r++)if(e[r-1].maxValue!==e[r].minValue)return!1;return!0}};u([d(BCe)],jn.prototype,"backgroundFillSymbol",void 0),u([d({type:[mV]})],jn.prototype,"classBreakInfos",void 0),u([$e("classBreakInfos")],jn.prototype,"readClassBreakInfos",null),u([Xe("classBreakInfos")],jn.prototype,"writeClassBreakInfos",null),u([d({type:String,json:{write:!0}})],jn.prototype,"defaultLabel",void 0),u([d(cL)],jn.prototype,"defaultSymbol",void 0),u([d({type:String,json:{write:!0}})],jn.prototype,"field",void 0),u([qt("field")],jn.prototype,"castField",null),u([d({type:Boolean})],jn.prototype,"isMaxInclusive",void 0),u([d({type:mC,json:{write:!0}})],jn.prototype,"legendOptions",void 0),u([d({type:Number,readOnly:!0,value:null,json:{read:!1,write:{overridePolicy(){return this.classBreakInfos.length!==0&&this._areClassBreaksConsecutive()?{enabled:!0}:{enabled:!1}}}}})],jn.prototype,"minValue",null),u([d({type:String,json:{write:!0}})],jn.prototype,"normalizationField",void 0),u([d({type:Number,cast:e=>yd(e),json:{write:!0}})],jn.prototype,"normalizationTotal",void 0),u([d({type:iN.apiValues,value:null,json:{type:iN.jsonValues,read:iN.read,write:iN.write}})],jn.prototype,"normalizationType",null),u([lt({classBreaks:"class-breaks"})],jn.prototype,"type",void 0),u([d({type:String,json:{write:!0}})],jn.prototype,"valueExpression",void 0),u([d({type:String,json:{write:!0}})],jn.prototype,"valueExpressionTitle",void 0),jn=JZ=u([$("esri.renderers.ClassBreaksRenderer")],jn);const jCe=jn;class pKe{constructor(t,r){this._storage=new Wte,this._storage.maxSize=t,r&&this._storage.registerRemoveFunc("",r)}put(t,r,i){this._storage.put(t,r,i,1)}pop(t){return this._storage.pop(t)}get(t){return this._storage.get(t)}clear(){this._storage.clearAll()}destroy(){this._storage.destroy()}get maxSize(){return this._storage.maxSize}set maxSize(t){this._storage.maxSize=t}}const Mue=fe.getLogger("esri.renderers.support.DictionaryLoader"),fKe={type:"CIMSimpleLineCallout",lineSymbol:{type:"CIMLineSymbol",symbolLayers:[{type:"CIMSolidStroke",width:.5,color:[0,0,0,255]}]}};class xre{constructor(t,r,i){this.config=null,this.fieldMap=null,this.url=null,this._ongoingRequests=new Map,this._symbolCache=new pKe(100),this.url=t,this.config=r,this.fieldMap=i}getSymbolFields(){return this._symbolFields}async getSymbolAsync(t,r){let i;this._dictionaryPromise||(this._dictionaryPromise=this.fetchResources(r));try{i=await this._dictionaryPromise}catch(m){if(Vi(m))return this._dictionaryPromise=null,null}const s={};if(this.fieldMap)for(const m of this._symbolFields){const g=this.fieldMap[m];if(g&&t.attributes[g]!=null){const v=""+t.attributes[g];s[m]=v}else s[m]=""}const n=i(s,r);if(!n||typeof n!="string")return null;const o=LK(n).toString(),a=this._symbolCache.get(o);if(a)return a.catch(()=>{this._symbolCache.pop(o)}),a;const l=n.split(";"),c=[],h=[];for(const m of l)if(m)if(m.includes("po:")){const g=m.substr(3).split("|");if(g.length===3){const v=g[0],w=g[1];let _=g[2];if(w==="DashTemplate")_=_.split(" ").map(T=>Number(T));else if(w==="Color"){const T=new Me(_).toRgba();_=[T[0],T[1],T[2],255*T[3]]}else _=Number(_);h.push({primitiveName:v,propertyName:w,value:_})}}else if(m.includes("|")){for(const g of m.split("|"))if(this._itemNames.has(g)){c.push(g);break}}else this._itemNames.has(m)&&c.push(m);const p=!b(t.geometry)||!t.geometry.hasZ&&t.geometry.type==="point",f=this._cimPartsToCIMSymbol(c,h,p,r);return this._symbolCache.put(o,f,1),f}async fetchResources(t){if(this._dictionaryPromise)return this._dictionaryPromise;if(!this.url)return void Mue.error("no valid URL!");const r=er(this.url+"/resources/styles/dictionary-info.json",{responseType:"json",query:{f:"json"},signal:b(t)?t.signal:null}),[{data:i}]=await Promise.all([r,Qm()]);if(!i)throw this._dictionaryPromise=null,new j("esri.renderers.DictionaryRenderer","Bad dictionary data!");const s=i.expression,n=i.authoringInfo;this._refSymbolUrlTemplate=this.url+"/"+i.cimRefTemplateUrl,this._itemNames=new Set(i.itemsNames),this._symbolFields=n.symbol;const o={};if(this.config){const l=this.config;for(const c in l)o[c]=l[c]}if(n.configuration)for(const l of n.configuration)o.hasOwnProperty(l.name)||(o[l.name]=l.value);const a=[];if(b(t)&&t.fields&&this.fieldMap)for(const l of this._symbolFields){const c=this.fieldMap[l],h=t.fields.filter(p=>p.name===c);h.length>0&&a.push({...h[0],name:l})}return this._dictionaryPromise=m6e(s,b(t)?t.spatialReference:null,a,o).then(l=>{const c={scale:0};return(h,p)=>{const f=l.repurposeFeature({geometry:null,attributes:h});return c.scale=b(p)?p.scale:void 0,l.evaluate({$feature:f,$view:c})}}).catch(l=>(Mue.error("Creating dictinoary expression failed:",l),null)),this._dictionaryPromise}async _cimPartsToCIMSymbol(t,r,i,s){const n=new Array(t.length);for(let l=0;l<t.length;l++)n[l]=this._getSymbolPart(t[l],s);const o=await Promise.all(n),a=this.fieldMap;for(const l of o)HCe(l,a);return new cR({data:this._combineSymbolParts(o,r,i)})}async _getSymbolPart(t,r){if(this._ongoingRequests.has(t))return this._ongoingRequests.get(t).then(n=>n.data);const i=this._refSymbolUrlTemplate.replace(/\{itemName\}/gi,t),s=er(i,{responseType:"json",query:{f:"json"},...r});this._ongoingRequests.set(t,s);try{return(await s).data}catch(n){throw this._ongoingRequests.delete(t),n}}_combineSymbolParts(t,r,i){if(!t||t.length===0)return null;const s={...t[0]};if(t.length>1){s.symbolLayers=[];for(const n of t){const o=n;s.symbolLayers.unshift(...o.symbolLayers)}}return i&&(s.callout=fKe),{type:"CIMSymbolReference",symbol:s,primitiveOverrides:r}}}function HCe(e,t){if(!e)return;const r=e.symbolLayers;if(!r)return;let i=r.length;for(;i--;){const s=r[i];s&&s.enable!==!1&&s.type==="CIMVectorMarker"&&mKe(s,t)}}function mKe(e,t){const r=e.markerGraphics;if(r)for(const i of r){if(!i)continue;const s=i.symbol;if(s)switch(s.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":HCe(s,t);break;case"CIMTextSymbol":s.fieldMap=t}}}const bLt=Object.freeze(Object.defineProperty({__proto__:null,DictionaryLoader:xre},Symbol.toStringTag,{value:"Module"}));var KZ;let Tp=KZ=class extends xR(R0){constructor(e){super(e),this.config=null,this.fieldMap=null,this.scaleExpression=null,this.scaleExpressionTitle=null,this.url=null,this.type="dictionary"}get _loader(){return new xre(this.url,this.config,this.fieldMap)}writeData(e,t){e&&(t.scalingExpressionInfo={expression:e,returnType:"number"})}writeVisualVariables(e,t,r,i){i!=null&&i.origin||super.writeVisualVariables(e,t,r,i)}clone(){return new KZ({config:re(this.config),scaleExpression:this.scaleExpression,scaleExpressionTitle:this.scaleExpressionTitle,fieldMap:re(this.fieldMap),url:re(this.url),visualVariables:re(this.visualVariables)})}async getSymbolAsync(e,t){return this._loader.getSymbolAsync(e,t)}async collectRequiredFields(e,t){await this.collectVVRequiredFields(e,t),this.scaleExpression&&await oc(e,t,this.scaleExpression);for(const r in this.fieldMap){const i=this.fieldMap[r];t.has(i)&&e.add(i)}}get arcadeRequired(){return!0}getSymbol(){return null}getSymbols(){return[]}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce((e,t)=>e+t.getAttributeHash(),"")}getMeshHash(){return`${this.url}-${JSON.stringify(this.fieldMap)}`}getSymbolFields(){return this._loader.getSymbolFields()}};u([d({type:xre})],Tp.prototype,"_loader",null),u([d({type:Object,json:{read:{source:"configuration"},write:{target:"configuration"}}})],Tp.prototype,"config",void 0),u([d({type:Object,json:{write:!0}})],Tp.prototype,"fieldMap",void 0),u([d({type:String,json:{read:{source:"scalingExpressionInfo.expression"},write:!0}})],Tp.prototype,"scaleExpression",void 0),u([Xe("scaleExpression")],Tp.prototype,"writeData",null),u([d({type:String,json:{read:{source:"scalingExpressionInfo.title"},write:{target:"scalingExpressionInfo.title",overridePolicy(e){return{enabled:!!e&&!!this.scaleExpression}}}}})],Tp.prototype,"scaleExpressionTitle",void 0),u([d({type:String,json:{write:!0}})],Tp.prototype,"url",void 0),u([Xe("visualVariables")],Tp.prototype,"writeVisualVariables",null),Tp=KZ=u([$("esri.renderers.DictionaryRenderer")],Tp);const gKe=Tp;var eY;const yKe=fe.getLogger("esri.renderers.support.AttributeColorInfo");let Kg=eY=class extends ye{constructor(e){super(e),this.color=null,this.field=null,this.label=null,this.valueExpression=null,this.valueExpressionTitle=null}castField(e){return e==null?e:typeof e=="function"?(yKe.error(".field: field must be a string value"),null):G$(e)}getAttributeHash(){return`${this.field}-${this.valueExpression}`}clone(){return new eY({color:this.color&&this.color.clone(),field:this.field,label:this.label,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle})}};u([d({type:Me,json:{type:[Number],write:!0}})],Kg.prototype,"color",void 0),u([d({type:String,json:{write:!0}})],Kg.prototype,"field",void 0),u([qt("field")],Kg.prototype,"castField",null),u([d({type:String,json:{write:!0}})],Kg.prototype,"label",void 0),u([d({type:String,json:{write:!0}})],Kg.prototype,"valueExpression",void 0),u([d({type:String,json:{write:!0}})],Kg.prototype,"valueExpressionTitle",void 0),Kg=eY=u([$("esri.renderers.support.AttributeColorInfo")],Kg);const qCe=Kg;var tY;let E5=tY=class extends ye{constructor(){super(...arguments),this.unit=null}clone(){return new tY({unit:this.unit})}};u([d({type:String,json:{write:!0}})],E5.prototype,"unit",void 0),E5=tY=u([$("esri.renderers.support.DotDensityLegendOptions")],E5);const vKe=E5;var rY;let qa=rY=class extends xR(R0){constructor(e){super(e),this.attributes=null,this.backgroundColor=new Me([0,0,0,0]),this.blendDots=!0,this.dotBlendingEnabled=!0,this.dotShape="square",this.dotSize=1,this.legendOptions=null,this.outline=new cu,this.dotValue=null,this.referenceDotValue=null,this.referenceScale=null,this.seed=1,this.type="dot-density"}calculateDotValue(e){if(this.referenceScale==null)return this.dotValue;const t=e/this.referenceScale*this.dotValue;return t<1?1:t}getSymbol(){return new mg({outline:this.outline})}async getSymbolAsync(){return this.getSymbol()}getSymbols(){return[this.getSymbol()]}getAttributeHash(){return this.attributes&&this.attributes.reduce((e,t)=>e+t.getAttributeHash(),"")}getMeshHash(){return JSON.stringify(this.outline)}clone(){return new rY({attributes:re(this.attributes),backgroundColor:re(this.backgroundColor),dotBlendingEnabled:re(this.dotBlendingEnabled),dotShape:re(this.dotShape),dotSize:re(this.dotSize),dotValue:re(this.dotValue),legendOptions:re(this.legendOptions),outline:re(this.outline),referenceScale:re(this.referenceScale),visualVariables:re(this.visualVariables),authoringInfo:this.authoringInfo&&this.authoringInfo.clone()})}getControllerHash(){return`${this.attributes.map(e=>e.field||e.valueExpression||"")}-${this.outline&&JSON.stringify(this.outline.toJSON())||""}`}async collectRequiredFields(e,t){await this.collectVVRequiredFields(e,t);for(const r of this.attributes)r.valueExpression&&await oc(e,t,r.valueExpression),r.field&&e.add(r.field)}};u([d({type:[qCe],json:{write:!0}})],qa.prototype,"attributes",void 0),u([d({type:Me,json:{write:!0}})],qa.prototype,"backgroundColor",void 0),u([d({type:Boolean}),We("dotBlendingEnabled")],qa.prototype,"blendDots",void 0),u([d({type:Boolean,json:{write:!0}})],qa.prototype,"dotBlendingEnabled",void 0),u([d({type:String,json:{write:!1}})],qa.prototype,"dotShape",void 0),u([d({type:Number,json:{write:!0,origins:{"web-map":{write:!1},"web-scene":{write:!1}}}})],qa.prototype,"dotSize",void 0),u([d({type:vKe,json:{write:!0}})],qa.prototype,"legendOptions",void 0),u([d({type:cu,json:{default:null,write:!0}})],qa.prototype,"outline",void 0),u([d({type:Number,json:{write:!0}})],qa.prototype,"dotValue",void 0),u([d({type:Number}),We("dotValue")],qa.prototype,"referenceDotValue",void 0),u([d({type:Number,json:{write:!0}})],qa.prototype,"referenceScale",void 0),u([d({type:Number,json:{write:!0}})],qa.prototype,"seed",void 0),u([lt({dotDensity:"dot-density"})],qa.prototype,"type",void 0),qa=rY=u([$("esri.renderers.DotDensityRenderer")],qa);const _Ke=qa;let D2=class extends au(ye){constructor(){super(...arguments),this.minLabel=null,this.maxLabel=null,this.title=null}};u([d({type:String,json:{write:!0}})],D2.prototype,"minLabel",void 0),u([d({type:String,json:{write:!0}})],D2.prototype,"maxLabel",void 0),u([d({type:String,json:{write:!0}})],D2.prototype,"title",void 0),D2=u([$("esri.renderers.support.HeatmapLegendOptions")],D2);const Tre=2.4;function bKe(e){return ac(e*Tre)}function wKe(e){return yr(e)/Tre}function xKe(e,t,r,i){let{color:s,ratio:n}=t,{color:o,ratio:a}=r;a===n&&(a===1?n-=1e-6:a+=1e-6);const l=Le((i-n)/(a-n),0,1);Kz(e,s.toArray(),o.toArray(),l)}function wLt(e){const r=new Uint8ClampedArray(2048);if(e=e.filter(({ratio:a})=>a>=0&&a<=1).sort((a,l)=>a.ratio-l.ratio).map(({color:a,ratio:l})=>({color:a,ratio:Math.max(l,.001)})),e.length<1)return r;let i=e[0],s=e[0],n=1;const o=Zt();for(let a=0;a<512;a++){const l=(a+.5)/512;for(;l>s.ratio&&n<e.length;)i=s,s=e[n++];xKe(o,i,s,l),r.set(o,4*a)}return r}function xLt(e,t,r,i){const{radius:s,fieldOffset:n,field:o}=t,a=Math.round(yr(s)),l=new Float64Array(r*i);let c,h=Number.NEGATIVE_INFINITY;const p=SKe(o,n),f=new Set;for(const m of e){const g=m.getCursor();for(;g.next();){const v=g.getObjectId();if(f.has(v))continue;f.add(v);const w=g.readLegacyPointGeometry(),_=128;if(w.x<-_||w.x>=r+_||w.y<-_||w.y>i+_)continue;const T=+p(g),x=Math.max(0,Math.round(w.x)-a),E=Math.max(0,Math.round(w.y)-a),C=Math.min(i,Math.round(w.y)+a),A=Math.min(r,Math.round(w.x)+a);for(let P=E;P<C;P++)for(let I=x;I<A;I++){const L=P*r+I,k=TKe(w.x-I,w.y-P,a);c=l[L]+=k*T,c>h&&(h=c)}}}return{matrix:l.buffer,max:h}}function TKe(e,t,r){const i=Math.sqrt(e**2+t**2)/r;return i>1?0:3/(Math.PI*r**2)*(1-i**2)**2}function TLt(e,t){return typeof e=="function"?e:e?typeof t=="string"?r=>-1*+r[e]:r=>+r[e]+t:()=>1}function SKe(e,t){return e!=null?typeof t=="string"?r=>-1*+r.readAttribute(e):r=>+r.readAttribute(e)+t:r=>1}var iY;const EKe=fe.getLogger("esri.renderers.HeatmapRenderer");function Pue(e){if(e!=null){const{maxDensity:t,minDensity:r,radius:i}=e;if(t!=null||r!=null||i!=null){const{blurRadius:s,maxPixelIntensity:n,minPixelIntensity:o,...a}=e;return a}}return e}let mo=iY=class extends R0{constructor(e){super(e),this.authoringInfo=null,this.colorStops=[new eP({ratio:0,color:new Me("rgba(255, 140, 0, 0)")}),new eP({ratio:.75,color:new Me("rgba(255, 140, 0, 1)")}),new eP({ratio:.9,color:new Me("rgba(255, 0,   0, 1)")})],this.field=null,this.fieldOffset=0,this.legendOptions=null,this.maxDensity=.04,this.minDensity=0,this.radius=18,this.referenceScale=0,this.type="heatmap",this.valueExpression=null,this.valueExpressionTitle=null,this._warnedProps={blurRadius:!1,maxPixelIntensity:!1,minPixelIntensity:!1}}normalizeCtorArgs(e){return Pue(e)}get blurRadius(){return wKe(this.radius)}set blurRadius(e){const t=this.maxPixelIntensity,r=this.minPixelIntensity;this._set("radius",bKe(e)),this._warnAboutDeprecatedGaussianBlurProp("blurRadius","radius"),this._set("maxDensity",t*this._pixelIntensityToDensity),this._set("minDensity",r*this._pixelIntensityToDensity)}get maxPixelIntensity(){return this.maxDensity/this._pixelIntensityToDensity}set maxPixelIntensity(e){this._set("maxDensity",e*this._pixelIntensityToDensity),this._warnAboutDeprecatedGaussianBlurProp("maxPixelIntensity","maxDensity")}get minPixelIntensity(){return this.minDensity/this._pixelIntensityToDensity}set minPixelIntensity(e){this._set("minDensity",e*this._pixelIntensityToDensity),this._warnAboutDeprecatedGaussianBlurProp("minPixelIntensity","minDensity")}get _pixelIntensityToDensity(){return 24/(Tre**2*this.blurRadius**4)}_warnAboutDeprecatedGaussianBlurProp(e,t){this._warnedProps[e]||Pa(this).getDefaultOrigin()==="user"&&(this._warnedProps[e]=!0,iR(()=>{S5e(EKe,e,{replacement:`${String(t)} (suggested value: ${this._get(t)})`,version:"4.24"})}))}read(e,t){e=Pue(e),super.read(e,t)}getSymbol(){const e=this.referenceScale!==0?5:1,t=Math.min(this.radius*e,ac(256));return new eu({size:t})}async getSymbolAsync(){return this.getSymbol()}getSymbols(){return[this.getSymbol()]}async collectRequiredFields(e,t){const r=this.field,i=this.valueExpression;r&&typeof r=="string"&&await $d(e,t,r),i&&typeof i=="string"&&await oc(e,t,i)}getAttributeHash(){return null}getMeshHash(){return`${JSON.stringify(this.colorStops)}.${this.blurRadius}.${this.field}`}clone(){return new iY({colorStops:re(this.colorStops),field:this.field,legendOptions:re(this.legendOptions),maxDensity:this.maxDensity,minDensity:this.minDensity,radius:this.radius,referenceScale:this.referenceScale,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle})}};u([d({type:ACe,json:{write:!1}})],mo.prototype,"authoringInfo",void 0),u([d({type:Number,json:{origins:{"portal-item":{write:!0},"web-map":{write:!0}}}})],mo.prototype,"blurRadius",null),u([d({type:[eP],json:{write:!0}})],mo.prototype,"colorStops",void 0),u([d({type:String,json:{write:!0}})],mo.prototype,"field",void 0),u([d({type:Number,json:{write:{overridePolicy:(e,t,r)=>({enabled:r==null})},origins:{"web-scene":{write:!1}}}})],mo.prototype,"fieldOffset",void 0),u([d({type:D2,json:{write:!0}})],mo.prototype,"legendOptions",void 0),u([d({type:Number,json:{write:!0}})],mo.prototype,"maxDensity",void 0),u([d({type:Number,json:{origins:{"portal-item":{write:!0},"web-map":{write:!0}}}})],mo.prototype,"maxPixelIntensity",null),u([d({type:Number,json:{write:!0}})],mo.prototype,"minDensity",void 0),u([d({type:Number,json:{origins:{"portal-item":{write:!0},"web-map":{write:!0}}}})],mo.prototype,"minPixelIntensity",null),u([d({type:Number,cast:si,json:{write:!0}})],mo.prototype,"radius",void 0),u([d({type:Number,range:{min:0},json:{default:0,write:!0}})],mo.prototype,"referenceScale",void 0),u([lt({heatmap:"heatmap"})],mo.prototype,"type",void 0),u([d({type:String,json:{write:!0,origins:{"web-document":{write:!1},"portal-item":{write:!1}}}})],mo.prototype,"valueExpression",void 0),u([d({type:String})],mo.prototype,"valueExpressionTitle",void 0),u([d({readOnly:!0})],mo.prototype,"_pixelIntensityToDensity",null),mo=iY=u([$("esri.renderers.HeatmapRenderer")],mo);const WCe=mo;let Jw=class extends au(ye){constructor(){super(...arguments),this.color=new Me([0,0,0,0]),this.label=null,this.threshold=0}};u([d({type:Me,json:{write:!0}})],Jw.prototype,"color",void 0),u([d({type:String,json:{write:!0}})],Jw.prototype,"label",void 0),u([d({type:Number,range:{min:0,max:1},json:{write:!0}})],Jw.prototype,"threshold",void 0),Jw=u([$("esri.renderers.support.OthersCategory")],Jw);let C5=class extends au(ye){constructor(){super(...arguments),this.title=null}};u([d({type:String,json:{write:!0}})],C5.prototype,"title",void 0),C5=u([$("esri.renderers.support.PieChartLegendOptions")],C5);let Au=class extends xR(au(R0)){constructor(e){super(e),this.attributes=null,this.backgroundFillSymbol=null,this.defaultColor=new Me([0,0,0,0]),this.defaultLabel=null,this.holePercentage=0,this.othersCategory=new Jw,this.legendOptions=null,this.outline=null,this.size=12,this.type="pie-chart"}getSymbol(){var e;return new eu({size:this.size?this.size/2+(((e=this.outline)==null?void 0:e.width)||0):0})}async getSymbolAsync(){return this.getSymbol()}getSymbols(){return[this.getSymbol(),this.backgroundFillSymbol]}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce((e,t)=>e+t.getAttributeHash(),"")}getMeshHash(){return this.getSymbols().reduce((e,t)=>e+JSON.stringify(t),"")}async collectRequiredFields(e,t){await this.collectVVRequiredFields(e,t);for(const r of this.attributes)r.valueExpression&&await oc(e,t,r.valueExpression),r.field&&e.add(r.field)}};u([d({type:[qCe],json:{write:!0}})],Au.prototype,"attributes",void 0),u([d({type:mg,json:{default:null,write:!0}})],Au.prototype,"backgroundFillSymbol",void 0),u([d({type:Me,json:{write:!0}})],Au.prototype,"defaultColor",void 0),u([d({type:String,json:{write:!0}})],Au.prototype,"defaultLabel",void 0),u([d({type:Number,range:{min:0,max:1},json:{write:!0}})],Au.prototype,"holePercentage",void 0),u([d({type:Jw,json:{write:!0}})],Au.prototype,"othersCategory",void 0),u([d({type:C5,json:{write:!0}})],Au.prototype,"legendOptions",void 0),u([d({type:cu,json:{default:null,write:!0}})],Au.prototype,"outline",void 0),u([d({type:Number,cast:si,json:{write:!0}})],Au.prototype,"size",void 0),u([lt({pieChart:"pie-chart"})],Au.prototype,"type",void 0),Au=u([$("esri.renderers.PieChartRenderer")],Au);const CKe=Au;var sY;let gw=sY=class extends xR(R0){constructor(e){super(e),this.description=null,this.label=null,this.symbol=null,this.type="simple"}async collectRequiredFields(e,t){await Promise.all([this.collectSymbolFields(e,t),this.collectVVRequiredFields(e,t)])}async collectSymbolFields(e,t){await Promise.all(this.getSymbols().map(r=>r.collectRequiredFields(e,t)))}getSymbol(e,t){return this.symbol}async getSymbolAsync(e,t){return this.symbol}getSymbols(){return this.symbol?[this.symbol]:[]}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce((e,t)=>e+t.getAttributeHash(),"")}getMeshHash(){return this.getSymbols().reduce((e,t)=>e+JSON.stringify(t),"")}get arcadeRequired(){return this.arcadeRequiredForVisualVariables}clone(){return new sY({description:this.description,label:this.label,symbol:this.symbol&&this.symbol.clone(),visualVariables:re(this.visualVariables),authoringInfo:this.authoringInfo&&this.authoringInfo.clone()})}};u([d({type:String,json:{write:!0}})],gw.prototype,"description",void 0),u([d({type:String,json:{write:!0}})],gw.prototype,"label",void 0),u([d(cL)],gw.prototype,"symbol",void 0),u([lt({simple:"simple"})],gw.prototype,"type",void 0),gw=sY=u([$("esri.renderers.SimpleRenderer")],gw);const Sre=gw,AKe=["esri.Color","esri.portal.Portal","esri.symbols.support.Symbol3DAnchorPosition2D","esri.symbols.support.Symbol3DAnchorPosition3D"];function nY(e){return e instanceof xe}function Iue(e){return e instanceof ot?Object.keys(e.items):nY(e)?Pa(e).keys():e?Object.keys(e):[]}function sN(e,t){return e instanceof ot?e.items[t]:e[t]}function RKe(e,t){return!(!Array.isArray(e)||!Array.isArray(t))&&e.length!==t.length}function nP(e){return e?e.declaredClass:null}function XCe(e,t){const r=e.diff;if(r&&typeof r=="function")return r(e,t);const i=Iue(e),s=Iue(t);if(i.length===0&&s.length===0)return;if(!i.length||!s.length||RKe(e,t))return{type:"complete",oldValue:e,newValue:t};const n=s.filter(p=>!i.includes(p)),o=i.filter(p=>!s.includes(p)),a=i.filter(p=>s.includes(p)&&sN(e,p)!==sN(t,p)).concat(n,o).sort(),l=nP(e);if(l&&AKe.includes(l)&&a.length)return{type:"complete",oldValue:e,newValue:t};let c;const h=nY(e)&&nY(t);for(const p of a){const f=sN(e,p),m=sN(t,p);let g;if((h||typeof f!="function"&&typeof m!="function")&&f!==m&&(f!=null||m!=null)){if(r&&r[p]&&typeof r[p]=="function")g=r[p](f,m);else if(f instanceof Date&&m instanceof Date){if(f.getTime()===m.getTime())continue;g={type:"complete",oldValue:f,newValue:m}}else g=typeof f=="object"&&typeof m=="object"&&nP(f)===nP(m)?XCe(f,m):{type:"complete",oldValue:f,newValue:m};b(g)&&(b(c)?c.diff[p]=g:c={type:"partial",diff:{[p]:g}})}}return c}function OKe(e,t){if(R(e))return!1;const r=t.split(".");let i=e;for(const s of r){if(i.type==="complete")return!0;if(i.type!=="partial")return!1;{const n=i.diff[s];if(!n)return!1;i=n}}return!0}function SLt(e,t){for(const r of t)if(OKe(e,r))return!0;return!1}function MKe(e,t){if(!(typeof e=="function"||typeof t=="function"||R(e)&&R(t)))return R(e)||R(t)||typeof e=="object"&&typeof t=="object"&&nP(e)!==nP(t)?{type:"complete",oldValue:e,newValue:t}:XCe(e,t)}function nN(e){if(R(e))return!0;switch(e.type){case"complete":return!1;case"collection":{const t=e;for(const r of t.added)if(!nN(r))return!1;for(const r of t.removed)if(!nN(r))return!1;for(const r of t.changed)if(!nN(r))return!1;return!0}case"partial":for(const t in e.diff)if(!nN(e.diff[t]))return!1;return!0}}var oY;let zv=oY=class extends ye{constructor(e){super(e),this.description=null,this.label=null,this.symbol=null,this.value=null}castValue(e){return e==null||typeof e=="string"||typeof e=="number"?e:`${e}`}clone(){return new oY({value:this.value,description:this.description,label:this.label,symbol:this.symbol?this.symbol.clone():null})}getMeshHash(){const e=JSON.stringify(this.symbol&&this.symbol.toJSON());return`${this.value}.${e}`}};u([d({type:String,json:{write:!0}})],zv.prototype,"description",void 0),u([d({type:String,json:{write:!0}})],zv.prototype,"label",void 0),u([d(cL)],zv.prototype,"symbol",void 0),u([d({json:{type:String,write:{writer:(e,t)=>{t.value=e==null?void 0:e.toString()}}}})],zv.prototype,"value",void 0),u([qt("value")],zv.prototype,"castValue",null),zv=oY=u([$("esri.renderers.support.UniqueValueInfo")],zv);const gV=zv,PKe=()=>!!he("enable-feature:force-wosr"),ELt=()=>!!he("enable-feature:direct-3d-object-feature-layer-display"),$G={};async function IKe(e,t){try{return{data:(await Ere(e,t)).data,baseUrl:eee(e),styleUrl:e}}catch(r){return ah(r),null}}function $Ke(e,t,r){const i=b(t.portal)?t.portal:Sn.getDefault();let s;const n=`${i.url} - ${i.user&&i.user.username} - ${e}`;return $G[n]||($G[n]=LKe(e,i,r).then(o=>(s=o,o.fetchData())).then(o=>({data:o,baseUrl:s.itemUrl,styleName:e}))),$G[n]}function LKe(e,t,r){return t.load(r).then(()=>{const i=new Oy({disableExtraQuery:!0,query:`owner:${$ue} AND type:${Lue} AND typekeywords:"${e}"`});return t.queryItems(i,r)}).then(({results:i})=>{let s=null;const n=e.toLowerCase();if(i&&Array.isArray(i)){for(const o of i)if(o.typeKeywords.some(a=>a.toLowerCase()===n)&&o.type===Lue&&o.owner===$ue){s=o;break}}if(!s)throw new j("symbolstyleutils:style-not-found",`The style '${e}' could not be found`,{styleName:e});return s.load(r)})}function ZCe(e,t,r){return e.styleUrl?IKe(e.styleUrl,r):e.styleName?$Ke(e.styleName,t,r):Promise.reject(new j("symbolstyleutils:style-url-and-name-missing","Either styleUrl or styleName is required to resolve a style"))}function YCe(e){return e===null||e.type==="CIMSymbolReference"?e:{type:"CIMSymbolReference",symbol:e}}function DKe(e,t){if(t==="cimRef")return e.cimRef;if(e.formatInfos&&!PKe()){for(const r of e.formatInfos)if(r.type==="gltf")return r.href}return e.webRef}function Ere(e,t){const r={responseType:"json",query:{f:"json"},...t};return er(Id(e),r)}const $ue="esri_en",Lue="Style",NKe="https://cdn.arcgis.com/sharing/rest/content/items/220936cc6ed342c9937abd8f180e7d1e/resources/styles/cim/{SymbolName}.json?f=json";var ZM;const hb=fe.getLogger("esri.renderers.UniqueValueRenderer"),FKe=en(gV);let Us=ZM=class extends xR(R0){constructor(e){super(e),this._valueInfoMap={},this._isDefaultSymbolDerived=!1,this.type="unique-value",this.backgroundFillSymbol=null,this.field=null,this.field2=null,this.field3=null,this.valueExpression=null,this.valueExpressionTitle=null,this.legendOptions=null,this.defaultLabel=null,this.fieldDelimiter=null,this.portal=null,this.styleOrigin=null,this.diff={uniqueValueInfos(t,r){if(!t&&!r)return;if(!t||!r)return{type:"complete",oldValue:t,newValue:r};let i=!1;const s={type:"collection",added:[],removed:[],changed:[],unchanged:[]};for(let n=0;n<r.length;n++){const o=t.find(a=>a.value===r[n].value);o?MKe(o,r[n])?(s.changed.push({type:"complete",oldValue:o,newValue:r[n]}),i=!0):s.unchanged.push({oldValue:o,newValue:r[n]}):(s.added.push(r[n]),i=!0)}for(let n=0;n<t.length;n++)r.find(o=>o.value===t[n].value)||(s.removed.push(t[n]),i=!0);return i?s:void 0}},this._set("uniqueValueInfos",[])}get _cache(){return{compiledFunc:null}}castField(e){return e==null||typeof e=="function"?e:G$(e)}writeField(e,t,r,i){typeof e=="string"?t[r]=e:i&&i.messages?i.messages.push(new j("property:unsupported","UniqueValueRenderer.field set to a function cannot be written to JSON")):hb.error(".field: cannot write field to JSON since it's not a string value")}set defaultSymbol(e){this._isDefaultSymbolDerived=!1,this._set("defaultSymbol",e)}readPortal(e,t,r){return r.portal||Sn.getDefault()}readStyleOrigin(e,t,r){if(t.styleName)return Object.freeze({styleName:t.styleName});if(t.styleUrl){const i=d0(t.styleUrl,r);return Object.freeze({styleUrl:i})}}writeStyleOrigin(e,t,r,i){e.styleName?t.styleName=e.styleName:e.styleUrl&&(t.styleUrl=p0(e.styleUrl,i))}set uniqueValueInfos(e){this.styleOrigin?hb.error("#uniqueValueInfos=","Cannot modify unique value infos of a UniqueValueRenderer created from a web style"):(this._set("uniqueValueInfos",e),this._updateValueInfoMap())}addUniqueValueInfo(e,t){if(this.styleOrigin)return void hb.error("#addUniqueValueInfo()","Cannot modify unique value infos of a UniqueValueRenderer created from a web style");let r;r=typeof e=="object"?FKe(e):new gV({value:e,symbol:Oxe(t)}),this.uniqueValueInfos.push(r),this._valueInfoMap[r.value]=r}removeUniqueValueInfo(e){if(this.styleOrigin)hb.error("#removeUniqueValueInfo()","Cannot modify unique value infos of a UniqueValueRenderer created from a web style");else for(let t=0;t<this.uniqueValueInfos.length;t++)if(this.uniqueValueInfos[t].value===e+""){delete this._valueInfoMap[e],this.uniqueValueInfos.splice(t,1);break}}async getUniqueValueInfo(e,t){let r=t;return this.valueExpression&&(R(t)||R(t.arcade))&&(r={...r,arcade:await Qm()}),this._getUniqueValueInfo(e,r)}getSymbol(e,t){if(this.valueExpression&&(R(t)||R(t.arcade)))return void hb.error("#getSymbol()","Please use getSymbolAsync if valueExpression is used");const r=this._getUniqueValueInfo(e,t);return r&&r.symbol||this.defaultSymbol}async getSymbolAsync(e,t){let r=t;if(this.valueExpression&&(R(r)||R(r.arcade))){const s=await Qm(),{arcadeUtils:n}=s;n.hasGeometryOperations(this.valueExpression)&&await n.enableGeometryOperations(),r={...r,arcade:s}}const i=this._getUniqueValueInfo(e,r);return i&&i.symbol||this.defaultSymbol}getSymbols(){const e=[];for(const t of this.uniqueValueInfos)t.symbol&&e.push(t.symbol);return this.defaultSymbol&&e.push(this.defaultSymbol),e}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce((e,t)=>e+t.getAttributeHash(),"")}getMeshHash(){return`${JSON.stringify(this.backgroundFillSymbol)}.${JSON.stringify(this.defaultSymbol)}.${this.uniqueValueInfos.reduce((e,t)=>e+t.getMeshHash(),"")}.${`${this.field}.${this.field2}.${this.field3}.${this.fieldDelimiter}`}.${this.valueExpression}`}clone(){const e=new ZM({field:this.field,field2:this.field2,field3:this.field3,defaultLabel:this.defaultLabel,defaultSymbol:re(this.defaultSymbol),valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,fieldDelimiter:this.fieldDelimiter,visualVariables:re(this.visualVariables),legendOptions:re(this.legendOptions),authoringInfo:this.authoringInfo&&this.authoringInfo.clone(),backgroundFillSymbol:re(this.backgroundFillSymbol)});this._isDefaultSymbolDerived&&(e._isDefaultSymbolDerived=!0),e._set("portal",this.portal);const t=re(this.uniqueValueInfos);return this.styleOrigin&&(e._set("styleOrigin",Object.freeze(re(this.styleOrigin))),Object.freeze(t)),e._set("uniqueValueInfos",t),e._updateValueInfoMap(),e}get arcadeRequired(){return this.arcadeRequiredForVisualVariables||!!this.valueExpression}async collectRequiredFields(e,t){const r=[this.collectVVRequiredFields(e,t),this.collectSymbolFields(e,t)];await Promise.all(r)}async collectSymbolFields(e,t){const r=[...this.getSymbols().map(i=>i.collectRequiredFields(e,t)),oc(e,t,this.valueExpression)];$d(e,t,this.field),$d(e,t,this.field2),$d(e,t,this.field3),await Promise.all(r)}populateFromStyle(){return ZCe(this.styleOrigin,{portal:this.portal}).then(e=>{const t=[];return this._valueInfoMap={},e&&e.data&&Array.isArray(e.data.items)&&e.data.items.forEach(r=>{const i=new YT({styleUrl:e.styleUrl,styleName:e.styleName,portal:this.portal,name:r.name});this.defaultSymbol||r.name!==e.data.defaultItem||(this.defaultSymbol=i,this._isDefaultSymbolDerived=!0);const s=new gV({value:r.name,symbol:i});t.push(s),this._valueInfoMap[r.name]=s}),this._set("uniqueValueInfos",Object.freeze(t)),!this.defaultSymbol&&this.uniqueValueInfos.length&&(this.defaultSymbol=this.uniqueValueInfos[0].symbol,this._isDefaultSymbolDerived=!0),this})}_updateValueInfoMap(){this._valueInfoMap={},this.uniqueValueInfos.forEach(e=>this._valueInfoMap[e.value+""]=e)}_getUniqueValueInfo(e,t){return this.valueExpression?this._getUnqiueValueInfoForExpression(e,t):this._getUnqiueValueInfoForFields(e)}_getUnqiueValueInfoForExpression(e,t){const{viewingMode:r,scale:i,spatialReference:s,arcade:n}=_t(t,{});let o=this._cache.compiledFunc;const a=n.arcadeUtils;if(!o){const c=a.createSyntaxTree(this.valueExpression);o=a.createFunction(c),this._cache.compiledFunc=o}const l=a.executeFunction(o,a.createExecContext(e,a.getViewInfo({viewingMode:r,scale:i,spatialReference:s})));return this._valueInfoMap[l+""]}_getUnqiueValueInfoForFields(e){const t=this.field,r=e.attributes;let i;if(typeof t!="function"&&this.field2){const s=this.field2,n=this.field3,o=[];t&&o.push(r[t]),s&&o.push(r[s]),n&&o.push(r[n]),i=o.join(this.fieldDelimiter||"")}else typeof t=="function"?i=t(e):t&&(i=r[t]);return this._valueInfoMap[i+""]}static fromPortalStyle(e,t){const r=new ZM(t&&t.properties);r._set("styleOrigin",Object.freeze({styleName:e})),r._set("portal",t&&t.portal||Sn.getDefault());const i=r.populateFromStyle();return i.catch(s=>{hb.error(`#fromPortalStyle('${e}'[, ...])`,"Failed to create unique value renderer from style name",s)}),i}static fromStyleUrl(e,t){const r=new ZM(t&&t.properties);r._set("styleOrigin",Object.freeze({styleUrl:e}));const i=r.populateFromStyle();return i.catch(s=>{hb.error(`#fromStyleUrl('${e}'[, ...])`,"Failed to create unique value renderer from style URL",s)}),i}};u([d({readOnly:!0})],Us.prototype,"_cache",null),u([lt({uniqueValue:"unique-value"})],Us.prototype,"type",void 0),u([d(BCe)],Us.prototype,"backgroundFillSymbol",void 0),u([d({json:{type:String,read:{source:"field1"},write:{target:"field1"}}})],Us.prototype,"field",void 0),u([qt("field")],Us.prototype,"castField",null),u([Xe("field")],Us.prototype,"writeField",null),u([d({type:String,json:{write:!0}})],Us.prototype,"field2",void 0),u([d({type:String,json:{write:!0}})],Us.prototype,"field3",void 0),u([d({type:String,json:{write:!0}})],Us.prototype,"valueExpression",void 0),u([d({type:String,json:{write:!0}})],Us.prototype,"valueExpressionTitle",void 0),u([d({type:mC,json:{write:!0}})],Us.prototype,"legendOptions",void 0),u([d({type:String,json:{write:!0}})],Us.prototype,"defaultLabel",void 0),u([d(l1e({...cL},{json:{write:{overridePolicy(){return{enabled:!this._isDefaultSymbolDerived}}},origins:{"web-scene":{write:{overridePolicy(){return{enabled:!this._isDefaultSymbolDerived}}}}}}}))],Us.prototype,"defaultSymbol",null),u([d({type:String,json:{write:!0}})],Us.prototype,"fieldDelimiter",void 0),u([d({type:Sn,readOnly:!0})],Us.prototype,"portal",void 0),u([$e("portal",["styleName"])],Us.prototype,"readPortal",null),u([d({readOnly:!0,json:{write:{enabled:!1,overridePolicy:()=>({enabled:!0})}}})],Us.prototype,"styleOrigin",void 0),u([$e("styleOrigin",["styleName","styleUrl"])],Us.prototype,"readStyleOrigin",null),u([Xe("styleOrigin",{styleName:{type:String},styleUrl:{type:String}})],Us.prototype,"writeStyleOrigin",null),u([d({type:[gV],json:{write:{overridePolicy(){return this.styleOrigin?{enabled:!1}:{enabled:!0}}}}})],Us.prototype,"uniqueValueInfos",null),Us=ZM=u([$("esri.renderers.UniqueValueRenderer")],Us);const Cre=Us,uL={key:"type",base:R0,typeMap:{heatmap:WCe,simple:Sre,"unique-value":Cre,"class-breaks":jCe,"dot-density":_Ke,dictionary:gKe,"pie-chart":CKe},errorContext:"renderer"},Are={key:"type",base:R0,typeMap:{simple:Sre,"unique-value":Cre,"class-breaks":jCe,heatmap:WCe},errorContext:"renderer"};function kKe(e,t){return QCe(e,null,t)}const UKe=sR({types:uL});function QCe(e,t,r){return e?e&&(e.styleName||e.styleUrl)&&e.type!=="uniqueValue"?(r&&r.messages&&r.messages.push(new ic("renderer:unsupported","Only UniqueValueRenderer can be referenced from a web style, but found '"+e.type+"'",{definition:e,context:r})),null):UKe(e,t,r):null}class Rre{constructor(){this._propertyOriginMap=new Map,this._originStores=new Array(wq),this._values=new Map,this.multipleOriginsSupported=!0}clone(t){const r=new Rre,i=this._originStores[Bt.DEFAULTS];i&&i.forEach((s,n)=>{r.set(n,re(s),Bt.DEFAULTS)});for(let s=Bt.SERVICE;s<wq;s++){const n=this._originStores[s];n&&n.forEach((o,a)=>{t&&t.has(a)||r.set(a,re(o),s)})}return r}get(t,r){const i=r===void 0?this._values:this._originStores[r];return i?i.get(t):void 0}keys(t){const r=t==null?this._values:this._originStores[t];return r?[...r.keys()]:[]}set(t,r,i=Bt.USER){let s=this._originStores[i];if(s||(s=new Map,this._originStores[i]=s),s.set(t,r),!this._values.has(t)||this._propertyOriginMap.get(t)<=i){const n=this._values.get(t);return this._values.set(t,r),this._propertyOriginMap.set(t,i),n!==r}return!1}delete(t,r=Bt.USER){const i=this._originStores[r];if(!i)return;const s=i.get(t);if(i.delete(t),this._values.has(t)&&this._propertyOriginMap.get(t)===r){this._values.delete(t);for(let n=r-1;n>=0;n--){const o=this._originStores[n];if(o&&o.has(t)){this._values.set(t,o.get(t)),this._propertyOriginMap.set(t,n);break}}}return s}has(t,r){const i=r===void 0?this._values:this._originStores[r];return!!i&&i.has(t)}revert(t,r){for(;r>0&&!this.has(t,r);)--r;const i=this._originStores[r],s=i&&i.get(t),n=this._values.get(t);return this._values.set(t,s),this._propertyOriginMap.set(t,r),n!==s}originOf(t){return this._propertyOriginMap.get(t)||Bt.DEFAULTS}forEach(t){this._values.forEach(t)}}const JCe=e=>{let t=class extends e{constructor(...r){super(...r);const i=Pa(this),s=i.store,n=new Rre;i.store=n,W1e(i,s,n)}read(r,i){Z1e(this,r,i)}getAtOrigin(r,i){const s=LG(this),n=Dy(i);if(typeof r=="string")return s.get(r,n);const o={};return r.forEach(a=>{o[a]=s.get(a,n)}),o}originOf(r){return aU(this.originIdOf(r))}originIdOf(r){return LG(this).originOf(r)}revert(r,i){const s=LG(this),n=Dy(i),o=Pa(this);let a;a=typeof r=="string"?r==="*"?s.keys(n):[r]:r,a.forEach(l=>{o.invalidate(l),s.revert(l,n),o.commit(l)})}};return t=u([$("esri.core.ReadOnlyMultiOriginJSONSupport")],t),t};function LG(e){return Pa(e).store}let Due=class extends JCe(xe){};Due=u([$("esri.core.ReadOnlyMultiOriginJSONSupport")],Due);const VKe=e=>{let t=class extends e{constructor(...r){super(...r)}clear(r,i="user"){return DG(this).delete(r,Dy(i))}write(r={},i){return Q1e(this,r=r||{},i),r}setAtOrigin(r,i,s){Pa(this).setAtOrigin(r,i,Dy(s))}removeOrigin(r){const i=DG(this),s=Dy(r),n=i.keys(s);for(const o of n)i.originOf(o)===s&&i.set(o,i.get(o,s),Bt.USER)}updateOrigin(r,i){const s=DG(this),n=Dy(i),o=this.get(r);for(let a=n+1;a<wq;++a)s.delete(r,a);s.set(r,o,n)}toJSON(r){return this.write({},r)}};return t=u([$("esri.core.WriteableMultiOriginJSONSupport")],t),t.prototype.toJSON.isDefaultToJSON=!0,t};function DG(e){return Pa(e).store}const tB=e=>{let t=class extends VKe(JCe(e)){constructor(...r){super(...r)}};return t=u([$("esri.core.MultiOriginJSONSupport")],t),t};let Nue=class extends tB(xe){};Nue=u([$("esri.core.MultiOriginJSONSupport")],Nue);async function zKe(e,t){const{WhereClause:r}=await ie(()=>import("./WhereClause.c395dc79.js"),[],import.meta.url);return r.create(e,t)}function KCe(e,t){return b(e)?b(t)?`(${e}) AND (${t})`:e:t}var aY;let yw=aY=class extends ye{constructor(e){super(e),this.expression=null,this.name=null,this.returnType="boolean",this.title=null}clone(){return new aY({name:this.name,title:this.title,expression:this.expression,returnType:this.returnType})}};u([d({type:String,json:{write:!0}})],yw.prototype,"expression",void 0),u([d({type:String,json:{write:!0}})],yw.prototype,"name",void 0),u([d({type:["boolean","date","number","string"],json:{write:!0}})],yw.prototype,"returnType",void 0),u([d({type:String,json:{write:!0}})],yw.prototype,"title",void 0),yw=aY=u([$("esri.form.ExpressionInfo")],yw);const BKe=yw;let vw=class extends ye{constructor(e){super(e),this.description=null,this.label=null,this.type=null,this.visibilityExpression=null}};u([d({type:String,json:{write:!0}})],vw.prototype,"description",void 0),u([d({type:String,json:{write:!0}})],vw.prototype,"label",void 0),u([d()],vw.prototype,"type",void 0),u([d({type:String,json:{write:!0}})],vw.prototype,"visibilityExpression",void 0),vw=u([$("esri.form.elements.Element")],vw);const bA=vw;var lY;let A5=lY=class extends ye{constructor(e){super(e),this.type=null}clone(){return new lY({type:this.type})}};u([d({type:["attachment","audio","document","image","signature","video"],json:{write:!0}})],A5.prototype,"type",void 0),A5=lY=u([$("esri.form.elements.inputs.AttachmentInput")],A5);const GKe=A5;var cY;let _w=cY=class extends bA{constructor(e){super(e),this.attachmentKeyword=null,this.editable=!0,this.input=null,this.type="attachment"}clone(){return new cY({attachmentKeyword:this.attachmentKeyword,description:this.description,editable:this.editable,input:this.input,label:this.label,visibilityExpression:this.visibilityExpression})}};u([d({type:String,json:{write:!0}})],_w.prototype,"attachmentKeyword",void 0),u([d({type:Boolean,json:{write:!0}})],_w.prototype,"editable",void 0),u([d({type:GKe,json:{read:{source:"inputType"},write:{target:"inputType"}}})],_w.prototype,"input",void 0),u([d({type:["attachment"],json:{read:!1,write:!0}})],_w.prototype,"type",void 0),_w=cY=u([$("esri.form.elements.AttachmentElement")],_w);const Fue=_w;let R5=class extends ye{constructor(e){super(e),this.type=null}};u([d()],R5.prototype,"type",void 0),R5=u([$("esri.form.elements.inputs.Input")],R5);const TR=R5;let YM=class extends TR{constructor(e){super(e),this.maxLength=null,this.minLength=0}};u([d({type:Number,json:{write:!0}})],YM.prototype,"maxLength",void 0),u([d({type:Number,json:{write:!0}})],YM.prototype,"minLength",void 0),YM=u([$("esri.form.elements.inputs.TextInput")],YM);const Ore=YM;var uY;let O5=uY=class extends Ore{constructor(e){super(e),this.type="barcode-scanner"}clone(){return new uY({maxLength:this.maxLength,minLength:this.minLength})}};u([d({type:["barcode-scanner"],json:{read:!1,write:!0}})],O5.prototype,"type",void 0),O5=uY=u([$("esri.form.elements.inputs.BarcodeScannerInput")],O5);const jKe=O5;var hY;let N2=hY=class extends TR{constructor(e){super(e),this.noValueOptionLabel=null,this.showNoValueOption=!1,this.type="combo-box"}clone(){return new hY({showNoValueOption:this.showNoValueOption,noValueOptionLabel:this.noValueOptionLabel})}};u([d({type:String,json:{write:!0}})],N2.prototype,"noValueOptionLabel",void 0),u([d({type:Boolean,json:{write:!0}})],N2.prototype,"showNoValueOption",void 0),u([d({type:["combo-box"],json:{read:!1,write:!0}})],N2.prototype,"type",void 0),N2=hY=u([$("esri.form.elements.inputs.ComboBoxInput")],N2);const HKe=N2;var dY;function kue(e){return e!=null?new Date(e):null}function Uue(e){return e?e.getTime():null}let Sp=dY=class extends TR{constructor(e){super(e),this.includeTime=!1,this.max=null,this.min=null,this.type="datetime-picker"}readMax(e,t){return kue(t.max)}writeMax(e,t){t.max=Uue(e)}readMin(e,t){return kue(t.min)}writeMin(e,t){t.min=Uue(e)}clone(){return new dY({includeTime:this.includeTime,max:this.max,min:this.min,type:this.type})}};u([d({type:Boolean,json:{write:!0}})],Sp.prototype,"includeTime",void 0),u([d({type:Date,json:{type:Number,write:!0}})],Sp.prototype,"max",void 0),u([$e("max")],Sp.prototype,"readMax",null),u([Xe("max")],Sp.prototype,"writeMax",null),u([d({type:Date,json:{type:Number,write:!0}})],Sp.prototype,"min",void 0),u([$e("min")],Sp.prototype,"readMin",null),u([Xe("min")],Sp.prototype,"writeMin",null),u([d({type:["datetime-picker"],json:{read:!1,write:!0}})],Sp.prototype,"type",void 0),Sp=dY=u([$("esri.form.elements.inputs.DateTimePickerInput")],Sp);const qKe=Sp;var pY;let F2=pY=class extends TR{constructor(e){super(e),this.noValueOptionLabel=null,this.showNoValueOption=!1,this.type="radio-buttons"}clone(){return new pY({noValueOptionLabel:this.noValueOptionLabel,showNoValueOption:this.showNoValueOption})}};u([d({type:String,json:{write:!0}})],F2.prototype,"noValueOptionLabel",void 0),u([d({type:Boolean,json:{write:!0}})],F2.prototype,"showNoValueOption",void 0),u([d({type:["radio-buttons"],json:{read:!1,write:!0}})],F2.prototype,"type",void 0),F2=pY=u([$("esri.form.elements.inputs.RadioButtonsInput")],F2);const WKe=F2;var fY;let k2=fY=class extends TR{constructor(e){super(e),this.offValue=null,this.onValue=null,this.type="switch"}clone(){return new fY({offValue:this.offValue,onValue:this.onValue})}};u([d({type:[String,Number],json:{write:!0}})],k2.prototype,"offValue",void 0),u([d({type:[String,Number],json:{write:!0}})],k2.prototype,"onValue",void 0),u([d({type:["switch"],json:{read:!1,write:!0}})],k2.prototype,"type",void 0),k2=fY=u([$("esri.form.elements.inputs.SwitchInput")],k2);const XKe=k2;var mY;let M5=mY=class extends Ore{constructor(e){super(e),this.type="text-area"}clone(){return new mY({maxLength:this.maxLength,minLength:this.minLength})}};u([d({type:["text-area"],json:{read:!1,write:!0}})],M5.prototype,"type",void 0),M5=mY=u([$("esri.form.elements.inputs.TextAreaInput")],M5);const ZKe=M5;var gY;let P5=gY=class extends Ore{constructor(e){super(e),this.type="text-box"}clone(){return new gY({maxLength:this.maxLength,minLength:this.minLength})}};u([d({type:["text-box"],json:{read:!1,write:!0}})],P5.prototype,"type",void 0),P5=gY=u([$("esri.form.elements.inputs.TextBoxInput")],P5);const YKe=P5,QKe={base:TR,key:"type",typeMap:{"barcode-scanner":jKe,"combo-box":HKe,"datetime-picker":qKe,"radio-buttons":WKe,switch:XKe,"text-area":ZKe,"text-box":YKe}};var yY;let Zh=yY=class extends bA{constructor(e){super(e),this.domain=null,this.editable=!0,this.editableExpression=null,this.fieldName=null,this.hint=null,this.input=null,this.requiredExpression=null,this.type="field",this.valueExpression=null}clone(){return new yY({description:this.description,domain:this.domain,editable:this.editable,editableExpression:this.editableExpression,fieldName:this.fieldName,hint:this.hint,input:this.input,label:this.label,requiredExpression:this.requiredExpression,valueExpression:this.valueExpression,visibilityExpression:this.visibilityExpression})}};u([d({types:Z2e,json:{read:{reader:Yte},write:!0}})],Zh.prototype,"domain",void 0),u([d({type:Boolean,json:{write:!0}})],Zh.prototype,"editable",void 0),u([d({type:String,json:{write:!0}})],Zh.prototype,"editableExpression",void 0),u([d({type:String,json:{write:!0}})],Zh.prototype,"fieldName",void 0),u([d({type:String,json:{write:!0}})],Zh.prototype,"hint",void 0),u([d({types:QKe,json:{read:{source:"inputType"},write:{target:"inputType"}}})],Zh.prototype,"input",void 0),u([d({type:String,json:{write:!0}})],Zh.prototype,"requiredExpression",void 0),u([d({type:String,json:{read:!1,write:!0}})],Zh.prototype,"type",void 0),u([d({type:String,json:{write:!0}})],Zh.prototype,"valueExpression",void 0),Zh=yY=u([$("esri.form.elements.FieldElement")],Zh);const Vue=Zh;var vY;let ey=vY=class extends bA{constructor(e){super(e),this.displayCount=null,this.displayType="list",this.editable=!0,this.orderByFields=null,this.relationshipId=null,this.type="relationship"}clone(){return new vY({description:this.description,displayCount:this.displayCount,displayType:this.displayType,editable:this.editable,label:this.label,orderByFields:re(this.orderByFields),relationshipId:this.relationshipId,visibilityExpression:this.visibilityExpression})}};u([d({type:Number,json:{write:!0}})],ey.prototype,"displayCount",void 0),u([d({type:["list"],json:{write:!0}})],ey.prototype,"displayType",void 0),u([d({type:Boolean,json:{write:!0}})],ey.prototype,"editable",void 0),u([d({type:[kwe],json:{write:!0}})],ey.prototype,"orderByFields",void 0),u([d({type:Number,json:{write:!0}})],ey.prototype,"relationshipId",void 0),u([d({type:["relationship"],json:{read:!1,write:!0}})],ey.prototype,"type",void 0),ey=vY=u([$("esri.form.elements.RelationshipElement")],ey);const zue=ey;function eAe(e){return{typesWithGroup:{base:bA,key:"type",typeMap:{attachment:Fue,field:Vue,group:e,relationship:zue}},typesWithoutGroup:{base:bA,key:"type",typeMap:{attachment:Fue,field:Vue,relationship:zue}}}}function tAe(e,t,r=!0){if(!e)return null;const i=r?t.typesWithGroup.typeMap:t.typesWithoutGroup.typeMap;return e.filter(s=>i[s.type]).map(s=>i[s.type].fromJSON(s))}function rAe(e,t,r=!0){if(!e)return null;const i=r?t.typesWithGroup.typeMap:t.typesWithoutGroup.typeMap;return e.filter(s=>i[s.type]).map(s=>s.toJSON())}function iAe(e,t,r=!0){return e?e.map(i=>_f(r?t.typesWithGroup:t.typesWithoutGroup,i)):null}var _Y;let wm=_Y=class extends bA{constructor(e){super(e),this.elements=null,this.initialState="expanded",this.type="group"}castElements(e){return iAe(e,NG,!1)}readElements(e,t){return tAe(t.formElements,NG,!1)}writeElements(e,t){t.formElements=rAe(e,NG,!1)}clone(){return new _Y({description:this.description,elements:re(this.elements),initialState:this.initialState,label:this.label,visibilityExpression:this.visibilityExpression})}};u([d({json:{write:!0}})],wm.prototype,"elements",void 0),u([qt("elements")],wm.prototype,"castElements",null),u([$e("elements",["formElements"])],wm.prototype,"readElements",null),u([Xe("elements")],wm.prototype,"writeElements",null),u([d({type:["collapsed","expanded"],json:{write:!0}})],wm.prototype,"initialState",void 0),u([d({type:String,json:{read:!1,write:!0}})],wm.prototype,"type",void 0),wm=_Y=u([$("esri.form.elements.GroupElement")],wm);const NG=eAe(wm),JKe=wm;var bY;const FG=eAe(JKe);let nm=bY=class extends ye{constructor(e){super(e),this.description=null,this.elements=null,this.expressionInfos=null,this.title=null}castElements(e){return iAe(e,FG)}readElements(e,t){return tAe(t.formElements,FG)}writeElements(e,t){t.formElements=rAe(e,FG)}clone(){return new bY({description:this.description,expressionInfos:re(this.expressionInfos),elements:re(this.elements),title:this.title})}};u([d({type:String,json:{write:!0}})],nm.prototype,"description",void 0),u([d({json:{write:!0}})],nm.prototype,"elements",void 0),u([qt("elements")],nm.prototype,"castElements",null),u([$e("elements",["formElements"])],nm.prototype,"readElements",null),u([Xe("elements")],nm.prototype,"writeElements",null),u([d({type:[BKe],json:{write:!0}})],nm.prototype,"expressionInfos",void 0),u([d({type:String,json:{write:!0}})],nm.prototype,"title",void 0),nm=bY=u([$("esri.form.FormTemplate")],nm);const KKe=nm;function Bue(e,t,r){if(e.hasM==null||e.hasZ)for(const i of t)for(const s of i)s.length>2&&(s[2]*=r)}function eet(e,t,r){if(!e&&!t||!r)return;const i=aA(r);Gue(e,r,i),Gue(t,r,i)}function Gue(e,t,r){if(e)for(const i of e)tet(i.geometry,t,r)}function tet(e,t,r){if(R(e)||!e.spatialReference||ml(e.spatialReference,t))return;const i=aA(e.spatialReference)/r;if(i!==1){if("x"in e)e.z!=null&&(e.z*=i);else if("rings"in e)Bue(e,e.rings,i);else if("paths"in e)Bue(e,e.paths,i);else if("points"in e&&(e.hasM==null||e.hasZ))for(const s of e.points)s.length>2&&(s[2]*=i)}}let ret=0;const kG=fe.getLogger("esri.layers.graphics.sources.MemorySource");let vy=class extends gh.LoadableMixin(j$(pg(ot))){constructor(e){super(e),this._idToClientGraphic=null,this.type="memory"}load(e){const t=b(e)?e.signal:null;return this.addResolvingPromise(this._startWorker(t)),Promise.resolve(this)}destroy(){var e;(e=this._connection)==null||e.close(),this._connection=null}get workerGeometryType(){var t;const e=(t=this.layer)==null?void 0:t.geometryType;return e?this._geometryTypeRequiresClientGraphicMapping(e)?"polygon":e:null}applyEdits(e){return this.load().then(()=>this._applyEdits(e))}openPorts(){return this.load().then(()=>this._connection.openPorts())}async queryFeatures(e,t={}){await this.load(t);const r=await this._connection.invoke("queryFeatures",e?e.toJSON():null,t);gZ(e,this.layer.spatialReference,r);const i=rL.fromJSON(r);if(!this._requiresClientGraphicMapping())return i;const s=this.layer.objectIdField;for(const n of i.features){const o=n.attributes[s],a=this._idToClientGraphic.get(o);a&&(n.geometry=a.geometry)}return i.geometryType=this.layer.geometryType,i}async queryFeaturesJSON(e,t={}){if(this._requiresClientGraphicMapping())throw new j("query-features-json:unsupported","Cannot query in JSON format for client only geometry types (mesh and extent)");await this.load(t);const r=await this._connection.invoke("queryFeatures",e?e.toJSON():null,t);return gZ(e,this.layer.spatialReference,r),r}queryFeatureCount(e,t={}){return this.load(t).then(()=>this._connection.invoke("queryFeatureCount",e?e.toJSON():null,t))}queryObjectIds(e,t={}){return this.load(t).then(()=>this._connection.invoke("queryObjectIds",e?e.toJSON():null,t))}queryExtent(e,t={}){return this.load(t).then(()=>this._connection.invoke("queryExtent",e?e.toJSON():null,t)).then(r=>({count:r.count,extent:Kt.fromJSON(r.extent)}))}querySnapping(e,t={}){return this.load(t).then(()=>this._connection.invoke("querySnapping",e,t))}async _applyEdits(e){if(!this._connection)throw new j("feature-layer-source:edit-failure","Memory source not loaded");const t=this.layer.objectIdField;let r=null;const i=[],s=[];await Promise.all([this._prepareClientMapping(e.addFeatures,null),this._prepareClientMapping(e.updateFeatures,null)]);const n=c=>"objectId"in c&&c.objectId!=null?c.objectId:"attributes"in c&&c.attributes[t]!=null?c.attributes[t]:null;if(e.addFeatures&&(r=this._prepareAddFeatures(e.addFeatures)),e.deleteFeatures)for(const c of e.deleteFeatures){const h=n(c);h!=null&&i.push(h)}const o=e.updateFeatures&&this._idToClientGraphic?new Map:null;if(e.updateFeatures){for(const c of e.updateFeatures)if(s.push(this._serializeFeature(c)),o){const h=n(c);h!=null&&o.set(h,c)}}eet(r?r.features:null,s,this.layer.spatialReference);const{fullExtent:a,featureEditResults:l}=await this._connection.invoke("applyEdits",{adds:r?r.features:[],updates:s,deletes:i});return this.fullExtent=a,r&&r.finish(l.uidToObjectId),this._updateClientGraphicIds(o,l),this._createEditsResult(l)}async _prepareClientMapping(e,t){if(this.layerOrSourceGeometryType!=="mesh"||R(e))return;const r=[];for(const{geometry:i}of e)!b(i)||i.type!=="mesh"||i.hasExtent||i.loaded||r.push(i.load({signal:t}));r.length&&await Promise.all(r)}_updateClientGraphicIds(e,t){if(this._idToClientGraphic){if(e)for(const r of t.updateResults){if(!r.success)continue;const i=e.get(r.objectId);i!=null&&this._addIdToClientGraphic(i)}for(const r of t.deleteResults)r.success&&this._idToClientGraphic.delete(r.objectId)}}_createEditsResult(e){return{addFeatureResults:e.addResults?e.addResults.map(this._createFeatureEditResult,this):[],updateFeatureResults:e.updateResults?e.updateResults.map(this._createFeatureEditResult,this):[],deleteFeatureResults:e.deleteResults?e.deleteResults.map(this._createFeatureEditResult,this):[],addAttachmentResults:[],updateAttachmentResults:[],deleteAttachmentResults:[]}}_createFeatureEditResult(e){const t=e.success===!0?null:e.error||{code:void 0,description:void 0};return{objectId:e.objectId,globalId:e.globalId,error:t?new j("feature-layer-source:edit-failure",t.description,{code:t.code}):null}}_prepareAddFeatures(e){const t=new Map,r=new Array(e.length);let i=null;for(let n=0;n<e.length;n++){const o=e[n],a=this._serializeFeature(o);!i&&b(o.geometry)&&(i=o.geometry.type),r[n]=a,t.set(`${a.uid}`,o)}const s=this;return{features:r,inferredGeometryType:i,finish(n){const o=s.sourceJSON.objectIdField;for(const a in n){const l=n[a],c=t.get(a);c&&(c.attributes||(c.attributes={}),l===-1?delete c.attributes[o]:c.attributes[o]=l,s._addIdToClientGraphic(c))}}}}_addIdToClientGraphic(e){if(!this._idToClientGraphic)return;const t=this.sourceJSON.objectIdField,r=e.attributes&&e.attributes[t];r!=null&&this._idToClientGraphic.set(r,e)}get layerOrSourceGeometryType(){var e,t,r;return(r=(e=this.layer)==null?void 0:e.geometryType)!=null?r:(t=this.sourceJSON)==null?void 0:t.geometryType}_requiresClientGraphicMapping(){return this._geometryTypeRequiresClientGraphicMapping(this.layerOrSourceGeometryType)}_geometryRequiresClientGraphicMapping(e){return this._geometryTypeRequiresClientGraphicMapping(e.type)}_geometryTypeRequiresClientGraphicMapping(e){return e==="mesh"||e==="multipatch"||e==="extent"}_serializeFeature(e){const{attributes:t}=e,r=this._geometryForSerialization(e),i=(ret++).toString();return r?{uid:i,geometry:r.toJSON(),attributes:t}:{uid:i,attributes:t}}_geometryForSerialization(e){const{geometry:t}=e;return R(t)?null:this._geometryRequiresClientGraphicMapping(t)?t.extent?Oa.fromExtent(t.extent):null:t}async _startWorker(e){this._connection=await Kee("MemorySourceWorker",{strategy:he("feature-layers-workers")?"dedicated":"local",signal:e});const{fields:t,spatialReference:r,objectIdField:i,hasM:s,hasZ:n,timeInfo:o}=this.layer,a=this.layer.originOf("spatialReference")==="defaults";await this._prepareClientMapping(this.items,e);const l=this._prepareAddFeatures(this.items);this.handles.add(this.on("before-changes",f=>{kG.error("Source modifications will not propagate after layer has been loaded. Please use .applyEdits() instead"),f.preventDefault()}));const c={features:l.features,fields:t&&t.map(f=>f.toJSON()),geometryType:Hae.toJSON(this.workerGeometryType),hasM:this.layerOrSourceGeometryType!=="mesh"&&s,hasZ:this.layerOrSourceGeometryType==="mesh"||n,objectIdField:i,spatialReference:a?null:r&&r.toJSON(),timeInfo:o?o.toJSON():null},h=await this._connection.invoke("load",c,{signal:e});for(const f of h.warnings)kG.warn(f.message,{layer:this.layer,warning:f});h.featureErrors.length&&kG.warn(`Encountered ${h.featureErrors.length} validation errors while loading features`,h.featureErrors);const p=h.layerDefinition;this._geometryTypeRequiresClientGraphicMapping(l.inferredGeometryType)&&(p.geometryType=Hae.toJSON(l.inferredGeometryType)),this.sourceJSON=p,this._requiresClientGraphicMapping()&&(this._idToClientGraphic=new Map),l.finish(h.assignedObjectIds)}};u([HK({Type:gl,ensureType:en(gl)})],vy.prototype,"itemType",void 0),u([d()],vy.prototype,"type",void 0),u([d({constructOnly:!0})],vy.prototype,"layer",void 0),u([d({readOnly:!0})],vy.prototype,"workerGeometryType",null),u([d()],vy.prototype,"sourceJSON",void 0),vy=u([$("esri.layers.graphics.sources.MemorySource")],vy);function iet(e){return"portalItem"in e}const sAe=e=>{let t=class extends e{get apiKey(){var r;return this._isOverridden("apiKey")?this._get("apiKey"):iet(this)?(r=this.portalItem)==null?void 0:r.apiKey:null}set apiKey(r){r!=null?this._override("apiKey",r):(this._clearOverride("apiKey"),this.clear("apiKey","user"))}};return u([d({type:String})],t.prototype,"apiKey",null),t=u([$("esri.layers.mixins.APIKeyMixin")],t),t},nAe={mapserver:"MapServer",imageserver:"ImageServer",featureserver:"FeatureServer",sceneserver:"SceneServer",streamserver:"StreamServer",vectortileserver:"VectorTileServer"},oAe=Object.values(nAe),aAe=new RegExp(`^((?:https?:)?\\/\\/\\S+?\\/rest\\/services\\/(.+?)\\/(${oAe.join("|")}))(?:\\/(?:layers\\/)?(\\d+))?`,"i"),set=new RegExp(`^((?:https?:)?\\/\\/\\S+?\\/([^\\/\\n]+)\\/(${oAe.join("|")}))(?:\\/(?:layers\\/)?(\\d+))?`,"i"),net=/(.*?)\/(?:layers\/)?(\d+)\/?$/i;function CLt(e){return!!aAe.test(e)}function yT(e){if(R(e))return null;const t=Ds(e),r=t.path.match(aAe)||t.path.match(set);if(!r)return null;const[,i,s,n,o]=r,a=s.indexOf("/");return{title:rB(a!==-1?s.slice(a+1):s),serverType:nAe[n.toLowerCase()],sublayer:o!=null&&o!==""?parseInt(o,10):null,url:{path:i}}}function oet(e){const t=Ds(e).path.match(net);return t?{serviceUrl:t[1],sublayerId:Number(t[2])}:null}function rB(e){return(e=e.replace(/\s*[/_]+\s*/g," "))[0].toUpperCase()+e.slice(1)}function lAe(e,t){const r=[];if(e){const i=yT(e);b(i)&&i.title&&r.push(i.title)}if(t){const i=rB(t);r.push(i)}if(r.length===2){if(r[0].toLowerCase().includes(r[1].toLowerCase()))return r[0];if(r[1].toLowerCase().includes(r[0].toLowerCase()))return r[1]}return r.join(" - ")}function cAe(e){if(!e)return!1;const t=".arcgis.com/",r="//services",i="//tiles",s="//features",n=(e=e.toLowerCase()).includes(t),o=e.includes(r)||e.includes(i)||e.includes(s);return n&&o}function aet(e,t){return e&&lbe(cbe(e,t))}function uAe(e){let{url:t}=e;if(!t)return{url:t};t=cbe(t,e.logger);const r=Ds(t),i=yT(r.path);let s;if(b(i))i.sublayer!=null&&e.layer.layerId==null&&(s=i.sublayer),t=i.url.path;else if(e.nonStandardUrlAllowed){const n=oet(r.path);b(n)&&(t=n.serviceUrl,s=n.sublayerId)}return{url:lbe(t),layerId:s}}function hAe(e,t,r,i,s){R1(t,i,"url",s),i.url&&e.layerId!=null&&(i.url=sc(i.url,r,e.layerId.toString()))}function ALt(e){if(!e)return!1;const t=e.toLowerCase(),r=t.includes("/services/"),i=t.includes("/mapserver/wmsserver"),s=t.includes("/imageserver/wmsserver"),n=t.includes("/wmsserver");return r&&(i||s||n)}const dAe=e=>{let t=class extends e{get title(){if(this._get("title")&&this.originOf("title")!=="defaults")return this._get("title");if(this.url){const r=yT(this.url);if(b(r)&&r.title)return r.title}return this._get("title")||""}set title(r){this._set("title",r)}set url(r){this._set("url",aet(r,fe.getLogger(this.declaredClass)))}};return u([d()],t.prototype,"title",null),u([d({type:String})],t.prototype,"url",null),t=u([$("esri.layers.mixins.ArcGISService")],t),t},jue={read:{reader:Hte},write:{allowNull:!0,writer:qte}},pAe=e=>{let t=class extends e{constructor(){super(...arguments),this.blendMode="normal",this.effect=null}};return u([d({type:["average","color-burn","color-dodge","color","darken","destination-atop","destination-in","destination-out","destination-over","difference","exclusion","hard-light","hue","invert","lighten","lighter","luminosity","minus","multiply","normal","overlay","plus","reflect","saturation","screen","soft-light","source-atop","source-in","source-out","vivid-light","xor"],nonNullable:!0,json:{read:!1,write:!1,origins:{"web-map":{read:!0,write:!0},"portal-item":{read:!0,write:!0}}}})],t.prototype,"blendMode",void 0),u([d({json:{read:!1,write:!1,origins:{"web-map":jue,"portal-item":jue}}})],t.prototype,"effect",void 0),t=u([$("esri.layers.mixins.BlendLayer")],t),t},fAe=e=>{let t=class extends e{constructor(){super(...arguments),this.customParameters=null}};return u([d({type:Object,json:{write:{overridePolicy:r=>({enabled:!!(r&&Object.keys(r).length>0)})}}})],t.prototype,"customParameters",void 0),t=u([$("esri.layers.mixins.CustomParametersMixin")],t),t};var wY;const UG=new Tr({esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"envelope-intersects",esriSpatialRelIndexIntersects:"index-intersects",esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:"relation"}),VG=new Tr({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"});let om=wY=class extends ye{constructor(e){super(e),this.where=null,this.geometry=null,this.spatialRelationship="intersects",this.distance=void 0,this.objectIds=null,this.units=null,this.timeExtent=null}createQuery(e={}){const{where:t,geometry:r,spatialRelationship:i,timeExtent:s,objectIds:n,units:o,distance:a}=this;return new Sa({geometry:re(r),objectIds:re(n),spatialRelationship:i,timeExtent:re(s),where:t,units:o,distance:a,...e})}clone(){const{where:e,geometry:t,spatialRelationship:r,timeExtent:i,objectIds:s,units:n,distance:o}=this;return new wY({geometry:re(t),objectIds:re(s),spatialRelationship:r,timeExtent:re(i),where:e,units:n,distance:o})}};u([d({type:String,json:{write:!0}})],om.prototype,"where",void 0),u([d({types:jT,json:{write:!0}})],om.prototype,"geometry",void 0),u([d({type:UG.apiValues,json:{name:"spatialRel",read:{reader:UG.read},write:{allowNull:!1,writer:UG.write,overridePolicy(){return{enabled:b(this.geometry)}}}}})],om.prototype,"spatialRelationship",void 0),u([d({type:Number,json:{write:{overridePolicy(e){return{enabled:e!=null&&this.geometry!=null}}}}})],om.prototype,"distance",void 0),u([d({type:[Number],json:{write:!0}})],om.prototype,"objectIds",void 0),u([d({type:VG.apiValues,json:{read:VG.read,write:{writer:VG.write,overridePolicy(e){return{enabled:e!=null&&this.geometry!=null}}}}})],om.prototype,"units",void 0),u([d({type:vg,json:{write:!0}})],om.prototype,"timeExtent",void 0),om=wY=u([$("esri.layers.support.FeatureFilter")],om);const cet=om;var xY;const Hue={read:{reader:Hte},write:{writer:qte,overridePolicy(){return{allowNull:this.excludedEffect!=null,isRequired:this.excludedEffect==null}}}},que={read:{reader:Hte},write:{writer:qte,overridePolicy(){return{allowNull:this.includedEffect!=null,isRequired:this.includedEffect==null}}}},Wue={name:"showExcludedLabels",default:!0};let bw=xY=class extends ye{constructor(e){super(e),this.filter=null,this.includedEffect=null,this.excludedEffect=null,this.excludedLabelsVisible=!1}write(e,t){var i,s;const r=super.write(e,t);if(t!=null&&t.origin){if(r.filter){const n=Object.keys(r.filter);if(n.length>1||n[0]!=="where")return(i=t.messages)==null||i.push(new j("web-document-write:unsupported-feature-effect","Invalid feature effect 'filter'. A filter can only contain a 'where' property",{layer:t.layer,effect:this})),null}if("showExcludedLabels"in r)return(s=t.messages)==null||s.push(new j("web-document-write:unsupported-feature-effect","Invalid value for property 'excludedLabelsVisible' which should always be 'true'",{layer:t.layer,effect:this})),null}return r}clone(){return new xY({filter:b(this.filter)&&this.filter.clone(),includedEffect:this.includedEffect,excludedEffect:this.excludedEffect,excludedLabelsVisible:this.excludedLabelsVisible})}};u([d({type:cet,json:{write:{allowNull:!0,writer(e,t,r,i){const s=e==null?void 0:e.write({},i);s&&Object.keys(s).length!==0?ru(r,s,t):ru(r,null,t)}}}})],bw.prototype,"filter",void 0),u([d({json:{write:!0,origins:{"web-map":Hue,"portal-item":Hue}}})],bw.prototype,"includedEffect",void 0),u([d({json:{write:!0,origins:{"web-map":que,"portal-item":que}}})],bw.prototype,"excludedEffect",void 0),u([d({type:Boolean,json:{write:!0,name:"showExcludedLabels",origins:{"web-map":Wue,"portal-item":Wue}}})],bw.prototype,"excludedLabelsVisible",void 0),bw=xY=u([$("esri.layers.support.FeatureEffect")],bw);const uet=bw,Xue={write:{allowNull:!0}},mAe=e=>{let t=class extends e{constructor(){super(...arguments),this.featureEffect=null}};return u([d({type:uet,json:{origins:{"web-map":Xue,"portal-item":Xue}}})],t.prototype,"featureEffect",void 0),t=u([$("esri.layers.mixins.FeatureEffectLayer")],t),t},het={"web-scene/operational-layers":{ArcGISFeatureLayer:!0,ArcGISImageServiceLayer:!0,ArcGISMapServiceLayer:!0,ArcGISSceneServiceLayer:!0,ArcGISTiledElevationServiceLayer:!0,ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,BuildingSceneLayer:!0,GroupLayer:!0,IntegratedMeshLayer:!0,OGCFeatureLayer:!0,PointCloudLayer:!0,WebTiledLayer:!0,CSV:!0,GeoJSON:!0,VectorTileLayer:!0,WFS:!0,WMS:!0,KML:!0,RasterDataLayer:!0,Voxel:!0,LineOfSightLayer:!0},"web-scene/basemap":{ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,WebTiledLayer:!0,OpenStreetMap:!0,VectorTileLayer:!0,ArcGISImageServiceLayer:!0,WMS:!0,ArcGISMapServiceLayer:!0},"web-scene/ground":{ArcGISTiledElevationServiceLayer:!0,RasterDataElevationLayer:!0},"web-map/operational-layers":{ArcGISAnnotationLayer:!0,ArcGISDimensionLayer:!0,ArcGISFeatureLayer:!0,ArcGISImageServiceLayer:!0,ArcGISImageServiceVectorLayer:!0,ArcGISMapServiceLayer:!0,ArcGISStreamLayer:!0,ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,BingMapsAerial:!0,BingMapsHybrid:!0,BingMapsRoad:!0,CSV:!0,GeoRSS:!0,GeoJSON:!0,GroupLayer:!0,KML:!0,OGCFeatureLayer:!0,SubtypeGroupLayer:!0,VectorTileLayer:!0,WFS:!0,WMS:!0,WebTiledLayer:!0},"web-map/basemap":{ArcGISImageServiceLayer:!0,ArcGISImageServiceVectorLayer:!0,ArcGISMapServiceLayer:!0,ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,OpenStreetMap:!0,VectorTileLayer:!0,WMS:!0,WebTiledLayer:!0,BingMapsAerial:!0,BingMapsRoad:!0,BingMapsHybrid:!0},"web-map/tables":{ArcGISFeatureLayer:!0},"portal-item/operational-layers":{ArcGISFeatureLayer:!0,ArcGISSceneServiceLayer:!0,PointCloudLayer:!0,BuildingSceneLayer:!0,IntegratedMeshLayer:!0}};function det(e){if(!e)return e;const{start:t,end:r}=e;return new vg({start:b(t)?jx(t,-t.getTimezoneOffset(),"minutes"):t,end:b(r)?jx(r,-r.getTimezoneOffset(),"minutes"):r})}function pet(e){if(!e)return e;const{start:t,end:r}=e;return new vg({start:b(t)?jx(t,t.getTimezoneOffset(),"minutes"):t,end:b(r)?jx(r,r.getTimezoneOffset(),"minutes"):r})}var TY;let QM=TY=class extends ye{async collectRequiredFields(e,t){return oc(e,t,this.expression)}clone(){return new TY({expression:this.expression,title:this.title})}equals(e){return this.expression===e.expression&&this.title===e.title}};u([d({type:String,json:{write:!0}})],QM.prototype,"expression",void 0),u([d({type:String,json:{write:!0}})],QM.prototype,"title",void 0),QM=TY=u([$("esri.layers.support.FeatureExpressionInfo")],QM);const Zue=QM;function fet(e){return vA[e]!=null}function met(e){return 1/(vA[e]||1)}function get(){const e=Object.keys(vA);return e.sort(),e}const yet=get();var SY;const oN=Da()({onTheGround:"on-the-ground",relativeToGround:"relative-to-ground",relativeToScene:"relative-to-scene",absoluteHeight:"absolute-height"}),Yue=new Tr({foot:"feet",kilometer:"kilometers",meter:"meters",mile:"miles","us-foot":"us-feet",yard:"yards"});let ty=SY=class extends ye{constructor(){super(...arguments),this.offset=null}readFeatureExpressionInfo(e,t){return e!=null?e:t.featureExpression&&t.featureExpression.value===0?{expression:"0"}:void 0}writeFeatureExpressionInfo(e,t,r,i){t[r]=e.write({},i),e.expression==="0"&&(t.featureExpression={value:0})}get mode(){const{offset:e,featureExpressionInfo:t}=this;return this._isOverridden("mode")?this._get("mode"):b(e)||t?"relative-to-ground":"on-the-ground"}set mode(e){this._override("mode",e)}set unit(e){this._set("unit",e)}write(e,t){return this.offset||this.mode||this.featureExpressionInfo||this.unit?super.write(e,t):null}clone(){return new SY({mode:this.mode,offset:this.offset,featureExpressionInfo:this.featureExpressionInfo?this.featureExpressionInfo.clone():void 0,unit:this.unit})}equals(e){return this.mode===e.mode&&this.offset===e.offset&&this.unit===e.unit&&F4e(this.featureExpressionInfo,e.featureExpressionInfo)}};u([d({type:Zue,json:{write:!0}})],ty.prototype,"featureExpressionInfo",void 0),u([$e("featureExpressionInfo",["featureExpressionInfo","featureExpression"])],ty.prototype,"readFeatureExpressionInfo",null),u([Xe("featureExpressionInfo",{featureExpressionInfo:{type:Zue},"featureExpression.value":{type:[0]}})],ty.prototype,"writeFeatureExpressionInfo",null),u([d({type:oN.apiValues,nonNullable:!0,json:{type:oN.jsonValues,read:oN.read,write:{writer:oN.write,isRequired:!0}}})],ty.prototype,"mode",null),u([d({type:Number,json:{write:!0}})],ty.prototype,"offset",void 0),u([d({type:yet,json:{type:String,read:Yue.read,write:Yue.write}})],ty.prototype,"unit",null),ty=SY=u([$("esri.layers.support.ElevationInfo")],ty);const vet=ty,Mre={type:Boolean,value:!0,json:{origins:{service:{read:!1,write:!1},"web-map":{read:!1,write:!1}},name:"screenSizePerspective",write:!0}},hL={type:Boolean,value:!0,json:{name:"disablePopup",read:{reader:(e,t)=>!t.disablePopup},write:{enabled:!0,writer(e,t,r){t[r]=!e}}}},dL={type:Boolean,value:!0,json:{name:"showLabels",write:!0}},Pre={type:String,json:{origins:{"portal-item":{write:!1}},write:{isRequired:!0,ignoreOrigin:!0,writer:R1}}},Ire={type:Boolean,value:!0,json:{origins:{service:{read:{enabled:!1}}},name:"showLegend",write:!0}},$re={value:null,type:vet,json:{origins:{service:{name:"elevationInfo",write:!0}},name:"layerDefinition.elevationInfo",write:!0}};function RLt(e){return{type:e,readOnly:!0,json:{origins:{service:{read:!0}},read:!1}}}const oP={type:Number,json:{origins:{"web-document":{write:!0,read:!0},"portal-item":{write:!0}}}},_et={...oP,json:{...oP.json,origins:{"web-document":{...oP.json.origins["web-document"],write:{enabled:!0,target:{opacity:{type:Number},"layerDefinition.drawingInfo.transparency":{type:Number}}}}},read:{source:["layerDefinition.drawingInfo.transparency","drawingInfo.transparency"],reader:(e,t,r)=>r&&r.origin!=="service"||!t.drawingInfo||t.drawingInfo.transparency===void 0?t.layerDefinition&&t.layerDefinition.drawingInfo&&t.layerDefinition.drawingInfo.transparency!==void 0?ZC(t.layerDefinition.drawingInfo.transparency):void 0:ZC(t.drawingInfo.transparency)}}},bet={type:vg,readOnly:!0,get(){var a,l;if(!((a=this.layer)!=null&&a.timeInfo))return null;const{datesInUnknownTimezone:e,timeOffset:t,useViewTime:r}=this.layer,i=(l=this.view)==null?void 0:l.timeExtent;let s=this.layer.timeExtent;e&&(s=pet(s));let n=r?i&&s?i.intersection(s):i||s:s;if(!n||n.isEmpty||n.isAllTime)return n;t&&(n=n.offset(-t.value,t.unit)),e&&(n=det(n));const o=this._get("timeExtent");return n.equals(o)?o:n}},OLt={type:Kt,readOnly:!0,json:{origins:{service:{read:{source:["fullExtent","spatialReference"],reader:(e,t)=>{const r=Kt.fromJSON(e);return t.spatialReference!=null&&typeof t.spatialReference=="object"&&(r.spatialReference=Ze.fromJSON(t.spatialReference)),r}}}},read:!1}},Lre={type:String,json:{origins:{service:{read:!1},"portal-item":{read:!1}}}},wet={type:Number,json:{origins:{service:{write:{enabled:!1}}},read:{source:"layerDefinition.minScale"},write:{target:"layerDefinition.minScale"}}},xet={type:Number,json:{origins:{service:{write:{enabled:!1}}},read:{source:"layerDefinition.maxScale"},write:{target:"layerDefinition.maxScale"}}},gAe={json:{write:{ignoreOrigin:!0},origins:{"web-map":{read:!1,write:!1}}}},Dre=e=>{let t=class extends e{constructor(){super(...arguments),this.title=null}writeListMode(r,i,s,n){(n&&n.layerContainerType==="ground"||r&&kke(this,s,{},n))&&(i[s]=r)}writeOperationalLayerType(r,i,s,n){!r||n&&n.layerContainerType==="tables"||(i.layerType=r)}writeTitle(r,i){i.title=r||"Layer"}read(r,i){i&&(i.layer=this),Lke(this,r,s=>super.read(r,s),i)}write(r,i){var o,a;if(i!=null&&i.origin){const l=`${i.origin}/${i.layerContainerType||"operational-layers"}`,c=het[l];let h=c&&c[this.operationalLayerType];if(this.operationalLayerType==="ArcGISTiledElevationServiceLayer"&&l==="web-scene/operational-layers"&&(h=!1),!h)return(o=i.messages)==null||o.push(new j("layer:unsupported",`Layers (${this.title}, ${this.id}) of type '${this.declaredClass}' are not supported in the context of '${l}'`,{layer:this})),null}const s=super.write(r,{...i,layer:this}),n=!!i&&!!i.messages&&!!i.messages.filter(l=>l instanceof j&&l.name==="web-document-write:property-required").length;return S1(s==null?void 0:s.url)?((a=i==null?void 0:i.messages)==null||a.push(new j("layer:invalid-url",`Layer (${this.title}, ${this.id}) of type '${this.declaredClass}' using a Blob URL cannot be written to web scenes and web maps`,{layer:this})),null):!this.url&&n?null:s}beforeSave(){}};return u([d({type:String,json:{write:{ignoreOrigin:!0},origins:{"web-scene":{write:{isRequired:!0,ignoreOrigin:!0}},"portal-item":{write:!1}}}})],t.prototype,"id",void 0),u([d(gAe)],t.prototype,"listMode",void 0),u([Xe("listMode")],t.prototype,"writeListMode",null),u([d({type:String,readOnly:!0,json:{read:!1,write:{target:"layerType",ignoreOrigin:!0},origins:{"portal-item":{write:!1}}}})],t.prototype,"operationalLayerType",void 0),u([Xe("operationalLayerType")],t.prototype,"writeOperationalLayerType",null),u([d(oP)],t.prototype,"opacity",void 0),u([d({type:String,json:{write:{ignoreOrigin:!0,writerEnsuresNonNull:!0},origins:{"web-scene":{write:{isRequired:!0,ignoreOrigin:!0,writerEnsuresNonNull:!0}},"portal-item":{write:!1}}},value:"Layer"})],t.prototype,"title",void 0),u([Xe([void 0,"web-scene"],"title")],t.prototype,"writeTitle",null),u([d({type:Boolean,json:{name:"visibility"}})],t.prototype,"visible",void 0),t=u([$("esri.layers.mixins.OperationalLayer")],t),t};var EY;const zG=new Tr({asc:"ascending",desc:"descending"});let U2=EY=class extends ye{constructor(e){super(e),this.field=null,this.valueExpression=null,this.order="ascending"}clone(){return new EY({field:this.field,valueExpression:this.valueExpression,order:this.order})}};u([d({type:String,json:{write:!0}})],U2.prototype,"field",void 0),u([d({type:String,json:{write:!0}})],U2.prototype,"valueExpression",void 0),u([d({type:zG.apiValues,json:{read:zG.read,write:zG.write}})],U2.prototype,"order",void 0),U2=EY=u([$("esri.layers.support.OrderByInfo")],U2);const yAe=U2;function Tet(e,t,r){if(!e)return null;const i=e.find(n=>!!n.field);if(!i)return null;const s=new yAe;return s.read(i,r),[s]}function Eet(e,t,r,i){const s=e.find(n=>!!n.field);s&&ru(r,[s.toJSON()],t)}const vAe=e=>{let t=class extends e{constructor(){super(...arguments),this.orderBy=null}};return u([d({type:[yAe],json:{origins:{"web-scene":{write:!1,read:!1}},read:{source:"layerDefinition.orderBy",reader:Tet},write:{target:"layerDefinition.orderBy",writer:Eet}}})],t.prototype,"orderBy",void 0),t=u([$("esri.layers.mixins.OrderedLayer")],t),t},Cet=fe.getLogger("esri.layers.mixins.PortalLayer"),_Ae=e=>{let t=class extends e{constructor(){super(...arguments),this.resourceReferences={portalItem:null,paths:[]},this.userHasEditingPrivileges=!0}destroy(){var r;(r=this.portalItem)==null||r.destroy(),this.portalItem=null}set portalItem(r){r!==this._get("portalItem")&&(this.removeOrigin("portal-item"),this._set("portalItem",r))}readPortalItem(r,i,s){if(i.itemId)return new HC({id:i.itemId,portal:s&&s.portal})}writePortalItem(r,i){r&&r.id&&(i.itemId=r.id)}async loadFromPortal(r,i){if(this.portalItem&&this.portalItem.id)try{const s=await ie(()=>import("./layersLoader.55238685.js").then(n=>n.l),["layersLoader.55238685.js","lazyLayerLoader.fb403b9c.js","jsonContext.a084d534.js"],import.meta.url);return Jt(i),await s.load({instance:this,supportedTypes:r.supportedTypes,validateItem:r.validateItem,supportsData:r.supportsData},i)}catch(s){throw Vi(s)||Cet.warn(`Failed to load layer (${this.title}, ${this.id}) portal item (${this.portalItem.id})
  ${s}`),s}}async finishLoadEditablePortalLayer(r){this._set("userHasEditingPrivileges",await this._fetchUserHasEditingPrivileges(r).catch(i=>(ah(i),!0)))}async _fetchUserHasEditingPrivileges(r){const i=this.url?Xi==null?void 0:Xi.findCredential(this.url):null;if(!i)return!0;const s=aN.credential===i?aN.user:await this._fetchEditingUser(r);return aN.credential=i,aN.user=s,R(s)||s.privileges==null||s.privileges.includes("features:user:edit")}async _fetchEditingUser(r){var h,p;const i=(p=(h=this.portalItem)==null?void 0:h.portal)==null?void 0:p.user;if(i)return i;const s=Xi.findServerInfo(this.url);if(!(s!=null&&s.owningSystemUrl))return null;const n=`${s.owningSystemUrl}/sharing/rest`,o=Sn.getDefault();if(o&&o.loaded&&Id(o.restUrl)===Id(n))return o.user;const a=`${n}/community/self`,l=b(r)?r.signal:null,c=await yh(er(a,{authMode:"no-prompt",query:{f:"json"},signal:l}));return c.ok?cee.fromJSON(c.value.data):null}read(r,i){i&&(i.layer=this),super.read(r,i)}write(r,i){const s=i&&i.portal,n=this.portalItem&&this.portalItem.id&&(this.portalItem.portal||Sn.getDefault());return s&&n&&!sbe(n.restUrl,s.restUrl)?(i.messages&&i.messages.push(new j("layer:cross-portal",`The layer '${this.title} (${this.id})' cannot be persisted because it refers to an item on a different portal than the one being saved to. To save, set layer.portalItem to null or save to the same portal as the item associated with the layer`,{layer:this})),null):super.write(r,{...i,layer:this})}};return u([d({type:HC})],t.prototype,"portalItem",null),u([$e("web-document","portalItem",["itemId"])],t.prototype,"readPortalItem",null),u([Xe("web-document","portalItem",{itemId:{type:String}})],t.prototype,"writePortalItem",null),u([d({clonable:!1})],t.prototype,"resourceReferences",void 0),u([d({readOnly:!0})],t.prototype,"userHasEditingPrivileges",void 0),t=u([$("esri.layers.mixins.PortalLayer")],t),t},aN={credential:null,user:null},AI=new ot,aP=new WeakMap;function Aet(e){bAe(e)&&AI.push(e)}function Ret(e){bAe(e)&&AI.includes(e)&&AI.remove(e)}function bAe(e){return e&&typeof e=="object"&&"refreshInterval"in e&&"refresh"in e}function wAe(e,t){return Number.isFinite(e)&&Number.isFinite(t)?t<=0?e:wAe(t,e%t):0}let BG=0,lN=0;function Oet(){var t;const e=Date.now();for(const r of AI)r.refreshInterval&&e-((t=aP.get(r))!=null?t:0)+5>=6e4*r.refreshInterval&&(aP.set(r,e),r.refresh(e))}C1e(()=>{const e=Date.now();let t=0;for(const r of AI)t=wAe(Math.round(6e4*r.refreshInterval),t),r.refreshInterval?aP.get(r)||aP.set(r,e):aP.delete(r);if(t!==lN){if(lN=t,clearInterval(BG),lN===0)return void(BG=0);BG=setInterval(Oet,lN)}});function Met(e){return e&&typeof e=="object"&&"refreshTimestamp"in e&&"refresh"in e}const xAe=e=>{let t=class extends e{constructor(...r){super(...r),this.refreshInterval=0,this.refreshTimestamp=0,this._debounceHasDataChanged=z$(()=>this.hasDataChanged()),this.when().then(()=>{Aet(this)},()=>{})}destroy(){Ret(this)}get refreshParameters(){return{_ts:this.refreshTimestamp||null}}refresh(r=Date.now()){Sq(this._debounceHasDataChanged()).then(i=>{i&&this._set("refreshTimestamp",r),this.emit("refresh",{dataChanged:i})},i=>{fe.getLogger(this.declaredClass).error(i),this.emit("refresh",{dataChanged:!1,error:i})})}async hasDataChanged(){return!0}};return u([d({type:Number,cast:r=>r>=.1?r:r<=0?0:.1,json:{write:!0}})],t.prototype,"refreshInterval",void 0),u([d({readOnly:!0})],t.prototype,"refreshTimestamp",void 0),u([d()],t.prototype,"refreshParameters",null),t=u([$("esri.layers.mixins.RefreshableLayer")],t),t},Nre=e=>{let t=class extends e{constructor(){super(...arguments),this.minScale=0,this.maxScale=0}get effectiveScaleRange(){const r={minScale:this.minScale,maxScale:this.maxScale},i=this.parent;i&&"effectiveScaleRange"in i&&Pet(r,i.effectiveScaleRange);const s=this._get("effectiveScaleRange");return s&&s.minScale===r.minScale&&s.maxScale===r.maxScale?s:r}};return u([d({type:Number,nonNullable:!0,json:{write:!0}})],t.prototype,"minScale",void 0),u([d({type:Number,nonNullable:!0,json:{write:!0}})],t.prototype,"maxScale",void 0),u([d({readOnly:!0})],t.prototype,"effectiveScaleRange",null),t=u([$("esri.layers.mixins.ScaleRangeLayer")],t),t};function Pet(e,t){return e.minScale=e.minScale>0?t.minScale>0?Math.min(e.minScale,t.minScale):e.minScale:t.minScale,e.maxScale=e.maxScale>0?t.maxScale>0?Math.max(e.maxScale,t.maxScale):e.maxScale:t.maxScale,e}const xx=Da()({esriTimeUnitsMilliseconds:"milliseconds",esriTimeUnitsSeconds:"seconds",esriTimeUnitsMinutes:"minutes",esriTimeUnitsHours:"hours",esriTimeUnitsDays:"days",esriTimeUnitsWeeks:"weeks",esriTimeUnitsMonths:"months",esriTimeUnitsYears:"years",esriTimeUnitsDecades:"decades",esriTimeUnitsCenturies:"centuries",esriTimeUnitsUnknown:void 0});var CY;let JM=CY=class extends ye{constructor(e){super(e),this.value=0,this.unit="milliseconds"}toMilliseconds(){return oZe(this.value,this.unit,"milliseconds")}clone(){return new CY({value:this.value,unit:this.unit})}};u([d({type:Number,json:{write:!0},nonNullable:!0})],JM.prototype,"value",void 0),u([d({type:xx.apiValues,json:{type:xx.jsonValues,read:xx.read,write:xx.write},nonNullable:!0})],JM.prototype,"unit",void 0),JM=CY=u([$("esri.TimeInterval")],JM);const RI=JM;var AY;let V2=AY=class extends ye{constructor(e){super(e),this.respectsDaylightSaving=!1,this.timezone=null}readRespectsDaylightSaving(e,t){return t.respectsDaylightSaving!==void 0?t.respectsDaylightSaving:t.respectDaylightSaving!==void 0&&t.respectDaylightSaving}clone(){const{respectsDaylightSaving:e,timezone:t}=this;return new AY({respectsDaylightSaving:e,timezone:t})}};u([d({type:Boolean,json:{write:!0}})],V2.prototype,"respectsDaylightSaving",void 0),u([$e("respectsDaylightSaving",["respectsDaylightSaving","respectDaylightSaving"])],V2.prototype,"readRespectsDaylightSaving",null),u([d({type:String,json:{read:{source:"timeZone"},write:{target:"timeZone"}}})],V2.prototype,"timezone",void 0),V2=AY=u([$("esri.layers.support.TimeReference")],V2);const Iet=V2;var RY;let Wa=RY=class extends ye{constructor(e){super(e),this.cumulative=!1,this.endField=null,this.fullTimeExtent=null,this.hasLiveData=!1,this.interval=null,this.startField=null,this.timeReference=null,this.trackIdField=null,this.useTime=!0}readFullTimeExtent(e,t){if(!t.timeExtent||!Array.isArray(t.timeExtent)||t.timeExtent.length!==2)return null;const r=new Date(t.timeExtent[0]),i=new Date(t.timeExtent[1]);return new vg({start:r,end:i})}writeFullTimeExtent(e,t){e&&b(e.start)&&b(e.end)?t.timeExtent=[e.start.getTime(),e.end.getTime()]:t.timeExtent=null}readInterval(e,t){return t.timeInterval&&t.timeIntervalUnits?new RI({value:t.timeInterval,unit:xx.fromJSON(t.timeIntervalUnits)}):t.defaultTimeInterval&&t.defaultTimeIntervalUnits?new RI({value:t.defaultTimeInterval,unit:xx.fromJSON(t.defaultTimeIntervalUnits)}):null}writeInterval(e,t){if(e){const r=e.toJSON();t.timeInterval=r.value,t.timeIntervalUnits=r.unit}else t.timeInterval=null,t.timeIntervalUnits=null}clone(){const{cumulative:e,endField:t,hasLiveData:r,interval:i,startField:s,timeReference:n,fullTimeExtent:o,trackIdField:a,useTime:l}=this;return new RY({cumulative:e,endField:t,hasLiveData:r,interval:i,startField:s,timeReference:re(n),fullTimeExtent:re(o),trackIdField:a,useTime:l})}};u([d({type:Boolean,json:{read:{source:"exportOptions.timeDataCumulative"},write:{target:"exportOptions.timeDataCumulative"}}})],Wa.prototype,"cumulative",void 0),u([d({type:String,json:{read:{source:"endTimeField"},write:{target:"endTimeField",allowNull:!0}}})],Wa.prototype,"endField",void 0),u([d({type:vg,json:{write:{enabled:!0,allowNull:!0}}})],Wa.prototype,"fullTimeExtent",void 0),u([$e("fullTimeExtent",["timeExtent"])],Wa.prototype,"readFullTimeExtent",null),u([Xe("fullTimeExtent")],Wa.prototype,"writeFullTimeExtent",null),u([d({type:Boolean,json:{write:!0}})],Wa.prototype,"hasLiveData",void 0),u([d({type:RI,json:{write:{enabled:!0,allowNull:!0}}})],Wa.prototype,"interval",void 0),u([$e("interval",["timeInterval","timeIntervalUnits","defaultTimeInterval","defaultTimeIntervalUnits"])],Wa.prototype,"readInterval",null),u([Xe("interval")],Wa.prototype,"writeInterval",null),u([d({type:String,json:{read:{source:"startTimeField"},write:{target:"startTimeField",allowNull:!0}}})],Wa.prototype,"startField",void 0),u([d({type:Iet,json:{write:{enabled:!0,allowNull:!0}}})],Wa.prototype,"timeReference",void 0),u([d({type:String,json:{write:{enabled:!0,allowNull:!0}}})],Wa.prototype,"trackIdField",void 0),u([d({type:Boolean,json:{read:{source:"exportOptions.useTime"},write:{target:"exportOptions.useTime"}}})],Wa.prototype,"useTime",void 0),Wa=RY=u([$("esri.layers.support.TimeInfo")],Wa);const TAe=Wa,SAe=e=>{let t=class extends e{constructor(){super(...arguments),this.timeExtent=null,this.timeOffset=null,this.useViewTime=!0}readOffset(r,i){const s=i.timeInfo.exportOptions;if(!s)return null;const n=s.timeOffset,o=xx.fromJSON(s.timeOffsetUnits);return n&&o?new RI({value:n,unit:o}):null}set timeInfo(r){Iee(r,this.fieldsIndex),this._set("timeInfo",r)}};return u([d({type:vg,json:{write:!1}})],t.prototype,"timeExtent",void 0),u([d({type:RI})],t.prototype,"timeOffset",void 0),u([$e("service","timeOffset",["timeInfo.exportOptions"])],t.prototype,"readOffset",null),u([d({value:null,type:TAe,json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],t.prototype,"timeInfo",null),u([d({type:Boolean,json:{read:{source:"timeAnimation"},write:{target:"timeAnimation"},origins:{"web-scene":{read:!1,write:!1}}}})],t.prototype,"useViewTime",void 0),t=u([$("esri.layers.mixins.TemporalLayer")],t),t};var OY;let _y=OY=class extends ye{constructor(e){super(e)}clone(){const{name:e,fields:t,isAscending:r,isUnique:i,description:s}=this;return new OY({name:e,fields:t,isAscending:r,isUnique:i,description:s})}};u([d({constructOnly:!0})],_y.prototype,"name",void 0),u([d({constructOnly:!0})],_y.prototype,"fields",void 0),u([d({constructOnly:!0})],_y.prototype,"isAscending",void 0),u([d({constructOnly:!0})],_y.prototype,"isUnique",void 0),u([d({constructOnly:!0})],_y.prototype,"description",void 0),_y=OY=u([$("esri.layers.support.FeatureIndex")],_y);let Wy=class extends ye{constructor(){super(...arguments),this.type=null}};u([d({type:["selection","cluster","binning"],readOnly:!0,json:{read:!1,write:!0}})],Wy.prototype,"type",void 0),Wy=u([$("esri.layers.support.FeatureReduction")],Wy);var MY;let z2=MY=class extends ye{constructor(){super(...arguments),this.statisticType=null,this.onStatisticField=null,this.onStatisticValueExpression=null}clone(){return new MY({statisticType:this.statisticType,onStatisticField:this.onStatisticField,onStatisticValueExpression:this.onStatisticValueExpression})}};u([d({type:String,json:{write:!0}})],z2.prototype,"statisticType",void 0),u([d({type:String,json:{write:!0}})],z2.prototype,"onStatisticField",void 0),u([d({type:String,json:{write:!0}})],z2.prototype,"onStatisticValueExpression",void 0),z2=MY=u([$("esri.layers.support.OutStatistic")],z2);const $et=z2;var PY;let KM=PY=class extends ye{constructor(){super(...arguments),this.name=null,this.outStatistic=null}clone(){return new PY({name:this.name,outStatistic:this.outStatistic.clone()})}};u([d({type:String,json:{write:!0}})],KM.prototype,"name",void 0),u([d({type:$et,json:{write:!0}})],KM.prototype,"outStatistic",void 0),KM=PY=u([$("esri.layers.support.AggregateField")],KM);const EAe=KM,Fre="__begin__",kre="__end__",Let=new RegExp(Fre,"ig"),Det=new RegExp(kre,"ig"),Que=new RegExp("^"+Fre,"i"),Jue=new RegExp(kre+"$","i"),yV='"',Net=yV+" + ",Fet=" + "+yV;function ket(e){return e.replace(new RegExp("\\[","g"),"{").replace(new RegExp("\\]","g"),"}")}function Uet(e){return e.replace(new RegExp("\\{","g"),"[").replace(new RegExp("\\}","g"),"]")}function iB(e){const t={expression:"",type:"none"};return e.labelExpressionInfo?e.labelExpressionInfo.value?(t.expression=e.labelExpressionInfo.value,t.type="conventional"):e.labelExpressionInfo.expression&&(t.expression=e.labelExpressionInfo.expression,t.type="arcade"):e.labelExpression!=null&&(t.expression=ket(e.labelExpression),t.type="conventional"),t}function Vet(e){const t=iB(e);if(!t)return null;switch(t.type){case"conventional":return IY(t.expression);case"arcade":return t.expression}return null}function zet(e){const t=iB(e);if(!t)return null;switch(t.type){case"conventional":return Get(t.expression);case"arcade":return Ure(t.expression)}return null}function IY(e){let t;return e?(t=Zm(e,r=>Fre+'$feature["'+r+'"]'+kre),t=Que.test(t)?t.replace(Que,""):yV+t,t=Jue.test(t)?t.replace(Jue,""):t+yV,t=t.replace(Let,Net).replace(Det,Fet)):t='""',t}const Bet=/^\s*\{([^}]+)\}\s*$/i;function Get(e){const t=e.match(Bet);return t&&t[1].trim()||null}const jet=/^\s*(?:(?:\$feature\.(\w+))|(?:\$feature\[(["'])([\w\s]+)(\2)\]));?\s*$/i,Het=/^\s*(?:(?:\$feature\.(\w+))|(?:\$feature\[(["'])([\w\s]+)(\2)\]));?\s*(?:DomainName\(\s*\$feature\s*,\s*(["'])(\1|\3)(\5)\s*\));?\s*$/i,qet=/^\s*(?:DomainName\(\s*\$feature\s*,\s*(["'])([\w\s]+)(\1)\s*\));?\s*$/i;function Ure(e){if(!e)return null;let t=jet.exec(e)||Het.exec(e);return t?t[1]||t[3]:(t=qet.exec(e),t?t[2]:null)}var $Y;let Bv=$Y=class extends ye{constructor(){super(...arguments),this.expression=null,this.title=null,this.value=null}readExpression(e,t){return t.value?IY(t.value):e}writeExpression(e,t,r){this.value!=null&&(e=IY(this.value)),e!=null&&(t[r]=e)}clone(){return new $Y({expression:this.expression,title:this.title,value:this.value})}};u([d({type:String,json:{write:{writerEnsuresNonNull:!0}}})],Bv.prototype,"expression",void 0),u([$e("expression",["expression","value"])],Bv.prototype,"readExpression",null),u([Xe("expression")],Bv.prototype,"writeExpression",null),u([d({type:String,json:{write:!0,origins:{"web-scene":{write:!1}}}})],Bv.prototype,"title",void 0),u([d({json:{read:!1,write:!1}})],Bv.prototype,"value",void 0),Bv=$Y=u([$("esri.layers.support.LabelExpressionInfo")],Bv);const CAe=Bv,AAe=[252,146,31,255],MLt=[153,153,153,255],RAe={type:"esriSMS",style:"esriSMSCircle",size:6,color:AAe,outline:{type:"esriSLS",style:"esriSLSSolid",width:.75,color:[153,153,153,255]}},OAe={type:"esriSLS",style:"esriSLSSolid",width:.75,color:AAe},MAe={type:"esriSFS",style:"esriSFSSolid",color:[252,146,31,196],outline:{type:"esriSLS",style:"esriSLSSolid",width:.75,color:[255,255,255,191]}},Wet={type:"esriTS",color:[255,255,255,255],font:{family:"arial-unicode-ms",size:10,weight:"bold"},horizontalAlignment:"center",kerning:!0,haloColor:[0,0,0,255],haloSize:1,rotated:!1,text:"",xoffset:0,yoffset:0,angle:0},Xet={type:"esriSMS",style:"esriSMSCircle",color:[0,0,0,255],outline:null,size:10.5},Zet={type:"esriSLS",style:"esriSLSSolid",color:[0,0,0,255],width:1.5},Yet={type:"esriSFS",style:"esriSFSSolid",color:[0,0,0,255],outline:null},PLt=eu.fromJSON(RAe),ILt=cu.fromJSON(OAe),$Lt=mg.fromJSON(MAe),Qet=hR.fromJSON(Wet);eu.fromJSON(Xet);cu.fromJSON(Zet);mg.fromJSON(Yet);var LY;const cN=new Tr({esriServerPointLabelPlacementAboveCenter:"above-center",esriServerPointLabelPlacementAboveLeft:"above-left",esriServerPointLabelPlacementAboveRight:"above-right",esriServerPointLabelPlacementBelowCenter:"below-center",esriServerPointLabelPlacementBelowLeft:"below-left",esriServerPointLabelPlacementBelowRight:"below-right",esriServerPointLabelPlacementCenterCenter:"center-center",esriServerPointLabelPlacementCenterLeft:"center-left",esriServerPointLabelPlacementCenterRight:"center-right",esriServerLinePlacementAboveAfter:"above-after",esriServerLinePlacementAboveAlong:"above-along",esriServerLinePlacementAboveBefore:"above-before",esriServerLinePlacementAboveStart:"above-start",esriServerLinePlacementAboveEnd:"above-end",esriServerLinePlacementBelowAfter:"below-after",esriServerLinePlacementBelowAlong:"below-along",esriServerLinePlacementBelowBefore:"below-before",esriServerLinePlacementBelowStart:"below-start",esriServerLinePlacementBelowEnd:"below-end",esriServerLinePlacementCenterAfter:"center-after",esriServerLinePlacementCenterAlong:"center-along",esriServerLinePlacementCenterBefore:"center-before",esriServerLinePlacementCenterStart:"center-start",esriServerLinePlacementCenterEnd:"center-end",esriServerPolygonPlacementAlwaysHorizontal:"always-horizontal"},{ignoreUnknown:!0});function PAe(e){var t;return!e||e.origin!=="service"&&((t=e.layer)==null?void 0:t.type)!=="map-image"}function Jet(e){return(e==null?void 0:e.type)==="map-image"}function IAe(e){var t,r;return!!Jet(e)&&!!((r=(t=e.capabilities)==null?void 0:t.exportMap)!=null&&r.supportsArcadeExpressionForLabeling)}function Ket(e){return PAe(e)||IAe(e.layer)}let an=LY=class extends ye{constructor(e){super(e),this.type="label",this.name=null,this.allowOverrun=!1,this.deconflictionStrategy="static",this.labelExpression=null,this.labelExpressionInfo=null,this.labelPlacement=null,this.labelPosition="curved",this.maxScale=0,this.minScale=0,this.repeatLabel=!0,this.repeatLabelDistance=null,this.symbol=Qet,this.useCodedValues=void 0,this.where=null}static evaluateWhere(e,t){const r=(i,s,n)=>{switch(s){case"=":return i==n;case"<>":return i!=n;case">":return i>n;case">=":return i>=n;case"<":return i<n;case"<=":return i<=n}return!1};try{if(e==null)return!0;const i=e.split(" ");if(i.length===3)return r(t[i[0]],i[1],i[2]);if(i.length===7){const s=r(t[i[0]],i[1],i[2]),n=i[3],o=r(t[i[4]],i[5],i[6]);switch(n){case"AND":return s&&o;case"OR":return s||o}}return!1}catch{console.log("Error.: can't parse = "+e)}}readLabelExpression(e,t){const r=t.labelExpressionInfo;if(!r||!r.value&&!r.expression)return e}writeLabelExpression(e,t,r){if(this.labelExpressionInfo){if(this.labelExpressionInfo.value!=null)e=Uet(this.labelExpressionInfo.value);else if(this.labelExpressionInfo.expression!=null){const i=Ure(this.labelExpressionInfo.expression);i&&(e="["+i+"]")}}e!=null&&(t[r]=e)}writeLabelExpressionInfo(e,t,r,i){if(e==null&&this.labelExpression!=null&&PAe(i))e=new CAe({expression:this.getLabelExpressionArcade()});else if(!e)return;const s=e.toJSON(i);s.expression&&(t[r]=s)}writeMaxScale(e,t){(e||this.minScale)&&(t.maxScale=e)}writeMinScale(e,t){(e||this.maxScale)&&(t.minScale=e)}getLabelExpression(){return iB(this)}getLabelExpressionArcade(){return Vet(this)}getLabelExpressionSingleField(){return zet(this)}hash(){return JSON.stringify(this)}clone(){return new LY({allowOverrun:this.allowOverrun,deconflictionStrategy:this.deconflictionStrategy,labelExpression:this.labelExpression,labelExpressionInfo:re(this.labelExpressionInfo),labelPosition:this.labelPosition,labelPlacement:this.labelPlacement,maxScale:this.maxScale,minScale:this.minScale,name:this.name,repeatLabel:this.repeatLabel,repeatLabelDistance:this.repeatLabelDistance,symbol:re(this.symbol),where:this.where,useCodedValues:this.useCodedValues})}};u([d({type:String,json:{write:!0}})],an.prototype,"name",void 0),u([d({type:Boolean,json:{write:!0,default:!1,origins:{"web-scene":{write:!1}}}})],an.prototype,"allowOverrun",void 0),u([d({type:String,json:{write:!0,default:"static",origins:{"web-scene":{write:!1}}}})],an.prototype,"deconflictionStrategy",void 0),u([d({type:String,json:{write:{overridePolicy(e,t,r){return this.labelExpressionInfo&&(r==null?void 0:r.origin)==="service"&&IAe(r.layer)?{enabled:!1}:{allowNull:!0}}}}})],an.prototype,"labelExpression",void 0),u([$e("labelExpression")],an.prototype,"readLabelExpression",null),u([Xe("labelExpression")],an.prototype,"writeLabelExpression",null),u([d({type:CAe,json:{write:{overridePolicy:(e,t,r)=>Ket(r)?{allowNull:!0}:{enabled:!1}}}})],an.prototype,"labelExpressionInfo",void 0),u([Xe("labelExpressionInfo")],an.prototype,"writeLabelExpressionInfo",null),u([d({type:cN.apiValues,json:{type:cN.jsonValues,read:cN.read,write:cN.write}})],an.prototype,"labelPlacement",void 0),u([d({type:["curved","parallel"],json:{write:!0,origins:{"web-map":{write:!1},"web-scene":{write:!1},"portal-item":{write:!1}}}})],an.prototype,"labelPosition",void 0),u([d({type:Number})],an.prototype,"maxScale",void 0),u([Xe("maxScale")],an.prototype,"writeMaxScale",null),u([d({type:Number})],an.prototype,"minScale",void 0),u([Xe("minScale")],an.prototype,"writeMinScale",null),u([d({type:Boolean,json:{write:!0,origins:{"web-scene":{write:!1},"portal-item":{write:!1}}}})],an.prototype,"repeatLabel",void 0),u([d({type:Number,cast:si,json:{write:!0,origins:{"web-scene":{write:!1}}}})],an.prototype,"repeatLabelDistance",void 0),u([d({types:t8e,json:{origins:{"web-scene":{types:r8e,write:Rue,default:null}},write:Rue,default:null}})],an.prototype,"symbol",void 0),u([d({type:Boolean,json:{write:!0}})],an.prototype,"useCodedValues",void 0),u([d({type:String,json:{write:!0}})],an.prototype,"where",void 0),an=LY=u([$("esri.layers.support.LabelClass")],an);const SR=an;var DY;let Ep=DY=class extends Wy{constructor(e){super(e),this.type="binning",this.fixedBinLevel=3,this.labelingInfo=null,this.labelsVisible=!0,this.popupEnabled=!0,this.popupTemplate=null,this.fields=[],this.renderer=null}clone(){return new DY({fields:re(this.fields),fixedBinLevel:this.fixedBinLevel,labelingInfo:re(this.labelingInfo),labelsVisible:this.labelsVisible,popupEnabled:this.popupEnabled,popupTemplate:re(this.popupTemplate),renderer:re(this.renderer)})}};u([lt({binning:"binning"})],Ep.prototype,"type",void 0),u([d({type:Number,json:{write:!0}})],Ep.prototype,"fixedBinLevel",void 0),u([d({type:[SR],json:{read:{source:"drawingInfo.labelingInfo"},write:{target:"drawingInfo.labelingInfo"}}})],Ep.prototype,"labelingInfo",void 0),u([d(dL)],Ep.prototype,"labelsVisible",void 0),u([d(hL)],Ep.prototype,"popupEnabled",void 0),u([d({type:qT,json:{name:"popupInfo",write:!0}})],Ep.prototype,"popupTemplate",void 0),u([d({type:[EAe],json:{write:!0,origins:{"web-document":{write:!1},"portal-item":{write:!1}}}})],Ep.prototype,"fields",void 0),u([d({types:uL,json:{write:!0}})],Ep.prototype,"renderer",void 0),Ep=DY=u([$("esri.layers.support.FeatureReductionBinning")],Ep);const ett=Ep;var NY;let Ec=NY=class extends ye{constructor(e){super(e),this.type="cluster",this.clusterRadius=si("80px"),this.clusterMinSize=si("12px"),this.clusterMaxSize=si("50px"),this.popupEnabled=!0,this.popupTemplate=null,this.symbol=null,this.labelingInfo=null,this.labelsVisible=!0,this.fields=null}clone(){return new NY({clusterRadius:this.clusterRadius,clusterMinSize:this.clusterMinSize,clusterMaxSize:this.clusterMaxSize,labelingInfo:re(this.labelingInfo),labelsVisible:this.labelsVisible,fields:re(this.fields),renderer:re(this.renderer),popupEnabled:this.popupEnabled,popupTemplate:re(this.popupTemplate)})}};u([d({type:["cluster"],readOnly:!0,json:{write:!0}})],Ec.prototype,"type",void 0),u([d({type:Number,cast:e=>e==="auto"?e:si(e),json:{write:!0}})],Ec.prototype,"clusterRadius",void 0),u([d({type:Number,cast:si,json:{write:!0}})],Ec.prototype,"clusterMinSize",void 0),u([d({type:Number,cast:si,json:{write:!0}})],Ec.prototype,"clusterMaxSize",void 0),u([d(hL)],Ec.prototype,"popupEnabled",void 0),u([d({type:qT,json:{read:{source:"popupInfo"},write:{target:"popupInfo"}}})],Ec.prototype,"popupTemplate",void 0),u([d({types:uL,json:{write:!0}})],Ec.prototype,"renderer",void 0),u([d({types:KBe})],Ec.prototype,"symbol",void 0),u([d({type:[SR],json:{read:{source:"drawingInfo.labelingInfo"},write:{target:"drawingInfo.labelingInfo"}}})],Ec.prototype,"labelingInfo",void 0),u([d(dL)],Ec.prototype,"labelsVisible",void 0),u([d({type:[EAe],json:{write:!0,origins:{"web-document":{write:!1},"portal-item":{write:!1}}}})],Ec.prototype,"fields",void 0),Ec=NY=u([$("esri.layers.support.FeatureReductionCluster")],Ec);const $Ae=Ec;var FY;let I5=FY=class extends Wy{constructor(e){super(e),this.type="selection"}clone(){return new FY}};u([d({type:["selection"]})],I5.prototype,"type",void 0),I5=FY=u([$("esri.layers.support.FeatureReductionSelection")],I5);const kY=I5,Kue={key:"type",base:Wy,typeMap:{selection:$Ae}},LAe={types:{key:"type",base:Wy,typeMap:{selection:kY,cluster:$Ae,binning:ett}},json:{name:"layerDefinition.featureReduction",write:{allowNull:!0},origins:{"web-map":{types:Kue},"portal-item":{types:Kue},"web-scene":{types:{key:"type",base:Wy,typeMap:{selection:kY}}}}}},ehe=new Tr({esriFeatureEditToolAutoCompletePolygon:"auto-complete-polygon",esriFeatureEditToolCircle:"circle",esriFeatureEditToolEllipse:"ellipse",esriFeatureEditToolFreehand:"freehand",esriFeatureEditToolLine:"line",esriFeatureEditToolNone:"none",esriFeatureEditToolPoint:"point",esriFeatureEditToolPolygon:"polygon",esriFeatureEditToolRectangle:"rectangle",esriFeatureEditToolArrow:"arrow",esriFeatureEditToolTriangle:"triangle",esriFeatureEditToolLeftArrow:"left-arrow",esriFeatureEditToolRightArrow:"right-arrow",esriFeatureEditToolUpArrow:"up-arrow",esriFeatureEditToolDownArrow:"down-arrow"});let Gv=class extends au(ye){constructor(e){super(e),this.name=null,this.description=null,this.drawingTool=null,this.prototype=null,this.thumbnail=null}};u([d({json:{write:!0}})],Gv.prototype,"name",void 0),u([d({json:{write:!0}})],Gv.prototype,"description",void 0),u([d({json:{read:ehe.read,write:ehe.write}})],Gv.prototype,"drawingTool",void 0),u([d({json:{write:!0}})],Gv.prototype,"prototype",void 0),u([d({json:{write:!0}})],Gv.prototype,"thumbnail",void 0),Gv=u([$("esri.layers.support.FeatureTemplate")],Gv);const sB=Gv;let ry=class extends au(ye){constructor(e){super(e),this.id=null,this.name=null,this.domains=null,this.templates=null}readDomains(e){const t={};for(const r of Object.keys(e))t[r]=Yte(e[r]);return t}writeDomains(e,t){var i;const r={};for(const s of Object.keys(e))e[s]&&(r[s]=(i=e[s])==null?void 0:i.toJSON());t.domains=r}};u([d({json:{write:!0}})],ry.prototype,"id",void 0),u([d({json:{write:!0}})],ry.prototype,"name",void 0),u([d({json:{write:!0}})],ry.prototype,"domains",void 0),u([$e("domains")],ry.prototype,"readDomains",null),u([Xe("domains")],ry.prototype,"writeDomains",null),u([d({type:[sB],json:{write:!0}})],ry.prototype,"templates",void 0),ry=u([$("esri.layers.support.FeatureType")],ry);const Vre=ry;function ttt(e){return e.type==="date"||e.type==="esriFieldTypeDate"}function the(e){return e.type==="oid"||e.type==="esriFieldTypeOID"}function rhe(e){return e.type==="global-id"||e.type==="esriFieldTypeGlobalID"}class DAe{constructor(t){if(this.fields=t,this._fieldsMap=new Map,this._dateFieldsSet=new Set,this._numericFieldsSet=new Set,this.dateFields=[],this.numericFields=[],this._requiredFields=null,!t)return;const r=[];for(const i of t){const s=i&&i.name;if(s){const n=ihe(s);this._fieldsMap.set(s,i),this._fieldsMap.set(n,i),r.push(n),ttt(i)?(this.dateFields.push(i),this._dateFieldsSet.add(i)):r6(i)&&(this._numericFieldsSet.add(i),this.numericFields.push(i)),the(i)||rhe(i)||(i.editable=i.editable==null||!!i.editable,i.nullable=i.nullable==null||!!i.nullable)}}r.sort(),this.uid=r.join(",")}destroy(){this._fieldsMap.clear()}get requiredFields(){if(!this._requiredFields){this._requiredFields=[];for(const t of this.fields)the(t)||rhe(t)||t.nullable||T6e(t)!==void 0||this._requiredFields.push(t)}return this._requiredFields}has(t){return this.get(t)!=null}get(t){return t!=null?this._fieldsMap.get(t)||this._fieldsMap.get(ihe(t)):void 0}isDateField(t){return this._dateFieldsSet.has(this.get(t))}isNumericField(t){return this._numericFieldsSet.has(this.get(t))}normalizeFieldName(t){const r=this.get(t);if(r)return r.name}}function ihe(e){return e.toLowerCase().trim()}const rtt=fe.getLogger("esri.layers.support.fieldProperties");function zre(){return{fields:{type:[gR],value:null},fieldsIndex:{readOnly:!0,get(){return new DAe(this.fields||[])}},outFields:{type:[String],json:{read:!1},set:function(e){this._userOutFields=e,this.notifyChange("outFields")},get:function(){const e=this._userOutFields;if(!e||!e.length)return null;if(e.includes("*"))return["*"];if(!this.fields)return e;for(const t of e)this.fieldsIndex.has(t)||rtt.error("field-attributes-layer:invalid-field",`Invalid field ${t} found in outFields`,{layer:this,outFields:e});return _we(this.fieldsIndex,e)}}}}let B2=class extends au(ye){constructor(e){super(e),this.shapeAreaField=null,this.shapeLengthField=null,this.units=null}};u([d({type:String,json:{read:{source:"shapeAreaFieldName"}}})],B2.prototype,"shapeAreaField",void 0),u([d({type:String,json:{read:{source:"shapeLengthFieldName"}}})],B2.prototype,"shapeLengthField",void 0),u([d({type:String,json:{read:e=>Q8e.read(e)||J8e.read(e)}})],B2.prototype,"units",void 0),B2=u([$("esri.layers.support.GeometryFieldsInfo")],B2);const itt=B2,stt=/\[([^\[\]]+)\]/gi;function OI(e,t,r){return e?e.map(i=>{const s=new SR;if(s.read(i,r),s.labelExpression){const n=t.fields||t.layerDefinition&&t.layerDefinition.fields||this.fields;s.labelExpression=s.labelExpression.replace(stt,(o,a)=>`[${ntt(a,n)}]`)}return s}):null}function ntt(e,t){if(!t)return e;const r=e.toLowerCase();for(let i=0;i<t.length;i++){const s=t[i].name;if(s.toLowerCase()===r)return s}return e}var UY;let G2=UY=class extends ye{constructor(e){super(e),this.floorField=null,this.viewAllMode=!1,this.viewAllLevelIds=new ot}clone(){return new UY({floorField:this.floorField,viewAllMode:this.viewAllMode,viewAllLevelIds:this.viewAllLevelIds})}};u([d({type:String,json:{write:!0}})],G2.prototype,"floorField",void 0),u([d({json:{read:!1,write:!1}})],G2.prototype,"viewAllMode",void 0),u([d({json:{read:!1,write:!1}})],G2.prototype,"viewAllLevelIds",void 0),G2=UY=u([$("esri.layers.support.LayerFloorInfo")],G2);const NAe=G2,she=new Tr({esriRelCardinalityOneToOne:"one-to-one",esriRelCardinalityOneToMany:"one-to-many",esriRelCardinalityManyToMany:"many-to-many"}),nhe=new Tr({esriRelRoleOrigin:"origin",esriRelRoleDestination:"destination"});let Yh=class extends au(ye){constructor(e){super(e),this.cardinality=null,this.composite=null,this.id=null,this.keyField=null,this.keyFieldInRelationshipTable=null,this.name=null,this.relatedTableId=null,this.relationshipTableId=null,this.role=null}};u([d({json:{read:she.read,write:she.write}})],Yh.prototype,"cardinality",void 0),u([d({json:{read:!0,write:!0}})],Yh.prototype,"composite",void 0),u([d({json:{read:!0,write:!0}})],Yh.prototype,"id",void 0),u([d({json:{read:!0,write:!0}})],Yh.prototype,"keyField",void 0),u([d({json:{read:!0,write:!0}})],Yh.prototype,"keyFieldInRelationshipTable",void 0),u([d({json:{read:!0,write:!0}})],Yh.prototype,"name",void 0),u([d({json:{read:!0,write:!0}})],Yh.prototype,"relatedTableId",void 0),u([d({json:{read:!0,write:!0}})],Yh.prototype,"relationshipTableId",void 0),u([d({json:{read:nhe.read,write:nhe.write}})],Yh.prototype,"role",void 0),Yh=u([$("esri.layers.support.Relationship")],Yh);const ott=Yh,Cp=[];function att(e,t){if(cAe(e.url))return!0;const{wkid:r}=t;for(const i of Cp){if(e.version>=i[0])return!0;if(typeof i[1]=="function"&&(i[1]=i[1]()),i[1].has(r))return!1}return!0}Cp.push([10.91,()=>{const e=new Set([9709,9716,9741,9761,9766]);for(let t=9712;t<=9713;t++)e.add(t);for(let t=9748;t<=9749;t++)e.add(t);for(let t=20904;t<=20932;t++)e.add(t);for(let t=21004;t<=21032;t++)e.add(t);for(let t=21207;t<=21264;t++)e.add(t);for(let t=21307;t<=21364;t++)e.add(t);for(let t=102759;t<=102760;t++)e.add(t);for(let t=102901;t<=102955;t++)e.add(t);return e}]),Cp.push([10.9,()=>{const e=new Set([9300,9354,9364,9367,9373,9377,9387,9456,9473,9498,9678,9680,29874,103599,103872,104028]);for(let t=9356;t<=9360;t++)e.add(t);for(let t=9404;t<=9407;t++)e.add(t);for(let t=9476;t<=9482;t++)e.add(t);for(let t=9487;t<=9494;t++)e.add(t);for(let t=9697;t<=9699;t++)e.add(t);return e}]),Cp.push([10.81,()=>{const e=new Set([9265,9333,103598,103699]);for(let t=9248;t<=9254;t++)e.add(t);for(let t=9271;t<=9273;t++)e.add(t);for(let t=9284;t<=9285;t++)e.add(t);for(let t=21453;t<=21463;t++)e.add(t);return e}]),Cp.push([10.8,()=>{const e=new Set([8088,8395,8428,8433,8531,8687,8692,8694,8699,8900,9003,9006,9009,9012,9017,9191]);for(let t=8035;t<=8036;t++)e.add(t);for(let t=8455;t<=8456;t++)e.add(t);for(let t=8518;t<=8529;t++)e.add(t);for(let t=8533;t<=8536;t++)e.add(t);for(let t=8538;t<=8540;t++)e.add(t);for(let t=8677;t<=8679;t++)e.add(t);for(let t=8902;t<=8903;t++)e.add(t);for(let t=8907;t<=8910;t++)e.add(t);for(let t=8949;t<=8951;t++)e.add(t);for(let t=8972;t<=8987;t++)e.add(t);for(let t=9039;t<=9040;t++)e.add(t);for(let t=9068;t<=9069;t++)e.add(t);for(let t=9140;t<=9141;t++)e.add(t);for(let t=9148;t<=9150;t++)e.add(t);for(let t=9153;t<=9159;t++)e.add(t);for(let t=9205;t<=9218;t++)e.add(t);for(let t=9221;t<=9222;t++)e.add(t);for(let t=54098;t<=54101;t++)e.add(t);return e}]),Cp.push([10.71,()=>{const e=new Set([6316]);for(let t=8351;t<=8353;t++)e.add(t);for(let t=9294;t<=9297;t++)e.add(t);for(let t=103586;t<=103594;t++)e.add(t);for(let t=103696;t<=103698;t++)e.add(t);return e}]),Cp.push([10.7,()=>{const e=new Set([8387,8391,8427,8545,8682,8685,8818,31370,104022,104024,104975]);for(let t=8065;t<=8068;t++)e.add(t);for(let t=8082;t<=8083;t++)e.add(t);for(let t=8379;t<=8385;t++)e.add(t);for(let t=8836;t<=8840;t++)e.add(t);for(let t=8857;t<=8860;t++)e.add(t);for(let t=53035;t<=53037;t++)e.add(t);for(let t=54090;t<=54091;t++)e.add(t);for(let t=102498;t<=102499;t++)e.add(t);return e}]),Cp.push([10.61,()=>new Set([102497])]),Cp.push([10.6,()=>{const e=new Set([7803,7805,7887,8086,8232,8237,8240,8246,8249,8252,8255,9019,9391]);for(let t=7755;t<=7787;t++)e.add(t);for(let t=7791;t<=7795;t++)e.add(t);for(let t=7799;t<=7801;t++)e.add(t);for(let t=7825;t<=7831;t++)e.add(t);for(let t=7877;t<=7878;t++)e.add(t);for(let t=7882;t<=7883;t++)e.add(t);for(let t=7991;t<=7992;t++)e.add(t);for(let t=8042;t<=8043;t++)e.add(t);for(let t=8058;t<=8059;t++)e.add(t);for(let t=8311;t<=8348;t++)e.add(t);for(let t=9060;t<=9067;t++)e.add(t);for(let t=102562;t<=102568;t++)e.add(t);for(let t=102799;t<=102900;t++)e.add(t);return e}]),Cp.push([10.51,()=>{const e=new Set([7683,7881,7886,7899,8888,9e3]);for(let t=8013;t<=8032;t++)e.add(t);for(let t=9053;t<=9057;t++)e.add(t);for(let t=104017;t<=104018;t++)e.add(t);for(let t=104971;t<=104974;t++)e.add(t);return e}]),Cp.push([10.5,()=>{const e=new Set([6962,7035,7037,7039,7041,7084,7086,7133,7798,102399]);for(let t=4087;t<=4088;t++)e.add(t);for(let t=5896;t<=5899;t++)e.add(t);for(let t=7005;t<=7007;t++)e.add(t);for(let t=7057;t<=7070;t++)e.add(t);for(let t=7073;t<=7082;t++)e.add(t);for(let t=7109;t<=7128;t++)e.add(t);for(let t=7844;t<=7859;t++)e.add(t);return e}]);async function FAe(e,t,r){const i=e&&e.getAtOrigin&&e.getAtOrigin("renderer",t.origin);if(i&&i.type==="unique-value"&&i.styleOrigin){const s=await yh(i.populateFromStyle());if(Jt(r),s.ok===!1){const n=s.error;t&&t.messages&&t.messages.push(new ic("renderer:style-reference",`Failed to create unique value renderer from style reference: ${n.message}`,{error:n,context:t})),e.clear("renderer",t.origin)}}}const ltt=["oid","global-id"],ctt=["oid","global-id","guid"];function Bre({displayField:e,editFieldsInfo:t,fields:r,objectIdField:i,title:s},n){if(!r)return null;const o=mtt({editFieldsInfo:t,fields:r,objectIdField:i},n);if(!o.length)return null;const a=vtt({titleBase:s,fields:r,displayField:e}),l=ytt();return new qT({title:a,content:l,fieldInfos:o})}const utt=[/^fnode_$/i,/^tnode_$/i,/^lpoly_$/i,/^rpoly_$/i,/^poly_$/i,/^subclass$/i,/^subclass_$/i,/^rings_ok$/i,/^rings_nok$/i,/shape/i,/perimeter/i,/objectid/i,/_i$/i],htt=(e,{editFieldsInfo:t,objectIdField:r,visibleFieldNames:i})=>i?i.has(e.name):!kAe(e.name,t)&&(!r||e.name!==r)&&!ltt.includes(e.type)&&!utt.some(s=>s.test(e.name));function dtt(e,t){const r=e;return t&&(e=e.filter(i=>!t.includes(i.type))),e===r&&(e=e.slice()),e.sort(ptt),e}function ptt(e,t){return e.type==="oid"?-1:t.type==="oid"?1:ohe(e)?-1:ohe(t)?1:(e.alias||e.name).toLocaleLowerCase().localeCompare((t.alias||t.name).toLocaleLowerCase())}function kAe(e,t){if(!e||!t)return!1;const{creationDateField:r,creatorField:i,editDateField:s,editorField:n}=t;return[r&&r.toLowerCase(),i&&i.toLowerCase(),s&&s.toLowerCase(),n&&n.toLowerCase()].includes(e.toLowerCase())}function ftt(e,t){return e.editable&&!ctt.includes(e.type)&&!kAe(e.name,t)}function mtt({editFieldsInfo:e,fields:t,objectIdField:r},i){return dtt(t,(i==null?void 0:i.ignoreFieldTypes)||_tt).map(s=>new W$({fieldName:s.name,isEditable:ftt(s,e),label:s.alias,format:gtt(s),visible:htt(s,{editFieldsInfo:e,objectIdField:r,visibleFieldNames:i==null?void 0:i.visibleFieldNames})}))}function gtt(e){switch(e.type){case"small-integer":case"integer":case"single":return new EE({digitSeparator:!0,places:0});case"double":return new EE({digitSeparator:!0,places:2});case"date":return new EE({dateFormat:"long-month-day-year"});default:return e.type==="string"&&Ewe(e.name)?new EE({digitSeparator:!0,places:0}):null}}function ytt(){return[new iA,new lI]}function vtt(e){const t=v6e(e),{titleBase:r}=e;return t?`${r}: {${t.trim()}}`:r}function ohe(e){return(e.name&&e.name.toLowerCase())==="name"?!0:(e.alias&&e.alias.toLowerCase())==="name"||void 0}const _tt=["geometry","blob","raster","guid","xml"],GG=new Tr({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryMultiPatch:"multipatch"}),btt={name:"supportsName",size:"supportsSize",contentType:"supportsContentType",keywords:"supportsKeywords",exifInfo:"supportsExifInfo"},on="FeatureLayer",ahe=fe.getLogger("esri.layers.FeatureLayer");function uN(e,t){return new j("layer:unsupported",`Layer (${e.title}, ${e.id}) of type '${e.declaredClass}' ${t}`,{layer:e})}function lhe(e){return e&&e instanceof ot}function Vt(e,t,r){return!!(e&&e.hasOwnProperty(t)?e[t]:r)}function hN(e,t,r){return e&&e.hasOwnProperty(t)?e[t]:r}function wtt(e){var r;const t=(r=e==null?void 0:e.supportedSpatialAggregationStatistics)==null?void 0:r.map(i=>i.toLowerCase());return{envelope:!!(t!=null&&t.includes("envelopeaggregate")),centroid:!!(t!=null&&t.includes("centroidaggregate")),convexHull:!!(t!=null&&t.includes("convexhullaggregate"))}}function uO(e,t){var i;const r=(i=e==null?void 0:e.supportedOperationsWithCacheHint)==null?void 0:i.map(s=>s.toLowerCase());return!!(r!=null&&r.includes(t.toLowerCase()))}const jG=zre();function HG(e,t,r){const i=!!(r!=null&&r.writeLayerSchema);return{enabled:i,ignoreOrigin:i}}let Ie=class extends mAe(pAe(vAe(SAe(Nre(xAe(dAe(Dre(_Ae(tB(fAe(sAe(au(eA))))))))))))){constructor(...e){super(...e),this._handles=new Dt,this.capabilities=null,this.charts=null,this.copyright=null,this.datesInUnknownTimezone=!1,this.displayField=null,this.definitionExpression=null,this.dynamicDataSource=null,this.editFieldsInfo=null,this.editingInfo=null,this.elevationInfo=null,this.featureReduction=null,this.fields=null,this.fieldsIndex=null,this.floorInfo=null,this.formTemplate=null,this.fullExtent=null,this.gdbVersion=null,this.geometryFieldsInfo=null,this.geometryType=null,this.hasM=void 0,this.hasZ=void 0,this.heightModelInfo=null,this.historicMoment=null,this.infoFor3D=null,this.isTable=!1,this.labelsVisible=!0,this.labelingInfo=null,this.layerId=void 0,this.legendEnabled=!0,this.minScale=0,this.maxScale=0,this.globalIdField=null,this.objectIdField=null,this.outFields=null,this.path=null,this.popupEnabled=!0,this.popupTemplate=null,this.relationships=null,this.sourceJSON=null,this.returnM=void 0,this.returnZ=void 0,this.screenSizePerspectiveEnabled=!0,this.serviceDefinitionExpression=null,this.spatialReference=Ze.WGS84,this.subtypeCode=null,this.subtypeField=null,this.templates=null,this.timeInfo=null,this.title=null,this.sublayerTitleMode="item-title",this.trackIdField=null,this.type="feature",this.typeIdField=null,this.types=null,this.indexes=new(ot.ofType(_y)),this.userIsAdmin=!1,this.version=void 0,this.visible=!0}destroy(){var e;(e=this.source)==null||e.destroy(),this._handles=ct(this._handles)}normalizeCtorArgs(e,t){return typeof e=="string"?{url:e,...t}:e}load(e){const t=b(e)?e.signal:null;if(this.portalItem&&this.portalItem.loaded&&this.source)return void this.addResolvingPromise(this.createGraphicsSource(t).then(i=>this._initLayerProperties(i)));const r=this.loadFromPortal({supportedTypes:["Feature Service","Feature Collection"]},e).catch(ah).then(async()=>{if(this.url&&this.layerId==null&&/FeatureServer|MapServer\/*$/i.test(this.url)){const i=await this._fetchFirstLayerId(t);i!=null&&(this.layerId=i)}if(!this.url&&!this._hasMemorySource())throw new j("feature-layer:missing-url-or-source","Feature layer must be created with either a url or a source");return this._initLayerProperties(await this.createGraphicsSource(t))}).then(()=>this.finishLoadEditablePortalLayer(e));return this.addResolvingPromise(r),Promise.resolve(this)}readCapabilities(e,t){return t=t.layerDefinition||t,{analytics:this._readAnalyticsCapabilities(t),attachment:this._readAttachmentCapabilities(t),data:this._readDataCapabilities(t),metadata:this._readMetadataCapabilities(t),operations:this._readOperationsCapabilities(t.capabilities||e,t),query:this._readQueryCapabilities(t),queryRelated:this._readQueryRelatedCapabilities(t),queryTopFeatures:this._readQueryTopFeaturesCapabilities(t),editing:this._readEditingCapabilities(t)}}get createQueryVersion(){return this.commitProperty("definitionExpression"),this.commitProperty("dynamicDataSource"),this.commitProperty("timeExtent"),this.commitProperty("timeOffset"),this.commitProperty("geometryType"),this.commitProperty("gdbVersion"),this.commitProperty("historicMoment"),this.commitProperty("returnZ"),this.commitProperty("capabilities"),this.commitProperty("returnM"),(this._get("createQueryVersion")||0)+1}get editingEnabled(){return!(this.loaded&&!this.capabilities.operations.supportsEditing)&&(this._isOverridden("editingEnabled")?this._get("editingEnabled"):this._hasMemorySource()||this.userHasEditingPrivileges)}set editingEnabled(e){e!=null?this._override("editingEnabled",e):this._clearOverride("editingEnabled")}readEditingEnabled(e,t){return this._readEditingEnabled(t,!1)}readEditingEnabledFromWebMap(e,t,r){return this._readEditingEnabled(t,!0,r)}writeEditingEnabled(e,t){this._writeEditingEnabled(e,t,!1)}writeEditingEnabledToWebMap(e,t,r,i){this._writeEditingEnabled(e,t,!0,i)}readEditingInfo(e,t){const{editingInfo:r}=t;return r?{lastEditDate:r.lastEditDate!=null?new Date(r.lastEditDate):null}:null}readIsTable(e,t){return(t=t&&t.layerDefinition||t).type==="Table"||!t.geometryType}writeIsTable(e,t,r,i){i!=null&&i.writeLayerSchema&&ru(r,e?"Table":"Feature Layer",t)}readMinScale(e,t){return t.effectiveMinScale||e||0}readMaxScale(e,t){return t.effectiveMaxScale||e||0}readGlobalIdFieldFromService(e,t){if((t=t.layerDefinition||t).globalIdField)return t.globalIdField;if(t.fields){for(const r of t.fields)if(r.type==="esriFieldTypeGlobalID")return r.name}}readObjectIdFieldFromService(e,t){if((t=t.layerDefinition||t).objectIdField)return t.objectIdField;if(t.fields){for(const r of t.fields)if(r.type==="esriFieldTypeOID")return r.name}}get parsedUrl(){const e=this.url?Ds(this.url):null;return e!=null&&(this.dynamicDataSource!=null?e.path=sc(e.path,"dynamicLayer"):this.layerId!=null&&(e.path=sc(e.path,this.layerId.toString()))),e}get defaultPopupTemplate(){return this.createPopupTemplate()}set renderer(e){rA(e,this.fieldsIndex),this._set("renderer",e)}readRenderer(e,t,r){const i=(t=t.layerDefinition||t).drawingInfo&&t.drawingInfo.renderer||void 0;if(i){const s=QCe(i,t,r)||void 0;return s||ahe.error("Failed to create renderer",{rendererDefinition:t.drawingInfo.renderer,layer:this,context:r}),s}if(t.defaultSymbol)return t.types&&t.types.length?new Cre({defaultSymbol:qG(t.defaultSymbol,t,r),field:t.typeIdField,uniqueValueInfos:t.types.map(s=>({id:s.id,symbol:qG(s.symbol,s,r)}))}):new Sre({symbol:qG(t.defaultSymbol,t,r)})}set source(e){const t=this._get("source");t!==e&&(lhe(t)&&this._resetMemorySource(t),lhe(e)&&this._initMemorySource(e),this._set("source",e))}castSource(e){return e?Array.isArray(e)||e instanceof ot?new vy({layer:this,items:e}):e:null}readSource(e,t){const r=rL.fromJSON(t.featureSet);return new vy({layer:this,items:r&&r.features||[]})}readServiceDefinitionExpression(e,t){return t.definitionQuery||t.definitionExpression}readTemplates(e,t){const r=t.editFieldsInfo,i=r&&r.creatorField,s=r&&r.editorField;return e=e&&e.map(n=>sB.fromJSON(n)),this._fixTemplates(e,i),this._fixTemplates(e,s),e}readTitle(e,t){const r=t.layerDefinition&&t.layerDefinition.name||t.name,i=t.title||t.layerDefinition&&t.layerDefinition.title;if(r){const s=this.portalItem&&this.portalItem.title;if(this.sublayerTitleMode==="item-title")return this.url?lAe(this.url,r):r;let n=r;if(!n&&this.url){const o=yT(this.url);b(o)&&(n=o.title)}return n?(this.sublayerTitleMode==="item-title-and-service-name"&&s&&s!==n&&(n=s+" - "+n),rB(n)):void 0}if(this.sublayerTitleMode==="item-title"&&i)return i}readTitleFromWebMap(e,t){return t.title||t.layerDefinition&&t.layerDefinition.name}readTypeIdField(e,t){let r=(t=t.layerDefinition||t).typeIdField;if(r&&t.fields){r=r.toLowerCase();const i=t.fields.find(s=>s.name.toLowerCase()===r);i&&(r=i.name)}return r}readTypes(e,t){e=(t=t.layerDefinition||t).types;const r=t.editFieldsInfo,i=r&&r.creatorField,s=r&&r.editorField;return e&&e.map(n=>(n=Vre.fromJSON(n),this._fixTemplates(n.templates,i),this._fixTemplates(n.templates,s),n))}set url(e){const t=uAe({layer:this,url:e,nonStandardUrlAllowed:!0,logger:ahe});this._set("url",t.url),t.layerId!=null&&this._set("layerId",t.layerId)}writeUrl(e,t,r,i){hAe(this,e,null,t,i)}readVersion(e,t){return t.currentVersion?t.currentVersion:t.hasOwnProperty("capabilities")||t.hasOwnProperty("drawingInfo")||t.hasOwnProperty("hasAttachments")||t.hasOwnProperty("htmlPopupType")||t.hasOwnProperty("relationships")||t.hasOwnProperty("timeInfo")||t.hasOwnProperty("typeIdField")||t.hasOwnProperty("types")?10:9.3}readVisible(e,t){return t.layerDefinition&&t.layerDefinition.defaultVisibility!=null?!!t.layerDefinition.defaultVisibility:t.visibility!=null?!!t.visibility:void 0}addAttachment(e,t){return this.load().then(()=>this._checkAttachmentSupport(e)).then(()=>{if(!("addAttachment"in this.source))throw new j(on,"Layer source does not support addAttachment capability");return this.source.addAttachment(e,t)})}updateAttachment(e,t,r){return this.load().then(()=>this._checkAttachmentSupport(e)).then(()=>{if(!("updateAttachment"in this.source))throw new j(on,"Layer source does not support updateAttachment capability");return this.source.updateAttachment(e,t,r)})}async applyEdits(e,t){const r=await ie(()=>import("./editingSupport.141ffbc0.js"),[],import.meta.url);return await this.load(),r.applyEdits(this,this.source,e,t)}on(e,t){return super.on(e,t)}createPopupTemplate(e){return Bre(this,e)}async createGraphicsSource(e){if(this._hasMemorySource())return this.source.load({signal:e});const{default:t}=await C5e(ie(()=>import("./FeatureLayerSource.308b9cbf.js"),["FeatureLayerSource.308b9cbf.js","executeForIds.72542c04.js"],import.meta.url),e);return new t({layer:this}).load({signal:e})}createQuery(){const e=new Sa,t=this.get("capabilities.data"),r=this.get("capabilities.query");e.dynamicDataSource=this.dynamicDataSource,e.historicMoment=this.historicMoment,e.gdbVersion=this.gdbVersion,e.returnGeometry=!0,r&&(e.compactGeometryEnabled=r.supportsCompactGeometry,e.defaultSpatialReferenceEnabled=r.supportsDefaultSpatialReference),t&&(t.supportsZ&&this.returnZ!=null&&(e.returnZ=this.returnZ),t.supportsM&&this.returnM!=null&&(e.returnM=this.returnM)),e.outFields=["*"];const i=b(this.subtypeCode)?`${this.subtypeField} = ${this.subtypeCode}`:null,s=KCe(this.definitionExpression,i);e.where=s||"1=1";const{timeOffset:n,timeExtent:o}=this;return e.timeExtent=n!=null&&o!=null?o.offset(-n.value,n.unit):o||null,e.multipatchOption=this.geometryType==="multipatch"?"xyFootprint":null,e}deleteAttachments(e,t){return this.load().then(()=>this._checkAttachmentSupport(e)).then(()=>{if(!("deleteAttachments"in this.source))throw new j(on,"Layer source does not support deleteAttachments capability");return this.source.deleteAttachments(e,t)})}fetchRecomputedExtents(e){return this.load({signal:e==null?void 0:e.signal}).then(()=>{if(this.source.fetchRecomputedExtents)return this.source.fetchRecomputedExtents(e);throw new j(on,"Layer source does not support fetchUpdates capability")})}getFeatureType(e){const{typeIdField:t,types:r}=this;if(!t||!e)return null;const i=e.attributes?e.attributes[t]:void 0;if(i==null)return null;let s=null;return r.some(n=>{const{id:o}=n;return o!=null&&(o.toString()===i.toString()&&(s=n),!!s)}),s}getFieldDomain(e,t){const r=t&&t.feature,i=this.getFeatureType(r);if(i){const s=i.domains&&i.domains[e];if(s&&s.type!=="inherited")return s}return this._getLayerDomain(e)}getField(e){return this.fieldsIndex.get(e)}queryAttachments(e,t){return e=XX.from(e),this.load().then(()=>{if(!this.get("capabilities.data.supportsAttachment"))throw new j(on,"this layer doesn't support attachments");const{attachmentTypes:r,objectIds:i,globalIds:s,num:n,size:o,start:a,where:l}=e;if(!this.get("capabilities.operations.supportsQueryAttachments")){const c=i&&i.length>1,h=r&&r.length,p=s&&s.length,f=o&&o.length;if(c||h||p||f||n||a||l)throw new j(on,"when 'supportsQueryAttachments' is false, only objectIds of length 1 are supported",e)}if(!(i&&i.length||l))throw new j(on,"'objectIds' or 'where' are required to perform attachment query",e);if(!("queryAttachments"in this.source))throw new j(on,"Layer source does not support queryAttachments capability",e);return this.source.queryAttachments(e)})}queryFeatures(e,t){return this.load().then(()=>this.source.queryFeatures(Sa.from(e)||this.createQuery(),t)).then(r=>{if(r!=null&&r.features)for(const i of r.features)i.layer=i.sourceLayer=this;return r})}queryObjectIds(e,t){return this.load().then(()=>{if(this.source.queryObjectIds)return this.source.queryObjectIds(Sa.from(e)||this.createQuery(),t);throw new j(on,"Layer source does not support queryObjectIds capability")})}queryFeatureCount(e,t){return this.load().then(()=>{if(this.source.queryFeatureCount)return this.source.queryFeatureCount(Sa.from(e)||this.createQuery(),t);throw new j(on,"Layer source does not support queryFeatureCount capability")})}queryExtent(e,t){return this.load().then(()=>{if(this.source.queryExtent)return this.source.queryExtent(Sa.from(e)||this.createQuery(),t);throw new j(on,"Layer source does not support queryExtent capability")})}queryRelatedFeatures(e,t){return this.load().then(()=>{if("queryRelatedFeatures"in this.source)return this.source.queryRelatedFeatures(TZ.from(e),t);throw new j(on,"Layer source does not support queryRelatedFeatures capability")})}queryRelatedFeaturesCount(e,t){return this.load().then(()=>{if("queryRelatedFeaturesCount"in this.source)return this.source.queryRelatedFeaturesCount(TZ.from(e),t);throw new j(on,"Layer source does not support queryRelatedFeaturesCount capability")})}queryTopFeatures(e,t){return this.load().then(()=>{if("queryTopFeatures"in this.source&&this.get("capabilities.query.supportsTopFeaturesQuery"))return this.source.queryTopFeatures(qD.from(e),t).then(r=>{if(r!=null&&r.features)for(const i of r.features)i.layer=i.sourceLayer=this;return r});throw new j(on,"Layer source does not support queryTopFeatures capability")})}queryTopObjectIds(e,t){return this.load().then(()=>{if("queryTopObjectIds"in this.source&&this.get("capabilities.query.supportsTopFeaturesQuery"))return this.source.queryTopObjectIds(qD.from(e),t);throw new j(on,"Layer source does not support queryTopObjectIds capability")})}queryTopFeaturesExtent(e,t){return this.load().then(()=>{if("queryTopExtents"in this.source&&this.get("capabilities.query.supportsTopFeaturesQuery"))return this.source.queryTopExtents(qD.from(e),t);throw new j(on,"Layer source does not support queryTopExtents capability")})}queryTopFeatureCount(e,t){return this.load().then(()=>{if("queryTopCount"in this.source&&this.get("capabilities.query.supportsTopFeaturesQuery"))return this.source.queryTopCount(qD.from(e),t);throw new j(on,"Layer source does not support queryFeatureCount capability")})}read(e,t){const r=e.featureCollection;if(r){const i=r.layers;i&&i.length===1&&(super.read(i[0],t),r.showLegend!=null&&super.read({showLegend:r.showLegend},t))}super.read(e,t),t&&t.origin==="service"&&this.revert(["objectIdField","fields","timeInfo","spatialReference"],"service")}write(e,t){var n;t={...t,writeLayerSchema:(n=t==null?void 0:t.writeLayerSchema)!=null?n:this._hasMemorySource()};const{origin:r,layerContainerType:i,messages:s}=t;if(this.dynamicDataSource)return s==null||s.push(uN(this,"using a dynamic data source cannot be written to web scenes, web maps and feature service items")),null;if(this.isTable){if(r==="web-scene"||r==="web-map"&&i!=="tables")return s==null||s.push(uN(this,"using a table source cannot be written to web scenes and web maps")),null;if(this._hasMemorySource())return s==null||s.push(uN(this,"using an in-memory table source cannot be written to web scenes and web maps")),null}else if(this.loaded&&r==="web-map"&&i==="tables")return s==null||s.push(uN(this,"using a non-table source cannot be written to tables in web maps")),null;return super.write(e,t)}clone(){if(this._hasMemorySource())throw new j(on,`FeatureLayer (title: ${this.title}, id: ${this.id}) created using in-memory source cannot be cloned`);return super.clone()}serviceSupportsSpatialReference(e){return!!this.loaded&&(this.source.type==="memory"||att(this,e))}async save(e){return(await ie(()=>import("./featureLayerUtils.1e761930.js"),["featureLayerUtils.1e761930.js","arcgisLayers.c4cc8e09.js","lazyLayerLoader.fb403b9c.js","jsonContext.a084d534.js","portalItemUtils.13c3070b.js"],import.meta.url)).save(this,e)}async saveAs(e,t){return(await ie(()=>import("./featureLayerUtils.1e761930.js"),["featureLayerUtils.1e761930.js","arcgisLayers.c4cc8e09.js","lazyLayerLoader.fb403b9c.js","jsonContext.a084d534.js","portalItemUtils.13c3070b.js"],import.meta.url)).saveAs(this,e,t)}_readEditingEnabled(e,t,r){var s;let i=(s=e.layerDefinition)==null?void 0:s.capabilities;return i?this._hasEditingCapability(i):(i=e.capabilities,t&&(r==null?void 0:r.origin)==="web-map"&&!this._hasMemorySource()&&i?this._hasEditingCapability(i):void 0)}_hasEditingCapability(e){return e.toLowerCase().split(",").map(t=>t.trim()).includes("editing")}_writeEditingEnabled(e,t,r,i){var s,n;if(!e){const o=(n=(s=this.capabilities)==null?void 0:s.operations)!=null&&n.supportsSync?"Query,Sync":"Query";ru("layerDefinition.capabilities",o,t),r&&!(i!=null&&i.writeLayerSchema)&&(t.capabilities=o)}}_checkAttachmentSupport(e){const{attributes:t}=e,{objectIdField:r}=this;return this.get("capabilities.data.supportsAttachment")?e?t?t[r]?void 0:Promise.reject(new j(on,`feature is missing the identifying attribute ${r}`)):Promise.reject(new j(on,"'attributes' are required on a feature to query attachments")):Promise.reject(new j(on,"A feature is required to add/delete/update attachments")):Promise.reject(new j(on,"this layer doesn't support attachments"))}_getLayerDomain(e){const t=this.fieldsIndex.get(e);return t?t.domain:null}_fetchFirstLayerId(e){return er(this.url,{query:{f:"json",...this.customParameters,token:this.apiKey},responseType:"json",signal:e}).then(t=>{const r=t.data;if(r)return Array.isArray(r.layers)&&r.layers.length>0?r.layers[0].id:Array.isArray(r.tables)&&r.tables.length>0?r.tables[0].id:void 0})}async _initLayerProperties(e){return this._set("source",e),e.sourceJSON&&(this.sourceJSON=e.sourceJSON,this.read(e.sourceJSON,{origin:"service",url:this.parsedUrl})),this._verifySource(),this._verifyFields(),rA(this.renderer,this.fieldsIndex),Iee(this.timeInfo,this.fieldsIndex),FAe(this,{origin:"service"})}async hasDataChanged(){var e,t;if((e=this.source)!=null&&e.refresh)try{const{dataChanged:r,updates:i}=await((t=this.source)==null?void 0:t.refresh());if(b(i)&&(this.sourceJSON={...this.sourceJSON,...i},this.read(i,{origin:"service",url:this.parsedUrl})),r)return!0}catch{}if(this.definitionExpression)try{return(await zKe(this.definitionExpression,this.fieldsIndex)).hasDateFunctions}catch{}return!1}_verifyFields(){var t;const e=this.parsedUrl&&this.parsedUrl.path||"undefined";this.objectIdField||console.log("FeatureLayer: 'objectIdField' property is not defined (url: "+e+")"),this.isTable||this._hasMemorySource()||e.search(/\/FeatureServer\//i)!==-1||((t=this.fields)==null?void 0:t.some(r=>r.type==="geometry"))||console.log("FeatureLayer: unable to find field of type 'geometry' in the layer 'fields' list. If you are using a map service layer, features will not have geometry (url: "+e+")")}_fixTemplates(e,t){e&&e.forEach(r=>{const i=r.prototype&&r.prototype.attributes;i&&t&&delete i[t]})}_verifySource(){if(this._hasMemorySource()){if(this.url)throw new j("feature-layer:mixed-source-and-url","FeatureLayer cannot be created with both an in-memory source and a url")}else if(!this.url)throw new j("feature-layer:source-or-url-required","FeatureLayer requires either a url, a valid portal item or a source")}_initMemorySource(e){e.forEach(t=>{t.layer=this,t.sourceLayer=this}),this._handles.add([e.on("after-add",t=>{t.item.layer=this,t.item.sourceLayer=this}),e.on("after-remove",t=>{t.item.layer=null,t.item.sourceLayer=null})],"fl-source")}_resetMemorySource(e){e.forEach(t=>{t.layer=null,t.sourceLayer=null}),this._handles.remove("fl-source")}_hasMemorySource(){return!(this.url||!this.source)}_readAnalyticsCapabilities(e){return{supportsCacheHint:uO(e.advancedQueryCapabilities,"queryAnalytics")}}_readAttachmentCapabilities(e){const t=e.attachmentProperties,r={supportsName:!1,supportsSize:!1,supportsContentType:!1,supportsKeywords:!1,supportsExifInfo:!1,supportsCacheHint:uO(e.advancedQueryCapabilities,"queryAttachments"),supportsResize:Vt(e,"supportsAttachmentsResizing",!1)};return t&&Array.isArray(t)&&t.forEach(i=>{const s=btt[i.name];s&&(r[s]=!!i.isEnabled)}),r}_readDataCapabilities(e){return{isVersioned:Vt(e,"isDataVersioned",!1),supportsAttachment:Vt(e,"hasAttachments",!1),supportsM:Vt(e,"hasM",!1),supportsZ:Vt(e,"hasZ",!1)}}_readMetadataCapabilities(e){return{supportsAdvancedFieldProperties:Vt(e,"supportsFieldDescriptionProperty",!1)}}_readOperationsCapabilities(e,t){const r=e?e.toLowerCase().split(",").map(p=>p.trim()):[],i=this.url?yT(this.url):null,s=r.includes(b(i)&&i.serverType==="MapServer"?"data":"query"),n=r.includes("editing")&&!t.datesInUnknownTimezone;let o=n&&r.includes("create"),a=n&&r.includes("delete"),l=n&&r.includes("update");const c=r.includes("changetracking"),h=t.advancedQueryCapabilities;return n&&!(o||a||l)&&(o=a=l=!0),{supportsCalculate:Vt(t,"supportsCalculate",!1),supportsTruncate:Vt(t,"supportsTruncate",!1),supportsValidateSql:Vt(t,"supportsValidateSql",!1),supportsAdd:o,supportsDelete:a,supportsEditing:n,supportsChangeTracking:c,supportsQuery:s,supportsQueryAnalytics:Vt(h,"supportsQueryAnalytic",!1),supportsQueryAttachments:Vt(h,"supportsQueryAttachments",!1),supportsQueryTopFeatures:Vt(h,"supportsTopFeaturesQuery",!1),supportsResizeAttachments:Vt(t,"supportsAttachmentsResizing",!1),supportsSync:r.includes("sync"),supportsUpdate:l,supportsExceedsLimitStatistics:Vt(t,"supportsExceedsLimitStatistics",!1)}}_readQueryCapabilities(e){var l;const t=e.advancedQueryCapabilities,r=e.ownershipBasedAccessControlForFeatures,i=e.archivingInfo,s=(l=this.url)==null?void 0:l.includes("MapServer"),n=!he("mapserver-pbf-enabled")&&s&&this.version<10.81,o=cAe(this.url),a=(e.supportedQueryFormats||"").split(",").reduce((c,h)=>{const p=h.toLowerCase().trim();return p&&c.add(p),c},new Set);return{supportsStatistics:Vt(t,"supportsStatistics",e.supportsStatistics),supportsPercentileStatistics:Vt(t,"supportsPercentileStatistics",!1),supportsSpatialAggregationStatistics:Vt(t,"supportsSpatialAggregationStatistics",!1),supportedSpatialAggregationStatistics:wtt(t),supportsCentroid:Vt(t,"supportsReturningGeometryCentroid",!1),supportsDistance:Vt(t,"supportsQueryWithDistance",!1),supportsDistinct:Vt(t,"supportsDistinct",e.supportsAdvancedQueries),supportsExtent:Vt(t,"supportsReturningQueryExtent",!1),supportsGeometryProperties:Vt(t,"supportsReturningGeometryProperties",!1),supportsHavingClause:Vt(t,"supportsHavingClause",!1),supportsOrderBy:Vt(t,"supportsOrderBy",e.supportsAdvancedQueries),supportsPagination:Vt(t,"supportsPagination",!1),supportsQuantization:Vt(e,"supportsCoordinatesQuantization",!1),supportsQuantizationEditMode:Vt(e,"supportsQuantizationEditMode",!1),supportsQueryGeometry:Vt(e,"supportsReturningQueryGeometry",!1),supportsResultType:Vt(t,"supportsQueryWithResultType",!1),supportsMaxRecordCountFactor:Vt(t,"supportsMaxRecordCountFactor",!1),supportsSqlExpression:Vt(t,"supportsSqlExpression",!1),supportsStandardizedQueriesOnly:Vt(e,"useStandardizedQueries",!1),supportsTopFeaturesQuery:Vt(t,"supportsTopFeaturesQuery",!1),supportsQueryByOthers:Vt(r,"allowOthersToQuery",!0),supportsHistoricMoment:Vt(i,"supportsQueryWithHistoricMoment",!1),supportsFormatPBF:!n&&a.has("pbf"),supportsDisjointSpatialRelationship:Vt(t,"supportsDisjointSpatialRel",!1),supportsCacheHint:Vt(t,"supportsQueryWithCacheHint",!1)||uO(t,"query"),supportsDefaultSpatialReference:Vt(t,"supportsDefaultSR",!1),supportsCompactGeometry:o,maxRecordCountFactor:hN(e,"maxRecordCountFactor",void 0),maxRecordCount:hN(e,"maxRecordCount",void 0),standardMaxRecordCount:hN(e,"standardMaxRecordCount",void 0),tileMaxRecordCount:hN(e,"tileMaxRecordCount",void 0)}}_readQueryRelatedCapabilities(e){const t=e.advancedQueryCapabilities,r=Vt(t,"supportsAdvancedQueryRelated",!1);return{supportsPagination:Vt(t,"supportsQueryRelatedPagination",!1),supportsCount:r,supportsOrderBy:r,supportsCacheHint:uO(t,"queryRelated")}}_readQueryTopFeaturesCapabilities(e){return{supportsCacheHint:uO(e.advancedQueryCapabilities,"queryTopFilter")}}_readEditingCapabilities(e){const t=e.ownershipBasedAccessControlForFeatures;return{supportsGeometryUpdate:Vt(e,"allowGeometryUpdates",!0),supportsGlobalId:Vt(e,"supportsApplyEditsWithGlobalIds",!1),supportsReturnServiceEditsInSourceSpatialReference:Vt(e,"supportsReturnServiceEditsInSourceSR",!1),supportsRollbackOnFailure:Vt(e,"supportsRollbackOnFailureParameter",!1),supportsUpdateWithoutM:Vt(e,"allowUpdateWithoutMValues",!1),supportsUploadWithItemId:Vt(e,"supportsAttachmentsByUploadId",!1),supportsDeleteByAnonymous:Vt(t,"allowAnonymousToDelete",!0),supportsDeleteByOthers:Vt(t,"allowOthersToDelete",!0),supportsUpdateByAnonymous:Vt(t,"allowAnonymousToUpdate",!0),supportsUpdateByOthers:Vt(t,"allowOthersToUpdate",!0)}}};u([d({readOnly:!0,json:{read:!1}})],Ie.prototype,"capabilities",void 0),u([$e("service","capabilities",["advancedQueryCapabilities","allowGeometryUpdates","allowUpdateWithoutMValues","archivingInfo","capabilities","datesInUnknownTimezone","hasAttachments","hasM","hasZ","maxRecordCount","maxRecordCountFactor","ownershipBasedAccessControlForFeatures","standardMaxRecordCount","supportedQueryFormats","supportsAdvancedQueries","supportsApplyEditsWithGlobalIds","supportsAttachmentsByUploadId","supportsAttachmentsResizing","supportsCalculate","supportsCoordinatesQuantization","supportsExceedsLimitStatistics","supportsFieldDescriptionProperty","supportsQuantizationEditMode","supportsRollbackOnFailureParameter","supportsStatistics","supportsTruncate","supportsValidateSql","tileMaxRecordCount","useStandardizedQueries"])],Ie.prototype,"readCapabilities",null),u([d({json:{origins:{"portal-item":{write:!0},"web-map":{write:!0}}}})],Ie.prototype,"charts",void 0),u([d({readOnly:!0})],Ie.prototype,"createQueryVersion",null),u([d({type:String,json:{read:{source:"layerDefinition.copyrightText"},origins:{service:{read:{source:"copyrightText"}}}}})],Ie.prototype,"copyright",void 0),u([d({type:Boolean})],Ie.prototype,"datesInUnknownTimezone",void 0),u([d({type:String,json:{read:{source:"layerDefinition.displayField"},origins:{service:{read:{source:"displayField"}}}}})],Ie.prototype,"displayField",void 0),u([d({type:String,json:{origins:{service:{read:!1,write:!1}},name:"layerDefinition.definitionExpression",write:{enabled:!0,allowNull:!0}}})],Ie.prototype,"definitionExpression",void 0),u([d({types:kx,readOnly:!0})],Ie.prototype,"defaultSymbol",void 0),u([d({type:zp})],Ie.prototype,"dynamicDataSource",void 0),u([d({readOnly:!0})],Ie.prototype,"editFieldsInfo",void 0),u([d({type:Boolean})],Ie.prototype,"editingEnabled",null),u([$e(["portal-item","web-scene"],"editingEnabled",["layerDefinition.capabilities"])],Ie.prototype,"readEditingEnabled",null),u([$e("web-map","editingEnabled",["capabilities","layerDefinition.capabilities"])],Ie.prototype,"readEditingEnabledFromWebMap",null),u([Xe(["portal-item","web-scene"],"editingEnabled",{"layerDefinition.capabilities":{type:String}})],Ie.prototype,"writeEditingEnabled",null),u([Xe("web-map","editingEnabled",{capabilities:{type:String},"layerDefinition.capabilities":{type:String}})],Ie.prototype,"writeEditingEnabledToWebMap",null),u([d({readOnly:!0})],Ie.prototype,"editingInfo",void 0),u([$e("editingInfo")],Ie.prototype,"readEditingInfo",null),u([d((()=>{const e=re($re),t=e.json.origins;return t["web-map"]={read:!1,write:!1},t["portal-item"]={read:!1,write:!1},e})())],Ie.prototype,"elevationInfo",void 0),u([d(LAe)],Ie.prototype,"featureReduction",void 0),u([d({...jG.fields,json:{read:{source:"layerDefinition.fields"},origins:{service:{name:"fields"},"web-map":{write:{target:"layerDefinition.fields",overridePolicy:HG}}}}})],Ie.prototype,"fields",void 0),u([d(jG.fieldsIndex)],Ie.prototype,"fieldsIndex",void 0),u([d({type:NAe,json:{read:{source:"layerDefinition.floorInfo"},write:{target:"layerDefinition.floorInfo"}}})],Ie.prototype,"floorInfo",void 0),u([d({type:KKe,json:{name:"formInfo",write:!0,origins:{"web-scene":{read:!1,write:!1}}}})],Ie.prototype,"formTemplate",void 0),u([d({type:Kt,json:{origins:{service:{read:{source:"extent"}}},read:{source:"layerDefinition.extent"}}})],Ie.prototype,"fullExtent",void 0),u([d()],Ie.prototype,"gdbVersion",void 0),u([d({readOnly:!0,type:itt,json:{read:{source:"geometryProperties"}}})],Ie.prototype,"geometryFieldsInfo",void 0),u([d({type:["point","polygon","polyline","multipoint","multipatch","mesh"],json:{origins:{service:{read:GG.read},"web-map":{write:{target:"layerDefinition.geometryType",overridePolicy:HG,writer(e,t,r){const i=e?GG.toJSON(e):null;i&&ru(r,i,t)}}}},read:{source:"layerDefinition.geometryType",reader:GG.read}}})],Ie.prototype,"geometryType",void 0),u([d({type:Boolean,json:{origins:{service:{read:!0}},read:{source:"layerDefinition.hasM"}}})],Ie.prototype,"hasM",void 0),u([d({type:Boolean,json:{origins:{service:{read:!0}},read:{source:"layerDefinition.hasZ"}}})],Ie.prototype,"hasZ",void 0),u([d({readOnly:!0,type:QT})],Ie.prototype,"heightModelInfo",void 0),u([d({type:Date})],Ie.prototype,"historicMoment",void 0),u([d(Lre)],Ie.prototype,"id",void 0),u([d({readOnly:!0,json:{origins:{service:{read:!0}},read:!1}})],Ie.prototype,"infoFor3D",void 0),u([d({readOnly:!0,json:{origins:{"web-map":{write:{target:"layerDefinition.type"}}}}})],Ie.prototype,"isTable",void 0),u([$e("service","isTable",["type","geometryType"]),$e("isTable",["layerDefinition.type","layerDefinition.geometryType"])],Ie.prototype,"readIsTable",null),u([Xe("web-map","isTable")],Ie.prototype,"writeIsTable",null),u([d(dL)],Ie.prototype,"labelsVisible",void 0),u([d({type:[SR],json:{origins:{service:{read:{source:"drawingInfo.labelingInfo",reader:OI},write:{target:"drawingInfo.labelingInfo",enabled:!1}}},read:{source:"layerDefinition.drawingInfo.labelingInfo",reader:OI},write:{target:"layerDefinition.drawingInfo.labelingInfo"}}})],Ie.prototype,"labelingInfo",void 0),u([d((()=>{const e=re(_et);return e.json.origins["portal-item"]={write:{target:"layerDefinition.drawingInfo.transparency",writer(t,r,i){ru(i,e6(t),r)}}},e})())],Ie.prototype,"opacity",void 0),u([d({type:Number,json:{origins:{service:{read:{source:"id"}},"portal-item":{read:!1,write:{target:"id"}}},read:!1}})],Ie.prototype,"layerId",void 0),u([d(Ire)],Ie.prototype,"legendEnabled",void 0),u([d({type:["show","hide"],json:(()=>{const e=re(gAe.json);return e.origins["portal-item"]={read:!1,write:!1},e})()})],Ie.prototype,"listMode",void 0),u([d(wet)],Ie.prototype,"minScale",void 0),u([$e("service","minScale",["minScale","effectiveMinScale"])],Ie.prototype,"readMinScale",null),u([d(xet)],Ie.prototype,"maxScale",void 0),u([$e("service","maxScale",["maxScale","effectiveMaxScale"])],Ie.prototype,"readMaxScale",null),u([d({type:String})],Ie.prototype,"globalIdField",void 0),u([$e("globalIdField",["layerDefinition.globalIdField","layerDefinition.fields"]),$e("service","globalIdField",["globalIdField","fields"])],Ie.prototype,"readGlobalIdFieldFromService",null),u([d({type:String,json:{origins:{"web-map":{write:{target:"layerDefinition.objectIdField",overridePolicy:HG}}}}})],Ie.prototype,"objectIdField",void 0),u([$e("objectIdField",["layerDefinition.objectIdField","layerDefinition.fields"]),$e("service","objectIdField",["objectIdField","fields"])],Ie.prototype,"readObjectIdFieldFromService",null),u([d({value:"ArcGISFeatureLayer",type:["ArcGISFeatureLayer"]})],Ie.prototype,"operationalLayerType",void 0),u([d(jG.outFields)],Ie.prototype,"outFields",void 0),u([d({readOnly:!0})],Ie.prototype,"parsedUrl",null),u([d({type:String,json:{origins:{"web-scene":{read:!0,write:!0}},read:!1}})],Ie.prototype,"path",void 0),u([d(hL)],Ie.prototype,"popupEnabled",void 0),u([d({type:qT,json:{name:"popupInfo",write:!0}})],Ie.prototype,"popupTemplate",void 0),u([d({readOnly:!0})],Ie.prototype,"defaultPopupTemplate",null),u([d({type:[ott],readOnly:!0})],Ie.prototype,"relationships",void 0),u([d({types:uL,json:{origins:{service:{write:{target:"drawingInfo.renderer",enabled:!1}},"web-scene":{types:Are,name:"layerDefinition.drawingInfo.renderer",write:{overridePolicy:(e,t,r)=>({ignoreOrigin:r==null?void 0:r.writeLayerSchema})}}},write:{target:"layerDefinition.drawingInfo.renderer",overridePolicy:(e,t,r)=>({ignoreOrigin:r==null?void 0:r.writeLayerSchema})}}})],Ie.prototype,"renderer",null),u([$e("service","renderer",["drawingInfo.renderer","defaultSymbol"]),$e("renderer",["layerDefinition.drawingInfo.renderer","layerDefinition.defaultSymbol"])],Ie.prototype,"readRenderer",null),u([d()],Ie.prototype,"sourceJSON",void 0),u([d({type:Boolean})],Ie.prototype,"returnM",void 0),u([d({type:Boolean})],Ie.prototype,"returnZ",void 0),u([d((()=>{const e=re(Mre);return e.json.origins["portal-item"]={read:!1,write:!1},e})())],Ie.prototype,"screenSizePerspectiveEnabled",void 0),u([d({clonable:!1})],Ie.prototype,"source",null),u([qt("source")],Ie.prototype,"castSource",null),u([$e("portal-item","source",["featureSet"]),$e("web-map","source",["featureSet"])],Ie.prototype,"readSource",null),u([d({readOnly:!0})],Ie.prototype,"serviceDefinitionExpression",void 0),u([$e("service","serviceDefinitionExpression",["definitionQuery","definitionExpression"])],Ie.prototype,"readServiceDefinitionExpression",null),u([d({type:Ze,json:{origins:{service:{read:{source:"extent.spatialReference"}}},read:{source:"layerDefinition.extent.spatialReference"}}})],Ie.prototype,"spatialReference",void 0),u([d({type:Number})],Ie.prototype,"subtypeCode",void 0),u([d({type:String,json:{origins:{service:{read:!0}}}})],Ie.prototype,"subtypeField",void 0),u([d({type:[sB]})],Ie.prototype,"templates",void 0),u([$e("templates",["editFieldsInfo","creatorField","editorField","templates"])],Ie.prototype,"readTemplates",null),u([d({type:TAe})],Ie.prototype,"timeInfo",void 0),u([d()],Ie.prototype,"title",void 0),u([$e("service","title",["name"]),$e("portal-item","title",["layerDefinition.title","layerDefinition.name","title"])],Ie.prototype,"readTitle",null),u([$e("web-map","title",["layerDefinition.name","title"])],Ie.prototype,"readTitleFromWebMap",null),u([d({type:String})],Ie.prototype,"sublayerTitleMode",void 0),u([d({type:String,json:{read:{source:"timeInfo.trackIdField"}}})],Ie.prototype,"trackIdField",void 0),u([d({json:{read:!1}})],Ie.prototype,"type",void 0),u([d({type:String})],Ie.prototype,"typeIdField",void 0),u([$e("service","typeIdField"),$e("typeIdField",["layerDefinition.typeIdField"])],Ie.prototype,"readTypeIdField",null),u([d({type:[Vre]})],Ie.prototype,"types",void 0),u([$e("service","types",["types"]),$e("types",["layerDefinition.types"])],Ie.prototype,"readTypes",null),u([d({readOnly:!0,json:{write:!1}})],Ie.prototype,"serverGens",void 0),u([d({type:ot.ofType(_y),readOnly:!0})],Ie.prototype,"indexes",void 0),u([d(Pre)],Ie.prototype,"url",null),u([Xe("url")],Ie.prototype,"writeUrl",null),u([d({readOnly:!0})],Ie.prototype,"userIsAdmin",void 0),u([d({json:{origins:{service:{read:!0}},read:!1}})],Ie.prototype,"version",void 0),u([$e("service","version",["currentVersion","capabilities","drawingInfo","hasAttachments","htmlPopupType","relationships","timeInfo","typeIdField","types"])],Ie.prototype,"readVersion",null),u([d({type:Boolean,json:{origins:{"portal-item":{write:{target:"layerDefinition.defaultVisibility"}}}}})],Ie.prototype,"visible",void 0),u([$e("portal-item","visible",["visibility","layerDefinition.defaultVisibility"])],Ie.prototype,"readVisible",null),Ie=u([$("esri.layers.FeatureLayer")],Ie);const qG=sR({types:Rxe}),vV=Ie,LLt=Object.freeze(Object.defineProperty({__proto__:null,default:vV},Symbol.toStringTag,{value:"Module"})),xtt=["$datastore","$map","$layer","$aggregatedfeatures"],Ttt="esri.widgets.Feature.support.arcadeFeatureUtils",Stt=fe.getLogger(Ttt);function Ett(e){return typeof e=="string"?K$(Nte(e)):Array.isArray(e)?Ctt(e):(e==null?void 0:e.declaredClass)==="esri.arcade.Dictionary"?Att(e):e}function Ctt(e){return`<ul class="esri-widget__list">${e.map(t=>`<li>${typeof t=="string"?K$(Nte(t)):t}</li>`).join("")}</ul>`}function Att(e){return`<table class="esri-widget__table">${e.keys().map(t=>{const r=e.field(t);return`<tr><th>${t}</th><td>${typeof r=="string"?K$(Nte(r)):r}</td></tr>`}).join("")}</table>`}function Rtt({aggregatedFeatures:e,arcadeUtils:t,featureSetVars:r,context:i,viewInfo:s,map:n,graphic:o,interceptor:a}){r.forEach(l=>{const c=l.toLowerCase(),h={map:n,spatialReference:s.sr,interceptor:a};if(c==="$map"&&(i.vars[c]=t.convertMapToFeatureSetCollection(h)),c==="$layer"&&(i.vars[c]=t.convertFeatureLayerToFeatureSet({layer:o.sourceLayer,spatialReference:s.sr,interceptor:a})),c==="$datastore"&&(i.vars[c]=t.convertServiceUrlToWorkspace({url:o.sourceLayer.url,spatialReference:s.sr,interceptor:a})),c==="$aggregatedfeatures"){const p=o.layer,{fields:f,objectIdField:m,geometryType:g,spatialReference:v,displayField:w}=p,_=new vV({fields:f,objectIdField:m,geometryType:g,spatialReference:v,displayField:w,...p.type==="feature"?{templates:p.templates,typeIdField:p.typeIdField,types:p.types}:null,source:e});i.vars[c]=t.convertFeatureLayerToFeatureSet({layer:_,spatialReference:s.sr,interceptor:a})}})}function UAe(){return ie(()=>import("./arcadeUtils.b0959288.js").then(e=>e.t),[],import.meta.url)}async function Ott({graphic:e,view:t}){const{isAggregate:r,layer:i}=e;if(!r||!i||(t==null?void 0:t.type)!=="2d")return[];const s=await t.whenLayerView(i);if(!s.createQuery||!s.queryFeatures)return[];const n=s.createQuery();n.aggregateIds=[e.getObjectId()];const{features:o}=await s.queryFeatures(n);return o}async function VAe({expressionInfo:e,arcadeUtils:t,interceptor:r,spatialReference:i,map:s,graphic:n,view:o}){if(!e||!e.expression)return null;const a=t.createSyntaxTree(e.expression),l=xtt.filter(m=>t.hasVariable(a,m)),[c]=await Promise.all([Ott({graphic:n,view:o}),t.loadScriptDependencies(a,!0,l)]),h=t.getViewInfo({spatialReference:i}),p=t.createExecContext(n,h);p.interceptor=r,p.useAsync=!0,Rtt({aggregatedFeatures:c,arcadeUtils:t,featureSetVars:l,context:p,viewInfo:h,map:s,graphic:n,interceptor:r});const f=t.createFunction(a,p);return t.executeAsyncFunction(f,p).catch(m=>Stt.error("arcade-execution-error",{error:m,graphic:n,expressionInfo:e}))}async function Mtt({expressionInfos:e,spatialReference:t,graphic:r,interceptor:i,map:s,view:n}){if(!e||!e.length)return{};const o=await UAe(),a={};for(const h of e)a[`expression/${h.name}`]=VAe({expressionInfo:h,arcadeUtils:o,interceptor:i,spatialReference:t,map:s,graphic:r,view:n});const l=await xs(a),c={};for(const h in l)c[h]=Ett(l[h].value);return c}const Ptt=1;let Ru=class extends pg(xe){constructor(e){super(e),this._abortController=null,this.expressionInfo=null,this.graphic=null,this.contentElement=null,this.contentElementViewModel=null,this.interceptor=null,this.view=null,this._cancelQuery=()=>{const{_abortController:t}=this;t&&t.abort(),this._abortController=null},this._createVM=()=>{var i,s;const t=(i=this.contentElement)==null?void 0:i.type;(s=this.contentElementViewModel)==null||s.destroy();const r=t==="fields"?new F6:t==="media"?new wx:t==="text"?new eV:null;this._set("contentElementViewModel",r)},this._compile=async()=>{this._cancelQuery();const t=new AbortController;this._abortController=t,await this._compileExpression(),this._abortController===t&&(this._abortController=null)},this._compileThrottled=Rte(this._compile,Ptt,this),this._compileExpression=async()=>{const{expressionInfo:t,graphic:r,interceptor:i,spatialReference:s,map:n,view:o,_abortController:a}=this;if(!(t&&r&&s&&n))return void this._set("contentElement",null);const l=await UAe();if(a!==this._abortController)return;const c=await VAe({arcadeUtils:l,expressionInfo:t,graphic:r,interceptor:i,map:n,spatialReference:s,view:o});if(!c||c.declaredClass!=="esri.arcade.Dictionary")return void this._set("contentElement",null);const h=await gre(c,a.signal),p=h==null?void 0:h.type,f=p==="media"?hI.fromJSON(h):p==="text"?sA.fromJSON(h):p==="fields"?iA.fromJSON(h):null;this._set("contentElement",f)},this.handles.add([te(()=>[this.expressionInfo,this.graphic,this.map,this.spatialReference,this.view],()=>this._compileThrottled(),Rt),te(()=>[this.contentElement],()=>this._createVM(),Rt)])}destroy(){var e;this._cancelQuery(),(e=this.contentElementViewModel)==null||e.destroy(),this._set("contentElementViewModel",null),this._set("contentElement",null)}get spatialReference(){var e;return((e=this.view)==null?void 0:e.spatialReference)||null}set spatialReference(e){e!==void 0?this._override("spatialReference",e):this._clearOverride("spatialReference")}get state(){const{_abortController:e,contentElement:t,contentElementViewModel:r}=this;return e?"loading":t||r?"ready":"disabled"}get map(){var e;return((e=this.view)==null?void 0:e.map)||null}set map(e){e!==void 0?this._override("map",e):this._clearOverride("map")}};u([d()],Ru.prototype,"_abortController",void 0),u([d({type:Cwe})],Ru.prototype,"expressionInfo",void 0),u([d({type:gl})],Ru.prototype,"graphic",void 0),u([d({readOnly:!0})],Ru.prototype,"contentElement",void 0),u([d({readOnly:!0})],Ru.prototype,"contentElementViewModel",void 0),u([d()],Ru.prototype,"interceptor",void 0),u([d()],Ru.prototype,"spatialReference",null),u([d({readOnly:!0})],Ru.prototype,"state",null),u([d()],Ru.prototype,"map",null),u([d()],Ru.prototype,"view",void 0),Ru=u([$("esri.widgets.Feature.FeatureExpression.FeatureExpressionViewModel")],Ru);const Gre=Ru,dN={iconLoading:"esri-icon-loading-indicator esri-rotating",base:"esri-feature-expression",loadingSpinnerContainer:"esri-feature__loading-container",spinner:"esri-feature__loading-spinner"};let $5=class extends Un{constructor(e,t){super(e,t),this.viewModel=new Gre}initialize(){this.own(te(()=>{var e;return(e=this.viewModel)==null?void 0:e.contentElementViewModel},()=>this._setupExpressionWidget(),Rt))}destroy(){this._destroyContentWidget()}renderLoading(){return U("div",{key:"loading-container",class:dN.loadingSpinnerContainer},U("span",{class:this.classes(dN.iconLoading,dN.spinner)}))}render(){var t;const{state:e}=this.viewModel;return U("div",{class:dN.base},e==="loading"?this.renderLoading():e==="disabled"?null:(t=this._contentWidget)==null?void 0:t.render())}_destroyContentWidget(){const{_contentWidget:e}=this;e&&(e.viewModel=null,e.destroy()),this._contentWidget=null}_setupExpressionWidget(){const{contentElementViewModel:e,contentElement:t}=this.viewModel,r=t==null?void 0:t.type;this._destroyContentWidget();const i=e?r==="fields"?new C2e({viewModel:e}):r==="media"?new _Ee({viewModel:e}):r==="text"?new h5({viewModel:e}):null:null;this._contentWidget=i,this.scheduleRender()}};u([d({type:Gre})],$5.prototype,"viewModel",void 0),$5=u([$("esri.widgets.Feature.FeatureExpression")],$5);const Itt=$5;class $tt{constructor(t,r){this.preLayerQueryCallback=t,this.preRequestCallback=r,this.preLayerQueryCallback||(this.preLayerQueryCallback=i=>{}),this.preRequestCallback||(this.preLayerQueryCallback=i=>{})}}var L5;const Ltt=1,che="content-view-models",zAe="esri.widgets.FeatureViewModel",Dtt=fe.getLogger(zAe),uhe={attachmentsContent:!0,chartAnimation:!0,customContent:!0,expressionContent:!0,fieldsContent:!0,mediaContent:!0,textContent:!0};let Rs=L5=class extends xe{constructor(e){super(e),this._handles=new Dt,this._error=null,this._featureAbortController=null,this.graphicChangedThrottled=Rte(this._graphicChanged,Ltt,this),this._expressionAttributes=null,this._graphicExpressionAttributes=null,this.abilities={...uhe},this.content=null,this.contentViewModels=[],this.defaultPopupTemplateEnabled=!1,this.formattedAttributes=null,this.lastEditInfo=null,this.relatedInfos=new Map,this.title="",this.view=null,this._isAllowedContentType=t=>{const{abilities:r}=this;return t.type==="attachments"&&r.attachmentsContent||t.type==="custom"&&r.customContent||t.type==="fields"&&r.fieldsContent||t.type==="media"&&r.mediaContent||t.type==="text"&&r.textContent||t.type==="expression"&&r.expressionContent},this._handles.add(te(()=>[this.graphic,this._effectivePopupTemplate,this.abilities],()=>this.graphicChangedThrottled(),Rt))}destroy(){this._clear(),this._cancelFeatureQuery(),this._error=null,this._handles.destroy(),this._handles=null,this.graphic=null,this._destroyContentViewModels(),this.relatedInfos.clear()}get _effectivePopupTemplate(){return b(this.graphic)?this.graphic.getEffectivePopupTemplate(this.defaultPopupTemplateEnabled):null}get _fieldInfoMap(){return gqe(nce(this._effectivePopupTemplate),this._sourceLayer)}get _sourceLayer(){return d2e(this.graphic)}castAbilities(e){return{...uhe,...e}}get state(){return this.graphic?this._error?"error":this.waitingForContent?"loading":"ready":"disabled"}set graphic(e){this._set("graphic",e?e.clone():null)}get spatialReference(){return this.get("view.spatialReference")||null}set spatialReference(e){e!==void 0?this._override("spatialReference",e):this._clearOverride("spatialReference")}get map(){return this.get("view.map")||null}set map(e){e!==void 0?this._override("map",e):this._clearOverride("map")}get waitingForContent(){return!!this._featureAbortController}setActiveMedia(e,t){const r=this.contentViewModels[e];r instanceof wx&&r.setActiveMedia(t)}nextMedia(e){const t=this.contentViewModels[e];t instanceof wx&&t.next()}previousMedia(e){const t=this.contentViewModels[e];t instanceof wx&&t.previous()}_clear(){this._set("title",""),this._set("content",null),this._set("formattedAttributes",null)}async _graphicChanged(){this._cancelFeatureQuery(),this._error=null,this._clear();const{graphic:e}=this;if(!e)return;const t=new AbortController;this._featureAbortController=t;try{await this._queryFeature({signal:t.signal})}catch(r){Vi(r)||(this._error=r,Dtt.error("error","The popupTemplate could not be displayed for this feature.",{error:r,graphic:e,popupTemplate:this._effectivePopupTemplate}))}this._featureAbortController===t&&(this._featureAbortController=null)}_cancelFeatureQuery(){const{_featureAbortController:e}=this;e&&e.abort(),this._featureAbortController=null}_compileContentElement(e,t){return e.type==="attachments"?this._compileAttachments(e,t):e.type==="custom"?this._compileCustom(e,t):e.type==="fields"?this._compileFields(e,t):e.type==="media"?this._compileMedia(e,t):e.type==="text"?this._compileText(e,t):e.type==="expression"?this._compileExpression(e,t):void 0}_compileContent(e){if(this._destroyContentViewModels(),this.graphic)return Array.isArray(e)?e.filter(this._isAllowedContentType).map((t,r)=>this._compileContentElement(t,r)):typeof e=="string"?this._compileText(new sA({text:e}),0).text:e}_destroyContentViewModels(){var e;(e=this._handles)==null||e.remove(che),this.contentViewModels.forEach(t=>t&&!t.destroyed&&t.destroy()),this._set("contentViewModels",[])}_setExpressionContentVM(e,t){const{formattedAttributes:r}=this,{contentElement:i,contentElementViewModel:s}=e,n=i==null?void 0:i.type;s&&n&&(n==="fields"&&(this._createFieldsFormattedAttributes({contentElement:i,contentElementIndex:t,formattedAttributes:r}),s.set(this._createFieldsVMParams(i,t))),n==="media"&&(this._createMediaFormattedAttributes({contentElement:i,contentElementIndex:t,formattedAttributes:r}),s.set(this._createMediaVMParams(i,t))),n==="text"&&s.set(this._createTextVMParams(i)))}_compileExpression(e,t){const{expressionInfo:r}=e,{graphic:i,map:s,spatialReference:n,view:o}=this,a=new Gre({expressionInfo:r,graphic:i,interceptor:L5.interceptor,map:s,spatialReference:n,view:o});return this.contentViewModels[t]=a,this._handles.add(te(()=>a.contentElementViewModel,()=>this._setExpressionContentVM(a,t),Rt),che),e}_compileAttachments(e,t){const{graphic:r}=this,{description:i,title:s}=e;return this.contentViewModels[t]=new kte({graphic:r,...this._compileTitleAndDesc({title:s,description:i})}),e}_compileCustom(e,t){const{graphic:r}=this,{creator:i,destroyer:s}=e;return this.contentViewModels[t]=new eV({graphic:r,creator:i,destroyer:s}),e}_compileTitleAndDesc({title:e,description:t}){const{_fieldInfoMap:r,_sourceLayer:i,graphic:s,formattedAttributes:n,_expressionAttributes:o}=this,{attributes:a}=s,l=n.global;return{title:_x({attributes:a,fieldInfoMap:r,globalAttributes:l,expressionAttributes:o,layer:i,text:e}),description:_x({attributes:a,fieldInfoMap:r,globalAttributes:l,expressionAttributes:o,layer:i,text:t})}}_createFieldsVMParams(e,t){var c;const{_effectivePopupTemplate:r,formattedAttributes:i}=this,s={...i.global,...i.content[t]},n=(c=(e==null?void 0:e.fieldInfos)||(r==null?void 0:r.fieldInfos))==null?void 0:c.filter(({fieldName:h})=>f2e(h)||Ny(h)||s.hasOwnProperty(h)),o=r==null?void 0:r.expressionInfos,{description:a,title:l}=e;return{attributes:s,expressionInfos:o,fieldInfos:n,...this._compileTitleAndDesc({title:l,description:a})}}_compileFields(e,t){const r=e.clone(),i=new F6(this._createFieldsVMParams(e,t));return this.contentViewModels[t]=i,r.fieldInfos=i.formattedFieldInfos.slice(0),r}_createMediaVMParams(e,t){const{abilities:r,graphic:i,_fieldInfoMap:s,formattedAttributes:n,_effectivePopupTemplate:o,relatedInfos:a,_sourceLayer:l,_expressionAttributes:c}=this,{attributes:h}=i,{description:p,mediaInfos:f,title:m}=e;return{abilities:{chartAnimation:r.chartAnimation},activeMediaInfoIndex:e.activeMediaInfoIndex||0,attributes:h,layer:l,fieldInfoMap:s,formattedAttributes:{...n.global,...n.content[t]},expressionAttributes:c,mediaInfos:f,popupTemplate:o,relatedInfos:a,...this._compileTitleAndDesc({title:m,description:p})}}_compileMedia(e,t){const r=e.clone(),i=new wx(this._createMediaVMParams(e,t));return r.mediaInfos=i.formattedMediaInfos.slice(0),this.contentViewModels[t]=i,r}_createTextVMParams(e){const{graphic:t,_fieldInfoMap:r,_sourceLayer:i,_expressionAttributes:s}=this;if(e&&e.text){const{attributes:n}=t,o=this.formattedAttributes.global;e.text=_x({attributes:n,fieldInfoMap:r,globalAttributes:o,expressionAttributes:s,layer:i,text:e.text})}return{graphic:t,creator:e.text}}_compileText(e,t){const r=e.clone();return this.contentViewModels[t]=new eV(this._createTextVMParams(r)),r}_compileLastEditInfo(){const{_effectivePopupTemplate:e,_sourceLayer:t,graphic:r}=this;if(!e)return;const{lastEditInfoEnabled:i}=e,s=t==null?void 0:t.editFieldsInfo;return i&&s?mqe(s,r.attributes):void 0}_compileTitle(e){const{_fieldInfoMap:t,_sourceLayer:r,graphic:i,_expressionAttributes:s}=this,{attributes:n}=i,o=this.formattedAttributes.global;return _x({attributes:n,fieldInfoMap:t,globalAttributes:o,expressionAttributes:s,layer:r,text:e})}async _getTitle(){const{_effectivePopupTemplate:e,graphic:t}=this,r=e==null?void 0:e.title;return JU(r,{graphic:t})}async _getContent(){const{_effectivePopupTemplate:e,graphic:t}=this,r=e==null?void 0:e.content;return JU(r,{graphic:t})}async _queryFeature(e){const{_featureAbortController:t,_sourceLayer:r,graphic:i,_effectivePopupTemplate:s,spatialReference:n,map:o,view:a}=this,{content:{value:l},title:{value:c}}=await xs({content:this._getContent(),title:this._getTitle()});if(t!==this._featureAbortController||!i)return;await _qe({graphic:i,popupTemplate:s,layer:r,spatialReference:n},e);const{expressionAttributes:{value:h}}=await xs({checkForRelatedFeatures:this._checkForRelatedFeatures(e),expressionAttributes:Mtt({expressionInfos:s==null?void 0:s.expressionInfos,spatialReference:n,graphic:i,map:o,interceptor:L5.interceptor,view:a})});t===this._featureAbortController&&i&&(this._expressionAttributes=h,this._graphicExpressionAttributes={...i.attributes,...h},this._set("formattedAttributes",this._createFormattedAttributes(l)),this._set("title",this._compileTitle(c)),this._set("lastEditInfo",this._compileLastEditInfo()||null),this._set("content",this._compileContent(l)||null))}_createMediaFormattedAttributes({contentElement:e,contentElementIndex:t,formattedAttributes:r}){const{_effectivePopupTemplate:i,graphic:s,relatedInfos:n,_sourceLayer:o,_fieldInfoMap:a,_graphicExpressionAttributes:l}=this;r.content[t]=aG({fieldInfos:i==null?void 0:i.fieldInfos,graphic:s,attributes:{...l,...e.attributes},layer:o,fieldInfoMap:a,relatedInfos:n})}_createFieldsFormattedAttributes({contentElement:e,contentElementIndex:t,formattedAttributes:r}){if(e.fieldInfos){const{graphic:i,relatedInfos:s,_sourceLayer:n,_fieldInfoMap:o,_graphicExpressionAttributes:a}=this;r.content[t]=aG({fieldInfos:e.fieldInfos,graphic:i,attributes:{...a,...e.attributes},layer:n,fieldInfoMap:o,relatedInfos:s})}}_createFormattedAttributes(e){const{_effectivePopupTemplate:t,graphic:r,relatedInfos:i,_sourceLayer:s,_fieldInfoMap:n,_graphicExpressionAttributes:o}=this,a=t==null?void 0:t.fieldInfos,l={global:aG({fieldInfos:a,graphic:r,attributes:o,layer:s,fieldInfoMap:n,relatedInfos:i}),content:[]};return Array.isArray(e)&&e.forEach((c,h)=>{c.type==="fields"&&this._createFieldsFormattedAttributes({contentElement:c,contentElementIndex:h,formattedAttributes:l}),c.type==="media"&&this._createMediaFormattedAttributes({contentElement:c,contentElementIndex:h,formattedAttributes:l})}),l}_checkForRelatedFeatures(e){const{graphic:t,_effectivePopupTemplate:r}=this;return this._queryRelatedInfos(t,nce(r),e)}async _queryRelatedInfos(e,t,r){const{relatedInfos:i,_sourceLayer:s}=this;i.clear();const n=b(s.associatedLayer)?await s.associatedLayer.load(r):s;if(!n)return;const o=t.filter(c=>c&&Ny(c.fieldName));if(!o||!o.length)return;t.forEach(c=>this._configureRelatedInfo(c,n));const a=await zZe({relatedInfos:i,layer:n},r);Object.keys(a).forEach(c=>{var f;const h=i.get(c.toString()),p=(f=a[c])==null?void 0:f.value;h&&p&&(h.layerInfo=p.data)});const l=await BZe({graphic:e,relatedInfos:i,layer:n},r);Object.keys(l).forEach(c=>{var h;NZe((h=l[c])==null?void 0:h.value,i.get(c.toString()))})}_configureRelatedInfo(e,t){const{relatedInfos:r}=this,i=CZ(e.fieldName);if(!i)return;const{layerId:s,fieldName:n}=i;if(!s)return;const o=r.get(s.toString())||DZe(s,t);o&&(GZe({relatedInfo:o,fieldName:n,fieldInfo:e}),this.relatedInfos.set(s,o))}};Rs.interceptor=new $tt(xqe,Tqe),u([d()],Rs.prototype,"_error",void 0),u([d()],Rs.prototype,"_featureAbortController",void 0),u([d({readOnly:!0})],Rs.prototype,"_effectivePopupTemplate",null),u([d({readOnly:!0})],Rs.prototype,"_fieldInfoMap",null),u([d({readOnly:!0})],Rs.prototype,"_sourceLayer",null),u([d()],Rs.prototype,"abilities",void 0),u([qt("abilities")],Rs.prototype,"castAbilities",null),u([d({readOnly:!0})],Rs.prototype,"content",void 0),u([d({readOnly:!0})],Rs.prototype,"contentViewModels",void 0),u([d({type:Boolean})],Rs.prototype,"defaultPopupTemplateEnabled",void 0),u([d({readOnly:!0})],Rs.prototype,"state",null),u([d({readOnly:!0})],Rs.prototype,"formattedAttributes",void 0),u([d({type:gl,value:null})],Rs.prototype,"graphic",null),u([d({readOnly:!0})],Rs.prototype,"lastEditInfo",void 0),u([d({readOnly:!0})],Rs.prototype,"relatedInfos",void 0),u([d()],Rs.prototype,"spatialReference",null),u([d({readOnly:!0})],Rs.prototype,"title",void 0),u([d()],Rs.prototype,"map",null),u([d({readOnly:!0})],Rs.prototype,"waitingForContent",null),u([d()],Rs.prototype,"view",void 0),Rs=L5=u([$(zAe)],Rs);const jre=Rs,BAe=e=>{let t=class extends e{constructor(){super(...arguments),this.renderNodeContent=r=>tV(r)&&!r.destroyed?U("div",{key:r},r.render()):r instanceof HTMLElement?U("div",{key:r,bind:r,afterCreate:this._attachToNode}):E2e(r)?U("div",{key:r,bind:r.domNode,afterCreate:this._attachToNode}):null}_attachToNode(r){const i=this;r.appendChild(i)}};return t=u([$("esri.widgets.Feature.ContentMixin")],t),t},ua={iconText:"esri-icon-font-fallback-text",iconLoading:"esri-icon-loading-indicator esri-rotating",esriTable:"esri-widget__table",esriWidget:"esri-widget",base:"esri-feature",container:"esri-feature__size-container",title:"esri-feature__title",main:"esri-feature__main-container",btn:"esri-feature__button",icon:"esri-feature__icon",content:"esri-feature__content",contentElement:"esri-feature__content-element",text:"esri-feature__text",lastEditedInfo:"esri-feature__last-edited-info",fields:"esri-feature__fields",fieldHeader:"esri-feature__field-header",fieldData:"esri-feature__field-data",fieldDataDate:"esri-feature__field-data--date",loadingSpinnerContainer:"esri-feature__loading-container",spinner:"esri-feature__loading-spinner"},hhe={title:!0,content:!0,lastEditedInfo:!0};let ga=class extends BAe(Un){constructor(e,t){super(e,t),this._contentWidgets=[],this.graphic=null,this.defaultPopupTemplateEnabled=!1,this.headingLevel=2,this.label=void 0,this.messages=null,this.messagesCommon=null,this.messagesURIUtils=null,this.spatialReference=null,this.title=null,this.visibleElements={...hhe},this.map=null,this.view=null,this.viewModel=new jre}initialize(){this.own(te(()=>{var e;return(e=this.viewModel)==null?void 0:e.contentViewModels},()=>this._setupContentWidgets(),Rt))}loadDependencies(){return ie(()=>import("./calcite-notice.341e0695.js"),[],import.meta.url)}destroy(){this._destroyContentWidgets()}castVisibleElements(e){return{...hhe,...e}}render(){const{state:e}=this.viewModel,t=U("div",{class:ua.container,key:"container"},this.renderTitle(),e==="error"?this.renderError():e==="loading"?this.renderLoading():this.renderContentContainer());return U("div",{class:this.classes(ua.base,ua.esriWidget)},t)}setActiveMedia(e,t){this.viewModel.setActiveMedia(e,t)}nextMedia(e){this.viewModel.nextMedia(e)}previousMedia(e){this.viewModel.previousMedia(e)}renderError(){const{messagesCommon:e,messages:t,visibleElements:r}=this;return U("calcite-notice",{active:!0,color:"red",icon:"exclamation-mark-circle",scale:"s"},r.title?U("div",{key:"error-title",slot:"title"},e.errorMessage):null,U("div",{key:"error-message",slot:"message"},t.loadingError))}renderLoading(){return U("div",{key:"loading-container",class:ua.loadingSpinnerContainer},U("span",{class:this.classes(ua.iconLoading,ua.spinner)}))}renderContentContainer(){const{visibleElements:e}=this;return e.content?U("div",{class:ua.main},[this.renderContent(),this.renderLastEditInfo()]):null}renderTitle(){const{visibleElements:e,title:t}=this;return e.title?U(u1,{level:this.headingLevel,class:ua.title,innerHTML:t}):null}renderContent(){const e=this.viewModel.content,t="content";if(!e)return null;if(Array.isArray(e))return e.length?U("div",{key:`${t}-content-elements`},e.map(this.renderContentElement,this)):null;if(typeof e=="string"){const r=this._contentWidgets[0];return!r||r.destroyed?null:U("div",{key:`${t}-content`},r.render())}return this.renderNodeContent(e)}renderContentElement(e,t){const{visibleElements:r}=this;if(typeof r.content!="boolean"&&!r.content[e.type])return null;switch(e.type){case"attachments":return this.renderAttachments(t);case"custom":return this.renderCustom(e,t);case"fields":return this.renderFields(t);case"media":return this.renderMedia(t);case"text":return this.renderText(e,t);case"expression":return this.renderExpression(t);default:return null}}renderAttachments(e){const t=this._contentWidgets[e];if(!t||t.destroyed)return null;const{state:r,attachmentInfos:i}=t.viewModel;return r==="loading"||i.length>0?U("div",{key:this._buildKey("attachments-element",e),class:this.classes(ua.contentElement)},t.render()):null}renderExpression(e){const t=this._contentWidgets[e];return!t||t.destroyed?null:U("div",{key:this._buildKey("expression-element",e),class:ua.contentElement},t.render())}renderCustom(e,t){const{creator:r}=e,i=this._contentWidgets[t];return!i||i.destroyed?null:r?U("div",{key:this._buildKey("custom-element",t),class:ua.contentElement},i.render()):null}renderFields(e){const t=this._contentWidgets[e];return!t||t.destroyed?null:U("div",{key:this._buildKey("fields-element",e),class:ua.contentElement},t.render())}renderMedia(e){const t=this._contentWidgets[e];return!t||t.destroyed?null:U("div",{key:this._buildKey("media-element",e),class:ua.contentElement},t.render())}renderLastEditInfo(){const{visibleElements:e,messages:t}=this,{lastEditInfo:r}=this.viewModel;if(!r||!e.lastEditedInfo)return null;const{date:i,user:s}=r,n=r.type==="edit"?s?t.lastEditedByUser:t.lastEdited:s?t.lastCreatedByUser:t.lastCreated,o=nd(n,{date:i,user:s});return U("div",{key:"edit-info-element",class:this.classes(ua.lastEditedInfo,ua.contentElement)},o)}renderText(e,t){const r=e.text,i=this._contentWidgets[t];return!i||i.destroyed?null:r?U("div",{key:this._buildKey("text-element",t),class:this.classes(ua.contentElement,ua.text)},i.render()):null}_buildKey(e,...t){return`${e}__${this.get("viewModel.graphic.uid")||"0"}-${t.join("-")}`}_destroyContentWidget(e){e&&(e.viewModel=null,!e.destroyed&&e.destroy())}_destroyContentWidgets(){this._contentWidgets.forEach(e=>this._destroyContentWidget(e)),this._contentWidgets=[]}_setupContentWidgets(){this._destroyContentWidgets();const{headingLevel:e,visibleElements:t}=this,r=this.get("viewModel.content"),{contentViewModels:i}=this.viewModel;if(Array.isArray(r))r.forEach((s,n)=>{s.type==="attachments"&&(this._contentWidgets[n]=new $qe({displayType:s.displayType,headingLevel:t.title?e+1:e,viewModel:i[n]})),s.type==="fields"&&(this._contentWidgets[n]=new C2e({viewModel:i[n]})),s.type==="media"&&(this._contentWidgets[n]=new _Ee({viewModel:i[n]})),s.type==="text"&&(this._contentWidgets[n]=new h5({viewModel:i[n]})),s.type==="custom"&&(this._contentWidgets[n]=new h5({viewModel:i[n]})),s.type==="expression"&&(this._contentWidgets[n]=new Itt({viewModel:i[n]}))},this);else{const s=i[0];s&&!s.destroyed&&(this._contentWidgets[0]=new h5({viewModel:s}))}this.scheduleRender()}};u([We("viewModel.graphic")],ga.prototype,"graphic",void 0),u([We("viewModel.defaultPopupTemplateEnabled")],ga.prototype,"defaultPopupTemplateEnabled",void 0),u([d()],ga.prototype,"headingLevel",void 0),u([d({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],ga.prototype,"label",void 0),u([d(),Js("esri/widgets/Feature/t9n/Feature")],ga.prototype,"messages",void 0),u([d(),Js("esri/t9n/common")],ga.prototype,"messagesCommon",void 0),u([d(),Js("esri/widgets/support/t9n/uriUtils")],ga.prototype,"messagesURIUtils",void 0),u([We("viewModel.spatialReference")],ga.prototype,"spatialReference",void 0),u([We("viewModel.title")],ga.prototype,"title",void 0),u([d()],ga.prototype,"visibleElements",void 0),u([qt("visibleElements")],ga.prototype,"castVisibleElements",null),u([We("viewModel.map")],ga.prototype,"map",void 0),u([We("viewModel.view")],ga.prototype,"view",void 0),u([d({type:jre})],ga.prototype,"viewModel",void 0),ga=u([$("esri.widgets.Feature")],ga);const Ntt=ga;var GAe;const D5=Symbol("anchorHandles");let ww=class extends ds.EventedAccessor{constructor(e){super(e),this[GAe]=new Dt,this.location=null,this.screenLocationEnabled=!1,this.view=null,this[D5].add([Lo(()=>mn(this.screenLocationEnabled?this.view:null,t=>[t.size,t.type==="3d"?t.camera:t.viewpoint]),()=>this.notifyChange("screenLocation")),te(()=>this.screenLocation,(t,r)=>{b(t)&&b(r)&&this.emit("view-change")})])}destroy(){this.view=null,this[D5]=ct(this[D5])}get screenLocation(){const{location:e,view:t,screenLocationEnabled:r}=this;return r&&b(e)&&b(t)&&t.ready?t.toScreen(e):null}};GAe=D5,u([d()],ww.prototype,"location",void 0),u([d()],ww.prototype,"screenLocation",null),u([d()],ww.prototype,"screenLocationEnabled",void 0),u([d()],ww.prototype,"view",void 0),ww=u([$("esri.widgets.support.AnchorElementViewModel")],ww);const jAe=ww,Ftt="esri.widgets.CompassViewModel";let N5=class extends jAe{constructor(e){super(e),this.visible=!1}};u([d()],N5.prototype,"visible",void 0),N5=u([$(Ftt)],N5);const HAe=N5,WG={base:"esri-spinner",spinnerStart:"esri-spinner--start",spinnerFinish:"esri-spinner--finish"};let xw=class extends Un{constructor(e,t){super(e,t),this._animationDelay=500,this._animationPromise=null,this.location=null,this.view=null,this.viewModel=new HAe,this.visible=!1}initialize(){this.own([te(()=>this.visible,e=>this._visibleChange(e))])}destroy(){this._animationPromise=null}show(e){const{location:t,promise:r}=e;t&&(this.viewModel.location=t),this.visible=!0;const i=()=>this.hide();r&&r.catch(()=>{}).then(i)}hide(){this.visible=!1}render(){const{visible:e}=this,{screenLocation:t}=this.viewModel,r=!!t,i=e&&r,s=!e&&r,n={[WG.spinnerStart]:i,[WG.spinnerFinish]:s},o=this._getPositionStyles();return U("div",{class:this.classes(WG.base,n),styles:o})}_visibleChange(e){if(e)return void(this.viewModel.screenLocationEnabled=!0);const t=BC(this._animationDelay);this._animationPromise=t,t.catch(()=>{}).then(()=>{this._animationPromise===t&&(this.viewModel.screenLocationEnabled=!1,this._animationPromise=null)})}_getPositionStyles(){const{screenLocation:e,view:t}=this.viewModel;if(R(t)||R(e))return{};const{padding:r}=t;return{left:e.x-r.left+"px",top:e.y-r.top+"px"}}};u([We("viewModel.location")],xw.prototype,"location",void 0),u([We("viewModel.view")],xw.prototype,"view",void 0),u([d({type:HAe})],xw.prototype,"viewModel",void 0),u([We("viewModel.visible")],xw.prototype,"visible",void 0),xw=u([$("esri.widgets.Spinner")],xw);const ktt=xw;var no;(function(e){e[e.size=22]="size",e[e.lineWidth=50]="lineWidth",e[e.maxSize=120]="maxSize",e[e.maxOutlineSize=80]="maxOutlineSize",e[e.tallSymbolWidth=20]="tallSymbolWidth"})(no||(no={}));const VY={fill:[{type:"path",path:"M -10,-10 L 10,0 L 10,10 L -10,10 L -10,-10 Z"}],squareFill:[{type:"path",path:"M -10,-10 L 10,-10 L 10,10 L -10,10 L -10,-10 Z"}],pathSymbol3DLayer:[{type:"path",path:"M 3,12 L 12,0 L 11,-2 L -4,5 L -1,5 L 1,7 L 3,10 L 3,12 Z"},{type:"circle",cx:-2,cy:10,r:5}],extrudeSymbol3DLayer:[{type:"path",path:"M -7,-5 L -2,0 L -2,7 L -7,3 L -7,-5 Z"},{type:"path",path:"M -2,0 L -2,7 L 10,-3 L 10,-10 L -2,0 Z"},{type:"path",path:"M -7,-5 L -2,0 L 10,-10 L -2,-10 L -7,-5 Z"}],cone:[{type:"path",path:"M 0,-10 L -8,5 L -4,6.5 L 0,7 L 4,6.5 L 8,5 Z"}],tallCone:[{type:"path",path:"M 0,-9 L -3.5,7 L -1.5,7.8 L 0,8 L 1.5,7.8 L 3.5,7 L 0,-9 Z"}],invertedCone:[{type:"path",path:"M 0,7 L -8,-8 L 8,-8 Z"},{type:"path",path:"M -8,-8 L -4,-9.5 L 0,-10 L 4,-9.5 L 8,-8 L 4,-6.5 L 0,-6 L -4,-6.5 Z"}],cube:[{type:"path",path:"M -10,-7 L 0,-12 L 10,-7 L 0,-2 L -10,-7 Z"},{type:"path",path:"M -10,-7 L 0,-2 L 0,12 L -10,7 L -10,-7 Z"},{type:"path",path:"M 0,-2 L 10,-7 L 10,7 L 0,12 L 0,-2 Z"}],tallCube:[{type:"path",path:"M -3.5,-8.5 L 0,-9.5 L 3.5,-8.5 L 0,-7.5 L -3.5,-8.5 Z"},{type:"path",path:"M -3.5,-8.5 L 0,-7.5 L 0,9 L -3.5,8 L -3.5,-8.5 Z"},{type:"path",path:"M 0,-7.5 L 3.5,-8.5 L 3.5,8 L 0,9 L 0,-7.5 Z"}],cylinder:[{type:"path",path:"M -8,-9 L -8,7 L -4,8.5 L 0,9 L 4,8.5 L 8,7 L 8,-9 Z"},{type:"ellipse",cx:0,cy:-9,rx:8,ry:2}],tallCylinder:[{type:"path",path:"M -3.5,-9 L -3.5,7 L -1.5,7.8 L 0,8 L 1.5,7.8 L 3.5,7 L 3.5,-9 Z"},{type:"ellipse",cx:0,cy:-9,rx:3.5,ry:1}],diamond:[{type:"path",path:"M 0,-10 L 10,-1 L -1,1 L 0,-10 Z"},{type:"path",path:"M 0,-10 L -1,1 L -8,-1 L 0,-10 Z"},{type:"path",path:"M -1,1 L 0,10 L -8,-1 L -1,1 Z"},{type:"path",path:"M -1,0 L 0,10 L 10,-1 L -1,1 Z"}],tetrahedron:[{type:"path",path:"M 0,-10 L 10,7 L 0,0 L 0,-10 Z"},{type:"path",path:"M 0,-10 L 0,0 L -8,7 L 0,-10 Z"},{type:"path",path:"M 10,7 L 0,0 L -8,7 L 10,7 Z"}]};function Utt(e,t,r){const i=no.size;let s=i,n=i;e<1?s*=.75:e>1&&(n*=1.25);const o=0,a=0;let l=i,c=i;return t&&r&&(s=n=l=c=0),[{type:"path",path:[{command:"M",values:[l,o]},{command:"L",values:[r?l:.875*l,o]},{command:"L",values:[r?s-.5*l:a,n-.5*c]},{command:"L",values:[s-.5*l,n-.5*c]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[l,o]},{command:"L",values:[l,t?o:.125*c]},{command:"L",values:[s-.5*l,t?n-.5*c:c]},{command:"L",values:[s-.5*l,n-.5*c]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[s-.5*l,n-.5*c]},{command:"L",values:[r?s-.5*l:a,n-.5*c]},{command:"L",values:[r?s-.5*l:a,t?n-.5*c:c]},{command:"L",values:[s-.5*l,t?n-.5*c:c]},{command:"Z",values:[]}]}]}function Vtt(e){const t=no.size,r=.5*e,i=0,s=0;return[{type:"path",path:[{command:"M",values:[s,.7*t*.5]},{command:"L",values:[.3*t,.7*t]},{command:"L",values:[.3*t,.7*t+r]},{command:"L",values:[s,.7*t+r-.7*t*.5]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[.3*t,.7*t]},{command:"L",values:[.3*t,.7*t+r]},{command:"L",values:[t,r]},{command:"L",values:[t,i]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[.3*t,i]},{command:"L",values:[t,i]},{command:"L",values:[.3*t,.7*t]},{command:"L",values:[s,.7*t*.5]},{command:"Z",values:[]}]}]}function ztt(){return[{type:"path",path:"M80,80.2v-27c-1.5,0.7-2.8,1.6-3.9,2.8c-1.8,2.1-4.4,3.3-7.1,3.5c-2.7-0.1-5.3-1.4-7.1-3.4c-2.2-2.3-4.7-3.6-7.4-3.6s-5.1,1.3-7.3,3.6c-1.8,2.1-4.4,3.3-7.2,3.4c-2.7-0.1-5.3-1.4-7.1-3.4c-2.2-2.3-4.7-3.6-7.4-3.6s-5.1,1.3-7.4,3.6c-1.8,2.1-4.4,3.3-7.2,3.4C8.3,59.3,5.7,58,3.9,56c-1.1-1.2-2.4-2.1-3.9-2.8v27"},{type:"path",path:"M11,59.4c2.7-0.1,5.3-1.4,7.1-3.4c2.2-2.3,4.7-3.6,7.4-3.6s5.1,1.3,7.4,3.6c1.8,2,4.4,3.3,7.2,3.4c2.7-0.1,5.3-1.4,7.1-3.4c2.2-2.3,4.7-3.6,7.3-3.6s5.1,1.3,7.4,3.6c1.8,2.1,4.4,3.3,7.2,3.4c2.7-0.1,5.3-1.4,7.1-3.4c1.1-1.2,2.4-2.1,3.9-2.8v-24c-1.5,0.7-2.8,1.6-3.9,2.8c-1.8,2.1-4.4,3.3-7.1,3.5c-2.7-0.1-5.3-1.4-7.1-3.4c-2.2-2.3-4.7-3.6-7.4-3.6s-5.1,1.3-7.3,3.6c-1.8,2.1-4.4,3.3-7.2,3.4c-2.7-0.1-5.3-1.4-7.1-3.4c-2.2-2.3-4.7-3.6-7.4-3.6s-5.1,1.3-7.4,3.6c-1.8,2.1-4.4,3.3-7.2,3.4c-2.7-0.1-5.3-1.4-7.1-3.4c-1.1-1.2-2.4-2.1-3.9-2.8v24c1.5,0.7,2.8,1.6,3.9,2.8C5.7,58,8.3,59.3,11,59.4z"},{type:"path",path:"M11,35.4c2.7-0.1,5.3-1.4,7.1-3.4c2.2-2.3,4.7-3.6,7.4-3.6s5.1,1.3,7.4,3.6c1.8,2,4.4,3.3,7.2,3.4c2.7-0.1,5.3-1.4,7.1-3.4c2.2-2.3,4.7-3.6,7.3-3.6s5.1,1.3,7.4,3.6c1.8,2.1,4.4,3.3,7.2,3.4c2.7-0.1,5.3-1.4,7.1-3.4c1.1-1.2,2.4-2.1,3.9-2.8V3.6c-1.5,0.7-2.8,1.6-3.9,2.8c-2.2,2.1-4.6,3.4-7.1,3.4s-5-1.3-7.1-3.4s-4.7-3.6-7.4-3.6s-5.1,1.3-7.3,3.6S42.5,9.9,40,9.9s-5-1.3-7.1-3.4s-4.7-3.6-7.4-3.6s-5.1,1.3-7.3,3.6c-1.8,2.1-4.4,3.3-7.2,3.4c-2.5,0-5-1.3-7.1-3.4C2.8,5.3,1.4,4.3,0,3.6v25.6c1.5,0.7,2.8,1.6,3.9,2.8C5.7,34.1,8.3,35.3,11,35.4z"}]}function Btt(e,t){let r=t?no.tallSymbolWidth:e;const i=e,s=t?4:6;r<=no.size?r-=.5*s:r-=s;const n=0,o=0,a=t?.35*r:.5*r;return[{type:"path",path:[{command:"M",values:[.5*r,n]},{command:"L",values:[r,.5*a]},{command:"L",values:[.5*r,a]},{command:"L",values:[o,.5*a]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[n,.5*a]},{command:"L",values:[.5*r,a]},{command:"L",values:[.5*r,i]},{command:"L",values:[o,i-.5*a]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[.5*r,a]},{command:"L",values:[.5*r,i]},{command:"L",values:[r,i-.5*a]},{command:"L",values:[r,.5*a]},{command:"Z",values:[]}]}]}function Gtt(e,t){let r=t?no.tallSymbolWidth:e;const i=e,s=t?4:6;r<=no.size?r-=.5*s:r-=s;const n=.5*r,o=.15*r,a=0,l=i-o;return[{type:"ellipse",cx:.5*r,cy:l,rx:n,ry:o},{type:"path",path:[{command:"M",values:[a,o]},{command:"L",values:[a,l]},{command:"L",values:[r,l]},{command:"L",values:[r,o]},{command:"Z",values:[]}]},{type:"ellipse",cx:.5*r,cy:o,rx:n,ry:o}]}function jtt(e,t){let r=t?no.tallSymbolWidth:e;const i=e,s=t?4:6;r<=no.size?r-=.5*s:r-=s;const n=.15*r,o=i-n;return[{type:"ellipse",cx:.5*r,cy:o,rx:.5*r,ry:n},{type:"path",path:[{command:"M",values:[.5*r,0]},{command:"L",values:[r,o]},{command:"L",values:[0,o]},{command:"Z",values:[]}]}]}function Htt(e){let t=e;const r=e,i=6;t<no.size?t-=.5*i:t-=i;const s=.15*t,n=0;return[{type:"path",path:[{command:"M",values:[0,n]},{command:"L",values:[t,n]},{command:"L",values:[.5*t,r-s]},{command:"Z",values:[]}]},{type:"ellipse",cx:.5*t,cy:n,rx:.5*t,ry:s}]}function qtt(e){let t=e;const r=e,i=4;t<no.size?t-=.5*i:t-=i;const s=0,n=0,o=t,a=r,l=Math.floor(e/10)-1||1;return[{type:"path",path:[{command:"M",values:[.45*o,s]},{command:"L",values:[o,.5*a-l]},{command:"L",values:[.45*o-l,.5*a+l]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[.45*o,s]},{command:"L",values:[.45*o-l,.5*a+l]},{command:"L",values:[n,.5*a-l]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[n,.5*a-l]},{command:"L",values:[.45*o-l,.5*a+l]},{command:"L",values:[.45*o,r]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[.45*o,r]},{command:"L",values:[o,.5*a-l]},{command:"L",values:[.45*o-l,.5*a+l]},{command:"Z",values:[]}]}]}function Wtt(e){const t=e,r=2;let i=e;i<no.size?i-=.5*r:i-=r;const s=0,n=0;return[{type:"path",path:[{command:"M",values:[.45*t,s]},{command:"L",values:[t,i]},{command:"L",values:[.45*t,.6*i]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[.45*t,s]},{command:"L",values:[.45*t,.6*i]},{command:"L",values:[n,i]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[n,i]},{command:"L",values:[.45*t,.6*i]},{command:"L",values:[t,i]},{command:"Z",values:[]}]}]}function d1(e,t){return Math.round(Math.min(Math.max(e+255*t*.75,0),255))}function DLt(e,t){if("type"in e&&(e.type==="linear"||e.type==="pattern"))return e;const r=new Me(e);return new Me([d1(r.r,t),d1(r.g,t),d1(r.b,t),r.a])}function Xtt(e){return"r"in e&&"g"in e&&"b"in e}function qAe(e){return"h"in e&&"s"in e&&"v"in e}function WAe(e){return"l"in e&&"a"in e&&"b"in e}function XAe(e){return"l"in e&&"c"in e&&"h"in e}function Ztt(e){return"x"in e&&"y"in e&&"z"in e}const Ytt=[[.4124,.3576,.1805],[.2126,.7152,.0722],[.0193,.1192,.9505]],Qtt=[[3.2406,-1.5372,-.4986],[-.9689,1.8758,.0415],[.0557,-.204,1.057]];function ZAe(e,t){const r=[];let i,s;if(e[0].length!==t.length)throw"dimensions do not match";const n=e.length,o=e[0].length;let a=0;for(i=0;i<n;i++){for(a=0,s=0;s<o;s++)a+=e[i][s]*t[s];r.push(a)}return r}function YAe(e){const t=[e.r/255,e.g/255,e.b/255].map(i=>i<=.04045?i/12.92:((i+.055)/1.055)**2.4),r=ZAe(Ytt,t);return{x:100*r[0],y:100*r[1],z:100*r[2]}}function Hre(e){const t=ZAe(Qtt,[e.x/100,e.y/100,e.z/100]).map(r=>{const i=r<=.0031308?12.92*r:1.055*r**.4166666666666667-.055;return Math.min(1,Math.max(i,0))});return{r:Math.round(255*t[0]),g:Math.round(255*t[1]),b:Math.round(255*t[2])}}function QAe(e){const t=[e.x/95.047,e.y/100,e.z/108.883].map(r=>r>.008856451679035631?r**.3333333333333333:7.787037037037035*r+.13793103448275862);return{l:116*t[1]-16,a:500*(t[0]-t[1]),b:200*(t[1]-t[2])}}function JAe(e){const t=e.l,r=[(t+16)/116+e.a/500,(t+16)/116,(t+16)/116-e.b/200].map(i=>i>6/29?i**3:3*(6/29)**2*(i-4/29));return{x:95.047*r[0],y:100*r[1],z:108.883*r[2]}}function Jtt(e){const t=e.l,r=e.a,i=e.b,s=Math.sqrt(r*r+i*i);let n=Math.atan2(i,r);return n=n>0?n:n+2*Math.PI,{l:t,c:s,h:n}}function Ktt(e){const t=e.l,r=e.c,i=e.h;return{l:t,a:r*Math.cos(i),b:r*Math.sin(i)}}function ert(e){return QAe(YAe(e))}function trt(e){return Hre(JAe(e))}function rrt(e){return Jtt(QAe(YAe(e)))}function irt(e){return Hre(JAe(Ktt(e)))}function srt(e){const t=e.r,r=e.g,i=e.b,s=Math.max(t,r,i),n=s-Math.min(t,r,i);let o=s,a=n===0?0:s===t?(r-i)/n%6:s===r?(i-t)/n+2:(t-r)/n+4,l=n===0?0:n/o;return a<0&&(a+=6),a*=60,l*=100,o*=100/255,{h:a,s:l,v:o}}function nrt(e){const t=(e.h+360)%360/60,r=e.s/100,i=e.v/100*255,s=i*r,n=s*(1-Math.abs(t%2-1));let o;switch(Math.floor(t)){case 0:o={r:s,g:n,b:0};break;case 1:o={r:n,g:s,b:0};break;case 2:o={r:0,g:s,b:n};break;case 3:o={r:0,g:n,b:s};break;case 4:o={r:n,g:0,b:s};break;case 5:case 6:o={r:s,g:0,b:n};break;default:o={r:0,g:0,b:0}}return o.r=Math.round(o.r+i-s),o.g=Math.round(o.g+i-s),o.b=Math.round(o.b+i-s),o}function pL(e){return Xtt(e)?e:XAe(e)?irt(e):WAe(e)?trt(e):Ztt(e)?Hre(e):qAe(e)?nrt(e):e}function qre(e){return qAe(e)?e:srt(pL(e))}function NLt(e){return WAe(e)?e:ert(pL(e))}function FLt(e){return XAe(e)?e:rrt(pL(e))}function _V(){const e=new Float32Array(6);return e[0]=1,e[3]=1,e}function ort(e){const t=new Float32Array(6);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t}function art(e,t,r,i,s,n){const o=new Float32Array(6);return o[0]=e,o[1]=t,o[2]=r,o[3]=i,o[4]=s,o[5]=n,o}function lrt(e,t){return new Float32Array(e,t,6)}function KAe(e,t,r,i){const s=t[i],n=t[i+1];e[i]=r[0]*s+r[2]*n+r[4],e[i+1]=r[1]*s+r[3]*n+r[5]}function crt(e,t,r,i=0,s=0,n=2){const o=s||t.length/n;for(let a=i;a<o;a++)KAe(e,t,r,a*n)}Object.freeze(Object.defineProperty({__proto__:null,create:_V,clone:ort,fromValues:art,createView:lrt,transform:KAe,transformMany:crt},Symbol.toStringTag,{value:"Module"}));function urt(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e}function nB(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e}function hrt(e,t,r,i,s,n,o){return e[0]=t,e[1]=r,e[2]=i,e[3]=s,e[4]=n,e[5]=o,e}function eRe(e,t){const r=t[0],i=t[1],s=t[2],n=t[3],o=t[4],a=t[5];let l=r*n-i*s;return l?(l=1/l,e[0]=n*l,e[1]=-i*l,e[2]=-s*l,e[3]=r*l,e[4]=(s*a-n*o)*l,e[5]=(i*o-r*a)*l,e):null}function drt(e){return e[0]*e[3]-e[1]*e[2]}function Kw(e,t,r){const i=t[0],s=t[1],n=t[2],o=t[3],a=t[4],l=t[5],c=r[0],h=r[1],p=r[2],f=r[3],m=r[4],g=r[5];return e[0]=i*c+n*h,e[1]=s*c+o*h,e[2]=i*p+n*f,e[3]=s*p+o*f,e[4]=i*m+n*g+a,e[5]=s*m+o*g+l,e}function oB(e,t,r){const i=t[0],s=t[1],n=t[2],o=t[3],a=t[4],l=t[5],c=Math.sin(r),h=Math.cos(r);return e[0]=i*h+n*c,e[1]=s*h+o*c,e[2]=i*-c+n*h,e[3]=s*-c+o*h,e[4]=a,e[5]=l,e}function Wre(e,t,r){const i=t[0],s=t[1],n=t[2],o=t[3],a=t[4],l=t[5],c=r[0],h=r[1];return e[0]=i*c,e[1]=s*c,e[2]=n*h,e[3]=o*h,e[4]=a,e[5]=l,e}function aB(e,t,r){const i=t[0],s=t[1],n=t[2],o=t[3],a=t[4],l=t[5],c=r[0],h=r[1];return e[0]=i,e[1]=s,e[2]=n,e[3]=o,e[4]=i*c+n*h+a,e[5]=s*c+o*h+l,e}function prt(e,t){const r=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=r,e[2]=-r,e[3]=i,e[4]=0,e[5]=0,e}function frt(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=t[1],e[4]=0,e[5]=0,e}function Xre(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=t[0],e[5]=t[1],e}function mrt(e){return"mat2d("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+")"}function grt(e){return Math.sqrt(e[0]**2+e[1]**2+e[2]**2+e[3]**2+e[4]**2+e[5]**2+1)}function yrt(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e[4]=t[4]+r[4],e[5]=t[5]+r[5],e}function tRe(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e[4]=t[4]-r[4],e[5]=t[5]-r[5],e}function vrt(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*r,e[5]=t[5]*r,e}function _rt(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e[2]=t[2]+r[2]*i,e[3]=t[3]+r[3]*i,e[4]=t[4]+r[4]*i,e[5]=t[5]+r[5]*i,e}function brt(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]}function wrt(e,t){const r=e[0],i=e[1],s=e[2],n=e[3],o=e[4],a=e[5],l=t[0],c=t[1],h=t[2],p=t[3],f=t[4],m=t[5];return Math.abs(r-l)<=At*Math.max(1,Math.abs(r),Math.abs(l))&&Math.abs(i-c)<=At*Math.max(1,Math.abs(i),Math.abs(c))&&Math.abs(s-h)<=At*Math.max(1,Math.abs(s),Math.abs(h))&&Math.abs(n-p)<=At*Math.max(1,Math.abs(n),Math.abs(p))&&Math.abs(o-f)<=At*Math.max(1,Math.abs(o),Math.abs(f))&&Math.abs(a-m)<=At*Math.max(1,Math.abs(a),Math.abs(m))}const xrt=Kw,Trt=tRe;Object.freeze(Object.defineProperty({__proto__:null,copy:urt,identity:nB,set:hrt,invert:eRe,determinant:drt,multiply:Kw,rotate:oB,scale:Wre,translate:aB,fromRotation:prt,fromScaling:frt,fromTranslation:Xre,str:mrt,frob:grt,add:yrt,subtract:tRe,multiplyScalar:vrt,multiplyScalarAndAdd:_rt,exactEquals:brt,equals:wrt,mul:xrt,sub:Trt},Symbol.toStringTag,{value:"Module"}));const Srt="http://www.w3.org/2000/svg";let Ert=0,Crt=0;const dhe=he("android"),Art=he("chrome")||dhe&&dhe>=4?"auto":"optimizeLegibility",Rrt={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7,z:0},Ort=/([A-DF-Za-df-z])|([-+]?\d*[.]?\d+(?:[eE][-+]?\d+)?)/g;let Zn={},yi={};const phe={solid:"none",shortdash:[4,1],shortdot:[1,1],shortdashdot:[4,1,1,1],shortdashdotdot:[4,1,1,1,1,1],dot:[1,3],dash:[4,3],longdash:[8,3],dashdot:[4,3,1,3],longdashdot:[8,3,1,3],longdashdotdot:[8,3,1,3,1,3]},Mrt=Math.PI;let Prt=1;function PE(e,t){const r=e*(Mrt/180);return Math.abs(t*Math.sin(r))+Math.abs(t*Math.cos(r))}function rRe(e){return e.map(t=>`${t.command} ${t.values.join(" ")}`).join(" ").trim()}function Zre(e,t,r,i){if(e){if(e.type==="circle")return U("circle",{fill:t,"fill-rule":"evenodd",stroke:r.color,"stroke-width":r.width,"stroke-linecap":r.cap,"stroke-linejoin":r.join,"stroke-dasharray":r.dashArray,"stroke-dashoffset":r.dashOffset,"stroke-miterlimit":"4",cx:e.cx,cy:e.cy,r:e.r});if(e.type==="ellipse")return U("ellipse",{fill:t,"fill-rule":"evenodd",stroke:r.color,"stroke-width":r.width,"stroke-linecap":r.cap,"stroke-linejoin":r.join,"stroke-dasharray":r.dashArray,"stroke-miterlimit":"4",cx:e.cx,cy:e.cy,rx:e.rx,ry:e.ry});if(e.type==="rect")return U("rect",{fill:t,"fill-rule":"evenodd",stroke:r.color,"stroke-width":r.width,"stroke-linecap":r.cap,"stroke-linejoin":r.join,"stroke-dasharray":r.dashArray,"stroke-miterlimit":"4",x:e.x,y:e.y,width:e.width,height:e.height});if(e.type==="image")return U("image",{href:e.src,x:e.x,y:e.y,width:e.width,height:e.height,preserveAspectRatio:"none"});if(e.type==="path"){const s=typeof e.path!="string"?rRe(e.path):e.path;return U("path",{fill:t,"fill-rule":"evenodd",stroke:r.color,"stroke-width":r.width,"stroke-linecap":r.cap,"stroke-linejoin":r.join,"stroke-dasharray":r.dashArray,"stroke-miterlimit":"4",d:s})}if(e.type==="text")return U("text",{"alignment-baseline":i.alignBaseline,fill:t,"fill-rule":"evenodd",stroke:r.color,"stroke-width":r.width,"stroke-linecap":r.cap,"stroke-linejoin":r.join,"stroke-dasharray":r.dashArray,"stroke-miterlimit":"4","text-anchor":i.align,"text-decoration":i.decoration,kerning:i.kerning,rotate:i.rotate,"text-rendering":Art,"font-style":i.font.style,"font-variant":i.font.variant,"font-weight":i.font.weight,"font-size":i.font.size,"font-family":i.font.family,x:e.x,y:e.y},e.text)}return null}function Yre(e){const t={fill:"none",pattern:null,linearGradient:null};if(e){if("type"in e&&e.type==="pattern"){const r="patternId-"+ ++Ert;t.fill=`url(#${r})`,t.pattern={id:r,x:e.x,y:e.y,width:e.width,height:e.height,image:{x:0,y:0,width:e.width,height:e.height,href:e.src}}}else if("type"in e&&e.type==="linear"){const r="linearGradientId-"+ ++Crt;t.fill=`url(#${r})`,t.linearGradient={id:r,x1:e.x1,y1:e.y1,x2:e.x2,y2:e.y2,stops:e.colors.map(i=>({offset:i.offset,color:i.color&&new Me(i.color).toString()}))}}else if(e){const r=new Me(e);t.fill=r.toString()}}return t}function Qre(e){const t={color:"none",width:1,cap:"butt",join:"4",dashArray:"none",dashOffset:"0"};if(e&&(e.width!=null&&(t.width=e.width),e.cap&&(t.cap=e.cap),e.join&&(t.join=e.join.toString()),e.color&&(t.color=new Me(e.color).toString()),e.dashArray&&(t.dashArray=e.dashArray),e.dashArray&&(t.dashOffset=e.dashoffset),e.style)){let r=null;if(e.style in phe&&(r=phe[e.style]),Array.isArray(r)){r=r.slice(0);for(let i=0;i<r.length;++i)r[i]*=e.width;if(e.cap!=="butt"){for(let i=0;i<r.length;i+=2)r[i]-=e.width,r[i]<1&&(r[i]=1);for(let i=1;i<r.length;i+=2)r[i]+=e.width}r=r.join(",")}t.dashArray=r}return t}function iRe(e,t){const r={align:null,decoration:null,kerning:null,rotate:null,font:{style:null,variant:null,weight:null,size:null,family:null}};return e&&(r.align=e.align,r.alignBaseline=e.alignBaseline,r.decoration=e.decoration,r.kerning=e.kerning?"auto":"0",r.rotate=e.rotated?"90":"0",r.font.style=t.style||"normal",r.font.variant=t.variant||"normal",r.font.weight=t.weight||"normal",r.font.size=t.size&&t.size.toString()||"10pt",r.font.family=t.family||"serif"),r}function sRe(e){const{pattern:t,linearGradient:r}=e;if(t)return U("pattern",{id:t.id,patternUnits:"userSpaceOnUse",x:t.x,y:t.y,width:t.width,height:t.height},U("image",{x:t.image.x,y:t.image.y,width:t.image.width,height:t.image.height,href:t.image.href}));if(r){const i=r.stops.map((s,n)=>U("stop",{key:`${n}-stop`,offset:s.offset,"stop-color":s.color}));return U("linearGradient",{id:r.id,gradientUnits:"userSpaceOnUse",x1:r.x1,y1:r.y1,x2:r.x2,y2:r.y2},i)}return null}function Irt(e,t){if(!e)return null;const r=[];for(const i of e){const{shape:s,fill:n,stroke:o,font:a}=i,l=Yre(n),c=Qre(o),h=s.type==="text"?iRe(s,a):null;r.push(Zre(s,l.fill,c,h))}return U("mask",{id:t,maskUnits:"userSpaceOnUse"},U("g",null,r))}function fhe(e,t,r){return aB(e,nB(e),[t,r])}function mhe(e,t,r,i,s){return Wre(e,nB(e),[t,r]),e[4]=e[4]*t-i*t+i,e[5]=e[5]*r-s*r+s,e}function $rt(e,t,r,i){const s=t%360*Math.PI/180;oB(e,nB(e),s);const n=Math.cos(s),o=Math.sin(s),a=e[4],l=e[5];return e[4]=a*n-l*o+i*o-r*n+r,e[5]=l*n+a*o-r*o-i*n+i,e}function wl(e,t){Zn&&"left"in Zn?(Zn.left>e&&(Zn.left=e),Zn.right<e&&(Zn.right=e),Zn.top>t&&(Zn.top=t),Zn.bottom<t&&(Zn.bottom=t)):Zn={left:e,bottom:t,right:e,top:t}}function ghe(e){const t=e.args,r=t.length;let i;switch(e.action){case"M":case"L":case"C":case"S":case"Q":case"T":for(i=0;i<r;i+=2)wl(t[i],t[i+1]);yi.x=t[r-2],yi.y=t[r-1];break;case"H":for(i=0;i<r;++i)wl(t[i],yi.y);yi.x=t[r-1];break;case"V":for(i=0;i<r;++i)wl(yi.x,t[i]);yi.y=t[r-1];break;case"m":{let s=0;for(("x"in yi)||(wl(yi.x=t[0],yi.y=t[1]),s=2),i=s;i<r;i+=2)wl(yi.x+=t[i],yi.y+=t[i+1]);break}case"l":case"t":for(i=0;i<r;i+=2)wl(yi.x+=t[i],yi.y+=t[i+1]);break;case"h":for(i=0;i<r;++i)wl(yi.x+=t[i],yi.y);break;case"v":for(i=0;i<r;++i)wl(yi.x,yi.y+=t[i]);break;case"c":for(i=0;i<r;i+=6)wl(yi.x+t[i],yi.y+t[i+1]),wl(yi.x+t[i+2],yi.y+t[i+3]),wl(yi.x+=t[i+4],yi.y+=t[i+5]);break;case"s":case"q":for(i=0;i<r;i+=4)wl(yi.x+t[i],yi.y+t[i+1]),wl(yi.x+=t[i+2],yi.y+=t[i+3]);break;case"A":for(i=0;i<r;i+=7)wl(t[i+5],t[i+6]);yi.x=t[r-2],yi.y=t[r-1];break;case"a":for(i=0;i<r;i+=7)wl(yi.x+=t[i+5],yi.y+=t[i+6])}}function yhe(e,t,r){const i=Rrt[e.toLowerCase()];let s;typeof i=="number"&&(i?t.length>=i&&(s={action:e,args:t.slice(0,t.length-t.length%i)},r.push(s),ghe(s)):(s={action:e,args:[]},r.push(s),ghe(s)))}function Lrt(e){const t=(typeof e.path!="string"?rRe(e.path):e.path).match(Ort),r=[];if(Zn={},yi={},!t)return null;let i="",s=[];const n=t.length;for(let a=0;a<n;++a){const l=t[a],c=parseFloat(l);isNaN(c)?(i&&yhe(i,s,r),s=[],i=l):s.push(c)}yhe(i,s,r);const o={x:0,y:0,width:0,height:0};return Zn&&"left"in Zn&&(o.x=Zn.left,o.y=Zn.top,o.width=Zn.right-Zn.left,o.height=Zn.bottom-Zn.top),o}function nRe(e){const t={x:0,y:0,width:0,height:0};if(e.type==="circle")t.x=e.cx-e.r,t.y=e.cy-e.r,t.width=2*e.r,t.height=2*e.r;else if(e.type==="ellipse")t.x=e.cx-e.rx,t.y=e.cy-e.ry,t.width=2*e.rx,t.height=2*e.ry;else if(e.type==="image"||e.type==="rect")t.x=e.x,t.y=e.y,t.width=e.width,t.height=e.height;else if(e.type==="path"){const r=Lrt(e);t.x=r.x,t.y=r.y,t.width=r.width,t.height=r.height}return t}function oRe(e){const t={x:0,y:0,width:0,height:0};let r=null,i=Number.NEGATIVE_INFINITY,s=Number.NEGATIVE_INFINITY;for(const n of e)r?(r.x=Math.min(r.x,n.x),r.y=Math.min(r.y,n.y),i=Math.max(i,n.x+n.width),s=Math.max(s,n.y+n.height)):(r=t,r.x=n.x,r.y=n.y,i=n.x+n.width,s=n.y+n.height);return r&&(r.width=i-r.x,r.height=s-r.y),r}function zY(e,t,r,i,s,n,o,a,l){let c=(o&&n?PE(n,t):t)/2,h=(o&&n?PE(n,r):r)/2;if(l){const T=l[0],x=l[1];c=(o&&n?PE(n,T):T)/2,h=(o&&n?PE(n,x):x)/2}const p=e.width+i,f=e.height+i,m=_V(),g=_V();let v=!1;if(s&&p!==0&&f!==0){const T=t!==r?t/r:p/f,x=t>r?t:r;let E=1,C=1;isNaN(x)||(T>1?(E=x/p,C=x/T/f):(C=x/f,E=x*T/p)),Kw(g,g,mhe(m,E,C,c,h)),v=!0}const w=e.x+(p-i)/2,_=e.y+(f-i)/2;if(Kw(g,g,fhe(m,c-w,h-_)),!v&&(p>t||f>r)){const T=p/t>f/r,x=(T?t:r)/(T?p:f);Kw(g,g,mhe(m,x,x,w,_))}return n&&Kw(g,g,$rt(m,n,w,_)),a&&Kw(g,g,fhe(m,a[0],a[1])),`matrix(${g[0]},${g[1]},${g[2]},${g[3]},${g[4]},${g[5]})`}function Drt(e,t,r){const i=e==null?void 0:e.effects.find(c=>c.type==="bloom");if(!i)return null;const{strength:s,radius:n}=i,o=s>0?n:0,a=(s+o)*t,l=4*s+1;return U("filter",{id:`bloom${r}`,x:"-100%",y:"-100%",width:"300%",height:"300%",filterUnits:"userSpaceOnUse"},U("feMorphology",{operator:"dilate",radius:(s+.5*o)*(5**(t/100)*(.4+t/100)),in:"SourceGraphic",result:"dilate"}),U("feGaussianBlur",{in:"dilate",stdDeviation:a/25,result:"blur"}),U("feGaussianBlur",{in:"blur",stdDeviation:a/50,result:"intensityBlur"}),U("feComponentTransfer",{in:"SourceGraphic",result:"intensityBrightness"},U("feFuncR",{type:"linear",slope:l}),U("feFuncG",{type:"linear",slope:l}),U("feFuncB",{type:"linear",slope:l})),U("feMerge",null,U("feMergeNode",{in:"intensityBlur"}),U("feMergeNode",{in:"intensityBrightness"}),U("feGaussianBlur",{stdDeviation:s/10})))}function aRe(e,t,r,i={}){var c;const s=[],n=[],o=++Prt,a=Drt(i.effectView,t,o);let l=null;if(a){const h=(c=i.effectView)==null?void 0:c.effects.find(g=>g.type==="bloom"),p=(h.strength?h.strength+h.radius/2:0)/3,f=t+t*p,m=r+r*p;l=[Math.max(f,10),Math.max(m,10)]}for(let h=0;h<e.length;h++){const p=e[h],f=[],m=[];let g=0,v=0,w=0;for(const x of p){const{shape:E,fill:C,stroke:A,font:P,offset:I}=x;i.ignoreStrokeWidth||(g+=A&&A.width||0);const L=Yre(C),k=Qre(A),G=E.type==="text"?iRe(E,P):null;s.push(sRe(L)),f.push(Zre(E,L.fill,k,G)),m.push(nRe(E)),I&&(v+=I[0],w+=I[1])}const _=zY(oRe(m),t,r,g,i.scale,i.rotation,i.useRotationSize,[v,w],l);let T=null;if(i.masking){const x=`mask-${h}`,E=i.masking[h];s.push(Irt(E,x)),T=`url(#${x})`}n.push(T?U("g",{mask:T},U("g",{transform:_},f)):U("g",{transform:_},f))}return i.useRotationSize&&i.rotation&&(t=PE(i.rotation,t),r=PE(i.rotation,r)),a&&(t=l[0],r=l[1]),U("svg",{xmlns:Srt,width:t,height:r,style:"display: block;"},a,U("defs",null,s),a?U("g",{filter:`url(#bloom${o})`},n):n)}const Nrt=HU();function fL(e,t,r){const i=Math.ceil(t[0]),s=Math.ceil(t[1]);if(!e.some(o=>!!o.length))return null;const n=r&&r.node||document.createElement("div");return r.opacity!=null&&(n.style.opacity=r.opacity.toString()),r.effectView!=null&&(n.style.filter=xI(r.effectView)),Nrt.append(n,aRe.bind(null,e,i,s,r)),n}function Frt(e,t){e=Math.ceil(e),t=Math.ceil(t);const r=document.createElement("canvas");r.width=e,r.height=t,r.style.width=e+"px",r.style.height=t+"px";const i=r.getContext("2d");return i.clearRect(0,0,e,t),i}function krt(e,t,r){return e?er(e,{responseType:"image"}).then(i=>{const s=i.data,n=s.width,o=s.height,a=n/o;let l=t;if(r){const c=Math.max(n,o);l=Math.min(l,c)}return{image:s,width:a<=1?Math.ceil(l*a):l,height:a<=1?l:Math.ceil(l/a)}}):Promise.reject(new j("renderUtils: imageDataSize","href not provided."))}function Urt(e,t){return!(!e||t==="ignore")&&(t!=="multiply"||e.r!==255||e.g!==255||e.b!==255||e.a!==1)}function Vrt(e,t,r,i,s){switch(s){case"multiply":e[t+0]*=r[0],e[t+1]*=r[1],e[t+2]*=r[2],e[t+3]*=r[3];break;default:{const n=qre({r:e[t+0],g:e[t+1],b:e[t+2]});n.h=i.h,n.s=i.s,n.v=n.v/100*i.v;const o=pL(n);e[t+0]=o.r,e[t+1]=o.g,e[t+2]=o.b,e[t+3]*=r[3];break}}}function zrt(e,t,r,i,s){return krt(e,t,s).then(n=>{const o=n.width?n.width:t,a=n.height?n.height:t;if(n.image&&Urt(r,i)){let l=n.image.width,c=n.image.height;he("edge")&&/\.svg$/i.test(e)&&(l-=1,c-=1);const h=Frt(o,a);h.drawImage(n.image,0,0,l,c,0,0,o,a);const p=h.getImageData(0,0,o,a),f=[r.r/255,r.g/255,r.b/255,r.a],m=qre(r);for(let g=0;g<p.data.length;g+=4)Vrt(p.data,g,f,m,i);h.putImageData(p,0,0),e=h.canvas.toDataURL("image/png")}else{const l=Xi&&Xi.findCredential(e);if(l&&l.token){const c=e.includes("?")?"&":"?";e=`${e}${c}token=${l.token}`}}return{url:e,width:o,height:a}}).catch(()=>({url:e,width:t,height:t}))}let yS=null;const vhe=[255,255,255];function _he(e,t){return Math.floor(Math.random()*(t-e+1)+e)}function Brt(e,t,r){const{backgroundColor:i,outline:s,dotSize:n}=e,o=r&&r.swatchSize||no.size,a=.8,l=Math.round(o*o/n**2*a),c=window.devicePixelRatio,h=document.createElement("canvas"),p=o*c;h.width=p,h.height=p,h.style.width=h.width/c+"px",h.style.height=h.height/c+"px";const f=h.getContext("2d");if(i&&(f.fillStyle=i.toCss(!0),f.fillRect(0,0,p,p),f.fill()),f.fillStyle=t.toCss(!0),yS&&yS.length/2===l)for(let g=0;g<2*l;g+=2){const v=yS[g],w=yS[g+1];f.fillRect(v,w,n*c,n*c),f.fill()}else{yS=[];for(let g=0;g<2*l;g+=2){const v=_he(0,p),w=_he(0,p);yS.push(v,w),f.fillRect(v,w,n*c,n*c),f.fill()}}s&&(s.color&&(f.strokeStyle=s.color.toCss(!0)),f.lineWidth=s.width,f.strokeRect(0,0,p,p));const m=new Image(o,o);return m.src=h.toDataURL(),m}function Grt(e,t={}){const r=t.radius||40,i=2*Math.PI*r,s=e.length,n=i/s,o=[],a=bI(t.outline);a&&(a.width*=2),(a||t.backgroundColor)&&o.push({shape:{type:"circle",cx:r,cy:r,r},fill:t.backgroundColor,stroke:a,offset:[0,0]});const l=t.values,c=l&&l.length===s&&l.reduce((g,v)=>g+v,0)===100,h=[0];for(let g=0;g<s;g++){const v=c?l[g]*i/100:null;c&&h.push(v+h[g]),o.push({shape:{type:"circle",cx:r,cy:r,r:r/2},fill:[0,0,0,0],stroke:{width:r,dashArray:`${v||n} ${i}`,dashoffset:"-"+(c?h[g]/2:g*(n/2)),color:e[g]},offset:[0,0]})}let p=null;const f=2*r+((a==null?void 0:a.width)||0),m=t.holePercentage;if(m){a&&o.push({shape:{type:"circle",cx:r,cy:r,r:r*m},fill:null,stroke:a,offset:[0,0]});const g=f/2;p=[[{shape:{type:"circle",cx:g,cy:g,r:g},fill:vhe,stroke:a?{...a,color:vhe}:null,offset:[0,0]},{shape:{type:"circle",cx:g,cy:g,r:r*m},fill:[0,0,0],stroke:null,offset:[0,0]}]]}return fL([o],[f,f],{effectView:t.effectList,ignoreStrokeWidth:!0,masking:p,rotation:-90})}function Tw(e,t={}){const s=t.align==="horizontal",n=s?75:24,o=s?24:75,{width:a=n,height:l=o,gradient:c=!0}=t,h=window.devicePixelRatio,p=a*h,f=l*h,m=document.createElement("canvas");m.width=p,m.height=f,m.style.width=`${a}px`,m.style.height=`${l}px`;const g=m.getContext("2d"),v=s?p:0,w=s?0:f;if(c){const T=g.createLinearGradient(0,0,v,w),x=e.length,E=x===1?0:1/(x-1);e.forEach((C,A)=>T.addColorStop(A*E,C.toString())),g.fillStyle=T,g.fillRect(0,0,p,f)}else{const T=s?p/e.length:p,x=s?f:f/e.length;let E=0,C=0;for(const A of e)g.fillStyle=A.toString(),g.fillRect(E,C,T,x),E=s?E+T:0,C=s?0:C+x}const _=document.createElement("div");return _.style.width=`${a}px`,_.style.height=`${l}px`,jrt(_,t==null?void 0:t.effectList),_.appendChild(m),_}function jrt(e,t){if(!t)return;e.style.filter=xI(t);const r=t.effects;if(r){for(const i of r)if((i==null?void 0:i.type)==="drop-shadow"){i.offsetX<0?e.style.marginLeft=`${Math.abs(i.offsetX)}px`:e.style.marginRight=`${i.offsetX}px`;break}}}async function lRe(e,t){switch(e.type){case"web-style":{const{previewWebStyleSymbol:r}=await ie(()=>import("./previewWebStyleSymbol.3373ba08.js"),[],import.meta.url);return r(e,lRe,t)}case"label-3d":case"line-3d":case"mesh-3d":case"point-3d":case"polygon-3d":{const{previewSymbol3D:r}=await ie(()=>Promise.resolve().then(()=>$Mt),void 0,import.meta.url);return r(e,t)}case"simple-marker":case"simple-line":case"simple-fill":case"picture-marker":case"picture-fill":case"text":{const{previewSymbol2D:r}=await ie(()=>import("./previewSymbol2D.67aab817.js"),[],import.meta.url);return r(e,t)}case"cim":{const{previewCIMSymbol:r}=await ie(()=>import("./previewCIMSymbol.c3b4577a.js"),["previewCIMSymbol.c3b4577a.js","CIMSymbolRasterizer.6bd8dfe3.js","cimAnalyzer.a17266d9.js","CIMSymbolHelper.0e25a568.js","BidiEngine.210f7ff8.js","enums.4de5fe56.js","number.6e30c64a.js"],import.meta.url);return r(e,t)}default:return}}function cRe(e){return e&&"opacity"in e?e.opacity*cRe(e.parent):1}async function Hrt(e,t){var w;if(!e)return;const r=e.sourceLayer,i=(w=b(t)&&t.useSourceLayer?r:e.layer)!=null?w:r,s=cRe(i);if(b(e.symbol)&&(!b(t)||t.ignoreGraphicSymbol!==!0)){const _=e.symbol.type==="web-style"?await e.symbol.fetchSymbol({...t,cache:b(t)?t.webStyleCache:null}):e.symbol.clone();return dG(_,null,s),_}const n=b(t)&&t.renderer||i&&"renderer"in i&&i.renderer;let o=n&&"getSymbolAsync"in n?await n.getSymbolAsync(e,t):null;if(!o)return;if(o=o.type==="web-style"?await o.fetchSymbol({...t,cache:b(t)?t.webStyleCache:null}):o.clone(),!("visualVariables"in n)||!n.visualVariables||!n.visualVariables.length)return dG(o,null,s),o;if("arcadeRequiredForVisualVariables"in n&&n.arcadeRequiredForVisualVariables&&(R(t)||R(t.arcade))){const _={...t};_.arcade=await Qm(),t=_}const a=await ie(()=>Promise.resolve().then(()=>iS),void 0,import.meta.url),l=[],c=[],h=[],p=[];for(const _ of n.visualVariables)switch(_.type){case"color":l.push(_);break;case"opacity":c.push(_);break;case"rotation":p.push(_);break;case"size":_.target||h.push(_)}const f=!!l.length&&l[l.length-1],m=f?a.getColor(f,e,t):null,g=!!c.length&&c[c.length-1];let v=g?a.getOpacity(g,e,t):null;if(s!=null&&(v=v!=null?v*s:s),dG(o,m,v),h.length){const _=a.getAllSizes(h,e,t);await lXe(o,_)}for(const _ of p)cXe(o,a.getRotationAngle(_,e,t),_.axis);return o}class g0{constructor(t,r){this.owner=r,this.properties={},this.afterDispatchHandle=null;for(const i in t){const s=t[i],n=new y1e(s,null,null,2,2);this.properties[i]={pool:n,acquired:[]}}this.afterDispatchHandle=O1e(()=>this._release())}destroy(){this.afterDispatchHandle&&(this.afterDispatchHandle.remove(),this.afterDispatchHandle=null);for(const t in this.properties){const r=this.properties[t];for(const i of r.acquired)tae(i)||r.pool.release(i);r.pool.destroy(),r.pool=null,r.acquired=null}this.properties=null,this.owner=null}get(t){const r=this.owner._get(t),i=this.properties[t];let s=i.pool.acquire();for(i.acquired.push(s);s===r;)i.acquired.push(s),s=i.pool.acquire();return s}_release(){for(const t in this.properties){const r=this.properties[t];let i=0;for(const s of r.acquired)tae(s)?r.acquired[i++]=s:r.pool.release(s);r.acquired.length=i}}}const qrt=he("mac")?"Meta":"Ctrl",lB={8:"Backspace",9:"Tab",13:"Enter",27:"Escape",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete"};for(let e=48;e<58;e++)lB[e]=String.fromCharCode(e);for(let e=1;e<25;e++)lB[111+e]=`F${e}`;for(let e=65;e<91;e++)lB[e]=[String.fromCharCode(e+32),String.fromCharCode(e)];function Wrt(e){if(e.key!==void 0)return Hw(e);const t=lB[e.keyCode];return Array.isArray(t)?e.shiftKey?t[1]:t[0]:t}function Xrt(e){switch(e){case"Ctrl":case"Alt":case"Shift":case"Meta":case"Primary":return!0}return!1}class Zrt{constructor(t,r=[]){this.eventType=t,this.keyModifiers=r}matches(t){if(t.type!==this.eventType)return!1;if(this.keyModifiers.length===0)return!0;const r=t.modifiers;for(const i of this.keyModifiers)if(!r.has(i))return!1;return!0}}const bhe=fe.getLogger("esri.views.input.InputHandler");class aa{constructor(t){this._manager=null,this._incoming={},this._outgoing={},this._incomingEventMatches=null,this._incomingEventTypes=null,this._outgoingEventTypes=null,this._hasSideEffects=t}get incomingEventMatches(){if(!this._incomingEventMatches){this._incomingEventMatches=[];for(const t in this._incoming){const r=this._incoming[t];for(const i of r)this._incomingEventMatches.push(i.match)}}return this._incomingEventMatches}get incomingEventTypes(){return this._incomingEventTypes||(this._incomingEventTypes=this.incomingEventMatches.map(t=>t.eventType)),this._incomingEventTypes}get outgoingEventTypes(){return this._outgoingEventTypes||(this._outgoingEventTypes=Object.keys(this._outgoing)),this._outgoingEventTypes}get hasSideEffects(){return this._hasSideEffects}get hasPendingInputs(){return!1}onInstall(t){this._manager?bhe.error("This InputHandler has already been registered with an InputManager"):(t.setEventCallback(r=>this._handleEvent(r)),t.setUninstallCallback(()=>this._onUninstall()),this._manager=t)}onUninstall(){}registerIncoming(t,r,i){let s;typeof r=="function"?(i=r,s=[]):s=r||[];const n=typeof t=="string"?new Zrt(t,s):t,o=()=>{this._incomingEventTypes=null,this._incomingEventMatches=null},a=h=>{const p=this._incoming[h.match.eventType];if(p){const f=p.indexOf(h);p.splice(f,1),o(),this._manager&&this._manager.updateDependencies()}},l=new Yrt(n,i,{onPause:a,onRemove:a,onResume:h=>{const p=this._incoming[h.match.eventType];p&&!p.includes(h)&&(p.push(h),o(),this._manager&&this._manager.updateDependencies())}});let c=this._incoming[n.eventType];return c||(c=[],this._incoming[n.eventType]=c),c.push(l),o(),this._manager&&this._manager.updateDependencies(),l}registerOutgoing(t){if(this._outgoing[t])throw Error("There is already a callback registered for this outgoing InputEvent: "+t);const r=new Qrt(t,{onEmit:(i,s,n,o)=>{this._manager.emit(i.eventType,s,n,o)},onRemove:i=>{delete this._outgoing[i.eventType],this._manager.updateDependencies()}});return this._outgoing[t]=r,this._outgoingEventTypes=null,this._manager&&this._manager.updateDependencies(),r}startCapturingPointer(t){this._manager.setPointerCapture(t,!0)}stopCapturingPointer(t){this._manager.setPointerCapture(t,!1)}refreshHasPendingInputs(){this._manager.refreshHasPendingInputs()}_onUninstall(){this._manager?(this.onUninstall(),this._manager=null):bhe.error("This InputHandler is not registered with an InputManager")}_handleEvent(t){const r=this._incoming[t.type];if(r){for(const i of r)if(i.match.matches(t)&&(i.callback(t),t.shouldStopPropagation()))break}}}class Yrt{constructor(t,r,i){this.match=t,this._callback=r,this._handler=i}pause(){this._handler.onPause(this)}resume(){this._handler.onResume(this)}remove(){this._handler.onRemove(this)}get callback(){return this._callback}}class Qrt{constructor(t,r){this.eventType=t,this._removed=!1,this._handler=r}emit(t,r,i){this._removed||this._handler.onEmit(this,t,r,i)}remove(){this._removed=!0,this._handler.onRemove(this)}}class Jrt extends aa{constructor(t){super(!0),this._onChange=t,this._value="mouse",this._x=null,this._y=null,this.registerIncoming("pointer-move",r=>{const i=r.data.native.pointerType==="touch";this._setValue(i?"touch":"mouse",r.data.x,r.data.y)})}_setValue(t,r,i){t===this._value&&this._x===r&&this._y===i||(this._value=t,this._x=r,this._y=i,this._onChange(t,r,i))}}const XG=fe.getLogger("esri.views.input.InputManager");let jv=class extends xe{constructor(e){super(e),this._pointerCaptures=new Map,this._nameToGroup={},this._handlers=[],this._currentPropagation=null,this._updateDependenciesAfterPropagation=!1,this._sourceEvents=new Set,this._keyModifiers=new Set,this._activeKeyModifiers=new Set,this._stoppedPropagationEventIds=new Set,this.primaryKey=qrt,this.latestPointerType="mouse",this._propertiesPool=new g0({latestPointerLocation:eit},this),this.latestPointerLocation=null,this.test={timestamp:void 0,hasCurrentPropagation:()=>!!this._currentPropagation}}initialize(){this.eventSource.onEventReceived=this._onEventReceived.bind(this),this._installRecognizers()}destroy(){const e=Object.keys(this._nameToGroup);for(const t of e)this.uninstallHandlers(t);this.eventSource=null,this._currentPropagation=null,this._propertiesPool.destroy()}get hasPendingInputs(){return this._handlers.some(e=>e.handler.hasPendingInputs)}installHandlers(e,t,r=p1.INTERNAL){if(this._nameToGroup[e])return void XG.error("There is already an InputHandler group registered under the name `"+e+"`");if(t.length===0)return void XG.error("Can't register a group of zero handlers");const i={name:e,handlers:t.map(s=>({handler:s,active:!0,removed:!1,priorityIndex:0,groupPriority:r,eventCallback:null,uninstallCallback:null}))};this._nameToGroup[e]=i;for(let s=i.handlers.length-1;s>=0;s--){const n=i.handlers[s];this._handlers.push(n),n.handler.onInstall({updateDependencies:()=>{this.updateDependencies()},emit:(o,a,l,c,h)=>{this._emitInputEvent(n.priorityIndex+1,o,a,l,h,c)},setPointerCapture:(o,a)=>{this._setPointerCapture(i,n,o,a)},setEventCallback:o=>{n.eventCallback=o},setUninstallCallback:o=>{n.uninstallCallback=o},refreshHasPendingInputs:()=>{this.notifyChange("hasPendingInputs")}})}this.updateDependencies()}uninstallHandlers(e){const t=this._nameToGroup[e];t?(t.handlers.forEach(r=>{r.removed=!0,r.uninstallCallback()}),delete this._nameToGroup[e],this._currentPropagation?this._currentPropagation.needsHandlerGarbageCollect=!0:this._garbageCollectRemovedHandlers()):XG.error("There is no InputHandler group registered under the name `"+e+"`")}hasHandlers(e){return this._nameToGroup[e]!==void 0}updateDependencies(){if(this._currentPropagation)return void(this._updateDependenciesAfterPropagation=!0);this._updateDependenciesAfterPropagation=!1;const e=new Set,t=new Set;this._handlersPriority=[];for(let r=this._handlers.length-1;r>=0;r--){const i=this._handlers[r];i.priorityIndex=r,this._handlersPriority.push(i)}this._handlersPriority=this._sortHandlersPriority(this._handlersPriority);for(let r=this._handlersPriority.length-1;r>=0;r--){const i=this._handlersPriority[r];i.priorityIndex=r;let s=i.handler.hasSideEffects;if(!s){for(const n of i.handler.outgoingEventTypes)if(e.has(n)){s=!0;break}}if(s)for(const n of i.handler.incomingEventMatches){e.add(n.eventType);for(const o of n.keyModifiers)Xrt(o)||t.add(o)}i.active=s}this._sourceEvents=e,this._keyModifiers=t,this._pointerCaptures.size>0&&this._sourceEvents.add("pointer-capture-lost"),this._keyModifiers.size>0&&(this._sourceEvents.add("key-down"),this._sourceEvents.add("key-up")),this.eventSource&&(this.eventSource.activeEvents=this._sourceEvents)}_setLatestPointer(e,t,r){this._get("latestPointerType")!==e&&this._set("latestPointerType",e);const i=this._get("latestPointerLocation");if(R(i)||i.x!==t||i.y!==r){const s=this._propertiesPool.get("latestPointerLocation");s.x=t,s.y=r,this._set("latestPointerLocation",s)}}_onEventReceived(e,t){if(e==="pointer-capture-lost"){const s=t;this._pointerCaptures.delete(s.native.pointerId)}this._updateKeyModifiers(e,t);const r=this.test.timestamp!=null?this.test.timestamp:t.native?t.native.timestamp:void 0,i=t.native?t.native.cancelable:void 0;this._emitInputEventFromSource(e,t,r,i)}_updateKeyModifiers(e,t){if(!t)return;let r=!1;const i=()=>{if(!r){const o=new Set;this._activeKeyModifiers.forEach(a=>{o.add(a)}),this._activeKeyModifiers=o,r=!0}},s=(o,a)=>{a&&!this._activeKeyModifiers.has(o)?(i(),this._activeKeyModifiers.add(o)):!a&&this._activeKeyModifiers.has(o)&&(i(),this._activeKeyModifiers.delete(o))};if(e==="key-down"||e==="key-up"){const o=t.key;this._keyModifiers.has(o)&&s(o,e==="key-down")}const n=t.native;s("Alt",!(!n||!n.altKey)),s("Ctrl",!(!n||!n.ctrlKey)),s("Shift",!(!n||!n.shiftKey)),s("Meta",!(!n||!n.metaKey)),s("Primary",this._activeKeyModifiers.has(this.primaryKey))}_installRecognizers(){this._latestPointerHandler=new Jrt((e,t,r)=>this._setLatestPointer(e,t,r)),this.installHandlers("input-manager-logic",[this._latestPointerHandler],p1.ALWAYS),this.recognizers.length>0&&this.installHandlers("default",this.recognizers,p1.INTERNAL)}_setPointerCapture(e,t,r,i){const s=e.name+"-"+t.priorityIndex,n=this._pointerCaptures.get(r.pointerId)||new Set;this._pointerCaptures.set(r.pointerId,n),i?(n.add(s),n.size===1&&this.eventSource&&this.eventSource.setPointerCapture(r,!0)):n.has(s)&&(n.delete(s),n.size===0&&(this._pointerCaptures.delete(r.pointerId),this.eventSource&&this.eventSource.setPointerCapture(r,!1)))}_garbageCollectRemovedHandlers(){this._handlers=this._handlers.filter(e=>!e.removed),this.updateDependencies()}_emitInputEventFromSource(e,t,r,i){this._emitInputEvent(0,e,t,r,i)}_emitInputEvent(e,t,r,i,s,n){const o=i!==void 0?i:this._currentPropagation?this._currentPropagation.timestamp:performance.now(),a=s!==void 0&&s,l={event:new Krt(t,r,o,n||this._activeKeyModifiers,a),priorityIndex:e};this._currentPropagation?this._currentPropagation.events.push(l):this._doNewPropagation(l)}_doNewPropagation(e){this._currentPropagation={events:new vX,currentHandler:null,needsHandlerGarbageCollect:!1,timestamp:e.event.timestamp},this._currentPropagation.events.push(e),this._continuePropagation()}_continuePropagation(){const e=this._currentPropagation;if(e){for(;this._currentPropagation.events.length>0;){const{event:t,priorityIndex:r}=this._currentPropagation.events.pop(),i=t.data&&t.data.eventId;if(!(i!=null&&this._stoppedPropagationEventIds.has(i)))for(e.currentHandler=this._handlersPriority[r];e.currentHandler;){if(e.currentHandler.removed)e.needsHandlerGarbageCollect=!0;else{if(e.currentHandler.active&&!t.shouldStopPropagation()&&e.currentHandler.eventCallback(t),t.shouldStopPropagation()){i!=null&&this._stoppedPropagationEventIds.add(i);break}if(t.shouldPausePropagation(()=>this._continuePropagation()))return void this._pausePropagation({event:t,priorityIndex:e.currentHandler.priorityIndex+1})}e.currentHandler=this._handlersPriority[e.currentHandler.priorityIndex+1]}}e.needsHandlerGarbageCollect&&this._garbageCollectRemovedHandlers(),this.hasPendingInputs||this._stoppedPropagationEventIds.clear(),this._currentPropagation=null,this._updateDependenciesAfterPropagation&&this.updateDependencies()}}_pausePropagation(e){const t=new vX;for(t.push(e);this._currentPropagation.events.length;)t.push(this._currentPropagation.events.pop());this._currentPropagation.events=t,this._currentPropagation.currentHandler=null}_compareHandlerPriority(e,t){if(e.handler.hasSideEffects!==t.handler.hasSideEffects)return e.handler.hasSideEffects?1:-1;if(e.groupPriority!==t.groupPriority)return e.groupPriority>t.groupPriority?-1:1;for(const r of e.handler.incomingEventMatches)for(const i of t.handler.incomingEventMatches){if(r.eventType!==i.eventType)continue;const s=r.keyModifiers.filter(n=>i.keyModifiers.includes(n));if(s.length===r.keyModifiers.length!=(s.length===i.keyModifiers.length))return r.keyModifiers.length>i.keyModifiers.length?-1:1}return e.priorityIndex>t.priorityIndex?-1:1}_sortHandlersPriority(e){const t=[];for(const r of e){let i=0;for(;i<t.length&&this._compareHandlerPriority(r,t[i])>=0;)i++;t.splice(i,0,r)}return t}get debug(){const e=t=>{const r=this._setPointerCapture;this._setPointerCapture=()=>{},t(),this._setPointerCapture=r};return{injectEvent:(t,r)=>{e(()=>{this._onEventReceived(t,r)})},disablePointerCapture:e}}};u([d({readOnly:!0})],jv.prototype,"hasPendingInputs",null),u([d()],jv.prototype,"eventSource",void 0),u([d()],jv.prototype,"recognizers",void 0),u([d({readOnly:!0})],jv.prototype,"latestPointerType",void 0),u([d({readOnly:!0})],jv.prototype,"latestPointerLocation",void 0),jv=u([$("esri.views.input.InputManager")],jv);class Krt{constructor(t,r,i,s,n){this.type=t,this.data=r,this.timestamp=i,this.modifiers=s,this.cancelable=n,this._propagationState=f_.NONE,this._resumeCallback=null}stopPropagation(){this._propagationState|=f_.STOPPED}shouldStopPropagation(){return(this._propagationState&f_.STOPPED)!=0}async(t){this._propagationState|=f_.PAUSED;const r=(i,s)=>{this._propagationState&=~f_.PAUSED;const n=this._resumeCallback;if(this._resumeCallback=null,n&&n(),s)throw i;return i};return(typeof t=="function"?t():t).then(i=>r(i,!1),i=>r(i,!0))}shouldPausePropagation(t){return!!(this._propagationState&f_.PAUSED)&&(this._resumeCallback=t,!0)}preventDefault(){this.data.native.preventDefault()}}var f_;(function(e){e[e.NONE=0]="NONE",e[e.STOPPED=1]="STOPPED",e[e.PAUSED=2]="PAUSED"})(f_||(f_={}));const p1={ALWAYS:1,DEFAULT:0,TOOL:-1,WIDGET:-2,INTERNAL:-3};class eit{}function whe(e){return e&&typeof e.highlight=="function"}function tit(e){return e&&typeof e.maskOccludee=="function"}function kLt(e,t,r){return R(e)||e>r&&(t===0||e<t)}function ULt(e,t){return e>0||t>0}function VLt(e){var r,i;const t=e.effectiveScaleRange;return{minScale:(r=t==null?void 0:t.minScale)!=null?r:0,maxScale:(i=t==null?void 0:t.maxScale)!=null?i:0}}const cB={iconZoom:"esri-icon-zoom-in-magnifying-glass",iconTrash:"esri-icon-trash",iconBrowseClusteredFeatures:"esri-icon-table"},Tx=new lR({id:"zoom-to-feature",title:"{messages.zoom}",className:cB.iconZoom}),xhe=new lR({id:"remove-selected-feature",title:"{messages.remove}",className:cB.iconTrash}),IE=new lR({id:"zoom-to-clustered-features",title:"{messages.zoom}",className:cB.iconZoom}),$E=new lR({id:"browse-clustered-features",title:"{messages.browseClusteredFeatures}",className:cB.iconBrowseClusteredFeatures}),rit="esri.widgets.Popup.PopupViewModel",bV=fe.getLogger(rit),iit=e=>{const{event:t,view:r}=e,{action:i}=t,s=r&&r.popup;if(!i)return Promise.reject(new j("trigger-action:missing-arguments","Event has no action"));if(!s)return Promise.reject(new j("trigger-action:missing-arguments","view.popup is missing"));const{disabled:n,id:o}=i;if(!o)return Promise.reject(new j("trigger-action:invalid-action","action.id is missing"));if(n)return Promise.reject(new j("trigger-action:invalid-action","Action is disabled"));if(o===Tx.id)return nit(s.viewModel).catch(Tq);if(o===IE.id)return oit(s.viewModel);if(o===$E.id)return s.featureMenuOpen=!s.featureMenuOpen,s.viewModel.browseClusterEnabled=!s.viewModel.browseClusterEnabled,Promise.resolve();if(s.viewModel.browseClusterEnabled=!1,o===xhe.id){s.close();const{selectedFeature:a}=s;if(!a)return Promise.reject(new j(`trigger-action:${xhe.id}`,"selectedFeature is required",{selectedFeature:a}));const{sourceLayer:l}=a;return l?l.remove(a):r.graphics.remove(a),Promise.resolve()}return Promise.resolve()};function uRe(e){const{selectedFeature:t,location:r,view:i}=e;return i?i.type==="3d"?t||r:e.get("selectedFeature.geometry")||r:null}function ex(e){var t,r;return(e==null?void 0:e.isAggregate)&&((r=(t=e==null?void 0:e.sourceLayer)==null?void 0:t.featureReduction)==null?void 0:r.type)==="cluster"}function sit(e,t){if((t==null?void 0:t.type)!=="3d"||!e||e.declaredClass!=="esri.Graphic")return!0;const r=t.getViewForGraphic(e);if(r&&"whenGraphicBounds"in r){let i=!1;return r.whenGraphicBounds(e,{useViewElevation:!0}).then(s=>{i=!s||!s.boundingBox||s.boundingBox[0]===s.boundingBox[3]&&s.boundingBox[1]===s.boundingBox[4]&&s.boundingBox[2]===s.boundingBox[5]}).catch(()=>{const s=new j("zoom-to:invalid-graphic","Could not zoom to the location of the graphic.",{graphic:e});bV.error(s)}),i}return!0}async function nit(e){const{location:t,selectedFeature:r,view:i,zoomFactor:s}=e,n=uRe(e);if(!n){const c=new j("zoom-to:invalid-target-or-view","Cannot zoom to location without a target and view.",{target:n,view:i});throw bV.error(c),c}const o=i.scale/s,a=e.get("selectedFeature.geometry")||t,l=a&&a.type==="point"&&sit(r,i);Tx.active=!0,Tx.disabled=!0;try{await e.view.goTo({target:n,scale:l?o:void 0})}finally{Tx.active=!1,Tx.disabled=!1,e.zoomToLocation=null,l&&(e.location=a)}}async function oit(e){const{selectedFeature:t,view:r}=e;if((r==null?void 0:r.type)!=="2d"){const a=new j("zoomToCluster:invalid-view","View must be 2d MapView.",{view:r});throw bV.error(a),a}if(!ex(t)){const a=new j("zoomToCluster:invalid-selectedFeature","Selected feature must represent an aggregate/cluster graphic.",{selectedFeature:t});throw bV.error(a),a}const i=t.sourceLayer,s=await r.whenLayerView(i),n=s.createQuery();n.aggregateIds=[t.getObjectId()],IE.active=!0,IE.disabled=!0;const{extent:o}=await s.queryExtent(n);await r.goTo({target:o}),IE.active=!1,IE.disabled=!1}async function ait(e){const{selectedFeature:t,view:r}=e,i=t.sourceLayer,s=await r.whenLayerView(i),n=s.createQuery();n.aggregateIds=[t.getObjectId()];const{extent:o}=await s.queryExtent(n);e.selectedClusterBoundaryFeature.geometry=o,r.graphics.add(e.selectedClusterBoundaryFeature)}async function lit(e){const{selectedFeature:t,view:r}=e,i=t.sourceLayer,s=await r.whenLayerView(i),n=s.createQuery();n.aggregateIds=[t.getObjectId()],$E.active=!0,$E.disabled=!0;const{features:o}=await s.queryFeatures(n);$E.active=!1,$E.disabled=!1,r.popup.open({features:[t].concat(o),featureMenuOpen:!0})}function cit(e){const t=e.features.filter(r=>ex(r));t.length&&(e.features=t)}const Jre=e=>{let t=class extends e{constructor(...r){super(...r),this.goToOverride=null,this.view=null}callGoTo(r){const{view:i}=this;return this.goToOverride?this.goToOverride(i,r):i.goTo(r.target,r.options)}};return u([d()],t.prototype,"goToOverride",void 0),u([d()],t.prototype,"view",void 0),t=u([$("esri.widgets.support.GoTo")],t),t},lP=ot.ofType({key:"type",defaultKeyValue:"button",base:o6,typeMap:{button:lR,toggle:Uwe}}),uit=()=>[Tx.clone()],hit=()=>[IE.clone(),$E.clone()],hRe="esri.widgets.Popup.PopupViewModel",pN=fe.getLogger(hRe);let Rr=class extends Jre(jAe){constructor(e){super(e),this._handles=new Dt,this._pendingPromises=new Set,this._fetchFeaturesController=null,this._selectedClusterFeature=null,this.featurePage=null,this.actions=new lP,this.activeFeature=null,this.defaultPopupTemplateEnabled=!1,this.autoCloseEnabled=!1,this.autoOpenEnabled=!0,this.browseClusterEnabled=!1,this.content=null,this.featuresPerPage=20,this.featureViewModelAbilities=null,this.featureViewModels=[],this.highlightEnabled=!0,this.includeDefaultActions=!0,this.selectedClusterBoundaryFeature=new gl({symbol:new mg({outline:{width:1.5,color:"cyan"},style:"none"})}),this.title=null,this.updateLocationEnabled=!1,this.view=null,this.visible=!1,this.zoomFactor=4,this.zoomToLocation=null}get isLoadingFeature(){return this.featureViewModels.some(e=>e.waitingForContent)}initialize(){this._handles.add([te(()=>[this.autoOpenEnabled,this.view],()=>this._autoOpenEnabledChange()),this.on("view-change",()=>this._autoClose()),te(()=>[this.highlightEnabled,this.selectedFeature,this.visible,this.view],()=>this._highlightSelectedFeature()),te(()=>[this.highlightEnabled,this.activeFeature,this.visible,this.view],()=>this._highlightActiveFeature()),te(()=>{var e,t;return(t=(e=this.view)==null?void 0:e.animation)==null?void 0:t.state},e=>this._animationStateChange(e)),te(()=>this.location,e=>this._locationChange(e)),te(()=>this.selectedFeature,e=>this._selectedFeatureChange(e)),te(()=>[this.selectedFeatureIndex,this.featureCount,this.featuresPerPage],()=>this._selectedFeatureIndexChange()),te(()=>[this.featurePage,this.selectedFeatureIndex,this.featureCount,this.featuresPerPage,this.featureViewModels],()=>this._setGraphicOnFeatureViewModels()),te(()=>this.featureViewModels,()=>this._featureViewModelsChange()),this.on("trigger-action",e=>iit({event:e,view:this.view})),Lo(()=>!this.waitingForResult,()=>this._waitingForResultChange(),ei),te(()=>{var e,t;return[this.features,(e=this.view)==null?void 0:e.map,(t=this.view)==null?void 0:t.spatialReference]},()=>this._updateFeatureVMs()),te(()=>{var e;return(e=this.view)==null?void 0:e.scale},()=>this._viewScaleChange()),Lo(()=>!this.visible,()=>this.browseClusterEnabled=!1),te(()=>this.browseClusterEnabled,e=>e?this.enableClusterBrowsing():this.disableClusterBrowsing())])}destroy(){this._cancelFetchingFeatures(),this._handles.destroy(),this._handles=null,this._pendingPromises.clear(),this.browseClusterEnabled=!1,this.view=null}get active(){return!(!this.visible||this.waitingForResult)}get allActions(){const e=this._get("allActions")||new lP;e.removeAll();const{actions:t,defaultActions:r,defaultPopupTemplateEnabled:i,includeDefaultActions:s,selectedFeature:n}=this,o=s?r.concat(t):t,a=n&&(typeof n.getEffectivePopupTemplate=="function"&&n.getEffectivePopupTemplate(i)||n.popupTemplate),l=a&&a.actions,c=a&&a.overwriteActions?l:l?l.concat(o):o;return c&&c.filter(Boolean).forEach(h=>e.add(h)),e}get defaultActions(){const e=this._get("defaultActions")||new lP;return e.removeAll(),e.addMany(ex(this.selectedFeature)?hit():uit()),e}get featureCount(){return this.features.length}get features(){return this._get("features")||[]}set features(e){const t=e||[];this._set("features",t);const{pendingPromisesCount:r,promiseCount:i,selectedFeatureIndex:s}=this,n=i&&t.length;n&&r&&s===-1?this.selectedFeatureIndex=0:n&&s!==-1||(this.selectedFeatureIndex=t.length?0:-1)}get location(){return this._get("location")||null}set location(e){const t=this.get("view.spatialReference.isWebMercator");e&&e.get("spatialReference.isWGS84")&&t&&(e=jy(e)),this._set("location",e)}get pendingPromisesCount(){return this._pendingPromises.size}get waitingForResult(){return!(!(!!this._fetchFeaturesController||this.pendingPromisesCount>0)||this.featureCount!==0)}get promiseCount(){return this.promises.length}get promises(){return this._get("promises")||[]}set promises(e){if(this._pendingPromises.clear(),this.features=[],!Array.isArray(e)||!e.length)return this._set("promises",[]),void this.notifyChange("pendingPromisesCount");this._set("promises",e),(e=e.slice(0)).forEach(t=>{this._pendingPromises.add(t);const r=s=>{this._pendingPromises.has(t)&&this._updateFeatures(s),this._updatePendingPromises(t)},i=()=>this._updatePendingPromises(t);t.then(r,i)}),this.notifyChange("pendingPromisesCount")}get selectedFeature(){const{features:e,selectedFeatureIndex:t}=this;return t===-1?null:e[t]||null}get selectedFeatureIndex(){const e=this._get("selectedFeatureIndex");return typeof e=="number"?e:-1}set selectedFeatureIndex(e){const{featureCount:t}=this;e=isNaN(e)||e<-1||!t?-1:(e+t)%t,this.activeFeature=null,this._set("selectedFeatureIndex",e)}get selectedFeatureViewModel(){return this.featureViewModels[this.selectedFeatureIndex]||null}get state(){return this.get("view.ready")?"ready":"disabled"}centerAtLocation(){const{view:e}=this,t=uRe(this);if(!t){const r=new j("center-at-location:invalid-target-or-view","Cannot center at a location without a target and view.",{target:t,view:e});return pN.error(r),Promise.reject(r)}return this.callGoTo({target:{target:t,scale:e.scale}})}clear(){this.set({promises:[],features:[],content:null,title:null,location:null,activeFeature:null})}fetchFeatures(e,t){const{view:r}=this;if(!r||!e){const i=new j("fetch-features:invalid-screenpoint-or-view","Cannot fetch features without a screenPoint and view.",{screenPoint:e,view:r});return pN.error(i),Promise.reject(i)}return r.fetchPopupFeatures(e,{event:t&&t.event,defaultPopupTemplateEnabled:this.defaultPopupTemplateEnabled,signal:t&&t.signal})}open(e){const t={updateLocationEnabled:!1,promises:[],fetchFeatures:!1,...e,visible:!0},{fetchFeatures:r}=t;delete t.fetchFeatures,r&&this._setFetchFeaturesPromises(t.location);const i=["actionsMenuOpen","collapsed","featureMenuOpen"];for(const s of i)delete t[s];this.set(t)}triggerAction(e){const t=this.allActions.getItemAt(e);t&&!t.disabled&&this.emit("trigger-action",{action:t})}next(){return this.selectedFeatureIndex=this.selectedFeatureIndex+1,this}previous(){return this.selectedFeatureIndex=this.selectedFeatureIndex-1,this}disableClusterBrowsing(){cit(this),this._clearBrowsedClusterGraphics()}async enableClusterBrowsing(){const{view:e,selectedFeature:t}=this;(e==null?void 0:e.type)==="2d"?ex(t)?(await ait(this),await lit(this)):pN.warn("enableClusterBrowsing:invalid-selectedFeature: Selected feature must represent an aggregate/cluster graphic.",t):pN.warn("enableClusterBrowsing:invalid-view: View must be 2d MapView.",t)}_animationStateChange(e){this.zoomToLocation||(Tx.disabled=e==="waiting-for-target")}_clearBrowsedClusterGraphics(){var t;const e=(t=this.view)==null?void 0:t.graphics;e&&(e.remove(this.selectedClusterBoundaryFeature),e.remove(this._selectedClusterFeature)),this._selectedClusterFeature=null,this.selectedClusterBoundaryFeature.geometry=null}_viewScaleChange(){if(ex(this.selectedFeature))return this.browseClusterEnabled=!1,this.visible=!1,void this.clear();this.browseClusterEnabled&&(this.features=[this.selectedFeature])}_locationChange(e){const{selectedFeature:t,updateLocationEnabled:r}=this;r&&e&&(!t||t.geometry)&&this.centerAtLocation()}_selectedFeatureIndexChange(){this.featurePage=this.featureCount>1?Math.floor(this.selectedFeatureIndex/this.featuresPerPage)+1:null}_featureViewModelsChange(){this.featurePage=this.featureCount>1?1:null}_setGraphicOnFeatureViewModels(){const{features:e,featureCount:t,featurePage:r,featuresPerPage:i,featureViewModels:s}=this;if(r===null)return;const n=((r-1)*i+t)%t,o=n+i;s.slice(n,o).forEach((a,l)=>{a&&!a.graphic&&(a.graphic=e[n+l])})}async _selectedFeatureChange(e){if(!e)return;const{location:t,updateLocationEnabled:r,view:i}=this;if(this.browseClusterEnabled)return this._selectedClusterFeature&&(i.graphics.remove(this._selectedClusterFeature),this._selectedClusterFeature=null),ex(e)?void 0:(e.symbol=await Hrt(e),this._selectedClusterFeature=e,void i.graphics.add(this._selectedClusterFeature));!r&&t||!e.geometry?r&&!e.geometry&&this.centerAtLocation().then(()=>{this.location=i.center.clone()}):this.location=this._getPointFromGeometry(e.geometry)}_waitingForResultChange(){!this.featureCount&&this.promises&&(this.visible=!1)}_setFetchFeaturesPromises(e){return this._fetchFeaturesWithController(this._getScreenPoint(e||this.location)).then(t=>{const{clientOnlyGraphics:r,promisesPerLayerView:i}=t,s=Promise.resolve(r),n=i.map(o=>o.promise);this.promises=[s,...n]})}_destroyFeatureVMs(){this.featureViewModels.forEach(e=>e&&!e.destroyed&&e.destroy()),this._set("featureViewModels",[])}_updateFeatureVMs(){const{selectedFeature:e,features:t,featureViewModels:r}=this;if(ex(e)||(this.browseClusterEnabled=!1),this._destroyFeatureVMs(),!t||!t.length)return;const i=r.slice(0),s=[];t.forEach((n,o)=>{var l,c;if(!n)return;let a=null;if(i.some((h,p)=>(h&&h.graphic===n&&(a=h,i.splice(p,1)),!!a)),a)s[o]=a;else{const h=new jre({abilities:this.featureViewModelAbilities,defaultPopupTemplateEnabled:this.defaultPopupTemplateEnabled,spatialReference:(l=this.view)==null?void 0:l.spatialReference,graphic:n===e?n:null,map:(c=this.view)==null?void 0:c.map,view:this.view});s[o]=h}}),i.forEach(n=>n&&!n.destroyed&&n.destroy()),this._set("featureViewModels",s)}_getScreenPoint(e){const{view:t}=this;return t&&e&&typeof t.toScreen=="function"?t.toScreen(e):null}_autoOpenEnabledChange(){const e="auto-fetch-features",{_handles:t,autoOpenEnabled:r}=this;if(t.remove(e),r&&this.view){const i=this.view.on("click",s=>{s.pointerType==="mouse"&&s.button!==0||this._fetchFeaturesAndOpen(s)},p1.WIDGET);t.add(i,e)}}_cancelFetchingFeatures(){const e=this._fetchFeaturesController;e&&e.abort(),this._fetchFeaturesController=null,this.notifyChange("waitingForResult")}_fetchFeaturesWithController(e,t){this._cancelFetchingFeatures();const r=new AbortController,{signal:i}=r;this._fetchFeaturesController=r,this.notifyChange("waitingForResult");const s=this.fetchFeatures(e,{signal:i,event:t});return s.catch(()=>{}).then(()=>{this._fetchFeaturesController=null,this.notifyChange("waitingForResult")}),s}_fetchFeaturesAndOpen(e){const{screenPoint:t,mapPoint:r}=e,{view:i}=this;this._fetchFeaturesWithController(t,e).then(s=>{const{clientOnlyGraphics:n,promisesPerLayerView:o,location:a}=s,l=[Promise.resolve(n),...o.map(c=>c.promise)];return i.popup.open({location:a||r,promises:l}),s})}_updatePendingPromises(e){e&&this._pendingPromises.has(e)&&(this._pendingPromises.delete(e),this.notifyChange("pendingPromisesCount"))}_autoClose(){this.autoCloseEnabled&&(this.visible=!1)}_getPointFromGeometry(e){return R(e)?null:e.type==="point"?e:e.type==="extent"?e.center:e.type==="polygon"?e.centroid:e.type==="multipoint"||e.type==="polyline"?e.extent.center:null}async _getLayerView(e,t){return await e.when(),e.whenLayerView(t)}_getHighlightLayer(e){const{layer:t,sourceLayer:r}=e;return(r==null?void 0:r.type)==="map-notes"||(r==null?void 0:r.type)==="subtype-group"?r:t}_getHighlightTarget(e,t){const r=t.type==="imagery"?void 0:"objectIdField"in t&&t.objectIdField,i=e.attributes;return i&&r&&i[r]||e}async _highlightActiveFeature(){const e="highlight-active-feature";this._handles.remove(e);const{highlightEnabled:t,view:r,activeFeature:i,visible:s}=this;if(!(i&&r&&t&&s))return;const n=this._getHighlightLayer(i);if(!(n&&n instanceof eA))return;const o=this._getLayerView(r,n);this._highlightActiveFeaturePromise=o;const a=await o;if(!(a&&whe(a)&&this._highlightActiveFeaturePromise===o&&this.activeFeature&&this.highlightEnabled))return;const l=a.highlight(this._getHighlightTarget(i,n));this._handles.add(l,e)}async _highlightSelectedFeature(){const e="highlight-selected-feature";this._handles.remove(e);const{selectedFeature:t,highlightEnabled:r,view:i,visible:s}=this;if(!(t&&i&&r&&s))return;const n=this._getHighlightLayer(t);if(!(n&&n instanceof eA))return;const o=this._getLayerView(i,n);this._highlightSelectedFeaturePromise=o;const a=await o;if(!(a&&whe(a)&&this._highlightSelectedFeaturePromise===o&&this.selectedFeature&&this.highlightEnabled&&this.visible))return;const l=a.highlight(this._getHighlightTarget(t,n));this._handles.add(l,e)}_updateFeatures(e){const{features:t}=this;if(!e||!e.length)return;if(!t.length)return void(this.features=e);const r=e.filter(i=>!t.includes(i));this.features=t.concat(r)}};u([d()],Rr.prototype,"featurePage",void 0),u([d()],Rr.prototype,"isLoadingFeature",null),u([d({type:lP})],Rr.prototype,"actions",void 0),u([d({readOnly:!0})],Rr.prototype,"active",null),u([d()],Rr.prototype,"activeFeature",void 0),u([d({readOnly:!0})],Rr.prototype,"allActions",null),u([d({type:Boolean})],Rr.prototype,"defaultPopupTemplateEnabled",void 0),u([d()],Rr.prototype,"autoCloseEnabled",void 0),u([d()],Rr.prototype,"autoOpenEnabled",void 0),u([d()],Rr.prototype,"browseClusterEnabled",void 0),u([d()],Rr.prototype,"content",void 0),u([d({type:lP,readOnly:!0})],Rr.prototype,"defaultActions",null),u([d({readOnly:!0})],Rr.prototype,"featureCount",null),u([d()],Rr.prototype,"features",null),u([d()],Rr.prototype,"featuresPerPage",void 0),u([d()],Rr.prototype,"featureViewModelAbilities",void 0),u([d({readOnly:!0})],Rr.prototype,"featureViewModels",void 0),u([d()],Rr.prototype,"highlightEnabled",void 0),u([d()],Rr.prototype,"includeDefaultActions",void 0),u([d({type:at})],Rr.prototype,"location",null),u([d({readOnly:!0})],Rr.prototype,"pendingPromisesCount",null),u([d({readOnly:!0})],Rr.prototype,"selectedClusterBoundaryFeature",void 0),u([d({readOnly:!0})],Rr.prototype,"waitingForResult",null),u([d({readOnly:!0})],Rr.prototype,"promiseCount",null),u([d()],Rr.prototype,"promises",null),u([d({value:null,readOnly:!0})],Rr.prototype,"selectedFeature",null),u([d({value:-1})],Rr.prototype,"selectedFeatureIndex",null),u([d({readOnly:!0})],Rr.prototype,"selectedFeatureViewModel",null),u([d({readOnly:!0})],Rr.prototype,"state",null),u([d()],Rr.prototype,"title",void 0),u([d()],Rr.prototype,"updateLocationEnabled",void 0),u([d()],Rr.prototype,"view",void 0),u([d()],Rr.prototype,"visible",void 0),u([d()],Rr.prototype,"zoomFactor",void 0),u([d()],Rr.prototype,"zoomToLocation",void 0),u([d()],Rr.prototype,"centerAtLocation",null),Rr=u([$(hRe)],Rr);const dRe=Rr,The="selected-index",dit=0,She="popup-spinner",Pe={iconLeftTriangleArrow:"esri-icon-left-triangle-arrow",iconRightTriangleArrow:"esri-icon-right-triangle-arrow",iconDockToTop:"esri-icon-maximize",iconDockToBottom:"esri-icon-dock-bottom",iconDockToLeft:"esri-icon-dock-left",iconDockToRight:"esri-icon-dock-right",iconClose:"esri-icon-close",iconUndock:"esri-icon-minimize",iconCheckMark:"esri-icon-check-mark",iconLoading:"esri-icon-loading-indicator",iconDefaultAction:"esri-icon-default-action",iconActionsMenu:"esri-icon-handle-horizontal",rotating:"esri-rotating",base:"esri-popup",widget:"esri-widget",main:"esri-popup__main-container",loadingContainer:"esri-popup__loading-container",isCollapsible:"esri-popup--is-collapsible",isCollapsed:"esri-popup--is-collapsed",shadow:"esri-popup--shadow",isDocked:"esri-popup--is-docked",isDockedTopLeft:"esri-popup--is-docked-top-left",isDockedTopCenter:"esri-popup--is-docked-top-center",isDockedTopRight:"esri-popup--is-docked-top-right",isDockedBottomLeft:"esri-popup--is-docked-bottom-left",isDockedBottomCenter:"esri-popup--is-docked-bottom-center",isDockedBottomRight:"esri-popup--is-docked-bottom-right",alignTopCenter:"esri-popup--aligned-top-center",alignBottomCenter:"esri-popup--aligned-bottom-center",alignTopLeft:"esri-popup--aligned-top-left",alignBottomLeft:"esri-popup--aligned-bottom-left",alignTopRight:"esri-popup--aligned-top-right",alignBottomRight:"esri-popup--aligned-bottom-right",isFeatureMenuOpen:"esri-popup--feature-menu-open",isActionsMenuOpen:"esri-popup--actions-menu-open",hasFeatureUpdated:"esri-popup--feature-updated",header:"esri-popup__header",headerButtons:"esri-popup__header-buttons",headerContainer:"esri-popup__header-container",headerContainerButton:"esri-popup__header-container--button",headerTitle:"esri-popup__header-title",content:"esri-popup__content",footer:"esri-popup__footer",footerHasPagination:"esri-popup__footer--has-pagination",footerHasActions:"esri-popup__footer--has-actions",footerHasActionsMenu:"esri-popup__footer--has-actions-menu",button:"esri-popup__button",buttonDisabled:"esri-popup__button--disabled",buttonDock:"esri-popup__button--dock",icon:"esri-popup__icon",iconDock:"esri-popup__icon--dock-icon",inlineActionsContainer:"esri-popup__inline-actions-container",actionsMenuButton:"esri-popup__actions-menu-button",actions:"esri-popup__actions",action:"esri-popup__action",actionImage:"esri-popup__action-image",actionText:"esri-popup__action-text",actionToggle:"esri-popup__action-toggle",actionToggleOn:"esri-popup__action-toggle--on",pointer:"esri-popup__pointer",pointerDirection:"esri-popup__pointer-direction",navigation:"esri-popup__navigation",paginationPrevious:"esri-popup__pagination-previous",paginationNext:"esri-popup__pagination-next",paginationPreviousIconLTR:"esri-popup__pagination-previous-icon",paginationPreviousIconRTL:"esri-popup__pagination-previous-icon--rtl",paginationNextIconLTR:"esri-popup__pagination-next-icon",paginationNextIconRTL:"esri-popup__pagination-next-icon--rtl",featureMenu:"esri-popup__feature-menu",featureMenuList:"esri-popup__feature-menu-list",featureMenuItem:"esri-popup__feature-menu-item",featureMenuViewport:"esri-popup__feature-menu-viewport",featureMenuHeader:"esri-popup__feature-menu-header",featureMenuNote:"esri-popup__feature-menu-note",featureMenuSelected:"esri-popup__feature-menu-item--selected",featureMenuButton:"esri-popup__feature-menu-button",featureMenuTitle:"esri-popup__feature-menu-title",featureMenuObserver:"esri-popup__feature-menu-observer",featureMenuLoader:"esri-popup__feature-menu-loader",collapseButton:"esri-popup__collapse-button"},Ehe={buttonEnabled:!0,position:"auto",breakpoint:{width:544}},Che="esri-popup";function Og(e,t){return t===void 0?`${Che}__${e}`:`${Che}__${e}-${t}`}const pRe="esri.widgets.Popup",Ahe=fe.getLogger(pRe),Rhe={closeButton:!0,featureNavigation:!0};let Et=class extends BAe(Un){constructor(e,t){super(e,t),this._blurClose=!1,this._blurContainer=!1,this._containerNode=null,this._mainContainerNode=null,this._featureMenuNode=null,this._actionsMenuNode=null,this._focusClose=!1,this._focusContainer=!1,this._focusDockButton=!1,this._focusFeatureMenuButton=!1,this._focusActionsMenuButton=!1,this._focusFirstFeature=!1,this._focusFirstAction=!1,this._handles=new Dt,this._pointerOffsetInPx=16,this._spinner=null,this._feature=null,this._featureMenuIntersectionObserverCallback=([r])=>{r!=null&&r.isIntersecting&&this.viewModel.featurePage++},this._featureMenuIntersectionObserver=new IntersectionObserver(this._featureMenuIntersectionObserverCallback,{root:window.document}),this._displaySpinnerThrottled=Rte(()=>this._displaySpinner(),dit),this.actions=null,this.alignment="auto",this.autoCloseEnabled=null,this.autoOpenEnabled=null,this.defaultPopupTemplateEnabled=null,this.content=null,this.collapsed=!1,this.collapseEnabled=!0,this.dockEnabled=!1,this.featureCount=null,this.featureMenuOpen=!1,this.features=null,this.goToOverride=null,this.headingLevel=2,this.highlightEnabled=null,this.location=null,this.label=void 0,this.maxInlineActions=3,this.messages=null,this.messagesCommon=null,this.promises=null,this.selectedFeature=null,this.selectedFeatureIndex=null,this.spinnerEnabled=!0,this.title=null,this.updateLocationEnabled=null,this.view=null,this.viewModel=new dRe,this.visible=null,this.visibleElements={...Rhe},this._addSelectedFeatureIndexHandle(),this.own([te(()=>{var r;return(r=this.viewModel)==null?void 0:r.screenLocation},()=>this._positionContainer()),te(()=>{var r;return[(r=this.viewModel)==null?void 0:r.active,this.dockEnabled]},()=>this._toggleScreenLocationEnabled()),te(()=>{var r;return(r=this.viewModel)==null?void 0:r.screenLocation},(r,i)=>{!!r!=!!i&&this.reposition()}),te(()=>{var r,i,s,n,o,a;return[(i=(r=this.viewModel)==null?void 0:r.view)==null?void 0:i.padding,(n=(s=this.viewModel)==null?void 0:s.view)==null?void 0:n.size,(o=this.viewModel)==null?void 0:o.active,(a=this.viewModel)==null?void 0:a.location,this.alignment]},()=>this.reposition()),te(()=>this.spinnerEnabled,r=>this._spinnerEnabledChange(r)),te(()=>{var r,i;return(i=(r=this.viewModel)==null?void 0:r.view)==null?void 0:i.size},(r,i)=>this._updateDockEnabledForViewSize(r,i)),te(()=>{var r;return(r=this.viewModel)==null?void 0:r.view},(r,i)=>this._viewChange(r,i)),te(()=>{var r,i;return(i=(r=this.viewModel)==null?void 0:r.view)==null?void 0:i.ready},(r,i)=>this._viewReadyChange(r,i)),te(()=>{var r,i;return[(r=this.viewModel)==null?void 0:r.waitingForResult,(i=this.viewModel)==null?void 0:i.location]},()=>{this._hideSpinner(),this._displaySpinnerThrottled()}),te(()=>{var r,i,s,n;return[(i=(r=this.selectedFeatureWidget)==null?void 0:r.viewModel)==null?void 0:i.title,(n=(s=this.selectedFeatureWidget)==null?void 0:s.viewModel)==null?void 0:n.state]},()=>this._setTitleFromFeatureWidget()),te(()=>{var r,i,s,n;return[(i=(r=this.selectedFeatureWidget)==null?void 0:r.viewModel)==null?void 0:i.content,(n=(s=this.selectedFeatureWidget)==null?void 0:s.viewModel)==null?void 0:n.state]},()=>this._setContentFromFeatureWidget()),Lo(()=>!this.collapsed,()=>{var r,i;((i=(r=this.viewModel)==null?void 0:r.view)==null?void 0:i.widthBreakpoint)==="xsmall"&&this.viewModel.active&&this.collapseEnabled&&this.viewModel.centerAtLocation()}),rs(()=>{var r;return(r=this.viewModel)==null?void 0:r.allActions},"change",()=>this._watchActions()),te(()=>{var r;return(r=this.viewModel)==null?void 0:r.allActions},()=>this._watchActions(),Rt),te(()=>{var r;return(r=this.viewModel)==null?void 0:r.featureViewModels},()=>this._featureMenuViewportScrollTop())])}destroy(){var e,t;this._destroySelectedFeatureWidget(),this._destroySpinner(),(e=this._handles)==null||e.destroy(),this._unobserveFeatureMenuObserver(),(t=this._featureMenuIntersectionObserver)==null||t.disconnect(),this._handles=null}get actionsMenuId(){return`${this.id}-actions-menu`}get actionsMenuButtonId(){return`${this.id}-actions-menu-button`}get featureMenuId(){return`${this.id}-feature-menu`}get titleId(){return`${this.id}-popup-title`}get contentId(){return`${this.id}-popup-content`}get hasContent(){var e,t,r,i,s,n,o;return!!(this.selectedFeatureWidget?((t=(e=this.selectedFeatureWidget)==null?void 0:e.viewModel)==null?void 0:t.waitingForContent)||((i=(r=this.selectedFeatureWidget)==null?void 0:r.viewModel)==null?void 0:i.state)==="error"||((n=(s=this.selectedFeatureWidget)==null?void 0:s.viewModel)==null?void 0:n.content):(o=this.viewModel)==null?void 0:o.content)}get featureNavigationVisible(){return this.viewModel.active&&this.viewModel.featureCount>1&&this.visibleElements.featureNavigation}get collapsible(){return!!(this.collapseEnabled&&this.viewModel.title&&this.hasContent)}get featureMenuVisible(){return this.featureNavigationVisible&&this.featureMenuOpen}get contentCollapsed(){return this.collapsible&&!this.featureMenuVisible&&this.collapsed}get dividedActions(){return this._divideActions()}set actionsMenuOpen(e){this._set("actionsMenuOpen",!!e)}get actionsMenuOpen(){return!!this.viewModel.active&&this._get("actionsMenuOpen")}get currentAlignment(){return this._getCurrentAlignment()}get currentDockPosition(){return this._getCurrentDockPosition()}get dockOptions(){return this._get("dockOptions")||Ehe}set dockOptions(e){const t={...Ehe},r=this.get("viewModel.view.breakpoints"),i={};r&&(i.width=r.xsmall,i.height=r.xsmall);const s={...t,...e},n={...t.breakpoint,...i},{breakpoint:o}=s;o===!0?s.breakpoint=n:typeof o=="object"&&(s.breakpoint={...n,...o}),this._set("dockOptions",s),this._setCurrentDockPosition(),this.reposition()}get selectedFeatureWidget(){const{_feature:e,visibleElements:t,headingLevel:r}=this,{selectedFeatureViewModel:i}=this.viewModel,s={...t,title:!1};return i?(e?(e.viewModel=i,e.visibleElements=s):this._feature=new Ntt({headingLevel:r+1,viewModel:i,visibleElements:s}),this._feature):null}castVisibleElements(e){return{...Rhe,...e}}blur(){const{active:e}=this.viewModel;e||Ahe.warn("Popup can only be blurred when currently active."),this.visibleElements.closeButton?this._blurClose=!0:this._blurContainer=!0,this.scheduleRender()}clear(){this.viewModel.clear()}close(){this.visible=!1}fetchFeatures(e,t){return this.viewModel.fetchFeatures(e,t)}focus(){const{active:e}=this.viewModel;e||Ahe.warn("Popup can only be focused when currently active."),this.visibleElements.closeButton?this._focusClose=!0:this._focusContainer=!0,this.scheduleRender()}next(){return this.viewModel.next()}open(e){var s,n;this._handles.remove(The);const t=!!e&&!!e.featureMenuOpen,r=!!e&&!!e.actionsMenuOpen,i={collapsed:!!e&&!!e.collapsed,actionsMenuOpen:r,featureMenuOpen:t};((n=(s=this.viewModel)==null?void 0:s.view)==null?void 0:n.widthBreakpoint)==="xsmall"&&(i.collapsed=!0),this.set(i),this.viewModel.open(e),this._shouldFocus(e),this._addSelectedFeatureIndexHandle()}previous(){return this.viewModel.previous()}reposition(){this.renderNow(),this._positionContainer(),this._setCurrentAlignment()}triggerAction(e){this.viewModel.triggerAction(e)}render(){var g,v,w,_;const{actionsMenuOpen:e,dockEnabled:t,featureMenuVisible:r,dividedActions:i,currentAlignment:s,currentDockPosition:n}=this,{active:o}=this.viewModel,{menuActions:a}=i,l=o&&a.length>1&&e,c=o&&t,h=o&&!t,p=(v=(g=this.selectedFeature)==null?void 0:g.layer)==null?void 0:v.title,f=(_=(w=this.selectedFeature)==null?void 0:w.layer)==null?void 0:_.id,m={[Pe.alignTopCenter]:s==="top-center",[Pe.alignBottomCenter]:s==="bottom-center",[Pe.alignTopLeft]:s==="top-left",[Pe.alignBottomLeft]:s==="bottom-left",[Pe.alignTopRight]:s==="top-right",[Pe.alignBottomRight]:s==="bottom-right",[Pe.isDocked]:c,[Pe.shadow]:h,[Pe.isDockedTopLeft]:n==="top-left",[Pe.isDockedTopCenter]:n==="top-center",[Pe.isDockedTopRight]:n==="top-right",[Pe.isDockedBottomLeft]:n==="bottom-left",[Pe.isDockedBottomCenter]:n==="bottom-center",[Pe.isDockedBottomRight]:n==="bottom-right",[Pe.isFeatureMenuOpen]:r,[Pe.isActionsMenuOpen]:l};return U("div",{class:this.classes(Pe.base,m),role:"presentation","data-layer-title":p,"data-layer-id":f,bind:this,afterCreate:this._positionContainer,afterUpdate:this._positionContainer},o?[this.renderMainContainer(),this.renderPointer()]:null)}renderLoadingIcon(){return U("span",{"aria-hidden":"true",class:this.classes(Pe.icon,Pe.iconLoading,Pe.rotating)})}renderNavigationLoading(){const{messagesCommon:e}=this;return this.viewModel.pendingPromisesCount?U("div",{key:Og("loading-container"),role:"presentation",class:Pe.loadingContainer,"aria-label":e.loading,title:e.loading},this.renderLoadingIcon()):null}renderPreviousIcon(){const e=nf(this.container),t={[Pe.iconRightTriangleArrow]:e,[Pe.paginationPreviousIconRTL]:e,[Pe.iconLeftTriangleArrow]:!e,[Pe.paginationPreviousIconLTR]:!e};return U("span",{"aria-hidden":"true",class:this.classes(Pe.icon,t)})}renderPreviousButton(){const{messages:e}=this;return U("div",{role:"button",tabIndex:0,bind:this,onclick:this._previous,onkeydown:this._previous,class:this.classes(Pe.button,Pe.paginationPrevious),"aria-label":e.previous,title:e.previous},this.renderPreviousIcon())}renderNextIcon(){const e=nf(this.container),t={[Pe.iconLeftTriangleArrow]:e,[Pe.paginationNextIconRTL]:e,[Pe.iconRightTriangleArrow]:!e,[Pe.paginationNextIconLTR]:!e};return U("span",{"aria-hidden":"true",class:this.classes(Pe.icon,t)})}renderNextButton(){const{messages:e}=this;return U("div",{role:"button",tabIndex:0,bind:this,onclick:this._next,onkeydown:this._next,class:this.classes(Pe.button,Pe.paginationNext),"aria-label":e.next,title:e.next},this.renderNextIcon())}renderFeatureMenuButton(){const{featureMenuOpen:e,featureMenuId:t,messagesCommon:r}=this,{featureCount:i,selectedFeatureIndex:s}=this.viewModel;return U("div",{role:"button",tabIndex:0,bind:this,onclick:this._toggleFeatureMenu,onkeydown:this._toggleFeatureMenu,afterCreate:this._focusFeatureMenuButtonNode,afterUpdate:this._focusFeatureMenuButtonNode,class:this.classes(Pe.button,Pe.featureMenuButton),"aria-haspopup":"true","aria-controls":t,"aria-expanded":e.toString(),"aria-label":r.menu,title:r.menu},this._getPageText(i,s))}renderNavigationButtons(){return this.featureNavigationVisible?[this.renderPreviousButton(),this.renderNavigationLoading()||this.renderFeatureMenuButton(),this.renderNextButton()]:null}renderDockIcon(){const{dockEnabled:e}=this,t=this._wouldDockTo(),r={[Pe.iconUndock]:e,[Pe.iconDock]:!e,[Pe.iconDockToRight]:!e&&(t==="top-right"||t==="bottom-right"),[Pe.iconDockToLeft]:!e&&(t==="top-left"||t==="bottom-left"),[Pe.iconDockToTop]:!e&&t==="top-center",[Pe.iconDockToBottom]:!e&&t==="bottom-center"};return U("span",{"aria-hidden":"true",class:this.classes(r,Pe.icon)})}renderDockButton(){var s,n,o;const{dockEnabled:e,messages:t}=this,r=(n=(s=this.viewModel)==null?void 0:s.view)==null?void 0:n.widthBreakpoint,i=e?t.undock:t.dock;return r!=="xsmall"&&((o=this.dockOptions)==null?void 0:o.buttonEnabled)?U("div",{role:"button","aria-label":i,title:i,tabIndex:0,bind:this,onclick:this._toggleDockEnabled,onkeydown:this._toggleDockEnabled,afterCreate:this._focusDockButtonNode,afterUpdate:this._focusDockButtonNode,class:this.classes(Pe.button,Pe.buttonDock)},this.renderDockIcon()):null}renderTitle(){const{title:e}=this.viewModel,{titleId:t,collapsible:r,contentCollapsed:i,messagesCommon:s}=this,n={[Pe.headerContainerButton]:r},o=U(u1,{level:this.headingLevel,class:Pe.headerTitle,innerHTML:e}),a=r?U("button",{key:`${e}--collapsible`,id:t,title:i?s.expand:s.collapse,bind:this,enterAnimation:this._createFeatureUpdatedAnimation(),class:this.classes(Pe.headerContainer,n),"aria-expanded":i?"false":"true",onclick:this._toggleCollapsed,type:"button"},o):U("div",{key:e,id:t,bind:this,enterAnimation:this._createFeatureUpdatedAnimation(),class:this.classes(Pe.headerContainer,n)},o);return e?a:null}renderCloseIcon(){return U("span",{"aria-hidden":"true",class:this.classes(Pe.icon,Pe.iconClose)})}renderCloseButton(){const{visibleElements:e,messagesCommon:t}=this;return e.closeButton?U("div",{role:"button",tabIndex:0,bind:this,onclick:this._close,onkeydown:this._close,class:Pe.button,"aria-label":t.close,title:t.close,afterCreate:this._closeButtonNodeUpdated,afterUpdate:this._closeButtonNodeUpdated},this.renderCloseIcon()):null}renderHeader(){return U("header",{class:Pe.header},this.renderTitle(),U("div",{class:Pe.headerButtons},this.renderDockButton(),this.renderCloseButton()))}renderContentContainer(){const{contentId:e,hasContent:t,contentCollapsed:r}=this,{content:i}=this.viewModel;return t&&!r?U("article",{key:i,enterAnimation:this._createFeatureUpdatedAnimation(),id:e,class:Pe.content},this.renderContent()):null}renderActionsMenuButton(){const{actionsMenuId:e,actionsMenuButtonId:t,actionsMenuOpen:r,dividedActions:i,messagesCommon:s}=this,n=r?s.close:s.open,{menuActions:o}=i;return o.length?U("div",{key:Og("actions-menu-button"),class:this.classes(Pe.button,Pe.actionsMenuButton),role:"button",id:t,"aria-haspopup":"true","aria-controls":r?e:null,tabIndex:0,bind:this,onclick:this._toggleActionsMenu,onkeydown:this._toggleActionsMenu,afterCreate:this._focusActionsMenuButtonNode,afterUpdate:this._focusActionsMenuButtonNode,"aria-label":n,title:n},U("span",{"aria-hidden":"true",class:Pe.iconActionsMenu})):null}renderMenuActions(){const{actionsMenuId:e,actionsMenuButtonId:t,actionsMenuOpen:r,dividedActions:i}=this,{menuActions:s}=i;return s.length&&r?U("ul",{id:e,role:"menu","aria-labelledby":t,key:Og("actions"),class:Pe.actions,bind:this,onkeyup:this._handleActionMenuKeyup,afterCreate:this._actionsMenuNodeUpdated,afterUpdate:this._actionsMenuNodeUpdated},s.toArray().map(n=>this.renderAction({action:n,type:"menu-item"}))):null}renderInlineActions(){const{inlineActions:e}=this.dividedActions;return!!e.length&&e.toArray().map(t=>this.renderAction({action:t,type:"inline"}))}renderInlineActionsContainer(){const{inlineActions:e,menuActions:t}=this.dividedActions,r=!!e.length,i=!!t.length;return r||i?U("div",{key:"inline-actions-container","data-inline-actions":r.toString(),"data-menu-actions":i.toString(),class:Pe.inlineActionsContainer},this.renderInlineActions(),this.renderActionsMenuButton(),this.renderMenuActions()):null}renderNavigation(){return this.featureNavigationVisible?U("section",{key:Og("navigation"),class:this.classes(Pe.navigation)},this.renderNavigationButtons()):null}renderFooter(){const{featureNavigationVisible:e,dividedActions:t}=this,{inlineActions:r,menuActions:i}=t,s=!!r.length,n=!!i.length,o={[Pe.footerHasPagination]:e,[Pe.footerHasActions]:s,[Pe.footerHasActionsMenu]:n};return e||s?U("div",{key:Og("feature-buttons"),class:this.classes(Pe.footer,o)},this.renderInlineActionsContainer(),this.renderNavigation()):null}renderFeatureMenuContainer(){const{messages:e}=this,{featureViewModels:t,isLoadingFeature:r}=this.viewModel,i=nd(e.selectedFeatures,{total:t.length});return U("section",{key:Og("menu"),class:Pe.featureMenu},U("strong",{class:Pe.featureMenuHeader},i),U("nav",{bind:this,class:Pe.featureMenuViewport,"data-node-ref":"_featureMenuViewportNode",afterCreate:VX},this.renderFeatureMenu(),U("div",{class:Pe.featureMenuObserver,bind:this,afterCreate:this._featureMenuIntersectionObserverCreated}),r?U("div",{class:Pe.featureMenuLoader},this.renderLoadingIcon()):null))}renderPointer(){return this.dockEnabled?null:U("div",{key:Og("pointer"),class:Pe.pointer,role:"presentation"},U("div",{class:this.classes(Pe.pointerDirection,Pe.shadow)}))}renderMainContainer(){const{dockEnabled:e,currentAlignment:t,currentDockPosition:r,titleId:i,contentId:s,collapsible:n,hasContent:o,contentCollapsed:a,visibleElements:l}=this,{title:c}=this.viewModel,h=t==="bottom-left"||t==="bottom-center"||t==="bottom-right"||r==="top-left"||r==="top-center"||r==="top-right",p=t==="top-left"||t==="top-center"||t==="top-right"||r==="bottom-left"||r==="bottom-center"||r==="bottom-right",f={[Pe.shadow]:e,[Pe.isCollapsible]:n,[Pe.isCollapsed]:a};return U("div",{class:this.classes(Pe.main,Pe.widget,f),tabIndex:l.closeButton?null:-1,role:"dialog","aria-labelledby":c?i:"","aria-describedby":o&&!a?s:"",bind:this,onkeyup:this._handleMainKeyup,afterCreate:this._mainContainerNodeUpdated,afterUpdate:this._mainContainerNodeUpdated},h?this.renderFooter():null,h?this.renderFeatureMenuContainer():null,this.renderHeader(),this.renderContentContainer(),p?this.renderFooter():null,p?this.renderFeatureMenuContainer():null)}renderContent(){var t;const e=(t=this.viewModel)==null?void 0:t.content;return e?typeof e=="string"?U("div",{key:e,innerHTML:e}):this.renderNodeContent(e):null}renderActionText(e){return U("span",{key:"text",class:Pe.actionText},e)}renderActionIcon(e){const t=this._getActionClass(e),r=this._getActionImage(e),i={[Pe.iconLoading]:e.active,[Pe.rotating]:e.active,[Pe.icon]:!!t,[Pe.actionImage]:!e.active&&!!r};return t&&(i[t]=!e.active),U("span",{key:"icon","aria-hidden":"true",class:this.classes(Pe.icon,i),styles:this._getIconStyles(r)})}renderAction(e){const{action:t,type:r}=e,i=this._getActionTitle(t),s={[Pe.action]:t.type!=="toggle",[Pe.actionToggle]:t.type==="toggle",[Pe.actionToggleOn]:t.type==="toggle"&&t.value,[Pe.buttonDisabled]:t.disabled},n=[this.renderActionIcon(t),this.renderActionText(i)],o=r==="menu-item"?U("li",{key:t.uid,role:"menuitem",tabIndex:0,title:i,"aria-label":i,class:this.classes(Pe.button,s),onkeyup:this._handleActionMenuItemKeyup,bind:this,"data-action-uid":t.uid,onclick:this._triggerAction,onkeydown:this._triggerAction},n):U("div",{key:t.uid,role:"button",tabIndex:0,title:i,"aria-label":i,class:this.classes(Pe.button,s),onkeyup:this._handleActionMenuItemKeyup,bind:this,"data-action-uid":t.uid,onclick:this._triggerAction,onkeydown:this._triggerAction},n);return t.visible?o:null}renderFeatureMenuItem(e,t){const{messages:r,messagesCommon:i}=this,{selectedFeatureIndex:s,selectedFeatureViewModel:n}=this.viewModel,o=e===n,a={[Pe.featureMenuSelected]:o},l=o?U("span",{key:Og(`feature-menu-selected-feature-${s}`),title:r.selectedFeature,"aria-label":r.selectedFeature,class:Pe.iconCheckMark}):null,c=U("span",{innerHTML:e.title||i.untitled});return U("li",{role:"menuitem",tabIndex:-1,key:Og(`feature-menu-feature-${s}`),class:this.classes(a,Pe.featureMenuItem),bind:this,"data-feature-index":t,onblur:this._removeActiveFeature,onfocus:this._setActiveFeature,onkeyup:this._handleFeatureMenuItemKeyup,onclick:this._selectFeature,onkeydown:this._selectFeature,onmouseover:this._setActiveFeature,onmouseleave:this._removeActiveFeature},U("span",{class:Pe.featureMenuTitle},c,l))}renderFeatureMenu(){const{featureMenuId:e}=this,{featureViewModels:t}=this.viewModel;return t.length>1?U("ol",{class:Pe.featureMenuList,id:e,bind:this,afterCreate:this._featureMenuNodeUpdated,afterUpdate:this._featureMenuNodeUpdated,onkeyup:this._handleFeatureMenuKeyup,role:"menu"},t.filter(r=>!!r.graphic).map((r,i)=>this.renderFeatureMenuItem(r,i))):null}_getActionTitle(e){const{messages:t,selectedFeature:r,messagesCommon:i}=this,{id:s}=e,n=r==null?void 0:r.attributes,o=s==="zoom-to-feature"?nd(e.title,{messages:t}):s==="remove-selected-feature"?nd(e.title,{messages:i}):s==="zoom-to-clustered-features"||s==="browse-clustered-features"?nd(e.title,{messages:t}):e.title;return o&&n?nd(o,n):o}_getActionClass(e){const{selectedFeature:t}=this,r=t==null?void 0:t.attributes,{className:i,image:s}=e,n=s||i?i:Pe.iconDefaultAction;return n&&r?nd(n,r):n}_getActionImage(e){const{selectedFeature:t}=this,r=t==null?void 0:t.attributes,{image:i}=e;return i&&r?nd(i,r):i}_createFeatureUpdatedAnimation(){return bje("enter",Pe.hasFeatureUpdated)}_getInlineActionCount(){const{maxInlineActions:e,featureNavigationVisible:t}=this;if(typeof e!="number")return null;const r=Math.round(e);return Math.max(t?r-1:r,0)}_watchActions(){const{allActions:e}=this.viewModel;this.notifyChange("dividedActions");const t="actions";this._handles.remove(t),e&&e.forEach(r=>{this._handles.add(te(()=>[r.uid,r.active,r.className,r.disabled,r.id,r.title,r.image,r.visible],()=>this.scheduleRender()),t)})}_divideActions(){const{allActions:e}=this.viewModel,t=e.filter(n=>n.visible),r=this._getInlineActionCount(),i=r===null,s=r===0;return{inlineActions:i?t.slice(0):s?new ot:t.slice(0,r),menuActions:i?new ot:s?t.slice(0):t.slice(r)}}_featureMenuOpenChanged(e){e?this._focusFirstFeature=!0:this._focusFeatureMenuButton=!0}_actionsMenuOpenChanged(e){e?this._focusFirstAction=!0:this._focusActionsMenuButton=!0}_setTitleFromFeatureWidget(){var r,i;const{selectedFeatureWidget:e,messagesCommon:t}=this;e&&(this.viewModel.title=((r=e.viewModel)==null?void 0:r.state)==="error"?t.errorMessage:((i=e.viewModel)==null?void 0:i.title)||"")}_setContentFromFeatureWidget(){const{selectedFeatureWidget:e}=this;e&&(this.viewModel.content=e)}_unobserveFeatureMenuObserver(){this._featureMenuIntersectionObserverNode&&this._featureMenuIntersectionObserver.unobserve(this._featureMenuIntersectionObserverNode)}_featureMenuIntersectionObserverCreated(e){this._unobserveFeatureMenuObserver(),this._featureMenuIntersectionObserver.observe(e),this._featureMenuIntersectionObserverNode=e}_handleFeatureMenuKeyup(e){Hw(e)==="Escape"&&(e.stopPropagation(),this._focusFeatureMenuButton=!0,this.featureMenuOpen=!1,this.scheduleRender())}_handleActionMenuKeyup(e){Hw(e)==="Escape"&&(e.stopPropagation(),this._focusActionsMenuButton=!0,this.actionsMenuOpen=!1,this.scheduleRender())}_setActiveFeature(e){const{viewModel:t}=this,r=e.currentTarget["data-feature-index"];t.activeFeature=t.features[r]||null}_removeActiveFeature(){this.viewModel.activeFeature=null}_handleFeatureMenuItemKeyup(e){const t=Hw(e),{_featureMenuNode:r}=this,i=e.currentTarget["data-feature-index"];if(!r)return;const s=r.querySelectorAll("li"),n=s.length;t!=="ArrowUp"?t!=="ArrowDown"?t!=="Home"?t!=="End"||(e.stopPropagation(),s[s.length-1].focus()):(e.stopPropagation(),s[0].focus()):(e.stopPropagation(),s[(i+1+n)%n].focus()):(e.stopPropagation(),s[(i-1+n)%n].focus())}_handleActionMenuItemKeyup(e){const t=Hw(e),{_actionsMenuNode:r}=this,i=e.currentTarget.dataset.actionUid,{menuActions:s}=this.dividedActions,n=s.findIndex(l=>l.uid===i);if(!r)return;const o=r.querySelectorAll("li"),a=o.length;t!=="ArrowUp"?t!=="ArrowDown"?t!=="Home"?t!=="End"||(e.stopPropagation(),o[o.length-1].focus()):(e.stopPropagation(),o[0].focus()):(e.stopPropagation(),o[(n+1+a)%a].focus()):(e.stopPropagation(),o[(n-1+a)%a].focus())}_handleMainKeyup(e){const t=Hw(e);t==="ArrowLeft"&&(e.stopPropagation(),this.previous()),t==="ArrowRight"&&(e.stopPropagation(),this.next())}_spinnerEnabledChange(e){if(this._destroySpinner(),!e)return;const t=this.get("viewModel.view");this._createSpinner(t)}_hideSpinner(){const{_spinner:e}=this;e&&(e.location=null,e.hide())}_displaySpinner(){const{_spinner:e}=this;if(!e)return;const{location:t,waitingForResult:r}=this.viewModel;r?e.show({location:t}):e.hide()}_getIconStyles(e){return{"background-image":e?`url(${e})`:""}}async _shouldFocus(e){e.shouldFocus&&(await E1(()=>{var t;return((t=this.viewModel)==null?void 0:t.active)===!0}),this.focus())}_addSelectedFeatureIndexHandle(){const e=te(()=>{var t;return(t=this.viewModel)==null?void 0:t.selectedFeatureIndex},(t,r)=>this._selectedFeatureIndexUpdated(t,r));this._handles.add(e,The)}_selectedFeatureIndexUpdated(e,t){const{featureCount:r}=this;r&&e!==t&&e!==-1&&(this.actionsMenuOpen=!1,this.featureMenuOpen=!1)}_destroySelectedFeatureWidget(){const{_feature:e}=this;e&&(e.viewModel=null,e&&!e.destroyed&&e.destroy()),this._feature=null}_isScreenLocationWithinView(e,t){return e.x>-1&&e.y>-1&&e.x<=t.width&&e.y<=t.height}_isOutsideView(e){const{popupHeight:t,popupWidth:r,screenLocation:i,side:s,view:n}=e;if(isNaN(r)||isNaN(t)||!n||!i)return!1;const o=n.padding;return s==="right"&&i.x+r/2>n.width-o.right||s==="left"&&i.x-r/2<o.left||s==="top"&&i.y-t<o.top||s==="bottom"&&i.y+t>n.height-o.bottom}_calculateAutoAlignment(e){if(e!=="auto")return e;const{_pointerOffsetInPx:t,_containerNode:r,_mainContainerNode:i,viewModel:s}=this,{screenLocation:n,view:o}=s;if(R(n)||!o||!r)return"top-center";if(!this._isScreenLocationWithinView(n,o))return this._get("currentAlignment")||"top-center";function a(x){return parseInt(x.replace(/[^-\d\.]/g,""),10)}const l=i?window.getComputedStyle(i,null):null,c=l?a(l.getPropertyValue("max-height")):0,h=l?a(l.getPropertyValue("height")):0,{height:p,width:f}=r.getBoundingClientRect(),m=f+t,g=Math.max(p,c,h)+t,v=this._isOutsideView({popupHeight:g,popupWidth:m,screenLocation:n,side:"right",view:o}),w=this._isOutsideView({popupHeight:g,popupWidth:m,screenLocation:n,side:"left",view:o}),_=this._isOutsideView({popupHeight:g,popupWidth:m,screenLocation:n,side:"top",view:o}),T=this._isOutsideView({popupHeight:g,popupWidth:m,screenLocation:n,side:"bottom",view:o});return w?_?"bottom-right":"top-right":v?_?"bottom-left":"top-left":_?T?"top-center":"bottom-center":"top-center"}_callCurrentAlignment(e){return typeof e=="function"?e.call(this):e}_getCurrentAlignment(){const{alignment:e,dockEnabled:t}=this;return t||!this.viewModel.active?null:this._calculatePositionResult(this._calculateAutoAlignment(this._callCurrentAlignment(e)))}_setCurrentAlignment(){this._set("currentAlignment",this._getCurrentAlignment())}_setCurrentDockPosition(){this._set("currentDockPosition",this._getCurrentDockPosition())}_calculatePositionResult(e){const t=["left","right"];return nf(this.container)&&t.reverse(),e.replace(/leading/gi,t[0]).replace(/trailing/gi,t[1])}_callDockPosition(e){return typeof e=="function"?e.call(this):e}_getDockPosition(){var e;return this._calculatePositionResult(this._calculateAutoDockPosition(this._callDockPosition((e=this.dockOptions)==null?void 0:e.position)))}_getCurrentDockPosition(){return this.dockEnabled&&this.viewModel.active?this._getDockPosition():null}_wouldDockTo(){return this.dockEnabled?null:this._getDockPosition()}_calculateAutoDockPosition(e){var o;if(e!=="auto")return e;const t=(o=this.viewModel)==null?void 0:o.view,r=nf(this.container)?"top-left":"top-right";if(!t)return r;const i=t.padding||{left:0,right:0,top:0,bottom:0},s=t.width-i.left-i.right,{breakpoints:n}=t;return n&&s<=n.xsmall?"bottom-center":r}_positionContainer(e=this._containerNode){if(e&&(this._containerNode=e),!e)return;const{screenLocation:t}=this.viewModel,{width:r}=e.getBoundingClientRect(),i=this._calculatePositionStyle(t,r);i&&(e.style.top=i.top,e.style.left=i.left,e.style.bottom=i.bottom,e.style.right=i.right)}_calculateFullWidth(e){const{currentAlignment:t,_pointerOffsetInPx:r}=this;return t==="top-left"||t==="bottom-left"||t==="top-right"||t==="bottom-right"?e+r:e}_calculateAlignmentPosition(e,t,r,i){const{currentAlignment:s,_pointerOffsetInPx:n}=this,o=i/2,a=r.height-t,l=r.width-e,{padding:c}=this.view;return s==="bottom-center"?{top:t+n-c.top,left:e-o-c.left}:s==="top-left"?{bottom:a+n-c.bottom,right:l+n-c.right}:s==="bottom-left"?{top:t+n-c.top,right:l+n-c.right}:s==="top-right"?{bottom:a+n-c.bottom,left:e+n-c.left}:s==="bottom-right"?{top:t+n-c.top,left:e+n-c.left}:s==="top-center"?{bottom:a+n-c.bottom,left:e-o-c.left}:void 0}_calculatePositionStyle(e,t){const{dockEnabled:r,view:i}=this;if(!i)return;if(r)return{left:"",top:"",right:"",bottom:""};if(R(e)||!t)return;const s=this._calculateFullWidth(t),n=this._calculateAlignmentPosition(e.x,e.y,i,s);return n?{top:n.top!==void 0?`${n.top}px`:"auto",left:n.left!==void 0?`${n.left}px`:"auto",bottom:n.bottom!==void 0?`${n.bottom}px`:"auto",right:n.right!==void 0?`${n.right}px`:"auto"}:void 0}_viewChange(e,t){e&&t&&(this.close(),this.clear())}_viewReadyChange(e,t){if(e){const r=this.get("viewModel.view");this._wireUpView(r)}else t&&(this.close(),this.clear())}_wireUpView(e){if(this._destroySpinner(),!e)return;const{spinnerEnabled:t}=this;t&&this._createSpinner(e),this._setDockEnabledForViewSize(this.dockOptions)}_dockingThresholdCrossed(e,t,r){const[i,s]=e,[n,o]=t,{width:a,height:l}=r;return i<=a&&n>a||i>a&&n<=a||s<=l&&o>l||s>l&&o<=l}_updateDockEnabledForViewSize(e,t){if(!e||!t)return;const r=this.get("viewModel.view.padding")||{left:0,right:0,top:0,bottom:0},i=r.left+r.right,s=r.top+r.bottom,n=[],o=[];n[0]=e[0]-i,n[1]=e[1]-s,o[0]=t[0]-i,o[1]=t[1]-s;const{dockOptions:a}=this,l=a.breakpoint;this._dockingThresholdCrossed(n,o,l)&&this._setDockEnabledForViewSize(a),this._setCurrentDockPosition()}_focusDockButtonNode(e){this._focusDockButton&&(this._focusDockButton=!1,e.focus())}_closeButtonNodeUpdated(e){return this._focusClose?(this._focusClose=!1,void e.focus()):this._blurClose?(this._blurClose=!1,void e.blur()):void 0}_mainContainerNodeUpdated(e){return this._mainContainerNode=e,this._focusContainer?(this._focusContainer=!1,void e.focus()):this._blurContainer?(this._blurContainer=!1,void e.blur()):void 0}_featureMenuNodeUpdated(e){if(this._featureMenuNode=e,!e||!this._focusFirstFeature)return;this._focusFirstFeature=!1;const t=e.querySelectorAll("li");t.length&&t[0].focus()}_actionsMenuNodeUpdated(e){if(this._actionsMenuNode=e,!e||!this._focusFirstAction)return;this._focusFirstAction=!1;const t=e.querySelectorAll("li");t.length&&t[0].focus()}_focusFeatureMenuButtonNode(e){this._focusFeatureMenuButton&&(this._focusFeatureMenuButton=!1,e.focus())}_focusActionsMenuButtonNode(e){this._focusActionsMenuButton&&(this._focusActionsMenuButton=!1,e.focus())}_featureMenuViewportScrollTop(){this._featureMenuViewportNode&&(this._featureMenuViewportNode.scrollTop=0)}_toggleScreenLocationEnabled(){const{dockEnabled:e,viewModel:t}=this;if(!t)return;const r=t.active&&!e;t.screenLocationEnabled=r}_shouldDockAtCurrentViewSize(e){var a,l;const t=e.breakpoint,r=(l=(a=this.viewModel)==null?void 0:a.view)==null?void 0:l.ui;if(!r)return!1;const{width:i,height:s}=r;if(isNaN(i)||isNaN(s))return!1;const n=t.hasOwnProperty("width")&&i<=t.width,o=t.hasOwnProperty("height")&&s<=t.height;return n||o}_setDockEnabledForViewSize(e){e.breakpoint&&(this.dockEnabled=this._shouldDockAtCurrentViewSize(e))}_getPageText(e,t){return this.featureNavigationVisible?nd(this.messages.pageText,{index:t+1,total:e}):null}_destroySpinner(){const{_spinner:e,view:t}=this;e&&(t&&t.ui&&t.ui.remove(this._spinner,She),e.destroy(),this._spinner=null)}_createSpinner(e){e&&(this._spinner=new ktt({view:e}),e.ui.add(this._spinner,{key:She,position:"manual"}))}_toggleCollapsed(){this.collapsed=!this.collapsed}_close(){this.close(),this.view&&this.view.focus()}_toggleDockEnabled(){this.dockEnabled=!this.dockEnabled,this._focusDockButton=!0,this.scheduleRender()}_toggleFeatureMenu(){const e=!this.featureMenuOpen;this._featureMenuOpenChanged(e),this.actionsMenuOpen=!1,this.featureMenuOpen=e}_toggleActionsMenu(){const e=!this.actionsMenuOpen;this._actionsMenuOpenChanged(e),this.featureMenuOpen=!1,this.actionsMenuOpen=e}_triggerAction(e){const t=e.currentTarget.dataset.actionUid,{allActions:r}=this.viewModel,i=r.findIndex(n=>n.uid===t),s=r.getItemAt(i);s&&s.type==="toggle"&&(s.value=!s.value),this.actionsMenuOpen=!1,this.viewModel.triggerAction(i)}_selectFeature(e){const t=e.currentTarget["data-feature-index"];isNaN(t)||(this.viewModel.selectedFeatureIndex=t),this.featureMenuOpen=!1,this._focusFeatureMenuButton=!0,this.scheduleRender()}_next(){this.next()}_previous(){this.previous()}};u([d({readOnly:!0})],Et.prototype,"actionsMenuId",null),u([d({readOnly:!0})],Et.prototype,"actionsMenuButtonId",null),u([d({readOnly:!0})],Et.prototype,"featureMenuId",null),u([d({readOnly:!0})],Et.prototype,"titleId",null),u([d({readOnly:!0})],Et.prototype,"contentId",null),u([d({readOnly:!0})],Et.prototype,"hasContent",null),u([d({readOnly:!0})],Et.prototype,"featureNavigationVisible",null),u([d({readOnly:!0})],Et.prototype,"collapsible",null),u([d({readOnly:!0})],Et.prototype,"featureMenuVisible",null),u([d({readOnly:!0})],Et.prototype,"contentCollapsed",null),u([d({readOnly:!0})],Et.prototype,"dividedActions",null),u([We("viewModel.actions")],Et.prototype,"actions",void 0),u([d()],Et.prototype,"actionsMenuOpen",null),u([d()],Et.prototype,"alignment",void 0),u([We("viewModel.autoCloseEnabled")],Et.prototype,"autoCloseEnabled",void 0),u([We("viewModel.autoOpenEnabled")],Et.prototype,"autoOpenEnabled",void 0),u([We("viewModel.defaultPopupTemplateEnabled")],Et.prototype,"defaultPopupTemplateEnabled",void 0),u([We("viewModel.content")],Et.prototype,"content",void 0),u([d()],Et.prototype,"collapsed",void 0),u([d()],Et.prototype,"collapseEnabled",void 0),u([d({readOnly:!0})],Et.prototype,"currentAlignment",null),u([d({readOnly:!0})],Et.prototype,"currentDockPosition",null),u([d()],Et.prototype,"dockOptions",null),u([d()],Et.prototype,"dockEnabled",void 0),u([We("viewModel.featureCount")],Et.prototype,"featureCount",void 0),u([d()],Et.prototype,"featureMenuOpen",void 0),u([We("viewModel.features")],Et.prototype,"features",void 0),u([We("viewModel.goToOverride")],Et.prototype,"goToOverride",void 0),u([d()],Et.prototype,"headingLevel",void 0),u([We("viewModel.highlightEnabled")],Et.prototype,"highlightEnabled",void 0),u([We("viewModel.location")],Et.prototype,"location",void 0),u([d({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],Et.prototype,"label",void 0),u([d()],Et.prototype,"maxInlineActions",void 0),u([d(),Js("esri/widgets/Popup/t9n/Popup")],Et.prototype,"messages",void 0),u([d(),Js("esri/t9n/common")],Et.prototype,"messagesCommon",void 0),u([We("viewModel.promises")],Et.prototype,"promises",void 0),u([We("viewModel.selectedFeature")],Et.prototype,"selectedFeature",void 0),u([We("viewModel.selectedFeatureIndex")],Et.prototype,"selectedFeatureIndex",void 0),u([d({readOnly:!0})],Et.prototype,"selectedFeatureWidget",null),u([d()],Et.prototype,"spinnerEnabled",void 0),u([We("viewModel.title")],Et.prototype,"title",void 0),u([We("viewModel.updateLocationEnabled")],Et.prototype,"updateLocationEnabled",void 0),u([We("viewModel.view")],Et.prototype,"view",void 0),u([d({type:dRe}),T2e(["triggerAction","trigger-action"])],Et.prototype,"viewModel",void 0),u([We("viewModel.visible")],Et.prototype,"visible",void 0),u([d()],Et.prototype,"visibleElements",void 0),u([qt("visibleElements")],Et.prototype,"castVisibleElements",null),u([sl()],Et.prototype,"_close",null),u([sl()],Et.prototype,"_toggleDockEnabled",null),u([sl()],Et.prototype,"_toggleFeatureMenu",null),u([sl()],Et.prototype,"_toggleActionsMenu",null),u([sl()],Et.prototype,"_triggerAction",null),u([sl()],Et.prototype,"_selectFeature",null),u([sl()],Et.prototype,"_next",null),u([sl()],Et.prototype,"_previous",null),Et=u([$(pRe)],Et);const Ohe=Et,ZG=[0,0];function pit(e){const t=(e.ownerDocument||window.document).defaultView,r=e.getBoundingClientRect();return ZG[0]=r.left+t.pageXOffset,ZG[1]=r.top+t.pageYOffset,ZG}function Mhe(e){e&&(Mxe(e),e.parentNode&&e.parentNode.removeChild(e))}function fit(e){const t=document.createElement("div");return e.appendChild(t),t}const hO=16,fN=750,mit=512,git=2,yit=e=>{let t=class extends e{constructor(...r){super(...r),this._freqInfo={freq:hO,time:fN},this._overlayRenderTaskHandle=null,this.height=0,this.position=null,this.resizing=!1,this.root=null,this.surface=null,this.suspended=!0,this.ui=null,this.userContent=null,this.width=0,this.widthBreakpoint=null,this.handles.add([te(()=>this.cursor,i=>{const{surface:s}=this;s&&s.setAttribute("data-cursor",i)}),te(()=>this.interacting,i=>{const{surface:s}=this;s&&s.setAttribute("data-interacting",i.toString())})])}initialize(){this.handles.add(te(()=>this.ui,(r,i)=>this._handleUIChange(r,i))),this._wireUI(this.ui),this.handles.add([this.on("focus",()=>this.notifyChange("focused")),this.on("blur",()=>this.notifyChange("focused"))])}destroy(){this.destroyed||(this.ui&&(this.ui.destroy(),this.ui=null),this.popup&&!this.popup.destroyed&&this.popup.destroy(),this.container=null)}set container(r){const i=this._get("container");if(i===r)return;const s="dom-size";if(this.handles.remove(s),this._stopMeasuring(),i&&(i.classList.remove("esri-view"),this._overlayRenderTaskHandle&&(this._overlayRenderTaskHandle.remove(),this._overlayRenderTaskHandle=null),this.overlay.destroy(),this._set("overlay",null),Mhe(this.root),this._set("root",null),nle(this.userContent,i),Mhe(this.userContent),this._set("userContent",null)),r){r.classList.add("esri-view");const n=document.createElement("div");n.className="esri-view-user-storage",nle(r,n),r.appendChild(n),this._set("userContent",n);const o=document.createElement("div");o.className="esri-view-root",r.insertBefore(o,r.firstChild),this._set("root",o);const a=document.createElement("div");a.className="esri-view-surface",a.setAttribute("role","application"),a.tabIndex=0,o.appendChild(a),this._set("surface",a);const l=new zle;o.appendChild(l.surface),this._set("overlay",l),te(()=>l.needsRender,c=>{c&&!this._overlayRenderTaskHandle?this._overlayRenderTaskHandle=rT({render:()=>{this.overlay.render()}}):this._overlayRenderTaskHandle&&(this._overlayRenderTaskHandle.remove(),this._overlayRenderTaskHandle=null)}),this.forceDOMReadyCycle(),this.handles.add(te(()=>this.size,c=>{const[h,p]=c,f="esri-view-surface--inset-outline";h>=document.body.clientWidth||p>=document.body.clientHeight?a.classList.add(f):a.classList.remove(f)},Rt),s),this._set("container",r),this._startMeasuring()}else this._set("width",0),this._set("height",0),this._set("position",null),this._set("suspended",!0),this._set("surface",null),this._set("container",null)}get focused(){const r=document.activeElement===this.surface;return document.hasFocus()&&r}get popup(){return this._get("popup")||new Ohe({view:this})}set popup(r){const i=this._get("popup");i&&i!==r&&i.destroy(),this._set("popup",r)}get size(){return[this.width,this.height]}blur(){this.surface&&this.surface.blur()}focus(){this.surface&&this.surface.focus()}pageToContainer(r,i,s){const n=this.position;return r-=n[0],i-=n[1],s?(s[0]=r,s[1]=i):s=[r,i],s}containerToPage(r,i,s){const n=this.position;return r+=n[0],i+=n[1],s?(s[0]=r,s[1]=i):s=[r,i],s}_handleUIChange(r,i){i&&(this.handles.remove("ui"),i.destroy()),r&&this._wireUI(r),this._set("ui",r)}_wireUI(r){this.handles.remove("ui"),r&&(r.view=this,this.handles.add([te(()=>this.root,i=>{r.container=i?fit(i):null},Rt),te(()=>this.popup,(i,s)=>{const n="popup",o="manual";s&&r.remove(s,n),i&&(i.view=r.view,r.add(i,{key:n,position:o}))},Rt)],"ui"))}_stopMeasuring(){this.handles.remove("measuring"),this._get("resizing")&&this._set("resizing",!1)}_startMeasuring(){const r=this._freqInfo;r.freq=hO,r.time=fN,this.handles.add([(()=>{const i=()=>{r.freq=hO,r.time=fN};return window.addEventListener("resize",i),{remove(){window.removeEventListener("resize",i)}}})(),rT({prepare:i=>{const s=this._measure(),n=this._freqInfo;if(n.time+=i.deltaTime,s&&(n.freq=hO,this._get("resizing")||this._set("resizing",!0)),n.time<n.freq)return;n.time=0;const o=this._position();n.freq=o||s?hO:Math.min(fN,n.freq*git),!s&&n.freq>=mit&&this._get("resizing")&&this._set("resizing",!1)}})],"measuring"),this._measure(),this._position()}_measure(){const r=this.container,i=r?r.clientWidth:0,s=r?r.clientHeight:0;if(i===0||s===0)return this.suspended||this._set("suspended",!0),!1;const n=this.width,o=this.height;return i===n&&s===o?(this.suspended&&this._set("suspended",!1),!1):(this._set("width",i),this._set("height",s),this.suspended&&this._set("suspended",!1),this.emit("resize",{oldWidth:n,oldHeight:o,width:i,height:s}),!0)}_position(){const r=this.container,i=this.position,s=pit(r);return(!i||s[0]!==i[0]||s[1]!==i[1])&&(this._set("position",[s[0],s[1]]),!0)}forceDOMReadyCycle(){}};return u([d({value:null,cast:r=>y6(r)})],t.prototype,"container",null),u([d({readOnly:!0})],t.prototype,"focused",null),u([d({readOnly:!0})],t.prototype,"height",void 0),u([d({type:Ohe})],t.prototype,"popup",null),u([d({type:zle})],t.prototype,"overlay",void 0),u([d({readOnly:!0})],t.prototype,"position",void 0),u([d({readOnly:!0})],t.prototype,"resizing",void 0),u([d({readOnly:!0})],t.prototype,"root",void 0),u([d({value:null,readOnly:!0})],t.prototype,"size",null),u([d({readOnly:!0})],t.prototype,"surface",void 0),u([d({readOnly:!0})],t.prototype,"suspended",void 0),u([d()],t.prototype,"ui",void 0),u([d({readOnly:!0})],t.prototype,"userContent",void 0),u([d({readOnly:!0})],t.prototype,"width",void 0),u([d()],t.prototype,"widthBreakpoint",void 0),t=u([$("esri.views.DOMContainer")],t),t};function zLt(e){return e&&"focus"in e}const Kre=fe.getLogger("esri.layers.support.ElevationSampler");class fRe{queryElevation(t){return mRe(t.clone(),this)}on(){return xit}projectIfRequired(t,r){return gRe(t,r)}}class vit extends fRe{constructor(t,r,i){super(),this.tile=t,this.noDataValue=i,this.extent=a6(t.tile.extent,r.spatialReference),this.extent.zmin=t.zmin,this.extent.zmax=t.zmax,this.aaExtent=t.tile.extent;const s=uu(r.spatialReference),n=r.lodAt(t.tile.level).resolution*s;this.demResolution={min:n,max:n}}get spatialReference(){return this.extent.spatialReference}contains(t){const r=this.projectIfRequired(t,this.spatialReference);return!R(r)&&this.containsAt(r.x,r.y)}containsAt(t,r){return zee(this.aaExtent,t,r)}elevationAt(t,r){if(!this.containsAt(t,r)){const i=this.extent,s=`${i.xmin}, ${i.ymin}, ${i.xmax}, ${i.ymax}`;return Kre.warn("#elevationAt()",`Point used to sample elevation (${t}, ${r}) is outside of the sampler extent (${s})`),this.noDataValue}return _t(this.tile.sample(t,r),this.noDataValue)}}class BLt extends fRe{constructor(t,r,i){let s;super(),typeof r=="number"?(this.noDataValue=r,s=null):(s=r,this.noDataValue=i),this.samplers=s?t.map(o=>new vit(o,s,this.noDataValue)):t;const n=this.samplers[0];if(n){this.extent=n.extent.clone();const{min:o,max:a}=n.demResolution;this.demResolution={min:o,max:a};for(let l=1;l<this.samplers.length;l++){const c=this.samplers[l];this.extent.union(c.extent),this.demResolution.min=Math.min(this.demResolution.min,c.demResolution.min),this.demResolution.max=Math.max(this.demResolution.max,c.demResolution.max)}}else this.extent=a6(Ut(),s.spatialReference),this.demResolution={min:0,max:0}}get spatialReference(){return this.extent.spatialReference}elevationAt(t,r){for(const i of this.samplers)if(i.containsAt(t,r))return i.elevationAt(t,r);return Kre.warn("#elevationAt()",`Point used to sample elevation (${t}, ${r}) is outside of the sampler`),this.noDataValue}}function mRe(e,t){const r=gRe(e,t.spatialReference);if(!r)return null;switch(e.type){case"point":_it(e,r,t);break;case"polyline":bit(e,r,t);break;case"multipoint":wit(e,r,t)}return e}function gRe(e,t){if(R(e))return null;const r=e.spatialReference;if(r.equals(t))return e;const i=BT(e,t);return i||Kre.error(`Cannot project geometry spatial reference (wkid:${r.wkid}) to elevation sampler spatial reference (wkid:${t.wkid})`),i}function _it(e,t,r){e.z=r.elevationAt(t.x,t.y)}function bit(e,t,r){Im.spatialReference=t.spatialReference;const i=e.hasM&&!e.hasZ;for(let s=0;s<e.paths.length;s++){const n=e.paths[s],o=t.paths[s];for(let a=0;a<n.length;a++){const l=n[a],c=o[a];Im.x=c[0],Im.y=c[1],i&&(l[3]=l[2]),l[2]=r.elevationAt(Im.x,Im.y)}}e.hasZ=!0}function wit(e,t,r){Im.spatialReference=t.spatialReference;const i=e.hasM&&!e.hasZ;for(let s=0;s<e.points.length;s++){const n=e.points[s],o=t.points[s];Im.x=o[0],Im.y=o[1],i&&(n[3]=n[2]),n[2]=r.elevationAt(Im.x,Im.y)}e.hasZ=!0}const Im=new at,xit={remove(){}};var BY;let am=BY=class extends ye{constructor(e){super(e),this.cols=null,this.level=0,this.levelValue=null,this.origin=null,this.resolution=0,this.rows=null,this.scale=0}clone(){return new BY({cols:this.cols,level:this.level,levelValue:this.levelValue,resolution:this.resolution,rows:this.rows,scale:this.scale})}};u([d({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],am.prototype,"cols",void 0),u([d({type:Wi,json:{write:!0}})],am.prototype,"level",void 0),u([d({type:String,json:{write:!0}})],am.prototype,"levelValue",void 0),u([d({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],am.prototype,"origin",void 0),u([d({type:Number,json:{write:!0}})],am.prototype,"resolution",void 0),u([d({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],am.prototype,"rows",void 0),u([d({type:Number,json:{write:!0}})],am.prototype,"scale",void 0),am=BY=u([$("esri.layers.support.LOD")],am);const yRe=am;var Hv;const Phe=new Tr({PNG:"png",PNG8:"png8",PNG24:"png24",PNG32:"png32",JPEG:"jpg",JPG:"jpg",DIB:"dib",TIFF:"tiff",EMF:"emf",PS:"ps",PDF:"pdf",GIF:"gif",SVG:"svg",SVGZ:"svgz",Mixed:"mixed",MIXED:"mixed",LERC:"lerc",LERC2D:"lerc2d",RAW:"raw",pbf:"pbf"});let go=Hv=class extends ye{constructor(e){super(e),this.dpi=96,this.format=null,this.origin=null,this.minScale=0,this.maxScale=0,this.size=null,this.spatialReference=null}static create(e={}){const{resolutionFactor:t=1,scales:r,size:i=256,spatialReference:s=Ze.WebMercator,numLODs:n=24}=e;if(!nc(s)){const p=[];if(r)for(let f=0;f<r.length;f++){const m=r[f];p.push({level:f,scale:m,resolution:m})}else{let f=5e-4;for(let m=n-1;m>=0;m--)p.unshift({level:m,scale:f,resolution:f}),f*=2}return new Hv({dpi:96,lods:p,origin:new at(0,0,s),size:[i,i],spatialReference:s})}const o=a1(s),a=e.origin?new at({x:e.origin.x,y:e.origin.y,spatialReference:s}):new at(o?{x:o.origin[0],y:o.origin[1],spatialReference:s}:{x:0,y:0,spatialReference:s}),l=96,c=1/(uu(s)*39.37*l),h=[];if(r)for(let p=0;p<r.length;p++){const f=r[p],m=f*c;h.push({level:p,scale:f,resolution:m})}else{let p=dbe(s)?512/i*5916575275917094e-7:256/i*591657527591555e-6;const f=Math.ceil(n/t);h.push({level:0,scale:p,resolution:p*c});for(let m=1;m<f;m++){const g=p/2**t,v=g*c;h.push({level:m,scale:g,resolution:v}),p=g}}return new Hv({dpi:l,lods:h,origin:a,size:[i,i],spatialReference:s})}get isWrappable(){const{spatialReference:e,origin:t}=this;if(e&&t){const r=a1(e);return e.isWrappable&&Math.abs(r.origin[0]-t.x)<=r.dx}return!1}readOrigin(e,t){return at.fromJSON({spatialReference:t.spatialReference,...e})}set lods(e){let t=0,r=0;const i=[];this._levelToLOD={},e&&(t=-1/0,r=1/0,e.forEach(s=>{i.push(s.scale),t=s.scale>t?s.scale:t,r=s.scale<r?s.scale:r,this._levelToLOD[s.level]=s})),this._set("scales",i),this._set("minScale",t),this._set("maxScale",r),this._set("lods",e),this._initializeUpsampleLevels()}readSize(e,t){return[t.cols,t.rows]}writeSize(e,t){t.cols=e[0],t.rows=e[1]}zoomToScale(e){const t=this.scales;if(e<=0)return t[0];if(e>=t.length-1)return t[t.length-1];{const r=Math.floor(e),i=r+1;return t[r]/(t[r]/t[i])**(e-r)}}scaleToZoom(e){const t=this.scales,r=t.length-1;let i=0;for(;i<r;i++){const s=t[i],n=t[i+1];if(s<=e)return i;if(n===e)return i+1;if(s>e&&n<e)return i+Math.log(s/e)/Math.log(s/n)}return i}snapScale(e,t=.95){const r=this.scaleToZoom(e);return r%Math.floor(r)>=t?this.zoomToScale(Math.ceil(r)):this.zoomToScale(Math.floor(r))}tileAt(e,t,r,i){const s=this.lodAt(e);if(!s)return null;let n,o;if(typeof t=="number")n=t,o=r;else if(ml(t.spatialReference,this.spatialReference))n=t.x,o=t.y,i=r;else{const c=BT(t,this.spatialReference);if(R(c))return null;n=c.x,o=c.y,i=r}const a=s.resolution*this.size[0],l=s.resolution*this.size[1];return i||(i={id:null,level:0,row:0,col:0,extent:Ut()}),i.level=e,i.row=Math.floor((this.origin.y-o)/l+.001),i.col=Math.floor((n-this.origin.x)/a+.001),this.updateTileInfo(i),i}updateTileInfo(e,t=Hv.ExtrapolateOptions.NONE){let r=this.lodAt(e.level);if(!r&&t===Hv.ExtrapolateOptions.POWER_OF_TWO){const o=this.lods[this.lods.length-1];o.level<e.level&&(r=o)}if(!r)return;const i=e.level-r.level,s=r.resolution*this.size[0]/2**i,n=r.resolution*this.size[1]/2**i;e.id=`${e.level}/${e.row}/${e.col}`,e.extent||(e.extent=Ut()),e.extent[0]=this.origin.x+e.col*s,e.extent[1]=this.origin.y-(e.row+1)*n,e.extent[2]=e.extent[0]+s,e.extent[3]=e.extent[1]+n}upsampleTile(e){const t=this._upsampleLevels[e.level];return!(!t||t.parentLevel===-1)&&(e.level=t.parentLevel,e.row=Math.floor(e.row/t.factor+.001),e.col=Math.floor(e.col/t.factor+.001),this.updateTileInfo(e),!0)}getTileBounds(e,t){const{resolution:r}=this.lodAt(t.level),i=r*this.size[0],s=r*this.size[1];return e[0]=this.origin.x+t.col*i,e[1]=this.origin.y-(t.row+1)*s,e[2]=e[0]+i,e[3]=e[1]+s,e}lodAt(e){return this._levelToLOD&&this._levelToLOD[e]||null}clone(){return Hv.fromJSON(this.write({}))}getOrCreateCompatible(e,t){if(this.size[0]===256&&this.size[1]===256)return e===256?this:null;const r=[],i=this.lods.length;for(let s=0;s<i;s++){const n=this.lods[s],o=n.resolution*t;r.push(new yRe({level:n.level,scale:n.scale,resolution:o}))}return new Hv({size:[e,e],dpi:this.dpi,format:this.format,compressionQuality:this.compressionQuality,origin:this.origin,spatialReference:this.spatialReference,lods:r})}_initializeUpsampleLevels(){const e=this.lods;this._upsampleLevels=[];let t=null;for(let r=0;r<e.length;r++){const i=e[r];this._upsampleLevels[i.level]={parentLevel:t?t.level:-1,factor:t?t.resolution/i.resolution:0},t=i}}};u([d({type:Number,json:{write:!0}})],go.prototype,"compressionQuality",void 0),u([d({type:Number,json:{write:!0}})],go.prototype,"dpi",void 0),u([d({type:String,json:{read:Phe.read,write:Phe.write,origins:{"web-scene":{read:!1,write:!1}}}})],go.prototype,"format",void 0),u([d({readOnly:!0})],go.prototype,"isWrappable",null),u([d({type:at,json:{write:!0}})],go.prototype,"origin",void 0),u([$e("origin")],go.prototype,"readOrigin",null),u([d({type:[yRe],value:null,json:{write:!0}})],go.prototype,"lods",null),u([d({readOnly:!0})],go.prototype,"minScale",void 0),u([d({readOnly:!0})],go.prototype,"maxScale",void 0),u([d({readOnly:!0})],go.prototype,"scales",void 0),u([d({cast:e=>Array.isArray(e)?e:typeof e=="number"?[e,e]:[256,256]})],go.prototype,"size",void 0),u([$e("size",["rows","cols"])],go.prototype,"readSize",null),u([Xe("size",{cols:{type:Wi},rows:{type:Wi}})],go.prototype,"writeSize",null),u([d({type:Ze,json:{write:!0}})],go.prototype,"spatialReference",void 0),go=Hv=u([$("esri.layers.support.TileInfo")],go),function(e){var t;(t=e.ExtrapolateOptions||(e.ExtrapolateOptions={}))[t.NONE=0]="NONE",t[t.POWER_OF_TWO=1]="POWER_OF_TWO"}(go||(go={}));const F5=go,Tit=12;class Mi{constructor(t){const r=Mi.checkUnsupported(t);if(b(r))throw r;const i=t;this.spatialReference=i.spatialReference,this._isWebMercator=this.spatialReference.isWebMercator,this._isGCS=dT(this.spatialReference)||hg(this.spatialReference)||dg(this.spatialReference),this.origin=[i.origin.x,i.origin.y],this.pixelSize=i.size[0],this.dpi=i.dpi;const s=i.lods.reduce((c,h,p)=>(h.level<c.min&&(c.min=h.level,c.minIndex=p),c.max=Math.max(c.max,h.level),c),{min:1/0,minIndex:0,max:-1/0}),n=i.lods[s.minIndex],o=2**n.level;let a=n.resolution*o,l=n.scale*o;this.levels=new Array(s.max+1);for(let c=0;c<this.levels.length;c++)this.levels[c]={resolution:a,scale:l,tileSize:[a*i.size[0],a*i.size[1]]},a/=2,l/=2}clone(){return new Mi(this.toTileInfo())}toTileInfo(){return new F5({dpi:this.dpi,origin:{x:this.origin[0],y:this.origin[1],spatialReference:this.spatialReference},size:[this.pixelSize,this.pixelSize],spatialReference:this.spatialReference,lods:this.levels.map((t,r)=>({level:r,scale:t.scale,resolution:t.resolution}))})}getExtent(t,r,i,s){const n=this.levels[t],o=n.tileSize[0],a=n.tileSize[1];s[0]=this.origin[0]+i*o,s[2]=this.origin[0]+(i+1)*o,s[3]=this.origin[1]-r*a,s[1]=this.origin[1]-(r+1)*a}convertExtentToRadians(t,r){this._isWebMercator?(r[0]=bae(t[0]),r[1]=xU(t[1]),r[2]=bae(t[2]),r[3]=xU(t[3])):this._isGCS&&(r[0]=Ft(t[0]),r[1]=Ft(t[1]),r[2]=Ft(t[2]),r[3]=Ft(t[3]))}getExtentGeometry(t,r,i,s=new Kt){return this.getExtent(t,r,i,Pf),s.spatialReference=this.spatialReference,s.xmin=Pf[0],s.ymin=Pf[1],s.xmax=Pf[2],s.ymax=Pf[3],s.zmin=void 0,s.zmax=void 0,s}ensureMaxLod(t){if(t==null)return!1;let r=!1;for(;this.levels.length<=t;){const i=this.levels[this.levels.length-1],s=i.resolution/2;this.levels.push({resolution:s,scale:i.scale/2,tileSize:[s*this.pixelSize,s*this.pixelSize]}),r=!0}return r}capMaxLod(t){this.levels.length>t+1&&(this.levels.length=t+1)}getMaxLod(){return this.levels.length-1}scaleAtLevel(t){return this.levels[0].scale/2**t}levelAtScale(t){const r=this.levels[0].scale;return t>=r?0:Math.log(r/t)*Math.LOG2E}resolutionAtLevel(t){return this.levels[0].resolution/2**t}compatibleWith(t){if(!(t instanceof Mi)){if(Mi.checkUnsupported(t))return!1;t=new Mi(t)}if(!t.spatialReference.equals(this.spatialReference)||t.pixelSize!==this.pixelSize)return!1;const r=Math.min(this.levels.length,t.levels.length)-1,i=this.levels[r].resolution;let s=.5*i;return!lC(t.origin[0],this.origin[0],s)||!lC(t.origin[1],this.origin[1],s)?!1:(s=.5*i/2**r/this.pixelSize*Tit,lC(i,t.levels[r].resolution,s))}rootTilesInExtent(t,r=null,i=1/0){const s=new Array,n=this.levels[0].tileSize;if(R(t)||n[0]===0||n[1]===0)return s;Mi.computeRowColExtent(t,n,this.origin,Pf);let o=Pf[1],a=Pf[3],l=Pf[0],c=Pf[2];const h=c-l,p=a-o;if(h*p>i){const f=Math.floor(Math.sqrt(i));p>f&&(o=o+Math.floor(.5*p)-Math.floor(.5*f),a=o+f),h>f&&(l=l+Math.floor(.5*h)-Math.floor(.5*f),c=l+f)}for(let f=o;f<a;f++)for(let m=l;m<c;m++)s.push([0,f,m]);return b(r)&&(r[0]=this.origin[0]+l*n[0],r[1]=this.origin[1]-a*n[1],r[2]=this.origin[0]+c*n[0],r[3]=this.origin[1]-o*n[1]),s}static computeRowColExtent(t,r,i,s){const n=.001*(t[2]-t[0]+(t[3]-t[1]));s[0]=Math.max(0,Math.floor((t[0]+n-i[0])/r[0])),s[2]=Math.max(0,Math.ceil((t[2]-n-i[0])/r[0])),s[1]=Math.max(0,Math.floor((i[1]-t[3]+n)/r[1])),s[3]=Math.max(0,Math.ceil((i[1]-t[1]-n)/r[1]))}static isPowerOfTwo(t){const r=t.lods,i=r[0].resolution*2**r[0].level;return!r.some(s=>!Sze(s.resolution,i/2**s.level))}static hasGapInLevels(t){const r=t.lods.map(i=>i.level);r.sort((i,s)=>i-s);for(let i=1;i<r.length;i++)if(r[i]!==r[0]+i)return!0;return!1}static tileSizeSupported(t){const r=t.size[1];return r===t.size[0]&&(r&r-1)==0&&r>=128&&r<=512}static hasOriginPerLODs(t){const r=t.origin;return t.lods.some(i=>i.origin!=null&&(i.origin[0]!==r.x||i.origin[1]!==r.y))}static getMissingTileInfoError(){return new j("tilingscheme:tile-info-missing","Tiling scheme must have tiling information")}static checkUnsupported(t){return R(t)?eie():t.lods.length<1?new j("tilingscheme:generic","Tiling scheme must have at least one level"):Mi.isPowerOfTwo(t)?Mi.hasGapInLevels(t)?new j("tilingscheme:gaps","Tiling scheme levels must not have gaps between min and max level"):Mi.tileSizeSupported(t)?Mi.hasOriginPerLODs(t)?new j("tilingscheme:multiple-origin","Tiling scheme levels must not have their own origin"):null:new j("tilingscheme:tile-size","Tiles must be square and size must be one of [128, 256, 512]"):new j("tilingscheme:power-of-two","Tiling scheme must be power of two")}static fromExtent(t,r){const i=t[2]-t[0],s=t[3]-t[1],n=uu(r),o=1.2*Math.max(i,s),a=256,l=96,c=.0254,h=new Mi(new F5({size:[a,a],origin:{x:t[0]-.5*(o-i),y:t[3]+.5*(o-s)},lods:[{level:0,resolution:o/a,scale:1/(a/l*c/(o*n))}],spatialReference:r}));return h.ensureMaxLod(20),h}static makeWebMercatorAuxiliarySphere(t){const r=new Mi(Mi.WebMercatorAuxiliarySphereTileInfo);return r.ensureMaxLod(t),r}static makeGCSWithTileSize(t,r=256,i=16){const s=256/r,n=new Mi(new F5({size:[r,r],origin:{x:-180,y:90,spatialReference:t},spatialReference:t,lods:[{level:0,resolution:.703125*s,scale:295497598570834e-6*s}]}));return n.ensureMaxLod(i),n}get test(){return{isWebMercator:this._isWebMercator,isGCS:this._isGCS}}}function eie(){return new j("tilingscheme:tile-info-missing","Tiling scheme must have tiling information")}Mi.WebMercatorAuxiliarySphereTileInfo=new F5({size:[256,256],origin:{x:-20037508342787e-6,y:20037508342787e-6,spatialReference:Ze.WebMercator},spatialReference:Ze.WebMercator,lods:[{level:0,resolution:156543.03392800014,scale:591657527591555e-6}]}),Mi.WebMercatorAuxiliarySphere=Mi.makeWebMercatorAuxiliarySphere(19);const Pf=Ut(),LE=64,GY=512,Sit=2.5,MI=Eze(eW/10),vRe=4,Eit=4,k5=e=>e<4?3:Eit,_Re=Ut();Mi.WebMercatorAuxiliarySphere.getExtent(0,0,0,_Re);const Cit=Ut([-180,-90,180,90]),Ait="Cannot extend surface to encompass all layers because it would result in too many root tiles.",Rit="Surface extent is too large for tile resolution at level 0.",od=8,Oit=fe.getLogger("esri.views.support.GroundViewElevationSampler");let qv=class extends ds.EventedAccessor{constructor(e){super(e),this.demResolution={min:-1,max:-1},this.noDataValue=MI}initialize(){this.view.basemapTerrain.on("elevation-change",()=>this.emit("changed",{}))}get extent(){const e=this.view.basemapTerrain;if(R(e.extent)||!e.spatialReference)return null;const t=a6(e.extent,e.spatialReference);return t.zmin=e.elevationBounds.min,t.zmax=e.elevationBounds.max,t}elevationAt(e,t){if(R(this.extent)||!rl(this.extent,e,t)){const r=b(this.extent)?`${this.extent.xmin}, ${this.extent.ymin}, ${this.extent.xmax}, ${this.extent.ymax}`:null;return Oit.warn("#elevationAt()",`Point used to sample elevation (${e}, ${t}) is outside of the sampler extent (${r})`),this.noDataValue}return _t(this.view.elevationProvider.getElevation(e,t,0,this.spatialReference,"ground"),this.noDataValue)}queryElevation(e){return mRe(e.clone(),this)}};u([d({readOnly:!0})],qv.prototype,"demResolution",void 0),u([d({readOnly:!0})],qv.prototype,"extent",null),u([d({readOnly:!0})],qv.prototype,"noDataValue",void 0),u([d({readOnly:!0,aliasOf:"view.basemapTerrain.spatialReference"})],qv.prototype,"spatialReference",void 0),u([d({constructOnly:!0})],qv.prototype,"view",void 0),qv=u([$("esri.views.support.GroundViewElevationSampler")],qv);const Mit=qv;let Wv=class extends xe{constructor(e){super(e),this.handles=new Dt,this.view=null,this.layerViews=new ot}initialize(){this.handles.add(Lo(()=>{var e,t;return(t=(e=this.view)==null?void 0:e.map)==null?void 0:t.ground},e=>e.load())),this.handles.add(this.layerViews.on("after-changes",()=>this._layerViewsAfterChangesHandler()))}destroy(){this._set("view",null),this.handles&&(this.handles.destroy(),this.handles=null)}get elevationSampler(){return this.view?this.view.type==="2d"?null:this.view.ready&&this.view.basemapTerrain&&this.view.basemapTerrain.ready?new Mit({view:this.view}):null:null}get updating(){return!this.suspended&&this.layerViews.some(e=>e.updating)}get suspended(){return!this.view||this.view.suspended}_layerViewsAfterChangesHandler(){this.handles.remove("updating"),this.handles.add(this.layerViews.map(e=>te(()=>e.updating,()=>this._updateUpdating(),ei)).toArray(),"updating"),this._updateUpdating()}_updateUpdating(){this.notifyChange("updating")}};u([d({readOnly:!0})],Wv.prototype,"elevationSampler",null),u([d({type:Boolean,readOnly:!0})],Wv.prototype,"updating",null),u([d({constructOnly:!0})],Wv.prototype,"view",void 0),u([d({type:ot,readOnly:!0})],Wv.prototype,"layerViews",void 0),u([d({readOnly:!0})],Wv.prototype,"suspended",null),Wv=u([$("esri.views.GroundView")],Wv);const Pit=Wv,Iit=e=>{let t=class extends e{async fetchPopupFeatures(r,i){await this.when();const{location:s,queryArea:n,layerViewsAndGraphics:o,clientOnlyGraphics:a}=await this._prepareFetchPopupFeatures(r,i),l=Promise.resolve(a),c=this._queryLayerPopupFeatures(n,o,i),h=c.map(p=>p.promise);return{location:s,clientOnlyGraphics:a,allGraphicsPromise:A5e([l,...h]).then(p=>Array.from(new Set(p.flat()))),promisesPerLayerView:c}}_queryLayerPopupFeatures(r,i,s){return i.map(({layerView:n,graphics:o})=>{const a={clientGraphics:o,event:b(s)?s.event:null,signal:b(s)?s.signal:null,defaultPopupTemplateEnabled:!!b(s)&&!!s.defaultPopupTemplateEnabled},l=n.fetchPopupFeatures(r,a);return{layerView:n,promise:l}})}_isValidPopupGraphic(r,i){return r&&!!r.getEffectivePopupTemplate(b(i)&&i.defaultPopupTemplateEnabled)}async _prepareFetchPopupFeatures(r,i){const{clientGraphics:s,queryArea:n,location:o}=await this._popupHitTestGraphics(r,i),a=this._getFetchPopupLayerViews(),{layerViewsAndGraphics:l,clientOnlyGraphics:c}=this._graphicsPerFetchPopupLayerView(s,a);return{clientOnlyGraphics:c,layerViewsAndGraphics:l,queryArea:n,location:o}}async _popupHitTestGraphics(r,i){const{results:s,mapPoint:n}=await this.popupHitTest(r),o=s.filter(l=>l.type==="graphic"&&this._isValidPopupGraphic(l.graphic,i)),a=o.length?o[0].mapPoint:null;return{clientGraphics:o.map(l=>l.graphic),queryArea:n,location:n||a}}_getFetchPopupLayerViews(){const r=[];return this.allLayerViews.forEach(i=>{this._isValidPopupLayerView(i)&&r.push(i)}),b(this.graphicsView)&&this._isValidPopupLayerView(this.graphicsView)&&r.push(this.graphicsView),r.reverse()}_isValidPopupLayerView(r){return b(r)&&(!("layer"in r)||!r.suspended)&&"fetchPopupFeatures"in r}_graphicsPerFetchPopupLayerView(r,i){const s=[],n=new Map,o=i.map(a=>{const l=[];return"layer"in a?n.set(a.layer,l):n.set(a.graphics,l),{layerView:a,graphics:l}});for(const a of r){const l=n.get(a.layer)||n.get(a.sourceLayer)||null;l?l.push(a):s.push(a)}return{layerViewsAndGraphics:o,clientOnlyGraphics:s}}};return t=u([$("esri.views.PopupView")],t),t};let cP=class extends X3{_own(e){e.layer&&"remove"in e.layer&&e.layer!==this.owner&&e.layer.remove(e),e.layer=this.owner}_release(e){e.layer===this.owner&&(e.layer=null)}};u([HK({Type:gl,ensureType:en(gl)})],cP.prototype,"itemType",void 0),cP=u([$("esri.support.GraphicsCollection")],cP);let Xv=class extends xe{constructor(e){super(e),this.view=null,this.baseLayerViews=new ot,this.referenceLayerViews=new ot,this._loadingHandle=te(()=>{var t,r;return(r=(t=this.view)==null?void 0:t.map)==null?void 0:r.basemap},t=>{t&&t.load().catch(()=>{})},Rt)}destroy(){this._set("view",null),this._loadingHandle&&(this._loadingHandle.remove(),this._loadingHandle=null)}get suspended(){return!this.view||this.view.suspended}get updating(){var t,r;if(this.view&&this.view.suspended)return!1;const e=(r=(t=this.view)==null?void 0:t.map)==null?void 0:r.basemap;return!!e&&!!e.loaded&&(this.baseLayerViews.some(i=>i.updating)||this.referenceLayerViews.some(i=>i.updating))}};u([d({constructOnly:!0})],Xv.prototype,"view",void 0),u([d({readOnly:!0})],Xv.prototype,"baseLayerViews",void 0),u([d({readOnly:!0})],Xv.prototype,"referenceLayerViews",void 0),u([d({readOnly:!0})],Xv.prototype,"suspended",null),u([d({type:Boolean,readOnly:!0})],Xv.prototype,"updating",null),Xv=u([$("esri.views.BasemapView")],Xv);const $it=fe.getLogger("esri.views.LayerViewManager");class Lit{constructor(t,r,i){this.layer=t,this.view=r,this.layerViewImporter=i,this._controller=new AbortController,this._deferred=T1(),this._started=!1,this.done=!1,Ia(this._controller.signal,()=>{const s=new j("cancelled:layerview-create","layerview creation cancelled",{layer:t});this._deferred.reject(s)})}get promise(){return this._deferred.promise}destroy(){this._controller.abort();const{layerView:t}=this;if(!t)return;const{layer:r,view:i}=this;r.emit("layerview-destroy",{view:i,layerView:t}),i.emit("layerview-destroy",{layer:r,layerView:t}),this.done=!0,this.layer=null,this.layerView=null,this.view=null,this.layerViewImporter=null}async start(){var s,n;if(this._started)return;this._started=!0;const{_controller:{signal:t},layer:r,view:i}=this;this._map=i.map;try{let o,a;if(await r.load({signal:t}),"prefetchResources"in r&&await r.prefetchResources({signal:t}),r.createLayerView)o=await r.createLayerView(i,{signal:t});else{if(!this.layerViewImporter.hasLayerViewModule(r))throw new j("layer:view-not-supported","No layerview implementation was found");const h=await this.layerViewImporter.importLayerView(r);Jt(t),o="default"in h?new h.default({layer:r,view:i}):new h({layer:r,view:i})}const l=()=>{a=wn(a),o.destroyed||o.destroy(),o.layer=null,o.parent=null,o.view=null,this.done=!0};a=Ia(t,l),Jt(t);try{await o.when()}catch(h){throw l(),h}if(!((n=(s=this._map)==null?void 0:s.allLayers)==null?void 0:n.includes(r)))return l(),void this._deferred.reject(new j("view:no-layerview-for-layer","The layer has been removed from the map",{layer:r}));this.layerView=o,r.emit("layerview-create",{view:i,layerView:o}),i.emit("layerview-create",{layer:r,layerView:o}),this.done=!0,this._deferred.resolve(o)}catch(o){r.emit("layerview-create-error",{view:i,error:o}),i.emit("layerview-create-error",{layer:r,error:o}),this.done=!0,this._deferred.reject(new j("layerview:create-error","layerview creation failed",{layer:r,error:o}))}}}let Qh=class extends YC{constructor(e){super(e),this._layerLayerViewInfoMap=new Map,this._watchUpdatingTracking=new Gm,this.supportsGround=!0,this._preloadLayerViewModules=()=>{var r;const t=(r=this.view.map)==null?void 0:r.allLayers;if(t)for(const i of t)this.layerViewImporter.hasLayerViewModule(i)&&this.layerViewImporter.importLayerView(i)},this._reschedule=()=>(R(this._workPromise)&&(this._workPromise=T1()),this.handles.remove("reschedule"),this.handles.add(iR(this._doWork),"reschedule"),this._workPromise.promise),this._doWork=()=>{var n,o,a;const t=this.view.map;if(this._map!==t&&(this.clear(),this._map=t),R(this._workPromise))return void this.notifyChange("updating");this.handles.remove("reschedule"),this.handles.remove("collection-change");const r=new QC({getCollections:()=>this._rootCollectionNames.map(l=>this.get(l)),getChildrenFunction:l=>l&&"layers"in l?l.layers:null});if(!r)return this._workPromise.resolve(),void(this._workPromise=null);for(const l of r)this._createLayerView(l);this._refreshCollections();for(const[l,c]of this._layerLayerViewInfoMap)r.includes(l)||(this._layerLayerViewInfoMap.delete(c.layer),c.destroy());const i=r.filter(l=>l.type==="group").map(l=>l.layers),s=[(n=t==null?void 0:t.ground)==null?void 0:n.layers,(o=t==null?void 0:t.basemap)==null?void 0:o.baseLayers,(a=t==null?void 0:t.basemap)==null?void 0:a.referenceLayers,t==null?void 0:t.layers,...i].filter(l=>!!l);this.handles.add(s.map(l=>this._watchUpdatingTracking.addOnCollectionChange(()=>l,this._reschedule)),"collection-change"),this._workPromise.resolve(),this._workPromise=null}}initialize(){this.handles.add([rs(()=>{var e,t;return(t=(e=this.view)==null?void 0:e.map)==null?void 0:t.allLayers},"change",this._preloadLayerViewModules,{onListenerAdd:this._preloadLayerViewModules}),te(()=>{const e=this.view,t=e==null?void 0:e.map;return[t==null?void 0:t.basemap,t==null?void 0:t.ground,t==null?void 0:t.layers,e==null?void 0:e.ready]},()=>this._reschedule(),Xs)]),this._preloadLayerViewModules(),this._reschedule()}destroy(){this.clear(),this._watchUpdatingTracking.destroy(),this._map=null}get _layersToLayerViews(){const e=[["view.map.basemap.baseLayers","view.basemapView.baseLayerViews"],["view.map.layers","view.layerViews"],["view.map.basemap.referenceLayers","view.basemapView.referenceLayerViews"]];return this.supportsGround&&e.push(["view.map.ground.layers","view.groundView.layerViews"]),new Map(e)}get _rootCollectionNames(){return Array.from(this._layersToLayerViews.keys())}get updating(){return b(this._workPromise)||this._watchUpdatingTracking.updating||yn(this._layerLayerViewInfoMap,e=>!e.done)}get updatingRemaining(){let e=0;for(const t of this._layerLayerViewInfoMap.values())t.done||++e;return e}clear(){if(!this.destroyed){for(const e of this._layerLayerViewInfoMap.values())e.destroy();this._layerLayerViewInfoMap.clear(),this._refreshCollections()}}async whenLayerView(e){if(await this._reschedule(),!this._layerLayerViewInfoMap.has(e))throw new j("view:no-layerview-for-layer","No layerview has been found for the layer",{layer:e});return this._layerLayerViewInfoMap.get(e).promise}_refreshCollections(){for(const[e,t]of this._layersToLayerViews)this._populateLayerViewsOwners(this.get(e),this.get(t),this.view);this.notifyChange("updating"),this.notifyChange("updatingRemaining")}_populateLayerViewsOwners(e,t,r){if(!e||!t)return void(t&&t.removeAll());let i=0;for(const s of e){const n=this._layerLayerViewInfoMap.get(s);if(!n||!n.layerView)continue;const o=n.layerView;o.layer=s,o.parent=r,t.getItemAt(i)!==o&&t.splice(i,0,o),s.layers&&this._populateLayerViewsOwners(s.layers,o.layerViews,o),i+=1}i<t.length&&t.splice(i,t.length)}_createLayerView(e){if(this._layerLayerViewInfoMap.has(e))return this.view.ready&&this._layerLayerViewInfoMap.get(e).start(),this.notifyChange("updating"),void this.notifyChange("updatingRemaining");e.load().catch(()=>{}),this.layerViewImporter.hasLayerViewModule(e)&&this.layerViewImporter.importLayerView(e);const t=new Lit(e,this.view,this.layerViewImporter);t.promise.then(()=>this._refreshCollections(),r=>{var i,s;r&&(Vi(r)||r.name==="cancelled:layerview-create")||$it.error(`Failed to create layerview for layer title:'${(i=e.title)!=null?i:"no title"}', id:'${(s=e.id)!=null?s:"no id"}' of type '${e.type}'.`,{layer:e,error:r}),this._refreshCollections()}),this._layerLayerViewInfoMap.set(e,t),this.view.ready&&t.start(),this.notifyChange("updating"),this.notifyChange("updatingRemaining")}};u([d()],Qh.prototype,"_workPromise",void 0),u([d({readOnly:!0})],Qh.prototype,"_watchUpdatingTracking",void 0),u([d({readOnly:!0})],Qh.prototype,"_layersToLayerViews",null),u([d({readOnly:!0})],Qh.prototype,"_rootCollectionNames",null),u([d()],Qh.prototype,"layerViewImporter",void 0),u([d()],Qh.prototype,"supportsGround",void 0),u([d({readOnly:!0})],Qh.prototype,"updating",null),u([d({readOnly:!0})],Qh.prototype,"updatingRemaining",null),u([d({constructOnly:!0})],Qh.prototype,"view",void 0),Qh=u([$("esri.views.LayerViewManager")],Qh);const Dit=Qh;let Ou=class extends xe{constructor(e){super(e),this.factor=1.5,this.offset=wf(0,0),this.position=null,this.size=120,this.maskUrl=null,this.maskEnabled=!0,this.overlayUrl=null,this.overlayEnabled=!0,this.visible=!0}get version(){return this.commitProperty("factor"),this.commitProperty("offset"),this.commitProperty("position"),this.commitProperty("visible"),this.commitProperty("size"),this.commitProperty("maskUrl"),this.commitProperty("maskEnabled"),this.commitProperty("overlayUrl"),this.commitProperty("overlayEnabled"),(this._get("version")||0)+1}};u([d({type:Number})],Ou.prototype,"factor",void 0),u([d({nonNullable:!0})],Ou.prototype,"offset",void 0),u([d()],Ou.prototype,"position",void 0),u([d({type:Number,range:{min:0}})],Ou.prototype,"size",void 0),u([d()],Ou.prototype,"maskUrl",void 0),u([d()],Ou.prototype,"maskEnabled",void 0),u([d()],Ou.prototype,"overlayUrl",void 0),u([d()],Ou.prototype,"overlayEnabled",void 0),u([d({readOnly:!0})],Ou.prototype,"version",null),u([d({type:Boolean})],Ou.prototype,"visible",void 0),Ou=u([$("esri.views.Magnifier")],Ou);const bRe=Ou;let U5=class extends xe{constructor(){super(...arguments),this._tasks=new Array,this.running=!1}get length(){return this._tasks.length}destroy(){this.cancelAll()}runTask(e){for(;!e.done&&this._process(e);)e.madeProgress()}push(e,t,r){return this.running=!0,new Promise((i,s)=>this._tasks.push(new Ihe(i,s,e,t,r)))}unshift(e,t,r){return this.running=!0,new Promise((i,s)=>this._tasks.unshift(new Ihe(i,s,e,t,r)))}_process(e){if(this._tasks.length===0)return!1;const t=this._tasks.shift();try{const r=gn(t.signal);if(r&&!t.abortCallback)t.reject(gr());else{const i=r?t.abortCallback(gr()):t.callback(e);Ch(i)?i.then(t.resolve,t.reject):t.resolve(i)}}catch(r){t.reject(r)}return this.running=this._tasks.length>0,!0}cancelAll(){const e=gr();for(const t of this._tasks)if(t.abortCallback){const r=t.abortCallback(e);t.resolve(r)}else t.reject(e);this._tasks.length=0,this.running=!1}};u([d()],U5.prototype,"running",void 0),U5=u([$("esri.layers.support.PromiseQueue")],U5);class Ihe{constructor(t,r,i,s,n){this.resolve=t,this.reject=r,this.callback=i,this.signal=s,this.abortCallback=n}}let e3=class extends xe{constructor(){super(...arguments),this.SCHEDULER_LOG_SLOW_TASKS=!1,this.FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES=!1}};u([d()],e3.prototype,"SCHEDULER_LOG_SLOW_TASKS",void 0),u([d()],e3.prototype,"FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES",void 0),e3=u([$("esri.views.support.DebugFlags")],e3);const Nit=new e3,Fit=fe.getLogger("esri.views.support.Scheduler");function kit(){return new wV.Scheduler}var vt;(function(e){e.RESOURCE_CONTROLLER="schedule",e.SLIDE="slide",e.STREAM_DATA_LOADER="stream loader",e.ELEVATION_QUERY="elevation query",e.TERRAIN_SURFACE="terrain",e.SURFACE_GEOMETRY_UPDATES="surface geometry updates",e.GRAPHICS_CORE="Graphics3D",e.I3S_CONTROLLER="I3S",e.POINT_CLOUD_LAYER="point cloud",e.FEATURE_TILE_FETCHER="feature fetcher",e.OVERLAY="overlay",e.STAGE="stage",e.GRAPHICS_DECONFLICTOR="graphics deconflictor",e.FILTER_VISIBILITY="Graphics3D filter visibility",e.SCALE_VISIBILITY="Graphics3D scale visibility",e.FRUSTUM_VISIBILITY="Graphics3D frustum visibility",e.POINT_OF_INTEREST_FREQUENT="POI frequent",e.POINT_OF_INTEREST_INFREQUENT="POI infrequent",e.LABELER="labeler",e.FEATURE_QUERY_ENGINE="feature query",e.FEATURE_TILE_TREE="feature tile tree",e.FEATURE_TILE_TREE_ACTIVE="fast feature tile tree",e.ELEVATION_ALIGNMENT="elevation alignment",e.TEXT_TEXTURE_ATLAS="text texture atlas",e.TEXTURE_UNLOAD="texture unload",e.LINE_OF_SIGHT_TOOL="line of sight tool",e.LINE_OF_SIGHT_TOOL_INTERACTIVE="interactive line of sight tool",e.ELEVATION_PROFILE="elevation profile",e.SNAPPING="snapping",e.SHADOW_ACCUMULATOR="shadow accumulator",e.CLOUDS_GENERATOR="cloud generator",e[e.TEST_PRIO=1]="TEST_PRIO"})(vt||(vt={}));const Em=0,$he=new Map([[vt.RESOURCE_CONTROLLER,Em],[vt.SLIDE,Em],[vt.STREAM_DATA_LOADER,Em],[vt.ELEVATION_QUERY,Em],[vt.TERRAIN_SURFACE,1],[vt.SURFACE_GEOMETRY_UPDATES,1],[vt.GRAPHICS_CORE,2],[vt.I3S_CONTROLLER,2],[vt.POINT_CLOUD_LAYER,2],[vt.FEATURE_TILE_FETCHER,2],[vt.OVERLAY,4],[vt.STAGE,4],[vt.GRAPHICS_DECONFLICTOR,4],[vt.FILTER_VISIBILITY,4],[vt.SCALE_VISIBILITY,4],[vt.FRUSTUM_VISIBILITY,4],[vt.POINT_OF_INTEREST_FREQUENT,6],[vt.POINT_OF_INTEREST_INFREQUENT,30],[vt.LABELER,8],[vt.FEATURE_QUERY_ENGINE,8],[vt.FEATURE_TILE_TREE,16],[vt.FEATURE_TILE_TREE_ACTIVE,Em],[vt.ELEVATION_ALIGNMENT,12],[vt.TEXT_TEXTURE_ATLAS,12],[vt.CLOUDS_GENERATOR,12],[vt.TEXTURE_UNLOAD,12],[vt.LINE_OF_SIGHT_TOOL,16],[vt.LINE_OF_SIGHT_TOOL_INTERACTIVE,Em],[vt.SNAPPING,Em],[vt.SHADOW_ACCUMULATOR,30]]);function Lhe(e){return $he.has(e)?$he.get(e):typeof e=="number"?e:1}var Yn;(function(e){e[e.ANIMATING=0]="ANIMATING",e[e.INTERACTING=1]="INTERACTING",e[e.IDLE=2]="IDLE"})(Yn||(Yn={}));const Dhe=6.5,Nhe=1,Uit=30,Fhe=1e3/30,khe=100,Uhe=.9;var wV,db;(function(e){let t=class extends xe{constructor(){super(),this.updating=!0,this._microTaskQueued=!1,this.performanceInfo={total:new o1("total"),tasks:new Map},this._frameTaskTimes=new Map,this._budget=new i,this._state=Yn.INTERACTING,this._tasks=new Xt,this._runQueue=new Xt,this._load=0,this._idleStateCallbacks=new Xt,this._idleUpdatesStartFired=!1,this._maxReschedule=mN,this._forceTask=!1,this._debug=!1,this._debugHandle=te(()=>Nit.SCHEDULER_LOG_SLOW_TASKS,o=>this._debug=o,Rt);for(const o of Object.keys(vt))this.performanceInfo.tasks.set(vt[o],new o1(vt[o]));let s;const n=this;this._test={get state(){return _t(s,n._state)},set state(o){s=o},FRAME_SAFETY_BUDGET:Dhe,INTERACTING_BUDGET:Fhe,IDLE_BUDGET:khe,get availableBudget(){return n._budget.budget},usedBudget:0,getBudget:()=>n._budget,setBudget:o=>n._budget=o,updateTask:o=>this._updateTask(o),getState:o=>this._getState(o),getRuntime:o=>this._getRuntime(o),frameTaskTimes:this._frameTaskTimes,resetRuntimes:()=>this._resetRuntimes(),getRunning:()=>this._getRunning()}}destroy(){this._tasks.toArray().forEach(s=>s.remove()),this._tasks.clear(),wn(this._debugHandle),this._microTaskQueued=!1,this.updating=!1}activate(){this._budget.done||this._microTaskQueued||(this._microTaskQueued=!0,queueMicrotask(()=>{this._microTaskQueued&&(this._microTaskQueued=!1,this._budget.done||(this._maxReschedule=mN,this._schedule(),this.frame()))}))}registerTask(s,n){const o=Lhe(s),a=new r(this,s,n,o);return this._tasks.push(a),this.performanceInfo.tasks.has(s)||this.performanceInfo.tasks.set(s,new o1(s)),a}registerIdleStateCallbacks(s,n){const o={idleBegin:s,idleEnd:n};this._idleStateCallbacks.push(o),this.state===Yn.IDLE&&this._idleUpdatesStartFired&&o.idleBegin();const a=this;return{remove:()=>this._removeIdleStateCallbacks(o),set idleBegin(l){a._idleUpdatesStartFired&&(o.idleEnd(),a._state===Yn.IDLE&&l()),o.idleBegin=l},set idleEnd(l){o.idleEnd=l}}}get load(){return this._load}set state(s){this._state!==s&&(this._state=s,this.state!==Yn.IDLE&&this._idleUpdatesStartFired&&(this._idleUpdatesStartFired=!1,this._idleStateCallbacks.forAll(n=>n.idleEnd())))}get state(){return R(this._test.state)?this._state:this._test.state}updateBudget(s){this._test.usedBudget=0;let n=Dhe,o=s.frameDuration,a=Nhe;switch(this.state){case Yn.IDLE:n=0,o=Math.max(khe,s.frameDuration),a=Uit;break;case Yn.INTERACTING:o=Math.max(Fhe,s.frameDuration);case Yn.ANIMATING:}return o=o-s.elapsedFrameTime-n,this.state!==Yn.IDLE&&o<Nhe&&!this._forceTask?(this._forceTask=!0,!1):(o=Math.max(o,a),this._budget.reset(o,this.state),this._maxReschedule=mN,this._updateLoad(),this._schedule())}frame(){switch(this._forceTask=!1,this._microTaskQueued=!1,this.state){case Yn.IDLE:this._idleUpdatesStartFired||(this._idleUpdatesStartFired=!0,this._idleStateCallbacks.forAll(s=>s.idleBegin())),this._runIdle();break;case Yn.INTERACTING:this._runInteracting();break;default:this._runAnimating()}this._test.usedBudget=this._budget.elapsed}stopFrame(){this._budget.reset(0,this._state),this._budget.madeProgress()}_removeIdleStateCallbacks(s){this._idleUpdatesStartFired&&s.idleEnd(),this._idleStateCallbacks.removeUnordered(s)}removeTask(s){this._tasks.removeUnordered(s),this._runQueue.removeUnordered(s)}_updateTask(s){this._tasks.forAll(n=>{n.name===s&&n.setPriority(s)})}_getState(s){if(this._runQueue.some(o=>o.name===s))return db.SCHEDULED;let n=db.IDLE;return this._tasks.forAll(o=>{o.name===s&&o.needsUpdate&&(o.schedulePriority<=1?n=db.READY:n!==db.READY&&(n=db.WAITING))}),n}_getRuntime(s){let n=0;return this._tasks.forAll(o=>{o.name===s&&(n+=o.runtime)}),n}_resetRuntimes(){this._tasks.forAll(s=>s.runtime=0)}_getRunning(){const s=new Map;if(this._tasks.forAll(o=>{o.needsUpdate&&s.set(o.name,(s.get(o.name)||0)+1)}),s.size===0)return null;let n="";return s.forEach((o,a)=>{n+=o>1?` ${o}x ${a}`:` ${a}`}),n}_runIdle(){this._run()}_runInteracting(){this._run()}_runAnimating(){this._run()}_updateLoad(){const s=this._tasks.reduce((n,o)=>o.needsUpdate?++n:n,0);this._load=this._load*Uhe+s*(1-Uhe)}_schedule(){if(this._maxReschedule<=0)return!1;for(this._runQueue.filterInPlace(s=>!!s.needsUpdate||(s.schedulePriority=s.basePriority,!1)),this._tasks.forAll(s=>{s.basePriority===Em&&s.needsUpdate&&!this._runQueue.includes(s)&&this._runQueue.unshift(s)});this._runQueue.length===0;){let s=!1,n=0;if(this._tasks.forAll(o=>{o.needsUpdate&&o.schedulePriority!==0&&o.basePriority!==Em&&(s=!0,n=Math.max(n,o.basePriority),o.schedulePriority===1?(o.schedulePriority=0,this._runQueue.push(o)):--o.schedulePriority)}),!s)return this.updating=!1,!1;this._maxReschedule===mN&&(this._maxReschedule=n),--this._maxReschedule}return this.updating=!0,!0}_run(){const s=this._budget.now();this._startFrameTaskTimes();do for(;this._runQueue.length>0;){const n=this._budget.now(),o=this._runQueue.pop();this._budget.resetProgress();try{o.task.runTask(this._budget)}catch(l){Fit.error(`Exception in task "${o.name}"`,l)}o.schedulePriority=o.basePriority;const a=this._budget.now()-n;if(o.runtime+=a,this._frameTaskTimes.set(o.priority,this._frameTaskTimes.get(o.priority)+a),this._debug&&this._budget.elapsed>2*this._budget.budget&&console.log("Task",o.name,"used",this._budget.elapsed,"of max",this._budget.budget,"ms"),this._budget.remaining<=0)return this.updating=this._tasks.some(l=>l.needsUpdate),void this._recordFrameTaskTimes(this._budget.now()-s)}while(this._schedule());this.updating=this._tasks.some(n=>n.needsUpdate),this._recordFrameTaskTimes(this._budget.now()-s)}_startFrameTaskTimes(){for(const s of Object.keys(vt))this._frameTaskTimes.set(vt[s],0)}_recordFrameTaskTimes(s){this._frameTaskTimes.forEach((n,o)=>this.performanceInfo.tasks.get(o).record(n)),this.performanceInfo.total.record(s)}get test(){return this._test}};u([d()],t.prototype,"updating",void 0),t=u([$("esri.views.support.Scheduler")],t),e.Scheduler=t;let r=class extends xe{constructor(s,n,o,a){super({}),this._scheduler=s,this.name=n,this._basePriority=a,this.runtime=0,this._queue=new U5,this._handles=new Dt,this.schedulePriority=this._basePriority,this.task=b(o)?o:this._queue,this._handles.add(Lo(()=>this.task.running,()=>s.activate()))}get updating(){return this._queue.running}normalizeCtorArgs(){return{}}remove(){this.processQueue(ER),this._scheduler.removeTask(this),this.schedule=wA.schedule,this.reschedule=wA.reschedule,this._handles.destroy()}get basePriority(){return this._basePriority}setPriority(s){this.name=s;const n=Lhe(s);this._basePriority!==Em&&this.schedulePriority===0||(this.schedulePriority=n),this._basePriority=n}get priority(){return this.name}set priority(s){this.setPriority(s)}get needsUpdate(){return this.updating||this.task.running}schedule(s,n,o){return this._queue.push(s,n,o)}reschedule(s,n,o){return this._queue.unshift(s,n,o)}processQueue(s){this._queue.runTask(s)}};u([d({constructOnly:!0})],r.prototype,"task",void 0),u([d({readOnly:!0})],r.prototype,"updating",null),r=u([$("esri.views.support.SchedulerTask")],r);class i{constructor(){this._begin=typeof performance<"u"?performance.now():0,this._budget=0,this._state=Yn.IDLE,this._didWork=!1,this._enabled=!0}run(n){return!this.done&&(n()===!0&&(this._didWork=!0),!0)}get done(){return this._didWork&&this.elapsed>=this._budget&&this._enabled}get budget(){return this._budget}madeProgress(){this._didWork=!0}get state(){return this._state}get enabled(){return this._enabled}set enabled(n){this._enabled=n}reset(n,o){this._begin=this.now(),this._budget=n,this._state=o,this._didWork=!1}get remaining(){return Math.max(this._budget-this.elapsed,0)}now(){return performance.now()}get elapsed(){return performance.now()-this._begin}resetProgress(){this._didWork=!1}get hasProgressed(){return this._didWork}}e.Budget=i})(wV||(wV={})),function(e){e.SCHEDULED="s",e.READY="r",e.WAITING="w",e.IDLE="i"}(db||(db={}));const ER=(()=>{const e=new wV.Budget;return e.enabled=!1,e})();class Vit{remove(){}processQueue(){}schedule(t,r,i){try{if(gn(r)){const s=gr();return i?Promise.resolve(i(s)):Promise.reject(s)}return Eq(t(ER))}catch(s){return Promise.reject(s)}}reschedule(t,r,i){return this.schedule(t,r,i)}}const wA=new Vit,mN=Number.MAX_SAFE_INTEGER;let DE=class extends xe{constructor(e,t){var r;super({}),this._stage=e,this._textureRequests=new Map,this._frameTask=(r=t==null?void 0:t.registerTask(vt.TEXTURE_UNLOAD))!=null?r:wA}normalizeCtorArgs(){return{}}destroy(){super.destroy(),this._frameTask.remove(),this._textureRequests.forEach(e=>this._releaseTextureRequest(e)),this._textureRequests.clear()}get updating(){return this._frameTask.updating}fromData(e,t,r){const i=this.makeUid(e);let s=this._textureRequests.get(i);return s||(s={referenceCount:0,texture:t(),textureAsync:null,abortController:null,onRemove:r},this._stage&&(this._stage.add(s.texture),this._stage.loadImmediate(s.texture)),this._textureRequests.set(i,s)),s.referenceCount++,{uid:i,texture:s.texture,release:()=>this._release(i)}}_release(e){const t=this._textureRequests.get(e);t?(t.referenceCount<1&&console.warn("TextureCollection: reference count is < 1 for "+e),t.referenceCount--,t.referenceCount<1&&this._frameTask.schedule(()=>this._releaseNow(e))):console.warn(`TextureCollection: texture doesn't exist: '${e}'`)}get test(){return{textureRequests:this._textureRequests}}_releaseNow(e){if(!this._textureRequests)return;const t=this._textureRequests.get(e);!t||t.referenceCount>0||(this._releaseTextureRequest(t),this._textureRequests.delete(e))}_releaseTextureRequest(e){var t;e.onRemove&&e.onRemove(),e.texture?(t=this._stage)==null||t.remove(e.texture):e.abortController&&(e.abortController.abort(),e.abortController=null)}makeUid(e,t=null){return b(t)?`${e}.${t}px`:e}};u([d()],DE.prototype,"_frameTask",void 0),u([d()],DE.prototype,"updating",null),DE=u([$("esri.views.3d.support.TextureCollection")],DE);var Vhe;(function(e){e[e.Left=0]="Left",e[e.Middle=1]="Middle",e[e.Right=2]="Right"})(Vhe||(Vhe={}));const wRe=["click","double-click","immediate-click","immediate-double-click","hold","drag","key-down","key-up","pointer-down","pointer-move","pointer-up","pointer-drag","mouse-wheel","pointer-enter","pointer-leave","gamepad","focus","blur"],xRe={};function TRe(e){return!!xRe[e]}function zit(e){for(const t of e)if(!TRe(t))return!1;return!0}wRe.forEach(e=>{xRe[e]=!0});class Bit{constructor(t){this.handlers=new Map,this.counter=0,this.handlerCounts=new Map,this.view=t,this.inputManager=null}connect(t){t&&this.disconnect(),this.inputManager=t,this.handlers.forEach(({handler:r,priority:i},s)=>this.inputManager.installHandlers(s,[r],i))}disconnect(){this.inputManager&&this.handlers.forEach((t,r)=>this.inputManager.uninstallHandlers(r)),this.inputManager=null}destroy(){this.disconnect(),this.handlers.clear(),this.view=null}on(t,r,i,s){const n=Array.isArray(t)?t:t.split(",");if(!zit(n))return n.some(TRe)&&console.error("Error: registering input events and other events on the view at the same time is not supported."),null;let o,a;Array.isArray(r)?a=r:(o=r,a=[]),typeof i=="function"?o=i:s=i,s=s!=null?s:p1.DEFAULT;const l=this._createUniqueGroupName(),c=new Git(this.view,n,a,o);this.handlers.set(l,{handler:c,priority:s});for(const h of n){const p=this.handlerCounts.get(h)||0;this.handlerCounts.set(h,p+1)}return this.inputManager&&this.inputManager.installHandlers(l,[c],s),{remove:()=>this._removeHandler(l,n)}}hasHandler(t){return!!this.handlerCounts.get(t)}_removeHandler(t,r){if(this.handlers.has(t)){this.handlers.delete(t);for(const i of r){const s=this.handlerCounts.get(i);s===void 0?console.error("Trying to remove handler for event that has no handlers registered: ",i):s===1?this.handlerCounts.delete(i):this.handlerCounts.set(i,s-1)}}this.inputManager&&this.inputManager.uninstallHandlers(t)}_createUniqueGroupName(){return this.counter+=1,`viewEvents_${this.counter}`}}class Git extends aa{constructor(t,r,i,s){super(!0),this.view=t;for(const n of r)switch(n){case"click":this.registerIncoming("click",i,o=>s(this._wrapClick(o)));break;case"double-click":this.registerIncoming("double-click",i,o=>s(this._wrapDoubleClick(o)));break;case"immediate-click":this.registerIncoming("immediate-click",i,o=>s(this._wrapImmediateClick(o)));break;case"immediate-double-click":this.registerIncoming("immediate-double-click",i,o=>s(this._wrapImmediateDoubleClick(o)));break;case"hold":this.registerIncoming("hold",i,o=>s(this._wrapHold(o)));break;case"drag":this.registerIncoming("drag",i,o=>{const a=this._wrapDrag(o);a&&s(a)});break;case"key-down":this.registerIncoming("key-down",i,o=>s(this._wrapKeyDown(o)));break;case"key-up":this.registerIncoming("key-up",i,o=>s(this._wrapKeyUp(o)));break;case"pointer-down":this.registerIncoming("pointer-down",i,o=>s(this._wrapPointer(o,"pointer-down")));break;case"pointer-move":this.registerIncoming("pointer-move",i,o=>s(this._wrapPointer(o,"pointer-move")));break;case"pointer-up":this.registerIncoming("pointer-up",i,o=>s(this._wrapPointer(o,"pointer-up")));break;case"pointer-drag":this.registerIncoming("pointer-drag",i,o=>s(this._wrapPointerDrag(o)));break;case"mouse-wheel":this.registerIncoming("mouse-wheel",i,o=>s(this._wrapMouseWheel(o)));break;case"pointer-enter":this.registerIncoming("pointer-enter",i,o=>s(this._wrapPointer(o,"pointer-enter")));break;case"pointer-leave":this.registerIncoming("pointer-leave",i,o=>s(this._wrapPointer(o,"pointer-leave")));break;case"gamepad":this.registerIncoming("gamepad",i,o=>{s(this._wrapGamepad(o))});break;case"focus":this.registerIncoming("focus",i,o=>{s(this._wrapFocus(o))});break;case"blur":this.registerIncoming("blur",i,o=>{s(this._wrapBlur(o))})}}_wrapFocus(t){return{type:"focus",timestamp:t.timestamp,native:t.data.native,cancelable:t.cancelable,stopPropagation:()=>t.stopPropagation(),async:r=>t.async(r),preventDefault:()=>t.preventDefault()}}_wrapBlur(t){return{type:"blur",timestamp:t.timestamp,native:t.data.native,cancelable:t.cancelable,stopPropagation:()=>t.stopPropagation(),async:r=>t.async(r),preventDefault:()=>t.preventDefault()}}_wrapClick(t){const{pointerType:r,button:i,buttons:s,x:n,y:o,native:a,eventId:l}=t.data,{cancelable:c,timestamp:h}=t;return{type:"click",pointerType:r,button:i,buttons:s,x:n,y:o,native:a,timestamp:h,screenPoint:wf(n,o),mapPoint:this._getMapPoint(n,o),eventId:l,cancelable:c,stopPropagation:()=>t.stopPropagation(),async:p=>t.async(p),preventDefault:()=>t.preventDefault()}}_wrapDoubleClick(t){const{pointerType:r,button:i,buttons:s,x:n,y:o,native:a,eventId:l}=t.data,{cancelable:c,timestamp:h}=t;return{type:"double-click",pointerType:r,button:i,buttons:s,x:n,y:o,native:a,timestamp:h,mapPoint:this._getMapPoint(n,o),eventId:l,cancelable:c,stopPropagation:()=>t.stopPropagation(),async:p=>t.async(p),preventDefault:()=>t.preventDefault()}}_wrapImmediateClick(t){const{pointerType:r,button:i,buttons:s,x:n,y:o,native:a,eventId:l}=t.data,c=a.pointerId,{cancelable:h,timestamp:p}=t;return{type:"immediate-click",pointerId:c,pointerType:r,button:i,buttons:s,x:n,y:o,native:a,timestamp:p,mapPoint:this._getMapPoint(n,o),eventId:l,cancelable:h,stopPropagation:()=>t.stopPropagation(),async:f=>t.async(f),preventDefault:()=>t.preventDefault()}}_wrapImmediateDoubleClick(t){const{pointerType:r,button:i,buttons:s,x:n,y:o,native:a,eventId:l}=t.data,c=a.pointerId,{cancelable:h,timestamp:p}=t;return{type:"immediate-double-click",pointerId:c,pointerType:r,button:i,buttons:s,x:n,y:o,native:a,timestamp:p,mapPoint:this._getMapPoint(n,o),eventId:l,cancelable:h,stopPropagation:()=>t.stopPropagation(),async:f=>t.async(f),preventDefault:()=>t.preventDefault()}}_wrapHold(t){const{pointerType:r,button:i,buttons:s,x:n,y:o,native:a}=t.data,{cancelable:l,timestamp:c}=t;return{type:"hold",pointerType:r,button:i,buttons:s,x:n,y:o,native:a,timestamp:c,mapPoint:this._getMapPoint(n,o),cancelable:l,stopPropagation:()=>t.stopPropagation(),async:h=>t.async(h),preventDefault:()=>t.preventDefault()}}_getMapPoint(t,r){return this.view.toMap(wf(t,r),{exclude:[]})}_wrapDrag(t){const r=t.data,{x:i,y:s}=r.center,{action:n,pointerType:o,button:a}=r;if(n==="start"&&(this.latestDragStart=r),!this.latestDragStart)return;const l=r.pointer.native,c=r.buttons,{cancelable:h,timestamp:p}=t,f={x:this.latestDragStart.center.x,y:this.latestDragStart.center.y};return n==="end"&&(this.latestDragStart=void 0),{type:"drag",action:n,x:i,y:s,origin:f,pointerType:o,button:a,buttons:c,radius:r.radius,angle:nu(r.angle),native:l,timestamp:p,cancelable:h,stopPropagation:()=>t.stopPropagation(),async:m=>t.async(m),preventDefault:()=>t.preventDefault()}}_wrapKeyDown(t){const{key:r,repeat:i,native:s}=t.data,{cancelable:n,timestamp:o}=t;return{type:"key-down",key:r,repeat:i,native:s,timestamp:o,cancelable:n,stopPropagation:()=>t.stopPropagation(),async:a=>t.async(a),preventDefault:()=>t.preventDefault()}}_wrapKeyUp(t){const{key:r,native:i}=t.data,{cancelable:s,timestamp:n}=t;return{type:"key-up",key:r,native:i,timestamp:n,cancelable:s,stopPropagation:()=>t.stopPropagation(),async:o=>t.async(o),preventDefault:()=>t.preventDefault()}}_wrapPointer(t,r){const{x:i,y:s,button:n,buttons:o,native:a,eventId:l}=t.data,c=a.pointerId,h=a.pointerType,{cancelable:p,timestamp:f}=t;return{type:r,x:i,y:s,pointerId:c,pointerType:h,button:n,buttons:o,native:a,timestamp:f,eventId:l,cancelable:p,stopPropagation:()=>t.stopPropagation(),async:m=>t.async(m),preventDefault:()=>t.preventDefault()}}_wrapPointerDrag(t){const{x:r,y:i,buttons:s,native:n,eventId:o}=t.data.currentEvent,{button:a}=t.data.startEvent,l=t.data.startEvent.native.pointerId,c=t.data.startEvent.native.pointerType,h=t.data.action,p={x:t.data.startEvent.x,y:t.data.startEvent.y},{cancelable:f,timestamp:m}=t;return{type:"pointer-drag",x:r,y:i,pointerId:l,pointerType:c,button:a,buttons:s,action:h,origin:p,native:n,timestamp:m,eventId:o,cancelable:f,stopPropagation:()=>t.stopPropagation(),async:g=>t.async(g),preventDefault:()=>t.preventDefault()}}_wrapMouseWheel(t){const{cancelable:r,data:i,timestamp:s}=t,{x:n,y:o,deltaY:a,native:l}=i;return{type:"mouse-wheel",x:n,y:o,deltaY:a,native:l,timestamp:s,cancelable:r,stopPropagation:()=>t.stopPropagation(),async:c=>t.async(c),preventDefault:()=>t.preventDefault()}}_wrapGamepad(t){const{action:r,state:i,device:s}=t.data,{cancelable:n,timestamp:o}=t,{buttons:a,axes:l}=i;return{type:"gamepad",device:s,timestamp:o,action:r,buttons:a,axes:l,cancelable:n,stopPropagation:()=>t.stopPropagation(),async:c=>t.async(c),preventDefault:()=>t.preventDefault()}}}var PI,zhe,Bhe;(function(e){e[e.USER=0]="USER",e[e.MANAGER=1]="MANAGER"})(PI||(PI={})),function(e){e[e.None=0]="None",e[e.Unfocused=1]="Unfocused",e[e.Focused=2]="Focused",e[e.Unselected=4]="Unselected",e[e.Selected=8]="Selected",e[e.All=15]="All"}(zhe||(zhe={})),function(e){e[e.None=0]="None",e[e.Custom1=16]="Custom1",e[e.Custom2=32]="Custom2",e[e.Custom3=64]="Custom3",e[e.Custom4=128]="Custom4",e[e.Custom5=256]="Custom5",e[e.Custom6=512]="Custom6",e[e.Custom7=1024]="Custom7",e[e.Custom8=2048]="Custom8",e[e.Custom9=4096]="Custom9",e[e.Custom10=8192]="Custom10",e[e.Custom11=16384]="Custom11",e[e.Custom12=32768]="Custom12",e[e.All=65520]="All"}(Bhe||(Bhe={}));const jit=fe.getLogger("esri.views.interactive.interactiveToolUtils");function Hit(e){return[e.on("before-add",t=>{const r=t.item;if(r==null||e.includes(r))return jit.warn("Tool is either already in the list of tools or tool is `null`. Not adding tool."),void t.preventDefault();r.onAdd()}),e.on("after-remove",t=>{const r=t.item;r.visible=!1,r.active&&(r.view.activeTool=null),r.destroy()})]}function xV(e){return e.visible&&e.getEditableFlag(PI.USER)&&e.getEditableFlag(PI.MANAGER)}function lm(e){return wf(e.x,e.y)}function GLt(e){return ts(e.x,e.y)}function SRe(e,t){const r=(e instanceof HTMLElement?e:e.surface).getBoundingClientRect();return wf(t.clientX-r.left,t.clientY-r.top)}function Ghe(e,t){return t instanceof Event?SRe(e,t):lm(t)}function jhe(e){if(e instanceof Event)return!0;if(typeof e=="object"&&"type"in e)switch(e.type){case"click":case"double-click":case"pointer-down":case"pointer-drag":case"pointer-enter":case"pointer-leave":case"pointer-up":case"pointer-move":case"immediate-click":case"immediate-double-click":case"hold":case"drag":case"mouse-wheel":return!0;default:return!1}return!1}class qit{constructor(){this._pointerLocations=new Map,this._hoveredManipulators=new Map,this._grabbedManipulators=new Map,this._draggedManipulators=new Map,this._stopDrag=!1,this._currentlyActiveTool=null,this._revertToActiveTool=!1,this._cursor=null}get cursor(){return this._cursor}handleInputEvent(t,r){const i=()=>t.stopPropagation();switch(t.type){case"pointer-move":Hhe(t.pointerType)&&this._pointerLocations.set(t.pointerId,{x:t.x,y:t.y,pointerType:t.pointerType});break;case"drag":this._grabbedManipulators.size>0&&(this._stopDrag=!0),this._stopDrag&&(i(),t.action==="end"&&(this._stopDrag=!1));break;case"pointer-down":{if(!qhe(t))break;const s=lm(t),n=this._intersect(s,t.pointerType,r.forEachTool);if(R(n))break;const o=this._findToolAndManipulatorByKey(n,r.forEachTool,gN),a=mn(o,c=>c.manipulator),l=mn(o,c=>c.tool);!(b(a)&&b(l)&&a.interactive)||a.grabbable&&a.grabbableForEvent(t)||!a.grabbing||a.dragging||this._ungrabManipulatorBeforeDragging(a,l,t),b(a)&&a.interactive&&a.grabbable&&a.grabbableForEvent(t)&&!a.grabbing&&(this._grabbedManipulators.set(t.pointerId,{key:n,start:s,pointerType:t.pointerType}),this._grabbedManipulators.size===1&&r.activeTool!==n.tool&&(this._currentlyActiveTool=r.activeTool,this._revertToActiveTool=!0,r.setActiveTool(n.tool)),a.grabbing=!0,a.events.emit("grab-changed",{action:"start",pointerType:t.pointerType,screenPoint:s}),i());break}case"pointer-up":this._handlePointerEnd(t,r);break;case"pointer-drag":{if(!qhe(t))break;const s=this._grabbedManipulators.get(t.pointerId),n=this._draggedManipulators.get(t.pointerId),o=mn(s||n,({key:h})=>h),a=this._findManipulatorByKey(o,r.forEachTool);if(R(a))break;const l=lm(t);l.x=Le(l.x,0,r.view.width),l.y=Le(l.y,0,r.view.height);const c=(s||n).start;switch(t.action){case"start":case"update":t.action!=="update"&&this._grabbedManipulators.size!==1||(a.dragging=!0,n?a.events.emit("drag",{action:"update",start:c,screenPoint:l}):a.events.emit("drag",{action:"start",start:c,screenPoint:l,pointerType:t.pointerType}),this._draggedManipulators.set(t.pointerId,{key:o,start:c}));break;case"end":a.dragging=!1,n&&a.events.emit("drag",{action:"end",start:c,screenPoint:l}),this._draggedManipulators.delete(t.pointerId),this._handlePointerEnd(t,r)}i();break}case"immediate-click":{const s=lm(t),n=this._intersect(s,t.pointerType,r.forEachTool),o=this._findToolAndManipulatorByKey(n,r.forEachTool,gN);if(Wit(t)||r.forEachTool(h=>{if((!b(o)||o.tool!==h||h.automaticManipulatorSelection)&&h.manipulators){let p=!1;h.manipulators.forEach(({manipulator:f})=>{f.selected&&(f.selected=!1,p=!0)}),p&&h.manipulatorSelectionChanged&&h.manipulatorSelectionChanged()}}),R(o))break;const{manipulator:a,tool:l}=o;if(!a.interactive)break;a.selectable&&l.automaticManipulatorSelection&&(a.selected=!a.selected,l.manipulatorSelectionChanged&&l.manipulatorSelectionChanged());const c=t.native.shiftKey;a.events.emit("immediate-click",{screenPoint:s,button:t.button,pointerType:t.pointerType,shiftKey:c,stopPropagation:i});break}case"click":{const s=lm(t),n=this._intersect(s,t.pointerType,r.forEachTool),o=this._findManipulatorByKey(n,r.forEachTool);if(R(o)||!o.interactive)break;const a=t.native.shiftKey;o.events.emit(t.type,{screenPoint:s,button:t.button,pointerType:t.pointerType,shiftKey:a}),i();break}case"double-click":{const s=lm(t),n=this._intersect(s,t.pointerType,r.forEachTool),o=this._findManipulatorByKey(n,r.forEachTool);if(R(o)||!o.interactive)break;const a=t.native.shiftKey;o.events.emit("double-click",{screenPoint:s,button:t.button,pointerType:t.pointerType,shiftKey:a,stopPropagation:i});break}case"immediate-double-click":{const s=lm(t),n=this._intersect(s,t.pointerType,r.forEachTool),o=this._findManipulatorByKey(n,r.forEachTool);if(R(o)||!o.interactive)break;const a=t.native.shiftKey;o.events.emit("immediate-double-click",{screenPoint:s,button:t.button,pointerType:t.pointerType,shiftKey:a,stopPropagation:i});break}}this._onFocusChange(r.forEachTool)}_ungrabManipulatorBeforeDragging(t,r,i){t.grabbing=!1,t.events.emit("grab-changed",{action:"end",pointerType:i.pointerType,screenPoint:lm(i)}),this._grabbedManipulators.forEach(({key:s},n)=>{s.tool===r&&r.manipulators.findById(s.manipulatorId)===t&&this._grabbedManipulators.delete(n)})}_handlePointerEnd(t,r){const i=mn(this._grabbedManipulators.get(t.pointerId),({key:n})=>n),s=this._findManipulatorByKey(i,r.forEachTool);b(s)&&!s.dragging&&(this._grabbedManipulators.size===1&&this._draggedManipulators.size===0&&this._revertToActiveTool&&(r.setActiveTool(this._currentlyActiveTool),this._revertToActiveTool=!1,this._currentlyActiveTool=null),s.grabbing&&(s.grabbing=!1,s.events.emit("grab-changed",{action:"end",pointerType:t.pointerType,screenPoint:lm(t)})),this._grabbedManipulators.delete(t.pointerId))}_cursorFromMap(t,r){let i=null;return yn(t,({key:s})=>{const n=this._findManipulatorByKey(s,r);return!!(b(n)&&n.interactive&&"cursor"in n&&n.cursor)&&(i=n.cursor,!0)}),i}_onFocusChange(t){this._updateCursor(t),this._updateFocusedManipulatorTools(t)}_updateCursor(t){this._grabbedManipulators.size>0?this._cursor=this._cursorFromMap(this._grabbedManipulators,t)||"grabbing":this._hoveredManipulators.size>0?this._cursor=this._cursorFromMap(this._hoveredManipulators,t)||"pointer":this._cursor=null}_updateFocusedManipulatorTools(t){const r=new Set;this._grabbedManipulators.forEach(({key:{tool:i}})=>{r.add(i)}),this._hoveredManipulators.forEach(({key:{tool:i}})=>{r.add(i)}),t(i=>{i.hasFocusedManipulators=r.has(i)})}clearPointers(t,r,i=!0,s){const n=o=>o.tool===t&&(R(s)||o.manipulatorId===s);this._grabbedManipulators.forEach(({key:o,pointerType:a},l)=>{if(n(o)){this._grabbedManipulators.delete(l);const c=this._findManipulatorByKey(o,r);b(c)&&(c.grabbing=!1,c.events.emit("grab-changed",{action:"end",screenPoint:null,pointerType:a}))}}),this._draggedManipulators.forEach(({key:o},a)=>{if(n(o)){this._draggedManipulators.delete(a);const l=this._findManipulatorByKey(o,r);b(l)&&(l.dragging=!1,l.events.emit("drag",{action:"cancel"}))}}),i&&this._hoveredManipulators.forEach(({key:o},a)=>{if(n(o)){this._hoveredManipulators.delete(a);const l=this._findManipulatorByKey(o,r);b(l)&&(l.hovering=!1)}}),this._onFocusChange(r)}_intersect(t,r,i){let s=null;return i(n=>{if(n.manipulators==null||!xV(n))return!1;const o=n.manipulators.intersect(t,r);return!R(o)&&(s={manipulatorId:o.id,tool:n},!0)}),s}updateHoveredStateFromKnownPointers(t){this._pointerLocations.forEach((r,i)=>{this._updateHoveredStateForPointerAtScreenPosition(wf(r.x,r.y),i,r.pointerType,t)})}handleHoverEvent(t,r){t.type!=="pointer-up"&&t.type!=="immediate-click"&&t.type!=="pointer-move"||!Hhe(t.pointerType)||this._updateHoveredStateForPointerAtScreenPosition(lm(t),t.pointerId,t.pointerType,r)}_updateHoveredStateForPointerAtScreenPosition(t,r,i,s){const n=this._intersect(t,i,s);let o=this._findManipulatorByKey(n,s);const a=mn(this._hoveredManipulators.get(r),({key:c})=>c),l=this._findManipulatorByKey(a,s);b(o)&&!o.interactive&&(o=null),l!==o&&(b(l)&&(l.hovering=!1),b(o)?(o.hovering=!0,this._hoveredManipulators.set(r,{key:n})):this._hoveredManipulators.delete(r),this._onFocusChange(s))}_findManipulatorByKey(t,r){return this._findToolAndManipulatorByKey(t,r,gN)?gN.manipulator:null}_findToolAndManipulatorByKey(t,r,i){return R(t)?null:(i.tool=null,i.manipulator=null,r(s=>{if(s!==t.tool||s.manipulators==null||!xV(s))return!1;const n=s.manipulators.findById(t.manipulatorId);return!!b(n)&&(i.manipulator=n,i.tool=s,!0)}),i.manipulator?i:null)}}function Hhe(e){return e==="mouse"}function qhe(e){return e.pointerType!=="mouse"||e.button===0}function Wit(e){return!!e.native.shiftKey}const gN={manipulator:null,tool:null},Xit=fe.getLogger("esri.views.ToolViewManager"),Whe="attached",YG="tools";let iy=class extends YC{constructor(e){super(e),this._manipulatorState=new qit,this.tools=new ot,this.cursor=null,this._forEachTool=t=>{for(const r of this.tools.items)if(t(r))return}}initialize(){this.handles.add([this.view.on(wRe,e=>{this._handleInputEvent(e)},p1.TOOL),...Hit(this.tools),this.tools.on("before-remove",({item:e})=>{this._manipulatorState.clearPointers(e,this._forEachTool)}),this.tools.on("change",()=>{this._refreshToolWatchers()})])}destroy(){this.detach(),this.handles.removeAll()}set activeTool(e){if(b(e)&&!this.view.ready)return void Xit.error("Cannot set active tool while view is not ready.");if(e===this.activeTool)return;const t=this.activeTool;this._set("activeTool",e),b(t)&&t.deactivate(),b(e)&&e.activate(),this._removeIncompleteTools(e);const r=R(this.activeTool);for(const i of this.tools){i.setEditableFlag(PI.MANAGER,r||i===this.activeTool);const s=xV(i);!r&&s||this._manipulatorState.clearPointers(i,this._forEachTool,!s)}this._updateCursor()}get updating(){var e,t;return this.updatingHandles.updating||this.tools.some(r=>r.updating)||((t=(e=this.textures)==null?void 0:e.updating)!=null?t:!1)}attach(){this.view.type==="3d"?(this._set("textures",new DE(this.view._stage,this.view.resourceController.scheduler)),this.handles.add([te(()=>{const{state:e}=this.view;return"camera"in e&&e.camera},()=>{this._forEachManipulator(e=>{e.onViewChange!=null&&e.onViewChange()})}),this.view.elevationProvider.on("elevation-change",e=>{this._forEachManipulator(t=>{t.onElevationChange!=null&&t.onElevationChange(e)})}),kd(()=>this._set("textures",ct(this.textures)))],Whe)):this.handles.add(te(()=>this.view.extent,()=>{this._forEachManipulator(e=>{e.onViewChange!=null&&e.onViewChange()})}))}detach(){b(this.activeTool)&&(this.activeTool=null),this.tools.removeAll(),this.handles.remove(Whe)}_forEachManipulator(e){this._forEachTool(t=>{t.manipulators&&t.manipulators.forEach(({manipulator:r})=>e(r,t))})}_handleInputEvent(e){let t=!1;const r={...e,stopPropagation:()=>{t=!0,e.stopPropagation()}};b(this.activeTool)?this.activeTool.handleInputEvent&&this.activeTool.handleInputEvent(r):this._forEachTool(i=>{!t&&i.visible&&i.handleInputEvent(r)}),!t&&e.type==="key-down"&&e.key==="Escape"&&this.activeTool&&(e.stopPropagation(),this.activeTool=null),this._manipulatorState.handleInputEvent(r,{forEachTool:this._forEachTool,activeTool:this.activeTool,setActiveTool:i=>{this.activeTool=i},view:this.view}),!t&&b(this.activeTool)&&this.activeTool.handleInputEventAfter(r),this._manipulatorState.handleHoverEvent(r,this._forEachTool),this._updateCursor()}_refreshToolWatchers(){this.handles.remove(YG),this._forEachTool(e=>{if(e instanceof xe){const t=te(()=>[e.cursor,e.visible,e.editable],()=>{xV(e)||this._manipulatorState.clearPointers(e,this._forEachTool),this._updateCursor()});this.handles.add(t,YG)}e.manipulators&&this.handles.add(e.manipulators.on("change",t=>{t.removed.forEach(({id:r})=>{this._manipulatorState.clearPointers(e,this._forEachTool,!0,r)}),this._manipulatorState.updateHoveredStateFromKnownPointers(this._forEachTool),this._updateCursor()}),YG)}),this._manipulatorState.updateHoveredStateFromKnownPointers(this._forEachTool),this._updateCursor()}_updateCursor(){const e=this._manipulatorState.cursor;let t=e;this._forEachTool(r=>!(!b(r.cursor)||!r.visible||!R(e)&&r.preferManipulatorCursor)&&(t=r.cursor,!0)),this._get("cursor")!==t&&this._set("cursor",t)}_removeIncompleteTools(e){this.tools.filter(t=>(R(e)||t!==e)&&!t.created&&t.removeIncompleteOnCancel).forEach(t=>{this.tools.remove(t)})}};u([d({constructOnly:!0,nonNullable:!0})],iy.prototype,"view",void 0),u([d({readOnly:!0,nonNullable:!0})],iy.prototype,"textures",void 0),u([d({value:null})],iy.prototype,"activeTool",null),u([d({readOnly:!0,type:ot})],iy.prototype,"tools",void 0),u([d({readOnly:!0})],iy.prototype,"cursor",void 0),u([d({readOnly:!0})],iy.prototype,"updating",null),iy=u([$("esri.views.ToolViewManager")],iy);const Zit=iy;let j2=class extends xe{constructor(e){super(),this.nativeIndex=null,this._detectedDeviceType="unknown",e.mapping==="standard"?this._detectedDeviceType="standard":Yit.test(e.id)?this._detectedDeviceType="spacemouse":this._detectedDeviceType="unknown",this.nativeIndex=e.index}get native(){return(navigator.getGamepads?navigator.getGamepads():[])[this.nativeIndex]}get deviceType(){return this._detectedDeviceType}get axisThreshold(){return Qit[this.deviceType]}};u([d({nonNullable:!0,readOnly:!0})],j2.prototype,"nativeIndex",void 0),u([d({type:String,readOnly:!0})],j2.prototype,"deviceType",null),u([d({type:Number,readOnly:!0})],j2.prototype,"axisThreshold",null),j2=u([$("esri.views.input.gamepad.GamepadInputDevice")],j2);const Yit=new RegExp("^(3dconnexion|space(mouse|navigator|pilot|explorer))","i"),Qit={standard:.15,spacemouse:.025,unknown:0},tie=j2;let t3=class extends xe{constructor(...e){super(...e),this.devices=new ot,this.enabledFocusMode="document"}};u([d({type:ot.ofType(tie),readOnly:!0})],t3.prototype,"devices",void 0),u([d({type:["document","view","none"]})],t3.prototype,"enabledFocusMode",void 0),t3=u([$("esri.views.input.gamepad.GamepadSettings")],t3);const Jit=t3;let V5=class extends xe{constructor(){super(...arguments),this.gamepad=new Jit}};u([d({readOnly:!0})],V5.prototype,"gamepad",void 0),V5=u([$("esri.views.input.Input")],V5);const Kit=V5;let Zv=class extends xe{constructor(e){super(e),this.enabled=!0,this.device=null,this.mode="pan",this.tiltDirection="forward-down",this.velocityFactor=1}};u([d({type:Boolean,nonNullable:!0})],Zv.prototype,"enabled",void 0),u([d({type:tie})],Zv.prototype,"device",void 0),u([d({type:["pan","zoom"],nonNullable:!0})],Zv.prototype,"mode",void 0),u([d({type:["forward-down","forward-up"],nonNullable:!0})],Zv.prototype,"tiltDirection",void 0),u([d({type:Number,nonNullable:!0})],Zv.prototype,"velocityFactor",void 0),Zv=u([$("esri.views.navigation.gamepad.GamepadSettings")],Zv);const ERe=Zv;let Sw=class extends xe{constructor(e){super(e),this.browserTouchPanEnabled=!0,this.gamepad=new ERe,this.momentumEnabled=!0,this.mouseWheelZoomEnabled=!0}};u([d({type:Boolean})],Sw.prototype,"browserTouchPanEnabled",void 0),u([d({type:ERe,nonNullable:!0})],Sw.prototype,"gamepad",void 0),u([d({type:Boolean})],Sw.prototype,"momentumEnabled",void 0),u([d({type:Boolean})],Sw.prototype,"mouseWheelZoomEnabled",void 0),Sw=u([$("esri.views.navigation.Navigation")],Sw);const CRe=Sw;function jLt(e,t,r){const i=ARe(e),s=t,n=est(i,s,r);if(i){const o=QT.deriveUnitFromSR(i,e.spatialReference).heightUnit;if(!r&&o!==i.heightUnit){const a=new j("layerview:unmatched-height-unit",`The vertical units of the layer must match the horizontal units (${o})`,{horizontalUnit:o});return new j("layerview:unsupported-height-model-info","The vertical coordinate system of the layer is not supported",{heightModelInfo:i,error:a})}}if(!tst(e)||n===Ic.Unsupported)return new j("layerview:unsupported-height-model-info","The vertical coordinate system of the layer is not supported",{heightModelInfo:i});switch(n){case Ic.Units:{const o=i.heightUnit||"unknown",a=s.heightUnit||"unknown",l=new j("layerview:incompatible-height-unit",`The vertical units of the layer (${o}) must match the vertical units of the scene (${a})`,{layerUnit:o,sceneUnit:a});return new j("layerview:incompatible-height-model-info","The vertical coordinate system of the layer is incompatible with the scene",{layerHeightModelInfo:i,sceneHeightModelInfo:s,error:l})}case Ic.HeightModel:{const o=i.heightModel||"unknown",a=s.heightModel||"unknown",l=new j("layerview:incompatible-height-model",`The height model of the layer (${o}) must match the height model of the scene (${a})`,{layerHeightModel:o,sceneHeightModel:a});return new j("layerview:incompatible-height-model-info","The vertical coordinate system of the layer is incompatible with the scene",{layerHeightModelInfo:i,sceneHeightModelInfo:s,error:l})}case Ic.CRS:{const o=i.vertCRS||"unknown",a=s.vertCRS||"unknown",l=new j("layerview:incompatible-vertical-datum",`The vertical datum of the layer (${o}) must match the vertical datum of the scene (${a})`,{layerDatum:o,sceneDatum:a});return new j("layerview:incompatible-height-model-info","The vertical coordinate system of the layer is incompatible with the scene",{layerHeightModelInfo:i,sceneHeightModelInfo:s,error:l})}}return null}function est(e,t,r){if(!Xhe(e)||!Xhe(t))return Ic.Unsupported;if(e==null||t==null)return Ic.Ok;if(!r&&e.heightUnit!==t.heightUnit)return Ic.Units;if(e.heightModel!==t.heightModel)return Ic.HeightModel;switch(e.heightModel){case"gravity-related-height":return Ic.Ok;case"ellipsoidal":return e.vertCRS===t.vertCRS?Ic.Ok:Ic.CRS;default:return Ic.Unsupported}}var Ic;function Xhe(e){return e==null||e.heightModel!=null&&e.heightUnit!=null}function tst(e){return"heightModelInfo"in e&&e.heightModelInfo!=null||e.spatialReference!=null||!MRe(e)}function ARe(e){const t=e.url&&yT(e.url);return!((e.spatialReference&&e.spatialReference.vcsWkid)==null&&b(t)&&t.serverType==="ImageServer")&&RRe(e)&&e.heightModelInfo?e.heightModelInfo:MRe(e)?QT.deriveUnitFromSR(ist,e.spatialReference):null}function RRe(e){return"heightModelInfo"in e}function ORe(e){if(e.type==="unknown"||!("capabilities"in e))return!1;switch(e.type){case"csv":case"feature":case"geojson":case"subtype-group":case"ogc-feature":case"wfs":return!0;default:return!1}}function MRe(e){return ORe(e)?!!(e.capabilities&&e.capabilities.data&&e.capabilities.data.supportsZ):PRe(e)}function rst(e){return e.layers!=null||PRe(e)||ORe(e)||RRe(e)}function PRe(e){switch(e.type){case"building-scene":case"elevation":case"integrated-mesh":case"point-cloud":case"scene":case"voxel":return!0;case"line-of-sight":case"base-dynamic":case"base-elevation":case"base-tile":case"bing-maps":case"csv":case"geojson":case"feature":case"subtype-group":case"geo-rss":case"graphics":case"group":case"imagery":case"imagery-tile":case"kml":case"map-image":case"map-notes":case"media":case"ogc-feature":case"open-street-map":case"route":case"stream":case"tile":case"unknown":case"unsupported":case"vector-tile":case"wcs":case"web-tile":case"wfs":case"wms":case"wmts":case null:return!1}return!1}(function(e){e[e.Ok=0]="Ok",e[e.Units=1]="Units",e[e.HeightModel=2]="HeightModel",e[e.CRS=3]="CRS",e[e.Unsupported=4]="Unsupported"})(Ic||(Ic={}));const ist=new QT({heightModel:"gravity-related-height"});var Be;function Zhe(e){return e==="global"?Be.Global:Be.Local}function uP(e){return e===Be.Global?"global":"local"}(function(e){e[e.Global=1]="Global",e[e.Local=2]="Local"})(Be||(Be={}));let jY,QG=null;async function sst(e){QG||(QG=ie(()=>Promise.resolve().then(()=>Ywt),void 0,import.meta.url).then(t=>jY=t)),await QG,Jt(e)}async function IRe(e,t,r,i){if(!e)return null;const s=e.spatialReference;return x6()||sg(s,t)?Q$(e,t):jY?jY.projectGeometry(e,t,r,i):(await Promise.race([sst(i),mI(i)]),IRe(e,t,r,i))}let Ni=class extends xe{constructor(e){super(e),this.required={tileInfo:!1,heightModelInfo:!1,extent:!1},this.defaultSpatialReference=null,this.userSpatialReference=null,this.sourcePreloadCount=10,this.priorityCollection=null,this.requiresExtentInSpatialReference=!0,this.suspended=!1,this._projectExtentTask={task:null,input:null,output:null,spatialReference:null}}destroy(){this._projectExtentTask.task&&(this._projectExtentTask.task=Fd(this._projectExtentTask.task)),this._set("map",null)}get ready(){return!this._spatialReferenceTask.updating&&!this._tileInfoTask.updating&&!this._extentTask.updating}get heightModelInfoReady(){return!this._heightModelInfoTask.updating}get spatialReference(){return b(this.userSpatialReference)?this.userSpatialReference:this._spatialReferenceTask.spatialReference}get extent(){return this._extentTask.extent}get heightModelInfo(){return this._heightModelInfoTask.heightModelInfo}get vcsWkid(){return this._heightModelInfoTask.vcsWkid}get latestVcsWkid(){return this._heightModelInfoTask.latestVcsWkid}get viewingMode(){return R(this.userSpatialReference)||this.userSpatialReference.equals(this._spatialReferenceTask.spatialReference)?this._spatialReferenceTask.viewingMode:null}get tileInfo(){return this._tileInfoTask.tileInfo}get mapCollections(){var r,i,s,n;const e=(r=this.map)==null?void 0:r.call(this),t=[];return b(this.priorityCollection)&&t.push(this.priorityCollection),t.push({parent:e==null?void 0:e.basemap,layers:(i=e==null?void 0:e.basemap)==null?void 0:i.baseLayers},{layers:e==null?void 0:e.layers},{parent:e==null?void 0:e.ground,layers:(s=e==null?void 0:e.ground)==null?void 0:s.layers},{parent:e==null?void 0:e.basemap,layers:(n=e==null?void 0:e.basemap)==null?void 0:n.referenceLayers}),t}get _allLayers(){return this._collectLayers(this.mapCollections)}get _spatialReferenceTask(){var s;if(this.suspended)return(s=this._get("_spatialReferenceTask"))!=null?s:{updating:!1};const{layers:e,updating:t}=this._allLayers;let r=null;for(const n of e){const o=this._getSupportedSpatialReferences(n);if(o.length>0){const a=this._narrowDownSpatialReferenceCandidates(r,o);b(a)&&(r=a)}if(b(r)&&r.length===1)break}if(t&&(R(r)||r.length!==1))return{updating:!0};const i=this._pickSpatialReferenceCandidate(r);return{spatialReference:b(i)?i.spatialReference:null,viewingMode:b(i)?i.viewingMode:null,updating:!1}}get _tileInfoTask(){var r,i,s,n,o,a,l,c;if(!this.required.tileInfo)return(r=this._get("_tileInfoTask"))!=null?r:{updating:!1};if(!this.spatialReference)return{updating:this._spatialReferenceTask.updating};const{layers:e,updating:t}=this._collectLayers([{parent:(s=(i=this.map)==null?void 0:i.call(this))==null?void 0:s.basemap,layers:(a=(o=(n=this.map)==null?void 0:n.call(this))==null?void 0:o.basemap)==null?void 0:a.baseLayers},{layers:(c=(l=this.map)==null?void 0:l.call(this))==null?void 0:c.layers}]);if(e&&e.length>0&&"tileInfo"in e[0]){const h=e[0].tileInfo;return{tileInfo:h&&h.spatialReference.equals(this.spatialReference)?h:null,updating:!1}}return{updating:t}}get _heightModelInfoTask(){var r,i,s,n;if(!this.required.heightModelInfo||this.suspended&&((r=this._get("_heightModelInfoTask"))==null?void 0:r.heightModelInfo))return(i=this._get("_heightModelInfoTask"))!=null?i:{updating:!1};const{layers:e,updating:t}=this._allLayers;for(const o of e)if(rst(o)){const a=ARe(o);if(a)return{heightModelInfo:a,vcsWkid:(s=o.spatialReference)==null?void 0:s.vcsWkid,latestVcsWkid:(n=o.spatialReference)==null?void 0:n.latestVcsWkid,updating:!1}}return{updating:t}}get _extentCandidatesTask(){var i,s;if(this.suspended||!this.required.extent)return(i=this._get("_extentCandidatesTask"))!=null?i:{updating:!1};if(!this.spatialReference)return{updating:this._spatialReferenceTask.updating};const e=this._allLayers,t=e.updating,r=[];for(const n of e.layers){const o="fullExtents"in n&&n.fullExtents||(b(n.fullExtent)?[n.fullExtent]:[]),a=this.requiresExtentInSpatialReference?null:o[0],l=(s=o.find(c=>c.spatialReference.equals(this.spatialReference)))!=null?s:a;if(l)return{candidates:[{extent:l,layer:n}],updating:!1};if(this._getSupportedSpatialReferences(n).length>0)for(const c of o)r.push({extent:c,layer:n})}return{candidates:r,updating:t}}get _extentTask(){const{candidates:e,updating:t}=this._extentCandidatesTask;if(t)return{updating:t};if(R(e)||e.length===0)return{updating:!1};if(!this.spatialReference)return{updating:this._spatialReferenceTask.updating};const r=this._pickExtentCandidate(e),i=this.spatialReference;return r.extent.equals(this._projectExtentTask.input)&&i.equals(this._projectExtentTask.spatialReference)?{extent:this._projectExtentTask.output,updating:b(this._projectExtentTask.task)&&!this._projectExtentTask.task.finished}:(b(this._projectExtentTask.task)&&(this._projectExtentTask.task=Fd(this._projectExtentTask.task)),this._projectExtentTask={input:r.extent.clone(),output:null,spatialReference:i.clone(),task:B$(async s=>{try{const n=await IRe(r.extent,i,r.layer.portalItem,s);this._projectExtentTask={...this._projectExtentTask,task:null,output:n}}catch{if(gn(s))return;this._projectExtentTask={...this._projectExtentTask,task:null}}})},{updating:!0})}_narrowDownSpatialReferenceCandidates(e,t){if(R(e))return t;const r=[],i=(s,n)=>b(s)?b(n)?s===n&&s:s:n;for(const s of e)for(const n of t){if(!s.spatialReference.equals(n.spatialReference))continue;const o=i(s.viewingMode,n.viewingMode);if(o!==!1){r.push({spatialReference:s.spatialReference,viewingMode:o});break}}return r.length>0?r:null}_pickSpatialReferenceCandidate(e){const t=this.defaultSpatialReference;return R(e)||e.length<1?b(t)?{spatialReference:t,viewingMode:null}:null:(b(t)&&e.length>1&&e.some(({spatialReference:r})=>r.equals(t))&&(e=e.filter(({spatialReference:r})=>r.equals(t))),e.length>1&&e.some(({viewingMode:r})=>r!==Be.Local)&&(e=e.filter(({viewingMode:r})=>r!==Be.Local)),e[0])}_getSupportedSpatialReferences(e){const t="supportedSpatialReferences"in e&&e.supportedSpatialReferences||(e.spatialReference?[e.spatialReference]:[]);if(t.length===0)return[];const r=[];for(const i of t){const s=this.getSpatialReferenceSupport({spatialReference:i,layer:e});if(b(s)){const n=b(s.constraints)?s.constraints:[{spatialReference:i,viewingMode:null}];for(const{spatialReference:o,viewingMode:a}of n)(!this.requiresExtentInSpatialReference||R(this.userSpatialReference)||o.equals(this.userSpatialReference))&&r.push({spatialReference:o,viewingMode:a})}}return r}_pickExtentCandidate(e){const t=this.spatialReference;return e.find(({extent:r})=>t.equals(r.spatialReference))||e[0]}_collectLayers(e){var r;if(this._loadMaybe((r=this.map)==null?void 0:r.call(this))!=="loaded")return{layers:[],updating:!0};const t={layers:[],preloading:-1,updating:!1};for(const i of e)if(this._collectCollection(i,t),t.preloading===this.sourcePreloadCount)break;return{layers:t.layers,updating:t.updating}}_collectCollection(e,t){if(e.layers){switch(this._loadMaybe(e.parent)){case"loading":return t.updating=!0,void++t.preloading;case"failed":return}for(const r of e.layers){switch(this._loadMaybe(r)){case"failed":continue;case"loading":t.updating=!0,++t.preloading;break;case"loaded":t.updating||t.layers.push(r),"layers"in r&&this._collectCollection({layers:r.layers},t)}if(t.preloading===this.sourcePreloadCount)break}}}_loadMaybe(e){return e&&"loadStatus"in e?e.loadStatus==="not-loaded"?(e.load(),"loading"):e.loadStatus:"loaded"}};u([d()],Ni.prototype,"required",void 0),u([d({constructOnly:!0})],Ni.prototype,"map",void 0),u([d({constructOnly:!0})],Ni.prototype,"getSpatialReferenceSupport",void 0),u([d()],Ni.prototype,"defaultSpatialReference",void 0),u([d()],Ni.prototype,"userSpatialReference",void 0),u([d()],Ni.prototype,"sourcePreloadCount",void 0),u([d()],Ni.prototype,"priorityCollection",void 0),u([d()],Ni.prototype,"requiresExtentInSpatialReference",void 0),u([d()],Ni.prototype,"suspended",void 0),u([d({readOnly:!0})],Ni.prototype,"ready",null),u([d({readOnly:!0})],Ni.prototype,"heightModelInfoReady",null),u([d({readOnly:!0})],Ni.prototype,"spatialReference",null),u([d({readOnly:!0})],Ni.prototype,"extent",null),u([d({readOnly:!0})],Ni.prototype,"heightModelInfo",null),u([d({readOnly:!0})],Ni.prototype,"vcsWkid",null),u([d({readOnly:!0})],Ni.prototype,"latestVcsWkid",null),u([d({readOnly:!0})],Ni.prototype,"viewingMode",null),u([d({readOnly:!0})],Ni.prototype,"tileInfo",null),u([d({readOnly:!0})],Ni.prototype,"mapCollections",null),u([d({readOnly:!0})],Ni.prototype,"_allLayers",null),u([d({readOnly:!0})],Ni.prototype,"_spatialReferenceTask",null),u([d({readOnly:!0})],Ni.prototype,"_tileInfoTask",null),u([d({readOnly:!0})],Ni.prototype,"_heightModelInfoTask",null),u([d({readOnly:!0})],Ni.prototype,"_extentCandidatesTask",null),u([d()],Ni.prototype,"_extentTask",null),u([d()],Ni.prototype,"_projectExtentTask",void 0),Ni=u([$("esri.views.support.DefaultsFromMap")],Ni);var z5;const yN=fe.getLogger("esri.views.View");let It=z5=class extends pg(ds.EventedMixin(j$(xe))){constructor(e){super(e),this._userSpatialReference=null,this._cursor=null,this.allLayerViews=new QC({getCollections:()=>{var t,r,i;return[(t=this.basemapView)==null?void 0:t.baseLayerViews,(r=this.groundView)==null?void 0:r.layerViews,this.layerViews,(i=this.basemapView)==null?void 0:i.referenceLayerViews]},getChildrenFunction:t=>t.layerViews}),this.groundView=null,this.animation=null,this.basemapView=null,this.fatalError=null,this.extent=null,this.graphics=new cP,this.analyses=new fA,this.navigating=!1,this.typeSpecificPreconditionsReady=!0,this.layerViews=new ot,this.magnifier=new bRe,this.padding={left:0,top:0,right:0,bottom:0},this.ready=!1,this.spatialReferenceWarningDelay=1e3,this.supportsGround=!0,this.timeExtent=null,this.type=null,this.scale=null,this.updating=!1,this.initialExtentRequired=!0,this.input=new Kit,this.navigation=new CRe,this.layerViewManager=null,this.analysisViewManager=null,this.isHeightModelInfoRequired=!1,this.width=null,this.height=null,this.resizing=!1,this.suspended=!1,this.viewEvents=new Bit(this),this.persistableViewModels=new ot,this._isValid=!1,this._readyCycleForced=!1,this.handles.add(te(()=>this.preconditionsReady,t=>{var r,i;t?(this._currentSpatialReference=this.spatialReference,z5.views.add(this)):(this._currentSpatialReference=null,z5.views.remove(this)),this.notifyChange("spatialReference"),!t&&this.ready?((r=this.layerViewManager)==null||r.clear(),(i=this.toolViewManager)==null||i.detach(),b(this.analysisViewManager)&&this.analysisViewManager.detach(),this._teardown()):t&&!this.ready&&(this._startup(),b(this.analysisViewManager)&&this.analysisViewManager.attach(),this.toolViewManager.attach())},ei))}initialize(){this.addResolvingPromise(this.validate().then(()=>(this._isValid=!0,E1(()=>this.ready)))),this.basemapView=new Xv({view:this}),this.layerViewManager=new Dit({view:this,layerViewImporter:{importLayerView:e=>this.importLayerView(e),hasLayerViewModule:e=>this.hasLayerViewModule(e)},supportsGround:this.supportsGround}),this.toolViewManager=new Zit({view:this}),this._setupSpatialReferenceLogger(),this.handles.add([te(()=>this.initialExtentRequired,e=>this.defaultsFromMap.required={...this.defaultsFromMap.required,extent:e},{sync:!0,initial:!0}),te(()=>this.ready,e=>{this.defaultsFromMap&&(this.defaultsFromMap.suspended=e,this.defaultsFromMap.userSpatialReference=e?this.spatialReference:this._userSpatialReference)},{sync:!0}),te(()=>this._userSpatialReference,e=>{this.defaultsFromMap&&(this.defaultsFromMap.userSpatialReference=e)},{sync:!0,initial:!0})])}_setupSpatialReferenceLogger(){let e=null;this.handles.add([te(()=>{var t;return(t=this.defaultsFromMap)==null?void 0:t.ready},t=>{var i;const r=((i=this.map)==null?void 0:i.allLayers.length)>0;if(t&&!this.spatialReference&&r){if(b(e))return;const s=kd(()=>e=Fd(e));e=B$(async n=>{try{await BC(this.spatialReferenceWarningDelay,null,n)}catch{return}finally{e=null}yN.warn("#spatialReference","no spatial reference could be derived from the currently added map layers")}),this.handles.add(s,"spatial-reference-logger-task")}else this.handles.remove("spatial-reference-logger-task")},{sync:!0})])}destroy(){if(this.destroyed)return;this.viewEvents.destroy(),this.allLayerViews.destroy(),this.navigation&&(this.navigation.destroy(),this._set("navigation",null)),this.graphics=ct(this.graphics),this.analyses=ct(this.analyses),this.handles.remove("defaultsFromMap"),this.defaultsFromMap.destroy(),this._set("defaultsFromMap",null),ct(this.analysisViewManager),this.toolViewManager=ct(this.toolViewManager),this.layerViewManager=ct(this.layerViewManager),this.basemapView=ct(this.basemapView),this.invalidate(),this._emitter.clear(),this.handles.removeAll();const e=this.map;this.map=null,e==null||e.destroy()}_startup(){this._set("ready",!0)}_teardown(){this._set("ready",!1)}whenReady(){return Promise.resolve(this)}toMap(){return yN.error("#toMap()","Not implemented on this instance of View"),null}get _defaultsFromMapSettings(){return{}}get defaultsFromMap(){return new Ni({required:{tileInfo:!1,heightModelInfo:!1,extent:!1},map:()=>this.map,getSpatialReferenceSupport:e=>this.getSpatialReferenceSupport(e),...this._defaultsFromMapSettings})}get heightModelInfo(){return this.getDefaultHeightModelInfo()}get interacting(){return this.navigating}get preconditionsReady(){var e;return!(this.fatalError||!this._isValid||this._readyCycleForced||!this.map||gh.isLoadable(this.map)&&!this.map.loaded||this.width===0||this.height===0||!this.spatialReference||!this._validateSpatialReference(this.spatialReference)||!this._currentSpatialReference&&!((e=this.defaultsFromMap)!=null&&e.ready)||!this.typeSpecificPreconditionsReady)}set map(e){e!==this._get("map")&&(e!=null&&e.destroyed&&(yN.warn("#map","The provided map is already destroyed",{map:e}),e=null),gh.isLoadable(e)&&e.load().catch(()=>{}),this.initialized&&(this.forceReadyCycle(),this._currentSpatialReference=null),this._set("map",e))}get spatialReference(){var t,r;let e=this._userSpatialReference||this._currentSpatialReference||this.getDefaultSpatialReference()||null;return e&&((r=(t=this.defaultsFromMap)==null?void 0:t.required)==null?void 0:r.heightModelInfo)&&(e=e.clone(),e.vcsWkid=this.defaultsFromMap.vcsWkid,e.latestVcsWkid=this.defaultsFromMap.latestVcsWkid),e}set spatialReference(e){const t=!ml(e,this._get("spatialReference"));this._set("_userSpatialReference",e),t&&(this._set("spatialReference",e),this._spatialReferenceChanged(e))}_spatialReferenceChanged(e){}get stationary(){return!this.animation&&!this.navigating&&!this.resizing}get initialExtent(){var e;return(e=this.defaultsFromMap)==null?void 0:e.extent}get cursor(){const e=this.toolViewManager?this.toolViewManager.cursor:null;return b(e)?e:this._cursor||"default"}set cursor(e){this._cursor=e,this.notifyChange("cursor")}get size(){return[this.width,this.height]}whenLayerView(e){return this.layerViewManager.whenLayerView(e)}getDefaultSpatialReference(){var e;return(e=this.defaultsFromMap)==null?void 0:e.spatialReference}getDefaultHeightModelInfo(){var e,t,r;return(r=(t=this.map&&"heightModelInfo"in this.map?this.map.heightModelInfo:void 0)!=null?t:(e=this.defaultsFromMap)==null?void 0:e.heightModelInfo)!=null?r:null}importLayerView(e){throw new j("importLayerView() not implemented")}hasLayerViewModule(e){return!1}async validate(){}invalidate(){this._isValid=!1}getSpatialReferenceSupport(){return{constraints:null}}_validateSpatialReference(e){return b(this.getSpatialReferenceSupport({spatialReference:e}))}when(e,t){return this.isResolved()&&!this.ready&&yN.warn("#when()","Calling view.when() while the view is no longer ready but was already resolved once will resolve immediately. Use reactiveUtils.whenOnce(() => view.ready).then(...) instead."),super.when(e,t)}forceReadyCycle(){this.ready&&(Lo(()=>this.preconditionsReady===!1,()=>this._readyCycleForced=!1,{once:!0}),this._readyCycleForced=!0)}addAndActivateTool(e){this.toolViewManager.tools.add(e),this.activeTool=e}tryFatalErrorRecovery(){this.fatalError=null}};It.views=new ot,u([d()],It.prototype,"_userSpatialReference",void 0),u([We("toolViewManager.activeTool")],It.prototype,"activeTool",void 0),u([d({readOnly:!0})],It.prototype,"allLayerViews",void 0),u([d()],It.prototype,"groundView",void 0),u([d()],It.prototype,"animation",void 0),u([d()],It.prototype,"basemapView",void 0),u([d({readOnly:!0})],It.prototype,"_defaultsFromMapSettings",null),u([d()],It.prototype,"defaultsFromMap",null),u([d()],It.prototype,"fatalError",void 0),u([d({type:Kt})],It.prototype,"extent",void 0),u([d(bX(cP,"graphics"))],It.prototype,"graphics",void 0),u([d(bX(fA,"analyses"))],It.prototype,"analyses",void 0),u([d({readOnly:!0,type:QT})],It.prototype,"heightModelInfo",null),u([d({readOnly:!0})],It.prototype,"interacting",null),u([d({readOnly:!0})],It.prototype,"navigating",void 0),u([d({readOnly:!0,dependsOn:["fatalError","_isValid","_readyCycleForced","map","map.loaded?","width","height","spatialReference","_currentSpatialReference","defaultsFromMap.ready","typeSpecificPreconditionsReady"]})],It.prototype,"preconditionsReady",null),u([d({readOnly:!0})],It.prototype,"typeSpecificPreconditionsReady",void 0),u([d({type:ot,readOnly:!0})],It.prototype,"layerViews",void 0),u([d({type:bRe})],It.prototype,"magnifier",void 0),u([d({value:null,type:vwe})],It.prototype,"map",null),u([d()],It.prototype,"padding",void 0),u([d({readOnly:!0})],It.prototype,"ready",void 0),u([d({type:Ze})],It.prototype,"spatialReference",null),u([d()],It.prototype,"spatialReferenceWarningDelay",void 0),u([d()],It.prototype,"stationary",null),u([d({readOnly:!0})],It.prototype,"supportsGround",void 0),u([d({type:vg})],It.prototype,"timeExtent",void 0),u([We("toolViewManager.tools")],It.prototype,"tools",void 0),u([d()],It.prototype,"toolViewManager",void 0),u([d({readOnly:!0})],It.prototype,"type",void 0),u([d({type:Number})],It.prototype,"scale",void 0),u([d({readOnly:!0})],It.prototype,"updating",void 0),u([d({readOnly:!0})],It.prototype,"initialExtentRequired",void 0),u([d({readOnly:!0})],It.prototype,"initialExtent",null),u([d()],It.prototype,"cursor",null),u([d({readOnly:!0})],It.prototype,"input",void 0),u([d({type:CRe,nonNullable:!0})],It.prototype,"navigation",void 0),u([d()],It.prototype,"layerViewManager",void 0),u([d()],It.prototype,"analysisViewManager",void 0),u([d()],It.prototype,"width",void 0),u([d()],It.prototype,"height",void 0),u([d({readOnly:!0})],It.prototype,"resizing",void 0),u([d({value:null,readOnly:!0})],It.prototype,"size",null),u([d({readOnly:!0})],It.prototype,"suspended",void 0),u([d({readOnly:!0})],It.prototype,"viewEvents",void 0),u([d({readOnly:!0})],It.prototype,"persistableViewModels",void 0),u([d()],It.prototype,"_isValid",void 0),u([d()],It.prototype,"_readyCycleForced",void 0),u([d()],It.prototype,"_currentSpatialReference",void 0),It=z5=u([$("esri.views.View")],It);const nst=It;let Yv=class extends _U{constructor(e){super(e),this.state="running",this.target=null}initialize(){this.addResolvingPromise(new Promise((e,t)=>this._dfd={resolve:e,reject:t}))}get done(){return this.state==="finished"||this.state==="stopped"}stop(){this.state!=="stopped"&&this.state!=="finished"&&(this._set("state","stopped"),this._dfd.reject(new j("ViewAnimation stopped")))}finish(){this.state!=="stopped"&&this.state!=="finished"&&(this._set("state","finished"),this._dfd.resolve())}update(e,t){t||(t=Ch(e)?"waiting-for-target":"running"),this._set("target",e),this._set("state",t)}};u([d({readOnly:!0})],Yv.prototype,"done",null),u([d({readOnly:!0,type:String})],Yv.prototype,"state",void 0),u([d()],Yv.prototype,"target",void 0),Yv=u([$("esri.views.ViewAnimation")],Yv),function(e){e.State={RUNNING:"running",STOPPED:"stopped",FINISHED:"finished",WAITING_FOR_TARGET:"waiting-for-target"}}(Yv||(Yv={}));const xA=Yv,dO=()=>ie(()=>import("./TileLayerView3D.4867d47f.js"),["TileLayerView3D.4867d47f.js","LayerView3D.f2ff891e.js","TiledLayerView3D.8028357a.js","LayerView.93cef2a0.js","RefreshableLayerView.faed2da7.js","clickToleranceUtils.dc236802.js","drapedUtils.c3220d2e.js"],import.meta.url),Yhe=()=>ie(()=>import("./ElevationLayerView3D.678a9dd7.js"),["ElevationLayerView3D.678a9dd7.js","LayerView3D.f2ff891e.js","TiledLayerView3D.8028357a.js","LayerView.93cef2a0.js"],import.meta.url),Qhe={"base-dynamic":()=>ie(()=>import("./BaseDynamicLayerView3D.a74b93f2.js"),["BaseDynamicLayerView3D.a74b93f2.js","DynamicLayerView3D.5735c4a0.js","LayerView3D.f2ff891e.js","projectExtentUtils.84613448.js","ImageMaterial.76178402.js","LayerView.93cef2a0.js","RefreshableLayerView.faed2da7.js"],import.meta.url),"base-elevation":Yhe,"base-tile":dO,"bing-maps":dO,"building-scene":()=>ie(()=>import("./BuildingSceneLayerView3D.58788cf2.js"),["BuildingSceneLayerView3D.58788cf2.js","BuildingGroupSublayer.29e15b94.js","BuildingComponentSublayer.bb0fcd7a.js","WhereClause.c395dc79.js","I3SMeshView3D.da104237.js","I3SAttributeOverrides.1198a2c1.js","I3SNode.08c44e8c.js","SceneModification.cfa8b2b2.js","Graphics3DScaleVisibility.935d1efb.js","optimizedFeatureQueryEngineAdapter.ccd4095f.js","centroid.b6fe1cdb.js","PooledRBush.240e2876.js","quickselect.bb286034.js","SceneLayerWorker.cb4f9617.js","attributeUtils.72e006d3.js","I3SQueryFeatureStore.4691f3dd.js","QueryEngine.b68da516.js","QueryEngineResult.9885fa73.js","utils.5e3fd577.js","ClassBreaksDefinition.c5cbbd6d.js","json.8bd707cf.js","DefinitionExpressionSceneLayerView.55c0d7ea.js","popupUtils.bf30376b.js","LayerView3D.f2ff891e.js","LayerView.93cef2a0.js"],import.meta.url),csv:()=>ie(()=>import("./CSVLayerView3D.73e1af93.js"),["CSVLayerView3D.73e1af93.js","FeatureLayerViewBase3D.9c952de8.js","FeatureLikeLayerView3D.dce5c1bd.js","dehydratedFeatureComparison.46ca5791.js","Graphics3DFeatureProcessor.afe5de96.js","Graphics3DScaleVisibility.935d1efb.js","optimizedFeatureQueryEngineAdapter.ccd4095f.js","centroid.b6fe1cdb.js","PooledRBush.240e2876.js","quickselect.bb286034.js","Graphics3DObjectStates.f45b9ab1.js","QueryEngine.b68da516.js","QueryEngineResult.9885fa73.js","WhereClause.c395dc79.js","utils.5e3fd577.js","ClassBreaksDefinition.c5cbbd6d.js","json.8bd707cf.js","attributeUtils.72e006d3.js","FeatureStore.4f146d77.js","projectExtentUtils.84613448.js","LayerView3D.f2ff891e.js","EventedSet.73d8b515.js","popupUtils.bf30376b.js","LayerView.93cef2a0.js","RefreshableLayerView.faed2da7.js"],import.meta.url),elevation:Yhe,feature:()=>ie(()=>import("./FeatureLayerView3D.1f05af55.js"),["FeatureLayerView3D.1f05af55.js","FeatureLayerViewBase3D.9c952de8.js","FeatureLikeLayerView3D.dce5c1bd.js","dehydratedFeatureComparison.46ca5791.js","Graphics3DFeatureProcessor.afe5de96.js","Graphics3DScaleVisibility.935d1efb.js","optimizedFeatureQueryEngineAdapter.ccd4095f.js","centroid.b6fe1cdb.js","PooledRBush.240e2876.js","quickselect.bb286034.js","Graphics3DObjectStates.f45b9ab1.js","QueryEngine.b68da516.js","QueryEngineResult.9885fa73.js","WhereClause.c395dc79.js","utils.5e3fd577.js","ClassBreaksDefinition.c5cbbd6d.js","json.8bd707cf.js","attributeUtils.72e006d3.js","FeatureStore.4f146d77.js","projectExtentUtils.84613448.js","LayerView3D.f2ff891e.js","EventedSet.73d8b515.js","popupUtils.bf30376b.js","LayerView.93cef2a0.js","RefreshableLayerView.faed2da7.js"],import.meta.url),geojson:()=>ie(()=>import("./GeoJSONLayerView3D.61e5e15b.js"),["GeoJSONLayerView3D.61e5e15b.js","FeatureLayerViewBase3D.9c952de8.js","FeatureLikeLayerView3D.dce5c1bd.js","dehydratedFeatureComparison.46ca5791.js","Graphics3DFeatureProcessor.afe5de96.js","Graphics3DScaleVisibility.935d1efb.js","optimizedFeatureQueryEngineAdapter.ccd4095f.js","centroid.b6fe1cdb.js","PooledRBush.240e2876.js","quickselect.bb286034.js","Graphics3DObjectStates.f45b9ab1.js","QueryEngine.b68da516.js","QueryEngineResult.9885fa73.js","WhereClause.c395dc79.js","utils.5e3fd577.js","ClassBreaksDefinition.c5cbbd6d.js","json.8bd707cf.js","attributeUtils.72e006d3.js","FeatureStore.4f146d77.js","projectExtentUtils.84613448.js","LayerView3D.f2ff891e.js","EventedSet.73d8b515.js","popupUtils.bf30376b.js","LayerView.93cef2a0.js","RefreshableLayerView.faed2da7.js"],import.meta.url),graphics:()=>ie(()=>import("./GraphicsLayerView3D.1cac9b6c.js"),["GraphicsLayerView3D.1cac9b6c.js","LayerView3D.f2ff891e.js","GraphicsProcessor.281b3aff.js","Graphics3DScaleVisibility.935d1efb.js","optimizedFeatureQueryEngineAdapter.ccd4095f.js","centroid.b6fe1cdb.js","PooledRBush.240e2876.js","quickselect.bb286034.js","Graphics3DObjectStates.f45b9ab1.js","projectExtentUtils.84613448.js","LayerView.93cef2a0.js"],import.meta.url),group:()=>ie(()=>import("./GroupLayerView.9c4f6d44.js"),["GroupLayerView.9c4f6d44.js","LayerView.93cef2a0.js"],import.meta.url),imagery:()=>ie(()=>import("./ImageryLayerView3D.76743aba.js"),["ImageryLayerView3D.76743aba.js","DynamicLayerView3D.5735c4a0.js","LayerView3D.f2ff891e.js","projectExtentUtils.84613448.js","ImageMaterial.76178402.js","LayerView.93cef2a0.js","RefreshableLayerView.faed2da7.js","popupUtils.bf30376b.js"],import.meta.url),"integrated-mesh":()=>ie(()=>import("./IntegratedMeshLayerView3D.7c9c3ea6.js"),["IntegratedMeshLayerView3D.7c9c3ea6.js","I3SMeshView3D.da104237.js","I3SAttributeOverrides.1198a2c1.js","I3SNode.08c44e8c.js","SceneModification.cfa8b2b2.js","Graphics3DScaleVisibility.935d1efb.js","optimizedFeatureQueryEngineAdapter.ccd4095f.js","centroid.b6fe1cdb.js","PooledRBush.240e2876.js","quickselect.bb286034.js","SceneLayerWorker.cb4f9617.js","attributeUtils.72e006d3.js","LayerView3D.f2ff891e.js","LayerView.93cef2a0.js"],import.meta.url),"line-of-sight":()=>ie(()=>import("./LineOfSightLayerView3D.e55b92c0.js"),["LineOfSightLayerView3D.e55b92c0.js","LayerView3D.f2ff891e.js","LayerView.93cef2a0.js"],import.meta.url),"map-image":()=>ie(()=>import("./MapImageLayerView3D.5ccb7064.js"),["MapImageLayerView3D.5ccb7064.js","DynamicLayerView3D.5735c4a0.js","LayerView3D.f2ff891e.js","projectExtentUtils.84613448.js","ImageMaterial.76178402.js","LayerView.93cef2a0.js","RefreshableLayerView.faed2da7.js","clickToleranceUtils.dc236802.js","popupUtils.bf30376b.js","drapedUtils.c3220d2e.js"],import.meta.url),media:()=>ie(()=>import("./MediaLayerView3D.8803028c.js"),["MediaLayerView3D.8803028c.js","normalizeUtilsSync.dda81a4f.js","LayerView3D.f2ff891e.js","ImageMaterial.76178402.js","LayerView.93cef2a0.js"],import.meta.url),"ogc-feature":()=>ie(()=>import("./OGCFeatureLayerView3D.c6e56319.js"),["OGCFeatureLayerView3D.c6e56319.js","FeatureLayerViewBase3D.9c952de8.js","FeatureLikeLayerView3D.dce5c1bd.js","dehydratedFeatureComparison.46ca5791.js","Graphics3DFeatureProcessor.afe5de96.js","Graphics3DScaleVisibility.935d1efb.js","optimizedFeatureQueryEngineAdapter.ccd4095f.js","centroid.b6fe1cdb.js","PooledRBush.240e2876.js","quickselect.bb286034.js","Graphics3DObjectStates.f45b9ab1.js","QueryEngine.b68da516.js","QueryEngineResult.9885fa73.js","WhereClause.c395dc79.js","utils.5e3fd577.js","ClassBreaksDefinition.c5cbbd6d.js","json.8bd707cf.js","attributeUtils.72e006d3.js","FeatureStore.4f146d77.js","projectExtentUtils.84613448.js","LayerView3D.f2ff891e.js","EventedSet.73d8b515.js","popupUtils.bf30376b.js","LayerView.93cef2a0.js","RefreshableLayerView.faed2da7.js"],import.meta.url),"open-street-map":dO,"point-cloud":()=>ie(()=>import("./PointCloudLayerView3D.686b19d3.js").then(e=>e.P),["PointCloudLayerView3D.686b19d3.js","LayerView3D.f2ff891e.js","PointCloudWorkerUtil.18a1e061.js","PointCloudUniqueValueRenderer.5b4c7434.js","PopupSceneLayerView.e5cff50b.js","popupUtils.bf30376b.js","LayerView.93cef2a0.js"],import.meta.url),voxel:()=>ie(()=>import("./VoxelLayerView3D.221cce10.js"),["VoxelLayerView3D.221cce10.js","LayerView3D.f2ff891e.js","LayerView.93cef2a0.js"],import.meta.url),route:()=>ie(()=>import("./RouteLayerView3D.e5374e0f.js"),["RouteLayerView3D.e5374e0f.js","Stop.94a0c1e0.js","LayerView3D.f2ff891e.js","GraphicsProcessor.281b3aff.js","Graphics3DScaleVisibility.935d1efb.js","optimizedFeatureQueryEngineAdapter.ccd4095f.js","centroid.b6fe1cdb.js","PooledRBush.240e2876.js","quickselect.bb286034.js","Graphics3DObjectStates.f45b9ab1.js","projectExtentUtils.84613448.js","EventedSet.73d8b515.js","LayerView.93cef2a0.js"],import.meta.url),scene:e=>e.profile==null||e.profile==="mesh-pyramids"?ie(()=>import("./SceneLayerView3D.a3ab3217.js"),["SceneLayerView3D.a3ab3217.js","WhereClause.c395dc79.js","I3SMeshView3D.da104237.js","I3SAttributeOverrides.1198a2c1.js","I3SNode.08c44e8c.js","SceneModification.cfa8b2b2.js","Graphics3DScaleVisibility.935d1efb.js","optimizedFeatureQueryEngineAdapter.ccd4095f.js","centroid.b6fe1cdb.js","PooledRBush.240e2876.js","quickselect.bb286034.js","SceneLayerWorker.cb4f9617.js","attributeUtils.72e006d3.js","LayerView3D.f2ff891e.js","SceneLayerView.17a1bff4.js","LayerView.93cef2a0.js","I3SQueryFeatureStore.4691f3dd.js","QueryEngine.b68da516.js","QueryEngineResult.9885fa73.js","utils.5e3fd577.js","ClassBreaksDefinition.c5cbbd6d.js","json.8bd707cf.js","DefinitionExpressionSceneLayerView.55c0d7ea.js","PopupSceneLayerView.e5cff50b.js","popupUtils.bf30376b.js"],import.meta.url):ie(()=>import("./SceneLayerGraphicsView3D.aa23329d.js"),["SceneLayerGraphicsView3D.aa23329d.js","I3SAttributeOverrides.1198a2c1.js","I3SNode.08c44e8c.js","LayerView3D.f2ff891e.js","Graphics3DFeatureProcessor.afe5de96.js","Graphics3DScaleVisibility.935d1efb.js","optimizedFeatureQueryEngineAdapter.ccd4095f.js","centroid.b6fe1cdb.js","PooledRBush.240e2876.js","quickselect.bb286034.js","Graphics3DObjectStates.f45b9ab1.js","QueryEngine.b68da516.js","QueryEngineResult.9885fa73.js","WhereClause.c395dc79.js","utils.5e3fd577.js","ClassBreaksDefinition.c5cbbd6d.js","json.8bd707cf.js","attributeUtils.72e006d3.js","SceneLayerView.17a1bff4.js","LayerView.93cef2a0.js","DefinitionExpressionSceneLayerView.55c0d7ea.js","PopupSceneLayerView.e5cff50b.js","popupUtils.bf30376b.js"],import.meta.url),stream:()=>ie(()=>import("./StreamLayerView3D.179fe3f4.js"),["StreamLayerView3D.179fe3f4.js","createConnection.b247cd1a.js","EventedSet.73d8b515.js","FeatureLikeLayerView3D.dce5c1bd.js","dehydratedFeatureComparison.46ca5791.js","Graphics3DFeatureProcessor.afe5de96.js","Graphics3DScaleVisibility.935d1efb.js","optimizedFeatureQueryEngineAdapter.ccd4095f.js","centroid.b6fe1cdb.js","PooledRBush.240e2876.js","quickselect.bb286034.js","Graphics3DObjectStates.f45b9ab1.js","QueryEngine.b68da516.js","QueryEngineResult.9885fa73.js","WhereClause.c395dc79.js","utils.5e3fd577.js","ClassBreaksDefinition.c5cbbd6d.js","json.8bd707cf.js","attributeUtils.72e006d3.js","FeatureStore.4f146d77.js","projectExtentUtils.84613448.js","LayerView3D.f2ff891e.js","LayerView.93cef2a0.js"],import.meta.url),tile:dO,"imagery-tile":()=>ie(()=>import("./ImageryTileLayerView3D.755b6053.js"),["ImageryTileLayerView3D.755b6053.js","LayerView3D.f2ff891e.js","TiledLayerView3D.8028357a.js","rasterProjectionHelper.636b7cf7.js","popupUtils.bf30376b.js","LayerView.93cef2a0.js","RefreshableLayerView.faed2da7.js","drapedUtils.c3220d2e.js"],import.meta.url),"vector-tile":()=>ie(()=>import("./VectorTileLayerView3D.234194f8.js"),["VectorTileLayerView3D.234194f8.js","GeometryUtils.2547656a.js","CIMSymbolHelper.0e25a568.js","BidiEngine.210f7ff8.js","enums.4de5fe56.js","number.6e30c64a.js","StyleRepository.759ba6c0.js","Geometry.f2d62961.js","PixelBlock.a3ab9bb3.js","Utils.34c984b0.js","MaterialKey.d151146e.js","LayerView3D.f2ff891e.js","TiledLayerView3D.8028357a.js","LayerView.93cef2a0.js"],import.meta.url),wcs:()=>ie(()=>import("./ImageryTileLayerView3D.755b6053.js"),["ImageryTileLayerView3D.755b6053.js","LayerView3D.f2ff891e.js","TiledLayerView3D.8028357a.js","rasterProjectionHelper.636b7cf7.js","popupUtils.bf30376b.js","LayerView.93cef2a0.js","RefreshableLayerView.faed2da7.js","drapedUtils.c3220d2e.js"],import.meta.url),"web-tile":dO,wfs:()=>ie(()=>import("./WFSLayerView3D.1e4fb3e0.js"),["WFSLayerView3D.1e4fb3e0.js","FeatureLayerViewBase3D.9c952de8.js","FeatureLikeLayerView3D.dce5c1bd.js","dehydratedFeatureComparison.46ca5791.js","Graphics3DFeatureProcessor.afe5de96.js","Graphics3DScaleVisibility.935d1efb.js","optimizedFeatureQueryEngineAdapter.ccd4095f.js","centroid.b6fe1cdb.js","PooledRBush.240e2876.js","quickselect.bb286034.js","Graphics3DObjectStates.f45b9ab1.js","QueryEngine.b68da516.js","QueryEngineResult.9885fa73.js","WhereClause.c395dc79.js","utils.5e3fd577.js","ClassBreaksDefinition.c5cbbd6d.js","json.8bd707cf.js","attributeUtils.72e006d3.js","FeatureStore.4f146d77.js","projectExtentUtils.84613448.js","LayerView3D.f2ff891e.js","EventedSet.73d8b515.js","popupUtils.bf30376b.js","LayerView.93cef2a0.js","RefreshableLayerView.faed2da7.js"],import.meta.url),wms:()=>ie(()=>import("./WMSLayerView3D.75ffc063.js"),["WMSLayerView3D.75ffc063.js","DynamicLayerView3D.5735c4a0.js","LayerView3D.f2ff891e.js","projectExtentUtils.84613448.js","ImageMaterial.76178402.js","LayerView.93cef2a0.js","RefreshableLayerView.faed2da7.js","ExportWMSImageParameters.1a93b0d7.js"],import.meta.url),wmts:()=>ie(()=>import("./WMTSLayerView3D.ebc99088.js"),["WMTSLayerView3D.ebc99088.js","LayerView3D.f2ff891e.js","TiledLayerView3D.8028357a.js","LayerView.93cef2a0.js","RefreshableLayerView.faed2da7.js"],import.meta.url),"geo-rss":null,kml:null,"map-notes":null,"subtype-group":null,unknown:null,unsupported:null};function ost(e){const t=e.declaredClass?e.declaredClass.slice(e.declaredClass.lastIndexOf(".")+1):"Unknown",r=t.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase();return new j(`${r}:view-not-supported`,`${t} is not supported in 3D`)}const Jhe={hasLayerViewModule:e=>b(Qhe[e.type]),importLayerView:e=>{const t=Qhe[e.type];if(R(t))throw ost(e);return t(e)}},ast=fe.getLogger("esri.views.3d.analysis.AnalysisViewManager3D"),Khe="analyses-owner-handles";var NE,tx;(function(e){e[e.PENDING=0]="PENDING",e[e.CREATED=1]="CREATED"})(NE||(NE={})),function(e){e[e.ADDED=0]="ADDED",e[e.REMOVED=1]="REMOVED"}(tx||(tx={}));let Ew=class extends YC{constructor(e){super(e),this._allAnalysisViews=new ot,this._creatingViewCount=0,this._items=new Map,this._scheduledUpdateHandle=null,this._attachedToViewResolver=vf(),this._analysisModules={"area-measurement":{module:null},dimensioning:{module:null},"direct-line-measurement":{module:null},"line-of-sight":{module:null},slice:{module:null}}}destroy(){this._disconnectOwners(),this._attachedToViewResolver.reject(gr("AnalysisViewManager was destroyed"))}attach(){this._connectOwners(),this._attachedToViewResolver.resolve()}detach(){this._disconnectOwners(),this._attachedToViewResolver.reject(gr()),this._attachedToViewResolver=vf(),this._attachedToViewResolver.promise.catch(()=>{})}get updating(){return!this.view.ready||this._creatingViewCount!==0||this._allAnalysisViews.some(e=>e.updating)}get testInfo(){return{allAnalysisViews:this._allAnalysisViews}}async whenAnalysisView(e){await this._attachedToViewResolver.promise;const t=this._items.get(e);if(R(t)||t.state.list===tx.REMOVED)throw new j("AnalysisViewManager:no-analysisview-for-analysis","The analysis has not been added to view.analyses",{analysis:e});return t.createAnalysisViewTask.promise}_connectOwners(){this.handles.add(this._connectAnalysesCollection(this.view.analyses),Khe)}_disconnectOwners(){this.handles.remove(Khe),this._update(),this._creatingViewCount=0}_connectAnalysesCollection(e){for(const i of e)this._addAnalysis(i);const t=e.on("after-add",i=>this._addAnalysis(i.item)),r=e.on("after-remove",i=>this._removeAnalysis(i.item));return{remove:()=>{t.remove(),r.remove();for(const i of e)this._removeAnalysis(i)}}}_addAnalysis(e){const t=this._items.get(e);if(t==null){const r={state:{view:NE.PENDING,list:tx.ADDED},analysis:e,view:null,createAnalysisViewTask:null};this._items.set(e,r),r.createAnalysisViewTask=B$(i=>this._createAnalysisViewPromise(r,i))}else t.state.list=tx.ADDED}_removeAnalysis(e){const t=this._items.get(e);t!=null?(t.state.list=tx.REMOVED,this._scheduleUpdate()):ast.error("Trying to remove analysis which was not added")}_scheduleUpdate(){b(this._scheduledUpdateHandle)||(this._scheduledUpdateHandle=iR(()=>this._update()))}_update(){this._scheduledUpdateHandle=wn(this._scheduledUpdateHandle),this._items.forEach(e=>{if(e.state.list===tx.REMOVED)switch(this._items.delete(e.analysis),e.state.view){case NE.PENDING:e.createAnalysisViewTask=Fd(e.createAnalysisViewTask);break;case NE.CREATED:b(e.view)&&(this._allAnalysisViews.remove(e.view),e.view=ct(e.view),e.createAnalysisViewTask=null)}})}async _createAnalysisViewPromise(e,t){const r=e.analysis,i=r.type,s=this._analysisModules[i];if(this._creatingViewCount+=1,R(s.module))try{s.module=await this._loadAnalysisModule(i)}catch(o){throw this._creatingViewCount-=1,o}if(gn(t))throw this._creatingViewCount-=1,gr("AnalysisView creation aborted");const n=new s.module.default({analysis:r,view:this.view});try{await n.when()}catch(o){throw this._creatingViewCount-=1,o}if(gn(t))throw this._creatingViewCount-=1,n.destroy(),gr("AnalysisView creation aborted");return e.view=n,e.state.view=NE.CREATED,this._allAnalysisViews.add(n),this._creatingViewCount-=1,n}_loadAnalysisModule(e){switch(e){case"area-measurement":return ie(()=>import("./AreaMeasurementAnalysisView3D.24712b8b.js").then(t=>t.A),["AreaMeasurementAnalysisView3D.24712b8b.js","quantityFormatUtils.d58f5550.js","Segment.b7f04993.js","LineVisualElement.b68e53b8.js","elevationInfoUtils.0270f3ac.js","geometryEngine.59935bf0.js","geometryEngineBase.0f0d7ecf.js","hydrated.c9acaaf8.js","projectionUtils.49303302.js","EditGeometryOperations.c1c61fdd.js"],import.meta.url);case"dimensioning":return ie(()=>import("./DimensioningAnalysisView3D.0d19a91f.js").then(t=>t.D),["DimensioningAnalysisView3D.0d19a91f.js","LineVisualElement.b68e53b8.js","analysisViewUtils.c0225204.js","PointVisualElement.9db464f6.js","RightAngleQuadVisualElement.0132a60f.js","Segment.b7f04993.js","elevationInfoUtils.0270f3ac.js","dragEventPipeline3D.92efcf93.js","EditGeometryOperations.c1c61fdd.js","QueryEngineResult.9885fa73.js","WhereClause.c395dc79.js","utils.5e3fd577.js","ClassBreaksDefinition.c5cbbd6d.js","json.8bd707cf.js","dehydratedFeatureComparison.46ca5791.js"],import.meta.url);case"direct-line-measurement":return ie(()=>import("./DirectLineMeasurementAnalysisView3D.eeb80152.js").then(t=>t.D),["DirectLineMeasurementAnalysisView3D.eeb80152.js","quantityFormatUtils.d58f5550.js","Segment.b7f04993.js","LineVisualElement.b68e53b8.js","elevationInfoUtils.0270f3ac.js","geometryEngine.59935bf0.js","geometryEngineBase.0f0d7ecf.js","hydrated.c9acaaf8.js","projectionUtils.49303302.js","RightAngleQuadVisualElement.0132a60f.js"],import.meta.url);case"line-of-sight":return ie(()=>import("./LineOfSightAnalysisView3D.fcd5bec1.js"),["LineOfSightAnalysisView3D.fcd5bec1.js","LineVisualElement.b68e53b8.js","LineOfSightAnalysisTarget.2950d8eb.js","elevationInfoUtils.0270f3ac.js","projectionUtils.49303302.js","analysisViewUtils.c0225204.js","PointVisualElement.9db464f6.js"],import.meta.url);case"slice":return ie(()=>import("./SliceAnalysisView3D.41bd2a2c.js").then(t=>t.S),["SliceAnalysisView3D.41bd2a2c.js","LineVisualElement.b68e53b8.js","BuildingComponentSublayer.bb0fcd7a.js","projectionUtils.49303302.js","analysisViewUtils.c0225204.js","ImageMaterial.76178402.js","dragEventPipeline3D.92efcf93.js"],import.meta.url)}}};u([d()],Ew.prototype,"updating",null),u([d({constructOnly:!0})],Ew.prototype,"view",void 0),u([d()],Ew.prototype,"_allAnalysisViews",void 0),u([d()],Ew.prototype,"_creatingViewCount",void 0),Ew=u([$("esri.views.3d.analysis.AnalysisViewManager3D")],Ew);const lst=Ew,cst=fe.getLogger("esri.views.3d.state.Constraints");let sy=class extends xe{constructor(e){super(e),this.collision=new r3,this.distance=1/0,this.minimumPoiDistance=4}get altitude(){return this.mode===Be.Local?null:this._get("altitude")||null}set altitude(e){this.mode!==Be.Local?this._set("altitude",e):cst.warn("Altitude constraint is ignored in local scenes")}clampAltitude(e){return this.altitude?Le(e,this.altitude.min,this.altitude.max):e}clampTilt(e,t){if(!this.tilt)return t;const r=this.tilt(e);return Le(t,r.min,r.max)}clampDistance(e){return Math.min(e,this.distance)}createDefaultTilt(){return this.mode===Be.Local?this._createDefaultTiltLocal():this._createDefaultTiltGlobal()}createConstantMaxTilt(e){return(t,r=JG)=>(r.min=Qo.min,r.max=e,r)}_createDefaultTiltLocal(){const e=this.collision.enabled?l5([[4e3,Qo.max],[1e4,Ft(88)],[6e6,Ft(88)]]):()=>Qo.max;return(t,r=JG)=>(r.min=Qo.min,r.max=e(t),r)}_createDefaultTiltGlobal(){const e=this.collision.enabled?l5([[4e3,Qo.max],[5e4,Ft(88)],[6e6,Ft(88)],[2e7,Qo.min]]):l5([[3e5,Qo.max],[3e6,Ft(88)],[6e6,Ft(88)],[2e7,Qo.min]]);return(t,r=JG)=>(r.min=Qo.min,r.max=e(t),r)}};function ust(e){return{min:-2e5,max:4*e.radius}}u([d()],sy.prototype,"altitude",null),u([d({readOnly:!0})],sy.prototype,"collision",void 0),u([d()],sy.prototype,"distance",void 0),u([d({readOnly:!0})],sy.prototype,"minimumPoiDistance",void 0),u([d()],sy.prototype,"tilt",void 0),u([d({constructOnly:!0})],sy.prototype,"mode",void 0),sy=u([$("esri.views.3d.state.Constraints")],sy);const ede=ust($r),Qo={min:Ft(.5),max:Ft(179.5)},JG={min:0,max:0};let r3=class extends xe{constructor(){super(...arguments),this.enabled=!0,this.elevationMargin=5}};u([d({type:Boolean})],r3.prototype,"enabled",void 0),u([d({type:Number})],r3.prototype,"elevationMargin",void 0),r3=u([$("esri.views.3d.state.Constraints.CollisionConstraint")],r3);let FE=class extends xe{constructor(){super(...arguments),this.min=ede.min,this.max=ede.max}};u([d({type:Number})],FE.prototype,"min",void 0),u([d({type:Number})],FE.prototype,"max",void 0),FE=u([$("esri.views.3d.constraints.AltitudeConstraint")],FE);let by=class extends xe{constructor(){super(...arguments),this.mode="auto"}get near(){return this._get("near")}set near(e){this._set("near",e),e>=this._get("far")&&(this.far=e+1e-9),this.mode="manual"}castNear(e){return Math.max(1e-8,e)}get far(){return this._get("far")}set far(e){this._set("far",e),e<=this._get("near")&&(this.near=e-1e-9),this.mode="manual"}castFar(e){return Math.max(1e-8,e)}autoUpdate(e,t){this.mode==="auto"&&(this._get("near")!==e&&this._set("near",e),this._get("far")!==t&&this._set("far",t))}};u([d({type:Number,value:1e-8})],by.prototype,"near",null),u([qt("near")],by.prototype,"castNear",null),u([d({type:Number,value:1e-8})],by.prototype,"far",null),u([qt("far")],by.prototype,"castFar",null),u([d({type:["auto","manual"]})],by.prototype,"mode",void 0),by=u([$("esri.views.3d.constraints.ClipDistanceConstraint")],by);const HY={min:nu(Qo.min),max:nu(Qo.max)};let rx=class extends xe{constructor(){super(...arguments),this.mode="auto"}get max(){return this._get("max")}set max(e){this._set("max",e),this.mode="manual"}castMax(e){return Le(e,HY.min,HY.max)}autoUpdate(e){this.mode==="auto"&&this._get("max")!==e&&this._set("max",e)}};u([d({type:["auto","manual"]})],rx.prototype,"mode",void 0),u([d({type:Number,value:HY.max})],rx.prototype,"max",null),u([qt("max")],rx.prototype,"castMax",null),rx=u([$("esri.views.3d.constraints.TiltConstraint")],rx);let ix=class extends xe{constructor(){super(...arguments),this.tilt=new rx,this.altitude=new FE,this.clipDistance=new by}};u([d({type:rx})],ix.prototype,"tilt",void 0),u([d({type:FE})],ix.prototype,"altitude",void 0),u([d({type:by})],ix.prototype,"clipDistance",void 0),ix=u([$("esri.views.3d.constraints.Constraints")],ix);var qY;let Jh=qY=class extends ye{constructor(e){super(e),this.type="sun",this.date=null,this.directShadowsEnabled=!1,this.displayUTCOffset=null}readDate(e,t){return t.datetime!=null&&new Date(t.datetime)||null}writeDate(e,t,r){t[r]=e.getTime()}readDirectShadowsEnabled(e,t){return!!t.directShadows}writedirectShadowsEnabled(e,t,r){e&&(t[r]=e)}writeDisplayUTCOffset(e,t){e!=null&&(t.displayUTCOffset=e)}clone(){return new qY(this.cloneConstructProperties())}cloneConstructProperties(){const e={directShadowsEnabled:this.directShadowsEnabled,displayUTCOffset:this.displayUTCOffset!=null?this.displayUTCOffset:null};return this.date!=null&&(e.date=new Date(this.date.getTime())),e}};u([d({readOnly:!0,type:["sun"],json:{write:!0}})],Jh.prototype,"type",void 0),u([d({type:Date,json:{type:Number,write:{target:"datetime"}}})],Jh.prototype,"date",void 0),u([$e("date",["datetime"])],Jh.prototype,"readDate",null),u([Xe("date")],Jh.prototype,"writeDate",null),u([d({type:Boolean,json:{default:!1,write:{target:"directShadows"}}})],Jh.prototype,"directShadowsEnabled",void 0),u([$e("directShadowsEnabled",["directShadows"])],Jh.prototype,"readDirectShadowsEnabled",null),u([Xe("directShadowsEnabled")],Jh.prototype,"writedirectShadowsEnabled",null),u([d({type:Number,json:{write:!0}})],Jh.prototype,"displayUTCOffset",void 0),u([Xe("displayUTCOffset")],Jh.prototype,"writeDisplayUTCOffset",null),Jh=qY=u([$("esri.webscene.SunLighting")],Jh);const II=Jh;var H2;let cm=H2=class extends ds.EventedMixin(II){constructor(e){super(e),this.cameraTrackingEnabled=!0,this.ambientOcclusionEnabled=!1,this.waterReflectionEnabled=!1,this.positionTimezoneInfo={hours:0,minutes:0,seconds:0,autoUpdated:!0};const t=new Date().getFullYear(),r=new Date("March 15, "+t+" 12:00:00 UTC");this._set("defaultDate",r),this._set("date",r)}get defaultDate(){return new Date(this._get("defaultDate").getTime())}static fromWebsceneLighting(e){return new H2(e.cloneConstructProperties())}set defaultDate(e){const t=this._get("date")===this._get("defaultDate");e=new Date(e.getTime()),this._set("defaultDate",e),t&&this._set("date",e)}set date(e){e!=null&&(this.positionTimezoneInfo.autoUpdated=!1,this._set("date",new Date(e.getTime())))}autoUpdate(e,t){const r=H2.calculateTimezoneOffset(this.positionTimezoneInfo);this.positionTimezoneInfo.hours=t.hours,this.positionTimezoneInfo.minutes=t.minutes,this.positionTimezoneInfo.seconds=t.seconds;let i=null;e!=null&&(this.positionTimezoneInfo.autoUpdated=!0,i=this.date&&this.date.getTime(),this._set("date",new Date(e.getTime())));const s=H2.calculateTimezoneOffset(this.positionTimezoneInfo);if(r!==s&&(KG.target=this,KG.timezoneOffset=s,this.emit("timezone-will-change",KG)),e!=null)return i!==e.getTime()}clone(){const e=this._get("date")===this._get("defaultDate"),t=new H2({...this.cloneConstructProperties(),defaultDate:this.defaultDate,cameraTrackingEnabled:this.cameraTrackingEnabled,ambientOcclusionEnabled:this.ambientOcclusionEnabled,waterReflectionEnabled:this.waterReflectionEnabled});return e&&t._set("date",t._get("defaultDate")),t.positionTimezoneInfo.autoUpdated=this.positionTimezoneInfo.autoUpdated,t.positionTimezoneInfo.hours=this.positionTimezoneInfo.hours,t.positionTimezoneInfo.minutes=this.positionTimezoneInfo.minutes,t.positionTimezoneInfo.seconds=this.positionTimezoneInfo.seconds,t}cloneWithWebsceneLighting(e){const t=this.clone();return e.date!=null&&(t.date=e.date),t.directShadowsEnabled=e.directShadowsEnabled,t.displayUTCOffset=e.displayUTCOffset,t}};u([d({type:Boolean})],cm.prototype,"cameraTrackingEnabled",void 0),u([d({type:Boolean})],cm.prototype,"ambientOcclusionEnabled",void 0),u([d({type:Boolean})],cm.prototype,"waterReflectionEnabled",void 0),u([d({type:Date})],cm.prototype,"defaultDate",null),u([d({type:Date})],cm.prototype,"date",null),cm=H2=u([$("esri.views.3d.environment.SunLighting")],cm),function(e){function t({hours:r,minutes:i,seconds:s}){return Math.round(r+i/60+s/3600)}e.calculateTimezoneOffset=t}(cm||(cm={}));const KG={target:null,timezoneOffset:0},Qv=cm;var WY;let i3=WY=class extends ye{constructor(e){super(e),this.type="virtual",this.directShadowsEnabled=!1}clone(){return new WY(this.cloneConstructProperties())}cloneConstructProperties(){return{directShadowsEnabled:this.directShadowsEnabled}}};u([d({readOnly:!0,type:["virtual"],json:{write:!0}})],i3.prototype,"type",void 0),u([d({type:Boolean,json:{default:!1,name:"directShadows",write:!0}})],i3.prototype,"directShadowsEnabled",void 0),i3=WY=u([$("esri.webscene.VirtualLighting")],i3);const uB=i3;var B5;let s3=B5=class extends ds.EventedMixin(uB){constructor(e){super(e),this.ambientOcclusionEnabled=!1,this.waterReflectionEnabled=!1}clone(){return new B5({...this.cloneConstructProperties(),ambientOcclusionEnabled:this.ambientOcclusionEnabled,waterReflectionEnabled:this.waterReflectionEnabled})}static fromWebsceneLighting(e){return new B5(e.cloneConstructProperties())}cloneWithWebsceneLighting(e){const t=this.clone();return t.directShadowsEnabled=e.directShadowsEnabled,t}};u([d({type:Boolean})],s3.prototype,"ambientOcclusionEnabled",void 0),u([d({type:Boolean})],s3.prototype,"waterReflectionEnabled",void 0),s3=B5=u([$("esri.views.3d.environment.VirtualLighting")],s3);const n3=s3,hst={key:"type",defaultKeyValue:"sun",base:null,typeMap:{sun:Qv,virtual:n3}};var XY;let hP=XY=class extends xe{set quality(e){["low","high"].includes(e)&&this._set("quality",e)}clone(){return new XY({quality:this.quality})}};u([d({type:["low","high"],value:"low"})],hP.prototype,"quality",null),hP=XY=u([$("esri.views.3d.environment.SceneViewAtmosphere")],hP);var ZY;let o3=ZY=class extends ye{constructor(e){super(e),this.type="sunny",this.cloudCover=.5}clone(){return new ZY({cloudCover:this.cloudCover})}};u([lt({sunny:"sunny"})],o3.prototype,"type",void 0),u([d({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],o3.prototype,"cloudCover",void 0),o3=ZY=u([$("esri.views.3d.environment.SunnyWeather")],o3);const YY=o3;var QY;let a3=QY=class extends ye{constructor(e){super(e),this.type="cloudy",this.cloudCover=.5}clone(){return new QY({cloudCover:this.cloudCover})}};u([lt({cloudy:"cloudy"})],a3.prototype,"type",void 0),u([d({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],a3.prototype,"cloudCover",void 0),a3=QY=u([$("esri.views.3d.environment.CloudyWeather")],a3);const dst=a3;var JY;let l3=JY=class extends ye{constructor(e){super(e),this.type="foggy",this.fogStrength=.5}clone(){return new JY({fogStrength:this.fogStrength})}};u([lt({foggy:"foggy"})],l3.prototype,"type",void 0),u([d({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],l3.prototype,"fogStrength",void 0),l3=JY=u([$("esri.views.3d.environment.FoggyWeather")],l3);const pst=l3;var KY;let q2=KY=class extends ye{constructor(e){super(e),this.type="rainy",this.cloudCover=.5,this.precipitation=.5}clone(){return new KY({cloudCover:this.cloudCover,precipitation:this.precipitation})}};u([lt({rainy:"rainy"})],q2.prototype,"type",void 0),u([d({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],q2.prototype,"cloudCover",void 0),u([d({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],q2.prototype,"precipitation",void 0),q2=KY=u([$("esri.views.3d.environment.RainyWeather")],q2);const fst=q2;var eQ;let Cw=eQ=class extends ye{constructor(e){super(e),this.type="snowy",this.cloudCover=.5,this.precipitation=.5,this.snowCover="disabled"}clone(){return new eQ({cloudCover:this.cloudCover,precipitation:this.precipitation,snowCover:this.snowCover})}};u([lt({snowy:"snowy"})],Cw.prototype,"type",void 0),u([d({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],Cw.prototype,"cloudCover",void 0),u([d({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],Cw.prototype,"precipitation",void 0),u([d({type:["enabled","disabled"],nonNullable:!0,json:{write:!0}})],Cw.prototype,"snowCover",void 0),Cw=eQ=u([$("esri.views.3d.environment.SnowyWeather")],Cw);const mst=Cw,$Re={key:"type",base:YY,typeMap:{sunny:YY,cloudy:dst,rainy:fst,snowy:mst,foggy:pst}},gst=Object.keys($Re.typeMap);function yst(e,t){return!!gst.includes(e)||(t.error(`"${e}" is not a valid weather type`),!1)}const dd=1e4,vst={key:"type",defaultKeyValue:"sun",base:null,typeMap:{sun:II,virtual:uB}};let G5=class extends ye{constructor(e){super(e)}clone(){}};u([d({readOnly:!0,json:{read:!1}})],G5.prototype,"type",void 0),G5=u([$("esri.webscene.background.Background")],G5);const LRe=G5;var tQ;const _st={...E0,nonNullable:!0};let c3=tQ=class extends LRe{constructor(e){super(e),this.type="color",this.color=new Me([0,0,0,1])}clone(){return new tQ(this.cloneProperties())}cloneProperties(){return{color:this.color.clone()}}};u([lt({color:"color"},{readOnly:!0})],c3.prototype,"type",void 0),u([d(_st)],c3.prototype,"color",void 0),c3=tQ=u([$("esri.webscene.background.ColorBackground")],c3);const DRe=c3,tde={base:LRe,key:"type",typeMap:{color:DRe}};function bst(e){return(t,r,i)=>{if(!t)return t;for(const s in e.typeMap)if(t.type===s){const n=new e.typeMap[s];return n.read(t,i),n}}}const wst={types:tde,json:{read:bst(tde),write:{overridePolicy:(e,t,r)=>({enabled:!r||!r.isPresentation})}}};var rQ;const xst=fe.getLogger("esri.webscene.Environment"),rde=(e,t,r)=>({enabled:!r||!r.isPresentation});let Jv=rQ=class extends ye{constructor(e){super(e),this.lighting=new II,this.background=null,this.atmosphereEnabled=!0,this.starsEnabled=!0}set weather(e){yst(e==null?void 0:e.type,xst)&&this._set("weather",e)}clone(){return new rQ(this.cloneConstructProperties())}cloneConstructProperties(){return{lighting:this.lighting&&this.lighting.type==="virtual"?uB.prototype.clone.call(this.lighting):II.prototype.clone.call(this.lighting),background:re(this.background),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,weather:this.weather.clone()}}};u([d({types:vst,nonNullable:!0,json:{write:!0}})],Jv.prototype,"lighting",void 0),u([d(wst)],Jv.prototype,"background",void 0),u([d({type:Boolean,nonNullable:!0,json:{write:{overridePolicy:rde}}})],Jv.prototype,"atmosphereEnabled",void 0),u([d({type:Boolean,nonNullable:!0,json:{write:{overridePolicy:rde}}})],Jv.prototype,"starsEnabled",void 0),u([d({types:$Re,nonNullable:!0,json:{write:!0},value:new YY})],Jv.prototype,"weather",null),Jv=rQ=u([$("esri.webscene.Environment")],Jv);const NRe=Jv;var u3;let W2=u3=class extends NRe{constructor(e){super(e),this.atmosphere=new hP,this.lighting=new Qv}static fromWebsceneEnvironment(e){const t=e.cloneConstructProperties();return new u3({...t,lighting:t.lighting.type==="virtual"?n3.fromWebsceneLighting(t.lighting):Qv.fromWebsceneLighting(t.lighting)})}castLighting(e){return this._convertLighting(e)}applyLighting(e){this.lighting=this._convertLighting(e)}_convertLighting(e){return e?e instanceof Qv||e instanceof n3?e:e instanceof II?this.lighting&&this.lighting.type==="sun"?this.lighting.cloneWithWebsceneLighting(e):new Qv(e.cloneConstructProperties()):e instanceof uB?this.lighting&&this.lighting.type==="virtual"?this.lighting.cloneWithWebsceneLighting(e):new n3(e.cloneConstructProperties()):_f(hst,e):new Qv}clone(){return new u3({lighting:this.lighting.clone(),atmosphere:this.atmosphere.clone(),weather:this.weather.clone(),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,background:re(this.background)})}cloneWithWebsceneEnvironment(e){return new u3({atmosphere:this.atmosphere.clone(),weather:this.weather.clone(),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,background:re(this.background),...e.cloneConstructProperties(),lighting:this._getLighting(e)})}_getLighting(e){return e.lighting.type==="sun"?this.lighting&&this.lighting.type==="sun"?this.lighting.cloneWithWebsceneLighting(e.lighting):Qv.fromWebsceneLighting(e.lighting):e.lighting.type==="virtual"?this.lighting&&this.lighting.type==="virtual"?this.lighting.cloneWithWebsceneLighting(e.lighting):n3.fromWebsceneLighting(e.lighting):Qv.fromWebsceneLighting(e.lighting)}};u([d({type:hP,json:{read:!1},nonNullable:!0})],W2.prototype,"atmosphere",void 0),u([d({nonNullable:!0})],W2.prototype,"lighting",void 0),u([qt("lighting")],W2.prototype,"castLighting",null),W2=u3=u([$("esri.views.3d.environment.SceneViewEnvironment")],W2);const X2=W2;function Do(e,t){return e[0]=t[0],e[1]=t[1],e}function vr(e,t,r){return e[0]=t,e[1]=r,e}function Bp(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e}function $m(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e}function FRe(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e}function kRe(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e}function Tst(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e}function Sst(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e}function Est(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e}function Cst(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e}function Ast(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e}function Bc(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e}function Rst(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e}function rie(e,t){const r=t[0]-e[0],i=t[1]-e[1];return Math.sqrt(r*r+i*i)}function TV(e,t){const r=t[0]-e[0],i=t[1]-e[1];return r*r+i*i}function iie(e){const t=e[0],r=e[1];return Math.sqrt(t*t+r*r)}function URe(e){const t=e[0],r=e[1];return t*t+r*r}function sie(e,t){return e[0]=-t[0],e[1]=-t[1],e}function Ost(e,t){return e[0]=1/t[0],e[1]=1/t[1],e}function $I(e,t){const r=t[0],i=t[1];let s=r*r+i*i;return s>0&&(s=1/Math.sqrt(s),e[0]=t[0]*s,e[1]=t[1]*s),e}function un(e,t){return e[0]*t[0]+e[1]*t[1]}function Mst(e,t,r){const i=t[0]*r[1]-t[1]*r[0];return e[0]=e[1]=0,e[2]=i,e}function Z2(e,t,r,i){const s=t[0],n=t[1];return e[0]=s+i*(r[0]-s),e[1]=n+i*(r[1]-n),e}function Pst(e,t){t=t||1;const r=2*Kp()*Math.PI;return e[0]=Math.cos(r)*t,e[1]=Math.sin(r)*t,e}function iQ(e,t,r){const i=t[0],s=t[1];return e[0]=r[0]*i+r[2]*s,e[1]=r[1]*i+r[3]*s,e}function Aw(e,t,r){const i=t[0],s=t[1];return e[0]=r[0]*i+r[2]*s+r[4],e[1]=r[1]*i+r[3]*s+r[5],e}function Ist(e,t,r){const i=t[0],s=t[1];return e[0]=r[0]*i+r[3]*s+r[6],e[1]=r[1]*i+r[4]*s+r[7],e}function $st(e,t,r){const i=t[0],s=t[1];return e[0]=r[0]*i+r[4]*s+r[12],e[1]=r[1]*i+r[5]*s+r[13],e}function Lst(e,t,r,i){const s=t[0]-r[0],n=t[1]-r[1],o=Math.sin(i),a=Math.cos(i);return e[0]=s*a-n*o+r[0],e[1]=s*o+n*a+r[1],e}function Dst(e,t){const r=e[0],i=e[1],s=t[0],n=t[1];let o=r*r+i*i;o>0&&(o=1/Math.sqrt(o));let a=s*s+n*n;a>0&&(a=1/Math.sqrt(a));const l=(r*s+i*n)*o*a;return l>1?0:l<-1?Math.PI:Math.acos(l)}function Nst(e){return"vec2("+e[0]+", "+e[1]+")"}function VRe(e,t){return e[0]===t[0]&&e[1]===t[1]}function Fst(e,t){const r=e[0],i=e[1],s=t[0],n=t[1];return Math.abs(r-s)<=At*Math.max(1,Math.abs(r),Math.abs(s))&&Math.abs(i-n)<=At*Math.max(1,Math.abs(i),Math.abs(n))}function kst(e,t,r,i,s){let n=t[0]-r[0],o=t[1]-r[1];const a=(i[0]*n+i[1]*o)*(s-1);return n=i[0]*a,o=i[1]*a,e[0]=t[0]+n,e[1]=t[1]+o,e}const Ust=iie,Vst=$m,zst=FRe,Bst=kRe,zRe=rie,Gst=TV,jst=URe;Object.freeze(Object.defineProperty({__proto__:null,copy:Do,set:vr,add:Bp,subtract:$m,multiply:FRe,divide:kRe,ceil:Tst,floor:Sst,min:Est,max:Cst,round:Ast,scale:Bc,scaleAndAdd:Rst,distance:rie,squaredDistance:TV,length:iie,squaredLength:URe,negate:sie,inverse:Ost,normalize:$I,dot:un,cross:Mst,lerp:Z2,random:Pst,transformMat2:iQ,transformMat2d:Aw,transformMat3:Ist,transformMat4:$st,rotate:Lst,angle:Dst,str:Nst,exactEquals:VRe,equals:Fst,projectAndScale:kst,len:Ust,sub:Vst,mul:zst,div:Bst,dist:zRe,sqrDist:Gst,sqrLen:jst},Symbol.toStringTag,{value:"Module"}));function BRe(e){return Math.min(1,Math.max(0,(e-1e5)/(1e6-1e5)))}const sQ=1e4,vS=Ue(5802e-9,13558e-9,331e-7),e7=3,t7=Ue(65e-8*e7,1881e-9*e7,85e-9*e7),Hst=3996e-9,qst=.085,j5=1e5;class nn{}function S(e,...t){let r="";for(let i=0;i<t.length;i++)r+=e[i]+t[i];return r+=e[e.length-1],r}(function(e){function t(i){return Math.round(i).toString()}function r(i){return i.toPrecision(8)}e.int=t,e.float=r})(S||(S={}));var O;(function(e){e.POSITION="position",e.NORMAL="normal",e.UV0="uv0",e.AUXPOS1="auxpos1",e.AUXPOS2="auxpos2",e.MAPPOS="mapPos",e.COLOR="color",e.SYMBOLCOLOR="symbolColor",e.SIZE="size",e.TANGENT="tangent",e.OFFSET="offset",e.SUBDIVISIONFACTOR="subdivisionFactor",e.COLORFEATUREATTRIBUTE="colorFeatureAttribute",e.SIZEFEATUREATTRIBUTE="sizeFeatureAttribute",e.OPACITYFEATUREATTRIBUTE="opacityFeatureAttribute",e.DISTANCETOSTART="distanceToStart",e.UVMAPSPACE="uvMapSpace",e.BOUNDINGRECT="boundingRect",e.UVREGION="uvRegion",e.NORMALCOMPRESSED="normalCompressed",e.PROFILERIGHT="profileRight",e.PROFILEUP="profileUp",e.PROFILEVERTEXANDNORMAL="profileVertexAndNormal",e.FEATUREVALUE="featureValue",e.MODELORIGINHI="modelOriginHi",e.MODELORIGINLO="modelOriginLo",e.MODEL="model",e.MODELNORMAL="modelNormal",e.INSTANCECOLOR="instanceColor",e.INSTANCEFEATUREATTRIBUTE="instanceFeatureAttribute",e.LOCALTRANSFORM="localTransform",e.GLOBALTRANSFORM="globalTransform",e.BOUNDINGSPHERE="boundingSphere",e.MODELORIGIN="modelOrigin",e.MODELSCALEFACTORS="modelScaleFactors",e.FEATUREATTRIBUTE="featureAttribute",e.STATE="state",e.LODLEVEL="lodLevel",e.POSITION0="position0",e.POSITION1="position1",e.NORMALA="normalA",e.NORMALB="normalB",e.COMPONENTINDEX="componentIndex",e.VARIANTOFFSET="variantOffset",e.VARIANTSTROKE="variantStroke",e.VARIANTEXTENSION="variantExtension",e.U8PADDING="u8padding",e.U16PADDING="u16padding",e.SIDENESS="sideness",e.START="start",e.END="end",e.UP="up",e.EXTRUDE="extrude"})(O||(O={}));var _n;function Xy(e,t){switch(t.textureCoordinateType){case _n.Default:return e.attributes.add(O.UV0,"vec2"),e.varyings.add("vuv0","vec2"),void e.vertex.code.add(S`void forwardTextureCoordinates() {
vuv0 = uv0;
}`);case _n.Atlas:return e.attributes.add(O.UV0,"vec2"),e.varyings.add("vuv0","vec2"),e.attributes.add(O.UVREGION,"vec4"),e.varyings.add("vuvRegion","vec4"),void e.vertex.code.add(S`void forwardTextureCoordinates() {
vuv0 = uv0;
vuvRegion = uvRegion;
}`);case _n.None:return void e.vertex.code.add(S`void forwardTextureCoordinates() {}`);default:t.textureCoordinateType;case _n.COUNT:return}}(function(e){e[e.None=0]="None",e[e.Default=1]="Default",e[e.Atlas=2]="Atlas",e[e.COUNT=3]="COUNT"})(_n||(_n={}));function hu(e){e.code.add(S`const float MAX_RGBA_FLOAT =
255.0 / 256.0 +
255.0 / 256.0 / 256.0 +
255.0 / 256.0 / 256.0 / 256.0 +
255.0 / 256.0 / 256.0 / 256.0 / 256.0;
const vec4 FIXED_POINT_FACTORS = vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);
vec4 float2rgba(const float value) {
float valueInValidDomain = clamp(value, 0.0, MAX_RGBA_FLOAT);
vec4 fixedPointU8 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);
const float toU8AsFloat = 1.0 / 255.0;
return fixedPointU8 * toU8AsFloat;
}
const vec4 RGBA_2_FLOAT_FACTORS = vec4(
255.0 / (256.0),
255.0 / (256.0 * 256.0),
255.0 / (256.0 * 256.0 * 256.0),
255.0 / (256.0 * 256.0 * 256.0 * 256.0)
);
float rgba2float(vec4 rgba) {
return dot(rgba, RGBA_2_FLOAT_FACTORS);
}`)}function xh(e){e.include(hu),e.code.add(S`float linearDepthFromFloat(float depth, vec2 nearFar) {
return -(depth * (nearFar[1] - nearFar[0]) + nearFar[0]);
}
float linearDepthFromTexture(sampler2D depthTex, vec2 uv, vec2 nearFar) {
return linearDepthFromFloat(rgba2float(texture2D(depthTex, uv)), nearFar);
}`)}function hB(e){e.fragment.code.add(S`const float GAMMA = 2.2;
const float INV_GAMMA = 0.4545454545;
vec4 delinearizeGamma(vec4 color) {
return vec4(pow(color.rgb, vec3(INV_GAMMA)), color.w);
}
vec3 linearizeGamma(vec3 color) {
return pow(color, vec3(GAMMA));
}`)}var Vr;(function(e){e[e.Pass=0]="Pass",e[e.Draw=1]="Draw"})(Vr||(Vr={}));class ss{constructor(t,r,i,s,n=null){this.name=t,this.type=r,this.arraySize=n,this.bind={[Vr.Pass]:null,[Vr.Draw]:null},b(i)&&b(s)&&(this.bind[i]=s)}equals(t){return this.type===t.type&&this.name===t.name&&this.arraySize===t.arraySize}}class _r extends ss{constructor(t,r){super(t,"vec2",Vr.Pass,(i,s,n)=>i.setUniform2fv(t,r(s,n)))}}class Zy extends ss{constructor(t){super(t,"vec2")}}class St extends ss{constructor(t,r){super(t,"vec3",Vr.Pass,(i,s,n)=>i.setUniform3fv(t,r(s,n)))}}class Yl extends ss{constructor(t){super(t,"vec3")}}class hl extends ss{constructor(t){super(t,"vec4")}}class kr extends ss{constructor(t){super(t,"float")}}class Ei extends ss{constructor(t,r){super(t,"mat4",Vr.Pass,(i,s,n)=>i.setUniformMatrix4fv(t,r(s,n)))}}const Wst=fe.getLogger("esri.views.3d.webgl-engine.core.shaderModules.shaderBuilder");class GRe{constructor(){this.includedModules=new Map}include(t,r){if(this.includedModules.has(t)){const i=this.includedModules.get(t);if(i!==r){Wst.error("Trying to include shader module multiple times with different sets of options.");const s=new Set;for(const n of Object.keys(i))i[n]!==t[n]&&s.add(n);for(const n of Object.keys(t))i[n]!==t[n]&&s.add(n);s.forEach(n=>console.error(`  ${n}: current ${i[n]} new ${t[n]}`))}}else this.includedModules.set(t,r),t(this.builder,r)}}class Yr extends GRe{constructor(){super(...arguments),this.vertex=new ide,this.fragment=new ide,this.attributes=new Yst,this.varyings=new Qst,this.extensions=new TA,this.constants=new Os}get fragmentUniforms(){return this.fragment.uniforms.entries}get builder(){return this}generate(t){const r=this.extensions.generateSource(t),i=this.attributes.generateSource(t),s=this.varyings.generateSource(),n=t==="vertex"?this.vertex:this.fragment,o=n.uniforms.generateSource(),a=n.code.generateSource(),l=t==="vertex"?Kst:Jst,c=this.constants.generateSource().concat(n.constants.generateSource());return`
${r.join(`
`)}

${l}

${c.join(`
`)}

${o.join(`
`)}

${i.join(`
`)}

${s.join(`
`)}

${a.join(`
`)}`}generateBind(t,r){const i=new Map;this.vertex.uniforms.entries.forEach(o=>{const a=o.bind[t];b(a)&&i.set(o.name,a)}),this.fragment.uniforms.entries.forEach(o=>{const a=o.bind[t];b(a)&&i.set(o.name,a)});const s=Array.from(i.values()),n=s.length;return(o,a)=>{for(let l=0;l<n;++l)s[l](r,o,a)}}}class Xst{constructor(){this._entries=new Map}add(t){if(!Array.isArray(t))return this._add(t);for(const r of t)this._add(r)}_add(t){if(this._entries.has(t.name)&&!this._entries.get(t.name).equals(t))throw new j(`Duplicate uniform name ${t.name} for different uniform type`);this._entries.set(t.name,t)}generateSource(){return Array.from(this._entries.values()).map(t=>b(t.arraySize)?`uniform ${t.type} ${t.name}[${t.arraySize}];`:`uniform ${t.type} ${t.name};`)}get entries(){return Array.from(this._entries.values())}}class Zst{constructor(){this._entries=new Array}add(t){this._entries.push(t)}generateSource(){return this._entries}}class ide extends GRe{constructor(){super(...arguments),this.uniforms=new Xst,this.code=new Zst,this.constants=new Os}get builder(){return this}}class Yst{constructor(){this._entries=new Array}add(t,r){this._entries.push([t,r])}generateSource(t){return t==="fragment"?[]:this._entries.map(r=>`attribute ${r[1]} ${r[0]};`)}}class Qst{constructor(){this._entries=new Array}add(t,r){this._entries.push([t,r])}generateSource(){return this._entries.map(t=>`varying ${t[1]} ${t[0]};`)}}class TA{constructor(){this._entries=new Set}add(t){this._entries.add(t)}generateSource(t){const r=t==="vertex"?TA.ALLOWLIST_VERTEX:TA.ALLOWLIST_FRAGMENT;return Array.from(this._entries).filter(i=>r.includes(i)).map(i=>`#extension ${i} : enable`)}}TA.ALLOWLIST_FRAGMENT=["GL_EXT_shader_texture_lod","GL_OES_standard_derivatives"],TA.ALLOWLIST_VERTEX=[];class Os{constructor(){this._entries=new Set}add(t,r,i){let s="ERROR_CONSTRUCTOR_STRING";switch(r){case"float":s=Os._numberToFloatStr(i);break;case"int":s=Os._numberToIntStr(i);break;case"bool":s=i.toString();break;case"vec2":s=`vec2(${Os._numberToFloatStr(i[0])},                            ${Os._numberToFloatStr(i[1])})`;break;case"vec3":s=`vec3(${Os._numberToFloatStr(i[0])},                            ${Os._numberToFloatStr(i[1])},                            ${Os._numberToFloatStr(i[2])})`;break;case"vec4":s=`vec4(${Os._numberToFloatStr(i[0])},                            ${Os._numberToFloatStr(i[1])},                            ${Os._numberToFloatStr(i[2])},                            ${Os._numberToFloatStr(i[3])})`;break;case"ivec2":s=`ivec2(${Os._numberToIntStr(i[0])},                             ${Os._numberToIntStr(i[1])})`;break;case"ivec3":s=`ivec3(${Os._numberToIntStr(i[0])},                             ${Os._numberToIntStr(i[1])},                             ${Os._numberToIntStr(i[2])})`;break;case"ivec4":s=`ivec4(${Os._numberToIntStr(i[0])},                             ${Os._numberToIntStr(i[1])},                             ${Os._numberToIntStr(i[2])},                             ${Os._numberToIntStr(i[3])})`;break;case"mat2":case"mat3":case"mat4":s=`${r}(${Array.prototype.map.call(i,n=>Os._numberToFloatStr(n)).join(", ")})`}return this._entries.add(`const ${r} ${t} = ${s};`),this}static _numberToIntStr(t){return t.toFixed(0)}static _numberToFloatStr(t){return Number.isInteger(t)?t.toFixed(1):t.toString()}generateSource(){return Array.from(this._entries)}}const Jst=`#ifdef GL_FRAGMENT_PRECISION_HIGH
  precision highp float;
  precision highp sampler2D;
#else
  precision mediump float;
  precision mediump sampler2D;
#endif`,Kst=`precision highp float;
precision highp sampler2D;`;class Hi extends ss{constructor(t){super(t,"sampler2D")}}function ent(e){const t=new Yr;t.attributes.add(O.POSITION,"vec2"),t.include(Xy,{textureCoordinateType:_n.Default}),t.varyings.add("worldRay","vec3"),t.varyings.add("eyeDir","vec3");const{vertex:r,fragment:i}=t;return r.uniforms.add([new Ei("inverseProjectionMatrix",(s,n)=>n.camera.inverseProjectionMatrix),new Ei("inverseViewMatrix",(s,n)=>Cs(tnt,n.camera.viewMatrix))]),r.code.add(S`void main(void) {
vec3 posViewNear = (inverseProjectionMatrix * vec4(position, -1, 1)).xyz;
eyeDir = posViewNear;
worldRay = (inverseViewMatrix * vec4(posViewNear, 0)).xyz;
forwardTextureCoordinates();
gl_Position = vec4(position, 1, 1);
}`),i.uniforms.add([new St("lightingMainDirection",(s,n)=>n.lighting.lightingMainDirection),new Zy("radii"),new kr("scaleHeight"),new Yl("cameraPosition"),new hl("heightParameters"),new kr("innerFadeDistance"),new kr("altitudeFade"),new Hi("depthTex"),new Yl("betaRayleigh"),new Yl("betaCombined"),new kr("betaMie"),new kr("hazeStrength")]),t.include(hB),e.haze&&(i.include(xh),i.uniforms.add(new _r("nearFar",(s,n)=>n.camera.nearFar))),i.code.add(S`vec2 sphereIntersect(vec3 start, vec3 dir, float radius, bool planet) {
float a = dot(dir, dir);
float b = 2.0 * dot(dir, start);
float c = planet ? heightParameters[1] - radius * radius : heightParameters[2];
float d = (b * b) - 4.0 * a * c;
if (d < 0.0) {
return vec2(1e5, -1e5);
}
return vec2((-b - sqrt(d)) / (2.0 * a), (-b + sqrt(d)) / (2.0 * a));
}`),i.code.add(S`float chapmanApproximation(float X, float h, float cosZenith) {
float c = sqrt(X + h);
float cExpH = c * exp(-h);
if (cosZenith >= 0.0) {
return cExpH / (c * cosZenith + 1.0);
} else {
float x0 = sqrt(1.0 - cosZenith * cosZenith) * (X + h);
float c0 = sqrt(x0);
return 2.0 * c0 * exp(X - x0) - cExpH / (1.0 - c * cosZenith);
}
}`),i.code.add(S`float getOpticalDepth(vec3 position, vec3 dir, float h) {
return scaleHeight * chapmanApproximation(radii[0] / scaleHeight, h, dot(normalize(position), dir));
}`),i.code.add(S`
    const int STEPS = 6;

    float getGlow(float dist, float radius, float intensity) {
      return pow(radius / max(dist, 1e-6), intensity);
    }

    vec3 getAtmosphereColour(vec3 cameraPos, vec3 rayDir, vec3 lightDir, float terrainDepth) {
      float reducedPlanetRadius = radii[0] - 20000.0;
      vec2 rayPlanetIntersect = sphereIntersect(cameraPos, rayDir, reducedPlanetRadius, true);
      vec2 rayAtmosphereIntersect = sphereIntersect(cameraPos, rayDir, radii[1], false);
      bool hitsAtmosphere = (rayAtmosphereIntersect.x <= rayAtmosphereIntersect.y) && rayAtmosphereIntersect.x > 0.0;
      bool insideAtmosphere = heightParameters[0] < radii[1];

      if (!(hitsAtmosphere || insideAtmosphere)) {
        return vec3(0);
      }

      bool hitsPlanet = (rayPlanetIntersect.x <= rayPlanetIntersect.y) && rayPlanetIntersect.x > 0.0;

      float start = insideAtmosphere ? 0.0 : rayAtmosphereIntersect.x;

      if (heightParameters[0] < reducedPlanetRadius) {
        // Long light rays from the night side of the planet lead to numerical instability
        // Do not render the atmosphere in such cases
        if (dot(rayDir, normalize(cameraPos)) < -0.025) {
          return vec3(0);
        }
        start = rayPlanetIntersect.y;
      }

      float end = hitsPlanet ? rayPlanetIntersect.x : rayAtmosphereIntersect.y;
      float maxEnd = end;

      ${e.haze?S`if (terrainDepth != -1.0) { end = terrainDepth; }`:""}

      vec3 samplePoint = cameraPos + rayDir * end;
      float multiplier = hitsPlanet ? -1.0 : 1.0;

      vec3 scattering = vec3(0);
      float scaleFract = (length(samplePoint) - radii[0]) / scaleHeight;
      float lastOpticalDepth = getOpticalDepth(samplePoint, rayDir, scaleFract);
      float stepSize = (end - start) / float(STEPS);
      for (int i = 0; i < STEPS; i++) {
        samplePoint -= stepSize * rayDir;
        scaleFract = (length(samplePoint) - radii[0]) / scaleHeight;
        float opticalDepth = multiplier * getOpticalDepth(samplePoint, rayDir * multiplier, scaleFract);

        if (i > 0) {
          scattering *= ${e.haze?S``:" mix(2.5, 1.0, clamp((length(cameraPos) - radii[0]) / 50e3, 0.0, 1.0)) * "} exp(-(mix(betaCombined, betaRayleigh, 0.5) + betaMie) * max(0.0, (opticalDepth - lastOpticalDepth)));
        }

        if (dot(normalize(samplePoint), lightDir) > -0.3) {

          float scale = exp(-scaleFract);
          float lightDepth = getOpticalDepth(samplePoint, lightDir, scaleFract);

          scattering += scale * exp(-(betaCombined + betaMie) * lightDepth);
          ${e.haze?"":S`scattering += scale * exp(-(0.25 * betaCombined ) * lightDepth);`}
        }

        lastOpticalDepth = opticalDepth;

      }

      float mu = dot(rayDir, lightDir);
      float mumu = 1.0 + mu * mu;

      float phaseRayleigh = 0.05968310365 * mumu;

      ${e.haze?S`return 3.0 * scattering * stepSize * phaseRayleigh * betaRayleigh;`:S`
            const float g = 0.8;
            const float gg = g * g;
            float phaseMie = end == maxEnd ? 0.11936620731 * ((1.0 - gg) * mumu) / (pow(1.0 + gg - 2.0 * mu * g, 1.5) * (2.0 + gg)) : 0.0;
            phaseMie += getGlow(1.0 - mu, 5e-5, 3.0) * smoothstep(0.01, 0.1, length(scattering));
            phaseMie = clamp(phaseMie, 0.0, 128.0);
            return 3.0 * scattering * stepSize * (phaseRayleigh * betaRayleigh + 0.025 * phaseMie * betaMie);`}
    }

    vec3 tonemapACES(vec3 x) {
      return clamp((x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14), 0.0, 1.0);
    }

    vec4 applyUndergroundAtmosphere(vec3 rayDir, vec3 lightDirection, vec4 fragColor) {
      vec2 rayPlanetIntersect = sphereIntersect(cameraPosition, rayDir, radii[0], true);
      if (!((rayPlanetIntersect.x <= rayPlanetIntersect.y) && rayPlanetIntersect.y > 0.0)) {
        return fragColor;
      }

      float lightAngle = dot(lightDirection, normalize(cameraPosition + rayDir * max(0.0, rayPlanetIntersect.x)));
      vec4 surfaceColor = vec4(vec3(max(0.0, (smoothstep(-1.0, 0.8, 2.0 * lightAngle)))), 1.0 - altitudeFade);
      float relDist = (rayPlanetIntersect.y - max(0.0, rayPlanetIntersect.x)) / innerFadeDistance;
      if (relDist > 1.0) {
        return surfaceColor;
      }

      return mix(gl_FragColor, surfaceColor, smoothstep(0.0, 1.0, relDist * relDist));
    }

    void main() {
      vec3 rayDir = normalize(worldRay);
      float terrainDepth = -1.0;
      ${e.haze?S`
          vec4 depthSample = texture2D(depthTex, vuv0).rgba;
          if (depthSample != vec4(0)) {
            vec3 cameraSpaceRay = normalize(eyeDir);
            cameraSpaceRay /= cameraSpaceRay.z;
            cameraSpaceRay *= -linearDepthFromTexture(depthTex, vuv0, nearFar);
            terrainDepth = max(0.0, length(cameraSpaceRay));
          }`:S`
          float depthSample = texture2D(depthTex, vuv0).r;
          if (depthSample != 1.0) {
            gl_FragColor = vec4(0);
            return;
          }`}

      ${e.haze?S`
            vec3 col = vec3(0);
            float fadeOut = smoothstep(-10000.0, -15000.0, heightParameters[0] - radii[0]);
            if(depthSample != vec4(0)){
              col = (1.0 - fadeOut) * hazeStrength * getAtmosphereColour(cameraPosition, rayDir, lightingMainDirection, terrainDepth);
            }
            float alpha = 1.0 - fadeOut;`:S`
            vec3 col = getAtmosphereColour(cameraPosition, rayDir, lightingMainDirection, terrainDepth);;
            float alpha = smoothstep(0.0, mix(0.15, 0.01, heightParameters[3]), length(col));`}
      col = tonemapACES(col);
      gl_FragColor = delinearizeGamma(vec4(col, alpha));
      ${e.haze?"":S`
          if (depthSample == 1.0) {
            gl_FragColor = applyUndergroundAtmosphere(rayDir, lightingMainDirection, gl_FragColor);
          }`}
    }
  `),t}const tnt=Ce(),rnt=Object.freeze(Object.defineProperty({__proto__:null,build:ent},Symbol.toStringTag,{value:"Module"}));class ni{constructor(t,r){this._module=t,this._loadModule=r}get(){return this._module}async reload(){return this._module=await this._loadModule(),this._module}}var ri,Lt,Ae,y0,Tt,af,SA,pt,_i,hs,et,xt,mt,ze,gt,Ct,ol,Cr,Yu,Qn,us,Pr;(function(e){e[e.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",e[e.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",e[e.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT"})(ri||(ri={})),function(e){e[e.POINTS=0]="POINTS",e[e.LINES=1]="LINES",e[e.LINE_LOOP=2]="LINE_LOOP",e[e.LINE_STRIP=3]="LINE_STRIP",e[e.TRIANGLES=4]="TRIANGLES",e[e.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",e[e.TRIANGLE_FAN=6]="TRIANGLE_FAN"}(Lt||(Lt={})),function(e){e[e.ZERO=0]="ZERO",e[e.ONE=1]="ONE",e[e.SRC_COLOR=768]="SRC_COLOR",e[e.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",e[e.SRC_ALPHA=770]="SRC_ALPHA",e[e.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",e[e.DST_ALPHA=772]="DST_ALPHA",e[e.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",e[e.DST_COLOR=774]="DST_COLOR",e[e.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",e[e.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",e[e.CONSTANT_COLOR=32769]="CONSTANT_COLOR",e[e.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",e[e.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",e[e.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA"}(Ae||(Ae={})),function(e){e[e.ADD=32774]="ADD",e[e.SUBTRACT=32778]="SUBTRACT",e[e.REVERSE_SUBTRACT=32779]="REVERSE_SUBTRACT"}(y0||(y0={})),function(e){e[e.ARRAY_BUFFER=34962]="ARRAY_BUFFER",e[e.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",e[e.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",e[e.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER",e[e.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER",e[e.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER",e[e.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER"}(Tt||(Tt={})),function(e){e[e.FRONT=1028]="FRONT",e[e.BACK=1029]="BACK",e[e.FRONT_AND_BACK=1032]="FRONT_AND_BACK"}(af||(af={})),function(e){e[e.CW=2304]="CW",e[e.CCW=2305]="CCW"}(SA||(SA={})),function(e){e[e.BYTE=5120]="BYTE",e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.SHORT=5122]="SHORT",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.INT=5124]="INT",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.FLOAT=5126]="FLOAT"}(pt||(pt={})),function(e){e[e.NEVER=512]="NEVER",e[e.LESS=513]="LESS",e[e.EQUAL=514]="EQUAL",e[e.LEQUAL=515]="LEQUAL",e[e.GREATER=516]="GREATER",e[e.NOTEQUAL=517]="NOTEQUAL",e[e.GEQUAL=518]="GEQUAL",e[e.ALWAYS=519]="ALWAYS"}(_i||(_i={})),function(e){e[e.ZERO=0]="ZERO",e[e.KEEP=7680]="KEEP",e[e.REPLACE=7681]="REPLACE",e[e.INCR=7682]="INCR",e[e.DECR=7683]="DECR",e[e.INVERT=5386]="INVERT",e[e.INCR_WRAP=34055]="INCR_WRAP",e[e.DECR_WRAP=34056]="DECR_WRAP"}(hs||(hs={})),function(e){e[e.NEAREST=9728]="NEAREST",e[e.LINEAR=9729]="LINEAR",e[e.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",e[e.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",e[e.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",e[e.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR"}(et||(et={})),function(e){e[e.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",e[e.REPEAT=10497]="REPEAT",e[e.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT"}(xt||(xt={})),function(e){e[e.TEXTURE_2D=3553]="TEXTURE_2D",e[e.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",e[e.TEXTURE_3D=32879]="TEXTURE_3D",e[e.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",e[e.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",e[e.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",e[e.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",e[e.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY"}(mt||(mt={})),function(e){e[e.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",e[e.DEPTH_STENCIL=34041]="DEPTH_STENCIL",e[e.ALPHA=6406]="ALPHA",e[e.RGB=6407]="RGB",e[e.RGBA=6408]="RGBA",e[e.LUMINANCE=6409]="LUMINANCE",e[e.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",e[e.RED=6403]="RED",e[e.RG=33319]="RG",e[e.RED_INTEGER=36244]="RED_INTEGER",e[e.RG_INTEGER=33320]="RG_INTEGER",e[e.RGB_INTEGER=36248]="RGB_INTEGER",e[e.RGBA_INTEGER=36249]="RGBA_INTEGER"}(ze||(ze={})),function(e){e[e.RGBA4=32854]="RGBA4",e[e.R16F=33325]="R16F",e[e.RG16F=33327]="RG16F",e[e.RGB32F=34837]="RGB32F",e[e.RGBA16F=34842]="RGBA16F",e[e.R32F=33326]="R32F",e[e.RG32F=33328]="RG32F",e[e.RGBA32F=34836]="RGBA32F",e[e.R11F_G11F_B10F=35898]="R11F_G11F_B10F",e[e.RGB8=32849]="RGB8",e[e.RGBA8=32856]="RGBA8",e[e.RGB5_A1=32855]="RGB5_A1",e[e.R8=33321]="R8",e[e.RG8=33323]="RG8",e[e.R8I=33329]="R8I",e[e.R8UI=33330]="R8UI",e[e.R16I=33331]="R16I",e[e.R16UI=33332]="R16UI",e[e.R32I=33333]="R32I",e[e.R32UI=33334]="R32UI",e[e.RG8I=33335]="RG8I",e[e.RG8UI=33336]="RG8UI",e[e.RG16I=33337]="RG16I",e[e.RG16UI=33338]="RG16UI",e[e.RG32I=33339]="RG32I",e[e.RG32UI=33340]="RG32UI",e[e.RGB16F=34843]="RGB16F",e[e.RGB9_E5=35901]="RGB9_E5",e[e.SRGB8=35905]="SRGB8",e[e.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",e[e.RGB565=36194]="RGB565",e[e.RGBA32UI=36208]="RGBA32UI",e[e.RGB32UI=36209]="RGB32UI",e[e.RGBA16UI=36214]="RGBA16UI",e[e.RGB16UI=36215]="RGB16UI",e[e.RGBA8UI=36220]="RGBA8UI",e[e.RGB8UI=36221]="RGB8UI",e[e.RGBA32I=36226]="RGBA32I",e[e.RGB32I=36227]="RGB32I",e[e.RGBA16I=36232]="RGBA16I",e[e.RGB16I=36233]="RGB16I",e[e.RGBA8I=36238]="RGBA8I",e[e.RGB8I=36239]="RGB8I",e[e.R8_SNORM=36756]="R8_SNORM",e[e.RG8_SNORM=36757]="RG8_SNORM",e[e.RGB8_SNORM=36758]="RGB8_SNORM",e[e.RGBA8_SNORM=36759]="RGBA8_SNORM",e[e.RGB10_A2=32857]="RGB10_A2",e[e.RGB10_A2UI=36975]="RGB10_A2UI"}(gt||(gt={})),function(e){e[e.FLOAT=5126]="FLOAT",e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",e[e.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",e[e.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",e[e.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",e[e.BYTE=5120]="BYTE",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.SHORT=5122]="SHORT",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.INT=5124]="INT",e[e.HALF_FLOAT=5131]="HALF_FLOAT",e[e.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",e[e.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",e[e.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",e[e.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV"}(Ct||(Ct={})),function(e){e[e.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",e[e.STENCIL_INDEX8=36168]="STENCIL_INDEX8",e[e.DEPTH_STENCIL=34041]="DEPTH_STENCIL",e[e.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",e[e.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",e[e.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",e[e.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8"}(ol||(ol={})),function(e){e[e.STATIC_DRAW=35044]="STATIC_DRAW",e[e.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",e[e.STREAM_DRAW=35040]="STREAM_DRAW",e[e.STATIC_READ=35045]="STATIC_READ",e[e.DYNAMIC_READ=35049]="DYNAMIC_READ",e[e.STREAM_READ=35041]="STREAM_READ",e[e.STATIC_COPY=35046]="STATIC_COPY",e[e.DYNAMIC_COPY=35050]="DYNAMIC_COPY",e[e.STREAM_COPY=35042]="STREAM_COPY"}(Cr||(Cr={})),function(e){e[e.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",e[e.VERTEX_SHADER=35633]="VERTEX_SHADER"}(Yu||(Yu={})),function(e){e[e.FRAMEBUFFER=36160]="FRAMEBUFFER",e[e.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER",e[e.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER"}(Qn||(Qn={})),function(e){e[e.TEXTURE=0]="TEXTURE",e[e.RENDER_BUFFER=1]="RENDER_BUFFER",e[e.CUBEMAP=2]="CUBEMAP"}(us||(us={})),function(e){e[e.NONE=0]="NONE",e[e.DEPTH_RENDER_BUFFER=1]="DEPTH_RENDER_BUFFER",e[e.STENCIL_RENDER_BUFFER=2]="STENCIL_RENDER_BUFFER",e[e.DEPTH_STENCIL_RENDER_BUFFER=3]="DEPTH_STENCIL_RENDER_BUFFER",e[e.DEPTH_STENCIL_TEXTURE=4]="DEPTH_STENCIL_TEXTURE"}(Pr||(Pr={}));const r7=33984;var Nn,Uu;(function(e){e[e.Texture=0]="Texture",e[e.BufferObject=1]="BufferObject",e[e.VertexArrayObject=2]="VertexArrayObject",e[e.Shader=3]="Shader",e[e.Program=4]="Program",e[e.FramebufferObject=5]="FramebufferObject",e[e.Renderbuffer=6]="Renderbuffer",e[e.Sync=7]="Sync",e[e.COUNT=8]="COUNT"})(Nn||(Nn={})),function(e){e[e.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",e[e.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1",e[e.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2",e[e.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3",e[e.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4",e[e.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5",e[e.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6",e[e.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7",e[e.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8",e[e.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9",e[e.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10",e[e.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11",e[e.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12",e[e.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13",e[e.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14",e[e.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15"}(Uu||(Uu={}));const sde=33306;var ls,nde,ode,ade,SV,nQ,lde;(function(e){e[e.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",e[e.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",e[e.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",e[e.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",e[e.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",e[e.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",e[e.COMPRESSED_SRGB8_ETC2=37493]="COMPRESSED_SRGB8_ETC2",e[e.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",e[e.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",e[e.COMPRESSED_RGBA8_ETC2_EAC=37496]="COMPRESSED_RGBA8_ETC2_EAC",e[e.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC"})(ls||(ls={})),function(e){e[e.FLOAT=5126]="FLOAT",e[e.FLOAT_VEC2=35664]="FLOAT_VEC2",e[e.FLOAT_VEC3=35665]="FLOAT_VEC3",e[e.FLOAT_VEC4=35666]="FLOAT_VEC4",e[e.INT=5124]="INT",e[e.INT_VEC2=35667]="INT_VEC2",e[e.INT_VEC3=35668]="INT_VEC3",e[e.INT_VEC4=35669]="INT_VEC4",e[e.BOOL=35670]="BOOL",e[e.BOOL_VEC2=35671]="BOOL_VEC2",e[e.BOOL_VEC3=35672]="BOOL_VEC3",e[e.BOOL_VEC4=35673]="BOOL_VEC4",e[e.FLOAT_MAT2=35674]="FLOAT_MAT2",e[e.FLOAT_MAT3=35675]="FLOAT_MAT3",e[e.FLOAT_MAT4=35676]="FLOAT_MAT4",e[e.SAMPLER_2D=35678]="SAMPLER_2D",e[e.SAMPLER_CUBE=35680]="SAMPLER_CUBE",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2",e[e.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3",e[e.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4",e[e.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3",e[e.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4",e[e.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2",e[e.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4",e[e.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2",e[e.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3",e[e.SAMPLER_3D=35679]="SAMPLER_3D",e[e.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW",e[e.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY",e[e.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW",e[e.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW",e[e.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D",e[e.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D",e[e.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE",e[e.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY",e[e.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D",e[e.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D",e[e.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE",e[e.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY"}(nde||(nde={})),function(e){e[e.OBJECT_TYPE=37138]="OBJECT_TYPE",e[e.SYNC_CONDITION=37139]="SYNC_CONDITION",e[e.SYNC_STATUS=37140]="SYNC_STATUS",e[e.SYNC_FLAGS=37141]="SYNC_FLAGS"}(ode||(ode={})),function(e){e[e.UNSIGNALED=37144]="UNSIGNALED",e[e.SIGNALED=37145]="SIGNALED"}(ade||(ade={})),function(e){e[e.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED",e[e.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED",e[e.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED",e[e.WAIT_FAILED=37149]="WAIT_FAILED"}(SV||(SV={})),function(e){e[e.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE"}(nQ||(nQ={})),function(e){e[e.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT"}(lde||(lde={}));class gi{constructor(t,r,i){this.release=i,r&&(this.initializeConfiguration(t,r),this._configuration=r.snapshot()),this._program=this.initializeProgram(t),this._pipeline=this.initializePipeline(t.rctx.capabilities)}destroy(){this._program=Ye(this._program),this._pipeline=this._configuration=null}reload(t){Ye(this._program),this._program=this.initializeProgram(t),this._pipeline=this.initializePipeline(t.rctx.capabilities)}get program(){return this._program}get compiled(){return this.program.isCompiled}get key(){return this._configuration.key}get configuration(){return this._configuration}bindPass(t,r){this.program.bindPass(t,r)}bindDraw(t,r){this.program.bindDraw(t,r),this.program.rebindTextures()}bindPipelineState(t,r=null,i){t.setPipelineState(this.getPipelineState(r,i))}ensureAttributeLocations(t){this.program.assertCompatibleVertexAttributeLocations(t)}get primitiveType(){return Lt.TRIANGLES}getPipelineState(t,r){return this._pipeline}initializeConfiguration(t,r){}}const zr=new Map([[O.POSITION,0],[O.NORMAL,1],[O.UV0,2],[O.COLOR,3],[O.SIZE,4],[O.TANGENT,4],[O.AUXPOS1,5],[O.SYMBOLCOLOR,5],[O.AUXPOS2,6],[O.FEATUREATTRIBUTE,6],[O.INSTANCEFEATUREATTRIBUTE,6],[O.INSTANCECOLOR,7],[O.MODEL,8],[O.MODELNORMAL,12],[O.MODELORIGINHI,11],[O.MODELORIGINLO,15]]),int=fe.getLogger("esri/views/webgl");function snt(e,t){switch(t){case e.INVALID_ENUM:return"Invalid Enum. An unacceptable value has been specified for an enumerated argument.";case e.INVALID_VALUE:return"Invalid Value. A numeric argument is out of range.";case e.INVALID_OPERATION:return"Invalid Operation. The specified command is not allowed for the current state.";case e.INVALID_FRAMEBUFFER_OPERATION:return"Invalid Framebuffer operation. The currently bound framebuffer is not framebuffer complete when trying to render to or to read from it.";case e.OUT_OF_MEMORY:return"Out of memory. Not enough memory is left to execute the command.";case e.CONTEXT_LOST_WEBGL:return"WebGL context has been lost";default:return"Unknown error"}}const jRe=!!he("enable-feature:webgl-debug");function ad(){return jRe}function LI(){return jRe}function H_(e){if(ad()){const t=e.getError();if(t){const r=snt(e,t),i=new Error().stack;int.error(new j("webgl-error","WebGL error occured",{message:r,stack:i}))}}}class oi{constructor(t,r,i){this._context=t,this._locations=i,this._textures=new Map,this._freeTextureUnits=new Xt({deallocator:null}),this._glProgram=t.programCache.acquire(r.generate("vertex"),r.generate("fragment"),i),this._glProgram.stop=()=>{throw new Error("Wrapped _glProgram used directly")},this.bindPass=r.generateBind(Vr.Pass,this),this.bindDraw=r.generateBind(Vr.Draw,this),this._fragmentUniforms=ad()?r.fragmentUniforms:null}dispose(){this._glProgram.dispose()}get glName(){return this._glProgram.glName}get isCompiled(){return this._glProgram.isCompiled}setUniform1b(t,r){this._glProgram.setUniform1i(t,r?1:0)}setUniform1i(t,r){this._glProgram.setUniform1i(t,r)}setUniform1f(t,r){this._glProgram.setUniform1f(t,r)}setUniform2f(t,r,i){this._glProgram.setUniform2f(t,r,i)}setUniform2fv(t,r){this._glProgram.setUniform2fv(t,r)}setUniform3f(t,r,i,s){this._glProgram.setUniform3f(t,r,i,s)}setUniform3fv(t,r){this._glProgram.setUniform3fv(t,r)}setUniform4f(t,r,i,s,n){this._glProgram.setUniform4f(t,r,i,s,n)}setUniform4fv(t,r){this._glProgram.setUniform4fv(t,r)}setUniformMatrix3fv(t,r){this._glProgram.setUniformMatrix3fv(t,r)}setUniformMatrix4fv(t,r){this._glProgram.setUniformMatrix4fv(t,r)}setUniform1fv(t,r){this._glProgram.setUniform1fv(t,r)}setUniform1iv(t,r){this._glProgram.setUniform1iv(t,r)}setUniform2iv(t,r){this._glProgram.setUniform3iv(t,r)}setUniform3iv(t,r){this._glProgram.setUniform3iv(t,r)}setUniform4iv(t,r){this._glProgram.setUniform4iv(t,r)}assertCompatibleVertexAttributeLocations(t){t.locations!==this._locations&&console.error("VertexAttributeLocations are incompatible")}stop(){this._textures.clear(),this._freeTextureUnits.clear()}bindTexture(t,r){if(R(r)||r.glName==null){const s=this._textures.get(t);return s&&(this._context.bindTexture(null,s.unit),this._freeTextureUnit(s),this._textures.delete(t)),null}let i=this._textures.get(t);return i==null?(i=this._allocTextureUnit(r),this._textures.set(t,i)):i.texture=r,this._context.useProgram(this),this.setUniform1i(t,i.unit),this._context.bindTexture(r,i.unit),i.unit}rebindTextures(){this._context.useProgram(this),this._textures.forEach((t,r)=>{this._context.bindTexture(t.texture,t.unit),this.setUniform1i(r,t.unit)}),b(this._fragmentUniforms)&&this._fragmentUniforms.forEach(t=>{t.type!=="sampler2D"&&t.type!=="samplerCube"||this._textures.has(t.name)||console.error(`Texture sampler ${t.name} has no bound texture`)})}_allocTextureUnit(t){return{texture:t,unit:this._freeTextureUnits.length===0?this._textures.size:this._freeTextureUnits.pop()}}_freeTextureUnit(t){this._freeTextureUnits.push(t.unit)}}var fi,vT,sx,yt,Ws,Nc,tc,EA,v0,rc,f1,CA,hi,_T;(function(e){e[e.None=0]="None",e[e.Front=1]="Front",e[e.Back=2]="Back",e[e.COUNT=3]="COUNT"})(fi||(fi={})),function(e){e[e.Less=0]="Less",e[e.Lequal=1]="Lequal",e[e.COUNT=2]="COUNT"}(vT||(vT={})),function(e){e[e.NONE=0]="NONE",e[e.SMAA=1]="SMAA"}(sx||(sx={})),function(e){e[e.Color=0]="Color",e[e.Alpha=1]="Alpha",e[e.FrontFace=2]="FrontFace",e[e.NONE=3]="NONE",e[e.COUNT=4]="COUNT"}(yt||(yt={})),function(e){e[e.BACKGROUND=0]="BACKGROUND",e[e.UPDATE=1]="UPDATE"}(Ws||(Ws={})),function(e){e[e.NOT_LOADED=0]="NOT_LOADED",e[e.LOADING=1]="LOADING",e[e.LOADED=2]="LOADED"}(Nc||(Nc={})),function(e){e[e.IntegratedMeshMaskExcluded=1]="IntegratedMeshMaskExcluded",e[e.OutlineVisualElementMask=2]="OutlineVisualElementMask"}(tc||(tc={})),function(e){e[e.ASYNC=0]="ASYNC",e[e.SYNC=1]="SYNC"}(EA||(EA={})),function(e){e[e.Highlight=0]="Highlight",e[e.MaskOccludee=1]="MaskOccludee",e[e.COUNT=2]="COUNT"}(v0||(v0={})),function(e){e[e.Triangle=0]="Triangle",e[e.Point=1]="Point",e[e.Line=2]="Line"}(rc||(rc={})),function(e){e[e.STRETCH=1]="STRETCH",e[e.PAD=2]="PAD"}(f1||(f1={})),function(e){e[e.CHANGED=0]="CHANGED",e[e.UNCHANGED=1]="UNCHANGED"}(CA||(CA={})),function(e){e[e.Blend=0]="Blend",e[e.Opaque=1]="Opaque",e[e.Mask=2]="Mask",e[e.MaskBlend=3]="MaskBlend",e[e.COUNT=4]="COUNT"}(hi||(hi={})),function(e){e[e.OFF=0]="OFF",e[e.ON=1]="ON"}(_T||(_T={}));function bg(e,t,r=y0.ADD,i=[0,0,0,0]){return{srcRgb:e,srcAlpha:e,dstRgb:t,dstAlpha:t,opRgb:r,opAlpha:r,color:{r:i[0],g:i[1],b:i[2],a:i[3]}}}function No(e,t,r,i,s=y0.ADD,n=y0.ADD,o=[0,0,0,0]){return{srcRgb:e,srcAlpha:t,dstRgb:r,dstAlpha:i,opRgb:s,opAlpha:n,color:{r:o[0],g:o[1],b:o[2],a:o[3]}}}const nie={face:af.BACK,mode:SA.CCW},HRe={face:af.FRONT,mode:SA.CCW},dB=e=>e===fi.Back?nie:e===fi.Front?HRe:null,cc={zNear:0,zFar:1},or={r:!0,g:!0,b:!0,a:!0};function nnt(e){return pnt.intern(e)}function ont(e){return fnt.intern(e)}function ant(e){return mnt.intern(e)}function lnt(e){return gnt.intern(e)}function cnt(e){return ynt.intern(e)}function unt(e){return vnt.intern(e)}function hnt(e){return _nt.intern(e)}function dnt(e){return bnt.intern(e)}function Gt(e){return wnt.intern(e)}class O0{constructor(t,r){this.makeKey=t,this.makeRef=r,this.interns=new Map}intern(t){if(!t)return null;const r=this.makeKey(t),i=this.interns;return i.has(r)||i.set(r,this.makeRef(t)),i.get(r)}}function M0(e){return"["+e.join(",")+"]"}const pnt=new O0(qRe,e=>({__tag:"Blending",...e}));function qRe(e){return e?M0([e.srcRgb,e.srcAlpha,e.dstRgb,e.dstAlpha,e.opRgb,e.opAlpha,e.color.r,e.color.g,e.color.b,e.color.a]):null}const fnt=new O0(WRe,e=>({__tag:"Culling",...e}));function WRe(e){return e?M0([e.face,e.mode]):null}const mnt=new O0(XRe,e=>({__tag:"PolygonOffset",...e}));function XRe(e){return e?M0([e.factor,e.units]):null}const gnt=new O0(ZRe,e=>({__tag:"DepthTest",...e}));function ZRe(e){return e?M0([e.func]):null}const ynt=new O0(YRe,e=>({__tag:"StencilTest",...e}));function YRe(e){return e?M0([e.function.func,e.function.ref,e.function.mask,e.operation.fail,e.operation.zFail,e.operation.zPass]):null}const vnt=new O0(QRe,e=>({__tag:"DepthWrite",...e}));function QRe(e){return e?M0([e.zNear,e.zFar]):null}const _nt=new O0(JRe,e=>({__tag:"ColorWrite",...e}));function JRe(e){return e?M0([e.r,e.g,e.b,e.a]):null}const bnt=new O0(KRe,e=>({__tag:"StencilWrite",...e}));function KRe(e){return e?M0([e.mask]):null}const wnt=new O0(xnt,e=>({blending:nnt(e.blending),culling:ont(e.culling),polygonOffset:ant(e.polygonOffset),depthTest:lnt(e.depthTest),stencilTest:cnt(e.stencilTest),depthWrite:unt(e.depthWrite),colorWrite:hnt(e.colorWrite),stencilWrite:dnt(e.stencilWrite)}));function xnt(e){return e?M0([qRe(e.blending),WRe(e.culling),XRe(e.polygonOffset),ZRe(e.depthTest),YRe(e.stencilTest),QRe(e.depthWrite),JRe(e.colorWrite),KRe(e.stencilWrite)]):null}class Tnt{constructor(t){this._pipelineInvalid=!0,this._blendingInvalid=!0,this._cullingInvalid=!0,this._polygonOffsetInvalid=!0,this._depthTestInvalid=!0,this._stencilTestInvalid=!0,this._depthWriteInvalid=!0,this._colorWriteInvalid=!0,this._stencilWriteInvalid=!0,this._stateSetters=t}setPipeline(t){(this._pipelineInvalid||t!==this._pipeline)&&(this._setBlending(t.blending),this._setCulling(t.culling),this._setPolygonOffset(t.polygonOffset),this._setDepthTest(t.depthTest),this._setStencilTest(t.stencilTest),this._setDepthWrite(t.depthWrite),this._setColorWrite(t.colorWrite),this._setStencilWrite(t.stencilWrite),this._pipeline=t),this._pipelineInvalid=!1}invalidateBlending(){this._blendingInvalid=!0,this._pipelineInvalid=!0}invalidateCulling(){this._cullingInvalid=!0,this._pipelineInvalid=!0}invalidatePolygonOffset(){this._polygonOffsetInvalid=!0,this._pipelineInvalid=!0}invalidateDepthTest(){this._depthTestInvalid=!0,this._pipelineInvalid=!0}invalidateStencilTest(){this._stencilTestInvalid=!0,this._pipelineInvalid=!0}invalidateDepthWrite(){this._depthWriteInvalid=!0,this._pipelineInvalid=!0}invalidateColorWrite(){this._colorWriteInvalid=!0,this._pipelineInvalid=!0}invalidateStencilWrite(){this._stencilTestInvalid=!0,this._pipelineInvalid=!0}_setBlending(t){this._blending=this._setSubState(t,this._blending,this._blendingInvalid,this._stateSetters.setBlending),this._blendingInvalid=!1}_setCulling(t){this._culling=this._setSubState(t,this._culling,this._cullingInvalid,this._stateSetters.setCulling),this._cullingInvalid=!1}_setPolygonOffset(t){this._polygonOffset=this._setSubState(t,this._polygonOffset,this._polygonOffsetInvalid,this._stateSetters.setPolygonOffset),this._polygonOffsetInvalid=!1}_setDepthTest(t){this._depthTest=this._setSubState(t,this._depthTest,this._depthTestInvalid,this._stateSetters.setDepthTest),this._depthTestInvalid=!1}_setStencilTest(t){this._stencilTest=this._setSubState(t,this._stencilTest,this._stencilTestInvalid,this._stateSetters.setStencilTest),this._stencilTestInvalid=!1}_setDepthWrite(t){this._depthWrite=this._setSubState(t,this._depthWrite,this._depthWriteInvalid,this._stateSetters.setDepthWrite),this._depthWriteInvalid=!1}_setColorWrite(t){this._colorWrite=this._setSubState(t,this._colorWrite,this._colorWriteInvalid,this._stateSetters.setColorWrite),this._colorWriteInvalid=!1}_setStencilWrite(t){this._stencilWrite=this._setSubState(t,this._stencilWrite,this._stencilWriteInvalid,this._stateSetters.setStencilWrite),this._stencilTestInvalid=!1}_setSubState(t,r,i,s){return(i||t!==r)&&(s(t),this._pipelineInvalid=!0),t}}class DI extends gi{initializeProgram(t){const r=DI.shader.get().build(this.configuration);return new oi(t.rctx,r,zr)}initializePipeline(){return this.configuration.haze?Gt({blending:No(Ae.ONE,Ae.ZERO,Ae.ONE_MINUS_SRC_COLOR,Ae.ONE),colorWrite:or}):Gt({blending:No(Ae.SRC_ALPHA,Ae.ONE,Ae.ONE_MINUS_SRC_ALPHA,Ae.ONE_MINUS_SRC_ALPHA),depthTest:{func:_i.LEQUAL},colorWrite:or})}}DI.shader=new ni(rnt,()=>ie(()=>import("./ChapmanAtmosphere.glsl.6eca827f.js"),[],import.meta.url));class vl{constructor(){this._key="",this._keyDirty=!1,this._parameterBits=this._parameterBits?this._parameterBits.map(()=>0):[],this._parameterNames||(this._parameterNames=[])}get key(){return this._keyDirty&&(this._keyDirty=!1,this._key=String.fromCharCode.apply(String,this._parameterBits)),this._key}snapshot(){const t=this._parameterNames,r={key:this.key};for(const i of t)r[i]=this[i];return r}}function q(e={}){return(t,r)=>{var i,s;if(t._parameterNames=(i=t._parameterNames)!=null?i:[],t._parameterNames.push(r),e.constValue!=null)Object.defineProperty(t,r,{get:()=>e.constValue});else{const n=t._parameterNames.length-1,o=e.count||2,a=Math.ceil(Math.log2(o)),l=(s=t._parameterBits)!=null?s:[0];let c=0;for(;l[c]+a>16;)c++,c>=l.length&&l.push(0);t._parameterBits=l;const h=l[c],p=(1<<a)-1<<h;l[c]+=a,Object.defineProperty(t,r,{get(){return this[n]},set(f){if(this[n]!==f&&(this[n]=f,this._keyDirty=!0,this._parameterBits[c]=this._parameterBits[c]&~p|+f<<h&p,typeof f!="number"&&typeof f!="boolean"))throw"Configuration value for "+r+" must be boolean or number, got "+typeof f}})}}}class eOe extends vl{constructor(){super(...arguments),this.haze=!1}}u([q()],eOe.prototype,"haze",void 0);class Io{constructor(t,r,i,s,n,o=!1,a=0){this.name=t,this.count=r,this.type=i,this.offset=s,this.stride=n,this.normalized=o,this.divisor=a}}new Io(O.POSITION,3,pt.FLOAT,0,12);new Io(O.POSITION,3,pt.FLOAT,0,20),new Io(O.UV0,2,pt.FLOAT,12,20);new Io(O.POSITION,3,pt.FLOAT,0,32),new Io(O.NORMAL,3,pt.FLOAT,12,32),new Io(O.UV0,2,pt.FLOAT,24,32);new Io(O.POSITION,3,pt.FLOAT,0,16),new Io(O.COLOR,4,pt.UNSIGNED_BYTE,12,16);const oie=[new Io(O.POSITION,2,pt.FLOAT,0,8)],mL=[new Io(O.POSITION,2,pt.FLOAT,0,16),new Io(O.UV0,2,pt.FLOAT,8,16)];var mr;function Snt(e,t,r={}){const i=tOe(e);for(;i.length>1;){const s=EV(t,i.shift(),r);if(b(s))return s}return Ent(t,i.shift(),r)}function tOe(e){const t=he("esri-force-webgl");if(t===mr.WEBGL1||t===mr.WEBGL2)return[t];switch(e){case"2d":return he("mac")&&he("chrome")?[mr.WEBGL1,mr.WEBGL2]:[mr.WEBGL2,mr.WEBGL1];case"3d":return[mr.WEBGL2,mr.WEBGL1]}}function Ent(e,t,r={}){if(!window.WebGLRenderingContext)return cde(e,Cnt),null;const i=EV(e,t,r);return R(i)&&cde(e,Ant),i}function EV(e,t,r={}){const i=t===mr.WEBGL1?["webgl","experimental-webgl","webkit-3d","moz-webgl"]:["webgl2"];let s=null;for(const n of i){try{s=e.getContext(n,r)}catch{}if(s)break}return s}function cde(e,t){const r=e.parentNode;r&&(r.innerHTML='<table style="background-color: #8CE; width: 100%; height: 100%;"><tr><td align="center"><div style="display: table-cell; vertical-align: middle;"><div style="">'+t+"</div></div></td></tr></table>")}(function(e){e[e.WEBGL1=1]="WEBGL1",e[e.WEBGL2=2]="WEBGL2"})(mr||(mr={}));const Cnt='This page requires a browser that supports WebGL.<br/><a href="http://get.webgl.org">Click here to upgrade your browser.</a>',Ant=`It doesn't appear your computer can support WebGL.<br/><a href="http://get.webgl.org/troubleshooting/">Click here for more information.</a>`,fu=fe.getLogger("esri.views.webgl.BufferObject");function Rnt(e){return z4e(e)}class cr{constructor(t,r,i,s){this._context=t,this.bufferType=r,this.usage=i,this._glName=null,this._size=-1,this._indexType=void 0,t.instanceCounter.increment(Nn.BufferObject,this),this._glName=this._context.gl.createBuffer(),H_(this._context.gl),s&&this.setData(s)}static createIndex(t,r,i){return new cr(t,Tt.ELEMENT_ARRAY_BUFFER,r,i)}static createVertex(t,r,i){return new cr(t,Tt.ARRAY_BUFFER,r,i)}static createUniform(t,r,i){if(t.type!==mr.WEBGL2)throw new Error("Uniform buffers are supported in WebGL2 only!");return new cr(t,Tt.UNIFORM_BUFFER,r,i)}static createPixelPack(t,r=Cr.STREAM_READ,i){if(t.type!==mr.WEBGL2)throw new Error("Pixel pack buffers are supported in WebGL2 only!");const s=new cr(t,Tt.PIXEL_PACK_BUFFER,r);return i&&s.setSize(i),s}static createPixelUnpack(t,r=Cr.STREAM_DRAW,i){if(t.type!==mr.WEBGL2)throw new Error("Pixel unpack buffers are supported in WebGL2 only!");return new cr(t,Tt.PIXEL_UNPACK_BUFFER,r,i)}get glName(){return this._glName}get size(){return this._size}get indexType(){return this._indexType}get byteSize(){return this.bufferType===Tt.ELEMENT_ARRAY_BUFFER?this._indexType===pt.UNSIGNED_INT?4*this._size:2*this._size:this._size}get _isVAOAware(){return this.bufferType===Tt.ELEMENT_ARRAY_BUFFER||this.bufferType===Tt.ARRAY_BUFFER}dispose(){var t;(t=this._context)!=null&&t.gl?(this._glName&&(this._context.gl.deleteBuffer(this._glName),this._glName=null),this._context.instanceCounter.decrement(Nn.BufferObject,this),this._context=null):this._glName&&fu.warn("Leaked WebGL buffer object")}setSize(t,r=null){if(t<=0&&fu.error("Buffer size needs to be positive!"),this.bufferType===Tt.ELEMENT_ARRAY_BUFFER&&b(r))switch(this._indexType=r,r){case pt.UNSIGNED_SHORT:t*=2;break;case pt.UNSIGNED_INT:t*=4}this._setBufferData(t)}setData(t){if(!t)return;let r=t.byteLength;this.bufferType===Tt.ELEMENT_ARRAY_BUFFER&&(iU(t)&&(r/=2,this._indexType=pt.UNSIGNED_SHORT),sU(t)&&(r/=4,this._indexType=pt.UNSIGNED_INT)),this._setBufferData(r,t)}_setBufferData(t,r=null){this._size=t;const i=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null),this._context.bindBuffer(this);const s=this._context.gl;b(r)?s.bufferData(this.bufferType,r,this.usage):s.bufferData(this.bufferType,t,this.usage),H_(s),this._isVAOAware&&this._context.bindVAO(i)}setSubData(t,r=0,i=0,s=t.byteLength){if(!t)return;(r<0||r>=this._size)&&fu.error("offset is out of range!");let n=r,o=i,a=s,l=t.byteLength;this.bufferType===Tt.ELEMENT_ARRAY_BUFFER&&(iU(t)?(l/=2,n*=2,o*=2,a*=2):sU(t)&&(l/=4,n*=4,o*=4,a*=4)),s===void 0&&(s=l-1),i>=s&&fu.error("end must be bigger than start!"),r+i-s>this._size&&fu.error("An attempt to write beyond the end of the buffer!");const c=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null),this._context.bindBuffer(this);const h=this._context.gl,p=ArrayBuffer.isView(t)?t.buffer:t,f=o===0&&a===t.byteLength?p:p.slice(o,a);h.bufferSubData(this.bufferType,n,f),H_(h),this._isVAOAware&&this._context.bindVAO(c)}setSubDataFromView(t,r,i,s){if(!t)return;(r<0||r>=this._size)&&fu.error("offset is out of range!"),i>=s&&fu.error("end must be bigger than start!"),r+i-s>this._size&&fu.error("An attempt to write beyond the end of the buffer!");const n=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null),this._context.bindBuffer(this);const o=this._context.gl;if(this._context.type===mr.WEBGL2)o.bufferSubData(this.bufferType,r*t.BYTES_PER_ELEMENT,t,i,s-i);else{const a=i===0&&s===t.length?t:t.subarray(i,s);o.bufferSubData(this.bufferType,r*t.BYTES_PER_ELEMENT,a)}H_(o),this._isVAOAware&&this._context.bindVAO(n)}getSubData(t,r=0,i,s){if(this._context.type!==mr.WEBGL2)return void fu.error("Get buffer subdata is supported in WebGL2 only!");if(i<0||s<0)return void fu.error("Problem getting subdata: offset and length were less than zero!");const n=Rnt(t)?t.BYTES_PER_ELEMENT:1;if(n*((i!=null?i:0)+(s!=null?s:0))>t.byteLength)return void fu.error("Problem getting subdata: offset and length exceeded destination size!");r+n*(s!=null?s:0)>this.byteSize&&fu.warn("Potential problem getting subdata: requested data exceeds buffer size!");const o=this._context.gl;this._context.bindBuffer(this,Tt.COPY_READ_BUFFER),o.getBufferSubData(Tt.COPY_READ_BUFFER,r,t,i,s),this._context.unbindBuffer(Tt.COPY_READ_BUFFER)}async getSubDataAsync(t,r=0,i,s){this._context.type===mr.WEBGL2?(await this._context.clientWaitAsync(),this.getSubData(t,r,i,s)):fu.error("Get buffer subdata is supported in WebGL2 only!")}}function eo(e){return window.WebGL2RenderingContext&&e instanceof window.WebGL2RenderingContext}const ude=4;class nt{constructor(t,r,i=null){if(this._context=t,this.type="texture",this._glName=null,this._descriptor=void 0,this._samplingModeDirty=!1,this._wrapModeDirty=!1,this._wasImmutablyAllocated=!1,t.instanceCounter.increment(Nn.Texture,this),this._descriptor={target:mt.TEXTURE_2D,samplingMode:et.LINEAR,wrapMode:xt.REPEAT,flipped:!1,hasMipmap:!1,isOpaque:!1,unpackAlignment:4,preMultiplyAlpha:!1,isImmutable:!1,...r},t.type!==mr.WEBGL2&&(this._descriptor.isImmutable&&(this._descriptor.isImmutable=!1),pb(this._descriptor.target)))throw new Error("3D and array textures are not supported in WebGL1");this._descriptor.target===mt.TEXTURE_CUBE_MAP?this._setDataCubeMap(i):this.setData(i)}get glName(){return this._glName}get descriptor(){return this._descriptor}get isDirty(){return this._samplingModeDirty||this._wrapModeDirty}dispose(){this._context.gl&&this._glName&&(this._context.unbindTexture(this),this._context.gl.deleteTexture(this._glName),this._glName=null,this._context.instanceCounter.decrement(Nn.Texture,this))}release(){this.dispose()}resize(t,r){const i=this._descriptor;if(i.width!==t||i.height!==r){if(this._wasImmutablyAllocated)throw new Error("Immutable textures can't be resized!");i.width=t,i.height=r,this._descriptor.target===mt.TEXTURE_CUBE_MAP?this._setDataCubeMap(null):this.setData(null)}}_setDataCubeMap(t=null){for(let r=mt.TEXTURE_CUBE_MAP_POSITIVE_X;r<=mt.TEXTURE_CUBE_MAP_NEGATIVE_Z;r++)this._setData(t,r)}setData(t){this._setData(t)}_setData(t,r){var c;if(!this._context||!this._context.gl)return;const i=this._context.gl;this._glName||(this._glName=i.createTexture()),t===void 0&&(t=null);const s=this._descriptor;r!=null||(r=s.target);const n=pb(r);t===null&&(s.width=s.width||ude,s.height=s.height||ude,n&&(s.depth=(c=s.depth)!=null?c:1));const o=this._context.bindTexture(this,nt.TEXTURE_UNIT_FOR_UPDATES);this._context.setActiveTexture(nt.TEXTURE_UNIT_FOR_UPDATES),nt._validateTexture(this._context,s),this._configurePixelStorage();const a=s.pixelFormat;let l=s.internalFormat?s.internalFormat:this._deriveInternalFormat(a,s.dataType);if(i7(t)){let h=t.width,p=t.height;const f=1;t instanceof HTMLVideoElement&&(h=t.videoWidth,p=t.videoHeight),s.width&&s.height,n&&s.depth,s.isImmutable&&!this._wasImmutablyAllocated&&this._texStorage(r,l,s.hasMipmap,h,p,f),this._texImage(r,0,l,h,p,f,t),H_(i),s.hasMipmap&&this.generateMipmap(),s.width===void 0&&(s.width=h),s.height===void 0&&(s.height=p),n&&s.depth===void 0&&(s.depth=f)}else{const{width:h,height:p,depth:f}=s;if(h!=null&&p!=null||console.error("Width and height must be specified!"),n&&f==null&&console.error("Depth must be specified!"),s.isImmutable&&!this._wasImmutablyAllocated&&this._texStorage(r,l,s.hasMipmap,h,p,f),i.DEPTH24_STENCIL8&&l===i.DEPTH_STENCIL&&(l=i.DEPTH24_STENCIL8),H5(t)){const m=t.levels,g=hde(r,h,p,f),v=Math.min(g-1,m.length-1);eo(i)?i.texParameteri(s.target,i.TEXTURE_MAX_LEVEL,v):s.hasMipmap=s.hasMipmap&&g===m.length;const w=l;if(!Mnt(w))throw new Error("Attempting to use compressed data with an umcompressed format!");this._forEachMipmapLevel((_,T,x,E)=>{const C=m[Math.min(_,m.length-1)];this._compressedTexImage(r,_,w,T,x,E,C)},v)}else b(t)?(this._texImage(r,0,l,h,p,f,t),H_(i),s.hasMipmap&&this.generateMipmap()):this._forEachMipmapLevel((m,g,v,w)=>{this._texImage(r,m,l,g,v,w,null),H_(i)})}nt._applySamplingMode(i,this._descriptor),nt._applyWrapMode(i,this._descriptor),nt._applyAnisotropicFilteringParameters(this._context,this._descriptor),H_(i),this._context.bindTexture(o,nt.TEXTURE_UNIT_FOR_UPDATES)}updateData(t,r,i,s,n,o){o||console.error("An attempt to use uninitialized data!"),this._glName||console.error("An attempt to update uninitialized texture!");const a=this._context.gl,l=this._descriptor,{pixelFormat:c,internalFormat:h,dataType:p,isImmutable:f,target:m}=l;if(f&&!this._wasImmutablyAllocated)throw new Error("Cannot update immutable texture before allocation!");const g=this._context.bindTexture(this,nt.TEXTURE_UNIT_FOR_UPDATES);(r<0||i<0||s>l.width||n>l.height||r+s>l.width||i+n>l.height)&&console.error("An attempt to update out of bounds of the texture!"),this._configurePixelStorage(),i7(o)?a.texSubImage2D(m,t,r,i,c,p,o):H5(o)?a.compressedTexSubImage2D(m,t,r,i,s,n,h,o.levels[t]):a.texSubImage2D(m,t,r,i,s,n,c,p,o),this._context.bindTexture(g,nt.TEXTURE_UNIT_FOR_UPDATES)}updateData3D(t,r,i,s,n,o,a,l){l||console.error("An attempt to use uninitialized data!"),this._glName||console.error("An attempt to update uninitialized texture!");const c=this._context.gl;if(!eo(c))throw new Error("3D textures are not supported in WebGL1");const h=this._descriptor,{pixelFormat:p,dataType:f,isImmutable:m,target:g,internalFormat:v}=h;if(m&&!this._wasImmutablyAllocated)throw new Error("Cannot update immutable texture before allocation!");pb(g)||console.warn("Attempting to set 3D texture data on a non-3D texture");const w=this._context.bindTexture(this,nt.TEXTURE_UNIT_FOR_UPDATES);if(this._context.setActiveTexture(nt.TEXTURE_UNIT_FOR_UPDATES),(r<0||i<0||s<0||n>h.width||o>h.height||a>h.depth||r+n>h.width||i+o>h.height||s+a>h.depth)&&console.error("An attempt to update out of bounds of the texture!"),this._configurePixelStorage(),H5(l))l=l.levels[t],c.compressedTexSubImage3D(g,t,r,i,s,n,o,a,v,l);else{const _=l;c.texSubImage3D(g,t,r,i,s,n,o,a,p,f,_)}this._context.bindTexture(w,nt.TEXTURE_UNIT_FOR_UPDATES)}generateMipmap(){const t=this._descriptor;if(!t.hasMipmap){if(this._wasImmutablyAllocated)throw new Error("Cannot add mipmaps to immutable texture after allocation");t.hasMipmap=!0,this._samplingModeDirty=!0,nt._validateTexture(this._context,t)}t.samplingMode===et.LINEAR?(this._samplingModeDirty=!0,t.samplingMode=et.LINEAR_MIPMAP_NEAREST):t.samplingMode===et.NEAREST&&(this._samplingModeDirty=!0,t.samplingMode=et.NEAREST_MIPMAP_NEAREST);const r=this._context.bindTexture(this,nt.TEXTURE_UNIT_FOR_UPDATES);this._context.setActiveTexture(nt.TEXTURE_UNIT_FOR_UPDATES),this._context.gl.generateMipmap(t.target),this._context.bindTexture(r,nt.TEXTURE_UNIT_FOR_UPDATES)}setSamplingMode(t){t!==this._descriptor.samplingMode&&(this._descriptor.samplingMode=t,this._samplingModeDirty=!0)}setWrapMode(t){t!==this._descriptor.wrapMode&&(this._descriptor.wrapMode=t,nt._validateTexture(this._context,this._descriptor),this._wrapModeDirty=!0)}applyChanges(){const t=this._context.gl,r=this._descriptor;this._samplingModeDirty&&(nt._applySamplingMode(t,r),this._samplingModeDirty=!1),this._wrapModeDirty&&(nt._applyWrapMode(t,r),this._wrapModeDirty=!1)}_deriveInternalFormat(t,r){if(this._context.type===mr.WEBGL1)return t;switch(r){case Ct.FLOAT:switch(t){case ze.RGBA:return gt.RGBA32F;case ze.RGB:return gt.RGB32F;default:throw new Error("Unable to derive format")}case Ct.UNSIGNED_BYTE:switch(t){case ze.RGBA:return gt.RGBA8;case ze.RGB:return gt.RGB8}default:return t}}_configurePixelStorage(){const t=this._context.gl,{unpackAlignment:r,flipped:i,preMultiplyAlpha:s}=this._descriptor;t.pixelStorei(t.UNPACK_ALIGNMENT,r),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,i?1:0),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,s?1:0)}_texStorage(t,r,i,s,n,o){const a=this._context.gl;if(!eo(a))throw new Error("Immutable textures are not supported in WebGL1");if(!Ont(r))throw new Error("Immutable textures must have a sized internal format");if(!this._descriptor.isImmutable)return;const l=i?hde(t,s,n,o):1;pb(t)?a.texStorage3D(t,l,r,s,n,o):a.texStorage2D(t,l,r,s,n),this._wasImmutablyAllocated=!0}_texImage(t,r,i,s,n,o,a){const l=this._context.gl;let c=null;const h=this._context.type===mr.WEBGL2,p=pb(t),{isImmutable:f,pixelFormat:m,dataType:g}=this._descriptor;if(h&&(c=l),h||!i7(a))if(f){if(b(a)){const v=a;p?c.texSubImage3D(t,r,0,0,0,s,n,o,m,g,v):l.texSubImage2D(t,r,0,0,s,n,m,g,v)}}else{const v=a;p?c.texImage3D(t,r,i,s,n,o,0,m,g,v):l.texImage2D(t,r,i,s,n,0,m,g,v)}else l.texImage2D(t,0,i,m,g,a)}_compressedTexImage(t,r,i,s,n,o,a){const l=this._context.gl;let c=null;const h=pb(t),p=this._descriptor.isImmutable;if(h){if(this._context.type!==mr.WEBGL2)throw new Error("3D textures are not supported in WebGL1");c=l}p?b(a)&&(h?c.compressedTexSubImage3D(t,r,0,0,0,s,n,o,i,a):l.compressedTexSubImage2D(t,r,0,0,s,n,i,a)):h?c.compressedTexImage3D(t,r,i,s,n,o,0,a):l.compressedTexImage2D(t,r,i,s,n,0,a)}_forEachMipmapLevel(t,r=1/0){let{width:i,height:s,depth:n,hasMipmap:o,target:a}=this._descriptor;const l=a===mt.TEXTURE_3D;for(let c=0;t(c,i,s,n),o&&(i!==1||s!==1||l&&n!==1)&&!(c>=r);++c)i=Math.max(1,i>>1),s=Math.max(1,s>>1),l&&(n=Math.max(1,n>>1))}static _validateTexture(t,r){(r.width<0||r.height<0||r.depth<0)&&console.error("Negative dimension parameters are not allowed!");const i=eo(t.gl),s=WC(r.width)&&WC(r.height);i||!r.isImmutable&&!pb(r.target)||console.error("Immutable and 3D-like textures are not supported in WebGL1!"),i||s||(typeof r.wrapMode=="number"?r.wrapMode!==xt.CLAMP_TO_EDGE&&console.error("Non-power-of-two textures must have a wrap mode of CLAMP_TO_EDGE!"):r.wrapMode.s===xt.CLAMP_TO_EDGE&&r.wrapMode.t===xt.CLAMP_TO_EDGE||console.error("Non-power-of-two textures must have a wrap mode of CLAMP_TO_EDGE!"),r.hasMipmap&&console.error("Mipmapping requires power-of-two textures!"))}static _applySamplingMode(t,r){let i=r.samplingMode,s=r.samplingMode;i===et.LINEAR_MIPMAP_NEAREST||i===et.LINEAR_MIPMAP_LINEAR?(i=et.LINEAR,r.hasMipmap||(s=et.LINEAR)):i!==et.NEAREST_MIPMAP_NEAREST&&i!==et.NEAREST_MIPMAP_LINEAR||(i=et.NEAREST,r.hasMipmap||(s=et.NEAREST)),t.texParameteri(r.target,t.TEXTURE_MAG_FILTER,i),t.texParameteri(r.target,t.TEXTURE_MIN_FILTER,s)}static _applyWrapMode(t,r){typeof r.wrapMode=="number"?(t.texParameteri(r.target,t.TEXTURE_WRAP_S,r.wrapMode),t.texParameteri(r.target,t.TEXTURE_WRAP_T,r.wrapMode)):(t.texParameteri(r.target,t.TEXTURE_WRAP_S,r.wrapMode.s),t.texParameteri(r.target,t.TEXTURE_WRAP_T,r.wrapMode.t))}static _applyAnisotropicFilteringParameters(t,r){var s;const i=t.capabilities.textureFilterAnisotropic;!i||t.gl.texParameterf(r.target,i.TEXTURE_MAX_ANISOTROPY,(s=r.maxAnisotropy)!=null?s:1)}}function Ont(e){return e in gt}function Mnt(e){return e in ls}function H5(e){return b(e)&&"type"in e&&e.type==="compressed"}function Pnt(e){return b(e)&&"byteLength"in e}function i7(e){return b(e)&&!H5(e)&&!Pnt(e)}function pb(e){return e===mt.TEXTURE_3D||e===mt.TEXTURE_2D_ARRAY}function hde(e,t,r,i=1){let s=Math.max(t,r);return e===mt.TEXTURE_3D&&(s=Math.max(s,i)),Math.round(Math.log(s)/Math.LN2)+1}nt.TEXTURE_UNIT_FOR_UPDATES=0;function dde(e){const t=e.gl;switch(t.getError()){case t.NO_ERROR:return null;case t.INVALID_ENUM:return"An unacceptable value has been specified for an enumerated argument";case t.INVALID_VALUE:return"A numeric argument is out of range";case t.INVALID_OPERATION:return"The specified command is not allowed for the current state";case t.INVALID_FRAMEBUFFER_OPERATION:return"The currently bound framebuffer is not framebuffer complete";case t.OUT_OF_MEMORY:return"Not enough memory is left to execute the command";case t.CONTEXT_LOST_WEBGL:return"WebGL context is lost"}return"Unknown error"}function ta(e,t){return e.vertexBuffers[t].size/Int(e.layout[t])}function Int(e){return e[0].stride}function aie(e,t,r,i,s=0){const n=e.gl,o=e.capabilities.instancing;e.bindBuffer(r);for(const a of i){const l=t.get(a.name);l===void 0&&console.error(`There is no location for vertex attribute '${a.name}' defined.`);const c=s*a.stride;if(a.count<=4)n.vertexAttribPointer(l,a.count,a.type,a.normalized,a.stride,a.offset+c),n.enableVertexAttribArray(l),a.divisor>0&&o&&o.vertexAttribDivisor(l,a.divisor);else if(a.count===9)for(let h=0;h<3;h++)n.vertexAttribPointer(l+h,3,a.type,a.normalized,a.stride,a.offset+12*h+c),n.enableVertexAttribArray(l+h),a.divisor>0&&o&&o.vertexAttribDivisor(l+h,a.divisor);else if(a.count===16)for(let h=0;h<4;h++)n.vertexAttribPointer(l+h,4,a.type,a.normalized,a.stride,a.offset+16*h+c),n.enableVertexAttribArray(l+h),a.divisor>0&&o&&o.vertexAttribDivisor(l+h,a.divisor);else console.error("Unsupported vertex attribute element count: "+a.count)}}function lie(e,t,r,i){const s=e.gl,n=e.capabilities.instancing;e.bindBuffer(r);for(const o of i){const a=t.get(o.name);if(o.count<=4)s.disableVertexAttribArray(a),o.divisor&&o.divisor>0&&n&&n.vertexAttribDivisor(a,0);else if(o.count===9)for(let l=0;l<3;l++)s.disableVertexAttribArray(a+l),o.divisor&&o.divisor>0&&n&&n.vertexAttribDivisor(a+l,0);else if(o.count===16)for(let l=0;l<4;l++)s.disableVertexAttribArray(a+l),o.divisor&&o.divisor>0&&n&&n.vertexAttribDivisor(a+l,0);else console.error("Unsupported vertex attribute element count: "+o.count)}e.unbindBuffer(Tt.ARRAY_BUFFER)}function rOe(e){switch(e){case ze.ALPHA:case ze.LUMINANCE:case ze.RED:case ze.RED_INTEGER:case gt.R8:case gt.R8I:case gt.R8UI:case gt.R8_SNORM:case ol.STENCIL_INDEX8:return 1;case ze.LUMINANCE_ALPHA:case ze.RG:case ze.RG_INTEGER:case gt.RGBA4:case gt.R16F:case gt.R16I:case gt.R16UI:case gt.RG8:case gt.RG8I:case gt.RG8UI:case gt.RG8_SNORM:case gt.RGB565:case gt.RGB5_A1:case ol.DEPTH_COMPONENT16:return 2;case ze.DEPTH_COMPONENT:case ze.RGB:case ze.RGB_INTEGER:case gt.RGB8:case gt.RGB8I:case gt.RGB8UI:case gt.RGB8_SNORM:case gt.SRGB8:case ol.DEPTH_COMPONENT24:return 3;case ze.DEPTH_STENCIL:case ze.RGBA:case ze.RGBA_INTEGER:case gt.RGBA8:case gt.R32F:case gt.R11F_G11F_B10F:case gt.RG16F:case gt.R32I:case gt.R32UI:case gt.RG16I:case gt.RG16UI:case gt.RGBA8I:case gt.RGBA8UI:case gt.RGBA8_SNORM:case gt.SRGB8_ALPHA8:case gt.RGB9_E5:case gt.RGB10_A2UI:case gt.RGB10_A2:case ol.DEPTH_STENCIL:case ol.DEPTH_COMPONENT32F:case ol.DEPTH24_STENCIL8:return 4;case ol.DEPTH32F_STENCIL8:return 5;case gt.RGB16F:case gt.RGB16I:case gt.RGB16UI:return 6;case gt.RG32F:case gt.RG32I:case gt.RG32UI:case gt.RGBA16F:case gt.RGBA16I:case gt.RGBA16UI:return 8;case gt.RGB32F:case gt.RGB32I:case gt.RGB32UI:return 12;case gt.RGBA32F:case gt.RGBA32I:case gt.RGBA32UI:return 16;case ls.COMPRESSED_RGB_S3TC_DXT1_EXT:case ls.COMPRESSED_RGBA_S3TC_DXT1_EXT:return .5;case ls.COMPRESSED_RGBA_S3TC_DXT3_EXT:case ls.COMPRESSED_RGBA_S3TC_DXT5_EXT:return 1;case ls.COMPRESSED_R11_EAC:case ls.COMPRESSED_SIGNED_R11_EAC:case ls.COMPRESSED_RGB8_ETC2:case ls.COMPRESSED_SRGB8_ETC2:case ls.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:case ls.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:return .5;case ls.COMPRESSED_RG11_EAC:case ls.COMPRESSED_SIGNED_RG11_EAC:case ls.COMPRESSED_RGBA8_ETC2_EAC:case ls.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:return 1}return 0}function bT(e){if(R(e))return 0;if("descriptor"in e)return e.glName?bT(e.descriptor):0;const t=e.internalFormat||"pixelFormat"in e&&e.pixelFormat;if(!t)return 0;const r="hasMipmap"in e&&e.hasMipmap?1.3:1,i=e.width*e.height;return rOe(t)*i*r}const fb=fe.getLogger("esri.views.webgl.VertexArrayObject");class rn{constructor(t,r,i,s,n=null){this._context=t,this._locations=r,this._layout=i,this._buffers=s,this._indexBuffer=n,this._glName=null,this._initialized=!1,t.instanceCounter.increment(Nn.VertexArrayObject,this)}get glName(){return this._glName}get context(){return this._context}get vertexBuffers(){return this._buffers}get indexBuffer(){return this._indexBuffer}get size(){return Object.keys(this._buffers).reduce((t,r)=>t+this._buffers[r].size,b(this._indexBuffer)?this._indexBuffer.size:0)}get layout(){return this._layout}get locations(){return this._locations}dispose(t=!0){var r,i;if(!this._context)return void((this._glName||t&&Object.getOwnPropertyNames(this._buffers).length>0)&&fb.warn("Leaked WebGL VAO"));if(this._glName){const s=(i=(r=this._context)==null?void 0:r.capabilities)==null?void 0:i.vao;s?(s.deleteVertexArray(this._glName),this._glName=null):fb.warn("Leaked WebGL VAO")}if(this._context.getBoundVAO()===this&&this._context.bindVAO(null),t){for(const s in this._buffers)this._buffers[s].dispose(),delete this._buffers[s];this._indexBuffer=Ye(this._indexBuffer)}this._context.instanceCounter.decrement(Nn.VertexArrayObject,this),this._context=null}initialize(){if(this._initialized)return;const t=this._context.capabilities.vao;if(t){const r=t.createVertexArray();t.bindVertexArray(r),this._bindLayout(),t.bindVertexArray(null),this._glName=r}this._initialized=!0}bind(){this.initialize();const t=this._context.capabilities.vao;t?t.bindVertexArray(this.glName):(this._context.bindVAO(null),this._bindLayout())}_bindLayout(){const{_buffers:t,_layout:r,_indexBuffer:i}=this;t||fb.error("Vertex buffer dictionary is empty!");const s=this._context.gl;for(const n in t){const o=t[n];o||fb.error("Vertex buffer is uninitialized!");const a=r[n];a||fb.error("Vertex element descriptor is empty!"),aie(this._context,this._locations,o,a)}b(i)&&(this._context.capabilities.vao?s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,i.glName):this._context.bindBuffer(i))}unbind(){this.initialize();const t=this._context.capabilities.vao;t?t.bindVertexArray(null):this._unbindLayout()}_unbindLayout(){const{_buffers:t,_layout:r}=this;t||fb.error("Vertex buffer dictionary is empty!");for(const i in t){const s=t[i];s||fb.error("Vertex buffer is uninitialized!");const n=r[i];lie(this._context,this._locations,s,n)}b(this._indexBuffer)&&this._context.unbindBuffer(this._indexBuffer.bufferType)}}function _l(e,t=oie,r=zr,i=-1,s=1){let n=null;return t===mL?n=new Float32Array([i,i,0,0,s,i,1,0,i,s,0,1,s,s,1,1]):n=new Float32Array([i,i,s,i,i,s,s,s]),new rn(e,r,{geometry:t},{geometry:cr.createVertex(e,Cr.STATIC_DRAW,n)})}function $nt(e,t=oie,r=zr){const i=new Float32Array([-1,-1,3,-1,-1,3]);return new rn(e,r,{geometry:t},{geometry:cr.createVertex(e,Cr.STATIC_DRAW,i)})}const iOe=4;function sOe(e,t=iOe){return new nt(e,{target:mt.TEXTURE_2D,pixelFormat:ze.RGBA,dataType:Ct.UNSIGNED_BYTE,samplingMode:et.NEAREST,width:t,height:t})}function Lnt(e,t,r=iOe){const i=new Uint8Array(r*r*4);for(let s=0;s<i.length;s+=4)i[s+0]=255*t[0],i[s+1]=255*t[1],i[s+2]=255*t[2],i[s+3]=255*t[3];return new nt(e,{target:mt.TEXTURE_2D,pixelFormat:ze.RGBA,dataType:Ct.UNSIGNED_BYTE,samplingMode:et.NEAREST,width:r,height:r},i)}function nOe(e){return new nt(e,{target:mt.TEXTURE_2D,pixelFormat:ze.RGBA,dataType:Ct.UNSIGNED_BYTE,samplingMode:et.NEAREST,width:1,height:1},new Uint8Array([255,255,255,255]))}class pde{constructor(t){this._view=t,this.type="realistic",this.canRender=!0,this._cameraPosition=M(),this._heightParameters=Zt(),this._betasRayleigh=M(),this._betasCombined=M(),this._scaleHeight=0,this._radii=rt(),this._cameraHeight=0,this._cameraHeightSq=0,this._cAtmosphere=0,this._innerFadeDistance=0,this._altitudeFade=0,this._lowerElevationBoundRadius=0,this._lowerBoundEarthRadius=$r.radius,this._hazeStrength=1,this._darkenHaze=!1,this._updateRadius($r.radius)}destroy(){this._atmosphereTechnique=ti(this._atmosphereTechnique),this._atmosphereHazeTechnique=ti(this._atmosphereHazeTechnique),this._vao=Ye(this._vao),this._handles=ct(this._handles)}when(){return Promise.resolve()}initializeRenderContext(t){const r=t.renderContext.rctx,i=this._handles=new Dt,s=this._view.basemapTerrain;b(s.rootTiles)&&this._updateElevation({spatialReference:s.spatialReference,tile:s.rootTiles[0],extent:s.rootTiles[0].extent,context:"ground"}),i.add(rs(()=>this._view.basemapTerrain,"elevation-change",o=>this._updateElevation(o),{onListenerAdd:()=>this._updateElevation()})),i.add(rs(()=>this._view.basemapTerrain,"elevation-bounds-change",()=>this._updateVisibleElevationBounds()));const n=new eOe;n.haze=!1,this._atmosphereTechnique=t.shaderTechniqueRepository.acquire(DI,n),n.haze=!0,this._atmosphereHazeTechnique=t.shaderTechniqueRepository.acquire(DI,n),this._vao=_l(r,mL),this._scaleHeight=qst*j5,se(this._betasRayleigh,vS[0],vS[1],vS[2]),se(this._betasCombined,vS[0]+t7[0],vS[1]+t7[1],vS[2]+t7[2])}render(t){this._render(t,this._atmosphereTechnique,t.offscreenRenderingHelper.depthTexture)}renderHaze(t,r){this._darkenHaze=r,this._render(t,this._atmosphereHazeTechnique,t.offscreenRenderingHelper.linearDepthTexture)}_render(t,r,i){this._update(t.bindParameters.camera);const s=t.rctx.bindTechnique(r,Dnt,t.bindParameters);t.offscreenRenderingHelper.renderDepthDetached(()=>{s.bindTexture("depthTex",i),this._renderCommon(r.program,t)})}_renderCommon(t,r){if(R(this._vao))return;const i=r.rctx;t.setUniform4fv("heightParameters",this._heightParameters),t.setUniform3fv("cameraPosition",this._cameraPosition),t.setUniform2fv("radii",this._radii),t.setUniform1f("scaleHeight",this._scaleHeight),t.setUniform1f("betaMie",Hst),t.setUniform3fv("betaRayleigh",this._betasRayleigh),t.setUniform3fv("betaCombined",this._betasCombined),t.setUniform1f("innerFadeDistance",this._innerFadeDistance),t.setUniform1f("altitudeFade",this._altitudeFade),t.setUniform1f("hazeStrength",this._hazeStrength),i.bindVAO(this._vao),t.assertCompatibleVertexAttributeLocations(this._vao),i.drawArrays(Lt.TRIANGLE_STRIP,0,4)}_adjustRadiusForTesselation(t){return t*Math.cos(Math.PI/16/16)}_updateElevation(t){const r=t?t.tile:_t(this._view.basemapTerrain.rootTiles,[null])[0];if(R(r)||r.level!==0)return;const i=this._adjustRadiusForTesselation($r.radius+r.elevationBounds[0]);i!==this._lowerElevationBoundRadius&&(this._lowerElevationBoundRadius=i,this._lowerBoundEarthRadius=-1,this._updateVisibleElevationBounds())}_updateVisibleElevationBounds(){const t=this._adjustRadiusForTesselation($r.radius+this._view.basemapTerrain.elevationBounds.min);(this._lowerBoundEarthRadius<0||t<this._lowerBoundEarthRadius)&&this._updateRadius(t)}_updateRadius(t){this._lowerBoundEarthRadius=t,vr(this._radii,t,t+j5),this._innerFadeDistance=2*Math.sqrt((2*t-sQ)*sQ)}_update(t){if(R(t))return;this._cameraHeight=Re(t.eye),this._cameraHeightSq=this._cameraHeight*this._cameraHeight,this._cAtmosphere=this._cameraHeightSq-this._radii[1]*this._radii[1];const r=Math.min(1,Math.max(0,(this._cameraHeight-this._radii[0])/j5));this._heightParameters=xr(this._cameraHeight,this._cameraHeightSq,this._cAtmosphere,r),ae(this._cameraPosition,t.eye),this._altitudeFade=BRe(this._cameraHeight-this._lowerBoundEarthRadius),this._hazeStrength=this._darkenHaze?Yt(.6,1,XC(9500,10500,this._cameraHeight-$r.radius)):1}static isSupported(t){return t.renderContext.rctx.capabilities.depthTexture}}const Dnt=new nn;function Nnt(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e}function oOe(e,t,r){r*=.5;const i=Math.sin(r);return e[0]=i*t[0],e[1]=i*t[1],e[2]=i*t[2],e[3]=Math.cos(r),e}function aOe(e,t){const r=2*Math.acos(t[3]),i=Math.sin(r/2);return i>At?(e[0]=t[0]/i,e[1]=t[1]/i,e[2]=t[2]/i):(e[0]=1,e[1]=0,e[2]=0),r}function cie(e,t,r){const i=t[0],s=t[1],n=t[2],o=t[3],a=r[0],l=r[1],c=r[2],h=r[3];return e[0]=i*h+o*a+s*c-n*l,e[1]=s*h+o*l+n*a-i*c,e[2]=n*h+o*c+i*l-s*a,e[3]=o*h-i*a-s*l-n*c,e}function Fnt(e,t,r){r*=.5;const i=t[0],s=t[1],n=t[2],o=t[3],a=Math.sin(r),l=Math.cos(r);return e[0]=i*l+o*a,e[1]=s*l+n*a,e[2]=n*l-s*a,e[3]=o*l-i*a,e}function knt(e,t,r){r*=.5;const i=t[0],s=t[1],n=t[2],o=t[3],a=Math.sin(r),l=Math.cos(r);return e[0]=i*l-n*a,e[1]=s*l+o*a,e[2]=n*l+i*a,e[3]=o*l-s*a,e}function Unt(e,t,r){r*=.5;const i=t[0],s=t[1],n=t[2],o=t[3],a=Math.sin(r),l=Math.cos(r);return e[0]=i*l+s*a,e[1]=s*l-i*a,e[2]=n*l+o*a,e[3]=o*l-n*a,e}function Vnt(e,t){const r=t[0],i=t[1],s=t[2];return e[0]=r,e[1]=i,e[2]=s,e[3]=Math.sqrt(Math.abs(1-r*r-i*i-s*s)),e}function q5(e,t,r,i){const s=t[0],n=t[1],o=t[2],a=t[3];let l,c,h,p,f,m=r[0],g=r[1],v=r[2],w=r[3];return c=s*m+n*g+o*v+a*w,c<0&&(c=-c,m=-m,g=-g,v=-v,w=-w),1-c>At?(l=Math.acos(c),h=Math.sin(l),p=Math.sin((1-i)*l)/h,f=Math.sin(i*l)/h):(p=1-i,f=i),e[0]=p*s+f*m,e[1]=p*n+f*g,e[2]=p*o+f*v,e[3]=p*a+f*w,e}function znt(e){const t=Kp(),r=Kp(),i=Kp(),s=Math.sqrt(1-t),n=Math.sqrt(t);return e[0]=s*Math.sin(2*Math.PI*r),e[1]=s*Math.cos(2*Math.PI*r),e[2]=n*Math.sin(2*Math.PI*i),e[3]=n*Math.cos(2*Math.PI*i),e}function Bnt(e,t){const r=t[0],i=t[1],s=t[2],n=t[3],o=r*r+i*i+s*s+n*n,a=o?1/o:0;return e[0]=-r*a,e[1]=-i*a,e[2]=-s*a,e[3]=n*a,e}function _0(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e}function lOe(e,t){const r=t[0]+t[4]+t[8];let i;if(r>0)i=Math.sqrt(r+1),e[3]=.5*i,i=.5/i,e[0]=(t[5]-t[7])*i,e[1]=(t[6]-t[2])*i,e[2]=(t[1]-t[3])*i;else{let s=0;t[4]>t[0]&&(s=1),t[8]>t[3*s+s]&&(s=2);const n=(s+1)%3,o=(s+2)%3;i=Math.sqrt(t[3*s+s]-t[3*n+n]-t[3*o+o]+1),e[s]=.5*i,i=.5/i,e[3]=(t[3*n+o]-t[3*o+n])*i,e[n]=(t[3*n+s]+t[3*s+n])*i,e[o]=(t[3*o+s]+t[3*s+o])*i}return e}function Gnt(e,t,r,i){const s=.5*Math.PI/180;t*=s,r*=s,i*=s;const n=Math.sin(t),o=Math.cos(t),a=Math.sin(r),l=Math.cos(r),c=Math.sin(i),h=Math.cos(i);return e[0]=n*l*h-o*a*c,e[1]=o*a*h+n*l*c,e[2]=o*l*c-n*a*h,e[3]=o*l*h+n*a*c,e}function jnt(e){return"quat("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}const gL=ef,Hnt=Kr,qnt=yee,Wnt=cie,Xnt=H$,Znt=Hbe,Ynt=Kz,cOe=vee,Qnt=cOe,uOe=_ee,Jnt=uOe,uie=jbe,Knt=oI,eot=qbe;function tot(e,t,r){const i=Te(t,r);return i<-.999999?(ut(If,rot,t),gee(If)<1e-6&&ut(If,iot,t),we(If,If),oOe(e,If,Math.PI),e):i>.999999?(e[0]=0,e[1]=0,e[2]=0,e[3]=1,e):(ut(If,t,r),e[0]=If[0],e[1]=If[1],e[2]=If[2],e[3]=1+i,uie(e,e))}const If=M(),rot=Ue(1,0,0),iot=Ue(0,1,0);function sot(e,t,r,i,s,n){return q5(fde,t,s,n),q5(mde,r,i,n),q5(e,fde,mde,2*n*(1-n)),e}const fde=A0(),mde=A0();function not(e,t,r,i){const s=oot;return s[0]=r[0],s[3]=r[1],s[6]=r[2],s[1]=i[0],s[4]=i[1],s[7]=i[2],s[2]=-t[0],s[5]=-t[1],s[8]=-t[2],uie(e,lOe(e,s))}const oot=$i();Object.freeze(Object.defineProperty({__proto__:null,identity:Nnt,setAxisAngle:oOe,getAxisAngle:aOe,multiply:cie,rotateX:Fnt,rotateY:knt,rotateZ:Unt,calculateW:Vnt,slerp:q5,random:znt,invert:Bnt,conjugate:_0,fromMat3:lOe,fromEuler:Gnt,str:jnt,copy:gL,set:Hnt,add:qnt,mul:Wnt,scale:Xnt,dot:Znt,lerp:Ynt,length:cOe,len:Qnt,squaredLength:uOe,sqrLen:Jnt,normalize:uie,exactEquals:Knt,equals:eot,rotationTo:tot,sqlerp:sot,setAxes:not},Symbol.toStringTag,{value:"Module"}));function CR(e=lot){return[e[0],e[1],e[2],e[3]]}function NI(e,t){return aot(e[0],e[1],e[2],t,pte.get())}function aot(e,t,r,i,s=CR()){return s[0]=e,s[1]=t,s[2]=r,s[3]=i,s}function FI(e,t,r=CR()){return ut(r,e,t),we(r,r),r[3]=gte(e,t),r}const lot=[0,0,1,0];class cot{constructor(){this.startTime=0,this.startTimeHeightFade=0,this.cameraPositionLastFrame=M(),this.parallax={anchorPointClouds:M(),cloudsHeight:1e5,radiusCurvatureCorrectionFactor:0,transform:Ce()},this.parallaxNew={anchorPointClouds:M(),cloudsHeight:1e5,radiusCurvatureCorrectionFactor:0,transform:Ce()},this.crossFade={enabled:!1,factor:0,distanceThresholdFactor:.3},this.fadeInOut={stage:bo.FINISHED,factor:0,distanceThresholdFactor:.6},this.fadeIn={stage:ld.FINISHED,factor:0,distanceThresholdFactor:2},this.fadeInOutHeight={stage:m1.FINISHED,factor:-1}}}var ld,bo,m1;(function(e){e[e.FINISHED=0]="FINISHED",e[e.CHANGE_ANCHOR=1]="CHANGE_ANCHOR",e[e.FADE_IN=2]="FADE_IN"})(ld||(ld={})),function(e){e[e.FINISHED=0]="FINISHED",e[e.FADE_OUT=1]="FADE_OUT",e[e.SWITCH=2]="SWITCH",e[e.FADE_IN=3]="FADE_IN"}(bo||(bo={})),function(e){e[e.FINISHED=0]="FINISHED",e[e.HEIGHT_FADE=1]="HEIGHT_FADE"}(m1||(m1={}));function Mr(){return new Float32Array(3)}function CV(e){const t=new Float32Array(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function Dr(e,t,r){const i=new Float32Array(3);return i[0]=e,i[1]=t,i[2]=r,i}function hOe(e,t){return new Float32Array(e,t,3)}function hie(){return Mr()}function dOe(){return Dr(1,1,1)}function pOe(){return Dr(1,0,0)}function fOe(){return Dr(0,1,0)}function mOe(){return Dr(0,0,1)}const uot=hie(),hot=dOe(),dot=pOe(),pot=fOe(),fot=mOe();Object.freeze(Object.defineProperty({__proto__:null,create:Mr,clone:CV,fromValues:Dr,createView:hOe,zeros:hie,ones:dOe,unitX:pOe,unitY:fOe,unitZ:mOe,ZEROS:uot,ONES:hot,UNIT_X:dot,UNIT_Y:pot,UNIT_Z:fot},Symbol.toStringTag,{value:"Module"}));function gOe(e){e.extensions.add("GL_EXT_shader_texture_lod"),e.extensions.add("GL_OES_standard_derivatives"),e.fragment.code.add(S`#ifndef GL_EXT_shader_texture_lod
float calcMipMapLevel(const vec2 ddx, const vec2 ddy) {
float deltaMaxSqr = max(dot(ddx, ddx), dot(ddy, ddy));
return max(0.0, 0.5 * log2(deltaMaxSqr));
}
#endif
vec4 textureAtlasLookup(sampler2D texture, vec2 textureSize, vec2 textureCoordinates, vec4 atlasRegion) {
vec2 atlasScale = atlasRegion.zw - atlasRegion.xy;
vec2 uvAtlas = fract(textureCoordinates) * atlasScale + atlasRegion.xy;
float maxdUV = 0.125;
vec2 dUVdx = clamp(dFdx(textureCoordinates), -maxdUV, maxdUV) * atlasScale;
vec2 dUVdy = clamp(dFdy(textureCoordinates), -maxdUV, maxdUV) * atlasScale;
#ifdef GL_EXT_shader_texture_lod
return texture2DGradEXT(texture, uvAtlas, dUVdx, dUVdy);
#else
vec2 dUVdxAuto = dFdx(uvAtlas);
vec2 dUVdyAuto = dFdy(uvAtlas);
float mipMapLevel = calcMipMapLevel(dUVdx * textureSize, dUVdy * textureSize);
float autoMipMapLevel = calcMipMapLevel(dUVdxAuto * textureSize, dUVdyAuto * textureSize);
return texture2D(texture, uvAtlas, mipMapLevel - autoMipMapLevel);
#endif
}`)}function die(e,t){switch(e.include(Xy,t),e.fragment.code.add(S`
  struct TextureLookupParameter {
    vec2 uv;
    ${t.supportsTextureAtlas?"vec2 size;":""}
  } vtc;
  `),t.textureCoordinateType){case _n.Default:return void e.fragment.code.add(S`vec4 textureLookup(sampler2D texture, TextureLookupParameter params) {
return texture2D(texture, params.uv);
}`);case _n.Atlas:return e.include(gOe),void e.fragment.code.add(S`vec4 textureLookup(sampler2D texture, TextureLookupParameter params) {
return textureAtlasLookup(texture, params.size, params.uv, vuvRegion);
}`);default:t.textureCoordinateType;case _n.None:case _n.COUNT:return}}class pl extends ss{constructor(t,r){super(t,"vec3",Vr.Draw,(i,s,n)=>i.setUniform3fv(t,r(s,n)))}}class pie extends ss{constructor(t,r){super(t,"vec2",Vr.Draw,(i,s,n)=>i.setUniform2fv(t,r(s,n)))}}class fie extends ss{constructor(t,r){super(t,"sampler2D",Vr.Draw,(i,s,n)=>i.bindTexture(t,r(s,n)))}}function dP(e,t,r){const i=[new fie(e,t)];if(r){const s=e+"Size";i.push(new pie(s,(n,o)=>{const a=t(n,o);return b(a)?vr(mot,a.descriptor.width,a.descriptor.height):zd}))}return i}const mot=rt();class Ht extends ss{constructor(t,r){super(t,"sampler2D",Vr.Pass,(i,s,n)=>i.bindTexture(t,r(s,n)))}}function W5(e,t,r){const i=[new Ht(e,t)];if(r){const s=e+"Size";i.push(new _r(s,(n,o)=>{const a=t(n,o);return b(a)?vr(got,a.descriptor.width,a.descriptor.height):zd}))}return i}const got=rt();class J1{constructor(t){this._material=t.material,this._techniqueRepository=t.techniqueRep,this._output=t.output}dispose(){this._techniqueRepository.release(this._technique)}get technique(){return this._technique}ensureTechnique(t,r,i=this._output){return this._technique=this._techniqueRepository.releaseAndAcquire(t,this._material.getConfiguration(i,r),this._technique),this._technique}ensureResources(t){return Nc.LOADED}}class mie extends J1{constructor(t){super(t),this._numLoading=0,this._disposed=!1,this._textureRepository=t.textureRep,this._textureId=t.textureId,this._acquire(t.textureId,r=>this._texture=r),this._acquire(t.normalTextureId,r=>this._textureNormal=r),this._acquire(t.emissiveTextureId,r=>this._textureEmissive=r),this._acquire(t.occlusionTextureId,r=>this._textureOcclusion=r),this._acquire(t.metallicRoughnessTextureId,r=>this._textureMetallicRoughness=r)}dispose(){this._texture=ti(this._texture),this._textureNormal=ti(this._textureNormal),this._textureEmissive=ti(this._textureEmissive),this._textureOcclusion=ti(this._textureOcclusion),this._textureMetallicRoughness=ti(this._textureMetallicRoughness),this._disposed=!0}ensureResources(t){return this._numLoading===0?Nc.LOADED:Nc.LOADING}get textureBindParameters(){return new yOe(b(this._texture)?this._texture.glTexture:null,b(this._textureNormal)?this._textureNormal.glTexture:null,b(this._textureEmissive)?this._textureEmissive.glTexture:null,b(this._textureOcclusion)?this._textureOcclusion.glTexture:null,b(this._textureMetallicRoughness)?this._textureMetallicRoughness.glTexture:null)}updateTexture(t){(R(this._texture)||t!==this._texture.id)&&(this._texture=ti(this._texture),this._textureId=t,this._acquire(this._textureId,r=>this._texture=r))}_acquire(t,r){if(R(t))return void r(null);const i=this._textureRepository.acquire(t);if(Ch(i))return++this._numLoading,void i.then(s=>{if(this._disposed)return ti(s),void r(null);r(s)}).finally(()=>--this._numLoading);r(i)}}class yOe extends nn{constructor(t=null,r=null,i=null,s=null,n=null){super(),this.texture=t,this.textureNormal=r,this.textureEmissive=i,this.textureOcclusion=s,this.textureMetallicRoughness=n}}const HLt=Dr(0,.6,.2);var Pt;(function(e){e[e.Disabled=0]="Disabled",e[e.Normal=1]="Normal",e[e.Schematic=2]="Schematic",e[e.Water=3]="Water",e[e.WaterOnIntegratedMesh=4]="WaterOnIntegratedMesh",e[e.COUNT=5]="COUNT"})(Pt||(Pt={}));function gie(e,t){const r=e.fragment,i=t.hasMetalnessAndRoughnessTexture||t.hasEmissionTexture||t.hasOcclusionTexture;if(t.pbrMode===Pt.Normal&&i&&e.include(die,t),t.pbrMode!==Pt.Schematic)if(t.pbrMode!==Pt.Disabled){if(t.pbrMode===Pt.Normal){r.code.add(S`vec3 mrr;
vec3 emission;
float occlusion;`);const s=t.supportsTextureAtlas,n=t.pbrTextureBindType;t.hasMetalnessAndRoughnessTexture&&(r.uniforms.add(n===Vr.Pass?W5("texMetallicRoughness",o=>o.textureMetallicRoughness,s):dP("texMetallicRoughness",o=>o.textureMetallicRoughness,s)),r.code.add(S`void applyMetallnessAndRoughness(TextureLookupParameter params) {
vec3 metallicRoughness = textureLookup(texMetallicRoughness, params).rgb;
mrr[0] *= metallicRoughness.b;
mrr[1] *= metallicRoughness.g;
}`)),t.hasEmissionTexture&&(r.uniforms.add(n===Vr.Pass?W5("texEmission",o=>o.textureEmissive,s):dP("texEmission",o=>o.textureEmissive,s)),r.code.add(S`void applyEmission(TextureLookupParameter params) {
emission *= textureLookup(texEmission, params).rgb;
}`)),t.hasOcclusionTexture?(r.uniforms.add(n===Vr.Pass?W5("texOcclusion",o=>o.textureOcclusion,s):dP("texOcclusion",o=>o.textureOcclusion,s)),r.code.add(S`void applyOcclusion(TextureLookupParameter params) {
occlusion *= textureLookup(texOcclusion, params).r;
}
float getBakedOcclusion() {
return occlusion;
}`)):r.code.add(S`float getBakedOcclusion() { return 1.0; }`),r.uniforms.add(n===Vr.Pass?[new St("emissionFactor",o=>o.emissiveFactor),new St("mrrFactors",o=>o.mrrFactors)]:[new pl("emissionFactor",o=>o.emissiveFactor),new pl("mrrFactors",o=>o.mrrFactors)]),r.code.add(S`
    void applyPBRFactors() {
      mrr = mrrFactors;
      emission = emissionFactor;
      occlusion = 1.0;
      ${i?"vtc.uv = vuv0;":""}
      ${t.hasMetalnessAndRoughnessTexture?t.supportsTextureAtlas?"vtc.size = texMetallicRoughnessSize; applyMetallnessAndRoughness(vtc);":"applyMetallnessAndRoughness(vtc);":""}
      ${t.hasEmissionTexture?t.supportsTextureAtlas?"vtc.size = texEmissionSize; applyEmission(vtc);":"applyEmission(vtc);":""}
      ${t.hasOcclusionTexture?t.supportsTextureAtlas?"vtc.size = texOcclusionSize; applyOcclusion(vtc);":"applyOcclusion(vtc);":""}
    }
  `)}}else r.code.add(S`float getBakedOcclusion() { return 1.0; }`);else r.code.add(S`vec3 mrr = vec3(0.0, 0.6, 0.2);
vec3 emission = vec3(0.0);
float occlusion = 1.0;
void applyPBRFactors() {}
float getBakedOcclusion() { return 1.0; }`)}class lr extends ss{constructor(t,r){super(t,"vec4",Vr.Pass,(i,s,n)=>i.setUniform4fv(t,r(s,n)))}}function yie(e,t){const r=e.fragment,i=t.lightingSphericalHarmonicsOrder!==void 0?t.lightingSphericalHarmonicsOrder:2;i===0?(r.uniforms.add(new St("lightingAmbientSH0",(s,n)=>se(gde,n.lighting.sh.r[0],n.lighting.sh.g[0],n.lighting.sh.b[0]))),r.code.add(S`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec3 ambientLight = 0.282095 * lightingAmbientSH0;
return ambientLight * (1.0 - ambientOcclusion);
}`)):i===1?(r.uniforms.add([new lr("lightingAmbientSH_R",(s,n)=>Kr(Mg,n.lighting.sh.r[0],n.lighting.sh.r[1],n.lighting.sh.r[2],n.lighting.sh.r[3])),new lr("lightingAmbientSH_G",(s,n)=>Kr(Mg,n.lighting.sh.g[0],n.lighting.sh.g[1],n.lighting.sh.g[2],n.lighting.sh.g[3])),new lr("lightingAmbientSH_B",(s,n)=>Kr(Mg,n.lighting.sh.b[0],n.lighting.sh.b[1],n.lighting.sh.b[2],n.lighting.sh.b[3]))]),r.code.add(S`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec4 sh0 = vec4(
0.282095,
0.488603 * normal.x,
0.488603 * normal.z,
0.488603 * normal.y
);
vec3 ambientLight = vec3(
dot(lightingAmbientSH_R, sh0),
dot(lightingAmbientSH_G, sh0),
dot(lightingAmbientSH_B, sh0)
);
return ambientLight * (1.0 - ambientOcclusion);
}`)):i===2&&(r.uniforms.add([new St("lightingAmbientSH0",(s,n)=>se(gde,n.lighting.sh.r[0],n.lighting.sh.g[0],n.lighting.sh.b[0])),new lr("lightingAmbientSH_R1",(s,n)=>Kr(Mg,n.lighting.sh.r[1],n.lighting.sh.r[2],n.lighting.sh.r[3],n.lighting.sh.r[4])),new lr("lightingAmbientSH_G1",(s,n)=>Kr(Mg,n.lighting.sh.g[1],n.lighting.sh.g[2],n.lighting.sh.g[3],n.lighting.sh.g[4])),new lr("lightingAmbientSH_B1",(s,n)=>Kr(Mg,n.lighting.sh.b[1],n.lighting.sh.b[2],n.lighting.sh.b[3],n.lighting.sh.b[4])),new lr("lightingAmbientSH_R2",(s,n)=>Kr(Mg,n.lighting.sh.r[5],n.lighting.sh.r[6],n.lighting.sh.r[7],n.lighting.sh.r[8])),new lr("lightingAmbientSH_G2",(s,n)=>Kr(Mg,n.lighting.sh.g[5],n.lighting.sh.g[6],n.lighting.sh.g[7],n.lighting.sh.g[8])),new lr("lightingAmbientSH_B2",(s,n)=>Kr(Mg,n.lighting.sh.b[5],n.lighting.sh.b[6],n.lighting.sh.b[7],n.lighting.sh.b[8]))]),r.code.add(S`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec3 ambientLight = 0.282095 * lightingAmbientSH0;
vec4 sh1 = vec4(
0.488603 * normal.x,
0.488603 * normal.z,
0.488603 * normal.y,
1.092548 * normal.x * normal.y
);
vec4 sh2 = vec4(
1.092548 * normal.y * normal.z,
0.315392 * (3.0 * normal.z * normal.z - 1.0),
1.092548 * normal.x * normal.z,
0.546274 * (normal.x * normal.x - normal.y * normal.y)
);
ambientLight += vec3(
dot(lightingAmbientSH_R1, sh1),
dot(lightingAmbientSH_G1, sh1),
dot(lightingAmbientSH_B1, sh1)
);
ambientLight += vec3(
dot(lightingAmbientSH_R2, sh2),
dot(lightingAmbientSH_G2, sh2),
dot(lightingAmbientSH_B2, sh2)
);
return ambientLight * (1.0 - ambientOcclusion);
}`),t.pbrMode!==Pt.Normal&&t.pbrMode!==Pt.Schematic||r.code.add(S`const vec3 skyTransmittance = vec3(0.9, 0.9, 1.0);
vec3 calculateAmbientRadiance(float ambientOcclusion)
{
vec3 ambientLight = 1.2 * (0.282095 * lightingAmbientSH0) - 0.2;
return ambientLight *= (1.0 - ambientOcclusion) * skyTransmittance;
}`))}const gde=M(),Mg=Zt();class qe extends ss{constructor(t,r){super(t,"float",Vr.Pass,(i,s,n)=>i.setUniform1f(t,r(s,n)))}}function vie(e,t){const r=e.fragment;t.isGround?r.uniforms.add(new qe("lightingFixedFactor",(i,s)=>(1-s.lighting.groundLightingFactor)*(1-s.lighting.globalFactor))):r.constants.add("lightingFixedFactor","float",0),r.uniforms.add([new St("lightingMainDirection",(i,s)=>s.lighting.lightingMainDirection),new St("lightingMainIntensity",(i,s)=>s.lighting.mainLight.intensity)]),r.code.add(S`vec3 evaluateMainLighting(vec3 normal_global, float shadowing) {
float dotVal = clamp(dot(normal_global, lightingMainDirection), 0.0, 1.0);
dotVal = mix(dotVal, 1.0, lightingFixedFactor);
return lightingMainIntensity * ((1.0 - shadowing) * dotVal);
}`)}function pB(e){e.vertex.code.add(S`const float PI = 3.141592653589793;`),e.fragment.code.add(S`const float PI = 3.141592653589793;
const float LIGHT_NORMALIZATION = 1.0 / PI;
const float INV_PI = 0.3183098861837907;
const float HALF_PI = 1.570796326794897;`)}class wT extends ss{constructor(t,r){super(t,"bool",Vr.Pass,(i,s,n)=>i.setUniform1b(t,r(s,n)))}}class yot extends ss{constructor(t,r){super(t,"samplerCube",Vr.Pass,(i,s,n)=>i.bindTexture(t,r(s,n)))}}function vOe(e){const t=e.fragment;t.uniforms.add([new Ei("rotationMatrixClouds",(r,i)=>i.clouds.parallax.transform),new Ei("rotationMatrixCloudsCrossFade",(r,i)=>i.clouds.parallaxNew.transform),new St("anchorPosition",(r,i)=>i.clouds.parallax.anchorPointClouds),new St("anchorPositionCrossFade",(r,i)=>i.clouds.parallaxNew.anchorPointClouds),new _r("cloudVariables",(r,i)=>b(i.clouds.data)?vr(vot,i.clouds.data.coverage,i.clouds.data.absorption):zd),new qe("cloudsHeight",(r,i)=>i.clouds.parallax.cloudsHeight),new qe("radiusCurvatureCorrectionFactor",(r,i)=>i.clouds.parallax.radiusCurvatureCorrectionFactor),new qe("totalFadeInOut",(r,i)=>i.clouds.fadeInOut.stage===bo.FINISHED?i.clouds.fadeInOutHeight.factor+Math.max(Le(i.clouds.fadeIn.factor,0,1)):i.clouds.fadeInOutHeight.factor+Math.max(Le(i.clouds.fadeInOut.factor,0,1))),new qe("crossFadeAnchorFactor",(r,i)=>Le(i.clouds.crossFade.factor,0,1)),new yot("cubeMap",(r,i)=>b(i.clouds.data)?i.clouds.data.cubeMap.colorTexture:null),new wT("crossFade",(r,i)=>i.clouds.crossFade.enabled)]),t.constants.add("planetRadius","float",$r.radius),t.code.add(S`vec3 intersectWithCloudLayer(vec3 dir, vec3 cameraPosition, vec3 spherePos)
{
float radiusClouds = planetRadius + cloudsHeight;
float B = 2.0 * dot(cameraPosition, dir);
float C = dot(cameraPosition, cameraPosition) - radiusClouds * radiusClouds;
float det = B * B - 4.0 * C;
float pointIntDist = max(0.0, 0.5 *(-B + sqrt(det)));
vec3 intersectionPont = cameraPosition + dir * pointIntDist;
intersectionPont =  intersectionPont - spherePos;
return intersectionPont;
}`),t.code.add(S`vec3 correctForPlanetCurvature(vec3 dir)
{
dir.z = dir.z*(1.-radiusCurvatureCorrectionFactor) + radiusCurvatureCorrectionFactor;
return dir;
}`),t.code.add(S`vec3 rotateDirectionToAnchorPoint(mat4 rotMat, vec3 inVec)
{
return (rotMat * vec4(inVec, 0.0)).xyz;
}`),t.uniforms.add([new St("lightingMainDirection",(r,i)=>i.lighting.lightingMainDirection),new St("lightingMainIntensity",(r,i)=>i.lighting.mainLight.intensity)]),t.code.add(S`const float SUNSET_TRANSITION_FACTOR = 0.3;
const vec3 RIM_COLOR = vec3(0.28, 0.175, 0.035);
const float RIM_SCATTERING_FACTOR = 140.0;
const float BACKLIGHT_FACTOR = 0.2;
const float BACKLIGHT_SCATTERING_FACTOR = 10.0;
const float BACKLIGHT_TRANSITION_FACTOR = 0.3;
vec3 calculateCloudColor(vec3 cameraPosition, vec3 worldSpaceRay, vec4 clouds)
{
float upDotLight = dot(normalize(cameraPosition), normalize(lightingMainDirection));
float dirDotLight = max(dot(normalize(-worldSpaceRay), normalize(lightingMainDirection)), 0.0);
float sunsetTransition = clamp(pow(max(upDotLight, 0.0), SUNSET_TRANSITION_FACTOR), 0.0, 1.0);
vec3 ambientLight = calculateAmbientIrradiance(normalize(cameraPosition),  0.0);
vec3 mainLight = evaluateMainLighting(normalize(cameraPosition),  0.0);
vec3 combinedLight = clamp((lightingMainIntensity + ambientLight )/PI, vec3(0.0), vec3(1.0));
vec3 baseCloudColor = pow(combinedLight * pow(clouds.xyz, vec3(GAMMA)), vec3(INV_GAMMA));
float scatteringMod = max(clouds.a < 0.5 ? clouds.a / 0.5 : - clouds.a / 0.5 + 2.0, 0.0);
float rimLightIntensity = 0.5 + 0.5 *pow(max(upDotLight, 0.0), 0.35);
vec3 directSunScattering = RIM_COLOR * rimLightIntensity * pow(dirDotLight, RIM_SCATTERING_FACTOR) * scatteringMod;
float additionalLight = BACKLIGHT_FACTOR * pow(dirDotLight, BACKLIGHT_SCATTERING_FACTOR) * (1. - pow(sunsetTransition, BACKLIGHT_TRANSITION_FACTOR)) ;
return vec3(baseCloudColor * (1. + additionalLight) + directSunScattering);
}`),t.code.add(S`vec4 getCloudData(vec3 rayDir)
{
vec4 cloudData = textureCube(cubeMap, rayDir);
float mu = dot(rayDir, vec3(0, 0, 1));
return mix(vec4(vec3(clamp(1.0 - cloudVariables.y, 0.6, 1.0)), 0.0), cloudData, smoothstep(-0.01, mix(0.0, 0.075, cloudVariables.x), abs(mu)));
}`),t.code.add(S`vec4 renderCloudsNoFade(vec3 worldRay, vec3 cameraPosition)
{
vec3 intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPosition);
vec3 worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixClouds, normalize(intersectionPoint));
vec3 worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
vec4 cloudData = getCloudData(worldRayRotatedCorrected);
float totalTransmittance = clamp(cloudData.a * (1.0 - totalFadeInOut) + totalFadeInOut, 0.0 , 1.0);
if (length(cloudData.rgb) == 0.0) {
totalTransmittance = 1.0;
}
return vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), totalTransmittance);
}`),t.code.add(S`vec4 renderCloudsCrossFade(vec3 worldRay, vec3 cameraPosition)
{
vec3 intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPosition);
vec3 worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixClouds, normalize(intersectionPoint));
vec3 worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
vec4 cloudData = getCloudData(worldRayRotatedCorrected);
vec4 cloudColor = vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), cloudData.a);
intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPositionCrossFade);
worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixCloudsCrossFade, normalize(intersectionPoint));
worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
cloudData = getCloudData(worldRayRotatedCorrected);
vec4 cloudColorCrossFade = vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), cloudData.a);
cloudColor = mix(cloudColor, cloudColorCrossFade, crossFadeAnchorFactor);
float totalTransmittance = clamp(cloudColor.a * (1.0 - totalFadeInOut) + totalFadeInOut, 0.0 , 1.0);
if (length(cloudColor.rgb) == 0.0) {
totalTransmittance = 1.0;
}
return vec4(cloudColor.rgb, totalTransmittance);
}`),t.code.add(S`vec4 renderClouds(vec3 worldRay, vec3 cameraPosition)
{
return crossFade ? renderCloudsCrossFade(worldRay, cameraPosition) : renderCloudsNoFade(worldRay, cameraPosition);
}`)}const vot=rt();function wg(e){e.code.add(S`vec4 premultiplyAlpha(vec4 v) {
return vec4(v.rgb * v.a, v.a);
}
vec3 rgb2hsv(vec3 c) {
vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);
vec4 p = c.g < c.b ? vec4(c.bg, K.wz) : vec4(c.gb, K.xy);
vec4 q = c.r < p.x ? vec4(p.xyw, c.r) : vec4(c.r, p.yzx);
float d = q.x - min(q.w, q.y);
float e = 1.0e-10;
return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), min(d / (q.x + e), 1.0), q.x);
}
vec3 hsv2rgb(vec3 c) {
vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);
vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);
return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);
}
float rgb2v(vec3 c) {
return max(c.x, max(c.y, c.z));
}`)}function _ot(){const e=new Yr;e.attributes.add(O.POSITION,"vec2"),e.varyings.add("worldRay","vec3");const{vertex:t,fragment:r}=e;return t.uniforms.add([new Ei("inverseProjectionMatrix",(i,s)=>s.camera.inverseProjectionMatrix),new Ei("inverseViewMatrix",(i,s)=>Cs(bot,s.camera.viewMatrix))]),t.code.add(S`void main(void) {
vec3 posViewNear = (inverseProjectionMatrix * vec4(position, -1.0, 1.0)).xyz;
worldRay = (inverseViewMatrix * vec4(posViewNear, 0.0)).xyz;
gl_Position = vec4(position, 1.0, 1.0);
}`),r.include(wg),r.include(hu),e.include(yie,{pbrMode:Pt.Disabled,lightingSphericalHarmonicsOrder:2}),e.include(pB),e.include(hB),e.include(vie,{isGround:!1}),e.include(vOe,{instancedDoublePrecision:!1,isGround:!1}),r.uniforms.add([new St("cameraPosition",(i,s)=>s.camera.eye)]),r.code.add(S`void main() {
vec4 cloudsColor = renderClouds(normalize(worldRay), cameraPosition);
gl_FragColor = vec4((1.0 - totalFadeInOut) * cloudsColor.rgb, cloudsColor.a);
}`),e}const bot=Ce(),wot=Object.freeze(Object.defineProperty({__proto__:null,build:_ot},Symbol.toStringTag,{value:"Module"}));class fB extends gi{constructor(t){super(t,null,()=>this.destroy())}initializeProgram(t){const r=fB.shader.get().build();return new oi(t.rctx,r,zr)}initializePipeline(){return Gt({blending:bg(Ae.ONE,Ae.SRC_ALPHA),depthTest:{func:_i.LEQUAL},colorWrite:or})}}fB.shader=new ni(wot,()=>ie(()=>import("./CloudsComposition.glsl.bc2db4c2.js"),[],import.meta.url));function xot(e){return b(e)&&b(e.cubeMap)&&e.coverage>0}function yde(e){return b(e)&&!e.running}let Rw=class extends xe{constructor(e){super(e),this._technique=new fB(e),this._vao=_l(e.rctx)}destroy(){this._technique=ti(this._technique),this._vao=Ye(this._vao)}render(e,t){const r=e.bindParameters.clouds;if(R(this._vao)||R(r.data))return;if(!this._technique.compiled)return void this.requestRender();this._setParallaxParameters(r,e.bindParameters.camera.eye,t);const i=e.rctx.bindTechnique(this._technique,Rot,e.bindParameters);e.rctx.bindVAO(this._vao),i.assertCompatibleVertexAttributeLocations(this._vao),e.rctx.drawArrays(Lt.TRIANGLE_STRIP,0,4),Aot(r)&&this.requestRender()}_setFadeInStage(e,t){const r=performance.now(),i=e.parallax.anchorPointClouds;e.fadeIn.stage===ld.FINISHED&&(e.fadeIn.factor=1,ae(i,$f),e.fadeIn.stage=ld.CHANGE_ANCHOR,e.crossFade.enabled=!1,e.fadeInOut.stage=bo.FINISHED);const s=bde(e,t);e.fadeIn.stage===ld.CHANGE_ANCHOR&&s&&yde(e.data)&&(ae(i,$f),e.fadeIn.stage=ld.FADE_IN,e.startTime=r),e.fadeIn.factor>0&&e.fadeIn.stage===ld.FADE_IN&&(e.fadeIn.factor=1-(r-e.startTime)/_de),e.fadeIn.factor<=0&&e.fadeIn.stage===ld.FADE_IN&&(e.fadeIn.stage=ld.FINISHED,e.fadeIn.factor=0)}_setCrossFadingStage(e){const t=performance.now(),{crossFade:r}=e,i=e.parallax.anchorPointClouds;e.crossFade.enabled||(ae(e.parallaxNew.anchorPointClouds,$f),e.startTime=t,r.factor=0,e.crossFade.enabled=!0),r.factor<1&&e.crossFade.enabled&&(r.factor=(t-e.startTime)/Eot),r.factor>=1&&e.crossFade.enabled&&(e.crossFade.enabled=!1,r.factor=1,ae(i,e.parallaxNew.anchorPointClouds))}_setFadeInOutStage(e,t){const r=performance.now(),{fadeInOut:i,crossFade:s}=e;i.stage===bo.FINISHED&&(e.startTime=r,i.factor=0,i.stage=bo.FADE_OUT),i.factor<1&&i.stage===bo.FADE_OUT&&(i.factor=(r-e.startTime)/Sot),i.factor>=1&&i.stage===bo.FADE_OUT&&(i.factor=1,ae(e.parallax.anchorPointClouds,$f)),i.factor>=1&&i.stage===bo.FADE_OUT&&bde(e,t)&&(i.factor=1,i.stage=bo.SWITCH,e.crossFade.enabled=!1,s.factor=1),yde(e.data)&&i.stage===bo.SWITCH&&(e.startTime=r,i.factor=1,i.stage=bo.FADE_IN,ae(e.parallax.anchorPointClouds,$f),e.crossFade.enabled=!1,s.factor=1),i.factor>0&&i.stage===bo.FADE_IN&&(i.factor=1-(r-e.startTime)/_de),i.factor<=0&&i.stage===bo.FADE_IN&&(i.stage=bo.FINISHED,i.factor=0)}_setFadeInOutHeight(e,t){const r=performance.now(),i=e.fadeInOutHeight,s=(r-(i.stage===m1.FINISHED?r:e.startTimeHeightFade))/Cot;i.factor+=t?-s:s,e.startTimeHeightFade=r,i.factor=Le(i.factor,0,1),i.stage=m1.HEIGHT_FADE}_setParallaxParameters(e,t,r){const{parallax:i}=e;e.fadeInOutHeight.factor<0&&(e.fadeInOutHeight.factor=Re(t)-this.planetRadius>dd?1:0),we($f,t),le($f,$f,this.planetRadius),i.anchorPointClouds[0]===0&&i.anchorPointClouds[1]===0&&i.anchorPointClouds[2]===0&&ae(i.anchorPointClouds,$f);const s=Re(pe(Tot,i.anchorPointClouds,$f));let n=!0;s>e.fadeIn.distanceThresholdFactor*i.cloudsHeight||e.fadeIn.stage!==ld.FINISHED?this._setFadeInStage(e,t):s>e.fadeInOut.distanceThresholdFactor*i.cloudsHeight||e.fadeInOut.stage!==bo.FINISHED?this._setFadeInOutStage(e,t):s>e.crossFade.distanceThresholdFactor*i.cloudsHeight&&!r||e.crossFade.enabled?this._setCrossFadingStage(e):n=!1;const o=Re(t),a=o-this.planetRadius;if((a>1.7*dd||a<-dd)&&e.fadeInOutHeight.factor<1?e.fadeInOutHeight.factor=1:(a>dd||a<-.35*dd)&&e.fadeInOutHeight.factor<1?this._setFadeInOutHeight(e,!1):a<dd&&a>-.35*dd&&e.fadeInOutHeight.factor>0?this._setFadeInOutHeight(e,!0):e.fadeInOutHeight.stage=m1.FINISHED,i.radiusCurvatureCorrectionFactor=.84*Math.sqrt(Math.max(o*o-this.planetRadius*this.planetRadius,0))/o,FI(vde,i.anchorPointClouds,_S),i.transform=Ce(),qc(i.transform,i.transform,_S[3],_S),n){const{parallaxNew:l}=e;FI(vde,l.anchorPointClouds,_S),l.transform=Ce(),qc(l.transform,l.transform,_S[3],_S)}ae(e.cameraPositionLastFrame,t)}};u([d({constructOnly:!0})],Rw.prototype,"rctx",void 0),u([d({constructOnly:!0})],Rw.prototype,"viewingMode",void 0),u([d({constructOnly:!0})],Rw.prototype,"planetRadius",void 0),u([d({constructOnly:!0})],Rw.prototype,"requestRender",void 0),Rw=u([$("esri.views.3d.environment.CloudsComposition")],Rw);const vde=Ue(0,0,1),_S=CR(),$f=M(),Tot=M(),_de=500,Sot=250,Eot=500,Cot=500;function Aot(e){return e.crossFade.enabled||e.fadeInOut.stage!==bo.FINISHED||e.fadeIn.stage!==ld.FINISHED||e.fadeInOutHeight.stage!==m1.FINISHED}function bde(e,t){return cT(e.cameraPositionLastFrame,t)}const Rot=new nn;function Gd(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10],e}function Oot(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function _ie(e,t,r,i,s,n,o,a,l,c){return e[0]=t,e[1]=r,e[2]=i,e[3]=s,e[4]=n,e[5]=o,e[6]=a,e[7]=l,e[8]=c,e}function bie(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function jd(e,t){if(e===t){const r=t[1],i=t[2],s=t[5];e[1]=t[3],e[2]=t[6],e[3]=r,e[5]=t[7],e[6]=i,e[7]=s}else e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8];return e}function sS(e,t){const r=t[0],i=t[1],s=t[2],n=t[3],o=t[4],a=t[5],l=t[6],c=t[7],h=t[8],p=h*o-a*c,f=-h*n+a*l,m=c*n-o*l;let g=r*p+i*f+s*m;return g?(g=1/g,e[0]=p*g,e[1]=(-h*i+s*c)*g,e[2]=(a*i-s*o)*g,e[3]=f*g,e[4]=(h*r-s*l)*g,e[5]=(-a*r+s*n)*g,e[6]=m*g,e[7]=(-c*r+i*l)*g,e[8]=(o*r-i*n)*g,e):null}function Mot(e,t){const r=t[0],i=t[1],s=t[2],n=t[3],o=t[4],a=t[5],l=t[6],c=t[7],h=t[8];return e[0]=o*h-a*c,e[1]=s*c-i*h,e[2]=i*a-s*o,e[3]=a*l-n*h,e[4]=r*h-s*l,e[5]=s*n-r*a,e[6]=n*c-o*l,e[7]=i*l-r*c,e[8]=r*o-i*n,e}function Pot(e){const t=e[0],r=e[1],i=e[2],s=e[3],n=e[4],o=e[5],a=e[6],l=e[7],c=e[8];return t*(c*n-o*l)+r*(-c*s+o*a)+i*(l*s-n*a)}function mB(e,t,r){const i=t[0],s=t[1],n=t[2],o=t[3],a=t[4],l=t[5],c=t[6],h=t[7],p=t[8],f=r[0],m=r[1],g=r[2],v=r[3],w=r[4],_=r[5],T=r[6],x=r[7],E=r[8];return e[0]=f*i+m*o+g*c,e[1]=f*s+m*a+g*h,e[2]=f*n+m*l+g*p,e[3]=v*i+w*o+_*c,e[4]=v*s+w*a+_*h,e[5]=v*n+w*l+_*p,e[6]=T*i+x*o+E*c,e[7]=T*s+x*a+E*h,e[8]=T*n+x*l+E*p,e}function AV(e,t,r){const i=t[0],s=t[1],n=t[2],o=t[3],a=t[4],l=t[5],c=t[6],h=t[7],p=t[8],f=r[0],m=r[1];return e[0]=i,e[1]=s,e[2]=n,e[3]=o,e[4]=a,e[5]=l,e[6]=f*i+m*o+c,e[7]=f*s+m*a+h,e[8]=f*n+m*l+p,e}function wie(e,t,r){const i=t[0],s=t[1],n=t[2],o=t[3],a=t[4],l=t[5],c=t[6],h=t[7],p=t[8],f=Math.sin(r),m=Math.cos(r);return e[0]=m*i+f*o,e[1]=m*s+f*a,e[2]=m*n+f*l,e[3]=m*o-f*i,e[4]=m*a-f*s,e[5]=m*l-f*n,e[6]=c,e[7]=h,e[8]=p,e}function xie(e,t,r){const i=r[0],s=r[1],n=r[2];return e[0]=i*t[0],e[1]=i*t[1],e[2]=i*t[2],e[3]=s*t[3],e[4]=s*t[4],e[5]=s*t[5],e[6]=n*t[6],e[7]=n*t[7],e[8]=n*t[8],e}function Iot(e,t,r){const i=r[0],s=r[1];return e[0]=i*t[0],e[1]=i*t[1],e[2]=i*t[2],e[3]=s*t[3],e[4]=s*t[4],e[5]=s*t[5],e}function $ot(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=t[0],e[7]=t[1],e[8]=1,e}function Lot(e,t){const r=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=r,e[2]=0,e[3]=-r,e[4]=i,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function Dot(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=t[1],e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function Not(e,t){return e[0]=t[0],e[1]=t[1],e[2]=0,e[3]=t[2],e[4]=t[3],e[5]=0,e[6]=t[4],e[7]=t[5],e[8]=1,e}function gB(e,t){const r=t[0],i=t[1],s=t[2],n=t[3],o=r+r,a=i+i,l=s+s,c=r*o,h=i*o,p=i*a,f=s*o,m=s*a,g=s*l,v=n*o,w=n*a,_=n*l;return e[0]=1-p-g,e[3]=h-_,e[6]=f+w,e[1]=h+_,e[4]=1-c-g,e[7]=m-v,e[2]=f-w,e[5]=m+v,e[8]=1-c-p,e}function _Oe(e,t){const r=t[0],i=t[1],s=t[2],n=t[4],o=t[5],a=t[6],l=t[8],c=t[9],h=t[10],p=h*o-a*c,f=-h*n+a*l,m=c*n-o*l,g=r*p+i*f+s*m;if(!g)return null;const v=1/g;return e[0]=p*v,e[1]=(-h*i+s*c)*v,e[2]=(a*i-s*o)*v,e[3]=f*v,e[4]=(h*r-s*l)*v,e[5]=(-a*r+s*n)*v,e[6]=m*v,e[7]=(-c*r+i*l)*v,e[8]=(o*r-i*n)*v,e}function AA(e,t){const r=t[0],i=t[1],s=t[2],n=t[3],o=t[4],a=t[5],l=t[6],c=t[7],h=t[8],p=t[9],f=t[10],m=t[11],g=t[12],v=t[13],w=t[14],_=t[15],T=r*a-i*o,x=r*l-s*o,E=r*c-n*o,C=i*l-s*a,A=i*c-n*a,P=s*c-n*l,I=h*v-p*g,L=h*w-f*g,k=h*_-m*g,G=p*w-f*v,z=p*_-m*v,X=f*_-m*w;let Z=T*X-x*z+E*G+C*k-A*L+P*I;return Z?(Z=1/Z,e[0]=(a*X-l*z+c*G)*Z,e[1]=(l*k-o*X-c*L)*Z,e[2]=(o*z-a*k+c*I)*Z,e[3]=(s*z-i*X-n*G)*Z,e[4]=(r*X-s*k+n*L)*Z,e[5]=(i*k-r*z-n*I)*Z,e[6]=(v*P-w*A+_*C)*Z,e[7]=(w*E-g*P-_*x)*Z,e[8]=(g*A-v*E+_*T)*Z,e):null}function Fot(e,t,r){return e[0]=2/t,e[1]=0,e[2]=0,e[3]=0,e[4]=-2/r,e[5]=0,e[6]=-1,e[7]=1,e[8]=1,e}function kot(e){return"mat3("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+")"}function Uot(e){return Math.sqrt(e[0]**2+e[1]**2+e[2]**2+e[3]**2+e[4]**2+e[5]**2+e[6]**2+e[7]**2+e[8]**2)}function Vot(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e[4]=t[4]+r[4],e[5]=t[5]+r[5],e[6]=t[6]+r[6],e[7]=t[7]+r[7],e[8]=t[8]+r[8],e}function bOe(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e[4]=t[4]-r[4],e[5]=t[5]-r[5],e[6]=t[6]-r[6],e[7]=t[7]-r[7],e[8]=t[8]-r[8],e}function zot(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=t[7]*r,e[8]=t[8]*r,e}function Bot(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e[2]=t[2]+r[2]*i,e[3]=t[3]+r[3]*i,e[4]=t[4]+r[4]*i,e[5]=t[5]+r[5]*i,e[6]=t[6]+r[6]*i,e[7]=t[7]+r[7]*i,e[8]=t[8]+r[8]*i,e}function Got(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]}function jot(e,t){const r=e[0],i=e[1],s=e[2],n=e[3],o=e[4],a=e[5],l=e[6],c=e[7],h=e[8],p=t[0],f=t[1],m=t[2],g=t[3],v=t[4],w=t[5],_=t[6],T=t[7],x=t[8];return Math.abs(r-p)<=At*Math.max(1,Math.abs(r),Math.abs(p))&&Math.abs(i-f)<=At*Math.max(1,Math.abs(i),Math.abs(f))&&Math.abs(s-m)<=At*Math.max(1,Math.abs(s),Math.abs(m))&&Math.abs(n-g)<=At*Math.max(1,Math.abs(n),Math.abs(g))&&Math.abs(o-v)<=At*Math.max(1,Math.abs(o),Math.abs(v))&&Math.abs(a-w)<=At*Math.max(1,Math.abs(a),Math.abs(w))&&Math.abs(l-_)<=At*Math.max(1,Math.abs(l),Math.abs(_))&&Math.abs(c-T)<=At*Math.max(1,Math.abs(c),Math.abs(T))&&Math.abs(h-x)<=At*Math.max(1,Math.abs(h),Math.abs(x))}function Tie(e){const t=At,r=e[0],i=e[1],s=e[2],n=e[3],o=e[4],a=e[5],l=e[6],c=e[7],h=e[8];return Math.abs(1-(r*r+n*n+l*l))<=t&&Math.abs(1-(i*i+o*o+c*c))<=t&&Math.abs(1-(s*s+a*a+h*h))<=t}const Hot=mB,qot=bOe;Object.freeze(Object.defineProperty({__proto__:null,fromMat4:Gd,copy:Oot,set:_ie,identity:bie,transpose:jd,invert:sS,adjoint:Mot,determinant:Pot,multiply:mB,translate:AV,rotate:wie,scale:xie,scaleByVec2:Iot,fromTranslation:$ot,fromRotation:Lot,fromScaling:Dot,fromMat2d:Not,fromQuat:gB,normalFromMat4Legacy:_Oe,normalFromMat4:AA,projection:Fot,str:kot,frob:Uot,add:Vot,subtract:bOe,multiplyScalar:zot,multiplyScalarAndAdd:Bot,exactEquals:Got,equals:jot,isOrthoNormal:Tie,mul:Hot,sub:qot},Symbol.toStringTag,{value:"Module"}));function Sie(){return new Float32Array(2)}function Wot(e){const t=new Float32Array(2);return t[0]=e[0],t[1]=e[1],t}function ll(e,t){const r=new Float32Array(2);return r[0]=e,r[1]=t,r}function Xot(e,t){return new Float32Array(e,t,2)}function wOe(){return Sie()}function xOe(){return ll(1,1)}function TOe(){return ll(1,0)}function SOe(){return ll(0,1)}const Zot=wOe(),Yot=xOe(),Qot=TOe(),Jot=SOe();Object.freeze(Object.defineProperty({__proto__:null,create:Sie,clone:Wot,fromValues:ll,createView:Xot,zeros:wOe,ones:xOe,unitX:TOe,unitY:SOe,ZEROS:Zot,ONES:Yot,UNIT_X:Qot,UNIT_Y:Jot},Symbol.toStringTag,{value:"Module"}));var Zp;(function(e){e[e.SIXTEEN=0]="SIXTEEN",e[e.HUNDRED=1]="HUNDRED",e[e.TWOHUNDRED=2]="TWOHUNDRED",e[e.COUNT=3]="COUNT"})(Zp||(Zp={}));class EOe extends vl{constructor(){super(...arguments),this.steps=Zp.SIXTEEN}}u([q({count:Zp.COUNT})],EOe.prototype,"steps",void 0);const pd=he("esri-mobile")?64:128,Kot=pd/128,$p=Math.ceil(Math.sqrt(pd)),qp=(pd+2)*$p,eat=1e5,s7=128,tat=qp/1560;function K1(e,t=!0){e.attributes.add(O.POSITION,"vec2"),t&&e.varyings.add("uv","vec2"),e.vertex.code.add(S`
    void main(void) {
      gl_Position = vec4(position, 0.0, 1.0);
      ${t?S`uv = position * 0.5 + vec2(0.5);`:""}
    }
  `)}class kI extends ss{constructor(t,r){super(t,"mat3",Vr.Draw,(i,s,n)=>i.setUniformMatrix3fv(t,r(s,n)))}}class COe extends nn{constructor(){super(...arguments),this.viewMatrix=$i()}}function rat(e){const t=new Yr;return t.include(K1,!1),t.fragment.uniforms.add(new kr("cloudRadius")),t.fragment.uniforms.add(new kr("halfCubeMapSize")),t.fragment.uniforms.add(new kr("power")),t.fragment.uniforms.add(new kr("sigmaE")),t.fragment.uniforms.add(new kr("density")),t.fragment.uniforms.add(new kr("cloudSize")),t.fragment.uniforms.add(new kr("detailSize")),t.fragment.uniforms.add(new kr("smoothness")),t.fragment.uniforms.add(new kr("cloudHeight")),t.fragment.uniforms.add(new kr("coverage")),t.fragment.uniforms.add(new kI("view",r=>r.viewMatrix)),t.fragment.uniforms.add(new Hi("cloudShapeTexture")),t.fragment.code.add(S`
    const int STEPS = ${e.steps===Zp.SIXTEEN?S`16`:e.steps===Zp.HUNDRED?S`100`:S`200`};
    const int STEPS_LIGHT = 6;
    const float stepL = 300.0 / float(STEPS_LIGHT);
    const float cloudStart = 1500.0;

    vec3 rayDirection(vec2 fragCoord) {
      vec2 xy = fragCoord - halfCubeMapSize;
      return normalize(vec3(-xy, -halfCubeMapSize));
    }

    float remap(float x, float low1, float high1, float low2, float high2) {
      return low2 + (x - low1) * (high2 - low2) / (high1 - low1);
    }

    float saturate(float x) {
      return clamp(x, 0.0, 1.0);
    }`),t.fragment.code.add(S`
    float getCloudShape(vec3 pos, float pOffset) {
      const float textureWidth = ${S.float(qp)};
      const float dataWidth = ${S.float(qp)};
      const float tileRows = ${S.float($p)};
      const vec3 atlasDimensions = vec3(${S.float(pd)}, ${S.float(pd)}, tileRows * tileRows);

      //Change from Y being height to Z being height
      vec3 p = float(${S.float(Kot)}) * pos.xzy;

      //Pixel coordinates of point in the 3D data
      vec3 coord = vec3(mod(p - pOffset * atlasDimensions, atlasDimensions));
      float f = fract(coord.z);
      float level = floor(coord.z);
      float tileY = floor(level / tileRows);
      float tileX = level - tileY * tileRows;

      //The data coordinates are offset by the x and y tile, the two boundary cells between each tile pair and the initial boundary cell on the first row/column
      vec2 offset = atlasDimensions.x * vec2(tileX, tileY) + 2.0 * vec2(tileX, tileY) + 1.0;
      vec2 pixel = coord.xy + offset;
      vec2 data = texture2D(cloudShapeTexture, mod(pixel, dataWidth) / textureWidth).xy;

      return 1.0 - mix(data.x, data.y, f);
    }

    float getCloudMap(vec2 p){
      // Non-power-of-two textures can't be tiled using WebGL1
      // Get fractional part of uv to tile
      // Shift the texture center to origin to avoid seam artifacts
      vec2 uv = fract((${S.float(tat)} * p) / ${S.float(qp)} + 0.5);

      return texture2D(cloudShapeTexture, uv).a;
    }
    `),t.fragment.code.add(S`float clouds(vec3 p) {
float cloud = saturate(0.5 * mix(0.0, 1.0, min(2.0 * coverage, 1.0)));
if (cloud <= 0.0) {
return 0.0;
}
float cloudMap = getCloudMap(cloudSize * p.xy);
cloud = mix(cloud, min(2.0 * (coverage), 1.0) * cloudMap, min(2.0 * (1.0 - coverage), 1.0));
if (cloud <= 0.0) {
return 0.0;
}
float shape = getCloudShape(8.0 * cloudSize * p, 0.0);
cloud = saturate(remap(cloud, smoothness * shape, 1.0, 0.0, 1.0));
if (cloud <= 0.0) {
return 0.0;
}
float heightFraction = saturate((length(p) - cloudRadius - cloudStart) / cloudHeight);
cloud *= saturate(remap(heightFraction, 0.0, 0.25, 0.0, 1.0)) * smoothstep(1.0, 0.25, heightFraction);
if (cloud <= 0.0) {
return 0.0;
}
return density * saturate(remap(cloud, 0.35 * smoothness * getCloudShape(detailSize * p, 0.0), 1.0, 0.0, 1.0));
}`),t.fragment.code.add(S`vec2 sphereIntersections(vec3 start, vec3 dir, float radius) {
float a = dot(dir, dir);
float b = 2.0 * dot(dir, start);
float c = dot(start, start) - (radius * radius);
float d = (b * b) - 4.0 * a * c;
if (d < 0.0) {
return vec2(1e5, -1e5);
}
return vec2((-b - sqrt(d)) / (2.0 * a), (-b + sqrt(d)) / (2.0 * a));
}
float HenyeyGreenstein(float g, float costh) {
return (1.0 / (4.0 * 3.1415))  * ((1.0 - g * g) / pow(1.0 + g * g - 2.0 * g * costh, 1.5));
}`),t.fragment.code.add(`
    vec3 multipleOctaves(float extinction, float mu, float stepL) {
      float attenuation = 1.0;
      float contribution = 1.0;
      float phaseAttenuation = 1.0;
      vec3 luminance = vec3(0);

      for (int i = 0; i < 4; i++) {
        float phase = mix(HenyeyGreenstein(0.0, mu), HenyeyGreenstein(0.3 * phaseAttenuation, mu), 0.7);
        luminance += contribution * phase * exp(-stepL * extinction * sigmaE * attenuation);
        attenuation *= 0.2;
        contribution *= 0.6;
        phaseAttenuation *= 0.5;
      }

      return luminance;
    }`),t.fragment.code.add(S`vec3 lightRay(vec3 org, vec3 p, float phaseFunction, float mu, vec3 sunDirection) {
float lightRayDensity = clouds(p);
lightRayDensity += clouds(p + sunDirection * 1.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 2.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 3.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 4.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 5.0 * stepL);
vec3 beersLaw = multipleOctaves(lightRayDensity, mu, stepL);
return mix(beersLaw * 2.0 * (1.0 - (exp(-stepL * lightRayDensity * 2.0 * sigmaE ))), beersLaw, 0.5 + 0.5 * mu);
}`),t.fragment.code.add(S`vec3 mainRay(vec3 org, vec3 dir, vec3 sunDirection, float distToStart, float totalDistance, out float totalTransmittance) {
if (dir.z < 0.0) {
return vec3(0);
}
totalTransmittance = 1.0;
float stepS = totalDistance / float(STEPS);
float cameraHeight = length(org);
float mu = 0.5 + 0.5 * dot(sunDirection, dir);
float phaseFunction = mix(HenyeyGreenstein(-0.3, mu), HenyeyGreenstein(0.3, mu), 0.7);
vec3 p = org + distToStart  * dir;
float dist = distToStart;
vec3 color = vec3(0.0);
for (int i = 0; i < STEPS; i++) {
float sampleDensity = clouds(p);
float sampleSigmaE = sampleDensity * sigmaE;
if (sampleDensity > 0.0 ) {
float ambient = mix((1.2), (1.6), saturate((length(p) - cloudRadius - cloudStart) / cloudHeight));
vec3 luminance = sampleDensity * (ambient + power * phaseFunction * lightRay(org, p, phaseFunction, mu, sunDirection));
float transmittance = exp(-sampleSigmaE * stepS);
color += totalTransmittance * (luminance - luminance * transmittance) / sampleSigmaE;
totalTransmittance *= transmittance;
if (totalTransmittance <= 0.001) {
totalTransmittance = 0.0;
break;
}
}
dist += stepS;
p = org + dir * dist;
}
return color;
}`),t.fragment.code.add(S`void main() {
vec3 rayDir = rayDirection(gl_FragCoord.xy);
rayDir = normalize(view * rayDir);
vec3 viewPos = vec3(0, 0, cloudRadius + 1.0);
bool hitsPlanet = rayDir.z < 0.0;
if (hitsPlanet) {
gl_FragColor = vec4(vec3(0), 1);
return;
}
vec2 rayStartIntersect = sphereIntersections(viewPos, rayDir, cloudRadius + cloudStart);
vec2 rayEndIntersect = sphereIntersections(viewPos, rayDir, cloudRadius + cloudStart + cloudHeight);
float distToStart = rayStartIntersect.y;
float totalDistance = rayEndIntersect.y - distToStart;
float totalTransmittance = 1.0;
vec3 sunDirection = normalize(vec3(0, 0, 1));
vec3 col = 0.5 * mainRay(viewPos, rayDir, sunDirection, distToStart, totalDistance, totalTransmittance).rgb;
gl_FragColor = vec4(col, totalTransmittance);
}`),t}const iat=Object.freeze(Object.defineProperty({__proto__:null,CloudsDrawParameters:COe,build:rat},Symbol.toStringTag,{value:"Module"}));class pO{constructor(t,r,i,s,n,o,a,l,c=.5){this.coverage=t,this.density=r,this.absorption=i,this.cloudSize=s,this.detailSize=n,this.smoothness=o,this.cloudHeight=a,this.raymarchingStepType=l,this.median=c}}const AOe={sunny:new pO([0,.6],[.03,.03],[0,0],[.9,.9],[.8,.8],[.7,.7],[.05,.05],Zp.SIXTEEN),cloudy:new pO([.3,.65],[.2,.4],[0,0],[.85,.85],[.75,.75],[.3,.4],[1,1],Zp.TWOHUNDRED,.6),rainy:new pO([.6,.8],[.5,.8],[.1,.5],[.9,.9],[.75,.75],[.5,.5],[1,1],Zp.TWOHUNDRED,.4),snowy:new pO([.25,.75],[.3,.3],[0,0],[.95,.95],[.7,.7],[.69,.75],[.3,1],Zp.HUNDRED,.65),foggy:new pO([.8,.8],[.5,.5],[0,0],[.95,.95],[.9,.9],[.55,.55],[.3,.3],Zp.SIXTEEN)};class yB extends gi{constructor(t,r){super(t,r,()=>this.destroy())}initializeProgram(t){const r=yB.shader.get().build(this.configuration);return new oi(t.rctx,r,zr)}initializePipeline(){return Gt({blending:No(Ae.ONE,Ae.ONE,Ae.ZERO,Ae.ZERO),depthTest:{func:_i.LEQUAL},colorWrite:or})}}yB.shader=new ni(iat,()=>ie(()=>import("./Clouds.glsl.81b9377e.js"),[],import.meta.url));var Ku;(function(e){e[e.Full=0]="Full",e[e.WeatherMap=1]="WeatherMap",e[e.COUNT=2]="COUNT"})(Ku||(Ku={}));class oQ extends vl{constructor(){super(...arguments),this.mode=Ku.Full}}u([q({count:Ku.COUNT})],oQ.prototype,"mode",void 0);function sat(e){const t=new Yr;return t.include(K1,!1),t.fragment.code.add(S`float remap(float x, float low1, float high1, float low2, float high2) {
return low2 + (x - low1) * (high2 - low2) / (high1 - low1);
}`),t.fragment.uniforms.add(new Zy("weatherTile")),e.mode===Ku.Full&&t.fragment.code.add(S`
    float saturate(float x) {
      return clamp(x, 0.0, 1.0);
    }

    // Safer modulo for positive and negative values
    vec3 modulo(vec3 m, float n){
      return mod(mod(m, n) + n, n);
    }

    vec3 hash(vec3 p3, float frequency){
      p3 = modulo(p3, frequency);
      p3 = fract(p3 * vec3(0.1031, 0.1030, 0.0973));
      p3 += dot(p3, p3.yxz + 33.33);
      return -1.0 + 2.0 * fract((p3.xxy + p3.yxx) * p3.zyx);
    }

    // 5th order polynomial interpolation
    vec3 fade(vec3 t){
      return (t * t * t) * (t * (t * 6.0 - 15.0) + 10.0);
    }

    float gradientNoise(vec3 p, float frequency){
      // Cell point is in
      vec3 i = floor(p);

      // Position in the cell in [0, 1]
      vec3 f = fract(p);

      // Interpolation value for gradient mixing
      vec3 u = fade(f);

      // Trilinear interpolation of gradients at cube vertices around point
      return mix( mix( mix( dot( hash( i + vec3(0.0,0.0,0.0), frequency), f - vec3(0.0,0.0,0.0) ),
                            dot( hash( i + vec3(1.0,0.0,0.0), frequency), f - vec3(1.0,0.0,0.0) ), u.x),
                       mix( dot( hash( i + vec3(0.0,1.0,0.0), frequency), f - vec3(0.0,1.0,0.0) ),
                            dot( hash( i + vec3(1.0,1.0,0.0), frequency), f - vec3(1.0,1.0,0.0) ), u.x), u.y),
                  mix( mix( dot( hash( i + vec3(0.0,0.0,1.0), frequency), f - vec3(0.0,0.0,1.0) ),
                            dot( hash( i + vec3(1.0,0.0,1.0), frequency), f - vec3(1.0,0.0,1.0) ), u.x),
                       mix( dot( hash( i + vec3(0.0,1.0,1.0), frequency), f - vec3(0.0,1.0,1.0) ),
                            dot( hash( i + vec3(1.0,1.0,1.0), frequency), f - vec3(1.0,1.0,1.0) ), u.x), u.y), u.z );
    }

    float getPerlinNoise(vec3 pos, float frequency) {
      float octaveFrequencyFactor = 2.0;
      float sum = 0.0;
      float weightSum = 0.0;
      float weight = 1.0;

      for (int oct = 0; oct < 3; oct++) {
        vec3 p = pos * frequency;
        float val = 0.5 + 0.5 * gradientNoise(p, frequency);
        sum += val * weight;
        weightSum += weight;
        weight *= 0.5;
        frequency *= octaveFrequencyFactor;
      }

      float noise = (sum / weightSum);
      noise = saturate(noise);
      return noise;
    }

    float worley(vec3 pos, float numCells) {
      vec3 p = pos * numCells;
      float d = 1.0e10;

      for (int x = -1; x <= 1; x++) {
        for (int y = -1; y <= 1; y++) {
          for (int z = -1; z <= 1; z++) {
            vec3 tp = floor(p) + vec3(x, y, z);
            tp = p - tp - (hash(tp, numCells) * 0.5 + 0.5);
            d = min(d, dot(tp, tp));
          }
        }
      }

      return 1.0 - clamp(d, 0.0, 1.0);
    }

    vec3 get3Dfrom2D(vec2 uv) {
      vec2 tile = floor(uv);
      float z = floor(${S.float($p)} * tile.y + tile.x);
      return vec3(fract(uv), z);
    }

    float getTextureForPointPerlinWorley(vec3 p) {
      float perlinNoise = getPerlinNoise(p, ${S.float(8)});

      float worley0 = worley(p, ${S.float(2)} * 2.0);
      float worley1 = worley(p, ${S.float(2)} * 8.0);
      float worley2 = worley(p, ${S.float(2)} * 14.0);

      float worleyFBM = worley0 * 0.625 + worley1 * 0.25 + worley2 * 0.125;
      return remap(perlinNoise, 0.0, 1.0, worleyFBM, 1.0);
    }

    float getTextureForPointWorley(vec3 p) {
      float worley0 = worley(p, ${S.float(2)});
      float worley1 = worley(p, ${S.float(2)} * 2.0);
      float worley2 = worley(p, ${S.float(2)} * 4.0);
      float worley3 = worley(p, ${S.float(2)} * 8.0);

      float FBM0 = worley0 * 0.625 + worley1 * 0.25 + worley2 * 0.125;
      float FBM1 = worley1 * 0.625 + worley2 * 0.25 + worley3 * 0.125;
      float FBM2 = worley2 * 0.75 + worley3 * 0.25;

      return FBM0 * 0.625 + FBM1 * 0.25 + FBM2 * 0.125;
    }
  `),t.fragment.code.add(S`
    vec2 modulo(vec2 m, float n){
      return mod(mod(m, n) + n, n);
    }

    vec2 hash(vec2 p){
      // Get position of p in weather tile
      p = modulo(p, ${S.float(s7)});

      // Get global coordinates of p
      p += weatherTile * ${S.float(s7)};

      // Limit position to avoid numerical instability
      p = modulo(p, ${S.float(eat)});

      vec3 p3 = fract(vec3(p.xyx) * vec3(0.1031, 0.1030, 0.0973));
      p3 += dot(p3, p3.yzx + 33.33);
      return 2.0 * fract((p3.xx + p3.yz) * p3.zy) - 1.0;
    }

    vec2 fade(vec2 t){
      return (t * t * t) * (t * (t * 6.0 - 15.0) + 10.0);
    }

    float gradientNoise(vec2 p){
      vec2 i = floor( p );
      vec2 f = fract( p );

      vec2 u = fade(f);

      // Bilinear interpolation of gradients at cell vertices around point
      return  mix(
                mix(dot( hash( i + vec2(0.0,0.0) ), f - vec2(0.0,0.0) ),
                    dot( hash( i + vec2(1.0,0.0) ), f - vec2(1.0,0.0) ), u.x),
                mix(dot( hash( i + vec2(0.0,1.0) ), f - vec2(0.0,1.0) ),
                    dot( hash( i + vec2(1.0,1.0) ), f - vec2(1.0,1.0) ), u.x),
                u.y);
    }

    float worley(vec2 p){
      float d = 1.0e10;
      for (int x = -1; x <= 1; x++){
        for (int y = -1; y <= 1; y++){
                vec2 tp = floor(p) + vec2(x, y);
                tp = p - tp - (0.5 + 0.5 * hash(tp));
                d = min(d, dot(tp, tp));
            }
        }
      return 1.0 - clamp(d, 0.0, 1.0);
    }
  `),t.fragment.code.add(S`void main() {`),e.mode===Ku.Full&&t.fragment.code.add(S`
        float padWidth = 1.0;
        float paddedSize = ${S.float(pd)} + 2.0 * padWidth;
        float tileCount = ${S.float($p)} * ${S.float($p)};
        vec2 tile = floor((gl_FragCoord.xy - 0.5) / paddedSize);

        bool padCell = false;
        if (mod(gl_FragCoord.x, paddedSize) == 0.5 || mod(gl_FragCoord.x, paddedSize) == paddedSize - 0.5) {
          padCell = true;
        }

        if (mod(gl_FragCoord.y, paddedSize) == 0.5 || mod(gl_FragCoord.y, paddedSize) == paddedSize - 0.5) {
          padCell = true;
        }

        bool startPadX = false;
        bool startPadY = false;
        bool endPadX = false;
        bool endPadY = false;

        if (gl_FragCoord.x == tile.x * paddedSize + 0.5) {
          startPadX = true;
        }

        if (gl_FragCoord.y == tile.y * paddedSize + 0.5) {
          startPadY = true;
        }

        if (gl_FragCoord.x == (tile.x + 1.0) * paddedSize - 0.5) {
          endPadX = true;
        }

        if (gl_FragCoord.y == (tile.y + 1.0) * paddedSize - 0.5) {
          endPadY = true;
        }

        vec2 padding = vec2(2.0 * padWidth) * tile;
        vec2 uv;

        if (padCell) {
          vec2 pixel = gl_FragCoord.xy - padWidth - padding;

          if (startPadX) {
            pixel.x += ${S.float(pd)};
          }

          if (startPadY) {
            pixel.y += ${S.float(pd)};
          }

          if (endPadX) {
            pixel.x -= ${S.float(pd)};
          }

          if (endPadY) {
            pixel.y -= ${S.float(pd)};
          }

          uv = vec2(pixel.xy / ${S.float(pd)});
        } else {
          vec2 pixel = gl_FragCoord.xy - padWidth - padding;
          uv = vec2(pixel.xy / ${S.float(pd)});
        }

        vec3 p_ = get3Dfrom2D(uv);
        vec3 p = p_;
        p.z /= (${S.float($p)} * ${S.float($p)});

        float worleyPerlinNoise = getTextureForPointPerlinWorley(p);
        float worleyNoise = getTextureForPointWorley(p);

        gl_FragColor.r = saturate(remap(worleyPerlinNoise, worleyNoise, 1.0, 0.0, 1.0));

        p_ = mod(p_ + 1.0, ${S.float($p)} * ${S.float($p)});
        p = p_;
        p.z /= (${S.float($p)} * ${S.float($p)});

        worleyPerlinNoise = getTextureForPointPerlinWorley(p);
        worleyNoise = getTextureForPointWorley(p);

        gl_FragColor.g = saturate(remap(worleyPerlinNoise, worleyNoise, 1.0, 0.0, 1.0));
      `),t.fragment.code.add(S`
      vec2 mapUV = ${S.float(s7)} * (gl_FragCoord.xy / ${S.float(qp)});
      float map = abs(gradientNoise(mapUV));
      map = remap(map, 0.25 * (1.0 - worley(8.0 * mapUV)), 1.0, 0.0, 1.0);

      ${e.mode===Ku.Full?S`gl_FragColor.ba = vec2(0.0, map);`:S`gl_FragColor = vec4(map);`};
    }
  `),t}const nat=Object.freeze(Object.defineProperty({__proto__:null,build:sat},Symbol.toStringTag,{value:"Module"}));class UI extends gi{initializeProgram(t){const r=UI.shader.get().build(this.configuration);return new oi(t.rctx,r,zr)}initializePipeline(){return Gt({blending:this.configuration.mode===Ku.Full?bg(Ae.ONE,Ae.ZERO):No(Ae.ZERO,Ae.ONE,Ae.ONE,Ae.ZERO),depthTest:{func:_i.ALWAYS},colorWrite:or})}}UI.shader=new ni(nat,()=>ie(()=>import("./NoiseTextureAtlas.glsl.05052788.js"),[],import.meta.url));class Y2{constructor(t,r){this._context=t,this._desc=r,this.type="renderbuffer",this._context.instanceCounter.increment(Nn.Renderbuffer,this);const i=this._context.gl;this.glName=i.createRenderbuffer(),this._context.bindRenderbuffer(this);const{width:s,height:n,internalFormat:o,multisampled:a}=r;if(a){if(this._context.type!==mr.WEBGL2)throw new Error("Multisampled renderbuffers are not supported in WebGL1!");i.renderbufferStorageMultisample(i.RENDERBUFFER,this.samples,o,s,n)}else i.renderbufferStorage(i.RENDERBUFFER,o,s,n)}get descriptor(){return this._desc}get samples(){const t=this._desc.samples,r=this._context.parameters.maxSamples;return t?Math.min(t,r):r}resize(t,r){const i=this._desc;if(i.width===t&&i.height===r)return;i.width=t,i.height=r;const s=this._context.gl;this._context.bindRenderbuffer(this),i.multisampled?s.renderbufferStorageMultisample(s.RENDERBUFFER,this.samples,i.internalFormat,i.width,i.height):s.renderbufferStorage(s.RENDERBUFFER,i.internalFormat,i.width,i.height)}dispose(){this._context&&(this._context.gl.deleteRenderbuffer(this.glName),this._context.instanceCounter.decrement(Nn.Renderbuffer,this),this._context=null)}}const oat=fe.getLogger("esri.views.webgl.FrameBufferObject");class Pi{constructor(t,r,i=null,s=null){var n;if(this._context=t,this._glName=null,this._depthAttachment=null,this._stencilAttachment=null,this._colorAttachments=new Map,this._initialized=!1,this._desc={...r},t.instanceCounter.increment(Nn.FramebufferObject,this),b(i)){Array.isArray(i)||(i=[i]);for(let o=0;o<i.length;++o){const a=i[o],l=Uu.COLOR_ATTACHMENT0+o;let c;xde(a)?(ny(a)?(c=a.descriptor,this._colorAttachments.set(l,a)):(c=a,this._colorAttachments.set(l,new nt(this._context,c))),vN(c,this._desc)):(wde(a)?(c=a.descriptor,this._colorAttachments.set(l,a)):(c=a,this._colorAttachments.set(l,new Y2(this._context,c))),n7(c,this._desc)),this._validateColorAttachmentPoint(l)}}if(b(s)){let o,a;if(xde(s))this._context.capabilities.depthTexture||console.error("Setting the depth/stencil texture as an attachment requires WEBGL_depth_texture or WebGL2"),ny(s)?(a=s.descriptor,this._depthStencilTexture=s):(a=s,this._depthStencilTexture=new nt(this._context,a)),vN(a,this._desc);else{wde(s)?(a=s.descriptor,o=s):(a=s,o=new Y2(this._context,a));const l=(n=this._desc.depthStencilTarget)!=null?n:Pr.DEPTH_STENCIL_RENDER_BUFFER;l===Pr.STENCIL_RENDER_BUFFER?this._stencilAttachment=o:l===Pr.DEPTH_RENDER_BUFFER||l===Pr.DEPTH_STENCIL_RENDER_BUFFER?this._depthAttachment=o:console.error('If a Renderbuffer is provided, "depthStencilTarget" must be one of STENCIL_RENDER_BUFFER, DEPTH_RENDER_BUFFER or DEPTH_STENCIL_RENDER_BUFFER'),n7(a,this._desc)}}}dispose(){if(!this._desc)return;const t=this._context.getBoundFramebufferObject();this._disposeColorAttachments(),this._disposeDepthStencilAttachments(),this._glName&&(this._context.gl.deleteFramebuffer(this._glName),this._glName=null),this._context.bindFramebuffer(t),this._context.instanceCounter.decrement(Nn.FramebufferObject,this),this._desc=null}get glName(){return this._glName}get descriptor(){return this._desc}get colorTexture(){const t=this._colorAttachments.get(Uu.COLOR_ATTACHMENT0);return t&&ny(t)?t:null}get colorAttachment(){return this._colorAttachments.get(Uu.COLOR_ATTACHMENT0)}get depthStencilAttachment(){return this._depthStencilTexture||this._depthAttachment||this._stencilAttachment}get depthStencilTexture(){return this._depthStencilTexture}get width(){return this._desc.width}get height(){return this._desc.height}get gpuMemoryUsage(){return[...this._colorAttachments].reduce((t,[r,i])=>t+bT(i),0)+bT(this.depthStencilAttachment)}getColorTexture(t){const r=this._colorAttachments.get(t);return r&&ny(r)?r:null}attachColorTexture(t,r=Uu.COLOR_ATTACHMENT0){!t||(this._validateColorAttachmentPoint(r),vN(t.descriptor,this._desc),this._disposeColorAttachments(),this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(t.glName,r)),this._colorAttachments.set(r,t))}detachColorTexture(t=Uu.COLOR_ATTACHMENT0){const r=this._colorAttachments.get(t);if(ny(r)){const i=r;return this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,t)),this._colorAttachments.delete(t),i}}setColorTextureTarget(t,r=Uu.COLOR_ATTACHMENT0){const i=this._colorAttachments.get(r);ny(i)&&this._framebufferTexture2D(i.glName,r,t)}attachDepthStencilTexture(t){if(R(t))return;const r=t.descriptor;r.pixelFormat!==ze.DEPTH_STENCIL&&console.error("Depth/Stencil texture must have a pixel type of DEPTH_STENCIL!"),r.dataType!==Ct.UNSIGNED_INT_24_8&&console.error("Depth/Stencil texture must have data type of UNSIGNED_INT_24_8!"),this._context.capabilities.depthTexture||console.error("Extension WEBGL_depth_texture isn't supported therefore it is no possible to set the depth/stencil texture!"),vN(r,this._desc),this._desc.depthStencilTarget&&this._desc.depthStencilTarget!==Pr.DEPTH_STENCIL_TEXTURE&&(this._desc.depthStencilTarget=Pr.DEPTH_STENCIL_TEXTURE),this._disposeDepthStencilAttachments(),this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(t.glName,sde)),this._depthStencilTexture=t}detachDepthStencilTexture(){const t=this._depthStencilTexture;return t&&this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,sde)),this._depthStencilTexture=null,t}attachDepthStencilBuffer(t){if(R(t))return;const r=t.descriptor;if(r.internalFormat!==ol.DEPTH_STENCIL&&r.internalFormat!==ol.DEPTH_COMPONENT16&&console.error("Depth/Stencil buffer must have correct internalFormat"),n7(r,this._desc),this._disposeDepthStencilAttachments(),this._desc.depthStencilTarget=r.internalFormat===ol.DEPTH_STENCIL?Pr.DEPTH_STENCIL_RENDER_BUFFER:Pr.DEPTH_RENDER_BUFFER,this._initialized){this._context.bindFramebuffer(this);const i=this._context.gl,s=this._desc.depthStencilTarget===Pr.DEPTH_RENDER_BUFFER?i.DEPTH_ATTACHMENT:i.DEPTH_STENCIL_ATTACHMENT;i.framebufferRenderbuffer(Qn.FRAMEBUFFER,s,i.RENDERBUFFER,t.glName)}this._depthAttachment=t}detachDepthStencilBuffer(){const t=this._context.gl,r=this._depthAttachment;if(r&&this._initialized){this._context.bindFramebuffer(this);const i=this._desc.depthStencilTarget===Pr.DEPTH_RENDER_BUFFER?t.DEPTH_ATTACHMENT:t.DEPTH_STENCIL_ATTACHMENT;t.framebufferRenderbuffer(Qn.FRAMEBUFFER,i,t.RENDERBUFFER,null)}return this._depthAttachment=null,r}detachAll(){this._colorAttachments.forEach((t,r)=>this._detachColorAttachment(r)),this.detachDepthStencilBuffer(),this.detachDepthStencilTexture()}copyToTexture(t,r,i,s,n,o,a){(t<0||r<0||n<0||o<0)&&console.error("Offsets cannot be negative!"),(i<=0||s<=0)&&console.error("Copy width and height must be greater than zero!");const l=this._desc,c=a.descriptor;a.descriptor.target!==mt.TEXTURE_2D&&console.error("Texture target must be TEXTURE_2D!"),(t+i>l.width||r+s>l.height||n+i>c.width||o+s>c.height)&&console.error("Bad dimensions, the current input values will attempt to read or copy out of bounds!");const h=this._context,p=h.bindTexture(a,nt.TEXTURE_UNIT_FOR_UPDATES);h.setActiveTexture(nt.TEXTURE_UNIT_FOR_UPDATES),h.bindFramebuffer(this),h.gl.copyTexSubImage2D(mt.TEXTURE_2D,0,n,o,t,r,i,s),h.bindTexture(p,nt.TEXTURE_UNIT_FOR_UPDATES)}readPixels(t,r,i,s,n,o,a){(i<=0||s<=0)&&console.error("Copy width and height must be greater than zero!"),a||console.error("Target memory is not initialized!"),this._context.bindFramebuffer(this),this._context.gl.readPixels(t,r,i,s,n,o,a)}async readPixelsAsync(t,r,i,s,n,o,a){if(this._context.type!==mr.WEBGL2)return ad()&&console.warn("Attempting to read pixels using pixel buffer object without WebGL2"),void this.readPixels(t,r,i,s,n,o,a);const l=this._context.gl,c=cr.createPixelPack(this._context,Cr.STREAM_READ,a.byteLength);this._context.bindBuffer(c),this._context.bindFramebuffer(this),l.readPixels(t,r,i,s,n,o,0),this._context.unbindBuffer(Tt.PIXEL_PACK_BUFFER),await c.getSubDataAsync(a),c.dispose()}resize(t,r){const i=this._desc;if(i.width!==t||i.height!==r){if(!this._initialized)return i.width=t,i.height=r,this._colorAttachments.forEach(s=>{s&&s.resize(t,r)}),void(this._depthStencilTexture&&this._depthStencilTexture.resize(t,r));i.width=t,i.height=r,this._colorAttachments.forEach(s=>{s&&s.resize(t,r)}),this._depthStencilTexture!=null?this._depthStencilTexture.resize(t,r):(this._depthAttachment||this._stencilAttachment)&&(this._depthAttachment&&this._depthAttachment.resize(t,r),this._stencilAttachment&&this._stencilAttachment.resize(t,r)),this._context.getBoundFramebufferObject()===this&&this._context.bindFramebuffer(null),this._initialized=!1}}initializeAndBind(t=Qn.FRAMEBUFFER){var h,p,f,m;const r=this._context.gl;if(this._initialized)return void r.bindFramebuffer(t,this.glName);this._glName&&r.deleteFramebuffer(this._glName);const i=this._context,s=r.createFramebuffer(),n=this._desc,o=(h=n.colorTarget)!=null?h:us.RENDER_BUFFER,a=(p=n.width)!=null?p:1,l=(f=n.height)!=null?f:1;if(r.bindFramebuffer(t,s),this._colorAttachments.size===0)if(o===us.TEXTURE||o===us.CUBEMAP)this._colorAttachments.set(Uu.COLOR_ATTACHMENT0,aat(i,n,this.descriptor.colorTarget===us.CUBEMAP?mt.TEXTURE_CUBE_MAP:mt.TEXTURE_2D));else{const g=new Y2(i,{internalFormat:gt.RGBA4,width:a,height:l});this._colorAttachments.set(Uu.COLOR_ATTACHMENT0,g)}this._colorAttachments.forEach((g,v)=>{g&&(ny(g)?this._framebufferTexture2D(g.glName,v,Tde(g),t):r.framebufferRenderbuffer(t,v,r.RENDERBUFFER,g.glName))});const c=(m=n.depthStencilTarget)!=null?m:Pr.NONE;switch(c){case Pr.DEPTH_RENDER_BUFFER:case Pr.DEPTH_STENCIL_RENDER_BUFFER:{this._depthAttachment||(this._depthAttachment=new Y2(i,{internalFormat:n.depthStencilTarget===Pr.DEPTH_RENDER_BUFFER?ol.DEPTH_COMPONENT16:ol.DEPTH_STENCIL,width:a,height:l}));const g=c===Pr.DEPTH_RENDER_BUFFER?r.DEPTH_ATTACHMENT:r.DEPTH_STENCIL_ATTACHMENT;r.framebufferRenderbuffer(t,g,r.RENDERBUFFER,this._depthAttachment.glName);break}case Pr.STENCIL_RENDER_BUFFER:this._stencilAttachment||(this._stencilAttachment=new Y2(i,{internalFormat:ol.STENCIL_INDEX8,width:a,height:l})),r.framebufferRenderbuffer(t,r.STENCIL_ATTACHMENT,r.RENDERBUFFER,this._stencilAttachment.glName);break;case Pr.DEPTH_STENCIL_TEXTURE:if(!this._depthStencilTexture){i.capabilities.depthTexture||console.error("Extension WEBGL_depth_texture isn't supported therefore it is no possible to set the depth/stencil texture as an attachment!");const g={target:mt.TEXTURE_2D,pixelFormat:ze.DEPTH_STENCIL,dataType:Ct.UNSIGNED_INT_24_8,samplingMode:et.NEAREST,wrapMode:xt.CLAMP_TO_EDGE,width:a,height:l};this._depthStencilTexture=new nt(i,g)}this._framebufferTexture2D(this._depthStencilTexture.glName,r.DEPTH_STENCIL_ATTACHMENT,Tde(this._depthStencilTexture),t)}LI()&&r.checkFramebufferStatus(t)!==r.FRAMEBUFFER_COMPLETE&&console.error("Framebuffer is incomplete!"),this._glName=s,this._initialized=!0}_framebufferTexture2D(t,r=Uu.COLOR_ATTACHMENT0,i=mt.TEXTURE_2D,s=Qn.FRAMEBUFFER,n=0){this._context.gl.framebufferTexture2D(s,r,i,t,n)}_detachColorAttachment(t){ad()&&console.warn("Detaching an FBO attachment can be a slow due to invalidating framebuffer completeness!");const r=this._context.gl,i=this._colorAttachments.get(t);return ny(i)?this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,t)):this._initialized&&(this._context.bindFramebuffer(this),r.framebufferRenderbuffer(Qn.FRAMEBUFFER,t,r.RENDERBUFFER,null)),this._colorAttachments.delete(t),i}_disposeColorAttachments(){this._colorAttachments.forEach((t,r)=>{this._detachColorAttachment(r),t.dispose()}),this._colorAttachments.clear()}_disposeDepthStencilAttachments(){const t=this._context.gl;if(this._depthAttachment){if(this._initialized){this._context.bindFramebuffer(this);const r=this._desc.depthStencilTarget===Pr.DEPTH_RENDER_BUFFER?t.DEPTH_ATTACHMENT:t.DEPTH_STENCIL_ATTACHMENT;t.framebufferRenderbuffer(Qn.FRAMEBUFFER,r,t.RENDERBUFFER,null)}this._depthAttachment.dispose(),this._depthAttachment=null}this._stencilAttachment&&(this._initialized&&(this._context.bindFramebuffer(this),t.framebufferRenderbuffer(Qn.FRAMEBUFFER,t.STENCIL_ATTACHMENT,t.RENDERBUFFER,null)),this._stencilAttachment.dispose(),this._stencilAttachment=null),this._depthStencilTexture&&(this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,t.DEPTH_STENCIL_ATTACHMENT)),this._depthStencilTexture.dispose(),this._depthStencilTexture=null)}_validateColorAttachmentPoint(t){if(Pi._MAX_COLOR_ATTACHMENTS===-1){const i=this._context.capabilities.drawBuffers;if(i){const s=this._context.gl;Pi._MAX_COLOR_ATTACHMENTS=s.getParameter(i.MAX_COLOR_ATTACHMENTS)}else Pi._MAX_COLOR_ATTACHMENTS=1}const r=t-Uu.COLOR_ATTACHMENT0;r+1>Pi._MAX_COLOR_ATTACHMENTS&&oat.error("esri.FrameBufferObject",`illegal attachment point for color attachment: ${r+1}. Implementation supports up to ${Pi._MAX_COLOR_ATTACHMENTS} color attachments`)}}function ny(e){return"type"in e&&e.type==="texture"}function wde(e){return"type"in e&&e.type==="renderbuffer"}function xde(e){return ny(e)||"pixelFormat"in e}function aat(e,t,r){return new nt(e,{target:r,pixelFormat:ze.RGBA,dataType:Ct.UNSIGNED_BYTE,samplingMode:et.NEAREST,wrapMode:xt.CLAMP_TO_EDGE,width:t.width,height:t.height})}function vN(e,t){e.target!==mt.TEXTURE_2D&&e.target!==mt.TEXTURE_CUBE_MAP&&console.error("Texture type must be TEXTURE_2D or TEXTURE_CUBE_MAP!"),t.width!==void 0&&t.width>=0&&t.height!==void 0&&t.height>=0?t.width===e.width&&t.height===e.height||console.error("Color attachment texture must match the framebuffer's!"):(t.width=e.width,t.height=e.height)}function n7(e,t){t.width!==void 0&&t.width>=0&&t.height!==void 0&&t.height>=0?t.width===e.width&&t.height===e.height||console.error("Renderbuffer dimensions must match the framebuffer's!"):(t.width=e.width,t.height=e.height)}function Tde(e){return e.descriptor.target===mt.TEXTURE_CUBE_MAP?mt.TEXTURE_CUBE_MAP_POSITIVE_X:mt.TEXTURE_2D}Pi._MAX_COLOR_ATTACHMENTS=-1;class ROe extends xe{constructor(t){let r;super(t),this._weatherTile=ll(0,0),this._needsRender=!0,this._frameBuffer=new Pi(t.context.renderContext.rctx,{colorTarget:us.TEXTURE,width:qp,height:qp},{target:mt.TEXTURE_2D,pixelFormat:ze.RGBA,dataType:Ct.UNSIGNED_BYTE,wrapMode:xt.CLAMP_TO_EDGE,samplingMode:et.LINEAR,hasMipmap:!1,width:qp,height:qp}),this._vao=_l(t.context.renderContext.rctx),this._shaderTechniqueRepository=t.context.shaderTechniqueRepository,this._ensureRendered=()=>(b(r)?b(this.weatherMapTechnique)&&this.weatherMapTechnique.compiled&&this._needsRender&&(r=this._render(t.context.renderContext.rctx,Ku.WeatherMap)):b(this.fullTechnique)&&this.fullTechnique.compiled&&(r=this._render(t.context.renderContext.rctx,Ku.Full)),r)}get textureAtlas(){return this._ensureRendered()}_setDirty(){this._needsRender=!0}updateWeatherMap(t){this._weatherTile[0]===t[0]&&this._weatherTile[1]===t[1]||(this._weatherTile=t,this._setDirty())}destroy(){this._fullTechnique=ti(this._fullTechnique),this._weatherMapTechnique=ti(this._weatherMapTechnique),this._frameBuffer=Ye(this._frameBuffer),this._vao=Ye(this._vao)}get fullTechnique(){if(R(this._fullTechnique)){const t=new oQ;t.mode=Ku.Full,this._fullTechnique=this._shaderTechniqueRepository.acquire(UI,t)}return this._fullTechnique}get weatherMapTechnique(){if(R(this._weatherMapTechnique)){const t=new oQ;t.mode=Ku.WeatherMap,this._weatherMapTechnique=this._shaderTechniqueRepository.acquire(UI,t)}return this._weatherMapTechnique}_render(t,r){if(R(this._vao)||R(this._frameBuffer))return null;const i=r===Ku.Full?this.fullTechnique:this.weatherMapTechnique;if(R(i))return null;const s=t.getViewport();t.setViewport(0,0,qp,qp),t.bindFramebuffer(this._frameBuffer);const n=t.bindTechnique(i);return n.setUniform2f("weatherTile",this._weatherTile[0],this._weatherTile[1]),t.bindVAO(this._vao),n.assertCompatibleVertexAttributeLocations(this._vao),t.gl.drawArrays(t.gl.TRIANGLE_STRIP,0,4),t.setViewport(s.x,s.y,s.width,s.height),this._needsRender=!1,this._frameBuffer.colorTexture}}u([d({constructOnly:!0})],ROe.prototype,"context",void 0);function OOe(e){e.include(xh),e.uniforms.add([new Ht("geometryDepthTexture",(t,r)=>r.multipassGeometry.linearDepthTexture),new _r("nearFar",(t,r)=>r.camera.nearFar)]),e.code.add(S`bool geometryDepthTest(vec2 pos, float elementDepth) {
float geometryDepth = linearDepthFromTexture(geometryDepthTexture, pos, nearFar);
return (elementDepth < (geometryDepth - 1.0));
}`)}class lat{constructor(){this.enabled=!1}}function Th(e,t){t.hasMultipassTerrain&&(e.fragment.include(xh),e.fragment.uniforms.add(new Ht("terrainDepthTexture",(r,i)=>i.multipassTerrain.linearDepthTexture)),e.fragment.uniforms.add(new _r("nearFar",(r,i)=>i.camera.nearFar)),e.fragment.uniforms.add(new _r("inverseViewport",(r,i)=>i.inverseViewport)),e.fragment.code.add(S`
    void terrainDepthTest(vec4 fragCoord, float fragmentDepth){
      float terrainDepth = linearDepthFromTexture(terrainDepthTexture, fragCoord.xy * inverseViewport, nearFar);
      if(fragmentDepth ${t.cullAboveGround?">":"<="} terrainDepth){
        discard;
      }
    }
  `))}class cat{constructor(){this.enabled=!1,this.cullAboveGround=!1}}function uat(e,t){const r=e.fragment.uniforms;r.add(new _r("nearFar",(i,s)=>s.camera.nearFar)),r.add(new Ht("depthMap",(i,s)=>s.linearDepthTexture)),r.add(new Ei("view",(i,s)=>s.ssr.camera.viewMatrix)),r.add(new Ei("proj",(i,s)=>s.ssr.camera.projectionMatrix)),r.add(new qe("invResolutionHeight",(i,s)=>1/s.ssr.camera.height)),r.add(new Ht("lastFrameColorMap",(i,s)=>s.ssr.lastFrameColorTexture)),r.add(new Ei("reprojectionMatrix",(i,s)=>s.ssr.reprojectionMatrix)),e.fragment.include(xh),e.fragment.code.add(S`
  vec2 reprojectionCoordinate(vec3 projectionCoordinate)
  {
    vec4 zw = proj * vec4(0.0, 0.0, -projectionCoordinate.z, 1.0);
    vec4 reprojectedCoord = reprojectionMatrix * vec4(zw.w * (projectionCoordinate.xy * 2.0 - 1.0), zw.z, zw.w);
    reprojectedCoord.xy /= reprojectedCoord.w;
    return reprojectedCoord.xy * 0.5 + 0.5;
  }

  const int maxSteps = ${t.highStepCount?"150;":"75;"}

  vec4 applyProjectionMat(mat4 projectionMat, vec3 x)
  {
    vec4 projectedCoord =  projectionMat * vec4(x, 1.0);
    projectedCoord.xy /= projectedCoord.w;
    projectedCoord.xy = projectedCoord.xy*0.5 + 0.5;
    return projectedCoord;
  }

  vec3 screenSpaceIntersection(vec3 dir, vec3 startPosition, vec3 viewDir, vec3 normal)
  {
    vec3 viewPos = startPosition;
    vec3 viewPosEnd = startPosition;

    // Project the start position to the screen
    vec4 projectedCoordStart = applyProjectionMat(proj, viewPos);
    vec3  Q0 = viewPos / projectedCoordStart.w; // homogeneous camera space
    float k0 = 1.0/ projectedCoordStart.w;

    // advance the position in the direction of the reflection
    viewPos += dir;

    vec4 projectedCoordVanishingPoint = applyProjectionMat(proj, dir);

    // Project the advanced position to the screen
    vec4 projectedCoordEnd = applyProjectionMat(proj, viewPos);
    vec3  Q1 = viewPos / projectedCoordEnd.w; // homogeneous camera space
    float k1 = 1.0/ projectedCoordEnd.w;

    // calculate the reflection direction in the screen space
    vec2 projectedCoordDir = (projectedCoordEnd.xy - projectedCoordStart.xy);
    vec2 projectedCoordDistVanishingPoint = (projectedCoordVanishingPoint.xy - projectedCoordStart.xy);

    float yMod = min(abs(projectedCoordDistVanishingPoint.y), 1.0);

    float projectedCoordDirLength = length(projectedCoordDir);
    float maxSt = float(maxSteps);

    // normalize the projection direction depending on maximum steps
    // this determines how blocky the reflection looks
    vec2 dP = yMod * (projectedCoordDir)/(maxSt * projectedCoordDirLength);

    // Normalize the homogeneous camera space coordinates
    vec3  dQ = yMod * (Q1 - Q0)/(maxSt * projectedCoordDirLength);
    float dk = yMod * (k1 - k0)/(maxSt * projectedCoordDirLength);

    // initialize the variables for ray marching
    vec2 P = projectedCoordStart.xy;
    vec3 Q = Q0;
    float k = k0;
    float rayStartZ = -startPosition.z; // estimated ray start depth value
    float rayEndZ = -startPosition.z;   // estimated ray end depth value
    float prevEstimateZ = -startPosition.z;
    float rayDiffZ = 0.0;
    float dDepth;
    float depth;
    float rayDiffZOld = 0.0;

    // early outs
    if (dot(normal, dir) < 0.0 || dot(-viewDir, normal) < 0.0)
      return vec3(P, 0.0);

    for(int i = 0; i < maxSteps-1; i++)
    {
      depth = -linearDepthFromTexture(depthMap, P, nearFar); // get linear depth from the depth buffer

      // estimate depth of the marching ray
      rayStartZ = prevEstimateZ;
      dDepth = -rayStartZ - depth;
      rayEndZ = (dQ.z * 0.5 + Q.z)/ ((dk * 0.5 + k));
      rayDiffZ = rayEndZ- rayStartZ;
      prevEstimateZ = rayEndZ;

      if(-rayEndZ > nearFar[1] || -rayEndZ < nearFar[0] || P.y < 0.0  || P.y > 1.0 )
      {
        return vec3(P, 0.);
      }

      // If we detect a hit - return the intersection point, two conditions:
      //  - dDepth > 0.0 - sampled point depth is in front of estimated depth
      //  - if difference between dDepth and rayDiffZOld is not too large
      //  - if difference between dDepth and 0.025/abs(k) is not too large
      //  - if the sampled depth is not behind far plane or in front of near plane

      if((dDepth) < 0.025/abs(k) + abs(rayDiffZ) && dDepth > 0.0 && depth > nearFar[0] && depth < nearFar[1] && abs(P.y - projectedCoordStart.y) > invResolutionHeight)
      {
        return vec3(P, depth);
      }

      // continue with ray marching
      P += dP;
      Q.z += dQ.z;
      k += dk;
      rayDiffZOld = rayDiffZ;
    }
    return vec3(P, 0.0);
  }
  `)}class hat{constructor(){this.reprojectionMatrix=Ce()}}var Se;(function(e){e[e.INTEGRATED_MESH=0]="INTEGRATED_MESH",e[e.OPAQUE_TERRAIN=1]="OPAQUE_TERRAIN",e[e.OPAQUE_MATERIAL=2]="OPAQUE_MATERIAL",e[e.TRANSPARENT_MATERIAL=3]="TRANSPARENT_MATERIAL",e[e.TRANSPARENT_TERRAIN=4]="TRANSPARENT_TERRAIN",e[e.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL=5]="TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL",e[e.OCCLUDED_TERRAIN=6]="OCCLUDED_TERRAIN",e[e.OCCLUDER_MATERIAL=7]="OCCLUDER_MATERIAL",e[e.TRANSPARENT_OCCLUDER_MATERIAL=8]="TRANSPARENT_OCCLUDER_MATERIAL",e[e.OCCLUSION_PIXELS=9]="OCCLUSION_PIXELS",e[e.POSTPROCESSING_ENVIRONMENT_OPAQUE=10]="POSTPROCESSING_ENVIRONMENT_OPAQUE",e[e.POSTPROCESSING_ENVIRONMENT_TRANSPARENT=11]="POSTPROCESSING_ENVIRONMENT_TRANSPARENT",e[e.LASERLINES=12]="LASERLINES",e[e.LASERLINES_CONTRAST_CONTROL=13]="LASERLINES_CONTRAST_CONTROL",e[e.HUD_MATERIAL=14]="HUD_MATERIAL",e[e.LABEL_MATERIAL=15]="LABEL_MATERIAL",e[e.LINE_CALLOUTS=16]="LINE_CALLOUTS",e[e.LINE_CALLOUTS_HUD_DEPTH=17]="LINE_CALLOUTS_HUD_DEPTH",e[e.DRAPED_MATERIAL=18]="DRAPED_MATERIAL",e[e.DRAPED_WATER=19]="DRAPED_WATER",e[e.VOXEL=20]="VOXEL",e[e.MAX_SLOTS=21]="MAX_SLOTS"})(Se||(Se={}));class Eie{constructor(t=M()){this.intensity=t}}class MOe{constructor(t=M(),r=Ue(.57735,.57735,.57735)){this.intensity=t,this.direction=r}}class aQ{constructor(t=M(),r=Ue(.57735,.57735,.57735),i=!0,s=1,n=1){this.intensity=t,this.direction=r,this.castShadows=i,this.specularStrength=s,this.environmentStrength=n}}class POe{constructor(){this.r=[0],this.g=[0],this.b=[0]}}function dat(e,t,r){(r=r||e).length=e.length;for(let i=0;i<e.length;i++)r[i]=e[i]*t[i];return r}function o7(e,t,r){(r=r||e).length=e.length;for(let i=0;i<e.length;i++)r[i]=e[i]*t;return r}function gC(e,t,r){(r=r||e).length=e.length;for(let i=0;i<e.length;i++)r[i]=e[i]+t[i];return r}function IOe(e){return(e+1)*(e+1)}function pat(e){return Le(Math.floor(Math.sqrt(e)-1),0,2)}function $Oe(e,t,r){const i=e[0],s=e[1],n=e[2],o=r||[];return o.length=IOe(t),t>=0&&(o[0]=.28209479177),t>=1&&(o[1]=.4886025119*i,o[2]=.4886025119*n,o[3]=.4886025119*s),t>=2&&(o[4]=1.09254843059*i*s,o[5]=1.09254843059*s*n,o[6]=.31539156525*(3*n*n-1),o[7]=1.09254843059*i*n,o[8]=.54627421529*(i*i-s*s)),o}function fat(e,t){const r=IOe(e),i=t||{r:[],g:[],b:[]};i.r.length=i.g.length=i.b.length=r;for(let s=0;s<r;s++)i.r[s]=i.g[s]=i.b[s]=0;return i}function mat(e,t){const r=pat(t.r.length);for(const i of e)Ra(lQ,i.direction),$Oe(lQ,r,Py),dat(Py,X5),o7(Py,i.intensity[0],bS),gC(t.r,bS),o7(Py,i.intensity[1],bS),gC(t.g,bS),o7(Py,i.intensity[2],bS),gC(t.b,bS);return t}function gat(e,t){$Oe(lQ,0,Py);for(const r of e)t.r[0]+=Py[0]*X5[0]*r.intensity[0]*4*Math.PI,t.g[0]+=Py[0]*X5[0]*r.intensity[1]*4*Math.PI,t.b[0]+=Py[0]*X5[0]*r.intensity[2]*4*Math.PI;return t}function yat(e,t,r,i){fat(t,i),se(r.intensity,0,0,0);let s=!1;const n=vat,o=_at,a=bat;n.length=0,o.length=0,a.length=0;for(const l of e)l instanceof aQ&&!s?(ae(r.direction,l.direction),ae(r.intensity,l.intensity),r.specularStrength=l.specularStrength,r.environmentStrength=l.environmentStrength,r.castShadows=l.castShadows,s=!0):l instanceof aQ||l instanceof MOe?n.push(l):l instanceof Eie?o.push(l):l instanceof POe&&a.push(l);mat(n,i),gat(o,i);for(const l of a)gC(i.r,l.r),gC(i.g,l.g),gC(i.b,l.b)}const vat=[],_at=[],bat=[],Py=[0],bS=[0],lQ=M(),X5=[3.141593,2.094395,2.094395,2.094395,.785398,.785398,.785398,.785398,.785398],AR=.4;class wat{constructor(){this._shOrder=2,this._oldSunlight={direction:M(),ambient:{color:M(),intensity:1},diffuse:{color:M(),intensity:1}},this.globalFactor=.5,this.groundLightingFactor=.5,this._sphericalHarmonics=new POe,this._mainLight={intensity:M(),direction:Ue(1,0,0),castShadows:!1,specularStrength:1,environmentStrength:1}}get sh(){return this._sphericalHarmonics}get mainLight(){return this._mainLight}get lightingMainDirection(){return this._mainLight.direction}set(t){yat(t,this._shOrder,this._mainLight,this._sphericalHarmonics),ae(this._oldSunlight.direction,this._mainLight.direction);const r=1/Math.PI;this._oldSunlight.ambient.color[0]=.282095*this._sphericalHarmonics.r[0]*r,this._oldSunlight.ambient.color[1]=.282095*this._sphericalHarmonics.g[0]*r,this._oldSunlight.ambient.color[2]=.282095*this._sphericalHarmonics.b[0]*r,le(this._oldSunlight.diffuse.color,this._mainLight.intensity,r),ae(_N,this._oldSunlight.diffuse.color),le(_N,_N,AR*this.globalFactor),de(this._oldSunlight.ambient.color,this._oldSunlight.ambient.color,_N)}get old(){return this._oldSunlight}}const _N=M();class vB{constructor(t,r,i){this.shadowMap=t,this.ssaoHelper=r,this.slicePlane=i,this.slot=Se.OPAQUE_MATERIAL,this.hasOccludees=!1,this.enableFillLights=!0,this._inverseViewport=rt(),this.lighting=new wat,this.ssr=new hat,this.multipassTerrain=new cat,this.multipassGeometry=new lat,this.clouds=new cot,this.overlays=[]}get camera(){return this._camera}set camera(t){this._camera=this.ssr.camera=t,this._inverseViewport[0]=1/t.fullViewport[2],this._inverseViewport[1]=1/t.fullViewport[3]}get inverseViewport(){return this._inverseViewport}}let Xa=class extends xe{constructor(e){super(e),this._frameTask=null,this._handles=new Dt,this._cubeMapSize=he("esri-mobile")?1024:2048,this._techniques=[],this._techniqueConfiguration=new EOe,this._bindParameters=new vB(null,null,null),this._drawParameters=new COe,this._weatherTile=ll(0,0),this._weatherTileCount=128,this.coverage=Yt(xl.coverage[0],xl.coverage[1],.5),this.density=Yt(xl.density[0],xl.density[1],.5),this.absorption=Yt(xl.absorption[0],xl.absorption[1],.5),this.cloudSize=Yt(xl.cloudSize[0],xl.cloudSize[1],.5),this.detailSize=Yt(xl.detailSize[0],xl.detailSize[1],.5),this.smoothness=Yt(xl.smoothness[0],xl.smoothness[1],.5),this.cloudHeight=Yt(xl.cloudHeight[0],xl.cloudHeight[1],.5),this.raymarchingStepType=xl.raymarchingStepType,this._cloudRadius=0,this._viewMatrix=Ce(),this._cameraPositionLastFrame=M(),this.running=!1}_getTechnique(e){return this._techniques[e]||(this._techniqueConfiguration.steps=e,this._techniques[e]=new yB({rctx:this.context.renderContext.rctx,viewingMode:this.view.state.viewingMode},this._techniqueConfiguration),this._techniques[e])}_getWeatherTile(){const e=this.view.camera.position.latitude,t=this.view.camera.position.longitude;let r=ll((e+90)/180,(t+180)/360);const i=Math.floor(this._weatherTileCount*Math.abs(2*r[0]-1));r=ll(Math.floor(2*this._weatherTileCount*r[0]),Math.floor(4*(this._weatherTileCount-i)*r[1]));let s=0,n=0;if(b(this.view.environment)&&this.view.environment.lighting.type==="sun"&&b(this.view.environment.lighting.date)){const o=new Date(this.view.environment.lighting.date);o.setUTCHours(this.view.environment.lighting.date.getUTCHours()+this.view.environment.lighting.displayUTCOffset),s=31*o.getUTCMonth()+o.getUTCDate(),n=o.getUTCFullYear()}return r[0]=(r[0]+s)%(2*this._weatherTileCount),r[1]=(r[1]+n%100)%(4*this._weatherTileCount),r}initialize(){this._vao=_l(this.context.renderContext.rctx);const e=Ar(this.view.spatialReference);this._cloudRadius=.5*e.radius,this.setDirty(),this._weatherTile=this._getWeatherTile(),this._frameTask=this.view.resourceController.scheduler.registerTask(vt.CLOUDS_GENERATOR,this),this._handles.add(this._frameTask),this._handles.add(te(()=>[this.coverage,this.density,this.absorption,this.cloudSize,this.detailSize,this.smoothness,this.cloudHeight,this.raymarchingStepType],()=>this.setDirty(),Rt))}destroy(){this._handles.destroy(),this._techniques.forEach(e=>ti(e)),this._techniques=null,this._frameBufferCube=Ye(this._frameBufferCube),this._vao=Ye(this._vao),this._noiseTexture=ct(this._noiseTexture)}_ensureNoiseTexture(){if(R(this._noiseTexture)){const e=this.context;this._noiseTexture=new ROe({context:e}),this._noiseTexture.updateWeatherMap(this._weatherTile)}return this._noiseTexture.textureAtlas}ensureWeatherTile(){const e=this._getWeatherTile();b(this._noiseTexture)&&b(this.context)&&this._noiseTexture.updateWeatherMap(e),e[0]===this._weatherTile[0]&&e[1]===this._weatherTile[1]||(this._weatherTile=e,this.setDirty())}get frameBufferCube(){if(R(this._frameBufferCube)){const e={target:mt.TEXTURE_CUBE_MAP,pixelFormat:ze.RGBA,dataType:Ct.UNSIGNED_BYTE,wrapMode:xt.CLAMP_TO_EDGE,samplingMode:et.LINEAR,hasMipmap:!1,width:this._cubeMapSize,height:this._cubeMapSize};this._frameBufferCube=new Pi(this.context.renderContext.rctx,{colorTarget:us.CUBEMAP,width:this._cubeMapSize,height:this._cubeMapSize},e)}return this._frameBufferCube}get cubeMap(){return this._frameBufferCube}isFading(e){return e.crossFade.enabled||e.fadeInOut.stage===bo.FADE_OUT||e.fadeInOutHeight.stage!==m1.FINISHED}applyPreset(e,t){const r=e.median,i=s=>{const n=Yt(s[0],s[1],r);return t<.5?Yt(s[0],n,2*t):Yt(n,s[1],2*(t-.5))};this.coverage=i(e.coverage),this.density=i(e.density),this.absorption=i(e.absorption),this.cloudSize=i(e.cloudSize),this.detailSize=i(e.detailSize),this.smoothness=i(e.smoothness),this.cloudHeight=i(e.cloudHeight),this.raymarchingStepType=e.raymarchingStepType}setDirty(){this.running=!0}runTask(e){if(this.coverage===0||R(this._vao))return void(this.running=!1);const t=this._getTechnique(this.raymarchingStepType);if(!t.compiled)return;if(!cT(this._cameraPositionLastFrame,this.context.renderContext.bindParameters.camera.eye)||this.isFading(this.context.renderContext.bindParameters.clouds))return void ae(this._cameraPositionLastFrame,this.context.renderContext.bindParameters.camera.eye);this.ensureWeatherTile();const r=this._ensureNoiseTexture();if(R(r))return;const i=this.context.renderContext.rctx,s=i.bindTechnique(t),n=1+this.absorption,o=Yt(35,120,this.absorption);s.bindTexture("cloudShapeTexture",r),s.setUniform1f("cloudRadius",this._cloudRadius),s.setUniform1f("halfCubeMapSize",.5*this._cubeMapSize),s.setUniform1f("power",o),s.setUniform1f("sigmaE",n),s.setUniform1f("density",Yt(0,.3,this.density)),s.setUniform1f("cloudSize",Yt(0,.02,Math.max(.01,1-this.cloudSize))),s.setUniform1f("detailSize",Yt(0,.2,Math.max(.01,1-this.detailSize))),s.setUniform1f("smoothness",Yt(0,.5,1-this.smoothness)),s.setUniform1f("cloudHeight",Yt(0,1500,this.cloudHeight)),s.setUniform1f("coverage",this.coverage),i.bindVAO(this._vao),s.assertCompatibleVertexAttributeLocations(this._vao);const a=i.getViewport();i.setViewport(0,0,this._cubeMapSize,this._cubeMapSize),i.bindFramebuffer(this.frameBufferCube);for(let l=0;l<5;l++){const c=xat[l],h=Tat[l];Qxe(this._viewMatrix,Sat,c,h),Gd(this._drawParameters.viewMatrix,this._viewMatrix);const p=mt.TEXTURE_CUBE_MAP_POSITIVE_X+l;this.frameBufferCube.setColorTextureTarget(p),s.bindDraw(this._drawParameters,this._bindParameters),i.gl.drawArrays(i.gl.TRIANGLE_STRIP,0,4),i.gl.flush()}this.running=!1,i.setViewport(a.x,a.y,a.width,a.height),this.requestRender(),e.madeProgress()}};u([d({constructOnly:!0})],Xa.prototype,"context",void 0),u([d({constructOnly:!0})],Xa.prototype,"view",void 0),u([d({constructOnly:!0})],Xa.prototype,"requestRender",void 0),u([d()],Xa.prototype,"_frameTask",void 0),u([d()],Xa.prototype,"coverage",void 0),u([d()],Xa.prototype,"density",void 0),u([d()],Xa.prototype,"absorption",void 0),u([d()],Xa.prototype,"cloudSize",void 0),u([d()],Xa.prototype,"detailSize",void 0),u([d()],Xa.prototype,"smoothness",void 0),u([d()],Xa.prototype,"cloudHeight",void 0),u([d()],Xa.prototype,"raymarchingStepType",void 0),u([d()],Xa.prototype,"running",void 0),Xa=u([$("esri.views.3d.environment.CloudsGenerator")],Xa);const xat=[Dr(1,0,0),Dr(-1,0,0),Dr(0,1,0),Dr(0,-1,0),Dr(0,0,1)],Tat=[Dr(0,1,0),Dr(0,1,0),Dr(0,0,-1),Dr(0,0,1),Dr(0,1,0)],Sat=hie(),xl=AOe.sunny;function Eat(e){const t=new Yr;t.attributes.add(O.POSITION,"vec2"),t.include(Xy,{textureCoordinateType:_n.Default}),t.varyings.add("worldRay","vec3"),t.varyings.add("eyeDir","vec3");const{vertex:r,fragment:i}=t;return r.uniforms.add([new Ei("inverseProjectionMatrix",(s,n)=>n.camera.inverseProjectionMatrix),new Ei("inverseViewMatrix",(s,n)=>Cs(Cat,n.camera.viewMatrix))]),r.code.add(S`void main(void) {
vec3 posViewNear = (inverseProjectionMatrix * vec4(position, -1, 1)).xyz;
eyeDir = posViewNear;
worldRay = (inverseViewMatrix * vec4(posViewNear, 0)).xyz;
forwardTextureCoordinates();
gl_Position = vec4(position, 1, 1);
}`),i.uniforms.add(new kr("atmosphereC")),i.uniforms.add(new Yl("cameraPosition")),i.uniforms.add(new _r("nearFar",(s,n)=>n.camera.nearFar)),i.uniforms.add(new Hi("depthTex")),i.uniforms.add(new kr("fogStrength")),i.uniforms.add(new kr("fogAmount")),i.uniforms.add(new Yl("fogColor")),t.include(hB),i.include(xh),i.code.add(S`vec2 sphereIntersect(vec3 start, vec3 dir) {
float a = dot(dir, dir);
float b = 2.0 * dot(dir, start);
float d = (b * b) - 4.0 * a * atmosphereC;
if (d < 0.0) {
return vec2(1e5, -1e5);
}
return vec2((-b - sqrt(d)) / (2.0 * a), (-b + sqrt(d)) / (2.0 * a));
}`),i.code.add(S`vec4 applyFog(float dist, vec3 rayDir){
if(dist == -1.0){
vec2 rayAtmosphereIntersect = sphereIntersect(cameraPosition, rayDir);
dist = 0.055 * rayAtmosphereIntersect.y;
}
float fogAmount = fogAmount * (1.0 - exp(-dist * fogStrength));
return vec4(fogAmount * fogColor, fogAmount);
}`),i.code.add(S`
    vec3 tonemapACES(vec3 x) {
      return clamp((x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14), 0.0, 1.0);
    }

    void main() {
      vec3 rayDir = normalize(worldRay);
      float terrainDepth = -1.0;

      float depthSample = texture2D(depthTex, vuv0).r;
      float zNorm = 2.0 * depthSample - 1.0;
      float linDepth = 2.0 * nearFar[0] * nearFar[1] / (nearFar[1] + nearFar[0] - zNorm * (nearFar[1] - nearFar[0]));
      if(depthSample < 1.0 && depthSample > 0.0){
        vec3 cameraSpaceRay = normalize(eyeDir);
        cameraSpaceRay /= cameraSpaceRay.z;
        cameraSpaceRay *= linDepth;
        terrainDepth = max(0.0, length(cameraSpaceRay));
      }

      ${e.haze?S`
          if(terrainDepth == -1.0){
            gl_FragColor = vec4(0);
            return;
          }`:""}

      vec4 fog = applyFog(terrainDepth, rayDir);

      gl_FragColor = delinearizeGamma(vec4(tonemapACES(fog.rgb), fog.a));
    }
  `),t}const Cat=Ce(),Aat=Object.freeze(Object.defineProperty({__proto__:null,build:Eat},Symbol.toStringTag,{value:"Module"}));class VI extends gi{initializeProgram(t){const r=VI.shader.get().build(this.configuration);return new oi(t.rctx,r,zr)}initializePipeline(){return this.configuration.haze?Gt({blending:No(Ae.ONE,Ae.ZERO,Ae.ONE_MINUS_SRC_COLOR,Ae.ONE),colorWrite:or}):Gt({blending:No(Ae.SRC_ALPHA,Ae.ZERO,Ae.ONE_MINUS_SRC_ALPHA,Ae.ONE),colorWrite:or})}}VI.shader=new ni(Aat,()=>ie(()=>import("./Fog.glsl.13118ab7.js"),[],import.meta.url));class cQ extends vl{constructor(){super(...arguments),this.haze=!1}}u([q()],cQ.prototype,"haze",void 0);let h3=class extends xe{constructor(e){super(e),this._fogColor=Mr(),this._fogColorAtNight=Mr(),this._cameraDirection=Mr(),this._foggyFadeStart=.95,this._foggyFadeEnd=1,this._hazeFadeStart=.7,this._hazeFadeEnd=1,this._strength=4e-6;const t=e.context.renderContext.rctx;this._vao=_l(t,mL);const r=Ar(e.view.spatialReference);this._planetRadius=r.radius,this._atmosphereRadius=r.radius+j5}destroy(){this._hazeFogTechnique=ti(this._hazeFogTechnique),this._thickFogTechnique=ti(this._thickFogTechnique),this._vao=Ye(this._vao)}get _shaderTechniqueRepository(){return this.context.shaderTechniqueRepository}set strength(e){this._strength=e}get strength(){return this._strength}get thickFogTechnique(){if(R(this._thickFogTechnique)){const e=new cQ;e.haze=!1,this._thickFogTechnique=this._shaderTechniqueRepository.acquire(VI,e)}return this._thickFogTechnique}get hazeFogTechnique(){if(R(this._hazeFogTechnique)){const e=new cQ;e.haze=!0,this._hazeFogTechnique=this._shaderTechniqueRepository.acquire(VI,e)}return this._hazeFogTechnique}when(){return Promise.resolve()}render(e,t,r){if(this.view.basemapTerrain.baseOpacity===0&&!t||(this._update(e,t,r),this._fogAmount<=0))return;const i=t?this.thickFogTechnique:this.hazeFogTechnique;if(!i.compiled)return void this.context.requestRender();const s=e.offscreenRenderingHelper,n=e.rctx.bindTechnique(i,Rat,e.bindParameters);s.renderDepthDetached(()=>{n.bindTexture("depthTex",s.depthTexture),this._renderFog(i.program,e)})}_renderFog(e,t){if(R(this._vao))return!1;const r=t.rctx,i=t.bindParameters.camera;return e.setUniform3fv("cameraPosition",i.eye),e.setUniform1f("atmosphereC",this._atmosphereC),e.setUniform1f("fogStrength",this._strength),e.setUniform1f("fogAmount",this._fogAmount),e.setUniform3fv("fogColor",this._fogColor),r.bindVAO(this._vao),e.assertCompatibleVertexAttributeLocations(this._vao),r.drawArrays(Lt.TRIANGLE_STRIP,0,4),!0}_update(e,t,r){const i=e.bindParameters.camera,s=t?.1:0;r?se(this._fogColor,.5,.5,.5):t?se(this._fogColor,1.5,1.5,1.5):se(this._fogColor,.24,.44,.8),le(this._fogColorAtNight,this._fogColor,s),we(this._cameraDirection,i.eye);const n=Math.max(0,Te(this._cameraDirection,e.bindParameters.lighting.lightingMainDirection));En(this._fogColor,this._fogColorAtNight,this._fogColor,n);const o=Re(i.eye),a=o*o;this._atmosphereC=a-this._atmosphereRadius*this._atmosphereRadius,this._fogAmount=t?1-XC(this._foggyFadeStart*dd,this._foggyFadeEnd*dd,Math.abs(o-this._planetRadius)):1-XC(this._hazeFadeStart*dd,this._hazeFadeEnd*dd,Math.abs(o-this._planetRadius))}static isSupported(e){return e.capabilities.depthTexture}};u([d({constructOnly:!0})],h3.prototype,"context",void 0),u([d({constructOnly:!0})],h3.prototype,"view",void 0),h3=u([$("esri.views.3d.environment.Fog")],h3);const Rat=new nn;async function Sf(e,t){const{data:r}=await er(e,{responseType:"image",...t});return r}var og;(function(e){e[e.Cone=0]="Cone",e[e.Cylinder=1]="Cylinder",e[e.Underground=2]="Underground",e[e.COUNT=3]="COUNT"})(og||(og={}));class RV extends vl{constructor(){super(...arguments),this.geometry=og.Cone}}u([q({count:og.COUNT})],RV.prototype,"geometry",void 0);function ra(e,t={hasModelTransformation:!1,linearDepth:!1}){if(t.hasModelTransformation)return t.linearDepth?void e.vertex.code.add(S`vec4 transformPositionWithDepth(mat4 proj, mat4 view, mat4 model, vec3 pos, vec2 nearFar, out float depth) {
vec4 eye = view * (model * vec4(pos, 1.0));
depth = (-eye.z - nearFar[0]) / (nearFar[1] - nearFar[0]) ;
return proj * eye;
}`):void e.vertex.code.add(S`vec4 transformPosition(mat4 proj, mat4 view, mat4 model, vec3 pos) {
return proj * (view * (model * vec4(pos, 1.0)));
}`);t.linearDepth?e.vertex.code.add(S`vec4 transformPositionWithDepth(mat4 proj, mat4 view, vec3 pos, vec2 nearFar, out float depth) {
vec4 eye = view * vec4(pos, 1.0);
depth = (-eye.z - nearFar[0]) / (nearFar[1] - nearFar[0]) ;
return proj * eye;
}`):e.vertex.code.add(S`vec4 transformPosition(mat4 proj, mat4 view, vec3 pos) {
return proj * (view * vec4(pos, 1.0));
}`)}class I1 extends ss{constructor(t){super(t,"mat4")}}class Cie extends nn{}function Oat(e){const t=new Yr,{vertex:r,fragment:i}=t;if(e.geometry===og.Underground)t.attributes.add(O.POSITION,"vec2"),t.varyings.add("color","vec4"),r.uniforms.add([new St("lightingMainDirection",(s,n)=>n.lighting.lightingMainDirection),new Yl("cameraPosition"),new kr("undergroundFadeAlpha")]),r.code.add(S`void main(void) {
float ndotl = dot(normalize(cameraPosition), lightingMainDirection);
float lighting = max(0.0, smoothstep(-1.0, 0.8, 2.0 * ndotl));
color = vec4(vec3(lighting), undergroundFadeAlpha);
gl_Position = vec4(position.xy, 1.0, 1.0);
}`),i.code.add(S`void main() {
gl_FragColor = color;
}`);else{t.include(ra),t.attributes.add(O.POSITION,"vec3"),t.varyings.add("vtc","vec2"),t.varyings.add("falloff","float");const s=e.geometry===og.Cylinder;r.uniforms.add([new Ei("proj",(a,l)=>l.camera.projectionMatrix),new I1("view"),new St("lightingMainDirection",(a,l)=>l.lighting.lightingMainDirection)]),s||(t.varyings.add("innerFactor","float"),r.uniforms.add(new Yl("silCircleCenter")),r.uniforms.add(new Yl("silCircleV1")),r.uniforms.add(new Yl("silCircleV2")),r.uniforms.add(new Zy("texV")),r.uniforms.add(new kr("innerScale")));const n=6.2831853,o=1/128;r.code.add(S`
		void main(void) {
      ${s?S`
      vec3 pos = position;
      float ndotl = lightingMainDirection.z;
      vtc = vec2(0.0, position.z + 0.05);`:S`
      innerFactor = clamp(-position.z, 0.0, 1.0);
      float scale = position.y * (1.0 + innerFactor * innerScale);
      float phi = position.x * ${S.float(n*o)} + 1.0;
      vec3 pos =  (silCircleCenter + sin(phi) * silCircleV1 + cos(phi) * silCircleV2) * scale;
      float ndotl = dot(normalize(position.y > 0.0 ? pos: silCircleCenter), lightingMainDirection);
      vtc.x = position.x  * ${S.float(o)};
      vtc.y = texV.x * (1.0 - position.z) + texV.y * position.z;
      `}
      falloff = max(0.0, smoothstep(-1.0, 0.8, 2.0 * ndotl));

		  gl_Position = transformPosition(proj, view, pos);
		  gl_Position.z = gl_Position.w; // project atmosphere onto the far plane
    }
	  `),i.uniforms.add(new Ht("tex",a=>a.texture)),s||i.uniforms.add(new kr("altitudeFade")),i.code.add(S`
		void main() {
			vec4 atmosphereColor = texture2D(tex, vtc) * falloff;
      ${s?S`gl_FragColor = atmosphereColor;`:S`
			vec4 innerColor = vec4(atmosphereColor.rgb, 1.0 - altitudeFade);
			gl_FragColor = mix(atmosphereColor, innerColor, smoothstep(0.0, 1.0, innerFactor));
      `}
    }`)}return t}const Mat=Object.freeze(Object.defineProperty({__proto__:null,SimpleAtmospherePassParameters:Cie,build:Oat},Symbol.toStringTag,{value:"Module"}));class RA extends gi{initializeProgram(t){const r=RA.shader.get().build(this.configuration);return new oi(t.rctx,r,zr)}initializePipeline(){return this.configuration.geometry===og.Cylinder?Gt({blending:No(Ae.SRC_ALPHA,Ae.ONE,Ae.ONE_MINUS_SRC_ALPHA,Ae.ONE_MINUS_SRC_ALPHA),culling:nie,depthTest:{func:_i.LEQUAL},colorWrite:or}):Gt({blending:No(Ae.SRC_ALPHA,Ae.ONE,Ae.ONE_MINUS_SRC_ALPHA,Ae.ONE_MINUS_SRC_ALPHA),depthTest:{func:_i.LEQUAL},colorWrite:or})}}RA.shader=new ni(Mat,()=>ie(()=>import("./SimpleAtmosphere.glsl.66f48436.js"),[],import.meta.url));const LOe="data:image/png;base64, iVBORw0KGgoAAAANSUhEUgAAAAEAAAIACAYAAABD1gYFAAAACXBIWXMAAC4jAAAuIwF4pT92AAAKT2lDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVNnVFPpFj333vRCS4iAlEtvUhUIIFJCi4AUkSYqIQkQSoghodkVUcERRUUEG8igiAOOjoCMFVEsDIoK2AfkIaKOg6OIisr74Xuja9a89+bN/rXXPues852zzwfACAyWSDNRNYAMqUIeEeCDx8TG4eQuQIEKJHAAEAizZCFz/SMBAPh+PDwrIsAHvgABeNMLCADATZvAMByH/w/qQplcAYCEAcB0kThLCIAUAEB6jkKmAEBGAYCdmCZTAKAEAGDLY2LjAFAtAGAnf+bTAICd+Jl7AQBblCEVAaCRACATZYhEAGg7AKzPVopFAFgwABRmS8Q5ANgtADBJV2ZIALC3AMDOEAuyAAgMADBRiIUpAAR7AGDIIyN4AISZABRG8lc88SuuEOcqAAB4mbI8uSQ5RYFbCC1xB1dXLh4ozkkXKxQ2YQJhmkAuwnmZGTKBNA/g88wAAKCRFRHgg/P9eM4Ors7ONo62Dl8t6r8G/yJiYuP+5c+rcEAAAOF0ftH+LC+zGoA7BoBt/qIl7gRoXgugdfeLZrIPQLUAoOnaV/Nw+H48PEWhkLnZ2eXk5NhKxEJbYcpXff5nwl/AV/1s+X48/Pf14L7iJIEyXYFHBPjgwsz0TKUcz5IJhGLc5o9H/LcL//wd0yLESWK5WCoU41EScY5EmozzMqUiiUKSKcUl0v9k4t8s+wM+3zUAsGo+AXuRLahdYwP2SycQWHTA4vcAAPK7b8HUKAgDgGiD4c93/+8//UegJQCAZkmScQAAXkQkLlTKsz/HCAAARKCBKrBBG/TBGCzABhzBBdzBC/xgNoRCJMTCQhBCCmSAHHJgKayCQiiGzbAdKmAv1EAdNMBRaIaTcA4uwlW4Dj1wD/phCJ7BKLyBCQRByAgTYSHaiAFiilgjjggXmYX4IcFIBBKLJCDJiBRRIkuRNUgxUopUIFVIHfI9cgI5h1xGupE7yAAygvyGvEcxlIGyUT3UDLVDuag3GoRGogvQZHQxmo8WoJvQcrQaPYw2oefQq2gP2o8+Q8cwwOgYBzPEbDAuxsNCsTgsCZNjy7EirAyrxhqwVqwDu4n1Y8+xdwQSgUXACTYEd0IgYR5BSFhMWE7YSKggHCQ0EdoJNwkDhFHCJyKTqEu0JroR+cQYYjIxh1hILCPWEo8TLxB7iEPENyQSiUMyJ7mQAkmxpFTSEtJG0m5SI+ksqZs0SBojk8naZGuyBzmULCAryIXkneTD5DPkG+Qh8lsKnWJAcaT4U+IoUspqShnlEOU05QZlmDJBVaOaUt2ooVQRNY9aQq2htlKvUYeoEzR1mjnNgxZJS6WtopXTGmgXaPdpr+h0uhHdlR5Ol9BX0svpR+iX6AP0dwwNhhWDx4hnKBmbGAcYZxl3GK+YTKYZ04sZx1QwNzHrmOeZD5lvVVgqtip8FZHKCpVKlSaVGyovVKmqpqreqgtV81XLVI+pXlN9rkZVM1PjqQnUlqtVqp1Q61MbU2epO6iHqmeob1Q/pH5Z/YkGWcNMw09DpFGgsV/jvMYgC2MZs3gsIWsNq4Z1gTXEJrHN2Xx2KruY/R27iz2qqaE5QzNKM1ezUvOUZj8H45hx+Jx0TgnnKKeX836K3hTvKeIpG6Y0TLkxZVxrqpaXllirSKtRq0frvTau7aedpr1Fu1n7gQ5Bx0onXCdHZ4/OBZ3nU9lT3acKpxZNPTr1ri6qa6UbobtEd79up+6Ynr5egJ5Mb6feeb3n+hx9L/1U/W36p/VHDFgGswwkBtsMzhg8xTVxbzwdL8fb8VFDXcNAQ6VhlWGX4YSRudE8o9VGjUYPjGnGXOMk423GbcajJgYmISZLTepN7ppSTbmmKaY7TDtMx83MzaLN1pk1mz0x1zLnm+eb15vft2BaeFostqi2uGVJsuRaplnutrxuhVo5WaVYVVpds0atna0l1rutu6cRp7lOk06rntZnw7Dxtsm2qbcZsOXYBtuutm22fWFnYhdnt8Wuw+6TvZN9un2N/T0HDYfZDqsdWh1+c7RyFDpWOt6azpzuP33F9JbpL2dYzxDP2DPjthPLKcRpnVOb00dnF2e5c4PziIuJS4LLLpc+Lpsbxt3IveRKdPVxXeF60vWdm7Obwu2o26/uNu5p7ofcn8w0nymeWTNz0MPIQ+BR5dE/C5+VMGvfrH5PQ0+BZ7XnIy9jL5FXrdewt6V3qvdh7xc+9j5yn+M+4zw33jLeWV/MN8C3yLfLT8Nvnl+F30N/I/9k/3r/0QCngCUBZwOJgUGBWwL7+Hp8Ib+OPzrbZfay2e1BjKC5QRVBj4KtguXBrSFoyOyQrSH355jOkc5pDoVQfujW0Adh5mGLw34MJ4WHhVeGP45wiFga0TGXNXfR3ENz30T6RJZE3ptnMU85ry1KNSo+qi5qPNo3ujS6P8YuZlnM1VidWElsSxw5LiquNm5svt/87fOH4p3iC+N7F5gvyF1weaHOwvSFpxapLhIsOpZATIhOOJTwQRAqqBaMJfITdyWOCnnCHcJnIi/RNtGI2ENcKh5O8kgqTXqS7JG8NXkkxTOlLOW5hCepkLxMDUzdmzqeFpp2IG0yPTq9MYOSkZBxQqohTZO2Z+pn5mZ2y6xlhbL+xW6Lty8elQfJa7OQrAVZLQq2QqboVFoo1yoHsmdlV2a/zYnKOZarnivN7cyzytuQN5zvn//tEsIS4ZK2pYZLVy0dWOa9rGo5sjxxedsK4xUFK4ZWBqw8uIq2Km3VT6vtV5eufr0mek1rgV7ByoLBtQFr6wtVCuWFfevc1+1dT1gvWd+1YfqGnRs+FYmKrhTbF5cVf9go3HjlG4dvyr+Z3JS0qavEuWTPZtJm6ebeLZ5bDpaql+aXDm4N2dq0Dd9WtO319kXbL5fNKNu7g7ZDuaO/PLi8ZafJzs07P1SkVPRU+lQ27tLdtWHX+G7R7ht7vPY07NXbW7z3/T7JvttVAVVN1WbVZftJ+7P3P66Jqun4lvttXa1ObXHtxwPSA/0HIw6217nU1R3SPVRSj9Yr60cOxx++/p3vdy0NNg1VjZzG4iNwRHnk6fcJ3/ceDTradox7rOEH0x92HWcdL2pCmvKaRptTmvtbYlu6T8w+0dbq3nr8R9sfD5w0PFl5SvNUyWna6YLTk2fyz4ydlZ19fi753GDborZ752PO32oPb++6EHTh0kX/i+c7vDvOXPK4dPKy2+UTV7hXmq86X23qdOo8/pPTT8e7nLuarrlca7nuer21e2b36RueN87d9L158Rb/1tWeOT3dvfN6b/fF9/XfFt1+cif9zsu72Xcn7q28T7xf9EDtQdlD3YfVP1v+3Njv3H9qwHeg89HcR/cGhYPP/pH1jw9DBY+Zj8uGDYbrnjg+OTniP3L96fynQ89kzyaeF/6i/suuFxYvfvjV69fO0ZjRoZfyl5O/bXyl/erA6xmv28bCxh6+yXgzMV70VvvtwXfcdx3vo98PT+R8IH8o/2j5sfVT0Kf7kxmTk/8EA5jz/GMzLdsAAAAgY0hSTQAAeiUAAICDAAD5/wAAgOkAAHUwAADqYAAAOpgAABdvkl/FRgAAAXVJREFUeNq0k9GWhDAIQ3PjzP9/cuehFqhW19mz++IhkCZAq1prsqT+kSQS9g8Vnqp6VGVWkYVktR6tj3Gr968nLnfwlHzHYyHapkKS73bPd/39eI38AYWj24OGvqdwWjZ3l8IDgacXyl1Dj9tdLOzZiicj+P1YcGk0H2O2vN/VQpTveEHmPHQxZxYlqsQdhUeuCWREuDEvAjqlCqDIMYwIo2ijR1HdYUS58dQrKpgQ0EGeMocsTNXrxzyOhS9kfzlWjn82YuWLqwAnvfNEWJFjYXkJCT0s7AmS0NG4x7Lt6Cpy2MiVPBZmS668QT5AR1cevp7b6CpzQ/ZSNH0vmhy5CsNtdax0MBpXDBiFsrDiMSLKMc8b6hH93bNbEpRsIyHDUhNcfTyeKF16PC7c/2QdczvUnvOB1ylZHVFSMtd5s8C2IW/7w6hwM5GLavLCd1zkiFjB+BwH1DSgctQ7mPOimBLJrw35beSXkd8BM/cCqbXWPgMA+GQQ5sIgkfAAAAAASUVORK5CYII=";function du(e,t=0){const r=e.stride;return e.fieldNames.filter(i=>{const s=e.fields.get(i).optional;return!(s&&s.glPadding)}).map(i=>{const s=e.fields.get(i),n=s.constructor.ElementCount,o=Pat(s.constructor.ElementType),a=s.offset,l=!(!s.optional||!s.optional.glNormalized);return new Io(i,n,o,a,r,l,t)})}function Pat(e){const t=Iat[e];if(t)return t;throw new Error("BufferType not supported in WebGL")}const Iat={u8:pt.UNSIGNED_BYTE,u16:pt.UNSIGNED_SHORT,u32:pt.UNSIGNED_INT,i8:pt.BYTE,i16:pt.SHORT,i32:pt.INT,f32:pt.FLOAT};class Aie{constructor(t,r,i=0,s,n){this.TypedArrayConstructor=t,this.elementCount=9;const o=this.TypedArrayConstructor;s===void 0&&(s=9*o.BYTES_PER_ELEMENT);const a=r.byteLength===0?0:i;this.typedBuffer=n==null?new o(r,a):new o(r,a,(n-i)/o.BYTES_PER_ELEMENT),this.typedBufferStride=s/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(t,r,i=this.count-r){const s=this.typedBuffer.byteOffset+r*this.stride;return new t(this.buffer,s,this.stride,s+i*this.stride)}getMat(t,r){let i=t*this.typedBufferStride;for(let s=0;s<9;s++)r[s]=this.typedBuffer[i++];return r}setMat(t,r){let i=t*this.typedBufferStride;for(let s=0;s<9;s++)this.typedBuffer[i++]=r[s]}get(t,r){return this.typedBuffer[t*this.typedBufferStride+r]}set(t,r,i){this.typedBuffer[t*this.typedBufferStride+r]=i}copyFrom(t,r,i){const s=this.typedBuffer,n=r.typedBuffer;let o=t*this.typedBufferStride,a=i*r.typedBufferStride;for(let l=0;l<9;++l)s[o++]=n[a++]}get buffer(){return this.typedBuffer.buffer}}Aie.ElementCount=9;class Rie{constructor(t,r,i=0,s,n){this.TypedArrayConstructor=t,this.elementCount=16;const o=this.TypedArrayConstructor;s===void 0&&(s=16*o.BYTES_PER_ELEMENT);const a=r.byteLength===0?0:i;this.typedBuffer=n==null?new o(r,a):new o(r,a,(n-i)/o.BYTES_PER_ELEMENT),this.typedBufferStride=s/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(t,r,i=this.count-r){const s=this.typedBuffer.byteOffset+r*this.stride;return new t(this.buffer,s,this.stride,s+i*this.stride)}getMat(t,r){let i=t*this.typedBufferStride;for(let s=0;s<16;s++)r[s]=this.typedBuffer[i++];return r}setMat(t,r){let i=t*this.typedBufferStride;for(let s=0;s<16;s++)this.typedBuffer[i++]=r[s]}get(t,r){return this.typedBuffer[t*this.typedBufferStride+r]}set(t,r,i){this.typedBuffer[t*this.typedBufferStride+r]=i}copyFrom(t,r,i){const s=this.typedBuffer,n=r.typedBuffer;let o=t*this.typedBufferStride,a=i*r.typedBufferStride;for(let l=0;l<16;++l)s[o++]=n[a++]}get buffer(){return this.typedBuffer.buffer}}Rie.ElementCount=16;class P0{constructor(t,r,i=0,s,n){this.TypedArrayConstructor=t,this.elementCount=1;const o=this.TypedArrayConstructor;s===void 0&&(s=o.BYTES_PER_ELEMENT);const a=r.byteLength===0?0:i;this.typedBuffer=n==null?new o(r,a):new o(r,a,(n-i)/o.BYTES_PER_ELEMENT),this.typedBufferStride=s/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(t,r,i=this.count-r){const s=this.typedBuffer.byteOffset+r*this.stride;return new t(this.buffer,s,this.stride,s+i*this.stride)}get(t){return this.typedBuffer[t*this.typedBufferStride]}set(t,r){this.typedBuffer[t*this.typedBufferStride]=r}get buffer(){return this.typedBuffer.buffer}}P0.ElementCount=1;class I0{constructor(t,r,i=0,s,n){this.TypedArrayConstructor=t,this.elementCount=2;const o=this.TypedArrayConstructor;s===void 0&&(s=2*o.BYTES_PER_ELEMENT);const a=r.byteLength===0?0:i;this.typedBuffer=n==null?new o(r,a):new o(r,a,(n-i)/o.BYTES_PER_ELEMENT),this.typedBufferStride=s/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(t,r,i=this.count-r){const s=this.typedBuffer.byteOffset+r*this.stride;return new t(this.buffer,s,this.stride,s+i*this.stride)}getVec(t,r){return t*=this.typedBufferStride,vr(r,this.typedBuffer[t],this.typedBuffer[t+1])}setVec(t,r){t*=this.typedBufferStride,this.typedBuffer[t++]=r[0],this.typedBuffer[t]=r[1]}get(t,r){return this.typedBuffer[t*this.typedBufferStride+r]}set(t,r,i){this.typedBuffer[t*this.typedBufferStride+r]=i}setValues(t,r,i){t*=this.typedBufferStride,this.typedBuffer[t++]=r,this.typedBuffer[t]=i}copyFrom(t,r,i){const s=this.typedBuffer,n=r.typedBuffer;let o=t*this.typedBufferStride,a=i*r.typedBufferStride;s[o++]=n[a++],s[o]=n[a]}get buffer(){return this.typedBuffer.buffer}}I0.ElementCount=2;class $0{constructor(t,r,i=0,s,n){this.TypedArrayConstructor=t,this.elementCount=3;const o=this.TypedArrayConstructor;s===void 0&&(s=3*o.BYTES_PER_ELEMENT);const a=r.byteLength===0?0:i;this.typedBuffer=n==null?new o(r,a):new o(r,a,(n-i)/o.BYTES_PER_ELEMENT),this.typedBufferStride=s/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(t,r,i=this.count-r){const s=this.typedBuffer.byteOffset+r*this.stride;return new t(this.buffer,s,this.stride,s+i*this.stride)}getVec(t,r){return t*=this.typedBufferStride,se(r,this.typedBuffer[t],this.typedBuffer[t+1],this.typedBuffer[t+2])}setVec(t,r){t*=this.typedBufferStride,this.typedBuffer[t++]=r[0],this.typedBuffer[t++]=r[1],this.typedBuffer[t]=r[2]}get(t,r){return this.typedBuffer[t*this.typedBufferStride+r]}set(t,r,i){this.typedBuffer[t*this.typedBufferStride+r]=i}setValues(t,r,i,s){t*=this.typedBufferStride,this.typedBuffer[t++]=r,this.typedBuffer[t++]=i,this.typedBuffer[t]=s}copyFrom(t,r,i){const s=this.typedBuffer,n=r.typedBuffer;let o=t*this.typedBufferStride,a=i*r.typedBufferStride;s[o++]=n[a++],s[o++]=n[a++],s[o]=n[a]}get buffer(){return this.typedBuffer.buffer}}$0.ElementCount=3;class L0{constructor(t,r,i=0,s,n){this.TypedArrayConstructor=t,this.elementCount=4;const o=this.TypedArrayConstructor;s===void 0&&(s=4*o.BYTES_PER_ELEMENT);const a=r.byteLength===0?0:i;this.typedBuffer=n==null?new o(r,a):new o(r,a,(n-i)/o.BYTES_PER_ELEMENT),this.typedBufferStride=s/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(t,r,i=this.count-r){const s=this.typedBuffer.byteOffset+r*this.stride;return new t(this.buffer,s,this.stride,s+i*this.stride)}getVec(t,r){return t*=this.typedBufferStride,Kr(r,this.typedBuffer[t++],this.typedBuffer[t++],this.typedBuffer[t++],this.typedBuffer[t])}setVec(t,r){t*=this.typedBufferStride,this.typedBuffer[t++]=r[0],this.typedBuffer[t++]=r[1],this.typedBuffer[t++]=r[2],this.typedBuffer[t]=r[3]}get(t,r){return this.typedBuffer[t*this.typedBufferStride+r]}set(t,r,i){this.typedBuffer[t*this.typedBufferStride+r]=i}setValues(t,r,i,s,n){t*=this.typedBufferStride,this.typedBuffer[t++]=r,this.typedBuffer[t++]=i,this.typedBuffer[t++]=s,this.typedBuffer[t]=n}copyFrom(t,r,i){const s=this.typedBuffer,n=r.typedBuffer;let o=t*this.typedBufferStride,a=i*r.typedBufferStride;s[o++]=n[a++],s[o++]=n[a++],s[o++]=n[a++],s[o]=n[a]}get buffer(){return this.typedBuffer.buffer}}L0.ElementCount=4;class yL extends P0{constructor(t,r=0,i,s){super(Float32Array,t,r,i,s),this.elementType="f32"}static fromTypedArray(t,r){return new yL(t.buffer,t.byteOffset,r,t.byteOffset+t.byteLength)}}yL.ElementType="f32";class Hd extends I0{constructor(t,r=0,i,s){super(Float32Array,t,r,i,s),this.elementType="f32"}slice(t,r){return this.sliceBuffer(Hd,t,r)}static fromTypedArray(t,r){return new Hd(t.buffer,t.byteOffset,r,t.byteOffset+t.byteLength)}}Hd.ElementType="f32";class Zr extends $0{constructor(t,r=0,i,s){super(Float32Array,t,r,i,s),this.elementType="f32"}slice(t,r){return this.sliceBuffer(Zr,t,r)}static fromTypedArray(t,r){return new Zr(t.buffer,t.byteOffset,r,t.byteOffset+t.byteLength)}}Zr.ElementType="f32";class oo extends L0{constructor(t,r=0,i,s){super(Float32Array,t,r,i,s),this.elementType="f32"}slice(t,r){return this.sliceBuffer(oo,t,r)}static fromTypedArray(t,r){return new oo(t.buffer,t.byteOffset,r,t.byteOffset+t.byteLength)}}oo.ElementType="f32";class Ef extends Aie{constructor(t,r=0,i,s){super(Float32Array,t,r,i,s),this.elementType="f32"}slice(t,r){return this.sliceBuffer(Ef,t,r)}static fromTypedArray(t,r){return new Ef(t.buffer,t.byteOffset,r,t.byteOffset+t.byteLength)}}Ef.ElementType="f32";class $1 extends Aie{constructor(t,r=0,i,s){super(Float64Array,t,r,i,s),this.elementType="f64"}slice(t,r){return this.sliceBuffer($1,t,r)}static fromTypedArray(t,r){return new $1(t.buffer,t.byteOffset,r,t.byteOffset+t.byteLength)}}$1.ElementType="f64";class OA extends Rie{constructor(t,r=0,i,s){super(Float32Array,t,r,i,s),this.elementType="f32"}slice(t,r){return this.sliceBuffer(OA,t,r)}static fromTypedArray(t,r){return new OA(t.buffer,t.byteOffset,r,t.byteOffset+t.byteLength)}}OA.ElementType="f32";class L1 extends Rie{constructor(t,r=0,i,s){super(Float64Array,t,r,i,s),this.elementType="f64"}slice(t,r){return this.sliceBuffer(L1,t,r)}static fromTypedArray(t,r){return new L1(t.buffer,t.byteOffset,r,t.byteOffset+t.byteLength)}}L1.ElementType="f64";class MA extends P0{constructor(t,r=0,i,s){super(Float64Array,t,r,i,s),this.elementType="f64"}slice(t,r){return this.sliceBuffer(MA,t,r)}static fromTypedArray(t,r){return new MA(t.buffer,t.byteOffset,r,t.byteOffset+t.byteLength)}}MA.ElementType="f64";class PA extends I0{constructor(t,r=0,i,s){super(Float64Array,t,r,i,s),this.elementType="f64"}slice(t,r){return this.sliceBuffer(PA,t,r)}static fromTypedArray(t,r){return new PA(t.buffer,t.byteOffset,r,t.byteOffset+t.byteLength)}}PA.ElementType="f64";class Ns extends $0{constructor(t,r=0,i,s){super(Float64Array,t,r,i,s),this.elementType="f64"}slice(t,r){return this.sliceBuffer(Ns,t,r)}static fromTypedArray(t,r){return new Ns(t.buffer,t.byteOffset,r,t.byteOffset+t.byteLength)}}Ns.ElementType="f64";class xT extends L0{constructor(t,r=0,i,s){super(Float64Array,t,r,i,s),this.elementType="f64"}slice(t,r){return this.sliceBuffer(xT,t,r)}static fromTypedArray(t,r){return new xT(t.buffer,t.byteOffset,r,t.byteOffset+t.byteLength)}}xT.ElementType="f64";class b0 extends P0{constructor(t,r=0,i,s){super(Uint8Array,t,r,i,s),this.elementType="u8"}slice(t,r){return this.sliceBuffer(b0,t,r)}static fromTypedArray(t,r){return new b0(t.buffer,t.byteOffset,r,t.byteOffset+t.byteLength)}}b0.ElementType="u8";class TT extends I0{constructor(t,r=0,i,s){super(Uint8Array,t,r,i,s),this.elementType="u8"}slice(t,r){return this.sliceBuffer(TT,t,r)}static fromTypedArray(t,r){return new TT(t.buffer,t.byteOffset,r,t.byteOffset+t.byteLength)}}TT.ElementType="u8";class D1 extends $0{constructor(t,r=0,i,s){super(Uint8Array,t,r,i,s),this.elementType="u8"}slice(t,r){return this.sliceBuffer(D1,t,r)}static fromTypedArray(t,r){return new D1(t.buffer,t.byteOffset,r,t.byteOffset+t.byteLength)}}D1.ElementType="u8";class uc extends L0{constructor(t,r=0,i,s){super(Uint8Array,t,r,i,s),this.elementType="u8"}slice(t,r){return this.sliceBuffer(uc,t,r)}static fromTypedArray(t,r){return new uc(t.buffer,t.byteOffset,r,t.byteOffset+t.byteLength)}}uc.ElementType="u8";class ST extends P0{constructor(t,r=0,i,s){super(Uint16Array,t,r,i,s),this.elementType="u16"}slice(t,r){return this.sliceBuffer(ST,t,r)}static fromTypedArray(t,r){return new ST(t.buffer,t.byteOffset,r,t.byteOffset+t.byteLength)}}ST.ElementType="u16";class IA extends I0{constructor(t,r=0,i,s){super(Uint16Array,t,r,i,s),this.elementType="u16"}slice(t,r){return this.sliceBuffer(IA,t,r)}static fromTypedArray(t,r){return new IA(t.buffer,t.byteOffset,r,t.byteOffset+t.byteLength)}}IA.ElementType="u16";class ET extends $0{constructor(t,r=0,i,s){super(Uint16Array,t,r,i,s),this.elementType="u16"}slice(t,r){return this.sliceBuffer(ET,t,r)}static fromTypedArray(t,r){return new ET(t.buffer,t.byteOffset,r,t.byteOffset+t.byteLength)}}ET.ElementType="u16";class N1 extends L0{constructor(t,r=0,i,s){super(Uint16Array,t,r,i,s),this.elementType="u16"}slice(t,r){return this.sliceBuffer(N1,t,r)}static fromTypedArray(t,r){return new N1(t.buffer,t.byteOffset,r,t.byteOffset+t.byteLength)}}N1.ElementType="u16";class CT extends P0{constructor(t,r=0,i,s){super(Uint32Array,t,r,i,s),this.elementType="u32"}slice(t,r){return this.sliceBuffer(CT,t,r)}static fromTypedArray(t,r){return new CT(t.buffer,t.byteOffset,r,t.byteOffset+t.byteLength)}}CT.ElementType="u32";class $A extends I0{constructor(t,r=0,i,s){super(Uint32Array,t,r,i,s),this.elementType="u32"}slice(t,r){return this.sliceBuffer($A,t,r)}static fromTypedArray(t,r){return new $A(t.buffer,t.byteOffset,r,t.byteOffset+t.byteLength)}}$A.ElementType="u32";class zI extends $0{constructor(t,r=0,i,s){super(Uint32Array,t,r,i,s),this.elementType="u32"}slice(t,r){return this.sliceBuffer(zI,t,r)}static fromTypedArray(t,r){return new zI(t.buffer,t.byteOffset,r,t.byteOffset+t.byteLength)}}zI.ElementType="u32";class BI extends L0{constructor(t,r=0,i,s){super(Uint32Array,t,r,i,s),this.elementType="u32"}slice(t,r){return this.sliceBuffer(BI,t,r)}static fromTypedArray(t,r){return new BI(t.buffer,t.byteOffset,r,t.byteOffset+t.byteLength)}}BI.ElementType="u32";class LA extends P0{constructor(t,r=0,i,s){super(Int8Array,t,r,i,s),this.elementType="i8"}slice(t,r){return this.sliceBuffer(LA,t,r)}static fromTypedArray(t,r){return new LA(t.buffer,t.byteOffset,r,t.byteOffset+t.byteLength)}}LA.ElementType="i8";class AT extends I0{constructor(t,r=0,i,s){super(Int8Array,t,r,i,s),this.elementType="i8"}slice(t,r){return this.sliceBuffer(AT,t,r)}static fromTypedArray(t,r){return new AT(t.buffer,t.byteOffset,r,t.byteOffset+t.byteLength)}}AT.ElementType="i8";class GI extends $0{constructor(t,r=0,i,s){super(Int8Array,t,r,i,s),this.elementType="i8"}slice(t,r){return this.sliceBuffer(GI,t,r)}static fromTypedArray(t,r){return new GI(t.buffer,t.byteOffset,r,t.byteOffset+t.byteLength)}}GI.ElementType="i8";class jI extends L0{constructor(t,r=0,i,s){super(Int8Array,t,r,i,s),this.elementType="i8"}slice(t,r){return this.sliceBuffer(jI,t,r)}static fromTypedArray(t,r){return new jI(t.buffer,t.byteOffset,r,t.byteOffset+t.byteLength)}}jI.ElementType="i8";class HI extends P0{constructor(t,r=0,i,s){super(Int16Array,t,r,i,s),this.elementType="i16"}slice(t,r){return this.sliceBuffer(HI,t,r)}static fromTypedArray(t,r){return new HI(t.buffer,t.byteOffset,r,t.byteOffset+t.byteLength)}}HI.ElementType="i16";class RT extends I0{constructor(t,r=0,i,s){super(Int16Array,t,r,i,s),this.elementType="i16"}slice(t,r){return this.sliceBuffer(RT,t,r)}static fromTypedArray(t,r){return new RT(t.buffer,t.byteOffset,r,t.byteOffset+t.byteLength)}}RT.ElementType="i16";class qI extends $0{constructor(t,r=0,i,s){super(Int16Array,t,r,i,s),this.elementType="i16"}slice(t,r){return this.sliceBuffer(qI,t,r)}static fromTypedArray(t,r){return new qI(t.buffer,t.byteOffset,r,t.byteOffset+t.byteLength)}}qI.ElementType="i16";class WI extends L0{constructor(t,r=0,i,s){super(Int16Array,t,r,i,s),this.elementType="i16"}slice(t,r){return this.sliceBuffer(WI,t,r)}static fromTypedArray(t,r){return new WI(t.buffer,t.byteOffset,r,t.byteOffset+t.byteLength)}}WI.ElementType="i16";class XI extends P0{constructor(t,r=0,i,s){super(Int32Array,t,r,i,s),this.elementType="i32"}slice(t,r){return this.sliceBuffer(XI,t,r)}static fromTypedArray(t,r){return new XI(t.buffer,t.byteOffset,r,t.byteOffset+t.byteLength)}}XI.ElementType="i32";class ZI extends I0{constructor(t,r=0,i,s){super(Int32Array,t,r,i,s),this.elementType="i32"}slice(t,r){return this.sliceBuffer(ZI,t,r)}static fromTypedArray(t,r){return new ZI(t.buffer,t.byteOffset,r,t.byteOffset+t.byteLength)}}ZI.ElementType="i32";class YI extends $0{constructor(t,r=0,i,s){super(Int32Array,t,r,i,s),this.elementType="i32"}slice(t,r){return this.sliceBuffer(YI,t,r)}static fromTypedArray(t,r){return new YI(t.buffer,t.byteOffset,r,t.byteOffset+t.byteLength)}}YI.ElementType="i32";class QI extends L0{constructor(t,r=0,i,s){super(Int32Array,t,r,i,s),this.elementType="i32"}slice(t,r){return this.sliceBuffer(QI,t,r)}static fromTypedArray(t,r){return new QI(t.buffer,t.byteOffset,r,t.byteOffset+t.byteLength)}}QI.ElementType="i32";function DOe(e){switch(e){case"u8":case"i8":return 1;case"u16":case"i16":return 2;case"u32":case"i32":case"f32":return 4;case"f64":return 8;default:return}}function $at(e){switch(e){case"u8":case"u16":case"u32":return!1;case"i8":case"i16":case"i32":case"f32":case"f64":return!0;default:return}}function Lat(e){switch(e){case"u8":case"u16":case"u32":case"i8":case"i16":case"i32":return!0;case"f32":case"f64":return!1;default:return}}function Dat(e){switch(e){case"u8":return 255;case"u16":return 65535;case"u32":return 4294967295;case"i8":return 127;case"i16":return 32767;case"i32":return 2147483647;case"f32":return 3402823e32;case"f64":return 179769e303;default:return}}class OV{constructor(t,r){this.layout=t,this.buffer=typeof r=="number"?new ArrayBuffer(r*t.stride):r;for(const i of t.fieldNames){const s=t.fields.get(i);this[i]=new s.constructor(this.buffer,s.offset,this.stride)}}get stride(){return this.layout.stride}get count(){return this.buffer.byteLength/this.stride}get byteLength(){return this.buffer.byteLength}getField(t,r){const i=this[t];return i&&i.elementCount===r.ElementCount&&i.elementType===r.ElementType?i:null}slice(t,r){return new OV(this.layout,this.buffer.slice(t*this.stride,r*this.stride))}copyFrom(t,r,i,s){const n=this.stride;if(n%4==0){const o=new Uint32Array(t.buffer,r*n,s*n/4);new Uint32Array(this.buffer,i*n,s*n/4).set(o)}else{const o=new Uint8Array(t.buffer,r*n,s*n);new Uint8Array(this.buffer,i*n,s*n).set(o)}}}class Oie{constructor(){this.stride=0,this.fields=new Map,this.fieldNames=[]}vec2f(t,r){return this._appendField(t,Hd,r),this}vec2f64(t,r){return this._appendField(t,PA,r),this}vec3f(t,r){return this._appendField(t,Zr,r),this}vec3f64(t,r){return this._appendField(t,Ns,r),this}vec4f(t,r){return this._appendField(t,oo,r),this}vec4f64(t,r){return this._appendField(t,xT,r),this}mat3f(t,r){return this._appendField(t,Ef,r),this}mat3f64(t,r){return this._appendField(t,$1,r),this}mat4f(t,r){return this._appendField(t,OA,r),this}mat4f64(t,r){return this._appendField(t,L1,r),this}vec4u8(t,r){return this._appendField(t,uc,r),this}f32(t,r){return this._appendField(t,yL,r),this}f64(t,r){return this._appendField(t,MA,r),this}u8(t,r){return this._appendField(t,b0,r),this}u16(t,r){return this._appendField(t,ST,r),this}i8(t,r){return this._appendField(t,LA,r),this}vec2i8(t,r){return this._appendField(t,AT,r),this}vec2i16(t,r){return this._appendField(t,RT,r),this}vec2u8(t,r){return this._appendField(t,TT,r),this}vec4u16(t,r){return this._appendField(t,N1,r),this}u32(t,r){return this._appendField(t,CT,r),this}_appendField(t,r,i){const s=r.ElementCount*DOe(r.ElementType),n=this.stride;this.fields.set(t,{size:s,constructor:r,offset:n,optional:i}),this.stride+=s,this.fieldNames.push(t)}alignTo(t){return this.stride=Math.floor((this.stride+t-1)/t)*t,this}hasField(t){return this.fieldNames.includes(t)}createBuffer(t){return new OV(this,t)}createView(t){return new OV(this,t)}clone(){const t=new Oie;return t.stride=this.stride,t.fields=new Map,this.fields.forEach((r,i)=>t.fields.set(i,r)),t.fieldNames=this.fieldNames.slice(),t.BufferType=this.BufferType,t}}function ps(){return new Oie}var uQ;(function(e){function t(o,a){const l=o[a],c=o[a+1],h=o[a+2];return Math.sqrt(l*l+c*c+h*h)}function r(o,a){const l=o[a],c=o[a+1],h=o[a+2],p=1/Math.sqrt(l*l+c*c+h*h);o[a]*=p,o[a+1]*=p,o[a+2]*=p}function i(o,a,l){o[a]*=l,o[a+1]*=l,o[a+2]*=l}function s(o,a,l,c,h,p=a){(h=h||o)[p]=o[a]+l[c],h[p+1]=o[a+1]+l[c+1],h[p+2]=o[a+2]+l[c+2]}function n(o,a,l,c,h,p=a){(h=h||o)[p]=o[a]-l[c],h[p+1]=o[a+1]-l[c+1],h[p+2]=o[a+2]-l[c+2]}e.length=t,e.normalize=r,e.scale=i,e.add=s,e.subtract=n})(uQ||(uQ={}));const Va=Zt();class Nat{constructor(t){this.message=t}toString(){return`AssertException: ${this.message}`}}function ft(e,t){if(!e)throw t=t||"assert",console.log(new Error(t).stack),new Nat(t)}function wS(e,t){e||(t=t||"",console.warn("Verify failed: "+t+`
`+new Error("verify").stack))}function Sde(e,t,r,i){let s,n=(r[0]-e[0])/t[0],o=(i[0]-e[0])/t[0];n>o&&(s=n,n=o,o=s);let a=(r[1]-e[1])/t[1],l=(i[1]-e[1])/t[1];if(a>l&&(s=a,a=l,l=s),n>l||a>o)return!1;a>n&&(n=a),l<o&&(o=l);let c=(r[2]-e[2])/t[2],h=(i[2]-e[2])/t[2];return c>h&&(s=c,c=h,h=s),!(n>h||c>o)&&(h<o&&(o=h),!(o<0))}function bN(e,t,r,i,s,n=rt()){const o=(i[s]-r[s])*(t[0]-e[0])-(i[0]-r[0])*(t[s]-e[s]),a=(i[0]-r[0])*(e[s]-r[s])-(i[s]-r[s])*(e[0]-r[0]);if(o===0)return!1;const l=a/o;return n[0]=e[0]+l*(t[0]-e[0]),n[1]=e[s]+l*(t[s]-e[s]),!0}function Ede(e,t,r,i,s){s||(s=e),Va[0]=e[0],Va[1]=e[1],Va[2]=e[2],Va[3]=1,ih(Va,Va,t),s.length>2&&(s[2]=-Va[2]),ih(Va,Va,r),ft(Va[3]!==0),s[0]=Va[0]/Va[3],s[1]=Va[1]/Va[3],s[2]=Va[2]/Va[3],s[0]=(.5*s[0]+.5)*i[2]+i[0],s[1]=(.5*s[1]+.5)*i[3]+i[1]}function Fat(e,t){return Math.log(e)/Math.log(t)}function NOe(e,t,r,i){e[12]=t,e[13]=r,e[14]=i}function FOe(e){return e[0]===1&&e[1]===0&&e[2]===0&&e[3]===0&&e[4]===0&&e[5]===1&&e[6]===0&&e[7]===0&&e[8]===0&&e[9]===0&&e[10]===1&&e[11]===0&&e[15]===1}function kat(e,t,r){return 2*Math.atan(Math.sqrt(t*t+r*r)*Math.tan(.5*e)/t)}function Uat(e,t,r){return 2*Math.atan(Math.sqrt(t*t+r*r)*Math.tan(.5*e)/r)}function Vat(e,t,r){return 2*Math.atan(t*Math.tan(.5*e)/Math.sqrt(t*t+r*r))}function zat(e,t,r){return 2*Math.atan(r*Math.tan(.5*e)/Math.sqrt(t*t+r*r))}class _B{constructor(t,r,i,s){this.primitiveIndices=t,this._numIndexPerPrimitive=r,this.indices=i,this.position=s,this.center=M(),ft(t.length>=1),ft(i.length%this._numIndexPerPrimitive==0),ft(i.length>=t.length*this._numIndexPerPrimitive),ft(s.size===3||s.size===4);const{data:n,size:o}=s,a=t.length;let l=o*i[this._numIndexPerPrimitive*t[0]];mb.clear(),mb.push(l),this.bbMin=Ue(n[l],n[l+1],n[l+2]),this.bbMax=Qs(this.bbMin);for(let h=0;h<a;++h){const p=this._numIndexPerPrimitive*t[h];for(let f=0;f<this._numIndexPerPrimitive;++f){l=o*i[p+f],mb.push(l);let m=n[l];this.bbMin[0]=Math.min(m,this.bbMin[0]),this.bbMax[0]=Math.max(m,this.bbMax[0]),m=n[l+1],this.bbMin[1]=Math.min(m,this.bbMin[1]),this.bbMax[1]=Math.max(m,this.bbMax[1]),m=n[l+2],this.bbMin[2]=Math.min(m,this.bbMin[2]),this.bbMax[2]=Math.max(m,this.bbMax[2])}}En(this.center,this.bbMin,this.bbMax,.5),this.radius=.5*Math.max(Math.max(this.bbMax[0]-this.bbMin[0],this.bbMax[1]-this.bbMin[1]),this.bbMax[2]-this.bbMin[2]);let c=this.radius*this.radius;for(let h=0;h<mb.length;++h){l=mb.getItemAt(h);const p=n[l]-this.center[0],f=n[l+1]-this.center[1],m=n[l+2]-this.center[2],g=p*p+f*f+m*m;if(g<=c)continue;const v=Math.sqrt(g),w=.5*(v-this.radius);this.radius=this.radius+w,c=this.radius*this.radius;const _=w/v;this.center[0]+=p*_,this.center[1]+=f*_,this.center[2]+=m*_}mb.clear()}getCenter(){return this.center}getBSRadius(){return this.radius}getBBMin(){return this.bbMin}getBBMax(){return this.bbMax}getChildren(){if(this._children)return this._children;if(Fn(this.bbMin,this.bbMax)>1){const t=En(M(),this.bbMin,this.bbMax,.5),r=this.primitiveIndices.length,i=new Uint8Array(r),s=new Array(8);for(let c=0;c<8;++c)s[c]=0;const{data:n,size:o}=this.position;for(let c=0;c<r;++c){let h=0;const p=this._numIndexPerPrimitive*this.primitiveIndices[c];let f=o*this.indices[p],m=n[f],g=n[f+1],v=n[f+2];for(let w=1;w<this._numIndexPerPrimitive;++w){f=o*this.indices[p+w];const _=n[f],T=n[f+1],x=n[f+2];_<m&&(m=_),T<g&&(g=T),x<v&&(v=x)}m<t[0]&&(h|=1),g<t[1]&&(h|=2),v<t[2]&&(h|=4),i[c]=h,++s[h]}let a=0;for(let c=0;c<8;++c)s[c]>0&&++a;if(a<2)return;const l=new Array(8);for(let c=0;c<8;++c)l[c]=s[c]>0?new Uint32Array(s[c]):void 0;for(let c=0;c<8;++c)s[c]=0;for(let c=0;c<r;++c){const h=i[c];l[h][s[h]++]=this.primitiveIndices[c]}this._children=new Array(8);for(let c=0;c<8;++c)l[c]!==void 0&&(this._children[c]=new _B(l[c],this._numIndexPerPrimitive,this.indices,this.position))}return this._children}static prune(){mb.prune()}}const mb=new Xt({deallocator:null});class vL{constructor(){this.id=Jl()}unload(){}}var Cf;(function(e){e[e.Layer=0]="Layer",e[e.Object=1]="Object",e[e.Geometry=2]="Geometry",e[e.Material=3]="Material",e[e.Texture=4]="Texture",e[e.COUNT=5]="COUNT"})(Cf||(Cf={}));function Cde(e,t,r){const i=t[0]-e[0],s=t[1]-e[1],n=r[0]-e[0],o=r[1]-e[1];return .5*Math.abs(i*o-s*n)}function Bat(e,t,r){return pe(a7,t,e),pe(Ade,r,e),Re(ut(a7,a7,Ade))/2}new C0(yg);new C0(()=>({p0:null,p1:null,p2:null}));const a7=M(),Ade=M();let m_=(()=>{const e=new Uint32Array(131072);for(let t=0;t<e.length;++t)e[t]=t;return e})();const kOe=new Uint16Array([0]),MV=(()=>{const e=new Uint16Array(65536);for(let t=0;t<e.length;++t)e[t]=t;return e})();function DA(e){if(e===1)return kOe;if(e<MV.length)return new Uint16Array(MV.buffer,0,e);if(e>m_.length){const t=Math.max(2*m_.length,e);m_=new Uint32Array(t);for(let r=0;r<m_.length;r++)m_[r]=r}return new Uint32Array(m_.buffer,0,e)}function qLt(e){if(e===1)return new Uint16Array(kOe);if(e<MV.length)return new Uint16Array(MV.slice(0,e));if(e>m_.length){const t=new Uint32Array(e);for(let r=0;r<t.length;r++)t[r]=r;return t}return new Uint32Array(m_.slice(0,e))}function UOe(e,t,r){if(!e)return!1;const{size:i,data:s}=e;se(r,0,0,0),se(cd,0,0,0);let n=0,o=0;for(let a=0;a<t.length-2;a+=3){const l=t[a+0]*i,c=t[a+1]*i,h=t[a+2]*i;se(Jn,s[l+0],s[l+1],s[l+2]),se(Iy,s[c+0],s[c+1],s[c+2]),se(wN,s[h+0],s[h+1],s[h+2]);const p=Bat(Jn,Iy,wN);p?(de(Jn,Jn,Iy),de(Jn,Jn,wN),le(Jn,Jn,1/3*p),de(r,r,Jn),n+=p):(de(cd,cd,Jn),de(cd,cd,Iy),de(cd,cd,wN),o+=3)}return(o!==0||n!==0)&&(n!==0?(le(r,r,1/n),!0):o!==0&&(le(r,cd,1/o),!0))}function VOe(e,t,r){if(!e||!t)return!1;const{size:i,data:s}=e;se(r,0,0,0);let n=-1,o=0;for(let a=0;a<t.length;a++){const l=t[a]*i;n!==l&&(r[0]+=s[l+0],r[1]+=s[l+1],r[2]+=s[l+2],o++),n=l}return o>1&&le(r,r,1/o),o>0}function Mie(e,t,r,i){if(!e)return!1;const{size:s,data:n}=e;se(i,0,0,0),se(cd,0,0,0);let o=0,a=0;const l=t?t.length-1:n.length/s-1,c=l+(r?2:0);for(let h=0;h<c;h+=2){const p=h<l?h:l,f=h<l?h+1:0,m=(t?t[p]:p)*s,g=(t?t[f]:f)*s;Jn[0]=n[m+0],Jn[1]=n[m+1],Jn[2]=n[m+2],Iy[0]=n[g+0],Iy[1]=n[g+1],Iy[2]=n[g+2],le(Jn,de(Jn,Jn,Iy),.5);const v=fee(Jn,Iy);v>0?(de(i,i,le(Jn,Jn,v)),o+=v):(de(cd,cd,Jn),a++)}return o!==0?(le(i,i,1/o),!0):a!==0&&(le(i,cd,1/a),!0)}const Jn=M(),Iy=M(),wN=M(),cd=M();class Bi extends vL{constructor(t,r=[],i=rc.Triangle,s=-1){super(),this._primitiveType=i,this.edgeIndicesLength=s,this.type=Cf.Geometry,this._vertexAttributes=new Map,this._indices=new Map,this._boundingInfo=null;for(const[n,o]of t)o&&this._vertexAttributes.set(n,{...o});if(r==null||r.length===0){const n=Gat(this._vertexAttributes),o=DA(n);this.edgeIndicesLength=this.edgeIndicesLength<0?n:this.edgeIndicesLength;for(const a of this._vertexAttributes.keys())this._indices.set(a,o)}else for(const[n,o]of r)o&&(this._indices.set(n,jat(o)),n===O.POSITION&&(this.edgeIndicesLength=this.edgeIndicesLength<0?this._indices.get(n).length:this.edgeIndicesLength))}cloneShallow(){const t=new Bi([],void 0,this._primitiveType,void 0),{_vertexAttributes:r,_indices:i}=t;return this._vertexAttributes.forEach((s,n)=>{r.set(n,s)}),this._indices.forEach((s,n)=>{i.set(n,s)}),t.screenToWorldRatio=this.screenToWorldRatio,t._boundingInfo=this._boundingInfo,t}get vertexAttributes(){return this._vertexAttributes}getMutableAttribute(t){const r=this._vertexAttributes.get(t);return r&&!r.exclusive&&(r.data=Array.from(r.data),r.exclusive=!0),r}get indices(){return this._indices}get indexCount(){const t=this._indices.values().next().value;return t?t.length:0}get primitiveType(){return this._primitiveType}get faceCount(){return this.indexCount/3}get boundingInfo(){return R(this._boundingInfo)&&(this._boundingInfo=this._calculateBoundingInfo()),this._boundingInfo}computeAttachmentOrigin(t){return this.primitiveType===rc.Triangle?this._computeAttachmentOriginTriangles(t):this._computeAttachmentOriginPoints(t)}_computeAttachmentOriginTriangles(t){const r=this.indices.get(O.POSITION),i=this.vertexAttributes.get(O.POSITION);return UOe(i,r,t)}_computeAttachmentOriginPoints(t){const r=this.indices.get(O.POSITION),i=this.vertexAttributes.get(O.POSITION);return VOe(i,r,t)}invalidateBoundingInfo(){this._boundingInfo=null}_calculateBoundingInfo(){const t=this.indices.get(O.POSITION);if(t.length===0)return null;const r=this.primitiveType===rc.Triangle?3:1;ft(t.length%r==0,"Indexing error: "+t.length+" not divisible by "+r);const i=DA(t.length/r),s=this.vertexAttributes.get(O.POSITION);return new _B(i,r,t,s)}}function Gat(e){const t=e.values().next().value;return t==null?0:t.data.length/t.size}function jat(e){if(e.BYTES_PER_ELEMENT===Uint16Array.BYTES_PER_ELEMENT)return e;for(const t of e)if(t>=65536)return e;return new Uint16Array(e)}const xS=uQ;var l7,c7,u7,hQ;(function(e){const r=[[-.5,-.5,.5],[.5,-.5,.5],[.5,.5,.5],[-.5,.5,.5],[-.5,-.5,-.5],[.5,-.5,-.5],[.5,.5,-.5],[-.5,.5,-.5]],i=[0,0,1,-1,0,0,1,0,0,0,-1,0,0,1,0,0,0,-1],s=[0,0,1,0,1,1,0,1],n=new Uint16Array([0,1,2,2,3,0,4,0,3,3,7,4,1,5,6,6,2,1,1,0,4,4,5,1,3,2,6,6,7,3,5,4,7,7,6,5]),o=new Uint16Array(36);for(let c=0;c<6;c++)for(let h=0;h<6;h++)o[6*c+h]=c;const a=new Uint16Array(36);for(let c=0;c<6;c++)a[6*c+0]=0,a[6*c+1]=1,a[6*c+2]=2,a[6*c+3]=2,a[6*c+4]=3,a[6*c+5]=0;function l(c){Array.isArray(c)||(c=[c,c,c]);const h=new Array(24);for(let p=0;p<8;p++)h[3*p]=r[p][0]*c[0],h[3*p+1]=r[p][1]*c[1],h[3*p+2]=r[p][2]*c[2];return new Bi([[O.POSITION,{size:3,data:h,exclusive:!0}],[O.NORMAL,{size:3,data:i}],[O.UV0,{size:2,data:s}]],[[O.POSITION,n],[O.NORMAL,o],[O.UV0,a]])}e.createGeometry=l})(l7||(l7={})),function(e){const r=[[-.5,0,-.5],[.5,0,-.5],[.5,0,.5],[-.5,0,.5],[0,-.5,0],[0,.5,0]],i=[0,1,-1,1,1,0,0,1,1,-1,1,0,0,-1,-1,1,-1,0,0,-1,1,-1,-1,0],s=new Uint16Array([5,1,0,5,2,1,5,3,2,5,0,3,4,0,1,4,1,2,4,2,3,4,3,0]),n=new Uint16Array([0,0,0,1,1,1,2,2,2,3,3,3,4,4,4,5,5,5,6,6,6,7,7,7]);function o(a){Array.isArray(a)||(a=[a,a,a]);const l=new Array(18);for(let c=0;c<6;c++)l[3*c]=r[c][0]*a[0],l[3*c+1]=r[c][1]*a[1],l[3*c+2]=r[c][2]*a[2];return new Bi([[O.POSITION,{size:3,data:l,exclusive:!0}],[O.NORMAL,{size:3,data:i}]],[[O.POSITION,s],[O.NORMAL,n]])}e.createGeometry=o}(c7||(c7={})),function(e){const i=Dr(-.5,0,-.5),s=Dr(.5,0,-.5),n=Dr(0,0,.5),o=Dr(0,0+.5,0),a=Mr(),l=Mr(),c=Mr(),h=Mr(),p=Mr();pe(a,i,o),pe(l,i,s),ut(c,a,l),we(c,c),pe(a,s,o),pe(l,s,n),ut(h,a,l),we(h,h),pe(a,n,o),pe(l,n,i),ut(p,a,l),we(p,p);const f=[i,s,n,o],m=[0,-1,0,c[0],c[1],c[2],h[0],h[1],h[2],p[0],p[1],p[2]],g=[0,1,2,3,1,0,3,2,1,3,0,2],v=[0,0,0,1,1,1,2,2,2,3,3,3];function w(_){Array.isArray(_)||(_=[_,_,_]);const T=new Array(12);for(let x=0;x<4;x++)T[3*x]=f[x][0]*_[0],T[3*x+1]=f[x][1]*_[1],T[3*x+2]=f[x][2]*_[2];return new Bi([[O.POSITION,{size:3,data:T,exclusive:!0}],[O.NORMAL,{size:3,data:m}]],[[O.POSITION,new Uint16Array(g)],[O.NORMAL,new Uint16Array(v)]])}e.createGeometry=w}(u7||(u7={})),function(e){function t(x,E,C,A={uv:!0}){const P=-Math.PI,I=2*Math.PI,L=-Math.PI/2,k=Math.PI,G=Math.max(3,Math.floor(E)),z=Math.max(2,Math.floor(C)),X=(G+1)*(z+1),Z=new Float32Array(3*X),ce=new Float32Array(3*X),ne=new Float32Array(2*X),D=[];let N=0;for(let Y=0;Y<=z;Y++){const H=[],ee=Y/z,me=L+ee*k,be=Math.cos(me);for(let De=0;De<=G;De++){const ve=De/G,ge=P+ve*I,Ee=Math.cos(ge)*be,Fe=Math.sin(me),Nr=-Math.sin(ge)*be;Z[3*N]=Ee*x,Z[3*N+1]=Fe*x,Z[3*N+2]=Nr*x,ce[3*N]=Ee,ce[3*N+1]=Fe,ce[3*N+2]=Nr,ne[2*N]=ve,ne[2*N+1]=ee,H.push(N),++N}D.push(H)}const V=new Uint32Array(2*G*(z-1)*3);N=0;for(let Y=0;Y<z;Y++)for(let H=0;H<G;H++){const ee=D[Y][H],me=D[Y][H+1],be=D[Y+1][H+1],De=D[Y+1][H];Y===0?(V[N++]=ee,V[N++]=be,V[N++]=De):Y===z-1?(V[N++]=ee,V[N++]=me,V[N++]=be):(V[N++]=ee,V[N++]=me,V[N++]=be,V[N++]=be,V[N++]=De,V[N++]=ee)}const B=[[O.POSITION,V],[O.NORMAL,V]],W=[[O.POSITION,{size:3,data:Z,exclusive:!0}],[O.NORMAL,{size:3,data:ce,exclusive:!0}]];return A.uv&&(W.push([O.UV0,{size:2,data:ne,exclusive:!0}]),B.push([O.UV0,V])),A.offset&&(B[0][0]=O.OFFSET,W[0][0]=O.OFFSET,B.push([O.POSITION,new Uint32Array(V.length)]),W.push([O.POSITION,{size:3,data:Float64Array.from(A.offset),exclusive:!0}])),new Bi(W,B)}function r(x,E,C){const A=x;let P,I;if(C)P=[0,-1,0,1,0,0,0,0,1,-1,0,0,0,0,-1,0,1,0],I=new Uint32Array([0,1,2,0,2,3,0,3,4,0,4,1,1,5,2,2,5,3,3,5,4,4,5,1]);else{const Z=A*(1+Math.sqrt(5))/2;P=[-A,Z,0,A,Z,0,-A,-Z,0,A,-Z,0,0,-A,Z,0,A,Z,0,-A,-Z,0,A,-Z,Z,0,-A,Z,0,A,-Z,0,-A,-Z,0,A],I=new Uint32Array([0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1])}for(let Z=0;Z<P.length;Z+=3)xS.scale(P,Z,x/xS.length(P,Z));let L={};function k(Z,ce){Z>ce&&([Z,ce]=[ce,Z]);const ne=Z.toString()+"."+ce.toString();if(L[ne])return L[ne];let D=P.length;return P.length+=3,xS.add(P,3*Z,P,3*ce,P,D),xS.scale(P,D,x/xS.length(P,D)),D/=3,L[ne]=D,D}for(let Z=0;Z<E;Z++){const ce=I.length,ne=new Uint32Array(4*ce);for(let D=0;D<ce;D+=3){const N=I[D],V=I[D+1],B=I[D+2],W=k(N,V),Y=k(V,B),H=k(B,N),ee=4*D;ne[ee]=N,ne[ee+1]=W,ne[ee+2]=H,ne[ee+3]=V,ne[ee+4]=Y,ne[ee+5]=W,ne[ee+6]=B,ne[ee+7]=H,ne[ee+8]=Y,ne[ee+9]=W,ne[ee+10]=Y,ne[ee+11]=H}I=ne,L={}}const G=new Float32Array(P);for(let Z=0;Z<G.length;Z+=3)xS.normalize(G,Z);const z=[[O.POSITION,I],[O.NORMAL,I]],X=[[O.POSITION,{size:3,data:new Float32Array(P),exclusive:!0}],[O.NORMAL,{size:3,data:G,exclusive:!0}]];return new Bi(X,z)}function i(x,E,C,A,P,I,L){const k=E?[E[0],E[1],E[2]]:[0,0,0],G=x?[x[0],x[1],x[2]]:[0,0,1];I=I||[0,0];const z=C?[255*C[0],255*C[1],255*C[2],C.length>3?255*C[3]:255]:[255,255,255,255],X=A!=null&&A.length===2?A:[1,1],Z=[[O.POSITION,{size:3,data:k,exclusive:!0}],[O.NORMAL,{size:3,data:G,exclusive:!0}],[O.UV0,{size:I.length,data:I}],[O.COLOR,{size:4,data:z,exclusive:!0}],[O.SIZE,{size:2,data:X}]];if(P!=null){const ce=new Float32Array([P[0],P[1],P[2],P[3]]);Z.push([O.AUXPOS1,{size:4,data:ce}])}if(L!=null){const ce=new Float32Array([L[0],L[1],L[2],L[3]]);Z.push([O.AUXPOS2,{size:4,data:ce}])}return new Bi(Z,null,rc.Point)}function s(x,E,C,A,P,I,L,k){if(x!=null){const{data:G}=k.getMutableAttribute(O.NORMAL);G[0]=x[0],G[1]=x[1],G[2]=x[2]}if(E!=null){const{data:G}=k.getMutableAttribute(O.POSITION);G[0]=E[0],G[1]=E[1],G[2]=E[2]}if(C!=null){const{data:G}=k.getMutableAttribute(O.COLOR);G[0]=C[0],G[1]=C[1],G[2]=C[2],G[3]=C[3]}if(A!=null){const{data:G}=k.getMutableAttribute(O.SIZE);G[0]=A[0],G[1]=A[1]}if(P!=null){const{data:G}=k.getMutableAttribute(O.AUXPOS1);G[0]=P[0],G[1]=P[1],G[2]=P[2],G[3]=P[3]}if(I!=null){const{data:G}=k.getMutableAttribute(O.UV0);G[0]=I[0],G[1]=I[1]}if(L!=null){const{data:G}=k.getMutableAttribute(O.AUXPOS2);G[0]=L[0],G[1]=L[1],G[2]=L[2],G[3]=L[3]}}function n(x,E){const C=new Float32Array(3*x.length),A=new Float32Array(E?3*x.length:3),P=new Uint32Array(x.length),I=new Uint32Array(x.length);for(let z=0;z<x.length;z++)C[3*z]=x[z][0],C[3*z+1]=x[z][1],C[3*z+2]=x[z][2],E&&(A[3*z]=E[z][0],A[3*z+1]=E[z][1],A[3*z+2]=E[z][2]),P[z]=z,I[z]=0;E||(A[0]=0,A[1]=1,A[2]=0);const L=[0,0],k=[[O.POSITION,P],[O.NORMAL,E?P:I],[O.UV0,I]],G=[[O.POSITION,{size:3,data:C,exclusive:!0}],[O.NORMAL,{size:3,data:A,exclusive:!0}],[O.UV0,{size:2,data:L,exclusive:!0}]];return new Bi(G,k,rc.Point)}function o(){const x=[0,0,0,0,0,100,100,0,0],E=new Uint16Array([0,1,2]),C=[0,1,0],A=new Uint16Array([0,0,0]),P=[0,0],I=new Uint16Array([0,0,0]),L=[[O.POSITION,E],[O.NORMAL,A],[O.UV0,I]],k=[[O.POSITION,{size:3,data:x,exclusive:!0}],[O.NORMAL,{size:3,data:C,exclusive:!0}],[O.UV0,{size:2,data:P,exclusive:!0}]];return new Bi(k,L)}e.createBoxGeometry=l7.createGeometry,e.createDiamondGeometry=c7.createGeometry,e.createTetrahedronGeometry=u7.createGeometry,e.createSphereGeometry=t,e.createPolySphereGeometry=r,e.createPointGeometry=i,e.updatePointGeometry=s,e.createPointArrayGeometry=n,e.createTriangleGeometry=o;const a=[[-1,-1,0],[1,-1,0],[1,1,0],[-1,1,0]];function l(x=a){const E=new Array(12);for(let z=0;z<4;z++)for(let X=0;X<3;X++)E[3*z+X]=x[z][X];const C=new Uint32Array([0,1,2,2,3,0]),A=[0,0,1],P=new Uint32Array([0,0,0,0,0,0]),I=[0,0,1,0,1,1,0,1],L=[255,255,255,255],k=[[O.POSITION,C],[O.NORMAL,P],[O.UV0,C],[O.COLOR,P]],G=[[O.POSITION,{size:3,data:E,exclusive:!0}],[O.NORMAL,{size:3,data:A,exclusive:!0}],[O.UV0,{size:2,data:I,exclusive:!0}],[O.COLOR,{size:4,data:L,exclusive:!0}]];return new Bi(G,k)}function c(x,E,C,A,P=!0,I=!0){let L=0;const k=E,G=x;let z=Dr(0,L,0),X=Dr(0,L+G,0),Z=Dr(0,-1,0),ce=Dr(0,1,0);A&&(L=G,X=Dr(0,0,0),z=Dr(0,L,0),Z=Dr(0,1,0),ce=Dr(0,-1,0));const ne=[X,z],D=[Z,ce],N=C+2,V=Math.sqrt(G*G+k*k);if(A)for(let ve=C-1;ve>=0;ve--){const ge=ve*(2*Math.PI/C),Ee=Dr(Math.cos(ge)*k,L,Math.sin(ge)*k);ne.push(Ee);const Fe=Dr(G*Math.cos(ge)/V,-k/V,G*Math.sin(ge)/V);D.push(Fe)}else for(let ve=0;ve<C;ve++){const ge=ve*(2*Math.PI/C),Ee=Dr(Math.cos(ge)*k,L,Math.sin(ge)*k);ne.push(Ee);const Fe=Dr(G*Math.cos(ge)/V,k/V,G*Math.sin(ge)/V);D.push(Fe)}const B=new Uint32Array(2*(C+2)*3),W=new Uint32Array(2*(C+2)*3);let Y=0,H=0;if(P){for(let ve=3;ve<ne.length;ve++)B[Y++]=1,B[Y++]=ve-1,B[Y++]=ve,W[H++]=0,W[H++]=0,W[H++]=0;B[Y++]=ne.length-1,B[Y++]=2,B[Y++]=1,W[H++]=0,W[H++]=0,W[H++]=0}if(I){for(let ve=3;ve<ne.length;ve++)B[Y++]=ve,B[Y++]=ve-1,B[Y++]=0,W[H++]=ve,W[H++]=ve-1,W[H++]=1;B[Y++]=0,B[Y++]=2,B[Y++]=ne.length-1,W[H++]=1,W[H++]=2,W[H++]=D.length-1}const ee=new Float32Array(3*N);for(let ve=0;ve<N;ve++)ee[3*ve]=ne[ve][0],ee[3*ve+1]=ne[ve][1],ee[3*ve+2]=ne[ve][2];const me=new Float32Array(3*N);for(let ve=0;ve<N;ve++)me[3*ve]=D[ve][0],me[3*ve+1]=D[ve][1],me[3*ve+2]=D[ve][2];const be=[[O.POSITION,B],[O.NORMAL,W]],De=[[O.POSITION,{size:3,data:ee,exclusive:!0}],[O.NORMAL,{size:3,data:me,exclusive:!0}]];return new Bi(De,be)}function h(x,E,C,A,P,I){const L=A?CV(A):Dr(1,0,0),k=P?CV(P):Dr(0,0,0);I=I==null||I;const G=Mr();we(G,L);const z=Mr();le(z,G,Math.abs(x));const X=Mr();le(X,z,-.5),de(X,X,k);const Z=Dr(0,1,0);Math.abs(1-Te(G,Z))<.2&&se(Z,0,0,1);const ce=Mr();ut(ce,G,Z),we(ce,ce),ut(Z,ce,G);const ne=2*C+(I?2:0),D=C+(I?2:0),N=new Float32Array(3*ne),V=new Float32Array(3*D),B=new Float32Array(2*ne),W=new Uint32Array(3*C*(I?4:2)),Y=new Uint32Array(3*C*(I?4:2));I&&(N[3*(ne-2)+0]=X[0],N[3*(ne-2)+1]=X[1],N[3*(ne-2)+2]=X[2],B[2*(ne-2)]=0,B[2*(ne-2)+1]=0,N[3*(ne-1)+0]=N[3*(ne-2)+0]+z[0],N[3*(ne-1)+1]=N[3*(ne-2)+1]+z[1],N[3*(ne-1)+2]=N[3*(ne-2)+2]+z[2],B[2*(ne-1)]=1,B[2*(ne-1)+1]=1,V[3*(D-2)+0]=-G[0],V[3*(D-2)+1]=-G[1],V[3*(D-2)+2]=-G[2],V[3*(D-1)+0]=G[0],V[3*(D-1)+1]=G[1],V[3*(D-1)+2]=G[2]);const H=(ge,Ee,Fe)=>{W[ge]=Ee,Y[ge]=Fe};let ee=0;const me=Mr(),be=Mr();for(let ge=0;ge<C;ge++){const Ee=ge*(2*Math.PI/C);le(me,Z,Math.sin(Ee)),le(be,ce,Math.cos(Ee)),de(me,me,be),V[3*ge+0]=me[0],V[3*ge+1]=me[1],V[3*ge+2]=me[2],le(me,me,E),de(me,me,X),N[3*ge+0]=me[0],N[3*ge+1]=me[1],N[3*ge+2]=me[2],B[2*ge+0]=ge/C,B[2*ge+1]=0,N[3*(ge+C)+0]=N[3*ge+0]+z[0],N[3*(ge+C)+1]=N[3*ge+1]+z[1],N[3*(ge+C)+2]=N[3*ge+2]+z[2],B[2*(ge+C)+0]=ge/C,B[2*ge+1]=1;const Fe=(ge+1)%C;H(ee++,ge,ge),H(ee++,ge+C,ge),H(ee++,Fe,Fe),H(ee++,Fe,Fe),H(ee++,ge+C,ge),H(ee++,Fe+C,Fe)}if(I){for(let ge=0;ge<C;ge++){const Ee=(ge+1)%C;H(ee++,ne-2,D-2),H(ee++,ge,D-2),H(ee++,Ee,D-2)}for(let ge=0;ge<C;ge++){const Ee=(ge+1)%C;H(ee++,ge+C,D-1),H(ee++,ne-1,D-1),H(ee++,Ee+C,D-1)}}const De=[[O.POSITION,W],[O.NORMAL,Y],[O.UV0,W]],ve=[[O.POSITION,{size:3,data:N,exclusive:!0}],[O.NORMAL,{size:3,data:V,exclusive:!0}],[O.UV0,{size:2,data:B,exclusive:!0}]];return new Bi(ve,De)}function p(x,E,C,A,P){C=C||10,A=A==null||A,ft(x.length>1);const I=[[0,0,0]],L=[],k=[];for(let G=0;G<C;G++){L.push([0,-G-1,-(G+1)%C-1]);const z=G/C*2*Math.PI;k.push([Math.cos(z)*E,Math.sin(z)*E])}return e.createPathExtrusionGeometry(k,x,I,L,A,P)}function f(x,E,C,A,P,I=Dr(0,0,0)){const L=x.length,k=new Float32Array(E.length*L*3+(6*C.length||0)),G=new Float32Array(E.length*L*3+(C?6:0)),z=(E.length-1)*L*6+3*A.length*2,X=new Uint32Array(z),Z=new Uint32Array(z);let ce=0,ne=0,D=0,N=0;const V=Mr(),B=Mr(),W=Mr(),Y=Mr(),H=Mr(),ee=Mr(),me=Mr(),be=M(),De=Mr(),ve=Mr(),ge=Mr(),Ee=Mr(),Fe=Mr(),Nr=Er();se(De,0,1,0),pe(B,E[1],E[0]),we(B,B),P?(de(be,E[0],I),we(W,be)):se(W,0,0,1),T(B,W,De,De,H,W,Rde),ae(Y,W),ae(Ee,H);for(let st=0;st<C.length;st++)le(ee,H,C[st][0]),le(be,W,C[st][2]),de(ee,ee,be),de(ee,ee,E[0]),k[ce++]=ee[0],k[ce++]=ee[1],k[ce++]=ee[2];G[ne++]=-B[0],G[ne++]=-B[1],G[ne++]=-B[2];for(let st=0;st<A.length;st++)X[D++]=A[st][0]>0?A[st][0]:-A[st][0]-1+C.length,X[D++]=A[st][1]>0?A[st][1]:-A[st][1]-1+C.length,X[D++]=A[st][2]>0?A[st][2]:-A[st][2]-1+C.length,Z[N++]=0,Z[N++]=0,Z[N++]=0;let Br=C.length;const ur=C.length-1;for(let st=0;st<E.length;st++){let Li=!1;st>0&&(ae(V,B),st<E.length-1?(pe(B,E[st+1],E[st]),we(B,B)):Li=!0,de(ve,V,B),we(ve,ve),de(ge,E[st-1],Y),pA(E[st],ve,Nr),JT(Nr,wh(ge,V),be)?(pe(be,be,E[st]),we(W,be),ut(H,ve,W),we(H,H)):T(ve,Y,Ee,De,H,W,Rde),ae(Y,W),ae(Ee,H)),P&&(de(be,E[st],I),we(Fe,be));for(let ao=0;ao<L;ao++)if(le(ee,H,x[ao][0]),le(be,W,x[ao][1]),de(ee,ee,be),we(me,ee),G[ne++]=me[0],G[ne++]=me[1],G[ne++]=me[2],de(ee,ee,E[st]),k[ce++]=ee[0],k[ce++]=ee[1],k[ce++]=ee[2],!Li){const bl=(ao+1)%L;X[D++]=Br+ao,X[D++]=Br+L+ao,X[D++]=Br+bl,X[D++]=Br+bl,X[D++]=Br+L+ao,X[D++]=Br+L+bl;for(let Na=0;Na<6;Na++)Z[N++]=X[D-6+Na]-ur}Br+=L}const Gr=E[E.length-1];for(let st=0;st<C.length;st++)le(ee,H,C[st][0]),le(be,W,C[st][1]),de(ee,ee,be),de(ee,ee,Gr),k[ce++]=ee[0],k[ce++]=ee[1],k[ce++]=ee[2];const pr=ne/3;G[ne++]=B[0],G[ne++]=B[1],G[ne++]=B[2];const jr=Br-L;for(let st=0;st<A.length;st++)X[D++]=A[st][0]>=0?Br+A[st][0]:-A[st][0]-1+jr,X[D++]=A[st][2]>=0?Br+A[st][2]:-A[st][2]-1+jr,X[D++]=A[st][1]>=0?Br+A[st][1]:-A[st][1]-1+jr,Z[N++]=pr,Z[N++]=pr,Z[N++]=pr;const Qi=[[O.POSITION,X],[O.NORMAL,Z]],fs=[[O.POSITION,{size:3,data:k,exclusive:!0}],[O.NORMAL,{size:3,data:G,exclusive:!0}]];return new Bi(fs,Qi)}function m(x,E,C){ft(x.length>1,"createPolylineGeometry(): polyline needs at least 2 points"),ft(x[0].length===3,"createPolylineGeometry(): malformed vertex"),ft(E==null||E.length===x.length,"createPolylineGeometry: need same number of points and normals"),ft(E==null||E[0].length===3,"createPolylineGeometry(): malformed normal");const A=new Float64Array(3*x.length),P=new Uint32Array(2*(x.length-1));let I=0,L=0;for(let z=0;z<x.length;z++){for(let X=0;X<3;X++)A[I++]=x[z][X];z>0&&(P[L++]=z-1,P[L++]=z)}const k=[],G=[];if(k.push([O.POSITION,P]),G.push([O.POSITION,{size:3,data:A,exclusive:!0}]),E){const z=new Float32Array(3*E.length);let X=0;for(let Z=0;Z<x.length;Z++)for(let ce=0;ce<3;ce++)z[X++]=E[Z][ce];k.push([O.NORMAL,P]),G.push([O.NORMAL,{size:3,data:z,exclusive:!0}])}return C&&(G.push([O.COLOR,{size:4,data:C}]),k.push([O.COLOR,DA(C.length/4)])),new Bi(G,k,rc.Line)}function g(x,E,C,A,P=0){const I=new Array(18),L=[[-E,P,A/2],[C,P,A/2],[0,x+P,A/2],[-E,P,-A/2],[C,P,-A/2],[0,x+P,-A/2]],k=new Uint16Array([0,1,2,3,0,2,2,5,3,1,4,5,5,2,1,1,0,3,3,4,1,4,3,5]);for(let G=0;G<6;G++)I[3*G]=L[G][0],I[3*G+1]=L[G][1],I[3*G+2]=L[G][2];return new Bi([[O.POSITION,{size:3,data:I,exclusive:!0}]],[[O.POSITION,k]])}function v(x,E){const C=x.getMutableAttribute(O.POSITION).data;for(let A=0;A<C.length;A+=3){const P=C[A],I=C[A+1],L=C[A+2];se(TS,P,I,L),Ve(TS,TS,E),C[A]=TS[0],C[A+1]=TS[1],C[A+2]=TS[2]}}function w(x,E=x){const C=x.vertexAttributes,A=C.get(O.POSITION).data,P=C.get(O.NORMAL).data;if(P){const I=E.getMutableAttribute(O.NORMAL).data;for(let L=0;L<P.length;L+=3){const k=P[L+1];I[L+1]=-P[L+2],I[L+2]=k}}if(A){const I=E.getMutableAttribute(O.POSITION).data;for(let L=0;L<A.length;L+=3){const k=A[L+1];I[L+1]=-A[L+2],I[L+2]=k}}return E}function _(x,E,C,A,P){return!(Math.abs(Te(E,x))>P)&&(ut(C,x,E),we(C,C),ut(A,C,x),we(A,A),!0)}function T(x,E,C,A,P,I,L){return _(x,E,P,I,L)||_(x,C,P,I,L)||_(x,A,P,I,L)}e.createSquareGeometry=l,e.createConeGeometry=c,e.createCylinderGeometry=h,e.createTubeGeometry=p,e.createPathExtrusionGeometry=f,e.createPolylineGeometry=m,e.createExtrudedTriangle=g,e.transformInPlace=v,e.cgToGIS=w,e.makeOrthoBasisDirUp=_,e.makeOrthoBasisDirUpFallback=T}(hQ||(hQ={}));const Rde=.99619469809,TS=Mr(),$c=hQ,Hat=fe.getLogger("esri.views.3d.environment.PanoramicAtmosphere");class qat{constructor(){this.type="panoramic",this._techniqueConfig=new RV,this._passParameters=new Cie,this._readyResolver=vf(),this._readyController=new AbortController}destroy(){this._readyResolver.reject(),this._passParameters.texture=Ye(this._passParameters.texture),this._vao=Ye(this._vao),this._readyController=Fd(this._readyController)}when(){return this._readyResolver.promise}initializeRenderContext(t){this._techniqueConfig.geometry=og.Cylinder,this._technique=t.shaderTechniqueRepository.acquire(RA,this._techniqueConfig);const r=t.renderContext.rctx;this._vao=this._createVertexArrayObject(r),this._vaoCount=ta(this._vao,"geometry"),Sf(LOe,{signal:this._readyController.signal}).then(i=>{this._passParameters.texture=new nt(r,{pixelFormat:ze.RGBA,dataType:Ct.UNSIGNED_BYTE,wrapMode:xt.CLAMP_TO_EDGE,samplingMode:et.LINEAR,flipped:!0},i),t.requestRender(),this._readyController=null,this._readyResolver.resolve()}).catch(i=>{Vi(i)||Hat.error("Unable to initialize atmosphere: image request failed",i),this._readyResolver.reject()})}get canRender(){return this._passParameters.texture!=null}render(t){const r=t.rctx,i=r.bindTechnique(this._technique,this._passParameters,t.bindParameters);Wat(Ode,t.bindParameters.camera.viewMatrix),i.setUniformMatrix4fv("view",Ode),r.bindVAO(this._vao),i.assertCompatibleVertexAttributeLocations(this._vao),r.drawArrays(Lt.TRIANGLES,0,this._vaoCount)}renderHaze(){return!1}_createVertexArrayObject(t){const r=$c.createPolySphereGeometry(1,2,!1),i=r.indices.get(O.POSITION);for(let a=0;a<i.length;a+=3){const l=i[a];i[a]=i[a+2],i[a+2]=l}const s=r.vertexAttributes.get(O.POSITION).data,n=Mde.createBuffer(i.length),o=n.position;for(let a=0;a<i.length;++a){const l=3*i[a];o.set(a,0,s[l]),o.set(a,1,s[l+1]),o.set(a,2,s[l+2])}return new rn(t,zr,{geometry:du(Mde)},{geometry:cr.createVertex(t,Cr.STATIC_DRAW,n.buffer)})}}function Wat(e,t){Is(e,t),e[12]=0,e[13]=0,e[14]=0,e[15]=1}const Ode=Ce(),Mde=ps().vec3f(O.POSITION);var F1;(function(e){e[e.Rain=0]="Rain",e[e.Snow=1]="Snow",e[e.COUNT=2]="COUNT"})(F1||(F1={}));class dQ extends vl{constructor(){super(...arguments),this.type=F1.Rain}}u([q({count:F1.COUNT})],dQ.prototype,"type",void 0);function Xat(e){const t=new Yr;return t.attributes.add(O.POSITION,"vec3"),t.attributes.add(O.INSTANCEFEATUREATTRIBUTE,"float"),t.vertex.uniforms.add(new Yl("cameraPosition")),t.vertex.uniforms.add(new Yl("offset")),t.vertex.uniforms.add(new kr("width")),t.vertex.uniforms.add(new Ei("proj",(r,i)=>i.camera.projectionMatrix)),t.vertex.uniforms.add(new I1("view")),t.vertex.uniforms.add(new kr("time")),t.varyings.add("vUv","vec2"),t.vertex.code.add(S`
    vec3 hash31(float p){
      vec3 p3 = fract(vec3(p) * vec3(0.1031, 0.1030, 0.0973));
      p3 += dot(p3, p3.yzx + 33.33);
      return fract((p3.xxy + p3.yzz) * p3.zyx);
    }

    float hash11(float p){
      p = fract(p * 0.1031);
      p *= p + 33.33;
      p *= p + p;
      return fract(p);
    }

    //https://www.geeks3d.com/20141201/how-to-rotate-a-vertex-by-a-quaternion-in-glsl/
    vec3 rotateVectorByQuaternion(vec3 v, vec4 q){
      return 2.0 * cross(q.xyz, v * q.w + cross(q.xyz, v)) + v;
    }

    void main(void) {

      vUv = position.xz;

      vec3 rand = hash31(instanceFeatureAttribute);

      // Set random position for all particles
      // The hash function space is not high resolution so offset particles by an additional random value
      // This creates grids of 1000 particles which are shifted by random hundreths of the tile width
      // overlaying multiple identical but offset grids
      vec3 randomPosition = 2.0 * (rand + (0.01 + 0.01 * rand) * floor(0.001 * instanceFeatureAttribute)) - 1.0;

      // Random orientation of rain drops
      float angle = 3.1415 * hash11(instanceFeatureAttribute);

      vec3 up = vec3(0, 0, 1);

      // Gravity and wind direction
      vec3 direction = normalize(cameraPosition);

      vec3 tangent = normalize(cross(direction, up));

      // Gravity
      vec3 animatedPos = randomPosition + direction * -time;

      // Rain particles fall straight down and are randomly oriented
      // Snow particles have random sinusoid trajectories and are rotated to face the camera
      ${e.type===F1.Rain?S`
            // Random rotation for particle
            vec3 rotationAxis = up;
            vec4 quat = vec4(rotationAxis * sin(angle), cos(angle));
            vec3 transformedPos = rotateVectorByQuaternion(vec3(0.2, 0.2, 4.0) * (position - vec3(0.5, 0.0, 0.5)), quat);

            // Rotate particle to planetary position
            rotationAxis = tangent;
            angle = 0.5 * -acos(dot(direction, up));
            quat = vec4(rotationAxis * sin(angle), cos(angle));
            transformedPos = rotateVectorByQuaternion(transformedPos, quat);

            vec4 pos = mat4(mat3(view)) * vec4(transformedPos + (mod(width * animatedPos - offset, width) - 0.5 * width), 1.0);
            gl_Position = proj * pos;
      `:S`
            vec3 rotationAxis = direction;
            vec4 quat = vec4(rotationAxis * sin(angle), cos(angle));

            tangent = rotateVectorByQuaternion(tangent, quat);
            // Random sinusoid from friction
            animatedPos += tangent * 0.25 * sin(dot(animatedPos, direction));
            vec4 pos = mat4(mat3(view)) * vec4((mod(width * animatedPos - offset, width) - 0.5 * width), 1.0);
            gl_Position = proj * (0.5 * vec4(position.xzy, 0.0) + pos);
      `}
    }
  `),t.fragment.uniforms.add(new kr("opacity")),t.fragment.uniforms.add(new Yl("particleColor")),t.fragment.code.add(S`
    void main() {

      // Cut off corners of the triangle
      if(vUv.x < 0.0 || vUv.y < 0.0){
        discard;
      }

      float d = length(vUv - vec2(0.5));

      ${e.type===F1.Rain?S`d = 0.35 * smoothstep(0.5, 0.0, d);`:S`d = smoothstep(0.5, 0.1, d);`}
      gl_FragColor = opacity * vec4(particleColor * d, d);
    }
  `),t}const Zat=Object.freeze(Object.defineProperty({__proto__:null,build:Xat},Symbol.toStringTag,{value:"Module"}));class Yat extends nn{constructor(){super(...arguments),this.time=0,this.radius=1}}class ky extends gi{initializeProgram(t){const r=ky.shader.get().build(this.configuration);return new oi(t.rctx,r,ky.attributeLocation)}initializePipeline(){return Gt({blending:No(Ae.ONE,Ae.ONE,Ae.ONE_MINUS_SRC_ALPHA,Ae.ONE_MINUS_SRC_ALPHA),depthTest:{func:_i.LEQUAL},colorWrite:or})}}ky.shader=new ni(Zat,()=>ie(()=>import("./Precipitation.glsl.db262093.js"),[],import.meta.url)),ky.attributeLocation=new Map([[O.POSITION,0],[O.INSTANCEFEATUREATTRIBUTE,1]]);class zOe{constructor(){this.enabled=!0,this._time=0}get time(){return this._time}advance(t){return b(t.forcedTime)?this._time!==t.forcedTime&&(this._time=t.forcedTime,!0):!(!this.enabled||t.dt===0)&&(this._time+=t.dt,!0)}}let Ow=class extends xe{constructor(e){super(e),this._numParticles=25e4,this._rainSpeed=.1,this._snowSpeed=.01,this._opacity=1,this._width=500,this._offset=M(),this._tile=M(),this._particleColor=Mr(),this._particleColorAtNight=Mr(),this._nightMultiplier=.7,this._cameraDirection=Mr(),this._renderParameters=new Yat,this._animation=new zOe,this._updatingTracking=new Gm,this._renderParameters.time=0,this._renderParameters.radius=Ar(e.view.spatialReference).radius,this._shaderTechniqueRepository=e.context.shaderTechniqueRepository}destroy(){this._updatingTracking.destroy(),this._numParticles=0,this._snowTechnique=ti(this._snowTechnique),this._rainTechnique=ti(this._rainTechnique),this._vao=Ye(this._vao),this._instanceIdBuffer=Ye(this._instanceIdBuffer)}get updating(){return this._updatingTracking.updating}get rainTechnique(){if(R(this._rainTechnique)){const e=new dQ;e.type=F1.Rain,this._rainTechnique=this._shaderTechniqueRepository.acquire(ky,e)}return this._rainTechnique}get snowTechnique(){if(R(this._snowTechnique)){const e=new dQ;e.type=F1.Snow,this._snowTechnique=this._shaderTechniqueRepository.acquire(ky,e)}return this._snowTechnique}update(e){return this._animation.advance(e)}render(e,t,r){const i=r==="rainy",s=i?this.rainTechnique:this.snowTechnique;if(!s.compiled)return void this.context.requestRender();const n=e.rctx;if(this._ensureResources(n),R(s)||R(this._vao)||R(this._instanceIdBuffer)||(b(e.bindParameters.clouds.data)&&(this._opacity=1-e.bindParameters.clouds.fadeInOutHeight.factor),this._opacity<=0))return;const o=.35;t=t<.5?Yt(0,o,2*t):Yt(o,1,2*(t-.5));const a=n.bindTechnique(s);this._renderParameters.camera=e.bindParameters.camera,this._renderParameters.time=(i?this._rainSpeed:this._snowSpeed)*kK(this._animation.time),this._renderParameters.time=this._renderParameters.time%1e5,this._update(a,r,e),n.bindVAO(this._vao);const l=ky.attributeLocation;a.assertCompatibleVertexAttributeLocations(this._vao),aie(n,l,this._instanceIdBuffer,Pde,0),n.capabilities.instancing.drawArraysInstanced(Lt.TRIANGLES,0,3,this._numParticles*t),lie(n,l,this._instanceIdBuffer,Pde)}_update(e,t,r){const i=r.bindParameters.camera,s=i.eye;this._tile[0]=Math.floor((s[0]+.5*this._width)/this._width),this._tile[1]=Math.floor((s[1]+.5*this._width)/this._width),this._tile[2]=Math.floor((s[2]+.5*this._width)/this._width),this._offset[0]=s[0]-this._tile[0]*this._width,this._offset[1]=s[1]-this._tile[1]*this._width,this._offset[2]=s[2]-this._tile[2]*this._width,e.setUniform1f("width",this._width),e.setUniform3fv("offset",this._offset),e.setUniformMatrix4fv("view",i.viewMatrix),e.setUniform3fv("cameraPosition",s),e.bindPass(null,r.bindParameters),e.setUniform1f("time",this._renderParameters.time),t==="rainy"?se(this._particleColor,.85,.85,.85):se(this._particleColor,1,1,1),le(this._particleColorAtNight,this._particleColor,this._nightMultiplier),we(this._cameraDirection,s);const n=Math.max(0,Te(this._cameraDirection,r.bindParameters.lighting.lightingMainDirection));En(this._particleColor,this._particleColorAtNight,this._particleColor,n),e.setUniform3fv("particleColor",this._particleColor),e.setUniform1f("opacity",this._opacity)}_ensureResources(e){R(this._vao)&&(this._vao=this._createVertexArrayObject(e)),R(this._instanceIdBuffer)&&(this._instanceIdBuffer=this._createInstanceIndices(e))}_createInstanceIndices(e){const t=[];for(let r=0;r<this._numParticles;r++)t.push(r);return cr.createVertex(e,Cr.STATIC_DRAW,new Float32Array(t))}_createVertexArrayObject(e){const t=new Float32Array([-1,0,1,1,0,-1,1,0,1]);return new rn(e,ky.attributeLocation,{geometry:du(Qat)},{geometry:cr.createVertex(e,Cr.STATIC_DRAW,t)})}};u([d({constructOnly:!0})],Ow.prototype,"context",void 0),u([d({constructOnly:!0})],Ow.prototype,"view",void 0),u([d({readOnly:!0})],Ow.prototype,"updating",null),u([d()],Ow.prototype,"_updatingTracking",void 0),Ow=u([$("esri.views.3d.environment.Precipitation")],Ow);const Qat=ps().vec3f(O.POSITION),Pde=du(ps().f32(O.INSTANCEFEATUREATTRIBUTE),1),Jat="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAIACAYAAAE00TaTAAAACXBIWXMAAA7AAAAOwAFq1okJAAAKT2lDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVNnVFPpFj333vRCS4iAlEtvUhUIIFJCi4AUkSYqIQkQSoghodkVUcERRUUEG8igiAOOjoCMFVEsDIoK2AfkIaKOg6OIisr74Xuja9a89+bN/rXXPues852zzwfACAyWSDNRNYAMqUIeEeCDx8TG4eQuQIEKJHAAEAizZCFz/SMBAPh+PDwrIsAHvgABeNMLCADATZvAMByH/w/qQplcAYCEAcB0kThLCIAUAEB6jkKmAEBGAYCdmCZTAKAEAGDLY2LjAFAtAGAnf+bTAICd+Jl7AQBblCEVAaCRACATZYhEAGg7AKzPVopFAFgwABRmS8Q5ANgtADBJV2ZIALC3AMDOEAuyAAgMADBRiIUpAAR7AGDIIyN4AISZABRG8lc88SuuEOcqAAB4mbI8uSQ5RYFbCC1xB1dXLh4ozkkXKxQ2YQJhmkAuwnmZGTKBNA/g88wAAKCRFRHgg/P9eM4Ors7ONo62Dl8t6r8G/yJiYuP+5c+rcEAAAOF0ftH+LC+zGoA7BoBt/qIl7gRoXgugdfeLZrIPQLUAoOnaV/Nw+H48PEWhkLnZ2eXk5NhKxEJbYcpXff5nwl/AV/1s+X48/Pf14L7iJIEyXYFHBPjgwsz0TKUcz5IJhGLc5o9H/LcL//wd0yLESWK5WCoU41EScY5EmozzMqUiiUKSKcUl0v9k4t8s+wM+3zUAsGo+AXuRLahdYwP2SycQWHTA4vcAAPK7b8HUKAgDgGiD4c93/+8//UegJQCAZkmScQAAXkQkLlTKsz/HCAAARKCBKrBBG/TBGCzABhzBBdzBC/xgNoRCJMTCQhBCCmSAHHJgKayCQiiGzbAdKmAv1EAdNMBRaIaTcA4uwlW4Dj1wD/phCJ7BKLyBCQRByAgTYSHaiAFiilgjjggXmYX4IcFIBBKLJCDJiBRRIkuRNUgxUopUIFVIHfI9cgI5h1xGupE7yAAygvyGvEcxlIGyUT3UDLVDuag3GoRGogvQZHQxmo8WoJvQcrQaPYw2oefQq2gP2o8+Q8cwwOgYBzPEbDAuxsNCsTgsCZNjy7EirAyrxhqwVqwDu4n1Y8+xdwQSgUXACTYEd0IgYR5BSFhMWE7YSKggHCQ0EdoJNwkDhFHCJyKTqEu0JroR+cQYYjIxh1hILCPWEo8TLxB7iEPENyQSiUMyJ7mQAkmxpFTSEtJG0m5SI+ksqZs0SBojk8naZGuyBzmULCAryIXkneTD5DPkG+Qh8lsKnWJAcaT4U+IoUspqShnlEOU05QZlmDJBVaOaUt2ooVQRNY9aQq2htlKvUYeoEzR1mjnNgxZJS6WtopXTGmgXaPdpr+h0uhHdlR5Ol9BX0svpR+iX6AP0dwwNhhWDx4hnKBmbGAcYZxl3GK+YTKYZ04sZx1QwNzHrmOeZD5lvVVgqtip8FZHKCpVKlSaVGyovVKmqpqreqgtV81XLVI+pXlN9rkZVM1PjqQnUlqtVqp1Q61MbU2epO6iHqmeob1Q/pH5Z/YkGWcNMw09DpFGgsV/jvMYgC2MZs3gsIWsNq4Z1gTXEJrHN2Xx2KruY/R27iz2qqaE5QzNKM1ezUvOUZj8H45hx+Jx0TgnnKKeX836K3hTvKeIpG6Y0TLkxZVxrqpaXllirSKtRq0frvTau7aedpr1Fu1n7gQ5Bx0onXCdHZ4/OBZ3nU9lT3acKpxZNPTr1ri6qa6UbobtEd79up+6Ynr5egJ5Mb6feeb3n+hx9L/1U/W36p/VHDFgGswwkBtsMzhg8xTVxbzwdL8fb8VFDXcNAQ6VhlWGX4YSRudE8o9VGjUYPjGnGXOMk423GbcajJgYmISZLTepN7ppSTbmmKaY7TDtMx83MzaLN1pk1mz0x1zLnm+eb15vft2BaeFostqi2uGVJsuRaplnutrxuhVo5WaVYVVpds0atna0l1rutu6cRp7lOk06rntZnw7Dxtsm2qbcZsOXYBtuutm22fWFnYhdnt8Wuw+6TvZN9un2N/T0HDYfZDqsdWh1+c7RyFDpWOt6azpzuP33F9JbpL2dYzxDP2DPjthPLKcRpnVOb00dnF2e5c4PziIuJS4LLLpc+Lpsbxt3IveRKdPVxXeF60vWdm7Obwu2o26/uNu5p7ofcn8w0nymeWTNz0MPIQ+BR5dE/C5+VMGvfrH5PQ0+BZ7XnIy9jL5FXrdewt6V3qvdh7xc+9j5yn+M+4zw33jLeWV/MN8C3yLfLT8Nvnl+F30N/I/9k/3r/0QCngCUBZwOJgUGBWwL7+Hp8Ib+OPzrbZfay2e1BjKC5QRVBj4KtguXBrSFoyOyQrSH355jOkc5pDoVQfujW0Adh5mGLw34MJ4WHhVeGP45wiFga0TGXNXfR3ENz30T6RJZE3ptnMU85ry1KNSo+qi5qPNo3ujS6P8YuZlnM1VidWElsSxw5LiquNm5svt/87fOH4p3iC+N7F5gvyF1weaHOwvSFpxapLhIsOpZATIhOOJTwQRAqqBaMJfITdyWOCnnCHcJnIi/RNtGI2ENcKh5O8kgqTXqS7JG8NXkkxTOlLOW5hCepkLxMDUzdmzqeFpp2IG0yPTq9MYOSkZBxQqohTZO2Z+pn5mZ2y6xlhbL+xW6Lty8elQfJa7OQrAVZLQq2QqboVFoo1yoHsmdlV2a/zYnKOZarnivN7cyzytuQN5zvn//tEsIS4ZK2pYZLVy0dWOa9rGo5sjxxedsK4xUFK4ZWBqw8uIq2Km3VT6vtV5eufr0mek1rgV7ByoLBtQFr6wtVCuWFfevc1+1dT1gvWd+1YfqGnRs+FYmKrhTbF5cVf9go3HjlG4dvyr+Z3JS0qavEuWTPZtJm6ebeLZ5bDpaql+aXDm4N2dq0Dd9WtO319kXbL5fNKNu7g7ZDuaO/PLi8ZafJzs07P1SkVPRU+lQ27tLdtWHX+G7R7ht7vPY07NXbW7z3/T7JvttVAVVN1WbVZftJ+7P3P66Jqun4lvttXa1ObXHtxwPSA/0HIw6217nU1R3SPVRSj9Yr60cOxx++/p3vdy0NNg1VjZzG4iNwRHnk6fcJ3/ceDTradox7rOEH0x92HWcdL2pCmvKaRptTmvtbYlu6T8w+0dbq3nr8R9sfD5w0PFl5SvNUyWna6YLTk2fyz4ydlZ19fi753GDborZ752PO32oPb++6EHTh0kX/i+c7vDvOXPK4dPKy2+UTV7hXmq86X23qdOo8/pPTT8e7nLuarrlca7nuer21e2b36RueN87d9L158Rb/1tWeOT3dvfN6b/fF9/XfFt1+cif9zsu72Xcn7q28T7xf9EDtQdlD3YfVP1v+3Njv3H9qwHeg89HcR/cGhYPP/pH1jw9DBY+Zj8uGDYbrnjg+OTniP3L96fynQ89kzyaeF/6i/suuFxYvfvjV69fO0ZjRoZfyl5O/bXyl/erA6xmv28bCxh6+yXgzMV70VvvtwXfcdx3vo98PT+R8IH8o/2j5sfVT0Kf7kxmTk/8EA5jz/GMzLdsAAAAgY0hSTQAAeiUAAICDAAD5/wAAgOkAAHUwAADqYAAAOpgAABdvkl/FRgAAAp1JREFUSMd9lcmSEzEQRCtflnqxYZgIThBDAP//kXDQ0pJtuDhqycxWZ5fKERFCERARIAVEyCjCtSFFEjWVa9q7OdJE0oiidIhKhRBROlhloiGVhaYERQHJWFEwMpYKrjUlibI2cqSJIJEpKNmM2c3GkRTOJDnThTMpnMWu0VFszs3Jfbe5bza3w+a229yOIs6zmP3czfn1K2w/for8+EVU15pNmmyqkeJyclinXNJRu1xrUaJmjmdzJiejVNt7zZVBRAIq1RwrsrrWnez+SR7WmQQP/1itKz2q/pmzuJtYnNy2bth9x9z2NLfDcB7FHOcGx6ebOb9/iPzxG/ztg4iorglFiKjzF9HSNphCoRb1OY3RZQJrYgRdT68bmgXGDdBzrTG8qNS7QP/m19ef7tGlcoH7vESYkK70uoPuOLEetz0IqeGoWQW6MlB/j36EnipYGKPWwDRg/RkNhXCNJIzAhMk6PrDePJNII6JHqM5VWqYApCtNFPe0GFFGtOWopWCrEVBSoiQi06KkRRaD08IlxXa/ifz8Jvz2LvjyLnh7F/r8Rei8a8xfjNkIrpmMOQ1C02COrkTEHxGhh+6DQJfXc/eZprXxcIyVIf1LJVgWvKaHvwI/1aQxtv851SQ/nqGXL6MHFVY3nmhLyqKsWO/+qzWif+yS1TpNKq8NezjGPCV69ciZoQj1PwfN6QRpWyCGVMe1D/AAHt3/gefu1Ign3AVpjOiNXkN90JlpL6TUnzFEUU+Jvks0tkp/dY3Fy1TzI24BWwsYJPyg11Q0FqDwK72xIz2kLojbeuxS1FpgtfNWyMX1gFw0j3W7RNeSHTVEe3VaV7SdCzVywFaEt02w7QH7Eeg4AvZDNdJ+Cu1HENsutO+Byi6ilEBZ9BeCNBJceJIjHgAAAABJRU5ErkJggg==",Kat=fe.getLogger("esri.views.3d.environment.SimpleAtmosphere"),xN=128,Ide=-sQ,$de=0,h7=50,elt=()=>1-511/512,tlt=l5([[50,.1015625],[500,.21875],[5e3,1-250/512],[5e4,.4140625]]);class rlt{constructor(t){this.view=t,this.type="simple",this._renderData={texV:rt(),silCircleCenter:M(),silCircleV1:M(),silCircleV2:M(),altitudeFade:0,innerScale:0,undergroundFadeAlpha:0},this._passParameters=new Cie,this._fadeVaoCount=0,this._readyResolver=vf(),this._readyController=new AbortController,this.texV1=1,this.canRender=!0,this.isOnMars=hg(t.spatialReference);const r=Ar(t.spatialReference);this.planetRadius=r.radius,this.outerRimWidth=r.outerAtmosphereRimWidth,this.innerRimFactor=(this.planetRadius+Ide)/this.planetRadius,this.middleRimFactor=(this.planetRadius+$de)/this.planetRadius,this.outerRimFactor=(this.planetRadius+this.outerRimWidth)/this.planetRadius,this.texV0=$de/this.outerRimWidth,this.texVScale=this.texV1-this.texV0}destroy(){this._readyResolver.reject(),this._cameraChangeHandle=wn(this._cameraChangeHandle),this._passParameters.texture=Ye(this._passParameters.texture),this._fadeVao=Ye(this._fadeVao),this._vao=Ye(this._vao),this._readyController=Fd(this._readyController)}when(){return this._readyResolver.promise}async initializeRenderContext(t){this._shaderTechniqueRepository=t.shaderTechniqueRepository;const r=t.renderContext.rctx;this._cameraChangeHandle=te(()=>{var n;return(n=this.view.state)==null?void 0:n.camera},()=>t.requestRender(),Xs),this._vao=this._createRibbon(r),this._vaoCount=ta(this._vao,"geometry"),this._fadeVao=_l(r),this._fadeVaoCount=ta(this._fadeVao,"geometry");const i=this.isOnMars?Jat:LOe,s=this._readyController.signal;try{const n=await Sf(i,{signal:s});Jt(s),this._passParameters.texture=new nt(r,{pixelFormat:ze.RGBA,dataType:Ct.UNSIGNED_BYTE,wrapMode:xt.CLAMP_TO_EDGE,samplingMode:et.LINEAR,flipped:!0},n),t.requestRender(),this._readyController=null,this._readyResolver.resolve()}catch(n){Vi(n)||Kat.error("Unable to initialize simple atmosphere: image request failed",n),this._readyResolver.reject(n)}}get coneTechnique(){if(R(this._coneTechnique)){const t=new RV;t.geometry=og.Cone,this._coneTechnique=this._shaderTechniqueRepository.acquire(RA,t)}return this._coneTechnique}get undergroundTechnique(){if(R(this._undergroundTechnique)){const t=new RV;t.geometry=og.Underground,this._undergroundTechnique=this._shaderTechniqueRepository.acquire(RA,t)}return this._undergroundTechnique}render(t){const r=t.bindParameters.camera;this._update(r);const i=t.rctx;if(this._renderData.undergroundFadeAlpha<1){const s=i.bindTechnique(this.coneTechnique,this._passParameters,t.bindParameters);s.setUniformMatrix4fv("proj",r.projectionMatrix),s.setUniformMatrix4fv("view",r.viewMatrix),s.setUniform3fv("silCircleCenter",this._renderData.silCircleCenter),s.setUniform3fv("silCircleV1",this._renderData.silCircleV1),s.setUniform3fv("silCircleV2",this._renderData.silCircleV2),s.setUniform2fv("texV",this._renderData.texV),s.setUniform1f("altitudeFade",this._renderData.altitudeFade),s.setUniform1f("innerScale",this._renderData.innerScale),i.bindVAO(this._vao),i.drawArrays(Lt.TRIANGLES,0,this._vaoCount)}if(this._renderData.undergroundFadeAlpha>0){const s=i.bindTechnique(this.undergroundTechnique,this._passParameters,t.bindParameters);s.setUniform1f("undergroundFadeAlpha",this._renderData.undergroundFadeAlpha),s.setUniform3fv("cameraPosition",r.eye),i.bindVAO(this._fadeVao),i.drawArrays(Lt.TRIANGLE_STRIP,0,this._fadeVaoCount)}}renderHaze(){return!1}_update(t){const r=M(),i=this.planetRadius,s=Re(t.eye),n=s-i;if(n<0){const m=Math.min(-n/5e3,1);this._renderData.undergroundFadeAlpha=m}else this._renderData.undergroundFadeAlpha=0;const o=Math.max(h7,n),a=i+Ide;this._renderData.innerScale=ilt(i+o,i,a)-1,this._renderData.altitudeFade=BRe(n),le(r,t.eye,(i+h7)/s),Lde(r,t.center,t.up,i,this._renderData);const l=this._computeScreenRimWidth(t,r,t.up,this._renderData),c=elt(),h=tlt(n);let p=this.texV0+c*this.texVScale,f=this.texV0+l*h*this.texVScale;if(n>h7){Lde(t.eye,t.center,t.up,i,this._renderData);const m=this._computeScreenRimWidth(t,t.eye,t.up,this._renderData),g=Le((m-1.5)/(l-1.5),0,1);p=this.texV0+g*c*this.texVScale,f=this.texV0+Yt(this.texV1,l*h,g)*this.texVScale}vr(this._renderData.texV,p,f)}_createRibbon(t){const r=new Float32Array(3+3*xN*3),i=new Uint32Array(3*xN*5);r[0]=0,r[1]=0,r[2]=-1;for(let o=0;o<xN;o++){const a=9*o+3;r[a+0]=o,r[a+1]=this.innerRimFactor,r[a+2]=-1,r[a+3]=o,r[a+4]=this.middleRimFactor,r[a+5]=0,r[a+6]=o,r[a+7]=this.outerRimFactor,r[a+8]=1;const l=3*o+1,c=o===xN-1?1:l+3,h=15*o;i[h+0]=l,i[h+1]=l+1,i[h+2]=c+1,i[h+3]=c+1,i[h+4]=c,i[h+5]=l,i[h+6]=l+1,i[h+7]=l+2,i[h+8]=c+2,i[h+9]=c+2,i[h+10]=c+1,i[h+11]=l+1,i[h+12]=l,i[h+13]=c,i[h+14]=0}const s=Dde.createBuffer(i.length),n=s.position;for(let o=0;o<i.length;++o){const a=3*i[o];n.set(o,0,r[a]),n.set(o,1,r[a+1]),n.set(o,2,r[a+2])}return new rn(t,zr,{geometry:du(Dde)},{geometry:cr.createVertex(t,Cr.STATIC_DRAW,s.buffer)})}_computeScreenRimWidth(t,r,i,s){return de(fO,s.silCircleCenter,s.silCircleV2),le(p7,fO,this.outerRimFactor),w6(d7,r,fO,i),Ede(fO,d7,t.projectionMatrix,t.viewport),Ede(p7,d7,t.projectionMatrix,t.viewport),pi(fO,p7)/t.height}}function Lde(e,t,r,i,s){const n=Re(e),o=i*Math.sqrt(n*n-i*i)/n,a=Math.sqrt(i*i-o*o),l=s.silCircleV1,c=s.silCircleV2;return le(s.silCircleCenter,e,a/n),ut(l,e,t),ul(l)<1&&ut(l,e,r),le(l,l,o/Re(l)),ut(c,l,e),le(c,c,o/Re(c)),o}const d7=Ce(),fO=M(),p7=M();function ilt(e,t,r){return e*e/(Math.sqrt(e*e-t*t)*Math.sqrt(e*e-r*r)+t*r)}const Dde=ps().vec3f(O.POSITION);function Pie(e){const t=S`vec4 alignToPixelCenter(vec4 clipCoord, vec2 widthHeight) {
vec2 xy = vec2(0.500123) + 0.5 * clipCoord.xy / clipCoord.w;
vec2 pixelSz = vec2(1.0) / widthHeight;
vec2 ij = (floor(xy * widthHeight) + vec2(0.5)) * pixelSz;
vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;
return vec4(result, clipCoord.zw);
}`,r=S`vec4 alignToPixelOrigin(vec4 clipCoord, vec2 widthHeight) {
vec2 xy = vec2(0.5) + 0.5 * clipCoord.xy / clipCoord.w;
vec2 pixelSz = vec2(1.0) / widthHeight;
vec2 ij = floor((xy + 0.5 * pixelSz) * widthHeight) * pixelSz;
vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;
return vec4(result, clipCoord.zw);
}`;e.vertex.code.add(t),e.vertex.code.add(r),e.fragment.code.add(t),e.fragment.code.add(r)}function slt(){const e=new Yr;return e.attributes.add(O.POSITION,"vec3"),e.attributes.add(O.COLOR,"vec4"),e.attributes.add(O.SIZE,"float"),e.varyings.add("vcolor","vec4"),e.varyings.add("vsize","float"),e.vertex.uniforms.add([new Ei("transform",(t,r)=>nlt(t,r)),new lr("viewport",(t,r)=>r.camera.fullViewport),new qe("pixelRatio",(t,r)=>r.camera.pixelRatio)]),e.include(Pie),e.vertex.code.add(S`void main(void) {
vec4 posProj = transform * vec4(position, 0);
gl_Position = alignToPixelCenter(posProj, viewport.zw);
vcolor = color / 1.2;
vsize = size * 5.0 * pixelRatio;
gl_PointSize = vsize;
}`),e.fragment.code.add(S`void main() {
float cap = 0.7;
float scale = 1.0 / cap;
float helper = clamp(length(abs(gl_PointCoord - vec2(0.5))), 0.0, cap);
float alpha = clamp((cap - helper) * scale, 0.0, 1.0);
float intensity = alpha * alpha * alpha;
if (vsize < 3.0) {
intensity *= 0.5;
}
gl_FragColor = vec4(vcolor.xyz, intensity);
}`),e}function nlt(e,t){return Is(Z0,t.camera.projectionMatrix),Z0[10]=24e-8-1,Z0[11]=-1,Z0[14]=(24e-8-2)*t.camera.near,Yi(Z0,Z0,t.camera.viewMatrix),Yi(Z0,Z0,e.modelMatrix)}const Z0=Ce(),olt=Object.freeze(Object.defineProperty({__proto__:null,build:slt},Symbol.toStringTag,{value:"Module"}));class alt extends nn{constructor(){super(...arguments),this.modelMatrix=Ce()}}class bB extends gi{constructor(t){super(t,null,()=>this.destroy())}initializeProgram(t){const r=bB.shader.get().build();return new oi(t.rctx,r,zr)}initializePipeline(){return Gt({blending:No(Ae.SRC_ALPHA,Ae.ONE,Ae.ONE_MINUS_SRC_ALPHA,Ae.ONE_MINUS_SRC_ALPHA),depthTest:{func:_i.LEQUAL},colorWrite:or})}}bB.shader=new ni(olt,()=>ie(()=>import("./Stars.glsl.7203f639.js"),[],import.meta.url));const llt=fe.getLogger("esri.views.3d.environment.Stars");let Kv=class extends xe{constructor(e){super(e),this._loadDataTask=null,this._numPoints=0,this._renderParameter=new alt,this._updatingTracking=new Gm}get updating(){return this._updatingTracking.updating||this.loading}get loading(){return b(this._loadDataTask)&&!this._loadDataTask.finished}initialize(){this._loadDataTask=this._createLoadDataTask()}destroy(){this._loadDataTask=Fd(this._loadDataTask),this._updatingTracking.destroy(),this._numPoints=0,this._technique=ti(this._technique),this._vao=Ye(this._vao)}render(e){const{rctx:t}=e;if(this._ensureResources(t),R(this._technique)||R(this._vao))return;if(!this._technique.compiled)return void this.requestRender();const r=t.bindTechnique(this._technique,this._renderParameter,e.bindParameters);t.bindVAO(this._vao),r.assertCompatibleVertexAttributeLocations(this._vao),t.drawArrays(Lt.POINTS,0,this._numPoints)}_ensureResources(e){if(b(this._technique)||R(SS))return;this._technique=new bB({rctx:e,viewingMode:this.view.state.viewingMode}),this._numPoints=SS.byteLength/Nde;const t=new Float32Array(SS,0,2*this._numPoints),r=new Uint8Array(SS,2*this._numPoints*4,this._numPoints);this._vao=this._createVertexArrayObject(e,t,r,this._numPoints),this._updatingTracking.add(()=>this.view.environment.lighting.type==="sun"?this.view.environment.lighting.date:null,i=>this._update(i),Rt)}_computeDayDuration(e){const t=e,r=new Date(e.getFullYear(),0,1,11,58,56);return(+t-+r)/(+new Date(e.getFullYear()+1,0,1,11,58,55)-+r)}_update(e){if(!e)return;const t=(e.getHours()/12+e.getMinutes()/60*(2/24)+e.getSeconds()/60*(2/1440)-.9972222)%2,r=2*this._computeDayDuration(e),i=Is(this._renderParameter.modelMatrix,hlt);cA(i,i,-r*Math.PI),Yi(i,ult,i),cA(i,i,-t*Math.PI),this.requestRender()}_hexToRGB(e){return[parseInt(e.substring(0,2),16),parseInt(e.substring(2,4),16),parseInt(e.substring(4,6),16)]}_unpackUint8Attributes(e){return e>=192?[2.9,e-192]:e>=160?[2.5,e-160]:e>=128?[2,e-128]:e>=96?[1.5,e-96]:e>=64?[1,e-64]:e>=32?[.7,e-32]:[.4,e]}_createVertexArrayObject(e,t,r,i){const s=Fde.createBuffer(i),n=s.position,o=s.color,a=s.size;for(let l=0;l<i;l++){const c=t[2*l+0],h=t[2*l+1];n.set(l,0,-Math.cos(c)*Math.sin(h)),n.set(l,1,-Math.sin(c)*Math.sin(h)),n.set(l,2,-Math.cos(h));const p=this._unpackUint8Attributes(r[l]),f=this._hexToRGB(clt[p[1]]);o.set(l,0,255*f[0]),o.set(l,1,255*f[1]),o.set(l,2,255*f[2]),o.set(l,3,255),a.set(l,p[0])}return new rn(e,zr,{geometry:du(Fde)},{geometry:cr.createVertex(e,Cr.STATIC_DRAW,s.buffer)})}_createLoadDataTask(){if(b(SS))return null;const e=B$(async t=>{const{data:r}=await _Ve("esri/views/3d/environment/resources/stars.wsv",{responseType:"array-buffer",signal:t});this._verifyStarData(r),SS=r});return e.promise.catch(t=>{Vi(t)||llt.error(t)}).then(()=>{this.destroyed||(this.requestRender(),this.notifyChange("updating"))}),e}_verifyStarData(e){if(!e)throw new j("stars:no-data-received","Failed to create stars because star catalogue is missing");const t=e.byteLength/Nde;if(t%1!=0||t>5e4||t<5e3)throw new j("stars:invalid-data","Failed to create stars because star catalogue data is invalid")}};u([d({constructOnly:!0})],Kv.prototype,"view",void 0),u([d({constructOnly:!0})],Kv.prototype,"requestRender",void 0),u([d({readOnly:!0})],Kv.prototype,"updating",null),u([d()],Kv.prototype,"_loadDataTask",void 0),u([d()],Kv.prototype,"_updatingTracking",void 0),Kv=u([$("esri.views.3d.environment.Stars")],Kv);const clt=["9bb2ff","9eb5ff","aabfff","bbccff","ccd8ff ","dae2ff","e4e9ff","eeefff","f8f6ff","fff9fb","fff5ef","fff1e5","ffeddb","ffe9d2","ffe6ca","ffe3c3","ffe0bb","ffddb4","ffdaad","ffd6a5","ffd29c","ffcc8f","ffc178","ffa94b","ff7b00"],ult=hte(1,0,0,0,0,.9174771405229186,.39778850739794974,0,0,-.39778850739794974,.9174771405229186,0,0,0,0,1),hlt=hte(1,0,0,0,0,.9174771405229186,-.39778850739794974,0,0,.39778850739794974,.9174771405229186,0,0,0,0,1),Nde=9,Fde=ps().vec3f(O.POSITION).vec4u8(O.COLOR).f32(O.SIZE);let SS=null;var je;(function(e){e[e.MATERIAL=0]="MATERIAL",e[e.MATERIAL_ALPHA=1]="MATERIAL_ALPHA",e[e.MATERIAL_DEPTH=2]="MATERIAL_DEPTH",e[e.MATERIAL_NORMAL=3]="MATERIAL_NORMAL",e[e.MATERIAL_DEPTH_SHADOWMAP_ALL=4]="MATERIAL_DEPTH_SHADOWMAP_ALL",e[e.MATERIAL_HIGHLIGHT=5]="MATERIAL_HIGHLIGHT",e[e.MATERIAL_DEPTH_SHADOWMAP_DEFAULT=6]="MATERIAL_DEPTH_SHADOWMAP_DEFAULT",e[e.MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT=7]="MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT"})(je||(je={}));var d3;const dlt=[Se.POSTPROCESSING_ENVIRONMENT_OPAQUE,Se.POSTPROCESSING_ENVIRONMENT_TRANSPARENT];let kde,Za=d3=class extends xe{constructor(e){super(e),this._handles=new Dt,this._context=null,this._pendingAtmosphere=null,this._atmosphere=null}initialize(){this.view._stage.addRenderPlugin(dlt,this)}destroy(){var e;this._pendingAtmosphere=ct(this._pendingAtmosphere),((e=this.view)==null?void 0:e._stage)!=null&&this.view._stage.removeRenderPlugin(this),this._handles=ct(this._handles),this._set("view",null)}get atmosphereType(){return b(this._pendingAtmosphere)?this._pendingAtmosphere.type:b(this._atmosphere)?this._atmosphere.type:"none"}get canRender(){var e;return!!((e=this.view.basemapTerrain)!=null&&e.renderer.canRender)||this.view.viewingMode!=="global"}get needsLinearDepth(){return this._selectAtmosphereType()==="realistic"}updateAnimation(e){return!!b(this._precipitation)&&this._precipitation.update(e)}get updating(){return b(this._pendingAtmosphere)||b(this._stars)&&this._stars.updating||b(this._clouds)&&this._clouds.running}get weatherVisible(){return Re(this.view.state.camera.eye)-Ar(this.view.spatialReference).radius<=dd}get _stars(){var i,s;const e=this.view,t=(s=(i=e.environment)==null?void 0:i.starsEnabled)!=null?s:!1,r=this._get("_stars");return!t||R(this._context)?(ct(r),null):b(r)?r:new Kv({view:e,requestRender:()=>this._setNeedsRender()})}get _precipitation(){const e=this._get("_precipitation");if(!this._precipitationEnabled||R(this._context))return ct(e),null;const t=this.view,r=this._context;return b(e)&&e.context===r?e:(ct(e),new Ow({context:r,view:t}))}get _clouds(){const e=this._get("_clouds");if(!this.weatherEnabled||R(this._context))return ct(e),null;if(b(e))return e;const t=this.view,r=this._context;return ct(e),new Xa({context:r,view:t,requestRender:()=>this._setNeedsRender()})}get _cloudsComposition(){const e=this._get("_cloudsComposition");if(!this.weatherEnabled||R(this._context))return ct(e),null;const t=this.view.state.viewingMode,r=this._context.renderContext.rctx,i=Ar(this.view.spatialReference).radius;return b(e)&&e.viewingMode===t&&e.planetRadius===i?e:(ct(e),new Rw({rctx:r,viewingMode:t,planetRadius:i,requestRender:()=>this._setNeedsRender()}))}get _fog(){const e=this._get("_fog");if(!this.weatherEnabled||R(this._context))return ct(e),null;if(b(e))return e;const t=this.view,r=this._context;return ct(e),new h3({context:r,view:t})}get weatherEnabled(){var e,t;return!!((t=(e=this.view)==null?void 0:e.environmentManager)!=null&&t.weatherEnabled)}get _precipitationEnabled(){return this.weatherEnabled&&(this.view.environment.weather.type==="rainy"||this.view.environment.weather.type==="snowy")}initializeRenderContext(e=null){this._context=e,this._handles.add([Lo(()=>{var t;return(t=this.view)==null?void 0:t.basemapTerrain},()=>this._updateBasemapTerrain(),Xs),te(()=>({viewingMode:this.view.viewingMode,atmosphereEnabled:this.view.environment.atmosphereEnabled,atmosphereQuality:this.view.environment.atmosphere.quality}),()=>this._updateAtmosphere(),Xs),te(()=>this._stars,()=>this._setNeedsRender()),te(()=>this._clouds,()=>this._updateWeather(this._weatherUpdateParameters),Rt),te(()=>this._precipitation,()=>this._setNeedsRender()),te(()=>this._fog,()=>this._updateFog(this._weatherUpdateParameters),Rt),te(()=>this._weatherUpdateParameters,t=>{this._updateWeather(t),this._updateFog(t)},Xs)])}uninitializeRenderContext(){this._context=null,this._atmosphere=ct(this._atmosphere),this._set("_stars",ct(this._stars)),this._set("_precipitation",ct(this._precipitation)),this._set("_clouds",ct(this._clouds)),this._set("_cloudsComposition",ct(this._cloudsComposition)),this._set("_fog",ct(this._fog))}prepareRender(e){e.bindParameters.clouds.data=xot(this._clouds)?this._clouds:null}render(e){if(e.pass===je.MATERIAL)switch(e.bindParameters.slot){case Se.POSTPROCESSING_ENVIRONMENT_OPAQUE:b(this._stars)&&this._stars.render(e),b(this._atmosphere)&&this._atmosphere.canRender&&(this._atmosphere.render(e),b(this._cloudsComposition)&&b(e.bindParameters.clouds.data)&&(this.weatherVisible&&b(this._clouds)&&this._clouds.ensureWeatherTile(),this._cloudsComposition.render(e,b(this.view.animation))));break;case Se.POSTPROCESSING_ENVIRONMENT_TRANSPARENT:if(b(this._atmosphere)&&this._atmosphere.canRender){const t=this.weatherEnabled?this.view.environment.weather.type:"disabled";if(this._atmosphere.renderHaze(e,t==="rainy"),b(this._fog)){const r=t==="foggy"||t==="rainy"||t==="snowy";(r||this._selectAtmosphereType()!=="realistic")&&this._fog.render(e,r,t==="rainy")}if(b(this._precipitation)){const r=this.view.environment.weather;r.type!=="rainy"&&r.type!=="snowy"||this._precipitation.render(e,r.precipitation,r.type)}}}}get _weatherUpdateParameters(){const e=this.weatherEnabled?this.view.environment.weather:null;return R(e)?null:e.type==="rainy"||e.type==="snowy"?{type:e.type,weatherAdjustment:e.cloudCover,effect:e.precipitation}:{type:e.type,weatherAdjustment:e.type==="foggy"?e.fogStrength:e.cloudCover}}_updateWeather(e){R(e)||R(this._clouds)||(this._clouds.applyPreset(AOe[e.type],e.weatherAdjustment),this._setNeedsRender())}_setNeedsRender(){b(this._context)&&this._context.requestRender()}_updateFog(e){if(!R(this._fog)&&!R(e))switch(e.type){case"foggy":this._fog.strength=Yt(3e-5,.005,e.weatherAdjustment**3),this._setNeedsRender();break;case"rainy":case"snowy":this._fog.strength=Yt(4e-6,2e-4,e.effect**3),this._setNeedsRender();break;default:this._fog.strength=4e-6,this._setNeedsRender()}}_updateAtmosphere(){const e=this._selectAtmosphereType();if(this.atmosphereType===e)return;b(this._pendingAtmosphere)&&(this._pendingAtmosphere!==this._atmosphere&&this._pendingAtmosphere.destroy(),this._pendingAtmosphere=null);const t=this._getAtmosphereClass();if(!t)return b(this._atmosphere)&&(this._atmosphere.destroy(),this._atmosphere=null,this._setNeedsRender()),void this._updateBasemapTerrain();const r=new t(this.view);b(this._context)&&r.initializeRenderContext(this._context),R(this._atmosphere)&&(this._atmosphere=r,this._setNeedsRender()),this._pendingAtmosphere=r,r.when().then(()=>{b(this._atmosphere)&&this._pendingAtmosphere&&this._pendingAtmosphere!==this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=this._pendingAtmosphere),this._pendingAtmosphere=null,this._setNeedsRender(),this._updateBasemapTerrain()}).catch(()=>{this._pendingAtmosphere===r&&(this._pendingAtmosphere=null)})}_getAtmosphereClass(){switch(this._selectAtmosphereType()){case"none":return null;case"realistic":return pde;case"panoramic":return qat;case"simple":return rlt;default:return}}_selectAtmosphereType(){const e=this.view.get("environment.atmosphereEnabled"),t=this.view.get("environment.atmosphere.quality"),r=this.view.viewingMode;return!e||t==null||dg(this.view.spatialReference)?"none":r==="local"?"panoramic":t==="high"&&b(this._context)&&pde.isSupported(this._context)&&iI(this.view.spatialReference)?"realistic":"simple"}_updateBasemapTerrain(){this.view.basemapTerrain&&(this.view.basemapTerrain.velvetOverground=b(this._atmosphere)&&this.atmosphereType==="simple")}get test(){return{atmosphere:this._atmosphere,clouds:this._clouds,selectAtmosphereType:()=>this._selectAtmosphereType(),stubGetAtmosphereClass:e=>{kde=d3.prototype._getAtmosphereClass,d3.prototype._getAtmosphereClass=e},restoreGetAtmosphereClass:()=>{d3.prototype._getAtmosphereClass=kde}}}};u([d({constructOnly:!0})],Za.prototype,"view",void 0),u([d({type:Boolean,readOnly:!0})],Za.prototype,"updating",null),u([d({readOnly:!0})],Za.prototype,"weatherVisible",null),u([d()],Za.prototype,"_context",void 0),u([d()],Za.prototype,"_pendingAtmosphere",void 0),u([d({readOnly:!0})],Za.prototype,"_stars",null),u([d({readOnly:!0})],Za.prototype,"_precipitation",null),u([d({readOnly:!0})],Za.prototype,"_clouds",null),u([d({readOnly:!0})],Za.prototype,"_cloudsComposition",null),u([d({readOnly:!0})],Za.prototype,"_fog",null),u([d({readOnly:!0})],Za.prototype,"weatherEnabled",null),u([d({readOnly:!0})],Za.prototype,"_precipitationEnabled",null),u([d({readOnly:!0})],Za.prototype,"_weatherUpdateParameters",null),Za=d3=u([$("esri.views.3d.environment.EnvironmentRenderer")],Za);function Ude(e,t,r){return plt(e,t.longitude,t.latitude,r.longitude,r.latitude)}function plt(e,t,r,i,s){const n=Ft(r),o=Ft(s),a=n-o,l=Ft(t)-Ft(i),c=Math.sin(a/2),h=Math.sin(l/2),p=2*bf(Math.sqrt(c*c+Math.cos(n)*Math.cos(o)*h*h))*e;return Math.round(1e4*p)/1e4}function flt(e,t,r){const i=t.spatialReference,s=Ar(i),n=new at(t.x,e.y,i),o=new at(r.x,e.y,i),a=new at(e.x,t.y,i),l=new at(e.x,r.y,i);return{lon:Ude(s.radius,n,o),lat:Ude(s.radius,a,l)}}function mlt(e,t,r){const i=t/r,s=Ft(e),n=Math.sin(i/2),o=Math.cos(s),a=2*bf(Math.sqrt(n*n/(o*o)));return nu(a)}function glt(e,t){let r=e/15;return t||(r=Math.round(r)),r}function Vde(e,t){t||(t={hours:0,minutes:0,seconds:0}),t.hours=glt(e[0],!0);const r=t.hours%1;t.hours-=r,t.minutes=60*r;const i=t.minutes%1;return t.minutes-=i,t.seconds=Math.round(60*i),t}var zde,Bde,Gde,BOe={exports:{}};zde=BOe,Bde=function(){var e=Math.PI,t=Math.sin,r=Math.cos,i=Math.tan,s=Math.asin,n=Math.atan2,o=Math.acos,a=e/180,l=864e5,c=2440588,h=2451545,p={dec:0,ra:0};function f(D){return D.valueOf()/l-.5+c}function m(D){return new Date((D+.5-c)*l)}function g(D){return f(D)-h}var v=23.4397*a;function w(D,N){return n(t(D)*r(v)-i(N)*t(v),r(D))}function _(D,N){return s(t(N)*r(v)+r(N)*t(v)*t(D))}function T(D,N,V){return n(t(D),r(D)*t(N)-i(V)*r(N))}function x(D,N,V){return s(t(N)*t(V)+r(N)*r(V)*r(D))}function E(D,N){return a*(280.16+360.9856235*D)-N}function C(D){return a*(357.5291+.98560028*D)}function A(D){return a*(1.9148*t(D)+.02*t(2*D)+3e-4*t(3*D))}function P(D,N){return D+N+102.9372*a+e}function I(D,N){var V=C(D),B=P(V,A(V));return N||(N={dec:0,ra:0}),N.dec=_(B,0),N.ra=w(B,0),N}var L={PolarException:{NORMAL:0,MIDNIGHT_SUN:1,POLAR_NIGHT:2},getPosition:function(D,N,V,B){var W=a*-V,Y=a*N,H=g(D),ee=I(H,p),me=E(H,W)-ee.ra;return B||(B={azimuth:0,altitude:0}),B.azimuth=T(me,Y,ee.dec),B.altitude=x(me,Y,ee.dec),B}},k=[[-.83,"sunrise","sunset"]];L.addTime=function(D,N,V){k.push([D,N,V])};var G=9e-4;function z(D,N){return Math.round(D-G-N/(2*e))}function X(D,N,V){return G+(D+N)/(2*e)+V}function Z(D,N,V){return h+D+.0053*t(N)-.0069*t(2*V)}function ce(D,N,V){return o((t(D)-t(N)*t(V))/(r(N)*r(V)))}function ne(D){var N=a*(134.963+13.064993*D),V=a*(93.272+13.22935*D),B=a*(218.316+13.176396*D)+6.289*a*t(N),W=5.128*a*t(V),Y=385001-20905*r(N);return{ra:w(B,W),dec:_(B,W),dist:Y}}return L.getTimes=function(D,N,V){var B=a*-V,W=a*N,Y=z(g(D),B),H=X(0,B,Y),ee=C(H),me=A(ee),be=P(ee,me),De=_(be,0),ve=Z(H,ee,be);function ge(jr){return Z(X(ce(jr,W,De),B,Y),ee,be)}function Ee(jr){var Qi=(t(jr)-t(W)*t(De))/(r(W)*r(De));return Qi<-1?L.PolarException.MIDNIGHT_SUN:Qi>1?L.PolarException.POLAR_NIGHT:L.PolarException.NORMAL}var Fe,Nr,Br,ur,Gr,pr={solarNoon:m(ve),nadir:m(ve-.5),polarException:L.PolarException.NORMAL};for(Fe=0,Nr=k.length;Fe<Nr;Fe+=1)Gr=ve-((ur=ge((Br=k[Fe])[0]*a))-ve),pr[Br[1]]=m(Gr),pr[Br[2]]=m(ur);return pr.polarException=Ee(k[0][0]*a),pr},L.getMoonPosition=function(D,N,V){var B=a*-V,W=a*N,Y=g(D),H=ne(Y),ee=E(Y,B)-H.ra,me=x(ee,W,H.dec);return me+=.017*a/i(me+10.26*a/(me+5.1*a)),{azimuth:T(ee,W,H.dec),altitude:me,distance:H.dist}},L.getMoonFraction=function(D){var N=g(D),V=I(N),B=ne(N),W=149598e3,Y=o(t(V.dec)*t(B.dec)+r(V.dec)*r(B.dec)*r(V.ra-B.ra)),H=n(W*t(Y),B.dist-W*r(Y));return(1+r(H))/2},L},(Gde=Bde())!==void 0&&(zde.exports=Gde);const OT=BOe.exports,Cm={local:{altitude:1500,ambientAtNight:.1,ambientAtNoon:.45,ambientAtTwilight:.2,directAtNoon:.65,directAtTwilight:.7},global:{altitude:8e5,ambient:.015,direct:.75},planarDirection:{localAltitude:1e4,globalAltitude:1e6,globalAngles:{azimuth:1.3*Math.PI,altitude:.6*Math.PI}}};function ylt(e,t,r,i,s,n,o){se(o.ambient.color,1,1,1),o.ambient.intensity=Cm.global.ambient,se(o.direct.color,1,1,1),o.direct.intensity=Cm.global.direct;const a=t[2],l=Le((Math.abs(a)-Cm.local.altitude)/(Cm.global.altitude-Cm.local.altitude),0,1);let c;if(o.globalFactor=l,n==="sun"&&(c=OT.getTimes(e,t[1],t[0])),l<1){let h;if(n==="sun")h=Elt(e,c,i);else{const p=jOe(i);h={direct:{intensity:Cm.local.directAtNoon*p.direct,color:Ue(1,1,1)},ambient:{intensity:Cm.local.ambientAtNoon*p.ambient,color:Ue(1,1,1)},timeOfDay:"early afternoon"}}En(o.ambient.color,h.ambient.color,o.ambient.color,l),o.ambient.intensity=Yt(h.ambient.intensity,o.ambient.intensity,l),En(o.direct.color,h.direct.color,o.direct.color,l),o.direct.intensity=Yt(h.direct.intensity,o.direct.intensity,l),o.specularStrength=i==="rainy"||i==="snowy"||i==="foggy"?0:1,o.environmentStrength=i==="rainy"?.7:i==="snowy"||i==="foggy"?.75:1}o.noonFactor=n==="sun"?Slt(e,c):1,n==="sun"?_lt(e,t,r,o.direct.directionToLightSource):vlt(s,r,o.direct.directionToLightSource)}function vlt(e,t,r){t===Be.Global?we(f7,e.eye):se(f7,0,0,1),le(m7,e.viewForward,-1);const i=a5(m7,f7),s=Math.max(i-2*g7,0),n=.85*s/(s+1),o=Math.max(g7,i-g7-n);_h(Hde,-o,e.viewRight),Ve(r,m7,Hde),de(r,r,le(Clt,e.viewRight,Alt)),we(r,r)}function _lt(e,t,r,i){const s=Tlt,n=ig(xlt);if(r===Be.Global)OT.getPosition(e,0,0,s),se(i,0,0,-1),lA(n,n,-s.azimuth),_6(n,n,-s.altitude),Ve(i,i,n);else{const o=Cm.planarDirection,a=o.globalAngles,l=t[2];let c=(Math.abs(l)-o.localAltitude)/(o.globalAltitude-o.localAltitude);c=Le(c,0,1),c<1?(OT.getPosition(e,t[1],t[0],s),s.azimuth=(1-c)*s.azimuth+c*a.azimuth,s.altitude=(1-c)*s.altitude+c*a.altitude):(s.azimuth=a.azimuth,s.altitude=a.altitude),se(i,0,-1,0),cA(n,n,-s.azimuth),lA(n,n,-s.altitude),Ve(i,i,n)}}function blt(e,t){if(t===Be.Global)return!0;const r=Cm.planarDirection;return Math.abs(e)<r.localAltitude}const wlt=Ue(.5773502691896258,-.5773502691896258,.5773502691896258);class GOe{constructor(){this.ambient={color:Ue(1,1,1),intensity:.55},this.direct={color:Ue(1,1,1),intensity:.55,directionToLightSource:Qs(wlt)},this.noonFactor=.5,this.globalFactor=0,this.specularStrength=1,this.environmentStrength=1}}const xlt=Ce(),Tlt={azimuth:0,altitude:0};function Slt(e,t){const r=e.valueOf();let i,s;t.polarException===OT.PolarException.MIDNIGHT_SUN?(i=r-60*(e.getHours()+48)*60*1e3-60*e.getMinutes()*1e3,s=i+432e6):t.polarException===OT.PolarException.POLAR_NIGHT?(i=r-2,s=r-1):(i=t.sunrise.valueOf(),s=t.sunset.valueOf());const n=i+(s-i)/2;return 1-Le(Math.abs(r-n)/432e5,0,1)}function jOe(e){switch(e){case"disabled":case"sunny":case"cloudy":return{direct:1,ambient:1};case"rainy":return{direct:.4,ambient:1.2};case"snowy":return{direct:.5,ambient:1.3};case"foggy":return{direct:.2,ambient:1.6}}}function jde(e,t){const r=(e[0]+e[1]+e[2])/3;for(let i=0;i<3;i++)e[i]=e[i]+(r-e[i])*t;return e}function Elt(e,t,r){const i=e.valueOf();let s,n;t.polarException===OT.PolarException.MIDNIGHT_SUN?(s=i-60*(e.getHours()+48)*60*1e3-60*e.getMinutes()*1e3,n=s+432e6):t.polarException===OT.PolarException.POLAR_NIGHT?(s=i-2,n=i-1):(s=t.sunrise.valueOf(),n=t.sunset.valueOf());const o=n-s,a=s+o/2,l=o/4,c=a-l,h=a+l,p=.06*o,f=s-p/2,m=s+p/2,g=n-p/2,v=n+p/2,w=Cm.local,_=[.01,w.ambientAtNight],T=[.8,.8,1],x=[.01,.01,.01],E=[w.directAtTwilight,w.ambientAtTwilight],C=[1,.6,.5],A=[.8,.8,1],P=[.9*w.directAtNoon,w.ambientAtNoon],I=[1,.98,.98],L=[.98,.98,1],k=[w.directAtNoon,w.ambientAtNoon],G=[1,1,1],z=[1,1,1],X=P,Z=I,ce=L,ne=E,D=C,N=A;let V,B,W=[0,0],Y=[0,0,0],H=[0,0,0];i<f||i>v?(W=_,Y=x,H=T,B="night"):i<m?(V=m-f,W=Vo(i-f,V,_,E),Y=Vo(i-f,V,x,C),H=Vo(i-f,V,T,A),B="sun rising"):i<c?(V=c-m,W=Vo(i-m,V,E,P),Y=Vo(i-m,V,C,I),H=Vo(i-m,V,A,L),B="early morning"):i<a?(V=a-c,W=Vo(i-c,V,P,k),Y=Vo(i-c,V,I,G),H=Vo(i-c,V,L,z),B="late morning"):i<h?(V=h-a,W=Vo(i-a,V,k,X),Y=Vo(i-a,V,G,Z),H=Vo(i-a,V,z,ce),B="early afternoon"):i<g?(V=g-h,W=Vo(i-h,V,X,ne),Y=Vo(i-h,V,Z,D),H=Vo(i-h,V,ce,N),B="late afternoon"):i<v&&(V=v-g,W=Vo(i-g,V,ne,_),Y=Vo(i-g,V,D,x),H=Vo(i-g,V,N,T),B="sun setting");let ee=0;switch(r){case"rainy":case"foggy":ee=.9;case"snowy":ee=.5}ee>0&&(Y=jde(Y,ee),H=jde(H,ee));const me=Ue(Y[0],Y[1],Y[2]),be=Ue(H[0],H[1],H[2]),De=jOe(r);return{direct:{intensity:W[0]*De.direct,color:me},ambient:{intensity:W[1]*De.ambient,color:be},timeOfDay:B}}function Vo(e,t,r,i){const s=[];for(let n=0;n<r.length;n++)s[n]=(i[n]-r[n])*e/t+r[n];return s}const Hde=Ce(),f7=M(),m7=M(),Clt=M(),g7=.25,Alt=.2;let Ap=class extends ds.EventedAccessor{constructor(){super(),this._referencePointUpdateDelay=200,this._referencePointUpdateInterval=3e3,this._referencePointUpdateDistThreshold=1e6,this._referencePosUpdateQuery=null,this._referencePosMapCoordsRequested=null,this._viewHandles=new Dt,this._preserveAbsoluteDateTime=!1,this._trackingEnabled=!1,this._referencePosResetPreserveAbsoluteTime=!1,this._referencePosUpdateTimer=null,this._referencePosMapCoords=null,this._mainLight=new aQ,this._ambientLight=new Eie,this._moonLight=new MOe,this.disableQueries=!1,this._disableWeather=!1,this._renderer=null,this._referencePosWGS84Comparable=null,this._resetReferencePosition()}destroy(){this.disconnectView(),this._viewHandles.destroy()}get _view(){var e;return(e=this._renderer)==null?void 0:e.view}get updating(){var e;return!((this.disableQueries||!this._referencePosUpdateQuery&&!this._referencePosMapCoordsRequested)&&!((e=this._renderer)!=null&&e.updating))}get weatherEnabled(){var e,t,r;return((e=this._view)==null?void 0:e.environment.atmosphereEnabled)&&!this._disableWeather&&((r=(t=this._view)==null?void 0:t.state)==null?void 0:r.viewingMode)===Be.Global&&iI(this._view.spatialReference)}get weatherVisible(){var e;return this.weatherEnabled&&((e=this._renderer)==null?void 0:e.weatherVisible)}get referencePositionWGS84Comparable(){return this._referencePosWGS84Comparable}connectView(e){if(this._renderer)return;this._renderer=new Za({view:e});const t=()=>this._updateRenderParameters(),r=()=>this._cameraHandler(),i=()=>this._updateLighting();this._viewHandles.add([te(()=>e.environment.lighting,s=>this._updateLightingHandler(s),ei),te(()=>e.environment.lighting.type==="sun"?e.environment.lighting.date:null,s=>this._lightingDateHandler(s),ei),te(()=>e.stationary,()=>this._interactingStationaryHandler()),te(()=>e.environment.lighting.directShadowsEnabled,t,ei),te(()=>e.environment.lighting.ambientOcclusionEnabled,t,ei),te(()=>e.environment.lighting.waterReflectionEnabled,t,ei),te(()=>{var s;return(s=e.environment.background)==null?void 0:s.color},t,ei),te(()=>e.spatialReference,()=>this._resetReferencePosition(!0),ei),te(()=>e.environment.weather.type,i,ei),te(()=>this.weatherEnabled,i,ei),te(()=>e.viewingMode,()=>this._resetReferencePosition(!0),Xs),te(()=>e.environment.lighting.type==="sun"&&e.environment.lighting.cameraTrackingEnabled,s=>this._updateCameraTracking(s),Xs),te(()=>e.state.camera,r,Xs),te(()=>this.disableQueries,r)]),this._updateRenderParameters(),this._updateLighting(),this._cameraHandler(),this.notifyChange("updating")}disconnectView(){this._viewHandles.removeAll(),this._resetReferencePosition(),this._renderer=ct(this._renderer)}_updateLightingHandler(e){this._updateCameraTracking(e.type==="sun"&&e.cameraTrackingEnabled),this._lightingDateHandler(e.type==="sun"?e.date:null),this._updateRenderParameters()}_updateCameraTracking(e){if(this._trackingEnabled=e,e)this._cameraHandler();else{const t=this._view.environment.lighting;(t==null?void 0:t.type)==="sun"&&(t.positionTimezoneInfo.autoUpdated=!1)}}_lightingDateHandler(e){const t=this._view.environment.lighting;if((t==null?void 0:t.type)!=="virtual"){if(e){if(!t.positionTimezoneInfo.autoUpdated){this._preserveAbsoluteDateTime=!0;const r=this._view.spatialReference;if(!dT(r)){const i=this._view.camera.position;if(!this._referencePosMapCoords||!this._referencePosMapCoords.equals(i))return void this._requestReferencePositionUpdate(i)}if(this._preupdateTracking(e),b(this._referencePosWGS84Comparable)){const i=Vde(this._referencePosWGS84Comparable,qde);b(i)&&(t.autoUpdate(null,i),this._trackingEnabled&&(t.positionTimezoneInfo.autoUpdated=!0))}}this._updateLighting(e)}}else this._updateLighting()}_preupdateTracking(e){!this._trackingEnabled&&this._view.environment.lighting.type==="sun"&&this._view.environment.lighting.cameraTrackingEnabled&&this._cameraHandler(e)}_cameraHandler(e=null){const t=this._view;if(!t.ready)return;const r=t.stateManager.camera;r&&(this._cameraHandlerClientSide(r,e)||this._cameraHandlerServerSide(r))}_cameraHandlerClientSide(e,t){const r=iI(this._view.spatialReference);if(r&&!dT(this._view.spatialReference))return!1;const i=e.position;return R(this._referencePosWGS84Comparable)&&(this._referencePosWGS84Comparable=M()),r?N9e(i,this._referencePosWGS84Comparable):se(this._referencePosWGS84Comparable,i.longitude,i.latitude,i.z),this.notifyChange("referencePositionWGS84Comparable"),this._autoUpdateTimezone(this._referencePosWGS84Comparable,t)||this._updateLighting(t),!0}_cameraHandlerServerSide(e){const t=e.position;(!this._referencePosMapCoords||this._referencePosMapCoordsRequested||this._exceedsReferencePosDistThreshold(t))&&this._requestReferencePositionUpdate(t,!0),this._view.mapCoordsHelper&&this._referencePosWGS84Comparable&&(this._referencePosWGS84Comparable[2]=t.z*this._view.mapCoordsHelper.unitInMeters,this._referencePosChanged())}_interactingStationaryHandler(){this._view.stationary&&this._executePendingReferencePositionUpdate()}_updateLighting(e){const t=this._view,r=e||(t.environment.lighting.type==="sun"?t.environment.lighting.date:null),i=this._referencePosWGS84Comparable,s=b(i)?Rlt:Olt;if(b(i)){const h=this.weatherVisible?t.environment.weather.type:"disabled";ylt(r,i,t.state.viewingMode,h,t.state.camera,t.environment.lighting.type,s)}const n=this._mainLight,o=s.direct;le(n.intensity,o.color,o.intensity*Math.PI),ae(n.direction,o.directionToLightSource),n.specularStrength=s.specularStrength,n.environmentStrength=s.environmentStrength;const a=this._ambientLight;le(a.intensity,s.ambient.color,s.ambient.intensity);const l=this._moonLight;En(l.intensity,Plt,Ilt,s.globalFactor);const c=(1-.5*s.globalFactor)*(1-.4*s.noonFactor*(1-s.globalFactor));le(l.intensity,l.intensity,c),ae(l.direction,o.directionToLightSource),t._stage.renderView.updateLightSources([n,a,l],1-s.noonFactor,s.globalFactor),this._updateRenderParameters()}_autoUpdateTimezone(e,t=null){if(this._view.environment.lighting.type==="virtual"||!this._view.environment.lighting.cameraTrackingEnabled||R(e))return!1;const r=Mlt;r.setTime((t||this._view.environment.lighting.date).getTime());const i=Vde(e,qde);if(R(i))return!1;let s=this._view.environment.lighting.positionTimezoneInfo;if(s.autoUpdated){if(s.hours===i.hours&&s.minutes===i.minutes&&s.seconds===i.seconds)return!1}else s=i;const n=r.getUTCHours()-(i.hours-s.hours),o=r.getUTCMinutes()-(i.minutes-s.minutes),a=r.getUTCSeconds()-(i.seconds-s.seconds);return r.setUTCHours(n),r.setUTCMinutes(o),r.setUTCSeconds(a),!t&&this._view.environment.lighting.autoUpdate(r,i)}_updateRenderParameters(){const e=this._view._stage;if(!e)return;const t=Xu(this._referencePosWGS84Comparable,!0,s=>blt(s[2],this._view.state.viewingMode)),r=this._view.environment.background,i=r instanceof DRe?{type:"color",color:dte(Me.toUnitRGBA(r.color))}:{type:"color",color:xr(0,0,0,1)};e.renderView.setRenderParameters({shadowMap:this._view.environment.lighting.directShadowsEnabled&&t,background:i,environment:this._view.environment,weatherVisible:this._view.environmentManager.weatherVisible})}_resetReferencePosition(e=!1){this._cancelReferencePosUpdates(),this._referencePosMapCoords=null,this._referencePosMapCoordsRequested=null,this._referencePosResetPreserveAbsoluteTime=null,this._referencePosWGS84Comparable=null,this.notifyChange("updating"),e&&this._cameraHandler()}_requestReferencePositionUpdate(e,t=!1){if(!this.disableQueries&&(this._referencePosMapCoordsRequested?this._referencePosMapCoordsRequested.copy(e):this._referencePosMapCoordsRequested=e.clone(),this._referencePosResetPreserveAbsoluteTime=!!t,!this._referencePosUpdateQuery&&!this._referencePosUpdateTimer&&this._view.stationary)){const r=this._referencePosUpdateQuery=BC(this._referencePointUpdateDelay).then(()=>{if(this._referencePosUpdateQuery===r){const s=()=>this._referencePosUpdateQuery!==r;return this._doReferencePositionUpdateQuery(s)}}).catch(s=>{s.name==="mapcoordshelper:missing-geometry-service"&&(this.disableQueries=!0)}).then(()=>{this._referencePosUpdateQuery===r&&(this._referencePosUpdateQuery=null,this._referencePosUpdateTimer||this._executePendingReferencePositionUpdate(),this.notifyChange("updating"))}),i=this._referencePosUpdateTimer=BC(this._referencePointUpdateInterval).then(()=>{this._referencePosUpdateTimer===i&&(this._referencePosUpdateTimer=null,this._referencePosUpdateQuery||this._executePendingReferencePositionUpdate())});this.notifyChange("updating")}}async _doReferencePositionUpdateQuery(e){this._referencePosResetPreserveAbsoluteTime&&(this._preserveAbsoluteDateTime=!1),this._referencePosMapCoords?this._referencePosMapCoords.copy(this._referencePosMapCoordsRequested):this._referencePosMapCoords=this._referencePosMapCoordsRequested.clone(),this._referencePosResetPreserveAbsoluteTime=null,this._referencePosMapCoordsRequested=null;const t=await this._view.mapCoordsHelper.toGeographic(this._referencePosMapCoords);if(!e()&&!isNaN(t[0])&&!isNaN(t[1])){const r=this._referencePosMapCoords.z*this._view.mapCoordsHelper.unitInMeters;this._referencePosWGS84Comparable?(this._referencePosWGS84Comparable[0]=t[0],this._referencePosWGS84Comparable[1]=t[1],this._referencePosWGS84Comparable[2]=r):this._referencePosWGS84Comparable=[t[0],t[1],r],this._referencePosChanged()}}_executePendingReferencePositionUpdate(){const e=this._referencePosMapCoordsRequested;e&&this._requestReferencePositionUpdate(e,this._referencePosResetPreserveAbsoluteTime)}_referencePosChanged(){this._preserveAbsoluteDateTime?this._updateLighting():this._autoUpdateTimezone(this._referencePosWGS84Comparable)||this._updateLighting(),this.notifyChange("referencePositionWGS84Comparable")}_exceedsReferencePosDistThreshold(e){if(this._referencePosMapCoords){let t=this._referencePosMapCoords.distance(e);return this._view.mapCoordsHelper&&(t*=this._view.mapCoordsHelper.unitInMeters),t>this._referencePointUpdateDistThreshold}return!0}_cancelReferencePosUpdates(){const e=!!this._referencePosUpdateQuery;return this._referencePosUpdateQuery=null,this._referencePosUpdateTimer=null,e}get test(){const e=this;return{get renderer(){return e._renderer},set referencePointUpdateInterval(t){e._referencePointUpdateInterval=t},set referencePointUpdateDistThreshold(t){e._referencePointUpdateDistThreshold=t},set referencePosUpdateTimer(t){e._referencePosUpdateTimer=t},set referencePointUpdateDelay(t){e._referencePointUpdateDelay=t},set disableWeather(t){e._disableWeather=t}}}};u([d({type:Boolean,readOnly:!0})],Ap.prototype,"updating",null),u([d()],Ap.prototype,"disableQueries",void 0),u([d()],Ap.prototype,"_disableWeather",void 0),u([d()],Ap.prototype,"weatherEnabled",null),u([d()],Ap.prototype,"weatherVisible",null),u([d()],Ap.prototype,"referencePositionWGS84Comparable",null),u([d()],Ap.prototype,"_renderer",void 0),u([d()],Ap.prototype,"_referencePosWGS84Comparable",void 0),Ap=u([$("esri.views.3d.environment.SceneViewEnvironmentManager")],Ap);const Rlt=new GOe,Olt=new GOe,Mlt=new Date,qde={hours:0,minutes:0,seconds:0},Plt=Ue(.22,.22,.33),Ilt=Ue(.22,.22,.22);function JI(e,t){return(e&t)!=0}function PV(e,t,r,i,s,n){e!==0&&(r?(n.min=Math.min(n.min,t),n.max=Math.max(n.max,t)):i!=null?(n.min-=Math.max(0,(t-n.min)*(1-i)),n.max+=Math.max(0,(t-n.max)*(1-i))):s&&(n.min-=Math.max(0,t-n.min-s),n.max+=Math.max(0,t-n.max-s)))}var jt,Ti,io;(function(e){e[e.NONE=0]="NONE",e[e.ZOOM=1]="ZOOM",e[e.TUMBLE=2]="TUMBLE",e[e.LOOK_AROUND=3]="LOOK_AROUND",e[e.PAN=4]="PAN",e[e.ASCEND=5]="ASCEND"})(jt||(jt={})),function(e){e[e.NONE=0]="NONE",e[e.TILT=1]="TILT",e[e.ALTITUDE=2]="ALTITUDE",e[e.DISTANCE=4]="DISTANCE",e[e.COLLISION=8]="COLLISION",e[e.ALL=15]="ALL",e[e.ALL_EXCEPT_COLLISION=7]="ALL_EXCEPT_COLLISION"}(Ti||(Ti={})),function(e){e[e.TUMBLE=0]="TUMBLE",e[e.LOOK_AROUND=1]="LOOK_AROUND"}(io||(io={}));const k1={selection:Ti.NONE,interactionType:jt.NONE,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:io.TUMBLE};function HOe(e,t,r,i){return t=t||e.viewForward,ae(i,t),le(i,i,Math.sign(Te(t,r))),i}function $lt(e,t,r,i){return klt(e,t,r,Nlt(i,t,r,!0))}function Llt(e,t,r,i){const s=Te(r,pe(e,i,t));return de(e,t,le(e,r,s))}const Dlt={dir:M(),len:0,clip:rt()};function Nlt(e,t,r,i){const s=Dlt;return e?(r&&i&&(s.len=pi(t,r)),ae(s.dir,e)):i?(s.len=pi(t,r),pe(s.dir,r,t),le(s.dir,s.dir,1/s.len)):(pe(s.dir,r,t),we(s.dir,s.dir)),s}function Flt(e,t,r){const i=Te(e,r.dir),s=-ui(e,t);if(s<0&&i>=0)return!1;if(i>-1e-6&&i<1e-6)return s>0;if((s<0||i<0)&&!(s<0&&i<0))return!0;const n=s/i;return i>0?n<r.clip[1]&&(r.clip[1]=n):n>r.clip[0]&&(r.clip[0]=n),r.clip[0]<=r.clip[1]}function klt(e,t,r,i){i.clip[0]=0,i.clip[1]=r?i.len:Number.MAX_VALUE;for(let s=0;s<e.length;s++)if(!Flt(e[s],t,i))return!1;return!0}function Ult(e,t,r=k1){const i=Iie(e,t,r);if(i===0)return!1;const s=e.renderCoordsHelper,n=s.getAltitude(t.eye)+i,o=HOe(t,r.interactionDirection,Blt(e,t,Math.sign(i),qlt),Hlt),a=ae(Wlt,t.viewForward),l=s.intersectInfiniteManifold(wh(t.eye,o),n,y7);return t.eye=b(l)?l:s.setAltitude(y7,n,t.eye),t.center=Llt(y7,t.eye,a,t.center),!0}function Iie(e,t,r=k1){if(!Vlt(e,r))return 0;const i=Glt(e.state.constraints.altitude,jlt);zlt(e,r,i);const s=e.renderCoordsHelper.getAltitude(t.eye),n=Le(s,i.min,i.max)-s;return Math.abs(n)<=1e-6?0:n}function Vlt(e,t){const r=e.state.constraints.altitude;return!(!e.state.isGlobal||!r)&&(t.interactionType!==jt.TUMBLE||!JI(t.selection,Ti.TILT))}function zlt(e,t,r){const i=t.interactionType;if(i===jt.NONE)return;const{min:s,max:n}=r,{interactionStartCamera:o,interactionFactor:a}=t,l=i===jt.TUMBLE||i===jt.ZOOM,c=Iie(e,o),h=c===0?0:e.renderCoordsHelper.getAltitude(o.eye);r.min=s,r.max=n,PV(c,h,l,a,.05*h,r)}function Blt(e,t,r,i){return e.renderCoordsHelper.worldUpAtPosition(t.eye,i),le(i,i,r),i}function Glt(e,t){return t.min=e.min,t.max=e.max,t}const jlt={min:0,max:0},Hlt=M(),qlt=M(),Wlt=M(),y7=M();function $ie(e,t,r=k1){if(!e.state.isLocal)return 0;const i=e.state.constraints.distance;if(!e.pointsOfInterest.surfaceOrigin.renderLocation||i===1/0)return 0;TN.min=0,TN.max=i,Zlt(e,r,TN);const s=Lie(e,t),n=TN.max-s;return n>=-1e-6?0:n}function Xlt(e,t,r=k1){const i=$ie(e,t,r);if(i===0)return!1;const s=e.pointsOfInterest.surfaceOrigin,n=Lie(e,t)+i,o=ae(Qlt,t.eye),a=HOe(t,r.interactionDirection,Ylt(e,t,ect),Klt);if(!Y1(BTe(s.renderLocation,n),wh(t.eye,a),SN))return!1;t.eye=SN;const l=pe(Jlt,t.eye,o);t.center=de(SN,t.center,l);const c=e.renderCoordsHelper.getAltitude(t.center),h=e.renderCoordsHelper.intersectInfiniteManifold(t.ray,c,SN);return b(h)&&(t.center=h),!0}function Zlt(e,t,r){const i=t.interactionType;if(i===jt.NONE)return;const{min:s,max:n}=r,{interactionStartCamera:o,interactionFactor:a}=t,l=i===jt.ZOOM||i===jt.PAN,c=$ie(e,o),h=c===0?0:Lie(e,o);r.min=s,r.max=n,PV(c,h,l,a,.05*h,r)}function Lie(e,t){const r=e.pointsOfInterest.surfaceOrigin;return pi(t.eye,r.renderLocation)}function Ylt(e,t,r){const i=e.pointsOfInterest.surfaceOrigin;return S0(r,t.eye,i.renderLocation)}const TN={min:0,max:0},Qlt=M(),Jlt=M(),Klt=M(),ect=M(),SN=M();var qi,$o;(function(e){e[e.OBJECT=0]="OBJECT",e[e.HUD=1]="HUD",e[e.TERRAIN=2]="TERRAIN",e[e.OVERLAY=3]="OVERLAY",e[e.I3S=4]="I3S",e[e.PCL=5]="PCL",e[e.LOD=6]="LOD",e[e.VOXEL=7]="VOXEL"})(qi||(qi={}));class tct{constructor(){this.verticalOffset=0,this.selectionMode=!1,this.hud=!0,this.selectOpaqueTerrainOnly=!0,this.invisibleTerrain=!1,this.backfacesTerrain=!0,this.isFiltered=!1,this.store=$o.ALL}}(function(e){e[e.MIN=0]="MIN",e[e.MINMAX=1]="MINMAX",e[e.ALL=2]="ALL"})($o||($o={}));function xg(e){return b(e)&&b(e.dist)}function Wde(e){return(t,r,i)=>(En(Xde,t,r,i),!wte(e,Xde))}function wB(e){return xg(e)&&e.intersector===qi.OBJECT&&!!e.target}function xB(e){return xg(e)&&e.intersector===qi.HUD&&!!e.target&&b(e.target.center)}const Xde=M();class rct{constructor(){this._transform=Ce(),this._transformInverse=new EN({value:this._transform},Cs,Ce),this._transformInverseTranspose=new EN(this._transformInverse,lc,Ce),this._transformTranspose=new EN({value:this._transform},lc,Ce),this._transformInverseRotation=new EN({value:this._transform},_Oe,$i)}_invalidateLazyTransforms(){this._transformInverse.invalidate(),this._transformInverseTranspose.invalidate(),this._transformTranspose.invalidate(),this._transformInverseRotation.invalidate()}get transform(){return this._transform}get inverse(){return this._transformInverse.value}get inverseTranspose(){return this._transformInverseTranspose.value}get inverseRotation(){return this._transformInverseRotation.value}get transpose(){return this._transformTranspose.value}setTransformMatrix(t){Is(this._transform,t)}multiplyTransform(t){Yi(this._transform,this._transform,t)}set(t){Is(this._transform,t),this._invalidateLazyTransforms()}setAndInvalidateLazyTransforms(t,r){this.setTransformMatrix(t),this.multiplyTransform(r),this._invalidateLazyTransforms()}}class EN{constructor(t,r,i){this.original=t,this.update=r,this.dirty=!0,this.transform=i()}invalidate(){this.dirty=!0}get value(){return this.dirty&&(this.update(this.transform,this.original.value),this.dirty=!1),this.transform}}class ict{constructor(t=0){this.offset=t,this.tmpVertex=M()}applyToVertex(t,r,i){const s=t+this.localOrigin[0],n=r+this.localOrigin[1],o=i+this.localOrigin[2],a=this.offset/Math.sqrt(s*s+n*n+o*o);return this.tmpVertex[0]=t+s*a,this.tmpVertex[1]=r+n*a,this.tmpVertex[2]=i+o*a,this.tmpVertex}applyToAabb(t){for(let n=0;n<3;++n)Y0[n]=t[0+n]+this.localOrigin[n],CN[n]=t[3+n]+this.localOrigin[n],ES[n]=Y0[n];const r=this.applyToVertex(Y0[0],Y0[1],Y0[2]);for(let n=0;n<3;++n)t[n]=r[n],t[n+3]=r[n];const i=n=>{const o=this.applyToVertex(n[0],n[1],n[2]);for(let a=0;a<3;++a)t[a+0]=Math.min(t[a+0],o[a]),t[a+3]=Math.max(t[a+3],o[a])};for(let n=1;n<8;++n){for(let o=0;o<3;++o)ES[o]=(n&1<<o)==0?Y0[o]:CN[o];i(ES)}let s=0;for(let n=0;n<3;++n)Y0[n]*CN[n]<0&&(s|=1<<n);if(s!==0&&s!==7){for(let n=0;n<8;++n)if((s&n)==0){for(let o=0;o<3;++o)s[o]?ES[o]=0:ES[o]=(n&1<<o)!=0?Y0[o]:CN[o];i(ES)}}for(let n=0;n<3;++n)t[n+0]-=this.localOrigin[n],t[n+3]-=this.localOrigin[n];return t}}const Y0=M(),CN=M(),ES=M();class sct{constructor(t=0){this.componentLocalOriginLength=0,this._tmpVertex=M(),this._mbs=kn(),this._obb={center:M(),halfSize:Mr(),quaternion:null},this._totalOffset=0,this._offset=0,this._resetOffset(t)}_resetOffset(t){this._offset=t,this._totalOffset=t}set offset(t){this._resetOffset(t)}get offset(){return this._offset}set componentOffset(t){this._totalOffset=this._offset+t}set localOrigin(t){this.componentLocalOriginLength=Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2])}applyToVertex(t,r,i){const s=t,n=r,o=i+this.componentLocalOriginLength,a=this._totalOffset/Math.sqrt(s*s+n*n+o*o);return this._tmpVertex[0]=t+s*a,this._tmpVertex[1]=r+n*a,this._tmpVertex[2]=i+o*a,this._tmpVertex}applyToAabb(t){const r=t[0],i=t[1],s=t[2]+this.componentLocalOriginLength,n=t[3],o=t[4],a=t[5]+this.componentLocalOriginLength,l=r*n<0?0:Math.min(Math.abs(r),Math.abs(n)),c=i*o<0?0:Math.min(Math.abs(i),Math.abs(o)),h=s*a<0?0:Math.min(Math.abs(s),Math.abs(a)),p=Math.sqrt(l*l+c*c+h*h);if(p<this._totalOffset)return t[0]-=r<0?this._totalOffset:0,t[1]-=i<0?this._totalOffset:0,t[2]-=s<0?this._totalOffset:0,t[3]+=n>0?this._totalOffset:0,t[4]+=o>0?this._totalOffset:0,t[5]+=a>0?this._totalOffset:0,t;const f=Math.max(Math.abs(r),Math.abs(n)),m=Math.max(Math.abs(i),Math.abs(o)),g=Math.max(Math.abs(s),Math.abs(a)),v=Math.sqrt(f*f+m*m+g*g),w=this._totalOffset/v,_=this._totalOffset/p;return t[0]+=r*(r>0?w:_),t[1]+=i*(i>0?w:_),t[2]+=s*(s>0?w:_),t[3]+=n*(n<0?w:_),t[4]+=o*(o<0?w:_),t[5]+=a*(a<0?w:_),t}applyToMbs(t){const r=Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]),i=this._totalOffset/r;return this._mbs[0]=t[0]+t[0]*i,this._mbs[1]=t[1]+t[1]*i,this._mbs[2]=t[2]+t[2]*i,this._mbs[3]=t[3]+t[3]*this._totalOffset/r,this._mbs}applyToObb(t){const r=t.center,i=this._totalOffset/Math.sqrt(r[0]*r[0]+r[1]*r[1]+r[2]*r[2]);this._obb.center[0]=r[0]+r[0]*i,this._obb.center[1]=r[1]+r[1]*i,this._obb.center[2]=r[2]+r[2]*i,ch(this._obb.halfSize,t.halfSize,t.quaternion),de(this._obb.halfSize,this._obb.halfSize,t.center);const s=this._totalOffset/Math.sqrt(this._obb.halfSize[0]*this._obb.halfSize[0]+this._obb.halfSize[1]*this._obb.halfSize[1]+this._obb.halfSize[2]*this._obb.halfSize[2]);return this._obb.halfSize[0]+=this._obb.halfSize[0]*s,this._obb.halfSize[1]+=this._obb.halfSize[1]*s,this._obb.halfSize[2]+=this._obb.halfSize[2]*s,pe(this._obb.halfSize,this._obb.halfSize,t.center),_0(Jde,t.quaternion),ch(this._obb.halfSize,this._obb.halfSize,Jde),this._obb.halfSize[0]*=this._obb.halfSize[0]<0?-1:1,this._obb.halfSize[1]*=this._obb.halfSize[1]<0?-1:1,this._obb.halfSize[2]*=this._obb.halfSize[2]<0?-1:1,this._obb.quaternion=t.quaternion,this._obb}}class nct{constructor(t=0){this.offset=t,this.sphere=kn(),this.tmpVertex=M()}applyToVertex(t,r,i){const s=this.objectTransform.transform;let n=s[0]*t+s[4]*r+s[8]*i+s[12],o=s[1]*t+s[5]*r+s[9]*i+s[13],a=s[2]*t+s[6]*r+s[10]*i+s[14];const l=this.offset/Math.sqrt(n*n+o*o+a*a);n+=n*l,o+=o*l,a+=a*l;const c=this.objectTransform.inverse;return this.tmpVertex[0]=c[0]*n+c[4]*o+c[8]*a+c[12],this.tmpVertex[1]=c[1]*n+c[5]*o+c[9]*a+c[13],this.tmpVertex[2]=c[2]*n+c[6]*o+c[10]*a+c[14],this.tmpVertex}applyToMinMax(t,r){const i=this.offset/Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);t[0]+=t[0]*i,t[1]+=t[1]*i,t[2]+=t[2]*i;const s=this.offset/Math.sqrt(r[0]*r[0]+r[1]*r[1]+r[2]*r[2]);r[0]+=r[0]*s,r[1]+=r[1]*s,r[2]+=r[2]*s}applyToAabb(t){const r=this.offset/Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);t[0]+=t[0]*r,t[1]+=t[1]*r,t[2]+=t[2]*r;const i=this.offset/Math.sqrt(t[3]*t[3]+t[4]*t[4]+t[5]*t[5]);return t[3]+=t[3]*i,t[4]+=t[4]*i,t[5]+=t[5]*i,t}applyToBoundingSphere(t){const r=Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]),i=this.offset/r;return this.sphere[0]=t[0]+t[0]*i,this.sphere[1]=t[1]+t[1]*i,this.sphere[2]=t[2]+t[2]*i,this.sphere[3]=t[3]+t[3]*this.offset/r,this.sphere}}const Zde=new nct;function pQ(e){return b(e)?(Zde.offset=e,Zde):null}const Yde=new sct;function oct(e){return b(e)?(Yde.offset=e,Yde):null}const Qde=new ict;function act(e){return b(e)?(Qde.offset=e,Qde):null}const Yp="terrain",Jde=A0();function fQ(e,t,r){for(let i=0;i<r;++i)t[2*i]=e[i],t[2*i+1]=e[i]-t[2*i]}function lct(e,t){const r=e.length;for(let i=0;i<r;++i)kE[0]=e[i],t[i]=kE[0];return t}function cct(e,t){const r=e.length;for(let i=0;i<r;++i)kE[0]=e[i],kE[1]=e[i]-kE[0],t[i]=kE[1];return t}const kE=new Float32Array(2);function mQ(e,t){return R(e)&&(e=[]),e.push(t),e}function gQ(e,t){if(R(e))return null;const r=e.filter(i=>i!==t);return r.length===0?null:r}function _L(e){return!!b(e)&&!e.visible}function uct(e,t,r){const i=e.origin.vec3;NOe(v7,-i[0],-i[1],-i[2]),b(e.transformation)?Yi(t,v7,e.transformation):Is(t,v7),r&&(Cs(r,t),lc(r,r))}function hct(e,t,r,i,s){AN[0]=e.get(t,0),AN[1]=e.get(t,1),AN[2]=e.get(t,2),fQ(AN,gb,3),r.set(s,0,gb[0]),i.set(s,0,gb[1]),r.set(s,1,gb[2]),i.set(s,1,gb[3]),r.set(s,2,gb[4]),i.set(s,2,gb[5])}const AN=new Float64Array(3),gb=new Float32Array(6),v7=Ce(),NA=1e-5;class dct{constructor(t){this.options=new tct,this._results=new pct,this.transform=new rct,this.tolerance=NA,this.verticalOffset=null,this._ray=Ro(),this._rayEnd=M(),this._rayBeginTransformed=M(),this._rayEndTransformed=M(),this.viewingMode=t==null?Be.Global:t}get results(){return this._results}get ray(){return this._ray}get rayBegin(){return this._ray.origin}get rayEnd(){return this._rayEnd}reset(t,r,i){this.resetWithRay(uGe(t,r,this._ray),i)}resetWithRay(t,r){this.camera=r,t!==this._ray&&zU(t,this._ray),this.options.verticalOffset!==0?this.viewingMode===Be.Local?this._ray.origin[2]-=this.options.verticalOffset:this.verticalOffset=this.options.verticalOffset:this.verticalOffset=null,de(this._rayEnd,this._ray.origin,this._ray.direction),this._results.init(this._ray)}intersect(t=null,r,i,s,n){this.point=r,this.filterPredicate=s,this.tolerance=i==null?NA:i;const o=pQ(this.verticalOffset);if(b(t)&&t.length>0){const a=n?l=>{n(l)&&this.intersectObject(l)}:l=>{this.intersectObject(l)};for(const l of t){const c=l.getSpatialQueryAccelerator&&l.getSpatialQueryAccelerator();b(c)?(b(o)?c.forEachAlongRayWithVerticalOffset(this._ray.origin,this._ray.direction,a,o):c.forEachAlongRay(this._ray.origin,this._ray.direction,a),this.options.selectionMode&&this.options.hud&&c.forEachDegenerateObject(a)):l.objects.forAll(h=>a(h))}}this.sortResults()}intersectObject(t){const r=t.geometryRecords;if(!r)return;const i=t.transformation,s=pQ(this.verticalOffset);for(const n of r){const{geometry:o,material:a,instanceParameters:l}=n;if(_L(l))continue;const c=o.id;this.transform.setAndInvalidateLazyTransforms(i,n.getShaderTransformation()),Ve(this._rayBeginTransformed,this.rayBegin,this.transform.inverse),Ve(this._rayEndTransformed,this.rayEnd,this.transform.inverse);const h=this.transform.transform;b(s)&&(s.objectTransform=this.transform),a.intersect(o,l,this.transform.transform,this,this._rayBeginTransformed,this._rayEndTransformed,(p,f,m,g,v,w)=>{if(p>=0){if(b(this.filterPredicate)&&!this.filterPredicate(this._ray.origin,this._rayEnd,p))return;const _=g?this._results.hud:this._results,T=g?x=>{const E={object:t,geometryId:c,triangleNr:m,center:b(w)?[w[0],w[1],w[2]]:null};x.set(qi.HUD,E,p,f,Tn,v)}:x=>x.set(qi.OBJECT,{object:t,geometryId:c,triangleNr:m},p,f,h,v);if((_.min.drapedLayerOrder==null||v>=_.min.drapedLayerOrder)&&(_.min.dist==null||p<_.min.dist)&&T(_.min),this.options.store!==$o.MIN&&(_.max.drapedLayerOrder==null||v<_.max.drapedLayerOrder)&&(_.max.dist==null||p>_.max.dist)&&T(_.max),this.options.store===$o.ALL)if(g){const x=new yQ(this._ray);T(x),this._results.hud.all.push(x)}else{const x=new yC(this._ray);T(x),this._results.all.push(x)}}},n.shaderTransformation)}}sortResults(t=this._results.all){t.sort((r,i)=>r.dist!==i.dist?_t(r.dist,0)-_t(i.dist,0):r.drapedLayerOrder!==i.drapedLayerOrder?_t(r.drapedLayerOrder,Number.MAX_VALUE)-_t(i.drapedLayerOrder,Number.MAX_VALUE):_t(i.drapedLayerGraphicOrder,Number.MIN_VALUE)-_t(r.drapedLayerGraphicOrder,Number.MIN_VALUE))}}function qd(e){return new dct(e)}class pct{constructor(){this.min=new yC(Ro()),this.max=new yC(Ro()),this.hud={min:new yQ(Ro()),max:new yQ(Ro()),all:new Array},this.ground=new yC(Ro()),this.all=[]}init(t){this.min.init(t),this.max.init(t),this.ground.init(t),this.all.length=0,this.hud.min.init(t),this.hud.max.init(t),this.hud.all.length=0}}class yC{constructor(t){this.intersector=qi.OBJECT,this.normal=M(),this.transformation=Ce(),this._ray=Ro(),this.init(t)}get ray(){return this._ray}get distanceInRenderSpace(){return b(this.dist)?(le(RN,this.ray.direction,this.dist),Re(RN)):null}getIntersectionPoint(t){return!!xg(this)&&(le(RN,this.ray.direction,this.dist),de(t,this.ray.origin,RN),!0)}getTransformedNormal(t){return ae(mO,this.normal),mO[3]=0,ih(mO,mO,this.transformation),ae(t,mO),we(t,t)}init(t){this.dist=null,this.target=null,this.drapedLayerOrder=null,this.drapedLayerGraphicOrder=null,this.intersector=qi.OBJECT,zU(t,this._ray)}set(t,r,i,s,n,o,a){this.intersector=t,this.dist=i,ae(this.normal,_t(s,Fbe)),Is(this.transformation,_t(n,Tn)),this.target=r,this.drapedLayerOrder=o,this.drapedLayerGraphicOrder=a}copy(t){zU(t.ray,this._ray),this.intersector=t.intersector,this.dist=t.dist,this.target=t.target,this.drapedLayerOrder=t.drapedLayerOrder,this.drapedLayerGraphicOrder=t.drapedLayerGraphicOrder,ae(this.normal,t.normal),Is(this.transformation,t.transformation)}}class yQ extends yC{constructor(){super(...arguments),this.intersector=qi.HUD}}function Die(e){return new yC(e)}const RN=M(),mO=Zt();function qOe(e,t,r,i){return b(e.renderCoordsHelper.fromRenderCoords(t.eye,IV,i))&&Jwe(r,IV)}function TB(e,t){return e.elevationProvider?_t(e.elevationProvider.getElevation(t[0],t[1],t[2],e.renderCoordsHelper.spatialReference,"ground"),0):0}function nS(e,t,r,i){const s=e.state.camera.clone();t&&(s.eye=t,s.center=r,s.up=i),fct(e,s.ray,Q0)||ae(Q0,s.center);const n=e.state.constraints,o=n.minimumPoiDistance;if(Fn(s.eye,Q0)<o){const a=n.collision.enabled;ae(yb,s.viewForward),le(yb,yb,o),a?s.eye=pe(IV,Q0,yb):de(Q0,s.eye,yb);const l=e.renderCoordsHelper,c=l.getAltitude(s.eye),h=n.collision.elevationMargin;a&&c<h&&(pe(yb,Q0,s.eye),s.eye=l.setAltitude(IV,h,s.eye),de(Q0,s.eye,yb))}return s.center=Q0,s}function Kde(e,t,r){if(!e.state.isGlobal)return!1;const i=TB(e,t),s=e.stateManager.constraintsManager.nearFarHeuristic,{far:n}=s.compute(t,r,e.renderDataExtent,i,gct),o=n*n;return Fn(t,r)>o}function fct(e,t,r){let i=epe[e.viewingMode];i||(i=qd(e.state.viewingMode),i.options.backfacesTerrain=!e.state.isGlobal,i.options.invisibleTerrain=!0,epe[e.viewingMode]=i);const{isGlobal:s}=e.state;return!(!e.sceneIntersectionHelper.intersectRay(t,i,r)||Kde(e,t.origin,r))||!(!e.renderCoordsHelper.intersectManifold(t,0,r)||Kde(e,t.origin,r))||!!s&&mct(t,r,Ar(e.spatialReference).radius)}function mct(e,t,r){const i=Te(e.origin,e.origin)-r*r,s=i>0?Math.sqrt(i)/3:1;return le(t,e.direction,s/Re(e.direction)),de(t,t,e.origin),!0}const epe={},IV=M(),Q0=M(),yb=M(),gct={near:0,far:0};function RR(e,t,r=Md.EYE){const i=e.state.constraints;if(!i.collision.enabled)return!1;const s=TB(e,t.eye),n=e.renderCoordsHelper.getAltitude(t.eye),o=s+i.collision.elevationMargin;if(n>=o)return!1;const a=Re(t.eye);if(pe(ON,t.center,t.eye),t.eye=e.renderCoordsHelper.setAltitude(yct,o,t.eye),r===Md.EYE_AND_CENTER)t.center=de(ON,t.eye,ON);else if(r===Md.EYE_AND_CENTER_SCALE){const l=(a-n+o)/a;t.center=le(ON,t.center,l)}return!0}var Md;(function(e){e[e.EYE=0]="EYE",e[e.EYE_AND_CENTER=1]="EYE_AND_CENTER",e[e.EYE_AND_CENTER_SCALE=2]="EYE_AND_CENTER_SCALE"})(Md||(Md={}));const ON=M(),yct=M();function U1(e,t,r){e.worldUpAtPosition(t,tpe),pe(_7,r,t);const i=Re(_7);return i===0?0:Cn(Te(_7,tpe)/i)}const tpe=M(),_7=M();function WOe(e,t,r=k1,i=!0){gO.eyeCenterDistance=0,gO.requiresTwoSteps=!1;const s=Nie(e,t,r,void 0,gO);if(s===0)return!1;switch(_h(MN,-s,t.viewRight),r.tiltMode){case io.LOOK_AROUND:Ve(J0,t.viewForward,MN),le(J0,J0,gO.eyeCenterDistance),t.center=de(E_,t.eye,J0);break;case io.TUMBLE:pe(J0,t.center,t.eye),Ve(J0,J0,MN),t.eye=pe(E_,t.center,J0);break;default:r.tiltMode}return t.up=Ve(E_,t.up,MN),!gO.requiresTwoSteps||!i||WOe(e,t,r,!1)}function Nie(e,t,r=k1,i=k1,s){if(!e.state.constraints.tilt)return 0;const n=t.distance,o=e.state.constraints.tilt(n,Act);return Cct(e,r,o),i.interactionType===jt.TUMBLE&&JI(i.selection,Ti.ALTITUDE)&&XOe(e,i.interactionStartCamera,o),r.tiltMode===io.LOOK_AROUND||i.tiltMode===io.LOOK_AROUND?_ct(e,t,o,s):vct(e,t,o)}function vct(e,t,r){const i=U1(e.renderCoordsHelper,t.center,t.eye),s=i-Le(i,r.min,r.max);return KI(s)?s:0}function _ct(e,t,r,i){switch(i&&(i.requiresTwoSteps=!1),e.viewingMode){case"global":return wct(e,t,r,i);case"local":return bct(e,t,r,i);default:return void(e.viewingMode,void 0)}}function bct(e,t,r,i){const s=U1(e.renderCoordsHelper,t.center,t.eye),n=Le(s,r.min,r.max),o=s-n;if(!KI(o))return 0;if(i){const a=e.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,l=e.renderCoordsHelper.getAltitude(t.eye)-a,c=Math.cos(n);Math.abs(c)>1e-4?i.eyeCenterDistance=l/c:i.eyeCenterDistance=t.distance}return o}function wct(e,t,r,i){const s=xct(e,t,Rct),n=Le(s.tiltAtCenter,r.min,r.max);if(!KI(s.tiltAtCenter-n))return 0;let o,a;return s.centerIsOnSurface?(o=Tct(s),a=Sct(s,o)):(o=s.constraints.clampTilt(s.eyeCenterDistance,s.tiltAtCenter),i&&o<Math.PI/2&&(i.requiresTwoSteps=!0,o=Math.PI/2-1e-5),a=Ect(s,o)),i&&(i.eyeCenterDistance=vQ(s,o)),a}function xct(e,t,r){const i=e.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,s=i+Ar(e.spatialReference).radius,n=e.renderCoordsHelper.intersectManifold(t.ray,i,E_);return r.eyeCenterDistance=t.distance,r.centerIsOnSurface=!1,b(n)?(r.eyeCenterDistance=pi(t.eye,n),r.tiltAtCenter=U1(e.renderCoordsHelper,n,t.eye),r.centerIsOnSurface=!0):e.state.isLocal?r.tiltAtCenter=U1(e.renderCoordsHelper,t.center,t.eye):(dR(C6(A6,s),t.ray,E_),r.eyeCenterDistance=pi(t.eye,E_),r.tiltAtCenter=Cn(-Te(t.viewForward,we(E_,E_)))),r.radius=s,r.eyeRadius=Re(t.eye),r.constraints=e.state.constraints,r}function KI(e){return Math.abs(e)>1e-9}function Tct(e){const{constraints:t,eyeCenterDistance:r,tiltAtCenter:i}=e;let s=i,n=t.clampTilt(r,i);const o=vQ(e,n);if(t.clampTilt(o,i)===n)return n;let a=0;for(;a<10&&KI(n-s);){const l=(s+n)/2,c=vQ(e,l);KI(t.clampTilt(c,l)-l)?s=l:n=l,a++}return n}function vQ(e,t){if(!e.centerIsOnSurface)return e.eyeCenterDistance;const r=Math.PI-Le(t,0,Math.PI),i=bf(e.radius/e.eyeRadius*Math.sin(r)),s=Math.PI-r-i,n=Math.sin(s)/Math.sin(r);if(e.eyeRadius<e.radius&&n>1){const o=Math.PI-i,a=Math.PI-r-o;return Math.sin(a)/Math.sin(r)*e.eyeRadius}return n*e.eyeRadius}function Sct(e,t){const r=bf(e.radius/e.eyeRadius*Math.sin(e.tiltAtCenter)),i=bf(e.radius/e.eyeRadius*Math.sin(t));return e.eyeRadius>e.radius?r-i:i-r}function Ect(e,t){return e.tiltAtCenter-Math.PI/2-(t-Math.PI/2)}function Cct(e,t,r){if(t.interactionType===jt.NONE)return;const{interactionStartCamera:i,interactionFactor:s}=t,{min:n,max:o}=r,a=Nie(e,i,k1,t),l=a===0?0:U1(e.renderCoordsHelper,i.center,i.eye);r.min=n,r.max=o,t.interactionType===jt.TUMBLE?(JI(t.selection,Ti.ALTITUDE)&&XOe(e,i,r),PV(a,l,!0,s,rpe,r)):PV(a,l,!1,s,rpe,r)}function XOe(e,t,r){if(e.state.isLocal)return;const i=e.state.constraints;if(!i.altitude)return;const s=ul(t.center),n=Math.sqrt(s),o=t.distance,a=Ar(e.spatialReference).radius,l=i.altitude.min+a,c=i.altitude.max+a,h=(l*l-o*o-s)/(-2*n*o),p=(c*c-o*o-s)/(-2*n*o);r.min=Math.max(r.min,Math.min(Math.PI-Cn(p),r.max)),r.max=Math.min(r.max,Math.PI-Cn(h))}const J0=M(),MN=Ce(),E_=M(),rpe=Ft(5),Act={min:0,max:0},Rct={constraints:null,radius:0,eyeRadius:0,centerIsOnSurface:!0,eyeCenterDistance:0,tiltAtCenter:0},gO={eyeCenterDistance:0,requiresTwoSteps:!1};function Oct(e){return e}const SB=e=>e*e,Fie=e=>1-SB(1-e),Mct=e=>e<.5?SB(2*e)/2:(Fie(2*(e-.5))+1)/2,kie=e=>e*e*e,ZOe=e=>1-kie(1-e),YOe=e=>e<.5?kie(2*e)/2:(ZOe(2*(e-.5))+1)/2,Uie=e=>e*e*e*e,QOe=e=>1-Uie(1-e),Pct=e=>e<.5?Uie(2*e)/2:(QOe(2*(e-.5))+1)/2,Vie=e=>e*e*e*e*e,JOe=e=>1-Vie(1-e),Ict=e=>e<.5?Vie(2*e)/2:(JOe(2*(e-.5))+1)/2,zie=e=>1-Math.cos(e*Math.PI/2),KOe=e=>1-zie(1-e),$ct=e=>e<.5?zie(2*e)/2:(KOe(2*(e-.5))+1)/2,Bie=e=>2**(10*(e-1)),bL=e=>1-Bie(1-e),Lct=e=>e<.5?Bie(2*e)/2:(bL(2*(e-.5))+1)/2,Gie=e=>-(Math.sqrt(1-e*e)-1),eMe=e=>1-Gie(1-e),Dct=e=>e<.5?Gie(2*e)/2:(eMe(2*(e-.5))+1)/2;function Zd(e){const t=2*(e-Math.sqrt((e-1)*e)),r=t/2/e;return i=>i<r?e*i*i:t*i-t+1}function Yd(e,t){return(r,i)=>r<t?t*e(r/t,i):1-e((1-r)/(1-t),i)*(1-t)}const Nct=Yd(Zd(1),1),Fct=Yd(Zd(1),0),tMe=Yd(Zd(1),.5),kct=Yd(Zd(2),1),Uct=Yd(Zd(2),0),Vct=Yd(Zd(2),.5),zct=Yd(Zd(3),1),Bct=Yd(Zd(3),0),Gct=Yd(Zd(3),.5),jct=Yd(Zd(4),1),Hct=Yd(Zd(4),0),qct=Yd(Zd(4),.5),Wct={linear:Oct,"in-quad":SB,"out-quad":Fie,"in-out-quad":Mct,"in-coast-quad":Nct,"out-coast-quad":Fct,"in-out-coast-quad":tMe,"in-cubic":kie,"out-cubic":ZOe,"in-out-cubic":YOe,"in-coast-cubic":kct,"out-coast-cubic":Uct,"in-out-coast-cubic":Vct,"in-quart":Uie,"out-quart":QOe,"in-out-quart":Pct,"in-coast-quart":zct,"out-coast-quart":Bct,"in-out-coast-quart":Gct,"in-quint":Vie,"out-quint":JOe,"in-out-quint":Ict,"in-coast-quint":jct,"out-coast-quint":Hct,"in-out-coast-quint":qct,"in-sine":zie,"out-sine":KOe,"in-out-sine":$ct,"in-expo":Bie,"out-expo":bL,"in-out-expo":Lct,"in-circ":Gie,"out-circ":eMe,"in-out-circ":Dct};function Ts(e,t,r=Qct,i=t){let s=!1;i!==t&&i.copyFrom(t),i.computeUp(e.state.viewingMode);for(let a=0;a<Jct;a++){let l=0;for(const c of Yct)if(JI(r.selection,c.type)){const h=Math.abs(c.error(e,i,r));c.apply(e,i,r)&&(s=!0,l+=h)}if(l===0)break}const n=JI(r.selection,Ti.COLLISION),o=Xct(r.interactionType,e);return n&&RR(e,i,o)&&(s=!0),s&&i.computeUp(e.state.viewingMode),s}function Xct(e,t){switch(e){case jt.PAN:return Md.EYE_AND_CENTER;case jt.ASCEND:return t.state.isGlobal?Md.EYE_AND_CENTER_SCALE:Md.EYE_AND_CENTER;default:return Md.EYE}}function Wp(e,t){const r=typeof e=="number"?e:rie(e,t),i=Math.min(1,r/150);return YOe(i)}function Zct(e,t,r){return Nie(e,t,r)*t.distance}const Yct=[{type:Ti.TILT,error:Zct,apply:WOe},{type:Ti.ALTITUDE,error:Iie,apply:Ult},{type:Ti.DISTANCE,error:$ie,apply:Xlt}],Qct={selection:Ti.ALL,interactionType:jt.NONE,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:io.TUMBLE},Jct=5,mu=M(),fc=M(),K0=M(),ha=M(),vb=M(),Kct=M(),gu={upward:Ue(0,0,1),forward:Ue(0,1,0),sideway:Ue(1,0,0)},ipe=$i();class spe{constructor(t=Be.Global){this.viewingMode=t,this.center=M(),this.pitch=0,this.yaw=0,this.distance=0,this.lookAtDirection=Qs(gu.forward)}pixelsPerPanAtZoom(t){return this.size/2/(this._zoomToPanScale*t)}zoomAtPixelsPerPan(t){return this.size/2/(this._zoomToPanScale*t)}pixelsPerRotateAtZoom(){const t=Math.max(Math.cos(Math.abs(this.pitch)),.5);return this.size/2/t}compareTo(t,r){if(r||(r={pan:0,rotate:0,sourceZoom:0,targetZoom:0}),this.viewingMode===Be.Global){const n=(Re(this.center)+Re(t.center))/2;r.pan=a5(this.center,t.center)*n}else r.pan=pi(this.center,t.center);let i=Math.abs(t.yaw-this.yaw);i>=Math.PI&&(i=2*Math.PI-i);const s=Math.abs(t.pitch-this.pitch);return r.rotate=Math.max(i,s),r.sourceZoom=this.distance,r.targetZoom=t.distance,r}interpolate(t,r,i){this.viewingMode===Be.Global?RGe(t.center,r.center,i.pan,this.center):En(this.center,t.center,r.center,i.pan),this.distance=Yt(t.distance,r.distance,i.zoom),this.pitch=Yt(t.pitch,r.pitch,i.rotate);let s=t.yaw;const n=r.yaw;Math.abs(n-s)>=Math.PI&&(s+=2*(s<n?1:-1)*Math.PI),this.yaw=Yt(s,n,i.rotate)}copyFrom(t){ae(this.center,t.center),this.pitch=t.pitch,this.yaw=t.yaw,this.distance=t.distance,ae(this.lookAtDirection,t.lookAtDirection),this.size=t.size,this.copyFromCommon(t),this.viewingMode=t.viewingMode}copyFromRenderCamera(t){const r=this._lookAtOrientation(t.center,ipe);ae(this.center,t.center),pe(ha,t.center,t.eye),Hc(ha,ha,r),Hc(vb,t.up,r),this.distance=Re(ha),ha[0]/=this.distance,ha[1]/=this.distance,ha[2]/=this.distance,this.pitch=this._eyeUpToPitch(ha),this.yaw=this._eyeUpToYaw(ha,vb),this.size=Math.sqrt(t.width*t.width+t.height*t.height),this.copyFromCommon(t)}copyFromCommon(t){this.fov=t.fov,this._zoomToPanScale=Math.atan(.5*this.fov)}copyToRenderCamera(t){const r=this._lookAtOrientation(this.center,ipe);jd(r,r),this._axisAngleVec3(gu.sideway,this.pitch-Math.PI/2,gu.forward,ha),this._axisAngleVec3(gu.upward,this.yaw,ha),this._axisAngleVec3(gu.sideway,this.pitch-Math.PI/2,gu.upward,vb),this._axisAngleVec3(gu.upward,this.yaw,vb),le(ha,ha,this.distance),Hc(ha,ha,r),Hc(vb,vb,r),t.center=this.center,t.eye=pe(ha,this.center,ha),t.up=vb}_axisAngleVec3(t,r,i,s=i){const n=Math.cos(r),o=Math.sin(r);return le(mu,i,n),ut(fc,t,i),le(fc,fc,o),le(K0,t,(1-n)*Te(t,i)),de(s,de(s,mu,fc),K0)}_lookAtOrientation(t,r=$i()){return this._upAtLookAt(t,K0),ut(mu,this.lookAtDirection,K0),we(mu,mu),mu[0]===0&&mu[1]===0&&mu[2]===0&&ae(mu,gu.sideway),ut(fc,K0,mu),we(fc,fc),r[0]=mu[0],r[1]=fc[0],r[2]=K0[0],r[3]=mu[1],r[4]=fc[1],r[5]=K0[1],r[6]=mu[2],r[7]=fc[2],r[8]=K0[2],r}_upAtLookAt(t,r){return this.viewingMode===Be.Local?ae(r,gu.upward):we(r,t)}_eyeUpToPitch(t){return Math.PI-a5(gu.upward,t)}_eyeUpToYaw(t,r){const i=Kct;return Math.abs(r[2])<.5?(ae(i,r),t[2]>0&&le(i,i,-1)):ae(i,t),ut(fc,i,gu.upward),we(fc,fc),a5(gu.sideway,fc,gu.upward)}}function jie(e){return e?{ray:Ro(e.ray),c0:e.c0,c1:e.c1}:{ray:Ro(),c0:0,c1:Number.MAX_VALUE}}function eut(e,t=jie()){return zU(e,t.ray),t.c0=0,t.c1=Number.MAX_VALUE,t}function tut(e,t,r=jie()){const i=Re(e.vector);return zTe(e.origin,t,r.ray),r.c0=0,r.c1=i,r}function WLt(e,t){return rMe(e,e.c0,t)}function XLt(e,t){return rMe(e,e.c1,t)}function rMe(e,t,r){return de(r,e.ray.origin,le(r,e.ray.direction,t))}new C0(()=>({c0:0,c1:0,ray:null}));function e$(e){return e?[Er(e[0]),Er(e[1]),Er(e[2]),Er(e[3]),Er(e[4]),Er(e[5])]:[Er(),Er(),Er(),Er(),Er(),Er()]}function iMe(){return[M(),M(),M(),M(),M(),M(),M(),M()]}function $V(e,t){for(let r=0;r<w0.NUM;r++)R6(e[r],t[r])}function sMe(e,t,r,i=aut){const s=Yi(fte.get(),t,e);Cs(s,s);for(let n=0;n<_Q.NUM;++n){const o=ih(pte.get(),out[n],s);se(i[n],o[0]/o[3],o[1]/o[3],o[2]/o[3])}nMe(r,i)}function nMe(e,t){xa(t[Ke.FAR_BOTTOM_LEFT],t[Ke.NEAR_BOTTOM_LEFT],t[Ke.NEAR_TOP_LEFT],e[ci.LEFT]),xa(t[Ke.NEAR_BOTTOM_RIGHT],t[Ke.FAR_BOTTOM_RIGHT],t[Ke.FAR_TOP_RIGHT],e[ci.RIGHT]),xa(t[Ke.FAR_BOTTOM_LEFT],t[Ke.FAR_BOTTOM_RIGHT],t[Ke.NEAR_BOTTOM_RIGHT],e[ci.BOTTOM]),xa(t[Ke.NEAR_TOP_LEFT],t[Ke.NEAR_TOP_RIGHT],t[Ke.FAR_TOP_RIGHT],e[ci.TOP]),xa(t[Ke.NEAR_BOTTOM_LEFT],t[Ke.NEAR_BOTTOM_RIGHT],t[Ke.NEAR_TOP_RIGHT],e[ci.NEAR]),xa(t[Ke.FAR_BOTTOM_RIGHT],t[Ke.FAR_BOTTOM_LEFT],t[Ke.FAR_TOP_LEFT],e[ci.FAR])}function q_(e,t){for(let r=0;r<w0.NUM;r++){const i=e[r];if(i[0]*t[0]+i[1]*t[1]+i[2]*t[2]+i[3]>=t[3])return!1}return!0}function rut(e,t){return aMe(e,eut(t,lMe.get()))}function ZLt(e,t){for(let r=0;r<w0.NUM;r++){const i=e[r];if(!NGe(i,t))return!1}return!0}function iut(e,t,r){return aMe(e,tut(t,r,lMe.get()))}function oMe(e,t){for(let r=0;r<w0.NUM;r++)if(ui(e[r],t)>0)return!1;return!0}function sut(e,t){for(let r=0;r<w0.NUM;r++)if(LGe(e[r],t))return!1;return!0}function aMe(e,t){for(let r=0;r<w0.NUM;r++)if(!DGe(e[r],t))return!1;return!0}var ci,Ke;(function(e){e[e.LEFT=0]="LEFT",e[e.RIGHT=1]="RIGHT",e[e.BOTTOM=2]="BOTTOM",e[e.TOP=3]="TOP",e[e.NEAR=4]="NEAR",e[e.FAR=5]="FAR"})(ci||(ci={})),function(e){e[e.NEAR_BOTTOM_LEFT=0]="NEAR_BOTTOM_LEFT",e[e.NEAR_BOTTOM_RIGHT=1]="NEAR_BOTTOM_RIGHT",e[e.NEAR_TOP_RIGHT=2]="NEAR_TOP_RIGHT",e[e.NEAR_TOP_LEFT=3]="NEAR_TOP_LEFT",e[e.FAR_BOTTOM_LEFT=4]="FAR_BOTTOM_LEFT",e[e.FAR_BOTTOM_RIGHT=5]="FAR_BOTTOM_RIGHT",e[e.FAR_TOP_RIGHT=6]="FAR_TOP_RIGHT",e[e.FAR_TOP_LEFT=7]="FAR_TOP_LEFT"}(Ke||(Ke={}));const nut={bottom:[Ke.FAR_BOTTOM_RIGHT,Ke.NEAR_BOTTOM_RIGHT,Ke.NEAR_BOTTOM_LEFT,Ke.FAR_BOTTOM_LEFT],near:[Ke.NEAR_BOTTOM_LEFT,Ke.NEAR_BOTTOM_RIGHT,Ke.NEAR_TOP_RIGHT,Ke.NEAR_TOP_LEFT],far:[Ke.FAR_BOTTOM_RIGHT,Ke.FAR_BOTTOM_LEFT,Ke.FAR_TOP_LEFT,Ke.FAR_TOP_RIGHT],right:[Ke.NEAR_BOTTOM_RIGHT,Ke.FAR_BOTTOM_RIGHT,Ke.FAR_TOP_RIGHT,Ke.NEAR_TOP_RIGHT],left:[Ke.FAR_BOTTOM_LEFT,Ke.NEAR_BOTTOM_LEFT,Ke.NEAR_TOP_LEFT,Ke.FAR_TOP_LEFT],top:[Ke.FAR_TOP_LEFT,Ke.NEAR_TOP_LEFT,Ke.NEAR_TOP_RIGHT,Ke.FAR_TOP_RIGHT]};var w0,_Q;(function(e){e[e.NUM=6]="NUM"})(w0||(w0={})),function(e){e[e.NUM=8]="NUM"}(_Q||(_Q={}));const out=[xr(-1,-1,-1,1),xr(1,-1,-1,1),xr(1,1,-1,1),xr(-1,1,-1,1),xr(-1,-1,1,1),xr(1,-1,1,1),xr(1,1,1,1),xr(-1,1,1,1)],lMe=new C0(jie),aut=iMe(),lut=fe.getLogger("esri.views.3d.webgl-engine.lib.Camera");class ii{constructor(t=null,r=null,i=null){this._viewUp=M(),this._viewForward=M(),this._viewRight=M(),this._ray=Ro(),this._viewport=xr(0,0,1,1),this._padding=xr(0,0,0,0),this._fov=55/180*Math.PI,this._nearFar=Fr(1,1e3),this._viewDirty=!0,this._viewMatrix=Ce(),this._projectionDirty=!0,this._projectionMatrix=Ce(),this._viewProjectionDirty=!0,this._viewProjectionMatrix=Ce(),this._viewInverseTransposeMatrixDirty=!0,this._viewInverseTransposeMatrix=Ce(),this._inverseProjectionDirty=!0,this._inverseProjectionMatrix=null,this._frustumDirty=!0,this._frustum=e$(),this._fullViewport=Zt(),this._pixelRatio=1,this.relativeElevation=0,b(t)&&ae(this._ray.origin,t),this._center=b(r)?Qs(r):M(),this._up=b(i)?Qs(i):Ue(0,0,1)}get pixelRatio(){return this._pixelRatio}set pixelRatio(t){this._pixelRatio=t>0?t:1}get eye(){return this._ray.origin}set eye(t){this._compareAndSetView(t,this._ray.origin)}get center(){return this._center}set center(t){this._compareAndSetView(t,this._center)}get ray(){return pe(this._ray.direction,this.center,this.eye),this._ray}get up(){return this._up}set up(t){this._compareAndSetView(t,this._up)}get viewMatrix(){return this._ensureViewClean(),this._viewMatrix}set viewMatrix(t){Is(this._viewMatrix,t),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}get viewForward(){return this._ensureViewClean(),this._viewForward}get viewUp(){return this._ensureViewClean(),this._viewUp}get viewRight(){return this._ensureViewClean(),this._viewRight}get nearFar(){return this._nearFar}get near(){return this._nearFar[0]}set near(t){this._nearFar[0]!==t&&(this._nearFar[0]=t,this._projectionDirty=!0,this._inverseProjectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}get far(){return this._nearFar[1]}set far(t){this._nearFar[1]!==t&&(this._nearFar[1]=t,this._projectionDirty=!0,this._inverseProjectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}get viewport(){return this._viewport}set viewport(t){this.x=t[0],this.y=t[1],this.width=t[2],this.height=t[3]}get x(){return this._viewport[0]}set x(t){t+=this._padding[Ot.LEFT],this._viewport[0]!==t&&(this._viewport[0]=t,this._projectionDirty=!0,this._inverseProjectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}get y(){return this._viewport[1]}set y(t){t+=this._padding[Ot.BOTTOM],this._viewport[1]!==t&&(this._viewport[1]=t,this._projectionDirty=!0,this._inverseProjectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}get width(){return this._viewport[2]}set width(t){this._viewport[2]!==t&&(this._viewport[2]=t,this._projectionDirty=!0,this._inverseProjectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}get height(){return this._viewport[3]}set height(t){this._viewport[3]!==t&&(this._viewport[3]=t,this._projectionDirty=!0,this._inverseProjectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}get fullWidth(){return this._viewport[2]+this._padding[Ot.RIGHT]+this._padding[Ot.LEFT]}set fullWidth(t){this.width=t-(this._padding[Ot.RIGHT]+this._padding[Ot.LEFT])}get fullHeight(){return this._viewport[3]+this._padding[Ot.TOP]+this._padding[Ot.BOTTOM]}set fullHeight(t){this.height=t-(this._padding[Ot.TOP]+this._padding[Ot.BOTTOM])}get fullViewport(){return this._fullViewport[0]=this._viewport[0]-this._padding[Ot.LEFT],this._fullViewport[1]=this._viewport[1]-this._padding[Ot.BOTTOM],this._fullViewport[2]=this.fullWidth,this._fullViewport[3]=this.fullHeight,this._fullViewport}get aspect(){return this.width/this.height}get padding(){return this._padding}set padding(t){this._padding[Ot.TOP]===t[Ot.TOP]&&this._padding[Ot.RIGHT]===t[Ot.RIGHT]&&this._padding[Ot.BOTTOM]===t[Ot.BOTTOM]&&this._padding[Ot.LEFT]===t[Ot.LEFT]||(this._viewport[0]+=t[Ot.LEFT]-this._padding[Ot.LEFT],this._viewport[1]+=t[Ot.BOTTOM]-this._padding[Ot.BOTTOM],this._viewport[2]-=t[Ot.RIGHT]+t[Ot.LEFT]-(this._padding[Ot.RIGHT]+this._padding[Ot.LEFT]),this._viewport[3]-=t[Ot.TOP]+t[Ot.BOTTOM]-(this._padding[Ot.TOP]+this._padding[Ot.BOTTOM]),ef(this._padding,t),this._projectionDirty=!0,this._inverseProjectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}get viewProjectionMatrix(){return this._viewProjectionDirty&&(Yi(this._viewProjectionMatrix,this.projectionMatrix,this.viewMatrix),this._viewProjectionDirty=!1),this._viewProjectionMatrix}get projectionMatrix(){if(this._projectionDirty){const t=this.width,r=this.height,i=this.near*Math.tan(this.fovY/2),s=i*this.aspect;Yxe(this._projectionMatrix,-s*(1+2*this._padding[Ot.LEFT]/t),s*(1+2*this._padding[Ot.RIGHT]/t),-i*(1+2*this._padding[Ot.BOTTOM]/r),i*(1+2*this._padding[Ot.TOP]/r),this.near,this.far),this._projectionDirty=!1}return this._projectionMatrix}get inverseProjectionMatrix(){return R(this._inverseProjectionMatrix)&&(this._inverseProjectionMatrix=Ce()),this._inverseProjectionDirty&&Cs(this._inverseProjectionMatrix,this.projectionMatrix),this._inverseProjectionMatrix}set projectionMatrix(t){Is(this._projectionMatrix,t),this._projectionDirty=!1,this._inverseProjectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}get fov(){return this._fov}set fov(t){this._fov=t,this._projectionDirty=!0,this._inverseProjectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}get fovX(){return Vat(this._fov,this.width,this.height)}set fovX(t){this._fov=kat(t,this.width,this.height),this._projectionDirty=!0,this._inverseProjectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}get fovY(){return zat(this._fov,this.width,this.height)}set fovY(t){this._fov=Uat(t,this.width,this.height),this._projectionDirty=!0,this._inverseProjectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}get distance(){return pi(this._center,this.eye)}get frustum(){return this._recomputeFrustum(),this._frustum}get viewInverseTransposeMatrix(){return(this._viewInverseTransposeMatrixDirty||this._viewDirty)&&(Cs(this._viewInverseTransposeMatrix,this.viewMatrix),lc(this._viewInverseTransposeMatrix,this._viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),this._viewInverseTransposeMatrix}depthNDCToWorld(t){const r=2*t-1;return 2*this.near*this.far/(this.far+this.near-r*(this.far-this.near))}get perRenderPixelRatio(){return Math.tan(this.fovX/2)/(this.width/2)}get perScreenPixelRatio(){return this.perRenderPixelRatio*this._pixelRatio}get aboveGround(){return this.relativeElevation&&this.relativeElevation>=0}copyFrom(t){ae(this._ray.origin,t.eye),ae(this._center,t.center),ae(this._up,t.up),ef(this._viewport,t.viewport),ef(this._padding,t.padding),Do(this._nearFar,t.nearFar),this._fov=t.fov,this.relativeElevation=t.relativeElevation;const r=t;return this._viewDirty=r._viewDirty,this._viewDirty||(Is(this._viewMatrix,t.viewMatrix),ae(this._viewRight,t.viewRight),ae(this._viewUp,t.viewUp),ae(this._viewForward,t.viewForward)),r._projectionDirty?this._projectionDirty=!0:(Is(this._projectionMatrix,t.projectionMatrix),this._projectionDirty=!1),this._viewProjectionDirty=!0,this._inverseProjectionDirty=!0,this._frustumDirty=r._frustumDirty,this._frustumDirty||($V(this._frustum,t.frustum),this._frustumDirty=!1),r._viewInverseTransposeMatrixDirty?this._viewInverseTransposeMatrixDirty=!0:(Is(this._viewInverseTransposeMatrix,t.viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),ef(this._fullViewport,t.fullViewport),this._pixelRatio=t.pixelRatio,this}copyViewFrom(t){this.eye=t.eye,this.center=t.center,this.up=t.up}clone(){return new ii().copyFrom(this)}equals(t){return Xl(this.eye,t.eye)&&Xl(this._center,t.center)&&Xl(this._up,t.up)&&oI(this._viewport,t.viewport)&&oI(this._padding,t.padding)&&VRe(this._nearFar,t.nearFar)&&this._fov===t.fov&&this._pixelRatio===t.pixelRatio&&this.relativeElevation===t.relativeElevation}almostEquals(t){if(this._pixelRatio!==t.pixelRatio||Math.abs(t.fov-this._fov)>=.001)return!1;const r=5e-4,i=1-1e-10;su(da,t.eye,t.center),su(b7,this.eye,this._center);const s=Te(da,b7),n=Jq(da),o=Jq(b7);return s*s>=i*n*o&&mee(t.eye,this.eye)<Math.max(n,o)*r*r&&CU(t.padding,this._padding)<.5&&CU(t.viewport,this._viewport)<.5}computeRenderPixelSizeAt(t){return this.computeRenderPixelSizeAtDist(this._viewDirectionDistance(t))}computeRenderPixelSizeAtDist(t){return t*this.perRenderPixelRatio}computeScreenPixelSizeAt(t){return this.computeScreenPixelSizeAtDist(this._viewDirectionDistance(t))}_viewDirectionDistance(t){return Math.abs(Q3(this.viewForward,pe(da,t,this.eye)))}computeScreenPixelSizeAtDist(t){return t*this.perScreenPixelRatio}computeDistanceFromRadius(t,r){return t/Math.tan(Math.min(this.fovX,this.fovY)/(2*(r||1)))}getScreenCenter(t=ts()){return t[0]=(this.padding[Ot.LEFT]+this.width/2)/this._pixelRatio,t[1]=(this.padding[Ot.TOP]+this.height/2)/this._pixelRatio,t}getRenderCenter(t,r=.5,i=.5){return t[0]=this.padding[Ot.LEFT]+this.width*r,t[1]=this.padding[Ot.BOTTOM]+this.height*i,t[2]=.5,t}setGLViewport(t){const r=this.viewport,i=this.padding;t.setViewport(r[0]-i[3],r[1]-i[2],r[2]+i[1]+i[3],r[3]+i[0]+i[2])}applyProjection(t,r){t!==Wt&&ae(Wt,t),Wt[3]=1,ih(Wt,Wt,this.projectionMatrix);const i=Math.abs(Wt[3]);le(Wt,Wt,1/i);const s=this.fullViewport;r[0]=Yt(0,s[0]+s[2],.5+.5*Wt[0]),r[1]=Yt(0,s[1]+s[3],.5+.5*Wt[1]),r[2]=.5*(Wt[2]+1),r[3]=i}unapplyProjection(t,r){const i=this.fullViewport;Wt[0]=(t[0]/(i[0]+i[2])*2-1)*t[3],Wt[1]=(t[1]/(i[1]+i[3])*2-1)*t[3],Wt[2]=(2*t[2]-1)*t[3],Wt[3]=t[3],ih(Wt,Wt,this.inverseProjectionMatrix),r[0]=Wt[0],r[1]=Wt[1],r[2]=Wt[2]}projectToScreen(t,r){this.projectToRenderScreen(t,w7),this.renderToScreen(w7,r)}projectToRenderScreen(t,r){if(Wt[0]=t[0],Wt[1]=t[1],Wt[2]=t[2],Wt[3]=1,ih(Wt,Wt,this.viewProjectionMatrix),Wt[3]===0)return null;le(Wt,Wt,1/Math.abs(Wt[3]));const i=this.fullViewport;return"x"in r?(r.x=Yt(0,i[0]+i[2],.5+.5*Wt[0]),r.y=Yt(0,i[1]+i[3],.5+.5*Wt[1])):(r[0]=Yt(0,i[0]+i[2],.5+.5*Wt[0]),r[1]=Yt(0,i[1]+i[3],.5+.5*Wt[1]),r.length>2&&(r[2]=.5*(Wt[2]+1))),r}unprojectFromScreen(t,r){return this.unprojectFromRenderScreen(this.screenToRender(t,w7),r)}unprojectFromRenderScreen(t,r){if(Yi(PN,this.projectionMatrix,this.viewMatrix),!Cs(PN,PN))return null;const i=this.fullViewport;return Wt[0]=2*(t[0]-i[0])/i[2]-1,Wt[1]=2*(t[1]-i[1])/i[3]-1,Wt[2]=2*t[2]-1,Wt[3]=1,ih(Wt,Wt,PN),Wt[3]===0?null:(r[0]=Wt[0]/Wt[3],r[1]=Wt[1]/Wt[3],r[2]=Wt[2]/Wt[3],r)}constrainWindowSize(t,r,i,s=i){const n=t*this._pixelRatio,o=r*this._pixelRatio,a=Math.max(n-i/2,0),l=Math.max(this.fullHeight-o-s/2,0),c=-Math.min(n-i/2,0),h=-Math.min(this.fullHeight-o-s/2,0);return[a,l,i-c- -Math.min(this.fullWidth-n-i/2,0),s-h- -Math.min(o-s/2,0)]}computeUp(t){t===Be.Global?this._computeUpGlobal():this._computeUpLocal()}screenToRender(t,r){const i=t[0]*this._pixelRatio,s=this.fullHeight-t[1]*this._pixelRatio;return r[0]=i,r[1]=s,r}renderToScreen(t,r){const i=t[0]/this._pixelRatio,s=(this.fullHeight-t[1])/this._pixelRatio;r[0]=i,r[1]=s}_computeUpGlobal(){pe(da,this.center,this.eye);const t=Re(this.center);t<1?(se(this._up,0,0,1),this._markViewDirty()):Math.abs(Te(da,this.center))>.9999*Re(da)*t||(ut(this._up,da,this.center),ut(this._up,this._up,da),we(this._up,this._up),this._markViewDirty())}_computeUpLocal(){S0(da,this.eye,this.center),Math.abs(da[2])<=.9999&&(le(da,da,da[2]),se(this._up,-da[0],-da[1],1-da[2]),we(this._up,this._up),this._markViewDirty())}_compareAndSetView(t,r){typeof t[0]=="number"&&isFinite(t[0])&&typeof t[1]=="number"&&isFinite(t[1])&&typeof t[2]=="number"&&isFinite(t[2])?Xl(t,r)||(ae(r,t),this._markViewDirty()):lut.warn("Camera vector contains invalid number, ignoring value")}_markViewDirty(){this._viewDirty=!0,this._frustumDirty=!0,this._viewProjectionDirty=!0}_recomputeFrustum(){this._frustumDirty&&(sMe(this.viewMatrix,this.projectionMatrix,this._frustum),this._frustumDirty=!1)}_ensureViewClean(){this._viewDirty&&(w6(this._viewMatrix,this.eye,this._center,this._up),se(this._viewForward,-this._viewMatrix[2],-this._viewMatrix[6],-this._viewMatrix[10]),se(this._viewUp,this._viewMatrix[1],this._viewMatrix[5],this._viewMatrix[9]),se(this._viewRight,this._viewMatrix[0],this._viewMatrix[4],this._viewMatrix[8]),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0)}}const Wt=Zt(),PN=Ce(),da=M(),b7=M(),w7=ea();var Ot;(function(e){e[e.TOP=0]="TOP",e[e.RIGHT=1]="RIGHT",e[e.BOTTOM=2]="BOTTOM",e[e.LEFT=3]="LEFT"})(Ot||(Ot={}));const LV={desiredScreenFlow:2,minDuration:500,maxDuration:8e3};class Hie{constructor(t){this.createCamera=t,this.compared={sourceZoom:0,targetZoom:0,pan:0,rotate:0},this.settings={desiredScreenFlow:LV.desiredScreenFlow},this.source=t(),this.target=t()}clone(){const t=new Hie(this.createCamera);return t.copyFrom(this),t}copyFrom(t){this.update(t.source,t.target,t.settings)}update(t,r,i){this.source!==t&&this.source.copyFrom(t),this.target!==r&&this.target.copyFrom(r),this.compared=this.source.compareTo(this.target,this.compared),this.settings.desiredScreenFlow=i.desiredScreenFlow!=null?i.desiredScreenFlow:LV.desiredScreenFlow,this.desiredPixelFlow=this.settings.desiredScreenFlow*this.target.size,this.halfWindowSize=this.target.size/2}halfWindowPanAtZoom(t){const r=this.target.pixelsPerPanAtZoom(t);return this.halfWindowSize/r}get hasZoom(){return Math.abs(this.compared.sourceZoom-this.compared.targetZoom)>1e-5}get hasPan(){return this.compared.pan>1e-9}get hasRotate(){return this.compared.rotate>1e-9}}class cut{constructor(){this.segments=[]}get time(){return this.segments.reduce((t,r)=>t+r.time,0)}interpolateComponentsAt(t,r){t=Math.min(Math.max(t,0),1),t*=this.time;let i=0,s=0;const n=this.definition;for(let o=0;o<this.segments.length;o++){const a=this.segments[o],l=a.definition;if(t<=a.time||o===this.segments.length-1){r=this.segmentInterpolateComponentsAt(a,t/a.time,r),n.hasPan?r.pan=(i+l.compared.pan*r.pan)/n.compared.pan:r.pan=1,n.hasRotate?r.rotate=(s+l.compared.rotate*r.rotate)/n.compared.rotate:r.rotate=1;const c=r.zoom*(l.compared.targetZoom-l.compared.sourceZoom)+l.compared.sourceZoom,h=this.segments[0].definition.compared.sourceZoom,p=this.segments[this.segments.length-1].definition.compared.targetZoom;return n.hasZoom?r.zoom=(c-h)/(p-h):r.zoom=1,r}t-=a.time,i+=l.compared.pan,s+=l.compared.rotate}}segmentInterpolateComponentsAt(t,r,i){return t.interpolateComponentsAt(r,i)}}class x7{constructor(t){t&&this.update(t)}get time(){return this._time}update(t){t&&(this.definition?this.definition.copyFrom(t):this.definition=t.clone()),this._updatePrecomputedVariables(),this._updatePixelFlow()}_updatePrecomputedVariables(){const t=this.definition,r=t.compared,i=r.sourceZoom,s=r.targetZoom;this._zoomSign=i>s?1:-1,this._panPixelsAtSource=r.pan*t.source.pixelsPerPanAtZoom(i);const n=(t.source.pixelsPerRotateAtZoom(i)+t.target.pixelsPerRotateAtZoom(s))/2;this._rotatePixels=r.rotate*n}_updatePixelFlow(){const t=this.definition.compared.sourceZoom,r=this.definition.compared.targetZoom,{hasZoom:i,hasPan:s,hasRotate:n}=this.definition;let o=0,a=0;i&&(s&&(o=(r/t-1)/(-1/(this._zoomSign*this.definition.halfWindowSize)*Math.LN2*this._panPixelsAtSource)),n&&(a=this._zoomSign*(Math.log(t/r)/Math.LN2)*this.definition.halfWindowSize/this._rotatePixels)),this._zoomPixelFlow=0,this._panPixelFlow=0,this._rotatePixelFlow=0;const l=this.definition.desiredPixelFlow;if(i&&s&&n){const c=o+a+o*a;this._zoomPixelFlow=o*a/c*l,this._panPixelFlow=a/c*l,this._rotatePixelFlow=o/c*l}else if(i&&s){const c=1+o;this._zoomPixelFlow=o/c*l,this._panPixelFlow=1/c*l}else if(i&&n){const c=1+a;this._zoomPixelFlow=a/c*l,this._rotatePixelFlow=1/c*l}else if(s&&n){const c=this._panPixelsAtSource/this._rotatePixels,h=1+c;this._panPixelFlow=c/h*l,this._rotatePixelFlow=1/h*l}else s?this._panPixelFlow=l:i?this._zoomPixelFlow=l:n&&(this._rotatePixelFlow=l);this._time=n?this.rotateTime:i?this.zoomTime:s?this.panTime:0}get rotateTime(){return this.definition.hasRotate?this._rotatePixels/this._rotatePixelFlow:0}get zoomTime(){return this.definition.hasZoom?this._zoomSign*(Math.log(this.definition.compared.sourceZoom/this.definition.compared.targetZoom)/Math.LN2)*this.definition.halfWindowSize/this._zoomPixelFlow:0}get panTime(){if(this.definition.hasPan){if(this.definition.hasZoom){const t=-1/(this._zoomSign*this.definition.halfWindowSize)*Math.LN2,r=t*this._panPixelsAtSource;return Math.log(r*(this._zoomPixelFlow/this._panPixelFlow)+1)/(t*this._zoomPixelFlow)}return this._panPixelsAtSource/this._panPixelFlow}return 0}_interpolateComponentsZoom(t){if(t===0||t===1)return t;if(this.definition.hasZoom){const r=this.definition.compared.sourceZoom,i=this.definition.compared.targetZoom;return(r*(r/i)**-t-r)/(i-r)}return t}_interpolateComponentsPan(t){if(t===0||t===1)return t;if(this.definition.hasPan&&this.definition.hasZoom){const r=-1/(this._zoomSign*this.definition.halfWindowSize)*this._zoomPixelFlow;return 1/this._panPixelsAtSource*(this._panPixelFlow*(2**(r*t*this._time)-1))/(r*Math.LN2)}return t}_interpolateComponentsRotate(t){return t}interpolateComponentsAt(t,r){t=Math.min(Math.max(t,0),1);const i=this._interpolateComponentsZoom(t),s=this._interpolateComponentsPan(t),n=this._interpolateComponentsRotate(t);return r?(r.zoom=i,r.pan=s,r.rotate=n):r={zoom:i,pan:s,rotate:n},r}}function uut(e,t,r){const i=t-e.compared.sourceZoom,s=e.halfWindowPanAtZoom(i);return-e.halfWindowSize*(r.ascensionFactor*Math.LN2*e.compared.pan+s)*Math.log(e.compared.sourceZoom/t)/(e.desiredPixelFlow*Math.LN2*s)}function hut(e,t,r){const i=1/t,s=Math.log(e.compared.sourceZoom*i),n=1/e.desiredPixelFlow,o=1/Math.LN2,a=t-e.compared.sourceZoom,l=1/a,c=(r.ascensionFactor*Math.LN2*e.compared.pan+e.halfWindowPanAtZoom(a))/e.halfWindowPanAtZoom(1);return e.halfWindowSize*i*n*o*l*c-e.halfWindowSize*s*n*o*l+e.halfWindowSize*s*n*o*c/(a*a)}function dut(e,t,r){const i=t-e.compared.sourceZoom,s=1/i,n=1/t,o=Math.log(e.compared.sourceZoom*n),a=(r.ascensionFactor*Math.LN2*e.compared.pan+e.halfWindowPanAtZoom(i))/e.halfWindowPanAtZoom(1);return e.halfWindowSize*s*(-2*s*n*a+2*s*o+2*n-2*o*a/(i*i)-a/(t*t))/(e.desiredPixelFlow*Math.LN2)}function put(e,t){return-e.halfWindowSize*Math.log(e.compared.sourceZoom/t)/(e.desiredPixelFlow*Math.LN2)}function fut(e,t){return e.halfWindowSize/(t*e.desiredPixelFlow*Math.LN2)}function mut(e,t){return-e.halfWindowSize/(t*t*e.desiredPixelFlow*Math.LN2)}function gut(e,t,r){return-e.compared.pan*e.halfWindowSize*(r.ascensionFactor+r.descensionFactor-1)/(e.desiredPixelFlow*e.halfWindowPanAtZoom(t))}function yut(e,t,r){return e.compared.pan*e.halfWindowSize*(r.ascensionFactor+r.descensionFactor-1)/(e.desiredPixelFlow*e.halfWindowPanAtZoom(t*t))}function vut(e,t,r){return-2*e.compared.pan*e.halfWindowSize*(r.ascensionFactor+r.descensionFactor-1)/(e.desiredPixelFlow*e.halfWindowPanAtZoom(t*t*t))}function _ut(e,t,r){return e.halfWindowSize*(-e.halfWindowPanAtZoom(t)-r.descensionFactor*Math.LN2*e.compared.pan+e.halfWindowPanAtZoom(e.compared.targetZoom))*Math.log(t/e.compared.targetZoom)/(e.desiredPixelFlow*Math.LN2*e.halfWindowPanAtZoom(-t+e.compared.targetZoom))}function but(e,t,r){const i=Math.log(t/e.compared.targetZoom),s=1/e.desiredPixelFlow,n=1/Math.LN2,o=-t+e.compared.targetZoom,a=1/o,l=(-e.halfWindowPanAtZoom(t)-r.descensionFactor*Math.LN2*e.compared.pan+e.halfWindowPanAtZoom(e.compared.targetZoom))/e.halfWindowPanAtZoom(1);return-e.halfWindowSize*i*s*n*a+e.halfWindowSize*i*s*n*l/(o*o)+e.halfWindowSize*s*n*a*l/t}function wut(e,t,r){const i=t-e.compared.targetZoom,s=1/i,n=1/t,o=Math.log(t/e.compared.targetZoom),a=(e.halfWindowPanAtZoom(t)+r.descensionFactor*Math.LN2*e.compared.pan-e.halfWindowPanAtZoom(e.compared.targetZoom))/e.halfWindowPanAtZoom(1);return e.halfWindowSize*s*(-2*s*n*a-2*s*o+2*n+2*o*a/(i*i)-a/(t*t))/(e.desiredPixelFlow*Math.LN2)}function xut(e,t){return e.halfWindowSize*Math.log(t/e.compared.targetZoom)/(e.desiredPixelFlow*Math.LN2)}function Tut(e,t){return e.halfWindowSize/(t*e.desiredPixelFlow*Math.LN2)}function Sut(e,t){return-e.halfWindowSize/(t*t*e.desiredPixelFlow*Math.LN2)}function Eut(e){const t=Math.LN2*e.compared.pan,r=e.compared.sourceZoom-e.compared.targetZoom,i=e.halfWindowPanAtZoom(r),s=e.halfWindowSize*Math.log(e.compared.sourceZoom/e.compared.targetZoom)/(e.desiredPixelFlow*Math.LN2*i);return e.compared.sourceZoom<=e.compared.targetZoom?s*(t-i):s*(t+i)}function Cut(e,t){let r=Aut(e,t);const i={ascensionFactor:t.ascensionFactor!=null?t.ascensionFactor:.5,descensionFactor:t.descensionFactor!=null?t.descensionFactor:.5},s=i.ascensionFactor===0,n=i.descensionFactor===0,o=s?put:uut,a=s?fut:hut,l=s?mut:dut,c=n?xut:_ut,h=n?Tut:but,p=n?Sut:wut,f=E=>o(e,E,i)+gut(e,E,i)+c(e,E,i),m=E=>a(e,E,i)+yut(e,E,i)+h(e,E,i),g=E=>l(e,E,i)+vut(e,E,i)+p(e,E,i);let v=f(r);const w=Eut(e);let _;const T=t.maximumIterations||20,x=t.maximumDistance!=null?t.maximumDistance:1/0;for(_=0;_<T;_++){const C=(m(r)+1e-6)/g(r);if(isNaN(C)||r>=x&&C<0){if(!isFinite(x))return null;r=x,v=f(r);break}if(r-=C,r<e.compared.sourceZoom||r<e.compared.targetZoom)return null;const A=f(r);if(Math.abs(A-v)/v<=.005)break;v=A}return v>w*(1-.3)||r<e.compared.sourceZoom||r<e.compared.targetZoom?null:r}function Aut(e,t){const r=Math.max(e.compared.sourceZoom,e.compared.targetZoom),i=e.source.zoomAtPixelsPerPan(e.desiredPixelFlow/e.compared.pan)/2;return i<r?t.maximumDistance!=null?r+(t.maximumDistance-r)/2:1.5*r:t.maximumDistance?Math.min(t.maximumDistance,i):i}class Rut extends cut{constructor(t,r){super(),this._preallocSegments=[new x7,new x7,new x7],this.update(t,r)}update(t,r){if(!t)return;this.definition?this.definition.copyFrom(t):this.definition=t.clone();let i=null;r&&r.apex&&(i=Cut(t,r.apex)),this.segments.length=0,this._ascensionSegment=null,this._descensionSegment=null,i==null?this._updateWithoutApex():this._updateWithApex(i,r.apex)}segmentInterpolateComponentsAt(t,r,i){return i=t.interpolateComponentsAt(r,i),t===this._ascensionSegment?i.zoom=Fie(i.zoom):t===this._descensionSegment&&(i.zoom=SB(i.zoom)),i}_updateWithApex(t,r){const[i,s,n]=this._preallocSegments,o=r.ascensionFactor!=null?r.ascensionFactor:.5,a=Math.min(1-o,r.ascensionFactor!=null?r.descensionFactor:.5),l=1-o-a;i.definition?i.definition.copyFrom(this.definition):i.definition=this.definition.clone(),i.definition.compared.targetZoom=t,i.definition.compared.pan=this.definition.compared.pan*o,i.definition.compared.rotate=this.definition.compared.rotate*o,i.update(),this._ascensionSegment=i,this.segments.push(i),l>0&&(s.definition?s.definition.copyFrom(this.definition):s.definition=this.definition.clone(),s.definition.copyFrom(this.definition),s.definition.compared.sourceZoom=t,s.definition.compared.targetZoom=t,s.definition.compared.pan=this.definition.compared.pan*l,s.definition.compared.rotate=this.definition.compared.rotate*l,s.update(),this.segments.push(s)),n.definition?n.definition.copyFrom(this.definition):n.definition=this.definition.clone(),n.definition.compared.sourceZoom=t,n.definition.compared.pan=this.definition.compared.pan*a,n.definition.compared.rotate=this.definition.compared.rotate*a,n.update(),this._descensionSegment=n,this.segments.push(n)}_updateWithoutApex(){const[t]=this._preallocSegments;t.update(this.definition),this.segments.push(t)}}const Out={zoom:0,pan:0,rotate:0};class Mut{constructor(t){this.createCamera=t,this._time=0,this.definition=new Hie(t),this.path=new Rut}get time(){return this._time}update(t,r,i){this.definition.update(t,r,i),this.path.update(this.definition,i),this._time=this._applyTimeSettings(b1e(this.path.time),i),this._easing=i.easing?i.easing:this._time>=1e3?tMe:bL}cameraAt(t,r){r=r||this.createCamera(),t=Math.min(Math.max(0,t),1),t=this._normalizedEasing(t);const i=this.path.interpolateComponentsAt(t,Out);return r.interpolate(this.definition.source,this.definition.target,i),r}_normalizedEasing(t){const r=this._easing(0,this._time),i=this._easing(1,this._time);return(this._easing(t,this._time)-r)/(i-r)}_applyTimeSettings(t,r){const i=r.speedFactor!=null?r.speedFactor:1;r.duration!=null?t=r.duration:r.speedFactor!=null&&(t=t/i);const s=r.minDuration!=null?r.minDuration:LV.minDuration/i,n=r.maxDuration!=null?r.maxDuration:LV.maxDuration/i;return Math.min(Math.max(s,t),n)}}const Put=M();class Iut{constructor(t){this.currentTime=0,this._animation=new Mut(()=>new spe(t)),this._current=new spe(t)}get finished(){return this.currentTime>=this._animation.time}get time(){return this._animation.time}update(t,r,i){const s=this._animation.definition.source,n=this._animation.definition.target,o=pe(Put,r.center,t.center),a=Re(o);a>=1e-5?(o[0]/=a,o[1]/=a,o[2]/=a):(o[0]=0,o[1]=1,o[0]=0),ae(s.lookAtDirection,o),ae(n.lookAtDirection,o),s.copyFromRenderCamera(t),n.copyFromRenderCamera(r),this._current.copyFrom(s),this._animation.update(s,n,i),this.currentTime=0,t.almostEquals(r)&&(this.currentTime=this._animation.time)}cameraAt(t,r){return this._animation.cameraAt(t,this._current),r=r||new ii,this._current.copyToRenderCamera(r),r}step(t,r){return this.finished||(this.currentTime=this.currentTime+b1e(t),this.currentTime>=this.time&&(this.currentTime=this.time)),this.cameraAt(this.currentTime/this.time,r)}}var ji;(function(e){e.Ready="ready",e.Rejected="rejected",e.Running="running",e.Stopped="stopped",e.Finished="finished"})(ji||(ji={}));let Sx=class extends xe{constructor(){super(...arguments),this.state=ji.Ready}get active(){return this.state===ji.Running}get isInteractive(){return!1}get canStop(){return!1}stopController(){return!!this.canStop&&(this.state=ji.Stopped,!0)}finishController(){this.state=ji.Finished}get steppingFinished(){return!1}};u([d({readOnly:!0})],Sx.prototype,"active",null),u([d()],Sx.prototype,"state",void 0),Sx=u([$("esri.views.3d.state.controllers.CameraController")],Sx);let t$=class extends Sx{get canStop(){return!0}set asyncResult(e){this._asyncResult&&(this._asyncResult.reject(gr()),this._asyncResult=null),this.state===ji.Finished||this.state===ji.Stopped?this.state===ji.Finished?e.resolve():e.reject(gr()):this._asyncResult=e}get asyncResult(){return this._asyncResult}onControllerStart(){this.state=ji.Running,b(this.viewAnimation)&&this.viewAnimation.when(()=>this.updateStateFromViewAnimation(),()=>this.updateStateFromViewAnimation())}updateStateFromViewAnimation(){!b(this.viewAnimation)||this.state!==ji.Ready&&this.state!==ji.Running||(this.viewAnimation.state===xA.State.FINISHED?this.finish():this.viewAnimation.state===xA.State.STOPPED&&(this.state=ji.Stopped))}onControllerEnd(){b(this.viewAnimation)&&!this.viewAnimation.done&&(this.state===ji.Finished?this.viewAnimation.finish():this.state===ji.Stopped&&this.viewAnimation.stop()),this._asyncResult&&(this.state===ji.Finished?this._asyncResult.resolve():this._asyncResult.reject(gr()))}finish(){this.finishController()}};t$=u([$("esri.views.3d.state.controllers.AnimationController")],t$);let Uy=class extends t${constructor(e){super(e),this.view=null,this.mode="interaction",this.hasTarget=!1}get intersectionHelper(){return this.view.sceneIntersectionHelper}initialize(){this.animation=new Iut(this.view.state.viewingMode),this.viewAnimation=this.mode==="interaction"?null:new xA}get isInteractive(){return this.mode==="interaction"}begin(e,t){this.hasTarget=!0;const r=this.animationSettings(t);IN.copyFrom(this.view.state.camera);const i=qd(this.view.state.viewingMode);this.intersectionHelper.intersectRay(IN.ray,i,npe)&&(IN.center=npe),this.animation.update(IN,e,r),this.animation.finished&&this.finish()}finish(){this.animation.currentTime=this.animation.time,super.finish()}get steppingFinished(){return this.hasTarget&&this.animation.finished}stepController(e,t){this.hasTarget&&this.animation.step(e,t)}onControllerEnd(e){this.hasTarget&&(this.animation.cameraAt(this.animation.currentTime/this.animation.time,e),this.animation.currentTime=this.animation.time),super.onControllerEnd(e)}animationSettings(e={}){return{apex:{maximumDistance:this.view.state.constraints.clampAltitude(1/0)/6,ascensionFactor:void 0,descensionFactor:void 0},...e,easing:typeof e.easing=="string"?Wct[e.easing]:e.easing}}};u([d({constructOnly:!0})],Uy.prototype,"view",void 0),u([d({constructOnly:!0})],Uy.prototype,"mode",void 0),Uy=u([$("esri.views.3d.state.controllers.PointToPointAnimationController")],Uy);const IN=new ii,npe=M();function cMe(e,t,r){return $ut(e,e.screenToRender(t,He.get()),r)}function $ut(e,t,r){const i=Do(He.get(),t);if(i[2]=0,!e.unprojectFromRenderScreen(i,r.origin))return null;const s=Do(He.get(),t);s[2]=1;const n=e.unprojectFromRenderScreen(s,He.get());return R(n)?null:(pe(r.direction,n,r.origin),r)}function OR(e,t,r){return qie(e,e.screenToRender(t,He.get()),r)}function qie(e,t,r){ae(r.origin,e.eye);const i=se(He.get(),t[0],t[1],1),s=e.unprojectFromRenderScreen(i,He.get());return R(s)?null:(pe(r.direction,s,r.origin),r)}function Wie(e,t,r,i){const s=OR(t,r,Lut);return Y1(e,s,i)}const Lut=Ro();var FA;(function(e){e[e.Ellipsoid=0]="Ellipsoid",e[e.Silhouette=1]="Silhouette"})(FA||(FA={}));const uMe=30,DV=[1,3e8],hMe=70;function qx(e,t,r){return r[0]=t[0]/(e.fullWidth/e.pixelRatio),r[1]=t[1]/(e.fullHeight/e.pixelRatio),r}function bQ(e){for(;e>Math.PI;)e-=2*Math.PI;for(;e<-Math.PI;)e+=2*Math.PI;return e}function V1(e,t,r){const i=_h(fte.get(),r[3],r);R(i)||(pe(Wr,e.eye,t),Ve(Wr,Wr,i),e.eye=de(Wr,Wr,t),pe(Wr,e.center,t),Ve(Wr,Wr,i),e.center=de(Wr,Wr,t),e.up=Ve(Wr,e.up,i))}function Dut(e,t,r,i){return JT(e,cMe(t,r,Yie),i)}function wQ(e,t,r,i){return JT(e,OR(t,r,Yie),i)}function Xie(e,t,r,i){const s=He.get();let n=1-r;pe(s,t,e.eye);const o=Re(s);let a=o*(1-n);n>=0&&a<i&&(a=i,n=-(a-o)/o),Math.abs(o-a)<1e-6||(le(s,s,n),e.eye=de(Wr,e.eye,s),e.center=En(Wr,e.center,t,n))}function dMe(e,t,r){t.getScreenCenter(ope),Wie(e,t,ope,Wr)&&(t.center=Wr);const i=t.distance,s=i*r;if(Math.abs(i-s)<1e-6)return;const n=le(He.get(),t.viewForward,s);t.eye=pe(Wr,t.center,n)}const ope=ts();function T7(e,t){se(t,0,0,0);for(const r of e)de(t,t,r);le(t,t,1/e.length)}function Z5(e,t,r,i){return Math.sin(e/Re(t))*(r+i.radius)}function ape(e,t,r,i){return Z5(Math.PI/2,t,r,i)+(e-Math.PI/2)}var Oo;(function(e){e[e.Vertical=0]="Vertical",e[e.Horizontal=1]="Horizontal"})(Oo||(Oo={}));const lpe={Elevation:3e4,Angle:Ft(6)},pP={Pole:.95,Angle:Ft(18),Tilt:45},pMe=Ft(80);function fMe(e,t,r,i,s,n){const o=M(),a=kn();let l=!0,c=!0;return e.intersectScreen(r,o,n)?a[3]=Re(o):(c=!1,t.aboveGround&&s!==FA.Ellipsoid?a[3]=Math.max(Re(t.center),.9*i.radius):a[3]=Re(t.eye)-t.relativeElevation,s===FA.Silhouette?r$(a,t,r,o):l=Wie(a,t,r,o)),{sphere:a,scenePickPoint:l?o:null,hasGeometryIntersection:c}}function EB(e,t,r,i){return Re(e.eye)-i.radius>lpe.Elevation?Oo.Horizontal:r?(OR(e,t,gpe),-Math.sign(e.relativeElevation)*(.5*Math.PI+gte(e.eye,gpe.direction))<lpe.Angle?Oo.Vertical:Oo.Horizontal):Oo.Vertical}function mMe(e,t,r){pe(S7,r,t),e.eye=pe(Wr,e.eye,S7),e.center=pe(Wr,e.center,S7)}const S7=M();function r$(e,t,r,i){const s=OR(t,r,Yie);return!R(s)&&(dR(e,s,$N),Y1(e,s,i)?!(Fn($N,s.origin)<Fn(i,s.origin))||(ae(i,$N),!1):(pe(CS,t.eye,t.center),we(CS,CS),YTe(CS,-Te(we(CS,CS),$N),cpe),JT(cpe,s,i),!1))}const $N=M(),CS=M(),cpe=Er();function gMe(e,t,r,i,s,n){let o;if(ut(kV,e,t),pe(FN,e,t),Re(e)<=s||!i.aboveGround){ut(r,FN,i.eye);const a=Te(e,t)/(Re(e)*Re(t)),l=Math.cos(Le(A1.normalize(Ft(n)),0,pMe));o=-Cn(a)-Math.max(0,Re(t)-s)/(l*s)}else pe(upe,i.eye,i.center),ut(r,FN,upe),o=-Re(FN)/s;return we(r,r),le(r,r,Re(kV)),o}const upe=M();function hpe(e,t,r,i){let s,n;const o=Math.cos(Le(A1.normalize(Ft(i)),0,pMe));return s=t>r?-(t-r)/(o*r):t<-r?Math.PI-(t+r)/(o*r):Cn(t/r),n=e>r?-(e-r)/(o*r):e<-r?Math.PI-(e+r)/(o*r):Cn(e/r),(n-s)*r}function Nut(e,t,r,i,s,n,o,a,l,c){const h=hpe(e[2],t[2],o[3],l),p=c?hpe(e[0],t[0],o[3],180):t[0]-e[0],f=Math.sin(a)*p-Math.cos(a)*h,m=Math.cos(a)*p+Math.sin(a)*h;we(Wr,s);const g=c?f/Math.sqrt(Math.abs(o[3]**2-Te(r,Wr)**2)):f/o[3],v=m/Math.sqrt(Math.abs(o[3]**2-Te(r,i)**2));vr(n,g,v)}function yMe(e,t,r,i,s,n,o,a,l,c){ut(kV,e,t),UX(n.up,n.eye,LN,DN,NN),UX([0,0,1],n.eye,Yy,g1,wMe),ae(r,g1),ae(i,Yy),we(r,r),le(r,r,Re(kV)),Ple(e,we(DN,DN),we(NN,NN),we(LN,LN),dpe),Ple(t,DN,NN,LN,ppe),Nut(dpe,ppe,e,Yy,g1,s,o,a,l,c)}function Fut(e,t,r,i,s,n,o){_h(NV,s,i),_h(FV,o,n),Yi(UE,NV,FV),pe(t,e,r),Ve(t,t,UE),de(t,t,r)}function vMe(e,t,r,i,s,n){_h(NV,i,r),_h(FV,n,s),Yi(UE,NV,FV),pe(Wr,e.eye,t),Ve(Wr,Wr,UE),e.eye=de(Wr,Wr,t),pe(Wr,e.center,t),Ve(Wr,Wr,UE),e.center=de(Wr,Wr,t),pe(Wr,e.up,t),Ve(Wr,Wr,UE),e.up=de(Wr,Wr,t)}function Zie(e,t,r,i,s,n,o=pP.Pole,a=pP.Angle){const l=Math.abs(i)>Math.PI-a||Math.abs(i)<a,c=Math.abs(e[2])<r*o||Math.abs(t)>r;return!!(l&&c&&n.aboveGround&&s<pP.Tilt)}function _Me(e,t,r,i,s,n){if(n)FI(r,i,fpe),V1(t,e,fpe);else{const o=gMe(r,i,mpe,t,e[3],s);V1(t,e,NI(mpe,o))}}function bMe(e,t,r,i,s,n,o){const a=o?20:1,l=1e-12;let c,h;ae(_b,i),kN.copyFrom(t);for(let p=0;p<a&&Fn(r,_b)>l&&(c=Fn(r,_b),yMe(r,_b,g1,Yy,yO,kN,e,s,n,o),vMe(kN,e,Yy,yO[1],g1,yO[0]),Fut(_b,_b,e,Yy,yO[1],g1,yO[0]),h=Fn(r,_b),h<c||p===0);p++)t.copyFrom(kN)}function kut(e,t,r,i,s,n,o){Zie(r,Te(t.up,r),e[3],-A1.normalize(Ft(s)),n,t,pP.Pole,pP.Angle)?bMe(e,t,r,i,-A1.normalize(Ft(s)),n,o):_Me(e,t,r,i,n,o)}function Uut(e,t,r,i,s,n){const{eye:o}=e;UX([0,0,1],o,Yy,g1,wMe);const a=t.translation[0]*r.pan,l=s.mode==="zoom"?0:t.translation[1]*r.pan,c=Math.max(Math.sqrt(Math.abs(1-Te(e.center,Yy)**2/Re(e.center)**2)),.5),h=(Math.sin(n)*l+Math.cos(n)*a)/c,p=-Math.cos(n)*l+Math.sin(n)*a;switch(qc(i.pan.matrix,i.pan.matrix,h,Yy),i.pan.enabled=!0,s.mode){case"pan":qc(i.pan.matrix,i.pan.matrix,p,g1),i.pan.enabled=!0;break;case"zoom":i.zoom=-t.translation[1]*r.zoom}}function Vut(e,t,r,i,s){const{eye:n,viewRight:o}=e,a=ut(He.get(),o,n),l=t.translation[0]*r.pan;switch(l!==0&&(qc(i.pan.matrix,i.pan.matrix,-l,a),i.pan.enabled=!0),s.mode){case"pan":{const c=t.translation[1]*r.pan;c!==0&&(qc(i.pan.matrix,i.pan.matrix,c,o),i.pan.enabled=!0);break}case"zoom":i.zoom=-t.translation[1]*r.zoom}}function zut(e,t,r,i,s,n,o,a,l){Zie(e.center,Te(e.up,e.center),Re(e.center),-A1.normalize(Ft(n)),o,t)?Uut(t,r,i,a,l,-A1.normalize(Ft(s))):Vut(t,r,i,a,l)}const Yy=M(),g1=M(),wMe=M(),LN=M(),DN=M(),NN=M(),dpe=M(),ppe=M(),yO=rt(),fpe=CR(),NV=Ce(),FV=Ce(),UE=Ce(),_b=M(),Wr=M(),FN=M(),kN=new ii,kV=M(),mpe=M(),Yie={origin:M(),direction:M()},gpe={origin:M(),direction:M()},ype=.6,E7=4,But=12,Gut=60,jut=200;let UV=class extends Uy{constructor(){super(...arguments),this.zoomLocation=M(),this.tmpCamera=new ii,this.tmpViewDir=M(),this.tmpRayDir={origin:M(),direction:M()},this.targetOnSphere=M(),this.tmpCenter=M(),this.constraintOptions={selection:Ti.ALL_EXCEPT_COLLISION,interactionType:jt.ZOOM,interactionFactor:null,interactionStartCamera:new ii,interactionDirection:null,tiltMode:io.TUMBLE},this.sphere=kn()}initialize(){this.intersector=qd(this.view.state.viewingMode)}zoomStep(e,t){if(!this.active)return;const r=this.view.state,{interactionStartCamera:i}=this.constraintOptions;this.animation.finished?i.copyFrom(r.camera):this.animation.cameraAt(1,i);let s=!1,n=!1;this.intersectionHelper.intersectScreen(t,this.zoomLocation,this.view.map.ground.opacity===0?Hut:{})&&(s=e>0,n=!0),this.tmpCamera.copyFrom(r.camera),s?this.intersectionHelper.intersectRay(this.tmpCamera.ray,this.intersector,this.tmpCenter)&&(this.tmpCamera.center=this.tmpCenter):this.intersectionHelper.intersectRay(this.tmpCamera.ray,this.intersector,this.zoomLocation)?this.tmpCamera.center=this.zoomLocation:ae(this.zoomLocation,this.tmpCamera.center),this._updateCamera(this.tmpCamera,e,this.zoomLocation,t,n),this.begin(this.tmpCamera)}animationSettings(){return{apex:null,duration:600,easing:bL}}_updateCamera(e,t,r,i,s){const n=Ar(this.view.spatialReference),o=EB(e,i,s,n);let a;this.view.camera.position.hasZ&&(a=Math.abs(this.view.camera.position.z)),we(VN,e.eye),le(VN,VN,-1),OR(e,i,this.tmpRayDir),we(this.tmpRayDir.direction,this.tmpRayDir.direction);const l=Math.max(Math.min(But,1/Math.abs(Te(VN,this.tmpRayDir.direction)))*a,jut);if(o===Oo.Horizontal){let c=ype**t;this.sphere[3]=Re(r),pe(this.tmpViewDir,e.center,e.eye);const h=Math.min(Re(this.tmpViewDir),l);let p=h*c;if(c<=1&&p<E7&&(p=E7,c=p/h),Math.abs(h-p)<1e-6)return;const f=Re(e.center);if(this.sphere[3]!==f){const m=this.sphere[3]+c*(f-this.sphere[3]);e.center=le(UN,e.center,m/f)}le(this.tmpViewDir,this.tmpViewDir,-c),e.eye=de(UN,e.center,this.tmpViewDir),Ts(this.view,e,this.constraintOptions),Fn(r,e.center)>1e-12&&Wie(this.sphere,e,i,this.targetOnSphere)&&kut(this.sphere,e,r,this.targetOnSphere,this.view.camera.heading,this.view.camera.tilt,!0)}else{let c=ype**Math.abs(t);const h=t>0?1:-1;pe(this.tmpViewDir,r,e.eye);const p=Re(this.tmpViewDir),f=this.view._stage.renderView.getMinimalDepthForArea(null,i[0],i[1],this.view.state.camera,Gut);let m=f?Math.min(l,f):l;m=s?Math.min(m,p):m,le(this.tmpRayDir.direction,this.tmpRayDir.direction,m),de(r,this.tmpRayDir.origin,this.tmpRayDir.direction);let g=m*c;const v=Math.max(E7,1.01*e.nearFar[0]);if(t>0&&g<v&&(g=v,c=g/m),Math.abs(m-g)<1e-6)return;le(this.tmpRayDir.direction,this.tmpRayDir.direction,h*(1-c)),e.eye=de(UN,e.eye,this.tmpRayDir.direction),e.center=de(UN,e.center,this.tmpRayDir.direction)}RR(this.view,e)}};UV=u([$("esri.views.3d.state.controllers.global.ZoomStepController")],UV);const UN=M(),VN=M(),Hut={exclude:new Set([Yp])},qut=.6,Wut=4,Xut=60,Zut=14,Yut=200;let VV=class extends Uy{constructor(){super(...arguments),this.zoomLocation=M(),this.tmpCamera=new ii,this.tmpRayDir=M(),this.tmpCenter=M(),this.constraintOptions={selection:Ti.ALL,interactionType:jt.ZOOM,interactionFactor:null,interactionStartCamera:new ii,interactionDirection:null,tiltMode:io.TUMBLE}}zoomStep(e,t){if(!this.active)return;const r=this.view.state,{interactionStartCamera:i}=this.constraintOptions;this.animation.finished?i.copyFrom(r.camera):this.animation.cameraAt(1,i),this.tmpCamera.copyFrom(r.camera);const s=qd(this.view.state.viewingMode);e>0?(this.view.map.ground.opacity===0?this.intersectionHelper.intersectScreenFreePointFallback(t,this.zoomLocation,Jut):this.intersectionHelper.intersectScreenFreePointFallback(t,this.zoomLocation),this.intersectionHelper.intersectRay(this.tmpCamera.ray,s,this.tmpCenter)&&(this.tmpCamera.center=this.tmpCenter)):this.intersectionHelper.intersectRay(this.tmpCamera.ray,s,this.zoomLocation)?this.tmpCamera.center=this.zoomLocation:ae(this.zoomLocation,this.tmpCamera.center);const n=qut**e;let o=this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm,t[0],t[1],this.view.state.camera,Xut);pe(zN,this.tmpCamera.eye,this.zoomLocation),we(zN,zN);const a=Math.max(Math.min(Zut,1/Math.abs(Te(Qut,zN)))*Math.abs(this.view.camera.position.z),Yut);if(o=o?Math.min(o,a):a,o){const l=M();pe(l,this.zoomLocation,this.tmpCamera.eye),o<Re(l)&&(we(l,l),de(this.zoomLocation,this.tmpCamera.eye,le(l,l,o)))}this._updateCamera(this.tmpCamera,n,this.zoomLocation),this.begin(this.tmpCamera)}animationSettings(){return{apex:null,duration:600,easing:bL}}_updateCamera(e,t,r){pe(this.tmpRayDir,r,e.eye);const i=Re(this.tmpRayDir);let s=i*t;const n=t<=1,o=Math.max(Wut,1.01*e.nearFar[0]);n&&s<o&&(s=o,t=s/i),Math.abs(i-s)<1e-6||(le(this.tmpRayDir,this.tmpRayDir,t),e.eye=pe(vpe,r,this.tmpRayDir),e.center=En(vpe,e.center,r,1-t),Ts(this.view,e,this.constraintOptions))}};VV=u([$("esri.views.3d.state.controllers.local.ZoomStepController")],VV);const vpe=M(),Qut=Ue(0,0,1),zN=M(),Jut={exclude:new Set([Yp])};function Kut(e,t){switch(t){case"primary":return e.pointerType==="touch"||e.button===0;case"secondary":return e.pointerType!=="touch"&&e.button===2;case"tertiary":return e.pointerType!=="touch"&&e.button===1}}function Qie(e,t){if(e.pointerType==="touch")return!1;switch(t){case"primary":return e.button===0;case"secondary":return e.button===2;case"tertiary":return e.button===1}}class eht extends aa{constructor(t,r){super(!0),this.view=t,this.registerIncoming("double-click",r,i=>this._handleDoubleClick(i))}_handleDoubleClick(t){const r=t.data;if(Kut(r,"primary")){const i=this.view.state.isGlobal?new UV({view:this.view,mode:"animation"}):new VV({view:this.view,mode:"animation"});this.view.state.switchCameraController(i),i.zoomStep(Math.log(.5)/Math.log(.6),ts(r.x,r.y)),t.stopPropagation()}}}let z1=class extends Sx{constructor(){super(...arguments),this.startCamera=new ii,this.currentCamera=new ii}get isInteractive(){return!0}stepController(e,t){t.copyViewFrom(this.currentCamera),this.currentCamera.copyFrom(t)}onControllerStart(e){this.state=ji.Running,this.startCamera.copyFrom(e),this.currentCamera.copyFrom(e)}onControllerEnd(e){e.copyViewFrom(this.currentCamera)}};z1=u([$("esri.views.3d.state.controllers.InteractiveController")],z1);var Lc;(function(e){e[e.CENTER=0]="CENTER",e[e.EYE=1]="EYE"})(Lc||(Lc={}));const tht=7,C7=90;let VE=class extends z1{constructor(e){super(e),this.view=null,this.pivot=Lc.CENTER,this.lastPoint=rt(),this.tmpWorldUp=M(),this.tmpViewDir=M(),this.tmpRotCurPoint=rt(),this.tmpTransf=Ce(),this.tmpAxis=M(),this.tmpPivotPoint=M(),this.pivotPos=M(),this.constraintOptions={selection:Ti.ALL,interactionType:jt.TUMBLE,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:io.TUMBLE}}get intersectionHelper(){return this.view.sceneIntersectionHelper}initialize(){this.rotScale=this.pivot===Lc.CENTER?3:1.5}begin(e){if(this.active){switch(this.pivot){case Lc.EYE:ae(this.pivotPos,this.startCamera.eye),this.constraintOptions.interactionType=jt.LOOK_AROUND,this.constraintOptions.tiltMode=io.LOOK_AROUND,this.constraintOptions.selection=Ti.NONE;break;case Lc.CENTER:{const t=this.intersectionHelper.intersectRayFreePointFallback(this.startCamera.ray,this.pivotPos);t||ae(this.pivotPos,this.startCamera.center),this._constrainPivotPoint(e,t),this.startCamera.center=this.pivotPos,this.constraintOptions.interactionType=jt.TUMBLE,this.constraintOptions.tiltMode=io.TUMBLE,this.constraintOptions.selection=Ti.ALL&~Ti.DISTANCE;break}}this.constraintOptions.interactionStartCamera=this.startCamera,qx(this.startCamera,e,this.lastPoint)}}_constrainPivotPoint(e,t){const r=this.startCamera,i=M();pe(i,this.pivotPos,r.eye);const s=Re(i);let n=Math.min(s,tht*Math.abs(this.view.camera.position.z));const o=Ar(this.view.spatialReference),a=ts(r.width/r.pixelRatio*.5,r.height/r.pixelRatio*.5),l=EB(this.startCamera,a,!0,o);let c=this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm,r.fullWidth/r.pixelRatio*.5,r.fullHeight/r.pixelRatio*.5,r,2.5*C7,C7),h=this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm,e[0],e[1],r,C7);c===void 0&&h===void 0||(c=c===void 0?h:c,h=h===void 0||l===Oo.Horizontal?c:h,n=c>h?h:c,n=t?Math.min(n,s):n),we(i,i),ae(this.pivotPos,de(this.tmpPivotPoint,r.eye,le(this.tmpPivotPoint,i,n)))}update(e){if(this.active){switch(this.pivot){case Lc.EYE:this.currentCamera.center=this._applyRotation(this.currentCamera,e,this.currentCamera.center,this.pivotPos);break;case Lc.CENTER:this.currentCamera.center=this.pivotPos,this.currentCamera.eye=this._applyRotation(this.currentCamera,e,this.currentCamera.eye,this.pivotPos)}Ts(this.view,this.currentCamera,this.constraintOptions)}}end(){this.active&&this.finishController()}_applyRotation(e,t,r,i){this.view.renderCoordsHelper.worldUpAtPosition(i,this.tmpWorldUp),qx(e,t,this.tmpRotCurPoint);let s=(this.lastPoint[1]-this.tmpRotCurPoint[1])*this.rotScale,n=(this.tmpRotCurPoint[0]-this.lastPoint[0])*this.rotScale;pe(this.tmpViewDir,r,i);const o=Re(this.tmpViewDir),a=Cn(Te(this.tmpViewDir,this.tmpWorldUp)/o);if(this.pivot===Lc.EYE){s*=-.5;const l=.5*Math.PI-a,c=.5*Math.PI*.99;s=l-Math.max(-c,Math.min(c,l+s))}return s=Le(s+a,Qo.min,Qo.max)-a,ut(this.tmpAxis,e.up,this.tmpViewDir),this.pivot===Lc.CENTER&&(n=-n),_h(this.tmpTransf,n,this.tmpWorldUp),qc(this.tmpTransf,this.tmpTransf,s,this.tmpAxis),Ve(this.tmpViewDir,this.tmpViewDir,this.tmpTransf),e.up=Ve(A7,e.up,this.tmpTransf),de(A7,i,this.tmpViewDir),Do(this.lastPoint,this.tmpRotCurPoint),A7}};u([d({constructOnly:!0})],VE.prototype,"view",void 0),u([d()],VE.prototype,"pivot",void 0),VE=u([$("esri.views.3d.state.controllers.RotateController")],VE);const A7=M();class R7 extends aa{constructor(t,r,i,s){super(!0),this.view=t,this.pointerAction=r,this.pivot=i,this.registerIncoming("drag",s,n=>this._handleDrag(n))}_handleDrag(t){const r=t.data;if(r.pointers.size>1||!Qie(t.data,this.pointerAction))return;const i=ts(r.center.x,r.center.y);switch(r.action){case"start":this.cameraController&&(this.cameraController.end(),this.cameraController=null),this.cameraController=new VE({view:this.view,pivot:this.pivot}),this.view.state.switchCameraController(this.cameraController),this.cameraController.begin(i);break;case"update":this.cameraController&&this.cameraController.update(i);break;case"end":this.cameraController&&(this.cameraController.end(),this.cameraController=null)}t.stopPropagation()}}let Y5=class extends z1{constructor(e){super(e),this.view=null,this.pickPoint=M(),this.tmpP0=rt(),this.panAxisAngle=CR(),this.tmpRayDir=M(),this.tmpRayDirPick=M(),this.targetOnSphere=M(),this.tmpRay={origin:M(),direction:M()},this.dragBeginPoint=ts(),this.normalizedAnchorPoint=rt(),this.constraintOptions={selection:Ti.ALL_EXCEPT_COLLISION,interactionType:jt.ZOOM,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:io.TUMBLE},this.sphere=kn(),this.hasPickPoint=!1}get intersectionHelper(){return this.view.sceneIntersectionHelper}begin(e){if(!this.active)return;Do(this.dragBeginPoint,e),qx(this.startCamera,e,this.normalizedAnchorPoint);const t=Ar(this.view.spatialReference),r=fMe(this.intersectionHelper,this.startCamera,e,t,FA.Ellipsoid,this.view.map.ground.opacity===0?rht:{});if(this.navMode=EB(this.startCamera,e,r.hasGeometryIntersection,t),this.navMode===Oo.Horizontal)this.hasPickPoint=!!r.scenePickPoint,this.pickPoint=r.scenePickPoint,this.sphere=r.sphere;else{let i,s;OR(this.startCamera,e,this.tmpRay),we(this.tmpRay.direction,this.tmpRay.direction),r.scenePickPoint&&(pe(this.tmpRayDirPick,this.startCamera.eye,r.scenePickPoint),s=Re(this.tmpRayDirPick)),this.view.camera.position.hasZ&&(i=Math.abs(this.view.camera.position.z));let n=Le(uMe*i,DV[0],DV[1]);const o=this.view._stage.renderView.getMinimalDepthForArea(null,e[0],e[1],this.view.state.camera,hMe);n=o?Math.min(n,o):n,n=r.scenePickPoint?Math.min(n,s):n,this.hasPickPoint=!0,le(this.tmpRay.direction,this.tmpRay.direction,n),de(this.pickPoint,this.tmpRay.origin,this.tmpRay.direction)}this.constraintOptions.interactionStartCamera=this.startCamera}update(e){if(this.active){if(this.currentCamera.eye=this.startCamera.eye,this.currentCamera.center=this.startCamera.center,this.currentCamera.up=this.startCamera.up,this.navMode===Oo.Horizontal){pe(this.tmpRayDir,this.currentCamera.center,this.currentCamera.eye);const t=Re(this.tmpRayDir);qx(this.currentCamera,e,this.tmpP0);const r=12*(this.normalizedAnchorPoint[1]-this.tmpP0[1]);let i=t*2**r;const s=this.view.state.constraints.minimumPoiDistance;if(r<0&&i<s&&(i=s),Math.abs(t-i)<1e-6)return;if(this.hasPickPoint&&i<t){const n=1-(1-i/t)*(1-this.sphere[3]/Re(this.currentCamera.center));this.currentCamera.center=le(BN,this.currentCamera.center,n)}le(this.tmpRayDir,this.tmpRayDir,-i/t),this.currentCamera.eye=de(BN,this.currentCamera.center,this.tmpRayDir),this.constraintOptions.interactionFactor=Wp(this.dragBeginPoint,e),Ts(this.view,this.currentCamera,this.constraintOptions),this.hasPickPoint&&(r$(this.sphere,this.currentCamera,this.dragBeginPoint,this.targetOnSphere),FI(this.pickPoint,this.targetOnSphere,this.panAxisAngle),V1(this.currentCamera,this.sphere,this.panAxisAngle))}else{const t=Re(this.tmpRay.direction);qx(this.currentCamera,e,this.tmpP0);const r=12*(this.normalizedAnchorPoint[1]-this.tmpP0[1]);let i=t*2**r;const s=this.view.state.constraints.minimumPoiDistance;if(r<0&&i<s&&(i=s),Math.abs(t-i)<1e-6)return;le(this.tmpRayDir,this.tmpRay.direction,1-i/t),this.currentCamera.eye=de(BN,this.currentCamera.eye,this.tmpRayDir),this.currentCamera.center=de(BN,this.currentCamera.center,this.tmpRayDir)}RR(this.view,this.currentCamera)}}end(){this.active&&this.finishController()}};u([d({constructOnly:!0})],Y5.prototype,"view",void 0),Y5=u([$("esri.views.3d.state.controllers.global.ZoomController")],Y5);const BN=M(),rht={exclude:new Set([Yp])};let Q5=class extends z1{constructor(e){super(e),this.view=null,this.tmpP=M(),this.tmpDir=M(),this.tmpN=M(),this.tmpP0=rt(),this.tmpPoi=M(),this.tmpRayDir=M(),this.dragBeginPoint=ts(),this.normalizedAnchorPoint=rt(),this.constraintOptions={selection:Ti.ALL,interactionType:jt.ZOOM,interactionFactor:0,interactionStartCamera:null,interactionDirection:M(),tiltMode:io.TUMBLE},this.plane=Er()}get intersectionHelper(){return this.view.sceneIntersectionHelper}begin(e){if(!this.active)return;Do(this.dragBeginPoint,e),qx(this.startCamera,e,this.normalizedAnchorPoint);const t=this.intersectionHelper.intersectScreenFreePointFallback(e,this.tmpP,this.view.map.ground.opacity===0?iht:{});pe(this.tmpDir,this.tmpP,this.startCamera.eye);const r=Re(this.tmpDir);let i;we(this.tmpDir,this.tmpDir),this.view.camera.position.hasZ&&(i=Math.abs(this.view.camera.position.z));let s=Le(uMe*i,DV[0],DV[1]);const n=this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm,e[0],e[1],this.view.state.camera,hMe);s=n?Math.min(s,n):s,s=t?Math.min(s,r):s,le(this.tmpDir,this.tmpDir,s),de(this.tmpP,this.startCamera.eye,this.tmpDir),pe(this.tmpN,this.startCamera.eye,this.startCamera.center),we(this.tmpN,this.tmpN),this.tmpN[1]<0&&Ra(this.tmpN,this.tmpN),pA(this.tmpP,this.tmpN,this.plane),this.constraintOptions.interactionStartCamera=this.startCamera}update(e){if(!this.active)return;Dut(this.plane,this.currentCamera,this.dragBeginPoint,this.tmpPoi)||ae(this.tmpPoi,this.currentCamera.center),qx(this.currentCamera,e,this.tmpP0);let t=4*(this.tmpP0[1]-this.normalizedAnchorPoint[1]);Do(this.normalizedAnchorPoint,this.tmpP0),pe(this.tmpRayDir,this.tmpPoi,this.currentCamera.eye);const r=Re(this.tmpRayDir);let i=r*(1-t);ae(this.constraintOptions.interactionDirection,this.tmpRayDir),le(this.constraintOptions.interactionDirection,this.constraintOptions.interactionDirection,Math.sign(t)/r);const s=this.view.state.constraints.minimumPoiDistance;t>=0&&i<s&&(i=s,t=-(i-r)/r),Math.abs(r-i)<1e-6||(le(this.tmpRayDir,this.tmpRayDir,t),this.currentCamera.eye=de(bb,this.currentCamera.eye,this.tmpRayDir),En(bb,this.currentCamera.center,this.tmpPoi,t),this.tmpPoi[2]>this.startCamera.center[2]?bb[2]=Math.max(this.startCamera.center[2],bb[2]):bb[2]=Math.min(this.startCamera.center[2],bb[2]),this.currentCamera.center=bb,this.constraintOptions.interactionFactor=Wp(this.dragBeginPoint,e),Ts(this.view,this.currentCamera,this.constraintOptions))}end(){this.active&&this.finishController()}};u([d({constructOnly:!0})],Q5.prototype,"view",void 0),Q5=u([$("esri.views.3d.state.controllers.local.ZoomController")],Q5);const bb=M(),iht={exclude:new Set([Yp])};class sht extends aa{constructor(t,r,i){super(!0),this.view=t,this.pointerAction=r,this.registerIncoming("drag",i,s=>this._handleDrag(s))}_handleDrag(t){const r=t.data;if(r.pointers.size>1||!Qie(t.data,this.pointerAction))return;const i=ts(r.center.x,r.center.y);switch(r.action){case"start":this.cameraController&&(this.cameraController.end(),this.cameraController=null),this.view.state.isGlobal?this.cameraController=new Y5({view:this.view}):this.cameraController=new Q5({view:this.view}),this.view.state.switchCameraController(this.cameraController),this.cameraController.begin(i);break;case"update":this.cameraController&&this.cameraController.update(i);break;case"end":this.cameraController&&(this.cameraController.end(),this.cameraController=null)}t.stopPropagation()}}const nht=M(),GN=M();function Jie(){return{direction:M(),up:M()}}function xMe(e,t,r,i,s){let n=we(nht,e),o=Te(n,i);const a=o>0;o=Math.abs(o),o>.99&&(o=Math.abs(Te(t,i)),o<.99?(ae(n,t),a&&le(n,n,-1)):n=null);let l=0;if(n){le(GN,i,Te(i,n)),pe(n,n,GN);const h=Te(n,s)/(Re(n)*Re(s));ut(GN,n,s),l=(Te(GN,i)>0?1:-1)*nu(Cn(h))}const c=nu(Cn(-Te(i,e)/Re(e)));return r?(r.heading=l,r.tilt=c,r):{heading:l,tilt:c}}const TMe=Ue(0,1,0),SMe=Ue(0,0,1),vO=Ce(),Pg=M(),Ig=M();function EMe(e,t,r,i=Jie()){const{direction:s,up:n}=i;return Wxe(vO,-Ft(t)),lA(vO,vO,Ft(r)),Ve(s,SMe,vO),le(s,s,-1),Ve(n,TMe,vO),i}function oht(e,t,r,i){return xMe(t,r,i,SMe,TMe)}function aht(e,t,r,i){const s=EMe(e,r,i),n=M();return le(n,s.direction,-t),de(n,n,e),{up:s.up,eye:n,heading:r,tilt:i}}function lht(e){return nu(e)}function cht(e){return Ft(e)}function CMe(e,t,r,i,s){const n=e.renderSpatialReference,o=e.map&&e.spatialReference||t.spatialReference;return so(t,Pg,n),so(t,Ig,n),Pg[0]-=r/2,Ig[0]+=r/2,Pg[1]-=i/2,Ig[1]+=i/2,xn(Pg,n,Pg,o),xn(Ig,n,Ig,o),s?(s.xmin=Pg[0],s.ymin=Pg[1],s.xmax=Ig[0],s.ymax=Ig[1],s.spatialReference=o):s=new Kt(Pg[0],Pg[1],Ig[0],Ig[1],o),s}const uht=Object.freeze(Object.defineProperty({__proto__:null,headingTiltToDirectionUp:EMe,directionToHeadingTilt:oht,eyeForCenterWithHeadingTilt:aht,lookAtTiltToEyeTilt:lht,eyeTiltToLookAtTilt:cht,toExtent:CMe},Symbol.toStringTag,{value:"Module"})),AMe=Ue(0,0,1),RMe=we(M(),Ue(1,1,1)),hht=new C1(-180,180),_O=Ce(),g_=M(),AS=M();function OMe(e,t,r,i=Jie()){ut(g_,e,AMe),Te(g_,g_)===0&&ut(g_,e,RMe),_h(_O,-Ft(t),e),qc(_O,_O,-Ft(r),g_);const{up:s,direction:n}=i;return ut(s,g_,e),we(s,s),Ve(s,s,_O),we(n,e),Ra(n,n),Ve(n,n,_O),i}function dht(e,t,r,i){const s=g_,n=AS;return we(s,e),ut(AS,s,AMe),Te(AS,AS)===0&&ut(AS,s,RMe),ut(n,AS,s),xMe(t,r,i,s,n)}function pht(e,t,r,i){const s={eye:M(),up:null,tilt:i,heading:r},n=g_;n[0]=e[0],n[1]=e[2],n[2]=-e[1];const o=t,a=Ft(r),l=Ft(i),c=Math.sin(a),h=Math.cos(a),p=Math.sin(l),f=Math.cos(l),m=Re(n);let g;if(Math.abs(l)<1e-8)g=o+m;else{const ne=m/p,D=bf(o/ne),N=Math.PI-l-D;g=ne*Math.sin(N)}const v=f*o,w=o*o*(p*p),_=h*h*w,T=g-v,x=T*T,E=_*(_+x-n[1]*n[1]);if(E<0)return le(s.eye,n,g/m),s.tilt=0,s;const C=Math.sqrt(E),A=n[1]*T,P=_+x;let I;if(I=h>0?-C+A:C+A,Math.abs(P)<1e-8)return m<1e-8?(s.eye[0]=0,s.eye[1]=0,s.eye[2]=o):le(s.eye,n,g/m),s.tilt=0,O7(s.eye),M7(s,e);s.eye[1]=I/P;const L=c*c*w,k=p*o,G=h*k*s.eye[1],z=s.eye[1]*s.eye[1],X=1-z,Z=Math.sqrt(X),ce=_*z+L-2*G*Z*T+X*x;return Math.abs(ce)<1e-8?(le(s.eye,n,g/m),s.tilt=0,O7(s.eye),M7(s,e)):(s.eye[0]=(X*(g*n[0]-v*n[0])-k*Z*(n[0]*s.eye[1]*h+n[2]*c))/ce,s.eye[2]=(X*(g*n[2]-v*n[2])-k*Z*(n[2]*s.eye[1]*h-n[0]*c))/ce,le(s.eye,s.eye,g),O7(s.eye),M7(s,e))}function O7(e){const t=e[1];e[1]=-e[2],e[2]=t}function M7(e,t){const r=OMe(t,e.heading,e.tilt);return e.up=r.up,e}function fht(e,t,r){const i=Re(t),s=Math.sqrt(r*r+i*i-2*r*i*Math.cos(Math.PI-e)),n=bf(r/(s/Math.sin(e)));return nu(e-n)}function mht(e,t,r){const i=Ft(e),s=Re(t);return bf(r/(s/Math.sin(i)))+i}function MMe(e,t,r,i,s){let n,o,a,l;const c=t.latitude,h=Ar(e.spatialReference).radius,p=t.longitude,f=mlt(c,r,h)/2;n=p-f,o=p+f;const m=Ft(c),g=(1+Math.sin(m))/(1-Math.sin(m)),v=(g+1)*Math.tan(i/h/2),w=v*v;function _(x){const E=Math.PI/2;return(x=h6e.normalize(x,-E))>E&&(x=Math.PI-x),x}if(a=1.5*Math.PI-2*Math.atan(.5*(v+Math.sqrt(4*g+w))),l=a+i/h,a=_(a),l=_(l),l<a){const x=l;l=a,a=x}if(a=Math.max(nu(a),-90),l=Math.min(nu(l),90),o=hht.monotonic(n,o),o-n>180){const x=(o-n-180)/2;n+=x,o-=x}const T=e.spatialReference&&e.spatialReference.isGeographic?e.spatialReference:Ze.WGS84;return s?(s.xmin=n,s.ymin=a,s.xmax=o,s.ymax=l,s.spatialReference=T):s=new Kt(n,a,o,l,T),e.spatialReference&&e.spatialReference.isWebMercator&&jy(s,!1,s),s}const ght=Object.freeze(Object.defineProperty({__proto__:null,headingTiltToDirectionUp:OMe,directionToHeadingTilt:dht,eyeForCenterWithHeadingTilt:pht,lookAtTiltToEyeTilt:fht,eyeTiltToLookAtTilt:mht,toExtent:MMe},Symbol.toStringTag,{value:"Module"}));function zV(e){return e.type==="point"}class PMe{constructor(t,r=null,i=0){this.array=t,this.spatialReference=r,this.offset=i}}function IMe(e){return"array"in e}function km(e,t,r="ground"){if(zV(t))return e.getElevation(t.x,t.y,t.z||0,t.spatialReference,r);if(IMe(t)){let i=t.offset;return e.getElevation(t.array[i++],t.array[i++],t.array[i]||0,_t(t.spatialReference,e.spatialReference),r)}return e.getElevation(t[0],t[1],t[2]||0,e.spatialReference,r)}function i$(e,t){return e!=null&&(t==null||(t===Be.Local?!e.isGeographic||e.isWGS84||e.wkid===Td.CGCS2000:e.isWebMercator||e.isWGS84||e.wkid===Td.CGCS2000||e.wkid===Td.GCSMARS2000||e.wkid===Td.GCSMARS2000_SPHERE||e.wkid===Td.GCSMOON2000))}const $Me=fe.getLogger("esri.views.3d.support.cameraUtils"),LMe=39.37,DMe=96,xQ=1,yht=8,vht=5,NMe=1,_pe=M(),jN=M(),_ht={heading:0,tilt:0},Ry=new at,bht=new C1(-20037508342788905e-9,20037508342788905e-9),wht=new C1(-180,180);var ia;function wL(e){return e.spatialReference||Ze.WGS84}function MR(e){return e.viewingMode==="global"?ght:uht}function xht(e,t,r,i,s){return MR(e).headingTiltToDirectionUp(t,r,i,s)}function wy(e,t){if(R(t))return null;const r=e.renderSpatialReference,i=MR(e).headingTiltToDirectionUp,s=M();if(!so(t.position,s,r))return null;const n=i(s,t.heading,t.tilt);le(n.direction,n.direction,e.state.camera.distance),de(n.direction,n.direction,s);const o=nS(e,s,n.direction,n.up);return o.fov=Ft(t.fov),o}(function(e){e[e.LOCKED=0]="LOCKED",e[e.ADJUST=1]="ADJUST"})(ia||(ia={}));const RS=M();function kA(e,t,r){const i=e.renderSpatialReference,s=CB(e,t.eye,t.viewForward,t.up,_ht);let n=wL(e);return xn(t.eye,i,RS,n)||(n=Ze.WGS84,xn(t.eye,i,RS,n)),R(r)?new ou(new at(RS,n),s.heading,s.tilt,nu(t.fov)):(r.position.x=RS[0],r.position.y=RS[1],r.position.z=RS[2],r.position.spatialReference=n,r.heading=s.heading,r.tilt=s.tilt,r.fov=nu(t.fov),r)}function Kie(e,t,r){const i=e.state.camera,s=i.width/2/i.pixelRatio;return e.renderCoordsHelper.viewingMode===Be.Global&&r!=null&&(t*=Math.cos(Ft(r))),t/=e.renderCoordsHelper.unitInMeters,s/(DMe*LMe/t)/Math.tan(i.fovX/2)}function MT(e,t,r){const i=e.state.camera,s=t*Math.tan(i.fovX/2),n=i.width/2/i.pixelRatio;let o=DMe*LMe/(n/s);return e.renderCoordsHelper.viewingMode===Be.Global&&(o/=Math.cos(Ft(r))),o*=e.renderCoordsHelper.unitInMeters,o}function FMe(e,t,r,i,s,n){return kMe(e,t,Kie(e,r,t.latitude),i,s,n)}function kMe(e,t,r,i,s,n){if(Wx(n)){const a=new PR(n.signal);return s$(e,i.heading,i.tilt,t,r,s,a),void a.resolver.promise.then(l=>{const c=GV(e,l,i.fov);if(!R(c))return n.resolver.resolve(c);n.resolver.reject()},l=>n.resolver.reject(l))}const o=s$(e,i.heading,i.tilt,t,r,s);return GV(e,o,i.fov,n)}function CB(e,t,r,i,s){return MR(e).directionToHeadingTilt(t,r,i,s)}function Tht(e,t){return!!(e.basemapTerrain&&e.renderCoordsHelper.fromRenderCoords(t,Ry,e.spatialReference)&&_t(km(e.elevationProvider,Ry),0)>Ry.z-NMe)}async function Sht(e,t,r){if(!e.renderCoordsHelper.fromRenderCoords(t,Ry,e.spatialReference))return!1;const i=await e.elevationProvider.queryElevation(Ry.x,Ry.y,Ry.z,Ry.spatialReference,"ground",r);return _t(i,0)>Ry.z-NMe}async function Eht(e,t,r){const i=M();if(t)if(t instanceof at){if(so(t,i,e.renderSpatialReference),t.z==null&&e.basemapTerrain!=null){const s=await e.elevationProvider.queryElevation(t.x,t.y,t.z,t.spatialReference,"ground",r);return b(s)&&e.renderCoordsHelper.setAltitude(i,s),i}}else ae(i,t);else ae(i,e.state.camera.center);return i}function Cht(e,t){const r=M();if(t&&t instanceof at){if(so(t,r,e.renderSpatialReference),t.z==null&&e.basemapTerrain!=null){const i=km(e.elevationProvider,t);b(i)&&e.renderCoordsHelper.setAltitude(r,i)}}else ae(r,t||e.state.camera.center);return r}function s$(e,t,r,i,s,n,o){const a=i&&i instanceof at?i:null;if(Wx(o))return Eht(e,i,o.signal).then(c=>{TQ(e,t,r,a,c,s,n,o)},c=>o.resolver.reject(c)),null;const l=Cht(e,i);return TQ(e,t,r,a,l,s,n,o)}function TQ(e,t,r,i,s,n,o,a){if(R(i)){const p=e.renderSpatialReference;if(i=O1(s,p,wL(e)),R(i))return null}n=Math.max(n,e.state.constraints.minimumPoiDistance);const l=Oht(e,t,r,s,n,o),c=(0,MR(e).eyeForCenterWithHeadingTilt)(s,n,l.heading,l.tilt);if(o===ia.ADJUST&&e.viewingMode==="global"&&r>0){const p=()=>{const m=UMe(e,s,n,Pht(e,n,r,s));return o=r-m<1?ia.LOCKED:ia.ADJUST,TQ(e,t,m,i,s,n,o,a)},f=e.map.ground.navigationConstraint;if(!f||f.type==="stay-above"){if(Tht(e,c.eye))return p();if(Wx(a))return Sht(e,c.eye,a.signal).then(m=>m?p():(a.resolver.resolve({eye:c.eye,up:c.up,center:Qs(s),heading:c.heading,tilt:c.tilt}),null)),null}}const h=!a||Wx(a)?{center:M(),eye:M(),up:M(),tilt:0,heading:0}:a;return h.eye=c.eye,h.up=c.up,h.center=Qs(s),h.heading=c.heading,h.tilt=c.tilt,Wx(a)&&a.resolver.resolve(h),h}function fP(e,t,r,i,s,n=null){const o=t.zmax!=null&&t.zmin!=null;let a,l,c;if(e.state.isGlobal){if(!i$(t.spatialReference,Be.Global))return Wx(n)&&n.resolver.reject(),null;const _=new at(t.xmin,t.ymin,t.spatialReference),T=new at(t.xmax,t.ymax,t.spatialReference),x=t.spatialReference.isGeographic?wht:bht;a=new at({x:x.center(_.x,T.x),y:(T.y+_.y)/2,z:o?(t.zmax+t.zmin)/2:null,spatialReference:t.spatialReference});const E=Ar(t.spatialReference),C=flt(a,_,T);l=C.lon,c=C.lat,x.diff(_.x,T.x)>x.range/2&&(l+=E.halfCircumference),l=Math.min(l,E.halfCircumference),c=Math.min(c,E.halfCircumference)}else{const _=_t(e.renderSpatialReference,t.spatialReference);_.equals(t.spatialReference)||(t=Q$(t,_)),l=t.xmax-t.xmin,c=t.ymax-t.ymin;const T=o?(t.zmax+t.zmin)/2:null;a=new at({x:t.xmin+.5*l,y:t.ymin+.5*c,z:T,spatialReference:_})}const h=o?t.zmax-t.zmin:0,p=e.state.camera,f=1/Math.tan(p.fovX/2),m=1/Math.tan(p.fovY/2),g=1/Math.tan(p.fov/2),v=Math.max(.5*l*f,.5*c*m,.5*h*g)/xQ;if(Wx(n)){const _=new PR(n.signal);return s$(e,r,i,a,v,s,_),void _.resolver.promise.then(T=>{const x=GV(e,T,e.camera.fov);if(!R(x))return n.resolver.resolve(x);n.resolver.reject()},T=>n.resolver.reject(T))}const w=s$(e,r,i,a,v,s);return GV(e,w,e.camera.fov,n)}function Aht(e,t,r){const i=e.renderSpatialReference,s=O1(r,i,wL(e));if(R(s))return null;const n=Math.tan(t.fovX/2),o=Math.tan(t.fovY/2),a=fee(t.eye,r),l=2*a*n*xQ,c=2*a*o*xQ;return e.viewingMode==="global"?MMe(e,s,l,c):CMe(e,s,l,c)}function Rht(e,t,r){const i=e.pointsOfInterest.centerOnSurfaceFrequent.distance;if(Math.log(r/i)/Math.LN2>yht)return!0;const s=e.renderSpatialReference,n=wL(e),o=O1(t,s,n),a=O1(e.pointsOfInterest.centerOnSurfaceFrequent.renderLocation,s,n);if(R(o)||R(a))return!1;const l=Math.tan(.5*e.state.camera.fov)*i;return a.distance(o)/l>vht}function Oht(e,t,r,i,s,n){let o=0;return n===ia.ADJUST&&Rht(e,i,s)?(t=0,o=Mht(e,s,r,i)):o=ese(e,i,s,r),o=e.state.constraints.clampTilt(s,o),{heading:t,tilt:r=UMe(e,i,s,o)}}const BV=.7;function Mht(e,t,r,i){const s=e.state.constraints.tilt(t);s.max=Math.min(s.max,.5*Math.PI);const n=s.min*(1-BV)+s.max*BV,o=ese(e,i,t,r);return Math.min(o,n)}function Pht(e,t,r,i){const s=e.state.constraints.tilt(t);let n=ese(e,i,t,r);return n=Math.min(n,.5*Math.PI),s.min*(1-BV)+n*BV}function UMe(e,t,r,i){return MR(e).lookAtTiltToEyeTilt(i,t,r)}function ese(e,t,r,i){return MR(e).eyeTiltToLookAtTilt(i,t,r)}function GV(e,t,r,i){if(R(t))return null;const s=e.renderSpatialReference,n=O1(t.eye,s,wL(e));return R(n)?null:b(i)?(i.position=n,i.heading=t.heading,i.tilt=t.tilt,i.fov=r,i):new ou(n,t.heading,t.tilt,r)}function VMe(e,t){var i;const r=(i=e.basemapTerrain)==null?void 0:i.tilingScheme;if(r)return r.levelAtScale(t);$Me.error("#scaleToZoom()","Cannot compute zoom from scale without a tiling scheme")}function zMe(e,t){var i;const r=(i=e.basemapTerrain)==null?void 0:i.tilingScheme;if(r)return r.scaleAtLevel(t);$Me.error("#zoomToScale()","Cannot compute scale from zoom without a tiling scheme")}function Iht(e,t){return e.spatialReference?mSe(t,e.spatialReference):void 0}function BMe(e,t,r){const i=e.renderSpatialReference;let s,n;t||(t=e.state.camera);const o=Ze.WGS84;return t instanceof ou?(s=t.position.latitude,so(t.position,_pe,i),so(r,jN,i),n=pi(_pe,jN)):(xn(t.center,i,jN,o),s=jN[1],n=t.distance),MT(e,n,s)}class PR{constructor(t){this.signal=t,this.resolver=vf()}}function Wx(e){return e&&"resolver"in e}function op(e){let t=e*e;return e<0&&(t*=-1),t}function bpe(e,t,r){const i=r,s=e.state,n=e.device,o=t.tiltDirection==="forward-down"?1:-1,a=1;return n.deviceType==="standard"?(i.translation[0]=op(s.axes[0]),i.translation[1]=op(s.axes[1]),i.translation[2]=op(s.buttons[7])-op(s.buttons[6]),i.heading=op(s.axes[2]),i.tilt=op(s.axes[3])):n.deviceType==="spacemouse"&&(i.translation[0]=1.2*op(s.axes[0]),i.translation[1]=1.2*op(s.axes[1]),i.translation[2]=2*-op(s.axes[2]),i.heading=1.2*op(s.axes[5]),i.tilt=1.2*op(s.axes[3])),i.tilt*=o,le(i.translation,i.translation,a),i}function wpe(e,t){const r=t;return r.translation[0]=e[1]-e[0],r.translation[1]=e[3]-e[2],r.translation[2]=e[4]-e[5],r.heading=e[7]-e[6],r.tilt=e[8]-e[9],r.zoom=e[10]-e[11],r}function P7(e){return e.translation[0]===0&&e.translation[1]===0&&e.translation[2]===0&&e.heading===0&&e.tilt===0&&e.zoom===0}let C_=class extends z1{constructor(e){super(e),this.transformation={translation:[0,0,0],heading:0,tilt:0,zoom:0},this.keysButtonState=[0,0,0,0,0,0,0,0,0,0,0,0],this.tmpCamera=new ii,this.constraintOptions={selection:Ti.ALL,interactionType:jt.NONE,interactionStartCamera:new ii,interactionFactor:0,interactionDirection:null,tiltMode:io.LOOK_AROUND}}handleEventGamepad(e){const t=bpe(e,this.view.navigation.gamepad,this.transformation);(e.action==="end"||P7(t))&&this.finishController()}activateDirection(e){this.keysButtonState[e]=1,wpe(this.keysButtonState,this.transformation)}deactivateDirection(e){this.keysButtonState[e]=0;const t=wpe(this.keysButtonState,this.transformation);P7(t)&&this.finishController()}onControllerStart(e){this.filteredSurfaceElevation=this.view.pointsOfInterest.cameraOnSurface.location.z,this.headingStart=this.view.camera.heading,super.onControllerStart(e)}_updateFilteredSurfaceElevation(e){const t=this.view.pointsOfInterest.cameraOnSurface.location.z,r=1;this.filteredSurfaceElevation+=r*(t-this.filteredSurfaceElevation)*e}stepController(e,t){this._updateStartHeading(),this._updateFilteredSurfaceElevation(e),this.currentCamera.copyViewFrom(t),this._updateCameraCenter(),this.constraintOptions.interactionStartCamera.copyFrom(this.currentCamera),this._calculateControlTransformation(e,this.currentCamera,wb),this._applyDisabledMovementTypes(wb),this._applyPan(wb.pan),this._applyRotate(wb.rotate),this._applyZoom(wb.zoom),this._applyAscend(wb.ascend),this.constraintOptions.interactionType=jt.NONE,this.constraintOptions.selection=Ti.COLLISION,Ts(this.view,this.currentCamera,this.constraintOptions),super.stepController(e,t)}_updateStartHeading(){this.transformation.heading!==0&&(this.headingStart=this.view.camera.heading)}_applyRotate(e){if(!e.enabled)return;const t=this.currentCamera;pe(Tl,t.center,t.eye),Ve(Tl,Tl,e.matrix),t.center=de(Tl,Tl,t.eye),t.up=Ve(Tl,t.up,e.matrix),this.constraintOptions.interactionType=jt.LOOK_AROUND,this.constraintOptions.selection=Ti.ALL_EXCEPT_COLLISION,Ts(this.view,t,this.constraintOptions)}_applyPan(e,t=this.currentCamera){!e.enabled||(t.eye=Ve(Tl,t.eye,e.matrix),t.center=Ve(Tl,t.center,e.matrix),this.view.state.isGlobal&&(t.up=Ve(Tl,t.up,e.matrix)),this.constraintOptions.interactionType=jt.PAN,this.constraintOptions.selection=Ti.ALL,Ts(this.view,t,this.constraintOptions))}_applyZoom(e){if(!e)return;const t=this.currentCamera.viewForward;this.currentCamera.eye=de(Tl,this.currentCamera.eye,le(He.get(),t,e)),ae(bO,t),Ra(bO,bO),this.constraintOptions.interactionDirection=bO,this.constraintOptions.interactionType=jt.ZOOM,this.constraintOptions.selection=Ti.ALL_EXCEPT_COLLISION,Ts(this.view,this.currentCamera,this.constraintOptions),this.constraintOptions.interactionDirection=null}_applyAscend(e){if(!e)return;const t=this.view.renderCoordsHelper.worldUpAtPosition(this.currentCamera.eye,He.get());if(this.constraintOptions.interactionDirection=ae(bO,t),this.view.state.isGlobal){const r=Re(this.currentCamera.eye),i=(r+e)/r;this.currentCamera.eye=le(Tl,this.currentCamera.eye,i),this.currentCamera.center=le(Tl,this.currentCamera.center,i)}else{const r=le(He.get(),t,e);this.currentCamera.eye=de(Tl,this.currentCamera.eye,r),this.currentCamera.center=de(Tl,this.currentCamera.center,r)}this._updateCameraCenter(),this.constraintOptions.interactionType=jt.ASCEND,this.constraintOptions.selection=Ti.COLLISION,Ts(this.view,this.currentCamera,this.constraintOptions)&&this._updateCameraCenter(),this.constraintOptions.selection=Ti.ALL_EXCEPT_COLLISION,Ts(this.view,this.currentCamera,this.constraintOptions),this.constraintOptions.interactionDirection=null}_calculateControlTransformation(e,t,r){Uht(r);const i=this._computeVelocities(e);this.view.state.isLocal?this._calculateControlTransformationLocal(i,t,r):this._calculateControlTransformationGlobal(i,t,r)}_updateCameraCenter(){const e=this.view.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,t=this.view.renderCoordsHelper,r=this.currentCamera.ray;this.currentCamera.center=t.intersectManifoldClosestSilhouette(r,e,Tl)}_calculateControlTransformationLocal(e,t,r){const{viewRight:i,viewForward:s}=t,n=this.transformation,o=this.view.navigation.gamepad,a=se(He.get(),s[0],s[1],0);we(a,a);const l=n.translation[0]*e.pan;if(l!==0){const g=le(He.get(),i,l);yl(r.pan.matrix,r.pan.matrix,g),r.pan.enabled=!0}switch(o.mode){case"pan":{const g=-n.translation[1]*e.pan;if(g!==0){const v=le(He.get(),a,g);yl(r.pan.matrix,r.pan.matrix,v),r.pan.enabled=!0}r.zoom=n.zoom*e.zoom;break}case"zoom":r.zoom=(-n.translation[1]+n.zoom)*e.zoom;break;default:o.mode}const c=n.translation[2]*e.ascend;r.ascend=c;const h=-n.heading*e.rotate;h!==0&&(qc(r.rotate.matrix,r.rotate.matrix,h,this.view.renderCoordsHelper.worldUpAtPosition(t.eye,He.get())),r.rotate.enabled=!0);const p=n.tilt*e.rotate,f=U1(this.view.renderCoordsHelper,t.center,t.eye),m=Le(f+p,Qo.min,Qo.max)-f;m&&(qc(r.rotate.matrix,r.rotate.matrix,m,i),r.rotate.enabled=!0)}_calculateControlTransformationGlobal(e,t,r){const{eye:i,viewRight:s}=t,n=this.transformation,o=this.view.navigation.gamepad,a=ut(He.get(),s,i);we(a,a),Ra(a,a),zut(this.startCamera,t,n,e,this.view.camera.heading,this.headingStart,this.view.camera.tilt,r,o),this.tmpCamera.copyFrom(this.currentCamera),this._applyPan(wb.pan,this.tmpCamera);const l=this.view.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,c=n.translation[2]*e.ascend;r.ascend=c;const h=-n.heading*e.rotate;h!==0&&(qc(r.rotate.matrix,r.rotate.matrix,h,this.tmpCamera.eye),r.rotate.enabled=!0);const p=n.tilt*e.rotate,f=this._clampTiltDeltaGlobalToValidRange(p,t.ray,l);f!==0&&(qc(r.rotate.matrix,r.rotate.matrix,f,this.tmpCamera.viewRight),r.rotate.enabled=!0),r.zoom+=n.zoom*e.zoom}_clampTiltDeltaGlobalToValidRange(e,t,r){const i=Ar(this.view.spatialReference),s=Z5(Qo.min,t.origin,r,i);let n=0,o=0;const a=He.get();if(this.view.renderCoordsHelper.intersectManifold(t,r,a)){const l=U1(this.view.renderCoordsHelper,a,t.origin);n=Z5(l,t.origin,r,i),o=Z5(Qo.max,t.origin,r,i)}else{dR(C6(A6,r+i.radius),t,a);const l=Cn(-Te(t.direction,we(a,a)));n=ape(l,t.origin,r,i),o=ape(Qo.max,t.origin,r,i)}return Le(n+e,s,o)-n}_getPointAbsoluteSurfaceElevation(e,t,r){const{renderCoordsHelper:i}=this.view,s=i.getAltitude(e),n=t+Math.abs(s-t);return i.setAltitude(r,n,e),n}_clampedDistanceToSurface(e,t){const{renderCoordsHelper:r}=this.view,{camera:i}=this.view.state,{direction:s}=xht(this.view,t,0,GMe,kht),n=r.intersectManifoldClosestSilhouette(wh(t,s),e,He.get()),o=pi(t,n),a=r.intersectManifoldClosestSilhouette(wh(t,S0(He.get(),t,i.center)),e,He.get()),l=pi(t,a);return Math.min(o,l)}_computeHeadingRotateRadius(e){const{renderCoordsHelper:t,state:r}=this.view,{camera:i,isGlobal:s}=r,n=t.intersectManifoldClosestSilhouette(i.ray,this.filteredSurfaceElevation,He.get());if(s){const o=pe(He.get(),e,n),a=Re(o);le(o,o,1/a);const l=we(He.get(),e),c=Cn(Te(l,o));return a*Math.sin(Math.min(Lht,c))}{const o=ae(He.get(),e);return t.setAltitude(o,this.filteredSurfaceElevation),pi(n,o)}}_minimumAscendVelocity(){return this.view.state.constraints.collision.enabled?0:Dht}_computeVelocities(e){const t=this.filteredSurfaceElevation,r=t+Ar(this.view.spatialReference).radius,{camera:i,isGlobal:s}=this.view.state,n=He.get(),o=this._getPointAbsoluteSurfaceElevation(i.eye,t,n),a=this._clampedDistanceToSurface(t,n),l=i.width/2,c=xpe*i.width,h=xpe*i.width,p=a*Math.tan(.5*i.fovX)/l,f=p/r,m=p/this._computeHeadingRotateRadius(n),g=o-t;return{pan:(s?f:p)*c*e,ascend:Math.max(this._minimumAscendVelocity()*e,2**(c*e/l)*g-g),zoom:2**(c*e/l)*a-a,rotate:Le(m*h,Nht,Fht)*e}}_applyDisabledMovementTypes(e){!b(this.disableMovements)||this.disableMovements.mode!==void 0&&this.view.state.viewingMode!==this.disableMovements.mode||(e.zoom=this.disableMovements.zoom?0:e.zoom,e.ascend=this.disableMovements.ascend?0:e.ascend,e.pan.enabled=!this.disableMovements.pan,this.disableMovements.pan&&ig(e.pan.matrix),e.rotate.enabled=!this.disableMovements.rotate,this.disableMovements.rotate&&ig(e.rotate.matrix))}static activatesFor(e,t){const r=bpe(t,e.navigation.gamepad,$ht);return!(t.action==="end"||P7(r))}};u([d({constructOnly:!0})],C_.prototype,"view",void 0),u([d({constructOnly:!0})],C_.prototype,"gamepadDevice",void 0),u([d({constructOnly:!0})],C_.prototype,"disableMovements",void 0),C_=u([$("esri.views.3d.state.controllers.GamepadKeyboardController")],C_);const $ht={translation:[0,0,0],heading:0,tilt:0,zoom:0},GMe=80,Lht=Ft(GMe),xpe=.75,Dht=5,Nht=Ft(30),Fht=Ft(80),wb={zoom:0,ascend:0,pan:{enabled:!1,matrix:Ce()},rotate:{enabled:!1,matrix:Ce()}},Tl=M(),bO=M(),kht=Jie();function Uht(e){e.zoom=0,e.ascend=0,e.pan.enabled=!1,ig(e.pan.matrix),e.rotate.enabled=!1,ig(e.rotate.matrix)}class Vht extends aa{constructor(t){super(!0),this.view=t,this.watchHandles=new Dt,this.handle=this.registerIncoming("gamepad",r=>this._handleEventGamepad(r)),this.handle.pause()}onInstall(t){super.onInstall(t),this.watchHandles.add([te(()=>this.view.navigation.gamepad.enabled,r=>{r?this.handle.resume():(this.handle.pause(),this.cameraControllerGamepad&&(this.cameraControllerGamepad.finishController(),this.cameraControllerGamepad=null))},Rt),te(()=>this.view.navigation.gamepad.device,r=>{this.cameraControllerGamepad&&r&&this.cameraControllerGamepad.gamepadDevice!==r&&(this.cameraControllerGamepad.finishController(),this.cameraControllerGamepad=null)})])}onUninstall(){this.watchHandles.removeAll(),super.onUninstall()}_handleEventGamepad(t){const r=this.view.navigation.gamepad.device;if(r&&t.data.device!==r)return;const i=this.cameraControllerGamepad&&this.cameraControllerGamepad.active;if(i||C_.activatesFor(this.view,t.data)){if(!i){const s=new C_({view:this.view,gamepadDevice:t.data.device});this.view.state.switchCameraController(s)&&(this.cameraControllerGamepad=s)}this.cameraControllerGamepad&&this.cameraControllerGamepad.active&&this.cameraControllerGamepad.gamepadDevice===t.data.device&&this.cameraControllerGamepad.handleEventGamepad(t.data)}}}var Rc;(function(e){e[e.LEFT=0]="LEFT",e[e.RIGHT=1]="RIGHT",e[e.FORWARD=2]="FORWARD",e[e.BACKWARD=3]="BACKWARD",e[e.UP=4]="UP",e[e.DOWN=5]="DOWN",e[e.HEADINGLEFT=6]="HEADINGLEFT",e[e.HEADINGRIGHT=7]="HEADINGRIGHT",e[e.TILTUP=8]="TILTUP",e[e.TILTDOWN=9]="TILTDOWN",e[e.ZOOMIN=10]="ZOOMIN",e[e.ZOOMOUT=11]="ZOOMOUT"})(Rc||(Rc={}));class zht extends aa{constructor(t,r){super(!0),this.view=t,this.disableMovements={pan:!0,zoom:!1,ascend:!0,rotate:!1,mode:Be.Local},this.keyToNumber={[r.left]:Rc.LEFT,[r.right]:Rc.RIGHT,[r.forward]:Rc.FORWARD,[r.backward]:Rc.BACKWARD,[r.up]:Rc.UP,[r.down]:Rc.DOWN,[r.headingLeft]:Rc.HEADINGLEFT,[r.headingRight]:Rc.HEADINGRIGHT,[r.tiltUp]:Rc.TILTUP,[r.tiltDown]:Rc.TILTDOWN,[r.zoomIn]:Rc.ZOOMIN,[r.zoomOut]:Rc.ZOOMOUT},this.registerIncoming("key-down",null,i=>this._handleKeyDown(i)),this.registerIncoming("key-up",null,i=>this._handleKeyUp(i)),this.registerIncoming("blur",null,()=>this._handleBlur())}_handleKeyDown(t){if(t.data.native.ctrlKey||t.data.native.metaKey)return;const r=this.keyToNumber[t.data.key];r!=null&&(this.cameraControllerKeyboard&&this.cameraControllerKeyboard.active||(this.cameraControllerKeyboard=new C_({view:this.view,disableMovements:this.disableMovements}),this.view.state.switchCameraController(this.cameraControllerKeyboard)),this.cameraControllerKeyboard.active&&(this.cameraControllerKeyboard.activateDirection(r),t.stopPropagation()))}_handleBlur(){this.cameraControllerKeyboard&&this.cameraControllerKeyboard.active&&(this.cameraControllerKeyboard.finishController(),this.cameraControllerKeyboard=null)}_handleKeyUp(t){if(t.data.native.ctrlKey||t.data.native.metaKey)return;const r=this.keyToNumber[t.data.key];r!=null&&this.cameraControllerKeyboard&&this.cameraControllerKeyboard.active&&(this.cameraControllerKeyboard.deactivateDirection(r),t.stopPropagation())}}class Bht extends aa{constructor(t,r){super(!0),this.view=t,this.registerIncoming("mouse-wheel",r,i=>this._handleMouseWheel(i))}_handleMouseWheel(t){if(!this.view.navigation.mouseWheelZoomEnabled)return;const r=t.data;this.cameraController&&this.cameraController.active||(this.cameraController=this.view.state.isGlobal?new UV({view:this.view,mode:"interaction"}):new VV({view:this.view,mode:"interaction"}),this.view.state.switchCameraController(this.cameraController)),this.cameraController.zoomStep(-1/60*r.deltaY,ts(r.x,r.y)),t.preventDefault(),t.stopPropagation()}}class jV{constructor(t){this._gain=t}reset(t){this._value=t}set gain(t){this._gain=t}get value(){return this._value===void 0?0:this._value}update(t){this._value===void 0?this._value=t:this._value=this._gain*t+(1-this._gain)*this._value}}let y1=class extends t${constructor(e){super(e),this.view=null,this.beginCamera=new ii,this.elapsedTimeSec=0,this.constraintOptions={selection:Ti.ALL,interactionType:jt.PAN,interactionFactor:0,interactionStartCamera:new ii,interactionDirection:null,tiltMode:io.TUMBLE}}initialize(){this.constraintOptions.interactionType=this.interactionType,this.viewAnimation=new xA}get steppingFinished(){return this.momentum.isFinished(this.elapsedTimeSec)}onControllerStart(e){this.beginCamera.copyFrom(e),this.constraintOptions.interactionStartCamera=this.beginCamera,super.onControllerStart(e)}stepController(e,t){t.copyViewFrom(this.beginCamera),this.elapsedTimeSec+=e,this.momentumStep(this.elapsedTimeSec,t),Ts(this.view,t,this.constraintOptions)}};u([d({constructOnly:!0})],y1.prototype,"view",void 0),y1=u([$("esri.views.3d.state.controllers.momentum.MomentumController")],y1);let mP=class extends y1{constructor(e){super(e),this.interactionType=jt.PAN,this.tmpPan=M()}momentumStep(e,t){const r=this.momentum.value(e);le(this.tmpPan,this.momentum.direction,r),t.eye=pe(Tpe,t.eye,this.tmpPan),t.center=pe(Tpe,t.center,this.tmpPan),this.constraintOptions.interactionDirection=this.tmpPan}};u([d({constructOnly:!0})],mP.prototype,"momentum",void 0),mP=u([$("esri.views.3d.state.controllers.momentum.PanPlanarMomentumController")],mP);const Tpe=M(),Ght=M(),HN=M();let J5=class extends y1{constructor(e){super(e),this.interactionType=jt.PAN}momentumStep(e,t){const r=this.momentum.value1(e),i=this.momentum.value2(e);ae(HN,t.eye),we(HN,HN),ut(this.momentum.axis2,HN,this.momentum.axis1),vMe(t,Ght,this.momentum.axis1,r,this.momentum.axis2,i)}};u([d({constructOnly:!0})],J5.prototype,"momentum",void 0),J5=u([$("esri.views.3d.state.controllers.momentum.PanSphericalMomentumController")],J5);let nx=class extends y1{constructor(e){super(e),this.interactionType=jt.TUMBLE}set center(e){this._set("center",Qs(e))}set axis(e){this._set("axis",Qs(e))}momentumStep(e,t){const r=this.momentum.value(e);V1(t,this.center,NI(this.axis,r))}};u([d({constructOnly:!0})],nx.prototype,"momentum",void 0),u([d({constructOnly:!0})],nx.prototype,"center",null),u([d({constructOnly:!0})],nx.prototype,"axis",null),nx=u([$("esri.views.3d.state.controllers.momentum.MomentumController")],nx);let zE=class extends y1{constructor(e){super(e),this.interactionType=jt.ZOOM,this.constraintOptions.interactionDirection=M()}set zoomCenter(e){this._set("zoomCenter",Qs(e))}momentumStep(e,t){ae(this.constraintOptions.interactionDirection,t.eye);const r=this.momentum.valueDelta(0,e);Xie(t,this.zoomCenter,r,this.view.state.constraints.minimumPoiDistance),this.constraintOptions.interactionDirection=S0(this.constraintOptions.interactionDirection,t.eye,this.constraintOptions.interactionDirection)}};u([d({constructOnly:!0})],zE.prototype,"momentum",void 0),u([d({constructOnly:!0})],zE.prototype,"zoomCenter",null),zE=u([$("esri.views.3d.state.controllers.momentum.ZoomPlanarMomentumController")],zE);let Mw=class extends y1{constructor(e){super(e),this.interactionType=jt.ZOOM,this.radius=0,this.tmpSceneCenter=M(),this.tmpZoomAxisAngle=CR(),this.sphere=kn()}set screenCenter(e){this._set("screenCenter",ts(e[0],e[1]))}set sceneCenter(e){this._set("sceneCenter",Qs(e))}initialize(){this.sphere[3]=this.radius}momentumStep(e,t){const r=this.momentum.valueDelta(0,e);dMe(this.sphere,t,r),this.constraintOptions.interactionType=jt.ZOOM,Ts(this.view,t,this.constraintOptions),r$(this.sphere,t,this.screenCenter,this.tmpSceneCenter),FI(this.sceneCenter,this.tmpSceneCenter,this.tmpZoomAxisAngle),V1(t,this.sphere,this.tmpZoomAxisAngle),this.constraintOptions.interactionType=jt.PAN}};u([d({constructOnly:!0})],Mw.prototype,"momentum",void 0),u([d({constructOnly:!0})],Mw.prototype,"screenCenter",null),u([d({constructOnly:!0})],Mw.prototype,"sceneCenter",null),u([d({constructOnly:!0})],Mw.prototype,"radius",void 0),Mw=u([$("esri.views.3d.state.controllers.momentum.ZoomSphericalMomentumController")],Mw);class Xp{constructor(t){this.gain=t}update(t){if(this.hasLastValue){const r=this.computeDelta(t);this._updateDelta(r)}this.lastValue=t}reset(){this.lastValue=void 0,this.filteredDelta=void 0}get hasLastValue(){return this.lastValue!==void 0}get hasFilteredDelta(){return this.filteredDelta!==void 0}computeDelta(t){return t-this.lastValue}_updateDelta(t){this.hasFilteredDelta?this.filteredDelta=(1-this.gain)*this.filteredDelta+this.gain*t:this.filteredDelta=t}}class AB{constructor(t,r,i){this._initialVelocity=t,this._stopVelocity=r,this._friction=i,this._duration=Math.abs(Math.log(Math.abs(this._initialVelocity)/this._stopVelocity)/Math.log(1-this._friction))}get duration(){return this._duration}isFinished(t){return t>this.duration}get friction(){return this._friction}value(t){return this.valueFromInitialVelocity(this._initialVelocity,t)}valueDelta(t,r){const i=this.value(t);return this.value(t+r)-i}valueFromInitialVelocity(t,r){r=Math.min(r,this.duration);const i=1-this.friction;return t*(i**r-1)/Math.log(i)}}class jht extends AB{constructor(t,r,i,s,n){super(t,r,i),this.sceneVelocity=s,this.direction=n}value(t){return super.valueFromInitialVelocity(this.sceneVelocity,t)}}class jMe{constructor(t=300,r=12,i=.84){this.minimumInitialVelocity=t,this.stopVelocity=r,this.friction=i,this.enabled=!0,this.time=new Xp(.6),this.screen=[new Xp(.4),new Xp(.4)],this.scene=[new Xp(.6),new Xp(.6),new Xp(.6)],this.tmpDirection=M()}add(t,r,i){if(this.enabled){if(this.time.hasLastValue&&this.time.computeDelta(i)<.015)return;this.screen[0].update(t[0]),this.screen[1].update(t[1]),this.scene[0].update(r[0]),this.scene[1].update(r[1]),this.scene[2].update(r[2]),this.time.update(i)}}reset(){this.screen[0].reset(),this.screen[1].reset(),this.scene[0].reset(),this.scene[1].reset(),this.scene[2].reset(),this.time.reset()}evaluateMomentum(){if(!this.enabled||!this.screen[0].hasFilteredDelta)return null;const t=this.screen[0].filteredDelta,r=this.screen[1].filteredDelta,i=Math.sqrt(t*t+r*r)/this.time.filteredDelta;return Math.abs(i)<this.minimumInitialVelocity?null:this.createMomentum(i,this.stopVelocity,this.friction)}createMomentum(t,r,i){se(this.tmpDirection,this.scene[0].filteredDelta,this.scene[1].filteredDelta,this.scene[2].filteredDelta);const s=Re(this.tmpDirection);s>0&&le(this.tmpDirection,this.tmpDirection,1/s);const n=s/this.time.filteredDelta;return new jht(t,r,i,n,this.tmpDirection)}}class Spe{constructor(t){this.gain=t}update(t){this.hasFilteredValue?this.filteredValue=(1-this.gain)*this.filteredValue+this.gain*t:this.filteredValue=t}reset(){this.filteredValue=void 0}get hasFilteredValue(){return this.filteredValue!==void 0}}const Epe=1e-5;class Hht extends AB{constructor(t,r,i,s,n,o=0,a){super(t,r,i),this.angularVelocity1=s,this.axis1=n,this.angularVelocity2=o,this.axis2=a}value1(t){return super.valueFromInitialVelocity(this.angularVelocity1,t)}value2(t){return super.valueFromInitialVelocity(this.angularVelocity2,t)}}class qht{constructor(t=300,r=12,i=.84){this.minimumInitialVelocity=t,this.stopVelocity=r,this.friction=i,this.enabled=!0,this.tmpAxis1=M(),this.tmpAxis2=M(),this.tmpAngles=rt(),this.time=new Xp(.3),this.screen=[new Xp(.4),new Xp(.4)],this.angle1=new Spe(.6),this.angle2=new Spe(.6),this.axis1=M(),this.axis2=M(),this.lastScene=M()}addMomentumDirectRotation(t,r,i,s,n,o){if(this.enabled){if(this.time.hasLastValue){if(this.time.computeDelta(i)<.01)return;let a=gMe(this.lastScene,r,this.tmpAxis2,s,n,o);this.angle2.update(0),ul(this.tmpAxis2)<Epe?a=0:we(this.axis1,this.tmpAxis2),this.angle1.update(a),ae(this.lastScene,r)}this.screen[0].update(t[0]),this.screen[1].update(t[1]),this.time.update(i)}}addMomentumPreserveHeading(t,r,i,s,n,o,a){if(this.enabled){if(this.time.hasLastValue){if(this.time.computeDelta(i)<.01)return;yMe(this.lastScene,r,this.tmpAxis2,this.tmpAxis1,this.tmpAngles,s,n,o,a,!1),ul(this.tmpAxis2)<Epe?(this.angle1.update(0),this.angle2.update(0)):(this.angle1.update(this.tmpAngles[1]),this.angle2.update(this.tmpAngles[0]),we(this.axis1,this.tmpAxis1),we(this.axis2,this.tmpAxis2)),ae(this.lastScene,r)}this.screen[0].update(t[0]),this.screen[1].update(t[1]),this.time.update(i)}}reset(){this.screen[0].reset(),this.screen[1].reset(),this.angle1.reset(),this.angle2.reset(),this.time.reset()}evaluateMomentum(){if(!this.enabled||!this.screen[0].hasFilteredDelta)return null;const t=this.screen[0].filteredDelta,r=this.screen[1].filteredDelta,i=Math.sqrt(t*t+r*r)/this.time.filteredDelta;return Math.abs(i)<this.minimumInitialVelocity?null:this.createMomentum(i,this.stopVelocity,this.friction)}createMomentum(t,r,i){const s=this.angle1.filteredValue/this.time.filteredDelta,n=this.angle2.filteredValue/this.time.filteredDelta;return new Hht(t,r,i,s,this.axis1,n,this.axis2)}}class HMe{constructor(t=2.5,r=.01,i=.95,s=12){this.minimumInitialVelocity=t,this.stopVelocity=r,this.friction=i,this.maxVelocity=s,this.enabled=!0,this.value=new Xp(.8),this.time=new Xp(.3)}add(t,r){if(this.enabled){if(this.time.hasLastValue){if(this.time.computeDelta(r)<.01)return;if(this.value.hasFilteredDelta){const i=this.value.computeDelta(t);this.value.filteredDelta*i<0&&this.value.reset()}}this.time.update(r),this.value.update(t)}}reset(){this.value.reset(),this.time.reset()}evaluateMomentum(){if(!this.enabled||!this.value.hasFilteredDelta)return null;let t=this.value.filteredDelta/this.time.filteredDelta;return t=Le(t,-this.maxVelocity,this.maxVelocity),Math.abs(t)<this.minimumInitialVelocity?null:this.createMomentum(t,this.stopVelocity,this.friction)}createMomentum(t,r,i){return new AB(t,r,i)}}class qMe extends HMe{constructor(t=3,r=.01,i=.95,s=12){super(t,r,i,s)}add(t,r){if(this.value.hasLastValue){const i=this.value.lastValue;let s=t-i;for(;s>Math.PI;)s-=2*Math.PI;for(;s<-Math.PI;)s+=2*Math.PI;t=i+s}super.add(t,r)}}class Wht extends AB{constructor(t,r,i){super(t,r,i)}value(t){const r=super.value(t);return Math.exp(r)}valueDelta(t,r){const i=super.value(t),s=super.value(t+r)-i;return Math.exp(s)}}class WMe extends HMe{constructor(t=2.5,r=.01,i=.95,s=12){super(t,r,i,s)}add(t,r){super.add(Math.log(t),r)}createMomentum(t,r,i){return new Wht(t,r,i)}}let K5=class extends z1{constructor(e){super(e),this.view=null,this.smoothRotation=new jV(.05),this.rotationAxis=M(),this.panningPlane=Er(),this.smoothScaling=new jV(.05),this.zoomCenterScreen=ts(),this.zoomMomentumEstimator=new WMe,this.rotationMomentumEstimator=new qMe,this.panSphericalMomentumEstimator=new qht,this.panPlanarMomentumEstimator=new jMe,this.adjustedSphere=kn(),this.tmp3d=M(),this.tmpScreenPointArray=ts(),this.beginScreenPoint=ts(),this.beginScenePoint=M(),this.screenPickPoint=ts(),this.navMode=Oo.Horizontal,this.tmpInteractionDirection=M(),this.constraintOptions={selection:Ti.ALL,interactionType:jt.NONE,interactionFactor:0,interactionStartCamera:new ii,interactionDirection:null,tiltMode:io.TUMBLE}}get intersectionHelper(){return this.view.sceneIntersectionHelper}begin(e){if(!this.active)return;const t=this.view.navigation.momentumEnabled;this.zoomMomentumEstimator.enabled=t,this.rotationMomentumEstimator.enabled=t,this.panPlanarMomentumEstimator.enabled=t,this.panSphericalMomentumEstimator.enabled=t,this.beginHeading=-A1.normalize(Ft(this.view.camera.heading)),this.beginRadius=e.radius,this.pointerCount=e.pointers.size,this.beginAngle=e.angle,this.smoothRotation.reset(),My(e.center,this.screenPickPoint),Do(this.beginScreenPoint,this.screenPickPoint);const r=Ar(this.view.spatialReference),i=fMe(this.intersectionHelper,this.startCamera,this.screenPickPoint,r,FA.Silhouette);this.scenePickPoint=i.scenePickPoint,this.sphere=i.sphere,ae(this.beginScenePoint,this.scenePickPoint),this.navMode=EB(this.startCamera,this.screenPickPoint,i.hasGeometryIntersection,r),this.navMode===Oo.Vertical&&this._preparePlanarPanMode(e),this.constraintOptions.interactionStartCamera.copyFrom(this.startCamera)}_preparePlanarPanMode(e){const t=Ra(this.tmp3d,this.startCamera.viewForward);pA(this.scenePickPoint,t,this.panningPlane);const r=ts(this.screenPickPoint[0],0),i=M(),s=Re(this.startCamera.eye);this.adjustedSphere[3]=s<this.sphere[3]?s-100:this.sphere[3],r$(this.adjustedSphere,this.startCamera,r,i);const n=ea();this.startCamera.projectToRenderScreen(i,n);const o=.9*n[1];this.screenPickPoint[1]=Math.min(this.screenPickPoint[1],o);const a=this.intersectionHelper.intersectScreen(this.screenPickPoint,this.scenePickPoint);a&&pA(this.scenePickPoint,this.panningPlane,this.panningPlane);const l=M(),c=M(),h=M(),p=80,f=5,m=50;pe(l,this.scenePickPoint,this.currentCamera.eye);const g=Re(l);we(l,l);const v=f*Math.max(Math.abs(this.view.camera.position.z),m),w=this.view._stage.renderView.getMinimalDepthForArea(null,this.screenPickPoint[0],this.screenPickPoint[1],this.view.state.camera,p);let _=w?Math.min(w,v):v;_=a?Math.min(_,g):_,ae(h,de(c,this.currentCamera.eye,le(c,l,_))),this.panningPlane[3]=-Te(this.panningPlane,h),this.startCamera.center=de(c,this.startCamera.eye,le(c,this.startCamera.viewForward,_));const T=My(e.center,this.tmpScreenPointArray);wQ(this.panningPlane,this.startCamera,T,this.beginScenePoint)}update(e){if(!this.active)return;this.currentCamera.copyFrom(this.startCamera);const t=e.pointers.size>1;this.navMode===Oo.Horizontal?(t&&this._zoomSpherical(e),this._panningSpherical(e),t&&this._rotateSpherical(e)):(t&&this._zoomPlanar(e),this._panningPlanar(e),t&&this._rotatePlanar(e))}end(e){e.pointers.size===this.pointerCount&&this.update(e),this.finishController();const t=this.zoomMomentumEstimator.evaluateMomentum();if(t)return this.navMode===Oo.Horizontal?new Mw({view:this.view,momentum:t,screenCenter:this.zoomCenterScreen,sceneCenter:this.beginScenePoint,radius:this.sphere[3]}):new zE({view:this.view,momentum:t,zoomCenter:this.beginScenePoint});const r=this.rotationMomentumEstimator.evaluateMomentum();if(r)return new nx({view:this.view,momentum:r,center:this.sphere,axis:this.rotationAxis});if(this.navMode===Oo.Horizontal){const i=this.panSphericalMomentumEstimator.evaluateMomentum();if(i)return new J5({view:this.view,momentum:i})}else{const i=this.panPlanarMomentumEstimator.evaluateMomentum();if(i)return new mP({view:this.view,momentum:i})}return null}_zoomSpherical(e){const t=this.beginRadius/e.radius,r=.001875*Math.min(Math.max(e.radius,40),120);this.smoothScaling.gain=r,this.smoothScaling.update(t),dMe(this.sphere,this.currentCamera,this.smoothScaling.value),My(e.center,this.zoomCenterScreen),this.zoomMomentumEstimator.add(this.smoothScaling.value,.001*e.timestamp),this.constraintOptions.interactionType=jt.ZOOM,this.constraintOptions.interactionFactor=Wp(e.radius-this.beginRadius),Ts(this.view,this.currentCamera,this.constraintOptions)}_panningSpherical(e){const t=My(e.center,this.tmpScreenPointArray);r$(this.sphere,this.currentCamera,t,this.tmp3d),Zie(this.beginScenePoint,Te(this.currentCamera.up,this.beginScenePoint),this.sphere[3],this.beginHeading,this.view.camera.tilt,this.startCamera)?(bMe(this.sphere,this.currentCamera,this.beginScenePoint,this.tmp3d,this.beginHeading,this.view.camera.tilt,!1),this.panSphericalMomentumEstimator.addMomentumPreserveHeading(t,this.tmp3d,.001*e.timestamp,this.startCamera,this.sphere,this.beginHeading,this.view.camera.tilt)):(_Me(this.sphere,this.currentCamera,this.beginScenePoint,this.tmp3d,this.view.camera.tilt,!1),this.panSphericalMomentumEstimator.addMomentumDirectRotation(t,this.tmp3d,.001*e.timestamp,this.startCamera,this.sphere[3],this.view.camera.tilt)),this.constraintOptions.interactionType=jt.PAN,this.constraintOptions.interactionFactor=Wp(this.screenPickPoint,t),Ts(this.view,this.currentCamera,this.constraintOptions)}_rotateSpherical(e){we(this.rotationAxis,this.scenePickPoint),this.currentCamera.aboveGround||Ra(this.rotationAxis,this.rotationAxis);const t=this.smoothRotation.value,r=t+bQ(e.angle-t),i=.00125*Math.min(Math.max(e.radius,40),120);this.smoothRotation.gain=i,this.smoothRotation.update(r);const s=this.smoothRotation.value-this.beginAngle;this.rotationMomentumEstimator.add(s,.001*e.timestamp),V1(this.currentCamera,this.sphere,NI(this.rotationAxis,s)),this.constraintOptions.interactionType=jt.TUMBLE,this.constraintOptions.interactionFactor=Wp(e.radius*r),Ts(this.view,this.currentCamera,this.constraintOptions)}_panningPlanar(e){const t=My(e.center,this.tmpScreenPointArray);wQ(this.panningPlane,this.currentCamera,t,this.tmp3d)&&(mMe(this.currentCamera,this.beginScenePoint,this.tmp3d),this.panPlanarMomentumEstimator.add(t,this.tmp3d,.001*e.timestamp),this.constraintOptions.interactionType=jt.PAN,this.constraintOptions.interactionFactor=Wp(this.beginScreenPoint,t),this.constraintOptions.interactionDirection=this.view.renderCoordsHelper.worldUpAtPosition(this.currentCamera.eye,this.tmpInteractionDirection),Ts(this.view,this.currentCamera,this.constraintOptions),this.constraintOptions.interactionDirection=null)}_zoomPlanar(e){const t=this.beginRadius/e.radius,r=.001875*Math.min(Math.max(e.radius,40),120);this.smoothScaling.gain=r,this.smoothScaling.update(t),this.zoomMomentumEstimator.add(this.smoothScaling.value,.001*e.timestamp),Xie(this.currentCamera,this.beginScenePoint,this.smoothScaling.value,this.view.state.constraints.minimumPoiDistance),this.constraintOptions.interactionType=jt.ZOOM,this.constraintOptions.interactionFactor=Wp(e.radius-this.beginRadius),Ts(this.view,this.currentCamera,this.constraintOptions)}_rotatePlanar(e){ae(this.rotationAxis,this.beginScenePoint),this.currentCamera.aboveGround||Ra(this.rotationAxis,this.rotationAxis);const t=this.smoothRotation.value;let r=e.angle-t;r=bQ(r);const i=t+r,s=.00125*Math.min(Math.max(e.radius,40),120);this.smoothRotation.gain=s,this.smoothRotation.update(i);const n=this.smoothRotation.value-this.beginAngle;this.rotationMomentumEstimator.add(n,.001*e.timestamp),V1(this.currentCamera,this.sphere,NI(this.rotationAxis,n)),this.constraintOptions.interactionType=jt.TUMBLE,this.constraintOptions.interactionFactor=Wp(e.radius*n),Ts(this.view,this.currentCamera,this.constraintOptions)}};u([d({constructOnly:!0})],K5.prototype,"view",void 0),K5=u([$("esri.views.3d.state.controllers.global.PinchAndPanController")],K5);const Cpe=Ue(0,0,1),Xht={ELEVATION_THRESHOLD:3e4,ANGLE_THRESHOLD:16/180*Math.PI},Zht=80;let ek=class extends z1{constructor(e){super(e),this.view=null,this.rotationValueSmooth=new jV(.05),this.scalingValueSmooth=new jV(.05),this.planeHorizontal=Er(),this.planeVertical=Er(),this.rotationMomentumEstimator=new qMe,this.panMomentumEstimator=new jMe(300,12,.9),this.zoomMomentumEstimator=new WMe,this.beginCenter=M(),this.tmpPoints=[],this.beginCenterScreen=ts(),this.tmpCentroid3d=M(),this.tmpCentroid2d=ts(),this.tmp2d=ts(),this.constraintOptions={selection:Ti.ALL,interactionType:jt.NONE,interactionFactor:0,interactionStartCamera:new ii,interactionDirection:null,tiltMode:io.TUMBLE}}get intersectionHelper(){return this.view.sceneIntersectionHelper}begin(e){if(!this.active)return;const t=this.view.navigation.momentumEnabled;this.zoomMomentumEstimator.enabled=t,this.rotationMomentumEstimator.enabled=t,this.panMomentumEstimator.enabled=t,this.beginRadius=e.radius,this.pointerCount=e.pointers.size,this.beginAngle=e.angle,this.rotationValueSmooth.reset(),this.scalingValueSmooth.reset(),My(e.center,this.beginCenterScreen),YTe(Cpe,0,this.planeHorizontal);const r=M(),i=this.intersectionHelper.intersectScreenFreePointFallback(this.beginCenterScreen,r),s=M();Ra(s,this.startCamera.viewForward);const n=M();ae(n,Cpe);const o=Te(s,n),a=bf(o<0?-o:o);if(this.panMode=a>=Xht.ANGLE_THRESHOLD?Oo.Horizontal:Oo.Vertical,NX(this.planeHorizontal,this.planeHorizontal,r),this.startCamera.aboveGround||FX(this.planeHorizontal,this.planeHorizontal),this.panMode===Oo.Vertical){le(n,n,o),pe(this.planeVertical,s,n),we(this.planeVertical,this.planeVertical),NX(this.planeVertical,this.planeVertical,r);const l=M(),c=M(),h=M();pe(l,r,this.currentCamera.eye);const p=Re(l);we(l,l);const f=5*Math.max(Math.abs(this.view.camera.position.z),50),m=this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm,this.beginCenterScreen[0],this.beginCenterScreen[1],this.view.state.camera,Zht);let g=m?Math.min(m,f):f;g=i?Math.min(g,p):g,ae(h,de(c,this.currentCamera.eye,le(c,l,g))),this.planeVertical[3]=-Te(this.planeVertical,h),this.computePlanePoints(e.pointers,this.planeVertical,this.startCamera,this.tmpPoints),T7(this.tmpPoints,this.beginCenter)}else this.computePlanePoints(e.pointers,this.planeHorizontal,this.startCamera,this.tmpPoints),T7(this.tmpPoints,this.beginCenter);this.constraintOptions.interactionStartCamera.copyFrom(this.startCamera)}update(e){if(!this.active)return;this.currentCamera.copyFrom(this.startCamera);const t=e.pointers.size>1,r=this.panMode===Oo.Horizontal?this.planeHorizontal:this.planeVertical,i=this.beginCenter;if(t){const s=this.beginRadius/e.radius,n=.001875*Math.min(Math.max(e.radius,40),120);this.scalingValueSmooth.gain=n,this.scalingValueSmooth.update(s),Xie(this.currentCamera,i,this.scalingValueSmooth.value,this.view.state.constraints.minimumPoiDistance),this.zoomMomentumEstimator.add(this.scalingValueSmooth.value,.001*e.timestamp),this.constraintOptions.interactionType=jt.ZOOM,this.constraintOptions.interactionFactor=Wp(Math.abs(e.radius-this.beginRadius)),Ts(this.view,this.currentCamera,this.constraintOptions)}if(this.computePlanePoints(e.pointers,r,this.currentCamera,this.tmpPoints),T7(this.tmpPoints,this.tmpCentroid3d),My(e.center,this.tmpCentroid2d),mMe(this.currentCamera,i,this.tmpCentroid3d),this.panMomentumEstimator.add(this.tmpCentroid2d,this.tmpCentroid3d,.001*e.timestamp),this.constraintOptions.interactionType=jt.PAN,this.constraintOptions.interactionFactor=Wp(this.beginCenterScreen,this.tmpCentroid2d),Ts(this.view,this.currentCamera,this.constraintOptions),t){const s=this.planeHorizontal,n=i,o=this.rotationValueSmooth.value,a=o+bQ(e.angle-o),l=.00125*Math.min(Math.max(e.radius,40),120);this.rotationValueSmooth.gain=l,this.rotationValueSmooth.update(a);const c=this.rotationValueSmooth.value-this.beginAngle;this.rotationMomentumEstimator.add(c,.001*e.timestamp),V1(this.currentCamera,n,NI(s,c)),this.constraintOptions.interactionType=jt.TUMBLE,this.constraintOptions.interactionFactor=Wp(Math.abs(e.radius*c)),Ts(this.view,this.currentCamera,this.constraintOptions)}}end(e){e.pointers.size===this.pointerCount&&this.update(e),this.finishController();const t=this.zoomMomentumEstimator.evaluateMomentum();if(t)return new zE({view:this.view,momentum:t,zoomCenter:this.beginCenter});const r=this.rotationMomentumEstimator.evaluateMomentum();if(r)return new nx({view:this.view,momentum:r,center:this.beginCenter,axis:this.planeHorizontal});const i=this.panMomentumEstimator.evaluateMomentum();return i?new mP({view:this.view,momentum:i}):null}computePlanePoints(e,t,r,i){i.length=e.size;const s=this.tmp2d;let n=0;return e.forEach(o=>{s[0]=o.x,s[1]=o.y,i[n]===void 0&&(i[n]=M()),wQ(t,r,s,i[n]),n+=1}),i}};u([d({constructOnly:!0})],ek.prototype,"view",void 0),ek=u([$("esri.views.3d.state.controllers.local.PinchAndPanController")],ek);class Ape extends aa{constructor(t,r,i){super(!0),this.view=t,this.pointerAction=r,this.lastEndTimestamp=0,this.lastTimestamp=0,this.registerIncoming("drag",i,s=>this._handleDrag(s))}_handleDrag(t){if(t.data.pointerType==="mouse"&&!Qie(t.data,this.pointerAction))return;const r=t.timestamp-this.lastEndTimestamp,i=40,s=this.momentum&&this.momentum.active&&r<i;switch(t.data.action){case"start":case"update":if(s)break;this.controller&&this.controller.active?t.data.timestamp-this.lastTimestamp>2&&(this.controller.update(t.data),this.lastTimestamp=t.timestamp):this._startController(t);break;case"end":case"removed":this._endController(t,!0);break;case"added":this._endController(t,!1),this._startController(t)}t.stopPropagation()}_endController(t,r){if(this.controller&&this.controller.active){this.lastEndTimestamp=t.timestamp;const i=this.controller.end(t.data);r&&i&&(this.momentum=i,this.view.state.switchCameraController(this.momentum))}this.controller=null}_startController(t){this.controller=this._createController(),this.view.state.switchCameraController(this.controller),this.controller.begin(t.data),this.lastTimestamp=t.timestamp}_createController(){return this.view.state.isGlobal?new K5({view:this.view}):new ek({view:this.view})}}class Yht extends aa{constructor(t,r){super(!0),this.view=t,this.registerIncoming("pointer-down",r,()=>this.view.state.stopActiveCameraController())}}class XMe extends aa{constructor(t,r){super(!0),this.key=t,this.registerIncoming("key-down",r,i=>this._handleKeyDown(i))}_handleKeyDown(t){t.data.key===this.key&&(this.activate(),t.stopPropagation())}}class Qht extends XMe{constructor(t,r,i){super(r,i),this.view=t}activate(){this.view.goTo({heading:0}).catch(()=>{})}}class Jht extends XMe{constructor(t,r,i){super(r,i),this.view=t}activate(){this.view.goTo({tilt:0}).catch(()=>{})}}class Kht extends aa{constructor(t,r=!1){super(!0),this.view=t,this.invert=r,this.registerIncoming("vertical-two-finger-drag",i=>this._handleTwoFinger(i))}_handleTwoFinger(t){var s,n,o;const r=this.invert?-1:1,i=ts(0,t.data.delta*r);switch(t.data.action){case"begin":(s=this.cameraController)==null||s.end(),this.cameraController=new VE({view:this.view,pivot:Lc.CENTER}),this.view.state.switchCameraController(this.cameraController),this.cameraController.begin(i);break;case"update":(n=this.cameraController)==null||n.update(i);break;case"end":(o=this.cameraController)==null||o.end(),this.cameraController=null}}}function Rpe(e){const t=e.native;return t?{buttons:t.buttons.map(r=>r.pressed?r.value?r.value:1:0),axes:t.axes.map(r=>rdt(r,e.axisThreshold))}:{buttons:[],axes:[]}}function edt(e,t){if(e.axes.length!==t.axes.length||e.buttons.length!==t.buttons.length)return!1;for(let r=0;r<e.axes.length;r++)if(e.axes[r]!==t.axes[r])return!1;for(let r=0;r<e.buttons.length;r++)if(e.buttons[r]!==t.buttons[r])return!1;return!0}function tdt(e){for(let t=0;t<e.axes.length;t++)if(e.axes[t]!==0)return!1;for(let t=0;t<e.buttons.length;t++)if(e.buttons[t]!==0)return!1;return!0}function rdt(e,t){const r=Math.abs(e);return r<t?0:Math.sign(e)*(r-t)/(1-t)}class idt{constructor(t,r){this.element=t,this.input=r,this._hasEventListeners=!1,this._onConnectGamepad=n=>{this._connectGamepad(n.gamepad)},this._onDisconnectGamepad=n=>{const o=n.gamepad,a=o.index,l=this.inputDevices[a];l&&(this._emitGamepadEvent(o,Rpe(l),!1),this.inputDevices.splice(a,1),this.latestUpdate.splice(a,1),this.input.gamepad.devices.remove(l),this.ensurePollingState())},this.frameTask=null,this.latestUpdate=new Array,this.inputDevices=new Array,this.callback=null;const i="getGamepads"in window.navigator,s=window.isSecureContext;this.supported=i&&s,this.supported&&(this._forEachGamepad(n=>this._connectGamepad(n)),window.addEventListener("gamepadconnected",this._onConnectGamepad),window.addEventListener("gamepaddisconnected",this._onDisconnectGamepad),this.ensurePollingState())}destroy(){this.hasEventListeners=!1,this.supported&&(window.removeEventListener("gamepadconnected",this._onConnectGamepad),window.removeEventListener("gamepaddisconnected",this._onDisconnectGamepad))}set hasEventListeners(t){this._hasEventListeners!==t&&(this._hasEventListeners=t,this.ensurePollingState())}get eventsEnabled(){return this.supported&&this.inputDevices.length>0&&this._hasEventListeners}set onEvent(t){this.callback=t}_connectGamepad(t){const r=new tie(t);r.deviceType!=="unknown"&&(this.inputDevices[t.index]=r,this.input.gamepad.devices.add(r)),this.ensurePollingState()}ensurePollingState(){this.eventsEnabled?this._startPolling():this._stopPolling()}_startPolling(){this.frameTask==null&&(this.frameTask=rT({update:()=>this._readGamepadState()}))}_stopPolling(){this.frameTask!=null&&(this.frameTask.remove(),this.frameTask=null,this.latestUpdate=new Array)}_readGamepadState(){const t=document.hasFocus(),r=this.element.contains(document.activeElement),i=this.input.gamepad.enabledFocusMode==="document"&&!t||this.input.gamepad.enabledFocusMode==="view"&&!r;this._forEachGamepad(s=>{const n=this.inputDevices[s.index];if(!n)return;const o=this.latestUpdate[s.index],a=Rpe(n),l=i||tdt(a);o&&(o.timestamp===s.timestamp||!o.active&&l||edt(o.state,a))||this._emitGamepadEvent(s,a,!l)})}_forEachGamepad(t){const r=window.navigator.getGamepads();for(let i=0;i<r.length;i++){const s=r[i];this._validate(s)&&t(s)}}_emitGamepadEvent(t,r,i){const s=this.latestUpdate[t.index],n=s&&s.active;if(!n&&!i)return;const o=!n&&i?"start":n&&i?"update":"end";this.latestUpdate[t.index]={timestamp:t.timestamp,state:r,active:i},this.callback&&this.callback({device:this.inputDevices[t.index],state:r,action:o})}_validate(t){if(!t||!t.connected)return!1;for(let r=0;r<t.axes.length;r++)if(isNaN(t.axes[r]))return!1;return!0}}const Ope=he("trident"),Mpe=he("edge"),sdt=he("chrome"),ndt=he("ff"),odt=he("safari"),OS={touchNone:"esri-view-surface--touch-none",touchPan:"esri-view-surface--touch-pan"};class RB{constructor(t,r){this.input=r,this._active={},this._activePointerCaptures=new Set,this._keyDownState=new Set,this._eventId=1,this._browserTouchPanningEnabled=!1,this._element=t,t.getAttribute("tabindex")||t.setAttribute("tabindex","0"),this._eventHandlers={"key-down":this._handleKey,"key-up":this._handleKey,"pointer-down":this._handlePointer,"pointer-move":this._handlePointerPreventDefault,"pointer-up":this._handlePointerPreventDefault,"pointer-enter":this._handlePointer,"pointer-leave":this._handlePointer,"pointer-cancel":this._handlePointer,"mouse-wheel":this._handleMouseWheel,"pointer-capture-lost":this._handlePointerCaptureLost},this._updateTouchAction(),this._element.addEventListener("keydown",this._preventAltKeyDefault),this._gamepadSource=new idt(t,this.input),this._gamepadSource.onEvent=i=>this._callback("gamepad",i)}destroy(){this._callback=null,this.activeEvents=null,this._activePointerCaptures.forEach(t=>{this._releasePointerCaptureSafe(t)}),this._gamepadSource&&(this._gamepadSource.destroy(),this._gamepadSource=null),this._activePointerCaptures=null,this._removeTouchAction(),this._element.removeEventListener("keydown",this._preventAltKeyDefault)}get browserTouchPanningEnabled(){return this._browserTouchPanningEnabled}set browserTouchPanningEnabled(t){this._browserTouchPanningEnabled=t,this._updateTouchAction(),this._updateTouchEventHandling()}set onEventReceived(t){this._callback=t}set activeEvents(t){for(const r in this._active)if(!t||!t.has(r)){const i=this._active[r];this._element.removeEventListener(I7[r],i),delete this._active[r]}t&&t.forEach(r=>{if(!this._active[r]&&I7[r]){const i=(this._eventHandlers[r]||this._handleDefault).bind(this,r);this._element.addEventListener(I7[r],i),this._active[r]=i}}),this._gamepadSource.hasEventListeners=t&&t.has("gamepad")}setPointerCapture(t,r){r?(this._element.setPointerCapture(t.pointerId),this._activePointerCaptures.add(t.pointerId)):(this._releasePointerCaptureSafe(t.pointerId),this._activePointerCaptures.delete(t.pointerId))}_updateTouchAction(){this._element.classList.remove(this._browserTouchPanningEnabled?OS.touchNone:OS.touchPan),this._element.classList.add(this._browserTouchPanningEnabled?OS.touchPan:OS.touchNone)}_updateTouchEventHandling(){this._browserTouchPanningEnabled?this._element.addEventListener("touchmove",this._preventMultiTouchPanning):this._element.removeEventListener("touchmove",this._preventMultiTouchPanning)}_removeTouchAction(){this._element.classList.remove(OS.touchNone),this._element.classList.remove(OS.touchPan),this._element.removeEventListener("touchmove",this._preventMultiTouchPanning)}_releasePointerCaptureSafe(t){try{if(this._element.hasPointerCapture&&!this._element.hasPointerCapture(t))return;this._element.releasePointerCapture(t)}catch{}}_updateNormalizedPointerLikeEvent(t,r){const i=SRe(this._element,t);return RB.test.disableSubpixelCoordinates&&(i.x=Math.round(i.x),i.y=Math.round(i.y)),r.x=i.x,r.y=i.y,r}_handleKey(t,r){const i=Wrt(r);i&&t==="key-up"&&this._keyDownState.delete(i);const s={native:r,key:i,repeat:i&&this._keyDownState.has(i)};i&&t==="key-down"&&this._keyDownState.add(s.key),this._callback(t,s)}_handlePointer(t,r){const i=this._updateNormalizedPointerLikeEvent(r,{native:r,x:0,y:0,pointerType:r.pointerType,button:r.button,buttons:r.buttons,eventId:this._eventId++});this._callback(t,i)}_handlePointerPreventDefault(t,r){const i=this._updateNormalizedPointerLikeEvent(r,{native:r,x:0,y:0,pointerType:r.pointerType,button:r.button,buttons:r.buttons,eventId:this._eventId++});r.preventDefault(),this._callback(t,i)}_handleMouseWheel(t,r){let i=r.deltaY;switch(r.deltaMode){case 0:(Ope||Mpe)&&(i=i/document.documentElement.clientHeight*600);break;case 1:i*=30;break;case 2:i*=900}Ope||Mpe?i*=.7:sdt||odt?i*=.6:ndt&&(i*=1.375);const s=100,n=Math.abs(i);n>s&&(i=i/n*200/(1+Math.exp(-.02*(n-s))));const o=this._updateNormalizedPointerLikeEvent(r,{native:r,x:0,y:0,deltaY:i});this._callback(t,o)}_handlePointerCaptureLost(t,r){this._activePointerCaptures.delete(r.pointerId),this._handleDefault(t,r)}_handleDefault(t,r){const i={native:r};r.preventDefault(),this._callback(t,i)}_preventAltKeyDefault(t){t.key==="Alt"&&t.preventDefault()}_preventMultiTouchPanning(t){t.touches.length>1&&t.preventDefault()}}RB.test={disableSubpixelCoordinates:!1};const I7={"key-down":"keydown","key-up":"keyup","pointer-down":"pointerdown","pointer-up":"pointerup","pointer-move":"pointermove","mouse-wheel":"wheel","pointer-capture-got":"gotpointercapture","pointer-capture-lost":"lostpointercapture","context-menu":"contextmenu","pointer-enter":"pointerenter","pointer-leave":"pointerleave","pointer-cancel":"pointercancel",focus:"focus",blur:"blur"};class adt extends aa{constructor(){super(!0),this.registerIncoming("context-menu",t=>{t.data.native.preventDefault()})}}function ZMe(e,t){return Math.abs(t.x-e.x)+Math.abs(t.y-e.y)}function ldt(e,t){const r=t.x-e.x,i=t.y-e.y;return Math.sqrt(r*r+i*i)}function cdt(e,t){if(t?(t.radius=0,t.center.x=0,t.center.y=0):t={radius:0,center:wf()},e.length===0)return t;if(e.length===1)return t.center.x=e[0].x,t.center.y=e[0].y,t;if(e.length===2){const[x,E]=e,[C,A]=[E.x-x.x,E.y-x.y];return t.radius=Math.sqrt(C*C+A*A)/2,t.center.x=(x.x+E.x)/2,t.center.y=(x.y+E.y)/2,t}let r=0,i=0;for(let x=0;x<e.length;x++)r+=e[x].x,i+=e[x].y;r/=e.length,i/=e.length;const s=e.map(x=>x.x-r),n=e.map(x=>x.y-i);let o=0,a=0,l=0,c=0,h=0,p=0,f=0;for(let x=0;x<s.length;x++){const E=s[x],C=n[x],A=E*E,P=C*C;o+=A,a+=P,l+=E*C,c+=A*E,h+=P*C,p+=E*P,f+=C*A}const m=.5*(c+p),g=.5*(h+f),v=o*a-l*l,w=(m*a-g*l)/v,_=(o*g-l*m)/v,T=wf(w+r,_+i);return{radius:Math.sqrt(w*w+_*_+(o+a)/e.length),center:T}}class udt extends aa{constructor(t){super(!1),this.navigationTouch=t,this.startStateModifiers=new Set,this.activePointerMap=new Map,this.isDragging=!1,this.isCurrentDragSuppressed=!1,this.drag=this.registerOutgoing("drag"),this.registerIncoming("pointer-drag",this._handlePointerDrag.bind(this)),this.registerIncoming("pointer-up",this._handlePointerUpAndPointerLost.bind(this)),this.registerIncoming("pointer-capture-lost",this._handlePointerUpAndPointerLost.bind(this)),this.registerIncoming("pointer-cancel",this._handlePointerUpAndPointerLost.bind(this))}_createPayload(t,r,i,s){return{action:t,pointerType:this.pointerType,button:this.mouseButton,buttons:r.buttons,timestamp:s,pointers:hdt(this.activePointerMap),pointer:r,angle:i.angle,radius:i.radius,center:i.center}}_addPointer(t){const r=t.native.pointerId,i=qN(this.activePointerMap).angle,s={event:t,initialAngle:0,lastAngle:0};this.activePointerMap.set(r,s);const n=tk(s,YMe(this.activePointerMap));s.initialAngle=n,s.lastAngle=n,this._updatePointerAngles(i)}_updatePointer(t){if(t&&t.x==null&&t.y==null)return;const r=t.native.pointerId,i=this.activePointerMap.get(r);i?i.event=t:this._addPointer(t)}_removePointer(t){const r=qN(this.activePointerMap).angle;this.activePointerMap.delete(t),this._updatePointerAngles(r)}_updatePointerAngles(t){const r=qN(this.activePointerMap);this.activePointerMap.forEach(i=>{i.initialAngle=tk(i,r)-t,i.lastAngle=tk(i,r)-t})}_emitEvent(t,r,i){const s=qN(this.activePointerMap);this.drag.emit(this._createPayload(t,r,s,i),void 0,this.startStateModifiers)}_handlePointerUpAndPointerLost(t){const r=t.data.native.pointerId,i=t.timestamp;this.activePointerMap.get(r)&&(this.activePointerMap.size===1?(this._updatePointer(t.data),!this.isCurrentDragSuppressed&&this._emitEvent("end",t.data,i),this.isDragging=!1,this.isCurrentDragSuppressed=!1,this._removePointer(r)):(this._removePointer(r),this._emitEvent("removed",t.data,t.timestamp)))}_handlePointerDrag(t){const r=t.data,i=r.currentEvent,s=t.timestamp;switch(r.action){case"start":case"update":this.isDragging?this.activePointerMap.has(i.native.pointerId)?(this._updatePointer(i),!this.isCurrentDragSuppressed&&this._emitEvent("update",i,s)):(this._addPointer(i),this._emitEvent("added",i,s),this.isCurrentDragSuppressed=this.isSuppressed):(this._updatePointer(i),this.pointerType=t.data.startEvent.pointerType,this.mouseButton=t.data.startEvent.button,this.startStateModifiers=t.modifiers,this.isDragging=!0,this.isCurrentDragSuppressed=this.isSuppressed,!this.isCurrentDragSuppressed&&this._emitEvent("start",i,s))}}get isSuppressed(){return this.navigationTouch&&!this.navigationTouch.browserTouchPanEnabled&&this.pointerType==="touch"&&this.activePointerMap.size===1}}function YMe(e){const t=[];return e.forEach(r=>{t.push(wf(r.event.x,r.event.y))}),cdt(t)}function qN(e){const t=YMe(e);let r=0;return e.forEach(i=>{let s=tk(i,t),n=s-i.lastAngle;for(;n>Math.PI;)n-=2*Math.PI;for(;n<-Math.PI;)n+=2*Math.PI;s=i.lastAngle+n,i.lastAngle=s,r+=s-i.initialAngle}),r/=e.size||1,{angle:r,radius:t.radius,center:t.center}}function hdt(e){const t=new Map;return e.forEach((r,i)=>t.set(i,r.event)),t}function tk(e,t){const r=e.event,i=r.x-t.center.x,s=r.y-t.center.y;return Math.atan2(s,i)}var Ppe;(function(e){e[e.Left=0]="Left",e[e.Middle=1]="Middle",e[e.Right=2]="Right",e[e.Back=3]="Back",e[e.Forward=4]="Forward",e[e.Undefined=-1]="Undefined"})(Ppe||(Ppe={}));const W_={maximumDoubleClickDelay:250,maximumDoubleClickDistance:10,maximumDoubleTouchDelay:350,maximumDoubleTouchDistance:35};class ddt extends aa{constructor(t=W_.maximumDoubleClickDelay,r=W_.maximumDoubleClickDistance,i=W_.maximumDoubleTouchDelay,s=W_.maximumDoubleTouchDistance,n=Gz){super(!1),this.maximumDoubleClickDelay=t,this.maximumDoubleClickDistance=r,this.maximumDoubleTouchDelay=i,this.maximumDoubleTouchDistance=s,this._clock=n,this._pointerState=new Map,this._click=this.registerOutgoing("click"),this._doubleClick=this.registerOutgoing("double-click"),this.registerIncoming("immediate-click",this._handleImmediateClick.bind(this)),this.registerIncoming("pointer-drag",this._handlePointerDrag.bind(this)),this.registerIncoming("drag",this._handleDrag.bind(this))}onUninstall(){this._pointerState.forEach(t=>t.doubleClickTimeout=wn(t.doubleClickTimeout))}get hasPendingInputs(){return yn(this._pointerState,t=>t.doubleClickTimeout!=null)}_pointerId(t){const r=t.native;return r.pointerType==="mouse"?`${r.pointerId}:${r.button}`:`${r.pointerType}`}_handleImmediateClick(t){const r=t.data,i=this._pointerId(r),s=this._pointerState.get(i);if(s){const n=r.native.pointerType==="touch"?this.maximumDoubleTouchDistance:this.maximumDoubleClickDistance;ZMe(s.event.data,r)>n?(this._clearDoubleClickTimeout(i,!0),this._startClick(t)):(this._clearDoubleClickTimeout(i,!1),this._doubleClick.emit(s.event.data,void 0,s.event.modifiers))}else this._startClick(t)}_startClick(t){const r=this._pointerId(t.data),i=t.data.native.pointerType==="touch"?this.maximumDoubleTouchDelay:this.maximumDoubleClickDelay;this._pointerState.set(r,{event:t,doubleClickTimeout:this._clock.setTimeout(()=>this._doubleClickTimeoutExceeded(r),i)}),this.refreshHasPendingInputs()}_handlePointerDrag(t){const r=this._pointerId(t.data.currentEvent);this._clearDoubleClickTimeout(r,!0)}_handleDrag(t){const r=this._pointerId(t.data.pointer);this._clearDoubleClickTimeout(r,!0)}_clearDoubleClickTimeout(t,r){const i=this._pointerState.get(t);i&&(i.doubleClickTimeout.remove(),i.doubleClickTimeout=null,r&&this._doubleClickTimeoutExceeded(t),this._pointerState.delete(t),this.refreshHasPendingInputs())}_doubleClickTimeoutExceeded(t){const r=this._pointerState.get(t);this._click.emit(r.event.data,void 0,r.event.modifiers),r.doubleClickTimeout=null,this._pointerState.delete(t),this.refreshHasPendingInputs()}}class pdt extends aa{constructor(t=W_.maximumDoubleClickDelay,r=W_.maximumDoubleClickDistance,i=W_.maximumDoubleTouchDelay,s=W_.maximumDoubleTouchDistance,n=Gz){super(!1),this.maximumDoubleClickDelay=t,this.maximumDoubleClickDistance=r,this.maximumDoubleTouchDelay=i,this.maximumDoubleTouchDistance=s,this._clock=n,this._pointerState=new Map,this._immediateDoubleClick=this.registerOutgoing("immediate-double-click"),this.registerIncoming("pointer-down",this._handlePointerDown.bind(this)),this.registerIncoming("pointer-up",o=>{this._handlePointerLoss(o,"pointer-up")}),this.registerIncoming("pointer-capture-lost",o=>{this._handlePointerLoss(o,"pointer-capture-lost")}),this.registerIncoming("pointer-cancel",o=>{this._handlePointerLoss(o,"pointer-cancel")})}onUninstall(){this._pointerState.forEach(t=>{t.immediateDoubleClick&&t.immediateDoubleClick.timeoutHandle.remove()}),super.onUninstall()}_handlePointerDown(t){const r=t.data,i=this._pointerId(r);if(!this._pointerState.has(i)){const s={downButton:r.native.button,immediateDoubleClick:null};this._pointerState.set(i,s),this.startCapturingPointer(r.native)}}_handlePointerLoss(t,r){const i=t.data,s=this._pointerId(i),n=this._pointerState.get(s);if(n&&r==="pointer-up"&&n.downButton===i.native.button){const o=n.immediateDoubleClick;if(o){o.timeoutHandle.remove();const a=t.data.native.pointerType==="touch"?this.maximumDoubleTouchDistance:this.maximumDoubleClickDistance;ZMe(o,t.data)>a?this._startImmediateDoubleClick(t,n):(this._immediateDoubleClick.emit(t.data,void 0,o.modifiers),this._removeState(i))}else this._startImmediateDoubleClick(t,n)}}_startImmediateDoubleClick(t,r){const i=t.data.native.pointerType==="touch"?this.maximumDoubleTouchDelay:this.maximumDoubleClickDelay;r.immediateDoubleClick={x:t.data.x,y:t.data.y,modifiers:t.modifiers,timeoutHandle:this._clock.setTimeout(()=>this._removeState(t.data),i)}}_pointerId(t){const r=t.native;return r.pointerType==="mouse"?`${r.pointerId}:${r.button}`:`${r.pointerType}`}_removeState(t){const r=this._pointerId(t);this._pointerState.delete(r),this.stopCapturingPointer(t.native),this.refreshHasPendingInputs()}}const wO={maximumClickDelay:300,movementUntilMouseDrag:1.5,movementUntilPenDrag:6,movementUntilTouchDrag:6,holdDelay:500};class fdt extends aa{constructor(t=wO.maximumClickDelay,r=wO.movementUntilMouseDrag,i=wO.movementUntilPenDrag,s=wO.movementUntilTouchDrag,n=wO.holdDelay,o=Gz){super(!1),this.maximumClickDelay=t,this.movementUntilMouseDrag=r,this.movementUntilPenDrag=i,this.movementUntilTouchDrag=s,this.holdDelay=n,this._clock=o,this._pointerState=new Map,this._pointerDrag=this.registerOutgoing("pointer-drag"),this._immediateClick=this.registerOutgoing("immediate-click"),this._pointerHold=this.registerOutgoing("hold"),this.registerIncoming("pointer-down",this._handlePointerDown.bind(this)),this.registerIncoming("pointer-up",a=>{this._handlePointerLoss(a,"pointer-up")}),this.registerIncoming("pointer-capture-lost",a=>{this._handlePointerLoss(a,"pointer-capture-lost")}),this.registerIncoming("pointer-cancel",a=>{this._handlePointerLoss(a,"pointer-cancel")}),this._moveHandle=this.registerIncoming("pointer-move",this._handlePointerMove.bind(this)),this._moveHandle.pause()}onUninstall(){this._pointerState.forEach(t=>{t.holdTimeout!=null&&(t.holdTimeout.remove(),t.holdTimeout=null)}),super.onUninstall()}_handlePointerDown(t){const r=t.data,i=r.native.pointerId;let s=null;this._pointerState.size===0&&(s=this._clock.setTimeout(()=>{const o=this._pointerState.get(i);if(o){if(!o.isDragging){const a=o.previousEvent;this._pointerHold.emit(a,void 0,t.modifiers),o.holdEmitted=!0}o.holdTimeout=null}},this.holdDelay));const n={startEvent:r,previousEvent:r,startTimestamp:t.timestamp,isDragging:!1,downButton:r.native.button,holdTimeout:s,modifiers:new Set};this._pointerState.set(i,n),this.startCapturingPointer(r.native),this._moveHandle.resume(),this._pointerState.size>1&&this._startDragging(t)}_createPointerDragData(t,r,i){return{action:t,startEvent:r.startEvent,previousEvent:r.previousEvent,currentEvent:i}}_handlePointerMove(t){const r=t.data,i=r.native.pointerId,s=this._pointerState.get(i);s&&(s.isDragging?this._pointerDrag.emit(this._createPointerDragData("update",s,r),void 0,s.modifiers):ldt(r,s.startEvent)>this._getDragThreshold(r.native.pointerType)&&this._startDragging(t),s.previousEvent=r)}_getDragThreshold(t){switch(t){case"touch":return this.movementUntilTouchDrag;case"pen":return this.movementUntilPenDrag;default:return this.movementUntilMouseDrag}}_startDragging(t){const r=t.data,i=r.native.pointerId;this._pointerState.forEach(s=>{s.holdTimeout!=null&&(s.holdTimeout.remove(),s.holdTimeout=null),s.isDragging||(s.modifiers=t.modifiers,s.isDragging=!0,i===s.startEvent.native.pointerId?this._pointerDrag.emit(this._createPointerDragData("start",s,r)):this._pointerDrag.emit(this._createPointerDragData("start",s,s.previousEvent),t.timestamp))})}_handlePointerLoss(t,r){const i=t.data,s=i.native.pointerId,n=this._pointerState.get(s);n&&(n.holdTimeout!=null&&(n.holdTimeout.remove(),n.holdTimeout=null),n.isDragging?this._pointerDrag.emit(this._createPointerDragData("end",n,r==="pointer-up"?i:n.previousEvent),void 0,n.modifiers):r==="pointer-up"&&n.downButton===i.native.button&&t.timestamp-n.startTimestamp<=this.maximumClickDelay&&!n.holdEmitted&&this._immediateClick.emit(i),this._pointerState.delete(s),this.stopCapturingPointer(i.native),this._pointerState.size===0&&this._moveHandle.pause())}}class mdt{constructor(t){this.callbacks=t,this.currentCount=0,this.callbacks.condition||(this.callbacks.condition=()=>!0)}handle(t){const r=t.data,i=r.pointers.size;switch(r.action){case"start":this.currentCount=i,this._emitStart(t);break;case"added":this._emitEnd(this.previousEvent),this.currentCount=i,this._emitStart(t);break;case"update":this._emitUpdate(t);break;case"removed":this.startEvent&&this._emitEnd(this.previousEvent),this.currentCount=i,this._emitStart(t);break;case"end":this._emitEnd(t),this.currentCount=0}this.previousEvent=t}_emitStart(t){this.startEvent=t,this.callbacks.condition(this.currentCount,t)&&this.callbacks.start(this.currentCount,t,this.startEvent)}_emitUpdate(t){this.callbacks.condition(this.currentCount,t)&&this.callbacks.update(this.currentCount,t,this.startEvent)}_emitEnd(t){this.callbacks.condition(this.currentCount,t)&&this.callbacks.end(this.currentCount,t,this.startEvent),this.startEvent=null}}class gdt extends aa{constructor(t=20,r=40){super(!1),this._threshold=t,this._maxDelta=r,this.state="ready",this.emittedArtificalEnd2=!1,this._vertical=this.registerOutgoing("vertical-two-finger-drag"),this._artificalDrag=this.registerOutgoing("drag"),this.dragEventSeparator=new mdt({start:(i,s)=>this._observeStart(i,s),update:(i,s,n)=>this._observeUpdate(i,s,n),end:(i,s)=>this._observeEnd(s)}),this.registerIncoming("drag",i=>this.dragEventSeparator.handle(i))}get failed(){return this.state==="failed"}_observeStart(t,r){t===1&&this.emittedArtificalEnd2&&(this.emittedArtificalEnd2=!1,this._artificalDrag.emit({action:"start",button:r.data.button,buttons:r.data.buttons,pointerType:r.data.pointerType,timestamp:r.data.timestamp,pointers:r.data.pointers,pointer:r.data.pointer,angle:r.data.angle,radius:r.data.radius,center:r.data.center}),r.stopPropagation()),this.state=t===2?"ready":"failed"}_observeUpdate(t,r,i){if(this.state!=="failed"&&t===2)return this.state==="active"?(this._vertical.emit({delta:r.data.center.y-this._thresholdReachedCenter.y,action:"update"}),void r.stopPropagation()):void(this._checkMovementWithinLimits(r.data,i.data)?this._checkVerticalThresholdReached(r.data,i.data)&&(this.state="active",this.emittedArtificalEnd2=!0,this._thresholdReachedCenter=r.data.center,this._artificalDrag.emit({action:"end",button:r.data.button,buttons:r.data.buttons,pointerType:r.data.pointerType,timestamp:r.data.timestamp,pointers:r.data.pointers,pointer:r.data.pointer,angle:r.data.angle,radius:r.data.radius,center:r.data.center}),this._vertical.emit({delta:r.data.center.y-this._thresholdReachedCenter.y,action:"begin"}),r.stopPropagation()):this.state="failed")}_observeEnd(t){this.state==="active"&&(this._vertical.emit({delta:t.data.center.y-this._thresholdReachedCenter.y,action:"end"}),this.state="ready",t.stopPropagation())}_checkMovementWithinLimits(t,r){let i=-1/0,s=1/0,n=-1/0,o=1/0;r.pointers.forEach(v=>{i=Math.max(i,v.x),s=Math.min(s,v.x),n=Math.max(n,v.y),o=Math.min(o,v.y)});let a=-1/0,l=1/0,c=-1/0,h=1/0;t.pointers.forEach(v=>{a=Math.max(a,v.x),l=Math.min(l,v.x),c=Math.max(c,v.y),h=Math.min(h,v.y)});const p=i-s,f=n-o,m=a-l,g=c-h;return Math.abs(t.center.x-r.center.x)<this._threshold&&Math.abs(m-p)<=this._maxDelta&&Math.abs(g-f)<=this._maxDelta}_checkVerticalThresholdReached(t,r){let i=Math.abs(t.center.y-r.center.y);return t.pointers.forEach((s,n)=>{const o=r.pointers.get(n);i=Math.min(i,Math.abs(s.y-o.y))}),i>=this._threshold}}let um=class extends xe{constructor(){super(...arguments),this._handles=new Dt}destroy(){this._handles&&(this._handles.removeAll(),this._handles=null),this.disconnect()}get primaryDragAction(){return this._get("primaryDragAction")}set primaryDragAction(e){e!=="pan"&&e!=="rotate"||e===this._get("primaryDragAction")||(this._set("primaryDragAction",e),this._updateMode())}get mode(){return this._get("mode")}set mode(e){e!=="default"&&e!=="pro"||e===this._get("mode")||(this._set("mode",e),this._updateMode())}get hasPendingInputs(){var e;return(e=this._inputManager)==null?void 0:e.hasPendingInputs}get latestPointerType(){var e;return(e=this._inputManager)==null?void 0:e.latestPointerType}get latestPointerLocation(){var e;return(e=this._inputManager)==null?void 0:e.latestPointerLocation}disconnect(){this.view.viewEvents.disconnect(),this._inputManager&&(this._inputManager.destroy(),this._inputManager=null),this._source&&(this._source.destroy(),this._source=null)}connect(){const e=this.view;this._source=new RB(this.view.surface,e.input);const t=[new pdt,new fdt,new ddt,new udt(this.view.navigation),new gdt],r=new jv({eventSource:this._source,recognizers:t});this._inputManager=r,r.installHandlers("prevent-context-menu",[new adt],p1.INTERNAL),this._modeDragPan=new Ape(e,"primary"),this._modeDragRotate=new R7(e,"secondary",Lc.CENTER),this._modeDragZoom=new sht(e,"tertiary");const i={lookAround:"b",pan:{left:"ArrowLeft",right:"ArrowRight",forward:"ArrowUp",backward:"ArrowDown",up:"u",down:"j",headingLeft:"a",headingRight:"d",tiltUp:"w",tiltDown:"s",zoomIn:"+",zoomOut:"-"},resetHeading:"n",resetTilt:"p"};r.installHandlers("navigation",[new Yht(e),new eht(e),new Vht(e),new zht(e,i.pan),new Bht(e),new Jht(e,i.resetTilt),new Qht(e,i.resetHeading),new R7(e,"primary",Lc.EYE,[i.lookAround]),new R7(e,"secondary",Lc.CENTER,[i.lookAround]),new Ape(e,"tertiary",[i.lookAround]),this._modeDragRotate,this._modeDragZoom,this._modeDragPan,new Kht(e)],p1.INTERNAL),this.view.viewEvents.connect(r),this._updateMode(),this._handles.add(te(()=>{var s;return(s=this.view.navigation)==null?void 0:s.browserTouchPanEnabled},s=>{this._source.browserTouchPanningEnabled=!s},Rt))}_updateMode(){const e=this.mode,t=this.primaryDragAction,r=SQ.get(e).get(t);this._modeDragPan&&(this._modeDragPan.pointerAction=r.pan),this._modeDragRotate&&(this._modeDragRotate.pointerAction=r.rotate),this._modeDragZoom&&(this._modeDragZoom.pointerAction=r.zoom)}get test(){return{inputManager:this._inputManager,modeDragPan:this._modeDragPan,modeDragRotate:this._modeDragRotate,modeDragZoom:this._modeDragZoom}}};u([d()],um.prototype,"view",void 0),u([d({value:"pan"})],um.prototype,"primaryDragAction",null),u([d({value:"default"})],um.prototype,"mode",null),u([d({readOnly:!0})],um.prototype,"hasPendingInputs",null),u([d()],um.prototype,"latestPointerType",null),u([d()],um.prototype,"latestPointerLocation",null),u([d()],um.prototype,"_inputManager",void 0),um=u([$("esri.views.3d.input.SceneInputManager")],um);const SQ=new Map,$7=new Map,L7=new Map;$7.set("pan",{pan:"primary",rotate:"secondary",zoom:"tertiary"}),$7.set("rotate",{pan:"secondary",rotate:"primary",zoom:"tertiary"}),L7.set("pan",{pan:"primary",rotate:"tertiary",zoom:"secondary"}),L7.set("rotate",{pan:"tertiary",rotate:"primary",zoom:"secondary"}),SQ.set("default",$7),SQ.set("pro",L7);const ydt=um;let ys=class extends xe{constructor(){super(...arguments),this.SCENEVIEW_HITTEST_RETURN_INTERSECTOR=!1,this.DECONFLICTOR_SHOW_VISIBLE=!1,this.DECONFLICTOR_SHOW_INVISIBLE=!1,this.DECONFLICTOR_SHOW_GRID=!1,this.LABELS_SHOW_BORDER=!1,this.TEXT_SHOW_BASELINE=!1,this.TEXT_SHOW_BORDER=!1,this.OVERLAY_DRAW_DEBUG_TEXTURE=!1,this.OVERLAY_SHOW_CENTER=!1,this.SHOW_POI=!1,this.TESTS_DISABLE_OPTIMIZATIONS=!1,this.TESTS_DISABLE_FAST_UPDATES=!1,this.DRAW_MESH_GEOMETRY_NORMALS=!1,this.FEATURE_TILE_FETCH_SHOW_TILES=!1,this.FEATURE_TILE_TREE_SHOW_TILES=!1,this.TERRAIN_TILE_TREE_SHOW_TILES=!1,this.I3S_TREE_SHOW_TILES=!1,this.I3S_SHOW_MODIFICATIONS=!1,this.LOD_INSTANCE_RENDERER_DISABLE_UPDATES=!1,this.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL=!1,this.EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES=!1,this.LINE_WIREFRAMES=!1}};u([d()],ys.prototype,"SCENEVIEW_HITTEST_RETURN_INTERSECTOR",void 0),u([d()],ys.prototype,"DECONFLICTOR_SHOW_VISIBLE",void 0),u([d()],ys.prototype,"DECONFLICTOR_SHOW_INVISIBLE",void 0),u([d()],ys.prototype,"DECONFLICTOR_SHOW_GRID",void 0),u([d()],ys.prototype,"LABELS_SHOW_BORDER",void 0),u([d()],ys.prototype,"TEXT_SHOW_BASELINE",void 0),u([d()],ys.prototype,"TEXT_SHOW_BORDER",void 0),u([d()],ys.prototype,"OVERLAY_DRAW_DEBUG_TEXTURE",void 0),u([d()],ys.prototype,"OVERLAY_SHOW_CENTER",void 0),u([d()],ys.prototype,"SHOW_POI",void 0),u([d()],ys.prototype,"TESTS_DISABLE_OPTIMIZATIONS",void 0),u([d()],ys.prototype,"TESTS_DISABLE_FAST_UPDATES",void 0),u([d()],ys.prototype,"DRAW_MESH_GEOMETRY_NORMALS",void 0),u([d()],ys.prototype,"FEATURE_TILE_FETCH_SHOW_TILES",void 0),u([d()],ys.prototype,"FEATURE_TILE_TREE_SHOW_TILES",void 0),u([d()],ys.prototype,"TERRAIN_TILE_TREE_SHOW_TILES",void 0),u([d()],ys.prototype,"I3S_TREE_SHOW_TILES",void 0),u([d()],ys.prototype,"I3S_SHOW_MODIFICATIONS",void 0),u([d()],ys.prototype,"LOD_INSTANCE_RENDERER_DISABLE_UPDATES",void 0),u([d()],ys.prototype,"LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL",void 0),u([d()],ys.prototype,"EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES",void 0),u([d()],ys.prototype,"LINE_WIREFRAMES",void 0),ys=u([$("esri.views.3d.support.DebugFlags")],ys);const Xr=new ys;let Bu,vC,EQ=!1,CQ=!1,AQ=!1,RQ=!1,gP=null;function vdt(e,t){if(!CQ||!vC)return;QMe();const r=vC;let i=0;for(let s=0;s<e.accBinsNumX;s++)for(let n=0;n<e.accBinsNumY;n++){const o=e.accBins[s][e.accBinsNumY-1-n];i+=o.length;const a=s*e.accBinsSizeX,l=(s+1)*e.accBinsSizeX,c=n*e.accBinsSizeY,h=(n+1)*e.accBinsSizeY;r.fillText(o.length.toFixed(),a+5,c+15),JMe(a,l,c,h,"blue")}r.fillText("total totalShownLabels: "+i,70,40),r.fillText("total visible labels: "+t.size,70,50),r.fillText("total numTests: "+e.accNumTests,70,30)}function _dt(e){AQ=Xr.DECONFLICTOR_SHOW_VISIBLE,RQ=Xr.DECONFLICTOR_SHOW_INVISIBLE,EQ=AQ||RQ,CQ=Xr.DECONFLICTOR_SHOW_GRID,gP=null,EQ||CQ?gP=()=>bdt(e):Bu&&(Bu.parentElement.removeChild(Bu),Bu=null)}function QMe(){gP&&(gP(),gP=null)}function bdt(e){Bu==null&&(Bu=document.createElement("canvas"),Bu.setAttribute("id","canvas2d"),e.surface.parentElement.style.position="relative",e.surface.parentElement.appendChild(Bu));const{state:t}=e,{camera:r,pixelRatio:i}=t,{width:s,height:n}=r,o=s*i,a=n*i;Bu.setAttribute("width",`${o}px`),Bu.setAttribute("height",`${a}px`),Bu.setAttribute("style",`position:absolute;left:0px;top:0px;display:block;pointer-events:none;width:${s}px;height:${n}px`),vC=Bu.getContext("2d"),vC.clearRect(0,0,s,n),vC.font="12px Arial"}function JMe(e,t,r,i,s){QMe();const n=Bu.height,o=vC;o.beginPath(),o.lineWidth=1,o.strokeStyle=s,o.moveTo(e,n-r),o.lineTo(t,n-r),o.stroke(),o.lineTo(t,n-i),o.stroke(),o.lineTo(t,n-r),o.stroke(),o.lineTo(e,n-r),o.stroke(),o.lineTo(e,n-r),o.stroke(),o.closePath()}function wdt(e,t){EQ&&(t&&AQ||!t&&RQ)&&JMe(e.aabr[0],e.aabr[2],e.aabr[1],e.aabr[3],t?"green":"red")}var Co,eh;(function(e){e[e.GRAPHIC=0]="GRAPHIC",e[e.LABEL=1]="LABEL",e[e._COUNT=2]="_COUNT"})(Co||(Co={})),function(e){e[e.USER_SETTING=0]="USER_SETTING",e[e.SCALE_RANGE=1]="SCALE_RANGE",e[e.FILTER=2]="FILTER",e[e.DECONFLICTION=3]="DECONFLICTION",e[e._COUNT=4]="_COUNT"}(eh||(eh={}));function KMe(e,t){return new OB(e,i3e,t)}function xdt(e,t){const{curvatureDependent:r,scaleStart:i,scaleFallOffRange:s}=i3e;return new OB(e,{curvatureDependent:{min:{curvature:r.min.curvature,tiltAngle:r.min.tiltAngle,scaleFallOffFactor:D7.curvatureDependent.min.scaleFallOffFactor},max:{curvature:r.max.curvature,tiltAngle:r.max.tiltAngle,scaleFallOffFactor:D7.curvatureDependent.max.scaleFallOffFactor}},scaleStart:i,scaleFallOffRange:s,minPixelSize:D7.minPixelSize},t)}function Tdt(e){return Math.abs(e*e*e)}function e3e(e,t,r){const i=r.parameters,s=r.paddingPixelsOverride;return xO.scale=Math.min(i.divisor/(t-i.offset),1),xO.factor=Tdt(e),xO.minPixelSize=i.minPixelSize,xO.paddingPixels=s,xO}function t3e(e,t){return e===0?t.minPixelSize:t.minPixelSize*(1+2*t.paddingPixels/e)}function tse(e,t){return Math.max(Yt(e*t.scale,e,t.factor),t3e(e,t))}function Sdt(e,t,r){const i=e3e(e,t,r);return i.minPixelSize=0,i.paddingPixels=0,tse(1,i)}function Ipe(e,t,r,i){i.scale=Sdt(e,t,r),i.factor=0,i.minPixelSize=r.parameters.minPixelSize,i.paddingPixels=r.paddingPixelsOverride}function r3e(e,t,r=[0,0]){const i=Math.min(Math.max(t.scale,t3e(e[1],t)/Math.max(1e-5,e[1])),1);return r[0]=e[0]*i,r[1]=e[1]*i,r}function Edt(e,t,r,i){return tse(e,e3e(t,r,i))}class OB{constructor(t,r,i,s=Cdt(),n){this.viewingMode=t,this.description=r,this.ellipsoidRadius=i,this.parameters=s,this._paddingPixelsOverride=n,this.viewingMode===Be.Local?(this.coverageCompensation=this._surfaceCoverageCompensationLocal,this.calculateCurvatureDependentParameters=this._calculateCurvatureDependentParametersLocal):(this.coverageCompensation=this._surfaceCoverageCompensationGlobal,this.calculateCurvatureDependentParameters=this._calculateCurvatureDependentParametersGlobal)}get paddingPixelsOverride(){return this._paddingPixelsOverride||this.parameters.paddingPixels}update(t){return(!this.parameters||this.parameters.camera.fovY!==t.fovY||this.parameters.camera.distance!==t.distance)&&(this._calculateParameters(t,this.ellipsoidRadius,this.parameters),!0)}overridePadding(t){return t!==this.paddingPixelsOverride?new OB(this.viewingMode,this.description,this.ellipsoidRadius,this.parameters,t):this}_calculateParameters(t,r,i){const{scaleStart:s,scaleFallOffRange:n,minPixelSize:o}=this.description,{fovY:a,distance:l}=t,c=this.calculateCurvatureDependentParameters(t,r),h=this.coverageCompensation(t,r,c),{tiltAngle:p,scaleFallOffFactor:f}=c,m=Math.sin(p)*l,g=.5*Math.PI-p-a*(.5-s*h),v=m/Math.cos(g),w=g+a*n*h,_=(v-f*(m/Math.cos(w)))/(1-f);return i.camera.fovY=t.fovY,i.camera.distance=t.distance,i.offset=_,i.divisor=v-_,i.minPixelSize=o,i}_calculateCurvatureDependentParametersLocal(t,r,i=$pe){return i.tiltAngle=this.description.curvatureDependent.min.tiltAngle,i.scaleFallOffFactor=this.description.curvatureDependent.min.scaleFallOffFactor,i}_calculateCurvatureDependentParametersGlobal(t,r,i=$pe){const s=this.description.curvatureDependent,n=1+t.distance/r,o=Math.sqrt(n*n-1),[a,l]=[s.min.curvature,s.max.curvature],c=Le((o-a)/(l-a),0,1),[h,p]=[s.min,s.max];return i.tiltAngle=Yt(h.tiltAngle,p.tiltAngle,c),i.scaleFallOffFactor=Yt(h.scaleFallOffFactor,p.scaleFallOffFactor,c),i}_surfaceCoverageCompensationLocal(t,r,i){return(t.fovY-i.tiltAngle)/t.fovY}_surfaceCoverageCompensationGlobal(t,r,i){const s=r*r,n=i.tiltAngle+.5*Math.PI,{fovY:o,distance:a}=t,l=a*a+s-2*Math.cos(n)*a*r,c=Math.sqrt(l),h=Math.sqrt(l-s);return(Math.acos(h/c)-Math.asin(r/(c/Math.sin(n)))+.5*o)/o}}const i3e={curvatureDependent:{min:{curvature:Ft(10),tiltAngle:Ft(12),scaleFallOffFactor:.5},max:{curvature:Ft(70),tiltAngle:Ft(40),scaleFallOffFactor:.8}},scaleStart:.3,scaleFallOffRange:.65,minPixelSize:0},D7={curvatureDependent:{min:{scaleFallOffFactor:.7},max:{scaleFallOffFactor:.95}},minPixelSize:14};function Cdt(){return{camera:{distance:0,fovY:0},divisor:0,offset:0,minPixelSize:0,paddingPixels:0}}const xO={scale:0,factor:0,minPixelSize:0,paddingPixels:0},$pe={tiltAngle:0,scaleFallOffFactor:0};function Adt(e){return e instanceof Float32Array&&e.length>=16}function Rdt(e){return Array.isArray(e)&&e.length>=16}function Odt(e){return Adt(e)||Rdt(e)}var K;(function(e){e[e.Color=0]="Color",e[e.Depth=1]="Depth",e[e.Normal=2]="Normal",e[e.Shadow=3]="Shadow",e[e.Highlight=4]="Highlight",e[e.Draped=5]="Draped",e[e.Occlusion=6]="Occlusion",e[e.Alpha=7]="Alpha",e[e.COUNT=8]="COUNT"})(K||(K={}));function rse(e){e.vertex.code.add(S`float screenSizePerspectiveMinSize(float size, vec4 factor) {
float nonZeroSize = 1.0 - step(size, 0.0);
return (
factor.z * (
1.0 +
nonZeroSize *
2.0 * factor.w / (
size + (1.0 - nonZeroSize)
)
)
);
}`),e.vertex.code.add(S`float screenSizePerspectiveViewAngleDependentFactor(float absCosAngle) {
return absCosAngle * absCosAngle * absCosAngle;
}`),e.vertex.code.add(S`vec4 screenSizePerspectiveScaleFactor(float absCosAngle, float distanceToCamera, vec4 params) {
return vec4(
min(params.x / (distanceToCamera - params.y), 1.0),
screenSizePerspectiveViewAngleDependentFactor(absCosAngle),
params.z,
params.w
);
}`),e.vertex.code.add(S`float applyScreenSizePerspectiveScaleFactorFloat(float size, vec4 factor) {
return max(mix(size * factor.x, size, factor.y), screenSizePerspectiveMinSize(size, factor));
}`),e.vertex.code.add(S`float screenSizePerspectiveScaleFloat(float size, float absCosAngle, float distanceToCamera, vec4 params) {
return applyScreenSizePerspectiveScaleFactorFloat(
size,
screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params)
);
}`),e.vertex.code.add(S`vec2 applyScreenSizePerspectiveScaleFactorVec2(vec2 size, vec4 factor) {
return mix(size * clamp(factor.x, screenSizePerspectiveMinSize(size.y, factor) / max(1e-5, size.y), 1.0), size, factor.y);
}`),e.vertex.code.add(S`vec2 screenSizePerspectiveScaleVec2(vec2 size, float absCosAngle, float distanceToCamera, vec4 params) {
return applyScreenSizePerspectiveScaleFactorVec2(size, screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params));
}`)}function Mdt(e){e.uniforms.add(new lr("screenSizePerspective",t=>s3e(t.screenSizePerspective)))}function MB(e){e.uniforms.add(new lr("screenSizePerspectiveAlignment",t=>s3e(t.screenSizePerspectiveAlignment||t.screenSizePerspective)))}function s3e(e){return Kr(Pdt,e.parameters.divisor,e.parameters.offset,e.parameters.minPixelSize,e.paddingPixelsOverride)}const Pdt=Zt();class OQ extends ss{constructor(t,r){super(t,"mat4",Vr.Draw,(i,s,n)=>i.setUniformMatrix4fv(t,r(s,n)))}}function ag(e,t){t.instancedDoublePrecision?e.constants.add("cameraPosition","vec3",dl):e.uniforms.add(new pl("cameraPosition",(r,i)=>se(n3e,i.camera.viewInverseTransposeMatrix[3]-r.origin[0],i.camera.viewInverseTransposeMatrix[7]-r.origin[1],i.camera.viewInverseTransposeMatrix[11]-r.origin[2])))}function ph(e,t){if(e.vertex.uniforms.add(new Ei("proj",(i,s)=>s.camera.projectionMatrix)),t.instancedDoublePrecision){const i=(n,o)=>se(n3e,o.camera.viewInverseTransposeMatrix[3],o.camera.viewInverseTransposeMatrix[7],o.camera.viewInverseTransposeMatrix[11]);e.vertex.uniforms.add(new Ei("view",(n,o)=>yl(Lpe,o.camera.viewMatrix,i(n,o))));const s=new St("localOrigin",i);return e.vertex.uniforms.add(s),s}e.vertex.uniforms.add(new OQ("view",(i,s)=>yl(Lpe,s.camera.viewMatrix,i.origin)));const r=new pl("localOrigin",i=>i.origin);return e.vertex.uniforms.add(r),r}const Lpe=eL(),n3e=M();function o3e(e,t){const r=e.vertex;t.hasVerticalOffset?(a3e(r),t.hasScreenSizePerspective&&(e.include(rse),MB(r),ag(e.vertex,t)),r.code.add(S`
      vec3 calculateVerticalOffset(vec3 worldPos, vec3 localOrigin) {
        float viewDistance = length((view * vec4(worldPos, 1.0)).xyz);
        ${t.spherical?S`vec3 worldNormal = normalize(worldPos + localOrigin);`:S`vec3 worldNormal = vec3(0.0, 0.0, 1.0);`}
        ${t.hasScreenSizePerspective?S`
            float cosAngle = dot(worldNormal, normalize(worldPos - cameraPosition));
            float verticalOffsetScreenHeight = screenSizePerspectiveScaleFloat(verticalOffset.x, abs(cosAngle), viewDistance, screenSizePerspectiveAlignment);`:S`
            float verticalOffsetScreenHeight = verticalOffset.x;`}
        // Screen sized offset in world space, used for example for line callouts
        float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * viewDistance, verticalOffset.z, verticalOffset.w);
        return worldNormal * worldOffset;
      }

      vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) {
        return worldPos + calculateVerticalOffset(worldPos, localOrigin);
      }
    `)):r.code.add(S`vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) { return worldPos; }`)}const Idt=Zt();function a3e(e){e.uniforms.add(new lr("verticalOffset",(t,r)=>{const{minWorldLength:i,maxWorldLength:s,screenLength:n}=t.verticalOffset,o=Math.tan(.5*r.camera.fovY)/(.5*r.camera.fullViewport[3]),a=r.camera.pixelRatio||1;return Kr(Idt,n*a,o,i,s)}))}var ud;(function(e){e[e.Occluded=0]="Occluded",e[e.NotOccluded=1]="NotOccluded",e[e.Both=2]="Both",e[e.COUNT=3]="COUNT"})(ud||(ud={}));var Wl;function l3e(e,t){e.include(rse),e.attributes.add(O.POSITION,"vec3"),e.attributes.add(O.NORMAL,"vec3"),e.attributes.add(O.AUXPOS1,"vec4");const r=e.vertex;ph(e,t),ag(r,t),r.uniforms.add([new lr("viewport",(i,s)=>s.camera.fullViewport),new qe("polygonOffset",i=>i.shaderPolygonOffset),new qe("cameraGroundRelative",(i,s)=>s.camera.aboveGround?1:-1),new qe("renderTransparentlyOccludedHUD",(i,s)=>s.renderTransparentlyOccludedHUD===ud.Occluded?1:s.renderTransparentlyOccludedHUD===ud.NotOccluded?0:.75),new Ht("hudVisibilityTexture",(i,s)=>s.hudVisibilityTexture)]),t.hasVerticalOffset&&a3e(r),r.constants.add("smallOffsetAngle","float",.984807753012208),r.code.add(S`struct ProjectHUDAux {
vec3 posModel;
vec3 posView;
vec3 vnormal;
float distanceToCamera;
float absCosAngle;
};`),r.code.add(S`float applyHUDViewDependentPolygonOffset(float pointGroundDistance, float absCosAngle, inout vec3 posView) {
float pointGroundSign = sign(pointGroundDistance);
if (pointGroundSign == 0.0) {
pointGroundSign = cameraGroundRelative;
}
float groundRelative = cameraGroundRelative * pointGroundSign;
if (polygonOffset > .0) {
float cosAlpha = clamp(absCosAngle, 0.01, 1.0);
float tanAlpha = sqrt(1.0 - cosAlpha * cosAlpha) / cosAlpha;
float factor = (1.0 - tanAlpha / viewport[2]);
if (groundRelative > 0.0) {
posView *= factor;
}
else {
posView /= factor;
}
}
return groundRelative;
}`),t.isDraped&&!t.hasVerticalOffset||r.uniforms.add(new Ei("viewNormal",(i,s)=>s.camera.viewInverseTransposeMatrix)),t.isDraped||(r.uniforms.add(new qe("perDistancePixelRatio",(i,s)=>Math.tan(s.camera.fovY/2)/(s.camera.fullViewport[2]/2))),r.code.add(S`void applyHUDVerticalGroundOffset(vec3 normalModel, inout vec3 posModel, inout vec3 posView) {
float distanceToCamera = length(posView);
float pixelOffset = distanceToCamera * perDistancePixelRatio * 0.5;
vec3 modelOffset = normalModel * cameraGroundRelative * pixelOffset;
vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;
posModel += modelOffset;
posView += viewOffset;
}`)),t.screenCenterOffsetUnitsEnabled===Wl.Screen&&r.uniforms.add(new qe("pixelRatio",(i,s)=>s.camera.pixelRatio)),t.hasScreenSizePerspective&&MB(r),r.code.add(S`
    vec4 projectPositionHUD(out ProjectHUDAux aux) {
      // centerOffset is in view space and is used to implement world size offsetting
      // of labels with respect to objects. It also pulls the label towards the viewer
      // so that the label is visible in front of the object.
      vec3 centerOffset = auxpos1.xyz;

      // The pointGroundDistance is the distance of the geometry to the ground and is
      // negative if the point is below the ground, or positive if the point is above
      // ground.
      float pointGroundDistance = auxpos1.w;

      aux.posModel = position;
      aux.posView = (view * vec4(aux.posModel, 1.0)).xyz;
      aux.vnormal = normal;
      ${t.isDraped?"":"applyHUDVerticalGroundOffset(aux.vnormal, aux.posModel, aux.posView);"}

      // Screen sized offset in world space, used for example for line callouts
      // Note: keep this implementation in sync with the CPU implementation, see
      //   - MaterialUtil.verticalOffsetAtDistance
      //   - HUDMaterial.applyVerticalOffsetTransformation

      aux.distanceToCamera = length(aux.posView);

      vec3 viewDirObjSpace = normalize(cameraPosition - aux.posModel);
      float cosAngle = dot(aux.vnormal, viewDirObjSpace);

      aux.absCosAngle = abs(cosAngle);

      ${t.hasScreenSizePerspective&&(t.hasVerticalOffset||t.screenCenterOffsetUnitsEnabled===Wl.Screen)?"vec4 perspectiveFactor = screenSizePerspectiveScaleFactor(aux.absCosAngle, aux.distanceToCamera, screenSizePerspectiveAlignment);":""}

      ${t.hasVerticalOffset?t.hasScreenSizePerspective?"float verticalOffsetScreenHeight = applyScreenSizePerspectiveScaleFactorFloat(verticalOffset.x, perspectiveFactor);":"float verticalOffsetScreenHeight = verticalOffset.x;":""}

      ${t.hasVerticalOffset?S`
            float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * aux.distanceToCamera, verticalOffset.z, verticalOffset.w);
            vec3 modelOffset = aux.vnormal * worldOffset;
            aux.posModel += modelOffset;
            vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;
            aux.posView += viewOffset;
            // Since we elevate the object, we need to take that into account
            // in the distance to ground
            pointGroundDistance += worldOffset;`:""}

      float groundRelative = applyHUDViewDependentPolygonOffset(pointGroundDistance, aux.absCosAngle, aux.posView);

      ${t.screenCenterOffsetUnitsEnabled!==Wl.Screen?S`
            // Apply x/y in view space, but z in screen space (i.e. along posView direction)
            aux.posView += vec3(centerOffset.x, centerOffset.y, 0.0);

            // Same material all have same z != 0.0 condition so should not lead to
            // branch fragmentation and will save a normalization if it's not needed
            if (centerOffset.z != 0.0) {
              aux.posView -= normalize(aux.posView) * centerOffset.z;
            }
          `:""}

      vec4 posProj = proj * vec4(aux.posView, 1.0);

      ${t.screenCenterOffsetUnitsEnabled===Wl.Screen?t.hasScreenSizePerspective?"float centerOffsetY = applyScreenSizePerspectiveScaleFactorFloat(centerOffset.y, perspectiveFactor);":"float centerOffsetY = centerOffset.y;":""}

      ${t.screenCenterOffsetUnitsEnabled===Wl.Screen?"posProj.xy += vec2(centerOffset.x, centerOffsetY) * pixelRatio * 2.0 / viewport.zw * posProj.w;":""}

      // constant part of polygon offset emulation
      posProj.z -= groundRelative * polygonOffset * posProj.w;
      return posProj;
    }
  `),r.code.add(S`bool testVisibilityHUD(vec4 posProj) {
vec4 posProjCenter = alignToPixelCenter(posProj, viewport.zw);
vec4 occlusionPixel = texture2D(hudVisibilityTexture, .5 + .5 * posProjCenter.xy / posProjCenter.w);
if (renderTransparentlyOccludedHUD > 0.5) {
return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g * renderTransparentlyOccludedHUD < 1.0;
}
return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g == 1.0;
}`)}(function(e){e[e.World=0]="World",e[e.Screen=1]="Screen",e[e.COUNT=2]="COUNT"})(Wl||(Wl={}));const WN=tn();function PB(e,t,r,i,s,n,o){if(!_L(t))if(e.boundingInfo){ft(e.primitiveType===rc.Triangle);const a=r.tolerance;c3e(e.boundingInfo,i,s,a,n,o)}else{const a=e.indices.get(O.POSITION),l=e.vertexAttributes.get(O.POSITION);xL(i,s,0,a.length/3,a,l,void 0,n,o)}}const $dt=M();function c3e(e,t,r,i,s,n){if(R(e))return;const o=h3e(t,r,$dt);if(txe(WN,e.getBBMin()),rxe(WN,e.getBBMax()),b(s)&&s.applyToAabb(WN),sse(WN,t,o,i)){const{primitiveIndices:a,indices:l,position:c}=e,h=a?a.length:l.length/3;if(h>kdt){const p=e.getChildren();if(p!==void 0){for(let f=0;f<8;++f)p[f]!==void 0&&c3e(p[f],t,r,i,s,n);return}}xL(t,r,0,h,l,c,a,s,n)}}const u3e=M();function xL(e,t,r,i,s,n,o,a,l){if(o)return Ldt(e,t,r,i,s,n,o,a,l);const c=n.data,h=n.stride||n.size,p=e[0],f=e[1],m=e[2],g=t[0]-p,v=t[1]-f,w=t[2]-m;for(let _=r,T=3*r;_<i;++_){let x=h*s[T++],E=c[x++],C=c[x++],A=c[x];x=h*s[T++];let P=c[x++],I=c[x++],L=c[x];x=h*s[T++];let k=c[x++],G=c[x++],z=c[x];b(a)&&([E,C,A]=a.applyToVertex(E,C,A,_),[P,I,L]=a.applyToVertex(P,I,L,_),[k,G,z]=a.applyToVertex(k,G,z,_));const X=P-E,Z=I-C,ce=L-A,ne=k-E,D=G-C,N=z-A,V=v*N-D*w,B=w*ne-N*g,W=g*D-ne*v,Y=X*V+Z*B+ce*W;if(Math.abs(Y)<=Number.EPSILON)continue;const H=p-E,ee=f-C,me=m-A,be=H*V+ee*B+me*W;if(Y>0){if(be<0||be>Y)continue}else if(be>0||be<Y)continue;const De=ee*ce-Z*me,ve=me*X-ce*H,ge=H*Z-X*ee,Ee=g*De+v*ve+w*ge;if(Y>0){if(Ee<0||be+Ee>Y)continue}else if(Ee>0||be+Ee<Y)continue;const Fe=(ne*De+D*ve+N*ge)/Y;Fe>=0&&l(Fe,ise(X,Z,ce,ne,D,N,u3e),_,!1)}}function Ldt(e,t,r,i,s,n,o,a,l){const c=n.data,h=n.stride||n.size,p=e[0],f=e[1],m=e[2],g=t[0]-p,v=t[1]-f,w=t[2]-m;for(let _=r;_<i;++_){const T=o[_];let x=3*T,E=h*s[x++],C=c[E++],A=c[E++],P=c[E];E=h*s[x++];let I=c[E++],L=c[E++],k=c[E];E=h*s[x];let G=c[E++],z=c[E++],X=c[E];b(a)&&([C,A,P]=a.applyToVertex(C,A,P,_),[I,L,k]=a.applyToVertex(I,L,k,_),[G,z,X]=a.applyToVertex(G,z,X,_));const Z=I-C,ce=L-A,ne=k-P,D=G-C,N=z-A,V=X-P,B=v*V-N*w,W=w*D-V*g,Y=g*N-D*v,H=Z*B+ce*W+ne*Y;if(Math.abs(H)<=Number.EPSILON)continue;const ee=p-C,me=f-A,be=m-P,De=ee*B+me*W+be*Y;if(H>0){if(De<0||De>H)continue}else if(De>0||De<H)continue;const ve=me*ne-ce*be,ge=be*Z-ne*ee,Ee=ee*ce-Z*me,Fe=g*ve+v*ge+w*Ee;if(H>0){if(Fe<0||De+Fe>H)continue}else if(Fe>0||De+Fe<H)continue;const Nr=(D*ve+N*ge+V*Ee)/H;Nr>=0&&l(Nr,ise(Z,ce,ne,D,N,V,u3e),T,!1)}}const Dpe=M(),Npe=M();function ise(e,t,r,i,s,n,o){return se(Dpe,e,t,r),se(Npe,i,s,n),ut(o,Dpe,Npe),we(o,o),o}function h3e(e,t,r){return se(r,1/(t[0]-e[0]),1/(t[1]-e[1]),1/(t[2]-e[2]))}function sse(e,t,r,i){return nse(e,t,r,i,1/0)}function nse(e,t,r,i,s){const n=(e[0]-i-t[0])*r[0],o=(e[3]+i-t[0])*r[0];let a=Math.min(n,o),l=Math.max(n,o);const c=(e[1]-i-t[1])*r[1],h=(e[4]+i-t[1])*r[1];if(l=Math.min(l,Math.max(c,h)),l<0||(a=Math.max(a,Math.min(c,h)),a>l))return!1;const p=(e[2]-i-t[2])*r[2],f=(e[5]+i-t[2])*r[2];return l=Math.min(l,Math.max(p,f)),!(l<0)&&(a=Math.max(a,Math.min(p,f)),!(a>l)&&a<s)}function d3e(e,t,r,i,s){let n=(r.screenLength||0)*e.pixelRatio;b(s)&&(n=Edt(n,i,t,s));const o=n*Math.tan(.5*e.fovY)/(.5*e.fullHeight);return Le(o*t,r.minWorldLength||0,r.maxWorldLength!=null?r.maxWorldLength:1/0)}function p3e(e,t){const r=t?p3e(t):{};for(const i in e){let s=e[i];s&&s.forEach&&(s=Fdt(s)),s==null&&i in r||(r[i]=s)}return r}function Ddt(e,t){let r=!1;for(const i in t){const s=t[i];s!==void 0&&(Array.isArray(s)?e[i]===null?(e[i]=s.slice(),r=!0):OK(e[i],s)&&(r=!0):e[i]!==s&&(r=!0,e[i]=s))}return r}function Ndt(e,t,r,i,s,n){if(!t.options.selectionMode)return;const o=e.vertexAttributes.get(O.POSITION).data,a=e.vertexAttributes.get(O.SIZE),l=a&&a.data[0],c=i[0],h=i[1],p=((l+s)/2+4)*e.screenToWorldRatio;let f=Number.MAX_VALUE,m=0;for(let g=0;g<o.length-5;g+=3){const v=o[g],w=o[g+1],_=c-v,T=h-w,x=o[g+3]-v,E=o[g+4]-w,C=Le((x*_+E*T)/(x*x+E*E),0,1),A=x*C-_,P=E*C-T,I=A*A+P*P;I<f&&(f=I,m=g/3)}f<p*p&&n(r.dist,r.normal,m,!1)}function Fdt(e){const t=[];return e.forEach(r=>t.push(r)),t}const f3e={multiply:1,ignore:2,replace:3,tint:4},kdt=1e3;class Tg extends vL{constructor(t,r){super(),this.type=Cf.Material,this.supportsEdges=!1,this._visible=!0,this._renderPriority=0,this._insertOrder=0,this._vertexAttributeLocations=zr,this._parameters=p3e(t,r),this.validateParameters(this._parameters)}dispose(){}get parameters(){return this._parameters}update(t){return!1}setParameters(t,r=!0){Ddt(this._parameters,t)&&(this.validateParameters(this._parameters),r&&this.parametersChanged())}validateParameters(t){}get visible(){return this._visible}set visible(t){t!==this._visible&&(this._visible=t,this.parametersChanged())}shouldRender(t){return this.isVisible()&&this.isVisibleInPass(t.pass)&&(this.renderOccluded&t.renderOccludedMask)!=0}isVisibleInPass(t){return!0}get renderOccluded(){return this.parameters.renderOccluded}get renderPriority(){return this._renderPriority}set renderPriority(t){t!==this._renderPriority&&(this._renderPriority=t,this.parametersChanged())}get insertOrder(){return this._insertOrder}set insertOrder(t){t!==this._insertOrder&&(this._insertOrder=t,this.parametersChanged())}get vertexAttributeLocations(){return this._vertexAttributeLocations}isVisible(){return this._visible}parametersChanged(){b(this.repository)&&this.repository.materialChanged(this)}}var Fi;(function(e){e[e.Occlude=1]="Occlude",e[e.Transparent=2]="Transparent",e[e.OccludeAndTransparent=4]="OccludeAndTransparent",e[e.OccludeAndTransparentStencil=8]="OccludeAndTransparentStencil",e[e.Opaque=16]="Opaque"})(Fi||(Fi={}));class IR extends nn{constructor(){super(...arguments),this.renderOccluded=Fi.Occlude}}function YLt(e,t,r,i,s=1){const n=r.typedBuffer,o=r.typedBufferStride,a=e.length;if(i*=o,s===1)for(let l=0;l<a;++l)n[i]=t[e[l]],i+=o;else for(let l=0;l<a;++l){const c=t[e[l]];for(let h=0;h<s;h++)n[i]=c,i+=o}}function Udt(e,t,r,i){const s=r.typedBuffer,n=r.typedBufferStride,o=e.length;i*=n;for(let a=0;a<o;++a){const l=2*e[a];s[i]=t[l],s[i+1]=t[l+1],i+=n}}function m3e(e,t,r,i,s){const n=r.typedBuffer,o=r.typedBufferStride,a=e.length;if(i*=o,s==null||s===1)for(let l=0;l<a;++l){const c=3*e[l];n[i]=t[c],n[i+1]=t[c+1],n[i+2]=t[c+2],i+=o}else for(let l=0;l<a;++l){const c=3*e[l];for(let h=0;h<s;++h)n[i]=t[c],n[i+1]=t[c+1],n[i+2]=t[c+2],i+=o}}function UA(e,t,r,i,s=1){const n=r.typedBuffer,o=r.typedBufferStride,a=e.length;if(i*=o,s===1)for(let l=0;l<a;++l){const c=4*e[l];n[i]=t[c],n[i+1]=t[c+1],n[i+2]=t[c+2],n[i+3]=t[c+3],i+=o}else for(let l=0;l<a;++l){const c=4*e[l];for(let h=0;h<s;++h)n[i]=t[c],n[i+1]=t[c+1],n[i+2]=t[c+2],n[i+3]=t[c+3],i+=o}}function IB(e,t,r,i,s,n=1){if(!r)return void m3e(e,t,i,s,n);const o=i.typedBuffer,a=i.typedBufferStride,l=e.length,c=r[0],h=r[1],p=r[2],f=r[4],m=r[5],g=r[6],v=r[8],w=r[9],_=r[10],T=r[12],x=r[13],E=r[14];if(s*=a,n===1)for(let C=0;C<l;++C){const A=3*e[C],P=t[A],I=t[A+1],L=t[A+2];o[s]=c*P+f*I+v*L+T,o[s+1]=h*P+m*I+w*L+x,o[s+2]=p*P+g*I+_*L+E,s+=a}else for(let C=0;C<l;++C){const A=3*e[C],P=t[A],I=t[A+1],L=t[A+2],k=c*P+f*I+v*L+T,G=h*P+m*I+w*L+x,z=p*P+g*I+_*L+E;for(let X=0;X<n;++X)o[s]=k,o[s+1]=G,o[s+2]=z,s+=a}}function ose(e,t,r,i,s,n=1){if(!r)return void m3e(e,t,i,s,n);const o=r,a=i.typedBuffer,l=i.typedBufferStride,c=e.length,h=o[0],p=o[1],f=o[2],m=o[4],g=o[5],v=o[6],w=o[8],_=o[9],T=o[10],x=!ite(o),E=1e-6,C=1-E;if(s*=l,n===1)for(let A=0;A<c;++A){const P=3*e[A],I=t[P],L=t[P+1],k=t[P+2];let G=h*I+m*L+w*k,z=p*I+g*L+_*k,X=f*I+v*L+T*k;if(x){const Z=G*G+z*z+X*X;if(Z<C&&Z>E){const ce=1/Math.sqrt(Z);G*=ce,z*=ce,X*=ce}}a[s+0]=G,a[s+1]=z,a[s+2]=X,s+=l}else for(let A=0;A<c;++A){const P=3*e[A],I=t[P],L=t[P+1],k=t[P+2];let G=h*I+m*L+w*k,z=p*I+g*L+_*k,X=f*I+v*L+T*k;if(x){const Z=G*G+z*z+X*X;if(Z<C&&Z>E){const ce=1/Math.sqrt(Z);G*=ce,z*=ce,X*=ce}}for(let Z=0;Z<n;++Z)a[s+0]=G,a[s+1]=z,a[s+2]=X,s+=l}}function Vdt(e,t,r,i,s,n=1){if(!r)return void UA(e,t,i,s,n);const o=r,a=i.typedBuffer,l=i.typedBufferStride,c=e.length,h=o[0],p=o[1],f=o[2],m=o[4],g=o[5],v=o[6],w=o[8],_=o[9],T=o[10],x=!ite(o),E=1e-6,C=1-E;if(s*=l,n===1)for(let A=0;A<c;++A){const P=4*e[A],I=t[P],L=t[P+1],k=t[P+2],G=t[P+3];let z=h*I+m*L+w*k,X=p*I+g*L+_*k,Z=f*I+v*L+T*k;if(x){const ce=z*z+X*X+Z*Z;if(ce<C&&ce>E){const ne=1/Math.sqrt(ce);z*=ne,X*=ne,Z*=ne}}a[s+0]=z,a[s+1]=X,a[s+2]=Z,a[s+3]=G,s+=l}else for(let A=0;A<c;++A){const P=4*e[A],I=t[P],L=t[P+1],k=t[P+2],G=t[P+3];let z=h*I+m*L+w*k,X=p*I+g*L+_*k,Z=f*I+v*L+T*k;if(x){const ce=z*z+X*X+Z*Z;if(ce<C&&ce>E){const ne=1/Math.sqrt(ce);z*=ne,X*=ne,Z*=ne}}for(let ce=0;ce<n;++ce)a[s+0]=z,a[s+1]=X,a[s+2]=Z,a[s+3]=G,s+=l}}function HV(e,t,r,i,s,n=1){const o=i.typedBuffer,a=i.typedBufferStride,l=e.length;if(s*=a,n===1){if(r===4)for(let c=0;c<l;++c){const h=4*e[c];o[s]=t[h],o[s+1]=t[h+1],o[s+2]=t[h+2],o[s+3]=t[h+3],s+=a}else if(r===3)for(let c=0;c<l;++c){const h=3*e[c];o[s]=t[h],o[s+1]=t[h+1],o[s+2]=t[h+2],o[s+3]=255,s+=a}}else if(r===4)for(let c=0;c<l;++c){const h=4*e[c];for(let p=0;p<n;++p)o[s]=t[h],o[s+1]=t[h+1],o[s+2]=t[h+2],o[s+3]=t[h+3],s+=a}else if(r===3)for(let c=0;c<l;++c){const h=3*e[c];for(let p=0;p<n;++p)o[s]=t[h],o[s+1]=t[h+1],o[s+2]=t[h+2],o[s+3]=255,s+=a}}function $B(e,t,r,i,s,n){for(const o of t.fieldNames){const a=e.vertexAttributes.get(o),l=e.indices.get(o);if(a&&l)switch(o){case O.POSITION:{ft(a.size===3);const c=s.getField(o,Zr);c&&IB(l,a.data,r,c,n);break}case O.NORMAL:{ft(a.size===3);const c=s.getField(o,Zr);c&&ose(l,a.data,i,c,n);break}case O.UV0:{ft(a.size===2);const c=s.getField(o,Hd);c&&Udt(l,a.data,c,n);break}case O.COLOR:{ft(a.size===3||a.size===4);const c=s.getField(o,uc);c&&HV(l,a.data,a.size,c,n);break}case O.SYMBOLCOLOR:{ft(a.size===3||a.size===4);const c=s.getField(o,uc);c&&HV(l,a.data,a.size,c,n);break}case O.TANGENT:{ft(a.size===4);const c=s.getField(o,oo);c&&Vdt(l,a.data,i,c,n);break}}}}function n$(e,t,r=0){const i=Le(e,0,Gdt);for(let s=0;s<4;s++)t[r+s]=Math.floor(256*jdt(i*zdt[s]))}function ase(e,t=0){let r=0;for(let i=0;i<4;i++)r+=e[t+i]*Bdt[i];return r}const zdt=[1,256,65536,16777216],Bdt=[1/256,1/65536,1/16777216,1/4294967296],Gdt=ase(new Uint8ClampedArray([255,255,255,255]));function jdt(e){return e-Math.floor(e)}function Hdt(){if(R(N7)){const e=t=>wr(`esri/libs/basisu/${t}`);N7=ie(()=>import("./basis_transcoder.13a5b8c6.js"),["basis_transcoder.13a5b8c6.js","commonjsHelpers.ce2b5698.js"],import.meta.url).then(t=>t.b).then(({default:t})=>t({locateFile:e}).then(r=>(r.initializeBasis(),delete r.then,r)))}return N7}let N7;var ox;(function(e){e[e.ETC1_RGB=0]="ETC1_RGB",e[e.ETC2_RGBA=1]="ETC2_RGBA",e[e.BC1_RGB=2]="BC1_RGB",e[e.BC3_RGBA=3]="BC3_RGBA",e[e.BC4_R=4]="BC4_R",e[e.BC5_RG=5]="BC5_RG",e[e.BC7_M6_RGB=6]="BC7_M6_RGB",e[e.BC7_M5_RGBA=7]="BC7_M5_RGBA",e[e.PVRTC1_4_RGB=8]="PVRTC1_4_RGB",e[e.PVRTC1_4_RGBA=9]="PVRTC1_4_RGBA",e[e.ASTC_4x4_RGBA=10]="ASTC_4x4_RGBA",e[e.ATC_RGB=11]="ATC_RGB",e[e.ATC_RGBA=12]="ATC_RGBA",e[e.FXT1_RGB=17]="FXT1_RGB",e[e.PVRTC2_4_RGB=18]="PVRTC2_4_RGB",e[e.PVRTC2_4_RGBA=19]="PVRTC2_4_RGBA",e[e.ETC2_EAC_R11=20]="ETC2_EAC_R11",e[e.ETC2_EAC_RG11=21]="ETC2_EAC_RG11",e[e.RGBA32=13]="RGBA32",e[e.RGB565=14]="RGB565",e[e.BGR565=15]="BGR565",e[e.RGBA4444=16]="RGBA4444"})(ox||(ox={}));let ff=null,XN=null;async function g3e(){return R(XN)&&(XN=Hdt(),ff=await XN),XN}function qdt(e,t){if(R(ff))return e.byteLength;const r=new ff.BasisFile(new Uint8Array(e)),i=v3e(r)?y3e(r.getNumLevels(0),r.getHasAlpha(),r.getImageWidth(0,0),r.getImageHeight(0,0),t):0;return r.close(),r.delete(),i}function Wdt(e,t){if(R(ff))return e.byteLength;const r=new ff.KTX2File(new Uint8Array(e)),i=_3e(r)?y3e(r.getLevels(),r.getHasAlpha(),r.getWidth(),r.getHeight(),t):0;return r.close(),r.delete(),i}function y3e(e,t,r,i,s){const n=rOe(t?ls.COMPRESSED_RGBA8_ETC2_EAC:ls.COMPRESSED_RGB8_ETC2),o=s&&e>1?(4**e-1)/(3*4**(e-1)):1;return Math.ceil(r*i*n*o)}function v3e(e){return e.getNumImages()>=1&&!e.isUASTC()}function _3e(e){return e.getFaces()>=1&&e.isETC1S()}async function Xdt(e,t,r){R(ff)&&(ff=await g3e());const i=new ff.BasisFile(new Uint8Array(r));if(!v3e(i))return null;i.startTranscoding();const s=b3e(e,t,i.getNumLevels(0),i.getHasAlpha(),i.getImageWidth(0,0),i.getImageHeight(0,0),(n,o)=>i.getImageTranscodedSizeInBytes(0,n,o),(n,o,a)=>i.transcodeImage(a,0,n,o,0,0));return i.close(),i.delete(),s}async function Zdt(e,t,r){R(ff)&&(ff=await g3e());const i=new ff.KTX2File(new Uint8Array(r));if(!_3e(i))return null;i.startTranscoding();const s=b3e(e,t,i.getLevels(),i.getHasAlpha(),i.getWidth(),i.getHeight(),(n,o)=>i.getImageTranscodedSizeInBytes(n,0,0,o),(n,o,a)=>i.transcodeImage(a,n,0,0,o,0,-1,-1));return i.close(),i.delete(),s}function b3e(e,t,r,i,s,n,o,a){const{compressedTextureETC:l,compressedTextureS3TC:c}=e.capabilities,[h,p]=l?i?[ox.ETC2_RGBA,ls.COMPRESSED_RGBA8_ETC2_EAC]:[ox.ETC1_RGB,ls.COMPRESSED_RGB8_ETC2]:c?i?[ox.BC3_RGBA,ls.COMPRESSED_RGBA_S3TC_DXT5_EXT]:[ox.BC1_RGB,ls.COMPRESSED_RGB_S3TC_DXT1_EXT]:[ox.RGBA32,ze.RGBA],f=t.hasMipmap?r:Math.min(1,r),m=[];for(let _=0;_<f;_++)m.push(new Uint8Array(o(_,h))),a(_,h,m[_]);const g=m.length>1,v=g?et.LINEAR_MIPMAP_LINEAR:et.LINEAR,w={...t,samplingMode:v,hasMipmap:g,internalFormat:p,width:s,height:n};return new nt(e,w,{type:"compressed",levels:m})}const TO=fe.getLogger("esri.views.3d.webgl-engine.lib.DDSUtil"),Ydt=542327876,Qdt=131072,Jdt=4;function lse(e){return e.charCodeAt(0)+(e.charCodeAt(1)<<8)+(e.charCodeAt(2)<<16)+(e.charCodeAt(3)<<24)}function Kdt(e){return String.fromCharCode(255&e,e>>8&255,e>>16&255,e>>24&255)}const ept=lse("DXT1"),tpt=lse("DXT3"),rpt=lse("DXT5"),ipt=31,spt=0,npt=1,opt=2,apt=3,lpt=4,cpt=7,upt=20,hpt=21;function dpt(e,t,r){const{textureData:i,internalFormat:s,width:n,height:o}=ppt(r,t.hasMipmap);return t.samplingMode=i.levels.length>1?et.LINEAR_MIPMAP_LINEAR:et.LINEAR,t.hasMipmap=i.levels.length>1,t.internalFormat=s,t.width=n,t.height=o,new nt(e,t,i)}function ppt(e,t){const r=new Int32Array(e,0,ipt);if(r[spt]!==Ydt)return TO.error("Invalid magic number in DDS header"),null;if(!(r[upt]&Jdt))return TO.error("Unsupported format, must contain a FourCC code"),null;const i=r[hpt];let s,n;switch(i){case ept:s=8,n=ls.COMPRESSED_RGB_S3TC_DXT1_EXT;break;case tpt:s=16,n=ls.COMPRESSED_RGBA_S3TC_DXT3_EXT;break;case rpt:s=16,n=ls.COMPRESSED_RGBA_S3TC_DXT5_EXT;break;default:return TO.error("Unsupported FourCC code:",Kdt(i)),null}let o=1,a=r[lpt],l=r[apt];(3&a)==0&&(3&l)==0||(TO.warn("Rounding up compressed texture size to nearest multiple of 4."),a=a+3&-4,l=l+3&-4);const c=a,h=l;let p,f;r[opt]&Qdt&&t!==!1&&(o=Math.max(1,r[cpt])),o===1||WC(a)&&WC(l)||(TO.warn("Ignoring mipmaps of non power of two sized compressed texture."),o=1);let m=r[npt]+4;const g=[];for(let v=0;v<o;++v)f=(a+3>>2)*(l+3>>2)*s,p=new Uint8Array(e,m,f),g.push(p),m+=f,a=Math.max(1,a>>1),l=Math.max(1,l>>1);return{textureData:{type:"compressed",levels:g},internalFormat:n,width:c,height:h}}class Hs extends vL{constructor(t,r){super(),this.data=t,this.type=Cf.Texture,this._glTexture=null,this._powerOfTwoStretchInfo=null,this._loadingPromise=null,this._loadingController=null,this.events=new ds,this.params=r||{},this.params.mipmap=this.params.mipmap!==!1,this.params.noUnpackFlip=this.params.noUnpackFlip||!1,this.params.preMultiplyAlpha=this.params.preMultiplyAlpha||!1,this.params.wrap=this.params.wrap||{s:xt.REPEAT,t:xt.REPEAT},this.params.powerOfTwoResizeMode=this.params.powerOfTwoResizeMode||f1.STRETCH,this.estimatedTexMemRequired=Hs._estimateTexMemRequired(this.data,this.params),this._startPreload()}_startPreload(){const t=this.data;R(t)||(t instanceof HTMLVideoElement?this._startPreloadVideoElement(t):t instanceof HTMLImageElement&&this._startPreloadImageElement(t))}_startPreloadVideoElement(t){if(!(S1(t.src)||t.preload==="auto"&&t.crossOrigin)){t.preload="auto",t.crossOrigin="anonymous";const r=!t.paused;if(t.src=t.src,r&&t.autoplay){const i=()=>{t.removeEventListener("canplay",i),t.play()};t.addEventListener("canplay",i)}}}_startPreloadImageElement(t){ug(t.src)||S1(t.src)||t.crossOrigin||(t.crossOrigin="anonymous",t.src=t.src)}static _getDataDimensions(t){return t instanceof HTMLVideoElement?{width:t.videoWidth,height:t.videoHeight}:t}static _estimateTexMemRequired(t,r){if(R(t))return 0;if(GR(t)||jw(t))return r.encoding===Hs.KTX2_ENCODING?Wdt(t,r.mipmap):r.encoding===Hs.BASIS_ENCODING?qdt(t,r.mipmap):t.byteLength;const{width:i,height:s}=t instanceof Image||t instanceof ImageData||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement?Hs._getDataDimensions(t):r;return(r.mipmap?4/3:1)*i*s*(r.components||4)||0}dispose(){this.data=void 0}get width(){return this.params.width}get height(){return this.params.height}_createDescriptor(t){var r;return{target:mt.TEXTURE_2D,pixelFormat:ze.RGBA,dataType:Ct.UNSIGNED_BYTE,wrapMode:this.params.wrap,flipped:!this.params.noUnpackFlip,samplingMode:this.params.mipmap?et.LINEAR_MIPMAP_LINEAR:et.LINEAR,hasMipmap:this.params.mipmap,preMultiplyAlpha:this.params.preMultiplyAlpha,maxAnisotropy:(r=this.params.maxAnisotropy)!=null?r:this.params.mipmap?t.parameters.maxMaxAnisotropy:1}}get glTexture(){return this._glTexture}load(t,r){if(b(this._glTexture))return this._glTexture;if(b(this._loadingPromise))return this._loadingPromise;const i=this.data;return R(i)?(this._glTexture=new nt(t,this._createDescriptor(t),null),this._glTexture):typeof i=="string"?this._loadFromURL(t,r,i):i instanceof Image?this._loadFromImageElement(t,r,i):i instanceof HTMLVideoElement?this._loadFromVideoElement(t,r,i):i instanceof ImageData||i instanceof HTMLCanvasElement?this._loadFromImage(t,i,r):(GR(i)||jw(i))&&this.params.encoding===Hs.DDS_ENCODING?(this.data=void 0,this._loadFromDDSData(t,i)):(GR(i)||jw(i))&&this.params.encoding===Hs.KTX2_ENCODING?(this.data=void 0,this._loadFromKTX2(t,i)):(GR(i)||jw(i))&&this.params.encoding===Hs.BASIS_ENCODING?(this.data=void 0,this._loadFromBasis(t,i)):jw(i)?this._loadFromPixelData(t,i):GR(i)?this._loadFromPixelData(t,new Uint8Array(i)):null}get requiresFrameUpdates(){return this.data instanceof HTMLVideoElement}frameUpdate(t,r,i){if(!(this.data instanceof HTMLVideoElement)||R(this._glTexture)||this.data.readyState<yP.HAVE_CURRENT_DATA||i===this.data.currentTime)return i;if(b(this._powerOfTwoStretchInfo)){const{framebuffer:s,vao:n,sourceTexture:o}=this._powerOfTwoStretchInfo;o.setData(this.data),this._drawStretchedTexture(t,r,s,n,o,this._glTexture)}else{const{videoWidth:s,videoHeight:n}=this.data,{width:o,height:a}=this._glTexture.descriptor;s!==o||n!==a?this._glTexture.updateData(0,0,0,Math.min(s,o),Math.min(n,a),this.data):this._glTexture.setData(this.data)}return this._glTexture.descriptor.hasMipmap&&this._glTexture.generateMipmap(),this.params.updateCallback&&this.params.updateCallback(),this.data.currentTime}_loadFromDDSData(t,r){return this._glTexture=dpt(t,this._createDescriptor(t),r),this._glTexture}_loadFromKTX2(t,r){return this._loadAsync(()=>Zdt(t,this._createDescriptor(t),r).then(i=>(this._glTexture=i,i)))}_loadFromBasis(t,r){return this._loadAsync(()=>Xdt(t,this._createDescriptor(t),r).then(i=>(this._glTexture=i,i)))}_loadFromPixelData(t,r){ft(this.params.width>0&&this.params.height>0);const i=this._createDescriptor(t);return i.pixelFormat=this.params.components===1?ze.LUMINANCE:this.params.components===3?ze.RGB:ze.RGBA,i.width=this.params.width,i.height=this.params.height,this._glTexture=new nt(t,i,r),this._glTexture}_loadFromURL(t,r,i){return this._loadAsync(async s=>{const n=await Sf(i,{signal:s});return Jt(s),this._loadFromImage(t,n,r)})}_loadFromImageElement(t,r,i){return i.complete?this._loadFromImage(t,i,r):this._loadAsync(async s=>{const n=await vbe(i,i.src,!1,s);return Jt(s),this._loadFromImage(t,n,r)})}_loadFromVideoElement(t,r,i){return i.readyState>=yP.HAVE_CURRENT_DATA?this._loadFromImage(t,i,r):this._loadFromVideoElementAsync(t,r,i)}_loadFromVideoElementAsync(t,r,i){return this._loadAsync(s=>new Promise((n,o)=>{const a=()=>{i.removeEventListener("loadeddata",l),i.removeEventListener("error",c),wn(h)},l=()=>{i.readyState>=yP.HAVE_CURRENT_DATA&&(a(),n(this._loadFromImage(t,i,r)))},c=p=>{a(),o(p||new j("Failed to load video"))};i.addEventListener("loadeddata",l),i.addEventListener("error",c);const h=Ia(s,()=>c(gr()))}))}_loadFromImage(t,r,i){const s=Hs._getDataDimensions(r);this.params.width=s.width,this.params.height=s.height;const n=this._createDescriptor(t);return n.pixelFormat=this.params.components===3?ze.RGB:ze.RGBA,!this._requiresPowerOfTwo(t,n)||WC(s.width)&&WC(s.height)?(n.width=s.width,n.height=s.height,this._glTexture=new nt(t,n,r),this._glTexture):(this._glTexture=this._makePowerOfTwoTexture(t,r,s,n,i),this._glTexture)}_loadAsync(t){const r=new AbortController;this._loadingController=r;const i=t(r.signal);this._loadingPromise=i;const s=()=>{this._loadingController===r&&(this._loadingController=null),this._loadingPromise===i&&(this._loadingPromise=null)};return i.then(s,s),i}_requiresPowerOfTwo(t,r){const i=xt.CLAMP_TO_EDGE,s=typeof r.wrapMode=="number"?r.wrapMode===i:r.wrapMode.s===i&&r.wrapMode.t===i;return!eo(t.gl)&&(r.hasMipmap||!s)}_makePowerOfTwoTexture(t,r,i,s,n){const{width:o,height:a}=i,l=qC(o),c=qC(a);let h;switch(s.width=l,s.height=c,this.params.powerOfTwoResizeMode){case f1.PAD:s.textureCoordinateScaleFactor=[o/l,a/c],h=new nt(t,s),h.updateData(0,0,0,o,a,r);break;case f1.STRETCH:case null:case void 0:h=this._stretchToPowerOfTwo(t,r,s,n());break;default:this.params.powerOfTwoResizeMode}return s.hasMipmap&&h.generateMipmap(),h}_stretchToPowerOfTwo(t,r,i,s){const n=new nt(t,i),o=new Pi(t,{colorTarget:us.TEXTURE,depthStencilTarget:Pr.NONE},n),a=new nt(t,{target:mt.TEXTURE_2D,pixelFormat:i.pixelFormat,dataType:Ct.UNSIGNED_BYTE,wrapMode:xt.CLAMP_TO_EDGE,samplingMode:et.LINEAR,flipped:!!i.flipped,maxAnisotropy:8,preMultiplyAlpha:i.preMultiplyAlpha},r),l=_l(t),c=t.getBoundFramebufferObject();return this._drawStretchedTexture(t,s,o,l,a,n),this.requiresFrameUpdates?this._powerOfTwoStretchInfo={vao:l,sourceTexture:a,framebuffer:o}:(l.dispose(!0),a.dispose(),o.detachColorTexture(),o.dispose()),t.bindFramebuffer(c),n}_drawStretchedTexture(t,r,i,s,n,o){t.bindFramebuffer(i);const a=t.getViewport();t.setViewport(0,0,o.descriptor.width,o.descriptor.height);const l=t.bindTechnique(r);l.setUniform4f("uColor",1,1,1,1),l.bindTexture("tex",n),t.bindVAO(s),t.drawArrays(Lt.TRIANGLE_STRIP,0,ta(s,"geometry")),t.bindFramebuffer(null),t.setViewport(a.x,a.y,a.width,a.height)}unload(){if(b(this._powerOfTwoStretchInfo)){const{framebuffer:t,vao:r,sourceTexture:i}=this._powerOfTwoStretchInfo;r.dispose(!0),i.dispose(),t.dispose(),this._glTexture=null,this._powerOfTwoStretchInfo=null}if(b(this._glTexture)&&(this._glTexture.dispose(),this._glTexture=null),b(this._loadingController)){const t=this._loadingController;this._loadingController=null,this._loadingPromise=null,t.abort()}this.events.emit("unloaded")}}var yP;Hs.DDS_ENCODING="image/vnd-ms.dds",Hs.KTX2_ENCODING="image/ktx2",Hs.BASIS_ENCODING="image/x.basis",function(e){e[e.HAVE_NOTHING=0]="HAVE_NOTHING",e[e.HAVE_METADATA=1]="HAVE_METADATA",e[e.HAVE_CURRENT_DATA=2]="HAVE_CURRENT_DATA",e[e.HAVE_FUTURE_DATA=3]="HAVE_FUTURE_DATA",e[e.HAVE_ENOUGH_DATA=4]="HAVE_ENOUGH_DATA"}(yP||(yP={}));const o$=128,cse=.5;function w3e(e,t=o$,r=t*cse,i=0){const s=fpt(e,t,r,i);return new Hs(s,{mipmap:!1,wrap:{s:xt.CLAMP_TO_EDGE,t:xt.CLAMP_TO_EDGE},width:t,height:t,components:4,noUnpackFlip:!0})}function fpt(e,t=o$,r=t*cse,i=0){switch(e){case"circle":default:return mpt(t,r);case"square":return gpt(t,r);case"cross":return vpt(t,r,i);case"x":return _pt(t,r,i);case"kite":return ypt(t,r);case"triangle":return bpt(t,r);case"arrow":return wpt(t,r)}}function mpt(e,t){const r=e/2-.5;return TL(e,S3e(r,r,t/2))}function gpt(e,t){return x3e(e,t,!1)}function ypt(e,t){return x3e(e,t,!0)}function vpt(e,t,r=0){return T3e(e,t,!1,r)}function _pt(e,t,r=0){return T3e(e,t,!0,r)}function bpt(e,t){return TL(e,E3e(e/2,t,t/2))}function wpt(e,t){const r=t,i=t/2,s=e/2,n=.8*r,o=S3e(s,(e-t)/2-n,Math.sqrt(n*n+i*i)),a=E3e(s,r,i);return TL(e,(l,c)=>Math.max(a(l,c),-o(l,c)))}function x3e(e,t,r){return r&&(t/=Math.SQRT2),TL(e,(i,s)=>{let n=i-.5*e+.25,o=.5*e-s-.75;if(r){const a=(n+o)/Math.SQRT2;o=(o-n)/Math.SQRT2,n=a}return Math.max(Math.abs(n),Math.abs(o))-.5*t})}function T3e(e,t,r,i=0){t-=i,r&&(t*=Math.SQRT2);const s=.5*t;return TL(e,(n,o)=>{let a,l=n-.5*e,c=.5*e-o-1;if(r){const h=(l+c)/Math.SQRT2;c=(c-l)/Math.SQRT2,l=h}return l=Math.abs(l),c=Math.abs(c),a=l>c?l>s?Math.sqrt((l-s)*(l-s)+c*c):c:c>s?Math.sqrt(l*l+(c-s)*(c-s)):l,a-=i/2,a})}function S3e(e,t,r){return(i,s)=>{const n=i-e,o=s-t;return Math.sqrt(n*n+o*o)-r}}function E3e(e,t,r){const i=Math.sqrt(t*t+r*r);return(s,n)=>{const o=Math.abs(s-e)-r,a=n-e+t/2+.75,l=(t*o+r*a)/i,c=-a;return Math.max(l,c)}}function TL(e,t){const r=new Uint8Array(4*e*e);for(let i=0;i<e;i++)for(let s=0;s<e;s++){const n=s+e*i;let o=t(s,i);o=o/e+.5,n$(o,r,4*n)}return r}class QLt extends nn{constructor(t){super(),this.slicePlaneLocalOrigin=t}}function xpt(e,t){C3e(e,t,[new St("slicePlaneOrigin",(r,i)=>M3e(t,r,i)),new St("slicePlaneBasis1",(r,i)=>{var s;return qV(t,r,i,(s=i.slicePlane)==null?void 0:s.basis1)}),new St("slicePlaneBasis2",(r,i)=>{var s;return qV(t,r,i,(s=i.slicePlane)==null?void 0:s.basis2)})])}function Ss(e,t){C3e(e,t,[new pl("slicePlaneOrigin",(r,i)=>M3e(t,r,i)),new pl("slicePlaneBasis1",(r,i)=>{var s;return qV(t,r,i,(s=i.slicePlane)==null?void 0:s.basis1)}),new pl("slicePlaneBasis2",(r,i)=>{var s;return qV(t,r,i,(s=i.slicePlane)==null?void 0:s.basis2)})])}function C3e(e,t,r){if(!t.hasSlicePlane){const o=S`#define rejectBySlice(_pos_) false
#define discardBySlice(_pos_) {}
#define highlightSlice(_color_, _pos_) (_color_)`;return t.hasSliceInVertexProgram&&e.vertex.code.add(o),void e.fragment.code.add(o)}e.extensions.add("GL_OES_standard_derivatives"),t.hasSliceInVertexProgram&&e.vertex.uniforms.add(r),e.fragment.uniforms.add(r);const i=S`struct SliceFactors {
float front;
float side0;
float side1;
float side2;
float side3;
};
SliceFactors calculateSliceFactors(vec3 pos) {
vec3 rel = pos - slicePlaneOrigin;
vec3 slicePlaneNormal = -cross(slicePlaneBasis1, slicePlaneBasis2);
float slicePlaneW = -dot(slicePlaneNormal, slicePlaneOrigin);
float basis1Len2 = dot(slicePlaneBasis1, slicePlaneBasis1);
float basis2Len2 = dot(slicePlaneBasis2, slicePlaneBasis2);
float basis1Dot = dot(slicePlaneBasis1, rel);
float basis2Dot = dot(slicePlaneBasis2, rel);
return SliceFactors(
dot(slicePlaneNormal, pos) + slicePlaneW,
-basis1Dot - basis1Len2,
basis1Dot - basis1Len2,
-basis2Dot - basis2Len2,
basis2Dot - basis2Len2
);
}
bool sliceByFactors(SliceFactors factors) {
return factors.front < 0.0
&& factors.side0 < 0.0
&& factors.side1 < 0.0
&& factors.side2 < 0.0
&& factors.side3 < 0.0;
}
bool sliceEnabled() {
return dot(slicePlaneBasis1, slicePlaneBasis1) != 0.0;
}
bool sliceByPlane(vec3 pos) {
return sliceEnabled() && sliceByFactors(calculateSliceFactors(pos));
}
#define rejectBySlice(_pos_) sliceByPlane(_pos_)
#define discardBySlice(_pos_) { if (sliceByPlane(_pos_)) discard; }`,s=S`vec4 applySliceHighlight(vec4 color, vec3 pos) {
SliceFactors factors = calculateSliceFactors(pos);
const float HIGHLIGHT_WIDTH = 1.0;
const vec4 HIGHLIGHT_COLOR = vec4(0.0, 0.0, 0.0, 0.3);
factors.front /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.front);
factors.side0 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side0);
factors.side1 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side1);
factors.side2 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side2);
factors.side3 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side3);
if (sliceByFactors(factors)) {
return color;
}
float highlightFactor = (1.0 - step(0.5, factors.front))
* (1.0 - step(0.5, factors.side0))
* (1.0 - step(0.5, factors.side1))
* (1.0 - step(0.5, factors.side2))
* (1.0 - step(0.5, factors.side3));
return mix(color, vec4(HIGHLIGHT_COLOR.rgb, color.a), highlightFactor * HIGHLIGHT_COLOR.a);
}`,n=t.hasSliceHighlight?S`
        ${s}
        #define highlightSlice(_color_, _pos_) (sliceEnabled() ? applySliceHighlight(_color_, _pos_) : (_color_))
      `:S`#define highlightSlice(_color_, _pos_) (_color_)`;t.hasSliceInVertexProgram&&e.vertex.code.add(i),e.fragment.code.add(i),e.fragment.code.add(n)}function A3e(e,t,r){return e.instancedDoublePrecision?se(Tpt,r.camera.viewInverseTransposeMatrix[3],r.camera.viewInverseTransposeMatrix[7],r.camera.viewInverseTransposeMatrix[11]):t.slicePlaneLocalOrigin}function R3e(e,t){return b(e)?pe(WV,t.origin,e):t.origin}function O3e(e,t,r){return e.hasSliceTranslatedView?b(t)?yl(Spt,r.camera.viewMatrix,t):r.camera.viewMatrix:null}function M3e(e,t,r){if(R(r.slicePlane))return dl;const i=A3e(e,t,r),s=R3e(i,r.slicePlane),n=O3e(e,i,r);return b(n)?Ve(WV,s,n):s}function qV(e,t,r,i){if(R(i)||R(r.slicePlane))return dl;const s=A3e(e,t,r),n=R3e(s,r.slicePlane),o=O3e(e,s,r);return b(o)?(de(SO,i,n),Ve(WV,n,o),Ve(SO,SO,o),pe(SO,SO,WV)):i}const Tpt=M(),WV=M(),SO=M(),Spt=Ce();function Ept(e,t){const{vertex:r,fragment:i}=e;t.hasMultipassGeometry&&r.include(OOe),t.hasMultipassTerrain&&e.varyings.add("depth","float"),r.code.add(S`
  void main(void) {
    vec4 posProjCenter;
    if (dot(position, position) > 0.0) {
      // Render single point to center of the pixel to avoid subpixel
      // filtering to affect the marker color
      ProjectHUDAux projectAux;
      vec4 posProj = projectPositionHUD(projectAux);
      posProjCenter = alignToPixelCenter(posProj, viewport.zw);

      ${t.hasMultipassGeometry?S`
        // Don't draw vertices behind geometry
        if(geometryDepthTest(.5 + .5 * posProjCenter.xy / posProjCenter.w, projectAux.posView.z)){
          posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
        }`:""}

      ${t.hasMultipassTerrain?"depth = projectAux.posView.z;":""}
      vec3 vpos = projectAux.posModel;
      if (rejectBySlice(vpos)) {
        // Project out of clip space
        posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
      }

    } else {
      // Project out of clip space
      posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
    }

    gl_Position = posProjCenter;
    gl_PointSize = 1.0;
  }
  `),t.hasMultipassTerrain&&i.include(xh),t.hasMultipassTerrain&&i.uniforms.add([new Ht("terrainDepthTexture",(s,n)=>n.multipassTerrain.linearDepthTexture),new _r("nearFar",(s,n)=>n.camera.nearFar),new _r("inverseViewport",(s,n)=>n.inverseViewport)]),i.include(hu),i.code.add(S`
  void main() {
    gl_FragColor = vec4(1, 1, 1, 1);
    ${t.hasMultipassTerrain?S`
          vec2 uv = gl_FragCoord.xy * inverseViewport;

          //Read the rgba data from the texture linear depth
          vec4 terrainDepthData = texture2D(terrainDepthTexture, uv);

          float terrainDepth = linearDepthFromFloat(rgba2float(terrainDepthData), nearFar);

          //If HUD vertex is behind terrain and the terrain depth is not the initialize value (e.g. we are not looking at the sky)
          //Mark the HUD vertex as occluded by transparent terrain
          if(depth < terrainDepth && terrainDepthData != vec4(0,0,0,1)){
            gl_FragColor.g = 0.5;
          }`:""}
  }
  `)}const Cpt=xr(1,1,0,1),P3e=xr(1,0,1,1);function D0(e){e.fragment.uniforms.add(new Ht("depthTex",(t,r)=>r.highlightDepthTexture)),e.fragment.uniforms.add(new _r("highlightViewportPixelSz",(t,r)=>r.inverseViewport)),e.fragment.constants.add("occludedHighlightFlag","vec4",Cpt).add("unoccludedHighlightFlag","vec4",P3e),e.fragment.code.add(S`void outputHighlight() {
vec4 fragCoord = gl_FragCoord;
float sceneDepth = texture2D(depthTex, fragCoord.xy * highlightViewportPixelSz.xy).r;
if (fragCoord.z > sceneDepth + 5e-7) {
gl_FragColor = occludedHighlightFlag;
}
else {
gl_FragColor = unoccludedHighlightFlag;
}
}`)}class LB extends ss{constructor(t,r,i){super(t,"vec4",Vr.Pass,(s,n,o)=>s.setUniform4fv(t,r(n,o)),i)}}class Ea extends ss{constructor(t,r,i){super(t,"float",Vr.Pass,(s,n,o)=>s.setUniform1fv(t,r(n,o)),i)}}class SL extends ss{constructor(t,r){super(t,"mat3",Vr.Pass,(i,s,n)=>i.setUniformMatrix3fv(t,r(s,n)))}}class use extends IR{constructor(){super(...arguments),this.vvSizeEnabled=!1,this.vvSizeMinSize=Ue(1,1,1),this.vvSizeMaxSize=Ue(100,100,100),this.vvSizeOffset=Ue(0,0,0),this.vvSizeFactor=Ue(1,1,1),this.vvSizeValue=Ue(1,1,1),this.vvColorEnabled=!1,this.vvColorValues=[0,0,0,0,0,0,0,0],this.vvColorColors=[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],this.vvOpacityEnabled=!1,this.vvOpacityValues=[0,0,0,0,0,0,0,0],this.vvOpacityOpacities=[1,1,1,1,1,1,1,1],this.vvSymbolAnchor=[0,0,0],this.vvSymbolRotationMatrix=$i()}}const mf=8;function _C(e,t){t.hasVvInstancing&&(t.vvSize||t.vvColor)&&e.attributes.add(O.INSTANCEFEATUREATTRIBUTE,"vec4");const r=e.vertex;t.vvSize?(r.uniforms.add(new St("vvSizeMinSize",i=>i.vvSizeMinSize)),r.uniforms.add(new St("vvSizeMaxSize",i=>i.vvSizeMaxSize)),r.uniforms.add(new St("vvSizeOffset",i=>i.vvSizeOffset)),r.uniforms.add(new St("vvSizeFactor",i=>i.vvSizeFactor)),r.uniforms.add(new SL("vvSymbolRotationMatrix",i=>i.vvSymbolRotationMatrix)),r.uniforms.add(new St("vvSymbolAnchor",i=>i.vvSymbolAnchor)),r.code.add(S`vec3 vvScale(vec4 _featureAttribute) {
return clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize);
}
vec4 vvTransformPosition(vec3 position, vec4 _featureAttribute) {
return vec4(vvSymbolRotationMatrix * ( vvScale(_featureAttribute) * (position + vvSymbolAnchor)), 1.0);
}`),r.code.add(S`
      const float eps = 1.192092896e-07;
      vec4 vvTransformNormal(vec3 _normal, vec4 _featureAttribute) {
        vec3 vvScale = clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize + eps, vvSizeMaxSize);
        return vec4(vvSymbolRotationMatrix * _normal / vvScale, 1.0);
      }

      ${t.hasVvInstancing?S`
      vec4 vvLocalNormal(vec3 _normal) {
        return vvTransformNormal(_normal, instanceFeatureAttribute);
      }

      vec4 localPosition() {
        return vvTransformPosition(position, instanceFeatureAttribute);
      }`:""}
    `)):r.code.add(S`vec4 localPosition() { return vec4(position, 1.0); }
vec4 vvLocalNormal(vec3 _normal) { return vec4(_normal, 1.0); }`),t.vvColor?(r.constants.add("vvColorNumber","int",mf),t.hasVvInstancing&&r.uniforms.add([new Ea("vvColorValues",i=>i.vvColorValues,mf),new LB("vvColorColors",i=>i.vvColorColors,mf)]),r.code.add(S`
      vec4 vvGetColor(vec4 featureAttribute, float values[vvColorNumber], vec4 colors[vvColorNumber]) {
        float value = featureAttribute.y;
        if (value <= values[0]) {
          return colors[0];
        }

        for (int i = 1; i < vvColorNumber; ++i) {
          if (values[i] >= value) {
            float f = (value - values[i-1]) / (values[i] - values[i-1]);
            return mix(colors[i-1], colors[i], f);
          }
        }
        return colors[vvColorNumber - 1];
      }

      ${t.hasVvInstancing?S`
      vec4 vvColor() {
        return vvGetColor(instanceFeatureAttribute, vvColorValues, vvColorColors);
      }`:""}
    `)):r.code.add(S`vec4 vvColor() { return vec4(1.0); }`)}const XV=.1,sa=.001;function Apt(e){const t=new Yr,r=e.signedDistanceFieldEnabled;if(t.include(Pie),t.include(l3e,e),t.include(Ss,e),e.output===K.Occlusion)return t.include(Ept,e),t;const{vertex:i,fragment:s}=t;t.include(rse),s.include(hu),s.include(wg),t.include(_C,e),t.varyings.add("vcolor","vec4"),t.varyings.add("vtc","vec2"),t.varyings.add("vsize","vec2"),e.binaryHighlightOcclusionEnabled&&t.varyings.add("voccluded","float"),i.uniforms.add([new lr("viewport",(c,h)=>h.camera.fullViewport),new _r("screenOffset",(c,h)=>vr(I3e,2*c.screenOffset[0]*h.camera.pixelRatio,2*c.screenOffset[1]*h.camera.pixelRatio)),new _r("anchorPosition",c=>ZV(c)),new lr("materialColor",c=>c.color),new qe("pixelRatio",(c,h)=>h.camera.pixelRatio)]),r&&(i.uniforms.add(new lr("outlineColor",c=>c.outlineColor)),s.uniforms.add([new lr("outlineColor",c=>Fpe(c)?c.outlineColor:jm),new qe("outlineSize",c=>Fpe(c)?c.outlineSize:0)])),e.hasScreenSizePerspective&&(Mdt(i),MB(i)),(e.debugDrawLabelBorder||e.binaryHighlightOcclusionEnabled)&&t.varyings.add("debugBorderCoords","vec4"),t.attributes.add(O.UV0,"vec2"),t.attributes.add(O.COLOR,"vec4"),t.attributes.add(O.SIZE,"vec2"),t.attributes.add(O.AUXPOS2,"vec4"),i.code.add(S`
    void main(void) {
      ProjectHUDAux projectAux;
      vec4 posProj = projectPositionHUD(projectAux);

      if (rejectBySlice(projectAux.posModel)) {
        // Project outside of clip plane
        gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
        return;
      }
      vec2 inputSize;
      ${e.hasScreenSizePerspective?S`
      inputSize = screenSizePerspectiveScaleVec2(size, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspective);
      vec2 screenOffsetScaled = screenSizePerspectiveScaleVec2(screenOffset, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);
         `:S`
      inputSize = size;
      vec2 screenOffsetScaled = screenOffset;`}

      ${e.vvSize?"inputSize *= vvScale(auxpos2).xx;":""}

      vec2 combinedSize = inputSize * pixelRatio;
      vec4 quadOffset = vec4(0.0);

      ${e.occlusionTestEnabled||e.binaryHighlightOcclusionEnabled?"bool visible = testVisibilityHUD(posProj);":""}

      ${e.binaryHighlightOcclusionEnabled?"voccluded = visible ? 0.0 : 1.0;":""}
    `);const n=S`vec2 uv01 = floor(uv0);
vec2 uv = uv0 - uv01;
quadOffset.xy = ((uv01 - anchorPosition) * 2.0 * combinedSize + screenOffsetScaled) / viewport.zw * posProj.w;`,o=e.pixelSnappingEnabled?r?S`posProj = alignToPixelOrigin(posProj, viewport.zw) + quadOffset;`:S`posProj += quadOffset;
if (inputSize.x == size.x) {
posProj = alignToPixelOrigin(posProj, viewport.zw);
}`:S`posProj += quadOffset;`;e.vvColor&&i.uniforms.add([new LB("vvColorColors",c=>c.vvColorColors,mf),new Ea("vvColorValues",c=>c.vvColorValues,mf)]),i.uniforms.add(new _r("textureCoordinateScaleFactor",c=>b(c.texture)&&b(c.texture.descriptor.textureCoordinateScaleFactor)?c.texture.descriptor.textureCoordinateScaleFactor:PTe)),i.code.add(S`
    ${e.occlusionTestEnabled?"if (visible) {":""}
    ${n}
    ${e.vvColor?"vcolor = vvGetColor(auxpos2, vvColorValues, vvColorColors) * materialColor;":"vcolor = color / 255.0 * materialColor;"}

    bool alphaDiscard = vcolor.a < ${S.float(sa)};
    ${r?`alphaDiscard = alphaDiscard && outlineColor.a < ${S.float(sa)};`:""}
    if (alphaDiscard) {
      // "early discard" if both symbol color (= fill) and outline color (if applicable) are transparent
      gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
      return;
    } else {
      ${o}
      gl_Position = posProj;
    }

    vtc = uv * textureCoordinateScaleFactor;

    ${e.debugDrawLabelBorder?"debugBorderCoords = vec4(uv01, 1.5 / combinedSize);":""}
    vsize = inputSize;
    ${e.occlusionTestEnabled?S`} else { vtc = vec2(0.0);
      ${e.debugDrawLabelBorder?"debugBorderCoords = vec4(0.5, 0.5, 1.5 / combinedSize);}":"}"}`:""}
  }
  `),s.uniforms.add(new Ht("tex",c=>c.texture));const a=e.debugDrawLabelBorder?S`(isBorder > 0.0 ? 0.0 : ${S.float(XV)})`:S.float(XV),l=S`
    ${e.debugDrawLabelBorder?S`
      float isBorder = float(any(lessThan(debugBorderCoords.xy, debugBorderCoords.zw)) || any(greaterThan(debugBorderCoords.xy, 1.0 - debugBorderCoords.zw)));`:""}

    ${r?S`
      vec4 fillPixelColor = vcolor;

      // Attempt to sample texel centers to avoid that thin cross outlines
      // disappear with large symbol sizes.
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/7058#issuecomment-603041
      const float txSize = ${S.float(o$)};
      const float texelSize = 1.0 / txSize;
      // Calculate how much we have to add/subtract to/from each texel to reach the size of an onscreen pixel
      vec2 scaleFactor = (vsize - txSize) * texelSize;
      vec2 samplePos = vtc + (vec2(1.0, -1.0) * texelSize) * scaleFactor;

      // Get distance and map it into [-0.5, 0.5]
      float d = rgba2float(texture2D(tex, samplePos)) - 0.5;

      // Distance in output units (i.e. pixels)
      float dist = d * vsize.x;

      // Create smooth transition from the icon into its outline
      float fillAlphaFactor = clamp(0.5 - dist, 0.0, 1.0);
      fillPixelColor.a *= fillAlphaFactor;

      if (outlineSize > 0.25) {
        vec4 outlinePixelColor = outlineColor;
        float clampedOutlineSize = min(outlineSize, 0.5*vsize.x);

        // Create smooth transition around outline
        float outlineAlphaFactor = clamp(0.5 - (abs(dist) - 0.5*clampedOutlineSize), 0.0, 1.0);
        outlinePixelColor.a *= outlineAlphaFactor;

        if (
          outlineAlphaFactor + fillAlphaFactor < ${a} ||
          fillPixelColor.a + outlinePixelColor.a < ${S.float(sa)}
        ) {
          discard;
        }

        // perform un-premultiplied over operator (see https://en.wikipedia.org/wiki/Alpha_compositing#Description)
        float compositeAlpha = outlinePixelColor.a + fillPixelColor.a * (1.0 - outlinePixelColor.a);
        vec3 compositeColor = vec3(outlinePixelColor) * outlinePixelColor.a +
          vec3(fillPixelColor) * fillPixelColor.a * (1.0 - outlinePixelColor.a);

        gl_FragColor = vec4(compositeColor, compositeAlpha);
      } else {
        if (fillAlphaFactor < ${a}) {
          discard;
        }

        gl_FragColor = premultiplyAlpha(fillPixelColor);
      }

      // visualize SDF:
      // gl_FragColor = vec4(clamp(-dist/vsize.x*2.0, 0.0, 1.0), clamp(dist/vsize.x*2.0, 0.0, 1.0), 0.0, 1.0);
      `:S`
          vec4 texColor = texture2D(tex, vtc, -0.5);
          if (texColor.a < ${a}) {
            discard;
          }
          gl_FragColor = texColor * premultiplyAlpha(vcolor);
          `}

    // Draw debug border with transparency, so that original texels along border are still partially visible
    ${e.debugDrawLabelBorder?S`gl_FragColor = mix(gl_FragColor, vec4(1.0, 0.0, 1.0, 1.0), isBorder * 0.5);`:""}
  `;return e.output===K.Alpha&&s.code.add(S`
      void main() {
        ${l}
        gl_FragColor = vec4(gl_FragColor.a);
      }
      `),e.output===K.Color&&s.code.add(S`
    void main() {
      ${l}
      ${e.transparencyPassType===yt.FrontFace?"gl_FragColor.rgb /= gl_FragColor.a;":""}
    }
    `),e.output===K.Highlight&&(t.include(D0),s.code.add(S`
    void main() {
      ${l}
      ${e.binaryHighlightOcclusionEnabled?S`
          if (voccluded == 1.0) {
            gl_FragColor = vec4(1.0, 1.0, 0.0, 1.0);
          } else {
            gl_FragColor = vec4(1.0, 0.0, 1.0, 1.0);
          }`:"outputHighlight();"}
    }
    `)),t}function Fpe(e){return e.outlineColor[3]>0&&e.outlineSize>0}function ZV(e,t=I3e){return e.textureIsSignedDistanceField?Rpt(e.anchorPosition,e.distanceFieldBoundingBox,t):Do(t,e.anchorPosition),t}function Rpt(e,t,r){b(t)?vr(r,e[0]*(t[2]-t[0])+t[0],e[1]*(t[3]-t[1])+t[1]):vr(r,0,0)}const I3e=rt(),Opt=Object.freeze(Object.defineProperty({__proto__:null,build:Apt,calculateAnchorPosForRendering:ZV},Symbol.toStringTag,{value:"Module"})),fh=No(Ae.SRC_ALPHA,Ae.ONE,Ae.ONE_MINUS_SRC_ALPHA,Ae.ONE_MINUS_SRC_ALPHA),Mpt=bg(Ae.ONE,Ae.ONE),$3e=bg(Ae.ZERO,Ae.ONE_MINUS_SRC_ALPHA);function N0(e){return e===yt.FrontFace?null:e===yt.Alpha?$3e:Mpt}function DB(e){return e===yt.FrontFace?cc:null}const NB=5e5,FB={factor:-1,units:-2};function kB(e){return e?FB:null}function eb(e,t=_i.LESS){return e===yt.NONE||e===yt.FrontFace?t:_i.LEQUAL}class EL extends gi{initializeConfiguration(t,r){r.spherical=t.viewingMode===Be.Global}initializeProgram(t){const r=EL.shader.get().build(this.configuration);return new oi(t.rctx,r,zr)}_setPipelineState(t){const r=this.configuration,i=t===yt.NONE,s=t===yt.FrontFace,n=this.configuration.hasPolygonOffset&&Ppt,o=(i||s)&&r.output!==K.Highlight?(r.depthEnabled||r.output===K.Occlusion)&&cc:null;return Gt({blending:r.output===K.Color||r.output===K.Alpha||r.output===K.Highlight?i?Ipt:N0(t):null,depthTest:{func:_i.LEQUAL},depthWrite:o,colorWrite:or,polygonOffset:n})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}get primitiveType(){return this.configuration.output===K.Occlusion?Lt.POINTS:Lt.TRIANGLES}}EL.shader=new ni(Opt,()=>ie(()=>import("./HUDMaterial.glsl.b01835e6.js"),[],import.meta.url));const Ppt={factor:0,units:-4},Ipt=bg(Ae.ONE,Ae.ONE_MINUS_SRC_ALPHA);class Ca extends vl{}u([q({constValue:!0})],Ca.prototype,"hasSliceHighlight",void 0),u([q({constValue:!1})],Ca.prototype,"hasSliceInVertexProgram",void 0),u([q({constValue:!1})],Ca.prototype,"instancedDoublePrecision",void 0),u([q({constValue:!1})],Ca.prototype,"isGround",void 0),u([q({constValue:Vr.Pass})],Ca.prototype,"pbrTextureBindType",void 0);class Vs extends Ca{constructor(){super(...arguments),this.output=K.Color,this.screenCenterOffsetUnitsEnabled=Wl.World,this.transparencyPassType=yt.NONE,this.spherical=!1,this.occlusionTestEnabled=!0,this.signedDistanceFieldEnabled=!1,this.vvSize=!1,this.vvColor=!1,this.hasVerticalOffset=!1,this.hasScreenSizePerspective=!1,this.debugDrawLabelBorder=!1,this.binaryHighlightOcclusionEnabled=!0,this.hasSlicePlane=!1,this.hasPolygonOffset=!1,this.depthEnabled=!0,this.pixelSnappingEnabled=!0,this.isDraped=!1,this.hasMultipassGeometry=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1}}u([q({count:K.COUNT})],Vs.prototype,"output",void 0),u([q({count:Wl.COUNT})],Vs.prototype,"screenCenterOffsetUnitsEnabled",void 0),u([q({count:yt.COUNT})],Vs.prototype,"transparencyPassType",void 0),u([q()],Vs.prototype,"spherical",void 0),u([q()],Vs.prototype,"occlusionTestEnabled",void 0),u([q()],Vs.prototype,"signedDistanceFieldEnabled",void 0),u([q()],Vs.prototype,"vvSize",void 0),u([q()],Vs.prototype,"vvColor",void 0),u([q()],Vs.prototype,"hasVerticalOffset",void 0),u([q()],Vs.prototype,"hasScreenSizePerspective",void 0),u([q()],Vs.prototype,"debugDrawLabelBorder",void 0),u([q()],Vs.prototype,"binaryHighlightOcclusionEnabled",void 0),u([q()],Vs.prototype,"hasSlicePlane",void 0),u([q()],Vs.prototype,"hasPolygonOffset",void 0),u([q()],Vs.prototype,"depthEnabled",void 0),u([q()],Vs.prototype,"pixelSnappingEnabled",void 0),u([q()],Vs.prototype,"isDraped",void 0),u([q()],Vs.prototype,"hasMultipassGeometry",void 0),u([q()],Vs.prototype,"hasMultipassTerrain",void 0),u([q()],Vs.prototype,"cullAboveGround",void 0),u([q({constValue:!0})],Vs.prototype,"hasSliceInVertexProgram",void 0),u([q({constValue:!1})],Vs.prototype,"hasVvInstancing",void 0);class VA extends Tg{constructor(t){super(t,new Bpt),this.techniqueConfig=new Vs}getConfiguration(t,r){return this.techniqueConfig.output=t,this.techniqueConfig.hasSlicePlane=this.parameters.hasSlicePlane,this.techniqueConfig.hasVerticalOffset=!!this.parameters.verticalOffset,this.techniqueConfig.hasScreenSizePerspective=!!this.parameters.screenSizePerspective,this.techniqueConfig.screenCenterOffsetUnitsEnabled=this.parameters.centerOffsetUnits==="screen"?Wl.Screen:Wl.World,this.techniqueConfig.hasPolygonOffset=this.parameters.polygonOffset,this.techniqueConfig.isDraped=this.parameters.isDraped,this.techniqueConfig.occlusionTestEnabled=this.parameters.occlusionTest,this.techniqueConfig.pixelSnappingEnabled=this.parameters.pixelSnappingEnabled,this.techniqueConfig.signedDistanceFieldEnabled=this.parameters.textureIsSignedDistanceField,this.techniqueConfig.vvSize=!!this.parameters.vvSizeEnabled,this.techniqueConfig.vvColor=!!this.parameters.vvColorEnabled,t===K.Color&&(this.techniqueConfig.debugDrawLabelBorder=!!this.parameters.debugDrawLabelBorder),t===K.Highlight&&(this.techniqueConfig.binaryHighlightOcclusionEnabled=this.parameters.binaryHighlightOcclusion),this.techniqueConfig.depthEnabled=this.parameters.depthEnabled,this.techniqueConfig.transparencyPassType=r.transparencyPassType,this.techniqueConfig.hasMultipassGeometry=r.multipassGeometry.enabled,this.techniqueConfig.hasMultipassTerrain=r.multipassTerrain.enabled,this.techniqueConfig.cullAboveGround=r.multipassTerrain.cullAboveGround,this.techniqueConfig}intersect(t,r,i,s,n,o,a,l,c){b(c)?this._intersectDrapedHudGeometry(t,o,a,l,c):this._intersectHudGeometry(t,r,i,s,a,l)}_intersectDrapedHudGeometry(t,r,i,s,n){const o=t.vertexAttributes.get(O.POSITION),a=t.vertexAttributes.get(O.SIZE),l=this.parameters,c=ZV(l);let h=1,p=1;if(b(s)){const m=s(Vpe);h=m[0],p=m[5]}h*=t.screenToWorldRatio,p*=t.screenToWorldRatio;const f=Vpt*t.screenToWorldRatio;for(let m=0;m<o.data.length/o.size;m++){const g=m*o.size,v=o.data[g],w=o.data[g+1],_=m*a.size;let T;ev[0]=a.data[_]*h,ev[1]=a.data[_+1]*p,l.textureIsSignedDistanceField&&(T=l.outlineSize*t.screenToWorldRatio/2),kpe(r,v,w,ev,f,T,l,c)&&i(n.dist,n.normal,-1,!1)}}_intersectHudGeometry(t,r,i,s,n,o){if(!s.options.selectionMode||!s.options.hud||_L(r))return;const a=this.parameters;let l=1,c=1;if(Gd(k7,i),b(o)){const T=o(Vpe);l=T[0],c=T[5],Dpt(k7)}const h=t.vertexAttributes.get(O.POSITION),p=t.vertexAttributes.get(O.SIZE),f=t.vertexAttributes.get(O.NORMAL),m=t.vertexAttributes.get(O.AUXPOS1);ft(h.size>=3);const g=s.point,v=s.camera,w=ZV(a);l*=v.pixelRatio,c*=v.pixelRatio;const _=this.parameters.centerOffsetUnits==="screen";for(let T=0;T<h.data.length/h.size;T++){const x=T*h.size;se(pa,h.data[x],h.data[x+1],h.data[x+2]),Ve(pa,pa,i);const E=T*p.size;ev[0]=p.data[E]*l,ev[1]=p.data[E+1]*c,Ve(pa,pa,v.viewMatrix);const C=T*m.size;if(se(yu,m.data[C+0],m.data[C+1],m.data[C+2]),!_&&(pa[0]+=yu[0],pa[1]+=yu[1],yu[2]!==0)){const P=yu[2];we(yu,pa),pe(pa,pa,le(yu,yu,P))}const A=T*f.size;if(se(EO,f.data[A],f.data[A+1],f.data[A+2]),this._normalAndViewAngle(EO,k7,v,U7),this._applyVerticalOffsetTransformationView(pa,U7,v,F7),v.applyProjection(pa,za),za[0]>-1){za[0]=Math.floor(za[0]),za[1]=Math.floor(za[1]),_&&(yu[0]||yu[1])&&(za[0]+=yu[0],yu[1]!==0&&(za[1]+=tse(yu[1],F7.factorAlignment)),v.unapplyProjection(za,pa)),za[0]+=this.parameters.screenOffset[0],za[1]+=this.parameters.screenOffset[1],r3e(ev,F7.factor,ev);const P=Upt*v.pixelRatio;let I;if(a.textureIsSignedDistanceField&&(I=a.outlineSize*v.pixelRatio/2),kpe(g,za[0],za[1],ev,P,I,a,w)){const L=s.ray;if(Ve(Upe,pa,Cs(kpt,v.viewMatrix)),za[0]=g[0],za[1]=g[1],v.unprojectFromRenderScreen(za,pa)){const k=M();ae(k,L.direction);const G=1/Re(k);le(k,k,G),n(pi(L.origin,pa)*G,k,-1,!0,1,Upe)}}}}}computeAttachmentOrigin(t,r){const i=t.vertexAttributes;if(!i)return!1;const s=i.get(O.POSITION),n=t.indices.get(O.POSITION);return VOe(s,n,r)}createBufferWriter(){return new jpt(this)}_normalAndViewAngle(t,r,i,s){return Odt(r)&&(r=Gd(Fpt,r)),Hc(s.normal,t,r),Ve(s.normal,s.normal,i.viewInverseTransposeMatrix),s.cosAngle=Te(D3e,zpt),s}_updateScaleInfo(t,r,i){const s=this.parameters;b(s.screenSizePerspective)?Ipe(i,r,s.screenSizePerspective,t.factor):(t.factor.scale=1,t.factor.factor=0,t.factor.minPixelSize=0,t.factor.paddingPixels=0),b(s.screenSizePerspectiveAlignment)?Ipe(i,r,s.screenSizePerspectiveAlignment,t.factorAlignment):(t.factorAlignment.factor=t.factor.factor,t.factorAlignment.scale=t.factor.scale,t.factorAlignment.minPixelSize=t.factor.minPixelSize,t.factorAlignment.paddingPixels=t.factor.paddingPixels)}applyShaderOffsetsView(t,r,i,s,n,o,a){const l=this._normalAndViewAngle(r,i,n,U7);return this._applyVerticalGroundOffsetView(t,l,n,a),this._applyVerticalOffsetTransformationView(a,l,n,o),this._applyPolygonOffsetView(a,l,s[3],n,a),this._applyCenterOffsetView(a,s,a),a}applyShaderOffsetsNDC(t,r,i,s,n){return this._applyCenterOffsetNDC(t,r,i,s),b(n)&&ae(n,s),this._applyPolygonOffsetNDC(s,r,i,s),s}_applyPolygonOffsetView(t,r,i,s,n){const o=s.aboveGround?1:-1;let a=Math.sign(i);a===0&&(a=o);const l=o*a;if(this.parameters.shaderPolygonOffset<=0)return ae(n,t);const c=Le(Math.abs(r.cosAngle),.01,1),h=1-Math.sqrt(1-c*c)/c/s.viewport[2];return le(n,t,l>0?h:1/h),n}_applyVerticalGroundOffsetView(t,r,i,s){const n=Re(t),o=i.aboveGround?1:-1,a=.5*i.computeRenderPixelSizeAtDist(n),l=le(pa,r.normal,o*a);return de(s,t,l),s}_applyVerticalOffsetTransformationView(t,r,i,s){const n=this.parameters;if(!n.verticalOffset||!n.verticalOffset.screenLength){if(n.screenSizePerspective||n.screenSizePerspectiveAlignment){const c=Re(t);this._updateScaleInfo(s,c,r.cosAngle)}else s.factor.scale=1,s.factorAlignment.scale=1;return t}const o=Re(t),a=_t(n.screenSizePerspectiveAlignment,n.screenSizePerspective),l=d3e(i,o,n.verticalOffset,r.cosAngle,a);return this._updateScaleInfo(s,o,r.cosAngle),le(r.normal,r.normal,l),de(t,t,r.normal)}_applyCenterOffsetView(t,r,i){const s=this.parameters.centerOffsetUnits!=="screen";return i!==t&&ae(i,t),s&&(i[0]+=r[0],i[1]+=r[1],r[2]&&(we(EO,i),de(i,i,le(EO,EO,r[2])))),i}_applyCenterOffsetNDC(t,r,i,s){const n=this.parameters.centerOffsetUnits!=="screen";return s!==t&&ae(s,t),n||(s[0]+=r[0]/i.fullWidth*2,s[1]+=r[1]/i.fullHeight*2),s}_applyPolygonOffsetNDC(t,r,i,s){const n=this.parameters.shaderPolygonOffset;if(t!==s&&ae(s,t),n){const o=i.aboveGround?1:-1,a=o*Math.sign(r[3]);s[2]-=(a||o)*n}return s}requiresSlot(t){if(t===Se.DRAPED_MATERIAL)return!0;const{drawInSecondSlot:r,occlusionTest:i}=this.parameters;return t===(r?Se.LABEL_MATERIAL:Se.HUD_MATERIAL)||i&&t===Se.OCCLUSION_PIXELS}createGLMaterial(t){return t.output===K.Color||t.output===K.Alpha?new $pt(t):t.output===K.Highlight?new L3e(t):null}calculateRelativeScreenBounds(t,r,i=Ut()){return Lpt(this.parameters,t,r,i),i[2]=i[0]+t[0],i[3]=i[1]+t[1],i}}class L3e extends mie{constructor(t){super({...t,...t.material.parameters})}selectProgram(t){return this.ensureTechnique(EL,t)}beginSlot(t){return this.updateTexture(this._material.parameters.textureId),this._material.setParameters(this.textureBindParameters),this.selectProgram(t)}}class $pt extends L3e{_isOcclusionSlot(t){return t.slot===Se.OCCLUSION_PIXELS&&this._material.parameters.occlusionTest&&(this._output===K.Color||this._output===K.Alpha)}selectProgram(t){return this.ensureTechnique(EL,t,this._isOcclusionSlot(t)?K.Occlusion:this._output)}}function Lpt(e,t,r,i=Npt){return Do(i,e.anchorPosition),i[0]*=-t[0],i[1]*=-t[1],i[0]+=e.screenOffset[0]*r,i[1]+=e.screenOffset[1]*r,i}function Dpt(e){const t=e[0],r=e[1],i=e[2],s=e[3],n=e[4],o=e[5],a=e[6],l=e[7],c=e[8],h=1/Math.sqrt(t*t+r*r+i*i),p=1/Math.sqrt(s*s+n*n+o*o),f=1/Math.sqrt(a*a+l*l+c*c);return e[0]=t*h,e[1]=r*h,e[2]=i*h,e[3]=s*p,e[4]=n*p,e[5]=o*p,e[6]=a*f,e[7]=l*f,e[8]=c*f,e}function kpe(e,t,r,i,s,n,o,a){let l=t-s-(a[0]>0?i[0]*a[0]:0),c=l+i[0]+2*s,h=r-s-(a[1]>0?i[1]*a[1]:0),p=h+i[1]+2*s;const f=o.distanceFieldBoundingBox;return o.textureIsSignedDistanceField&&b(f)&&(l+=i[0]*f[0],h+=i[1]*f[1],c-=i[0]*(1-f[2]),p-=i[1]*(1-f[3]),l-=n,c+=n,h-=n,p+=n),e[0]>l&&e[0]<c&&e[1]>h&&e[1]<p}const F7={factor:{scale:0,factor:0,minPixelSize:0,paddingPixels:0},factorAlignment:{scale:0,factor:0,minPixelSize:0,paddingPixels:0}},Npt=rt(),pa=M(),EO=M(),za=Zt(),D3e=M(),Upe=M(),k7=$i(),Fpt=$i(),kpt=Ce(),yu=M(),U7={normal:D3e,cosAngle:0},Vpe=Ce(),Upt=1,Vpt=2,ev=[0,0],zpt=Ue(0,0,1);class Bpt extends yOe{constructor(){super(...arguments),this.renderOccluded=Fi.Occlude,this.color=[1,1,1,1],this.texCoordScale=[1,1],this.polygonOffset=!1,this.anchorPosition=Fr(.5,.5),this.screenOffset=[0,0],this.shaderPolygonOffset=1e-5,this.textureIsSignedDistanceField=!1,this.outlineColor=[1,1,1,1],this.outlineSize=0,this.vvSizeEnabled=!1,this.vvSizeMinSize=[1,1,1],this.vvSizeMaxSize=[100,100,100],this.vvSizeOffset=[0,0,0],this.vvSizeFactor=[1,1,1],this.vvColorEnabled=!1,this.vvColorValues=[0,0,0,0,0,0,0,0],this.vvColorColors=[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],this.hasSlicePlane=!1,this.pixelSnappingEnabled=!0,this.occlusionTest=!0,this.binaryHighlightOcclusion=!0,this.debugDrawLabelBorder=!1,this.centerOffsetUnits="world",this.drawInSecondSlot=!1,this.depthEnabled=!0,this.isDraped=!1}}const Gpt=ps().vec3f(O.POSITION).vec3f(O.NORMAL).vec2f(O.UV0).vec4u8(O.COLOR).vec2f(O.SIZE).vec4f(O.AUXPOS1).vec4f(O.AUXPOS2);class jpt{constructor(t){this.material=t,this.vertexBufferLayout=Gpt}allocate(t){return this.vertexBufferLayout.createBuffer(t)}elementCount(t){return 6*t.indices.get(O.POSITION).length}write(t,r,i,s){IB(r.indices.get(O.POSITION),r.vertexAttributes.get(O.POSITION).data,t.transformation,i.position,s,6),ose(r.indices.get(O.NORMAL),r.vertexAttributes.get(O.NORMAL).data,t.invTranspTransformation,i.normal,s,6);{const n=r.vertexAttributes.get(O.UV0).data;let o,a,l,c;if(n==null||n.length<4){const m=this.material.parameters;o=0,a=0,l=m.texCoordScale[0],c=m.texCoordScale[1]}else o=n[0],a=n[1],l=n[2],c=n[3];l=Math.min(1.99999,l+1),c=Math.min(1.99999,c+1);const h=r.indices.get(O.POSITION).length,p=i.uv0;let f=s;for(let m=0;m<h;++m)p.set(f,0,o),p.set(f,1,a),f+=1,p.set(f,0,l),p.set(f,1,a),f+=1,p.set(f,0,l),p.set(f,1,c),f+=1,p.set(f,0,l),p.set(f,1,c),f+=1,p.set(f,0,o),p.set(f,1,c),f+=1,p.set(f,0,o),p.set(f,1,a),f+=1}HV(r.indices.get(O.COLOR),r.vertexAttributes.get(O.COLOR).data,4,i.color,s,6);{const n=r.indices.get(O.SIZE),o=r.vertexAttributes.get(O.SIZE).data,a=n.length,l=i.size;let c=s;for(let h=0;h<a;++h){const p=o[2*n[h]],f=o[2*n[h]+1];for(let m=0;m<6;++m)l.set(c,0,p),l.set(c,1,f),c+=1}}r.indices.get(O.AUXPOS1)&&r.vertexAttributes.get(O.AUXPOS1)&&UA(r.indices.get(O.AUXPOS1),r.vertexAttributes.get(O.AUXPOS1).data,i.auxpos1,s,6),r.indices.get(O.AUXPOS2)&&r.vertexAttributes.get(O.AUXPOS2)&&UA(r.indices.get(O.AUXPOS2),r.vertexAttributes.get(O.AUXPOS2).data,i.auxpos2,s,6)}}const Lf=M(),MS=Zt(),CO=Zt(),V7=M(),Hpt=Ce(),qpt=kn(),z7=Ro(),Wpt=M(),Xpt=Ut();class Zpt{constructor(){this.aabr=Ut(),this.distance=0,this.culled=!1,this.visible=!1}}class Ypt{constructor(t,r,i={}){this.graphics3DGraphic=t,this.slicePlaneEnabled=r,this.info=i}}class Qpt{constructor(){this.active=new Map,this.visible=new Map}clear(){this.active.clear(),this.visible.clear()}}class Jpt{}class Kpt{constructor(){this.sortArray=new Xt({allocator:t=>t||new Jpt})}}var Mc;(function(e){e[e.Idle=0]="Idle",e[e.Process=1]="Process",e[e.Sort=2]="Sort",e[e.Deconflict=3]="Deconflict",e[e.NumStates=4]="NumStates"})(Mc||(Mc={}));class N3e{constructor(){this.camera=new ii,this.slicePlane=Q1(),this.slicePlaneEnabled=!1}copyFrom(t){this.camera.copyFrom(t.camera),KT(t.slicePlane,this.slicePlane),this.slicePlaneEnabled=t.slicePlaneEnabled}}let BE=class extends xe{constructor(){super(...arguments),this._dirty=!1,this._runningViewState=new N3e,this._state=Mc.Idle,this.graphics=new Qpt,this.iterators=new Kpt,this.accBinsNumX=15,this.accBinsNumY=20,this.accBinsSizeX=0,this.accBinsSizeY=0,this.accBins=null,this.accNumTests=0}get dirty(){return this._dirty}get state(){return this._state}destroy(){this.graphics.clear(),this.iterators=null}setDirty(){!this._dirty&&this.graphics.active.size>0&&(this._dirty=!0,this.notifyChange("updating"))}get updating(){return this._state!==Mc.Idle||this._dirty}get updatingProgress(){if(!this.updating)return 1;const e=this._state/Mc.NumStates;return this._dirty?.5*e:e}get running(){return this.view.ready&&this.view.state!=null&&this.updating}runTask(e){switch(this._state){case Mc.Idle:this._startUpdate(),e.madeProgress();case Mc.Process:if(this._state=Mc.Process,!this._processActiveGraphics(e))return;case Mc.Sort:if(this._state=Mc.Sort,!this._sortVisibleGraphics(e))return;case Mc.Deconflict:if(this._state=Mc.Deconflict,!this._deconflictVisibleGraphics(e))return;default:vdt(this,this.graphics.visible),this._state=Mc.Idle,this.notifyChange("updating")}}modifyGraphics(e,t){t?e.forEach(r=>this.addToActiveGraphics(r)):e.forEach(r=>this.removeFromActiveGraphics(r)),this.setDirty()}layerSupportsDeconfliction(e){if(R(e)||e.type!=="object3d")return!1;const t=e.stageObject;return(t?t.geometryRecords.length:0)!==1?!1:t.geometryRecords[0].material instanceof VA}_startUpdate(){_dt(this.view),this._dirty=!1,this._runningViewState.copyFrom(this.viewState);const{fullWidth:e,fullHeight:t}=this._runningViewState.camera;this._initBins(e,t),this._resetIterators()}addToActiveGraphics(e){e.info[this.visibilityGroup]=new Zpt,this.graphics.active.set(e.graphics3DGraphic.graphic.uid,e),this.setDirty()}removeFromActiveGraphics(e){this._removeFromVisibleGraphics(e),eft(e,this.visibilityGroup),delete e.info[this.visibilityGroup],this.graphics.active.delete(e.graphics3DGraphic.graphic.uid),this.setDirty()}_addToVisibleGraphics(e){this.graphics.visible.set(e.graphics3DGraphic.graphic.uid,e)}_removeFromVisibleGraphics(e){this.graphics.visible.delete(e.graphics3DGraphic.graphic.uid)}_processActiveGraphics(e){const t=this._ensureActiveGraphicsIterator(),r=Cs(Hpt,this._runningViewState.camera.projectionMatrix),i=this.view.viewingMode==="global"&&this.view.map.ground.opacity===1&&this._runningViewState.camera.relativeElevation>0?qpt:null;let s=0;for(b(i)&&(Ve(i,dl,this._runningViewState.camera.viewMatrix),i[3]=Ar(this.view.spatialReference).radius,s=qTe(i,dl));!e.done;){e.madeProgress();const n=t.next();if(n.done===!0)return this._resetActiveGraphicsIterator(),!0;const o=n.value,a=o&&o.info[this.visibilityGroup];a&&(this._collectGraphics3DGraphics(o,r,i,s),a.culled?this._removeFromVisibleGraphics(o):this._addToVisibleGraphics(o))}return!1}_sortVisibleGraphics(e){const t=this._ensureSortGraphicsIterator();for(;!e.done;){const r=t.next();if(e.madeProgress(),r.done===!0)return this._resetSortGraphicsIterator(),!0}return!1}_deconflictVisibleGraphics(e){const t=this._ensureVisibleGraphicsIterator(),r=this.visibilityGroup===Co.LABEL;for(;!e.done;){e.madeProgress();const i=t.next();if(i.done===!0)return this._resetVisibleGraphicsIterator(),!0;const s=i.value,n=s.info[this.visibilityGroup];if(!n||n.culled)continue;const o=s.graphics3DGraphic,a=(!r||o.isVisible())&&!this._isConflicted(s);a&&this._addToBins(s),n.visible=a,this._setGraphicVisibility(s,a),wdt(n,a)}return!1}_resetIterators(){this.iterators.active=null,this.iterators.visible=null,this.iterators.sort=null}_ensureActiveGraphicsIterator(){return this.iterators.active||(this.iterators.active=zpe(this.graphics.active)),this.iterators.active}_resetActiveGraphicsIterator(){this.iterators.active=null}_ensureVisibleGraphicsIterator(){return this.iterators.visible||(this.iterators.visible=zpe(this.graphics.visible)),this.iterators.visible}_resetVisibleGraphicsIterator(){this.iterators.visible=null}_ensureSortGraphicsIterator(){return this.iterators.sort||(this.iterators.sort=tft(this.graphics.visible,this.iterators.sortArray,this.visibilityGroup)),this.iterators.sort}_resetSortGraphicsIterator(){this.iterators.sort=null}_collectGraphics3DGraphics(e,t,r,i){const s=e.graphics3DGraphic;if(s.destroyed)return;const n=e.info[this.visibilityGroup];if(!s.isVisible(Co.GRAPHIC,eh.DECONFLICTION))return void(n.culled=!0);const o=this.getGraphicsLayers(s);vh(n.aabr);let a=null;for(const l of o){if(!this.layerSupportsDeconfliction(l))continue;const c=l.stageObject.geometryRecords[0].material;if(R(a)){if(a=this._getProjectionInfo(l,t,sft),a.isOutsideScreen||this._isCulledBySlice(e,Lf)||b(r)&&this._isCulledByHorizon(a,r,i))return void(n.culled=!0);!Xr.TESTS_DISABLE_OPTIMIZATIONS&&n.visible&&(a.distance*=.7)}this._expandBoundingRect(n,l,c,a)}R(a)?n.culled=!0:(n.distance=a.distance,n.culled=!1)}_getProjectionInfo(e,t,r){const i=this._runningViewState.camera,s=e.stageObject,n=s.geometryRecords[0],o=n.material,a=s.boundingVolumeWorldSpace.bounds;Ve(Lf,a,i.viewMatrix);const l=n.geometry.vertexAttributes,c=l.get(O.NORMAL).data,h=l.get(O.AUXPOS1).data;return o.applyShaderOffsetsView(Lf,c,s.transformation,h,i,r.scaleInfo,Lf),Kr(MS,Lf[0],Lf[1],Lf[2],1),ih(CO,MS,i.projectionMatrix),le(r.positionNDC,CO,1/CO[3]),o.applyShaderOffsetsNDC(r.positionNDC,h,i,r.positionNDC,V7),r.distanceWithoutPolygonOffset=i.depthNDCToWorld(V7[2]),r.distance=V7[2]===r.positionNDC[2]?r.distanceWithoutPolygonOffset:i.depthNDCToWorld(r.positionNDC[2]),Kr(CO,r.positionNDC[0],r.positionNDC[1],r.positionNDC[2],1),ih(MS,CO,t),H$(MS,MS,1/MS[3]),se(r.positionView,Lf[0],Lf[1],Lf[2]),r}_isCulledByHorizon(e,t,r){return ae(z7.direction,e.positionView),se(z7.origin,0,0,0),!!Y1(t,z7,Wpt)&&e.distanceWithoutPolygonOffset>r}_isCulledBySlice(e,t){return e.slicePlaneEnabled&&this._runningViewState.slicePlaneEnabled&&wte(this._runningViewState.slicePlane,t)}_expandBoundingRect(e,t,r,{positionNDC:i,scaleInfo:s}){const n=this._runningViewState.camera,o=t.getScreenSize(rft);r3e(o,s.factor,o),o[0]*=n.pixelRatio,o[1]*=n.pixelRatio;const a=MU(r.calculateRelativeScreenBounds(o,s.factorAlignment.scale,Xpt),Yt(0,n.fullWidth,.5+.5*i[0]),Yt(0,n.fullHeight,.5+.5*i[1])),l=this.iconMarginFactor;if(l!==0){const c=l*Math.min(Ju(a),xf(a));a[0]-=c,a[1]-=c,a[2]+=c,a[3]+=c}Dx(e.aabr,a,e.aabr)}_isConflicted(e){const t=e.graphics3DGraphic.graphic.uid,r=e.info[this.visibilityGroup];for(let i=Math.floor(r.aabr[0]/this.accBinsSizeX);i<=Math.floor(r.aabr[2]/this.accBinsSizeX);i++)if(!(i<0||i>=this.accBinsNumX))for(let s=Math.floor(r.aabr[1]/this.accBinsSizeY);s<=Math.floor(r.aabr[3]/this.accBinsSizeY);s++){if(s<0||s>=this.accBinsNumY)continue;const n=this.accBins[i][s];for(let o=0;o<n.length;o++){const a=n.data[o],l=a.info[this.visibilityGroup];if(l&&l.visible&&a.graphics3DGraphic.graphic.uid!==t&&(this.accNumTests++,X$(l.aabr,r.aabr)))return!0}}return!1}_initBins(e,t){if(this.accBins==null){this.accBins=[];for(let r=0;r<this.accBinsNumX;r++){this.accBins.push([]);const i=this.accBins[this.accBins.length-1];for(let s=0;s<this.accBinsNumY;s++)i.push(new Xt)}}else for(let r=0;r<this.accBinsNumX;r++)for(let i=0;i<this.accBinsNumY;i++)this.accBins[r][i].clear();this.accBinsSizeX=e/this.accBinsNumX,this.accBinsSizeY=t/this.accBinsNumY,this.accNumTests=0}_addToBins(e){const t=e.info[this.visibilityGroup],r=Math.floor(t.aabr[0]/this.accBinsSizeX),i=Math.floor(t.aabr[2]/this.accBinsSizeX),s=Math.floor(t.aabr[1]/this.accBinsSizeY),n=Math.floor(t.aabr[3]/this.accBinsSizeY);for(let o=r;o<=i;o++)if(!(o<0||o>=this.accBinsNumX))for(let a=s;a<=n;a++)a<0||a>=this.accBinsNumY||this.accBins[o][a].push(e)}_setGraphicVisibility(e,t){const r=e.graphics3DGraphic;r.destroyed||(r.setVisibilityFlag(eh.DECONFLICTION,t,this.visibilityGroup),this.visibilityGroup===Co.LABEL&&this.view.labeler.setLabelGraphicVisibility(r,t))}};function eft(e,t){const r=e.graphics3DGraphic;r.destroyed||r.clearVisibilityFlag(eh.DECONFLICTION,t)}function*zpe(e){if(Map.prototype.entries){const t=e.entries();for(let r=t.next();!r.done;r=t.next())yield r.value[1]}else yield*e.values()}function*tft(e,t,r){t.clear(),e.forEach((s,n)=>{const o=t.pushNew();o.id=n,o.prio=s.info?-s.info[r].distance:Number.MAX_VALUE}),yield;const i=t.iterableSort((s,n)=>n.prio-s.prio);for(let s=i.next();!s.done;s=i.next())yield;t.forAll(s=>{const n=e.get(s.id);n&&(e.delete(s.id),e.set(s.id,n))}),t.clear()}u([d({constructOnly:!0})],BE.prototype,"view",void 0),u([d({type:Boolean,readOnly:!0})],BE.prototype,"updating",null),BE=u([$("esri.views.3d.layers.graphics.Deconflictor")],BE);const rft=rt();class ift{constructor(){this.positionView=M(),this.positionNDC=M(),this.distance=0,this.distanceWithoutPolygonOffset=0,this.scaleInfo={factor:{scale:0,factor:0,minPixelSize:0,paddingPixels:0},factorAlignment:{scale:0,factor:0,minPixelSize:0,paddingPixels:0}}}get isOutsideScreen(){const t=this.positionNDC;return t[0]<-1||t[1]<-1||t[2]<-1||t[0]>=1||t[1]>=1}}const sft=new ift,nft=2e3;let rk=class extends BE{constructor(){super(...arguments),this.visibilityGroup=Co.LABEL,this.iconMarginFactor=0,this._lastDeconfliction=0}get viewState(){return this.parent.viewState}runTask(e){if(this.parent.running)return;const t=performance.now();(e.state===Yn.IDLE||t-this._lastDeconfliction>nft)&&(super.runTask(e),this.state===Mc.Idle&&(this._lastDeconfliction=t))}enabledChanged(e,t){this.modifyGraphics(t,e.labelsEnabled)}getGraphicsLayers(e){return e.labelGraphics}};u([d({constructOnly:!0})],rk.prototype,"parent",void 0),rk=u([$("esri.views.3d.layers.graphics.LabelDeconflictor")],rk);let MQ=class extends BE{constructor(){super(...arguments),this._handles=new Dt,this._contexts=new Map,this._viewState=new N3e,this.visibilityGroup=Co.GRAPHIC,this._iconMarginFactor=-.1}get labels(){return this._labels}get viewState(){return this._viewState}initialize(){this._handles.add([te(()=>{var e,t;return(t=(e=this.view)==null?void 0:e.state)==null?void 0:t.camera},()=>{this._updateViewState(),this.setDirty()}),te(()=>{var e,t,r;return(r=(t=(e=this.view)==null?void 0:e.map)==null?void 0:t.ground)==null?void 0:r.opacity},(e,t)=>{e!==1&&t!==1||this.setDirty()}),te(()=>{var e;return(e=this.view)==null?void 0:e.slicePlane},()=>{this._updateSlicePlane(),this._slicePlaneChanged()},Rt)]),this._frameTask=this.view.resourceController.scheduler.registerTask(vt.GRAPHICS_DECONFLICTOR,this),this._labels=new rk({view:this.view,parent:this})}destroy(){this._labels.destroy(),this._labels=null,this._handles.destroy(),this._handles=null,this._frameTask&&(this._frameTask.remove(),this._frameTask=null)}get iconMarginFactor(){return this._iconMarginFactor}set iconMarginFactor(e){this._iconMarginFactor=e,this.setDirty()}setDirty(){this._contexts.size>0&&(super.setDirty(),this._labels.setDirty())}runTask(e){super.runTask(e),this.running||this._labels.setDirty()}setInitialIconVisibilityFlag(e,t){const r=!(this._graphicSupportsDeconfliction(t)&&B7(e));t.setVisibilityFlag(eh.DECONFLICTION,r,Co.GRAPHIC)}_updateViewState(){this.view&&this.view.state&&(this._viewState.camera.copyFrom(this.view.state.camera),this._updateSlicePlane())}_updateSlicePlane(){const e=this.view?this.view.slicePlane:null;b(e)&&aSe(e,this._viewState.camera.viewMatrix,this._viewState.slicePlane),this._viewState.slicePlaneEnabled=b(e)}_slicePlaneChanged(){yn(this._contexts,(e,t)=>t.symbolCreationContext.slicePlaneEnabled)&&this.setDirty()}addGraphicsOwner(e){let t=this._contexts.get(e);return t==null&&(t=new Map,this._contexts.set(e,t),this.setDirty()),{addGraphic:r=>this._addGraphic(e,t,r),removeGraphic:r=>this._removeGraphic(t,r),labelingInfoChange:()=>this._labels.enabledChanged(e,t),featureReductionChange:()=>this.enabledChanged(e,t),slicePlaneEnabledChange:()=>this._slicePlaneEnabledChanged(e,t),clear:()=>t.forEach(r=>this._removeGraphic(t,r.graphics3DGraphic))}}removeGraphicsOwner(e){const t=this._contexts.get(e);t&&(t.forEach(r=>this._removeGraphic(t,r.graphics3DGraphic)),this._contexts.delete(e),this.setDirty())}_addGraphic(e,t,r){const i=r.graphic.uid,s=new Ypt(r,e.symbolCreationContext.slicePlaneEnabled);t.set(i,s),B7(e)&&this.addToActiveGraphics(s),e.labelsEnabled&&this._labels.addToActiveGraphics(s)}_removeGraphic(e,t){const r=t.graphic.uid,i=e.get(r);i&&(this.removeFromActiveGraphics(i),this._labels.removeFromActiveGraphics(i),e.delete(r),this.setDirty())}enabledChanged(e,t){const r=B7(e);r||oft(e),this.modifyGraphics(t,r)}_slicePlaneEnabledChanged(e,t){const r=e.symbolCreationContext.slicePlaneEnabled;t.forEach(i=>i.slicePlaneEnabled=r),this.setDirty()}getGraphicsLayers(e){return e.graphics}_graphicSupportsDeconfliction(e){if(e.isDraped)return!1;const t=e.graphics;if(!t||!t.length)return!1;for(const r of t)if(this.layerSupportsDeconfliction(r))return!0;return!1}};function B7(e){const t=e.layer;return!(!t||!t.featureReduction||t.featureReduction.type!=="selection")}function oft(e){const t=e.graphics3DGraphics;t&&t.forEach(r=>r.clearVisibilityFlag(eh.DECONFLICTION))}MQ=u([$("esri.views.3d.layers.graphics.GraphicsDeconflictor")],MQ);const hse=(e,t,r)=>[t,r],zA=(e,t,r)=>[t,r,e[2]],dse=(e,t,r)=>[t,r,e[2],e[3]];function JLt(e){return e?{originPosition:e.originPosition==="upper-left"?"upperLeft":e.originPosition==="lower-left"?"lowerLeft":e.originPosition,scale:e.tolerance?[e.tolerance,e.tolerance]:[1,1],translate:b(e.extent)?[e.extent.xmin,e.extent.ymax]:[0,0]}:null}function aft({scale:e,translate:t},r){return Math.round((r-t[0])/e[0])}function lft({scale:e,translate:t},r){return Math.round((t[1]-r)/e[1])}function F3e({scale:e,translate:t},r){return r*e[0]+t[0]}function k3e({scale:e,translate:t},r){return t[1]-r*e[1]}function U3e(e,t,r){const i=new Array(r.length);if(!r.length)return i;const[s,n]=e.scale;let o=F3e(e,r[0][0]),a=k3e(e,r[0][1]);i[0]=t(r[0],o,a);for(let l=1;l<r.length;l++){const c=r[l];o+=c[0]*s,a-=c[1]*n,i[l]=t(c,o,a)}return i}function V3e(e,t,r){const i=new Array(r.length);for(let s=0;s<r.length;s++)i[s]=U3e(e,t,r[s]);return i}function cft(e,t,r,i){return U3e(e,r?i?dse:zA:i?zA:hse,t)}function uft(e,t,r,i){return V3e(e,r?i?dse:zA:i?zA:hse,t)}function hft(e,t,r,i){return V3e(e,r?i?dse:zA:i?zA:hse,t)}function KLt(e,t,r,i,s){return t.x=aft(e,r.x),t.y=lft(e,r.y),t!==r&&(i&&(t.z=r.z),s&&(t.m=r.m)),t}function z3e(e,t,r,i,s){return b(r)&&(t.points=cft(e,r.points,i,s)),t}function B3e(e,t,r,i,s){return R(r)||(t.x=F3e(e,r.x),t.y=k3e(e,r.y),t!==r&&(i&&(t.z=r.z),s&&(t.m=r.m))),t}function G3e(e,t,r,i,s){return b(r)&&(t.rings=hft(e,r.rings,i,s)),t}function j3e(e,t,r,i,s){return b(r)&&(t.paths=uft(e,r.paths,i,s)),t}class eDt{constructor(t,r,i){this.uid=t,this.geometry=r,this.attributes=i,this.visible=!0,this.objectId=null,this.centroid=null}}function tDt(e){return b(e.geometry)}class rDt{constructor(){this.exceededTransferLimit=!1,this.features=[],this.fields=[],this.hasM=!1,this.hasZ=!1,this.geometryType=null,this.objectIdFieldName=null,this.globalIdFieldName=null,this.geometryProperties=null,this.geohashFieldName=null,this.spatialReference=null,this.transform=null}}function iDt(e){const t=t6.fromJSON(e.geometryType),r=Ze.fromJSON(e.spatialReference),i=e.transform,s=e.features.map(n=>{const o=dft(n,t,r,e.objectIdFieldName),a=o.geometry;if(b(a)&&i)switch(a.type){case"point":o.geometry=B3e(i,a,a,a.hasZ,a.hasM);break;case"multipoint":o.geometry=z3e(i,a,a,a.hasZ,a.hasM);break;case"polygon":o.geometry=G3e(i,a,a,a.hasZ,a.hasM);break;case"polyline":o.geometry=j3e(i,a,a,a.hasZ,a.hasM);break;case"extent":case"mesh":o.geometry=a}return o});return{geometryType:t,features:s,spatialReference:r,fields:e.fields?e.fields.map(n=>gR.fromJSON(n)):null,objectIdFieldName:e.objectIdFieldName,globalIdFieldName:e.globalIdFieldName,geohashFieldName:e.geohashFieldName,geometryProperties:e.geometryProperties,hasZ:e.hasZ,hasM:e.hasM,exceededTransferLimit:e.exceededTransferLimit,transform:null}}function dft(e,t,r,i){return{uid:Jl(),objectId:i&&e.attributes?e.attributes[i]:null,attributes:e.attributes,geometry:pft(e.geometry,t,r),visible:!0}}function pft(e,t,r){if(R(e))return null;switch(t){case"point":{const i=e;return{x:i.x,y:i.y,z:i.z,m:i.m,hasZ:i.z!=null,hasM:i.m!=null,type:"point",spatialReference:r}}case"polyline":{const i=e;return{paths:i.paths,hasZ:!!i.hasZ,hasM:!!i.hasM,type:"polyline",spatialReference:r}}case"polygon":{const i=e;return{rings:i.rings,hasZ:!!i.hasZ,hasM:!!i.hasM,type:"polygon",spatialReference:r}}case"multipoint":{const i=e;return{points:i.points,hasZ:!!i.hasZ,hasM:!!i.hasM,type:"multipoint",spatialReference:r}}}}function F0(e,t,r,i){return{x:e,y:t,z:r,hasZ:r!=null,hasM:!1,spatialReference:i,type:"point"}}function fft(e){if(R(e))return 0;let t=32;switch(e.type){case"point":t+=42;break;case"polyline":case"polygon":{let r=0;const i=2+(e.hasZ?1:0)+(e.hasM?1:0),s=e.type==="polyline"?e.paths:e.rings;for(const n of s)r+=n.length;t+=8*r*i+64,t+=128*r,t+=34,t+=32*(s.length+1);break}case"multipoint":{const r=2+(e.hasZ?1:0)+(e.hasM?1:0),i=e.points.length;t+=8*i*r+64,t+=128*i,t+=34,t+=32;break}case"extent":t+=98,e.hasM&&(t+=32),e.hasZ&&(t+=32);break;case"mesh":t+=mD(e.vertexAttributes.position),t+=mD(e.vertexAttributes.normal),t+=mD(e.vertexAttributes.uv),t+=mD(e.vertexAttributes.tangent)}return t}function sDt(e){let t=32;return t+=xTe(e.attributes),t+=3,t+=8+fft(e.geometry),t}function mft(e){if(R(e))return 0;switch(e.type){case"point":return 1;case"polyline":{let t=0;for(const r of e.paths)t+=r.length;return t}case"polygon":{let t=0;for(const r of e.rings)t+=r.length;return t}case"multipoint":return e.points.length;case"extent":return 2;case"mesh":{const t=e.vertexAttributes&&e.vertexAttributes.position;return t?t.length/3:0}default:return}}function nDt(e){if(R(e))return!1;switch(e.type){case"extent":case"point":return!0;case"polyline":for(const t of e.paths)if(t.length>0)return!0;return!1;case"polygon":for(const t of e.rings)if(t.length>0)return!0;return!1;case"multipoint":return e.points.length>0;case"mesh":return!e.loaded||e.vertexAttributes.position.length>0}}function oDt(e,t){switch(vi(t),e.type==="mesh"&&(e=e.extent),e.type){case"point":t[0]=t[3]=e.x,t[1]=t[4]=e.y,e.hasZ&&(t[2]=t[5]=e.z);break;case"polyline":for(let r=0;r<e.paths.length;r++)G9(t,e.paths[r],e.hasZ);break;case"polygon":for(let r=0;r<e.rings.length;r++)G9(t,e.rings[r],e.hasZ);break;case"multipoint":G9(t,e.points,e.hasZ);break;case"extent":t[0]=e.xmin,t[1]=e.ymin,t[3]=e.xmax,t[4]=e.ymax,e.zmin!=null&&(t[2]=e.zmin),e.zmax!=null&&(t[5]=e.zmax)}}function gft(e,t){switch(vh(t),e.type==="mesh"&&(e=e.extent),e.type){case"point":t[0]=t[2]=e.x,t[1]=t[3]=e.y;break;case"polyline":for(let r=0;r<e.paths.length;r++)B9(t,e.paths[r]);break;case"polygon":for(let r=0;r<e.rings.length;r++)B9(t,e.rings[r]);break;case"multipoint":B9(t,e.points);break;case"extent":t[0]=e.xmin,t[1]=e.ymin,t[2]=e.xmax,t[3]=e.ymax}}function aDt(e,t){return e.objectId!=null?e.objectId:e.attributes&&t?e.attributes[t]:null}tn();Ut();function H3e(e){return"declaredClass"in e}function Bpe(e){return"declaredClass"in e}function yft(e){return"declaredClass"in e}function vft(e,t){if(!e)return null;if(yft(e))return e;const r=new gl({layer:t,sourceLayer:t});return r.visible=e.visible,r.symbol=re(e.symbol),r.attributes=re(e.attributes),r.geometry=q3e(e.geometry),r}function q3e(e){return R(e)?null:H3e(e)?e:u0(_ft(e))}function _ft(e){const t=e.spatialReference.toJSON();switch(e.type){case"point":{const{x:r,y:i,z:s,m:n}=e;return{x:r,y:i,z:s,m:n,spatialReference:t}}case"polygon":{const{rings:r,hasZ:i,hasM:s}=e;return{rings:Gpe(r),hasZ:i,hasM:s,spatialReference:t}}case"polyline":{const{paths:r,hasZ:i,hasM:s}=e;return{paths:Gpe(r),hasZ:i,hasM:s,spatialReference:t}}case"extent":{const{xmin:r,xmax:i,ymin:s,ymax:n,zmin:o,zmax:a,mmin:l,mmax:c,hasZ:h,hasM:p}=e;return{xmin:r,xmax:i,ymin:s,ymax:n,zmin:o,zmax:a,mmin:l,mmax:c,hasZ:h,hasM:p,spatialReference:t}}case"multipoint":{const{points:r,hasZ:i,hasM:s}=e;return{points:X3e(r)?W3e(r):r,hasZ:i,hasM:s,spatialReference:t}}default:return}}function Gpe(e){return bft(e)?e.map(t=>W3e(t)):e}function W3e(e){return e.map(t=>Y4e(t))}function bft(e){for(const t of e)if(t.length!==0)return X3e(t);return!1}function X3e(e){return e.length&&(Q_e(e[0])||J_e(e[0]))}function wft(e,t){if(!e)return null;let r;if(Bpe(e)){if(t==null)return e.clone();if(Bpe(t))return t.copy(e)}return t!=null?(r=t,r.x=e.x,r.y=e.y,r.spatialReference=e.spatialReference,e.hasZ?(r.z=e.z,r.hasZ=e.hasZ):(r.z=null,r.hasZ=!1),e.hasM?(r.m=e.m,r.hasM=!0):(r.m=null,r.hasM=!1)):(r=F0(e.x,e.y,e.z,e.spatialReference),e.hasM&&(r.m=e.m,r.hasM=!0)),r}const G7=fe.getLogger("esri.layers.support.labelFormatUtils"),jpe={type:"simple",evaluate:()=>null},xft={getAttribute:(e,t)=>e.field(t)};async function Z3e(e,t,r){if(!e||!e.symbol)return jpe;const i=e.where,s=iB(e),n=i?await ie(()=>import("./WhereClause.c395dc79.js"),[],import.meta.url):null;let o;if(s.type==="arcade"){const a=await p6e(s.expression,r,t);o={type:"arcade",evaluate(l){try{const c=a.evaluate({$feature:"attributes"in l?a.repurposeFeature(l):l});if(c!=null)return c.toString()}catch{G7.error(new j("arcade-expression-error","Encountered an error when evaluating label expression for feature",{feature:l,expression:s}))}return null},needsHydrationToEvaluate:()=>Ure(s.expression)==null}}else o={type:"simple",evaluate:a=>s.expression.replace(/{[^}]*}/g,l=>{const c=l.slice(1,-1),h=t.get(c);if(!h)return l;let p=null;return"attributes"in a?a&&a.attributes&&(p=a.attributes[h.name]):p=a.field(h.name),p==null?"":Y3e(p,h)})};if(i){let a;try{a=n.WhereClause.create(i,t)}catch(c){return G7.error(new j("bad-where-clause","Encountered an error when evaluating where clause, ignoring",{where:i,error:c})),jpe}const l=o.evaluate;o.evaluate=c=>{const h="attributes"in c?void 0:xft;try{if(a.testFeature(c,h))return l(c)}catch(p){G7.error(new j("bad-where-clause","Encountered an error when evaluating where clause for feature",{where:i,feature:c,error:p}))}return null}}return o}function Y3e(e,t){if(e==null)return"";const r=t.domain;if(r){if(r.type==="codedValue"||r.type==="coded-value"){const s=e;for(const n of r.codedValues)if(n.code===s)return n.name}else if(r.type==="range"){const s=+e,n="range"in r?r.range[0]:r.minValue,o="range"in r?r.range[1]:r.maxValue;if(n<=s&&s<=o)return r.name}}let i=e;return t.type==="date"||t.type==="esriFieldTypeDate"?i=Jm(i,i6("short-date")):r6(t)&&(i=Ud(+i)),i||""}const lDt=Object.freeze(Object.defineProperty({__proto__:null,createLabelFunction:Z3e,formatField:Y3e},Symbol.toStringTag,{value:"Module"}));function pse(e,t){if(e.type==="point")return tv(e,t,!1);if(H3e(e))switch(e.type){case"extent":return tv(e.center,t,!1);case"polygon":return tv(e.centroid,t,!1);case"polyline":return tv(Hpe(e),t,!0);case"mesh":return tv(e.origin,t,!1)}else switch(e.type){case"extent":return tv(Tft(e),t,!0);case"polygon":return tv(Sft(e),t,!0);case"polyline":return tv(Hpe(e),t,!0)}}function Hpe(e){const t=e.paths[0];if(!t||t.length===0)return null;const r=ewe(t,Kbe(t)/2);return F0(r[0],r[1],r[2],e.spatialReference)}function Tft(e){const t=isFinite(e.zmin);return F0(.5*(e.xmax+e.xmin),.5*(e.ymax+e.ymin),t?.5*(e.zmax+e.zmin):void 0,e.spatialReference)}function Sft(e){const t=e.rings[0];if(!t||t.length===0)return null;const r=twe(e.rings,e.hasZ);return F0(r[0],r[1],r[2],e.spatialReference)}function tv(e,t,r){const i=r?e:wft(e);return t&&e?P9e(e,i,t)?i:null:i}function cDt(e,t,r,i=0){if(e){t||(t=Ut());const s=e;let n=.5*s.width*(r-1),o=.5*s.height*(r-1);return s.width<1e-7*s.height?n+=o/20:s.height<1e-7*s.width&&(o+=n/20),Kr(t,s.xmin-n-i,s.ymin-o-i,s.xmax+n+i,s.ymax+o+i),t}return null}function Q3e(e,t){for(let r=0;r<e.geometries.length;++r){const i=e.geometries[r].getMutableAttribute(O.AUXPOS1);i&&i.data[3]!==t&&(i.data[3]=t,e.geometryVertexAttrsUpdated(e.geometryRecords[r]))}}function vP(e,t){const r=E6(Sd);return b(e)&&(r[0]=e[0],r[1]=e[1],r[2]=e[2]),b(t)?r[3]=t:b(e)&&e.length>3&&(r[3]=e[3]),r}function uDt(e,t,r,i,s,n=[0,0,0,0]){for(let o=0;o<3;++o)b(e)&&e[o]!=null?n[o]=e[o]:b(r)&&r[o]!=null?n[o]=r[o]:n[o]=s[o];return b(t)?n[3]=t:b(i)?n[3]=i:n[3]=s[3],n}function qpe(e=Nm,t,r,i=1){const s=new Array(3);if(R(t)||R(r))s[0]=1,s[1]=1,s[2]=1;else{let n,o=0;for(let a=2;a>=0;a--){const l=e[a];let c;const h=l!=null,p=a===0&&!n&&!h,f=r[a];l==="symbol-value"||p?c=f!==0?t[a]/f:1:h&&l!=="proportional"&&isFinite(l)&&(c=f!==0?l/f:1),c!=null&&(s[a]=c,n=c,o=Math.max(o,Math.abs(c)))}for(let a=2;a>=0;a--)s[a]==null?s[a]=n:s[a]===0&&(s[a]=.001*o)}for(let n=2;n>=0;n--)s[n]/=i;return Bl(s)}function Eft(e){return e.isPrimitive!=null}function UB(e){return Eft(e)&&(e=[e.width,e.depth,e.height]),YV(e)?null:"Symbol sizes may not be negative values"}function YV(e){if(Array.isArray(e)){for(const t of e)if(!YV(t))return!1;return!0}return e==null||e>=0}function Cft(e,t,r,i=Ce()){const s=e||0,n=t||0,o=r||0;return s!==0&&cA(i,i,-s/180*Math.PI),n!==0&&lA(i,i,n/180*Math.PI),o!==0&&_6(i,i,o/180*Math.PI),i}function fse(e,t){return t.minDemResolution!=null?t.minDemResolution:c6(e)?t.minDemResolutionForPoints:.01*wBe(e)}function J3e(e,t,r,i,s,n,o,a,l,c,h){const p=Lft[h.mode];let f,m,g=0;if(mi(e,t,r,i,l.spatialReference,s,a))return p.requiresAlignment(h)?(g=p.applyElevationAlignmentBuffer(i,s,n,o,a,l,c,h),f=n,m=o):(f=i,m=s),mi(f,l.spatialReference,m,n,c.spatialReference,o,a)?g:void 0}function x0(e,t,r,i,s){const n=(zV(e)?e.z:IMe(e)?e.array[e.offset+2]:e[2])||0;switch(r.mode){case"on-the-ground":{const o=_t(km(t,e,"ground"),0);return s.verticalDistanceToGround=0,s.sampledElevation=o,void(s.z=o)}case"relative-to-ground":{const o=_t(km(t,e,"ground"),0),a=r.geometryZWithOffset(n,i);return s.verticalDistanceToGround=a,s.sampledElevation=o,void(s.z=a+o)}case"relative-to-scene":{const o=_t(km(t,e,"scene"),0),a=r.geometryZWithOffset(n,i);return s.verticalDistanceToGround=a,s.sampledElevation=o,void(s.z=a+o)}case"absolute-height":{const o=r.geometryZWithOffset(n,i),a=_t(km(t,e,"ground"),0);return s.verticalDistanceToGround=o-a,s.sampledElevation=a,void(s.z=o)}default:return r.mode,void(s.z=0)}}function Aft(e,t,r,i){return x0(e,t,r,i,GE),GE.z}function CL(e,t,r){return t==null||r==null?e.definedChanged:t==="on-the-ground"&&r==="on-the-ground"?e.staysOnTheGround:t===r||t!=="on-the-ground"&&r!=="on-the-ground"?is.UPDATE:e.onTheGroundChanged}function Wd(e){return e==="relative-to-ground"||e==="relative-to-scene"}function B1(e){return e!=="absolute-height"}function Rft(e,t,r,i,s){x0(t,r,s,i,GE),Q3e(e,GE.verticalDistanceToGround);const n=GE.sampledElevation,o=Is(Dft,e.transformation);return ZN[0]=t.x,ZN[1]=t.y,ZN[2]=GE.z,bh(t.spatialReference,ZN,o,i.spatialReference)?e.transformation=o:console.warn("Could not locate symbol object properly, it might be misplaced"),n}function Oft(e,t,r,i,s,n){let o=0;const a=n.spatialReference;t*=3,i*=3;for(let l=0;l<s;++l){const c=e[t+0],h=e[t+1],p=e[t+2],f=_t(n.getElevation(c,h,p,a,"ground"),0);o+=f,r[i+0]=c,r[i+1]=h,r[i+2]=f,t+=3,i+=3}return o/s}function Mft(e,t,r,i,s,n,o,a){let l=0;const c=a.calculateOffsetRenderUnits(o),h=a.featureExpressionInfoContext,p=n.spatialReference;t*=3,i*=3;for(let f=0;f<s;++f){const m=e[t+0],g=e[t+1],v=e[t+2],w=_t(n.getElevation(m,g,v,p,"ground"),0);l+=w,r[i+0]=m,r[i+1]=g,r[i+2]=h==null?v+w+c:w+c,t+=3,i+=3}return l/s}function Pft(e,t,r,i,s,n,o,a){let l=0;const c=a.calculateOffsetRenderUnits(o),h=a.featureExpressionInfoContext,p=n.spatialReference;t*=3,i*=3;for(let f=0;f<s;++f){const m=e[t+0],g=e[t+1],v=e[t+2],w=_t(n.getElevation(m,g,v,p,"scene"),0);l+=w,r[i+0]=m,r[i+1]=g,r[i+2]=h==null?v+w+c:w+c,t+=3,i+=3}return l/s}function Ift(e){const t=e.meterUnitOffset,r=e.featureExpressionInfoContext;return t!==0||r!=null}function $ft(e,t,r,i,s,n,o,a){const l=a.calculateOffsetRenderUnits(o),c=a.featureExpressionInfoContext;t*=3,i*=3;for(let h=0;h<s;++h){const p=e[t+0],f=e[t+1],m=e[t+2];r[i+0]=p,r[i+1]=f,r[i+2]=c==null?m+l:l,t+=3,i+=3}return 0}class AL{constructor(){this.verticalDistanceToGround=0,this.sampledElevation=0,this.z=0}}var is;(function(e){e[e.NONE=0]="NONE",e[e.UPDATE=1]="UPDATE",e[e.RECREATE=2]="RECREATE"})(is||(is={}));const Lft={"absolute-height":{applyElevationAlignmentBuffer:$ft,requiresAlignment:Ift},"on-the-ground":{applyElevationAlignmentBuffer:Oft,requiresAlignment:()=>!0},"relative-to-ground":{applyElevationAlignmentBuffer:Mft,requiresAlignment:()=>!0},"relative-to-scene":{applyElevationAlignmentBuffer:Pft,requiresAlignment:()=>!0}},Dft=Ce(),GE=new AL,ZN=M();function K3e(e,t,r,i){const s=e.stageObject,n=s.geometryRecords;let o=0;for(const a of n){const{update:l,averageGeometrySampledElevation:c}=tPe(a,t,r,i);o+=c,l&&s.geometryVertexAttrsUpdated(a)}return o/n.length}function a$(e,t,r,i){const s=e.stageObject,n=t.centerPointInElevationSR;let o=0;s.metadata.usesVerticalDistanceToGround?(x0(n,r,t,i,ql),Q3e(s,ql.verticalDistanceToGround),o=ql.sampledElevation):(x0(n,r,t,i,ql),t.mode!=="absolute-height"&&(o=ql.sampledElevation));const a=Is(Nft,s.transformation),l=se(ePe,a[12],a[13],a[14]);Xr.TESTS_DISABLE_OPTIMIZATIONS?(Hl[0]=n.x,Hl[1]=n.y,Hl[2]=ql.z,bh(n.spatialReference,Hl,a,i.spatialReference)&&(s.transformation=a)):i.setAltitudeOfTransformation(ql.z,a);const c=mse/i.unitInMeters;return(Math.abs(a[12]-l[0])>=c||Math.abs(a[13]-l[1])>=c||Math.abs(a[14]-l[2])>=c)&&(s.transformation=a),o}const Nft=Ce();function Fft(e,t,r,i){const s=e.graphics3DSymbolLayer.lodRenderer;if(R(s))return 0;const n=t.centerPointInElevationSR;x0(n,r,t,i,ql);const o=t.mode!=="absolute-height"?ql.sampledElevation:0,a=s.instanceData,l=e.instanceIndex,c=Uft;a.getGlobalTransform(l,c);const h=se(ePe,c[12],c[13],c[14]);Xr.TESTS_DISABLE_OPTIMIZATIONS?(Hl[0]=n.x,Hl[1]=n.y,Hl[2]=ql.z,bh(n.spatialReference,Hl,c,i.spatialReference)&&a.setGlobalTransform(l,c)):i.setAltitudeOfTransformation(ql.z,c);const p=mse/i.unitInMeters;return(Xr.TESTS_DISABLE_OPTIMIZATIONS||Math.abs(c[12]-h[0])>=p||Math.abs(c[13]-h[1])>=p||Math.abs(c[14]-h[2])>=p)&&a.setGlobalTransform(l,c),o}function kft(e,t,r,i){const s=e.stageObject,n=s.geometryRecords;if(n.length===0)return 0;let o=0,a=null,l=0,c=!1;for(const h of n){const p=h.geometry.vertexAttributes.get(O.POSITION);if(p!==a){const{update:f,averageGeometrySampledElevation:m}=tPe(h,t,r,i);l=m,a=p,c=f}c&&s.geometryVertexAttrsUpdated(h),o+=l}return o/n.length}const mse=.01,Hl=M(),$h=M(),PS=M(),Uft=Ce(),ePe=M(),ql=new AL;function tPe(e,t,r,i){let s=!1;const n=r.spatialReference,o=e.geometry,a=e.getShaderTransformation(),l=t.requiresSampledElevationInfo;$h[0]=a[12],$h[1]=a[13],$h[2]=a[14],o.invalidateBoundingInfo();const c=o.getMutableAttribute(O.POSITION),h=c.data,p=o.vertexAttributes.get(O.MAPPOS).data,f=c.size,m=h.length/f,g=new PMe(p,n);let v=0,w=0;for(let _=0;_<m;_++){if(PS[0]=h[v],PS[1]=h[v+1],PS[2]=h[v+2],x0(g,r,t,i,ql),l&&(w+=ql.sampledElevation),Xr.TESTS_DISABLE_OPTIMIZATIONS)h[v]=g.array[g.offset],h[v+1]=g.array[g.offset+1],h[v+2]=ql.z,mi(h,n,v,h,i.spatialReference,v,1),h[v]-=$h[0],h[v+1]-=$h[1],h[v+2]-=$h[2],s=!0;else{Hl[0]=h[v]+$h[0],Hl[1]=h[v+1]+$h[1],Hl[2]=h[v+2]+$h[2],i.setAltitude(Hl,ql.z),h[v]=Hl[0]-$h[0],h[v+1]=Hl[1]-$h[1],h[v+2]=Hl[2]-$h[2];const T=mse/i.unitInMeters;(Math.abs(PS[0]-h[v])>=T||Math.abs(PS[1]-h[v+1])>=T||Math.abs(PS[2]-h[v+2])>=T)&&(s=!0)}v+=f,g.offset+=3}return w/=m,{update:s,averageGeometrySampledElevation:w}}const Vft=fe.getLogger("esri.views.3d.layers.graphics.featureExpressionInfoUtils");function zft(e){return{cachedResult:e.cachedResult,arcade:e.arcade?{func:e.arcade.func,context:e.arcade.modules.arcadeUtils.createExecContext(null,{sr:e.arcade.context.spatialReference}),modules:e.arcade.modules}:null}}function hDt(e){const t=e&&e.expression;if(typeof t=="string"){const r=sPe(t);if(r!=null)return{cachedResult:r}}return null}async function dDt(e,t,r){const i=e&&e.expression;if(typeof i!="string")return null;const s=sPe(i);if(s!=null)return{cachedResult:s};const n=await Qm(),o=n.arcadeUtils,a=o.createSyntaxTree(i);return o.dependsOnView(a)?(r!=null&&r.error("Expressions containing '$view' are not supported on ElevationInfo"),{cachedResult:0}):{arcade:{func:o.createFunction(a),context:o.createExecContext(null,{sr:t}),modules:n}}}function rPe(e,t,r){return e.arcadeUtils.createFeature(t.attributes,t.geometry,r)}function gse(e,t){if(e!=null&&!iPe(e)){if(!t||!e.arcade)return void Vft.errorOncePerTick("Arcade support required but not provided");const r=t;r._geometry&&(r._geometry=q3e(r._geometry)),e.arcade.modules.arcadeUtils.updateExecContext(e.arcade.context,t)}}function Bft(e){if(e!=null){if(iPe(e))return e.cachedResult;const t=e.arcade;let r=e.arcade.modules.arcadeUtils.executeFunction(t.func,t.context);return typeof r!="number"&&(e.cachedResult=0,r=0),r}return 0}function pDt(e,t=!1){let r=e&&e.featureExpressionInfo;const i=r&&r.expression;return t||i==="0"||(r=null),r}const Gft={cachedResult:0};function iPe(e){return e.cachedResult!=null}function sPe(e){return e==="0"?0:null}class Ah{constructor(){this._meterUnitOffset=0,this._renderUnitOffset=0,this._unit="meters",this._metersPerElevationInfoUnit=1,this._featureExpressionInfoContext=null,this.centerPointInElevationSR=null,this.mode=null}get featureExpressionInfoContext(){return this._featureExpressionInfoContext}get meterUnitOffset(){return this._meterUnitOffset}get unit(){return this._unit}set unit(t){this._unit=t,this._metersPerElevationInfoUnit=met(t)}get requiresSampledElevationInfo(){return this.mode!=="absolute-height"}reset(){this.mode=null,this._meterUnitOffset=0,this._renderUnitOffset=0,this._featureExpressionInfoContext=null,this.unit="meters"}set offsetMeters(t){this._meterUnitOffset=t,this._renderUnitOffset=0}set offsetElevationInfoUnits(t){this._meterUnitOffset=t*this._metersPerElevationInfoUnit,this._renderUnitOffset=0}addOffsetRenderUnits(t){this._renderUnitOffset+=t}geometryZWithOffset(t,r){const i=this.calculateOffsetRenderUnits(r);return this.featureExpressionInfoContext!=null?i:t+i}calculateOffsetRenderUnits(t){let r=this._meterUnitOffset;const i=this.featureExpressionInfoContext;return i!=null&&(r+=Bft(i)*this._metersPerElevationInfoUnit),r/t.unitInMeters+this._renderUnitOffset}setFromElevationInfo(t){this.mode=t.mode,this.unit=fet(t.unit)?t.unit:"meters",this.offsetElevationInfoUnits=_t(t.offset,0)}updateFeatureExpressionInfoContext(t,r,i){if(R(t))return void(this._featureExpressionInfoContext=null);const s=t&&t.arcade;s&&b(r)&&b(i)?(this._featureExpressionInfoContext=zft(t),gse(this._featureExpressionInfoContext,rPe(s.modules,r,i))):this._featureExpressionInfoContext=t}static fromElevationInfo(t){const r=new Ah;return b(t)&&r.setFromElevationInfo(t),r}}var Nt;(function(e){e[e.INVISIBLE=0]="INVISIBLE",e[e.TRANSPARENT=1]="TRANSPARENT",e[e.OPAQUE=2]="OPAQUE"})(Nt||(Nt={}));class Sg{constructor(t,r,i,s,n,o,a,l=null){this.graphics3DSymbolLayer=t,this.stageObject=r,this._uniqueGeometries=i,this._uniqueMaterials=s,this._sharedResource=n,this.elevationAligner=o,this.elevationContext=a,this._edgeState=l,this.type="object3d",this._stageLayer=null,this._stage=null,this._visible=!1,this._addedToStage=!1,this.alignedSampledElevation=0,this.needsElevationUpdates=!1,this.useObjectOriginAsAttachmentOrigin=!1,this.graphics3DSymbolLayer=t,this.stageObject=r}get isElevationSource(){return!(!this.stageObject.metadata||!this.stageObject.metadata.isElevationSource)}initialize(t,r){this._stageLayer=r,this._stage=t,t.addMany(this._uniqueMaterials),t.addMany(this._uniqueGeometries),t.add(this.stageObject)}destroy(){const t=this._stage;this._stageLayer&&(t.removeMany(this._uniqueMaterials),t.removeMany(this._uniqueGeometries)),t.remove(this.stageObject),this._addedToStage&&(this._stageLayer.remove(this.stageObject),this._addedToStage=!1);const r=this._stage.renderView.ensureEdgeView();r.hasObject(this.stageObject)&&r.removeObject(this.stageObject),this.stageObject.dispose(),b(this._sharedResource)&&this._sharedResource.release(),this._visible=!1,this._stageLayer=null,this._stage=null}layerOpacityChanged(t,r){if(R(this._edgeState))return;const i=Wpe(this._edgeState.baseMaterial);let s=!1;for(const n of this._edgeState.edgeMaterials)n.objectTransparency!==i&&(n.objectTransparency=i,s=!0);s&&this._resetEdgeObject(r),this._stage.renderView.ensureEdgeView().updateAllComponentOpacities(this.stageObject,[t])}slicePlaneEnabledChanged(t,r){R(this._edgeState)||(this._stage.renderView.ensureEdgeView().updateAllComponentMaterials(this.stageObject,this._edgeState.edgeMaterials,{hasSlicePlane:t},!r),this._edgeState.properties.hasSlicePlane=t)}setVisibility(t){if(this._stage!=null&&this._visible!==t&&(this._visible=t,this._visible?this._addedToStage?this.stageObject.setVisible(!0):(this._stageLayer.add(this.stageObject),this._addedToStage=!0):this.stageObject.setVisible(!1),b(this._edgeState))){const r=this._stage.renderView.ensureEdgeView();r.hasObject(this.stageObject)?r.updateObjectVisibility(this.stageObject,t):t&&this._addOrUpdateEdgeObject(r,!1)}}get visible(){return this._visible}alignWithElevation(t,r,i,s){this.elevationAligner!=null&&(b(i)&&gse(this.elevationContext.featureExpressionInfoContext,i),this.alignedSampledElevation=this.elevationAligner(this,this.elevationContext,t,r),this._resetEdgeObject(s))}getCenterObjectSpace(t=M()){return ae(t,this.stageObject.boundingVolumeObjectSpace.bounds)}getBoundingBoxObjectSpace(t=tn()){const r=this.stageObject.boundingVolumeObjectSpace;return txe(t,r.min),rxe(t,r.max),t}computeAttachmentOrigin(t){if(this.useObjectOriginAsAttachmentOrigin){const r=this.stageObject.transformation;t.render.origin[0]+=r[12],t.render.origin[1]+=r[13],t.render.origin[2]+=r[14],t.render.num++}else for(const r of this.stageObject.geometryRecords)r.computeAttachmentOrigin($g)&&(Ve($g,$g,this.stageObject.transformation),de(t.render.origin,t.render.origin,$g),t.render.num++)}async getProjectedBoundingBox(t,r,i,s,n){const o=this.getBoundingBoxObjectSpace(n),a=jft,l=c6(o)?1:a.length;for(let h=0;h<l;h++){const p=a[h];rv[0]=o[p[0]],rv[1]=o[p[1]],rv[2]=o[p[2]],Ve(rv,rv,this.stageObject.transformation),xb[3*h+0]=rv[0],xb[3*h+1]=rv[1],xb[3*h+2]=rv[2]}if(!t(xb,0,l))return null;vi(o);let c=null;this.calculateRelativeScreenBounds&&(c=this.calculateRelativeScreenBounds());for(let h=0;h<3*l;h+=3){for(let p=0;p<3;p++)o[p]=Math.min(o[p],xb[h+p]),o[p+3]=Math.max(o[p+3],xb[h+p]);c&&i.push({location:xb.slice(h,h+3),screenSpaceBoundingRect:c})}if(r&&r.service&&this.elevationContext.mode!=="absolute-height"){tf(o,$g);const h=this.elevationContext.mode==="relative-to-scene"?"scene":"ground";let p=0;if(r.useViewElevation)p=_t(r.service.getElevation($g[0],$g[1],h),0);else try{const f=fse(o,r);p=_t(await r.service.queryElevation($g[0],$g[1],s,f,h),0)}catch{}exe(o,0,0,-this.alignedSampledElevation+p)}return o}addObjectState(t,r){t===v0.Highlight&&r.addObject(this.stageObject,this.stageObject.highlight()),t===v0.MaskOccludee&&r.addObject(this.stageObject,this.stageObject.maskOccludee())}removeObjectState(t){t.removeObject(this.stageObject)}_resetEdgeObject(t){if(R(this._edgeState))return;const r=this._stage.renderView.ensureEdgeView();this._visible?this._addOrUpdateEdgeObject(r,t):r.removeObject(this.stageObject)}_addOrUpdateEdgeObject(t,r){const i=this._edgeState;if(R(i))return;const s=Wpe(i.baseMaterial);for(const n of i.edgeMaterials)n.objectTransparency=s;t.addOrUpdateObject3D(this.stageObject,i.edgeMaterials,i.properties,!r).then(()=>{var n;return(n=this._stageLayer)==null?void 0:n.sync()})}}function Wpe(e){return e.isVisible?e.parameters.transparent?Nt.TRANSPARENT:Nt.OPAQUE:Nt.INVISIBLE}const xb=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],rv=M(),$g=M(),jft=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]];var bn;(function(e){e[e.Recreate_Symbol=0]="Recreate_Symbol",e[e.Recreate_Graphics=1]="Recreate_Graphics",e[e.Fast_Update=2]="Fast_Update"})(bn||(bn={}));class yse{constructor(t){this.schedule=t,this._loadStatus=Wu.LOADING,this.logger=null}destroy(){this.abortLoad()}get loadStatus(){return this._loadStatus}load(t,r){return this._loadStatus===Wu.LOADED?(t&&t(),this._loader):this._loadStatus===Wu.FAILED?(r&&r(this._loadError),this._loader):(R(this._loader)&&(this._abortController=new AbortController,this._loader=this.doLoad(this._abortController.signal).then(()=>{this._abortController=null,this._loadStatus=Wu.LOADED},i=>{throw this._loadError=i,this._abortController=null,this._loadStatus=Wu.FAILED,!Vi(i)&&this.logger&&i.message&&this.logger.warn(i.message),i})),this._loader.then(t,r).catch(()=>{}),this._loader)}abortLoad(){b(this._abortController)?this._abortController=Fd(this._abortController):this._loadStatus===Wu.LOADING&&(this._loadStatus=Wu.FAILED),this._loader=null}}var Wu;(function(e){e[e.LOADING=0]="LOADING",e[e.LOADED=1]="LOADED",e[e.FAILED=2]="FAILED"})(Wu||(Wu={}));function Hft(e){switch(e){case"sphere":case"cube":case"diamond":case"cylinder":case"cone":case"inverted-cone":case"tetrahedron":return!0}return!1}function nPe(e,t){const r=(i,s,n=!1)=>({levels:i.map(o=>{const a=s(o.tesselation);return n&&$c.cgToGIS(a),{components:[{geometry:a,material:t}],faceCount:a.indexCount/3,minScreenSpaceRadius:o.minScreenSpaceRadius}})});switch(e){case"sphere":return r([{tesselation:0,minScreenSpaceRadius:0},{tesselation:1,minScreenSpaceRadius:8},{tesselation:2,minScreenSpaceRadius:16},{tesselation:3,minScreenSpaceRadius:50},{tesselation:4,minScreenSpaceRadius:250}],i=>$c.createPolySphereGeometry(.5,i,!0));case"cube":return r([{tesselation:0,minScreenSpaceRadius:0}],()=>$c.createBoxGeometry(1));case"cone":return r(j7,i=>$c.createConeGeometry(1,.5,i,!1),!0);case"inverted-cone":return r(j7,i=>$c.createConeGeometry(1,.5,i,!0),!0);case"cylinder":return r(j7,i=>$c.createCylinderGeometry(1,.5,i,[0,0,1],[0,0,.5]));case"tetrahedron":return r([{tesselation:0,minScreenSpaceRadius:0}],()=>$c.createTetrahedronGeometry(1),!0);case"diamond":return r([{tesselation:0,minScreenSpaceRadius:0}],()=>$c.createDiamondGeometry(1),!0);default:return}}const j7=[{tesselation:6,minScreenSpaceRadius:0},{tesselation:18,minScreenSpaceRadius:7},{tesselation:64,minScreenSpaceRadius:65}];function qft(e){return e.type==="fill"}function Wft(e){return e.type==="extrude"}function Xft(e){return e&&e.enabled&&(Wft(e)||qft(e))&&b(e.edges)}function Zft(e){return e&&e.enabled&&e.edges||null}function oPe(e,t){return aPe(Zft(e),t)}function aPe(e,t){if(R(e))return null;const r=b(e.color)?dte(Me.toUnitRGBA(e.color)):xr(0,0,0,0),i=yr(e.size),s=yr(e.extensionLength);switch(e.type){case"solid":return lPe({color:r,size:i,extensionLength:s,...t});case"sketch":return Yft({color:r,size:i,extensionLength:s,...t});default:return}}function lPe(e){return{...Qft,...e,type:"solid"}}function Yft(e){return{...Jft,...e,type:"sketch"}}const Qft={color:xr(0,0,0,.2),size:1,extensionLength:0,opacity:1,objectTransparency:Nt.OPAQUE,hasSlicePlane:!1},Jft={color:xr(0,0,0,.2),size:1,extensionLength:0,opacity:1,objectTransparency:Nt.OPAQUE,hasSlicePlane:!1};function YN(e){const t=[];return e.levels.forEach(r=>{r.components.forEach(i=>{t.push(i.material)})}),N$(t)}function Kft(e){const t=new Array;return e.levels.forEach(r=>{r.components.forEach(i=>{i.textures&&t.push(...i.textures)})}),N$(t)}function vse(e){const t=[];return e.components.forEach(r=>{t.push(r.geometry)}),N$(t)}function emt(e){const t=[];return e.levels.forEach(r=>{r.components.forEach(i=>{t.push(i.geometry)})}),N$(t)}function tmt(e){return vse(e).reduce((t,r)=>t+r.indexCount/3,0)}const _se={primitivesPerFeature:0,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!0,memory:{bytesPerFeature:0,bytesPerCoordinate:0,bytesPerFeatureLabel:0,draped:{bytesPerFeature:0,bytesPerFeatureLabel:0,bytesPerCoordinate:0}}};function fDt(e){return e.type==="web-style"?_se:bse(e.symbolLayers.toArray().map(t=>cPe(e,t)))}function bse(e){let t=0,r=0,i=0,s=!1,n=0;const o={bytesPerFeature:0,bytesPerFeatureLabel:0,bytesPerCoordinate:0,draped:{bytesPerFeature:0,bytesPerFeatureLabel:0,bytesPerCoordinate:0}};for(const a of e)R(a)||(t+=a.primitivesPerFeature,r+=a.primitivesPerCoordinate,i+=a.drawCallsPerFeature,o.bytesPerFeature+=a.memory.bytesPerFeature,o.bytesPerFeatureLabel+=a.memory.bytesPerFeatureLabel,o.bytesPerCoordinate+=a.memory.bytesPerCoordinate,o.draped.bytesPerFeature+=a.memory.bytesPerFeature,o.draped.bytesPerFeatureLabel+=a.memory.bytesPerFeatureLabel,o.draped.bytesPerCoordinate+=a.memory.bytesPerCoordinate,s=s||a.estimated,++n);return{primitivesPerFeature:t,primitivesPerCoordinate:r,drawCallsPerFeature:i,estimated:s,memory:o,numComplexities:n}}function mDt(e){const t=bse(e);return t.numComplexities>0&&(t.primitivesPerFeature/=t.numComplexities,t.primitivesPerCoordinate/=t.numComplexities,t.drawCallsPerFeature/=t.numComplexities,t.memory.bytesPerFeature/=t.numComplexities,t.memory.bytesPerFeatureLabel/=t.numComplexities,t.memory.bytesPerCoordinate/=t.numComplexities,t.memory.draped.bytesPerFeature/=t.numComplexities,t.memory.draped.bytesPerFeatureLabel/=t.numComplexities,t.memory.draped.bytesPerCoordinate/=t.numComplexities),t}const Xpe={};function cPe(e,t){const r=uPe(e,t),i=Xft(t)?2:0;switch(t.type){case"extrude":return{primitivesPerFeature:-4,primitivesPerCoordinate:4,drawCallsPerFeature:i,estimated:!1,memory:r};case"fill":return e.type==="mesh-3d"?{primitivesPerFeature:0,primitivesPerCoordinate:0,drawCallsPerFeature:i,estimated:!1,memory:r}:b(t.outline)&&t.outline.size>0?{primitivesPerFeature:-4,primitivesPerCoordinate:3,drawCallsPerFeature:0,estimated:!1,memory:r}:{primitivesPerFeature:-2,primitivesPerCoordinate:1,drawCallsPerFeature:0,estimated:!1,memory:r};case"water":return{primitivesPerFeature:-2,primitivesPerCoordinate:1,drawCallsPerFeature:0,estimated:!1,memory:r};case"line":return{primitivesPerFeature:-2,primitivesPerCoordinate:2,drawCallsPerFeature:0,estimated:!1,memory:r};case"object":return t.resource&&t.resource.href?{primitivesPerFeature:16,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!0,memory:r}:{...rmt(t.resource&&t.resource.primitive||Hee),memory:r};case"path":{let a=0,l=0;switch(t.profile){case"circle":a=10;break;case"quad":a=4;break;default:return void(t.profile,void 0)}switch(t.join){case"round":l=3;break;case"miter":case"bevel":l=1;break;default:return void(t.join,void 0)}const c=2*a,h=a*l*2;let p=-2*h-c;switch(t.cap){case"none":break;case"butt":case"square":p+=2*(a-1);break;case"round":p+=2*(a*(3-1)*2+a);break;default:return}return{primitivesPerFeature:p,primitivesPerCoordinate:h+c,drawCallsPerFeature:0,estimated:!1,memory:r}}case"text":case"icon":return{primitivesPerFeature:2,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1,memory:r};default:return}}function uPe(e,t){const r=e.type==="point-3d";switch(t.type){case"extrude":return t.edges&&t.edges.size>0?Sl.EXTRUDE_EDGES:Sl.EXTRUDE;case"fill":return b(t.outline)&&t.outline.size>0?Sl.FILL_OUTLINE:Sl.FILL;case"water":return Sl.FILL;case"line":return t.join==="round"?Sl.LINE_ROUND:Sl.LINE_MITER;case"path":switch(t.join){case"round":switch(t.profile){case"circle":return Sl.PATH_ROUND_CIRCLE;case"quad":return Sl.PATH_ROUND_QUAD;default:return void(t.profile,void 0)}case"miter":case"bevel":switch(t.profile){case"circle":return Sl.PATH_MITER_CIRCLE;case"quad":return Sl.PATH_MITER_QUAD;default:return void(t.profile,void 0)}default:return void(t.join,void 0)}case"object":return r?Sl.OBJECT_POINT:Sl.OBJECT_POLYGON;case"icon":case"text":return r?Sl.ICON_POINT:Sl.ICON_POLYGON;default:return}}function rmt(e){let t=Xpe[e];if(t)return t;const r=nPe(e,null);return t={primitivesPerFeature:vse(r.levels[0]).reduce((i,s)=>i+s.indices.get(O.POSITION).length/3,0),primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1},Xpe[e]=t,t}const Sl={ICON_POINT:{bytesPerFeature:7127.413186968842,bytesPerFeatureLabel:4826.302896296296,bytesPerCoordinate:0,draped:{bytesPerFeature:3929.4396628895197,bytesPerFeatureLabel:3550.1332222222227,bytesPerCoordinate:0}},ICON_POLYGON:{bytesPerFeature:9329.452613976147,bytesPerFeatureLabel:3675.3372604938268,bytesPerCoordinate:60.177252982212096,draped:{bytesPerFeature:6190.247450139383,bytesPerFeatureLabel:3744.074358024691,bytesPerCoordinate:59.488211068026104}},OBJECT_POINT:{bytesPerFeature:2350.5884192634558,bytesPerFeatureLabel:4446.651003703703,bytesPerCoordinate:0,draped:{bytesPerFeature:2350.5884192634558,bytesPerFeatureLabel:4446.651003703703,bytesPerCoordinate:0}},OBJECT_POLYGON:{bytesPerFeature:4583.807620302299,bytesPerFeatureLabel:3665.342685185186,bytesPerCoordinate:60.11621818101506,draped:{bytesPerFeature:4583.807620302299,bytesPerFeatureLabel:3665.342685185186,bytesPerCoordinate:60.11621818101506}},LINE_MITER:{bytesPerFeature:7321.028181375921,bytesPerFeatureLabel:4048.0226716049388,bytesPerCoordinate:186.55621386363578,draped:{bytesPerFeature:4246.856619435009,bytesPerFeatureLabel:3852.3737679012347,bytesPerCoordinate:163.47884002621583}},LINE_ROUND:{bytesPerFeature:7482.205842738954,bytesPerFeatureLabel:4045.886987654321,bytesPerCoordinate:191.5452524171851,draped:{bytesPerFeature:4473.481387957992,bytesPerFeatureLabel:3842.1112395061728,bytesPerCoordinate:167.27703460226945}},PATH_MITER_CIRCLE:{bytesPerFeature:9010.489006415351,bytesPerFeatureLabel:4230.9109,bytesPerCoordinate:4618.2594178027275,draped:{bytesPerFeature:9010.489006415351,bytesPerFeatureLabel:4230.9109,bytesPerCoordinate:4618.2594178027275}},PATH_ROUND_CIRCLE:{bytesPerFeature:4104.727250200398,bytesPerFeatureLabel:4251.8525,bytesPerCoordinate:8019.043777064957,draped:{bytesPerFeature:4104.727250200398,bytesPerFeatureLabel:4251.8525,bytesPerCoordinate:8019.043777064957}},PATH_MITER_QUAD:{bytesPerFeature:9416.372942261387,bytesPerFeatureLabel:4241.2757,bytesPerCoordinate:3176.7222742582203,draped:{bytesPerFeature:9416.372942261387,bytesPerFeatureLabel:4241.2757,bytesPerCoordinate:3176.7222742582203}},PATH_ROUND_QUAD:{bytesPerFeature:6614.431545308682,bytesPerFeatureLabel:4206.7461,bytesPerCoordinate:5141.817789093826,draped:{bytesPerFeature:6614.431545308682,bytesPerFeatureLabel:4206.7461,bytesPerCoordinate:5141.817789093826}},FILL:{bytesPerFeature:9478.244183633637,bytesPerFeatureLabel:3713.816824691358,bytesPerCoordinate:95.9343604185578,draped:{bytesPerFeature:6287.911108168086,bytesPerFeatureLabel:3790.785032098766,bytesPerCoordinate:83.08783220478168}},FILL_OUTLINE:{bytesPerFeature:13085.871870349445,bytesPerFeatureLabel:3392.613241975309,bytesPerCoordinate:118.63968023169875,draped:{bytesPerFeature:8437.199992480122,bytesPerFeatureLabel:3973.5431172839503,bytesPerCoordinate:106.33556817014312}},EXTRUDE:{bytesPerFeature:19459.53727140414,bytesPerFeatureLabel:3743.7045209876546,bytesPerCoordinate:372.6819978900477,draped:{bytesPerFeature:19459.53727140414,bytesPerFeatureLabel:3743.7045209876546,bytesPerCoordinate:372.6819978900477}},EXTRUDE_EDGES:{bytesPerFeature:22266.888534913724,bytesPerFeatureLabel:3064.3193358024696,bytesPerCoordinate:374.3725221561312,draped:{bytesPerFeature:22266.888534913724,bytesPerFeatureLabel:3064.3193358024696,bytesPerCoordinate:374.3725221561312}}},QN=fe.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayer");class Eg extends yse{constructor(t,r,i,s){super(i.schedule),this._context=i,this._elevationInfoOverride=null,this._ignoreDrivers=!1,this._drivenProperties={color:!1,opacity:!1,opacityAlwaysOpaque:!0,size:!1},this.complexity=null,this.logger=QN,this._elevationOptions={supportsOffsetAdjustment:!1,supportsOnTheGround:!0},this.symbol=t,this.symbolLayer=r,this._renderPriority=s.renderPriority,this._renderPriorityStep=s.renderPriorityStep,this._elevationContext=new Ah,this.complexity=this.computeComplexity(),this._ignoreDrivers=s.ignoreDrivers,this._ignoreDrivers||(this._drivenProperties=Zpe(this._context.renderer)),this._updateElevationContext()}getCachedSize(){return null}get extentPadding(){return 0}_drivenPropertiesChanged(t){if(this._ignoreDrivers)return!1;const r=this._drivenProperties,i=Zpe(t);return i.color!==r.color||i.opacity!==r.opacity||i.opacityAlwaysOpaque!==r.opacityAlwaysOpaque||i.size!==r.size}get needsDrivenTransparentPass(){return this._drivenProperties.opacity&&!this._drivenProperties.opacityAlwaysOpaque}_logGeometryCreationWarnings(t,r,i,s){const n=t.projectionSuccess,o="polygons"in t?t.polygons:null,a=`${s} geometry failed to be created`;let l=null;n?!r.length||r.length===1&&!r[0].length?l=`${a} (no ${i} were defined)`:Array.isArray(r)&&Array.isArray(r[0])?o&&o.length===0&&i==="rings"&&r.length>0&&r[0].length>2&&(l=`${a} (filled rings should use clockwise winding - try reversing the order of vertices)`):l=`${a} (${i} should be defined as a 2D array)`:l=`${a} (failed to project geometry to view spatial reference)`,l&&QN.warnOncePerTick(l)}_validateGeometry(t,r=null,i=null){if(b(r)&&!r.includes(t.type))return this.logger.warn("unsupported geometry type for "+i+` symbol: ${t.type}`),!1;if(t.type==="point"){const s=t;if(!isFinite(s.x)||!isFinite(s.y))return QN.warn("point coordinate is not a valid number, graphic skipped"),!1}return!0}_defaultElevationInfoNoZ(){return imt}_defaultElevationInfoZ(){return smt}_updateElevationContext(){b(this._elevationInfoOverride)?(this._elevationContext.setFromElevationInfo(this._elevationInfoOverride),this._elevationContext.updateFeatureExpressionInfoContext(null)):this._context.layer.elevationInfo?(this._elevationContext.setFromElevationInfo(this._context.layer.elevationInfo),this._elevationContext.updateFeatureExpressionInfoContext(this._context.featureExpressionInfoContext)):this._elevationContext.reset()}getDefaultElevationInfo(t){return t.hasZ?this._defaultElevationInfoZ():this._defaultElevationInfoNoZ()}getGeometryElevationMode(t,r=this.getDefaultElevationInfo(t)){return this._elevationContext.mode||r.mode}setElevationInfoOverride(t){this._elevationInfoOverride=t,this._updateElevationContext()}setGraphicElevationContext(t,r){const i=t.geometry,s=this.getDefaultElevationInfo(i);r.unit=this._elevationContext.unit!=null?this._elevationContext.unit:s.unit,r.mode=this.getGeometryElevationMode(i,s),r.offsetMeters=_t(this._elevationContext.meterUnitOffset,_t(s.offset,0));const n=!this._elevationOptions.supportsOnTheGround&&r.mode==="on-the-ground";n&&(r.mode="relative-to-ground",r.offsetMeters=0);const o=n?Gft:this._elevationContext.featureExpressionInfoContext;return r.updateFeatureExpressionInfoContext(o,t,this._context.layer),r}prepareSymbolLayerPatch(t){}updateGeometry(t,r){return!1}onRemoveGraphic(t){}_getLayerOpacity(){if(this._context.graphicsCoreOwner&&"fullOpacity"in this._context.graphicsCoreOwner)return this._context.graphicsCoreOwner.fullOpacity;const t=this._context.layer.opacity;return t==null?1:t}_getCombinedOpacity(t,r=Ype){let i=1;return this.draped||(i*=this._getLayerOpacity()),this._drivenProperties.opacity||(b(t)?i*=t.a:r.hasIntrinsicColor||(i=0)),i}_getCombinedOpacityAndColor(t,r=Ype){const i=this._getCombinedOpacity(t,r);if(this._drivenProperties.color)return vP(null,i);const s=b(t)?Me.toUnitRGB(t):Nm;return vP(s,i)}_getVertexOpacityAndColor(t,r=null){const i=this._drivenProperties.color?t.color:null,s=this._drivenProperties.opacity?t.opacity:null,n=vP(i,s);return b(r)&&(n[0]*=r,n[1]*=r,n[2]*=r,n[3]*=r),n}isFastUpdatesEnabled(){return this._fastUpdates&&this._fastUpdates.enabled}computeComplexity(){return cPe(this.symbol,this.symbolLayer)}globalPropertyChanged(t,r,i){switch(t){case"opacity":return this.layerOpacityChanged(r,i);case"elevationInfo":{const s=this._elevationContext.mode;return this._updateElevationContext(),this.layerElevationInfoChanged(r,i,s)!==is.RECREATE}case"slicePlaneEnabled":return this.slicePlaneEnabledChanged(r,i);case"physicalBasedRenderingEnabled":return this.physicalBasedRenderingChanged();case"pixelRatio":return this.pixelRatioChanged();default:return!1}}updateGraphics3DGraphicElevationInfo(t,r,i){let s=is.UPDATE;return t.forEach(n=>{const o=r(n);if(b(o)){const a=n.graphic;this.setGraphicElevationContext(a,o.elevationContext),o.needsElevationUpdates=i(o.elevationContext.mode)}else s=is.RECREATE}),s}applyRendererDiff(t,r){return bn.Recreate_Symbol}getFastUpdateAttrValues(t){if(!this._fastUpdates.enabled)return null;const r=this._fastUpdates.visualVariables,i=r.size?Qy(r.size.field,t):0,s=r.color?Qy(r.color.field,t):0,n=r.opacity?Qy(r.opacity.field,t):0;return xr(i,s,n,0)}get draped(){return this._draped}ensureDrapedStatus(t){return this._draped==null?(this._draped=t,!0):(t!==this.draped&&QN.warnOnce("A symbol can only produce either draped or non-draped visualizations. Use two separate symbol instances for draped and non-draped graphics if necessary."),!1)}test(){const t=()=>{var r,i,s,n,o,a,l,c,h,p,f,m,g,v,w,_;return{size:(n=(s=(i=(r=this._fastUpdates)==null?void 0:r.visualVariables)==null?void 0:i.size)==null?void 0:s.field)!=null?n:null,color:(c=(l=(a=(o=this._fastUpdates)==null?void 0:o.visualVariables)==null?void 0:a.color)==null?void 0:l.field)!=null?c:null,opacity:(m=(f=(p=(h=this._fastUpdates)==null?void 0:h.visualVariables)==null?void 0:p.opacity)==null?void 0:f.field)!=null?m:null,rotation:(_=(w=(v=(g=this._fastUpdates)==null?void 0:g.visualVariables)==null?void 0:v.rotation)==null?void 0:w.field)!=null?_:null}};return{drivenProperties:this._drivenProperties,getVisVarFields:t}}}function Qy(e,t){const r=e!=null?t.attributes[e]:0;return r!=null&&isFinite(r)?r:0}function Zpe(e){const t={color:!1,opacity:!1,opacityAlwaysOpaque:!0,size:!1};return e&&"visualVariables"in e&&e.visualVariables&&e.visualVariables.forEach(r=>{switch(r.type){case"color":if(t.color=!0,r.stops)for(let i=0;i<r.stops.length;i++){const s=r.stops[i].color;s&&(t.opacity=!0,s.a<1&&(t.opacityAlwaysOpaque=!1))}break;case"opacity":t.opacity=!0,t.opacityAlwaysOpaque=!1;break;case"size":t.size=!0}}),t}const imt={mode:"on-the-ground",offset:0,unit:"meters"},smt={mode:"absolute-height",offset:0,unit:"meters"},Ype={hasIntrinsicColor:!1};class PT{constructor(){this._disposed=!1}get disposed(){return this._disposed}get shaderTransformation(){return this._shaderTransformation}acquire(t,r,i,s,n,o){this.id=Jl(),this.geometry=t,this.material=r,this.transformation=i,this.instanceParameters=s,this.origin=n,this._shaderTransformation=o,this._disposed=!1}release(){this._disposed=!1}dispose(){this._disposed=!0}getStaticTransformation(){return this.transformation}getShaderTransformation(){return b(this._shaderTransformation)?this._shaderTransformation(this.transformation):this.transformation}computeAttachmentOrigin(t){return!!(this.material.computeAttachmentOrigin?this.material.computeAttachmentOrigin(this.geometry,t):this.geometry.computeAttachmentOrigin(t))&&(Ve(t,t,this.getStaticTransformation()),!0)}}PT.pool=new Ls(PT);class QV{constructor(t){this.channel=t,this.id=Jl()}}class k0 extends vL{constructor(t={}){super(),this.type=Cf.Object,this._geometryRecords=new Array,this._geometries=new Array,this._objectTransformation=Ce(),this._bvObjectSpace=new Qpe,this._bvWorldSpace=new Qpe,this._bvDirty=!0,this._hasVolatileTransformation=!1,this._visible=!0,this.castShadow=t.castShadow==null||t.castShadow,this.metadata=t.metadata,this.metadata&&this.metadata.isElevationSource&&(this.metadata.lastValidElevationBB=new hPe),this.transformation=Ce();const{geometries:r,materials:i,transformations:s,origins:n}=t;if(Array.isArray(r)){ft(i.length===r.length,"Object3D: materials don't match geometries"),ft(s.length===r.length,"Object3D: transformations don't match geometries"),this._geometryRecords.length=r.length,this._geometries.length=r.length;for(let o=0;o<r.length;o++)this._geometries[o]=r[o],this._geometryRecords[o]=PT.pool.acquire(r[o],i[o],zx(s[o]),{highlights:null,occludees:null,visible:this._visible},n&&n[o])}}get geometryRecords(){return this._geometryRecords}get geometries(){return this._geometries}get transformation(){return this._objectTransformation}set transformation(t){Is(this._objectTransformation,t),this._invalidateBoundingVolume(),this._emit("objectTransformation",this)}dispose(){this._geometryRecords.length=0,this._geometries.length=0}get parentLayer(){return this._parentLayer}set parentLayer(t){ft(this._parentLayer==null||t==null,"Object3D can only be added to a single Layer"),this._parentLayer=t}addGeometry(t,r,i,s,n){i=i||Tn,this._geometries.push(t);const o=PT.pool.acquire(t,r,i,{highlights:null,occludees:null,visible:this._visible},s,n);return this._geometryRecords.push(o),this._hasVolatileTransformation=this._hasVolatileTransformation||b(o.shaderTransformation),this._emit("objectGeometryAdded",{object:this,record:o}),this._invalidateBoundingVolume(),o}removeGeometry(t){const r=this._geometryRecords.splice(t,1)[0];return this._hasVolatileTransformation=b(r.shaderTransformation)?this._geometryRecords.some(i=>b(i.shaderTransformation)):this._hasVolatileTransformation,r.dispose(),this._geometries.splice(t,1),this._emit("objectGeometryRemoved",{object:this,record:r}),this._invalidateBoundingVolume(),r}removeAllGeometries(){for(;this.geometryRecords.length>0;)this.removeGeometry(0)}geometryVertexAttrsUpdated(t){this._emit("vertexAttrsUpdated",{object:this,record:t}),this._invalidateBoundingVolume()}get isVisible(){return this._visible}setVisible(t){if(this._visible!==t){this._visible=t;for(const r of this._geometryRecords)r.instanceParameters.visible=this._visible;this._emit("visibilityChanged",this)}}maskOccludee(){const t=new QV(v0.MaskOccludee);for(const r of this._geometryRecords)r.instanceParameters.occludees=mQ(r.instanceParameters.occludees,t);return this._emit("occlusionChanged",this),t}removeOcclude(t){for(const r of this._geometryRecords)r.instanceParameters.occludees=gQ(r.instanceParameters.occludees,t);this._emit("occlusionChanged",this)}highlight(){const t=new QV(v0.Highlight);for(const r of this._geometryRecords)r.instanceParameters.highlights=mQ(r.instanceParameters.highlights,t);return this._emit("highlightChanged",this),t}removeHighlight(t){for(const r of this._geometryRecords)r.instanceParameters.highlights=gQ(r.instanceParameters.highlights,t);this._emit("highlightChanged",this)}getCombinedStaticTransformation(t,r){return Yi(_t(r,Ce()),this.transformation,t.getStaticTransformation())}_getCombinedShaderTransformation(t,r){return r=r||Ce(),Yi(r,this.transformation,t.getShaderTransformation()),r}hasVolativeTransformation(){return this._hasVolatileTransformation}get boundingVolumeWorldSpace(){return this._validateBoundingVolume(),this._bvWorldSpace}get boundingVolumeObjectSpace(){return this._validateBoundingVolume(),this._bvObjectSpace}_validateBoundingVolume(){if(!this._bvDirty&&!this._hasVolatileTransformation)return;this._bvObjectSpace.init(),this._bvWorldSpace.init();for(let s=0;s<this._geometryRecords.length;++s){const n=this._geometries[s],o=this._geometryRecords[s],a=n.boundingInfo;b(a)&&(this._calculateTransformedBoundingVolume(a,this._bvObjectSpace,o.getShaderTransformation()),this._calculateTransformedBoundingVolume(a,this._bvWorldSpace,this._getCombinedShaderTransformation(o)))}En(this._bvObjectSpace.bounds,this._bvObjectSpace.min,this._bvObjectSpace.max,.5),En(this._bvWorldSpace.bounds,this._bvWorldSpace.min,this._bvWorldSpace.max,.5);const t=M(),r=M(),i=pT(this.transformation);for(let s=0;s<this._geometryRecords.length;++s){const n=this._geometries[s].boundingInfo;if(R(n))continue;const o=this._geometryRecords[s].getShaderTransformation(),a=pT(o);Ve(t,n.getCenter(),o);const l=pi(t,this._bvObjectSpace.bounds),c=n.getBSRadius()*a;this._bvObjectSpace.bounds[3]=Math.max(this._bvObjectSpace.bounds[3],l+c),Ve(r,t,this.transformation);const h=pi(r,this._bvWorldSpace.bounds),p=c*i;this._bvWorldSpace.bounds[3]=Math.max(this._bvWorldSpace.bounds[3],h+p)}this._bvDirty=!1}_calculateTransformedBoundingVolume(t,r,i){const s=t.getBBMin(),n=t.getBBMax(),o=Qs(s),a=Qs(n);Ve(o,o,i),Ve(a,a,i);for(let l=0;l<3;++l)r.min[l]=Math.min(r.min[l],o[l],a[l]),r.max[l]=Math.max(r.max[l],o[l],a[l]);for(let l=0;l<3;++l){ae(o,s),ae(a,n),o[l]=n[l],a[l]=s[l],Ve(o,o,i),Ve(a,a,i);for(let c=0;c<3;++c)r.min[c]=Math.min(r.min[c],o[c],a[c]),r.max[c]=Math.max(r.max[c],o[c],a[c])}}_invalidateBoundingVolume(){this._bvDirty=!0,b(this._parentLayer)&&this._parentLayer.notifyObjectBBChanged(this,this._bvWorldSpace.bounds)}_emit(t,r){b(this._parentLayer)&&this._parentLayer.events.emit(t,r)}get test(){const t=this;return{hasGeometry:r=>t._geometries.includes(r),getGeometryIndex:r=>t._geometries.indexOf(r)}}}class hPe{constructor(){this.min=Ue(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this.max=Ue(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE)}isEmpty(){return this.max[0]<this.min[0]&&this.max[1]<this.min[1]&&this.max[2]<this.min[2]}}class Qpe extends hPe{constructor(){super(...arguments),this.bounds=kn()}init(){se(this.min,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),se(this.max,-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),GTe(this.bounds)}}const X_=M();function wse(e,t,r,i,s,n,o,a){const l=r?r.length:0,c=e.clippingExtent;if(so(t,X_,e.elevationProvider.spatialReference),b(c)&&!Bee(c,X_))return null;so(t,X_,e.renderCoordsHelper.spatialReference);const h=e.localOriginFactory.getOrigin(X_),p=new k0({castShadow:!1,metadata:{layerUid:n,graphicUid:o,usesVerticalDistanceToGround:!0}});for(let f=0;f<l;f++){const m=Tn;p.addGeometry(r[f],i[f],m,h,a)}return{object:p,sampledElevation:Rft(p,t,e.elevationProvider,e.renderCoordsHelper,s)}}function l$(e,t,r){const i=e.elevationContext,s=r.spatialReference;so(t,X_,s),i.centerPointInElevationSR=F0(X_[0],X_[1],t.hasZ?X_[2]:0,s)}function c$(e){switch(e.type){case"point":return e;case"polygon":case"extent":return pse(e);case"polyline":{const t=e.paths[0];if(!t||t.length===0)return null;const r=ewe(t,Kbe(t)/2);return F0(r[0],r[1],r[2],e.spatialReference)}case"mesh":return e.origin}return null}function nmt(e){const t=new Yr;t.include(Pie),t.include(l3e,e),t.include(Ss,e),t.attributes.add(O.UV0,"vec2");const{vertex:r,fragment:i}=t;return r.uniforms.add([new lr("viewport",(s,n)=>n.camera.fullViewport),new qe("lineSize",(s,n)=>Math.ceil(s.size)*n.camera.pixelRatio),new _r("pixelToNDC",(s,n)=>vr(Kpe,2/n.camera.fullViewport[2],2/n.camera.fullViewport[3])),new qe("borderSize",(s,n)=>b(s.borderColor)?n.camera.pixelRatio:0),new _r("screenOffset",(s,n)=>vr(Kpe,s.screenOffset[0]*n.camera.pixelRatio,s.screenOffset[1]*n.camera.pixelRatio))]),t.varyings.add("coverageSampling","vec4"),t.varyings.add("lineSizes","vec2"),e.hasMultipassGeometry&&t.varyings.add("depth","float"),e.hasScreenSizePerspective&&MB(r),r.code.add(S`
    void main(void) {
      ProjectHUDAux projectAux;
      vec4 endPoint = projectPositionHUD(projectAux);

      vec3 vpos = projectAux.posModel;
      if (rejectBySlice(vpos)) {
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }
    ${e.occlusionTestEnabled?S`
      if (!testVisibilityHUD(endPoint)) {
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }`:""}

    ${e.hasScreenSizePerspective?S`
      vec4 perspectiveFactor = screenSizePerspectiveScaleFactor(projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);
      vec2 screenOffsetScaled = applyScreenSizePerspectiveScaleFactorVec2(screenOffset, perspectiveFactor);
        `:S`
      vec2 screenOffsetScaled = screenOffset;
        `}
      // Add view dependent polygon offset to get exact same original starting point. This is mostly
      // used to get the correct depth value
      vec3 posView = (view * vec4(position, 1.0)).xyz;
      ${e.hasMultipassGeometry?"depth = posView.z;":""}

      applyHUDViewDependentPolygonOffset(auxpos1.w, projectAux.absCosAngle, posView);
      vec4 startPoint = proj * vec4(posView, 1.0);
      // Apply screen offset to both start and end point
      vec2 screenOffsetNorm = screenOffsetScaled * 2.0 / viewport.zw;
      startPoint.xy += screenOffsetNorm * startPoint.w;
      endPoint.xy += screenOffsetNorm * endPoint.w;
      // Align start and end to pixel origin
      vec4 startAligned = alignToPixelOrigin(startPoint, viewport.zw);
      vec4 endAligned = alignToPixelOrigin(endPoint, viewport.zw);
    ${e.depthHudEnabled?e.depthHudAlignStartEnabled?S`endAligned = vec4(endAligned.xy / endAligned.w * startAligned.w, startAligned.zw);`:S`startAligned = vec4(startAligned.xy / startAligned.w * endAligned.w, endAligned.zw);`:""}
      vec4 projectedPosition = mix(startAligned, endAligned, uv0.y);
      // The direction of the line in screen space
      vec2 screenSpaceDirection = normalize(endAligned.xy / endAligned.w - startAligned.xy / startAligned.w);
      vec2 perpendicularScreenSpaceDirection = vec2(screenSpaceDirection.y, -screenSpaceDirection.x);
    ${e.hasScreenSizePerspective?S`
      float lineSizeScaled = applyScreenSizePerspectiveScaleFactorFloat(lineSize, perspectiveFactor);
      float borderSizeScaled = applyScreenSizePerspectiveScaleFactorFloat(borderSize, perspectiveFactor);
        `:S`
      float lineSizeScaled = lineSize;
      float borderSizeScaled = borderSize;
        `}
      float halfPixelSize = lineSizeScaled * 0.5;
      // Calculate a pixel offset from the edge of the pixel, s.t. we keep the line aligned
      // to pixels if it has a full pixel size. Since pixel aligned biases to the bottom-left,
      // we bias the size to the right (for odd sizes) to balance out the bias. Grow sub-pixel
      // sizes towards the left or right s.t. there is a smooth transition (e.g. from 2 to 3 px).
      float halfWholePixelSize = floor(lineSizeScaled) * 0.5;
      float halfPixelSizeInt = floor(halfWholePixelSize);

      // Sub-pixel offset if we need to grow sub-pixels to the left
      float subpixelOffset = -fract(lineSizeScaled) * float(halfWholePixelSize > 0.0);

      // Pixel offset aligning to whole pixels and adding subpixel offset if needed
      float pixelOffset = -halfPixelSizeInt + subpixelOffset;

      // Compute full ndc offset, adding 1px padding for doing anti-aliasing and the border size
      float padding = 1.0 + borderSizeScaled;
      vec2 ndcOffset = (pixelOffset - padding + uv0.x * (lineSizeScaled + padding + padding)) * pixelToNDC;

      // Offset x/y from the center of the line in screen space
      projectedPosition.xy += perpendicularScreenSpaceDirection * ndcOffset * projectedPosition.w;

      // Compute a coverage varying which we can use in the fragment shader to determine
      // how much a pixel is actually covered by the line (i.e. to anti alias the line).
      // This works by computing two coordinates that can be linearly interpolated and then
      // subtracted to find out how far away from the line edge we are.
      float edgeDirection = (uv0.x * 2.0 - 1.0);

      float halfBorderSize = 0.5 * borderSizeScaled;
      float halfPixelSizeAndBorder = halfPixelSize + halfBorderSize;
      float outerEdgeCoverageSampler = edgeDirection * (halfPixelSizeAndBorder + halfBorderSize + 1.0);

      float isOneSided = float(lineSizeScaled < 2.0 && borderSize < 2.0);

      coverageSampling = vec4(
        // Edge coordinate
        outerEdgeCoverageSampler,

        // Border edge coordinate
        outerEdgeCoverageSampler - halfPixelSizeAndBorder * isOneSided,

        // Line offset
        halfPixelSize - 0.5,

        // Border offset
        halfBorderSize - 0.5 + halfPixelSizeAndBorder * (1.0 - isOneSided)
      );

      lineSizes = vec2(lineSizeScaled, borderSizeScaled);

      gl_Position = projectedPosition;
    }
  `),i.uniforms.add([new lr("uColor",s=>Jpe(s.color)),new lr("borderColor",s=>Jpe(s.borderColor))]),e.hasMultipassGeometry&&(i.include(OOe,e),i.uniforms.add(new _r("inverseViewport",(s,n)=>n.inverseViewport))),i.code.add(S`
    void main() {
      ${e.hasMultipassGeometry?"if( geometryDepthTest(gl_FragCoord.xy * inverseViewport, depth) ){ discard; }":""}

      // Mix between line and border coverage offsets depending on whether we need
      // a border (based on the sidedness).
      vec2 coverage = min(1.0 - clamp(abs(coverageSampling.xy) - coverageSampling.zw, 0.0, 1.0), lineSizes);

      // Mix between border and line color based on the line coverage (conceptually the line
      // blends on top of the border background).
      //
      // Anti-alias by blending final result using the full (including optional border) coverage
      // and the color alpha
      float borderAlpha = uColor.a * borderColor.a * coverage.y;
      float colorAlpha = uColor.a * coverage.x;

      float finalAlpha = mix(borderAlpha, 1.0, colorAlpha);

    ${e.depthHudEnabled?S`
      if (finalAlpha < 0.01) {
        discard;
      }
      `:S`
      vec3 finalRgb = mix(borderColor.rgb * borderAlpha, uColor.rgb, colorAlpha);
      gl_FragColor = vec4(finalRgb, finalAlpha);
      `}
  }
  `),t}function Jpe(e){return b(e)?e:jm}const Kpe=rt(),omt=Object.freeze(Object.defineProperty({__proto__:null,build:nmt},Symbol.toStringTag,{value:"Module"}));class VB extends gi{initializeConfiguration(t,r){r.spherical=t.viewingMode===Be.Global}initializeProgram(t){const r=VB.shader.get().build(this.configuration);return new oi(t.rctx,r,zr)}setPipelineState(t){const r=t?_i.ALWAYS:_i.LESS;return this.configuration.depthHudEnabled?Gt({depthTest:{func:r},depthWrite:cc}):Gt({blending:No(Ae.ONE,Ae.SRC_ALPHA,Ae.ONE_MINUS_SRC_ALPHA,Ae.ONE_MINUS_SRC_ALPHA),depthTest:{func:r},colorWrite:or})}initializePipeline(){return this.setPipelineState(this.configuration.hasMultipassGeometry)}}VB.shader=new ni(omt,()=>ie(()=>import("./LineCallout.glsl.6e2c8362.js"),[],import.meta.url));class Kh extends Ca{constructor(){super(...arguments),this.screenCenterOffsetUnitsEnabled=Wl.World,this.spherical=!1,this.occlusionTestEnabled=!0,this.hasVerticalOffset=!1,this.hasScreenSizePerspective=!1,this.depthHudEnabled=!1,this.depthHudAlignStartEnabled=!1,this.hasSlicePlane=!1,this.hasMultipassGeometry=!1}}u([q({count:Wl.COUNT})],Kh.prototype,"screenCenterOffsetUnitsEnabled",void 0),u([q()],Kh.prototype,"spherical",void 0),u([q()],Kh.prototype,"occlusionTestEnabled",void 0),u([q()],Kh.prototype,"hasVerticalOffset",void 0),u([q()],Kh.prototype,"hasScreenSizePerspective",void 0),u([q()],Kh.prototype,"depthHudEnabled",void 0),u([q()],Kh.prototype,"depthHudAlignStartEnabled",void 0),u([q()],Kh.prototype,"hasSlicePlane",void 0),u([q()],Kh.prototype,"hasMultipassGeometry",void 0),u([q({constValue:!0})],Kh.prototype,"hasSliceInVertexProgram",void 0),u([q({constValue:!1})],Kh.prototype,"isDraped",void 0);class Ex extends Tg{constructor(t){super(t,new lmt),this.techniqueConfig=new Kh,this._uniqueMaterialIdentifier=Ex.uniqueMaterialIdentifier(this.parameters)}get uniqueMaterialIdentifier(){return this._uniqueMaterialIdentifier}getPassParameters(){return this.parameters}getConfiguration(t,r){const i=(r==null?void 0:r.slot)!==Se.LINE_CALLOUTS;return this.techniqueConfig.occlusionTestEnabled=this.parameters.occlusionTest,this.techniqueConfig.hasVerticalOffset=b(this.parameters.verticalOffset),this.techniqueConfig.hasScreenSizePerspective=b(this.parameters.screenSizePerspective),this.techniqueConfig.depthHudEnabled=i,this.techniqueConfig.depthHudAlignStartEnabled=!!this.parameters.depthHUDAlignStart,this.techniqueConfig.screenCenterOffsetUnitsEnabled=this.parameters.centerOffsetUnits==="screen"?Wl.Screen:Wl.World,this.techniqueConfig.hasSlicePlane=this.parameters.hasSlicePlane,this.techniqueConfig.hasMultipassGeometry=!!r&&r.multipassGeometry.enabled,this.techniqueConfig}intersect(){}requiresSlot(t){switch(t){case Se.LINE_CALLOUTS:case Se.LINE_CALLOUTS_HUD_DEPTH:return!0}return!1}createGLMaterial(t){return t.output===K.Color?new amt(t):null}createBufferWriter(){return new umt}validateParameters(t){const r=Ex.uniqueMaterialIdentifier(t);r!==this._uniqueMaterialIdentifier&&(this._uniqueMaterialIdentifier=r)}static uniqueMaterialIdentifier(t){return JSON.stringify({screenOffset:t.screenOffset||[0,0],centerOffsetUnits:t.centerOffsetUnits||"world"})}}class amt extends J1{beginSlot(t){return this.ensureTechnique(VB,t)}}class lmt extends IR{constructor(){super(...arguments),this.screenOffset=zd,this.color=[0,0,0,1],this.size=1,this.occlusionTest=!1,this.shaderPolygonOffset=1e-5,this.depthHUDAlignStart=!1,this.centerOffsetUnits="world",this.hasSlicePlane=!1}}const cmt=ps().vec3f(O.POSITION).vec3f(O.NORMAL).vec2f(O.UV0).vec4f(O.AUXPOS1),efe=[ll(0,0),ll(1,0),ll(0,1),ll(1,0),ll(1,1),ll(0,1)];class umt{constructor(){this.vertexBufferLayout=cmt}allocate(t){return this.vertexBufferLayout.createBuffer(t)}elementCount(t){return 6*t.indices.get(O.POSITION).length}write(t,r,i,s){IB(r.indices.get(O.POSITION),r.vertexAttributes.get(O.POSITION).data,t.transformation,i.position,s,6),ose(r.indices.get(O.NORMAL),r.vertexAttributes.get(O.NORMAL).data,t.invTranspTransformation,i.normal,s,6),UA(r.indices.get(O.AUXPOS1),r.vertexAttributes.get(O.AUXPOS1).data,i.auxpos1,s,6);for(let n=0;n<efe.length;++n)i.uv0.setVec(s+n,efe[n])}}class zB extends Eg{constructor(t,r){super(t,null,r,pmt),this._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!1},this.ensureDrapedStatus(!1)}async doLoad(){this._material=new Ex(this.materialParameters),this._context.stage.add(this._material)}destroy(){super.destroy(),this._context.stage.remove(this._material),this._material=null}_perInstanceMaterialParameters(t){const r=this.materialParameters;return r.screenOffset=t.screenOffset||zd,r.centerOffsetUnits=t.centerOffsetUnits||"world",r}get materialParameters(){const t=this.symbol,r=t.callout,i=b(r.color)?Me.toUnitRGBA(r.color):[0,0,0,0];i[3]*=this._getLayerOpacity();const s=yr(r.size||0);let n=null;if(t.verticalOffset){const{screenLength:p,minWorldLength:f,maxWorldLength:m}=t.verticalOffset;n={screenLength:yr(p),minWorldLength:f||0,maxWorldLength:m!=null?m:1/0}}const o=b(r.border)&&b(r.border.color)?Me.toUnitRGBA(r.border.color):null,a=t.symbolLayers.getItemAt(0).type==="object",l=!a,c=a?0:void 0,h=t.type==="label-3d";return{color:i,size:s,verticalOffset:n,screenSizePerspective:this._context.screenSizePerspectiveEnabled?this._context.sharedResources.screenSizePerspectiveSettings:null,screenOffset:[0,0],centerOffsetUnits:"world",borderColor:o,occlusionTest:l,shaderPolygonOffset:c,depthHUDAlignStart:h,hasSlicePlane:this._context.slicePlaneEnabled,renderOccluded:Fi.Occlude,__tagStrict:"NoParameters"}}_defaultElevationInfoNoZ(){return dmt}createGraphics3DGraphic(t){const r=t.renderingInfo,i=t.graphic,s=this.setGraphicElevationContext(i,new Ah,r.elevationOffset||0),n=r.symbol,o=this._elevationContext.mode==="on-the-ground"&&(n.type==="cim"||!n.symbolLayers.some(l=>l.type==="object"||l.type==="text"));if(n.type!=="label-3d"&&o||n.type==="point-3d"&&n.symbolLayers.every(l=>l.type==="text"&&!gxe(l)))return null;const a=pse(i.geometry);return R(a)?null:this._createAs3DShape(a,s,r,i.uid)}layerOpacityChanged(){return R(this._material)||this._material.setParameters(this.materialParameters),!0}layerElevationInfoChanged(t,r,i){const s=this._elevationContext.mode,n=CL(zB.elevationModeChangeTypes,i,s);return n!==is.UPDATE||t.forEach(o=>{const a=r(o);b(a)&&this.updateGraphicElevationContext(o.graphic,a)}),n}slicePlaneEnabledChanged(){return R(this._material)||this._material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),!0}physicalBasedRenderingChanged(){return!0}pixelRatioChanged(){return!0}setGraphicElevationContext(t,r,i=0){const s=super.setGraphicElevationContext(t,r);return s.addOffsetRenderUnits(i),s}updateGraphicElevationContext(t,r){this.setGraphicElevationContext(t,r.elevationContext,r.metadata.elevationOffset),r.needsElevationUpdates=Wd(r.elevationContext.mode)}computeComplexity(){return{primitivesPerFeature:2,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1,memory:_se.memory}}_createVertexData(t){const{translation:r,centerOffset:i}=t,s=r?{size:3,data:[r[0],r[1],r[2]],exclusive:!0}:{size:3,data:[0,0,0],exclusive:!0},n=i?{size:4,data:[i[0],i[1],i[2],i[3]],exclusive:!0}:{size:4,data:[0,0,0,1],exclusive:!0};return[[O.POSITION,s],[O.NORMAL,{size:3,data:[0,0,1],exclusive:!0}],[O.AUXPOS1,n]]}_getOrCreateMaterial(t){const r=this._perInstanceMaterialParameters(t),i=Ex.uniqueMaterialIdentifier(r);if(b(this._material)&&i===this._material.uniqueMaterialIdentifier)return{material:this._material,isUnique:!1};if(t.materialCollection){let s=t.materialCollection.get(i);return R(s)&&(s=new Ex(r),t.materialCollection.add(i,s)),{material:s,isUnique:!1}}return{material:new Ex(r),isUnique:!0}}_createAs3DShape(t,r,i,s){const n=[new Bi(this._createVertexData(i),hmt,rc.Point)],o=this._getOrCreateMaterial(i),a=wse(this._context,t,n,[o.material],r,this._context.layer.uid,s);if(a===null)return null;const l=new Sg(this,a.object,n,o.isUnique?[o.material]:null,null,a$,r);return l.metadata={elevationOffset:i.elevationOffset||0},l.alignedSampledElevation=a.sampledElevation,l.needsElevationUpdates=Wd(r.mode),l$(l,t,this._context.elevationProvider),l}}zB.elevationModeChangeTypes={definedChanged:is.UPDATE,staysOnTheGround:is.UPDATE,onTheGroundChanged:is.RECREATE};const H7=new Uint16Array([0]),hmt=[[O.POSITION,H7],[O.NORMAL,H7],[O.AUXPOS1,H7]],dmt={mode:"relative-to-ground",offset:0},pmt={ignoreDrivers:!0,renderPriority:0,renderPriorityStep:1},tfe=fe.getLogger("esri.views.3d.layers.graphics.Graphics3DCalloutSymbolLayerFactory");function fmt(e,t){if(!Zee(e))return tfe.error("Graphics3DCalloutSymbolLayerFactory#make",`symbol of type '${e.type}' does not support callouts`),null;if(!e.callout)return null;const r=mmt[e.callout.type];return r?new r(e,t):(tfe.error("Graphics3DCalloutSymbolLayerFactory#make",`unknown or unsupported callout type ${e.callout.type}`),null)}const mmt={line:zB};class gmt{constructor(t,r,i){this.graphic=t,this.renderingInfo=r,this.layer=i}}const rfe=new Ls(Array,e=>l6(e,ixe),null,10,5),ymt=Ut();class vmt{constructor(t,r,i,s,n){this.graphic=t,this.graphics3DSymbol=r,this.graphics=i,this._labelGraphics=new Array,this._auxiliaryGraphics=new Array,this._visibilityFlags=_mt(Co._COUNT,eh._COUNT),this._featureExpressionFeature=null,this._optimizedGeometry={geometry:null,hasZ:!1,hasM:!1},this._extent=null,this.isElevationSource=!1,++r.referenced,this._featureExpressionFeature=n?rPe(n,t,s):null;for(const o of i)b(o)&&(this.isElevationSource=this.isElevationSource||o.isElevationSource)}get labelGraphics(){return this._labelGraphics}get extent(){return this._extent}initialize(t,r){this._layer=r,this._stage=t,this._forEachSymbolLayerGraphic(i=>{i.initialize(t,r),i.setVisibility(this.isVisible())})}destroy(){this._forEachSymbolLayerGraphic(t=>t.destroy()),this.graphics=null,this._auxiliaryGraphics=null,--this.graphics3DSymbol.referenced,this.graphics3DSymbol=null}get destroyed(){return this.graphics==null}clearLabelGraphics(){this._forEachLabelGraphic(t=>t.destroy()),this._labelGraphics.length=0}addLabelGraphic(t,r,i){this._labelGraphics.push(t),t.initialize(r,i),t.setVisibility(this.isVisible(Co.LABEL))}addAuxiliaryGraphic(t){this._auxiliaryGraphics.push(t),this._layer&&(t.initialize(this._stage,this._layer),t.setVisibility(this.isVisible()))}get isDraped(){let t=!1;return this._forEachSymbolLayerGraphic(r=>{r.type==="draped"&&(t=!0)}),t}isVisible(t=Co.GRAPHIC,r){for(let i=0;i<=t;i++){const s=this._visibilityFlags[i];for(let n=0;n<s.length;++n)if(s[n]===!1&&n!==r)return!1}return!0}hasVisibilityFlag(t,r){return this._visibilityFlags[r][t]!=null}setVisibilityFlag(t,r,i){const s=this.isVisible(i);this._visibilityFlags[i][t]=r;const n=this.isVisible(i);if(s===n)return!1;if(i===Co.LABEL)this._forEachLabelGraphic(o=>o.setVisibility(n));else{this._forEachSymbolLayerGraphic(a=>a.setVisibility(n));const o=this.isVisible(Co.LABEL);this._forEachLabelGraphic(a=>a.setVisibility(o))}return!0}clearVisibilityFlag(t,r=Co.GRAPHIC){return this.setVisibilityFlag(t,void 0,r)}computeExtent(t){if(!this._extent){const r=this.graphic.geometry;if(R(r))return!1;this._extent=Ut(),gft(r,this._extent);const i=r.spatialReference;if(!i.equals(t)&&!T6(this._extent,i,this._extent,t))return this._extent=null,!1}return!0}getAsOptimizedGeometry(t,r){return b(this._optimizedGeometry.geometry)&&this._optimizedGeometry.hasZ===t&&this._optimizedGeometry.hasM===r||(this._optimizedGeometry.geometry=this._convertGraphicToOptimizedGeometry(this.graphic,t,r),this._optimizedGeometry.hasZ=t,this._optimizedGeometry.hasM=r),this._optimizedGeometry.geometry}_convertGraphicToOptimizedGeometry(t,r,i){let s=t.geometry;return s.type!=="mesh"&&s.type!=="extent"||(s=Oa.fromExtent(s.type==="mesh"?s.extent:s)),EZe(s,r,i)}get usedMemory(){let t=xTe(this.graphic.attributes);return this._forEachSymbolLayerGraphic(r=>{const i=r.graphics3DSymbolLayer.complexity;if(R(i))return;const s=r.type==="draped"?i.memory.draped:i.memory;t+=s.bytesPerFeature,s.bytesPerCoordinate&&(t+=mft(this.graphic.geometry)*s.bytesPerCoordinate)}),t}computeAttachmentOrigin(){const t={render:{origin:M(),num:0},draped:{origin:rt(),num:0}};for(const r of this.graphics)R(r)||r.computeAttachmentOrigin(t);return t.render.num&&le(t.render.origin,t.render.origin,1/t.render.num),t.draped.num&&Bc(t.draped.origin,t.draped.origin,1/t.draped.num),t}async getProjectedBoundingBox(t,r,i,s,n){return n||(n={boundingBox:null,requiresDrapedElevation:!1,screenSpaceObjects:[]}),n.boundingBox?vi(n.boundingBox):n.boundingBox=vi(),n.requiresDrapedElevation=!1,await Xz(this.graphics,async o=>{if(R(o))return;const a=o.type==="draped"?r:t,l=rfe.acquire(),c=await o.getProjectedBoundingBox(a,i,n.screenSpaceObjects,s,l);isFinite(c[2])&&isFinite(c[5])||(n.requiresDrapedElevation=!0),c&&nA(n.boundingBox,l),rfe.release(l)}),bBe(n.boundingBox)||BW(Gee(n.boundingBox,ymt))?n:null}needsElevationUpdates(){for(const t of this.graphics)if(b(t)&&(t.type==="object3d"||t.type==="lod-instance")&&t.needsElevationUpdates)return!0;for(const t of this._labelGraphics)if(t&&t.needsElevationUpdates)return!0;return!1}alignWithElevation(t,r,i){this._forEachRenderedGraphic(s=>{s.type!=="object3d"&&s.type!=="lod-instance"||s.alignWithElevation(t,r,this._featureExpressionFeature,i)})}addObjectStateSet(t,r){this._forEachSymbolLayerGraphic(i=>i.addObjectState(t,r))}removeObjectState(t){this._forEachSymbolLayerGraphic(r=>r.removeObjectState(t))}_forEachGraphicList(t,r){t.forEach(i=>i&&r(i))}_forEachSymbolLayerGraphic(t){this._forEachGraphicList(this.graphics,t),this._forEachGraphicList(this._auxiliaryGraphics,t)}_forEachLabelGraphic(t){this._forEachGraphicList(this._labelGraphics,t)}_forEachRenderedGraphic(t){this._forEachSymbolLayerGraphic(t),this._forEachLabelGraphic(t)}}function _mt(e,t){const r=new Array(e);for(let i=0;i<r.length;i++)r[i]=new Array(t);return r}var ife,sfe,nfe,dPe={exports:{}};ife=dPe,sfe=function(){function e(D,N,V){V=V||2;var B,W,Y,H,ee,me,be,De=N&&N.length,ve=De?N[0]*V:D.length,ge=t(D,0,ve,V,!0),Ee=[];if(!ge||ge.next===ge.prev)return Ee;if(De&&(ge=l(D,N,ge,V)),D.length>80*V){B=Y=D[0],W=H=D[1];for(var Fe=V;Fe<ve;Fe+=V)(ee=D[Fe])<B&&(B=ee),(me=D[Fe+1])<W&&(W=me),ee>Y&&(Y=ee),me>H&&(H=me);be=(be=Math.max(Y-B,H-W))!==0?1/be:0}return i(ge,Ee,V,B,W,be),Ee}function t(D,N,V,B,W){var Y,H;if(W===ne(D,N,V,B)>0)for(Y=N;Y<V;Y+=B)H=X(Y,D[Y],D[Y+1],H);else for(Y=V-B;Y>=N;Y-=B)H=X(Y,D[Y],D[Y+1],H);if(H&&C(H,H.next)){var ee=H.next;Z(H),H=ee}return H}function r(D,N){if(!D)return D;N||(N=D);var V,B=D;do if(V=!1,B.steiner||!C(B,B.next)&&E(B.prev,B,B.next)!==0)B=B.next;else{var W=B.prev;if(Z(B),(B=N=W)===B.next)break;V=!0}while(V||B!==N);return N}function i(D,N,V,B,W,Y,H){if(D){!H&&Y&&g(D,B,W,Y);for(var ee,me,be=D;D.prev!==D.next;)if(ee=D.prev,me=D.next,Y?n(D,B,W,Y):s(D))N.push(ee.i/V),N.push(D.i/V),N.push(me.i/V),Z(D),D=me.next,be=me.next;else if((D=me)===be){H?H===1?i(D=o(r(D),N,V),N,V,B,W,Y,2):H===2&&a(D,N,V,B,W,Y):i(r(D),N,V,B,W,Y,1);break}}}function s(D){var N=D.prev,V=D,B=D.next;if(E(N,V,B)>=0)return!1;for(var W=D.next.next;W!==D.prev;){if(T(N.x,N.y,V.x,V.y,B.x,B.y,W.x,W.y)&&E(W.prev,W,W.next)>=0)return!1;W=W.next}return!0}function n(D,N,V,B){var W=D.prev,Y=D,H=D.next;if(E(W,Y,H)>=0)return!1;for(var ee=W.x<Y.x?W.x<H.x?W.x:H.x:Y.x<H.x?Y.x:H.x,me=W.y<Y.y?W.y<H.y?W.y:H.y:Y.y<H.y?Y.y:H.y,be=W.x>Y.x?W.x>H.x?W.x:H.x:Y.x>H.x?Y.x:H.x,De=W.y>Y.y?W.y>H.y?W.y:H.y:Y.y>H.y?Y.y:H.y,ve=w(ee,me,N,V,B),ge=w(be,De,N,V,B),Ee=D.prevZ,Fe=D.nextZ;Ee&&Ee.z>=ve&&Fe&&Fe.z<=ge;){if(Ee!==D.prev&&Ee!==D.next&&T(W.x,W.y,Y.x,Y.y,H.x,H.y,Ee.x,Ee.y)&&E(Ee.prev,Ee,Ee.next)>=0||(Ee=Ee.prevZ,Fe!==D.prev&&Fe!==D.next&&T(W.x,W.y,Y.x,Y.y,H.x,H.y,Fe.x,Fe.y)&&E(Fe.prev,Fe,Fe.next)>=0))return!1;Fe=Fe.nextZ}for(;Ee&&Ee.z>=ve;){if(Ee!==D.prev&&Ee!==D.next&&T(W.x,W.y,Y.x,Y.y,H.x,H.y,Ee.x,Ee.y)&&E(Ee.prev,Ee,Ee.next)>=0)return!1;Ee=Ee.prevZ}for(;Fe&&Fe.z<=ge;){if(Fe!==D.prev&&Fe!==D.next&&T(W.x,W.y,Y.x,Y.y,H.x,H.y,Fe.x,Fe.y)&&E(Fe.prev,Fe,Fe.next)>=0)return!1;Fe=Fe.nextZ}return!0}function o(D,N,V){var B=D;do{var W=B.prev,Y=B.next.next;!C(W,Y)&&A(W,B,B.next,Y)&&k(W,Y)&&k(Y,W)&&(N.push(W.i/V),N.push(B.i/V),N.push(Y.i/V),Z(B),Z(B.next),B=D=Y),B=B.next}while(B!==D);return r(B)}function a(D,N,V,B,W,Y){var H=D;do{for(var ee=H.next.next;ee!==H.prev;){if(H.i!==ee.i&&x(H,ee)){var me=z(H,ee);return H=r(H,H.next),me=r(me,me.next),i(H,N,V,B,W,Y),void i(me,N,V,B,W,Y)}ee=ee.next}H=H.next}while(H!==D)}function l(D,N,V,B){var W,Y,H,ee=[];for(W=0,Y=N.length;W<Y;W++)(H=t(D,N[W]*B,W<Y-1?N[W+1]*B:D.length,B,!1))===H.next&&(H.steiner=!0),ee.push(_(H));for(ee.sort(c),W=0;W<ee.length;W++)V=r(V=p(ee[W],V),V.next);return V}function c(D,N){return D.x-N.x}function h(D){if(D.next.prev===D)return D;let N=D;for(;;){const V=N.next;if(V.prev===N||V===N||V===D)break;N=V}return N}function p(D,N){var V=f(D,N);if(!V)return N;var B=z(V,D),W=r(V,V.next);let Y=h(B);return r(Y,Y.next),W=h(W),h(N===V?W:N)}function f(D,N){var V,B=N,W=D.x,Y=D.y,H=-1/0;do{if(Y<=B.y&&Y>=B.next.y&&B.next.y!==B.y){var ee=B.x+(Y-B.y)*(B.next.x-B.x)/(B.next.y-B.y);if(ee<=W&&ee>H){if(H=ee,ee===W){if(Y===B.y)return B;if(Y===B.next.y)return B.next}V=B.x<B.next.x?B:B.next}}B=B.next}while(B!==N);if(!V)return null;if(W===H)return V;var me,be=V,De=V.x,ve=V.y,ge=1/0;B=V;do W>=B.x&&B.x>=De&&W!==B.x&&T(Y<ve?W:H,Y,De,ve,Y<ve?H:W,Y,B.x,B.y)&&(me=Math.abs(Y-B.y)/(W-B.x),k(B,D)&&(me<ge||me===ge&&(B.x>V.x||B.x===V.x&&m(V,B)))&&(V=B,ge=me)),B=B.next;while(B!==be);return V}function m(D,N){return E(D.prev,D,N.prev)<0&&E(N.next,D,D.next)<0}function g(D,N,V,B){var W=D;do W.z===null&&(W.z=w(W.x,W.y,N,V,B)),W.prevZ=W.prev,W.nextZ=W.next,W=W.next;while(W!==D);W.prevZ.nextZ=null,W.prevZ=null,v(W)}function v(D){var N,V,B,W,Y,H,ee,me,be=1;do{for(V=D,D=null,Y=null,H=0;V;){for(H++,B=V,ee=0,N=0;N<be&&(ee++,B=B.nextZ);N++);for(me=be;ee>0||me>0&&B;)ee!==0&&(me===0||!B||V.z<=B.z)?(W=V,V=V.nextZ,ee--):(W=B,B=B.nextZ,me--),Y?Y.nextZ=W:D=W,W.prevZ=Y,Y=W;V=B}Y.nextZ=null,be*=2}while(H>1);return D}function w(D,N,V,B,W){return(D=1431655765&((D=858993459&((D=252645135&((D=16711935&((D=32767*(D-V)*W)|D<<8))|D<<4))|D<<2))|D<<1))|(N=1431655765&((N=858993459&((N=252645135&((N=16711935&((N=32767*(N-B)*W)|N<<8))|N<<4))|N<<2))|N<<1))<<1}function _(D){var N=D,V=D;do(N.x<V.x||N.x===V.x&&N.y<V.y)&&(V=N),N=N.next;while(N!==D);return V}function T(D,N,V,B,W,Y,H,ee){return(W-H)*(N-ee)-(D-H)*(Y-ee)>=0&&(D-H)*(B-ee)-(V-H)*(N-ee)>=0&&(V-H)*(Y-ee)-(W-H)*(B-ee)>=0}function x(D,N){return D.next.i!==N.i&&D.prev.i!==N.i&&!L(D,N)&&(k(D,N)&&k(N,D)&&G(D,N)&&(E(D.prev,D,N.prev)||E(D,N.prev,N))||C(D,N)&&E(D.prev,D,D.next)>0&&E(N.prev,N,N.next)>0)}function E(D,N,V){return(N.y-D.y)*(V.x-N.x)-(N.x-D.x)*(V.y-N.y)}function C(D,N){return D.x===N.x&&D.y===N.y}function A(D,N,V,B){var W=I(E(D,N,V)),Y=I(E(D,N,B)),H=I(E(V,B,D)),ee=I(E(V,B,N));return W!==Y&&H!==ee||!(W!==0||!P(D,V,N))||!(Y!==0||!P(D,B,N))||!(H!==0||!P(V,D,B))||!(ee!==0||!P(V,N,B))}function P(D,N,V){return N.x<=Math.max(D.x,V.x)&&N.x>=Math.min(D.x,V.x)&&N.y<=Math.max(D.y,V.y)&&N.y>=Math.min(D.y,V.y)}function I(D){return D>0?1:D<0?-1:0}function L(D,N){var V=D;do{if(V.i!==D.i&&V.next.i!==D.i&&V.i!==N.i&&V.next.i!==N.i&&A(V,V.next,D,N))return!0;V=V.next}while(V!==D);return!1}function k(D,N){return E(D.prev,D,D.next)<0?E(D,N,D.next)>=0&&E(D,D.prev,N)>=0:E(D,N,D.prev)<0||E(D,D.next,N)<0}function G(D,N){var V=D,B=!1,W=(D.x+N.x)/2,Y=(D.y+N.y)/2;do V.y>Y!=V.next.y>Y&&V.next.y!==V.y&&W<(V.next.x-V.x)*(Y-V.y)/(V.next.y-V.y)+V.x&&(B=!B),V=V.next;while(V!==D);return B}function z(D,N){var V=new ce(D.i,D.x,D.y),B=new ce(N.i,N.x,N.y),W=D.next,Y=N.prev;return D.next=N,N.prev=D,V.next=W,W.prev=V,B.next=V,V.prev=B,Y.next=B,B.prev=Y,B}function X(D,N,V,B){var W=new ce(D,N,V);return B?(W.next=B.next,W.prev=B,B.next.prev=W,B.next=W):(W.prev=W,W.next=W),W}function Z(D){D.next.prev=D.prev,D.prev.next=D.next,D.prevZ&&(D.prevZ.nextZ=D.nextZ),D.nextZ&&(D.nextZ.prevZ=D.prevZ)}function ce(D,N,V){this.i=D,this.x=N,this.y=V,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function ne(D,N,V,B){for(var W=0,Y=N,H=V-B;Y<V;Y+=B)W+=(D[H]-D[Y])*(D[Y+1]+D[H+1]),H=Y;return W}return e.deviation=function(D,N,V,B){var W=N&&N.length,Y=W?N[0]*V:D.length,H=Math.abs(ne(D,0,Y,V));if(W)for(var ee=0,me=N.length;ee<me;ee++){var be=N[ee]*V,De=ee<me-1?N[ee+1]*V:D.length;H-=Math.abs(ne(D,be,De,V))}var ve=0;for(ee=0;ee<B.length;ee+=3){var ge=B[ee]*V,Ee=B[ee+1]*V,Fe=B[ee+2]*V;ve+=Math.abs((D[ge]-D[Fe])*(D[Ee+1]-D[ge+1])-(D[ge]-D[Ee])*(D[Fe+1]-D[ge+1]))}return H===0&&ve===0?0:Math.abs((ve-H)/H)},e.flatten=function(D){for(var N=D[0][0].length,V={vertices:[],holes:[],dimensions:N},B=0,W=0;W<D.length;W++){for(var Y=0;Y<D[W].length;Y++)for(var H=0;H<N;H++)V.vertices.push(D[W][Y][H]);W>0&&(B+=D[W-1].length,V.holes.push(B))}return V},e},(nfe=sfe())!==void 0&&(ife.exports=nfe);const BA=dPe.exports,BB=fe.getLogger("esri.views.3d.support.buffer.math");function RL(e,t,r){if(e.count!==t.count)return void BB.error("source and destination buffers need to have the same number of elements");const i=e.count,s=r[0],n=r[1],o=r[2],a=r[4],l=r[5],c=r[6],h=r[8],p=r[9],f=r[10],m=r[12],g=r[13],v=r[14],w=e.typedBuffer,_=e.typedBufferStride,T=t.typedBuffer,x=t.typedBufferStride;for(let E=0;E<i;E++){const C=E*_,A=E*x,P=T[A],I=T[A+1],L=T[A+2];w[C]=s*P+a*I+h*L+m,w[C+1]=n*P+l*I+p*L+g,w[C+2]=o*P+c*I+f*L+v}}function G1(e,t,r){if(e.count!==t.count)return void BB.error("source and destination buffers need to have the same number of elements");const i=e.count,s=r[0],n=r[1],o=r[2],a=r[3],l=r[4],c=r[5],h=r[6],p=r[7],f=r[8],m=e.typedBuffer,g=e.typedBufferStride,v=t.typedBuffer,w=t.typedBufferStride;for(let _=0;_<i;_++){const T=_*g,x=_*w,E=v[x],C=v[x+1],A=v[x+2];m[T]=s*E+a*C+h*A,m[T+1]=n*E+l*C+p*A,m[T+2]=o*E+c*C+f*A}}function PQ(e,t,r){const i=Math.min(e.count,t.count),s=e.typedBuffer,n=e.typedBufferStride,o=t.typedBuffer,a=t.typedBufferStride;for(let l=0;l<i;l++){const c=l*n,h=l*a;s[c]=r*o[h],s[c+1]=r*o[h+1],s[c+2]=r*o[h+2]}}function xse(e,t){const r=Math.min(e.count,t.count),i=e.typedBuffer,s=e.typedBufferStride,n=t.typedBuffer,o=t.typedBufferStride;for(let a=0;a<r;a++){const l=a*s,c=a*o,h=n[c],p=n[c+1],f=n[c+2],m=h*h+p*p+f*f;if(m>0){const g=1/Math.sqrt(m);i[l]=g*h,i[l+1]=g*p,i[l+2]=g*f}}}function bmt(e,t,r){const i=Math.min(e.count,t.count),s=e.typedBuffer,n=e.typedBufferStride,o=t.typedBuffer,a=t.typedBufferStride;for(let l=0;l<i;l++){const c=l*n,h=l*a;s[c]=o[h]>>r,s[c+1]=o[h+1]>>r,s[c+2]=o[h+2]>>r}}Object.freeze(Object.defineProperty({__proto__:null,transformMat4:RL,transformMat3:G1,scale:PQ,normalize:xse,shiftRight:bmt},Symbol.toStringTag,{value:"Module"}));function GB(e,t){if(!e||e.symbol)return null;const r=t&&t.renderer;return e&&b(r)&&r.getObservationRenderer?r.getObservationRenderer(e):r}function wmt(e,t){if(b(e.symbol))return e.symbol;const r=GB(e,t);return b(r)&&r.type!=="dot-density"?r.getSymbol(e,t):null}function gDt(e,t){const r=GB(e,t),i=wmt(e,t);if(R(i))return null;const s={renderer:r,symbol:i};if(R(r)||!("visualVariables"in r)||!r.visualVariables)return s;const n=_re(r,e,t),o=["proportional","proportional","proportional"];for(const{variable:a,value:l}of n)switch(a.type){case"color":s.color=l.toRgba();break;case"size":if(a.target==="outline")s.outlineSize=l;else{const c=a.axis,h=a.useSymbolValue?"symbol-value":l;switch(c){case"width":o[0]=h;break;case"depth":o[1]=h;break;case"height":o[2]=h;break;case"width-and-depth":o[0]=o[1]=h;break;default:o[0]=o[1]=o[2]=h}}break;case"opacity":s.opacity=l;break;case"rotation":switch(a.axis){case"tilt":s.tilt=l;break;case"roll":s.roll=l;break;default:s.heading=l}}return o[0]==="proportional"&&o[1]==="proportional"&&o[2]==="proportional"||(s.size=o),s}async function xmt(e,t){if(b(e.symbol))return e.symbol;const r=GB(e,t);return b(r)&&r.getSymbolAsync(e,t)}async function yDt(e,t){const r=GB(e,t),i=await xmt(e,t);if(!i)return null;const s={renderer:r,symbol:i};if(!r||!("visualVariables"in r)||!r.visualVariables)return s;const n=_re(r,e,t),o=["proportional","proportional","proportional"];for(const{variable:a,value:l}of n)if(a.type==="color")s.color=Me.toUnitRGBA(l);else if(a.type==="size")if(a.target==="outline")s.outlineSize=l;else{const c=a.axis,h=a.useSymbolValue?"symbol-value":l;c==="width"?o[0]=h:c==="depth"?o[1]=h:c==="height"?o[2]=h:o[0]=o[1]=c==="width-and-depth"?h:o[2]=h}else a.type==="opacity"?s.opacity=l:a.type==="rotation"&&a.axis==="tilt"?s.tilt=l:a.type==="rotation"&&a.axis==="roll"?s.roll=l:a.type==="rotation"&&(s.heading=l);return(isFinite(o[0])||isFinite(o[1])||isFinite(o[2]))&&(s.size=o),s}function Tmt(e,t=0){const r=e[t];return typeof r=="number"&&isFinite(r)?r:null}function Smt(e){for(let t=0;t<3;t++){const r=e[t];if(typeof r=="number")return isFinite(r)?r:0}return 0}function pPe(e,t,r){var C;const i=e.byteLength/(4*t),s=new Uint32Array(e,0,i*t);let n=new Uint32Array(i);const o=(C=r==null?void 0:r.minReduction)!=null?C:0,a=(r==null?void 0:r.originalIndices)||null,l=a?a.length:0,c=(r==null?void 0:r.componentOffsets)||null;let h=0;if(c)for(let A=0;A<c.length-1;A++){const P=c[A+1]-c[A];P>h&&(h=P)}else h=i;const p=Math.floor(1.1*h)+1;(Df==null||Df.length<2*p)&&(Df=new Uint32Array(qC(2*p)));for(let A=0;A<2*p;A++)Df[A]=0;let f=0;const m=!!c&&!!a,g=m?l:i,v=m?new Uint32Array(l):null,w=1.96;let _=o!==0?Math.ceil(4*w*w/(o*o)*o*(1-o)):g,T=1,x=c?c[1]:g;for(let A=0;A<g;A++){if(A===_){const z=1-f/A;if(z+w*Math.sqrt(z*(1-z)/A)<o)return null;_*=2}if(A===x){for(let z=0;z<2*p;z++)Df[z]=0;if(a)for(let z=c[T-1];z<c[T];z++)v[z]=n[a[z]];x=c[++T]}const P=m?a[A]:A,I=P*t,L=Amt(s,I,t);let k=L%p,G=f;for(;Df[2*k+1]!==0;){if(Df[2*k]===L){const z=Df[2*k+1]-1;if(Emt(s,I,z*t,t)){G=n[z];break}}k++,k>=p&&(k-=p)}G===f&&(Df[2*k]=L,Df[2*k+1]=P+1,f++),n[P]=G}if(o!==0&&1-f/i<o)return null;if(m){for(let A=c[T-1];A<v.length;A++)v[A]=n[a[A]];n=v}const E=new Uint32Array(t*f);f=0;for(let A=0;A<g;A++)n[A]===f&&(Cmt(s,(m?a[A]:A)*t,E,f*t,t),f++);if(a&&!m){const A=new Uint32Array(l);for(let P=0;P<A.length;P++)A[P]=n[a[P]];n=A}return{buffer:E.buffer,indices:n,uniqueCount:f}}function Emt(e,t,r,i){for(let s=0;s<i;s++)if(e[t+s]!==e[r+s])return!1;return!0}function Cmt(e,t,r,i,s){for(let n=0;n<s;n++)r[i+n]=e[t+n]}function Amt(e,t,r){let i=0;for(let s=0;s<r;s++)i=e[t+s]+i|0,i=i+(i<<11)+(i>>>2)|0;return i>>>0}let Df=null;function vDt(e){const t=OL(e.rings,e.hasZ,lg.CCW_IS_HOLE),r=[];let i=0,s=0;for(const a of t.polygons){const l=a.count,c=a.index,h=new Float64Array(t.position.buffer,3*c*t.position.BYTES_PER_ELEMENT,3*l),p=a.holeIndices.map(m=>m-c),f=new Uint32Array(BA(h,p,3));r.push({position:h,faces:f}),i+=h.length,s+=f.length}const n=Rmt(r,i,s),o=pPe(n.position.buffer,6,{originalIndices:n.faces});return n.position=new Float64Array(o.buffer),n.faces=o.indices,n}function Rmt(e,t,r){if(e.length===1)return e[0];const i=new Float64Array(t),s=new Uint32Array(r);let n=0,o=0,a=0;for(const l of e){for(let c=0;c<l.position.length;c++)i[n++]=l.position[c];for(let c=0;c<l.faces.length;c++)s[o++]=l.faces[c]+a;a=n/3}return{position:i,faces:s}}function OL(e,t,r){const i=e.length,s=new Array(i),n=new Array(i),o=new Array(i);let a=0,l=0,c=0,h=0;for(let m=0;m<i;++m)h+=e[m].length;const p=new Float64Array(3*h);let f=0;for(let m=i-1;m>=0;m--){const g=e[m],v=r===lg.CCW_IS_HOLE&&Omt(g);if(v&&i!==1)s[a++]=g;else{let w=g.length;for(let T=0;T<a;++T)w+=s[T].length;const _={index:f,pathLengths:new Array(a+1),count:w,holeIndices:new Array(a)};_.pathLengths[0]=g.length,g.length>0&&(o[c++]={index:f,count:g.length}),f=v?JN(g,g.length-1,-1,p,f,g.length,t):JN(g,0,1,p,f,g.length,t);for(let T=0;T<a;++T){const x=s[T];_.holeIndices[T]=f,_.pathLengths[T+1]=x.length,x.length>0&&(o[c++]={index:f,count:x.length}),f=JN(x,0,1,p,f,x.length,t)}a=0,_.count>0&&(n[l++]=_)}}for(let m=0;m<a;++m){const g=s[m];g.length>0&&(o[c++]={index:f,count:g.length}),f=JN(g,0,1,p,f,g.length,t)}return l<i&&(n.length=l),c<i&&(o.length=c),{position:p,polygons:n,outlines:o}}function JN(e,t,r,i,s,n,o){s*=3;for(let a=0;a<n;++a){const l=e[t];i[s++]=l[0],i[s++]=l[1],i[s++]=o?l[2]:0,t+=r}return s/3}function Omt(e){return!xee(e,!1,!1)}var lg;(function(e){e[e.NONE=0]="NONE",e[e.CCW_IS_HOLE=1]="CCW_IS_HOLE"})(lg||(lg={}));var _P,IQ;(function(e){e[e.RasterImage=0]="RasterImage",e[e.Features=1]="Features"})(_P||(_P={})),function(e){e[e.WithRasterImage=0]="WithRasterImage",e[e.WithoutRasterImage=1]="WithoutRasterImage"}(IQ||(IQ={}));var Gi,_d,zt,GA,Ms,ro;(function(e){e[e.INNER=0]="INNER",e[e.OUTER=1]="OUTER"})(Gi||(Gi={})),function(e){e[e.REGULAR=0]="REGULAR",e[e.HAS_NORTH_POLE=1]="HAS_NORTH_POLE",e[e.HAS_SOUTH_POLE=2]="HAS_SOUTH_POLE",e[e.HAS_BOTH_POLES=3]="HAS_BOTH_POLES"}(_d||(_d={})),function(e){e[e.NORTH=0]="NORTH",e[e.NORTH_EAST=1]="NORTH_EAST",e[e.EAST=2]="EAST",e[e.SOUTH_EAST=3]="SOUTH_EAST",e[e.SOUTH=4]="SOUTH",e[e.SOUTH_WEST=5]="SOUTH_WEST",e[e.WEST=6]="WEST",e[e.NORTH_WEST=7]="NORTH_WEST"}(zt||(zt={})),function(e){e[e.OFF=0]="OFF",e[e.ON=1]="ON"}(GA||(GA={})),function(e){e[e.Color=0]="Color",e[e.ColorNoRasterImage=1]="ColorNoRasterImage",e[e.Highlight=2]="Highlight",e[e.Water=3]="Water",e[e.Occluded=4]="Occluded"}(Ms||(Ms={})),function(e){e[e.FADING=0]="FADING",e[e.IMMEDIATE=1]="IMMEDIATE",e[e.UNFADED=2]="UNFADED"}(ro||(ro={}));class Mmt{constructor(t,r){this.vec3=t,this.id=r}}function bP(e,t,r,i){return new Mmt(Ue(e,t,r),i)}var il;(function(e){e[e.None=0]="None",e[e.ColorAndWater=1]="ColorAndWater",e[e.Highlight=2]="Highlight",e[e.Occluded=3]="Occluded"})(il||(il={}));class ofe{constructor(t,r){this.index=t,this.renderTargets=r,this._extent=Ut(),this.resolution=0,this.renderLocalOrigin=bP(0,0,0,"O"),this.pixelRatio=1,this.mapUnitsPerPixel=1,this.canvasGeometries=new Imt,this.validTargets=null,this.hasDrapedFeatureSource=!1,this.hasDrapedRasterSource=!1,this.hasTargetWithoutRasterImage=!1,this.index=t,this.validTargets=new Array(r.renderTargets.length).fill(!1)}get extent(){return this._extent}getValidTexture(t){return this.validTargets[t]?this.renderTargets.getTarget(t).getTexture():null}get _needsColorWithoutRasterImage(){return this.hasDrapedRasterSource&&this.hasDrapedFeatureSource&&this.hasTargetWithoutRasterImage}getColorTexture(t){const r=t===il.ColorAndWater?this.renderTargets.getTarget(Ms.Color):t===il.Highlight?this.renderTargets.getTarget(Ms.Highlight):this.renderTargets.getTarget(Ms.Occluded);return r?r.getTexture():null}getColorTextureNoRasterImage(){return this._needsColorWithoutRasterImage?this.getValidTexture(Ms.ColorNoRasterImage):this.hasDrapedFeatureSource?this.getValidTexture(Ms.Color):null}getNormalTexture(t){const r=t===il.ColorAndWater?this.renderTargets.getTarget(Ms.Water):null;return r?r.getTexture():null}draw(t,r){const i=this.computeRenderTargetValidityBitfield();for(const s of this.renderTargets.renderTargets)s.type!==Ms.ColorNoRasterImage||this._needsColorWithoutRasterImage?this.validTargets[s.type]=t.drawTarget(this,s,r):this.validTargets[s.type]=!1;return i^this.computeRenderTargetValidityBitfield()?CA.CHANGED:CA.UNCHANGED}computeRenderTargetValidityBitfield(){const t=this.validTargets;return+t[Ms.Color]|+t[Ms.ColorNoRasterImage]<<1|+t[Ms.Highlight]<<2|+t[Ms.Water]<<3|+t[Ms.Occluded]<<4}setupGeometryViewsCyclical(t){this.setupGeometryViewsDirect();const r=.001*t.range;if(this._extent[0]-r<=t.min){const i=this.canvasGeometries.extents[this.canvasGeometries.numViews++];MU(this._extent,t.range,0,i)}if(this._extent[2]+r>=t.max){const i=this.canvasGeometries.extents[this.canvasGeometries.numViews++];MU(this._extent,-t.range,0,i)}}setupGeometryViewsDirect(){this.canvasGeometries.numViews=1,h0(this.canvasGeometries.extents[0],this._extent)}hasSomeSizedView(){for(let t=0;t<this.canvasGeometries.numViews;t++){const r=this.canvasGeometries.extents[t];if(r[0]!==r[2]&&r[1]!==r[3])return!0}return!1}applyViewport(t){t.setViewport(this.index===Gi.INNER?0:this.resolution,0,this.resolution,this.resolution)}}function Pmt(e,t,r){return Math.min(qC(Math.max(e,t)+256),r)}class Imt{constructor(){this.extents=[Ut(),Ut(),Ut()],this.numViews=0}}class fPe{constructor(t,r){this.size=Sie(),this._fbo=null,this._fbo=new Pi(t,{colorTarget:us.TEXTURE,depthStencilTarget:Pr.NONE},{target:mt.TEXTURE_2D,pixelFormat:ze.RGBA,dataType:Ct.UNSIGNED_BYTE,wrapMode:xt.CLAMP_TO_EDGE,samplingMode:et.LINEAR_MIPMAP_LINEAR,hasMipmap:r,maxAnisotropy:8,width:0,height:0})}dispose(){this._fbo=Ye(this._fbo)}getTexture(){return this._fbo?this._fbo.colorTexture:null}isValid(){return this._fbo!==null}resize(t,r){this.size[0]=t,this.size[1]=r,this._fbo.resize(this.size[0],this.size[1])}bind(t){t.bindFramebuffer(this._fbo)}generateMipMap(){this._fbo.colorTexture.descriptor.hasMipmap&&this._fbo.colorTexture.generateMipmap()}disposeRenderTargetMemory(){var t;(t=this._fbo)==null||t.resize(0,0)}get gpuMemoryUsage(){var t,r;return(r=(t=this._fbo)==null?void 0:t.gpuMemoryUsage)!=null?r:0}}class $mt{constructor(t){const r=(i,s,n=!0)=>({type:s,fbo:new fPe(t,n),renderPass:i,valid:!1,lastUsed:1/0});this.renderTargets=[r(je.MATERIAL,Ms.Color),r(je.MATERIAL,Ms.ColorNoRasterImage),r(je.MATERIAL_HIGHLIGHT,Ms.Highlight,!1),r(je.MATERIAL_NORMAL,Ms.Water),r(je.MATERIAL,Ms.Occluded)]}getTarget(t){return this.renderTargets[t].fbo}dispose(){for(const t of this.renderTargets)t.fbo.dispose()}disposeRenderTargetMemory(){for(const t of this.renderTargets)t.fbo.disposeRenderTargetMemory()}validateUsageForTarget(t,r,i){if(t)r.lastUsed=i;else if(i-r.lastUsed>Lmt)r.fbo.disposeRenderTargetMemory(),r.lastUsed=1/0;else if(r.lastUsed<1/0)return!0;return!1}get gpuMemoryUsage(){return this.renderTargets.reduce((t,r)=>t+r.fbo.gpuMemoryUsage,0)}}const Lmt=1e3;class Tse{constructor(){this._outer=new Map}clear(){this._outer.clear()}get empty(){return this._outer.size===0}get(t,r){var i;return(i=this._outer.get(t))==null?void 0:i.get(r)}set(t,r,i){const s=this._outer.get(t);s?s.set(r,i):this._outer.set(t,new Map([[r,i]]))}delete(t,r){const i=this._outer.get(t);i&&(i.delete(r),i.size===0&&this._outer.delete(t))}forEach(t){this._outer.forEach((r,i)=>t(r,i))}}class mPe{constructor(t){this._context=t,this._perConstructorInstances=new Tse,this._frameCounter=0,this._keepAliveFrameCount=afe}get viewingMode(){return this._context.viewingMode}get constructionContext(){return this._context}dispose(){this._perConstructorInstances.forEach(t=>t.forEach(r=>r.technique.destroy())),this._perConstructorInstances.clear()}acquire(t,r){const i=r.key;let s=this._perConstructorInstances.get(t,i);if(R(s)){const n=new t(this._context,r,()=>this.release(n));s=new Dmt(n),this._perConstructorInstances.set(t,i,s)}return++s.refCount,s.technique}releaseAndAcquire(t,r,i){if(b(i)){if(r.key===i.key)return i;this.release(i)}return this.acquire(t,r)}release(t){if(R(t)||this._perConstructorInstances.empty)return;const r=this._perConstructorInstances.get(t.constructor,t.key);R(r)||(--r.refCount,r.refCount===0&&(r.refZeroFrame=this._frameCounter))}frameUpdate(){this._frameCounter++,this._keepAliveFrameCount!==afe&&this._perConstructorInstances.forEach((t,r)=>{t.forEach((i,s)=>{i.refCount===0&&i.refZeroFrame+this._keepAliveFrameCount<this._frameCounter&&(i.technique.destroy(),this._perConstructorInstances.delete(r,s))})})}async reloadAll(){const t=new Array;this._perConstructorInstances.forEach((r,i)=>{const s=async(n,o)=>{const a=o.shader;a&&(await a.reload(),n.forEach(l=>{l.technique.reload(this._context)}))};t.push(s(r,i))}),await Promise.all(t)}}class Dmt{constructor(t){this.technique=t,this.refCount=0,this.refZeroFrame=0}}const afe=-1,jB=e=>{class t extends e{constructor(){super(...arguments),this._isDisposed=!1}dispose(){var i;for(const s of(i=this._managedDisposables)!=null?i:[]){const n=this[s];this[s]=null,n&&typeof n.dispose=="function"&&n.dispose()}this._isDisposed=!0}get isDisposed(){return this._isDisposed}}return t};class HB extends jB(class{}){}function Xo(){return(e,t)=>{var r,i;e.hasOwnProperty("_managedDisposables")||(e._managedDisposables=(i=(r=e._managedDisposables)==null?void 0:r.slice())!=null?i:[]),e._managedDisposables.unshift(t)}}const Nmt=fe.getLogger("esri.views.3d.webgl-engine.lib.GLMaterialRepository");class gPe{constructor(t,r,i,s){this._textureRepository=t,this._techniqueRepository=r,this.materialChanged=i,this.requestRender=s,this._id2glMaterialRef=new Tse}dispose(){this._textureRepository.dispose()}acquire(t,r){this._ownMaterial(t);let i=this._id2glMaterialRef.get(r,t.id);if(R(i)){const s=t.createGLMaterial({material:t,techniqueRep:this._techniqueRepository,textureRep:this._textureRepository,output:r});i=new Fmt(s),this._id2glMaterialRef.set(r,t.id,i)}return i.ref(),i.glMaterial}release(t,r){const i=this._id2glMaterialRef.get(r,t.id);b(i)&&(i.unref(),i.referenced||(Ye(i.glMaterial),this._id2glMaterialRef.delete(r,t.id)))}_ownMaterial(t){b(t.repository)&&t.repository!==this&&Nmt.error("Material is already owned by a different material repository"),t.repository=this}}class Fmt{constructor(t){this.glMaterial=t,this.refCnt=0}ref(){++this.refCnt}unref(){--this.refCnt,ft(this.refCnt>=0)}get referenced(){return this.refCnt>0}}const kmt={orderedRepackingEnabled:!1},Umt={rootOrigin:null},Vmt=["layerObjectAdded","layerObjectRemoved","layerObjectsAdded","layerObjectsRemoved","shaderTransformationChanged","objectTransformation","visibilityChanged","occlusionChanged","highlightChanged","objectGeometryAdded","objectGeometryRemoved","vertexAttrsUpdated"];class jA{constructor(t,r){this._objectToBoundingSphere=t,this._maximumObjectsPerNode=10,this._maximumDepth=20,this._degenerateObjects=new Set,this._root=new as,this._objectCount=0,r&&(r.maximumObjectsPerNode!==void 0&&(this._maximumObjectsPerNode=r.maximumObjectsPerNode),r.maximumDepth!==void 0&&(this._maximumDepth=r.maximumDepth))}get bounds(){return this._root.bounds}get halfSize(){return this._root.halfSize}get root(){return this._root.node}get maximumObjectsPerNode(){return this._maximumObjectsPerNode}get maximumDepth(){return this._maximumDepth}get objectCount(){return this._objectCount}destroy(){this._degenerateObjects.clear(),as.clearPool(),$Q[0]=null,Tb.prune(),Pw.prune()}add(t,r=t.length){this._objectCount+=r,this._grow(t,r);const i=as.acquire();for(let s=0;s<r;s++){const n=t[s];this._isDegenerate(n)?this._degenerateObjects.add(n):(i.init(this._root),this._add(n,i))}as.release(i)}remove(t,r=null){this._objectCount-=t.length;const i=as.acquire();for(const s of t){const n=b(r)?r:dA(this._objectToBoundingSphere(s),Hmt);p3(n[3])?(i.init(this._root),this._remove(s,n,i)):this._degenerateObjects.delete(s)}as.release(i),this._shrink()}update(t,r){if(!p3(r[3])&&this._isDegenerate(t))return;const i=jmt(t);this.remove(i,r),this.add(i)}forEachAlongRay(t,r,i){const s=wh(t,r);this._forEachNode(this._root,n=>{if(!this._intersectsNode(s,n))return!1;const o=n.node;return o.terminals.forAll(a=>{this._intersectsObject(s,a)&&i(a)}),o.residents!==null&&o.residents.forAll(a=>{this._intersectsObject(s,a)&&i(a)}),!0})}forEachAlongRayWithVerticalOffset(t,r,i,s){const n=wh(t,r);this._forEachNode(this._root,o=>{if(!this._intersectsNodeWithOffset(n,o,s))return!1;const a=o.node;return a.terminals.forAll(l=>{this._intersectsObjectWithOffset(n,l,s)&&i(l)}),a.residents!==null&&a.residents.forAll(l=>{this._intersectsObjectWithOffset(n,l,s)&&i(l)}),!0})}forEach(t){this._forEachNode(this._root,r=>{const i=r.node;return i.terminals.forAll(t),i.residents!==null&&i.residents.forAll(t),!0}),this._degenerateObjects.forEach(t)}forEachDegenerateObject(t){this._degenerateObjects.forEach(t)}findClosest(t,r,i,s=()=>!0,n=1/0){let o=1/0,a=1/0,l=null;const c=q7(t,r),h=p=>{if(--n,!s(p))return;const f=this._objectToBoundingSphere(p);if(!q_(i,f))return;const m=y_(t,r,f),g=m-f[3],v=m+f[3];g<o&&(o=g,a=v,l=p)};return this._forEachNodeDepthOrdered(this._root,p=>{if(n<=0||!q_(i,p.bounds)||(le(Lh,c,p.halfSize),de(Lh,Lh,p.bounds),y_(t,r,Lh)>a))return!1;const f=p.node;return f.terminals.forAll(m=>h(m)),f.residents!==null&&f.residents.forAll(m=>h(m)),!0},t,r),l}forEachInDepthRange(t,r,i,s,n,o,a){let l=-1/0,c=1/0;const h={setRange:v=>{i===jA.DepthOrder.FRONT_TO_BACK?(l=Math.max(l,v.near),c=Math.min(c,v.far)):(l=Math.max(l,-v.far),c=Math.min(c,-v.near))}};h.setRange(s);const p=y_(r,i,t),f=q7(r,i),m=q7(r,-i),g=v=>{if(!a(v))return;const w=this._objectToBoundingSphere(v),_=w,T=y_(r,i,_)-p,x=T-w[3],E=T+w[3];x>c||E<l||!q_(o,w)||n(v,h)};this._forEachNodeDepthOrdered(this._root,v=>{if(!q_(o,v.bounds)||(le(Lh,f,v.halfSize),de(Lh,Lh,v.bounds),y_(r,i,Lh)-p>c)||(le(Lh,m,v.halfSize),de(Lh,Lh,v.bounds),y_(r,i,Lh)-p<l))return!1;const w=v.node;return w.terminals.forAll(_=>g(_)),w.residents!==null&&w.residents.forAll(_=>g(_)),!0},r,i)}forEachNode(t){this._forEachNode(this._root,r=>t(r.node,r.bounds,r.halfSize))}forEachNeighbor(t,r){const i=Hy(r),s=r,n=o=>{const a=this._objectToBoundingSphere(o),l=Hy(a),c=i+l;Fn(a,s)-c*c<=0&&t(o)};this._forEachNode(this._root,o=>{const a=Hy(o.bounds),l=i+a;if(Fn(o.bounds,s)-l*l>0)return!1;const c=o.node;return c.terminals.forAll(h=>n(h)),c.residents!==null&&c.residents.forAll(h=>n(h)),!0}),this.forEachDegenerateObject(n)}_intersectsNode(t,r){return KN(r.bounds,2*-r.halfSize,Gu),KN(r.bounds,2*r.halfSize,ju),Sde(t.origin,t.direction,Gu,ju)}_intersectsNodeWithOffset(t,r,i){return KN(r.bounds,2*-r.halfSize,Gu),KN(r.bounds,2*r.halfSize,ju),i.applyToMinMax(Gu,ju),Sde(t.origin,t.direction,Gu,ju)}_intersectsObject(t,r){const i=this._objectToBoundingSphere(r);return!(i[3]>0)||LX(i,t)}_intersectsObjectWithOffset(t,r,i){const s=this._objectToBoundingSphere(r);return!(s[3]>0)||LX(i.applyToBoundingSphere(s),t)}_forEachNode(t,r){let i=as.acquire().init(t);const s=[i];for(;s.length!==0;){if(i=s.pop(),r(i)&&!i.isLeaf())for(let n=0;n<i.node.children.length;n++)i.node.children[n]&&s.push(as.acquire().init(i).advance(n));as.release(i)}}_forEachNodeDepthOrdered(t,r,i,s=jA.DepthOrder.FRONT_TO_BACK){let n=as.acquire().init(t);const o=[n];for(Gmt(i,s,ufe);o.length!==0;){if(n=o.pop(),r(n)&&!n.isLeaf())for(let a=7;a>=0;--a){const l=ufe[a];n.node.children[l]&&o.push(as.acquire().init(n).advance(l))}as.release(n)}}_remove(t,r,i){Tb.clear();const s=i.advanceTo(r,(n,o)=>{Tb.push(n.node),Tb.push(o)})?i.node.terminals:i.node.residents;if(s.removeUnordered(t),s.length===0)for(let n=Tb.length-2;n>=0;n-=2){const o=Tb.data[n],a=Tb.data[n+1];if(!this._purge(o,a))break}}_nodeIsEmpty(t){if(t.terminals.length!==0)return!1;if(t.residents!==null)return t.residents.length===0;for(let r=0;r<t.children.length;r++)if(t.children[r])return!1;return!0}_purge(t,r){return r>=0&&(t.children[r]=null),!!this._nodeIsEmpty(t)&&(t.residents===null&&(t.residents=new Xt({shrink:!0})),!0)}_add(t,r){r.advanceTo(this._objectToBoundingSphere(t))?r.node.terminals.push(t):(r.node.residents.push(t),r.node.residents.length>this._maximumObjectsPerNode&&r.depth<this._maximumDepth&&this._split(r))}_split(t){const r=t.node.residents;t.node.residents=null;for(let i=0;i<r.length;i++){const s=as.acquire().init(t);this._add(r.getItemAt(i),s),as.release(s)}}_grow(t,r){if(r!==0&&(lfe(t,r,i=>this._objectToBoundingSphere(i),Nf),p3(Nf[3])&&!this._fitsInsideTree(Nf)))if(this._nodeIsEmpty(this._root.node))dA(Nf,this._root.bounds),this._root.halfSize=1.25*Nf[3];else{const i=this._rootBoundsForRootAsSubNode(Nf);this._placingRootViolatesMaxDepth(i)?this._rebuildTree(Nf,i):this._growRootAsSubNode(i),as.release(i)}}_rebuildTree(t,r){ae(X7,r.bounds),X7[3]=r.halfSize,lfe([t,X7],2,s=>s,Z7);const i=as.acquire().init(this._root);this._root.initFrom(null,Z7,1.25*Z7[3]),this._forEachNode(i,s=>(this.add(s.node.terminals.data,s.node.terminals.length),s.node.residents!==null&&this.add(s.node.residents.data,s.node.residents.length),!0)),as.release(i)}_placingRootViolatesMaxDepth(t){const r=Math.log(t.halfSize/this._root.halfSize)*Math.LOG2E;let i=0;return this._forEachNode(this._root,s=>(i=Math.max(i,s.depth),i+r<=this._maximumDepth)),i+r>this._maximumDepth}_rootBoundsForRootAsSubNode(t){const r=t[3],i=t;let s=-1/0;const n=this._root.bounds,o=this._root.halfSize;for(let a=0;a<3;a++){const l=n[a]-o-(i[a]-r),c=i[a]+r-(n[a]+o),h=Math.max(0,Math.ceil(l/(2*o))),p=Math.max(0,Math.ceil(c/(2*o)))+1,f=2**Math.ceil(Math.log(h+p)*Math.LOG2E);s=Math.max(s,f),eF[a].min=h,eF[a].max=p}for(let a=0;a<3;a++){let l=eF[a].min,c=eF[a].max;const h=(s-(l+c))/2;l+=Math.ceil(h),c+=Math.floor(h);const p=n[a]-o-l*o*2;W7[a]=p+(c+l)*o}return W7[3]=s*o*vPe,as.acquire().initFrom(null,W7,s*o,0)}_growRootAsSubNode(t){const r=this._root.node;ae(Nf,this._root.bounds),Nf[3]=this._root.halfSize,this._root.init(t),t.advanceTo(Nf,null,!0),t.node.children=r.children,t.node.residents=r.residents,t.node.terminals=r.terminals}_shrink(){for(;;){const t=this._findShrinkIndex();if(t===-1)break;this._root.advance(t),this._root.depth=0}}_findShrinkIndex(){if(this._root.node.terminals.length!==0||this._root.isLeaf())return-1;let t=null;const r=this._root.node.children;let i=0,s=0;for(;s<r.length&&t==null;)i=s++,t=r[i];for(;s<r.length;)if(r[s++])return-1;return i}_isDegenerate(t){return!p3(this._objectToBoundingSphere(t)[3])}_fitsInsideTree(t){const r=this._root.bounds,i=this._root.halfSize;return t[3]<=i&&t[0]>=r[0]-i&&t[0]<=r[0]+i&&t[1]>=r[1]-i&&t[1]<=r[1]+i&&t[2]>=r[2]-i&&t[2]<=r[2]+i}}class as{constructor(){this.bounds=kn(),this.halfSize=0,this.initFrom(null,null,0,0)}init(t){return this.initFrom(t.node,t.bounds,t.halfSize,t.depth)}initFrom(t,r,i,s=this.depth){return this.node=b(t)?t:as.createEmptyNode(),b(r)&&dA(r,this.bounds),this.halfSize=i,this.depth=s,this}advance(t){let r=this.node.children[t];r||(r=as.createEmptyNode(),this.node.children[t]=r),this.node=r,this.halfSize/=2,this.depth++;const i=yPe[t];return this.bounds[0]+=i[0]*this.halfSize,this.bounds[1]+=i[1]*this.halfSize,this.bounds[2]+=i[2]*this.halfSize,this.bounds[3]=this.halfSize*vPe,this}advanceTo(t,r,i=!1){for(;;){if(this.isTerminalFor(t))return r&&r(this,-1),!0;if(this.isLeaf()){if(!i)return r&&r(this,-1),!1;this.node.residents=null}const s=this._childIndex(t);r&&r(this,s),this.advance(s)}}isLeaf(){return this.node.residents!=null}isTerminalFor(t){return t[3]>this.halfSize/2}_childIndex(t){const r=this.bounds;return(r[0]<t[0]?1:0)+(r[1]<t[1]?2:0)+(r[2]<t[2]?4:0)}static createEmptyNode(){return{children:[null,null,null,null,null,null,null,null],terminals:new Xt({shrink:!0}),residents:new Xt({shrink:!0})}}static acquire(){return as._pool.acquire()}static release(t){as._pool.release(t)}static clearPool(){as._pool.prune()}}function zmt(e,t){e[0]=Math.min(e[0],t[0]-t[3]),e[1]=Math.min(e[1],t[1]-t[3]),e[2]=Math.min(e[2],t[2]-t[3])}function Bmt(e,t){e[0]=Math.max(e[0],t[0]+t[3]),e[1]=Math.max(e[1],t[1]+t[3]),e[2]=Math.max(e[2],t[2]+t[3])}function KN(e,t,r){r[0]=e[0]+t,r[1]=e[1]+t,r[2]=e[2]+t}function lfe(e,t,r,i){if(t===1){const s=r(e[0]);dA(s,i)}else{Gu[0]=1/0,Gu[1]=1/0,Gu[2]=1/0,ju[0]=-1/0,ju[1]=-1/0,ju[2]=-1/0;for(let s=0;s<t;s++){const n=r(e[s]);p3(n[3])&&(zmt(Gu,n),Bmt(ju,n))}En(i,Gu,ju,.5),i[3]=Math.max(ju[0]-Gu[0],ju[1]-Gu[1],ju[2]-Gu[2])/2}}function Gmt(e,t,r){if(!Pw.length)for(let i=0;i<8;++i)Pw.push({index:0,distance:0});for(let i=0;i<8;++i){const s=yPe[i];Pw.data[i].index=i,Pw.data[i].distance=y_(e,t,s)}Pw.sort((i,s)=>i.distance-s.distance);for(let i=0;i<8;++i)r[i]=Pw.data[i].index}function q7(e,t){let r=1/0,i=null;for(let s=0;s<8;++s){const n=y_(e,t,cfe[s]);n<r&&(r=n,i=cfe[s])}return i}function y_(e,t,r){return t*(e[0]*r[0]+e[1]*r[1]+e[2]*r[2])}function p3(e){return!isNaN(e)&&e!==-1/0&&e!==1/0&&e>0}as._pool=new Ls(as),function(e){var t;(t=e.DepthOrder||(e.DepthOrder={}))[t.FRONT_TO_BACK=1]="FRONT_TO_BACK",t[t.BACK_TO_FRONT=-1]="BACK_TO_FRONT"}(jA||(jA={}));const yPe=[Ue(-1,-1,-1),Ue(1,-1,-1),Ue(-1,1,-1),Ue(1,1,-1),Ue(-1,-1,1),Ue(1,-1,1),Ue(-1,1,1),Ue(1,1,1)],cfe=[Ue(-1,-1,-1),Ue(-1,-1,1),Ue(-1,1,-1),Ue(-1,1,1),Ue(1,-1,-1),Ue(1,-1,1),Ue(1,1,-1),Ue(1,1,1)],vPe=Math.sqrt(3),$Q=[null];function jmt(e){return $Q[0]=e,$Q}const W7=kn(),Lh=M(),Gu=M(),ju=M(),Tb=new Xt,Hmt=kn(),Nf=kn(),X7=kn(),Z7=kn(),eF=[{min:0,max:0},{min:0,max:0},{min:0,max:0}],Pw=new Xt,ufe=[0,0,0,0,0,0,0,0],lf=jA;class _Pe extends vL{constructor(t,r=""){var i,s,n;super(),this.apiLayerUid=r,this.type=Cf.Layer,this.events=new ds,this.isSliceable=!1,this._objects=new Xt,this._stageHandles=new Dt,this.apiLayerUid=r,this.isVisible=(i=t==null?void 0:t.isVisible)!=null?i:!0,this.isPickable=(s=t==null?void 0:t.isPickable)!=null?s:!0,this.updatePolicy=(n=t==null?void 0:t.updatePolicy)!=null?n:EA.ASYNC}get objects(){return this._objects}destroy(){this.detachStage(),this._stage=null}attachStage(t){this.detachStage(),this._stage=t;for(const r of Vmt)this._stageHandles.add(this.events.on(r,i=>t.handleEvent(r,i)))}detachStage(){this._stageHandles.removeAll(),this.invalidateSpatialQueryAccelerator()}add(t){this._objects.push(t),t.parentLayer=this,this.events.emit("layerObjectAdded",{layer:this,object:t}),b(this._octree)&&this._octree.add([t])}remove(t){this._objects.removeUnordered(t)&&(t.parentLayer=null,this.events.emit("layerObjectRemoved",{layer:this,object:t}),b(this._octree)&&this._octree.remove([t]))}addMany(t){this._objects.pushArray(t);for(const r of t)r.parentLayer=this;this.events.emit("layerObjectsAdded",{layer:this,objects:t}),b(this._octree)&&this._octree.add(t)}removeMany(t){const r=new Array;if(this._objects.removeUnorderedMany(t,t.length,r),r.length!==0){for(const i of r)i.parentLayer=null;this.events.emit("layerObjectsRemoved",{layer:this,objects:r}),b(this._octree)&&this._octree.remove(r)}}sync(){b(this._stage)&&this.updatePolicy!==EA.SYNC&&this._stage.syncLayer(this.id)}notifyObjectBBChanged(t,r){b(this._octree)&&this._octree.update(t,r)}getSpatialQueryAccelerator(){return R(this._octree)&&this._objects.length>50&&this._createOctree(),this._octree}shaderTransformationChanged(){this.invalidateSpatialQueryAccelerator(),this.events.emit("shaderTransformationChanged",this)}invalidateSpatialQueryAccelerator(){this._octree=ct(this._octree)}_createOctree(){this._octree=new lf(t=>t.boundingVolumeWorldSpace.bounds),this._octree.add(this._objects.data,this._objects.length)}}function JV(e){return b(e)&&e.type===Cf.Layer}class bPe{constructor(t,r){this._material=t,this._repository=r,this._map=new Map}destroy(){this._map.forEach((t,r)=>{b(t)&&this._repository.release(this._material,IT(r))})}load(t,r){this._map.has(r)||this._map.set(r,this._repository.acquire(this._material,IT(r)));const i=this._map.get(r);if(b(i)){if(i.ensureResources(t)===Nc.LOADED)return i;this._repository.requestRender()}return null}}function IT(e){switch(e){case je.MATERIAL:return K.Color;case je.MATERIAL_ALPHA:return K.Alpha;case je.MATERIAL_DEPTH:return K.Depth;case je.MATERIAL_NORMAL:return K.Normal;case je.MATERIAL_DEPTH_SHADOWMAP_ALL:return K.Shadow;case je.MATERIAL_HIGHLIGHT:return K.Highlight;case je.MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT:case je.MATERIAL_DEPTH_SHADOWMAP_DEFAULT:return K.Shadow}}const hfe=8;function wPe(e,t){const r=e.vertex;r.uniforms.add(new qe("intrinsicWidth",i=>i.width)),t.vvSize?(e.attributes.add(O.SIZEFEATUREATTRIBUTE,"float"),r.uniforms.add(new St("vvSizeMinSize",i=>i.vvSizeMinSize)),r.uniforms.add(new St("vvSizeMaxSize",i=>i.vvSizeMaxSize)),r.uniforms.add(new St("vvSizeOffset",i=>i.vvSizeOffset)),r.uniforms.add(new St("vvSizeFactor",i=>i.vvSizeFactor)),r.code.add(S`float getSize() {
return intrinsicWidth * clamp(vvSizeOffset + sizeFeatureAttribute * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).x;
}`)):(e.attributes.add(O.SIZE,"float"),r.code.add(S`float getSize(){
return intrinsicWidth * size;
}`)),t.vvOpacity?(e.attributes.add(O.OPACITYFEATUREATTRIBUTE,"float"),r.constants.add("vvOpacityNumber","int",8),r.uniforms.add([new Ea("vvOpacityValues",i=>i.vvOpacityValues,hfe),new Ea("vvOpacityOpacities",i=>i.vvOpacityOpacities,hfe)]),r.code.add(S`float interpolateOpacity( float value ){
if (value <= vvOpacityValues[0]) {
return vvOpacityOpacities[0];
}
for (int i = 1; i < vvOpacityNumber; ++i) {
if (vvOpacityValues[i] >= value) {
float f = (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);
return mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f);
}
}
return vvOpacityOpacities[vvOpacityNumber - 1];
}
vec4 applyOpacity( vec4 color ){
return vec4(color.xyz, interpolateOpacity(opacityFeatureAttribute));
}`)):r.code.add(S`vec4 applyOpacity( vec4 color ){
return color;
}`),t.vvColor?(e.attributes.add(O.COLORFEATUREATTRIBUTE,"float"),r.constants.add("vvColorNumber","int",mf),r.uniforms.add(new Ea("vvColorValues",i=>i.vvColorValues,mf)),r.uniforms.add(new LB("vvColorColors",i=>i.vvColorColors,mf)),r.code.add(S`vec4 interpolateColor( float value ) {
if (value <= vvColorValues[0]) {
return vvColorColors[0];
}
for (int i = 1; i < vvColorNumber; ++i) {
if (vvColorValues[i] >= value) {
float f = (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);
return mix(vvColorColors[i-1], vvColorColors[i], f);
}
}
return vvColorColors[vvColorNumber - 1];
}
vec4 getColor(){
return applyOpacity(interpolateColor(colorFeatureAttribute));
}`)):(e.attributes.add(O.COLOR,"vec4"),r.code.add(S`vec4 getColor(){
return applyOpacity(color);
}`))}function tb(e,t){e.fragment.include(hu),t.output===K.Shadow?(e.extensions.add("GL_OES_standard_derivatives"),e.fragment.code.add(S`float _calculateFragDepth(const in float depth) {
const float SLOPE_SCALE = 2.0;
const float BIAS = 2.0 * .000015259;
float m = max(abs(dFdx(depth)), abs(dFdy(depth)));
float result = depth + SLOPE_SCALE * m + BIAS;
return clamp(result, .0, .999999);
}
void outputDepth(float _linearDepth) {
gl_FragColor = float2rgba(_calculateFragDepth(_linearDepth));
}`)):t.output===K.Depth&&e.fragment.code.add(S`void outputDepth(float _linearDepth) {
gl_FragColor = float2rgba(_linearDepth);
}`)}function qmt(e){return R(e)?jm:e.length===4?e:Kr(Wmt,e[0],e[1],e[2],1)}const Wmt=Zt();function xPe(e,t){e.constants.add("stippleAlphaColorDiscard","float",.001),e.constants.add("stippleAlphaHighlightDiscard","float",.5),t.stippleEnabled?Xmt(e,t):Zmt(e)}function Xmt(e,t){const r=!(t.draped&&t.stipplePreferContinuous),{vertex:i,fragment:s}=e;s.include(hu),i.uniforms.add(new kr("stipplePatternPixelSize")),t.draped||(ag(i,t),i.uniforms.add(new qe("worldToScreenPerDistanceRatio",(n,o)=>1/o.camera.perScreenPixelRatio)),i.code.add(S`float computeWorldToScreenRatio(vec3 segmentCenter) {
float segmentDistanceToCamera = length(segmentCenter - cameraPosition);
return worldToScreenPerDistanceRatio / segmentDistanceToCamera;
}`)),e.varyings.add("vStippleDistance","float"),t.stippleRequiresClamp&&e.varyings.add("vStippleDistanceLimits","vec2"),t.stippleRequiresStretchMeasure&&e.varyings.add("vStipplePatternStretch","float"),i.code.add(S`
    float discretizeWorldToScreenRatio(float worldToScreenRatio) {
      float step = ${Ymt};

      float discreteWorldToScreenRatio = log(worldToScreenRatio);
      discreteWorldToScreenRatio = ceil(discreteWorldToScreenRatio / step) * step;
      discreteWorldToScreenRatio = exp(discreteWorldToScreenRatio);
      return discreteWorldToScreenRatio;
    }
  `),i.code.add(S`vec2 computeStippleDistanceLimits(float startPseudoScreen, float segmentLengthPseudoScreen, float segmentLengthScreen, float patternLength) {`),i.code.add(S`
    if (segmentLengthPseudoScreen >= ${r?"patternLength":"1e4"}) {
  `),i.uniforms.add(new qe("pixelRatio",(n,o)=>o.camera.pixelRatio)),i.code.add(S`
        // Round the screen length to get an integer number of pattern repetitions (minimum 1).
        float repetitions = segmentLengthScreen / (patternLength * pixelRatio);
        float flooredRepetitions = max(1.0, floor(repetitions + 0.5));
        float segmentLengthScreenRounded = flooredRepetitions * patternLength;

        ${t.stippleRequiresStretchMeasure?S`
              float stretch = repetitions / flooredRepetitions;

              // We need to impose a lower bound on the stretch factor to prevent the dots from merging together when there is only 1 repetition.
              // 0.75 is the lowest possible stretch value for flooredRepetitions > 1, so it makes sense as lower bound.
              vStipplePatternStretch = max(0.75, stretch);`:""}

        return vec2(0.0, segmentLengthScreenRounded);
      }
      return vec2(startPseudoScreen, startPseudoScreen + segmentLengthPseudoScreen);
    }
  `),s.uniforms.add(new Hi("stipplePatternTexture")),s.uniforms.add(new kr("stipplePatternSDFNormalizer")),s.uniforms.add(new kr("stipplePatternTextureSize")),s.uniforms.add(new kr("stipplePatternPixelSizeInv")),s.code.add(S`float padTexture(float u) {
return (u * stipplePatternTextureSize + 1.0)/(stipplePatternTextureSize + 2.0);
}`),s.code.add(S`
    float getStippleSDF(out bool isClamped) {
      ${t.stippleRequiresClamp?S`
          float stippleDistanceClamped = clamp(vStippleDistance, vStippleDistanceLimits.x, vStippleDistanceLimits.y);
          vec2 aaCorrectedLimits = vStippleDistanceLimits + vec2(1.0, -1.0) / gl_FragCoord.w;
          isClamped = vStippleDistance < aaCorrectedLimits.x || vStippleDistance > aaCorrectedLimits.y;`:S`
          float stippleDistanceClamped = vStippleDistance;
          isClamped = false;`}

      float u = stippleDistanceClamped * gl_FragCoord.w * stipplePatternPixelSizeInv;
      ${t.stippleScaleWithLineWidth?S`u *= vLineSizeInv;`:""}
      u = padTexture(fract(u));

      float encodedSDF = rgba2float(texture2D(stipplePatternTexture, vec2(u, 0.5)));
      float sdf = (encodedSDF * 2.0 - 1.0) * stipplePatternSDFNormalizer;

      ${t.stippleRequiresStretchMeasure?S`return (sdf - 0.5) * vStipplePatternStretch + 0.5;`:S`return sdf;`}
    }

    float getStippleSDF() {
      bool ignored;
      return getStippleSDF(ignored);
    }

    float getStippleAlpha() {
      bool isClamped;
      float stippleSDF = getStippleSDF(isClamped);

      float antiAliasedResult = ${t.stippleScaleWithLineWidth?S`clamp(stippleSDF * vLineWidth + 0.5, 0.0, 1.0);`:S`clamp(stippleSDF + 0.5, 0.0, 1.0);`}

      return isClamped ? floor(antiAliasedResult + 0.5) : antiAliasedResult;
    }
  `),t.stippleOffColorEnabled?(s.uniforms.add(new lr("stippleOffColor",n=>qmt(n.stippleOffColor))),s.code.add(S`#define discardByStippleAlpha(stippleAlpha, threshold) {}
#define blendStipple(color, stippleAlpha) mix(color, stippleOffColor, stippleAlpha)`)):s.code.add(S`#define discardByStippleAlpha(stippleAlpha, threshold) if (stippleAlpha < threshold) { discard; }
#define blendStipple(color, stippleAlpha) vec4(color.rgb, color.a * stippleAlpha)`)}function Zmt(e){e.fragment.code.add(S`float getStippleAlpha() { return 1.0; }
#define discardByStippleAlpha(_stippleAlpha_, _threshold_) {}
#define blendStipple(color, _stippleAlpha_) color`)}const Ymt=S.float(.4);var Ld;(function(e){e[e.BUTT=0]="BUTT",e[e.SQUARE=1]="SQUARE",e[e.ROUND=2]="ROUND",e[e.COUNT=3]="COUNT"})(Ld||(Ld={}));class Ji extends Ca{constructor(){super(...arguments),this.output=K.Color,this.capType=Ld.BUTT,this.transparencyPassType=yt.NONE,this.occluder=!1,this.hasSlicePlane=!1,this.hasPolygonOffset=!1,this.writeDepth=!1,this.draped=!1,this.stippleEnabled=!1,this.stippleOffColorEnabled=!1,this.stippleScaleWithLineWidth=!1,this.stipplePreferContinuous=!0,this.roundJoins=!1,this.vvSize=!1,this.vvColor=!1,this.vvOpacity=!1,this.falloffEnabled=!1,this.innerColorEnabled=!1,this.hasOccludees=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1,this.wireframe=!1}}u([q({count:K.COUNT})],Ji.prototype,"output",void 0),u([q({count:Ld.COUNT})],Ji.prototype,"capType",void 0),u([q({count:yt.COUNT})],Ji.prototype,"transparencyPassType",void 0),u([q()],Ji.prototype,"occluder",void 0),u([q()],Ji.prototype,"hasSlicePlane",void 0),u([q()],Ji.prototype,"hasPolygonOffset",void 0),u([q()],Ji.prototype,"writeDepth",void 0),u([q()],Ji.prototype,"draped",void 0),u([q()],Ji.prototype,"stippleEnabled",void 0),u([q()],Ji.prototype,"stippleOffColorEnabled",void 0),u([q()],Ji.prototype,"stippleScaleWithLineWidth",void 0),u([q()],Ji.prototype,"stipplePreferContinuous",void 0),u([q()],Ji.prototype,"roundJoins",void 0),u([q()],Ji.prototype,"vvSize",void 0),u([q()],Ji.prototype,"vvColor",void 0),u([q()],Ji.prototype,"vvOpacity",void 0),u([q()],Ji.prototype,"falloffEnabled",void 0),u([q()],Ji.prototype,"innerColorEnabled",void 0),u([q()],Ji.prototype,"hasOccludees",void 0),u([q()],Ji.prototype,"hasMultipassTerrain",void 0),u([q()],Ji.prototype,"cullAboveGround",void 0),u([q()],Ji.prototype,"wireframe",void 0),u([q({constValue:!0})],Ji.prototype,"stippleRequiresClamp",void 0),u([q({constValue:!0})],Ji.prototype,"stippleRequiresStretchMeasure",void 0),u([q({constValue:!0})],Ji.prototype,"hasVvInstancing",void 0),u([q({constValue:!0})],Ji.prototype,"hasSliceTranslatedView",void 0);const KV=1;function Qmt(e){const t=new Yr,r=e.hasMultipassTerrain&&(e.output===K.Color||e.output===K.Alpha);t.include(pB),t.include(wPe,e),t.include(xPe,e),e.output===K.Depth&&t.include(tb,e),ph(t,e);const{vertex:i,fragment:s}=t;i.uniforms.add([new Ei("inverseProjectionMatrix",(f,m)=>m.camera.inverseProjectionMatrix),new _r("nearFar",(f,m)=>m.camera.nearFar),new qe("miterLimit",f=>f.join!=="miter"?0:f.miterLimit),new lr("viewport",(f,m)=>m.camera.fullViewport)]),i.constants.add("LARGE_HALF_FLOAT","float",65500),t.attributes.add(O.POSITION,"vec3"),t.attributes.add(O.SUBDIVISIONFACTOR,"float"),t.attributes.add(O.UV0,"vec2"),t.attributes.add(O.AUXPOS1,"vec3"),t.attributes.add(O.AUXPOS2,"vec3"),t.varyings.add("vColor","vec4"),t.varyings.add("vpos","vec3"),t.varyings.add("linearDepth","float"),r&&t.varyings.add("depth","float");const n=e.capType===Ld.ROUND,o=e.stippleEnabled&&e.stippleScaleWithLineWidth||n;o&&t.varyings.add("vLineWidth","float");const a=e.stippleEnabled&&e.stippleScaleWithLineWidth;a&&t.varyings.add("vLineSizeInv","float");const l=e.innerColorEnabled||n;l&&t.varyings.add("vLineDistance","float");const c=e.stippleEnabled&&n,h=e.falloffEnabled||c;h&&t.varyings.add("vLineDistanceNorm","float"),n&&(t.varyings.add("vSegmentSDF","float"),t.varyings.add("vReverseSegmentSDF","float")),i.code.add(S`#define PERPENDICULAR(v) vec2(v.y, -v.x);
float interp(float ncp, vec4 a, vec4 b) {
return (-ncp - a.z) / (b.z - a.z);
}
vec2 rotate(vec2 v, float a) {
float s = sin(a);
float c = cos(a);
mat2 m = mat2(c, -s, s, c);
return m * v;
}`),i.code.add(S`vec4 projectAndScale(vec4 pos) {
vec4 posNdc = proj * pos;
posNdc.xy *= viewport.zw / posNdc.w;
return posNdc;
}`),i.code.add(S`
    void clipAndTransform(inout vec4 pos, inout vec4 prev, inout vec4 next, in bool isStartVertex) {
      float vnp = nearFar[0] * 0.99;

      if(pos.z > -nearFar[0]) {
        //current pos behind ncp --> we need to clip
        if (!isStartVertex) {
          if(prev.z < -nearFar[0]) {
            //previous in front of ncp
            pos = mix(prev, pos, interp(vnp, prev, pos));
            next = pos;
          } else {
            pos = vec4(0.0, 0.0, 0.0, 1.0);
          }
        } else {
          if(next.z < -nearFar[0]) {
            //next in front of ncp
            pos = mix(pos, next, interp(vnp, pos, next));
            prev = pos;
          } else {
            pos = vec4(0.0, 0.0, 0.0, 1.0);
          }
        }
      } else {
        //current position visible
        if (prev.z > -nearFar[0]) {
          //previous behind ncp
          prev = mix(pos, prev, interp(vnp, pos, prev));
        }
        if (next.z > -nearFar[0]) {
          //next behind ncp
          next = mix(next, pos, interp(vnp, next, pos));
        }
      }

      ${r?"depth = pos.z;":""}
      linearDepth = (-pos.z - nearFar[0]) / (nearFar[1] - nearFar[0]);

      pos = projectAndScale(pos);
      next = projectAndScale(next);
      prev = projectAndScale(prev);
    }
  `),i.uniforms.add(new qe("pixelRatio",(f,m)=>m.camera.pixelRatio)),i.code.add(S`
  void main(void) {
    // unpack values from uv0.y
    bool isStartVertex = abs(abs(uv0.y)-3.0) == 1.0;

    float coverage = 1.0;

    // Check for special value of uv0.y which is used by the Renderer when graphics
    // are removed before the VBO is recompacted. If this is the case, then we just
    // project outside of clip space.
    if (uv0.y == 0.0) {
      // Project out of clip space
      gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
    }
    else {
      bool isJoin = abs(uv0.y) < 3.0;

      float lineSize = getSize();
      float lineWidth = lineSize * pixelRatio;

      ${o?S`vLineWidth = lineWidth;`:""}
      ${a?S`vLineSizeInv = 1.0 / lineSize;`:""}

      // convert sub-pixel coverage to alpha
      if (lineWidth < 1.0) {
        coverage = lineWidth;
        lineWidth = 1.0;
      }else{
        // Ribbon lines cannot properly render non-integer sizes. Round width to integer size if
        // larger than one for better quality. Note that we do render < 1 pixels more or less correctly
        // so we only really care to round anything larger than 1.
        lineWidth = floor(lineWidth + 0.5);
      }

      vec4 pos  = view * vec4(position.xyz, 1.0);
      vec4 prev = view * vec4(auxpos1.xyz, 1.0);
      vec4 next = view * vec4(auxpos2.xyz, 1.0);

      clipAndTransform(pos, prev, next, isStartVertex);

      vec2 left = (pos.xy - prev.xy);
      vec2 right = (next.xy - pos.xy);

      float leftLen = length(left);
      float rightLen = length(right);
  `),(e.stippleEnabled||n)&&i.code.add(S`
      float isEndVertex = float(!isStartVertex);
      vec2 segmentOrigin = mix(pos.xy, prev.xy, isEndVertex);
      vec2 segment = mix(right, left, isEndVertex);
      ${n?S`vec2 segmentEnd = mix(next.xy, pos.xy, isEndVertex);`:""}
    `),i.code.add(S`left = (leftLen > 0.001) ? left/leftLen : vec2(0.0, 0.0);
right = (rightLen > 0.001) ? right/rightLen : vec2(0.0, 0.0);
vec2 capDisplacementDir = vec2(0, 0);
vec2 joinDisplacementDir = vec2(0, 0);
float displacementLen = lineWidth;
if (isJoin) {
bool isOutside = (left.x * right.y - left.y * right.x) * uv0.y > 0.0;
joinDisplacementDir = normalize(left + right);
joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);
if (leftLen > 0.001 && rightLen > 0.001) {
float nDotSeg = dot(joinDisplacementDir, left);
displacementLen /= length(nDotSeg * left - joinDisplacementDir);
if (!isOutside) {
displacementLen = min(displacementLen, min(leftLen, rightLen)/abs(nDotSeg));
}
}
if (isOutside && (displacementLen > miterLimit * lineWidth)) {`),e.roundJoins?i.code.add(S`
        vec2 startDir = leftLen < 0.001 ? right : left;
        startDir = PERPENDICULAR(startDir);

        vec2 endDir = rightLen < 0.001 ? left : right;
        endDir = PERPENDICULAR(endDir);

        float factor = ${e.stippleEnabled?S`min(1.0, subdivisionFactor * ${S.float((KV+2)/(KV+1))})`:S`subdivisionFactor`};

        float rotationAngle = acos(clamp(dot(startDir, endDir), -1.0, 1.0));
        joinDisplacementDir = rotate(startDir, -sign(uv0.y) * factor * rotationAngle);
      `):i.code.add(S`if (leftLen < 0.001) {
joinDisplacementDir = right;
}
else if (rightLen < 0.001) {
joinDisplacementDir = left;
}
else {
joinDisplacementDir = (isStartVertex || subdivisionFactor > 0.0) ? right : left;
}
joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);`);const p=e.capType!==Ld.BUTT;return i.code.add(S`
        displacementLen = lineWidth;
      }
    } else {
      // CAP handling ---------------------------------------------------
      joinDisplacementDir = isStartVertex ? right : left;
      joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);

      ${p?S`capDisplacementDir = isStartVertex ? -right : left;`:""}
    }
  `),i.code.add(S`
    // Displacement (in pixels) caused by join/or cap
    vec2 dpos = joinDisplacementDir * sign(uv0.y) * displacementLen + capDisplacementDir * displacementLen;

    ${h||l?S`float lineDistNorm = sign(uv0.y) * pos.w;`:""}

    ${l?S`vLineDistance = lineWidth * lineDistNorm;`:""}
    ${h?S`vLineDistanceNorm = lineDistNorm;`:""}

    pos.xy += dpos;
  `),n&&i.code.add(S`vec2 segmentDir = normalize(segment);
vSegmentSDF = (isJoin && isStartVertex) ? LARGE_HALF_FLOAT : (dot(pos.xy - segmentOrigin, segmentDir) * pos.w) ;
vReverseSegmentSDF = (isJoin && !isStartVertex) ? LARGE_HALF_FLOAT : (dot(pos.xy - segmentEnd, -segmentDir) * pos.w);`),e.stippleEnabled&&(e.draped?i.uniforms.add(new qe("worldToScreenRatio",(f,m)=>1/m.screenToPCSRatio)):i.code.add(S`vec3 segmentCenter = mix((auxpos2 + position) * 0.5, (position + auxpos1) * 0.5, isEndVertex);
float worldToScreenRatio = computeWorldToScreenRatio(segmentCenter);`),i.code.add(S`float segmentLengthScreenDouble = length(segment);
float segmentLengthScreen = segmentLengthScreenDouble * 0.5;
float discreteWorldToScreenRatio = discretizeWorldToScreenRatio(worldToScreenRatio);
float segmentLengthRender = length(mix(auxpos2 - position, position - auxpos1, isEndVertex));
vStipplePatternStretch = worldToScreenRatio / discreteWorldToScreenRatio;`),e.draped?i.code.add(S`float segmentLengthPseudoScreen = segmentLengthScreen / pixelRatio * discreteWorldToScreenRatio / worldToScreenRatio;
float startPseudoScreen = uv0.x * discreteWorldToScreenRatio - mix(0.0, segmentLengthPseudoScreen, isEndVertex);`):i.code.add(S`float startPseudoScreen = mix(uv0.x, uv0.x - segmentLengthRender, isEndVertex) * discreteWorldToScreenRatio;
float segmentLengthPseudoScreen = segmentLengthRender * discreteWorldToScreenRatio;`),i.code.add(S`
      float patternLength = ${e.stippleScaleWithLineWidth?"lineSize * ":""} stipplePatternPixelSize;

      // Compute the coordinates at both start and end of the line segment, because we need both to clamp to in the fragment shader
      vStippleDistanceLimits = computeStippleDistanceLimits(startPseudoScreen, segmentLengthPseudoScreen, segmentLengthScreen, patternLength);

      vStippleDistance = mix(vStippleDistanceLimits.x, vStippleDistanceLimits.y, isEndVertex);

      // Adjust the coordinate to the displaced position (the pattern is shortened/overextended on the in/outside of joins)
      if (segmentLengthScreenDouble >= 0.001) {
        // Project the actual vertex position onto the line segment. Note that the resulting factor is within [0..1] at the
        // original vertex positions, and slightly outside of that range at the displaced positions
        vec2 stippleDisplacement = pos.xy - segmentOrigin;
        float stippleDisplacementFactor = dot(segment, stippleDisplacement) / (segmentLengthScreenDouble * segmentLengthScreenDouble);

        // Apply this offset to the actual vertex coordinate (can be screen or pseudo-screen space)
        vStippleDistance += (stippleDisplacementFactor - isEndVertex) * (vStippleDistanceLimits.y - vStippleDistanceLimits.x);
      }

      // Cancel out perspective correct interpolation because we want this length the really represent the screen distance
      vStippleDistanceLimits *= pos.w;
      vStippleDistance *= pos.w;

      // Disable stipple distance limits on caps
      vStippleDistanceLimits = isJoin ?
                                 vStippleDistanceLimits :
                                 isStartVertex ?
                                  vec2(-1e038, vStippleDistanceLimits.y) :
                                  vec2(vStippleDistanceLimits.x, 1e038);
    `)),i.code.add(S`
      // Convert back into NDC
      pos.xy = (pos.xy / viewport.zw) * pos.w;

      vColor = getColor();
      vColor.a *= coverage;

      ${e.wireframe&&!e.draped?"pos.z -= 0.001 * pos.w;":""}

      // transform final position to camera space for slicing
      vpos = (inverseProjectionMatrix * pos).xyz;
      gl_Position = pos;
    }
  }
  `),r&&t.include(Th,e),t.include(Ss,e),s.include(wg),s.code.add(S`
  void main() {
    discardBySlice(vpos);
    ${r?"terrainDepthTest(gl_FragCoord, depth);":""}
  `),e.wireframe?s.code.add(S`vec4 finalColor = vec4(1.0, 0.0, 1.0, 1.0);`):(n&&s.code.add(S`
      float sdf = min(vSegmentSDF, vReverseSegmentSDF);
      vec2 fragmentPosition = vec2(
        min(sdf, 0.0),
        vLineDistance
      ) * gl_FragCoord.w;

      float fragmentRadius = length(fragmentPosition);
      float fragmentCapSDF = (fragmentRadius - vLineWidth) * 0.5; // Divide by 2 to transform from double pixel scale
      float capCoverage = clamp(0.5 - fragmentCapSDF, 0.0, 1.0);

      if (capCoverage < ${S.float(sa)}) {
        discard;
      }
    `),c?s.code.add(S`
      vec2 stipplePosition = vec2(
        min(getStippleSDF() * 2.0 - 1.0, 0.0),
        vLineDistanceNorm * gl_FragCoord.w
      );
      float stippleRadius = length(stipplePosition * vLineWidth);
      float stippleCapSDF = (stippleRadius - vLineWidth) * 0.5; // Divide by 2 to transform from double pixel scale
      float stippleCoverage = clamp(0.5 - stippleCapSDF, 0.0, 1.0);
      float stippleAlpha = step(${S.float(sa)}, stippleCoverage);
      `):s.code.add(S`float stippleAlpha = getStippleAlpha();`),s.uniforms.add(new lr("intrinsicColor",f=>f.color)),s.code.add(S`discardByStippleAlpha(stippleAlpha, stippleAlphaColorDiscard);
vec4 color = intrinsicColor * vColor;`),e.innerColorEnabled&&(s.uniforms.add(new lr("innerColor",f=>_t(f.innerColor,f.color))),s.uniforms.add(new qe("innerWidth",(f,m)=>f.innerWidth*m.camera.pixelRatio)),s.code.add(S`float distToInner = abs(vLineDistance * gl_FragCoord.w) - innerWidth;
float innerAA = clamp(0.5 - distToInner, 0.0, 1.0);
float innerAlpha = innerColor.a + color.a * (1.0 - innerColor.a);
color = mix(color, vec4(innerColor.rgb, innerAlpha), innerAA);`)),s.code.add(S`vec4 finalColor = blendStipple(color, stippleAlpha);`),e.falloffEnabled&&(s.uniforms.add(new qe("falloff",f=>f.falloff)),s.code.add(S`finalColor.a *= pow(max(0.0, 1.0 - abs(vLineDistanceNorm * gl_FragCoord.w)), falloff);`))),s.code.add(S`
    if (finalColor.a < ${S.float(sa)}) {
      discard;
    }

    ${e.output===K.Alpha?S`gl_FragColor = vec4(finalColor.a);`:""}
    ${e.output===K.Color?S`gl_FragColor = highlightSlice(finalColor, vpos);`:""}
    ${e.output===K.Color&&e.transparencyPassType===yt.Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}
    ${e.output===K.Highlight?S`gl_FragColor = vec4(1.0);`:""}
    ${e.output===K.Depth?S`outputDepth(linearDepth);`:""}
  }
  `),t}const Jmt=Object.freeze(Object.defineProperty({__proto__:null,NUM_ROUND_JOIN_SUBDIVISIONS:KV,build:Qmt},Symbol.toStringTag,{value:"Module"})),Sse={func:_i.LESS},ez={func:_i.ALWAYS},cg={mask:255},TPe={mask:0},Kmt=e=>({function:{func:_i.NOTEQUAL,ref:e,mask:e},operation:{fail:hs.KEEP,zFail:hs.KEEP,zPass:hs.KEEP}}),egt=e=>({function:{func:_i.ALWAYS,ref:e,mask:e},operation:{fail:hs.KEEP,zFail:hs.KEEP,zPass:hs.REPLACE}}),rb={function:{func:_i.ALWAYS,ref:tc.OutlineVisualElementMask,mask:tc.OutlineVisualElementMask},operation:{fail:hs.KEEP,zFail:hs.KEEP,zPass:hs.ZERO}},j1={function:{func:_i.ALWAYS,ref:tc.OutlineVisualElementMask,mask:tc.OutlineVisualElementMask},operation:{fail:hs.KEEP,zFail:hs.KEEP,zPass:hs.REPLACE}},SPe={function:{func:_i.EQUAL,ref:tc.OutlineVisualElementMask,mask:tc.OutlineVisualElementMask},operation:{fail:hs.KEEP,zFail:hs.KEEP,zPass:hs.KEEP}},EPe={function:{func:_i.NOTEQUAL,ref:tc.OutlineVisualElementMask,mask:tc.OutlineVisualElementMask},operation:{fail:hs.KEEP,zFail:hs.KEEP,zPass:hs.KEEP}},CPe=new Map([[O.POSITION,0],[O.SUBDIVISIONFACTOR,1],[O.UV0,2],[O.AUXPOS1,3],[O.AUXPOS2,4],[O.COLOR,5],[O.COLORFEATUREATTRIBUTE,5],[O.SIZE,6],[O.SIZEFEATUREATTRIBUTE,6],[O.OPACITYFEATUREATTRIBUTE,7]]);class qB extends gi{constructor(t,r,i){super(t,r,i),this.stippleTextureRepository=t.stippleTextureRepository}initializeProgram(t){const r=qB.shader.get().build(this.configuration);return new oi(t.rctx,r,CPe)}destroy(){super.destroy(),this.stippleTextureRepository.release(this.stipplePattern),this.stipplePattern=null,this.stippleTextureBind=null}bindPass(t,r){if(this.program.bindPass(t,r),this.stipplePattern!==t.stipplePattern){const i=t.stipplePattern;this.stippleTextureBind=this.stippleTextureRepository.swap(this.stipplePattern,i),this.stipplePattern=i}if(this.configuration.stippleEnabled){const{pixelSize:i,sdfNormalizer:s,pixels:n}=b(this.stippleTextureBind)?this.stippleTextureBind(this.program):{pixelSize:1,sdfNormalizer:1,pixels:1};this.program.setUniform1f("stipplePatternSDFNormalizer",s),this.program.setUniform1f("stipplePatternTextureSize",n),this.program.setUniform1f("stipplePatternPixelSize",i),this.program.setUniform1f("stipplePatternPixelSizeInv",1/i)}}_makePipelineState(t,r){const i=this.configuration,s=t===yt.NONE,n=t===yt.FrontFace;return Gt({blending:i.output===K.Color||i.output===K.Alpha?s?fh:N0(t):null,depthTest:{func:eb(t)},depthWrite:s?i.writeDepth&&cc:DB(t),colorWrite:or,stencilWrite:i.hasOccludees?cg:null,stencilTest:i.hasOccludees?r?j1:rb:null,polygonOffset:s||n?i.hasPolygonOffset&&dfe:FB})}initializePipeline(){const t=this.configuration;if(t.occluder){const r=t.hasPolygonOffset&&dfe;this._occluderPipelineTransparent=Gt({blending:fh,polygonOffset:r,depthTest:ez,depthWrite:null,colorWrite:or,stencilWrite:null,stencilTest:EPe}),this._occluderPipelineOpaque=Gt({blending:fh,polygonOffset:r,depthTest:ez,depthWrite:null,colorWrite:or,stencilWrite:TPe,stencilTest:SPe}),this._occluderPipelineMaskWrite=Gt({blending:null,polygonOffset:r,depthTest:Sse,depthWrite:null,colorWrite:null,stencilWrite:cg,stencilTest:j1})}return this._occludeePipelineState=this._makePipelineState(this.configuration.transparencyPassType,!0),this._makePipelineState(this.configuration.transparencyPassType,!1)}get primitiveType(){return this.configuration.wireframe?Lt.LINES:Lt.TRIANGLE_STRIP}getPipelineState(t,r){return r?this._occludeePipelineState:this.configuration.occluder?t===Se.TRANSPARENT_OCCLUDER_MATERIAL?this._occluderPipelineTransparent:t===Se.OCCLUDER_MATERIAL?this._occluderPipelineOpaque:this._occluderPipelineMaskWrite:super.getPipelineState(t,r)}}qB.shader=new ni(Jmt,()=>ie(()=>import("./RibbonLine.glsl.b8cfcc90.js"),[],import.meta.url));const dfe={factor:0,units:-4},tgt=fe.getLogger("esri.views.3d.webgl-engine.materials.RibbonLineMaterial");var Oc;(function(e){e[e.LEFT_JOIN_START=-2]="LEFT_JOIN_START",e[e.LEFT_JOIN_END=-1]="LEFT_JOIN_END",e[e.LEFT_CAP_START=-4]="LEFT_CAP_START",e[e.LEFT_CAP_END=-5]="LEFT_CAP_END",e[e.RIGHT_JOIN_START=2]="RIGHT_JOIN_START",e[e.RIGHT_JOIN_END=1]="RIGHT_JOIN_END",e[e.RIGHT_CAP_START=4]="RIGHT_CAP_START",e[e.RIGHT_CAP_END=5]="RIGHT_CAP_END"})(Oc||(Oc={}));class jE extends Tg{constructor(t){super(t,new igt),this._vertexAttributeLocations=CPe,this.techniqueConfig=new Ji,this.layout=this.createLayout()}isClosed(t,r){return APe(this.parameters,t,r)}getConfiguration(t,r){this.techniqueConfig.output=t,this.techniqueConfig.draped=r.slot===Se.DRAPED_MATERIAL;const i=b(this.parameters.stipplePattern)&&t!==K.Highlight;return this.techniqueConfig.stippleEnabled=i,this.techniqueConfig.stippleOffColorEnabled=i&&b(this.parameters.stippleOffColor),this.techniqueConfig.stippleScaleWithLineWidth=i&&this.parameters.stippleScaleWithLineWidth,this.techniqueConfig.stipplePreferContinuous=i&&this.parameters.stipplePreferContinuous,this.techniqueConfig.hasSlicePlane=this.parameters.hasSlicePlane,this.techniqueConfig.hasOccludees=this.parameters.hasOccludees,this.techniqueConfig.roundJoins=this.parameters.join==="round",this.techniqueConfig.capType=this.parameters.cap,this.techniqueConfig.hasPolygonOffset=this.parameters.hasPolygonOffset,this.techniqueConfig.writeDepth=this.parameters.writeDepth,this.techniqueConfig.vvColor=this.parameters.vvColorEnabled,this.techniqueConfig.vvOpacity=this.parameters.vvOpacityEnabled,this.techniqueConfig.vvSize=this.parameters.vvSizeEnabled,this.techniqueConfig.innerColorEnabled=this.parameters.innerWidth>0&&b(this.parameters.innerColor),this.techniqueConfig.falloffEnabled=this.parameters.falloff>0,this.techniqueConfig.occluder=this.parameters.renderOccluded===Fi.OccludeAndTransparentStencil,this.techniqueConfig.transparencyPassType=r.transparencyPassType,this.techniqueConfig.hasMultipassTerrain=r.multipassTerrain.enabled,this.techniqueConfig.cullAboveGround=r.multipassTerrain.cullAboveGround,this.techniqueConfig.wireframe=this.parameters.wireframe,this.techniqueConfig}intersect(t,r,i,s,n,o,a,l,c){b(c)?this._intersectDrapedLineGeometry(t,s,c,o,a):this._intersectLineGeometry(t,r,i,s,a)}_intersectDrapedLineGeometry(t,r,i,s,n){if(!r.options.selectionMode)return;const o=t.vertexAttributes.get(O.POSITION).data,a=t.vertexAttributes.get(O.SIZE);let l=this.parameters.width;if(this.parameters.vvSizeEnabled){const g=t.vertexAttributes.get(O.SIZEFEATUREATTRIBUTE).data[0];l*=Le(this.parameters.vvSizeOffset[0]+g*this.parameters.vvSizeFactor[0],this.parameters.vvSizeMinSize[0],this.parameters.vvSizeMaxSize[0])}else a&&(l*=a.data[0]);const c=s[0],h=s[1],p=(l/2+4)*t.screenToWorldRatio;let f=Number.MAX_VALUE,m=0;for(let g=0;g<o.length-5;g+=3){const v=o[g],w=o[g+1],_=c-v,T=h-w,x=o[g+3]-v,E=o[g+4]-w,C=Le((x*_+E*T)/(x*x+E*E),0,1),A=x*C-_,P=E*C-T,I=A*A+P*P;I<f&&(f=I,m=g/3)}f<p*p&&n(i.dist,i.normal,m,!1)}_intersectLineGeometry(t,r,i,s,n){if(!s.options.selectionMode||_L(r))return;if(!FOe(i))return void tgt.error("intersection assumes a translation-only matrix");const o=t.vertexAttributes,a=o.get(O.POSITION).data;let l=this.parameters.width;if(this.parameters.vvSizeEnabled){const _=o.get(O.SIZEFEATUREATTRIBUTE).data[0];l*=Le(this.parameters.vvSizeOffset[0]+_*this.parameters.vvSizeFactor[0],this.parameters.vvSizeMinSize[0],this.parameters.vvSizeMaxSize[0])}else o.has(O.SIZE)&&(l*=o.get(O.SIZE).data[0]);const c=s.camera,h=ngt;Do(h,s.point);const p=l*c.pixelRatio/2+4*c.pixelRatio;se(AO[0],h[0]-p,h[1]+p,0),se(AO[1],h[0]+p,h[1]+p,0),se(AO[2],h[0]+p,h[1]-p,0),se(AO[3],h[0]-p,h[1]-p,0);for(let _=0;_<4;_++)if(!c.unprojectFromRenderScreen(AO[_],Lg[_]))return;xa(c.eye,Lg[0],Lg[1],Q7),xa(c.eye,Lg[1],Lg[2],J7),xa(c.eye,Lg[2],Lg[3],K7),xa(c.eye,Lg[3],Lg[0],ej);let f=Number.MAX_VALUE,m=0;const g=LQ(this.parameters,o,t.indices)?a.length-2:a.length-5;for(let _=0;_<g;_+=3){El[0]=a[_]+i[12],El[1]=a[_+1]+i[13],El[2]=a[_+2]+i[14];const T=(_+3)%a.length;if(Cl[0]=a[T]+i[12],Cl[1]=a[T+1]+i[13],Cl[2]=a[T+2]+i[14],ui(Q7,El)<0&&ui(Q7,Cl)<0||ui(J7,El)<0&&ui(J7,Cl)<0||ui(K7,El)<0&&ui(K7,Cl)<0||ui(ej,El)<0&&ui(ej,Cl)<0)continue;if(c.projectToRenderScreen(El,Eb),c.projectToRenderScreen(Cl,Cb),Eb[2]<0&&Cb[2]>0){pe(Ff,El,Cl);const E=c.frustum,C=-ui(E[ci.NEAR],El)/Te(Ff,E[ci.NEAR]);le(Ff,Ff,C),de(El,El,Ff),c.projectToRenderScreen(El,Eb)}else if(Eb[2]>0&&Cb[2]<0){pe(Ff,Cl,El);const E=c.frustum,C=-ui(E[ci.NEAR],Cl)/Te(Ff,E[ci.NEAR]);le(Ff,Ff,C),de(Cl,Cl,Ff),c.projectToRenderScreen(Cl,Cb)}else if(Eb[2]<0&&Cb[2]<0)continue;Eb[2]=0,Cb[2]=0;const x=mte(Bx(Eb,Cb,mfe),h);x<f&&(f=x,ae(pfe,El),ae(ffe,Cl),m=_/3)}const v=s.rayBegin,w=s.rayEnd;if(f<p*p){let _=Number.MAX_VALUE;if(UTe(Bx(pfe,ffe,mfe),Bx(v,w,ogt),Sb)){pe(Sb,Sb,v);const T=Re(Sb);le(Sb,Sb,1/T),_=T/pi(v,w)}n(_,Sb,m,!1)}}computeAttachmentOrigin(t,r){const i=t.vertexAttributes;if(!i)return null;const s=t.indices,n=i.get(O.POSITION);return Mie(n,s?s.get(O.POSITION):null,s&&LQ(this.parameters,i,s),r)}createLayout(){const t=ps().vec3f(O.POSITION).f32(O.SUBDIVISIONFACTOR).vec2f(O.UV0).vec3f(O.AUXPOS1).vec3f(O.AUXPOS2);return this.parameters.vvSizeEnabled?t.f32(O.SIZEFEATUREATTRIBUTE):t.f32(O.SIZE),this.parameters.vvColorEnabled?t.f32(O.COLORFEATUREATTRIBUTE):t.vec4f(O.COLOR),this.parameters.vvOpacityEnabled&&t.f32(O.OPACITYFEATUREATTRIBUTE),t}createBufferWriter(){return new sgt(this.layout,this.parameters)}requiresSlot(t,r){if(t===Se.DRAPED_MATERIAL)return!0;if(this.parameters.renderOccluded===Fi.OccludeAndTransparentStencil)return t===Se.OPAQUE_MATERIAL||t===Se.OCCLUDER_MATERIAL||t===Se.TRANSPARENT_OCCLUDER_MATERIAL;const i=IT(r);return i===K.Color||i===K.Alpha?t===(this.parameters.writeDepth?Se.TRANSPARENT_MATERIAL:Se.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL):t===Se.OPAQUE_MATERIAL}createGLMaterial(t){return t.output===K.Color||t.output===K.Alpha||t.output===K.Highlight||t.output===K.Depth?new rgt(t):null}validateParameters(t){t.join!=="miter"&&(t.miterLimit=0)}}class rgt extends J1{_updateOccludeeState(t){t.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:t.hasOccludees})}beginSlot(t){return this._output!==K.Color&&this._output!==K.Alpha||this._updateOccludeeState(t),this.ensureTechnique(qB,t)}}class igt extends use{constructor(){super(...arguments),this.width=0,this.color=Sd,this.join="miter",this.cap=Ld.BUTT,this.miterLimit=5,this.writeDepth=!0,this.hasPolygonOffset=!1,this.stippleScaleWithLineWidth=!1,this.stipplePreferContinuous=!0,this.hasSlicePlane=!1,this.vvFastUpdate=!1,this.isClosed=!1,this.falloff=0,this.innerWidth=0,this.hasOccludees=!1,this.wireframe=!1}}class sgt{constructor(t,r){this.parameters=r,this.numJoinSubdivisions=0,this.vertexBufferLayout=t;const i=r.stipplePattern?1:0;switch(this.parameters.join){case"miter":case"bevel":this.numJoinSubdivisions=i;break;case"round":this.numJoinSubdivisions=KV+i}}_isClosed(t){return LQ(this.parameters,t.vertexAttributes,t.indices)}allocate(t){return this.vertexBufferLayout.createBuffer(t)}elementCount(t){const i=t.indices.get(O.POSITION).length/2+1,s=this._isClosed(t);let n=s?2:2*2;return n+=((s?i:i-1)-(s?0:1))*(2*this.numJoinSubdivisions+4),n+=2,this.parameters.wireframe&&(n=2+4*(n-2)),n}write(t,r,i,s){var z;const n=agt,o=lgt,a=cgt,l=r.vertexAttributes.get(O.POSITION).data,c=r.indices&&r.indices.get(O.POSITION),h=(z=r.vertexAttributes.get(O.DISTANCETOSTART))==null?void 0:z.data;c&&c.length!==2*(l.length/3-1)&&console.warn("RibbonLineMaterial does not support indices");let p=1,f=0;this.parameters.vvSizeEnabled?f=r.vertexAttributes.get(O.SIZEFEATUREATTRIBUTE).data[0]:r.vertexAttributes.has(O.SIZE)&&(p=r.vertexAttributes.get(O.SIZE).data[0]);let m=[1,1,1,1],g=0;this.parameters.vvColorEnabled?g=r.vertexAttributes.get(O.COLORFEATUREATTRIBUTE).data[0]:r.vertexAttributes.has(O.COLOR)&&(m=r.vertexAttributes.get(O.COLOR).data);let v=0;this.parameters.vvOpacityEnabled&&(v=r.vertexAttributes.get(O.OPACITYFEATUREATTRIBUTE).data[0]);const w=l.length/3,_=t.transformation,T=new Float32Array(i.buffer),x=this.vertexBufferLayout.stride/4;let E=s*x;const C=E;let A=0;const P=h?(X,Z,ce)=>A=h[ce]:(X,Z,ce)=>A+=pi(X,Z),I=(X,Z,ce,ne,D,N,V)=>{if(T[E++]=Z[0],T[E++]=Z[1],T[E++]=Z[2],T[E++]=ne,T[E++]=V,T[E++]=D,T[E++]=X[0],T[E++]=X[1],T[E++]=X[2],T[E++]=ce[0],T[E++]=ce[1],T[E++]=ce[2],this.parameters.vvSizeEnabled?T[E++]=f:T[E++]=p,this.parameters.vvColorEnabled)T[E++]=g;else{const B=Math.min(4*N,m.length-4);T[E++]=m[B+0],T[E++]=m[B+1],T[E++]=m[B+2],T[E++]=m[B+3]}this.parameters.vvOpacityEnabled&&(T[E++]=v)};E+=x,se(o,l[0],l[1],l[2]),_&&Ve(o,o,_);const L=this._isClosed(r);if(L){const X=l.length-3;se(n,l[X],l[X+1],l[X+2]),_&&Ve(n,n,_)}else se(a,l[3],l[4],l[5]),_&&Ve(a,a,_),I(o,o,a,1,Oc.LEFT_CAP_START,0,0),I(o,o,a,1,Oc.RIGHT_CAP_START,0,0),ae(n,o),ae(o,a);const k=L?0:1,G=L?w:w-1;for(let X=k;X<G;X++){const Z=(X+1)%w*3;se(a,l[Z+0],l[Z+1],l[Z+2]),_&&Ve(a,a,_),P(n,o,X),I(n,o,a,0,Oc.LEFT_JOIN_END,X,A),I(n,o,a,0,Oc.RIGHT_JOIN_END,X,A);const ce=this.numJoinSubdivisions;for(let ne=0;ne<ce;++ne){const D=(ne+1)/(ce+1);I(n,o,a,D,Oc.LEFT_JOIN_END,X,A),I(n,o,a,D,Oc.RIGHT_JOIN_END,X,A)}I(n,o,a,1,Oc.LEFT_JOIN_START,X,A),I(n,o,a,1,Oc.RIGHT_JOIN_START,X,A),ae(n,o),ae(o,a)}L?(se(a,l[3],l[4],l[5]),_&&Ve(a,a,_),A=P(n,o,G),I(n,o,a,0,Oc.LEFT_JOIN_END,k,A),I(n,o,a,0,Oc.RIGHT_JOIN_END,k,A)):(A=P(n,o,G),I(n,o,o,0,Oc.LEFT_CAP_END,G,A),I(n,o,o,0,Oc.RIGHT_CAP_END,G,A)),Y7(T,C+x,T,C,x),E=Y7(T,E-x,T,E,x),this.parameters.wireframe&&this._addWireframeVertices(i,C,E,x)}_addWireframeVertices(t,r,i,s){const n=new Float32Array(t.buffer,i*Float32Array.BYTES_PER_ELEMENT),o=new Float32Array(t.buffer,r*Float32Array.BYTES_PER_ELEMENT,i-r);let a=0;const l=c=>a=Y7(o,c,n,a,s);for(let c=0;c<o.length-1;c+=2*s)l(c),l(c+2*s),l(c+1*s),l(c+2*s),l(c+1*s),l(c+3*s)}}function Y7(e,t,r,i,s){for(let n=0;n<s;n++)r[i++]=e[t++];return i}function LQ(e,t,r){return APe(e,t.get(O.POSITION).data,r?r.get(O.POSITION):null)}function APe(e,t,r){return!!e.isClosed&&(r?r.length>2:t.length>6)}const El=M(),Cl=M(),Ff=M(),Sb=M(),ngt=M(),Eb=ea(),Cb=ea(),pfe=M(),ffe=M(),mfe=yg(),ogt=yg(),agt=M(),lgt=M(),cgt=M(),AO=[ea(),ea(),ea(),ea()],Lg=[M(),M(),M(),M()],Q7=Er(),J7=Er(),K7=Er(),ej=Er();class Ese{constructor(t,r=125e4){this._originSR=t,this._gridSize=r,this._origins=new Map,this._objects=new Map,this._rootOriginId="root/"+Jl()}getOrigin(t){const r=this._origins.get(this._rootOriginId);if(r==null){const h=Umt.rootOrigin;if(b(h))return this._origins.set(this._rootOriginId,bP(h[0],h[1],h[2],this._rootOriginId)),this.getOrigin(t);const p=bP(t[0]+Math.random()-.5,t[1]+Math.random()-.5,t[2]+Math.random()-.5,this._rootOriginId);return this._origins.set(this._rootOriginId,p),p}const i=this._gridSize,s=Math.round(t[0]/i),n=Math.round(t[1]/i),o=Math.round(t[2]/i),a=`${s}/${n}/${o}`;let l=this._origins.get(a);const c=.5*i;if(pe(lo,t,r.vec3),lo[0]=Math.abs(lo[0]),lo[1]=Math.abs(lo[1]),lo[2]=Math.abs(lo[2]),lo[0]<c&&lo[1]<c&&lo[2]<c){if(l){const h=Math.max(...lo);if(pe(lo,t,l.vec3),lo[0]=Math.abs(lo[0]),lo[1]=Math.abs(lo[1]),lo[2]=Math.abs(lo[2]),Math.max(...lo)<h)return l}return r}return l||(l=bP(s*i,n*i,o*i,a),this._origins.set(a,l)),l}_drawOriginBox(t,r=xr(1,1,0,1)){const i=window.view,s=i._stage,n=r.toString();if(!this._objects.has(n)){this._material=new jE({width:2,color:r}),s.add(this._material);const m=new _Pe({isPickable:!1}),g=new k0({castShadow:!1});s.add(g),m.add(g),s.add(m),this._objects.set(n,g)}const o=this._objects.get(n),a=[0,1,5,4,0,2,1,7,6,2,0,1,3,7,5,4,6,2,0],l=a.length,c=new Array(3*l),h=new Uint16Array(2*(l-1)),p=.5*this._gridSize;for(let m=0;m<l;m++)c[3*m+0]=t[0]+(1&a[m]?p:-p),c[3*m+1]=t[1]+(2&a[m]?p:-p),c[3*m+2]=t[2]+(4&a[m]?p:-p),m>0&&(h[2*m+0]=m-1,h[2*m+1]=m);mi(c,this._originSR,0,c,i.renderSpatialReference,0,l);const f=new Bi([[O.POSITION,{size:3,data:c,exclusive:!0}]],[[O.POSITION,h]],rc.Line);s.add(f),o.addGeometry(f,this._material,Tn)}}const lo=M();class RPe{constructor(t,r,i,s=null){this.rctx=t,this.sliceHelper=s,this.lastFrameCamera=new ii,this.pass=je.MATERIAL,this.renderOccludedMask=gfe,this.bindParameters=new vB(r,i,b(s)?s.plane:null)}resetRenderOccludedMask(){this.renderOccludedMask=gfe}get isHighlightPass(){return this.pass===je.MATERIAL_HIGHLIGHT}}class ugt extends RPe{constructor(t,r,i,s,n){super(t,i,s,n),this.offscreenRenderingHelper=r,this.sliceHelper=n}}const gfe=Fi.Occlude|Fi.OccludeAndTransparent|Fi.OccludeAndTransparentStencil;var HA;(function(e){e[e.Highlight=0]="Highlight",e[e.Default=1]="Default"})(HA||(HA={}));class tF{constructor(){this.camera=new ii,this.lightMat=Ce()}}class Cse{constructor(t,r,i=0){this.rctx=t,this.viewingMode=r,this._enabled=!1,this._snapshots=new Array,this._textureSize=0,this.maxTextureSize=0,this.numCascades=1,this.maxNumCascades=4,this.splitSchemeLambda=0,this.warp=!0,this._cascadeDistances=[0,0,0,0,0],this._usedCascadeDistances=Zt(),this._cascades=[new tF,new tF,new tF,new tF],this.maxTextureSize=this.rctx.parameters.maxTextureSize,this.snapshotCount=i}get depthTexture(){return this._depthTexture}get textureSize(){return this._textureSize}get cascadeDistances(){return Kr(this._usedCascadeDistances,this._cascadeDistances[0],this.numCascades>1?this._cascadeDistances[1]:1/0,this.numCascades>2?this._cascadeDistances[2]:1/0,this.numCascades>3?this._cascadeDistances[3]:1/0)}dispose(){this._discardDepthTexture(),this._discardAllSnapshots()}set maxCascades(t){this.maxNumCascades=Le(Math.floor(t),1,4)}get maxCascades(){return this.maxNumCascades}set enabled(t){this._enabled=t,t||(this._discardDepthTexture(),this._discardAllSnapshots())}get enabled(){return this._enabled}get ready(){return this._enabled&&b(this._depthTexture)}get snapshotCount(){return this._snapshots.length}set snapshotCount(t){const r=this._snapshots.length;if(t>r){const i=t-r;this._snapshots.length=t;for(let s=0;s<i;++s)this._snapshots[r+s]=null}else if(t<this.snapshotCount){const i=r-t;for(let s=0;s<i;++s)this._discardSnapshot(t+s);this._snapshots.length=t}}getSnapshot(t){return this.enabled?this._snapshots[t]:null}getCascades(){for(let t=0;t<this.numCascades;++t)rj[t]=this._cascades[t];return rj.length=this.numCascades,rj}start(t,r,i){ft(this.enabled),this._textureSize=this._computeTextureSize(t.fullWidth,t.fullHeight),this._ensureDepthTexture();const{near:s,far:n}=this._clampNearFar(i);this._computeCascadeDistances(n,s),this._setupMatrices(t,r);const o=t.viewMatrix,a=t.projectionMatrix;for(let l=0;l<this.numCascades;++l)this._constructCascade(l,a,o,r);this.lastOrigin=null,this.clear()}finish(t){ft(this.enabled),this.rctx.bindFramebuffer(t)}getShadowMapMatrices(t){if(!this.lastOrigin||!Xl(t,this.lastOrigin)){this.lastOrigin=this.lastOrigin||M(),ae(this.lastOrigin,t);for(let r=0;r<this.numCascades;++r){yl(Cfe,this._cascades[r].lightMat,t);for(let i=0;i<16;++i)Afe[16*r+i]=Cfe[i]}}return Afe}takeCascadeSnapshotTo(t,r){ft(this.enabled);const i=this._ensureSnapshot(r);this._bindFbo();const s=this.rctx,n=s.bindTexture(i,nt.TEXTURE_UNIT_FOR_UPDATES);s.gl.copyTexSubImage2D(mt.TEXTURE_2D,0,t.camera.viewport[0],t.camera.viewport[1],t.camera.viewport[0],t.camera.viewport[1],t.camera.viewport[2],t.camera.viewport[3]),s.bindTexture(n,nt.TEXTURE_UNIT_FOR_UPDATES)}clear(){const t=this.rctx;this._bindFbo(),t.setClearColor(1,1,1,1),t.clearSafe(ri.COLOR_BUFFER_BIT|ri.DEPTH_BUFFER_BIT)}_computeTextureSize(t,r){const i=.5*Math.log(t*t+r*r)*Math.LOG2E,s=.35,n=2**Math.round(i+s);return Math.min(this.maxTextureSize,2*n)}_ensureDepthTexture(){if(b(this._depthTexture)&&this._depthTexture.descriptor.width===this._textureSize)return;this._discardDepthTexture();const t={target:mt.TEXTURE_2D,pixelFormat:ze.RGBA,dataType:Ct.UNSIGNED_BYTE,wrapMode:xt.CLAMP_TO_EDGE,samplingMode:et.NEAREST,flipped:!0,width:this._textureSize,height:this._textureSize};this._depthTexture=new nt(this.rctx,t),this._fbo=new Pi(this.rctx,{colorTarget:us.TEXTURE,depthStencilTarget:Pr.DEPTH_RENDER_BUFFER,width:this._textureSize,height:this._textureSize},this._depthTexture)}_ensureSnapshot(t){let r=this._snapshots[t];if(b(r)&&r.descriptor.width===this._textureSize)return r;this._discardSnapshot(t);const i={target:mt.TEXTURE_2D,pixelFormat:ze.RGBA,dataType:Ct.UNSIGNED_BYTE,wrapMode:xt.CLAMP_TO_EDGE,samplingMode:et.NEAREST,flipped:!0,width:this._textureSize,height:this._textureSize};return r=new nt(this.rctx,i),this._snapshots[t]=r,r}_discardDepthTexture(){this._fbo=Ye(this._fbo),this._depthTexture=Ye(this._depthTexture)}_discardSnapshot(t){this._snapshots[t]=Ye(this._snapshots[t])}_discardAllSnapshots(){for(let t=0;t<this.snapshotCount;++t)this._discardSnapshot(t)}_bindFbo(){const t=this.rctx;t.unbindTexture(this._depthTexture),t.bindFramebuffer(this._fbo)}_constructCascade(t,r,i,s){const n=this._cascades[t],o=-this._cascadeDistances[t],a=-this._cascadeDistances[t+1],l=(r[10]*o+r[14])/Math.abs(r[11]*o+r[15]),c=(r[10]*a+r[14])/Math.abs(r[11]*a+r[15]);ft(l<c);for(let p=0;p<8;++p){Kr(bfe,p%4==0||p%4==3?-1:1,p%4==0||p%4==1?-1:1,p<4?l:c,1),ih(Cc[p],bfe,_fe);for(let f=0;f<3;++f)Cc[p][f]/=Cc[p][3]}Ra(tj,Cc[0]),yl(yfe,Efe,tj),n.camera.viewMatrix=yfe;for(let p=0;p<8;++p)Ve(Cc[p],Cc[p],n.camera.viewMatrix);ae(kf,Cc[0]),ae(Uf,Cc[0]);for(let p=1;p<8;++p)for(let f=0;f<3;++f)kf[f]=Math.min(kf[f],Cc[p][f]),Uf[f]=Math.max(Uf[f],Cc[p][f]);kf[2]-=200,Uf[2]+=200,n.camera.near=-Uf[2],n.camera.far=-kf[2],this.warp?this._constructTrapezoidalProjection(i,s,n):this._constructOrthogonalProjection(n),Yi(n.lightMat,n.camera.projectionMatrix,n.camera.viewMatrix);const h=this._textureSize/2;n.camera.viewport[0]=t%2==0?0:h,n.camera.viewport[1]=Math.floor(t/2)===0?0:h,n.camera.viewport[2]=h,n.camera.viewport[3]=h}_constructOrthogonalProjection(t){rte(t.camera.projectionMatrix,kf[0],Uf[0],kf[1],Uf[1],t.camera.near,t.camera.far)}_constructTrapezoidalProjection(t,r,i){const s=1/Cc[0][3],n=1/Cc[4][3];ft(s<n);let o=s+Math.sqrt(s*n);const a=Math.sin(Cn(t[2]*r[0]+t[6]*r[1]+t[10]*r[2]));o/=a,dgt(Cc,o,a,wfe,xfe,hgt,Tfe,Sfe),pgt(wfe,xfe,Tfe,Sfe,i.camera.projectionMatrix),i.camera.projectionMatrix[10]=2/(kf[2]-Uf[2]),i.camera.projectionMatrix[14]=-(kf[2]+Uf[2])/(kf[2]-Uf[2])}_setupMatrices(t,r){Yi(vfe,t.projectionMatrix,t.viewMatrix),Cs(_fe,vfe);const i=this.viewingMode===Be.Global?t.eye:se(tj,0,0,1);w6(Efe,[0,0,0],[-r[0],-r[1],-r[2]],i)}_clampNearFar(t){let{near:r,far:i}=t;return r<2&&(r=2),i<2&&(i=2),r>=i&&(r=2,i=4),{near:r,far:i}}_computeCascadeDistances(t,r){this.numCascades=Math.min(1+Math.floor(Fat(t/r,4)),this.maxNumCascades);const i=(t-r)/this.numCascades,s=(t/r)**(1/this.numCascades);let n=r,o=r;for(let a=0;a<this.numCascades+1;++a)this._cascadeDistances[a]=Yt(n,o,this.splitSchemeLambda),n*=s,o+=i}get gpuMemoryUsage(){var t,r;return this._snapshots.reduce((i,s)=>i+bT(s),(r=(t=this._fbo)==null?void 0:t.gpuMemoryUsage)!=null?r:0)}get test(){const t=this;return{maxNumCascades:this.maxNumCascades,cascades:this._cascades,textureSize:this._textureSize,set splitSchemeLambda(r){t.splitSchemeLambda=r},get splitSchemeLambda(){return t.splitSchemeLambda},set warp(r){t.warp=r},get warp(){return t.warp}}}}const yfe=Ce(),vfe=Ce(),_fe=Ce(),bfe=Zt(),Cc=[];for(let e=0;e<8;++e)Cc.push(Zt());const kf=M(),Uf=M(),wfe=rt(),xfe=rt(),hgt=rt(),Tfe=rt(),Sfe=rt(),Efe=Ce(),tj=M(),rj=[],Cfe=Ce(),Afe=new Float32Array(64),vu=rt(),IS=rt(),Ab=[rt(),rt(),rt(),rt()],An=rt(),ij=rt(),iv=rt(),RO=rt(),$S=rt(),LS=rt(),rF=rt();function dgt(e,t,r,i,s,n,o,a){vr(vu,0,0);for(let C=0;C<4;++C)Bp(vu,vu,e[C]);Bc(vu,vu,.25),vr(IS,0,0);for(let C=4;C<8;++C)Bp(IS,IS,e[C]);Bc(IS,IS,.25),Z2(Ab[0],e[4],e[5],.5),Z2(Ab[1],e[5],e[6],.5),Z2(Ab[2],e[6],e[7],.5),Z2(Ab[3],e[7],e[4],.5);let l=0,c=TV(Ab[0],vu);for(let C=1;C<4;++C){const A=TV(Ab[C],vu);A<c&&(c=A,l=C)}$m(An,Ab[l],e[l+4]);const h=An[0];let p,f;An[0]=-An[1],An[1]=h,$m(ij,IS,vu),un(ij,An)<0&&sie(An,An),Z2(An,An,ij,r),$I(An,An),p=f=un($m(iv,e[0],vu),An);for(let C=1;C<8;++C){const A=un($m(iv,e[C],vu),An);A<p?p=A:A>f&&(f=A)}Do(i,vu),Bc(iv,An,p-t),Bp(i,i,iv);let m=-1,g=1,v=0,w=0;for(let C=0;C<8;++C){$m(RO,e[C],i),$I(RO,RO);const A=An[0]*RO[1]-An[1]*RO[0];A>0?A>m&&(m=A,v=C):A<g&&(g=A,w=C)}wS(m>0,"leftArea"),wS(g<0,"rightArea"),Bc($S,An,p),Bp($S,$S,vu),Bc(LS,An,f),Bp(LS,LS,vu),rF[0]=-An[1],rF[1]=An[0];const _=bN(i,e[w],LS,Bp(iv,LS,rF),1,s),T=bN(i,e[v],LS,iv,1,n),x=bN(i,e[v],$S,Bp(iv,$S,rF),1,o),E=bN(i,e[w],$S,iv,1,a);wS(_,"rayRay"),wS(T,"rayRay"),wS(x,"rayRay"),wS(E,"rayRay")}function fr(e,t){return 3*t+e}const Rfe=rt();function mc(e,t){return vr(Rfe,e[t],e[t+3]),Rfe}const Al=rt(),Je=$i();function pgt(e,t,r,i,s){$m(Al,r,i),Bc(Al,Al,.5),Je[0]=Al[0],Je[1]=Al[1],Je[2]=0,Je[3]=Al[1],Je[4]=-Al[0],Je[5]=0,Je[6]=Al[0]*Al[0]+Al[1]*Al[1],Je[7]=Al[0]*Al[1]-Al[1]*Al[0],Je[8]=1,Je[fr(0,2)]=-un(mc(Je,0),e),Je[fr(1,2)]=-un(mc(Je,1),e);let n=un(mc(Je,0),r)+Je[fr(0,2)],o=un(mc(Je,1),r)+Je[fr(1,2)],a=un(mc(Je,0),i)+Je[fr(0,2)],l=un(mc(Je,1),i)+Je[fr(1,2)];n=-(n+a)/(o+l),Je[fr(0,0)]+=Je[fr(1,0)]*n,Je[fr(0,1)]+=Je[fr(1,1)]*n,Je[fr(0,2)]+=Je[fr(1,2)]*n,n=1/(un(mc(Je,0),r)+Je[fr(0,2)]),o=1/(un(mc(Je,1),r)+Je[fr(1,2)]),Je[fr(0,0)]*=n,Je[fr(0,1)]*=n,Je[fr(0,2)]*=n,Je[fr(1,0)]*=o,Je[fr(1,1)]*=o,Je[fr(1,2)]*=o,Je[fr(2,0)]=Je[fr(1,0)],Je[fr(2,1)]=Je[fr(1,1)],Je[fr(2,2)]=Je[fr(1,2)],Je[fr(1,2)]+=1,n=un(mc(Je,1),t)+Je[fr(1,2)],o=un(mc(Je,2),t)+Je[fr(2,2)],a=un(mc(Je,1),r)+Je[fr(1,2)],l=un(mc(Je,2),r)+Je[fr(2,2)],n=-.5*(n/o+a/l),Je[fr(1,0)]+=Je[fr(2,0)]*n,Je[fr(1,1)]+=Je[fr(2,1)]*n,Je[fr(1,2)]+=Je[fr(2,2)]*n,n=un(mc(Je,1),t)+Je[fr(1,2)],o=un(mc(Je,2),t)+Je[fr(2,2)],a=-o/n,Je[fr(1,0)]*=a,Je[fr(1,1)]*=a,Je[fr(1,2)]*=a,s[0]=Je[0],s[1]=Je[1],s[2]=0,s[3]=Je[2],s[4]=Je[3],s[5]=Je[4],s[6]=0,s[7]=Je[5],s[8]=0,s[9]=0,s[10]=1,s[11]=0,s[12]=Je[6],s[13]=Je[7],s[14]=0,s[15]=Je[8]}class OPe{constructor(){this.adds=new Xt,this.removes=new Xt,this.updates=new Xt({allocator:t=>t||new fgt,deallocator:t=>(t.renderGeometry=null,t)})}clear(){this.adds.clear(),this.removes.clear(),this.updates.clear()}prune(){this.adds.prune(),this.removes.prune(),this.updates.prune()}}class fgt{}class mgt{constructor(){this.adds=new Array,this.removes=new Array,this.updates=new Array}}var sr;(function(e){var t,r;(t=e.Geometry||(e.Geometry={}))[t.ADD=1]="ADD",t[t.UPDATE=2]="UPDATE",t[t.REMOVE=4]="REMOVE",(r=e.State||(e.State={}))[r.VISIBILITIES=1]="VISIBILITIES",r[r.VERTEXATTRS=2]="VERTEXATTRS",r[r.TRANSFORMATION=4]="TRANSFORMATION",r[r.HIGHLIGHTS=8]="HIGHLIGHTS",r[r.OCCLUDEES=16]="OCCLUDEES"})(sr||(sr={}));function MPe(e){const t=new Map,r=i=>{let s=t.get(i);return s||(s=new mgt,t.set(i,s)),s};return e.removes.forAll(i=>{sj(i)&&r(i.material).removes.push(i)}),e.adds.forAll(i=>{sj(i)&&r(i.material).adds.push(i)}),e.updates.forAll(i=>{sj(i.renderGeometry)&&r(i.renderGeometry.material).updates.push(i)}),t}function sj(e){return e.data.indexCount>=1}function ggt(e){const t=S`vec3 decodeNormal(vec2 f) {
float z = 1.0 - abs(f.x) - abs(f.y);
return vec3(f + sign(f) * min(z, 0.0), z);
}`;e.fragment.code.add(t),e.vertex.code.add(t)}function WB(e,t){t.normalType===Ii.Attribute&&(e.attributes.add(O.NORMAL,"vec3"),e.vertex.code.add(S`vec3 normalModel() {
return normal;
}`)),t.normalType===Ii.CompressedAttribute&&(e.include(ggt),e.attributes.add(O.NORMALCOMPRESSED,"vec2"),e.vertex.code.add(S`vec3 normalModel() {
return decodeNormal(normalCompressed);
}`)),t.normalType===Ii.ScreenDerivative&&(e.extensions.add("GL_OES_standard_derivatives"),e.fragment.code.add(S`vec3 screenDerivativeNormal(vec3 positionView) {
return normalize(cross(dFdx(positionView), dFdy(positionView)));
}`))}var Ii;(function(e){e[e.Attribute=0]="Attribute",e[e.CompressedAttribute=1]="CompressedAttribute",e[e.Ground=2]="Ground",e[e.ScreenDerivative=3]="ScreenDerivative",e[e.COUNT=4]="COUNT"})(Ii||(Ii={}));function XB(e){e.attributes.add(O.POSITION,"vec3"),e.vertex.code.add(S`vec3 positionModel() { return position; }`)}function tz({code:e},t){t.doublePrecisionRequiresObfuscation?e.add(S`vec3 dpPlusFrc(vec3 a, vec3 b) {
return mix(a, a + b, vec3(notEqual(b, vec3(0))));
}
vec3 dpMinusFrc(vec3 a, vec3 b) {
return mix(vec3(0), a - b, vec3(notEqual(a, b)));
}
vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
vec3 t1 = dpPlusFrc(hiA, hiB);
vec3 e = dpMinusFrc(t1, hiA);
vec3 t2 = dpMinusFrc(hiB, e) + dpMinusFrc(hiA, dpMinusFrc(t1, e)) + loA + loB;
return t1 + t2;
}`):e.add(S`vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
vec3 t1 = hiA + hiB;
vec3 e = t1 - hiA;
vec3 t2 = ((hiB - e) + (hiA - (t1 - e))) + loA + loB;
return t1 + t2;
}`)}function ML(e){return!!he("force-double-precision-obfuscation")||e.driverTest.doublePrecisionRequiresObfuscation}function bC(e,t){e.include(XB);const r=e.vertex;r.include(tz,t),e.varyings.add("vPositionWorldCameraRelative","vec3"),e.varyings.add("vPosition_view","vec3"),r.uniforms.add([new St("transformWorldFromViewTH",i=>i.transformWorldFromViewTH),new St("transformWorldFromViewTL",i=>i.transformWorldFromViewTL),new SL("transformViewFromCameraRelativeRS",i=>i.transformViewFromCameraRelativeRS),new Ei("transformProjFromView",i=>i.transformProjFromView),new kI("transformWorldFromModelRS",i=>i.transformWorldFromModelRS),new pl("transformWorldFromModelTH",i=>i.transformWorldFromModelTH),new pl("transformWorldFromModelTL",i=>i.transformWorldFromModelTL)]),r.code.add(S`vec3 positionWorldCameraRelative() {
vec3 rotatedModelPosition = transformWorldFromModelRS * positionModel();
vec3 transform_CameraRelativeFromModel = dpAdd(
transformWorldFromModelTL,
transformWorldFromModelTH,
-transformWorldFromViewTL,
-transformWorldFromViewTH
);
return transform_CameraRelativeFromModel + rotatedModelPosition;
}`),r.code.add(S`
    void forwardPosition(float fOffset) {
      vPositionWorldCameraRelative = positionWorldCameraRelative();
      if (fOffset != 0.0) {
        vPositionWorldCameraRelative += fOffset * ${t.spherical?S`normalize(transformWorldFromViewTL + vPositionWorldCameraRelative)`:S`vec3(0.0, 0.0, 1.0)`};
      }

      vPosition_view = transformViewFromCameraRelativeRS * vPositionWorldCameraRelative;
      gl_Position = transformProjFromView * vec4(vPosition_view, 1.0);
    }
  `),e.fragment.uniforms.add(new St("transformWorldFromViewTL",i=>i.transformWorldFromViewTL)),r.code.add(S`vec3 positionWorld() {
return transformWorldFromViewTL + vPositionWorldCameraRelative;
}`),e.fragment.code.add(S`vec3 positionWorld() {
return transformWorldFromViewTL + vPositionWorldCameraRelative;
}`)}class PPe extends nn{constructor(){super(...arguments),this.transformWorldFromViewTH=M(),this.transformWorldFromViewTL=M(),this.transformViewFromCameraRelativeRS=$i(),this.transformProjFromView=Ce()}}class IPe extends nn{constructor(){super(...arguments),this.transformWorldFromModelRS=$i(),this.transformWorldFromModelTH=Mr(),this.transformWorldFromModelTL=Mr()}}function ZB(e,t){t.normalType===Ii.Attribute||t.normalType===Ii.CompressedAttribute?(e.include(WB,t),e.varyings.add("vNormalWorld","vec3"),e.varyings.add("vNormalView","vec3"),e.vertex.uniforms.add([new kI("transformNormalGlobalFromModel",r=>r.transformNormalGlobalFromModel),new SL("transformNormalViewFromGlobal",r=>r.transformNormalViewFromGlobal)]),e.vertex.code.add(S`void forwardNormal() {
vNormalWorld = transformNormalGlobalFromModel * normalModel();
vNormalView = transformNormalViewFromGlobal * vNormalWorld;
}`)):t.normalType===Ii.Ground?(e.include(bC,t),e.varyings.add("vNormalWorld","vec3"),e.vertex.code.add(S`
    void forwardNormal() {
      vNormalWorld = ${t.spherical?S`normalize(vPositionWorldCameraRelative);`:S`vec3(0.0, 0.0, 1.0);`}
    }
    `)):e.vertex.code.add(S`void forwardNormal() {}`)}class $Pe extends PPe{constructor(){super(...arguments),this.transformNormalViewFromGlobal=$i()}}class LPe extends IPe{constructor(){super(...arguments),this.transformNormalGlobalFromModel=$i(),this.toMapSpace=Zt()}}class DQ extends LPe{constructor(t=M()){super(),this.origin=t,this.slicePlaneLocalOrigin=this.origin}}function PL(e,t){t.output===K.Color&&t.receiveShadows?(e.varyings.add("linearDepth","float"),e.vertex.code.add(S`void forwardLinearDepth() { linearDepth = gl_Position.w; }`)):t.output===K.Depth||t.output===K.Shadow?(e.include(bC,t),e.varyings.add("linearDepth","float"),e.vertex.uniforms.add(new _r("nearFar",(r,i)=>i.camera.nearFar)),e.vertex.code.add(S`void forwardLinearDepth() {
linearDepth = (-vPosition_view.z - nearFar[0]) / (nearFar[1] - nearFar[0]);
}`)):e.vertex.code.add(S`void forwardLinearDepth() {}`)}function Z_(e,t){t.spherical?e.vertex.code.add(S`vec3 getLocalUp(in vec3 pos, in vec3 origin) {
return normalize(pos + origin);
}`):e.vertex.code.add(S`vec3 getLocalUp(in vec3 pos, in vec3 origin) {
return vec3(0.0, 0.0, 1.0);
}`),t.spherical?e.vertex.code.add(S`mat3 getTBNMatrix(in vec3 n) {
vec3 t = normalize(cross(vec3(0.0, 0.0, 1.0), n));
vec3 b = normalize(cross(n, t));
return mat3(t, b, n);
}`):e.vertex.code.add(S`mat3 getTBNMatrix(in vec3 n) {
vec3 t = vec3(1.0, 0.0, 0.0);
vec3 b = normalize(cross(n, t));
return mat3(t, b, n);
}`)}class IL extends ss{constructor(t,r){super(t,"int",Vr.Pass,(i,s,n)=>i.setUniform1i(t,r(s,n)))}}class DPe extends ss{constructor(t,r,i,s){switch(r){case Vr.Pass:return void super(t,"mat4",r,(n,o,a)=>n.setUniformMatrix4fv(t,i(o,a)),s);case Vr.Draw:return void super(t,"mat4",r,(n,o,a)=>n.setUniformMatrix4fv(t,i(o,a)),s)}}}class NPe extends nn{constructor(){super(...arguments),this.origin=M()}}function YB(e,t){t.receiveShadows&&(e.fragment.uniforms.add(new DPe("shadowMapMatrix",Vr.Pass,(r,i)=>i.shadowMap.getShadowMapMatrices(r.origin),4)),FPe(e))}function $T(e,t){t.receiveShadows&&(e.fragment.uniforms.add(new DPe("shadowMapMatrix",Vr.Draw,(r,i)=>i.shadowMap.getShadowMapMatrices(r.origin),4)),FPe(e))}function FPe(e){const t=e.fragment;t.include(hu),t.uniforms.add([new Ht("shadowMapTex",(r,i)=>i.shadowMap.depthTexture),new IL("numCascades",(r,i)=>i.shadowMap.numCascades),new lr("cascadeDistances",(r,i)=>i.shadowMap.cascadeDistances),new qe("depthHalfPixelSz",(r,i)=>.5/i.shadowMap.textureSize)]),t.code.add(S`int chooseCascade(float depth, out mat4 mat) {
vec4 distance = cascadeDistances;
int i = depth < distance[1] ? 0 : depth < distance[2] ? 1 : depth < distance[3] ? 2 : 3;
mat = i == 0 ? shadowMapMatrix[0] : i == 1 ? shadowMapMatrix[1] : i == 2 ? shadowMapMatrix[2] : shadowMapMatrix[3];
return i;
}
vec3 lightSpacePosition(vec3 _vpos, mat4 mat) {
vec4 lv = mat * vec4(_vpos, 1.0);
lv.xy /= lv.w;
return 0.5 * lv.xyz + vec3(0.5);
}
vec2 cascadeCoordinates(int i, vec3 lvpos) {
return vec2(float(i - 2 * (i / 2)) * 0.5, float(i / 2) * 0.5) + 0.5 * lvpos.xy;
}
float readShadowMapDepth(vec2 uv, sampler2D _depthTex) {
return rgba2float(texture2D(_depthTex, uv));
}
float posIsInShadow(vec2 uv, vec3 lvpos, sampler2D _depthTex) {
return readShadowMapDepth(uv, _depthTex) < lvpos.z ? 1.0 : 0.0;
}
float filterShadow(vec2 uv, vec3 lvpos, float halfPixelSize, sampler2D _depthTex) {
float texSize = 0.5 / halfPixelSize;
vec2 st = fract((vec2(halfPixelSize) + uv) * texSize);
float s00 = posIsInShadow(uv + vec2(-halfPixelSize, -halfPixelSize), lvpos, _depthTex);
float s10 = posIsInShadow(uv + vec2(halfPixelSize, -halfPixelSize), lvpos, _depthTex);
float s11 = posIsInShadow(uv + vec2(halfPixelSize, halfPixelSize), lvpos, _depthTex);
float s01 = posIsInShadow(uv + vec2(-halfPixelSize, halfPixelSize), lvpos, _depthTex);
return mix(mix(s00, s10, st.x), mix(s01, s11, st.x), st.y);
}
float readShadowMap(const in vec3 _vpos, float _linearDepth) {
mat4 mat;
int i = chooseCascade(_linearDepth, mat);
if (i >= numCascades) { return 0.0; }
vec3 lvpos = lightSpacePosition(_vpos, mat);
if (lvpos.z >= 1.0) { return 0.0; }
if (lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) { return 0.0; }
vec2 uv = cascadeCoordinates(i, lvpos);
return filterShadow(uv, lvpos, depthHalfPixelSz, shadowMapTex);
}`)}function ygt(e){e.fragment.code.add(S`float normals2FoamIntensity(vec3 n, float waveStrength){
float normalizationFactor =  max(0.015, waveStrength);
return max((n.x + n.y)*0.3303545/normalizationFactor + 0.3303545, 0.0);
}`)}function vgt(e){e.fragment.code.add(S`vec3 foamIntensity2FoamColor(float foamIntensityExternal, float foamPixelIntensity, vec3 skyZenitColor, float dayMod){
return foamIntensityExternal * (0.075 * skyZenitColor * pow(foamPixelIntensity, 4.) +  50.* pow(foamPixelIntensity, 23.0)) * dayMod;
}`)}function _gt(e){const t=e.fragment.code;t.add(S`vec3 evaluateDiffuseIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float NdotNG)
{
return ((1.0 - NdotNG) * ambientGround + (1.0 + NdotNG) * ambientSky) * 0.5;
}`),t.add(S`float integratedRadiance(float cosTheta2, float roughness)
{
return (cosTheta2 - 1.0) / (cosTheta2 * (1.0 - roughness * roughness) - 1.0);
}`),t.add(S`vec3 evaluateSpecularIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float RdotNG, float roughness)
{
float cosTheta2 = 1.0 - RdotNG * RdotNG;
float intRadTheta = integratedRadiance(cosTheta2, roughness);
float ground = RdotNG < 0.0 ? 1.0 - intRadTheta : 1.0 + intRadTheta;
float sky = 2.0 - ground;
return (ground * ambientGround + sky * ambientSky) * 0.5;
}`)}function QB(e,t){const r=e.fragment.code;e.include(pB),t.pbrMode===Pt.Water||t.pbrMode===Pt.WaterOnIntegratedMesh?(r.add(S`
    struct PBRShadingWater
    {
        float NdotL;   // cos angle between normal and light direction
        float NdotV;   // cos angle between normal and view direction
        float NdotH;   // cos angle between normal and half vector
        float VdotH;   // cos angle between view direction and half vector
        float LdotH;   // cos angle between light direction and half vector
        float VdotN;   // cos angle between view direction and normal vector
    };

    float dtrExponent = ${t.useCustomDTRExponentForWater?"2.2":"2.0"};
    `),r.add(S`vec3 fresnelReflection(float angle, vec3 f0, float f90) {
return f0 + (f90 - f0) * pow(1.0 - angle, 5.0);
}`),r.add(S`float normalDistributionWater(float NdotH, float roughness)
{
float r2 = roughness * roughness;
float NdotH2 = NdotH * NdotH;
float denom = pow((NdotH2 * (r2 - 1.0) + 1.0), dtrExponent) * PI;
return r2 / denom;
}`),r.add(S`float geometricOcclusionKelemen(float LoH)
{
return 0.25 / (LoH * LoH);
}`),r.add(S`vec3 brdfSpecularWater(in PBRShadingWater props, float roughness, vec3 F0, float F0Max)
{
vec3  F = fresnelReflection(props.VdotH, F0, F0Max);
float dSun = normalDistributionWater(props.NdotH, roughness);
float V = geometricOcclusionKelemen(props.LdotH);
float diffusionSunHaze = mix(roughness + 0.045, roughness + 0.385, 1.0 - props.VdotH);
float strengthSunHaze  = 1.2;
float dSunHaze = normalDistributionWater(props.NdotH, diffusionSunHaze)*strengthSunHaze;
return ((dSun + dSunHaze) * V) * F;
}
vec3 tonemapACES(const vec3 x) {
return (x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14);
}`)):t.pbrMode!==Pt.Normal&&t.pbrMode!==Pt.Schematic||(e.include(_gt),r.add(S`struct PBRShadingInfo
{
float NdotL;
float NdotV;
float NdotH;
float VdotH;
float LdotH;
float NdotNG;
float RdotNG;
float NdotAmbDir;
float NdotH_Horizon;
vec3 skyRadianceToSurface;
vec3 groundRadianceToSurface;
vec3 skyIrradianceToSurface;
vec3 groundIrradianceToSurface;
float averageAmbientRadiance;
float ssao;
vec3 albedoLinear;
vec3 f0;
vec3 f90;
vec3 diffuseColor;
float metalness;
float roughness;
};`),r.add(S`float normalDistribution(float NdotH, float roughness)
{
float a = NdotH * roughness;
float b = roughness / (1.0 - NdotH * NdotH + a * a);
return b * b * INV_PI;
}`),r.add(S`const vec4 c0 = vec4(-1.0, -0.0275, -0.572,  0.022);
const vec4 c1 = vec4( 1.0,  0.0425,  1.040, -0.040);
const vec2 c2 = vec2(-1.04, 1.04);
vec2 prefilteredDFGAnalytical(float roughness, float NdotV) {
vec4 r = roughness * c0 + c1;
float a004 = min(r.x * r.x, exp2(-9.28 * NdotV)) * r.x + r.y;
return c2 * a004 + r.zw;
}`),r.add(S`vec3 evaluateEnvironmentIllumination(PBRShadingInfo inputs) {
vec3 indirectDiffuse = evaluateDiffuseIlluminationHemisphere(inputs.groundIrradianceToSurface, inputs.skyIrradianceToSurface, inputs.NdotNG);
vec3 indirectSpecular = evaluateSpecularIlluminationHemisphere(inputs.groundRadianceToSurface, inputs.skyRadianceToSurface, inputs.RdotNG, inputs.roughness);
vec3 diffuseComponent = inputs.diffuseColor * indirectDiffuse * INV_PI;
vec2 dfg = prefilteredDFGAnalytical(inputs.roughness, inputs.NdotV);
vec3 specularColor = inputs.f0 * dfg.x + inputs.f90 * dfg.y;
vec3 specularComponent = specularColor * indirectSpecular;
return (diffuseComponent + specularComponent);
}`),r.add(S`float gamutMapChanel(float x, vec2 p){
return (x < p.x) ? mix(0.0, p.y, x/p.x) : mix(p.y, 1.0, (x - p.x) / (1.0 - p.x) );
}`),r.add(S`vec3 blackLevelSoftCompression(vec3 inColor, PBRShadingInfo inputs){
vec3 outColor;
vec2 p = vec2(0.02 * (inputs.averageAmbientRadiance), 0.0075 * (inputs.averageAmbientRadiance));
outColor.x = gamutMapChanel(inColor.x, p) ;
outColor.y = gamutMapChanel(inColor.y, p) ;
outColor.z = gamutMapChanel(inColor.z, p) ;
return outColor;
}`))}function kPe(e,t){e.include(QB,t),e.include(hB),e.include(vgt),t.hasCloudsReflections&&e.include(vOe,t),t.hasScreenSpaceReflections&&e.include(uat,t);const r=e.fragment;r.constants.add("fresnelSky","vec3",[.02,1,15]).add("fresnelMaterial","vec2",[.02,.1]).add("roughness","float",.015).add("foamIntensityExternal","float",1.7).add("ssrIntensity","float",.65).add("ssrHeightFadeStart","float",3e5).add("ssrHeightFadeEnd","float",5e5).add("waterDiffusion","float",.92).add("waterSeaColorMod","float",.8).add("correctionViewingPowerFactor","float",.4).add("skyZenitColor","vec3",[.52,.68,.9]).add("skyColor","vec3",[.67,.79,.9]).add("cloudFresnelModifier","vec2",[1.2,.01]),r.code.add(S`PBRShadingWater shadingInfo;
vec3 getSkyGradientColor(in float cosTheta, in vec3 horizon, in vec3 zenit) {
float exponent = pow((1.0 - cosTheta), fresnelSky[2]);
return mix(zenit, horizon, exponent);
}`),r.uniforms.add([new qe("lightingSpecularStrength",(i,s)=>s.lighting.mainLight.specularStrength),new qe("lightingEnvironmentStrength",(i,s)=>s.lighting.mainLight.environmentStrength)]),r.code.add(S`vec3 getSeaColor(in vec3 n, in vec3 v, in vec3 l, vec3 color, in vec3 lightIntensity, in vec3 localUp, in float shadow, float foamIntensity, vec3 viewPosition, vec3 position) {
float reflectionHit = 0.0;
float reflectionHitDiffused = 0.0;
vec3 seaWaterColor = linearizeGamma(color);
vec3 h = normalize(l + v);
shadingInfo.NdotL = clamp(dot(n, l), 0.0, 1.0);
shadingInfo.NdotV = clamp(dot(n, v), 0.001, 1.0);
shadingInfo.VdotN = clamp(dot(v, n), 0.001, 1.0);
shadingInfo.NdotH = clamp(dot(n, h), 0.0, 1.0);
shadingInfo.VdotH = clamp(dot(v, h), 0.0, 1.0);
shadingInfo.LdotH = clamp(dot(l, h), 0.0, 1.0);
float upDotV = max(dot(localUp,v), 0.0);
vec3 skyHorizon = linearizeGamma(skyColor);
vec3 skyZenit = linearizeGamma(skyZenitColor);
vec3 skyColor = getSkyGradientColor(upDotV, skyHorizon, skyZenit );
float upDotL = max(dot(localUp,l),0.0);
float daytimeMod = 0.1 + upDotL * 0.9;
skyColor *= daytimeMod;
float shadowModifier = clamp(shadow, 0.8, 1.0);
vec3 fresnelModifier = fresnelReflection(shadingInfo.VdotN, vec3(fresnelSky[0]), fresnelSky[1]);
vec3 reflSky = lightingEnvironmentStrength * fresnelModifier * skyColor * shadowModifier;
vec3 reflSea = seaWaterColor * mix(skyColor, upDotL * lightIntensity * LIGHT_NORMALIZATION, 2.0 / 3.0) * shadowModifier;
vec3 specular = vec3(0.0);
if(upDotV > 0.0 && upDotL > 0.0) {
vec3 specularSun = brdfSpecularWater(shadingInfo, roughness, vec3(fresnelMaterial[0]), fresnelMaterial[1]);
vec3 incidentLight = lightIntensity * LIGHT_NORMALIZATION * shadow;
specular = lightingSpecularStrength * shadingInfo.NdotL * incidentLight * specularSun;
}
vec3 foam = vec3(0.0);
if(upDotV > 0.0) {
foam = foamIntensity2FoamColor(foamIntensityExternal, foamIntensity, skyZenitColor, daytimeMod);
}
float correctionViewingFactor = pow(max(dot(v, localUp), 0.0), correctionViewingPowerFactor);
vec3 normalCorrectedClouds = mix(localUp, n, correctionViewingFactor);
vec3 reflectedWorld = normalize(reflect(-v, normalCorrectedClouds));`),t.hasCloudsReflections&&r.code.add(S`vec4 cloudsColor = renderClouds(reflectedWorld, position);
cloudsColor.a = 1.0 - cloudsColor.a;
cloudsColor = pow(cloudsColor, vec4(GAMMA));
cloudsColor *= clamp(fresnelModifier.y*cloudFresnelModifier[0] - cloudFresnelModifier[1], 0.0, 1.0) * clamp((1.0 - totalFadeInOut), 0.0, 1.0);`),t.hasScreenSpaceReflections?r.code.add(S`vec3 viewDir = normalize(viewPosition);
vec4 viewNormalVectorCoordinate = view *vec4(n, 0.0);
vec3 viewNormal = normalize(viewNormalVectorCoordinate.xyz);
vec4 viewUp = view *vec4(localUp, 0.0);
vec3 viewNormalCorrectedSSR = mix(viewUp.xyz, viewNormal, correctionViewingFactor);
vec3 reflected = normalize(reflect(viewDir, viewNormalCorrectedSSR));
vec3 hitCoordinate = screenSpaceIntersection(reflected, viewPosition, viewDir, viewUp.xyz);
vec3 reflectedColor = vec3(0.0);
if (hitCoordinate.z > 0.0)
{
vec2 reprojectedCoordinate = reprojectionCoordinate(hitCoordinate);
vec2 dCoords = smoothstep(0.3, 0.6, abs(vec2(0.5, 0.5) - hitCoordinate.xy));
float heightMod = smoothstep(ssrHeightFadeEnd, ssrHeightFadeStart, -viewPosition.z);
reflectionHit = clamp(1.0 - (1.3*dCoords.y), 0.0, 1.0) * heightMod;
reflectionHitDiffused = waterDiffusion * reflectionHit;
reflectedColor = linearizeGamma(texture2D(lastFrameColorMap, reprojectedCoordinate).xyz)* reflectionHitDiffused * fresnelModifier.y * ssrIntensity;
}
float seaColorMod =  mix(waterSeaColorMod, waterSeaColorMod*0.5, reflectionHitDiffused);
vec3 waterRenderedColor = tonemapACES((1.0 - reflectionHitDiffused) * reflSky + reflectedColor + reflSea * seaColorMod + specular  + foam);`):r.code.add(S`vec3 waterRenderedColor = tonemapACES(reflSky + reflSea * waterSeaColorMod + specular + foam);`),t.hasCloudsReflections?t.hasScreenSpaceReflections?r.code.add(S`return waterRenderedColor * (1.0 - (1.0 - reflectionHit) * cloudsColor.a) + (1.0 - reflectionHit) * cloudsColor.xyz;
}`):r.code.add(S`return waterRenderedColor * (1.0 - cloudsColor.a) + cloudsColor.xyz;
}`):r.code.add(S`return waterRenderedColor;
}`)}function Ofe(e){e.fragment.uniforms.add(new Hi("texWaveNormal")),e.fragment.uniforms.add(new Hi("texWavePerturbation")),e.fragment.uniforms.add([new lr("waveParams",t=>Kr(bgt,t.waveStrength,t.waveTextureRepeat,t.flowStrength,t.flowOffset)),new _r("waveDirection",t=>vr(wgt,t.waveDirection[0]*t.waveVelocity,t.waveDirection[1]*t.waveVelocity))]),e.include(ygt),e.fragment.code.add(S`const vec2  FLOW_JUMP = vec2(6.0/25.0, 5.0/24.0);
vec2 textureDenormalized2D(sampler2D _tex, vec2 _uv) {
return 2.0 * texture2D(_tex, _uv).rg - 1.0;
}
float sampleNoiseTexture(vec2 _uv) {
return texture2D(texWavePerturbation, _uv).b;
}
vec3 textureDenormalized3D(sampler2D _tex, vec2 _uv) {
return 2.0 * texture2D(_tex, _uv).rgb - 1.0;
}
float computeProgress(vec2 uv, float time) {
return fract(time);
}
float computeWeight(vec2 uv, float time) {
float progress = computeProgress(uv, time);
return 1.0 - abs(1.0 - 2.0 * progress);
}
vec3 computeUVPerturbedWeigth(sampler2D texFlow, vec2 uv, float time, float phaseOffset) {
float flowStrength = waveParams[2];
float flowOffset = waveParams[3];
vec2 flowVector = textureDenormalized2D(texFlow, uv) * flowStrength;
float progress = computeProgress(uv, time + phaseOffset);
float weight = computeWeight(uv, time + phaseOffset);
vec2 result = uv;
result -= flowVector * (progress + flowOffset);
result += phaseOffset;
result += (time - progress) * FLOW_JUMP;
return vec3(result, weight);
}
const float TIME_NOISE_TEXTURE_REPEAT = 0.3737;
const float TIME_NOISE_STRENGTH = 7.77;
vec3 getWaveLayer(sampler2D _texNormal, sampler2D _dudv, vec2 _uv, vec2 _waveDir, float time) {
float waveStrength = waveParams[0];
vec2 waveMovement = time * -_waveDir;
float timeNoise = sampleNoiseTexture(_uv * TIME_NOISE_TEXTURE_REPEAT) * TIME_NOISE_STRENGTH;
vec3 uv_A = computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.0);
vec3 uv_B = computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.5);
vec3 normal_A = textureDenormalized3D(_texNormal, uv_A.xy) * uv_A.z;
vec3 normal_B = textureDenormalized3D(_texNormal, uv_B.xy) * uv_B.z;
vec3 mixNormal = normalize(normal_A + normal_B);
mixNormal.xy *= waveStrength;
mixNormal.z = sqrt(1.0 - dot(mixNormal.xy, mixNormal.xy));
return mixNormal;
}
vec4 getSurfaceNormalAndFoam(vec2 _uv, float _time) {
float waveTextureRepeat = waveParams[1];
vec3 normal = getWaveLayer(texWaveNormal, texWavePerturbation, _uv * waveTextureRepeat, waveDirection, _time);
float foam  = normals2FoamIntensity(normal, waveParams[0]);
return vec4(normal, foam);
}`)}const bgt=Zt(),wgt=rt();function xgt(e){const t=new Yr,{vertex:r,fragment:i}=t,s=ph(t,e);return t.include(ra),t.attributes.add(O.POSITION,"vec3"),t.attributes.add(O.UV0,"vec2"),r.uniforms.add(new lr("waterColor",n=>n.color)),e.output!==K.Color&&e.output!==K.Alpha||(t.include(Z_,e),t.include(PL,e),t.varyings.add("vuv","vec2"),t.varyings.add("vpos","vec3"),t.varyings.add("vnormal","vec3"),t.varyings.add("vtbnMatrix","mat3"),i.uniforms.add(s),e.hasMultipassTerrain&&t.varyings.add("depth","float"),r.code.add(S`
      void main(void) {
        if (waterColor.a < ${S.float(sa)}) {
          // Discard this vertex
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          return;
        }

        vuv = uv0;
        vpos = position;

        vnormal = getLocalUp(vpos, localOrigin);
        vtbnMatrix = getTBNMatrix(vnormal);

        ${e.hasMultipassTerrain?"depth = (view * vec4(vpos, 1.0)).z;":""}

        gl_Position = transformPosition(proj, view, vpos);
        ${e.output===K.Color?"forwardLinearDepth();":""}
      }
    `)),t.include(Th,e),e.output===K.Alpha&&(t.include(Ss,e),i.uniforms.add(new hl("waterColor")),i.code.add(S`
        void main() {
          discardBySlice(vpos);
          ${e.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}

          gl_FragColor = vec4(waterColor.a);
        }
      `)),e.output===K.Color&&(t.include(vie,{isGround:!1}),t.include(yie,{pbrMode:Pt.Disabled,lightingSphericalHarmonicsOrder:2}),t.include(Ofe),t.include(Ss,e),t.include($T,e),t.include(kPe,e),i.uniforms.add([new hl("waterColor"),new St("lightingMainDirection",(n,o)=>o.lighting.lightingMainDirection),new St("lightingMainIntensity",(n,o)=>o.lighting.mainLight.intensity),new qe("timeElapsed",n=>n.timeElapsed),new I1("view")]),ag(i,e),i.include(wg),i.code.add(S`
      void main() {
        discardBySlice(vpos);
        ${e.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}
        vec3 localUp = vnormal;
        // the created normal is in tangent space
        vec4 tangentNormalFoam = getSurfaceNormalAndFoam(vuv, timeElapsed);

        // we rotate the normal according to the tangent-bitangent-normal-Matrix
        vec3 n = normalize(vtbnMatrix * tangentNormalFoam.xyz);
        vec3 v = -normalize(vpos - cameraPosition);
        float shadow = ${e.receiveShadows?S`1.0 - readShadowMap(vpos, linearDepth)`:"1.0"};
        vec4 vPosView = view*vec4(vpos, 1.0);
        vec4 final = vec4(getSeaColor(n, v, lightingMainDirection, waterColor.rgb, lightingMainIntensity, localUp, shadow, tangentNormalFoam.w, vPosView.xyz, vpos + localOrigin), waterColor.w);

        // gamma correction
        gl_FragColor = delinearizeGamma(final);
        gl_FragColor = highlightSlice(gl_FragColor, vpos);
        ${e.transparencyPassType===yt.Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}
      }
    `)),e.output===K.Normal&&(t.include(Z_,e),t.include(Ofe,e),t.include(Ss,e),t.varyings.add("vpos","vec3"),t.varyings.add("vuv","vec2"),r.code.add(S`
        void main(void) {
          if (waterColor.a < ${S.float(sa)}) {
            // Discard this vertex
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
            return;
          }

          vuv = uv0;
          vpos = position;

          gl_Position = transformPosition(proj, view, vpos);
        }
    `),i.uniforms.add(new qe("timeElapsed",n=>n.timeElapsed)),i.code.add(S`void main() {
discardBySlice(vpos);
vec4 tangentNormalFoam = getSurfaceNormalAndFoam(vuv, timeElapsed);
tangentNormalFoam.xyz = normalize(tangentNormalFoam.xyz);
gl_FragColor = vec4((tangentNormalFoam.xyz + vec3(1.0)) * 0.5, tangentNormalFoam.w);
}`)),e.output===K.Draped&&(t.varyings.add("vpos","vec3"),r.code.add(S`
        void main(void) {
          if (waterColor.a < ${S.float(sa)}) {
            // Discard this vertex
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
            return;
          }

          vpos = position;
          gl_Position = transformPosition(proj, view, vpos);
        }
    `),i.uniforms.add(new hl("waterColor")),i.code.add(S`void main() {
gl_FragColor = waterColor;
}`)),e.output===K.Highlight&&(t.include(D0),t.varyings.add("vpos","vec3"),r.code.add(S`
      void main(void) {
        if (waterColor.a < ${S.float(sa)}) {
          // Discard this vertex
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          return;
        }

        vpos = position;
        gl_Position = transformPosition(proj, view, vpos);
      }
    `),t.include(Ss,e),i.code.add(S`void main() {
discardBySlice(vpos);
outputHighlight();
}`)),t}const Tgt=Object.freeze(Object.defineProperty({__proto__:null,build:xgt},Symbol.toStringTag,{value:"Module"}));class JB extends gi{constructor(t,r,i){super(t,r,i),this._textureRepository=t.waterTextureRepository}initializeConfiguration(t,r){r.spherical=t.viewingMode===Be.Global,r.doublePrecisionRequiresObfuscation=ML(t.rctx)}initializeProgram(t){const r=JB.shader.get().build(this.configuration);return new oi(t.rctx,r,zr)}bindPass(t,r){this.program.bindPass(t,r),this.configuration.output!==K.Color&&this.configuration.output!==K.Normal||this._textureRepository.bind(this.program)}_setPipelineState(t){const r=this.configuration,i=t===yt.NONE,s=t===yt.FrontFace;return Gt({blending:r.output!==K.Normal&&r.output!==K.Highlight&&r.transparent?i?fh:N0(t):null,depthTest:{func:eb(t)},depthWrite:i?r.writeDepth&&cc:DB(t),colorWrite:or,polygonOffset:i||s?null:kB(r.enableOffset)})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}}JB.shader=new ni(Tgt,()=>ie(()=>import("./WaterSurface.glsl.ba159aaf.js"),[],import.meta.url));class yo extends Ca{constructor(){super(...arguments),this.output=K.Color,this.transparencyPassType=yt.NONE,this.spherical=!1,this.receiveShadows=!1,this.hasSlicePlane=!1,this.transparent=!1,this.enableOffset=!0,this.writeDepth=!1,this.hasScreenSpaceReflections=!1,this.doublePrecisionRequiresObfuscation=!1,this.hasCloudsReflections=!1,this.isDraped=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1}}u([q({count:K.COUNT})],yo.prototype,"output",void 0),u([q({count:yt.COUNT})],yo.prototype,"transparencyPassType",void 0),u([q()],yo.prototype,"spherical",void 0),u([q()],yo.prototype,"receiveShadows",void 0),u([q()],yo.prototype,"hasSlicePlane",void 0),u([q()],yo.prototype,"transparent",void 0),u([q()],yo.prototype,"enableOffset",void 0),u([q()],yo.prototype,"writeDepth",void 0),u([q()],yo.prototype,"hasScreenSpaceReflections",void 0),u([q()],yo.prototype,"doublePrecisionRequiresObfuscation",void 0),u([q()],yo.prototype,"hasCloudsReflections",void 0),u([q()],yo.prototype,"isDraped",void 0),u([q()],yo.prototype,"hasMultipassTerrain",void 0),u([q()],yo.prototype,"cullAboveGround",void 0),u([q({constValue:Pt.Water})],yo.prototype,"pbrMode",void 0),u([q({constValue:!0})],yo.prototype,"useCustomDTRExponentForWater",void 0),u([q({constValue:!0})],yo.prototype,"highStepCount",void 0),u([q({constValue:!1})],yo.prototype,"useFillLights",void 0);class Mfe extends J1{_updateShadowState(t){t.shadowMap.enabled!==this._material.parameters.receiveShadows&&this._material.setParameters({receiveShadows:t.shadowMap.enabled})}_updateSSRState(t){t.ssr.enabled!==this._material.parameters.hasScreenSpaceReflections&&this._material.setParameters({hasScreenSpaceReflections:t.ssr.enabled})}_updateCloudsReflectionState(t){const r=b(t.clouds.data);r!==this._material.parameters.hasCloudsReflections&&this._material.setParameters({hasCloudsReflections:r})}ensureResources(t){const r=this._techniqueRepository.constructionContext.waterTextureRepository;return r.resourceState===Nc.NOT_LOADED&&r.loadTextures(t),r.resourceState}beginSlot(t){return this._output===K.Color&&(this._updateShadowState(t),this._updateSSRState(t),this._updateCloudsReflectionState(t)),this.ensureTechnique(JB,t)}}const Sgt=ps().vec3f(O.POSITION),Egt=ps().vec3f(O.POSITION).vec2f(O.UV0),UPe=ps().vec3f(O.POSITION).vec4u8(O.COLOR);class KB{constructor(t){this.vertexBufferLayout=t}allocate(t){return this.vertexBufferLayout.createBuffer(t)}elementCount(t){return t.indices.get(O.POSITION).length}write(t,r,i,s){$B(r,this.vertexBufferLayout,t.transformation,t.invTranspTransformation,i,s)}}class VPe extends Tg{constructor(t){super(t,new zPe),this._techniqueConfig=new yo,this.animation=new zOe}getConfiguration(t,r){return this._techniqueConfig.output=t,this._techniqueConfig.writeDepth=this.parameters.writeDepth,this._techniqueConfig.receiveShadows=this.parameters.receiveShadows,this._techniqueConfig.hasSlicePlane=this.parameters.hasSlicePlane,this._techniqueConfig.transparent=this.parameters.transparent,this._techniqueConfig.hasScreenSpaceReflections=this.parameters.hasScreenSpaceReflections,this._techniqueConfig.hasCloudsReflections=this.parameters.hasCloudsReflections,this._techniqueConfig.isDraped=this.parameters.isDraped,this._techniqueConfig.transparencyPassType=r.transparencyPassType,this._techniqueConfig.enableOffset=r.camera.relativeElevation<NB,this._techniqueConfig.hasMultipassTerrain=r.multipassTerrain.enabled,this._techniqueConfig.cullAboveGround=r.multipassTerrain.cullAboveGround,this._techniqueConfig}update(t){const r=Math.min(t.camera.relativeElevation,t.camera.distance);this.animation.enabled=Math.sqrt(this.parameters.waveTextureRepeat/this.parameters.waveStrength)*r<Cgt;const i=this.animation.advance(t);return this.setParameters({timeElapsed:kK(this.animation.time)*this.parameters.animationSpeed},!1),this.animation.enabled&&i}intersect(t,r,i,s,n,o,a){PB(t,r,s,n,o,void 0,a)}requiresSlot(t,r){switch(IT(r)){case K.Normal:return t===Se.DRAPED_WATER;case K.Color:if(this.parameters.isDraped)return t===Se.DRAPED_MATERIAL;break;case K.Highlight:return t===Se.OPAQUE_MATERIAL||t===Se.DRAPED_MATERIAL}let i=Se.OPAQUE_MATERIAL;return this.parameters.transparent&&(i=this.parameters.writeDepth?Se.TRANSPARENT_MATERIAL:Se.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL),t===i}createGLMaterial(t){if(t.output===K.Color&&this.parameters.isDraped)return t.output=K.Draped,new Mfe(t);switch(t.output){case K.Color:case K.Normal:case K.Highlight:case K.Alpha:return new Mfe(t)}return null}createBufferWriter(){return new KB(Egt)}}class zPe extends IR{constructor(){super(...arguments),this.waveStrength=.06,this.waveTextureRepeat=32,this.waveDirection=Fr(1,0),this.waveVelocity=.05,this.flowStrength=.015,this.flowOffset=-.5,this.animationSpeed=.35,this.timeElapsed=0,this.color=xr(0,0,0,0),this.transparent=!0,this.writeDepth=!0,this.hasSlicePlane=!1,this.isDraped=!1,this.receiveShadows=!0,this.hasScreenSpaceReflections=!1,this.hasCloudsReflections=!1}}const Cgt=35e3;class Pfe{constructor(t){this.first=t.from,this.count=t.to-t.from}}class Q2{constructor(t=0,r=0){this.from=t,this.to=r}}class Agt extends Q2{constructor(t,r,i,s,n,o){super(r,i),this.id=t,this.isVisible=s,this.hasHighlights=n,this.hasOccludees=o}}function Ife(e){return Array.from(e.values()).sort(Rgt)}function Rgt(e,t){return e.from===t.from?e.to-t.to:e.from-t.from}function iF(e,t){if(e.length===0)return void e.push(new Pfe(t));const r=e[e.length-1];if(Ogt(r,t)){const i=t.from-r.first+t.to-t.from;r.count=i}else e.push(new Pfe(t))}function Ogt(e,t){return e.first+e.count>=t.from}class Mgt{constructor(t,r){this._pool=t,this._size=0,this._buffer=t.newBuffer(NQ(r))}dispose(){this._buffer=this._pool.deleteBuffer(this._buffer),this._size=0}release(){this.erase(0,this._size),this.dispose()}get vao(){return this._buffer.vao}get array(){return this._buffer.array}get size(){return this._size}grow(t){this._resize(this._size+t,!0).dispose()}alloc(t){return this._resize(t,!1)}_resize(t,r){let i;const s=Pgt(this._buffer.length,this._size,t);if(this._buffer.length!==s){const o=this._pool.newBuffer(s);r&&(o.array.set(this._buffer.array.subarray(0,Math.min(this._size,s))),o.vao.vertexBuffers.geometry.setSubData(o.array,0,0,o.array.byteLength)),i=this._buffer,this._buffer=o}const n=this._size;return this._size=t,i?{dispose:()=>{i.array.fill(0,0,n),this._pool.deleteBuffer(i)},copy:(o,a,l)=>this._buffer.array.set(i.array.subarray(a,l),o),hasNewBuffer:!0}:{dispose:()=>{},copy:(o,a,l)=>{o!==a&&this._buffer.array.copyWithin(o,a,l)},hasNewBuffer:!1}}erase(t,r){this._buffer.array.fill(0,t,r)}}const $fe=65536;function NQ(e){return Math.ceil(e/$fe)*$fe}function Pgt(e,t,r){return t<=r?e>=r?e:NQ(Math.max(2*e,r)):e<=2*r?e:NQ(r)}class Igt{constructor(t,r,i,s){this.vao=new rn(t,r,{geometry:i},{geometry:cr.createVertex(t,Cr.STATIC_DRAW)}),this.array=new Float32Array(s),this.vao.vertexBuffers.geometry.setSize(this.array.byteLength)}dispose(){this.vao.dispose(!0)}get length(){return this.array.length}}const $gt=p5+1;class Lgt{constructor(t,r,i){this._rctx=t,this._locations=r,this._layout=i,this._cache=t.newCache(`MergedRenderer pool ${Jl()}`,Dgt)}dispose(){this._cache.destroy()}newBuffer(t){const r=t.toString(),i=this._cache.pop(r);if(b(i)){const s=i.pop();return i.length>0&&this._cache.put(r,i,s.array.byteLength*i.length,$gt),s}return new Igt(this._rctx,this._locations,this._layout,t)}deleteBuffer(t){const r=t.array.byteLength,i=t.array.length.toString(),s=this._cache.pop(i);return b(s)?(s.push(t),this._cache.put(i,s,r*s.length,-1)):this._cache.put(i,[t],r,-1),null}}function Dgt(e,t){if(t===Ay.ALL)return void e.forEach(s=>s.dispose());const r=e.pop(),i=e.length*r.array.byteLength;return r.dispose(),i}class BPe{constructor(t,r,i){this._rctx=t,this._materialRepository=r,this._material=i,this.type="MergedRenderer",this._dataByOrigin=new Map,this._renderCommandData=new Xt,this._hasHighlights=!1,this._hasOccludees=!1,this._glMaterials=new bPe(this._material,this._materialRepository),this._bufferWriter=i.createBufferWriter(),this._bufferPool=new Lgt(t,i.vertexAttributeLocations,du(this._bufferWriter.vertexBufferLayout))}dispose(){this._glMaterials.destroy(),this._dataByOrigin.forEach(t=>t.buffer.dispose()),this._dataByOrigin.clear(),this._bufferPool.dispose()}get isEmpty(){return this._dataByOrigin.size===0}get hasHighlights(){return this._hasHighlights}get hasOccludees(){return this._hasOccludees}get hasWater(){return!this.isEmpty&&this._material instanceof VPe}get rendersOccluded(){return!this.isEmpty&&this._material.renderOccluded!==Fi.Occlude}modify(t){this._updateGeometries(t.updates),this._addAndRemoveGeometries(t.adds,t.removes),this._updateRenderCommands()}_addAndRemoveGeometries(t,r){const i=this._bufferWriter,s=i.vertexBufferLayout.stride/4,n=this._dataByOrigin,o=Fgt(t,r);o.forEach((a,l)=>{o.delete(l);const c=a.toAdd.reduce((_,T)=>_+i.elementCount(T.data),0);let h=n.get(l);if(h==null)ft(a.toRemove.length===0),h=new Ugt(a.origin,new Mgt(this._bufferPool,c*s)),n.set(l,h);else if(a.toAdd.length===0&&h.instances.size===a.toRemove.length)return h.buffer.dispose(),void n.delete(l);let p=0;h.instances.forEach(_=>p+=_.to-_.from);const f=a.toRemove.reduce((_,T)=>_+i.elementCount(T.data),0),m=h.buffer.size,g=(p+c-f)*s,v=zgt;if(g<m/2?this._removeAndRebuild(h,a.toRemove,s,g,v):a.toRemove.length>0&&this._remove(h,a.toRemove,s,v),a.toAdd.length>0){const _=Bgt;NOe(_,-a.origin[0],-a.origin[1],-a.origin[2]),this._add(h,a.toAdd,s,_,v)}const w=h.buffer.vao.vertexBuffers.geometry;Nfe(v),v.forAll(({from:_,to:T})=>{if(_<T){const x=h.buffer.array,E=4,C=_*E,A=T*E;w.setSubData(x,C,C,A)}}),v.clear(),h.drawCommandsDirty=!0})}_updateGeometries(t){const r=this._bufferWriter,i=r.vertexBufferLayout.stride/4;for(const s of t){const n=s.renderGeometry,o=this._dataByOrigin.get(n.origin.id),a=o&&o.instances.get(n.id);if(!a)return;const l=s.updateType;if(l&sr.State.VISIBILITIES&&(a.isVisible=n.instanceParameters.visible),l&(sr.State.HIGHLIGHTS|sr.State.VISIBILITIES)){const c=n.instanceParameters.visible;a.hasHighlights=!!n.instanceParameters.highlights&&c}if(l&sr.State.OCCLUDEES&&(a.hasOccludees=!!n.instanceParameters.occludees),l&(sr.State.VERTEXATTRS|sr.State.TRANSFORMATION)){const{array:c,vao:h}=o.buffer;uct(n,nj,OO),r.write({transformation:nj,invTranspTransformation:OO},n.data,r.vertexBufferLayout.createView(c.buffer),a.from),ft(a.from+r.elementCount(n.data)===a.to,"material VBO layout has changed"),h.vertexBuffers.geometry.setSubData(c,a.from*i*4,a.from*i*4,a.to*i*4)}o.drawCommandsDirty=!0}}_updateRenderCommands(){this._hasHighlights=!1,this._hasOccludees=!1,this._dataByOrigin.forEach(r=>{r.hasHiddenInstances=!1,r.hasHighlights=!1,r.hasOccludees=!1,yn(r.instances,i=>(i.isVisible?(i.hasHighlights&&(this._hasHighlights=!0,r.hasHighlights=!0),i.hasOccludees&&(this._hasOccludees=!0,r.hasOccludees=!0)):r.hasHiddenInstances=!0,r.hasHiddenInstances&&r.hasHighlights&&r.hasOccludees))});const t=r=>{if(r.drawCommandsDefault=null,r.drawCommandsHighlight=null,r.drawCommandsOccludees=null,r.drawCommandsShadowHighlightRest=null,r.instances.size===0)return;if(!Dfe(r)){const s=this._bufferWriter.vertexBufferLayout.stride,n=4*r.buffer.size/s;return void(r.drawCommandsDefault=[{first:0,count:n}])}const i=Ife(r.instances);r.drawCommandsDefault=[],r.drawCommandsHighlight=[],r.drawCommandsOccludees=[],r.drawCommandsShadowHighlightRest=[];for(const s of i)s.isVisible&&(s.hasOccludees?iF(r.drawCommandsOccludees,s):iF(r.drawCommandsDefault,s),s.hasHighlights?iF(r.drawCommandsHighlight,s):iF(r.drawCommandsShadowHighlightRest,s))};this._dataByOrigin.forEach(r=>{r.drawCommandsDirty&&(t(r),r.drawCommandsDirty=!1)})}updateAnimation(t){return this._material.update(t)}requiresSlot(t,r){return t==null||this._material.requiresSlot(t,r)}render(t,r){if(!this.requiresSlot(r.slot,t))return!1;const i=t===je.MATERIAL_HIGHLIGHT||t===je.MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT;if(i&&!this._hasHighlights)return!1;const s=t===je.MATERIAL_DEPTH_SHADOWMAP_DEFAULT,n=!(i||s);if(this._dataByOrigin.forEach(c=>{if(i&&!c.hasHighlights)return;const h=(i?c.drawCommandsHighlight:s&&Dfe(c)?c.drawCommandsShadowHighlightRest:c.drawCommandsDefault)||null,p=n&&c.drawCommandsOccludees||null;(b(h)||b(p))&&this._renderCommandData.push(new Vgt(c.origin,c.buffer,h,p))}),this._renderCommandData.length===0)return!1;const o=this._rctx,a=this._glMaterials.load(o,t);if(R(a))return this._renderCommandData.clear(),!1;const l=a.beginSlot(r);return o.bindTechnique(l,this._material.parameters,r,!1),this._renderCommandData.forAll(c=>{l.bindDraw(c,r);const{buffer:h,renderCommands:p,occludeeCommands:f}=c;l.ensureAttributeLocations(h.vao),o.bindVAO(h.vao);const m=l.primitiveType;b(p)&&this._renderCommands(o,m,p),b(f)&&(l.bindPipelineState(o,r.slot,!0),this._renderCommands(o,m,f),l.bindPipelineState(o,r.slot,!1))}),this._renderCommandData.clear(),!0}_renderCommands(t,r,i){for(let s=0;s<i.length;s++)t.drawArrays(r,i[s].first,i[s].count)}_removeAndRebuild(t,r,i,s,n){for(const h of r)t.instances.delete(h.id);const o=Ife(t.instances);t.instances.clear();const a=t.buffer.size,l=t.buffer.alloc(s);let c=0;for(const h of o){const p=h.from*i,f=h.to*i;l.copy(c,p,f),h.from=c/i,c+=f-p,h.to=c/i,t.instances.set(h.id,h)}n.push(new Q2(0,l.hasNewBuffer?t.buffer.array.length:a)),l.dispose(),t.buffer.erase(c,n.back().to),t.holes.clear()}_remove(t,r,i,s){for(const n of r){const o=n.id,a=t.instances.get(o),l=a.from*i,c=a.to*i;t.buffer.erase(l,c),t.holes.push(new Q2(a.from,a.to)),t.instances.delete(o),s.push(new Q2(l,c))}Nfe(t.holes)}_add(t,r,i,s,n){if(r.length===0)return;const o=this._bufferWriter;let a=o.vertexBufferLayout.createView(t.buffer.array.buffer);const l=t.holes.length>0;let c=Number.MAX_SAFE_INTEGER,h=Number.MIN_SAFE_INTEGER;for(const p of r){const f=b(p.transformation)?Yi(nj,s,p.transformation):s;Cs(OO,f);const m=lc(OO,OO),g=o.elementCount(p.data),v=g*i;let w=kgt(t.holes,g);R(w)&&(w=t.buffer.size/i,t.buffer.grow(v),a=o.vertexBufferLayout.createView(t.buffer.array.buffer)),o.write({transformation:f,invTranspTransformation:m},p.data,a,w);const _=p.instanceParameters.visible,T=!!p.instanceParameters.highlights&&_,x=!!p.instanceParameters.occludees,E=new Agt(p.id,w,w+g,_,T,x);ft(t.instances.get(p.id)==null),t.instances.set(p.id,E),l?n.push(new Q2(E.from*i,E.to*i)):(c=Math.min(E.from,c),h=Math.max(E.to,h))}l||n.push(new Q2(c*i,h*i))}get test(){return{material:this._material,glMaterials:this._glMaterials,dataByOrigin:this._dataByOrigin}}}class Ngt{constructor(t){this.origin=t,this.toAdd=new Array,this.toRemove=new Array}}function Fgt(e,t){const r=new Map;for(const i of e)Lfe(r,i,!0);for(const i of t)Lfe(r,i,!1);return r}function Lfe(e,t,r){const i=t.origin;if(R(i))return;let s=e.get(i.id);s==null&&(s=new Ngt(i.vec3),e.set(i.id,s)),r?s.toAdd.push(t):s.toRemove.push(t)}function Dfe(e){return e.hasOccludees||e.hasHighlights||e.hasHiddenInstances}function kgt(e,t){let r;if(!e.some(s=>!(s.to-s.from<t)&&(r=s,!0)))return null;const i=r.from;return r.from+=t,r.from>=r.to&&e.removeUnordered(r),i}function Nfe(e){const t=new Map;e.forAll(i=>t.set(i.from,i));let r=!0;for(;r;)r=!1,e.forEach(i=>{const s=t.get(i.to);s&&(i.to=s.to,t.delete(s.from),e.removeUnordered(s),r=!0)})}class Ugt{constructor(t,r){this.origin=t,this.buffer=r,this.instances=new Map,this.holes=new Xt({deallocator:null}),this.hasHiddenInstances=!1,this.hasHighlights=!1,this.hasOccludees=!1,this.drawCommandsDirty=!1}}class Vgt extends DQ{constructor(t,r,i,s){super(t),this.buffer=r,this.renderCommands=i,this.occludeeCommands=s}}const zgt=new Xt({deallocator:null}),Bgt=Ce(),nj=Ce(),OO=Ce();let xm=class extends xe{constructor(e){super(e),this._pending=new Ggt,this._changes=new OPe,this._materialRenderers=new Map,this._sortedMaterialRenderers=new Xt,this._geometries=new Map,this._hasHighlights=!1,this._hasWater=!1}destroy(){this._changes.prune(),this._materialRenderers.forEach(e=>e.dispose()),this._materialRenderers.clear(),this._sortedMaterialRenderers.clear(),this._geometries.clear()}get updating(){return!this._pending.empty||this._changes.updates.length>0}get rctx(){return this.rendererContext.rctx}get _materialRepository(){return this.rendererContext.materialRepository}get _localOriginFactory(){return this.rendererContext.localOriginFactory}get hasHighlights(){return this._hasHighlights}get hasWater(){return this._hasWater}get rendersOccluded(){return yn(this._materialRenderers,e=>e.rendersOccluded)}get isEmpty(){return!this.updating&&this._materialRenderers.size===0&&this._geometries.size===0}commitChanges(){if(!this.updating)return!1;this._processAddsRemoves();const e=MPe(this._changes);let t=!1,r=!1,i=!1;return e.forEach((s,n)=>{let o=this._materialRenderers.get(n);if(!o&&s.adds.length>0&&(o=new BPe(this.rctx,this._materialRepository,n),this._materialRenderers.set(n,o),t=!0,r=!0,i=!0),!o)return;const a=r||o.hasHighlights,l=i||o.hasWater;o.modify(s),r=r||a!==o.hasHighlights,i=i||l!==o.hasWater,o.isEmpty&&(this._materialRenderers.delete(n),o.dispose(),t=!0)}),this._changes.clear(),t&&this._updateSortedMaterialRenderers(),r&&(this._hasHighlights=yn(this._materialRenderers,s=>s.hasHighlights)),i&&(this._hasWater=yn(this._materialRenderers,s=>s.hasWater)),this.notifyChange("updating"),!0}addGeometries(e,t){if(e.length===0)return;const r=this._validateRenderGeometries(e);for(const s of r)this._geometries.set(s.id,s);const i=this._pending.empty;for(const s of r)this._pending.adds.add(s);i&&this.notifyChange("updating"),t===sr.Geometry.UPDATE&&this._notifyGraphicGeometryChanged(e)}removeGeometries(e,t){const r=this._pending.empty,i=this._pending.adds;for(const s of e)i.has(s)?(this._pending.removed.add(s),i.delete(s)):this._pending.removed.has(s)||this._pending.removes.add(s),this._geometries.delete(s.id);r&&!this._pending.empty&&this.notifyChange("updating"),t===sr.Geometry.UPDATE&&this._notifyGraphicGeometryChanged(e)}modifyGeometries(e,t){const r=this._changes.updates.length===0;for(const i of e){const s=this._changes.updates.pushNew();s.renderGeometry=this._validateRenderGeometry(i),s.updateType=t}switch(r&&this._changes.updates.length>0&&this.notifyChange("updating"),t){case sr.State.TRANSFORMATION:case sr.State.VERTEXATTRS:return this._notifyGraphicGeometryChanged(e);case sr.State.VISIBILITIES:return this._notifyGraphicVisibilityChanged(e)}}updateAnimation(e){let t=!1;return this._sortedMaterialRenderers.forAll(({materialRenderer:r})=>t=r.updateAnimation(e)||t),t}render(e,t){for(let r=0;r<this._sortedMaterialRenderers.length;r++){const i=this._sortedMaterialRenderers.data[r];i.material.shouldRender(e)&&i.materialRenderer.render(e.pass,t)}}intersect(e,t,r,i,s){return this._geometries.forEach(n=>{if(i&&!i(n))return;this._intersectRenderGeometry(n,r,t,0,e,s);const o=this.rendererContext.longitudeCyclical;o&&(n.boundingSphere[0]-n.boundingSphere[3]<o.min&&this._intersectRenderGeometry(n,r,t,o.range,e,s),n.boundingSphere[0]+n.boundingSphere[3]>o.max&&this._intersectRenderGeometry(n,r,t,-o.range,e,s)),s++}),s}_updateSortedMaterialRenderers(){this._sortedMaterialRenderers.clear();let e=0;this._materialRenderers.forEach((t,r)=>{r.insertOrder=e++,this._sortedMaterialRenderers.push({material:r,materialRenderer:t})}),this._sortedMaterialRenderers.sort((t,r)=>{const i=r.material.renderPriority-t.material.renderPriority;return i!==0?i:t.material.insertOrder-r.material.insertOrder})}_processAddsRemoves(){this._changes.adds.clear(),this._changes.removes.clear(),this._changes.adds.pushArray(Array.from(this._pending.adds)),this._changes.removes.pushArray(Array.from(this._pending.removes));for(let e=0;e<this._changes.updates.length;){const t=this._changes.updates.data[e];this._pending.has(t.renderGeometry)?this._changes.updates.removeUnorderedIndex(e):e++}this._pending.clear()}_intersectRenderGeometry(e,t,r,i,s,n){if(!e.instanceParameters.visible)return;let o=0;b(e.transformation)&&(i+=e.transformation[12],o=e.transformation[13]),sF[0]=r[0]-i,sF[1]=r[1]-o,sF[2]=1,nF[0]=r[0]-i,nF[1]=r[1]-o,nF[2]=0,e.screenToWorldRatio=this.rendererContext.screenToWorldRatio,e.material.intersect(e,null,e.getShaderTransformation(),s,sF,nF,(a,l,c)=>{jgt(t,c,e.material.renderPriority,n,s,e.layerUid,e.graphicUid)},e.calculateShaderTransformation,t)}_notifyGraphicGeometryChanged(e){if(R(this.drapeSource.notifyGraphicGeometryChanged))return;let t;for(const r of e){const i=r.graphicUid;b(i)&&i!==t&&(this.drapeSource.notifyGraphicGeometryChanged(i),t=i)}}_notifyGraphicVisibilityChanged(e){if(R(this.drapeSource.notifyGraphicVisibilityChanged))return;let t;for(const r of e){const i=r.graphicUid;b(i)&&i!==t&&(this.drapeSource.notifyGraphicVisibilityChanged(i),t=i)}}_validateRenderGeometries(e){for(const t of e)this._validateRenderGeometry(t);return e}_validateRenderGeometry(e){return R(e.origin)&&(e.origin=this._localOriginFactory.getOrigin(e.boundingSphere)),e}get test(){return{sortedMaterialRenderers:this._sortedMaterialRenderers}}};u([d()],xm.prototype,"drapeSource",void 0),u([d()],xm.prototype,"updating",null),u([d()],xm.prototype,"rctx",null),u([d()],xm.prototype,"rendererContext",void 0),u([d()],xm.prototype,"_materialRepository",null),u([d()],xm.prototype,"_localOriginFactory",null),xm=u([$("esri.views.3d.webgl-engine.lib.SortedRenderGeometryRenderer")],xm);class Ggt{constructor(){this.adds=new Set,this.removes=new Set,this.removed=new Set}get empty(){return this.adds.size===0&&this.removes.size===0&&this.removed.size===0}has(t){return this.adds.has(t)||this.removes.has(t)||this.removed.has(t)}clear(){this.adds.clear(),this.removes.clear(),this.removed.clear()}}function jgt(e,t,r,i,s,n,o){const a={layerUid:n,graphicUid:o,triangleNr:t},l=c=>{c.set(qi.OVERLAY,a,e.dist,e.normal,e.transformation,r,i)};if((s.results.min.drapedLayerOrder==null||r>=s.results.min.drapedLayerOrder)&&(s.results.min.dist==null||s.results.ground.dist<=s.results.min.dist)&&l(s.results.min),s.options.store!==$o.MIN&&(s.results.max.drapedLayerOrder==null||r<s.results.max.drapedLayerOrder)&&(s.results.max.dist==null||s.results.ground.dist>s.results.max.dist)&&l(s.results.max),s.options.store===$o.ALL){const c=Die(s.ray);l(c),s.results.all.push(c)}}const sF=M(),nF=M();function e8(e){e.fragment.uniforms.add(new lr("projInfo",(t,r)=>Hgt(r))),e.fragment.uniforms.add(new _r("zScale",(t,r)=>GPe(r))),e.fragment.code.add(S`vec3 reconstructPosition(vec2 fragCoord, float depth) {
return vec3((fragCoord * projInfo.xy + projInfo.zw) * (zScale.x * depth + zScale.y), depth);
}`)}function Hgt(e){const t=e.camera.projectionMatrix;return t[11]===0?Kr(Ffe,2/(e.camera.fullWidth*t[0]),2/(e.camera.fullHeight*t[5]),(1+t[12])/t[0],(1+t[13])/t[5]):Kr(Ffe,-2/(e.camera.fullWidth*t[0]),-2/(e.camera.fullHeight*t[5]),(1-t[8])/t[0],(1-t[9])/t[5])}const Ffe=Zt();function GPe(e){return e.camera.projectionMatrix[11]===0?vr(kfe,0,1):vr(kfe,1,0)}const kfe=rt();var H1;(function(e){e[e.SSAO=0]="SSAO",e[e.Blur=1]="Blur",e[e.COUNT=2]="COUNT"})(H1||(H1={}));class jPe extends vl{constructor(){super(...arguments),this.output=H1.SSAO}}u([q({count:H1.COUNT})],jPe.prototype,"output",void 0);const MO={samples:16,filterRadius:4};function qgt(e){const t=new Yr,r=t.fragment;if(t.include(K1),e.output===H1.Blur){const i=(MO.filterRadius+1)/2,s=1/(2*i*i);r.include(xh),r.uniforms.add([new Hi("normalMap"),new Hi("depthMap"),new Hi("tex"),new Zy("blurSize"),new kr("projScale"),new _r("nearFar",(n,o)=>o.camera.nearFar)]),r.code.add(S`
      void blurFunction(vec2 uv, float r, float center_d, float sharpness, inout float wTotal, inout float bTotal) {
        float c = texture2D(tex, uv).r;
        float d = linearDepthFromTexture(depthMap, uv, nearFar);

        float ddiff = d - center_d;

        float w = exp(-r * r * ${S.float(s)} - ddiff * ddiff * sharpness);
        wTotal += w;
        bTotal += w * c;
      }
    `),r.code.add(S`
      void main(void) {
        float b = 0.0;
        float w_total = 0.0;

        float center_d = linearDepthFromTexture(depthMap, uv, nearFar);

        float sharpness = -0.05 * projScale/center_d;
        for (int r = -${S.int(MO.filterRadius)}; r <= ${S.int(MO.filterRadius)}; ++r) {
          float rf = float(r);
          vec2 uvOffset = uv + rf * blurSize;
          blurFunction(uvOffset, rf, center_d, sharpness, w_total, b);
        }

        gl_FragColor = vec4(b / w_total);
      }
    `)}return e.output===H1.SSAO&&(r.include(xh),t.include(e8),r.uniforms.add(new Hi("normalMap")),r.uniforms.add(new Hi("depthMap")),r.uniforms.add(new Hi("rnm")),r.uniforms.add(new kr("intensity")),r.uniforms.add(new kr("projScale")),r.uniforms.add(new kr("radius")),r.uniforms.add(new _r("nearFar",(i,s)=>s.camera.nearFar)),r.uniforms.add(new Zy("screenSize")),r.uniforms.add(new Zy("rnmScale")),r.code.add(S`vec3 sphere[16];
void fillSphere() {
sphere[0] = vec3(0.186937, 0.0, 0.0);
sphere[1] = vec3(0.700542, 0.0, 0.0);
sphere[2] = vec3(-0.864858, -0.481795, -0.111713);
sphere[3] = vec3(-0.624773, 0.102853, -0.730153);
sphere[4] = vec3(-0.387172, 0.260319, 0.007229);
sphere[5] = vec3(-0.222367, -0.642631, -0.707697);
sphere[6] = vec3(-0.01336, -0.014956, 0.169662);
sphere[7] = vec3(0.122575, 0.1544, -0.456944);
sphere[8] = vec3(-0.177141, 0.85997, -0.42346);
sphere[9] = vec3(-0.131631, 0.814545, 0.524355);
sphere[10] = vec3(-0.779469, 0.007991, 0.624833);
sphere[11] = vec3(0.308092, 0.209288,0.35969);
sphere[12] = vec3(0.359331, -0.184533, -0.377458);
sphere[13] = vec3(0.192633, -0.482999, -0.065284);
sphere[14] = vec3(0.233538, 0.293706, -0.055139);
sphere[15] = vec3(0.417709, -0.386701, 0.442449);
}
float fallOffFunction(float vv, float vn, float bias) {
float f = max(radius * radius - vv, 0.0);
return f * f * f * max(vn-bias, 0.0);
}`),r.code.add(S`float aoValueFromPositionsAndNormal(vec3 C, vec3 n_C, vec3 Q) {
vec3 v = Q - C;
float vv = dot(v, v);
float vn = dot(normalize(v), n_C);
return fallOffFunction(vv, vn, 0.1);
}`),t.fragment.uniforms.add(new _r("zScale",(i,s)=>GPe(s))),r.code.add(S`
      void main(void) {
        fillSphere();
        vec3 fres = normalize((texture2D(rnm, uv * rnmScale).xyz * 2.0) - vec3(1.0));
        float currentPixelDepth = linearDepthFromTexture(depthMap, uv, nearFar);

        if (-currentPixelDepth>nearFar.y || -currentPixelDepth<nearFar.x) {
          gl_FragColor = vec4(0.0);
          return;
        }

        vec3 currentPixelPos = reconstructPosition(gl_FragCoord.xy,currentPixelDepth);

        // get the normal of current fragment
        vec4 norm4 = texture2D(normalMap, uv);
        vec3 norm = vec3(-1.0) + 2.0 * norm4.xyz;
        bool isTerrain = norm4.w<0.5;

        float sum = .0;
        vec3 tapPixelPos;

        // note: the factor 2.0 should not be necessary, but makes ssao much nicer.
        // bug or deviation from CE somewhere else?
        float ps = projScale/(2.0 * currentPixelPos.z * zScale.x + zScale.y);

        for(int i = 0; i < ${S.int(MO.samples)}; ++i) {
          vec2 unitOffset = reflect(sphere[i], fres).xy;
          vec2 offset = vec2(-unitOffset * radius * ps);

          //don't use current or very nearby samples
          if ( abs(offset.x)<2.0 || abs(offset.y)<2.0) continue;

          vec2 tc = vec2(gl_FragCoord.xy + offset);
          if (tc.x < 0.0 || tc.y < 0.0 || tc.x > screenSize.x || tc.y > screenSize.y) continue;
          vec2 tcTap = tc / screenSize;
          float occluderFragmentDepth = linearDepthFromTexture(depthMap, tcTap, nearFar);

          if (isTerrain) {
            bool isTerrainTap = texture2D(normalMap, tcTap).w<0.5;
            if (isTerrainTap) {
              continue;
            }
          }

          tapPixelPos = reconstructPosition(tc, occluderFragmentDepth);

          sum+= aoValueFromPositionsAndNormal(currentPixelPos, norm, tapPixelPos);
        }

        // output the result
        float A = max(1.0-sum*intensity/float(${S.int(MO.samples)}),0.0);

        // Anti-tone map to reduce contrast and drag dark region farther: (x^0.2 + 1.2 * x^4)/2.2
        A = (pow(A, 0.2) + 1.2 * A*A*A*A) / 2.2;
        gl_FragColor = vec4(A);
      }
    `)),t}const Wgt=Object.freeze(Object.defineProperty({__proto__:null,build:qgt},Symbol.toStringTag,{value:"Module"}));class u$ extends gi{initializeProgram(t){const r=u$.shader.get().build(this.configuration);return new oi(t.rctx,r,zr)}initializePipeline(){return Gt({colorWrite:or})}}u$.shader=new ni(Wgt,()=>ie(()=>import("./SSAO.glsl.3052be4d.js"),[],import.meta.url));class HPe{constructor(t,r,i){this._techniqueRep=t,this._rctx=r,this._requestRender=i,this._enabled=!1,this._ssaoTechniqueConfig=new jPe,this.quadVAO=null,this._blurSizePx=2,this._attenuation=.5}dispose(){this.quadVAO=Ye(this.quadVAO)}disposeOffscreenBuffers(){mn(this._ssaoFBO,t=>t.resize(0,0)),mn(this._blur0FBO,t=>t.resize(0,0)),mn(this._blur1FBO,t=>t.resize(0,0))}set enabled(t){t?this._enable():this._disable()}get enabled(){return this._enabled}get ready(){return this.enabled&&b(this._noiseTexture)&&b(this._ssaoFBO)&&b(this._blur0FBO)&&b(this._blur1FBO)}get colorTexture(){return b(this._blur1FBO)?this._blur1FBO.colorTexture:null}get width(){return b(this._ssaoFBO)?this._ssaoFBO.width:-1}get height(){return b(this._ssaoFBO)?this._ssaoFBO.height:-1}computeSSAO(t,r,i){if(!this.enabled||R(r)||R(i)||R(this._noiseTexture)||R(this._ssaoFBO)||R(this._blur0FBO)||R(this._blur1FBO))return;const s=this._rctx,n=t.camera,o=n.fullViewport,a=o[2],l=o[3],c=a/this._blurSizePx,h=l/this._blurSizePx;this._ssaoFBO.resize(a,l),this._blur0FBO.resize(c,h),this._blur1FBO.resize(c,h);const p=1,f=1,m=a*p,g=l*f;s.bindFramebuffer(this._ssaoFBO),s.setViewport(0,0,a,l);const v=s.bindTechnique(this._ssaoTechnique,Ufe,t);v.setUniform2f("rnmScale",a/this._noiseTexture.descriptor.width,l/this._noiseTexture.descriptor.height);let w=1/n.computeRenderPixelSizeAtDist(1);v.setUniform1f("projScale",w*p),v.setUniform2f("screenSize",m,g);const _=pi(n.eye,n.center);let T=20*n.computeRenderPixelSizeAtDist(_);T=Math.max(.1,T),v.setUniform1f("radius",T),v.setUniform1f("intensity",4*this._attenuation/T**6),v.bindTexture("rnm",this._noiseTexture),v.bindTexture("normalMap",i),v.bindTexture("depthMap",r),R(this.quadVAO)&&(this.quadVAO=_l(this._rctx)),s.bindVAO(this.quadVAO),s.drawArrays(Lt.TRIANGLE_STRIP,0,ta(this.quadVAO,"geometry"));const x=s.bindTechnique(this._blurTechnique,Ufe,t);x.bindTexture("tex",this._ssaoFBO.colorTexture),x.bindTexture("normalMap",i),x.bindTexture("depthMap",r),s.setViewport(0,0,m/this._blurSizePx,g/this._blurSizePx),s.bindFramebuffer(this._blur0FBO),x.setUniform2f("screenSize",m,g),x.setUniform2f("blurSize",0,this._blurSizePx*p/g),_>5e4&&(w=Math.max(0,w-(_-5e4))),x.setUniform1f("projScale",w),s.drawArrays(Lt.TRIANGLE_STRIP,0,ta(this.quadVAO,"geometry")),x.setUniform2f("blurSize",this._blurSizePx*f/m,0),s.bindFramebuffer(this._blur1FBO),x.bindTexture("tex",this._blur0FBO.colorTexture),s.drawArrays(Lt.TRIANGLE_STRIP,0,ta(this.quadVAO,"geometry")),s.setViewport(o[0],o[1],o[2],o[3])}_selectPrograms(){this._ssaoTechniqueConfig.output=H1.SSAO,this._ssaoTechnique=this._techniqueRep.releaseAndAcquire(u$,this._ssaoTechniqueConfig,this._ssaoTechnique),this._ssaoTechniqueConfig.output=H1.Blur,this._blurTechnique=this._techniqueRep.releaseAndAcquire(u$,this._ssaoTechniqueConfig,this._blurTechnique)}_enable(){this.enabled||(this._enabled=!0,this._loadResources(()=>{this._enabled&&this._initialize()}))}_loadResources(t){this._data?t():ie(()=>import("./SSAOHelperData.1dcefdba.js"),[],import.meta.url).then(r=>{this._data=r,t()})}_initialize(){const t={target:mt.TEXTURE_2D,pixelFormat:ze.RGBA,dataType:Ct.UNSIGNED_BYTE,samplingMode:et.LINEAR,wrapMode:xt.CLAMP_TO_EDGE,width:0,height:0},r={colorTarget:us.TEXTURE,depthStencilTarget:Pr.NONE};Sf(this._data.noiseTexture).then(i=>{this._enabled&&(this._ssaoFBO=new Pi(this._rctx,r,t),this._blur0FBO=new Pi(this._rctx,r,t),this._blur1FBO=new Pi(this._rctx,r,t),this._noiseTexture=new nt(this._rctx,{target:mt.TEXTURE_2D,pixelFormat:ze.RGBA,dataType:Ct.UNSIGNED_BYTE,hasMipmap:!0,width:i.width,height:i.height},i),this._requestRender())}),this._selectPrograms()}_disable(){this._enabled=!1,this._noiseTexture=Ye(this._noiseTexture),this._blur1FBO=Ye(this._blur1FBO),this._blur0FBO=Ye(this._blur0FBO),this._ssaoFBO=Ye(this._ssaoFBO)}get gpuMemoryUsage(){return(b(this._blur0FBO)?this._blur0FBO.gpuMemoryUsage:0)+(b(this._blur1FBO)?this._blur1FBO.gpuMemoryUsage:0)+(b(this._ssaoFBO)?this._ssaoFBO.gpuMemoryUsage:0)}get test(){return{ssao:this._ssaoFBO,blur:this._blur1FBO}}}const Ufe=new nn;function Xgt(){const e=new Yr;return e.include(K1),e.fragment.uniforms.add([new Hi("tex"),new hl("uColor")]),e.fragment.code.add(S`void main() {
vec4 texColor = texture2D(tex, uv);
gl_FragColor = texColor * uColor;
}`),e}const Zgt=Object.freeze(Object.defineProperty({__proto__:null,build:Xgt},Symbol.toStringTag,{value:"Module"}));class $L extends gi{initializeProgram(t){const r=$L.shader.get().build();return new oi(t.rctx,r,zr)}initializePipeline(){return this.configuration.hasAlpha?Gt({blending:No(Ae.SRC_ALPHA,Ae.ONE,Ae.ONE_MINUS_SRC_ALPHA,Ae.ONE_MINUS_SRC_ALPHA),colorWrite:or}):Gt({colorWrite:or})}}$L.shader=new ni(Zgt,()=>ie(()=>import("./TextureOnly.glsl.46d21375.js"),[],import.meta.url));class Ase extends vl{constructor(){super(...arguments),this.hasAlpha=!1}}u([q()],Ase.prototype,"hasAlpha",void 0);class qPe{constructor(t){this._rctx=t,this.cache=new Map}dispose(){this.cache.forEach(t=>t.texture=Ye(t.texture)),this.cache.clear()}_acquire(t){if(R(t))return null;const r=this._patternId(t),i=this.cache.get(r);if(i)return i.refCount++,i.bind;const s=t.pixelRatio,{encodedData:n,sdfNormalizer:o,pixels:a,paddedPixels:l}=Ygt(t.pattern,s),c=a/s,h={refCount:1,texture:null,bind:p=>(R(h.texture)&&(h.texture=new nt(this._rctx,{width:l,height:1,internalFormat:ze.RGBA,pixelFormat:ze.RGBA,dataType:Ct.UNSIGNED_BYTE,wrapMode:xt.CLAMP_TO_EDGE},n)),p.bindTexture("stipplePatternTexture",h.texture),{pixelSize:c,sdfNormalizer:o,pixels:a})};return this.cache.set(r,h),h.bind}release(t){if(R(t))return;const r=this._patternId(t),i=this.cache.get(r);i&&(i.refCount--,i.refCount===0&&(b(i.texture)&&i.texture.dispose(),this.cache.delete(r)))}swap(t,r){const i=this._acquire(r);return this.release(t),i}_patternId(t){return`${t.pattern.join(",")}-r${t.pixelRatio}`}}function Ygt(e,t){const r=e.map(g=>Math.round(g*t)),i=1/t,s=Math.floor(r.reduce((g,v)=>g+v)),n=r.reduce((g,v)=>Math.max(g,v)),o=(Math.floor(.5*(n-1))+.5)*i,a=[];let l=1;for(const g of r){for(let v=0;v<g;v++){const w=l*(Math.min(v,g-1-v)+.5)*i/o*.5+.5;a.push(w)}l=-l}const c=Math.round(r[0]/2),h=[...a.slice(c),...a.slice(0,c)],p=s+2,f=new Uint8Array(4*p);let m=4;for(const g of h)n$(g,f,m),m+=4;return f.copyWithin(0,m-4,m),f.copyWithin(m,4,8),{encodedData:f,sdfNormalizer:o,paddedPixels:p,pixels:s}}var Gc,Ko;(function(e){e[e.Standard=0]="Standard",e[e.TransparentToHUDVisibility=1]="TransparentToHUDVisibility",e[e.Transparency=2]="Transparency",e[e.OverlayWithTransparency=3]="OverlayWithTransparency",e[e.COUNT=4]="COUNT"})(Gc||(Gc={})),function(e){e[e.None=0]="None",e[e.Alpha=1]="Alpha",e[e.PremultipliedAlpha=2]="PremultipliedAlpha",e[e.COUNT=3]="COUNT"}(Ko||(Ko={}));class ik extends vl{constructor(){super(...arguments),this.function=Gc.Standard,this.alphaMode=Ko.None,this.hasOpacityFactor=!1}}u([q({count:Gc.COUNT})],ik.prototype,"function",void 0),u([q({count:Ko.COUNT})],ik.prototype,"alphaMode",void 0),u([q()],ik.prototype,"hasOpacityFactor",void 0);let Rp=class extends jB(xe){constructor(e){super(e),this._overlays=null,this._overlayRenderTarget=null,this._hasHighlights=!1,this._rendersOccluded=!1,this._hasWater=!1,this._handles=new Dt,this._frameTask=wA,this._drapeSourceRenderers=new Map,this._sortedDrapeSourceRenderersDirty=!1,this._sortedDrapeSourceRenderers=new Xt,this._rctx=null,this._materialRepository=null,this._screenToWorldRatio=1,this._localOriginFactory=null,this.worldToPCSRatio=1,this.events=new ds,this.longitudeCyclical=null}get _bindParameters(){return this._renderContext.bindParameters}get rctx(){return this._rctx}get materialRepository(){return this._materialRepository}get screenToWorldRatio(){return this._screenToWorldRatio}get localOriginFactory(){return this._localOriginFactory}initialize(){const e=this.view._stage.renderView;this._rctx=e.renderingContext;const t=e.waterTextureRepository;this._stippleTextureRepository=new qPe(e.renderingContext),this._shaderTechniqueRepository=new mPe({rctx:this._rctx,viewingMode:Be.Local,stippleTextureRepository:this._stippleTextureRepository,waterTextureRepository:t}),this._renderContext=new RPe(this._rctx,new Cse(this._rctx,this.view.state.viewingMode),new HPe(this._shaderTechniqueRepository,this._rctx,()=>{})),this._handles.add([te(()=>t.updating,()=>this.events.emit("content-changed"),Xs),te(()=>this.spatialReference,r=>this._localOriginFactory=new Ese(r),Xs),rs(()=>this.view.allLayerViews,"after-changes",()=>this._sortedDrapeSourceRenderersDirty=!0)]),this._materialRepository=new gPe(e.textureRepository,this._shaderTechniqueRepository,r=>{(r.renderOccluded&rz)>0!==this._rendersOccluded&&this._updateRendersOccluded(),this.events.emit("content-changed"),this.notifyChange("updating")},()=>this.events.emit("content-changed")),this._bindParameters.slot=Se.DRAPED_MATERIAL,this._bindParameters.highlightDepthTexture=nOe(this._rctx),this._bindParameters.camera=Cx,this._bindParameters.transparencyPassType=yt.NONE,this._bindParameters.lighting.groundLightingFactor=1,this._bindParameters.lighting.globalFactor=0,this._bindParameters.lighting.set([new Eie(Ue(1,1,1))]),this._frameTask=this.view.resourceController.scheduler.registerTask(vt.STAGE,this),this._handles.add(this._frameTask)}dispose(){this._handles.destroy(),this._drapeSourceRenderers.forEach(e=>e.destroy()),this._drapeSourceRenderers.clear(),this._debugTextureTechnique=ti(this._debugTextureTechnique),this._debugPatternTexture=Ye(this._debugPatternTexture),this._bindParameters.highlightDepthTexture=Ye(this._bindParameters.highlightDepthTexture),this._shaderTechniqueRepository=Ye(this._shaderTechniqueRepository),this._temporaryFBO=Ye(this._temporaryFBO),this._quadVAO=Ye(this._quadVAO),this.disposeOverlays()}get updating(){return this._sortedDrapeSourceRenderersDirty||this._frameTask.updating||yn(this._drapeSourceRenderers,e=>e.updating)}get hasOverlays(){return b(this._overlays)&&b(this._overlayRenderTarget)}get gpuMemoryUsage(){return b(this._overlayRenderTarget)?this._overlayRenderTarget.gpuMemoryUsage:0}createGeometryDrapeSourceRenderer(e){return this.createDrapeSourceRenderer(e,xm)}createDrapeSourceRenderer(e,t,r){const i=this._drapeSourceRenderers.get(e);b(i)&&i.destroy();const s=new t({...r,rendererContext:this,drapeSource:e});return this._drapeSourceRenderers.set(e,s),this._sortedDrapeSourceRenderersDirty=!0,"fullOpacity"in e&&this._handles.add(te(()=>e.fullOpacity,()=>this.events.emit("content-changed")),e),s}removeDrapeSourceRenderer(e){if(R(e))return;const t=this._drapeSourceRenderers.get(e);R(t)||(this._sortedDrapeSourceRenderersDirty=!0,this._drapeSourceRenderers.delete(e),this._handles.remove(e),t.destroy())}collectUnusedRenderTargetMemory(e){let t=!1;if(b(this._overlayRenderTarget))for(const r of this._overlayRenderTarget.renderTargets){const i=this.overlays[0].validTargets[r.type]||!this.overlays[1].validTargets[r.type];t=this._overlayRenderTarget.validateUsageForTarget(i,r,e)||t}return t}get overlays(){return _t(this._overlays,[])}ensureDrapeTargets(e){b(this._overlays)&&this._overlays.forEach(t=>{t.hasTargetWithoutRasterImage=I4(e,r=>r.drapeTargetType===IQ.WithoutRasterImage)})}ensureDrapeSources(e){b(this._overlays)&&this._overlays.forEach(t=>{t.hasDrapedFeatureSource=I4(e,r=>r.drapeSourceType===_P.Features),t.hasDrapedRasterSource=I4(e,r=>r.drapeSourceType===_P.RasterImage)})}ensureOverlays(e,t){R(this._overlays)&&(this._overlayRenderTarget=new $mt(this._rctx),this._overlays=[new ofe(Gi.INNER,this._overlayRenderTarget),new ofe(Gi.OUTER,this._overlayRenderTarget)]),this.ensureDrapeTargets(e),this.ensureDrapeSources(t)}disposeOverlays(){this._overlays=null,this._overlayRenderTarget=Ye(this._overlayRenderTarget),this.events.emit("textures-disposed")}get running(){return this.updating}runTask(e,t=()=>!0){this._frameTask.processQueue(e),e.done||this._processDrapeSources(e,t)}_processDrapeSources(e,t){let r=!1;for(const[i,s]of this._drapeSourceRenderers){if(e.done)break;(i.destroyed||t(i))&&s.commitChanges()&&(r=!0,e.madeProgress())}this._updateSortedDrapeSourceRenderers(),r&&(b(this._overlays)&&this._drapeSourceRenderers.size===0&&this.disposeOverlays(),this.notifyChange("updating"),this.events.emit("content-changed"),this._updateHasHighlights(),this._updateRendersOccluded(),this._updateHasWater())}processSyncDrapeSources(){this._processDrapeSources(ER,e=>e.updatePolicy===EA.SYNC)}isEmpty(){if(Xr.OVERLAY_DRAW_DEBUG_TEXTURE)return!1;for(const e of this._drapeSourceRenderers.values())if(!e.isEmpty)return!1;return!0}get hasHighlights(){return this._hasHighlights}get hasWater(){return this._hasWater}get rendersOccluded(){return this._rendersOccluded}updateAnimation(e){let t=!1;return this._drapeSourceRenderers.forEach(r=>t=r.updateAnimation(e)||t),t}updateDrapeSourceOrder(){this._sortedDrapeSourceRenderersDirty=!0}drawTarget(e,t,r){const i=e.canvasGeometries;if(i.numViews===0)return!1;this._screenToWorldRatio=r*e.mapUnitsPerPixel;const s=t.renderPass;if(this.isEmpty()||s===je.MATERIAL_HIGHLIGHT&&!this.hasHighlights||s===je.MATERIAL_NORMAL&&!this.hasWater||!e.hasSomeSizedView())return!1;const n=t.fbo;if(!n.isValid())return!1;const o=2*e.resolution,a=e.resolution;n.resize(o,a);const l=this._rctx;Cx.pixelRatio=e.pixelRatio*r,this._renderContext.pass=s,this._bindParameters.screenToWorldRatio=this._screenToWorldRatio,this._bindParameters.screenToPCSRatio=this._screenToWorldRatio*this.worldToPCSRatio,this._bindParameters.slot=s===je.MATERIAL_NORMAL?Se.DRAPED_WATER:Se.DRAPED_MATERIAL,e.applyViewport(this._rctx),n.bind(l),e.index===Gi.INNER&&(l.setClearColor(0,0,0,0),l.clearSafe(ri.COLOR_BUFFER_BIT));const c=t.type===Ms.ColorNoRasterImage?v_.ExcludeRasterImage:t.type===Ms.Occluded?v_.OccludedOnly:v_.Normal;if(c===v_.OccludedOnly&&(this._renderContext.renderOccludedMask=rz),Xr.OVERLAY_DRAW_DEBUG_TEXTURE&&c!==v_.OccludedOnly)for(let h=0;h<i.numViews;h++)this._setViewParameters(i.extents[h],e,Cx),this._drawDebugTexture(e.resolution,Jgt[e.index]);return this._drapeSourceRenderers.size>0&&this._sortedDrapeSourceRenderers.forAll(({drapeSource:h,renderer:p})=>{if(c===v_.ExcludeRasterImage&&h.drapeSourceType===_P.RasterImage)return;const{fullOpacity:f}=h,m=b(f)&&f<1&&s===je.MATERIAL;m&&(this.bindTemporaryFramebuffer(this._rctx,o,a),l.clearSafe(ri.COLOR_BUFFER_BIT));for(let g=0;g<i.numViews;g++)this._setViewParameters(i.extents[g],e,Cx),p.render(this._renderContext,this._bindParameters);m&&b(this._temporaryFBO)&&(n.bind(l),this.view._stage.renderView.compositingHelper.composite(this._renderContext.bindParameters,this._temporaryFBO.getTexture(),Ko.PremultipliedAlpha,f,Gc.OverlayWithTransparency,e.index))}),l.bindFramebuffer(null),n.generateMipMap(),this._renderContext.resetRenderOccludedMask(),!0}bindTemporaryFramebuffer(e,t,r){R(this._temporaryFBO)&&(this._temporaryFBO=new fPe(e,!1)),this._temporaryFBO.resize(t,r),this._temporaryFBO.bind(e)}async reloadShaders(){await this._shaderTechniqueRepository.reloadAll()}notifyContentChanged(){this.events.emit("content-changed")}intersect(e,t,r,i){var n,o;let s=0;for(const a of this._drapeSourceRenderers.values())s=(o=(n=a.intersect)==null?void 0:n.call(a,e,t,r,i,s))!=null?o:s}_updateSortedDrapeSourceRenderers(){if(!this._sortedDrapeSourceRenderersDirty||(this._sortedDrapeSourceRenderersDirty=!1,this._sortedDrapeSourceRenderers.clear(),this._drapeSourceRenderers.size===0))return;const e=this.view.map.allLayers;this._drapeSourceRenderers.forEach((t,r)=>{const i=e.indexOf(r.layer);this._sortedDrapeSourceRenderers.push(new Qgt(r,t,i<0?1/0:i))}),this._sortedDrapeSourceRenderers.sort((t,r)=>t.index-r.index)}_setViewParameters(e,t,r){r.viewport[0]=r.viewport[1]=0,r.viewport[2]=r.viewport[3]=t.resolution,rte(r.projectionMatrix,0,e[2]-e[0],0,e[3]-e[1],r.near,r.far),b6(r.viewMatrix,[-e[0],-e[1],0]),this._bindParameters.camera=r}_updateHasWater(){const e=yn(this._drapeSourceRenderers,t=>t.hasWater);e!==this._hasWater&&(this._hasWater=e,this.events.emit("has-water",e))}_updateHasHighlights(){const e=yn(this._drapeSourceRenderers,t=>t.hasHighlights);e!==this._hasHighlights&&(this._hasHighlights=e,this.events.emit("has-highlights",e))}_updateRendersOccluded(){const e=yn(this._drapeSourceRenderers,t=>t.rendersOccluded);e!==this._rendersOccluded&&(this._rendersOccluded=e,this.events.emit("renders-occluded",e))}_drawDebugTexture(e,t){this._ensureDebugPatternResources(e,e);const r=this._rctx,i=r.bindTechnique(this._debugTextureTechnique);i.setUniform4f("uColor",t[0],t[1],t[2],1),i.bindTexture("tex",this._debugPatternTexture),r.bindVAO(this._quadVAO),r.drawArrays(Lt.TRIANGLE_STRIP,0,ta(this._quadVAO,"geometry"))}_ensureDebugPatternResources(e,t){if(this._debugPatternTexture)return;const r=new Uint8Array(e*t*4);let i=0;for(let n=0;n<t;n++)for(let o=0;o<e;o++){const a=Math.floor(o/10),l=Math.floor(n/10);a<2||l<2||10*a>e-20||10*l>t-20?(r[i++]=255,r[i++]=255,r[i++]=255,r[i++]=255):(r[i++]=255,r[i++]=255,r[i++]=255,r[i++]=1&a&&1&l?1&o^1&n?0:255:1&a^1&l?0:128)}this._debugPatternTexture=new nt(this._rctx,{target:mt.TEXTURE_2D,pixelFormat:ze.RGBA,dataType:Ct.UNSIGNED_BYTE,samplingMode:et.NEAREST,width:e,height:t},r);const s=new Ase;s.hasAlpha=!0,this._debugTextureTechnique=this._shaderTechniqueRepository.acquire($L,s),this._quadVAO=_l(this._rctx)}get test(){return{drapeSourceRenderers:this._drapeSourceRenderers,getDrapeSourceRenderer:e=>this._drapeSourceRenderers.get(e)}}};var v_;u([d()],Rp.prototype,"_frameTask",void 0),u([d()],Rp.prototype,"_sortedDrapeSourceRenderersDirty",void 0),u([Xo()],Rp.prototype,"_shaderTechniqueRepository",void 0),u([Xo()],Rp.prototype,"_stippleTextureRepository",void 0),u([d({constructOnly:!0})],Rp.prototype,"view",void 0),u([d()],Rp.prototype,"worldToPCSRatio",void 0),u([d()],Rp.prototype,"spatialReference",void 0),u([d({type:Boolean,readOnly:!0})],Rp.prototype,"updating",null),Rp=u([$("esri.views.3d.terrain.OverlayRenderer")],Rp),function(e){e[e.Normal=0]="Normal",e[e.OccludedOnly=1]="OccludedOnly",e[e.ExcludeRasterImage=2]="ExcludeRasterImage"}(v_||(v_={}));class Qgt{constructor(t,r,i){this.drapeSource=t,this.renderer=r,this.index=i}}const Jgt=[[1,.5,.5],[.5,.5,1]],Cx=new ii;Cx.near=1,Cx.far=1e4,Cx.relativeElevation=null;const Rse=-2,rz=Fi.OccludeAndTransparent;function Vfe(e){const t=[[O.POSITION,e.indices]],r=[[O.POSITION,{size:3,data:e.attributeData.position,exclusive:!0}]];return b(e.attributeData.color)&&(r.push([O.COLOR,{size:4,data:e.attributeData.color,exclusive:!0}]),t.push([O.COLOR,new Uint32Array(e.indices.length)])),b(e.attributeData.uvMapSpace)&&(r.push([O.UVMAPSPACE,{size:4,data:e.attributeData.uvMapSpace,exclusive:!0}]),t.push([O.UVMAPSPACE,e.indices])),b(e.attributeData.boundingRect)&&(r.push([O.BOUNDINGRECT,{size:9,data:e.attributeData.boundingRect,exclusive:!0}]),t.push([O.BOUNDINGRECT,e.indices])),b(e.attributeData.mapPosition)&&(r.push([O.MAPPOS,{size:3,data:e.attributeData.mapPosition,exclusive:!0}]),t.push([O.MAPPOS,e.indices])),new Bi(r,t)}function zfe(e){const t=[[O.POSITION,e.indices],[O.UV0,e.indices]],r=[[O.POSITION,{size:3,data:e.attributeData.position,exclusive:!0}],[O.UV0,{size:2,data:e.attributeData.uv0,exclusive:!0}]];return b(e.attributeData.mapPosition)&&(r.push([O.MAPPOS,{size:3,data:e.attributeData.mapPosition,exclusive:!0}]),t.push([O.MAPPOS,e.indices])),new Bi(r,t)}function h$(e){switch(e.type){case"extent":if(e instanceof Kt)return Oa.fromExtent(e);break;case"polygon":return e}return null}function Ose(e,t,r,i){const s=OL(e.rings,e.hasZ,lg.CCW_IS_HOLE),n=new Float64Array(s.position.length),o=J3e(s.position,e.spatialReference,0,n,0,s.position,0,s.position.length/3,t,r,i),a=o!=null;return{position:s.position,mapPosition:n,polygons:ZPe(s.polygons,s.position,n),outlines:XPe(s.outlines,s.position,n),projectionSuccess:a,sampledElevation:o}}function WPe(e,t){const r=OL(e.rings,!1,lg.CCW_IS_HOLE),i=mi(r.position,e.spatialReference,0,r.position,t,0,r.position.length/3);for(let s=2;s<r.position.length;s+=3)r.position[s]=Rse;return{position:r.position,polygons:ZPe(r.polygons,r.position),outlines:XPe(r.outlines,r.position),projectionSuccess:i}}function XPe(e,t,r){const i=new Array;for(const{index:s,count:n}of e){if(n<=1)continue;const o=3*s,a=o+3*n;i.push({index:s,count:n,position:t.subarray(o,a),mapPosition:r?r.subarray(o,a):void 0})}return i}function ZPe(e,t,r){const i=new Array;for(const{index:s,count:n,holeIndices:o,pathLengths:a}of e){if(n<=1)continue;const l=3*s,c=l+3*n,h=o.map(p=>p-s);i.push({index:s,count:n,holeIndices:h,pathLengths:a,position:t.subarray(l,c),mapPosition:r?r.subarray(l,c):void 0})}return i}function YPe(e,t){const r=e.fragment;switch(r.code.add(S`struct ShadingNormalParameters {
vec3 normalView;
vec3 viewDirection;
} shadingParams;`),t.doubleSidedMode){case Zi.None:r.code.add(S`vec3 shadingNormal(ShadingNormalParameters params) {
return normalize(params.normalView);
}`);break;case Zi.View:r.code.add(S`vec3 shadingNormal(ShadingNormalParameters params) {
return dot(params.normalView, params.viewDirection) > 0.0 ? normalize(-params.normalView) : normalize(params.normalView);
}`);break;case Zi.WindingOrder:r.code.add(S`vec3 shadingNormal(ShadingNormalParameters params) {
return gl_FrontFacing ? normalize(params.normalView) : normalize(-params.normalView);
}`);break;default:t.doubleSidedMode;case Zi.COUNT:}}var Zi;(function(e){e[e.None=0]="None",e[e.View=1]="View",e[e.WindingOrder=2]="WindingOrder",e[e.COUNT=3]="COUNT"})(Zi||(Zi={}));function QPe(e){e.vertex.code.add(S`vec4 offsetBackfacingClipPosition(vec4 posClip, vec3 posWorld, vec3 normalWorld, vec3 camPosWorld) {
vec3 camToVert = posWorld - camPosWorld;
bool isBackface = dot(camToVert, normalWorld) > 0.0;
if (isBackface) {
posClip.z += 0.0000003 * posClip.w;
}
return posClip;
}`)}function JPe(e,t){t.instanced&&t.instancedDoublePrecision&&(e.attributes.add(O.MODELORIGINHI,"vec3"),e.attributes.add(O.MODELORIGINLO,"vec3"),e.attributes.add(O.MODEL,"mat3"),e.attributes.add(O.MODELNORMAL,"mat3"));const r=e.vertex;t.instancedDoublePrecision&&(r.include(tz,t),r.uniforms.add(new pl("viewOriginHi",(i,s)=>lct(se(oF,s.camera.viewInverseTransposeMatrix[3],s.camera.viewInverseTransposeMatrix[7],s.camera.viewInverseTransposeMatrix[11]),oF))),r.uniforms.add(new pl("viewOriginLo",(i,s)=>cct(se(oF,s.camera.viewInverseTransposeMatrix[3],s.camera.viewInverseTransposeMatrix[7],s.camera.viewInverseTransposeMatrix[11]),oF)))),r.code.add(S`
    vec3 calculateVPos() {
      ${t.instancedDoublePrecision?"return model * localPosition().xyz;":"return localPosition().xyz;"}
    }
    `),r.code.add(S`
    vec3 subtractOrigin(vec3 _pos) {
      ${t.instancedDoublePrecision?S`
          vec3 originDelta = dpAdd(viewOriginHi, viewOriginLo, -modelOriginHi, -modelOriginLo);
          return _pos - originDelta;`:"return vpos;"}
    }
    `),r.code.add(S`
    vec3 dpNormal(vec4 _normal) {
      ${t.instancedDoublePrecision?"return normalize(modelNormal * _normal.xyz);":"return normalize(_normal.xyz);"}
    }
    `),t.output===K.Normal&&(r.uniforms.add(new Ei("viewNormal",(i,s)=>s.camera.viewInverseTransposeMatrix)),r.code.add(S`
    vec3 dpNormalView(vec4 _normal) {
      ${t.instancedDoublePrecision?"return normalize((viewNormal * vec4(modelNormal * _normal.xyz, 1.0)).xyz);":"return normalize((viewNormal * _normal).xyz);"}
    }
    `)),t.hasVertexTangents&&r.code.add(S`
    vec4 dpTransformVertexTangent(vec4 _tangent) {
      ${t.instancedDoublePrecision?"return vec4(modelNormal * _tangent.xyz, _tangent.w);":"return _tangent;"}

    }
    `)}const oF=M();var $s;function KPe(e){switch(e){case"multiply":default:return $s.Multiply;case"ignore":return $s.Ignore;case"replace":return $s.Replace;case"tint":return $s.Tint}}function eIe(e,t,r){if(R(e)||t===$s.Ignore)return r[0]=255,r[1]=255,r[2]=255,void(r[3]=255);const i=Le(Math.round(e[3]*iz),0,iz),s=i===0||t===$s.Tint?0:t===$s.Replace?Kgt:eyt;r[0]=Le(Math.round(e[0]*DS),0,DS),r[1]=Le(Math.round(e[1]*DS),0,DS),r[2]=Le(Math.round(e[2]*DS),0,DS),r[3]=i+s}(function(e){e[e.Multiply=1]="Multiply",e[e.Ignore=2]="Ignore",e[e.Replace=3]="Replace",e[e.Tint=4]="Tint"})($s||($s={}));const DS=255,iz=85,Kgt=iz,eyt=2*iz;function tIe(e){e.vertex.code.add(S`
    vec4 decodeSymbolColor(vec4 symbolColor, out int colorMixMode) {
      float symbolAlpha = 0.0;

      const float maxTint = 85.0;
      const float maxReplace = 170.0;
      const float scaleAlpha = 3.0;

      if (symbolColor.a > maxReplace) {
        colorMixMode = ${S.int($s.Multiply)};
        symbolAlpha = scaleAlpha * (symbolColor.a - maxReplace);
      } else if (symbolColor.a > maxTint) {
        colorMixMode = ${S.int($s.Replace)};
        symbolAlpha = scaleAlpha * (symbolColor.a - maxTint);
      } else if (symbolColor.a > 0.0) {
        colorMixMode = ${S.int($s.Tint)};
        symbolAlpha = scaleAlpha * symbolColor.a;
      } else {
        colorMixMode = ${S.int($s.Multiply)};
        symbolAlpha = 0.0;
      }

      return vec4(symbolColor.r, symbolColor.g, symbolColor.b, symbolAlpha);
    }
  `)}function rIe(e,t){t.hasSymbolColors?(e.include(tIe),e.attributes.add(O.SYMBOLCOLOR,"vec4"),e.varyings.add("colorMixMode","mediump float"),e.vertex.code.add(S`int symbolColorMixMode;
vec4 getSymbolColor() {
return decodeSymbolColor(symbolColor, symbolColorMixMode) * 0.003921568627451;
}
void forwardColorMixMode() {
colorMixMode = float(symbolColorMixMode) + 0.5;
}`)):(e.fragment.uniforms.add(new IL("colorMixMode",r=>f3e[r.colorMixMode])),e.vertex.code.add(S`vec4 getSymbolColor() { return vec4(1.0); }
void forwardColorMixMode() {}`))}function oS(e,t){t.hasVertexColors?(e.attributes.add(O.COLOR,"vec4"),e.varyings.add("vColor","vec4"),e.vertex.code.add(S`void forwardVertexColor() { vColor = color; }`),e.vertex.code.add(S`void forwardNormalizedVertexColor() { vColor = color * 0.003921568627451; }`)):e.vertex.code.add(S`void forwardVertexColor() {}
void forwardNormalizedVertexColor() {}`)}function tyt(e){e.fragment.code.add(S`
    #define discardOrAdjustAlpha(color) { if (color.a < ${S.float(sa)}) { discard; } }
  `)}class iIe extends ss{constructor(t,r){super(t,"float",Vr.Draw,(i,s,n)=>i.setUniform1f(t,r(s,n)))}}function Xx(e,t){sIe(e,t,new qe("textureAlphaCutoff",r=>r.textureAlphaCutoff))}function ryt(e,t){sIe(e,t,new iIe("textureAlphaCutoff",r=>r.textureAlphaCutoff))}function sIe(e,t,r){const i=e.fragment;switch(t.alphaDiscardMode!==hi.Mask&&t.alphaDiscardMode!==hi.MaskBlend||i.uniforms.add(r),t.alphaDiscardMode){case hi.Blend:return e.include(tyt);case hi.Opaque:i.code.add(S`void discardOrAdjustAlpha(inout vec4 color) {
color.a = 1.0;
}`);break;case hi.Mask:i.code.add(S`#define discardOrAdjustAlpha(color) { if (color.a < textureAlphaCutoff) { discard; } else { color.a = 1.0; } }`);break;case hi.MaskBlend:e.fragment.code.add(S`#define discardOrAdjustAlpha(color) { if (color.a < textureAlphaCutoff) { discard; } }`)}}function nIe(e,t){const r=e.vertex.code,i=e.fragment.code,s=t.hasModelTransformation;t.output!==K.Depth&&t.output!==K.Shadow||(ph(e,t),e.include(ra,{linearDepth:!0,hasModelTransformation:s}),e.include(Xy,t),e.include(_C,t),e.include(tb,t),e.include(Ss,t),e.vertex.uniforms.add(new _r("nearFar",(n,o)=>o.camera.nearFar)),e.varyings.add("depth","float"),t.hasColorTexture&&e.fragment.uniforms.add(new Ht("tex",n=>n.texture)),r.add(S`
      void main(void) {
        vpos = calculateVPos();
        vpos = subtractOrigin(vpos);
        vpos = addVerticalOffset(vpos, localOrigin);
        gl_Position = transformPositionWithDepth(proj, view, ${s?"model,":""} vpos, nearFar, depth);
        forwardTextureCoordinates();
      }
    `),e.include(Xx,t),i.add(S`
      void main(void) {
        discardBySlice(vpos);
        ${t.hasColorTexture?S`
        vec4 texColor = texture2D(tex, vuv0);
        discardOrAdjustAlpha(texColor);`:""}
        outputDepth(depth);
      }
    `)),t.output===K.Normal&&(ph(e,t),e.include(ra,{linearDepth:!1,hasModelTransformation:s}),e.include(WB,t),e.include(ZB,t),e.include(Xy,t),e.include(_C,t),t.hasColorTexture&&e.fragment.uniforms.add(new Ht("tex",n=>n.texture)),e.varyings.add("vPositionView","vec3"),r.add(S`
      void main(void) {
        vpos = calculateVPos();
        vpos = subtractOrigin(vpos);
        ${t.normalType===Ii.Attribute?S`
        vNormalWorld = dpNormalView(vvLocalNormal(normalModel()));`:""}
        vpos = addVerticalOffset(vpos, localOrigin);
        gl_Position = transformPosition(proj, view, ${s?"model,":""} vpos);
        forwardTextureCoordinates();
      }
    `),e.include(Ss,t),e.include(Xx,t),i.add(S`
      void main() {
        discardBySlice(vpos);
        ${t.hasColorTexture?S`
        vec4 texColor = texture2D(tex, vuv0);
        discardOrAdjustAlpha(texColor);`:""}

        ${t.normalType===Ii.ScreenDerivative?S`
            vec3 normal = screenDerivativeNormal(vPositionView);`:S`
            vec3 normal = normalize(vNormalWorld);
            if (gl_FrontFacing == false) normal = -normal;`}
        gl_FragColor = vec4(vec3(0.5) + 0.5 * normal, 1.0);
      }
    `)),t.output===K.Highlight&&(ph(e,t),e.include(ra,{linearDepth:!1,hasModelTransformation:s}),e.include(Xy,t),e.include(_C,t),t.hasColorTexture&&e.fragment.uniforms.add(new Ht("tex",n=>n.texture)),r.add(S`
      void main(void) {
        vpos = calculateVPos();
        vpos = subtractOrigin(vpos);
        vpos = addVerticalOffset(vpos, localOrigin);
        gl_Position = transformPosition(proj, view, ${s?"model,":""} vpos);
        forwardTextureCoordinates();
      }
    `),e.include(Ss,t),e.include(Xx,t),e.include(D0),i.add(S`
      void main() {
        discardBySlice(vpos);
        ${t.hasColorTexture?S`
        vec4 texColor = texture2D(tex, vuv0);
        discardOrAdjustAlpha(texColor);`:""}
        outputHighlight();
      }
    `))}function oIe(e,t){const r=e.fragment;if(t.hasVertexTangents?(e.attributes.add(O.TANGENT,"vec4"),e.varyings.add("vTangent","vec4"),t.doubleSidedMode===Zi.WindingOrder?r.code.add(S`mat3 computeTangentSpace(vec3 normal) {
float tangentHeadedness = gl_FrontFacing ? vTangent.w : -vTangent.w;
vec3 tangent = normalize(gl_FrontFacing ? vTangent.xyz : -vTangent.xyz);
vec3 bitangent = cross(normal, tangent) * tangentHeadedness;
return mat3(tangent, bitangent, normal);
}`):r.code.add(S`mat3 computeTangentSpace(vec3 normal) {
float tangentHeadedness = vTangent.w;
vec3 tangent = normalize(vTangent.xyz);
vec3 bitangent = cross(normal, tangent) * tangentHeadedness;
return mat3(tangent, bitangent, normal);
}`)):(e.extensions.add("GL_OES_standard_derivatives"),r.code.add(S`mat3 computeTangentSpace(vec3 normal, vec3 pos, vec2 st) {
vec3 Q1 = dFdx(pos);
vec3 Q2 = dFdy(pos);
vec2 stx = dFdx(st);
vec2 sty = dFdy(st);
float det = stx.t * sty.s - sty.t * stx.s;
vec3 T = stx.t * Q2 - sty.t * Q1;
T = T - normal * dot(normal, T);
T *= inversesqrt(max(dot(T,T), 1.e-10));
vec3 B = sign(det) * cross(normal, T);
return mat3(T, B, normal);
}`)),t.textureCoordinateType!==_n.None){e.include(die,t);const i=t.supportsTextureAtlas;r.uniforms.add(t.pbrTextureBindType===Vr.Pass?W5("normalTexture",s=>s.textureNormal,i):dP("normalTexture",s=>s.textureNormal,i)),r.code.add(S`
    vec3 computeTextureNormal(mat3 tangentSpace, vec2 uv) {
      vtc.uv = uv;
      ${t.supportsTextureAtlas?"vtc.size = normalTextureSize;":""}
      vec3 rawNormal = textureLookup(normalTexture, vtc).rgb * 2.0 - 1.0;
      return tangentSpace * rawNormal;
    }
  `)}}function LL(e,t){const r=e.fragment;t.receiveAmbientOcclusion?(r.uniforms.add([new Ht("ssaoTex",(i,s)=>s.ssaoHelper.colorTexture),new lr("viewportPixelSz",(i,s)=>Kr(iyt,s.camera.fullViewport[0],s.camera.fullViewport[1],1/s.ssaoHelper.width,1/s.ssaoHelper.height))]),r.code.add(S`float evaluateAmbientOcclusion() {
return 1.0 - texture2D(ssaoTex, (gl_FragCoord.xy - viewportPixelSz.xy) * viewportPixelSz.zw).a;
}
float evaluateAmbientOcclusionInverse() {
return texture2D(ssaoTex, (gl_FragCoord.xy - viewportPixelSz.xy) * viewportPixelSz.zw).a;
}`)):r.code.add(S`float evaluateAmbientOcclusion() { return 0.0; }
float evaluateAmbientOcclusionInverse() { return 1.0; }`)}const iyt=Zt();function LT(e,t){const r=e.fragment;e.include(LL,t),t.pbrMode!==Pt.Disabled&&e.include(QB,t),e.include(yie,t),r.constants.add("ambientBoostFactor","float",AR),e.include(pB),r.code.add(S`
    const float GAMMA_SRGB = 2.1;
    const float INV_GAMMA_SRGB = 0.4761904;
    ${t.pbrMode===Pt.Disabled?"":"const vec3 GROUND_REFLECTANCE = vec3(0.2);"}
  `),r.uniforms.add(new St("lightingMainDirection",(i,s)=>s.lighting.lightingMainDirection)),r.code.add(S`
    float additionalDirectedAmbientLight(vec3 vPosWorld) {
      float vndl = dot(${t.spherical?S`normalize(vPosWorld)`:S`vec3(0.0, 0.0, 1.0)`}, lightingMainDirection);
      return smoothstep(0.0, 1.0, clamp(vndl * 2.5, 0.0, 1.0));
    }
  `),r.uniforms.add([new qe("lightingGlobalFactor",(i,s)=>s.lighting.globalFactor),new St("lightingMainIntensity",(i,s)=>s.lighting.mainLight.intensity)]),r.code.add(S`vec3 evaluateAdditionalLighting(float ambientOcclusion, vec3 vPosWorld) {
float additionalAmbientScale = additionalDirectedAmbientLight(vPosWorld);
return (1.0 - ambientOcclusion) * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor * lightingMainIntensity;
}`),t.pbrMode===Pt.Disabled||t.pbrMode===Pt.WaterOnIntegratedMesh?(e.include(vie,t),r.code.add(S`vec3 evaluateSceneLighting(vec3 normalWorld, vec3 albedo, float shadow, float ssao, vec3 additionalLight)
{
vec3 mainLighting = evaluateMainLighting(normalWorld, shadow);
vec3 ambientLighting = calculateAmbientIrradiance(normalWorld, ssao);
vec3 albedoLinear = pow(albedo, vec3(GAMMA_SRGB));
vec3 totalLight = mainLighting + ambientLighting + additionalLight;
totalLight = min(totalLight, vec3(PI));
vec3 outColor = vec3((albedoLinear / PI) * totalLight);
return pow(outColor, vec3(INV_GAMMA_SRGB));
}`)):t.pbrMode!==Pt.Normal&&t.pbrMode!==Pt.Schematic||(r.code.add(S`const float fillLightIntensity = 0.25;
const float horizonLightDiffusion = 0.4;
const float additionalAmbientIrradianceFactor = 0.02;
vec3 evaluateSceneLightingPBR(vec3 normal, vec3 albedo, float shadow, float ssao, vec3 additionalLight, vec3 viewDir, vec3 normalGround, vec3 mrr, vec3 _emission, float additionalAmbientIrradiance)
{
vec3 viewDirection = -viewDir;
vec3 mainLightDirection = lightingMainDirection;
vec3 h = normalize(viewDirection + mainLightDirection);
PBRShadingInfo inputs;
inputs.NdotL = clamp(dot(normal, mainLightDirection), 0.001, 1.0);
inputs.NdotV = clamp(abs(dot(normal, viewDirection)), 0.001, 1.0);
inputs.NdotH = clamp(dot(normal, h), 0.0, 1.0);
inputs.VdotH = clamp(dot(viewDirection, h), 0.0, 1.0);
inputs.NdotNG = clamp(dot(normal, normalGround), -1.0, 1.0);
vec3 reflectedView = normalize(reflect(viewDirection, normal));
inputs.RdotNG = clamp(dot(reflectedView, normalGround), -1.0, 1.0);
inputs.albedoLinear = pow(albedo, vec3(GAMMA_SRGB));
inputs.ssao = ssao;
inputs.metalness = mrr[0];
inputs.roughness = clamp(mrr[1] * mrr[1], 0.001, 0.99);`),r.code.add(S`inputs.f0 = (0.16 * mrr[2] * mrr[2]) * (1.0 - inputs.metalness) + inputs.albedoLinear * inputs.metalness;
inputs.f90 = vec3(clamp(dot(inputs.f0, vec3(50.0 * 0.33)), 0.0, 1.0));
inputs.diffuseColor = inputs.albedoLinear * (vec3(1.0) - inputs.f0) * (1.0 - inputs.metalness);`),t.useFillLights?r.uniforms.add(new wT("hasFillLights",(i,s)=>s.enableFillLights)):r.constants.add("hasFillLights","bool",!1),r.code.add(S`vec3 ambientDir = vec3(5.0 * normalGround[1] - normalGround[0] * normalGround[2], - 5.0 * normalGround[0] - normalGround[2] * normalGround[1], normalGround[1] * normalGround[1] + normalGround[0] * normalGround[0]);
ambientDir = ambientDir != vec3(0.0)? normalize(ambientDir) : normalize(vec3(5.0, -1.0, 0.0));
inputs.NdotAmbDir = hasFillLights ? abs(dot(normal, ambientDir)) : 1.0;
vec3 mainLightIrradianceComponent = inputs.NdotL * (1.0 - shadow) * lightingMainIntensity;
vec3 fillLightsIrradianceComponent = inputs.NdotAmbDir * lightingMainIntensity * fillLightIntensity;
vec3 ambientLightIrradianceComponent = calculateAmbientIrradiance(normal, ssao) + additionalLight;
inputs.skyIrradianceToSurface = ambientLightIrradianceComponent + mainLightIrradianceComponent + fillLightsIrradianceComponent ;
inputs.groundIrradianceToSurface = GROUND_REFLECTANCE * ambientLightIrradianceComponent + mainLightIrradianceComponent + fillLightsIrradianceComponent ;`),r.uniforms.add([new qe("lightingSpecularStrength",(i,s)=>s.lighting.mainLight.specularStrength),new qe("lightingEnvironmentStrength",(i,s)=>s.lighting.mainLight.environmentStrength)]),r.code.add(S`vec3 horizonRingDir = inputs.RdotNG * normalGround - reflectedView;
vec3 horizonRingH = normalize(viewDirection + horizonRingDir);
inputs.NdotH_Horizon = dot(normal, horizonRingH);
vec3 mainLightRadianceComponent = lightingSpecularStrength * normalDistribution(inputs.NdotH, inputs.roughness) * lightingMainIntensity * (1.0 - shadow);
vec3 horizonLightRadianceComponent = lightingEnvironmentStrength * normalDistribution(inputs.NdotH_Horizon, min(inputs.roughness + horizonLightDiffusion, 1.0)) * lightingMainIntensity * fillLightIntensity;
vec3 ambientLightRadianceComponent = lightingEnvironmentStrength * calculateAmbientRadiance(ssao) + additionalLight;
inputs.skyRadianceToSurface = ambientLightRadianceComponent + mainLightRadianceComponent + horizonLightRadianceComponent;
inputs.groundRadianceToSurface = GROUND_REFLECTANCE * (ambientLightRadianceComponent + horizonLightRadianceComponent) + mainLightRadianceComponent;
inputs.averageAmbientRadiance = ambientLightIrradianceComponent[1] * (1.0 + GROUND_REFLECTANCE[1]);`),r.code.add(S`
        vec3 reflectedColorComponent = evaluateEnvironmentIllumination(inputs);
        vec3 additionalMaterialReflectanceComponent = inputs.albedoLinear * additionalAmbientIrradiance;
        vec3 emissionComponent = pow(_emission, vec3(GAMMA_SRGB));
        vec3 outColorLinear = reflectedColorComponent + additionalMaterialReflectanceComponent + emissionComponent;
        ${t.pbrMode===Pt.Schematic?S`vec3 outColor = pow(max(vec3(0.0), outColorLinear - 0.005 * inputs.averageAmbientRadiance), vec3(INV_GAMMA_SRGB));`:S`vec3 outColor = pow(blackLevelSoftCompression(outColorLinear, inputs), vec3(INV_GAMMA_SRGB));`}
        return outColor;
      }
    `))}function aIe(e,t){const r=S`
  /*
  *  ${t.name}
  *  ${t.output===K.Color?"RenderOutput: Color":t.output===K.Depth?"RenderOutput: Depth":t.output===K.Shadow?"RenderOutput: Shadow":t.output===K.Normal?"RenderOutput: Normal":t.output===K.Highlight?"RenderOutput: Highlight":""}
  */
  `;LI()&&(e.fragment.code.add(r),e.vertex.code.add(r))}function d$(e){e.include(wg),e.code.add(S`
    vec3 mixExternalColor(vec3 internalColor, vec3 textureColor, vec3 externalColor, int mode) {
      // workaround for artifacts in OSX using Intel Iris Pro
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475
      vec3 internalMixed = internalColor * textureColor;
      vec3 allMixed = internalMixed * externalColor;

      if (mode == ${S.int($s.Multiply)}) {
        return allMixed;
      }
      if (mode == ${S.int($s.Ignore)}) {
        return internalMixed;
      }
      if (mode == ${S.int($s.Replace)}) {
        return externalColor;
      }

      // tint (or something invalid)
      float vIn = rgb2v(internalMixed);
      vec3 hsvTint = rgb2hsv(externalColor);
      vec3 hsvOut = vec3(hsvTint.x, hsvTint.y, vIn * hsvTint.z);
      return hsv2rgb(hsvOut);
    }

    float mixExternalOpacity(float internalOpacity, float textureOpacity, float externalOpacity, int mode) {
      // workaround for artifacts in OSX using Intel Iris Pro
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475
      float internalMixed = internalOpacity * textureOpacity;
      float allMixed = internalMixed * externalOpacity;

      if (mode == ${S.int($s.Ignore)}) {
        return internalMixed;
      }
      if (mode == ${S.int($s.Replace)}) {
        return externalOpacity;
      }

      // multiply or tint (or something invalid)
      return allMixed;
    }
  `)}function syt(e){const t=new Yr,r=t.vertex.code,i=t.fragment.code;t.include(aIe,{name:"Default Material Shader",output:e.output});const s=ph(t,e);return t.include(XB),t.varyings.add("vpos","vec3"),t.include(_C,e),t.include(JPe,e),t.include(o3e,e),e.output!==K.Color&&e.output!==K.Alpha||(ag(t.vertex,e),t.include(WB,e),t.include(ra,{linearDepth:!1,hasModelTransformation:e.hasModelTransformation}),e.normalType===Ii.Attribute&&e.offsetBackfaces&&t.include(QPe),t.include(oIe,e),t.include(ZB,e),e.instancedColor&&t.attributes.add(O.INSTANCECOLOR,"vec4"),t.varyings.add("localvpos","vec3"),t.include(Xy,e),t.include(PL,e),t.include(rIe,e),t.include(oS,e),t.vertex.uniforms.add(new lr("externalColor",n=>n.externalColor)),t.varyings.add("vcolorExt","vec4"),e.hasMultipassTerrain&&t.varyings.add("depth","float"),e.hasModelTransformation&&t.vertex.uniforms.add(new Ei("model",n=>b(n.modelTransformation)?n.modelTransformation:Tn)),r.add(S`
      void main(void) {
        forwardNormalizedVertexColor();
        vcolorExt = externalColor;
        ${e.instancedColor?"vcolorExt *= instanceColor;":""}
        vcolorExt *= vvColor();
        vcolorExt *= getSymbolColor();
        forwardColorMixMode();

        if (vcolorExt.a < ${S.float(sa)}) {
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        } else {
          vpos = calculateVPos();
          localvpos = vpos - view[3].xyz;
          vpos = subtractOrigin(vpos);
          ${e.normalType===Ii.Attribute?S`vNormalWorld = dpNormal(vvLocalNormal(normalModel()));`:""}
          vpos = addVerticalOffset(vpos, localOrigin);
          ${e.hasVertexTangents?"vTangent = dpTransformVertexTangent(tangent);":""}
          gl_Position = transformPosition(proj, view, ${e.hasModelTransformation?"model,":""} vpos);
          ${e.normalType===Ii.Attribute&&e.offsetBackfaces?"gl_Position = offsetBackfacingClipPosition(gl_Position, vpos, vNormalWorld, cameraPosition);":""}
        }

        ${e.hasMultipassTerrain?"depth = (view * vec4(vpos, 1.0)).z;":""}
        forwardLinearDepth();
        forwardTextureCoordinates();
      }
    `)),e.output===K.Alpha&&(t.include(Ss,e),t.include(Xx,e),t.include(Th,e),t.fragment.uniforms.add([new qe("opacity",n=>n.opacity),new qe("layerOpacity",n=>n.layerOpacity)]),e.hasColorTexture&&t.fragment.uniforms.add(new Ht("tex",n=>n.texture)),t.fragment.include(d$),i.add(S`
      void main() {
        discardBySlice(vpos);
        ${e.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}
        ${e.hasColorTexture?S`
                vec4 texColor = texture2D(tex, vuv0);
                ${e.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:S`vec4 texColor = vec4(1.0);`}
        ${e.hasVertexColors?S`float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:S`float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}
        gl_FragColor = vec4(opacity_);
      }
    `)),e.output===K.Color&&(t.include(Ss,e),t.include(LT,e),t.include(LL,e),t.include(Xx,e),t.include(e.instancedDoublePrecision?YB:$T,e),t.include(Th,e),ag(t.fragment,e),t.fragment.uniforms.add([s,new St("ambient",n=>n.ambient),new St("diffuse",n=>n.diffuse),new qe("opacity",n=>n.opacity),new qe("layerOpacity",n=>n.layerOpacity),new qe("lightingGlobalFactor",(n,o)=>o.lighting.globalFactor),new St("lightingMainIntensity",(n,o)=>o.lighting.mainLight.intensity)]),t.fragment.constants.add("ambientBoostFactor","float",AR),e.hasColorTexture&&t.fragment.uniforms.add(new Ht("tex",n=>n.texture)),t.include(gie,e),t.include(QB,e),t.fragment.include(d$),t.include(YPe,e),i.add(S`
      void main() {
        discardBySlice(vpos);
        ${e.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}
        ${e.hasColorTexture?S`
                vec4 texColor = texture2D(tex, vuv0);
                ${e.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:S`vec4 texColor = vec4(1.0);`}
        shadingParams.viewDirection = normalize(vpos - cameraPosition);
        ${e.normalType===Ii.ScreenDerivative?S`
                vec3 normal = screenDerivativeNormal(localvpos);`:S`
                shadingParams.normalView = vNormalWorld;
                vec3 normal = shadingNormal(shadingParams);`}
        ${e.pbrMode===Pt.Normal?"applyPBRFactors();":""}
        float ssao = evaluateAmbientOcclusionInverse();
        ssao *= getBakedOcclusion();

        float additionalAmbientScale = additionalDirectedAmbientLight(vpos + localOrigin);
        ${e.receiveShadows?"float shadow = readShadowMap(vpos, linearDepth);":e.spherical?"float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);":"float shadow = 0.0;"}
        vec3 matColor = max(ambient, diffuse);
        ${e.hasVertexColors?S`
                vec3 albedo = mixExternalColor(vColor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:S`
                vec3 albedo = mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}
        ${e.hasNormalTexture?S`
                mat3 tangentSpace = ${e.hasVertexTangents?"computeTangentSpace(normal);":"computeTangentSpace(normal, vpos, vuv0);"}
                vec3 shadingNormal = computeTextureNormal(tangentSpace, vuv0);`:S`vec3 shadingNormal = normal;`}
        vec3 normalGround = ${e.spherical?S`normalize(vpos + localOrigin);`:S`vec3(0.0, 0.0, 1.0);`}

        ${e.snowCover?S`
                float snow = smoothstep(0.5, 0.55, dot(normal, normalGround));
                albedo = mix(albedo, vec3(1), snow);
                shadingNormal = mix(shadingNormal, normal, snow);
                ssao = mix(ssao, 1.0, snow);`:""}

        vec3 additionalLight = ssao * lightingMainIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;

        ${e.pbrMode===Pt.Normal||e.pbrMode===Pt.Schematic?S`
                float additionalAmbientIrradiance = additionalAmbientIrradianceFactor * lightingMainIntensity[2];
                ${e.snowCover?S`
                        mrr = mix(mrr, vec3(0.0, 1.0, 0.04), snow);
                        emission = mix(emission, vec3(0.0), snow);`:""}

                vec3 shadedColor = evaluateSceneLightingPBR(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight, shadingParams.viewDirection, normalGround, mrr, emission, additionalAmbientIrradiance);`:S`vec3 shadedColor = evaluateSceneLighting(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight);`}
        gl_FragColor = highlightSlice(vec4(shadedColor, opacity_), vpos);
        ${e.transparencyPassType===yt.Color?S`gl_FragColor = premultiplyAlpha(gl_FragColor);`:""}
      }
    `)),t.include(nIe,e),t}const nyt=Object.freeze(Object.defineProperty({__proto__:null,build:syt},Symbol.toStringTag,{value:"Module"}));class oyt extends $Pe{constructor(){super(...arguments),this.isSchematic=!1,this.usePBR=!1,this.mrrFactors=Ue(0,1,.5),this.hasVertexColors=!1,this.hasSymbolColors=!1,this.doubleSided=!1,this.doubleSidedType="normal",this.cullFace=fi.Back,this.emissiveFactor=Ue(0,0,0),this.instancedDoublePrecision=!1,this.normals="default",this.receiveSSAO=!0,this.receiveShadows=!0,this.castShadows=!0,this.shadowMappingEnabled=!1,this.ambient=Ue(.2,.2,.2),this.diffuse=Ue(.8,.8,.8),this.externalColor=xr(1,1,1,1),this.colorMixMode="multiply",this.opacity=1,this.layerOpacity=1,this.origin=M(),this.hasSlicePlane=!1,this.hasSliceHighlight=!0,this.offsetTransparentBackfaces=!1,this.vvSizeEnabled=!1,this.vvSizeMinSize=[1,1,1],this.vvSizeMaxSize=[100,100,100],this.vvSizeOffset=[0,0,0],this.vvSizeFactor=[1,1,1],this.vvSizeValue=[1,1,1],this.vvColorEnabled=!1,this.vvColorValues=[0,0,0,0,0,0,0,0],this.vvColorColors=[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],this.vvSymbolAnchor=[0,0,0],this.vvSymbolRotationMatrix=$i(),this.vvOpacityEnabled=!1,this.vvOpacityValues=[],this.vvOpacityOpacities=[],this.transparent=!1,this.writeDepth=!0,this.customDepthTest=vT.Less,this.textureAlphaMode=hi.Blend,this.textureAlphaCutoff=XV,this.textureAlphaPremultiplied=!1,this.hasOccludees=!1,this.renderOccluded=Fi.Occlude}}class ayt extends LPe{constructor(){super(...arguments),this.origin=M(),this.slicePlaneLocalOrigin=this.origin}}class DL extends gi{initializeConfiguration(t,r){r.spherical=t.viewingMode===Be.Global,r.doublePrecisionRequiresObfuscation=ML(t.rctx),r.textureCoordinateType=r.hasColorTexture||r.hasMetalnessAndRoughnessTexture||r.hasEmissionTexture||r.hasOcclusionTexture||r.hasNormalTexture?_n.Default:_n.None}initializeProgram(t){return this._initializeProgram(t,DL.shader)}_initializeProgram(t,r){const i=r.get().build(this.configuration);return new oi(t.rctx,i,zr)}_convertDepthTestFunction(t){return t===vT.Lequal?_i.LEQUAL:_i.LESS}_setPipeline(t,r){const i=this.configuration,s=t===yt.NONE,n=t===yt.FrontFace;return Gt({blending:i.output!==K.Color&&i.output!==K.Alpha||!i.transparent?null:s?fh:N0(t),culling:lyt(i)&&dB(i.cullFace),depthTest:{func:eb(t,this._convertDepthTestFunction(i.customDepthTest))},depthWrite:s||n?i.writeDepth&&cc:null,colorWrite:or,stencilWrite:i.hasOccludees?cg:null,stencilTest:i.hasOccludees?r?j1:rb:null,polygonOffset:s||n?null:kB(i.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this._setPipeline(this.configuration.transparencyPassType,!0),this._setPipeline(this.configuration.transparencyPassType,!1)}getPipelineState(t,r){return r?this._occludeePipelineState:super.getPipelineState(t,r)}}function lyt(e){return e.cullFace!==fi.None||!e.hasSlicePlane&&!e.transparent&&!e.doubleSidedMode}DL.shader=new ni(nyt,()=>ie(()=>import("./DefaultMaterial.glsl.bd45d7c6.js"),[],import.meta.url));class rr extends Ca{constructor(){super(...arguments),this.output=K.Color,this.alphaDiscardMode=hi.Opaque,this.doubleSidedMode=Zi.None,this.pbrMode=Pt.Disabled,this.cullFace=fi.None,this.transparencyPassType=yt.NONE,this.normalType=Ii.Attribute,this.textureCoordinateType=_n.None,this.customDepthTest=vT.Less,this.spherical=!1,this.hasVertexColors=!1,this.hasSymbolColors=!1,this.hasVerticalOffset=!1,this.hasSlicePlane=!1,this.hasSliceHighlight=!0,this.hasColorTexture=!1,this.hasMetalnessAndRoughnessTexture=!1,this.hasEmissionTexture=!1,this.hasOcclusionTexture=!1,this.hasNormalTexture=!1,this.hasScreenSizePerspective=!1,this.hasVertexTangents=!1,this.hasOccludees=!1,this.hasMultipassTerrain=!1,this.hasModelTransformation=!1,this.offsetBackfaces=!1,this.vvSize=!1,this.vvColor=!1,this.receiveShadows=!1,this.receiveAmbientOcclusion=!1,this.textureAlphaPremultiplied=!1,this.instanced=!1,this.instancedColor=!1,this.instancedDoublePrecision=!1,this.doublePrecisionRequiresObfuscation=!1,this.writeDepth=!0,this.transparent=!1,this.enableOffset=!0,this.cullAboveGround=!1,this.snowCover=!1}}u([q({count:K.COUNT})],rr.prototype,"output",void 0),u([q({count:hi.COUNT})],rr.prototype,"alphaDiscardMode",void 0),u([q({count:Zi.COUNT})],rr.prototype,"doubleSidedMode",void 0),u([q({count:Pt.COUNT})],rr.prototype,"pbrMode",void 0),u([q({count:fi.COUNT})],rr.prototype,"cullFace",void 0),u([q({count:yt.COUNT})],rr.prototype,"transparencyPassType",void 0),u([q({count:Ii.COUNT})],rr.prototype,"normalType",void 0),u([q({count:_n.COUNT})],rr.prototype,"textureCoordinateType",void 0),u([q({count:vT.COUNT})],rr.prototype,"customDepthTest",void 0),u([q()],rr.prototype,"spherical",void 0),u([q()],rr.prototype,"hasVertexColors",void 0),u([q()],rr.prototype,"hasSymbolColors",void 0),u([q()],rr.prototype,"hasVerticalOffset",void 0),u([q()],rr.prototype,"hasSlicePlane",void 0),u([q()],rr.prototype,"hasSliceHighlight",void 0),u([q()],rr.prototype,"hasColorTexture",void 0),u([q()],rr.prototype,"hasMetalnessAndRoughnessTexture",void 0),u([q()],rr.prototype,"hasEmissionTexture",void 0),u([q()],rr.prototype,"hasOcclusionTexture",void 0),u([q()],rr.prototype,"hasNormalTexture",void 0),u([q()],rr.prototype,"hasScreenSizePerspective",void 0),u([q()],rr.prototype,"hasVertexTangents",void 0),u([q()],rr.prototype,"hasOccludees",void 0),u([q()],rr.prototype,"hasMultipassTerrain",void 0),u([q()],rr.prototype,"hasModelTransformation",void 0),u([q()],rr.prototype,"offsetBackfaces",void 0),u([q()],rr.prototype,"vvSize",void 0),u([q()],rr.prototype,"vvColor",void 0),u([q()],rr.prototype,"receiveShadows",void 0),u([q()],rr.prototype,"receiveAmbientOcclusion",void 0),u([q()],rr.prototype,"textureAlphaPremultiplied",void 0),u([q()],rr.prototype,"instanced",void 0),u([q()],rr.prototype,"instancedColor",void 0),u([q()],rr.prototype,"instancedDoublePrecision",void 0),u([q()],rr.prototype,"doublePrecisionRequiresObfuscation",void 0),u([q()],rr.prototype,"writeDepth",void 0),u([q()],rr.prototype,"transparent",void 0),u([q()],rr.prototype,"enableOffset",void 0),u([q()],rr.prototype,"cullAboveGround",void 0),u([q()],rr.prototype,"snowCover",void 0),u([q({constValue:!0})],rr.prototype,"hasVvInstancing",void 0),u([q({constValue:!1})],rr.prototype,"useCustomDTRExponentForWater",void 0),u([q({constValue:!1})],rr.prototype,"supportsTextureAtlas",void 0),u([q({constValue:!0})],rr.prototype,"useFillLights",void 0);function cyt(e){const t=new Yr,r=t.vertex.code,i=t.fragment.code,s=ph(t,e);return t.include(XB),t.varyings.add("vpos","vec3"),t.include(_C,e),t.include(JPe,e),t.include(o3e,e),e.output!==K.Color&&e.output!==K.Alpha||(ag(t.vertex,e),t.include(WB,e),t.include(ra),e.offsetBackfaces&&t.include(QPe),e.instancedColor&&t.attributes.add(O.INSTANCECOLOR,"vec4"),t.varyings.add("vNormalWorld","vec3"),t.varyings.add("localvpos","vec3"),e.hasMultipassTerrain&&t.varyings.add("depth","float"),t.include(Xy,e),t.include(PL,e),t.include(rIe,e),t.include(oS,e),t.vertex.uniforms.add(new lr("externalColor",n=>n.externalColor)),t.varyings.add("vcolorExt","vec4"),r.add(S`
        void main(void) {
          forwardNormalizedVertexColor();
          vcolorExt = externalColor;
          ${e.instancedColor?"vcolorExt *= instanceColor;":""}
          vcolorExt *= vvColor();
          vcolorExt *= getSymbolColor();
          forwardColorMixMode();

          if (vcolorExt.a < ${S.float(sa)}) {
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          } else {
            vpos = calculateVPos();
            localvpos = vpos - view[3].xyz;
            vpos = subtractOrigin(vpos);
            vNormalWorld = dpNormal(vvLocalNormal(normalModel()));
            vpos = addVerticalOffset(vpos, localOrigin);
            gl_Position = transformPosition(proj, view, vpos);
            ${e.offsetBackfaces?"gl_Position = offsetBackfacingClipPosition(gl_Position, vpos, vNormalWorld, cameraPosition);":""}
          }
          ${e.hasMultipassTerrain?S`depth = (view * vec4(vpos, 1.0)).z;`:""}
          forwardLinearDepth();
          forwardTextureCoordinates();
        }
      `)),e.output===K.Alpha&&(t.include(Ss,e),t.include(Xx,e),t.include(Th,e),t.fragment.uniforms.add([new qe("opacity",n=>n.opacity),new qe("layerOpacity",n=>n.layerOpacity),new I1("view")]),e.hasColorTexture&&t.fragment.uniforms.add(new Ht("tex",n=>n.texture)),t.fragment.include(d$),i.add(S`
      void main() {
        discardBySlice(vpos);
        ${e.hasMultipassTerrain?S`terrainDepthTest(gl_FragCoord, depth);`:""}
        ${e.hasColorTexture?S`
                vec4 texColor = texture2D(tex, vuv0);
                ${e.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:S`vec4 texColor = vec4(1.0);`}
        ${e.hasVertexColors?S`float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:S`float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}

        gl_FragColor = vec4(opacity_);
      }
    `)),e.output===K.Color&&(t.include(Ss,e),t.include(LT,e),t.include(LL,e),t.include(Xx,e),t.include(e.instancedDoublePrecision?YB:$T,e),t.include(Th,e),ag(t.fragment,e),t.fragment.uniforms.add([s,new St("ambient",n=>n.ambient),new St("diffuse",n=>n.diffuse),new qe("opacity",n=>n.opacity),new qe("layerOpacity",n=>n.layerOpacity),new I1("view"),new qe("lightingGlobalFactor",(n,o)=>o.lighting.globalFactor),new St("lightingMainIntensity",(n,o)=>o.lighting.mainLight.intensity)]),t.fragment.constants.add("ambientBoostFactor","float",AR),e.hasColorTexture&&t.fragment.uniforms.add(new Ht("tex",n=>n.texture)),t.include(gie,e),t.include(QB,e),t.fragment.include(d$),t.extensions.add("GL_OES_standard_derivatives"),i.add(S`
      void main() {
        discardBySlice(vpos);
        ${e.hasMultipassTerrain?S`terrainDepthTest(gl_FragCoord, depth);`:""}
        ${e.hasColorTexture?S`
                vec4 texColor = texture2D(tex, vuv0);
                ${e.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:S`vec4 texColor = vec4(1.0);`}
        vec3 viewDirection = normalize(vpos - cameraPosition);
        ${e.pbrMode===Pt.Normal?"applyPBRFactors();":""}
        float ssao = evaluateAmbientOcclusionInverse();
        ssao *= getBakedOcclusion();

        float additionalAmbientScale = additionalDirectedAmbientLight(vpos + localOrigin);
        vec3 additionalLight = ssao * lightingMainIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;
        ${e.receiveShadows?"float shadow = readShadowMap(vpos, linearDepth);":e.spherical?"float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);":"float shadow = 0.0;"}
        vec3 matColor = max(ambient, diffuse);
        ${e.hasVertexColors?S`
                vec3 albedo = mixExternalColor(vColor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:S`
                vec3 albedo = mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}
        ${e.snowCover?S`albedo = mix(albedo, vec3(1), 0.9);`:S``}
        ${S`
            vec3 shadingNormal = normalize(vNormalWorld);
            albedo *= 1.2;
            vec3 viewForward = vec3(view[0][2], view[1][2], view[2][2]);
            float alignmentLightView = clamp(dot(viewForward, -lightingMainDirection), 0.0, 1.0);
            float transmittance = 1.0 - clamp(dot(viewForward, shadingNormal), 0.0, 1.0);
            float treeRadialFalloff = vColor.r;
            float backLightFactor = 0.5 * treeRadialFalloff * alignmentLightView * transmittance * (1.0 - shadow);
            additionalLight += backLightFactor * lightingMainIntensity;`}
        ${e.pbrMode===Pt.Normal||e.pbrMode===Pt.Schematic?e.spherical?S`vec3 normalGround = normalize(vpos + localOrigin);`:S`vec3 normalGround = vec3(0.0, 0.0, 1.0);`:S``}
        ${e.pbrMode===Pt.Normal||e.pbrMode===Pt.Schematic?S`
                float additionalAmbientIrradiance = additionalAmbientIrradianceFactor * lightingMainIntensity[2];
                ${e.snowCover?S`
                        mrr = vec3(0.0, 1.0, 0.04);
                        emission = vec3(0.0);`:""}

                vec3 shadedColor = evaluateSceneLightingPBR(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight, viewDirection, normalGround, mrr, emission, additionalAmbientIrradiance);`:S`vec3 shadedColor = evaluateSceneLighting(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight);`}
        gl_FragColor = highlightSlice(vec4(shadedColor, opacity_), vpos);
        ${e.transparencyPassType===yt.Color?S`gl_FragColor = premultiplyAlpha(gl_FragColor);`:S``}
      }
    `)),t.include(nIe,e),t}const uyt=Object.freeze(Object.defineProperty({__proto__:null,build:cyt},Symbol.toStringTag,{value:"Module"}));class t8 extends DL{initializeConfiguration(t,r){super.initializeConfiguration(t,r),r.hasMetalnessAndRoughnessTexture=!1,r.hasEmissionTexture=!1,r.hasOcclusionTexture=!1,r.hasNormalTexture=!1,r.hasModelTransformation=!1,r.normalType=Ii.Attribute,r.doubleSidedMode=Zi.WindingOrder,r.hasVertexTangents=!1}initializeProgram(t){return this._initializeProgram(t,t8.shader)}}t8.shader=new ni(uyt,()=>ie(()=>import("./RealisticTree.glsl.d142958c.js"),[],import.meta.url));class DT extends Tg{constructor(t){super(t,pyt),this.supportsEdges=!0,this.techniqueConfig=new rr,this.vertexBufferLayout=myt(this.parameters),this.instanceBufferLayout=t.instanced?lIe(this.parameters):null}isVisibleInPass(t){return t!==je.MATERIAL_DEPTH_SHADOWMAP_ALL&&t!==je.MATERIAL_DEPTH_SHADOWMAP_DEFAULT&&t!==je.MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT||this.parameters.castShadows}isVisible(){const t=this.parameters;if(!super.isVisible()||t.layerOpacity===0)return!1;const{instanced:r,hasVertexColors:i,hasSymbolColors:s,vvColorEnabled:n}=t,o=b(r)&&r.includes("color"),a=t.colorMixMode==="replace",l=t.opacity>0,c=t.externalColor&&t.externalColor[3]>0;return i&&(o||n||s)?!!a||l:i?a?c:l:o||n||s?!!a||l:a?c:l}getConfiguration(t,r){return this.techniqueConfig.output=t,this.techniqueConfig.hasNormalTexture=!!this.parameters.normalTextureId,this.techniqueConfig.hasColorTexture=!!this.parameters.textureId,this.techniqueConfig.hasVertexTangents=this.parameters.hasVertexTangents,this.techniqueConfig.instanced=!!this.parameters.instanced,this.techniqueConfig.instancedDoublePrecision=this.parameters.instancedDoublePrecision,this.techniqueConfig.vvSize=this.parameters.vvSizeEnabled,this.techniqueConfig.hasVerticalOffset=b(this.parameters.verticalOffset),this.techniqueConfig.hasScreenSizePerspective=b(this.parameters.screenSizePerspective),this.techniqueConfig.hasSlicePlane=this.parameters.hasSlicePlane,this.techniqueConfig.hasSliceHighlight=this.parameters.hasSliceHighlight,this.techniqueConfig.alphaDiscardMode=this.parameters.textureAlphaMode,this.techniqueConfig.normalType=this.parameters.normals==="screenDerivative"?Ii.ScreenDerivative:Ii.Attribute,this.techniqueConfig.transparent=this.parameters.transparent,this.techniqueConfig.writeDepth=this.parameters.writeDepth,b(this.parameters.customDepthTest)&&(this.techniqueConfig.customDepthTest=this.parameters.customDepthTest),this.techniqueConfig.hasOccludees=this.parameters.hasOccludees,this.techniqueConfig.cullFace=this.parameters.hasSlicePlane?fi.None:this.parameters.cullFace,this.techniqueConfig.hasMultipassTerrain=r.multipassTerrain.enabled,this.techniqueConfig.cullAboveGround=r.multipassTerrain.cullAboveGround,this.techniqueConfig.hasModelTransformation=b(this.parameters.modelTransformation),t!==K.Color&&t!==K.Alpha||(this.techniqueConfig.hasVertexColors=this.parameters.hasVertexColors,this.techniqueConfig.hasSymbolColors=this.parameters.hasSymbolColors,this.parameters.treeRendering?this.techniqueConfig.doubleSidedMode=Zi.WindingOrder:this.techniqueConfig.doubleSidedMode=this.parameters.doubleSided&&this.parameters.doubleSidedType==="normal"?Zi.View:this.parameters.doubleSided&&this.parameters.doubleSidedType==="winding-order"?Zi.WindingOrder:Zi.None,this.techniqueConfig.instancedColor=b(this.parameters.instanced)&&this.parameters.instanced.includes("color"),this.techniqueConfig.receiveShadows=this.parameters.receiveShadows&&this.parameters.shadowMappingEnabled,this.techniqueConfig.receiveAmbientOcclusion=!!r.ssaoHelper.ready&&this.parameters.receiveSSAO,this.techniqueConfig.vvColor=this.parameters.vvColorEnabled,this.techniqueConfig.textureAlphaPremultiplied=!!this.parameters.textureAlphaPremultiplied,this.techniqueConfig.pbrMode=this.parameters.usePBR?this.parameters.isSchematic?Pt.Schematic:Pt.Normal:Pt.Disabled,this.techniqueConfig.hasMetalnessAndRoughnessTexture=!!this.parameters.metallicRoughnessTextureId,this.techniqueConfig.hasEmissionTexture=!!this.parameters.emissiveTextureId,this.techniqueConfig.hasOcclusionTexture=!!this.parameters.occlusionTextureId,this.techniqueConfig.offsetBackfaces=!(!this.parameters.transparent||!this.parameters.offsetTransparentBackfaces),this.techniqueConfig.transparencyPassType=r.transparencyPassType,this.techniqueConfig.enableOffset=r.camera.relativeElevation<NB,this.techniqueConfig.snowCover=this.hasSnowCover(r)),this.techniqueConfig}hasSnowCover(t){return b(t.weather)&&t.weatherVisible&&t.weather.type==="snowy"&&t.weather.snowCover==="enabled"}intersect(t,r,i,s,n,o,a){if(b(this.parameters.verticalOffset)){const l=s.camera;se(aj,i[12],i[13],i[14]);let c=null;switch(s.viewingMode){case Be.Global:c=we(Bfe,aj);break;case Be.Local:c=ae(Bfe,vyt)}let h=0;const p=pe(_yt,aj,l.eye),f=Re(p),m=le(p,p,1/f);let g=null;this.parameters.screenSizePerspective&&(g=Te(c,m)),h+=d3e(l,f,this.parameters.verticalOffset,g,this.parameters.screenSizePerspective),le(c,c,h),Hc(oj,c,s.transform.inverseRotation),n=pe(gyt,n,oj),o=pe(yyt,o,oj)}PB(t,r,s,n,o,pQ(s.verticalOffset),a)}requiresSlot(t){return t===(this.parameters.transparent?this.parameters.writeDepth?Se.TRANSPARENT_MATERIAL:Se.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL:Se.OPAQUE_MATERIAL)||t===Se.DRAPED_MATERIAL}createGLMaterial(t){return t.output===K.Color||t.output===K.Alpha||t.output===K.Depth||t.output===K.Normal||t.output===K.Shadow||t.output===K.Highlight?new hyt(t):null}createBufferWriter(){return new fyt(this.vertexBufferLayout,this.instanceBufferLayout)}}class hyt extends mie{constructor(t){super({...t,...t.material.parameters})}_updateParameters(t){const r=this._material.parameters;this.updateTexture(r.textureId);const i=t.camera.viewInverseTransposeMatrix;return se(r.origin,i[3],i[7],i[11]),this._material.setParameters(this.textureBindParameters),this.ensureTechnique(r.treeRendering?t8:DL,t)}_updateShadowState(t){t.shadowMap.enabled!==this._material.parameters.shadowMappingEnabled&&this._material.setParameters({shadowMappingEnabled:t.shadowMap.enabled})}_updateOccludeeState(t){t.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:t.hasOccludees})}beginSlot(t){return this._output!==K.Color&&this._output!==K.Alpha||(this._updateShadowState(t),this._updateOccludeeState(t)),this._updateParameters(t)}}class dyt extends oyt{constructor(){super(...arguments),this.initTextureTransparent=!1,this.treeRendering=!1,this.hasVertexTangents=!1}}const pyt=new dyt;class fyt{constructor(t,r){this.vertexBufferLayout=t,this.instanceBufferLayout=r}allocate(t){return this.vertexBufferLayout.createBuffer(t)}elementCount(t){return t.indices.get(O.POSITION).length}write(t,r,i,s){$B(r,this.vertexBufferLayout,t.transformation,t.invTranspTransformation,i,s)}}function myt(e){const t=e.textureId||e.normalTextureId||e.metallicRoughnessTextureId||e.emissiveTextureId||e.occlusionTextureId,r=ps().vec3f(O.POSITION).vec3f(O.NORMAL);return e.hasVertexTangents&&r.vec4f(O.TANGENT),t&&r.vec2f(O.UV0),e.hasVertexColors&&r.vec4u8(O.COLOR),e.hasSymbolColors&&r.vec4u8(O.SYMBOLCOLOR),r}function lIe(e){let t=ps();return t=e.instancedDoublePrecision?t.vec3f(O.MODELORIGINHI).vec3f(O.MODELORIGINLO).mat3f(O.MODEL).mat3f(O.MODELNORMAL):t.mat4f(O.MODEL).mat4f(O.MODELNORMAL),b(e.instanced)&&e.instanced.includes("color")&&(t=t.vec4f(O.INSTANCECOLOR)),b(e.instanced)&&e.instanced.includes("featureAttribute")&&(t=t.vec4f(O.INSTANCEFEATUREATTRIBUTE)),t}const gyt=M(),yyt=M(),vyt=Ue(0,0,1),Bfe=M(),oj=M(),aj=M(),_yt=M(),byt=["polygon","extent"];class wyt extends Eg{constructor(t,r,i,s){super(t,r,i,s),this.ensureDrapedStatus(!1)}async doLoad(){if(!this._drivenProperties.size){const a=UB(this._getSymbolSize());if(a)throw new j("graphics3dextrudesymbollayer:invalid-size",a)}const t=ki(this.symbolLayer,"material","color"),r=this._getCombinedOpacityAndColor(t),i=Bl(r),s=r[3],n=s<1||this.needsDrivenTransparentPass,o={usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0,diffuse:i,ambient:i,opacity:s,transparent:n,cullFace:n?fi.None:fi.Back,hasVertexColors:!0,hasSlicePlane:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows,offsetTransparentBackfaces:!0};this._material=new DT(o),this._bottomMaterial=new DT({...o,cullFace:fi.Back}),this._context.stage.add(this._material),this._context.stage.add(this._bottomMaterial)}destroy(){super.destroy(),this._material&&(this._context.stage.remove(this._material),this._context.stage.remove(this._bottomMaterial))}createGraphics3DGraphic(t){const r=t.graphic;if(!this._validateGeometry(r.geometry,byt,this.symbolLayer.type))return null;const i=this._getVertexOpacityAndColor(t.renderingInfo,255),s=this.setGraphicElevationContext(r,new Ah);return this._createAs3DShape(r,t.renderingInfo,i,s,r.uid)}layerOpacityChanged(t,r){const i=ki(this.symbolLayer,"material","color"),s=this._getCombinedOpacity(i),n=s<1||this.needsDrivenTransparentPass;this._material.setParameters({opacity:s,transparent:n}),this._bottomMaterial.setParameters({opacity:s,transparent:n});const o=this._getLayerOpacity();return t.forEach(a=>{const l=r(a);b(l)&&l.layerOpacityChanged(o,this._context.isAsync)}),!0}layerElevationInfoChanged(t,r){return this.updateGraphics3DGraphicElevationInfo(t,r,B1)}slicePlaneEnabledChanged(t,r){return this._material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),this._bottomMaterial.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),t.forEach(i=>{const s=r(i);b(s)&&s.slicePlaneEnabledChanged(this._context.slicePlaneEnabled,this._context.isAsync)}),!0}physicalBasedRenderingChanged(){return this._material.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}),this._bottomMaterial.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}),!0}pixelRatioChanged(){return!0}_getExtrusionSize(t){var i;let r;return r=t.size&&this._drivenProperties.size?(i=Tmt(t.size,2))!=null?i:0:this._getSymbolSize(),r/=this._context.renderCoordsHelper.unitInMeters,r}applyRendererDiff(t,r){return this._drivenPropertiesChanged(r)?bn.Recreate_Symbol:bn.Recreate_Graphics}_getSymbolSize(){var t;return(t=this.symbolLayer.size)!=null?t:1}_createAs3DShape(t,r,i,s,n){const o=h$(t.geometry);if(R(o))return null;const a=Ose(o,this._context.elevationProvider,this._context.renderCoordsHelper,s);if(this._logGeometryCreationWarnings(a,o.rings,"rings","ExtrudeSymbol3DLayer"),o.rings.length===0||!o.rings.some(ce=>ce.length>0))return null;const l=pse(o);if(R(l))return null;const c=new Array,h=new Array,p=new Array,f=tn(),m=Ce(),g=M(),v=this._context.renderCoordsHelper.viewingMode===Be.Global;v||this._context.renderCoordsHelper.worldUpAtPosition(null,g),bh(o.spatialReference,[l.x,l.y,0],m,this._context.renderCoordsHelper.spatialReference);const w=Ce();Cs(w,m);const _=$i();AA(_,w);const{polygons:T,mapPosition:x,position:E}=a,C=E.length/3,A=new Float64Array(3*C*6),P=new Float64Array(3*C*6),I=new Float64Array(3*C*6),L=new Float64Array(1*C*6);let k=0;for(let ce=0;ce<T.length;++ce){const ne=T[ce],D=ne.count;if(this._context.clippingExtent&&(vi(f),nh(f,ne.mapPosition),!rf(f,this._context.clippingExtent)))continue;const N=BA(ne.mapPosition,ne.holeIndices,3);if(N.length===0)continue;const V=3*D*2+N.length,B=new Uint32Array(V),W=new Uint32Array(N.length),Y=6*D,H=3*A.BYTES_PER_ELEMENT,ee=new Ns(A.buffer,k*H,H,(k+Y)*H),me=3*P.BYTES_PER_ELEMENT,be=new Ns(P.buffer,k*me,me,(k+Y)*me),De=new Float64Array(I.buffer,3*k*I.BYTES_PER_ELEMENT,3*Y),ve=new Float64Array(L.buffer,1*k*L.BYTES_PER_ELEMENT,1*Y),ge=this._getExtrusionSize(r);xyt(E,x,N,ne,ee.typedBuffer,De,be.typedBuffer,ve,0,B,W,ge,g,v),RL(ee,ee,w),G1(be,be,_),k+=6*D;const Ee=Gfe(B,B.length-W.length,{positions:ee.typedBuffer,elevation:De,normals:be.typedBuffer,heights:ve},i);c.push(Ee),h.push(this._material),p.push(Tn);const Fe=Gfe(W,0,{positions:ee.typedBuffer,elevation:De,normals:be.typedBuffer,heights:ve},i);c.push(Fe),h.push(this._bottomMaterial),p.push(Tn)}if(c.length===0)return null;const G=new k0({geometries:c,materials:h,transformations:p,metadata:{layerUid:this._context.layer.uid,graphicUid:n,isElevationSource:!0}});G.transformation=m;const z=oPe(this.symbolLayer,{opacity:this._getLayerOpacity()}),X=b(z)?{baseMaterial:this._material,edgeMaterials:[z],properties:{mergeGeometries:!0,hasSlicePlane:this._context.slicePlaneEnabled}}:null,Z=new Sg(this,G,c,null,null,Eyt,s,X);return Z.alignedSampledElevation=a.sampledElevation,Z.needsElevationUpdates=B1(s.mode),Z}}function Gfe(e,t,r,i){const s=new Uint32Array(e.length),n=[[O.POSITION,{size:3,data:r.positions,exclusive:!0}],[O.NORMAL,{size:3,data:r.normals,exclusive:!0}],[O.COLOR,{size:4,data:i,exclusive:!0}],[O.SIZE,{size:1,data:r.heights,exclusive:!0}]],o=[[O.POSITION,e],[O.NORMAL,e],[O.COLOR,s]];return r.elevation&&(n.push([O.MAPPOS,{size:3,data:r.elevation}]),o.push([O.MAPPOS,e])),new Bi(n,o,rc.Triangle,t)}function xyt(e,t,r,i,s,n,o,a,l,c,h,p,f,m){const g=r.length/3;let v=0,w=2*i.count;Tyt(e,t,i.index,i.count,r,0,g,s,n,o,a,l,c,h,w,p,f,m),l+=2*i.count,w=0,jfe(s,n,a,o,v,i.pathLengths[0],i.count,l,c,w,p),l+=4*i.pathLengths[0],w+=2*i.pathLengths[0],v+=i.pathLengths[0];for(let _=1;_<i.pathLengths.length;++_)jfe(s,n,a,o,v,i.pathLengths[_],i.count,l,c,w,p),l+=4*i.pathLengths[_],w+=2*i.pathLengths[_],v+=i.pathLengths[_]}function Tyt(e,t,r,i,s,n,o,a,l,c,h,p,f,m,g,v,w,_){ae(Rl,w);const T=v>0?1:-1;let x=3*r,E=p,C=3*E,A=p+i,P=3*A;for(let k=0;k<i;++k)_&&(Rl[0]=e[x+0],Rl[1]=e[x+1],Rl[2]=e[x+2],we(Rl,Rl)),a[C+0]=e[x+0],a[C+1]=e[x+1],a[C+2]=e[x+2],l[C+0]=t[x+0],l[C+1]=t[x+1],l[C+2]=t[x+2],c[C+0]=-T*Rl[0],c[C+1]=-T*Rl[1],c[C+2]=-T*Rl[2],h[E]=0,a[P+0]=e[x+0]+v*Rl[0],a[P+1]=e[x+1]+v*Rl[1],a[P+2]=e[x+2]+v*Rl[2],l[P+0]=t[x+0],l[P+1]=t[x+1],l[P+2]=t[x+2],c[P+0]=T*Rl[0],c[P+1]=T*Rl[1],c[P+2]=T*Rl[2],h[A]=v,C+=3,P+=3,x+=3,E+=1,A+=1;x=3*n,C=0,P=3*g;const I=v<0?Yfe:Zfe,L=v<0?Zfe:Yfe;for(let k=0;k<o;++k)m[C+0]=s[x+I[0]],m[C+1]=s[x+I[1]],m[C+2]=s[x+I[2]],f[P+0]=s[x+L[0]]+i,f[P+1]=s[x+L[1]]+i,f[P+2]=s[x+L[2]]+i,C+=3,P+=3,x+=3}function aF(e,t,r,i,s,n,o){i[n]=i[o],o*=3,e[(n*=3)+0]=e[o+0],e[n+1]=e[o+1],e[n+2]=e[o+2],t[n+0]=t[o+0],t[n+1]=t[o+1],t[n+2]=t[o+2],r[n+0]=s[0],r[n+1]=s[1],r[n+2]=s[2]}const PO=M();function jfe(e,t,r,i,s,n,o,a,l,c,h){let p=s,f=s+1,m=s+o,g=s+o+1,v=a,w=a+1,_=a+2*n,T=a+2*n+1;h<0&&(p=s+o+1,g=s),c*=3;for(let x=0;x<n;++x)x===n-1&&(h>0?(f=s,g=s+o):(f=s,p=s+o)),Syt(e,p,f,m,PO),aF(e,t,i,r,PO,v,p),aF(e,t,i,r,PO,w,f),aF(e,t,i,r,PO,_,m),aF(e,t,i,r,PO,T,g),l[c++]=v,l[c++]=_,l[c++]=T,l[c++]=v,l[c++]=T,l[c++]=w,p++,f++,m++,g++,v+=2,w+=2,_+=2,T+=2}const lj=M(),Hfe=M(),qfe=M(),Wfe=M(),Xfe=M();function Syt(e,t,r,i,s){t*=3,r*=3,i*=3,se(lj,e[t++],e[t++],e[t++]),se(Hfe,e[r++],e[r++],e[r++]),se(qfe,e[i++],e[i++],e[i++]),pe(Wfe,Hfe,lj),pe(Xfe,qfe,lj),ut(s,Xfe,Wfe),we(s,s)}const NS=M();function Eyt(e,t,r,i){const s=e.stageObject,n=s.geometryRecords,o=n.length,a=t.mode!=="absolute-height";let l=0;const c=s.transformation,h=Cs(Ce(),c);for(let p=0;p<o;p+=2){const f=n[p].geometry,m=f.getMutableAttribute(O.POSITION).data,g=f.vertexAttributes.get(O.SIZE).data,v=f.vertexAttributes.get(O.MAPPOS).data,w=new PMe(v),_=m.length/3;let T=0,x=!1,E=0;const C=r.spatialReference;for(let A=0;A<_;A++){NS[0]=m[T],NS[1]=m[T+1],NS[2]=m[T+2],x0(w,r,t,i,lF),a&&(E+=lF.sampledElevation),Xr.TESTS_DISABLE_OPTIMIZATIONS?(se(gc,w.array[w.offset+0],w.array[w.offset+1],lF.z+g[T/3]),i.toRenderCoords(gc,C,gc),Ve(gc,gc,h)):(se(gc,m[T+0],m[T+1],m[T+2]),Ve(gc,gc,c),i.setAltitude(gc,lF.z+g[T/3]),Ve(gc,gc,h)),m[T]=gc[0],m[T+1]=gc[1],m[T+2]=gc[2];const P=Cyt/i.unitInMeters;(Math.abs(NS[0]-m[T])>=P||Math.abs(NS[1]-m[T+1])>=P||Math.abs(NS[2]-m[T+2])>=P)&&(x=!0),w.offset+=3,T+=3}x&&(f.invalidateBoundingInfo(),s.geometryVertexAttrsUpdated(n[p]),n[p+1].geometry.invalidateBoundingInfo(),s.geometryVertexAttrsUpdated(n[p+1])),l+=E/_}return l/o}const gc=M(),Rl=M(),lF=new AL,Zfe=[0,2,1],Yfe=[0,1,2],Cyt=.01;function Ayt(e,t,r,i,s){const n=e.referencesGeometry()&&s?Ryt(t,i,s):t,o=e.repurposeFeature(n);try{return e.evaluate({...r,$feature:o})}catch(a){return fe.getLogger("esri.views.2d.support.arcadeOnDemand").warn("Feature arcade evaluation failed:",a),null}}const cj=new Map;function Ryt(e,t,r){const{transform:i,hasZ:s,hasM:n}=r;cj.has(t)||cj.set(t,Oyt(t));const o=cj.get(t)(e.geometry,i,s,n);return{...e,geometry:o}}function Oyt(e){const t={};switch(e){case"esriGeometryPoint":return(r,i,s,n)=>B3e(i,t,r,s,n);case"esriGeometryPolygon":return(r,i,s,n)=>G3e(i,t,r,s,n);case"esriGeometryPolyline":return(r,i,s,n)=>j3e(i,t,r,s,n);case"esriGeometryMultipoint":return(r,i,s,n)=>z3e(i,t,r,s,n);default:return fe.getLogger("esri.views.2d.support.arcadeOnDemand").error(new j("mapview-arcade",`Unable to handle geometryType: ${e}`)),r=>r}}const _Dt=1.2,Myt=jm,Pyt=Sd;class r8{constructor(t,r,i,s){this.graphics3DSymbolLayer=t,this.renderGeometries=r,this.boundingBox=i,this._drapeSourceRenderer=s,this.type="draped",this.stage=null,this._visible=!1,this._addedToStage=!1,this.isElevationSource=!1}initialize(t){this.stage=t}setVisibility(t){if(this.stage!=null&&this._visible!==t){if(this._visible=t,t&&!this._addedToStage)return this._addedToStage=!0,void this._drapeSourceRenderer.addGeometries(this.renderGeometries,sr.Geometry.ADD);if(t||this._addedToStage){for(const r of this.renderGeometries)r.instanceParameters.visible=this._visible;this._drapeSourceRenderer.modifyGeometries(this.renderGeometries,sr.State.VISIBILITIES)}}}destroy(){this.stage&&this._addedToStage&&this._drapeSourceRenderer.removeGeometries(this.renderGeometries,sr.Geometry.REMOVE),this._addedToStage=!1,this._visible=!1,this.stage=null}getCenterObjectSpace(t=M()){return se(t,0,0,0)}getBoundingBoxObjectSpace(t=tn()){return vi(t)}addObjectState(t,r){t===v0.Highlight&&(this.renderGeometries.forEach(i=>{const s=i.addHighlight();r.addRenderGeometry(i,s,this)}),this._addedToStage&&this._drapeSourceRenderer.modifyGeometries(this.renderGeometries,sr.State.HIGHLIGHTS))}removeObjectState(t){this.renderGeometries.forEach(r=>{t.removeRenderGeometry(r)})}removeRenderGeometryObjectState(t,r){t.removeHighlight(r),this._addedToStage&&this._drapeSourceRenderer.modifyGeometries(this.renderGeometries,sr.State.HIGHLIGHTS)}computeAttachmentOrigin(t){for(const r of this.renderGeometries)r.computeAttachmentOrigin(FS)&&(t.draped.origin[0]+=FS[0],t.draped.origin[1]+=FS[1],t.draped.num++)}async getProjectedBoundingBox(t,r,i,s,n){vi(n);for(let o=0;o<this.renderGeometries.length;o++){const a=this.renderGeometries[o];this._getRenderGeometryProjectedBoundingRect(a,t,Qfe,i),_Be(n,Qfe)}if(r){let o;tf(n,FS);const a=fse(n,r);try{o=await r.service.queryElevation(FS[0],FS[1],s,a,"ground")}catch{}b(o)&&(n[2]=Math.min(n[2],o),n[5]=Math.max(n[5],o))}return n}_getRenderGeometryProjectedBoundingRect(t,r,i,s){if(this.boundingBox)l6(Vf,this.boundingBox);else{const n=t.boundingSphere,o=n[3];Vf[0]=n[0]-o,Vf[1]=n[1]-o,Vf[2]=n[2]-o,Vf[3]=n[0]+o,Vf[4]=n[1]+o,Vf[5]=n[2]+o}return r(Vf,0,2),this.calculateRelativeScreenBounds&&s.push({location:tf(Vf),screenSpaceBoundingRect:this.calculateRelativeScreenBounds()}),Gee(Vf,i)}}const Qfe=Ut(),Vf=tn(),FS=M();class cIe{constructor(t,r,i,s=2048){this.text=t,this._alignment=r,this._parameters=i,this.maxSize=s,this._textWidths=[],this._lineWidths=[],this._renderPixelRatio=null,this._displayWidth=null,this._heightMetrics=null,this.key=`TextRenderer-${this._parameters.key}-${this._alignment}--${t}`,this._lines=t.split(/\r?\n/)}get displayWidth(){return Math.ceil(this._ensureTextWidth()+2*this.backgroundHorizontalPadding)}get displayHeight(){const t=this.lineSpacing*(this._lines.length-1),r=this.lineHeight;return Math.ceil(t+r+2*this.haloSize+this.backgroundTopPadding+this.backgroundBottomPadding)}get renderedWidth(){return Math.ceil(this._toRenderUnit(this.displayWidth))}get renderedHeight(){return Math.ceil(this._toRenderUnit(this.displayHeight))}get firstRenderedBaselinePosition(){return this._toRenderUnit(this.firstLineYOffset+this.baselinePosition)}get firstLineYOffset(){return this.backgroundTopPadding+this.haloSize}get heightMetrics(){return this._ensureHeightMetrics()}get lineSpacing(){return(this.lineHeight+this.linePadding)*this._parameters.definition.lineSpacingFactor}get lineHeight(){return this.heightMetrics.lineHeight}get linePadding(){return this.lineHeight*Iyt}get baselinePosition(){return this.heightMetrics.baselinePosition}get renderedFontSize(){return this._toRenderUnit(this.fontSize)}get fontSize(){return this._parameters.definition.size}get renderedHaloSize(){return this._toRenderUnit(this.haloSize)}get haloSize(){return this._parameters.haloSize}get backgroundHorizontalPadding(){return this.hasBackground?this._parameters.definition.background.padding[0]:0}get backgroundVerticalPadding(){return this.hasBackground?this._parameters.definition.background.padding[1]:0}get backgroundTopPadding(){return Math.max(0,this.backgroundVerticalPadding-this.heightMetrics.paddingTop)}get backgroundBottomPadding(){return Math.max(0,this.backgroundVerticalPadding-this.heightMetrics.paddingBottom)}get hasBackground(){return!!this._parameters.backgroundStyle}get renderPixelRatio(){if(R(this._renderPixelRatio)){const t=this._parameters.definition.pixelRatio;this.maxSize>0?this._renderPixelRatio=Math.min(t,Math.min(this.maxSize/this.displayWidth,this.maxSize/this.displayHeight)):this._renderPixelRatio=t}return this._renderPixelRatio}_getLineXOffset(t){switch(this._alignment){case v1.Left:return this.backgroundHorizontalPadding;case v1.Center:return(this.displayWidth-this._lineWidths[t])/2;case v1.Right:return this.displayWidth-this.backgroundHorizontalPadding-this._lineWidths[t]}}render(t,r=0,i=0){t.save();const s=r/=this.renderPixelRatio,n=i/=this.renderPixelRatio,o=this.haloSize,a=this.firstLineYOffset;r+=o,i+=a+this.baselinePosition;const l=this.haloSize>0;l&&this._renderHalo(t,s,n,o,a),this._setFontProperties(t,this.renderedFontSize);for(let c=0;c<this._lines.length;++c){const h=this._lines[c],p=this._getLineXOffset(c);l&&(t.globalCompositeOperation="destination-out",t.fillStyle="rgb(0, 0, 0)",this._fillText(t,h,r+p,i),this._renderLineDecoration(t,r+p,i,this._textWidths[c])),t.globalCompositeOperation="source-over",t.fillStyle=this._parameters.textStyle,this._fillText(t,h,r+this._getLineXOffset(c),i),this._renderLineDecoration(t,r+p,i,this._textWidths[c]),i+=this.lineSpacing}if(Xr.TEXT_SHOW_BASELINE){t.strokeStyle=Jfe,t.setLineDash([2,2]),t.lineWidth=1;let c=n+a;for(let h=0;h<this._lines.length;++h){const p=c+this.baselinePosition;this._drawLine(t,[s,p],[s+this.displayWidth,p]),c+=this.lineSpacing}}if(Xr.TEXT_SHOW_BORDER&&(t.strokeStyle=Jfe,t.setLineDash([]),t.lineWidth=1,this._drawBox(t,[s,n],[this.displayWidth,this.displayHeight])),this.hasBackground){const c=this._parameters.definition.background.borderRadius*this.renderPixelRatio;this._roundedRect(t,s,n,c),t.globalCompositeOperation="destination-over",t.fillStyle=this._parameters.backgroundStyle,t.fill()}t.restore()}_renderLineDecoration(t,r,i,s,n=!1){if(this._parameters.definition.font.decoration==="none"||s===0)return;const o=1,a=Math.max(this._parameters.definition.size/16,o);switch(this._parameters.definition.font.decoration){case"underline":i+=2*a;break;case"line-through":i-=.33*this.baselinePosition}const l=n?this.haloSize:0;t.strokeStyle=n?this._parameters.haloStyle:this._parameters.textStyle,t.lineWidth=this._toRenderUnit(a+2*l),t.beginPath(),t.moveTo(this._toRenderUnit(r-l),this._toRenderUnit(i)),t.lineTo(this._toRenderUnit(r+s+l),this._toRenderUnit(i)),t.stroke()}_roundedRect(t,r,i,s){r=this._toRenderUnit(r),i=this._toRenderUnit(i);const n=this.renderedWidth,o=this.renderedHeight;s!==0?(s=Le(s,0,Math.floor(o/2)),t.beginPath(),t.moveTo(r,i+s),t.arcTo(r,i,r+s,i,s),t.lineTo(r+n-s,i),t.arcTo(r+n,i,r+n,i+s,s),t.lineTo(r+n,i+o-s),t.arcTo(r+n,i+o,r+n-s,i+o,s),t.lineTo(r+s,i+o),t.arcTo(r,i+o,r,i+o-s,s),t.closePath()):t.rect(r,i,n,o)}_renderHalo(t,r,i,s,n){const o=this.renderedWidth,a=this.renderedHeight,l=sk(uj,Math.max(o,kS),Math.max(a,kS)),c=l.getContext("2d");c.clearRect(0,0,o,a),this._setFontProperties(c,this.renderedFontSize),c.fillStyle=this._parameters.haloStyle,c.strokeStyle=this._parameters.haloStyle;const h=this.renderedHaloSize<3;c.lineJoin=h?"miter":"round",h?this._renderHaloEmulated(c,s,n):this._renderHaloNative(c,s,n);let p=n+this.baselinePosition;for(let f=0;f<this._lines.length;++f){const m=this._getLineXOffset(f);this._renderLineDecoration(c,s+m,p,this._textWidths[f],!0),p+=this.lineSpacing}t.globalAlpha=this._parameters.definition.halo.color[3],t.drawImage(l,0,0,o,a,this._toRenderUnit(r),this._toRenderUnit(i),o,a),t.globalAlpha=1}_renderHaloEmulated(t,r,i){i+=this.baselinePosition;for(let s=0;s<this._lines.length;++s){const n=this._lines[s],o=this._getLineXOffset(s);for(const[a,l]of uIe)this._fillText(t,n,r+o+this.haloSize*a,i+this.haloSize*l);i+=this.lineSpacing}}_renderHaloNative(t,r,i){const s=2*this.haloSize;i+=this.baselinePosition;for(let n=0;n<this._lines.length;++n){const o=this._lines[n],a=this._getLineXOffset(n),l=5,c=.1;for(let h=0;h<l;h++){const p=1-(l-1)*c+h*c;t.lineWidth=this._toRenderUnit(p*s),this._strokeText(t,o,r+a,i)}i+=this.lineSpacing}}_setFontProperties(t,r){t.font=this._parameters.fontString(r),t.textAlign="left",t.textBaseline="alphabetic"}_ensureTextWidth(){if(b(this._displayWidth))return this._displayWidth;const t=sk(uj,kS,kS).getContext("2d");this._setFontProperties(t,this.fontSize);let r=2*this.haloSize;const i=this._parameters.definition.font;i.style!=="italic"&&i.style!=="oblique"&&i.weight!=="bold"&&i.weight!=="bolder"||(r+=.3*t.measureText("A").width),this._textWidths.length=0,this._lineWidths.length=0;let s=0;for(const n of this._lines){const o=t.measureText(n).width,a=o+r;this._textWidths.push(o),this._lineWidths.push(a),s=Math.max(s,a)}return this._displayWidth=s,this._displayWidth}_ensureHeightMetrics(){if(R(this._heightMetrics)){const t=sk(uj,kS,kS).getContext("2d");this._setFontProperties(t,this.fontSize);const r=t.measureText(this.text+$yt),i=this.hasBackground?t.measureText(this._lines[0]):r,s=this._lines.length===1?i:this.hasBackground?t.measureText(this._lines[this._lines.length-1]):r,n=r.actualBoundingBoxAscent+r.actualBoundingBoxDescent;this._heightMetrics={paddingTop:r.actualBoundingBoxAscent-i.actualBoundingBoxAscent,paddingBottom:r.actualBoundingBoxDescent-s.actualBoundingBoxDescent,lineHeight:n,baselinePosition:r.actualBoundingBoxAscent}}return this._heightMetrics}_toRenderUnit(t){return t*this.renderPixelRatio}_toRoundedRenderUnit(t){return Math.round(t*this.renderPixelRatio)}_fillText(t,r,i,s){t.fillText(r,this._toRenderUnit(i),this._toRenderUnit(s))}_strokeText(t,r,i,s){t.strokeText(r,this._toRenderUnit(i),this._toRenderUnit(s))}_drawLine(t,r,i){t.beginPath(),t.moveTo(this._toRoundedRenderUnit(r[0])+.5,this._toRoundedRenderUnit(r[1])+.5),t.lineTo(this._toRoundedRenderUnit(i[0])+.5,this._toRoundedRenderUnit(i[1])+.5),t.stroke()}_drawBox(t,r,i){const s=this._toRenderUnit(r[0]),n=this._toRenderUnit(r[1]),o=this._toRenderUnit(i[0]),a=this._toRenderUnit(i[1]),l=Math.floor(s)+.5,c=Math.ceil(s+o)-.5,h=Math.floor(n)+.5,p=Math.ceil(n+a)-.5;t.beginPath(),t.moveTo(l,h),t.lineTo(c,h),t.lineTo(c,p),t.lineTo(l,p),t.lineTo(l,h),t.stroke()}}const uIe=[];for(let t=0;t<360;t+=360/16)uIe.push([Math.cos(Math.PI*t/180),Math.sin(Math.PI*t/180)]);var v1;function sk(e,t,r){return e.canvas||(e.canvas=document.createElement("canvas")),e.canvas.width=t,e.canvas.height=r,e.canvas}(function(e){e[e.Left=0]="Left",e[e.Center=1]="Center",e[e.Right=2]="Right"})(v1||(v1={}));const uj={canvas:null},Iyt=.2,kS=512,Jfe="rgb(255, 0, 255, 0.5)",$yt=(()=>{let e="";for(let t=32;t<127;t++)e+=String.fromCharCode(t);return e})(),Lyt={left:0,center:.5,right:1},nk={"bottom-left":Fr(0,0),bottom:Fr(.5,0),"bottom-right":Fr(1,0),left:Fr(0,.5),center:Fr(.5,.5),right:Fr(1,.5),"top-left":Fr(0,1),top:Fr(.5,1),"top-right":Fr(1,1)};function hIe(e){switch(e){case"left":return v1.Left;case"right":return v1.Right;default:return v1.Center}}function Kfe(e){switch(e){case"bottom-left":case"left":case"top-left":return"left";case"bottom":case"center":case"top":return"center";case"bottom-right":case"right":case"top-right":return"right"}}function Dyt(e){switch(e){case"bottom-left":case"bottom":case"bottom-right":return"bottom";case"left":case"center":case"right":return"center";case"top-left":case"top":case"top-right":return"top"}}function Nyt(e,t){switch(t){case"bottom":return e==="left"?"bottom-left":e==="right"?"bottom-right":"bottom";case"center":return e;case"top":return e==="left"?"top-left":e==="right"?"top-right":"top"}}function Fyt(e){return e==="middle"?"center":e}var Ta,eme,sz;function IO(e){return e!=null}function US(e){return typeof e=="number"}function i8(e){return typeof e=="string"}function kyt(e){return e==null||i8(e)}function vn(e,t){e&&e.push(t)}function Uyt(e,t,r,i=Ce()){const s=e||0,n=t||0,o=r||0;return s!==0&&cA(i,i,-s/180*Math.PI),n!==0&&lA(i,i,n/180*Math.PI),o!==0&&_6(i,i,o/180*Math.PI),i}function sv(e,t,r,i,s){const n=e.minSize,o=e.maxSize;if(e.expression)return vn(s,"Could not convert size info: expression not supported"),!1;if(e.useSymbolValue){const a=i.symbolSize[r];return t.minSize[r]=a,t.maxSize[r]=a,t.offset[r]=t.minSize[r],t.factor[r]=0,t.type[r]=Ta.DefinedSize,!0}if(IO(e.field))return IO(e.stops)?e.stops.length===2&&US(e.stops[0].size)&&US(e.stops[1].size)?(tme(e.stops[0].size,e.stops[1].size,e.stops[0].value,e.stops[1].value,t,r),t.type[r]=Ta.DefinedSize,!0):(vn(s,"Could not convert size info: stops only supported with 2 elements"),!1):US(n)&&US(o)&&IO(e.minDataValue)&&IO(e.maxDataValue)?(tme(n,o,e.minDataValue,e.maxDataValue,t,r),t.type[r]=Ta.DefinedSize,!0):vA[e.valueUnit]!=null?(t.minSize[r]=-1/0,t.maxSize[r]=1/0,t.offset[r]=0,t.factor[r]=1/vA[e.valueUnit],t.type[r]=Ta.DefinedSize,!0):e.valueUnit==="unknown"?(vn(s,"Could not convert size info: proportional size not supported"),!1):(vn(s,"Could not convert size info: scale-dependent size not supported"),!1);if(!IO(e.field)){if(e.stops&&e.stops[0]&&US(e.stops[0].size))return t.minSize[r]=e.stops[0].size,t.maxSize[r]=e.stops[0].size,t.offset[r]=t.minSize[r],t.factor[r]=0,t.type[r]=Ta.DefinedSize,!0;if(US(n))return t.minSize[r]=n,t.maxSize[r]=n,t.offset[r]=n,t.factor[r]=0,t.type[r]=Ta.DefinedSize,!0}return vn(s,"Could not convert size info: unsupported variant of sizeInfo"),!1}function tme(e,t,r,i,s,n){const o=Math.abs(i-r)>0?(t-e)/(i-r):0;s.minSize[n]=o>0?e:t,s.maxSize[n]=o>0?t:e,s.offset[n]=e-r*o,s.factor[n]=o}function Vyt(e,t,r,i){if(e.normalizationField||e.valueRepresentation)return vn(i,"Could not convert size info: unsupported property"),null;if(!kyt(e.field))return vn(i,"Could not convert size info: field is not a string"),null;if(t.size){if(e.field)if(t.size.field){if(e.field!==t.size.field)return vn(i,"Could not convert size info: multiple fields in use"),null}else t.size.field=e.field}else t.size={field:e.field,minSize:[0,0,0],maxSize:[0,0,0],offset:[0,0,0],factor:[0,0,0],type:[Ta.Undefined,Ta.Undefined,Ta.Undefined]};let s;switch(e.axis){case"width":return s=sv(e,t.size,0,r,i),s?t:null;case"height":return s=sv(e,t.size,2,r,i),s?t:null;case"depth":return s=sv(e,t.size,1,r,i),s?t:null;case"width-and-depth":return s=sv(e,t.size,0,r,i),s&&sv(e,t.size,1,r,i),s?t:null;case null:case void 0:case"all":return s=sv(e,t.size,0,r,i),s=s&&sv(e,t.size,1,r,i),s=s&&sv(e,t.size,2,r,i),s?t:null;default:return vn(i,`Could not convert size info: unknown axis "${e.axis}""`),null}}function zyt(e,t,r){for(let s=0;s<3;++s){let n=t.unitInMeters;e.type[s]===Ta.DefinedSize&&(n*=t.modelSize[s],e.type[s]=Ta.DefinedScale),e.minSize[s]=e.minSize[s]/n,e.maxSize[s]=e.maxSize[s]/n,e.offset[s]=e.offset[s]/n,e.factor[s]=e.factor[s]/n}let i;if(e.type[0]!==Ta.Undefined)i=0;else if(e.type[1]!==Ta.Undefined)i=1;else{if(e.type[2]===Ta.Undefined)return vn(r,"No size axis contains a valid size or scale"),!1;i=2}for(let s=0;s<3;++s)e.type[s]===Ta.Undefined&&(e.minSize[s]=e.minSize[i],e.maxSize[s]=e.maxSize[i],e.offset[s]=e.offset[i],e.factor[s]=e.factor[i],e.type[s]=e.type[i]);return!0}function rme(e,t,r){e[4*t+0]=r.r/255,e[4*t+1]=r.g/255,e[4*t+2]=r.b/255,e[4*t+3]=r.a}function Byt(e,t,r){if(e.normalizationField)return vn(r,"Could not convert color info: unsupported property"),null;if(i8(e.field)){if(!e.stops)return vn(r,"Could not convert color info: missing stops or colors"),null;{if(e.stops.length>8)return vn(r,"Could not convert color info: too many color stops"),null;t.color={field:e.field,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};const i=e.stops;for(let s=0;s<8;++s){const n=i[Math.min(s,i.length-1)];t.color.values[s]=n.value,rme(t.color.colors,s,n.color)}}}else{if(!(e.stops&&e.stops.length>=0))return vn(r,"Could not convert color info: no field and no colors/stops"),null;{const i=e.stops&&e.stops.length>=0&&e.stops[0].color;t.color={field:null,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};for(let s=0;s<8;s++)t.color.values[s]=1/0,rme(t.color.colors,s,i)}}return t}function Gyt(e,t,r){if(e.normalizationField)return vn(r,"Could not convert opacity info: unsupported property"),null;if(i8(e.field)){if(!e.stops)return vn(r,"Could not convert opacity info: missing stops or opacities"),null;{if(e.stops.length>8)return vn(r,"Could not convert opacity info: too many opacity stops"),null;t.opacity={field:e.field,values:[0,0,0,0,0,0,0,0],opacityValues:[0,0,0,0,0,0,0,0]};const i=e.stops;for(let s=0;s<8;++s){const n=i[Math.min(s,i.length-1)];t.opacity.values[s]=n.value,t.opacity.opacityValues[s]=n.opacity}}}else{if(!(e.stops&&e.stops.length>=0))return vn(r,"Could not convert opacity info: no field and no opacities/stops"),null;{const i=e.stops&&e.stops.length>=0&&e.stops[0].opacity;t.opacity={field:null,values:[0,0,0,0,0,0,0,0],opacityValues:[0,0,0,0,0,0,0,0]};for(let s=0;s<8;s++)t.opacity.values[s]=1/0,t.opacity.opacityValues[s]=i}}return t}function hj(e,t,r){const i=r===2&&e.rotationType==="arithmetic";t.offset[r]=i?90:0,t.factor[r]=i?-1:1,t.type[r]=1}function jyt(e,t,r){if(!i8(e.field))return vn(r,"Could not convert rotation info: field is not a string"),null;if(t.rotation){if(e.field)if(t.rotation.field){if(e.field!==t.rotation.field)return vn(r,"Could not convert rotation info: multiple fields in use"),null}else t.rotation.field=e.field}else t.rotation={field:e.field,offset:[0,0,0],factor:[1,1,1],type:[0,0,0]};switch(e.axis){case"tilt":return hj(e,t.rotation,0),t;case"roll":return hj(e,t.rotation,1),t;case null:case void 0:case"heading":return hj(e,t.rotation,2),t;default:return vn(r,`Could not convert rotation info: unknown axis "${e.axis}""`),null}}function dIe(e,t,r){if(!e)return null;const i=!t.supportedTypes||!!t.supportedTypes.size,s=!t.supportedTypes||!!t.supportedTypes.color,n=!t.supportedTypes||!!t.supportedTypes.rotation,o=!!t.supportedTypes&&!!t.supportedTypes.opacity,a=e.reduce((l,c)=>{if(!l)return l;if(c.valueExpression)return vn(r,"Could not convert visual variables: arcade expressions not supported"),null;switch(c.type){case"size":return i?Vyt(c,l,t,r):l;case"color":return s?Byt(c,l,r):l;case"opacity":return o?Gyt(c,l,r):null;case"rotation":return n?jyt(c,l,r):l;default:return null}},{size:null,color:null,opacity:null,rotation:null});return!(e.length>0&&a)||a.size||a.color||a.opacity||a.rotation?a&&a.size&&!zyt(a.size,t,r)?null:a:null}function Mse(e){return e&&e.size!=null}function p$(e,t){if(!e)return{enabled:!1};if(Xr.TESTS_DISABLE_FAST_UPDATES)return{enabled:!1};const r=dIe(e.visualVariables,t);return r?{enabled:!0,visualVariables:r,materialParameters:pIe(r,t),requiresShaderTransformation:Mse(r)}:{enabled:!1}}function f$(e,t,r){if(!t||!e.enabled)return!1;const i=e.visualVariables,s=dIe(t.visualVariables,r);return!!s&&!!(cF(i.size,s.size,"size")&&cF(i.color,s.color,"color")&&cF(i.rotation,s.rotation,"rotation")&&cF(i.opacity,s.opacity,"opacity"))&&(e.visualVariables=s,e.materialParameters=pIe(s,r),e.requiresShaderTransformation=Mse(s),!0)}function cF(e,t,r){if(!!e!=!!t||e&&e.field!==t.field)return!1;if(e&&r==="rotation"){const i=e,s=t;for(let n=0;n<3;n++)if(i.type[n]!==s.type[n]||i.offset[n]!==s.offset[n]||i.factor[n]!==s.factor[n])return!1}return!0}function pIe(e,t){const r={vvSizeEnabled:!1,vvSizeMinSize:null,vvSizeMaxSize:null,vvSizeOffset:null,vvSizeFactor:null,vvSizeValue:null,vvColorEnabled:!1,vvColorValues:null,vvColorColors:null,vvOpacityEnabled:!1,vvOpacityValues:null,vvOpacityOpacities:null,vvSymbolAnchor:null,vvSymbolRotationMatrix:null},i=Mse(e);return e&&e.size?(r.vvSizeEnabled=!0,r.vvSizeMinSize=e.size.minSize,r.vvSizeMaxSize=e.size.maxSize,r.vvSizeOffset=e.size.offset,r.vvSizeFactor=e.size.factor):e&&i&&(r.vvSizeValue=t.transformation.scale),e&&i&&(r.vvSymbolAnchor=t.transformation.anchor,r.vvSymbolRotationMatrix=$i(),ig(wP),Uyt(t.transformation.rotation[2],t.transformation.rotation[0],t.transformation.rotation[1],wP),Gd(r.vvSymbolRotationMatrix,wP)),e&&e.color&&(r.vvColorEnabled=!0,r.vvColorValues=e.color.values,r.vvColorColors=e.color.colors),e&&e.opacity&&(r.vvOpacityEnabled=!0,r.vvOpacityValues=e.opacity.values,r.vvOpacityOpacities=e.opacity.opacityValues),r}(function(e){e[e.Undefined=0]="Undefined",e[e.DefinedSize=1]="DefinedSize",e[e.DefinedScale=2]="DefinedScale"})(Ta||(Ta={})),function(e){e[e.Undefined=0]="Undefined",e[e.DefinedAngle=1]="DefinedAngle"}(eme||(eme={})),function(e){const t=Ce(),r=M();function i(n,o,a){if(!n.vvSizeEnabled)return a;Is(t,a);const l=n.vvSymbolRotationMatrix;gg(wP,l[0],l[1],l[2],0,l[3],l[4],l[5],0,l[6],l[7],l[8],0,0,0,0,1),Yi(t,t,wP);for(let c=0;c<3;++c){const h=n.vvSizeOffset[c]+o[0]*n.vvSizeFactor[c];r[c]=Le(h,n.vvSizeMinSize[c],n.vvSizeMaxSize[c])}return v6(t,t,r),yl(t,t,n.vvSymbolAnchor),t}function s(n,o,a){if(!o.vvSizeEnabled)return se(n,1,1,1);for(let l=0;l<3;++l){const c=o.vvSizeOffset[l]+a[0]*o.vvSizeFactor[l];n[l]=Le(c,o.vvSizeMinSize[l],o.vvSizeMaxSize[l])}return n}e.evaluateModelTransform=i,e.evaluateModelTransformScale=s}(sz||(sz={}));const wP=Ce(),FQ=sz.evaluateModelTransform,Hyt=sz.evaluateModelTransformScale;class qyt{constructor(){this.visible=!0}}class qA{constructor(t,r,i={}){this.data=t,this.material=r,this.boundingSphere=Zt(),this.instanceParameters=new qyt,this._transformation=Ce(),this._shaderTransformationDirty=!0,this.layerUid=_t(i.layerUid,null),this.graphicUid=_t(i.graphicUid,null),this.id=i.id?i.id:Jl(),this.boundingInfo=_t(i.boundingInfo,null),this.calculateShaderTransformation=_t(i.calculateShaderTransformation,null),this.castShadow=!!i.castShadow&&i.castShadow}get transformation(){return this._transformation}updateTransformation(t){t(this._transformation),this._shaderTransformationDirty=!0,this.computeBoundingSphere(this._transformation,this.boundingSphere)}shaderTransformationChanged(){this._shaderTransformationDirty=!0}computeBoundingSphere(t,r,i=pT(t)){R(this.boundingInfo)||(Ve(r,this.boundingInfo.getCenter(),t),r[3]=this.boundingInfo.getBSRadius()*i)}get hasShaderTransformation(){return b(this.calculateShaderTransformation)}get primitiveType(){return this.data.primitiveType}getShaderTransformation(){return R(this.calculateShaderTransformation)?_t(this.transformation,Tn):(this._shaderTransformationDirty&&(this._shaderTransformation||(this._shaderTransformation=Ce()),Is(this._shaderTransformation,this.calculateShaderTransformation(_t(this.transformation,Tn))),this._shaderTransformationDirty=!1),this._shaderTransformation)}computeAttachmentOrigin(t){if(this.material.computeAttachmentOrigin)return!!this.material.computeAttachmentOrigin(this,t)&&(b(this._transformation)&&Ve(t,t,this._transformation),!0);const r=this.indices.get(O.POSITION),i=this.vertexAttributes.get(O.POSITION);return!!UOe(i,r,t)&&(b(this._transformation)&&Ve(t,t,this._transformation),!0)}get indices(){return this.data.indices}get vertexAttributes(){return this.data.vertexAttributes}addHighlight(){const t=new QV(v0.Highlight),r=this.instanceParameters;return r.highlights=mQ(r.highlights,t),t}removeHighlight(t){const r=this.instanceParameters;r.highlights=gQ(r.highlights,t)}}const Wyt=Ce(),ime=Ue(0,0,1),Xyt=16,Zyt=1.5,Ax=cse,Yyt=[Ax/2,Ax/2,1-Ax/2,1-Ax/2],Qyt=[o$*Ax,o$*Ax];class m$ extends Eg{constructor(t,r,i,s){super(t,r,i,s),this._cimLayers=null,this._cimSymbolMaterials=new Map,this._cimSymbolTextures=new Map,this._cimMaterialParametersInfo=null,this._cimRequiredFields=null,this._cimScaleFactorOrFunction=null,this._size=null,this._symbolTextureRatio=1,this._outlineSize=0,this._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!0}}getCachedSize(){return{size:this._getIconSize()}}async doLoad(t){this._validateOrThrow();const r=this._prepareMaterialParameters(),i=this._getPrimitive();if(b(i))this._prepareResourcesPrimitive(r,i);else{const s=N2e(this.symbol,this.symbolLayer),n=Yz(s);n&&n.mediaType==="application/json"?await this._prepareResourcesCIM(r,JSON.parse(n.data),t):await this._prepareResourcesHref(r,s,t)}}_validateOrThrow(){if(this._drivenProperties.size)return;const t=UB(this._getIconSize());if(t)throw new j("graphics3diconsymbollayer:invalid-size",t)}_getIconSize(){const t=this.symbolLayer,r=Math.round(t.size!=null?yr(t.size):Xyt);return this._drivenProperties.size?Math.max(r,64):r}_generateTextureCIM(t){const r=this._getGraphicHash(t);let i=r===""?null:this._cimSymbolTextures.get(r);if(!i){const s={scaleFactor:this._cimScaleFactorOrFunction},n=this._context.sharedResources.cimSymbolRasterizer.rasterizeCIMSymbol(this._cimLayers,t,"esriGeometryPoint",s,null,null);this._cimMaterialParametersInfo.anchorPosition=this._getAnchorPos("relative",n.anchorPosition);const o={width:n.imageData.width,height:n.imageData.height,powerOfTwoResizeMode:f1.PAD};i=new Hs(n.imageData,o),this._cimSymbolTextures.set(r,i),this._context.stage.add(i)}return i}_computeSize(t,r){const i=t.width/t.height;return i>1?[r,Math.round(r/i)]:[Math.round(r*i),r]}_prepareMaterialParameters(){const t={anchorPosition:this._getAnchorPos(this.symbolLayer.anchor,this.symbolLayer.anchorPosition)},r=this.symbol;if(Jyt(r)){const{screenLength:i,minWorldLength:s,maxWorldLength:n}=r.verticalOffset;t.verticalOffset={screenLength:yr(i),minWorldLength:s||0,maxWorldLength:n!=null?n:1/0}}return this._context.screenSizePerspectiveEnabled&&(t.screenSizePerspective=this._context.sharedResources.screenSizePerspectiveSettings),t.occlusionTest=!0,t.hasSlicePlane=this._context.slicePlaneEnabled,t}_prepareResourcesPrimitive(t,r){const i=this._getOutlineSize();if(dj(r)&&i===0)throw new Error("Nothing to render");this._outlineSize=i,t.color=this._getFillColor(),t.outlineColor=this._getOutlineColor(),t.outlineSize=this._outlineSize;const s=this._context.sharedResources.textures.fromData(r,()=>w3e(r));this._texture=s.texture,this._releaseTexture=s,t.textureIsSignedDistanceField=!0,t.distanceFieldBoundingBox=Yyt,t.textureId=this._texture.id;const n=this._getIconSize();this._size=[n,n],this._symbolTextureRatio=1/Ax,this._createMaterialAndAddToStage(t,this._context.stage)}async _prepareResourcesHref(t,r,i){if(!he("esri-canvas-svg-support")&&tee(r))throw new j("graphics3diconsymbollayer:unsupported-image-format","IconSymbol3DLayer failed to load (SVG symbols are not supported in IE11)");this._outlineSize=this._getOutlineSize(),t.color=this._getFillColor(),t.outlineColor=this._getOutlineColor(),t.outlineSize=this._outlineSize,t.textureIsSignedDistanceField=!1;const s=this._getIconSize(),n=s*this._context.graphicsCoreOwner.view.state.pixelRatio,o=await yh(this._context.sharedResources.textures.fromUrl(r,n,{signal:i}));if(o.ok===!1)throw ah(o.error),new j("graphics3diconsymbollayer:request-failed",`Failed to load (Request for icon resource failed: ${r})`);this._releaseTexture=o.value;const a=o.value.texture,l=a.params;this._size=this._computeSize(l,s),t.textureId=a.id,this._createMaterialAndAddToStage(t,this._context.stage)}async _prepareResourcesCIM(t,r,i){const s=new cR({data:r});if(!this._context.sharedResources.cimSymbolRasterizer){const h=(await ie(()=>import("./CIMSymbolRasterizer.6bd8dfe3.js"),["CIMSymbolRasterizer.6bd8dfe3.js","cimAnalyzer.a17266d9.js","CIMSymbolHelper.0e25a568.js","BidiEngine.210f7ff8.js","enums.4de5fe56.js","number.6e30c64a.js"],import.meta.url)).CIMSymbolRasterizer;Jt(i),this._context.sharedResources.cimSymbolRasterizer||(this._context.sharedResources.cimSymbolRasterizer=new h(this._context.renderCoordsHelper.spatialReference,!0))}const n=this._context.layer.fields?this._context.layer.fields.map(h=>h.toJSON()):null;let o,a;if(this._cimLayers=await this._context.sharedResources.cimSymbolRasterizer.analyzeCIMSymbol(s,n,this._context.renderer&&this._context.renderer.type==="dictionary"?this._context.renderer.fieldMap:null,"esriGeometryPoint",{signal:i}),this._context.renderer&&this._context.renderer.type==="dictionary"&&this._context.renderer.scaleExpression){const h=this._context.renderer;if(isNaN(h.scaleExpression)){const p=h.scaleExpression,f=await f6e(p,this._context.layer.spatialReference,n);a=(m,g,v)=>{const w=Ayt(f,m,{$view:v},"esriGeometryPoint",g);return w!==null?w:1}}else o=Number(h.scaleExpression)}this._cimScaleFactorOrFunction=o||a||1;const l=this._context.renderer?await this._context.renderer.getRequiredFields(this._context.layer.fieldsIndex):[];Jt(i);const c=this._context.layer.fieldsIndex;this._cimRequiredFields=l.map(h=>c.get(h).name),this._cimMaterialParametersInfo=t,this._cimMaterialParametersInfo.color=this._getFillColor(),this._cimMaterialParametersInfo.outlineColor=[0,0,0,0],this._cimMaterialParametersInfo.outlineSize=0,this._cimMaterialParametersInfo.textureIsSignedDistanceField=!1}_getPrimitive(){return this.symbolLayer.resource&&this.symbolLayer.resource.href?null:this.symbolLayer.resource&&this.symbolLayer.resource.primitive||uxe}_getOutlineSize(){let t=0;const r=this.symbolLayer;return b(r.outline)&&r.outline.size!=null?Math.max(yr(r.outline.size),0):(t=dj(this._getPrimitive())?Zyt:0,Math.max(t,0))}_getOutlineColor(){const t=this._getLayerOpacity(),r=this.symbolLayer,i=ki(r,"outline","color");if(b(i)){const s=Me.toUnitRGB(i),n=i.a*t;return[s[0],s[1],s[2],n]}return[0,0,0,0]}_getFillColor(){if(dj(this._getPrimitive()))return Myt;const t=R(this._getPrimitive()),r=ki(this.symbolLayer,"material","color");return this._getCombinedOpacityAndColor(r,{hasIntrinsicColor:t})}_getAnchorPos(t,r){return t==="relative"?Fr((r.x||0)+.5,.5-(r.y||0)):t in nk?nk[t]:nk.center}_createMaterialAndAddToStage(t,r){if(this._cimLayers?this._fastUpdates={enabled:!1}:this._fastUpdates=p$(this._context.renderer,this._fastVisualVariableConvertOptions()),this._fastUpdates.enabled&&Object.assign(t,this._fastUpdates.materialParameters),this._cimLayers){let i=b(t.textureId)?this._cimSymbolMaterials.get(t.textureId):null;return i||(i=new VA(t),this._cimSymbolMaterials.set(_t(t.textureId,0),i),r.add(i)),i}return this._material=new VA(t),r.add(this._material),this._material}_setDrapingDependentMaterialParameters(){this.draped&&(this._forEachMaterial(t=>{t.setParameters({verticalOffset:null,screenSizePerspective:null,occlusionTest:!1,hasSlicePlane:!1,shaderPolygonOffset:0,isDraped:this.draped})}),this.layerOpacityChanged())}destroy(){super.destroy(),this._forEachMaterial(t=>this._context.stage.remove(t)),this._material=null,this._cimSymbolMaterials.clear(),this._cimSymbolTextures.forEach(t=>this._context.stage.remove(t)),this._cimSymbolTextures.clear(),this._releaseTexture=ti(this._releaseTexture)}_getScaleFactor(t,r){if(this._drivenProperties.size&&t.size){for(let i=0;i<3;i++){const s=t.size[i];s&&s!=="symbol-value"&&s!=="proportional"&&(t.size[i]=yr(s))}if(t.size[0]==="symbol-value")return 1;if(isFinite(+t.size[0]))return+t.size[0]/r;if(isFinite(+t.size[2]))return+t.size[2]/r}return 1}createGraphics3DGraphic(t){const r=t.graphic;if(!this._validateGeometry(r.geometry))return null;let i,s;if(this._cimLayers){if(!this._cimLayers.length)return null;const p=this._generateTextureCIM(r),f={textureId:p.id,...this._cimMaterialParametersInfo};s=this._createMaterialAndAddToStage(f,this._context.stage),i=[p.params.width,p.params.height]}else i=this._size,s=this._material;const n=c$(r.geometry);if(R(n))return this.logger.warn(`unsupported geometry type for icon symbol: ${r.geometry.type}`),null;const o=t.renderingInfo,a=this._getVertexOpacityAndColor(o);let l=1;if(!this._fastUpdates.enabled||!this._fastUpdates.visualVariables.size){const p=i[0]>i[1]?i[0]:i[1];l=this._getScaleFactor(o,p)}l*=this._symbolTextureRatio;const c=[i[0]*l,i[1]*l],h=this.setGraphicElevationContext(r,new Ah);return this.ensureDrapedStatus(h.mode==="on-the-ground")&&this._setDrapingDependentMaterialParameters(),this.draped?this._createAsOverlay(r,n,s,a,c,t.layer.uid):this._createAs3DShape(r,n,s,a,c,h,r.uid)}layerOpacityChanged(){const t=this._getFillColor(),r=this._getOutlineColor();return this._forEachMaterial(i=>{i.setParameters({color:t}),i.setParameters({outlineColor:r})}),!0}layerElevationInfoChanged(t,r,i){const s=this._elevationContext.mode,n=CL(m$.elevationModeChangeTypes,i,s);if(n!==is.UPDATE)return n;const o=Wd(s)||s==="absolute-height";return this.updateGraphics3DGraphicElevationInfo(t,r,()=>o)}slicePlaneEnabledChanged(){return this.draped||this._forEachMaterial(t=>{t.setParameters({hasSlicePlane:this._context.slicePlaneEnabled})}),!0}physicalBasedRenderingChanged(){return!0}pixelRatioChanged(){return!!this._getPrimitive()}applyRendererDiff(t,r){for(const i in t.diff){if(i!=="visualVariables"||!f$(this._fastUpdates,r,this._fastVisualVariableConvertOptions()))return bn.Recreate_Symbol;b(this._material)&&this._material.setParameters(this._fastUpdates.materialParameters)}return bn.Fast_Update}_defaultElevationInfoNoZ(){return Kyt}_createAs3DShape(t,r,i,s,n,o,a){const l=this.getFastUpdateAttrValues(t),c=l?m=>FQ(this._fastUpdates.materialParameters,l,m):null,h=[$c.createPointGeometry(ime,null,s,n,e0t,null,l)],p=wse(this._context,r,h,[i],o,this._context.layer.uid,a,c);if(p===null)return null;const f=new Sg(this,p.object,h,null,null,a$,o);return f.alignedSampledElevation=p.sampledElevation,f.needsElevationUpdates=Wd(o.mode)||o.mode==="absolute-height",f.getScreenSize=this._createScreenSizeGetter(n,c),f.calculateRelativeScreenBounds=m=>i.calculateRelativeScreenBounds(f.getScreenSize(),1,m),l$(f,r,this._context.elevationProvider),f}_createAsOverlay(t,r,i,s,n,o){i.renderPriority=this._renderPriority;const a=Zt();so(r,a,this._context.overlaySR),a[2]=Rse;const l=this._context.clippingExtent;if(b(l)&&!Bee(l,a))return null;const c=this.getFastUpdateAttrValues(t),h=c?g=>FQ(this._fastUpdates.materialParameters,c,g):null,p=$c.createPointGeometry(ime,a,s,n,null,null,c),f=new qA(p,i,{layerUid:o,graphicUid:t.uid,calculateShaderTransformation:h});a[3]=0,ef(f.boundingSphere,a);const m=new r8(this,[f],null,this._context.drapeSourceRenderer);return m.getScreenSize=this._createScreenSizeGetter(n,h),m.calculateRelativeScreenBounds=g=>i.calculateRelativeScreenBounds(m.getScreenSize(),1,g),m}_createScreenSizeGetter(t,r){const i=this._outlineSize+2;if(this._fastUpdates.enabled){const s=t[0]/this._symbolTextureRatio,n=t[1]/this._symbolTextureRatio;return(o=rt())=>{const a=r(Wyt);return o[0]=a[0]*s+i,o[1]=a[5]*n+i,o}}{const s=t[0]/this._symbolTextureRatio+i,n=t[1]/this._symbolTextureRatio+i;return(o=rt())=>(o[0]=s,o[1]=n,o)}}_fastVisualVariableConvertOptions(){const t=this._size[0]>this._size[1]?this._size[0]:this._size[1],r=Ue(t,t,t),i=ac(1),s=t*i;return{modelSize:r,symbolSize:Ue(s,s,s),unitInMeters:i,transformation:{anchor:dl,scale:Nm,rotation:dl}}}_getGraphicHash(t){let r="";for(const i of this._cimRequiredFields)r+=i+t.attributes[i];return r}_forEachMaterial(t){b(this._material)&&t(this._material),this._cimSymbolMaterials.forEach(t)}test(){return{...super.test(),material:this._material}}}function Jyt(e){return e&&e.type==="point-3d"&&e.hasVisibleVerticalOffset()}function dj(e){return!R(e)&&(e==="cross"||e==="x")}m$.PRIMITIVE_SIZE=Qyt,m$.elevationModeChangeTypes={definedChanged:is.UPDATE,staysOnTheGround:is.NONE,onTheGroundChanged:is.RECREATE};const Kyt={mode:"relative-to-ground",offset:0},e0t=xr(0,0,0,1);function kQ(e){const t=[],r=[];i0t(e,r,t);const i=r[0][1].data,s=t[0][1].length,n=new Uint16Array(s);return s0t(e,r,t),n0t(e,r,t,n),a0t(e,r,t,n),o0t(e,r,t,n),l0t(e,r,t,n),c0t(e,r,t,n),u0t(e,r,t,i),new Bi(r,t,rc.Line)}function t0t(e,t,r,i){const s=e.type==="polygon"?lg.CCW_IS_HOLE:lg.NONE,n=e.type==="polygon"?e.rings:e.paths,{position:o,outlines:a}=OL(n,e.hasZ,s),l=new Float64Array(o.length),c=J3e(o,e.spatialReference,0,l,0,o,0,o.length/3,t,r,i),h=c!=null;return{lines:h?fIe(a,o,l):[],projectionSuccess:h,sampledElevation:c}}function fIe(e,t,r){const i=new Array;for(const{index:s,count:n}of e){if(n<=1)continue;const o=3*s,a=o+3*n;i.push({position:t.subarray(o,a),mapPosition:r?r.subarray(o,a):void 0})}return i}function r0t(e,t){const r=e.type==="polygon"?lg.CCW_IS_HOLE:lg.NONE,i=e.type==="polygon"?e.rings:e.paths,{position:s,outlines:n}=OL(i,!1,r),o=mi(s,e.spatialReference,0,s,t,0,s.length/3);for(let a=2;a<s.length;a+=3)s[a]=Rse;return{lines:o?fIe(n,s):[],projectionSuccess:o}}function i0t(e,t,r){const{attributeData:{position:i},removeDuplicateStartEnd:s}=e,n=h0t(i)&&s===NT.REMOVE,o=i.length/3-(n?1:0),a=new Uint32Array(2*(o-1)),l=n?PK(i,0,i.length-3):i;let c=0;for(let h=0;h<o-1;h++)a[c++]=h,a[c++]=h+1;t.push([O.POSITION,{size:3,data:l,exclusive:n}]),r.push([O.POSITION,a])}function s0t(e,t,r){const i=e.attributeData.mapPosition;R(i)||(r.push([O.MAPPOS,r[0][1]]),t.push([O.MAPPOS,{size:3,data:i}]))}function n0t(e,t,r,i){if(b(e.attributeData.colorFeature))return;const s=e.attributeData.color;t.push([O.COLOR,{size:4,data:_t(s,Pyt)}]),r.push([O.COLOR,i])}function o0t(e,t,r,i){const s=e.attributeData.colorFeature;R(s)||(t.push([O.COLORFEATUREATTRIBUTE,{size:1,data:new Float32Array([s])}]),r.push([O.COLOR,i]))}function a0t(e,t,r,i){if(b(e.attributeData.sizeFeature))return;const s=e.attributeData.size;t.push([O.SIZE,{size:1,data:[_t(s,1)]}]),r.push([O.SIZE,i])}function l0t(e,t,r,i){const s=e.attributeData.sizeFeature;R(s)||(t.push([O.SIZEFEATUREATTRIBUTE,{size:1,data:new Float32Array([s])}]),r.push([O.SIZEFEATUREATTRIBUTE,i]))}function c0t(e,t,r,i){const s=e.attributeData.opacityFeature;R(s)||(t.push([O.OPACITYFEATUREATTRIBUTE,{size:1,data:new Float32Array([s])}]),r.push([O.OPACITYFEATUREATTRIBUTE,i]))}function u0t(e,t,r,i){if(R(e.overlayInfo)||e.overlayInfo.renderCoordsHelper.viewingMode!==Be.Global||!e.overlayInfo.spatialReference.isGeographic)return;const s=new Float64Array(i.length),n=Ar(e.overlayInfo.spatialReference);for(let f=0;f<s.length;f+=3)nte(i,f,s,f,n);const o=i.length/3,a=new Float32Array(o+1);let l=d0t,c=p0t,h=0,p=0;se(l,s[p++],s[p++],s[p++]),a[0]=0;for(let f=1;f<o+1;++f)f===o&&(p=0),se(c,s[p++],s[p++],s[p++]),h+=zRe(l,c),a[f]=h,[l,c]=[c,l];t.push([O.DISTANCETOSTART,{size:1,data:a}]),r.push([O.DISTANCETOSTART,r[0][1]])}function h0t(e){const t=e.length;return e[0]===e[t-3]&&e[1]===e[t-2]&&e[2]===e[t-1]}var NT;(function(e){e[e.KEEP=0]="KEEP",e[e.REMOVE=1]="REMOVE"})(NT||(NT={}));const d0t=M(),p0t=M();function UQ(e){switch(e){case"butt":return Ld.BUTT;case"square":return Ld.SQUARE;case"round":return Ld.ROUND;default:return null}}const nz=64,mIe=nz/2,gIe=mIe/5;function f0t(e,t){return b(t)?m0t(e,g0t(t.style)):null}function m0t(e,t){return e.fromData(t,()=>w3e(t,nz,mIe,gIe))}function g0t(e){return e==="diamond"?"kite":e}function y0t(e){const t=new Yr,r=e.hasMultipassTerrain&&(e.output===K.Color||e.output===K.Alpha);t.include(wPe,e),e.output===K.Depth&&t.include(tb,e);const{vertex:i,fragment:s}=t;return s.include(hu),ph(t,e),t.attributes.add(O.POSITION,"vec3"),t.attributes.add(O.UV0,"vec2"),t.attributes.add(O.AUXPOS1,"vec3"),t.varyings.add("vColor","vec4"),t.varyings.add("vpos","vec3"),t.varyings.add("vUV","vec2"),t.varyings.add("vSize","float"),t.varyings.add("linearDepth","float"),r&&t.varyings.add("depth","float"),i.code.add(S`#define PERPENDICULAR(v) vec2(v.y, -v.x)
float interp(float ncp, vec4 a, vec4 b) {
return (-ncp - a.z) / (b.z - a.z);
}`),i.uniforms.add([new _r("nearFar",(n,o)=>o.camera.nearFar),new lr("viewport",(n,o)=>o.camera.fullViewport)]),i.code.add(S`vec4 projectAndScale(vec4 pos) {
vec4 posNdc = proj * pos;
posNdc.xy *= viewport.zw / posNdc.w;
return posNdc;
}`),i.code.add(S`void clip(vec4 pos, inout vec4 prev) {
float vnp = nearFar[0] * 0.99;
if (prev.z > -nearFar[0]) {
prev = mix(pos, prev, interp(vnp, pos, prev));
}
}`),e.draped||(i.uniforms.add(new Ei("inverseProjectionMatrix",(n,o)=>o.camera.inverseProjectionMatrix)),i.code.add(S`vec3 inverseProject(vec4 posScreen) {
posScreen.xy = (posScreen.xy / viewport.zw) * posScreen.w;
return (inverseProjectionMatrix * posScreen).xyz;
}`),i.code.add(S`bool rayIntersectPlane(vec3 rayDir, vec3 planeOrigin, vec3 planeNormal, out vec3 intersection) {
float cos = dot(rayDir, planeNormal);
float t = dot(planeOrigin, planeNormal) / cos;
intersection = t * rayDir;
return abs(cos) > 0.001 && t > 0.0;
}`),i.uniforms.add(new qe("perScreenPixelRatio",(n,o)=>o.camera.perScreenPixelRatio)),i.code.add(S`
      vec4 toFront(vec4 displacedPosScreen, vec3 posLeft, vec3 posRight, vec3 prev, float lineWidth) {
        // Project displaced position back to camera space
        vec3 displacedPos = inverseProject(displacedPosScreen);

        // Calculate the plane that we want the marker to lie in. Note that this will always be an approximation since ribbon lines are generally
        // not planar and we do not know the actual position of the displaced prev vertices (they are offset in screen space, too).
        vec3 planeNormal = normalize(cross(posLeft - posRight, posLeft - prev));
        vec3 planeOrigin = posLeft;

        ${e.hasCap?`
                if(prev.z > posLeft.z) {
                  vec2 diff = posLeft.xy - posRight.xy;
                  planeOrigin.xy += PERPENDICULAR(diff) / 2.0;
                }
              `:""};

        // Move the plane towards the camera by a margin dependent on the line width (approximated in world space). This tolerance corrects for the
        // non-planarity in most cases, but sharp joins can place the prev vertices at arbitrary positions so markers can still clip.
        float offset = lineWidth * perScreenPixelRatio;
        planeOrigin *= (1.0 - offset);

        // Intersect camera ray with the plane and make sure it is within clip space
        vec3 rayDir = normalize(displacedPos);
        vec3 intersection;
        if (rayIntersectPlane(rayDir, planeOrigin, planeNormal, intersection) && intersection.z < -nearFar[0] && intersection.z > -nearFar[1]) {
          return vec4(intersection.xyz, 1.0);
        }

        // Fallback: use depth of pos or prev, whichever is closer to the camera
        float minDepth = planeOrigin.z > prev.z ? length(planeOrigin) : length(prev);
        displacedPos *= minDepth / length(displacedPos);
        return vec4(displacedPos.xyz, 1.0);
      }
  `)),i.uniforms.add(new qe("pixelRatio",(n,o)=>o.camera.pixelRatio)),i.code.add(S`
    void main(void) {
      float coverage = 1.0;

      // Check for special value of uv0.y which is used by the Renderer when graphics
      // are removed before the VBO is recompacted. If this is the case, then we just
      // project outside of clip space.
      if (uv0.y == 0.0) {
        // Project out of clip space
        gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
      }
      else {
        float lineSize = getSize();
        float lineWidth = max(lineSize, 1.0) * pixelRatio;

        vec4 pos  = view * vec4(position.xyz, 1.0);
        vec4 prev = view * vec4(auxpos1.xyz, 1.0);
        clip(pos, prev);

        vec4 posScreen = projectAndScale(pos);
        vec4 prevScreen = projectAndScale(prev);

        vec2 segment = posScreen.xy - prevScreen.xy;

        // normalize vector along line segment
        float segmentLen = length(segment);
        segment = (segmentLen > 0.001) ? segment / segmentLen : vec2(0.0, 0.0);

        // displace according to position in the texture
        vec2 displacementDirU = PERPENDICULAR(segment);
        vec2 displacementDirV = segment;

        float displacementLen = ${S.float(nz/gIe)} * lineWidth;

        vec4 displacedPosScreen = posScreen;
        displacedPosScreen.xy += uv0.x * displacementDirU * displacementLen + uv0.y * displacementDirV * displacementLen;
  `),e.draped||i.code.add(S`vec3 posRight = inverseProject(posScreen + vec4(displacementDirU.xy, 0.0, 0.0) * lineWidth);
vec3 posLeft = pos.xyz + (pos.xyz - posRight);
pos = toFront(displacedPosScreen, posLeft, posRight, prev.xyz, lineWidth);
displacedPosScreen = projectAndScale(pos);`),i.code.add(S`
        ${r?"depth = pos.z;":""}
        linearDepth = (-pos.z - nearFar[0]) / (nearFar[1] - nearFar[0]);

        // Convert back into NDC
        displacedPosScreen.xy = (displacedPosScreen.xy / viewport.zw) * displacedPosScreen.w;

        // Convert texture coordinate into [0,1] and cancel out perspective correct interpolation
        vUV = (uv0 + 1.0) / 2.0;
        vUV *= displacedPosScreen.w;

        vSize = displacementLen;

        vColor = getColor();
        vColor.a *= coverage;

        // Use camera space for slicing
        vpos = pos.xyz;

        gl_Position = displacedPosScreen;
      }
    }
  `),r&&t.include(Th,e),t.include(Ss,e),s.uniforms.add([new lr("intrinsicColor",n=>n.color),new Ht("tex",n=>n.texture)]),s.include(wg),s.code.add(S`
  void main() {
    discardBySlice(vpos);
    ${r?"terrainDepthTest(gl_FragCoord, depth);":""}

    vec4 finalColor = intrinsicColor * vColor;

    // Offset texture coordinate s.t. we sample texel centers
    float texelSize = ${S.float(1/nz)};
    vec2 samplePos = vUV * gl_FragCoord.w + vec2(0.5, -0.5) * texelSize;

    // Evaluate sdf
    float sdf = rgba2float(texture2D(tex, samplePos)) - 0.5;
    float distance = sdf * vSize;

    // Grow by a halfpixel to make sure the line is fully covered by the cross marker
    // (otherwise there will be a halo if they are different colours)
    distance -= 0.5;

    finalColor.a *= clamp(0.5 - distance, 0.0, 1.0);

    if (finalColor.a < ${S.float(sa)}) {
      discard;
    }

    ${e.output===K.Alpha?S`gl_FragColor = vec4(finalColor.a);`:""}
    ${e.output===K.Color?S`gl_FragColor = highlightSlice(finalColor, vpos);`:""}
    ${e.output===K.Color&&e.transparencyPassType===yt.Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}
    ${e.output===K.Highlight?S`gl_FragColor = vec4(1.0);`:""}
    ${e.output===K.Depth?S`outputDepth(linearDepth);`:""}
  }
  `),t}const v0t=Object.freeze(Object.defineProperty({__proto__:null,build:y0t},Symbol.toStringTag,{value:"Module"})),yIe=new Map([[O.POSITION,0],[O.UV0,2],[O.AUXPOS1,3],[O.SIZE,6],[O.SIZEFEATUREATTRIBUTE,6],[O.COLOR,5],[O.COLORFEATUREATTRIBUTE,5],[O.OPACITYFEATUREATTRIBUTE,7]]);class s8 extends gi{initializeProgram(t){const r=s8.shader.get().build(this.configuration);return new oi(t.rctx,r,yIe)}_makePipelineState(t,r){const i=this.configuration,s=t===yt.NONE;return Gt({blending:i.output===K.Color||i.output===K.Alpha?s?fh:N0(t):null,depthTest:{func:eb(t)},depthWrite:s?i.writeDepth&&cc:DB(t),colorWrite:or,stencilWrite:i.hasOccludees?cg:null,stencilTest:i.hasOccludees?r?j1:rb:null,polygonOffset:{factor:0,units:-10}})}initializePipeline(){return this.configuration.occluder&&(this._occluderPipelineTransparent=Gt({blending:fh,depthTest:ez,depthWrite:null,colorWrite:or,stencilWrite:null,stencilTest:EPe}),this._occluderPipelineOpaque=Gt({blending:fh,depthTest:ez,depthWrite:null,colorWrite:or,stencilWrite:TPe,stencilTest:SPe}),this._occluderPipelineMaskWrite=Gt({blending:null,depthTest:Sse,depthWrite:null,colorWrite:null,stencilWrite:cg,stencilTest:j1})),this._occludeePipelineState=this._makePipelineState(this.configuration.transparencyPassType,!0),this._makePipelineState(this.configuration.transparencyPassType,!1)}getPipelineState(t,r){return r?this._occludeePipelineState:this.configuration.occluder?t===Se.TRANSPARENT_OCCLUDER_MATERIAL?this._occluderPipelineTransparent:t===Se.OCCLUDER_MATERIAL?this._occluderPipelineOpaque:this._occluderPipelineMaskWrite:super.getPipelineState(t,r)}}s8.shader=new ni(v0t,()=>ie(()=>import("./LineMarker.glsl.34f3bc29.js"),[],import.meta.url));class Ya extends Ca{constructor(){super(...arguments),this.output=K.Color,this.transparencyPassType=yt.NONE,this.occluder=!1,this.hasSlicePlane=!1,this.writeDepth=!1,this.draped=!1,this.hasCap=!1,this.vvSize=!1,this.vvColor=!1,this.vvOpacity=!1,this.hasOccludees=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1}}u([q({count:K.COUNT})],Ya.prototype,"output",void 0),u([q({count:yt.COUNT})],Ya.prototype,"transparencyPassType",void 0),u([q()],Ya.prototype,"occluder",void 0),u([q()],Ya.prototype,"hasSlicePlane",void 0),u([q()],Ya.prototype,"writeDepth",void 0),u([q()],Ya.prototype,"draped",void 0),u([q()],Ya.prototype,"hasCap",void 0),u([q()],Ya.prototype,"vvSize",void 0),u([q()],Ya.prototype,"vvColor",void 0),u([q()],Ya.prototype,"vvOpacity",void 0),u([q()],Ya.prototype,"hasOccludees",void 0),u([q()],Ya.prototype,"hasMultipassTerrain",void 0),u([q()],Ya.prototype,"cullAboveGround",void 0),u([q({constValue:!0})],Ya.prototype,"hasVvInstancing",void 0),u([q({constValue:!0})],Ya.prototype,"hasSliceTranslatedView",void 0);class _0t extends Tg{constructor(t){super(t,new w0t),this._vertexAttributeLocations=yIe,this.techniqueConfig=new Ya,this.layout=this.createLayout()}dispose(){}getConfiguration(t,r){return this.techniqueConfig.output=t,this.techniqueConfig.draped=r.slot===Se.DRAPED_MATERIAL,this.techniqueConfig.hasCap=this.parameters.cap!==Ld.BUTT,this.techniqueConfig.hasSlicePlane=this.parameters.hasSlicePlane,this.techniqueConfig.hasOccludees=this.parameters.hasOccludees,this.techniqueConfig.writeDepth=this.parameters.writeDepth,this.techniqueConfig.vvColor=this.parameters.vvColorEnabled,this.techniqueConfig.vvOpacity=this.parameters.vvOpacityEnabled,this.techniqueConfig.vvSize=this.parameters.vvSizeEnabled,this.techniqueConfig.occluder=this.parameters.renderOccluded===Fi.OccludeAndTransparentStencil,this.techniqueConfig.transparencyPassType=r.transparencyPassType,this.techniqueConfig.hasMultipassTerrain=r.multipassTerrain.enabled,this.techniqueConfig.cullAboveGround=r.multipassTerrain.cullAboveGround,this.techniqueConfig}intersect(){}createLayout(){const t=ps().vec3f(O.POSITION).vec2f(O.UV0).vec3f(O.AUXPOS1);return this.parameters.vvSizeEnabled?t.f32(O.SIZEFEATUREATTRIBUTE):t.f32(O.SIZE),this.parameters.vvColorEnabled?t.f32(O.COLORFEATUREATTRIBUTE):t.vec4f(O.COLOR),this.parameters.vvOpacityEnabled&&t.f32(O.OPACITYFEATUREATTRIBUTE),t}createBufferWriter(){return new x0t(this.layout,this.parameters)}requiresSlot(t,r){if(t===Se.DRAPED_MATERIAL)return!0;if(this.parameters.renderOccluded===Fi.OccludeAndTransparentStencil)return t===Se.OPAQUE_MATERIAL||t===Se.OCCLUDER_MATERIAL||t===Se.TRANSPARENT_OCCLUDER_MATERIAL;const i=IT(r);return i===K.Color||i===K.Alpha?t===(this.parameters.writeDepth?Se.TRANSPARENT_MATERIAL:Se.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL):t===Se.OPAQUE_MATERIAL}createGLMaterial(t){return t.output===K.Color||t.output===K.Alpha||t.output===K.Highlight||t.output===K.Depth?new b0t(t):null}}class b0t extends mie{_updateParameters(t){return this.updateTexture(this._material.parameters.textureId),this._material.setParameters(this.textureBindParameters),this.ensureTechnique(s8,t)}_updateOccludeeState(t){t.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:t.hasOccludees})}beginSlot(t){return this._output!==K.Color&&this._output!==K.Alpha||this._updateOccludeeState(t),this._updateParameters(t)}}class w0t extends use{constructor(){super(...arguments),this.width=0,this.color=[1,1,1,1],this.placement="end",this.cap=Ld.BUTT,this.writeDepth=!0,this.hasSlicePlane=!1,this.vvFastUpdate=!1,this.hasOccludees=!1}}class x0t{constructor(t,r){this.vertexBufferLayout=t,this.parameters=r}allocate(t){return this.vertexBufferLayout.createBuffer(t)}elementCount(){return this.parameters.placement==="begin-end"?12:6}write(t,r,i,s){const n=r.vertexAttributes.get(O.POSITION).data,o=n.length/3;let a=1,l=0;this.parameters.vvSizeEnabled?l=r.vertexAttributes.get(O.SIZEFEATUREATTRIBUTE).data[0]:r.vertexAttributes.has(O.SIZE)&&(a=r.vertexAttributes.get(O.SIZE).data[0]);let c=[1,1,1,1],h=0;this.parameters.vvColorEnabled?h=r.vertexAttributes.get(O.COLORFEATUREATTRIBUTE).data[0]:r.vertexAttributes.has(O.COLOR)&&(c=r.vertexAttributes.get(O.COLOR).data);let p=0;this.parameters.vvOpacityEnabled&&(p=r.vertexAttributes.get(O.OPACITYFEATUREATTRIBUTE).data[0]);const f=t.transformation,m=new Float32Array(i.buffer);let g=s*(this.vertexBufferLayout.stride/4);const v=(x,E,C,A)=>{if(m[g++]=x[0],m[g++]=x[1],m[g++]=x[2],m[g++]=C[0],m[g++]=C[1],m[g++]=E[0],m[g++]=E[1],m[g++]=E[2],this.parameters.vvSizeEnabled?m[g++]=l:m[g++]=a,this.parameters.vvColorEnabled)m[g++]=h;else{const P=Math.min(4*A,c.length-4);m[g++]=c[P+0],m[g++]=c[P+1],m[g++]=c[P+2],m[g++]=c[P+3]}this.parameters.vvOpacityEnabled&&(m[g++]=p)};let w;(function(x){x[x.ASCENDING=1]="ASCENDING",x[x.DESCENDING=-1]="DESCENDING"})(w||(w={}));const _=(x,E)=>{const C=se(T0t,n[3*x],n[3*x+1],n[3*x+2]),A=S0t;let P=x+E;do se(A,n[3*P],n[3*P+1],n[3*P+2]),P+=E;while(cT(C,A)&&P>=0&&P<o);f&&(Ve(C,C,f),Ve(A,A,f)),v(C,A,[-1,-1],x),v(C,A,[1,-1],x),v(C,A,[1,1],x),v(C,A,[-1,-1],x),v(C,A,[1,1],x),v(C,A,[-1,1],x)},T=this.parameters.placement;T!=="begin"&&T!=="begin-end"||_(0,w.ASCENDING),T!=="end"&&T!=="begin-end"||_(o-1,w.DESCENDING)}}const T0t=M(),S0t=M(),fa={dash:[4,3],dot:[1,3],"long-dash":[8,3],"short-dash":[4,1],"short-dot":[1,1]},E0t={dash:fa.dash,"dash-dot":[...fa.dash,...fa.dot],dot:fa.dot,"long-dash":fa["long-dash"],"long-dash-dot":[...fa["long-dash"],...fa.dot],"long-dash-dot-dot":[...fa["long-dash"],...fa.dot,...fa.dot],none:null,"short-dash":fa["short-dash"],"short-dash-dot":[...fa["short-dash"],...fa["short-dot"]],"short-dash-dot-dot":[...fa["short-dash"],...fa["short-dot"],...fa["short-dot"]],"short-dot":fa["short-dot"],solid:null},C0t=8;function A0t(e,t=2){return R(e)?e:{pattern:e.slice(),pixelRatio:t}}function bDt(e,t=2){return{pattern:[e,e],pixelRatio:t}}function vIe(e){return b(e)&&e.type==="style"?R0t(e.style):null}function R0t(e){return b(e)?A0t(E0t[e],C0t):null}const O0t=["polyline","polygon","extent"];class n8 extends Eg{constructor(t,r,i,s){super(t,r,i,s),this._uniformSize=1}async doLoad(){if(this._vvConvertOptions={modelSize:[1,1,1],symbolSize:[1,1,1],unitInMeters:1,transformation:{anchor:[0,0,0],scale:[1,1,1],rotation:[0,0,0]},supportedTypes:{size:!0,color:!0,opacity:!0,rotation:!1}},this._context.renderer&&this._context.renderer.visualVariables&&this._context.renderer.visualVariables.length>0?this._fastUpdates=p$(this._context.renderer,this._vvConvertOptions):this._fastUpdates={enabled:!1},!this._drivenProperties.size){const t=this.symbolLayer.size!=null?this.symbolLayer.size:ac(1);if(t<0)throw new j("graphics3dlinesymbollayer:invalid-size","Symbol sizes may not be negative values");this._uniformSize=t}this._markerTexture=f0t(this._context.sharedResources.textures,this.symbolLayer.marker)}_getMaterialParameters(t,r=!1){var n;const i=this._getCombinedOpacityAndColor(r&&this._markerColor||this._materialColor);this._patternHidesLine&&!r&&(i[3]=0);const s={width:this._computeMaterialWidth((n=this.symbolLayer)==null?void 0:n.size),color:i,hasPolygonOffset:!0,join:this.symbolLayer.join||"miter",cap:UQ(this.symbolLayer.cap||"butt"),hasSlicePlane:this._context.slicePlaneEnabled,isClosed:t,stipplePattern:vIe(this.symbolLayer.pattern),stippleScaleWithLineWidth:!0};return this._fastUpdates&&this._fastUpdates.visualVariables?{...s,...this._fastUpdates.materialParameters}:s}get _materialColor(){return mn(this.symbolLayer.material,t=>t.color)}get _markerColor(){return mn(this.symbolLayer.marker,t=>t.color)}get lineMaterial(){return R(this._lineMaterial)&&(this._lineMaterial=new jE(this._getMaterialParameters(!1)),this._context.stage.add(this._lineMaterial)),this._lineMaterial}get ringMaterial(){return R(this._ringMaterial)&&(this._ringMaterial=new jE(this._getMaterialParameters(!0)),this._context.stage.add(this._ringMaterial)),this._ringMaterial}get wireframeLineMaterial(){return R(this._wireframeLineMaterial)&&(this._wireframeLineMaterial=new jE({...this._getMaterialParameters(!1),wireframe:!0}),this._context.stage.add(this._wireframeLineMaterial)),this._wireframeLineMaterial}get wireframeRingMaterial(){return R(this._wireframeRingMaterial)&&(this._wireframeRingMaterial=new jE({...this._getMaterialParameters(!0),wireframe:!0}),this._context.stage.add(this._wireframeRingMaterial)),this._wireframeRingMaterial}get markerMaterial(){return R(this._markerMaterial)&&b(this.symbolLayer.marker)&&b(this._markerTexture)&&(this._markerMaterial=new _0t({...this._getMaterialParameters(!1,!0),placement:this.symbolLayer.marker.placement,textureId:this._markerTexture.texture.id}),this._context.stage.add(this._markerMaterial)),this._markerMaterial}destroy(){super.destroy(),this._forEachMaterial(t=>this._context.stage.remove(t)),this._lineMaterial=null,this._ringMaterial=null,this._wireframeLineMaterial=null,this._wireframeRingMaterial=null,this._markerMaterial=null,this._markerTexture=ti(this._markerTexture)}_getDrivenSize(t){return this._drivenProperties.size&&t.size?yr(Smt(t.size)):1}_getSizeFeatureAttributeData(t){return this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size?Qy(this._fastUpdates.visualVariables.size.field,t):null}_getDrivenColor(t){const r=xr(1,1,1,1);return this._drivenProperties.color&&t.color&&(r[0]=t.color[0],r[1]=t.color[1],r[2]=t.color[2],t.color.length>0&&(r[3]=t.color[3])),this._drivenProperties.opacity&&t.opacity&&(r[3]=t.opacity),r}_getColorFeatureAttributeData(t){return this._fastUpdates.enabled&&this._fastUpdates.visualVariables.color?Qy(this._fastUpdates.visualVariables.color.field,t):null}_getOpacityFeatureAttributeData(t){return this._fastUpdates.enabled&&this._fastUpdates.visualVariables.opacity?Qy(this._fastUpdates.visualVariables.opacity.field,t):null}createGraphics3DGraphic(t){const r=t.graphic;if(!this._validateGeometry(r.geometry,O0t,this.symbolLayer.type))return null;const i=this.setGraphicElevationContext(r,new Ah);return this.ensureDrapedStatus(i.mode==="on-the-ground"),this.draped?this._createAsOverlay(t,this._context.layer.uid):this._createAs3DShape(t,i,r.uid)}applyRendererDiff(t,r){for(const i in t.diff){if(i!=="visualVariables"||!f$(this._fastUpdates,r,this._vvConvertOptions))return bn.Recreate_Symbol;this._forEachMaterial(s=>s.setParameters(this._fastUpdates.materialParameters))}return bn.Fast_Update}prepareSymbolLayerPatch(t){var n,o;if(t.diff.type!=="partial")return;const r=t.diff.diff,i={};((n=r.size)==null?void 0:n.type)==="complete"&&(i.width=this._computeMaterialWidth(r.size.newValue),delete r.size),((o=r.cap)==null?void 0:o.type)==="complete"&&(i.cap=UQ(_t(r.cap.newValue,"butt")),delete r.cap);const s=this._prepareMarkerPatch(t,r);this._prepareMaterialPatch(t,r,s),t.symbolLayerStatePatches.push(()=>this._forEachMaterial(a=>a.setParameters(i)))}layerOpacityChanged(){return this._forEachMaterial((t,r)=>this._updateMaterialLayerOpacity(t,r)),!0}_forEachMaterial(t){b(this._lineMaterial)&&t(this._lineMaterial),b(this._ringMaterial)&&t(this._ringMaterial),b(this._wireframeLineMaterial)&&t(this._wireframeLineMaterial),b(this._wireframeRingMaterial)&&t(this._wireframeRingMaterial),b(this._markerMaterial)&&t(this._markerMaterial,!0)}_updateMaterialLayerOpacity(t,r=!1){const i=t.parameters.color,s=ki(this.symbolLayer,"material","color"),n=this._patternHidesLine&&!r?0:this._getCombinedOpacity(s),o=xr(i[0],i[1],i[2],n);t.setParameters({color:o})}layerElevationInfoChanged(t,r,i){const s=this._elevationContext.mode,n=CL(n8.elevationModeChangeTypes,i,s);if(n!==is.UPDATE)return n;const o=Wd(s);return this.updateGraphics3DGraphicElevationInfo(t,r,()=>o)}slicePlaneEnabledChanged(){const t={hasSlicePlane:this._context.slicePlaneEnabled};return this._forEachMaterial(r=>r.setParameters(t)),!0}physicalBasedRenderingChanged(){return!0}pixelRatioChanged(){return!0}_getGeometryAsPolygonOrPolyline(t){switch(t.type){case"extent":if(t instanceof Kt)return Oa.fromExtent(t);break;case"polygon":case"polyline":return t}return null}_createAs3DShape(t,r,i){const s=t.graphic,n=this._getGeometryAsPolygonOrPolyline(s.geometry),o=n.type==="polygon"?n.rings:n.paths,a=new Array,l=new Array,c=new Array,h=tn(),p=t0t(n,this._context.elevationProvider,this._context.renderCoordsHelper,r),f=n.type==="polygon"?"rings":"paths";this._logGeometryCreationWarnings(p,o,f,"LineSymbol3DLayer");for(let v=0;v<p.lines.length;v++){const{position:w,mapPosition:_}=p.lines[v];if(b(this._context.clippingExtent)&&(vi(h),nh(h,_),!rf(h,this._context.clippingExtent)))continue;const T=this._createGeometry(t,w,_,n.type,xP.ELEVATED);a.push(T),l.push(n.type==="polygon"?this.ringMaterial:this.lineMaterial),c.push(Tn),Xr.LINE_WIREFRAMES&&(a.push(T.cloneShallow()),l.push(n.type==="polygon"?this.wireframeRingMaterial:this.wireframeLineMaterial),c.push(Tn));const x=this.markerMaterial;b(x)&&(a.push(T.cloneShallow()),l.push(x),c.push(Tn))}if(a.length===0)return null;const m=new k0({geometries:a,materials:l,transformations:c,castShadow:!1,metadata:{layerUid:this._context.layer.uid,graphicUid:i}}),g=new Sg(this,m,a,null,null,kft,r);return g.alignedSampledElevation=p.sampledElevation,g.needsElevationUpdates=Wd(r.mode),g}_createGeometry(t,r,i,s,n){const o=s==="polygon"?NT.REMOVE:NT.KEEP,a=this._fastUpdates.enabled&&this._fastUpdates.visualVariables.color,l=this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size;return kQ({overlayInfo:n===xP.DRAPED?{spatialReference:this._context.overlaySR,renderCoordsHelper:this._context.renderCoordsHelper}:null,removeDuplicateStartEnd:o,uniformSize:this._uniformSize,attributeData:{position:r,mapPosition:i,size:l?null:this._getDrivenSize(t.renderingInfo),color:a?null:this._getDrivenColor(t.renderingInfo),sizeFeature:this._getSizeFeatureAttributeData(t.graphic),colorFeature:this._getColorFeatureAttributeData(t.graphic),opacityFeature:this._getOpacityFeatureAttributeData(t.graphic)}})}_createAsOverlay(t,r){const i=t.graphic,s=this._getGeometryAsPolygonOrPolyline(i.geometry),n=s.type==="polygon"?s.rings:s.paths,o=s.type==="polygon"?this.ringMaterial:this.lineMaterial;o.renderPriority=this._renderPriority;const a=Xr.LINE_WIREFRAMES?s.type==="polygon"?this.wireframeRingMaterial:this.wireframeLineMaterial:null,l=this.markerMaterial;b(a)&&(a.renderPriority=this._renderPriority-.001),b(l)&&(l.renderPriority=this._renderPriority-.002);const c=new Array,h=tn(),p=vi(),f=r0t(s,this._context.overlaySR),m=s.type==="polygon"?"rings":"paths";this._logGeometryCreationWarnings(f,n,m,"LineSymbol3DLayer");for(const g of f.lines){if(vi(h),nh(h,g.position),!rf(h,this._context.clippingExtent))continue;nA(p,h);const v=this._createGeometry(t,g.position,null,s.type,xP.DRAPED),w=T=>{const x=new qA(v,T,{layerUid:r,graphicUid:i.uid});return c.push(x),x};if(b(l)){const T=w(l),x=this.symbolLayer.marker.placement;x!=="begin"&&x!=="begin-end"||nh(h,g.position,0,1),x!=="end"&&x!=="begin-end"||nh(h,g.position,g.position.length-3,1),this._updateBoundingSphere(T,h)}const _=w(o);if(this._updateBoundingSphere(_,h),Xr.LINE_WIREFRAMES){const T=w(a);this._updateBoundingSphere(T,h)}}return new r8(this,c,p,this._context.drapeSourceRenderer)}_updateBoundingSphere(t,r){Kr(t.boundingSphere,.5*(r[0]+r[3]),.5*(r[1]+r[4]),0,.5*Math.sqrt((r[3]-r[0])*(r[3]-r[0])+(r[4]-r[1])*(r[4]-r[1])))}get _patternHidesLine(){const t=this.symbolLayer.pattern;return b(t)&&t.type==="style"&&t.style==="none"}_computeMaterialWidth(t){return t=_t(t,ac(1)),this._drivenProperties.size?this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size?yr(1):1:yr(t)}_prepareMaterialPatch(t,r,i){const s=r.material;if(R(s))return void(i.changed&&i.useMaterialColor&&this._patchMaterialColor(this._getCombinedOpacityAndColor(this._materialColor),this._markerMaterial,t));if(s.type==="collection")return;const n=s.type==="complete"?mn(s.newValue,a=>a.color):s.diff.color.type==="complete"?s.diff.color.newValue:null,o=this._getCombinedOpacityAndColor(n);i.useMaterialColor&&this._patchMaterialColor(E6(o),this._markerMaterial,t),this._patternHidesLine&&(o[3]=0),this._patchMaterialColor(o,this._lineMaterial,t),delete r.material}_prepareMarkerPatch(t,r){const i=r.marker;if(R(i)||i.type!=="partial"||b(i.diff.style)||b(i.diff.placement)||b(i.diff.color)&&i.diff.color.type!=="complete")return{changed:!1,useMaterialColor:R(this._markerColor)};const s=i.diff.color;if(R(s))return delete r.marker,{changed:!1,useMaterialColor:R(this._markerColor)};const n=s.newValue;return R(n)?(delete r.marker,{changed:!0,useMaterialColor:!0}):(this._patchMaterialColor(this._getCombinedOpacityAndColor(n),this._markerMaterial,t),delete r.marker,{changed:!0,useMaterialColor:!1})}_patchMaterialColor(t,r,i){R(r)||i.symbolLayerStatePatches.push(()=>r.setParameters({color:t}))}}var xP;n8.elevationModeChangeTypes={definedChanged:is.RECREATE,staysOnTheGround:is.NONE,onTheGroundChanged:is.RECREATE},function(e){e[e.DRAPED=0]="DRAPED",e[e.ELEVATED=1]="ELEVATED"}(xP||(xP={}));const sme=2048,M0t=1.5,P0t=8;function I0t(e,t){const{format:r,quality:i,rotation:s,disableDecorations:n}=e||{},o=Pse(e,t.padding),a=G0t(e,{width:t.width-o.left-o.right,height:t.height-o.top-o.bottom}),{width:l,height:c}=B0t(e,a),h=q0t(r),p=Q0t[h];return{format:h,quality:Le(i!=null?i:p,0,100),area:a,width:l,height:c,rotation:s,disableDecorations:!!n,ignoreBackground:!(!e||!e.ignoreBackground),ignorePadding:!(!e||!e.ignorePadding)}}function $0t(e,t){const r=I0t(e,t),i=r.area,s=r.width/i.width,n=Pse(r,t.padding),o=n.left+n.right,a=n.top+n.bottom,l=t.width-o,c=t.height-a,h=Math.floor(l*s+o),p=Math.floor(c*s+a),f=e&&e.layers?e.layers:[],m=r.ignoreBackground,g=r.ignorePadding;return{framebufferWidth:h,framebufferHeight:p,region:{x:Math.floor(i.x*s)+n.left,y:Math.floor(i.y*s)+n.top,width:r.width,height:r.height},format:r.format,quality:r.quality,rotation:r.rotation,pixelRatio:s,layers:f,disableDecorations:r.disableDecorations,ignoreBackground:m,ignorePadding:g}}function L0t(e,t,r){const{ctx:i,canvas:s}=_Ie(e,r),n=i.getImageData(0,0,e.width,e.height),o=F0t(s,t);return bIe(s),{dataUrl:o,data:n}}function D0t(e,t){const{ctx:r,canvas:i}=_Ie(e,t),s=r.getImageData(0,0,e.width,e.height);return bIe(i),s}function _Ie(e,t){const r=N0t();t.premultipliedAlpha&&X0t(e),r.width=e.width,r.height=e.height;const i=r.getContext("2d");return i.putImageData(e,0,0),t.flipY&&W0t(i),{ctx:i,canvas:r}}function bIe(e){e.width=0,e.height=0}function N0t(){return R(pj)&&(pj=document.createElement("canvas")),pj}let pj=null;function F0t(e,t){const r=Z0t[t.format],i=t.quality/100;return e.toDataURL(r,i)}function fj(e,t,r){if(!e||!t)throw new Error("Cannot construct image data without dimensions");if(oz)try{return new ImageData(e,t)}catch{oz=!1}return wIe(e,t,r)}function k0t(e,t,r,i){if(!t||!r)throw new Error("Cannot construct image data without dimensions");if(oz)try{return new ImageData(e,t,r)}catch{oz=!1}const s=wIe(t,r,i);return s.data.set(e,0),s}function U0t(e,t,r,i=0,s=0,n=e.width-i,o=e.height-s,a=!1){const{data:l}=e,{width:c,height:h,data:p}=t,f=n/c,m=o/h,g=Math.ceil(f/2),v=Math.ceil(m/2),w=e.width;for(let _=0;_<h;_++)for(let T=0;T<c;T++){const x=4*(T+(a?h-_-1:_)*c);let E=0,C=0,A=0,P=0,I=0,L=0;const k=(_+.5)*m;for(let G=Math.floor(_*m);G<(_+1)*m;G++){const z=Math.abs(k-(G+.5))/v,X=(T+.5)*f,Z=z*z;for(let ce=Math.floor(T*f);ce<(T+1)*f;ce++){const ne=Math.abs(X-(ce+.5))/g,D=Math.sqrt(Z+ne*ne);if(D>=1)continue;let N=2*D*D*D-3*D*D+1;const V=4*(i+ce+(s+G)*w);L+=N*l[V+3],C+=N,!r&&l[V+3]<255&&(N=N*l[V+3]/255),A+=N*l[V],P+=N*l[V+1],I+=N*l[V+2],E+=N}}p[x]=A/E,p[x+1]=P/E,p[x+2]=I/E,p[x+3]=L/C}return t}function V0t(e,t,r){if(!t)return e;const{framebufferWidth:i,framebufferHeight:s,pixelRatio:n,region:o}=e,a=Pse(e,r),l=a.left+a.right,c=a.top+a.bottom,h=i-l,p=s-c,f=Math.min(P0t,Math.min((sme-l)/h,(sme-c)/p));return f<M0t?e:{...e,framebufferWidth:Math.round(h*f)+l,framebufferHeight:Math.round(p*f)+c,pixelRatio:n*f,resample:{region:{x:Math.round((o.x-a.left)*f)+a.left,y:Math.round((o.y-a.top)*f)+a.top,width:Math.round(o.width*f),height:Math.round(o.height*f)},width:i,height:s}}}function wIe(e,t,r){return r||(r=z0t()),r.getContext("2d").createImageData(e,t)}let $O=null,oz=!0;function z0t(){return $O||($O=document.createElement("canvas"),$O.width=1,$O.height=1),$O}function B0t(e,t){if(!e)return t;const r=e.width,i=e.height;if(r!=null&&i!=null)return{width:Math.floor(r),height:Math.floor(i)};if(r==null&&i==null)return t;const s=t.width/t.height;return i==null?{width:Math.floor(r),height:Math.floor(r/s)}:{width:Math.floor(i*s),height:Math.floor(i)}}function G0t(e,t){const r={x:0,y:0,width:t.width,height:t.height};if(e&&e.area){e.area.x!=null&&(r.x=Math.floor(e.area.x)),e.area.y!=null&&(r.y=Math.floor(e.area.y));const i=e.area.width!=null?Math.floor(e.area.width):null,s=e.area.height!=null?Math.floor(e.area.height):null;if(r.width=t.width-r.x,r.height=t.height-r.y,i!=null&&s!=null)r.width=Math.min(r.width,i),r.height=Math.min(r.height,s);else if(i==null&&s!=null){const n=Math.min(r.width,i);r.height=n/r.width*r.height,r.width=n}else if(i!=null&&s==null){const n=Math.min(r.height,s);r.width=n/r.height*r.width,r.height=n}}return j0t(H0t(r,e),t)}function j0t(e,t){const r=Math.floor(Math.max(e.x,0)),i=Math.floor(Math.max(e.y,0)),s={x:r,y:i,width:Math.floor(Math.min(e.width,t.width-r)),height:Math.floor(Math.min(e.height,t.height-i))},n=s.width/s.height,o=e.width/e.height;if(o===n)return s;if(o>n){const c=Math.floor(s.width/o),h=s.height-c;return{x:s.x,y:Math.floor(s.y+h/2),width:s.width,height:c}}const a=Math.floor(s.height*o),l=s.width-a;return{x:Math.floor(s.x+l/2),y:s.y,width:a,height:s.height}}function H0t(e,t){if(!t||t.width==null||t.height==null)return e;const r=t.width/t.height,i=e.width/e.height;if(i===r)return e;if(i<r){const n=Math.floor(e.height*r);return e.x-=(n-e.width)/2,e.width=n,e}const s=Math.floor(e.width/r);return e.y-=(s-e.height)/2,e.height=s,e}function Pse(e,t){return!t||e&&e.ignorePadding?J0t:t}function q0t(e){switch(e){case"png":case"jpg":case"jpeg":return e;default:return Y0t}}function W0t(e){e.save(),e.globalCompositeOperation="copy",e.scale(1,-1),e.translate(0,-e.canvas.height),e.drawImage(e.canvas,0,0),e.restore()}function X0t(e){const t=e.data,r=t.length;for(let i=0;i<r;i+=4){const s=t[i+3];if(s!==255&&s>0){const n=255/s;t[i+0]=t[i+0]*n,t[i+1]=t[i+1]*n,t[i+2]=t[i+2]*n}}}const Z0t={png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg"},nme=98,Y0t="png",Q0t={png:100,jpg:nme,jpeg:nme},J0t={top:0,right:0,bottom:0,left:0};var J2;const mj=new WeakMap;let K0t=0,hm=J2=class extends ye{constructor(e){super(e),this.wrap="repeat"}get url(){return this._get("url")||null}set url(e){this._set("url",e),e&&this._set("data",null)}get data(){return this._get("data")||null}set data(e){this._set("data",e),e&&this._set("url",null)}writeData(e,t,r,i){if(e instanceof HTMLImageElement){const s={type:"image-element",src:p0(e.src,i),crossOrigin:e.crossOrigin};t[r]=s}else if(e instanceof HTMLCanvasElement){const s=e.getContext("2d").getImageData(0,0,e.width,e.height),n={type:"canvas-element",imageData:this._encodeImageData(s)};t[r]=n}else if(e instanceof HTMLVideoElement){const s={type:"video-element",src:p0(e.src,i),autoplay:e.autoplay,loop:e.loop,muted:e.muted,crossOrigin:e.crossOrigin,preload:e.preload};t[r]=s}else{const s={type:"image-data",imageData:this._encodeImageData(e)};t[r]=s}}readData(e){switch(e.type){case"image-element":{const t=new Image;return t.src=e.src,t.crossOrigin=e.crossOrigin,t}case"canvas-element":{const t=this._decodeImageData(e.imageData),r=document.createElement("canvas");return r.width=t.width,r.height=t.height,r.getContext("2d").putImageData(t,0,0),r}case"image-data":return this._decodeImageData(e.imageData);case"video-element":{const t=document.createElement("video");return t.src=e.src,t.crossOrigin=e.crossOrigin,t.autoplay=e.autoplay,t.loop=e.loop,t.muted=e.muted,t.preload=e.preload,t}default:return}}get transparent(){const e=this.data,t=this.url;if(e instanceof HTMLCanvasElement)return this._imageDataContainsTransparent(e.getContext("2d").getImageData(0,0,e.width,e.height));if(e instanceof ImageData)return this._imageDataContainsTransparent(e);if(t){const r=t.substr(t.length-4,4).toLowerCase(),i=t.substr(0,15).toLocaleLowerCase();if(r===".png"||i==="data:image/png;")return!0}return!1}set transparent(e){e!=null?this._override("transparent",e):this._clearOverride("transparent")}get contentHash(){const e=typeof this.wrap=="string"?this.wrap:typeof this.wrap=="object"?`${this.wrap.horizontal}/${this.wrap.vertical}`:"",t=(r="")=>`d:${r},t:${this.transparent},w:${e}`;return this.url!=null?t(this.url):this.data!=null?this.data instanceof HTMLImageElement||this.data instanceof HTMLVideoElement?t(this.data.src):(mj.has(this.data)||mj.set(this.data,++K0t),t(mj.get(this.data))):t()}clone(){const e={url:this.url,data:this.data,wrap:this._cloneWrap()};return new J2(e)}cloneWithDeduplication(e){const t=e.get(this);if(t)return t;const r=this.clone();return e.set(this,r),r}_cloneWrap(){return typeof this.wrap=="string"?this.wrap:{horizontal:this.wrap.horizontal,vertical:this.wrap.vertical}}_encodeImageData(e){let t="";for(let r=0;r<e.data.length;r++)t+=String.fromCharCode(e.data[r]);return{data:btoa(t),width:e.width,height:e.height}}_decodeImageData(e){const t=atob(e.data),r=new Uint8ClampedArray(t.length);for(let i=0;i<t.length;i++)r[i]=t.charCodeAt(i);return k0t(r,e.width,e.height)}_imageDataContainsTransparent(e){for(let t=3;t<e.data.length;t+=4)if(e.data[t]!==255)return!0;return!1}static from(e){return typeof e=="string"?new J2({url:e}):e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof ImageData||e instanceof HTMLVideoElement?new J2({data:e}):GC(J2,e)}};u([d({type:String,json:{write:R1}})],hm.prototype,"url",null),u([d({json:{write:{overridePolicy(){return{enabled:!this.url}}}}}),d()],hm.prototype,"data",null),u([Xe("data")],hm.prototype,"writeData",null),u([$e("data")],hm.prototype,"readData",null),u([d({type:Boolean,json:{write:{overridePolicy(){return{enabled:this._isOverridden("transparent")}}}}})],hm.prototype,"transparent",null),u([d({json:{write:!0}})],hm.prototype,"wrap",void 0),u([d({readOnly:!0})],hm.prototype,"contentHash",null),hm=J2=u([$("esri.geometry.support.MeshTexture")],hm);const TP=hm;var VQ;let oy=VQ=class extends ye{constructor(e){super(e),this.color=null,this.colorTexture=null,this.normalTexture=null,this.alphaMode="auto",this.alphaCutoff=.5,this.doubleSided=!0}clone(){return this.cloneWithDeduplication(null,new Map)}cloneWithDeduplication(e,t){const r=b(e)?e.get(this):null;if(r)return r;const i=new VQ(this.clonePropertiesWithDeduplication(t));return b(e)&&e.set(this,i),i}clonePropertiesWithDeduplication(e){return{color:b(this.color)?this.color.clone():null,colorTexture:b(this.colorTexture)?this.colorTexture.cloneWithDeduplication(e):null,normalTexture:b(this.normalTexture)?this.normalTexture.cloneWithDeduplication(e):null,alphaMode:this.alphaMode,alphaCutoff:this.alphaCutoff,doubleSided:this.doubleSided}}};u([d({type:Me,json:{write:!0}})],oy.prototype,"color",void 0),u([d({type:TP,json:{write:!0}})],oy.prototype,"colorTexture",void 0),u([d({type:TP,json:{write:!0}})],oy.prototype,"normalTexture",void 0),u([d({nonNullable:!0,json:{write:!0}})],oy.prototype,"alphaMode",void 0),u([d({nonNullable:!0,json:{write:!0}})],oy.prototype,"alphaCutoff",void 0),u([d({nonNullable:!0,json:{write:!0}})],oy.prototype,"doubleSided",void 0),oy=VQ=u([$("esri.geometry.support.MeshMaterial")],oy);const Ise=oy;var zQ;let ay=zQ=class extends Ise{constructor(e){super(e),this.emissiveColor=null,this.emissiveTexture=null,this.occlusionTexture=null,this.metallic=1,this.roughness=1,this.metallicRoughnessTexture=null}clone(){return this.cloneWithDeduplication(null,new Map)}cloneWithDeduplication(e,t){const r=b(e)?e.get(this):null;if(r)return r;const i=new zQ(this.clonePropertiesWithDeduplication(t));return b(e)&&e.set(this,i),i}clonePropertiesWithDeduplication(e){return{...super.clonePropertiesWithDeduplication(e),emissiveColor:b(this.emissiveColor)?this.emissiveColor.clone():null,emissiveTexture:b(this.emissiveTexture)?this.emissiveTexture.cloneWithDeduplication(e):null,occlusionTexture:b(this.occlusionTexture)?this.occlusionTexture.cloneWithDeduplication(e):null,metallic:this.metallic,roughness:this.roughness,metallicRoughnessTexture:b(this.metallicRoughnessTexture)?this.metallicRoughnessTexture.cloneWithDeduplication(e):null}}};u([d({type:Me,json:{write:!0}})],ay.prototype,"emissiveColor",void 0),u([d({type:TP,json:{write:!0}})],ay.prototype,"emissiveTexture",void 0),u([d({type:TP,json:{write:!0}})],ay.prototype,"occlusionTexture",void 0),u([d({type:Number,nonNullable:!0,json:{write:!0},range:{min:0,max:1}})],ay.prototype,"metallic",void 0),u([d({type:Number,nonNullable:!0,json:{write:!0},range:{min:0,max:1}})],ay.prototype,"roughness",void 0),u([d({type:TP,json:{write:!0}})],ay.prototype,"metallicRoughnessTexture",void 0),ay=zQ=u([$("esri.geometry.support.MeshMaterialMetallicRoughness")],ay);const xIe=ay;var ok;const VS=fe.getLogger("esri.geometry.support.MeshVertexAttributes");let Dh=ok=class extends ye{constructor(e){super(e),this.color=null,this.position=new Float64Array(0),this.uv=null,this.normal=null,this.tangent=null}castColor(e){return K2(e,Uint8Array,[Uint8ClampedArray],{loggerTag:".color=",stride:4},VS)}castPosition(e){return e&&e instanceof Float32Array&&VS.warn(".position=","Setting position attribute from a Float32Array may cause precision problems. Consider storing data in a Float64Array or a regular number array"),K2(e,Float64Array,[Float32Array],{loggerTag:".position=",stride:3},VS)}castUv(e){return K2(e,Float32Array,[Float64Array],{loggerTag:".uv=",stride:2},VS)}castNormal(e){return K2(e,Float32Array,[Float64Array],{loggerTag:".normal=",stride:3},VS)}castTangent(e){return K2(e,Float32Array,[Float64Array],{loggerTag:".tangent=",stride:4},VS)}clone(){const e={position:re(this.position),uv:re(this.uv),normal:re(this.normal),tangent:re(this.tangent),color:re(this.color)};return new ok(e)}clonePositional(){const e={position:re(this.position),normal:re(this.normal),tangent:re(this.tangent),uv:this.uv,color:this.color};return new ok(e)}};function gj(e,t,r,i){const{loggerTag:s,stride:n}=t;return e.length%n!=0?(i.error(s,`Invalid array length, expected a multiple of ${n}`),new r([])):e}function K2(e,t,r,i,s){if(!e)return e;if(e instanceof t)return gj(e,i,t,s);for(const n of r)if(e instanceof n)return gj(new t(e),i,t,s);if(Array.isArray(e))return gj(new t(e),i,t,s);{const n=r.map(o=>`'${o.name}'`);return s.error(`Failed to set property, expected one of ${n}, but got ${e.constructor.name}`),new t([])}}function LO(e,t,r){t[r]=evt(e)}function evt(e){const t=new Array(e.length);for(let r=0;r<e.length;r++)t[r]=e[r];return t}u([d({json:{write:LO}})],Dh.prototype,"color",void 0),u([qt("color")],Dh.prototype,"castColor",null),u([d({nonNullable:!0,json:{write:LO}})],Dh.prototype,"position",void 0),u([qt("position")],Dh.prototype,"castPosition",null),u([d({json:{write:LO}})],Dh.prototype,"uv",void 0),u([qt("uv")],Dh.prototype,"castUv",null),u([d({json:{write:LO}})],Dh.prototype,"normal",void 0),u([qt("normal")],Dh.prototype,"castNormal",null),u([d({json:{write:LO}})],Dh.prototype,"tangent",void 0),u([qt("tangent")],Dh.prototype,"castTangent",null),Dh=ok=u([$("esri.geometry.support.MeshVertexAttributes")],Dh);var f3;const tvt=fe.getLogger("esri.geometry.support.MeshComponent");let ly=f3=class extends ye{constructor(e){super(e),this.faces=null,this.material=null,this.shading="source",this.trustSourceNormals=!1}static from(e){return GC(f3,e)}castFaces(e){return K2(e,Uint32Array,[Uint16Array],{loggerTag:".faces=",stride:3},tvt)}castMaterial(e){return GC(e&&typeof e=="object"&&("metallic"in e||"roughness"in e||"metallicRoughnessTexture"in e)?xIe:Ise,e)}clone(){return new f3({faces:re(this.faces),shading:this.shading,material:re(this.material),trustSourceNormals:this.trustSourceNormals})}cloneWithDeduplication(e,t){const r={faces:re(this.faces),shading:this.shading,material:this.material?this.material.cloneWithDeduplication(e,t):null,trustSourceNormals:this.trustSourceNormals};return new f3(r)}};u([d({json:{write:!0}})],ly.prototype,"faces",void 0),u([qt("faces")],ly.prototype,"castFaces",null),u([d({type:Ise,json:{write:!0}})],ly.prototype,"material",void 0),u([qt("material")],ly.prototype,"castMaterial",null),u([d({type:String,json:{write:!0}})],ly.prototype,"shading",void 0),u([d({type:Boolean})],ly.prototype,"trustSourceNormals",void 0),ly=f3=u([$("esri.geometry.support.MeshComponent")],ly);const rvt=ly,o8=fe.getLogger("esri.geometry.support.meshUtils.normalProjection");function ivt(e,t,r,i,s){return l8(i)?(a8(Jy.TO_PCPF,Zr.fromTypedArray(e),Ns.fromTypedArray(t),Ns.fromTypedArray(r),i,Zr.fromTypedArray(s)),s):(o8.error("Cannot convert spatial reference to PCPF"),s)}function wDt(e,t,r,i,s){return l8(i)?(a8(Jy.FROM_PCPF,Zr.fromTypedArray(e),Ns.fromTypedArray(t),Ns.fromTypedArray(r),i,Zr.fromTypedArray(s)),s):(o8.error("Cannot convert to spatial reference from PCPF"),s)}function xDt(e,t,r){return mi(e,t,0,r,rg(t),0,e.length/3),r}function TDt(e,t,r){return mi(e,rg(r),0,t,r,0,e.length/3),t}function svt(e,t,r){if(R(e))return t;const i=Ns.fromTypedArray(e),s=Ns.fromTypedArray(t);return RL(s,i,r),t}function nvt(e,t,r){if(R(e))return t;AA(Xn,r);const i=Zr.fromTypedArray(e),s=Zr.fromTypedArray(t);return G1(s,i,Xn),Tie(Xn)||xse(s,s),t}function ovt(e,t,r){if(R(e))return t;AA(Xn,r);const i=Zr.fromTypedArray(e,4*Float32Array.BYTES_PER_ELEMENT),s=Zr.fromTypedArray(t,4*Float32Array.BYTES_PER_ELEMENT);if(G1(s,i,Xn),Tie(Xn)||xse(s,s),e!==t)for(let n=3;n<e.length;n+=4)t[n]=e[n];return t}function avt(e,t,r,i,s){if(!l8(i))return o8.error("Cannot convert spatial reference to PCPF"),s;a8(Jy.TO_PCPF,Zr.fromTypedArray(e,4*Float32Array.BYTES_PER_ELEMENT),Ns.fromTypedArray(t),Ns.fromTypedArray(r),i,Zr.fromTypedArray(s,4*Float32Array.BYTES_PER_ELEMENT));for(let n=3;n<e.length;n+=4)s[n]=e[n];return s}function SDt(e,t,r,i,s){if(!l8(i))return o8.error("Cannot convert to spatial reference from PCPF"),s;a8(Jy.FROM_PCPF,Zr.fromTypedArray(e,16),Ns.fromTypedArray(t),Ns.fromTypedArray(r),i,Zr.fromTypedArray(s,16));for(let n=3;n<e.length;n+=4)s[n]=e[n];return s}function a8(e,t,r,i,s,n){if(!t)return;const o=r.count,a=rg(s);if(TIe(s))for(let l=0;l<o;l++)i.getVec(l,uF),t.getVec(l,zf),bh(a,uF,hF,a),Gd(Xn,hF),e===Jy.FROM_PCPF&&jd(Xn,Xn),Hc(zf,zf,Xn),n.setVec(l,zf);else for(let l=0;l<o;l++){i.getVec(l,uF),t.getVec(l,zf),bh(a,uF,hF,a),Gd(Xn,hF);const c=xU(r.get(l,1));let h=Math.cos(c);e===Jy.TO_PCPF&&(h=1/h),Xn[0]*=h,Xn[1]*=h,Xn[2]*=h,Xn[3]*=h,Xn[4]*=h,Xn[5]*=h,e===Jy.FROM_PCPF&&jd(Xn,Xn),Hc(zf,zf,Xn),we(zf,zf),n.setVec(l,zf)}return n}function l8(e){return TIe(e)||lvt(e)}function TIe(e){return e.isWGS84||pbe(e)||hg(e)||dg(e)}function lvt(e){return e.isWebMercator}var Jy;(function(e){e[e.TO_PCPF=0]="TO_PCPF",e[e.FROM_PCPF=1]="FROM_PCPF"})(Jy||(Jy={}));const uF=M(),zf=M(),hF=Ce(),Xn=$i();function cvt(e){const t=new Yr;t.include(ra),t.include(oS,e),t.include(xPe,e),ph(t,e);const{vertex:r,fragment:i}=t;return e.stippleEnabled&&(t.attributes.add(O.UV0,"vec2"),t.attributes.add(O.AUXPOS1,"vec3"),r.uniforms.add(new lr("viewport",(s,n)=>n.camera.fullViewport))),t.attributes.add(O.POSITION,"vec3"),t.varyings.add("vpos","vec3"),r.code.add(S`void main(void) {
vpos = position;
forwardNormalizedVertexColor();
gl_Position = transformPosition(proj, view, vpos);`),e.stippleEnabled&&(r.code.add(S`vec4 vpos2 = transformPosition(proj, view, auxpos1);
vec2 ndcToPixel = viewport.zw * 0.5;
float lineSegmentPixelSize = length((vpos2.xy / vpos2.w - gl_Position.xy / gl_Position.w) * ndcToPixel);`),e.draped?r.uniforms.add(new qe("worldToScreenRatio",(s,n)=>1/n.screenToPCSRatio)):r.code.add(S`vec3 segmentCenter = (position + auxpos1) * 0.5;
float worldToScreenRatio = computeWorldToScreenRatio(segmentCenter);`),r.code.add(S`float discreteWorldToScreenRatio = discretizeWorldToScreenRatio(worldToScreenRatio);`),e.draped?r.code.add(S`float startPseudoScreen = uv0.y * discreteWorldToScreenRatio - mix(0.0, lineSegmentPixelSize, uv0.x);
float segmentLengthPseudoScreen = lineSegmentPixelSize;`):r.code.add(S`float segmentLengthRender = length(position - auxpos1);
float startPseudoScreen = mix(uv0.y, uv0.y - segmentLengthRender, uv0.x) * discreteWorldToScreenRatio;
float segmentLengthPseudoScreen = segmentLengthRender * discreteWorldToScreenRatio;`),r.code.add(S`vec2 stippleDistanceLimits = computeStippleDistanceLimits(startPseudoScreen, segmentLengthPseudoScreen, lineSegmentPixelSize, stipplePatternPixelSize);
vStippleDistance = mix(stippleDistanceLimits.x, stippleDistanceLimits.y, uv0.x);
vStippleDistance *= gl_Position.w;`)),r.code.add(S`}`),e.output===K.Highlight&&t.include(D0),t.include(Ss,e),i.uniforms.add(new qe("alphaCoverage",(s,n)=>Math.min(1,s.width*n.camera.pixelRatio))),e.hasVertexColors||i.uniforms.add(new lr("constantColor",s=>s.color)),i.code.add(S`
  void main() {
    discardBySlice(vpos);

    vec4 color = ${e.hasVertexColors?"vColor":"constantColor"};

    float stippleAlpha = getStippleAlpha();
    discardByStippleAlpha(stippleAlpha, stippleAlphaColorDiscard);

    vec4 finalColor = blendStipple(vec4(color.rgb, color.a * alphaCoverage), stippleAlpha);

    if (finalColor.a < ${S.float(sa)}) {
      discard;
    }

    ${e.output===K.Color?S`gl_FragColor = highlightSlice(finalColor, vpos);`:""}
    ${e.output===K.Highlight?S`outputHighlight();`:""}
  }
  `),t}const uvt=Object.freeze(Object.defineProperty({__proto__:null,build:cvt},Symbol.toStringTag,{value:"Module"}));class c8 extends gi{constructor(t,r,i){super(t,r,i),this.stipplePattern=null,this.stippleTextureBind=null,this.stippleTextureRepository=t.stippleTextureRepository}get stippleEnabled(){return this.configuration.stippleEnabled&&this.configuration.output!==K.Highlight}initializeProgram(t){const r=c8.shader.get().build(this.configuration);return new oi(t.rctx,r,zr)}destroy(){super.destroy(),this.stippleTextureRepository.release(this.stipplePattern),this.stipplePattern=null,this.stippleTextureBind=null}bindPass(t,r){if(this.program.bindPass(t,r),this.stipplePattern!==t.stipplePattern){const i=t.stipplePattern;this.stippleTextureBind=this.stippleTextureRepository.swap(this.stipplePattern,i),this.stipplePattern=i}if(this.stippleEnabled){const{pixelSize:i,sdfNormalizer:s,pixels:n}=b(this.stippleTextureBind)?this.stippleTextureBind(this.program):{pixelSize:1,sdfNormalizer:1,pixels:1};this.program.setUniform1f("stipplePatternSDFNormalizer",s),this.program.setUniform1f("stipplePatternTextureSize",n),this.program.setUniform1f("stipplePatternPixelSize",i),this.program.setUniform1f("stipplePatternPixelSizeInv",1/i)}}initializePipeline(){const t=this.configuration,r=No(Ae.SRC_ALPHA,Ae.ONE,Ae.ONE_MINUS_SRC_ALPHA,Ae.ONE_MINUS_SRC_ALPHA),i=(s,n=null,o=null)=>Gt({blending:n,depthTest:Sse,depthWrite:o,colorWrite:or,stencilWrite:t.hasOccludees?cg:null,stencilTest:t.hasOccludees?s?j1:rb:null});return t.output===K.Color?(this._occludeePipelineState=i(!0,t.transparent||this.stippleEnabled?r:null,cc),i(!1,t.transparent||this.stippleEnabled?r:null,cc)):i(!1)}get primitiveType(){return Lt.LINES}getPipelineState(t,r){return r?this._occludeePipelineState:super.getPipelineState(t,r)}}c8.shader=new ni(uvt,()=>ie(()=>import("./NativeLine.glsl.f704129c.js"),[],import.meta.url));class Mu extends Ca{constructor(){super(...arguments),this.output=K.Color,this.hasSlicePlane=!1,this.hasVertexColors=!1,this.transparent=!1,this.draped=!1,this.stippleEnabled=!1,this.stippleOffColorEnabled=!1,this.stipplePreferContinuous=!0,this.hasOccludees=!1}}u([q({count:K.COUNT})],Mu.prototype,"output",void 0),u([q()],Mu.prototype,"hasSlicePlane",void 0),u([q()],Mu.prototype,"hasVertexColors",void 0),u([q()],Mu.prototype,"transparent",void 0),u([q()],Mu.prototype,"draped",void 0),u([q()],Mu.prototype,"stippleEnabled",void 0),u([q()],Mu.prototype,"stippleOffColorEnabled",void 0),u([q()],Mu.prototype,"stipplePreferContinuous",void 0),u([q()],Mu.prototype,"hasOccludees",void 0),u([q({constValue:!1})],Mu.prototype,"stippleRequiresClamp",void 0),u([q({constValue:!1})],Mu.prototype,"stippleScaleWithLineWidth",void 0),u([q({constValue:!1})],Mu.prototype,"stippleRequiresStretchMeasure",void 0);const hvt=fe.getLogger("esri.views.3d.webgl-engine.materials.NativeLineMaterial");var az;(function(e){e[e.START=0]="START",e[e.END=1]="END"})(az||(az={}));class ome extends Tg{constructor(t){super(t,new fvt),this._techniqueConfig=new Mu}getConfiguration(t,r){this._techniqueConfig.output=t,this._techniqueConfig.hasSlicePlane=this.parameters.hasSlicePlane,this._techniqueConfig.hasVertexColors=this.parameters.hasVertexColors,this._techniqueConfig.transparent=this.parameters.color[3]<1||this.parameters.width<1,this._techniqueConfig.draped=r.slot===Se.DRAPED_MATERIAL;const i=b(this.parameters.stipplePattern);return this._techniqueConfig.stippleEnabled=i,this._techniqueConfig.stippleOffColorEnabled=i&&b(this.parameters.stippleOffColor),this._techniqueConfig.hasOccludees=this.parameters.hasOccludees,this._techniqueConfig.stipplePreferContinuous=this.parameters.stipplePreferContinuous,this._techniqueConfig}intersect(t,r,i,s,n,o,a,l,c){b(c)?Ndt(t,s,c,o,1,a):this._intersectLineGeometry(t,r,i,s,a)}_intersectLineGeometry(t,r,i,s,n){if(!s.options.selectionMode||_L(r))return;if(!FOe(i))return void hvt.error("intersection assumes a translation-only matrix");const o=t.vertexAttributes.get(O.POSITION).data,a=s.camera,l=gvt;Do(l,s.point);const c=2;se(DO[0],l[0]-c,l[1]+c,0),se(DO[1],l[0]+c,l[1]+c,0),se(DO[2],l[0]+c,l[1]-c,0),se(DO[3],l[0]-c,l[1]-c,0);for(let g=0;g<4;g++)if(!a.unprojectFromRenderScreen(DO[g],Dg[g]))return;xa(a.eye,Dg[0],Dg[1],yj),xa(a.eye,Dg[1],Dg[2],vj),xa(a.eye,Dg[2],Dg[3],_j),xa(a.eye,Dg[3],Dg[0],bj);let h=Number.MAX_VALUE,p=0;for(let g=0;g<o.length-5;g+=3){if(Qa[0]=o[g]+i[12],Qa[1]=o[g+1]+i[13],Qa[2]=o[g+2]+i[14],Ja[0]=o[g+3]+i[12],Ja[1]=o[g+4]+i[13],Ja[2]=o[g+5]+i[14],ui(yj,Qa)<0&&ui(yj,Ja)<0||ui(vj,Qa)<0&&ui(vj,Ja)<0||ui(_j,Qa)<0&&ui(_j,Ja)<0||ui(bj,Qa)<0&&ui(bj,Ja)<0)continue;if(a.projectToRenderScreen(Qa,Ob),a.projectToRenderScreen(Ja,Mb),Ob[2]<0&&Mb[2]>0){pe(Bf,Qa,Ja);const w=a.frustum,_=-ui(w[ci.NEAR],Qa)/Te(Bf,w[ci.NEAR]);le(Bf,Bf,_),de(Qa,Qa,Bf),a.projectToRenderScreen(Qa,Ob)}else if(Ob[2]>0&&Mb[2]<0){pe(Bf,Ja,Qa);const w=a.frustum,_=-ui(w[ci.NEAR],Ja)/Te(Bf,w[ci.NEAR]);le(Bf,Bf,_),de(Ja,Ja,Bf),a.projectToRenderScreen(Ja,Mb)}else if(Ob[2]<0&&Mb[2]<0)continue;Ob[2]=0,Mb[2]=0;const v=mte(Bx(Ob,Mb,cme),l);v<h&&(h=v,ae(ame,Qa),ae(lme,Ja),p=g/3)}const f=s.rayBegin,m=s.rayEnd;if(h<c*c){let g=Number.MAX_VALUE;if(UTe(Bx(ame,lme,cme),Bx(f,m,mvt),Rb)){pe(Rb,Rb,f);const v=Re(Rb);le(Rb,Rb,1/v),g=v/pi(f,m)}n(g,Rb,p,!1)}}computeAttachmentOrigin(t,r){const i=t.vertexAttributes;if(!i)return!1;const s=i.get(O.POSITION);return Mie(s,null,!1,r)}requiresSlot(t){return t===Se.OPAQUE_MATERIAL||t===Se.DRAPED_MATERIAL}createGLMaterial(t){return t.output===K.Color||t.output===K.Highlight?new dvt(t):null}createBufferWriter(){const t=this.parameters.hasVertexColors?UPe:Sgt;return R(this.parameters.stipplePattern)?new KB(t):new pvt(t.clone().vec3f(O.AUXPOS1).vec2f(O.UV0))}}class dvt extends J1{_updateOccludeeState(t){t.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:t.hasOccludees})}beginSlot(t){return this._output===K.Color&&this._updateOccludeeState(t),this.ensureTechnique(c8,t)}}class pvt{constructor(t){this.vertexBufferLayout=t}allocate(t){return this.vertexBufferLayout.createBuffer(t)}elementCount(t){return t.indices.get(O.POSITION).length}write(t,r,i,s){$B(r,this.vertexBufferLayout,t.transformation,t.invTranspTransformation,i,s),this._writeAuxpos1(t,r,i,s),this._writeUV0(t,r,i,s)}_writeAuxpos1(t,r,i,s){const n=i.getField(O.AUXPOS1,Zr),o=r.indices.get(O.POSITION),a=r.vertexAttributes.get(O.POSITION).data,l=t.transformation,c=n.typedBufferStride,h=n.typedBuffer;s*=c;for(let p=0;p<o.length-1;p+=2)for(const f of[1,0]){const m=3*o[p+f],g=a[m],v=a[m+1],w=a[m+2],_=l[0]*g+l[4]*v+l[8]*w+l[12],T=l[1]*g+l[5]*v+l[9]*w+l[13],x=l[2]*g+l[6]*v+l[10]*w+l[14];h[s]=_,h[s+1]=T,h[s+2]=x,s+=c}}_writeUV0(t,r,i,s){var E;const n=i.getField(O.UV0,Hd),o=r.indices.get(O.POSITION),a=r.vertexAttributes.get(O.POSITION).data,l=(E=r.vertexAttributes.get(O.DISTANCETOSTART))==null?void 0:E.data,c=t.transformation,h=n.typedBufferStride,p=n.typedBuffer;let f=0;p[s*=h]=az.START,p[s+1]=f,s+=h;const m=3*o[0],g=se(Qa,a[m],a[m+1],a[m+2]);c&&Ve(g,g,c);const v=Ja,w=o.length-1;let _=1;const T=l?(C,A,P)=>f=l[P]:(C,A,P)=>f+=pi(C,A);for(let C=1;C<w;C+=2){const A=3*o[C];se(v,a[A],a[A+1],a[A+2]),c&&Ve(v,v,c),T(g,v,_++);for(let P=0;P<2;++P)p[s]=1-P,p[s+1]=f,s+=h;ae(g,v)}const x=3*o[w];se(v,a[x],a[x+1],a[x+2]),c&&Ve(v,v,c),T(g,v,_),p[s]=az.END,p[s+1]=f}}class fvt extends IR{constructor(){super(...arguments),this.color=Sd,this.hasVertexColors=!1,this.hasSlicePlane=!1,this.width=1,this.stipplePreferContinuous=!0,this.hasOccludees=!1}}const Qa=M(),Ja=M(),Bf=M(),Rb=M(),Ob=ea(),Mb=ea(),ame=M(),lme=M(),cme=yg(),mvt=yg(),gvt=M(),DO=[ea(),ea(),ea(),ea()],Dg=[M(),M(),M(),M()],yj=Er(),vj=Er(),_j=Er(),bj=Er(),yvt=["mesh"];class vvt extends Eg{constructor(t,r,i,s){super(t,r,i,s),this._materials=new Map,this._textures=new Map,this.ensureDrapedStatus(!1)}async doLoad(){Xr.DRAW_MESH_GEOMETRY_NORMALS&&(this._debugVertexNormalMaterial=new ome({color:[1,0,1,1]}),this._debugFaceNormalMaterial=new ome({color:[0,1,1,1]}))}destroy(){super.destroy(),this._context.stage.removeMany(Array.from(this._materials.values(),t=>t.material)),this._context.stage.removeMany(Array.from(this._textures.values())),this._materials.clear(),this._textures.clear()}createGraphics3DGraphic(t){const r=t.graphic;if(!this._validateGeometry(r.geometry,yvt,"fill on mesh-3d"))return null;const i=this.setGraphicElevationContext(r,new Ah),s=t.renderingInfo;return this._createAs3DShape(r,s,i,r.uid)}layerOpacityChanged(t,r){const i=this._getLayerOpacity();return this._materials.forEach(s=>{s.material.setParameters({layerOpacity:i});const n=s.material.parameters;this._setMaterialTransparentParameter(n,s),s.material.setParameters({transparent:n.transparent})}),t.forEach(s=>{const n=r(s);b(n)&&n.layerOpacityChanged(i,this._context.isAsync)}),!0}layerElevationInfoChanged(t,r){return this.updateGraphics3DGraphicElevationInfo(t,r,B1)}slicePlaneEnabledChanged(t,r){return this._materials.forEach(i=>{i.material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled})}),t.forEach(i=>{const s=r(i);b(s)&&s.slicePlaneEnabledChanged(this._context.slicePlaneEnabled,this._context.isAsync)}),!0}physicalBasedRenderingChanged(){const t=this._usePBR();return this._materials.forEach(r=>r.material.setParameters({usePBR:t})),!0}pixelRatioChanged(){return!0}_requiresSymbolVertexColors(){return this._drivenProperties.color||this._drivenProperties.opacity}_colorOrTextureUid(t){return R(t)?"-":t instanceof Me?t.toHex():t.contentHash}_materialPropertiesDefault(t,r){const i=this._requiresSymbolVertexColors(),s=!!t.vertexAttributes.color,n=!!t.vertexAttributes.tangent;return{hasSymbolVertexColors:i,hasVertexColors:s,hasVertexTangents:n,uid:`vc:${s},vt:${n},vct${r},svc:${i}`}}_materialProperties(t,r,i){const s=this._materialPropertiesDefault(t,i);if(!r.material)return s;const{color:n,colorTexture:o,normalTexture:a,doubleSided:l,alphaCutoff:c,alphaMode:h}=r.material,p=this._colorOrTextureUid(n),f=this._colorOrTextureUid(o),m=this._colorOrTextureUid(a);if(s.color=n,s.colorTexture=o,s.normalTexture=a,s.uid=`${s.uid},cmuid:${p},ctmuid:${f},ntmuid:${m},ds:${l},ac:${c},am:${h}`,r.material instanceof xIe){const{metallic:g,roughness:v,metallicRoughnessTexture:w,emissiveColor:_,emissiveTexture:T,occlusionTexture:x}=r.material,E=this._colorOrTextureUid(w),C=this._colorOrTextureUid(_),A=this._colorOrTextureUid(T),P=this._colorOrTextureUid(x);s.metallic=g,s.roughness=v,s.metallicRoughnessTexture=w,s.emissiveColor=_,s.emissiveTexture=T,s.occlusionTexture=x,s.uid=`${s.uid},mrm:${g},mrr:${v},mrt:${E},emuid:${C},etmuid:${A},otmuid:${P}`}return s}_setInternalColorValueParameters(t,r){r.diffuse=Me.toUnitRGB(t),r.opacity=t.a}_getLoadableTextureResource(t){return t.data?t.data:t.url}_getInternalTextureId(t){const r=this._getInternalTexture(t,hi.Opaque);return b(r)?r.id:null}_getInternalTexture(t,r){const i=this._getLoadableTextureResource(t);if(!i)return null;const s=`${t.contentHash}/${r}`;let n=this._textures.get(s);return n||(n=new Hs(i,{mipmap:!0,wrap:this._castTextureWrap(t.wrap),noUnpackFlip:!0,preMultiplyAlpha:r!==hi.Opaque}),this._textures.set(s,n),this._context.stage.add(n),this._context.stage.loadImmediate(n)),n}_castTextureWrap(t="repeat"){if(typeof t=="string"){const r=this._castTextureWrapIndividual(t);return{s:r,t:r}}return{s:this._castTextureWrapIndividual(t.horizontal),t:this._castTextureWrapIndividual(t.vertical)}}_castTextureWrapIndividual(t){switch(t){case"clamp":return xt.CLAMP_TO_EDGE;case"mirror":return xt.MIRRORED_REPEAT;default:return xt.REPEAT}}_setInternalMaterialParameters(t,r){if(b(t.color)&&this._setInternalColorValueParameters(t.color,r),b(t.colorTexture)){const i=this._getInternalTexture(t.colorTexture,r.textureAlphaMode);b(i)?(r.textureId=i.id,r.textureAlphaPremultiplied=!!i.params.preMultiplyAlpha):r.textureId=void 0}b(t.normalTexture)&&(r.normalTextureId=this._getInternalTextureId(t.normalTexture)),b(t.emissiveColor)&&(r.emissiveFactor=Me.toUnitRGB(t.emissiveColor)),b(t.emissiveTexture)&&(r.emissiveTextureId=this._getInternalTextureId(t.emissiveTexture)),b(t.occlusionTexture)&&(r.occlusionTextureId=this._getInternalTextureId(t.occlusionTexture)),b(t.metallicRoughnessTexture)&&(r.metallicRoughnessTextureId=this._getInternalTextureId(t.metallicRoughnessTexture))}_setExternalMaterialParameters(t){const r=this._drivenProperties.color;let i=b(this.symbolLayer.material)?this.symbolLayer.material.colorMixMode:null;if(r)t.externalColor=Sd;else{const s=b(this.symbolLayer.material)?this.symbolLayer.material.color:null;b(s)?t.externalColor=Me.toUnitRGBA(s):(i=null,t.externalColor=Sd)}i&&(t.colorMixMode=i),t.castShadows=!!this.symbolLayer.castShadows}_hasTransparentVertexColors(t){const r=t.vertexAttributes.color;if(R(r))return!1;for(let i=3;i<r.length;i+=4)if(r[i]!==255)return!0;return!1}_getOrCreateMaterial(t,r){var g,v,w;const i=(g=r.material)==null?void 0:g.color,s=(v=r.material)==null?void 0:v.colorTexture,n=(w=r.material)==null?void 0:w.alphaMode,o=n==="blend",a=n!=="opaque"&&(this._hasTransparentVertexColors(t)||b(i)&&i.a<1||b(s)&&s.transparent||o),l=this._materialProperties(t,r,a),c=this._materials.get(l.uid);if(c)return c.material;const h={material:null,isComponentTransparent:a,alphaMode:r.material?r.material.alphaMode:"opaque"},p=l.metallicRoughnessTexture==null&&l.metallic==null&&l.roughness==null,f={usePBR:this._usePBR(),isSchematic:p,hasVertexColors:l.hasVertexColors,hasSymbolColors:l.hasSymbolVertexColors,hasVertexTangents:l.hasVertexTangents,ambient:dl,diffuse:Nm,opacity:1,doubleSided:!0,doubleSidedType:"winding-order",cullFace:fi.None,layerOpacity:this._getLayerOpacity(),hasSlicePlane:this._context.slicePlaneEnabled,initTextureTransparent:!0};p||(f.mrrFactors=[l.metallic!=null?l.metallic:1,l.roughness!=null?l.roughness:1,.5]),r.material&&(f.doubleSided=r.material.doubleSided,f.cullFace=r.material.doubleSided?fi.None:fi.Back,f.textureAlphaCutoff=r.material.alphaCutoff),this._setExternalMaterialParameters(f),this._setMaterialTransparentParameter(f,h),this._setInternalMaterialParameters(l,f);const m=new DT(f);return h.material=m,this._materials.set(l.uid,h),this._context.stage.add(m),m}_usePBR(){return this._context.physicalBasedRenderingEnabled}_setMaterialTransparentParameter(t,r){t.transparent=this.needsDrivenTransparentPass||r.isComponentTransparent||t.layerOpacity<1||t.opacity<1||t.externalColor&&t.externalColor[3]<1,r.alphaMode==="auto"?t.textureAlphaMode=t.transparent?hi.MaskBlend:hi.Opaque:t.textureAlphaMode=r.alphaMode==="opaque"?hi.Opaque:r.alphaMode==="mask"?hi.Mask:hi.Blend}_addDebugNormals(t,r,i,s){const n=r.length,o=t.spatialReference.isGeographic?20015077/180:1,a=.1*Math.max(t.extent.width*o,t.extent.height*o,t.extent.zmax-t.extent.zmin),l=[],c=[],h=[],p=[];for(let g=0;g<n;g++){const v=r[g],w=v.vertexAttributes.get(O.POSITION),_=v.vertexAttributes.get(O.NORMAL),T=v.indices.get(O.POSITION),x=v.indices.get(O.NORMAL),E=w.data,C=_.data;for(let A=0;A<T.length;A++){const P=3*T[A],I=3*x[A];for(let L=0;L<3;L++)l.push(E[P+L]);for(let L=0;L<3;L++)l.push(E[P+L]+C[I+L]*a);if(c.push(c.length),c.push(c.length),A%3==0){this._calculateFaceNormal(E,T,A,GS),this._getFaceVertices(E,T,A,zo,zS,BS),de(zo,zo,zS),de(zo,zo,BS),le(zo,zo,1/3);for(let L=0;L<3;L++)h.push(zo[L]);for(let L=0;L<3;L++)h.push(zo[L]+GS[L]*a);p.push(p.length),p.push(p.length)}}}const f=new Bi([[O.POSITION,{data:l,size:3,exclusive:!0}]],[[O.POSITION,new Uint32Array(c)]],rc.Line);r.push(f),i.push(this._debugVertexNormalMaterial),s.push(zx(s[0]));const m=new Bi([[O.POSITION,{data:h,size:3,exclusive:!0}]],[[O.POSITION,new Uint32Array(p)]],rc.Line);r.push(m),i.push(this._debugFaceNormalMaterial),s.push(zx(s[0]))}_createAs3DShape(t,r,i,s){const n=t.geometry;if(n.type!=="mesh")return null;const o=this._createGeometryInfo(n,r);if(!o)return null;const{geometries:a,materials:l,transformations:c,objectTransformation:h}=o;Xr.DRAW_MESH_GEOMETRY_NORMALS&&this._addDebugNormals(n,a,l,c);const p=new k0({geometries:a,materials:l,transformations:c,metadata:{layerUid:this._context.layer.uid,graphicUid:s}});p.transformation=h;const f=this._createEdgeMaterial(),m=b(f)?{baseMaterial:l[0],edgeMaterials:[f],properties:{mergeGeometries:!0,hasSlicePlane:this._context.slicePlaneEnabled}}:null,g=new Sg(this,p,a,null,null,a$,i,m);return g.needsElevationUpdates=B1(i.mode),g.useObjectOriginAsAttachmentOrigin=!0,g.elevationContext.centerPointInElevationSR=this._getCenterPointInElevationSR(p),g.alignedSampledElevation=a$(g,g.elevationContext,this._context.elevationProvider,this._context.renderCoordsHelper),g}_getCenterPointInElevationSR(t){const r=F0(0,0,0,this._context.elevationProvider.spatialReference);return cTe([t.transformation[12],t.transformation[13],t.transformation[14]],this._context.renderCoordsHelper.spatialReference,r),r}_createComponentNormals(t,r,i,s){switch(i.shading||"flat"){case"source":return this._createComponentNormalsSource(t,r,i,s);case"flat":return this._createComponentNormalsFlat(t,s);case"smooth":return this._createComponentNormalsSmooth(t,s);default:return}}_createComponentNormalsSource(t,r,i,s){if(R(r))return this._createComponentNormalsFlat(t,s);let n=!1;if(!i.trustSourceNormals)for(let o=0;o<s.length;o+=3){this._calculateFaceNormal(t,s,o,GS);for(let a=0;a<3;a++){const l=3*s[o+a];zo[0]=r[l+0],zo[1]=r[l+1],zo[2]=r[l+2],Te(GS,zo)<0&&(r[l+0]=-r[l+0],r[l+1]=-r[l+1],r[l+2]=-r[l+2],n=!0)}}return{normals:r,indices:s,didFlipNormals:n}}_createComponentNormalsFlat(t,r){const i=new Float32Array(r.length),s=new Uint32Array(3*r.length);for(let n=0;n<r.length;n+=3){const o=this._calculateFaceNormal(t,r,n,GS);for(let a=0;a<3;a++)i[n+a]=o[a],s[n+a]=n/3}return{normals:i,indices:s,didFlipNormals:!1}}_createComponentNormalsSmooth(t,r){const i={};for(let o=0;o<r.length;o+=3){const a=this._calculateFaceNormal(t,r,o,GS);for(let l=0;l<3;l++){const c=r[o+l];let h=i[c];h||(h={normal:M(),count:0},i[c]=h),de(h.normal,h.normal,a),h.count++}}const s=new Float32Array(3*r.length),n=new Uint32Array(3*r.length);for(let o=0;o<r.length;o++){const a=i[r[o]];a.count!==1&&(we(a.normal,a.normal),a.count=1);for(let l=0;l<3;l++)s[3*o+l]=a.normal[l];n[o]=o}return{normals:s,indices:n,didFlipNormals:!1}}_getFaceVertices(t,r,i,s,n,o){const a=3*r[i+0],l=3*r[i+1],c=3*r[i+2];s[0]=t[a+0],s[1]=t[a+1],s[2]=t[a+2],n[0]=t[l+0],n[1]=t[l+1],n[2]=t[l+2],o[0]=t[c+0],o[1]=t[c+1],o[2]=t[c+2]}_calculateFaceNormal(t,r,i,s){return this._getFaceVertices(t,r,i,zo,zS,BS),pe(zS,zS,zo),pe(BS,BS,zo),ut(zo,zS,BS),we(s,zo),s}_getOrCreateComponents(t){return _t(t.components,_vt)}_createPositionBuffer(t,r){let i=t.vertexAttributes.position;const s=r.reprojection===Nu.ECEF?r.transformBeforeProject:null;if(b(s)&&(i=svt(i,new Float64Array(i.length),s)),r.reprojection===Nu.NONE)return r.needsBufferCopy?new Float64Array(i):i;const n=b(s)?i:new Float64Array(i.length);return mi(i,t.spatialReference,0,n,this._context.renderCoordsHelper.spatialReference,0,i.length/3),n}_createNormalBuffer(t,r,i){let s=t.vertexAttributes.normal;if(R(s))return null;const n=i.reprojection===Nu.ECEF?i.transformBeforeProject:null;if(b(n)&&(s=nvt(s,new Float32Array(s.length),n)),this._context.graphicsCoreOwner.view.viewingMode==="local"||i.reprojection===Nu.NONE)return i.needsBufferCopy&&t.vertexAttributes.normal===s?new Float32Array(s):s;const o=t.vertexAttributes.position,a=b(n)?s:new Float32Array(s.length);return ivt(s,o,r,t.spatialReference,a)}_createTangentBuffer(t,r,i){let s=t.vertexAttributes.tangent;if(R(s))return null;const n=i.reprojection===Nu.ECEF?i.transformBeforeProject:null;if(b(n)&&(s=ovt(s,new Float32Array(s.length),n)),this._context.graphicsCoreOwner.view.viewingMode==="local"||i.reprojection===Nu.NONE)return i.needsBufferCopy&&t.vertexAttributes.normal===s?new Float32Array(s):s;const o=t.vertexAttributes.position,a=b(n)?s:new Float32Array(s.length);return avt(s,o,r,t.spatialReference,a)}_createColorBuffer(t){return t.vertexAttributes.color}_createSymbolColorBuffer(t){if(this._requiresSymbolVertexColors()){const r=this._getVertexOpacityAndColor(t),i=KPe(ki(this.symbolLayer,"material","colorMixMode")),s=new Uint8Array(4);return eIe(r,i,s),s}return null}_createBuffers(t,r){const i=t.vertexAttributes&&t.vertexAttributes.position;if(!i)return this.logger.warn("Mesh geometry must contain position vertex attributes"),null;const s=t.vertexAttributes.normal,n=t.vertexAttributes.uv,o=t.vertexAttributes.tangent;if(b(s)&&s.length!==i.length)return this.logger.warn("Mesh normal vertex buffer must contain the same number of elements as the position buffer"),null;if(b(o)&&o.length/4!=i.length/3)return this.logger.warn("Mesh tangent vertex buffer must contain the same number of elements as the position buffer"),null;if(b(n)&&n.length/2!=i.length/3)return this.logger.warn("Mesh uv vertex buffer must contain the same number of elements as the position buffer"),null;const a=this._computeReprojectionInfo(t),l=this._createPositionBuffer(t,a),c=this._createColorBuffer(t),h=this._createSymbolColorBuffer(r),p=this._createNormalBuffer(t,l,a),f=this._createTangentBuffer(t,l,a);return{positionBuffer:l,normalBuffer:p,tangentBuffer:f,uvBuffer:n,colorBuffer:c,symbolColorBuffer:h,objectTransformation:a.reprojection===Nu.NONE&&b(a.objectTransformation)?a.objectTransformation:this._transformOriginLocal(t,l,p,f),geometryTransformation:a.reprojection===Nu.NONE&&b(a.geometryTransformation)?a.geometryTransformation:Ce()}}_computeReprojectionInfo(t){const r=b(t.transform),i=r&&t.transform.geographic||this._context.renderCoordsHelper.viewingMode===Be.Local?Nu.NONE:Nu.ECEF;if(r){if(i===Nu.NONE){const n=Ce();return bh(t.spatialReference,t.transform.origin,n,this._context.renderCoordsHelper.spatialReference),{reprojection:i,objectTransformation:n,geometryTransformation:zx(t.transform.localMatrix),needsBufferCopy:!1}}const s=b6(Ce(),t.transform.origin);return Yi(s,s,t.transform.localMatrix),{reprojection:i,transformBeforeProject:s,needsBufferCopy:!0}}return{reprojection:i,needsBufferCopy:!0}}_transformOriginLocal(t,r,i,s){const n=this._context.renderCoordsHelper.spatialReference,o=t.anchor;dF[0]=o.x,dF[1]=o.y,dF[2]=o.z;const a=Ce();bh(t.spatialReference,dF,a,n);const l=Ns.fromTypedArray(r);if(Cs(ume,a),RL(l,l,ume),b(i)||b(s)){if(Gd(NO,a),jd(NO,NO),b(i)){const c=Zr.fromTypedArray(i);G1(c,c,NO)}if(b(s)){const c=Zr.fromTypedArray(s,4*s.BYTES_PER_ELEMENT);G1(c,c,NO)}}return a}_validateFaces(t,r){const i=t.vertexAttributes.position.length/3,s=r.faces;if(s){let n=-1;for(let o=0;o<s.length;o++){const a=s[o];a>n&&(n=a)}if(i<=n)return this.logger.warn(`Vertex index ${n} is out of bounds of the mesh position buffer`),!1}else if(i%3!=0)return this.logger.warn("Mesh position buffer length must be a multiple of 9 if no component faces are defined (3 values per vertex * 3 vertices per triangle)"),!1;return!0}_getOrCreateFaces(t,r){return r.faces?r.faces:DA(t.vertexAttributes.position.length/3)}_isOutsideClippingArea(t){if(!this._context.clippingExtent)return!1;const r=t.vertexAttributes&&t.vertexAttributes.position;if(!r)return!1;const i=this._context.elevationProvider.spatialReference;let s;const n=r.length/3;return t.spatialReference.equals(i)?s=r:(s=new Float64Array(r.length),mi(t.vertexAttributes.position,t.spatialReference,0,s,i,0,n)),vi(wj),nh(wj,s,0,n),!rf(wj,this._context.clippingExtent)}_createGeometryInfo(t,r){if(!sg(t.spatialReference,this._context.graphicsCoreOwner.view.spatialReference))return this.logger.warn("Geometry spatial reference is not compatible with the view"),null;if(this._isOutsideClippingArea(t))return null;const i=this._createBuffers(t,r);if(R(i))return null;const{positionBuffer:s,uvBuffer:n,colorBuffer:o,symbolColorBuffer:a,normalBuffer:l,tangentBuffer:c,objectTransformation:h,geometryTransformation:p}=i,f=this._getOrCreateComponents(t),m=[],g=[],v=[];let w=!1;for(const _ of f){if(!this._validateFaces(t,_))return null;const T=this._getOrCreateFaces(t,_);if(T.length===0)continue;const x=this._createComponentNormals(s,l,_,T);x.didFlipNormals&&(w=!0);const E=[[O.POSITION,{size:3,data:s,exclusive:!0}],[O.NORMAL,{size:3,data:x.normals,exclusive:!0}]],C=[[O.POSITION,T],[O.NORMAL,x.indices]];b(o)&&(E.push([O.COLOR,{size:4,data:o,exclusive:!0}]),C.push([O.COLOR,T])),b(a)&&(E.push([O.SYMBOLCOLOR,{size:4,data:a,exclusive:!0}]),C.push([O.SYMBOLCOLOR,new Uint16Array(T.length)])),b(n)&&(E.push([O.UV0,{size:2,data:n,exclusive:!0}]),C.push([O.UV0,T])),b(c)&&(E.push([O.TANGENT,{size:4,data:c,exclusive:!0}]),C.push([O.TANGENT,T]));const A=new Bi(E,C);m.push(A),g.push(p),v.push(this._getOrCreateMaterial(t,_))}return w&&this.logger.warn("Normals have been automatically flipped to be consistent with the counter clock wise face winding order. It is better to generate mesh geometries that have consistent normals."),{geometries:m,transformations:g,materials:v,objectTransformation:h}}_createEdgeMaterial(){const t={opacity:this._getLayerOpacity()};return oPe(this.symbolLayer,t)}}const dF=M(),zo=M(),zS=M(),BS=M(),GS=M(),ume=Ce(),NO=$i(),wj=tn(),_vt=[new rvt];var Nu;(function(e){e[e.NONE=0]="NONE",e[e.ECEF=1]="ECEF"})(Nu||(Nu={}));class bvt{constructor(t,r,i,s){this.graphics3DSymbolLayer=t,this.instanceIndex=r,this.elevationAligner=i,this.elevationContext=s,this.type="lod-instance",this._highlights=new Set,this.alignedSampledElevation=0,this.isElevationSource=!1,this.needsElevationUpdates=!1}initialize(){}setVisibility(t){const r=this.lodRenderer.instanceData;t!==r.getVisible(this.instanceIndex)&&r.setVisible(this.instanceIndex,t)}destroy(){this.instanceIndex!=null&&(this.lodRenderer.instanceData.removeInstance(this.instanceIndex),this.graphics3DSymbolLayer.notifyDestroyGraphicLayer(this))}alignWithElevation(t,r,i){if(this.elevationAligner){gse(this.elevationContext.featureExpressionInfoContext,i);const s=this.elevationAligner(this,this.elevationContext,t,r);b(s)&&(this.alignedSampledElevation=s)}}getCenterObjectSpace(t=M()){return this.lodRenderer.instanceData.getCombinedLocalTransform(this.instanceIndex,Gf),Ve(t,this.lodRenderer.baseBoundingSphere.center,Gf)}getBoundingBoxObjectSpace(t=tn()){this.lodRenderer.instanceData.getCombinedLocalTransform(this.instanceIndex,Gf);const r=this.lodRenderer.baseBoundingBox;vi(t);for(let i=0;i<8;++i)se(Nh,(1&i)==0?r[0]:r[3],(2&i)==0?r[1]:r[4],(4&i)==0?r[2]:r[5]),Ve(Nh,Nh,Gf),eg(t,Nh);return t}computeAttachmentOrigin(t){this.lodRenderer.instanceData.getGlobalTransform(this.instanceIndex,Gf),t.render.origin[0]+=Gf[12],t.render.origin[1]+=Gf[13],t.render.origin[2]+=Gf[14],t.render.num++}async getProjectedBoundingBox(t,r,i,s,n){const o=this.getBoundingBoxObjectSpace(n),a=wvt,l=c6(o)?1:a.length;this.lodRenderer.instanceData.getGlobalTransform(this.instanceIndex,Gf);for(let h=0;h<l;h++){const p=a[h];Nh[0]=o[p[0]],Nh[1]=o[p[1]],Nh[2]=o[p[2]],Ve(Nh,Nh,Gf),Pb[3*h+0]=Nh[0],Pb[3*h+1]=Nh[1],Pb[3*h+2]=Nh[2]}if(!t(Pb,0,l))return null;vi(o);let c=null;this.calculateRelativeScreenBounds&&(c=this.calculateRelativeScreenBounds());for(let h=0;h<3*l;h+=3){for(let p=0;p<3;p++)o[p]=Math.min(o[p],Pb[h+p]),o[p+3]=Math.max(o[p+3],Pb[h+p]);c&&i.push({location:Pb.slice(h,h+3),screenSpaceBoundingRect:c})}if(r&&(tf(o,xj),this.elevationContext.mode!=="absolute-height")){let h;const p=fse(o,r);try{h=await r.service.queryElevation(xj[0],xj[1],s,p,"ground")}catch{}b(h)&&exe(o,0,0,-this.alignedSampledElevation+h)}return o}addObjectState(t,r){if(t===v0.Highlight){const i=new QV(t);this._addHighlightId(i),r.addExternal(s=>{this._removeHighlightId(s)},i)}}removeObjectState(t){this._highlights.forEach(r=>t.remove(r))}_addHighlightId(t){this._highlights.add(t),this.lodRenderer.instanceData.setHighlight(this.instanceIndex,!0)}_removeHighlightId(t){this._highlights.delete(t),this.lodRenderer.instanceData.setHighlight(this.instanceIndex,this._highlights.size>0)}get lodRenderer(){return this.graphics3DSymbolLayer.lodRenderer}}const Pb=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],Nh=M(),xj=M(),wvt=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]],Gf=Ce();function xvt(e){const t=[];return e.stageResources.geometries.forEach((r,i)=>{const s=e.stageResources.materials[i],n=e.stageResources.textures;t.push({material:s,geometry:r,textures:n})}),{components:t,minScreenSpaceRadius:e.lodThreshold,pivotOffset:e.pivotOffset}}function Tvt(e){return{levels:e.map(t=>xvt(t))}}function Svt(e,t=Cvt){const r=tmt(e);return Math.sqrt(r/(t*Math.PI))}function Evt(e){e.levels.forEach(t=>{t.minScreenSpaceRadius||(t.minScreenSpaceRadius=Svt(t))})}const Cvt=.05;function Avt(e){return e=e||globalThis.location.hostname,Rvt.some(t=>(e==null?void 0:e.match(t))!=null)}function BQ(e,t){return e&&(t=t||globalThis.location.hostname)?t.match(SIe)!=null||t.match(CIe)!=null?e.replace("static.arcgis.com","staticdev.arcgis.com"):t.match(EIe)!=null||t.match(AIe)!=null?e.replace("static.arcgis.com","staticqa.arcgis.com"):e:e}const SIe=/^devext.arcgis.com$/,EIe=/^qaext.arcgis.com$/,CIe=/^[\w-]*\.mapsdevext.arcgis.com$/,AIe=/^[\w-]*\.mapsqa.arcgis.com$/,Rvt=[/^([\w-]*\.)?[\w-]*\.zrh-dev-local.esri.com$/,SIe,EIe,/^jsapps.esri.com$/,CIe,AIe];function Ovt(e,t,r){if(e.count!==t.count)return void BB.error("source and destination buffers need to have the same number of elements");const i=e.count,s=r[0],n=r[1],o=r[2],a=r[3],l=r[4],c=r[5],h=r[6],p=r[7],f=r[8],m=r[9],g=r[10],v=r[11],w=r[12],_=r[13],T=r[14],x=r[15],E=e.typedBuffer,C=e.typedBufferStride,A=t.typedBuffer,P=t.typedBufferStride;for(let I=0;I<i;I++){const L=I*C,k=I*P,G=A[k],z=A[k+1],X=A[k+2],Z=A[k+3];E[L]=s*G+l*z+f*X+w*Z,E[L+1]=n*G+c*z+m*X+_*Z,E[L+2]=o*G+h*z+g*X+T*Z,E[L+3]=a*G+p*z+v*X+x*Z}}function RIe(e,t,r){if(e.count!==t.count)return void BB.error("source and destination buffers need to have the same number of elements");const i=e.count,s=r[0],n=r[1],o=r[2],a=r[3],l=r[4],c=r[5],h=r[6],p=r[7],f=r[8],m=e.typedBuffer,g=e.typedBufferStride,v=t.typedBuffer,w=t.typedBufferStride;for(let _=0;_<i;_++){const T=_*g,x=_*w,E=v[x],C=v[x+1],A=v[x+2],P=v[x+3];m[T]=s*E+a*C+h*A,m[T+1]=n*E+l*C+p*A,m[T+2]=o*E+c*C+f*A,m[T+3]=P}}function Mvt(e,t){const r=Math.min(e.count,t.count),i=e.typedBuffer,s=e.typedBufferStride,n=t.typedBuffer,o=t.typedBufferStride;for(let a=0;a<r;a++){const l=a*s,c=a*o,h=n[c],p=n[c+1],f=n[c+2],m=h*h+p*p+f*f;if(m>0){const g=1/Math.sqrt(m);i[l]=g*h,i[l+1]=g*p,i[l+2]=g*f}}}function GQ(e,t,r){const i=Math.min(e.count,t.count),s=e.typedBuffer,n=e.typedBufferStride,o=t.typedBuffer,a=t.typedBufferStride;for(let l=0;l<i;l++){const c=l*n,h=l*a;s[c]=r*o[h],s[c+1]=r*o[h+1],s[c+2]=r*o[h+2],s[c+3]=r*o[h+3]}}function Pvt(e,t,r){const i=Math.min(e.count,t.count),s=e.typedBuffer,n=e.typedBufferStride,o=t.typedBuffer,a=t.typedBufferStride;for(let l=0;l<i;l++){const c=l*n,h=l*a;s[c]=o[h]>>r,s[c+1]=o[h+1]>>r,s[c+2]=o[h+2]>>r,s[c+3]=o[h+3]>>r}}Object.freeze(Object.defineProperty({__proto__:null,transformMat4:Ovt,transformMat3:RIe,normalize:Mvt,scale:GQ,shiftRight:Pvt},Symbol.toStringTag,{value:"Module"}));function Ivt(e,t,r){const i=e.typedBuffer,s=e.typedBufferStride,n=t.typedBuffer,o=t.typedBufferStride,a=r?r.count:t.count;let l=(r&&r.dstIndex?r.dstIndex:0)*s,c=(r&&r.srcIndex?r.srcIndex:0)*o;for(let h=0;h<a;++h){for(let p=0;p<9;++p)i[l+p]=n[c+p];l+=s,c+=o}}Object.freeze(Object.defineProperty({__proto__:null,copy:Ivt},Symbol.toStringTag,{value:"Module"}));function $vt(e,t,r){const i=e.typedBuffer,s=e.typedBufferStride,n=t.typedBuffer,o=t.typedBufferStride,a=r?r.count:t.count;let l=(r&&r.dstIndex?r.dstIndex:0)*s,c=(r&&r.srcIndex?r.srcIndex:0)*o;for(let h=0;h<a;++h){for(let p=0;p<16;++p)i[l+p]=n[c+p];l+=s,c+=o}}Object.freeze(Object.defineProperty({__proto__:null,copy:$vt},Symbol.toStringTag,{value:"Module"}));function Lvt(e,t,r){const i=e.typedBuffer,s=e.typedBufferStride,n=t.typedBuffer,o=t.typedBufferStride,a=r?r.count:t.count;let l=(r&&r.dstIndex?r.dstIndex:0)*s,c=(r&&r.srcIndex?r.srcIndex:0)*o;for(let h=0;h<a;++h)i[l]=n[c],l+=s,c+=o}function ak(e,t){const r=e.count;t||(t=new e.TypedArrayConstructor(r));for(let i=0;i<r;i++)t[i]=e.get(i);return t}Object.freeze(Object.defineProperty({__proto__:null,copy:Lvt,makeDense:ak},Symbol.toStringTag,{value:"Module"}));function OIe(e,t,r){const i=e.typedBuffer,s=e.typedBufferStride,n=t.typedBuffer,o=t.typedBufferStride,a=r?r.count:t.count;let l=(r&&r.dstIndex?r.dstIndex:0)*s,c=(r&&r.srcIndex?r.srcIndex:0)*o;for(let h=0;h<a;++h)i[l]=n[c],i[l+1]=n[c+1],l+=s,c+=o}function MIe(e,t,r){const i=e.typedBuffer,s=e.typedBufferStride,n=t.typedBuffer,o=t.typedBufferStride,a=r?r.count:t.count;let l=(r&&r.dstIndex?r.dstIndex:0)*s,c=(r&&r.srcIndex?r.srcIndex:0)*o;if(Lat(t.elementType)){const h=Dat(t.elementType);if($at(t.elementType))for(let p=0;p<a;++p)i[l]=Math.max(n[c]/h,-1),i[l+1]=Math.max(n[c+1]/h,-1),l+=s,c+=o;else for(let p=0;p<a;++p)i[l]=n[c]/h,i[l+1]=n[c+1]/h,l+=s,c+=o}else OIe(e,t,r);return e}function Dvt(e,t,r,i){var l,c;const s=e.typedBuffer,n=e.typedBufferStride,o=(l=i==null?void 0:i.count)!=null?l:e.count;let a=((c=i==null?void 0:i.dstIndex)!=null?c:0)*n;for(let h=0;h<o;++h)s[a]=t,s[a+1]=r,a+=n}Object.freeze(Object.defineProperty({__proto__:null,copy:OIe,normalizeIntegerBuffer:MIe,fill:Dvt},Symbol.toStringTag,{value:"Module"}));function u8(e,t,r){const i=e.typedBuffer,s=e.typedBufferStride,n=t.typedBuffer,o=t.typedBufferStride,a=r?r.count:t.count;let l=(r&&r.dstIndex?r.dstIndex:0)*s,c=(r&&r.srcIndex?r.srcIndex:0)*o;for(let h=0;h<a;++h)i[l]=n[c],i[l+1]=n[c+1],i[l+2]=n[c+2],l+=s,c+=o}function Nvt(e,t,r,i,s){var c,h;const n=e.typedBuffer,o=e.typedBufferStride,a=(c=s==null?void 0:s.count)!=null?c:e.count;let l=((h=s==null?void 0:s.dstIndex)!=null?h:0)*o;for(let p=0;p<a;++p)n[l]=t,n[l+1]=r,n[l+2]=i,l+=o}Object.freeze(Object.defineProperty({__proto__:null,copy:u8,fill:Nvt},Symbol.toStringTag,{value:"Module"}));function PIe(e,t,r){const i=e.typedBuffer,s=e.typedBufferStride,n=t.typedBuffer,o=t.typedBufferStride,a=r?r.count:t.count;let l=(r&&r.dstIndex?r.dstIndex:0)*s,c=(r&&r.srcIndex?r.srcIndex:0)*o;for(let h=0;h<a;++h)i[l]=n[c],i[l+1]=n[c+1],i[l+2]=n[c+2],i[l+3]=n[c+3],l+=s,c+=o}function IIe(e,t,r,i,s,n){var h,p;const o=e.typedBuffer,a=e.typedBufferStride,l=(h=n==null?void 0:n.count)!=null?h:e.count;let c=((p=n==null?void 0:n.dstIndex)!=null?p:0)*a;for(let f=0;f<l;++f)o[c]=t,o[c+1]=r,o[c+2]=i,o[c+3]=s,c+=a}Object.freeze(Object.defineProperty({__proto__:null,copy:PIe,fill:IIe},Symbol.toStringTag,{value:"Module"}));function ax(e,t){return new e(new ArrayBuffer(t*e.ElementCount*DOe(e.ElementType)))}class $Ie{constructor(t){this.streamDataRequester=t}async loadJSON(t,r){return this._load("json",t,r)}async loadBinary(t,r){return ug(t)?(Jt(r),obe(t)):this._load("binary",t,r)}async loadImage(t,r){return this._load("image",t,r)}async _load(t,r,i){if(R(this.streamDataRequester))return(await er(r,{responseType:Fvt[t]})).data;const s=await yh(this.streamDataRequester.request(r,t,i));if(s.ok===!0)return s.value;throw ah(s.error),new j("",`Request for resource failed: ${s.error}`)}}const Fvt={image:"image",binary:"array-buffer",json:"json"},kvt=fe.getLogger("esri.views.3d.glTF");class Uvt{error(t){throw new j("gltf-loader-error",t)}errorUnsupported(t){throw new j("gltf-loader-unsupported-feature",t)}errorUnsupportedIf(t,r){t&&this.errorUnsupported(r)}assert(t,r){t||this.error(r)}warn(t){kvt.warn(t)}warnUnsupported(t){this.warn("[Unsupported Feature] "+t)}warnUnsupportedIf(t,r){t&&this.warnUnsupported(r)}}function Vvt(e={}){return{color:[1,1,1],opacity:1,alphaMode:"OPAQUE",alphaCutoff:.5,doubleSided:!1,castShadows:!0,receiveShadows:!0,receiveAmbientOcclustion:!0,textureColor:null,textureNormal:null,textureOcclusion:null,textureEmissive:null,textureMetallicRoughness:null,emissiveFactor:[0,0,0],metallicFactor:1,roughnessFactor:1,colorMixMode:"multiply",...e}}function zvt(e,t={}){return{data:e,parameters:{wrap:{s:xt.REPEAT,t:xt.REPEAT,...t.wrap},noUnpackFlip:!0,mipmap:!1,...t}}}class FT{constructor(t,r,i=""){this.major=t,this.minor=r,this._context=i}lessThan(t,r){return this.major<t||t===this.major&&this.minor<r}since(t,r){return!this.lessThan(t,r)}validate(t){if(this.major!==t.major){const r=this._context&&this._context+":",i=this._context&&this._context+" ";throw new j(r+"unsupported-version",`Required major ${i}version is '${this.major}', but got '\${version.major}.\${version.minor}'`,{version:t})}}clone(){return new FT(this.major,this.minor,this._context)}static parse(t,r=""){const[i,s]=t.split("."),n=/^\s*\d+\s*$/;if(!i||!i.match||!i.match(n))throw new j((r&&r+":")+"invalid-version","Expected major version to be a number, but got '${version}'",{version:t});if(!s||!s.match||!s.match(n))throw new j((r&&r+":")+"invalid-version","Expected minor version to be a number, but got '${version}'",{version:t});const o=parseInt(i,10),a=parseInt(s,10);return new FT(o,a,r)}}class hme{constructor(t){this.data=t,this.offset4=0,this.dataUint32=new Uint32Array(this.data,0,Math.floor(this.data.byteLength/4))}readUint32(){const t=this.offset4;return this.offset4+=1,this.dataUint32[t]}readUint8Array(t){const r=4*this.offset4;return this.offset4+=t/4,new Uint8Array(this.data,r,t)}remainingBytes(){return this.data.byteLength-4*this.offset4}}var SP,dme;(function(e){e.SCALAR="SCALAR",e.VEC2="VEC2",e.VEC3="VEC3",e.VEC4="VEC4",e.MAT2="MAT2",e.MAT3="MAT3",e.MAT4="MAT4"})(SP||(SP={})),function(e){e[e.ARRAY_BUFFER=34962]="ARRAY_BUFFER",e[e.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER"}(dme||(dme={}));const LIe={baseColorFactor:[1,1,1,1],metallicFactor:1,roughnessFactor:1},Bvt={pbrMetallicRoughness:LIe,emissiveFactor:[0,0,0],alphaMode:"OPAQUE",alphaCutoff:.5,doubleSided:!1},Gvt={ESRI_externalColorMixMode:"tint"},pme=(e={})=>{const t={...LIe,...e.pbrMetallicRoughness},r=jvt({...Gvt,...e.extras});return{...Bvt,...e,pbrMetallicRoughness:t,extras:r}};function jvt(e){switch(e.ESRI_externalColorMixMode){case"multiply":case"tint":case"ignore":case"replace":break;default:e.ESRI_externalColorMixMode,e.ESRI_externalColorMixMode="tint"}return e}const Hvt={magFilter:et.LINEAR,minFilter:et.LINEAR_MIPMAP_LINEAR,wrapS:xt.REPEAT,wrapT:xt.REPEAT},qvt=e=>({...Hvt,...e});function Wvt(e){let t,r;return e.replace(/^(.*\/)?([^/]*)$/,(i,s,n)=>(t=s||"",r=n||"","")),{dirPart:t,filePart:r}}const pF={MAGIC:1179937895,CHUNK_TYPE_JSON:1313821514,CHUNK_TYPE_BIN:5130562,MIN_HEADER_LENGTH:20};class xy{constructor(t,r,i,s,n){this.context=t,this.errorContext=r,this.uri=i,this.json=s,this.glbBuffer=n,this.bufferLoaders=new Map,this.textureLoaders=new Map,this.textureCache=new Map,this.materialCache=new Map,this.nodeParentMap=new Map,this.nodeTransformCache=new Map,this.baseUri=Wvt(this.uri).dirPart,this._checkVersionSupported(),this._checkRequiredExtensionsSupported(),r.errorUnsupportedIf(s.scenes==null,"Scenes must be defined."),r.errorUnsupportedIf(s.meshes==null,"Meshes must be defined"),r.errorUnsupportedIf(s.nodes==null,"Nodes must be defined."),this._computeNodeParents()}static async load(t,r,i,s){if(ug(i)){const a=Yz(i);if(a.mediaType!=="model/gltf-binary")try{const c=JSON.parse(a.isBase64?atob(a.data):a.data);return new xy(t,r,i,c)}catch{}const l=obe(i);if(xy._isGLBData(l))return this._fromGLBData(t,r,i,l)}if(i.endsWith(".gltf")){const a=await t.loadJSON(i,s);return new xy(t,r,i,a)}const n=await t.loadBinary(i,s);if(xy._isGLBData(n))return this._fromGLBData(t,r,i,n);const o=await t.loadJSON(i,s);return new xy(t,r,i,o)}static _isGLBData(t){const r=new hme(t);return r.remainingBytes()>=4&&r.readUint32()===pF.MAGIC}static async _fromGLBData(t,r,i,s){const n=await xy._parseGLBData(r,s);return new xy(t,r,i,n.json,n.binaryData)}static async _parseGLBData(t,r){const i=new hme(r);t.assert(i.remainingBytes()>=12,"GLB binary data is insufficiently large.");const s=i.readUint32(),n=i.readUint32(),o=i.readUint32();t.assert(s===pF.MAGIC,"Magic first 4 bytes do not fit to expected GLB value."),t.assert(r.byteLength>=o,"GLB binary data is smaller than header specifies."),t.errorUnsupportedIf(n!==2,"An unsupported GLB container version was detected. Only version 2 is supported.");let a,l,c=0;for(;i.remainingBytes()>=8;){const h=i.readUint32(),p=i.readUint32();c===0?(t.assert(p===pF.CHUNK_TYPE_JSON,"First GLB chunk must be JSON."),t.assert(h>=0,"No JSON data found."),a=await Kvt(i.readUint8Array(h))):c===1?(t.errorUnsupportedIf(p!==pF.CHUNK_TYPE_BIN,"Second GLB chunk expected to be BIN."),l=i.readUint8Array(h)):t.warnUnsupported("More than 2 GLB chunks detected. Skipping."),c+=1}return a||t.error("No GLB JSON chunk detected."),{json:a,binaryData:l}}async getBuffer(t,r){const i=this.json.buffers[t],s=this.errorContext;if(i.uri==null)return s.assert(this.glbBuffer!=null,"GLB buffer not present"),this.glbBuffer;const n=await this._getBufferLoader(t,r);return s.assert(n.byteLength===i.byteLength,"Buffer byte lengths should match."),n}async _getBufferLoader(t,r){const i=this.bufferLoaders.get(t);if(i)return i;const s=this.json.buffers[t],n=this.context.loadBinary(this._resolveUri(s.uri),r).then(o=>new Uint8Array(o));return this.bufferLoaders.set(t,n),n}async getAccessor(t,r){const i=this.errorContext;i.errorUnsupportedIf(!this.json.accessors,"Accessors missing.");const s=this.json.accessors[t];i.errorUnsupportedIf((s==null?void 0:s.bufferView)==null,"Some accessor does not specify a bufferView."),i.errorUnsupportedIf(s.type in[SP.MAT2,SP.MAT3,SP.MAT4],`AttributeType ${s.type} is not supported`);const n=this.json.bufferViews[s.bufferView],o=await this.getBuffer(n.buffer,r),a=Yvt[s.type],l=Qvt[s.componentType],c=a*l,h=n.byteStride||c;return{raw:o.buffer,byteStride:h,byteOffset:o.byteOffset+(n.byteOffset||0)+(s.byteOffset||0),entryCount:s.count,isDenselyPacked:h===c,componentCount:a,componentByteSize:l,componentType:s.componentType,min:s.min,max:s.max,normalized:!!s.normalized}}async getIndexData(t,r){if(t.indices==null)return null;const i=await this.getAccessor(t.indices,r);if(i.isDenselyPacked)switch(i.componentType){case pt.UNSIGNED_BYTE:return new Uint8Array(i.raw,i.byteOffset,i.entryCount);case pt.UNSIGNED_SHORT:return new Uint16Array(i.raw,i.byteOffset,i.entryCount);case pt.UNSIGNED_INT:return new Uint32Array(i.raw,i.byteOffset,i.entryCount)}else switch(i.componentType){case pt.UNSIGNED_BYTE:return ak(this._wrapAccessor(b0,i));case pt.UNSIGNED_SHORT:return ak(this._wrapAccessor(ST,i));case pt.UNSIGNED_INT:return ak(this._wrapAccessor(CT,i))}}async getPositionData(t,r){const i=this.errorContext;i.errorUnsupportedIf(t.attributes.POSITION==null,"No POSITION vertex data found.");const s=await this.getAccessor(t.attributes.POSITION,r);return i.errorUnsupportedIf(s.componentType!==pt.FLOAT,"Expected type FLOAT for POSITION vertex attribute, but found "+mF[s.componentType]),i.errorUnsupportedIf(s.componentCount!==3,"POSITION vertex attribute must have 3 components, but found "+s.componentCount.toFixed()),this._wrapAccessor(Zr,s)}async getNormalData(t,r){const i=this.errorContext;i.assert(t.attributes.NORMAL!=null,"No NORMAL vertex data found.");const s=await this.getAccessor(t.attributes.NORMAL,r);return i.errorUnsupportedIf(s.componentType!==pt.FLOAT,"Expected type FLOAT for NORMAL vertex attribute, but found "+mF[s.componentType]),i.errorUnsupportedIf(s.componentCount!==3,"NORMAL vertex attribute must have 3 components, but found "+s.componentCount.toFixed()),this._wrapAccessor(Zr,s)}async getTangentData(t,r){const i=this.errorContext;i.assert(t.attributes.TANGENT!=null,"No TANGENT vertex data found.");const s=await this.getAccessor(t.attributes.TANGENT,r);return i.errorUnsupportedIf(s.componentType!==pt.FLOAT,"Expected type FLOAT for TANGENT vertex attribute, but found "+mF[s.componentType]),i.errorUnsupportedIf(s.componentCount!==4,"TANGENT vertex attribute must have 4 components, but found "+s.componentCount.toFixed()),new oo(s.raw,s.byteOffset,s.byteStride,s.byteOffset+s.byteStride*s.entryCount)}async getTextureCoordinates(t,r){const i=this.errorContext;i.assert(t.attributes.TEXCOORD_0!=null,"No TEXCOORD_0 vertex data found.");const s=await this.getAccessor(t.attributes.TEXCOORD_0,r);return i.errorUnsupportedIf(s.componentCount!==2,"TEXCOORD_0 vertex attribute must have 2 components, but found "+s.componentCount.toFixed()),s.componentType===pt.FLOAT?this._wrapAccessor(Hd,s):(i.errorUnsupportedIf(!s.normalized,"Integer component types are only supported for a normalized accessor for TEXCOORD_0."),Jvt(s))}async getVertexColors(t,r){const i=this.errorContext;i.assert(t.attributes.COLOR_0!=null,"No COLOR_0 vertex data found.");const s=await this.getAccessor(t.attributes.COLOR_0,r);if(i.errorUnsupportedIf(s.componentCount!==4&&s.componentCount!==3,"COLOR_0 attribute must have 3 or 4 components, but found "+s.componentCount.toFixed()),s.componentCount===4){if(s.componentType===pt.FLOAT)return this._wrapAccessor(oo,s);if(s.componentType===pt.UNSIGNED_BYTE)return this._wrapAccessor(uc,s);if(s.componentType===pt.UNSIGNED_SHORT)return this._wrapAccessor(N1,s)}else if(s.componentCount===3){if(s.componentType===pt.FLOAT)return this._wrapAccessor(Zr,s);if(s.componentType===pt.UNSIGNED_BYTE)return this._wrapAccessor(D1,s);if(s.componentType===pt.UNSIGNED_SHORT)return this._wrapAccessor(ET,s)}i.errorUnsupported("Unsupported component type for COLOR_0 attribute: "+mF[s.componentType])}hasPositions(t){return t.attributes.POSITION!==void 0}hasNormals(t){return t.attributes.NORMAL!==void 0}hasVertexColors(t){return t.attributes.COLOR_0!==void 0}hasTextureCoordinates(t){return t.attributes.TEXCOORD_0!==void 0}hasTangents(t){return t.attributes.TANGENT!==void 0}async getMaterial(t,r,i){let s=this.materialCache.get(t.material);if(!s){const n=t.material!=null?pme(this.json.materials[t.material]):pme(),o=n.pbrMetallicRoughness,a=this.hasVertexColors(t),l=this.getTexture(o.baseColorTexture,r),c=this.getTexture(n.normalTexture,r),h=i?this.getTexture(n.occlusionTexture,r):null,p=i?this.getTexture(n.emissiveTexture,r):null,f=i?this.getTexture(o.metallicRoughnessTexture,r):null,m=t.material!=null?t.material:-1;s={alphaMode:n.alphaMode,alphaCutoff:n.alphaCutoff,color:o.baseColorFactor,doubleSided:!!n.doubleSided,colorTexture:await l,normalTexture:await c,name:n.name,id:m,occlusionTexture:await h,emissiveTexture:await p,emissiveFactor:n.emissiveFactor,metallicFactor:o.metallicFactor,roughnessFactor:o.roughnessFactor,metallicRoughnessTexture:await f,hasVertexColors:a,ESRI_externalColorMixMode:n.extras.ESRI_externalColorMixMode}}return s}async getTexture(t,r){if(!t)return null;this.errorContext.errorUnsupportedIf((t.texCoord||0)!==0,"Only TEXCOORD with index 0 is supported.");const i=t.index,s=this.errorContext,n=this.json.textures[i],o=qvt(n.sampler!=null?this.json.samplers[n.sampler]:{});s.errorUnsupportedIf(n.source==null,"Source is expected to be defined for a texture.");const a=this.json.images[n.source],l=await this._loadTextureImageData(i,n,r);return UK(this.textureCache,i,()=>{const c=p=>p===33071||p===33648||p===10497,h=p=>(s.error(`Unexpected TextureSampler WrapMode: ${p}. Using default REPEAT(10497).`),10497);return{data:l,wrapS:c(o.wrapS)?o.wrapS:h(o.wrapS),wrapT:c(o.wrapT)?o.wrapT:h(o.wrapT),minFilter:o.minFilter,name:a.name,id:i}})}getNodeTransform(t){if(t===void 0)return Zvt;let r=this.nodeTransformCache.get(t);if(!r){const i=this.getNodeTransform(this._getNodeParent(t)),s=this.json.nodes[t];s.matrix?r=Yi(Ce(),i,s.matrix):s.translation||s.rotation||s.scale?(r=zx(i),s.translation&&yl(r,r,s.translation),s.rotation&&(fF[3]=aOe(fF,s.rotation),qc(r,r,fF[3],fF)),s.scale&&v6(r,r,s.scale)):r=i,this.nodeTransformCache.set(t,r)}return r}_wrapAccessor(t,r){return new t(r.raw,r.byteOffset,r.byteStride,r.byteOffset+r.byteStride*(r.entryCount-1)+r.componentByteSize*r.componentCount)}_resolveUri(t){return Rd(t,this.baseUri)}_getNodeParent(t){return this.nodeParentMap.get(t)}_checkVersionSupported(){const t=FT.parse(this.json.asset.version,"glTF");Xvt.validate(t)}_checkRequiredExtensionsSupported(){const t=this.json,r=this.errorContext;t.extensionsRequired&&t.extensionsRequired.length!==0&&r.errorUnsupported("gltf loader was not able to load unsupported feature. Required extensions: "+t.extensionsRequired.join(", "))}_computeNodeParents(){this.json.nodes.forEach((t,r)=>{t.children&&t.children.forEach(i=>{this.nodeParentMap.set(i,r)})})}async _loadTextureImageData(t,r,i){const s=this.textureLoaders.get(t);if(s)return s;const n=this._createTextureLoader(r,i);return this.textureLoaders.set(t,n),n}async _createTextureLoader(t,r){const i=this.json.images[t.source];if(i.uri)return this.context.loadImage(this._resolveUri(i.uri),r);const s=this.errorContext;s.errorUnsupportedIf(i.bufferView==null,"Image bufferView must be defined."),s.errorUnsupportedIf(i.mimeType==null,"Image mimeType must be defined.");const n=this.json.bufferViews[i.bufferView],o=await this.getBuffer(n.buffer,r);return s.errorUnsupportedIf(n.byteStride!=null,"byteStride not supported for image buffer"),e_t(new Uint8Array(o.buffer,o.byteOffset+(n.byteOffset||0),n.byteLength),i.mimeType)}}const Xvt=new FT(2,0,"glTF"),Zvt=qxe(Ce(),Math.PI/2),fF=A0(),Yvt={SCALAR:1,VEC2:2,VEC3:3,VEC4:4},Qvt={[pt.BYTE]:1,[pt.UNSIGNED_BYTE]:1,[pt.SHORT]:2,[pt.UNSIGNED_SHORT]:2,[pt.FLOAT]:4,[pt.UNSIGNED_INT]:4};function Jvt(e){switch(e.componentType){case pt.BYTE:return new AT(e.raw,e.byteOffset,e.byteStride,e.byteOffset+e.byteStride*e.entryCount);case pt.UNSIGNED_BYTE:return new TT(e.raw,e.byteOffset,e.byteStride,e.byteOffset+e.byteStride*e.entryCount);case pt.SHORT:return new RT(e.raw,e.byteOffset,e.byteStride,e.byteOffset+e.byteStride*e.entryCount);case pt.UNSIGNED_SHORT:return new IA(e.raw,e.byteOffset,e.byteStride,e.byteOffset+e.byteStride*e.entryCount);case pt.UNSIGNED_INT:return new $A(e.raw,e.byteOffset,e.byteStride,e.byteOffset+e.byteStride*e.entryCount);case pt.FLOAT:return new Hd(e.raw,e.byteOffset,e.byteStride,e.byteOffset+e.byteStride*e.entryCount);default:return void(e.componentType,void 0)}}async function Kvt(e){return new Promise((t,r)=>{const i=new Blob([e]),s=new FileReader;s.onload=()=>{const n=s.result;t(JSON.parse(n))},s.onerror=n=>{r(n)},s.readAsText(i)})}async function e_t(e,t){return new Promise((r,i)=>{const s=new Blob([e],{type:t}),n=URL.createObjectURL(s),o=new Image;o.addEventListener("load",()=>{URL.revokeObjectURL(n),"decode"in o?o.decode().then(()=>r(o),()=>r(o)):r(o)}),o.addEventListener("error",a=>{URL.revokeObjectURL(n),i(a)}),o.src=n})}const mF={5120:"BYTE",5121:"UNSIGNED_BYTE",5122:"SHORT",5123:"UNSIGNED_SHORT",5125:"UNSIGNED_INT",5126:"FLOAT"};let t_t=0;async function DIe(e,t,r={},i=!0){const s=await xy.load(e,lk,t,r),n="gltf_"+t_t++,o={lods:[],materials:new Map,textures:new Map,meta:r_t(s)},a=!(!s.json.asset.extras||s.json.asset.extras.ESRI_type!=="symbolResource"),l=new Map;await i_t(s,async(c,h,p,f)=>{var L;const m=(L=l.get(p))!=null?L:0;l.set(p,m+1);const g=c.mode!==void 0?c.mode:Lt.TRIANGLES,v=g===Lt.TRIANGLES||g===Lt.TRIANGLE_STRIP||g===Lt.TRIANGLE_FAN?g:null;if(R(v))return void lk.warnUnsupported("Unsupported primitive mode ("+a_t[g]+"). Skipping primitive.");if(!s.hasPositions(c))return void lk.warn("Skipping primitive without POSITION vertex attribute.");const w=s.getPositionData(c,r),_=s.getMaterial(c,r,i),T=s.hasNormals(c)?s.getNormalData(c,r):null,x=s.hasTangents(c)?s.getTangentData(c,r):null,E=s.hasTextureCoordinates(c)?s.getTextureCoordinates(c,r):null,C=s.hasVertexColors(c)?s.getVertexColors(c,r):null,A=s.getIndexData(c,r),P={transform:zx(h),attributes:{position:await w,normal:T?await T:null,texCoord0:E?await E:null,color:C?await C:null,tangent:x?await x:null},indices:await A,primitiveType:v,material:n_t(o,await _,n)};let I=null;b(o.meta)&&b(o.meta.ESRI_lod)&&o.meta.ESRI_lod.metric==="screenSpaceRadius"&&(I=o.meta.ESRI_lod.thresholds[p]),o.lods[p]=o.lods[p]||{parts:[],name:f,lodThreshold:I},o.lods[p].parts[m]=P});for(const c of o.lods)c.parts=c.parts.filter(h=>!!h);return{model:o,meta:{isEsriSymbolResource:a,uri:s.uri},customMeta:{}}}function r_t(e){const t=e.json;let r=null;return t.nodes.forEach(i=>{const s=i.extras;b(s)&&(s.ESRI_proxyEllipsoid||s.ESRI_lod)&&(r=s)}),r}async function i_t(e,t){const r=e.json,i=r.scenes[r.scene||0].nodes,s=i.length>1,n=[];for(const a of i){const l=r.nodes[a];n.push(o(a,0)),s_t(l)&&!s&&l.extensions.MSFT_lod.ids.forEach((c,h)=>o(c,h+1))}async function o(a,l){const c=r.nodes[a],h=e.getNodeTransform(a);if(lk.warnUnsupportedIf(c.weights!=null,"Morph targets are not supported."),c.mesh!=null){const p=r.meshes[c.mesh];for(const f of p.primitives)n.push(t(f,h,l,p.name))}for(const p of c.children||[])n.push(o(p,l))}await Promise.all(n)}function s_t(e){return e.extensions&&e.extensions.MSFT_lod&&Array.isArray(e.extensions.MSFT_lod.ids)}function n_t(e,t,r){const i=n=>{const o=`${r}_tex_${n&&n.id}${n&&n.name?"_"+n.name:""}`;if(n&&!e.textures.has(o)){const a=zvt(n.data,{wrap:{s:n.wrapS,t:n.wrapT},mipmap:o_t.includes(n.minFilter),noUnpackFlip:!0});e.textures.set(o,a)}return o},s=`${r}_mat_${t.id}_${t.name}`;if(!e.materials.has(s)){const n=Vvt({color:[t.color[0],t.color[1],t.color[2]],opacity:t.color[3],alphaMode:t.alphaMode,alphaCutoff:t.alphaCutoff,doubleSided:t.doubleSided,colorMixMode:t.ESRI_externalColorMixMode,textureColor:t.colorTexture?i(t.colorTexture):void 0,textureNormal:t.normalTexture?i(t.normalTexture):void 0,textureOcclusion:t.occlusionTexture?i(t.occlusionTexture):void 0,textureEmissive:t.emissiveTexture?i(t.emissiveTexture):void 0,textureMetallicRoughness:t.metallicRoughnessTexture?i(t.metallicRoughnessTexture):void 0,emissiveFactor:[t.emissiveFactor[0],t.emissiveFactor[1],t.emissiveFactor[2]],metallicFactor:t.metallicFactor,roughnessFactor:t.roughnessFactor});e.materials.set(s,n)}return s}const lk=new Uvt,o_t=[et.LINEAR_MIPMAP_LINEAR,et.LINEAR_MIPMAP_NEAREST],a_t=["POINTS","LINES","LINE_LOOP","LINE_STRIP","TRIANGLES","TRIANGLE_STRIP","TRIANGLE_FAN"];function l_t(e,t=DA){return typeof e=="number"?t(e):iU(e)||jw(e)?new Uint32Array(e):e}function c_t(e){const t=typeof e=="number"?e:e.length;if(t<3)return new Uint16Array(0);const r=t-2,i=r<=65536?new Uint16Array(3*r):new Uint32Array(3*r);if(typeof e=="number"){let s=0;for(let n=0;n<r;n+=1)n%2==0?(i[s++]=n,i[s++]=n+1,i[s++]=n+2):(i[s++]=n+1,i[s++]=n,i[s++]=n+2)}else{let s=0;for(let n=0;n<r;n+=1)if(n%2==0){const o=e[n],a=e[n+1],l=e[n+2];i[s++]=o,i[s++]=a,i[s++]=l}else{const o=e[n+1],a=e[n],l=e[n+2];i[s++]=o,i[s++]=a,i[s++]=l}}return i}function u_t(e){const t=typeof e=="number"?e:e.length;if(t<3)return new Uint16Array(0);const r=t-2,i=r<=65536?new Uint16Array(3*r):new Uint32Array(3*r);if(typeof e=="number"){let s=0;for(let n=0;n<r;++n)i[s++]=0,i[s++]=n+1,i[s++]=n+2;return i}{const s=e[0];let n=e[1],o=0;for(let a=0;a<r;++a){const l=e[a+2];i[o++]=s,i[o++]=n,i[o++]=l,n=l}return i}}const cy=fe.getLogger("esri.views.3d.layers.graphics.objectResourceUtils");async function NIe(e,t){const r=await h_t(e,t);return{resource:r,textures:await g_t(r.textureDefinitions,t)}}async function h_t(e,t){const r=b(t)&&t.streamDataRequester;if(r)return d_t(e,r,t);const i=await yh(er(e,t));if(i.ok===!0)return i.value.data;ah(i.error),FIe(i.error)}async function d_t(e,t,r){const i=await yh(t.request(e,"json",r));if(i.ok===!0)return i.value;ah(i.error),FIe(i.error.details.url)}function FIe(e){throw new j("",`Request for object resource failed: ${e}`)}function p_t(e){const t=e.params,r=t.topology;let i=!0;switch(t.vertexAttributes||(cy.warn("Geometry must specify vertex attributes"),i=!1),t.topology){case"PerAttributeArray":break;case"Indexed":case null:case void 0:{const n=t.faces;if(n){if(t.vertexAttributes)for(const o in t.vertexAttributes){const a=n[o];a&&a.values?(a.valueType!=null&&a.valueType!=="UInt32"&&(cy.warn(`Unsupported indexed geometry indices type '${a.valueType}', only UInt32 is currently supported`),i=!1),a.valuesPerElement!=null&&a.valuesPerElement!==1&&(cy.warn(`Unsupported indexed geometry values per element '${a.valuesPerElement}', only 1 is currently supported`),i=!1)):(cy.warn(`Indexed geometry does not specify face indices for '${o}' attribute`),i=!1)}}else cy.warn("Indexed geometries must specify faces"),i=!1;break}default:cy.warn(`Unsupported topology '${r}'`),i=!1}e.params.material||(cy.warn("Geometry requires material"),i=!1);const s=e.params.vertexAttributes;for(const n in s)s[n].values||(cy.warn("Geometries with externally defined attributes are not yet supported"),i=!1);return i}function f_t(e,t){const r=[],i=[],s=[],n=[],o=e.resource,a=FT.parse(o.version||"1.0","wosr");v_t.validate(a);const l=o.model.name,c=o.model.geometries,h=o.materialDefinitions,p=e.textures;let f=0;const m=new Map;for(let g=0;g<c.length;g++){const v=c[g];if(!p_t(v))continue;const w=y_t(v),_=v.params.vertexAttributes,T=[];for(const L in _){const k=_[L],G=k.values;T.push([L,{data:G,size:k.valuesPerElement,exclusive:!0}])}const x=[];if(v.params.topology!=="PerAttributeArray"){const L=v.params.faces;for(const k in L)x.push([k,new Uint32Array(L[k].values)])}const E=p&&p[w.texture];if(E&&!m.has(w.texture)){const{image:L,params:k}=E,G=new Hs(L,k);n.push(G),m.set(w.texture,G)}const C=m.get(w.texture),A=C?C.id:void 0;let P=s[w.material]?s[w.material][w.texture]:null;if(!P){const L=h[w.material.substring(w.material.lastIndexOf("/")+1)].params;L.transparency===1&&(L.transparency=0);const k=E&&E.alphaChannelUsage,G=L.transparency>0||k==="transparency"||k==="maskAndTransparency",z=E?kIe(E.alphaChannelUsage):void 0,X={ambient:Bl(L.diffuse),diffuse:Bl(L.diffuse),opacity:1-(L.transparency||0),transparent:G,textureAlphaMode:z,textureAlphaCutoff:.33,textureId:A,initTextureTransparent:!0,doubleSided:!0,cullFace:fi.None,colorMixMode:L.externalColorMixMode||"tint",textureAlphaPremultiplied:!!E&&!!E.params.preMultiplyAlpha};b(t)&&t.materialParamsMixin&&Object.assign(X,t.materialParamsMixin),P=new DT(X),s[w.material]||(s[w.material]={}),s[w.material][w.texture]=P}i.push(P);const I=new Bi(T,x);f+=x.position?x.position.length:0,r.push(I)}return{name:l,stageResources:{textures:n,materials:i,geometries:r},pivotOffset:o.model.pivotOffset,boundingBox:m_t(r),numberOfVertices:f,lodThreshold:null}}function m_t(e){const t=vi();return e.forEach(r=>{const i=r.boundingInfo;b(i)&&(eg(t,i.getBBMin()),eg(t,i.getBBMax()))}),t}async function g_t(e,t){const r=[];for(const n in e){const o=e[n],a=o.images[0].data;if(!a){cy.warn("Externally referenced texture data is not yet supported");continue}const l=o.encoding+";base64,"+a,c="/textureDefinitions/"+n,h=o.channels==="rgba"?o.alphaChannelUsage||"transparency":"none",p={noUnpackFlip:!0,wrap:{s:xt.REPEAT,t:xt.REPEAT},preMultiplyAlpha:kIe(h)!==hi.Opaque},f=b(t)&&t.disableTextures?Promise.resolve(null):Sf(l,t);r.push(f.then(m=>({refId:c,image:m,params:p,alphaChannelUsage:h})))}const i=await Promise.all(r),s={};for(const n of i)s[n.refId]=n;return s}function kIe(e){switch(e){case"mask":return hi.Mask;case"maskAndTransparency":return hi.MaskBlend;case"none":return hi.Opaque;default:return hi.Blend}}function y_t(e){const t=e.params;return{id:1,material:t.material,texture:t.texture,region:t.texture}}const v_t=new FT(1,2,"wosr"),jS=2.1;async function UIe(e,t){const r=VIe(BQ(e));if(r.fileType==="wosr"){const l=await(t.cache?t.cache.loadWOSR(r.url,t):NIe(r.url,t)),c=f_t(l,t);return{lods:[c],referenceBoundingBox:c.boundingBox,isEsriSymbolResource:!1,isWosr:!0,remove:l.remove}}const i=await(t.cache?t.cache.loadGLTF(r.url,t,t.usePBR):DIe(new $Ie(t.streamDataRequester),r.url,t,t.usePBR)),s=ki(i.model.meta,"ESRI_proxyEllipsoid");i.meta.isEsriSymbolResource&&b(s)&&i.meta.uri.includes("/RealisticTrees/")&&w_t(i,s);const n=i.meta.isEsriSymbolResource?{usePBR:t.usePBR,isSchematic:!1,treeRendering:!!i.customMeta.esriTreeRendering,mrrFactors:[0,1,.2]}:{usePBR:t.usePBR,isSchematic:!1,treeRendering:!1,mrrFactors:[0,1,.5]},o={...t.materialParamsMixin,treeRendering:!!i.customMeta.esriTreeRendering};if(r.specifiedLodIndex!=null){const l=ck(i,n,o,r.specifiedLodIndex);let c=l[0].boundingBox;return r.specifiedLodIndex!==0&&(c=ck(i,n,o,0)[0].boundingBox),{lods:l,referenceBoundingBox:c,isEsriSymbolResource:i.meta.isEsriSymbolResource,isWosr:!1,remove:i.remove}}const a=ck(i,n,o);return{lods:a,referenceBoundingBox:a[0].boundingBox,isEsriSymbolResource:i.meta.isEsriSymbolResource,isWosr:!1,remove:i.remove}}function VIe(e){const t=e.match(/(.*\.(gltf|glb))(\?lod=([0-9]+))?$/);return t?{fileType:"gltf",url:t[1],specifiedLodIndex:t[4]!=null?Number(t[4]):null}:e.match(/(.*\.(json|json\.gz))$/)?{fileType:"wosr",url:e,specifiedLodIndex:null}:{fileType:"unknown",url:e,specifiedLodIndex:null}}function ck(e,t,r,i){const s=e.model,n=$i(),o=new Array,a=new Map,l=new Map;return s.lods.forEach((c,h)=>{if(i!==void 0&&h!==i)return;const p={name:c.name,stageResources:{textures:new Array,materials:new Array,geometries:new Array},lodThreshold:b(c.lodThreshold)?c.lodThreshold:null,pivotOffset:[0,0,0],numberOfVertices:0,boundingBox:vi()};o.push(p),c.parts.forEach(f=>{const m=f.material+(f.attributes.normal?"_normal":"")+(f.attributes.color?"_color":"")+(f.attributes.texCoord0?"_texCoord0":"")+(f.attributes.tangent?"_tangent":""),g=s.materials.get(f.material),v=b(f.attributes.texCoord0),w=b(f.attributes.normal),_=__t(g.alphaMode);if(!a.has(m)){if(v){if(b(g.textureColor)&&!l.has(g.textureColor)){const ne=s.textures.get(g.textureColor),D={...ne.parameters,preMultiplyAlpha:_!==hi.Opaque};l.set(g.textureColor,new Hs(ne.data,D))}if(b(g.textureNormal)&&!l.has(g.textureNormal)){const ne=s.textures.get(g.textureNormal);l.set(g.textureNormal,new Hs(ne.data,ne.parameters))}if(b(g.textureOcclusion)&&!l.has(g.textureOcclusion)){const ne=s.textures.get(g.textureOcclusion);l.set(g.textureOcclusion,new Hs(ne.data,ne.parameters))}if(b(g.textureEmissive)&&!l.has(g.textureEmissive)){const ne=s.textures.get(g.textureEmissive);l.set(g.textureEmissive,new Hs(ne.data,ne.parameters))}if(b(g.textureMetallicRoughness)&&!l.has(g.textureMetallicRoughness)){const ne=s.textures.get(g.textureMetallicRoughness);l.set(g.textureMetallicRoughness,new Hs(ne.data,ne.parameters))}}const L=g.color[0]**(1/jS),k=g.color[1]**(1/jS),G=g.color[2]**(1/jS),z=g.emissiveFactor[0]**(1/jS),X=g.emissiveFactor[1]**(1/jS),Z=g.emissiveFactor[2]**(1/jS),ce=b(g.textureColor)&&v?l.get(g.textureColor):null;a.set(m,new DT({...t,transparent:_===hi.Blend,customDepthTest:vT.Lequal,textureAlphaMode:_,textureAlphaCutoff:g.alphaCutoff,diffuse:[L,k,G],ambient:[L,k,G],opacity:g.opacity,doubleSided:g.doubleSided,doubleSidedType:"winding-order",cullFace:g.doubleSided?fi.None:fi.Back,hasVertexColors:!!f.attributes.color,hasVertexTangents:!!f.attributes.tangent,normals:w?"default":"screenDerivative",castShadows:!0,receiveSSAO:!0,textureId:b(ce)?ce.id:void 0,colorMixMode:g.colorMixMode,normalTextureId:b(g.textureNormal)&&v?l.get(g.textureNormal).id:void 0,textureAlphaPremultiplied:b(ce)&&!!ce.params.preMultiplyAlpha,occlusionTextureId:b(g.textureOcclusion)&&v?l.get(g.textureOcclusion).id:void 0,emissiveTextureId:b(g.textureEmissive)&&v?l.get(g.textureEmissive).id:void 0,metallicRoughnessTextureId:b(g.textureMetallicRoughness)&&v?l.get(g.textureMetallicRoughness).id:void 0,emissiveFactor:[z,X,Z],mrrFactors:[g.metallicFactor,g.roughnessFactor,t.mrrFactors[2]],isSchematic:!1,...r}))}const T=b_t(f.indices||f.attributes.position.count,f.primitiveType),x=f.attributes.position.count,E=ax(Zr,x);RL(E,f.attributes.position,f.transform);const C=[[O.POSITION,{data:E.typedBuffer,size:E.elementCount,exclusive:!0}]],A=[[O.POSITION,T]];if(b(f.attributes.normal)){const L=ax(Zr,x);AA(n,f.transform),G1(L,f.attributes.normal,n),C.push([O.NORMAL,{data:L.typedBuffer,size:L.elementCount,exclusive:!0}]),A.push([O.NORMAL,T])}if(b(f.attributes.tangent)){const L=ax(oo,x);AA(n,f.transform),RIe(L,f.attributes.tangent,n),C.push([O.TANGENT,{data:L.typedBuffer,size:L.elementCount,exclusive:!0}]),A.push([O.TANGENT,T])}if(b(f.attributes.texCoord0)){const L=ax(Hd,x);MIe(L,f.attributes.texCoord0),C.push([O.UV0,{data:L.typedBuffer,size:L.elementCount,exclusive:!0}]),A.push([O.UV0,T])}if(b(f.attributes.color)){const L=ax(uc,x);if(f.attributes.color.elementCount===4)f.attributes.color instanceof oo?GQ(L,f.attributes.color,255):f.attributes.color instanceof uc?PIe(L,f.attributes.color):f.attributes.color instanceof N1&&GQ(L,f.attributes.color,1/256);else{IIe(L,255,255,255,255);const k=new D1(L.buffer,0,4);f.attributes.color instanceof Zr?PQ(k,f.attributes.color,255):f.attributes.color instanceof D1?u8(k,f.attributes.color):f.attributes.color instanceof ET&&PQ(k,f.attributes.color,1/256)}C.push([O.COLOR,{data:L.typedBuffer,size:L.elementCount,exclusive:!0}]),A.push([O.COLOR,T])}const P=new Bi(C,A);p.stageResources.geometries.push(P),p.stageResources.materials.push(a.get(m)),v&&(b(g.textureColor)&&p.stageResources.textures.push(l.get(g.textureColor)),b(g.textureNormal)&&p.stageResources.textures.push(l.get(g.textureNormal)),b(g.textureOcclusion)&&p.stageResources.textures.push(l.get(g.textureOcclusion)),b(g.textureEmissive)&&p.stageResources.textures.push(l.get(g.textureEmissive)),b(g.textureMetallicRoughness)&&p.stageResources.textures.push(l.get(g.textureMetallicRoughness))),p.numberOfVertices+=x;const I=P.boundingInfo;b(I)&&(eg(p.boundingBox,I.getBBMin()),eg(p.boundingBox,I.getBBMax()))})}),o}function __t(e){switch(e){case"BLEND":return hi.Blend;case"MASK":return hi.Mask;case"OPAQUE":case null:case void 0:return hi.Opaque}}function b_t(e,t){switch(t){case Lt.TRIANGLES:return l_t(e);case Lt.TRIANGLE_STRIP:return c_t(e);case Lt.TRIANGLE_FAN:return u_t(e)}}function w_t(e,t){for(let r=0;r<e.model.lods.length;++r){const i=e.model.lods[r];e.customMeta.esriTreeRendering=!0;for(const s of i.parts){const n=s.attributes.normal;if(R(n))return;const o=s.attributes.position,a=o.count,l=M(),c=M(),h=M(),p=ax(uc,a),f=ax(Zr,a),m=Cs(Ce(),s.transform);for(let g=0;g<a;g++){o.getVec(g,c),n.getVec(g,l),Ve(c,c,s.transform),pe(h,c,t.center),EU(h,h,t.radius);const v=h[2],w=Re(h),_=Math.min(.45+.55*w*w,1);EU(h,h,t.radius),Ve(h,h,m),we(h,h),r+1!==e.model.lods.length&&e.model.lods.length>1&&En(h,h,l,v>-1?.2:Math.min(-4*v-3.8,1)),f.setVec(g,h),p.set(g,0,255*_),p.set(g,1,255*_),p.set(g,2,255*_),p.set(g,3,255)}s.attributes.normal=f,s.attributes.color=p}}}const EDt=Object.freeze(Object.defineProperty({__proto__:null,fetch:UIe,gltfToEngineResources:ck,parseUrl:VIe},Symbol.toStringTag,{value:"Module"}));var Oi;function x_t(e){let t=ps().mat4f64(O.LOCALTRANSFORM).mat4f64(O.GLOBALTRANSFORM).vec4f64(O.BOUNDINGSPHERE).vec3f64(O.MODELORIGIN).mat3f(O.MODEL).mat3f(O.MODELNORMAL).vec2f(O.MODELSCALEFACTORS);return e.includes("color")&&(t=t.vec4f(O.COLOR)),e.includes("featureAttribute")&&(t=t.vec4f(O.FEATUREATTRIBUTE)),t=t.u8(O.STATE).u8(O.LODLEVEL).alignTo(8),t}(function(e){e[e.ALLOCATED=1]="ALLOCATED",e[e.DEFAULT_ACTIVE=2]="DEFAULT_ACTIVE",e[e.VISIBLE=4]="VISIBLE",e[e.HIGHLIGHT=8]="HIGHLIGHT",e[e.HIGHLIGHT_ACTIVE=16]="HIGHLIGHT_ACTIVE",e[e.REMOVE=32]="REMOVE",e[e.TRANSFORM_CHANGED=64]="TRANSFORM_CHANGED",e[e.ACTIVE=18]="ACTIVE"})(Oi||(Oi={}));class T_t{constructor(t){this.localTransform=t.getField(O.LOCALTRANSFORM,L1),this.globalTransform=t.getField(O.GLOBALTRANSFORM,L1),this.modelOrigin=t.getField(O.MODELORIGIN,Ns),this.model=t.getField(O.MODEL,Ef),this.modelNormal=t.getField(O.MODELNORMAL,Ef),this.modelScaleFactors=t.getField(O.MODELSCALEFACTORS,Hd),this.boundingSphere=t.getField(O.BOUNDINGSPHERE,xT),this.color=t.getField(O.COLOR,oo),this.featureAttribute=t.getField(O.FEATUREATTRIBUTE,oo),this.state=t.getField(O.STATE,b0),this.lodLevel=t.getField(O.LODLEVEL,b0)}}class S_t extends ds{constructor(t,r){super(),this._capacity=0,this._size=0,this._next=0,this._layout=x_t(t),this._shaderTransformation=r}get capacity(){return this._capacity}get size(){return this._size}get buffer(){return this._buffer.buffer}get view(){return this._view}addInstance(){this._size+1>this._capacity&&this._grow();const t=this._findSlot();return this._view.state.set(t,Oi.ALLOCATED),this._size++,this.emit("instance-added",{index:t}),t}removeInstance(t){const r=this._view.state;ft(t>=0&&t<this._capacity&&r.get(t)&Oi.ALLOCATED,"invalid instance handle"),this._getStateFlag(t,Oi.ACTIVE)?this._setStateFlags(t,Oi.REMOVE):this.freeInstance(t),this.emit("instance-removed",{index:t})}freeInstance(t){const r=this._view.state;ft(t>=0&&t<this._capacity&&r.get(t)&Oi.ALLOCATED,"invalid instance handle"),r.set(t,0),this._size--}setLocalTransform(t,r,i=!0){this._view.localTransform.setMat(t,r),i&&this.updateModelTransform(t)}getLocalTransform(t,r){this._view.localTransform.getMat(t,r)}setGlobalTransform(t,r,i=!0){this._view.globalTransform.setMat(t,r),i&&this.updateModelTransform(t)}getGlobalTransform(t,r){this._view.globalTransform.getMat(t,r)}updateModelTransform(t){const r=this._view,i=nv,s=ap;r.localTransform.getMat(t,fme),r.globalTransform.getMat(t,Tj);const n=Yi(Tj,Tj,fme);se(i,n[12],n[13],n[14]),r.modelOrigin.setVec(t,i),Gd(s,n),r.model.setMat(t,s);const o=AGe(nv,n);o.sort(),r.modelScaleFactors.set(t,0,o[1]),r.modelScaleFactors.set(t,1,o[2]),sS(s,s),jd(s,s),r.modelNormal.setMat(t,s),this._setStateFlags(t,Oi.TRANSFORM_CHANGED),this.emit("instance-transform-changed",{index:t})}getModelTransform(t,r){const i=this._view;i.model.getMat(t,ap),i.modelOrigin.getVec(t,nv),r[0]=ap[0],r[1]=ap[1],r[2]=ap[2],r[3]=0,r[4]=ap[3],r[5]=ap[4],r[6]=ap[5],r[7]=0,r[8]=ap[6],r[9]=ap[7],r[10]=ap[8],r[11]=0,r[12]=nv[0],r[13]=nv[1],r[14]=nv[2],r[15]=1}applyShaderTransformation(t,r){this._shaderTransformation&&this._shaderTransformation.applyTransform(this,t,r)}getCombinedModelTransform(t,r){return this.getModelTransform(t,r),this._shaderTransformation&&this._shaderTransformation.applyTransform(this,t,r),r}getCombinedLocalTransform(t,r){return this._view.localTransform.getMat(t,r),this._shaderTransformation&&this._shaderTransformation.applyTransform(this,t,r),r}getCombinedMaxScaleFactor(t){let r=this._view.modelScaleFactors.get(t,1);if(this._shaderTransformation){const i=this._shaderTransformation.scaleFactor(nv,this,t);r*=Math.max(i[0],i[1],i[2])}return r}getCombinedMedianScaleFactor(t){let r=this._view.modelScaleFactors.get(t,0);if(this._shaderTransformation){const i=this._shaderTransformation.scaleFactor(nv,this,t);i.sort(),r*=i[1]}return r}getModel(t,r){this._view.model.getMat(t,r)}setFeatureAttribute(t,r){this._view.featureAttribute.setVec(t,r)}getFeatureAttribute(t,r){this._view.featureAttribute.getVec(t,r)}setColor(t,r){this._view.color.setVec(t,r)}getColor(t,r){this._view.color.getVec(t,r)}setVisible(t,r){r!==this.getVisible(t)&&(this._setStateFlag(t,Oi.VISIBLE,r),this.emit("instance-visibility-changed",{index:t}))}getVisible(t){return this._getStateFlag(t,Oi.VISIBLE)}setHighlight(t,r){r!==this.getHighlight(t)&&(this._setStateFlag(t,Oi.HIGHLIGHT,r),this.emit("instance-highlight-changed",{index:t}))}getHighlight(t){return this._getStateFlag(t,Oi.HIGHLIGHT)}getState(t){return this._view.state.get(t)}getLodLevel(t){return this._view.lodLevel.get(t)}countFlags(t){let r=0;for(let i=0;i<this._capacity;++i)this.getState(i)&t&&++r;return r}_setStateFlags(t,r){const i=this._view.state;r=i.get(t)|r,i.set(t,r)}_clearStateFlags(t,r){const i=this._view.state;r=i.get(t)&~r,i.set(t,r)}_setStateFlag(t,r,i){i?this._setStateFlags(t,r):this._clearStateFlags(t,r)}_getStateFlag(t,r){return!!(this._view.state.get(t)&r)}_grow(){const t=Math.max(E_t,Math.floor(this._capacity*C_t)),r=this._layout.createBuffer(t);if(this._buffer){const i=new Uint8Array(this._buffer.buffer);new Uint8Array(r.buffer).set(i)}this._capacity=t,this._buffer=r,this._view=new T_t(this._buffer)}_findSlot(){const t=this._view.state;let r=this._next;for(;t.get(r)&Oi.ALLOCATED;)r=(r+1)%this._capacity;return this._next=(r+1)%this._capacity,r}}const E_t=1024,C_t=2,nv=M(),ap=$i(),fme=Ce(),Tj=Ce();class A_t extends lf{constructor(t,r){super(i=>this._instanceData.view.boundingSphere.getVec(i,this._tmpSphere),{maximumDepth:25}),this._tmpSphere=kn(),this._tmpMat4=Ce(),this._instanceData=t,this._boundingSphere=r}addInstance(t){const r=this._instanceData.view.boundingSphere,i=this._instanceData.getCombinedModelTransform(t,this._tmpMat4);Ve(this._tmpSphere,this._boundingSphere.center,i),this._tmpSphere[3]=this._boundingSphere.radius*pT(i),r.setVec(t,this._tmpSphere),this.add([t])}removeInstance(t){this.remove([t])}}class R_t{constructor(t,r){this.thresholdScale=1,this._camera=new ii,this._worldSpaceRadius=t,this._thresholds=r.map(i=>i)}updateCamera(t){this._camera.copyFrom(t)}selectLevel(t,r){const i=this._camera.computeScreenPixelSizeAt(t),s=this._worldSpaceRadius*r/i,n=this._thresholds;let o=-1;for(let a=0;a<n.length;++a)s>=n[a]*this.thresholdScale&&(o=a);return o}}class O_t{constructor(t,r){const i=t.renderContext.rctx,{geometry:s,material:n}=r;this._materialRepository=t.materialRep,n.setParameters({instancedDoublePrecision:!0});const o=n.createBufferWriter(),a=o.vertexBufferLayout,l=o.elementCount(s),c=o.allocate(l);o.write({},s,c,0),this.geometry=s,this.material=n,this.glMaterials=new bPe(n,this._materialRepository),this.vertexBufferLayout=a,this.vbo=cr.createVertex(i,Cr.STATIC_DRAW,c.buffer),this.vao=new rn(i,zr,{geometry:du(a)},{geometry:this.vbo}),this.vertexCount=l}destroy(){this.glMaterials.destroy(),this.vbo.dispose(),this.vao.dispose()}get boundingInfo(){return this.geometry.boundingInfo}get triangleCount(){return this.vertexCount/3}intersect(t,r,i,s,n,o,a,l){const c=this.geometry.id;this.material.intersect(this.geometry,null,t.transform.transform,t,i,s,(h,p,f,m,g)=>{if(h>=0){if(r!=null&&!r(t.rayBegin,t.rayEnd,h))return;const v={layerUid:o.layerUid,graphicUid:o.graphicUid(n),geometryId:c,triangleNr:f,baseBoundingSphere:a,numLodLevels:l};if((t.results.min.drapedLayerOrder==null||g>=t.results.min.drapedLayerOrder)&&(t.results.min.dist==null||h<t.results.min.dist)&&t.results.min.set(qi.LOD,v,h,p,t.transform.transform,g),t.options.store!==$o.MIN&&(t.results.max.drapedLayerOrder==null||g>=t.results.max.drapedLayerOrder)&&(t.results.max.dist==null||h>t.results.max.dist)&&t.results.max.set(qi.LOD,v,h,p,t.transform.transform,g),t.options.store===$o.ALL){const w=Die(t.results.min.ray);w.set(qi.LOD,v,h,p,t.transform.transform,g),t.results.all.push(w)}}})}}class $se{constructor(t,r){this.minScreenSpaceRadius=t,this.components=r}static async create(t,r,i){const s=await Promise.allSettled(r.components.map(o=>t.schedule(()=>new O_t(t,o),i))),n=s.map(o=>o.status==="fulfilled"?o.value:null).filter(o=>o);if(gn(i)||n.length!==s.length){n.forEach(o=>o.destroy()),Jt(i);for(const o of s)if(o.status==="rejected")throw o.reason}return new $se(r.minScreenSpaceRadius,n)}destroy(){this.components.forEach(t=>t.destroy())}intersect(t,r,i,s,n,o,a){this.components.forEach(l=>l.intersect(t,r,i,s,n,o,this.boundingSphere,a))}get boundingBox(){if(R(this._boundingBox)){const t=vi();this.components.forEach(r=>{b(r.boundingInfo)&&(eg(t,r.boundingInfo.bbMin),eg(t,r.boundingInfo.bbMax))}),this._boundingBox=t}return this._boundingBox}get boundingSphere(){if(R(this._boundingSphere)){const t=this.boundingBox,r=M();tf(t,r),this._boundingSphere={center:r,radius:.5*Kwe(t)}}return this._boundingSphere}get triangleCount(){return this.components.reduce((t,r)=>t+r.triangleCount,0)}}class M_t{constructor(t,r,i){this._elementSize=r,this._buffer=cr.createVertex(t,Cr.STATIC_DRAW),this.resize(i)}destroy(){this._buffer.dispose()}get elementSize(){return this._elementSize}get capacity(){return this._capacity}get array(){return this._array}get buffer(){return this._buffer}get memoryUsage(){return{cpu:this._capacity*this._elementSize,gpu:this._capacity*this._elementSize}}copyRange(t,r,i,s=0){const n=new Uint8Array(this.array,t*this.elementSize,(r-t)*this.elementSize);new Uint8Array(i.array,s*this.elementSize).set(n)}transferAll(){this._buffer.setData(this._array)}transferRange(t,r){const i=t*this._elementSize,s=r*this._elementSize;this._buffer.setSubData(this._array,i,i,s)}resize(t){const r=t*this._elementSize,i=new ArrayBuffer(r);this._array&&(t>=this._capacity?new Uint8Array(i).set(new Uint8Array(this._array)):new Uint8Array(i).set(new Uint8Array(this._array).subarray(0,t*this._elementSize))),this._array=i,this._buffer.setSize(r),this._capacity=t}}class P_t{constructor(t){this.modelOriginHi=t.getField(O.MODELORIGINHI,Zr),this.modelOriginLo=t.getField(O.MODELORIGINLO,Zr),this.model=t.getField(O.MODEL,Ef),this.modelNormal=t.getField(O.MODELNORMAL,Ef),this.color=t.getField(O.INSTANCECOLOR,oo),this.featureAttribute=t.getField(O.INSTANCEFEATUREATTRIBUTE,oo)}}class mme{constructor(t,r){this._headIndex=0,this._tailIndex=0,this._captureFirstIndex=!0,this._updating=!1,this._prevHeadIndex=0,this._resized=!1,this._rctx=t,this._instanceBufferLayout=r,this._elementSize=r.stride,this._capacity=1}destroy(){this._buffer&&this._buffer.destroy()}get buffer(){return this._buffer.buffer}get view(){return this._view}get capacity(){return this._capacity}get size(){const t=this._headIndex,r=this._tailIndex;return t>=r?t-r:t+this._capacity-r}get isEmpty(){return this._headIndex===this._tailIndex}get isFull(){return this._tailIndex===(this._headIndex+1)%this._capacity}get headIndex(){return this._headIndex}get tailIndex(){return this._tailIndex}get firstIndex(){return this._firstIndex}get memoryUsage(){return this._buffer?this._buffer.memoryUsage:{cpu:0,gpu:0}}reset(){this._headIndex=0,this._tailIndex=0,this._firstIndex=null}startUpdateCylce(){this._captureFirstIndex=!0}beginUpdate(){ft(!this._updating,"already updating"),this._updating=!0,this._prevHeadIndex=this._headIndex}endUpdate(){ft(this._updating,"not updating"),this.size<$_t*this.capacity&&this._shrink(),this._resized?(this._buffer.transferAll(),this._resized=!1):this._transferRange(this._prevHeadIndex,this._headIndex),this._updating=!1}allocateHead(){ft(this._updating,"not updating"),this.isFull&&this._grow();const t=this.headIndex;return this._captureFirstIndex&&(this._firstIndex=t,this._captureFirstIndex=!1),this._incrementHead(),ft(this._headIndex!==this._tailIndex,"invalid pointers"),t}freeTail(){ft(this._updating,"not updating"),ft(this.size>0,"invalid size");const t=this._tailIndex===this._firstIndex;this._incrementTail(),t&&(this._firstIndex=this._tailIndex)}_grow(){const t=Math.max(gme,Math.floor(this._capacity*I_t));this._resize(t)}_shrink(){const t=Math.max(gme,Math.floor(this._capacity*L_t));this._resize(t)}_resize(t){if(ft(this._updating,"not updating"),t===this._capacity)return;const r=new M_t(this._rctx,this._elementSize,t);if(this._buffer){this._firstIndex&&(this._firstIndex=(this._firstIndex+this._capacity-this._tailIndex)%this._capacity);const i=this.size,s=this._compactInstances(r);ft(s===i,"invalid compaction"),this._buffer.destroy(),this._tailIndex=0,this._headIndex=s,this._prevHeadIndex=0}this._resized=!0,this._capacity=t,this._buffer=r,this._view=new P_t(this._instanceBufferLayout.createView(this._buffer.array))}_compactInstances(t){const r=this._headIndex,i=this._tailIndex;return i<r?(this._buffer.copyRange(i,r,t),r-i):i>r?(this._buffer.copyRange(i,this._capacity,t),r>0&&this._buffer.copyRange(0,r,t,this._capacity-i),r+(this._capacity-i)):0}_incrementHead(t=1){this._headIndex=(this._headIndex+t)%this._capacity}_incrementTail(t=1){this._tailIndex=(this._tailIndex+t)%this._capacity}_transferRange(t,r){t<r?this._buffer.transferRange(t,r):t>r&&(r>0&&this._buffer.transferRange(0,r),this._buffer.transferRange(t,this._capacity))}}const gme=1024,I_t=2,$_t=.3,L_t=.5;let D_t=e=>{const t=e.baseBoundingSphere.radius,r=e.levels.map(i=>i.minScreenSpaceRadius);return new R_t(t,r)};class N_t{constructor(t,r,i,s){this.type=qi.LOD,this.isGround=!1,this._levels=[],this._defaultRenderInstanceData=[],this._highlightRenderInstanceData=[],this._instanceIndex=0,this._slicePlane=!1,this._enableLevelSelection=!0,this._lastCamera=new ii,this._updateCyclesWithStaticCamera=-1,this._needFullCycle=!1,this.slots=[Se.OPAQUE_MATERIAL,Se.TRANSPARENT_MATERIAL],this.canRender=!0,this._symbol=t,this._optionalFields=r,this._metadata=i,this._instanceBufferLayout=lIe({instancedDoublePrecision:!0,instanced:r}),this._glInstanceBufferLayout=du(this._instanceBufferLayout,1),this._instanceData=new S_t(this._optionalFields,s),this._instanceData.on("instance-added",()=>this._requestUpdateCycle()),this._instanceData.on("instance-removed",()=>this._requestUpdateCycle()),this._instanceData.on("instance-transform-changed",n=>{this._requestUpdateCycle(),this._metadata.notifyGraphicGeometryChanged(n.index)}),this._instanceData.on("instance-visibility-changed",n=>{this._requestUpdateCycle(!0),this._metadata.notifyGraphicVisibilityChanged(n.index)}),this._instanceData.on("instance-highlight-changed",()=>this._requestUpdateCycle(!0)),this._enableLevelSelection=this._symbol.levels.length>1}get levels(){return this._levels}get baseBoundingBox(){return this._levels[this._levels.length-1].boundingBox}get baseBoundingSphere(){return this._levels[this._levels.length-1].boundingSphere}get baseMaterial(){return this._levels[this._levels.length-1].components[0].material}get slicePlaneEnabled(){return this._slicePlane}set slicePlaneEnabled(t){this._slicePlane=t}get layerUid(){return this._metadata.layerUid}get instanceData(){return this._instanceData}get memoryUsage(){const t={cpu:0,gpu:0};return this._defaultRenderInstanceData.forEach(r=>{const i=r.memoryUsage;t.cpu+=i.cpu,t.gpu+=i.gpu}),this._highlightRenderInstanceData.forEach(r=>{const i=r.memoryUsage;t.cpu+=i.cpu,t.gpu+=i.gpu}),t}get renderStats(){const t=this._instanceData.size,r=[];return this._levels.forEach((i,s)=>{const n=this._defaultRenderInstanceData[s],o=this._highlightRenderInstanceData[s],a=n.size+o.size,l=i.triangleCount;r.push({renderedInstances:a,renderedTriangles:a*l,trianglesPerInstance:l})}),{totalInstances:t,renderedInstances:r.reduce((i,s)=>i+s.renderedInstances,0),renderedTriangles:r.reduce((i,s)=>i+s.renderedTriangles,0),levels:r}}async initializeRenderContext(t,r){this._context=t;const i=t.renderContext.rctx,s=await Promise.allSettled(this._symbol.levels.map(o=>(this._defaultRenderInstanceData.push(new mme(i,this._instanceBufferLayout)),this._highlightRenderInstanceData.push(new mme(i,this._instanceBufferLayout)),$se.create(t,o,r)))),n=s.map(o=>o.status==="fulfilled"?o.value:null).filter(o=>o);if(gn(r)||n.length!==s.length){n.forEach(o=>o.destroy()),Jt(r);for(const o of s)if(o.status==="rejected")throw o.reason}this._levels=n,this._levelSelector=D_t(this)}uninitializeRenderContext(){this._invalidateOctree(),this._levels.forEach(t=>t.destroy()),this._defaultRenderInstanceData.forEach(t=>t.destroy()),this._highlightRenderInstanceData.forEach(t=>t.destroy())}get needsTransparentPass(){return this._levels.some(t=>t.components.some(r=>r.material.requiresSlot(Se.TRANSPARENT_MATERIAL)))}get needsHighlight(){return this._highlightRenderInstanceData.some(t=>t.size>0)}prepareRender(t){if(Xr.LOD_INSTANCE_RENDERER_DISABLE_UPDATES)return;if(this._enableLevelSelection){const i=t.bindParameters.contentCamera.equals(this._lastCamera);this._lastCamera.copyFrom(t.bindParameters.contentCamera),i||this._requestUpdateCycle()}const r=this._needFullCycle?this._instanceData.size:2e3;this._needFullCycle=!1,this._updateInstances(t.bindParameters.contentCamera,r),this.needsUpdates&&this._context.requestRender()}render(t){if(!this.baseMaterial.isVisible()||!this.baseMaterial.isVisibleInPass(t.pass))return;t.rctx.bindVAO();const r=t.pass!==je.MATERIAL_HIGHLIGHT&&t.pass!==je.MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT,i=t.pass!==je.MATERIAL_DEPTH_SHADOWMAP_DEFAULT;r&&this._renderComponents(t,this._defaultRenderInstanceData),i&&this._renderComponents(t,this._highlightRenderInstanceData)}intersect(t,r,i,s){if(!this.baseMaterial.isVisible())return;const n=M();pe(n,s,i);const o=a=>{this._instanceData.getCombinedModelTransform(a,_me),t.transform.set(_me),Ve(bme,i,t.transform.inverse),Ve(wme,s,t.transform.inverse);const l=this._instanceData.getState(a),c=this._instanceData.getLodLevel(a),h=this._levels.length;ft(l&Oi.ACTIVE,"invalid instance state"),ft(c>=0&&c<h,"invaid lod level"),this._levels[c].intersect(t,r,bme,wme,a,this._metadata,h)};this.baseMaterial.parameters.verticalOffset?this.octree.forEach(o):this.octree.forEachAlongRay(i,n,o)}queryDepthRange(t){return this._queryDepthRangeOctree(t)}notifyShaderTransformationChanged(){this._invalidateOctree()}_requestUpdateCycle(t=!1){this._updateCyclesWithStaticCamera=-1,t&&(this._needFullCycle=!0),this.needsUpdates&&this._context.requestRender()}get needsUpdates(){return this._instanceData.size>0&&this._updateCyclesWithStaticCamera<1}get octree(){return this._octree||(this._octree=this._buildOctree()),this._octree}_invalidateOctree(){this._octree&&(this._octree.destroy(),this._octree=null)}_buildOctree(){const t=new A_t(this._instanceData,this.baseBoundingSphere),r=this._instanceData,i=r.view?r.view.state:null;for(let s=0;s<this._instanceData.capacity;++s)i.get(s)&Oi.ACTIVE&&t.addInstance(s);return t}_queryDepthRangeOctree(t){const r=t.eye,i=t.viewForward,s=this.octree.findClosest(i,lf.DepthOrder.FRONT_TO_BACK,t.frustum),n=this.octree.findClosest(i,lf.DepthOrder.BACK_TO_FRONT,t.frustum);if(s!=null&&n!=null){this._instanceData.view.boundingSphere.getVec(s,jf),pe(jf,jf,r);const o=Te(jf,i)-jf[3];this._instanceData.view.boundingSphere.getVec(n,jf),pe(jf,jf,r);const a=Te(jf,i)+jf[3];return{near:Math.max(t.near,o),far:Math.min(t.far,a)}}return{near:1/0,far:-1/0}}_startUpdateCycle(){this._updateCyclesWithStaticCamera++,this._defaultRenderInstanceData.forEach(t=>{t.startUpdateCylce()}),this._highlightRenderInstanceData.forEach(t=>{t.startUpdateCylce()}),this.needsUpdates&&this._context.requestRender()}_updateInstances(t,r){const i=this._enableLevelSelection,s=this._levelSelector;s.updateCamera(t),this._defaultRenderInstanceData.forEach(h=>{h.beginUpdate()}),this._highlightRenderInstanceData.forEach(h=>{h.beginUpdate()});const n=this._instanceData,o=this._instanceData.view,a=n.size,l=n.capacity;let c=this._instanceIndex;r=Math.min(a,r);for(let h=0;h<r;++h){c===0&&this._startUpdateCycle();const p=o.state.get(c);let f=0;if(!(p&Oi.ALLOCATED)){c=(c+1)%l,r++;continue}const m=o.lodLevel.get(c);if(p&Oi.DEFAULT_ACTIVE&&this._defaultRenderInstanceData[m].freeTail(),p&Oi.HIGHLIGHT_ACTIVE&&this._highlightRenderInstanceData[m].freeTail(),p&Oi.REMOVE)n.freeInstance(c);else if(p&Oi.VISIBLE){let g=0;i&&(o.modelOrigin.getVec(c,vme),g=s.selectLevel(vme,n.getCombinedMedianScaleFactor(c))),f=p&~(Oi.ACTIVE|Oi.TRANSFORM_CHANGED),g>=0&&(p&Oi.HIGHLIGHT?(yme(this._highlightRenderInstanceData[g],o,c),f|=Oi.HIGHLIGHT_ACTIVE):(yme(this._defaultRenderInstanceData[g],o,c),f|=Oi.DEFAULT_ACTIVE)),o.state.set(c,f),o.lodLevel.set(c,g)}else f=p&~(Oi.ACTIVE|Oi.TRANSFORM_CHANGED),o.state.set(c,f);if(this._octree){const g=!!(p&Oi.ACTIVE),v=!!(f&Oi.ACTIVE);!g&&v?this._octree.addInstance(c):g&&!v?this._octree.removeInstance(c):g&&v&&p&Oi.TRANSFORM_CHANGED&&(this._octree.removeInstance(c),this._octree.addInstance(c))}c=(c+1)%l}this._instanceIndex=c,this._defaultRenderInstanceData.forEach(h=>{h.endUpdate()}),this._highlightRenderInstanceData.forEach(h=>{h.endUpdate()})}_renderComponents(t,r){this.levels.forEach((i,s)=>{i.components.forEach(n=>{this._renderComponent(t,r[s],n,s)})})}_renderComponent(t,r,i,s){const n=t.bindParameters;if(r.size===0||!i.material.requiresSlot(n.slot))return;const{rctx:o,pass:a}=t,l=i.glMaterials.load(o,a);if(R(l))return;const c=l.beginSlot(n),h=o.bindTechnique(c,i.material.parameters,n);o.bindVAO(i.vao),c.ensureAttributeLocations(i.vao),c.bindDraw(k_t,n),Xr.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL&&t.pass===je.MATERIAL&&(h.setUniform4fv("externalColor",xme[Math.min(s,xme.length-1)]),h.setUniform1i("colorMixMode",f3e.replace));const p=o.capabilities.instancing,f=r.capacity,m=r.headIndex,g=r.tailIndex,v=r.firstIndex,w=this._glInstanceBufferLayout,_=(T,x)=>{aie(o,zr,r.buffer,w,T),p.drawArraysInstanced(c.primitiveType,0,i.vertexCount,x-T),lie(o,zr,r.buffer,w)};i.material.parameters.transparent&&v!=null?m>g?(ft(v>=g&&v<=m,"invalid firstIndex"),_(v,m),_(g,v)):m<g&&(v<=m?(ft(v>=0&&v<=m,"invalid firstIndex"),_(v,m),_(g,f),_(0,v)):(ft(v>=g&&v<=f,"invalid firstIndex"),_(v,f),_(0,m),_(g,v))):m>g?_(g,m):m<g&&(_(0,m),_(g,f)),o.bindVAO(null)}}function yme(e,t,r){const i=e.allocateHead();F_t(t,r,e.view,i)}function F_t(e,t,r,i){hct(e.modelOrigin,t,r.modelOriginHi,r.modelOriginLo,i),r.model.copyFrom(i,e.model,t),r.modelNormal.copyFrom(i,e.modelNormal,t),e.color&&r.color&&r.color.copyFrom(i,e.color,t),e.featureAttribute&&r.featureAttribute&&r.featureAttribute.copyFrom(i,e.featureAttribute,t)}const vme=M(),jf=Zt(),_me=Ce(),bme=M(),wme=M(),xme=[[1,0,1,1],[0,0,1,1],[0,1,0,1],[1,1,0,1],[1,0,0,1]],k_t=new ayt;class U_t extends Eg{constructor(t,r,i,s){super(t,r,i,s),this._resources=null,this._optionalFields=new Array,this._instanceIndexToGraphicUid=new Map,this.hasLoadedPBRTextures=!1,this._disposeResourceHandles=new Array,this.ensureDrapedStatus(!1),this.hasLoadedPBRTextures=i.physicalBasedRenderingEnabled}getCachedSize(){const[t,r,i]=b(this._resources)?this._resources.symbolSize:[1,1,1];return{width:t,depth:r,height:i}}async doLoad(t){if(!this._drivenProperties.size&&UB(this.symbolLayer))throw new Error;const r=this.symbolLayer;if(this.isPrimitive){const i=r.resource?r.resource.primitive:Hee;this._resources=await this._createResourcesForPrimitive(i,t)}else this._resources=await this._createResourcesForUrl(r.resource.href,t);this.layerOpacityChanged(),this.slicePlaneEnabledChanged(),this.physicalBasedRenderingChanged(),this.complexity=this.computeComplexity()}get extentPadding(){return b(this._resources)?this._resources.extentPadding:0}get isPrimitive(){return!(this.symbolLayer.resource&&this.symbolLayer.resource.href)}get lodRenderer(){return ki(this._resources,"lodRenderer")}_setMaterialTransparencyParams(t,r=ki(this.symbolLayer,"material","color")){const i=this._getCombinedOpacity(r),s=i<1||this.needsDrivenTransparentPass;return t.transparent=s,t.opacity=i,t.cullFace=s?fi.None:fi.Back,t}async _createResourcesForPrimitive(t,r){if(!Hft(t))throw new Error(`Unknown object symbol primitive: ${t}`);const i=this.symbolLayer,s=tn(RBe(t)),n=Bl(RD(s)),o=Bl(j9(n,i)),a=Re(o),l=!1,c=!1,h={usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0,ambient:Nm,diffuse:Nm,hasSlicePlane:this._context.slicePlaneEnabled,hasSliceHighlight:!1,castShadows:this.symbolLayer.castShadows,offsetTransparentBackfaces:!this.symbolLayer.isPrimitive},p=h.usePBR;this._setMaterialTransparencyParams(h);const f=this.symbol;if(f.type==="point-3d"&&f.verticalOffset){const{screenLength:_,minWorldLength:T,maxWorldLength:x}=f.verticalOffset;h.verticalOffset={screenLength:yr(_),minWorldLength:T||0,maxWorldLength:x!=null?x:1/0},h.castShadows=!1}if(this._context.screenSizePerspectiveEnabled&&(h.screenSizePerspective=this._context.sharedResources.screenSizePerspectiveSettings),this._drivenProperties.color)h.externalColor=Sd;else{const _=b(i.material)&&i.material.color,T=b(_)?Me.toUnitRGBA(_):Sd;h.externalColor=T}this._fastUpdates=p$(this._context.renderer,this._fastVisualVariableConvertOptions(s,o,n,Xb)),h.instanced=["transformation"],this._fastUpdates.enabled?(Object.assign(h,this._fastUpdates.materialParameters),h.instanced.push("featureAttribute"),this._optionalFields.push("featureAttribute")):this._hasPerInstanceColor()&&(h.instanced.push("color"),this._optionalFields.push("color"));const m=new DT(h),g=nPe(t,m);if(!g)throw new Error(`Unknown object symbol primitive: ${t}`);const v=YN(g).map(_=>({opacity:1,transparent:_.parameters.transparent})),w=await this._createStageResources(g,p);return{lodResources:g,lodRenderer:await this._createLodRenderer(g,r),stageResources:w,symbolSize:o,extentPadding:a,isEsriSymbolResource:l,isWosr:c,originalMaterialParameters:v,physicalBasedRenderingEnabled:p,resourceBoundingBox:s,resourceSize:n,pivotOffset:Xb}}async _createResourcesForUrl(t,r){const i=["transformation"],s={materialParamsMixin:{instanced:i,hasSlicePlane:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows},streamDataRequester:this._context.streamDataRequester,cache:this._context.sharedResources.objectResourceCache};this._fastUpdates=p$(this._context.renderer,this._fastVisualVariableConvertOptions(Xb,Xb,Xb,Xb)),this._fastUpdates.enabled?(Object.assign(s.materialParamsMixin,this._fastUpdates.materialParameters),i.push("featureAttribute"),this._optionalFields.push("featureAttribute")):this._hasPerInstanceColor()&&(i.push("color"),this._optionalFields.push("color"));const n=this.symbol;if(n.type==="point-3d"&&n.verticalOffset){const{screenLength:L,minWorldLength:k,maxWorldLength:G}=n.verticalOffset;s.materialParamsMixin.verticalOffset={screenLength:yr(L),minWorldLength:k||0,maxWorldLength:G!=null?G:1/0},s.materialParamsMixin.castShadows=!1}s.signal=r,s.usePBR=this._context.physicalBasedRenderingEnabled;const o=s.usePBR,a=await UIe(t,s),l=a.isEsriSymbolResource,c=a.isWosr;this._addDisposeResource(()=>a.remove());const h=Tvt(a.lods);Evt(h),h.levels.sort((L,k)=>L.minScreenSpaceRadius-k.minScreenSpaceRadius),h.levels[0].minScreenSpaceRadius=Math.min(2,h.levels[0].minScreenSpaceRadius);const p=this._context,f=this.symbolLayer.material,m=this._getExternalColorParameters(f),g=ki(this.symbolLayer,"material","color"),v=this._getCombinedOpacity(g,{hasIntrinsicColor:!0}),w=this.needsDrivenTransparentPass,_=YN(h),T=YN(h).map(L=>({opacity:L.parameters.opacity||1,transparent:L.parameters.transparent}));_.forEach(L=>{const k=L.parameters;L.setParameters(m);const G=k.opacity*v,z=G<1||w||k.transparent;L.setParameters({opacity:G,transparent:z}),p.screenSizePerspectiveEnabled&&L.setParameters({screenSizePerspective:p.sharedResources.screenSizePerspectiveSettings})});const x=a.referenceBoundingBox,E=Bl(RD(x)),C=Bl(h.levels[0].pivotOffset),A=Bl(j9(E,this.symbolLayer)),P=Re(A);f$(this._fastUpdates,this._context.renderer,this._fastVisualVariableConvertOptions(x,A,E,C))&&_.forEach(L=>L.setParameters(this._fastUpdates.materialParameters));const I=await this._createStageResources(h,o);return{lodResources:h,lodRenderer:await this._createLodRenderer(h,r),stageResources:I,symbolSize:A,extentPadding:P,isEsriSymbolResource:l,isWosr:c,originalMaterialParameters:T,physicalBasedRenderingEnabled:o,resourceBoundingBox:x,resourceSize:E,pivotOffset:C}}_addDisposeResource(t){this._disposeResourceHandles.push(t)}async _createStageResources(t,r){const i=this._context.stage,s=YN(t);r!==this._context.physicalBasedRenderingEnabled&&this.physicalBasedRenderingChanged(),i.addMany(s),this._addDisposeResource(()=>i.removeMany(s));const n=Kft(t);i.addMany(n),this._addDisposeResource(()=>i.removeMany(n)),await i.load(n);const o=emt(t);return i.addMany(o),this._addDisposeResource(()=>i.removeMany(o)),{materials:s,textures:n,geometries:o}}async _createLodRenderer(t,r){const i=this._context.stage,s={layerUid:this._context.layer.uid,graphicUid:a=>this._instanceIndexToGraphicUid.get(a),notifyGraphicGeometryChanged:a=>this._context.notifyGraphicGeometryChanged(this._instanceIndexToGraphicUid.get(a)),notifyGraphicVisibilityChanged:a=>this._context.notifyGraphicVisibilityChanged(this._instanceIndexToGraphicUid.get(a))},n=this._fastUpdates.enabled?{applyTransform:(a,l,c)=>{a.getFeatureAttribute(l,gF),Is(c,FQ(this._fastUpdates.materialParameters,gF,c))},scaleFactor:(a,l,c)=>(l.getFeatureAttribute(c,gF),Hyt(a,this._fastUpdates.materialParameters,gF))}:null,o=new N_t(t,this._optionalFields,s,n);return o.slicePlaneEnabled=this._context.slicePlaneEnabled,this._addDisposeResource(()=>{i.removeRenderPlugin(o)}),await i.addRenderPlugin(o.slots,o,r),o}_getExternalColorParameters(t){const r={};return this._drivenProperties.color?r.externalColor=Sd:b(t)&&b(t.color)?r.externalColor=Me.toUnitRGBA(t.color):(r.externalColor=Sd,r.colorMixMode="ignore"),r}destroy(){super.destroy(),this._cleanupResources()}_cleanupResources(){this._disposeResourceHandles.forEach(t=>t()),this._disposeResourceHandles.length=0,this._resources=null}createGraphics3DGraphic(t){const r=t.graphic;if(!this._validateGeometry(r.geometry))return null;const i=c$(r.geometry);if(R(i))return this.logger.warn(`unsupported geometry type for icon symbol: ${r.geometry.type}`),null;const s=this.setGraphicElevationContext(r,new Ah),n=t.renderingInfo;return this._createAs3DShape(r,i,n,s,r.uid)}notifyDestroyGraphicLayer(t){this._instanceIndexToGraphicUid.delete(t.instanceIndex)}graphicLayerToGraphicId(){return 0}layerOpacityChanged(){if(R(this._resources))return!0;const t=this._drivenProperties.opacity,r=!this.isPrimitive,i=this._resources.stageResources.materials,s=this._resources.originalMaterialParameters;for(let n=0;n<i.length;n++){const o=i[n],a=ki(this.symbolLayer,"material","color"),l=s[n],c=this._getCombinedOpacity(a,{hasIntrinsicColor:r})*l.opacity,h=c<1||t||l.transparent;o.setParameters({opacity:c,transparent:h}),this.isPrimitive&&o.setParameters({cullFace:h?fi.None:fi.Back})}return!0}layerElevationInfoChanged(t,r){return this.updateGraphics3DGraphicElevationInfo(t,r,B1)}slicePlaneEnabledChanged(){if(R(this._resources))return!0;this._resources.lodRenderer.slicePlaneEnabled=this._context.slicePlaneEnabled;for(const t of this._resources.stageResources.materials)t.setParameters({hasSlicePlane:this._context.slicePlaneEnabled});return!0}physicalBasedRenderingChanged(){if(R(this._resources))return!0;const{stageResources:t,isWosr:r}=this._resources;for(const i of t.materials)this.isPrimitive?i.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}):r||i.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!1});return this.hasLoadedPBRTextures!==!1||this._context.physicalBasedRenderingEnabled!==!0||(this.hasLoadedPBRTextures=!0,!1)}pixelRatioChanged(){return!0}applyRendererDiff(t,r){if(R(this._resources))return bn.Recreate_Symbol;const{stageResources:{materials:i},lodRenderer:s,resourceBoundingBox:n,symbolSize:o,resourceSize:a,pivotOffset:l}=this._resources;for(const c in t.diff){if(c!=="visualVariables"||!f$(this._fastUpdates,r,this._fastVisualVariableConvertOptions(n,o,a,l)))return bn.Recreate_Symbol;for(const h of i)h.setParameters(this._fastUpdates.materialParameters);s.notifyShaderTransformationChanged()}return bn.Fast_Update}computeComplexity(){return R(this._resources)?super.computeComplexity():{primitivesPerFeature:vse(this._resources.lodResources.levels[0]).reduce((t,r)=>t+r.indices.get(O.POSITION).length,0)/3,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1,memory:uPe(this.symbol,this.symbolLayer)}}_hasLodRenderer(){return b(this._resources)}_createAs3DShape(t,r,i,s,n){if(!this._hasLodRenderer()||R(this._resources))return null;const o=this.getFastUpdateAttrValues(t),a=!this._fastUpdates.enabled&&this._hasPerInstanceColor()?vP(i.color,i.opacity):null,l=this._context.clippingExtent;if(so(r,HS,this._context.elevationProvider.spatialReference),b(l)&&!Bee(l,HS))return null;const c=this._requiresTerrainElevation(s),h=this._computeGlobalTransform(r,s,Sj,yF),p=this._computeLocalTransform(this._resources,this.symbolLayer,i,Tme),f=this._resources.lodRenderer.instanceData,m=f.addInstance();this._instanceIndexToGraphicUid.set(m,n),f.setLocalTransform(m,p,!1),f.setGlobalTransform(m,h),o&&f.setFeatureAttribute(m,o),a&&f.setColor(m,a);const g=new bvt(this,m,Fft,s);return c&&(g.alignedSampledElevation=yF.sampledElevation),g.needsElevationUpdates=B1(s.mode),l$(g,r,this._context.elevationProvider),g}_computeGlobalTransform(t,r,i,s){return x0(t,this._context.elevationProvider,r,this._context.renderCoordsHelper,s),HS[0]=t.x,HS[1]=t.y,HS[2]=s.z,bh(t.spatialReference,HS,i,this._context.renderCoordsHelper.spatialReference),i}_computeLocalTransform(t,r,i,s){return ig(s),this._applyObjectRotation(i,!1,s),this._applyObjectRotation(r,!0,s),this._applyObjectScale(t,i,s),this._applyAnchor(t,r,s),s}_applyObjectScale(t,r,i){if(this._fastUpdates.enabled&&this._fastUpdates.requiresShaderTransformation)return;const s=this._drivenProperties.size&&r.size?r.size:t.symbolSize,n=qpe(s,t.symbolSize,t.resourceSize,this._context.renderCoordsHelper.unitInMeters);n[0]===1&&n[1]===1&&n[2]===1||v6(i,i,n)}prepareSymbolLayerPatch(t){if(t.diff.type!=="partial")return;const r=t.diff.diff;this._preparePatchTransform(t,r),this._preparePatchColor(t,r)}updateGeometry(t,r){if(R(this._resources))return!0;const i=r&&c$(r);if(R(i))return!1;const s=this.getGeometryElevationMode(r);return t.elevationContext.mode===s&&(this._computeGlobalTransform(i,t.elevationContext,Sj,yF),this._requiresTerrainElevation(t.elevationContext)&&(t.alignedSampledElevation=yF.sampledElevation),this._resources.lodRenderer.instanceData.setGlobalTransform(t.instanceIndex,Sj,!0),l$(t,i,this._context.elevationProvider),!0)}_preparePatchTransform(t,r){if(!(r.heading||r.tilt||r.roll||r.width||r.height||r.depth||r.anchor||r.anchorPosition)||R(this._resources))return;const i=(g,v,w)=>_t(g!=null&&g.type==="complete"?g.newValue:v,w),s=i(r.heading,this.symbolLayer.heading,0),n=i(r.tilt,this.symbolLayer.tilt,0),o=i(r.roll,this.symbolLayer.roll,0),a=i(r.width,this.symbolLayer.width,void 0),l=i(r.height,this.symbolLayer.height,void 0),c=i(r.depth,this.symbolLayer.depth,void 0),h=i(r.anchor,this.symbolLayer.anchor,void 0),p=i(r.anchorPosition,this.symbolLayer.anchorPosition,void 0);delete r.heading,delete r.tilt,delete r.roll,delete r.width,delete r.height,delete r.depth,delete r.anchor,delete r.anchorPosition;const f={heading:s,tilt:n,roll:o,anchor:h,anchorPosition:p},m=this._resources;this.loadStatus===Wu.LOADED&&t.symbolLayerStatePatches.push(()=>{m.symbolSize=Bl(j9(m.resourceSize,{width:a,height:l,depth:c,isPrimitive:this.symbolLayer.isPrimitive}))}),t.graphics3DGraphicPatches.push((g,v)=>{const w=this._computeLocalTransform(m,f,v,Tme),_=g.instanceIndex;m.lodRenderer.instanceData.setLocalTransform(_,w,!0)})}_preparePatchColor(t,r){if(!r.material||r.material.type!=="partial")return;const i=r.material.diff;if(!i.color||i.color.type!=="complete"||i.color.newValue==null||i.color.oldValue==null)return;const s=i.color.newValue,n=b(s)?Me.toUnitRGBA(s):Sd;delete i.color;const o=this._resources;R(o)||t.graphics3DGraphicPatches.push(a=>{let l;this._hasPerInstanceColor()?(o.lodRenderer.instanceData.setColor(a.instanceIndex,n),l=this._setMaterialTransparencyParams({},s)):l=this._setMaterialTransparencyParams({externalColor:n},s);for(const c of o.stageResources.materials)c.setParameters(l)})}_requiresTerrainElevation(t){return t.mode!=="absolute-height"}_applyObjectRotation(t,r,i){if(!(this._fastUpdates.enabled&&this._fastUpdates.requiresShaderTransformation&&r))return Cft(t.heading,t.tilt,t.roll,i)}_computeAnchor(t,r,i){const s=M();switch(i.anchor){case"center":ae(s,tf(t)),Ra(s,s);break;case"top":{const n=tf(t);se(s,-n[0],-n[1],-t[5]);break}case"bottom":{const n=tf(t);se(s,-n[0],-n[1],-t[2]);break}case"relative":{const n=tf(t),o=RD(t),a=i.anchorPosition,l=a?Ue(a.x,a.y,a.z):dl;Jz(s,o,l),de(s,s,n),Ra(s,s);break}default:b(r)?Ra(s,r):ae(s,dl)}return s}_applyAnchor(t,r,i){if(this._fastUpdates.enabled&&this._fastUpdates.requiresShaderTransformation)return;const s=this._computeAnchor(t.resourceBoundingBox,t.pivotOffset,r);s&&yl(i,i,s)}_hasPerInstanceColor(){return this._drivenProperties.color||this._drivenProperties.opacity}_fastVisualVariableConvertOptions(t,r,i,s){const n=b(t)?Bl(RD(t)):Nm,o=b(t)?this._computeAnchor(t,s,this.symbolLayer):dl,a=this._context.renderCoordsHelper.unitInMeters,l=qpe(b(r)?r:void 0,r,i,a),c=Ue(this.symbolLayer.tilt||0,this.symbolLayer.roll||0,this.symbolLayer.heading||0);return{modelSize:n,symbolSize:b(r)?r:Nm,unitInMeters:a,transformation:{anchor:o,scale:l,rotation:c}}}}const HS=M(),Tme=Ce(),Sj=Ce(),gF=Zt(),yF=new AL;function V_t(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function z_t(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e}function Lse(e,t,r,i,s){return e[0]=t,e[1]=r,e[2]=i,e[3]=s,e}function B_t(e,t){if(e===t){const r=t[1];e[1]=t[2],e[2]=r}else e[0]=t[0],e[1]=t[2],e[2]=t[1],e[3]=t[3];return e}function G_t(e,t){const r=t[0],i=t[1],s=t[2],n=t[3];let o=r*n-s*i;return o?(o=1/o,e[0]=n*o,e[1]=-i*o,e[2]=-s*o,e[3]=r*o,e):null}function j_t(e,t){const r=t[0];return e[0]=t[3],e[1]=-t[1],e[2]=-t[2],e[3]=r,e}function H_t(e){return e[0]*e[3]-e[2]*e[1]}function zIe(e,t,r){const i=t[0],s=t[1],n=t[2],o=t[3],a=r[0],l=r[1],c=r[2],h=r[3];return e[0]=i*a+n*l,e[1]=s*a+o*l,e[2]=i*c+n*h,e[3]=s*c+o*h,e}function q_t(e,t,r){const i=t[0],s=t[1],n=t[2],o=t[3],a=Math.sin(r),l=Math.cos(r);return e[0]=i*l+n*a,e[1]=s*l+o*a,e[2]=i*-a+n*l,e[3]=s*-a+o*l,e}function W_t(e,t,r){const i=t[0],s=t[1],n=t[2],o=t[3],a=r[0],l=r[1];return e[0]=i*a,e[1]=s*a,e[2]=n*l,e[3]=o*l,e}function X_t(e,t){const r=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=r,e[2]=-r,e[3]=i,e}function Z_t(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=t[1],e}function Y_t(e){return"mat2("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}function Q_t(e){return Math.sqrt(e[0]**2+e[1]**2+e[2]**2+e[3]**2)}function J_t(e,t,r,i){return e[2]=i[2]/i[0],r[0]=i[0],r[1]=i[1],r[3]=i[3]-e[2]*r[1],[e,t,r]}function K_t(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e}function BIe(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e}function e1t(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]}function t1t(e,t){const r=e[0],i=e[1],s=e[2],n=e[3],o=t[0],a=t[1],l=t[2],c=t[3];return Math.abs(r-o)<=At*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(i-a)<=At*Math.max(1,Math.abs(i),Math.abs(a))&&Math.abs(s-l)<=At*Math.max(1,Math.abs(s),Math.abs(l))&&Math.abs(n-c)<=At*Math.max(1,Math.abs(n),Math.abs(c))}function r1t(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e}function i1t(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e[2]=t[2]+r[2]*i,e[3]=t[3]+r[3]*i,e}const s1t=zIe,n1t=BIe;Object.freeze(Object.defineProperty({__proto__:null,copy:V_t,identity:z_t,set:Lse,transpose:B_t,invert:G_t,adjoint:j_t,determinant:H_t,multiply:zIe,rotate:q_t,scale:W_t,fromRotation:X_t,fromScaling:Z_t,str:Y_t,frob:Q_t,LDU:J_t,add:K_t,subtract:BIe,exactEquals:e1t,equals:t1t,multiplyScalar:r1t,multiplyScalarAndAdd:i1t,mul:s1t,sub:n1t},Symbol.toStringTag,{value:"Module"}));class o1t extends Bi{constructor(t,r,i,s,n,o){super(t,r),this.path=i,this.geometrySR=s,this.upVectorAlignment=n,this.stencilWidth=o}}function GIe(e){return"upVectorAlignment"in e}function jIe(){return[1,0,0,1]}function a1t(e){return[e[0],e[1],e[2],e[3]]}function l1t(e,t,r,i){return[e,t,r,i]}function c1t(e,t){return new Float64Array(e,t,4)}Object.freeze(Object.defineProperty({__proto__:null,create:jIe,clone:a1t,fromValues:l1t,createView:c1t},Symbol.toStringTag,{value:"Module"}));function jQ(){return{up:M(),right:M()}}function u1t(e,t,r){Ve(e.up,t.up,r),Ve(e.right,t.right,r)}function h1t(e,t,r){vr(e,Te(r,t.right),Te(r,t.up))}class d1t{constructor(){this.pos=M(),this.posES=M(),this.posGS=M(),this.vRight=M(),this.vLeft=M(),this.frame=jQ(),this.rotationFrame=jQ(),this.rotationRight=rt(),this.rotationAngle=0,this.miterStretch=jIe()}setFrameFromUpVector(t){ae(this.frame.up,t),de(ed,this.vLeft,this.vRight),we(ed,ed),le(Op,this.frame.up,Te(ed,this.frame.up)),pe(_F,ed,Op),we(_F,_F),ut(this.frame.right,_F,this.frame.up)}computeRotationAxisAndAngleFromUpVector(){ae(this.rotationFrame.up,this.frame.up),ae(this.rotationFrame.right,this.frame.right),vr(this.rotationRight,1,0),le(Op,this.frame.up,Te(this.frame.up,this.vLeft)),pe(Op,this.vLeft,Op),Ra(Op,Op),we(Op,Op),le(ed,this.frame.up,Te(this.frame.up,this.vRight)),pe(ed,this.vRight,ed),we(ed,ed),ut(HQ,this.rotationFrame.up,this.vLeft);const t=Math.sign(Te(HQ,this.vRight));if(this.rotationAngle=t*(Math.PI-Cn(Te(Op,ed))),Math.abs(this.rotationAngle)>0){const i=Kq(Math.cos(.5*this.rotationAngle));Lse(this.miterStretch,i-1+1,0,0,1)}const r=Math.PI-this.rotationAngle;this.maxStretchDistance=Math.abs(Math.min(this.vLeftLength,this.vRightLength)/Math.cos(.5*r))}}class g${constructor(){this.vertices=[],this.vertexIndices=[],this.vertexNormals=[],this.poles=[],this.poleIndices=[],this.uvs=null,this.uvIndices=null}addVertex(t,r){return this.vertices.push(FM(t)),this.vertexNormals.push(FM(r)),this.vertices.length-1}addUV(t){return this.uvs||(this.uvs=[],this.uvIndices=[]),this.uvs.push(t),this.uvs.length-1}addPole(t,r=null){return this.poles.push({position:FM(t),normal:r?FM(r):null}),this.poles.length-1}addSegment(t,r=null,i=null){this.vertexIndices.push(t.v0),this.vertexIndices.push(t.v1),r&&(this.uvIndices.push(r.v0),this.uvIndices.push(r.v1)),i&&(this.poleIndices.push(i.v0),this.poleIndices.push(i.v1))}get numSegments(){return this.vertexIndices.length/2}hasUV(){return this.uvs!=null}translate(t,r){for(const i of this.vertices)i[0]+=t,i[1]+=r;for(const i of this.poles)i.position[0]+=t,i.position[1]+=r}static circle(t=20){const i=new g$,s={v0:0,v1:0};i.addPole(Fr(0,0));for(let a=0;a<t;++a){const l=2*a*Math.PI/t,c=Math.cos(l),h=Math.sin(l),p=Fr(c*.5,h*.5),f=Fr(c,h);i.addVertex(p,f),i.addUV(a/t)}i.addUV(1);for(let a=0;a<t-1;++a){const l={v0:a,v1:a+1},c=l;i.addSegment(l,c,s)}const n={v0:t-1,v1:0},o={v0:t-1,v1:t};return i.addSegment(n,o,s),i}static rect(){const i=new g$,s=Fr(.5*-1,.5*-1),n=Fr(.5*1,.5*-1),o=Fr(.5*1,.5*1),a=Fr(.5*-1,.5*1),l=Fr(0,-1),c=Fr(1,0),h=Fr(0,1),p=Fr(-1,0);i.addUV(0),i.addUV(1),i.addPole(Fr(0,.5*1),h),i.addPole(Fr(0,.5*1)),i.addPole(Fr(0,.5*-1)),i.addPole(Fr(0,.5*-1),l);const f={v0:0,v1:1};return i.addVertex(s,l),i.addVertex(n,l),i.addSegment({v0:0,v1:1},f,{v0:3,v1:3}),i.addVertex(n,c),i.addVertex(o,c),i.addSegment({v0:2,v1:3},f,{v0:2,v1:1}),i.addVertex(o,h),i.addVertex(a,h),i.addSegment({v0:4,v1:5},f,{v0:0,v1:0}),i.addVertex(a,p),i.addVertex(s,p),i.addSegment({v0:6,v1:7},f,{v0:1,v1:2}),i}}class p1t{constructor(t){this.vertices=[],this.offset=M(),this.xform=Ce(),this.vertices=t;const r=Math.floor((t.length-1)/2);ae(this.offset,this.vertices[r].pos);for(const i of this.vertices)pe(i.pos,i.pos,this.offset);yl(this.xform,this.xform,this.offset),this.updatePathVertexInformation()}updatePathVertexInformation(){const t=this.vertices.length;let r=this.vertices[0];r.index=0,se(r.vLeft,0,0,0),r.vLeftLength=0,pe(r.vRight,this.vertices[1].pos,r.pos),r.vRightLength=Re(r.vRight),we(r.vRight,r.vRight);let i=r;for(let s=1;s<t;++s)r=this.vertices[s],r.index=s,ae(r.vLeft,i.vRight),r.vLeftLength=i.vRightLength,s<t-1?(pe(r.vRight,this.vertices[s+1].pos,r.pos),r.vRightLength=Re(r.vRight),we(r.vRight,r.vRight)):(ae(r.vRight,r.vLeft),r.vRightLength=r.vLeftLength),i=r}}function f1t(e,t){let r=null;const i=e.vertices.length,s=.99619469809,n=M(),o=M(),a=M(),l=M(),c=M(),h=M(),p=Er();let f=e.vertices[0];ae(o,t),se(n,0,1,0),$c.makeOrthoBasisDirUpFallback(f.vRight,o,n,n,a,o,s),ae(f.frame.up,o),ae(f.frame.right,a),r=f;for(let m=1;m<i;++m){f=e.vertices[m],de(c,f.vLeft,f.vRight);let g=Re(c);g>0?(g=1/Math.sqrt(g),c[0]=c[0]*g,c[1]=c[1]*g,c[2]=c[2]*g):(c[0]=f.vRight[0],c[1]=f.vRight[1],c[2]=f.vRight[2]),de(h,r.pos,r.frame.up),pA(f.pos,c,p),JT(p,wh(h,f.vLeft),l)?(pe(l,l,f.pos),we(o,l),ut(a,c,o),we(a,a)):$c.makeOrthoBasisDirUpFallback(c,r.frame.up,r.frame.right,n,a,o,s),ae(f.frame.up,o),ae(f.frame.right,a),r=f}}class m1t{numProfilesPerJoin(){return 1}extrude(t,r,i){for(let s=0;s<r.vertices.length;++s)i(t.index,t.frame,r.vertices[s],r.vertexNormals[s],!1)}}class Ej{constructor(t=.8*Math.PI,r=1){this.cutoffAngle=t,this.numBendSubdivisions=r}numProfilesPerJoin(){return this.numBendSubdivisions+1}extrude(t,r,i){const s=x1t;if(Math.abs(t.rotationAngle)>=this.cutoffAngle)for(let n=0;n<this.numBendSubdivisions+1;++n){_h(Cme,.5*-t.rotationAngle+n*t.rotationAngle/this.numBendSubdivisions,t.rotationFrame.up),u1t(s,t.frame,Cme);for(let o=0;o<r.vertices.length;++o)un(r.vertices[o],t.rotationRight)*t.rotationAngle>=0?i(t.index,s,r.vertices[o],r.vertexNormals[o],!1):(iQ(Rx,r.vertices[o],t.miterStretch),i(t.index,t.frame,Rx,r.vertexNormals[o],!0))}else for(let n=0;n<this.numBendSubdivisions+1;++n)for(let o=0;o<r.vertices.length;++o){const a=un(r.vertices[o],t.rotationRight)*t.rotationAngle>=0;iQ(Rx,r.vertices[o],t.miterStretch),i(t.index,t.frame,Rx,r.vertexNormals[o],!a)}}}const g1t={generateUV:!1};class Dse{rebuildConnectingProfileGeometry(t,r,i){for(let s=0;s<r.vertices.length;++s)i(t.index,t.frame,r.vertices[s],r.vertexNormals[s],0,0)}}class Sme extends Dse{constructor(){super()}getNumVertices(){return 0}getNumIndices(){return 0}rebuildCapGeometry(){}buildTopology(){}}class vF extends Dse{constructor(t,r=0,i=!1){super(),this.profile=t,this.profilePlaneOffset=r,this.flip=i}getNumVertices(){return this.profile.vertices.length}getNumIndices(){return 3*this.profile.numSegments}rebuildConnectingProfileGeometry(t,r,i){for(let s=0;s<r.vertices.length;++s)i(t.index,t.frame,r.vertices[s],r.vertexNormals[s],this.profilePlaneOffset,0)}rebuildCapGeometry(t,r){const i=Nse;vr(i,0,0);const s=this.flip?1:-1;for(let n=0;n<this.profile.vertices.length;++n)r(t.index,t.frame,this.profile.vertices[n],i,this.profilePlaneOffset,s)}buildTopology(t,r){const i=this.vertexBufferStart+this.profile.vertexIndices[0];for(let s=1;s<this.profile.numSegments;++s){const n=this.profile.vertexIndices[2*s+0],o=this.profile.vertexIndices[2*s+1],a=this.vertexBufferStart+n,l=this.vertexBufferStart+o;this.flip?r(l,a,i):r(i,a,l)}}}class Eme extends Dse{constructor(t){super(),this.flip=!1,this.sign=0,this.breakNormals=!1,this.numSegments=3,this.profile=t.profile,this.flip=t.flip,this.sign=this.flip?1:-1,this.breakNormals=t.breakNormals,this.numSegments=t.subdivisions}getNumVertices(){let t=0;return t=this.profile.vertices.length*(this.numSegments-1),this.breakNormals&&(t+=this.profile.vertices.length),t+=this.profile.poles.length,t}getNumIndices(){let t=0;t+=2*this.profile.numSegments*(this.numSegments-1);for(let r=0;r<this.profile.numSegments;++r){const i=this.profile.vertexIndices[2*r+0],s=this.profile.vertexIndices[2*r+1];this.profile.poleIndices[i]===this.profile.poleIndices[s]?t+=1:t+=2}return 3*t}rebuildCapGeometry(t,r){const i=t.frame,s=.5*this.sign,n=Rx,o=Nse;vr(o,0,0);for(let a=0;a<this.profile.poles.length;++a){const l=this.profile.poles[a];l.normal?r(t.index,i,l.position,l.normal,s,0):r(t.index,i,l.position,o,s,this.sign)}if(this.breakNormals)for(let a=0;a<this.profile.vertices.length;++a)r(t.index,i,this.profile.vertices[a],this.profile.vertexNormals[a],0,0);for(let a=0;a<this.numSegments-1;++a){const l=(1-(a+1)/this.numSegments)*Math.PI*.5,c=Math.sin(l),h=Math.cos(l);for(let p=0;p<this.profile.vertices.length;++p){const f=this.profile.poles[this.profile.poleIndices[p]];$m(n,this.profile.vertices[p],f.position),Bc(n,n,c),f.normal?(Bp(n,n,f.position),r(t.index,i,n,f.normal,s*h,0)):($I(o,n),Bc(o,o,c),Bp(n,n,f.position),r(t.index,i,n,o,s*h,this.sign*h))}}}buildTopology(t,r){const i=this.breakNormals?this.vertexBufferStart+this.profile.poles.length:this.firstProfileVertexIndex,s=this.breakNormals?this.vertexBufferStart+this.profile.poles.length+this.profile.vertices.length:this.vertexBufferStart+this.profile.poles.length;for(let n=0;n<this.profile.numSegments;++n){const o=this.profile.vertexIndices[2*n+0],a=this.profile.vertexIndices[2*n+1],l=this.vertexBufferStart+this.profile.poleIndices[o],c=this.vertexBufferStart+this.profile.poleIndices[a];let h=i+o,p=i+a;for(let f=0;f<this.numSegments-1;++f){const m=s+f*this.profile.vertices.length+o,g=s+f*this.profile.vertices.length+a;this.flip?(r(m,p,h),r(p,m,g)):(r(h,p,m),r(g,m,p)),h=m,p=g}this.flip?(r(l,p,h),l!==c&&r(l,c,p)):(r(h,p,l),l!==c&&r(p,c,l))}}}class y1t{constructor(t,r,i,s,n,o=g1t){this.options=o,this._extrusionVertexCount=0,this._triangleCount=0,this.numExtrusionProfiles=0,this.numVerticesTotal=0,this.numNormalsTotal=0,this.numUVTotal=0,this.profile=r,this.path=t,this.extruder=i,this.startCap=s,this.endCap=n;const a=this.path.vertices.length-2;this.numExtrusionProfiles=i.numProfilesPerJoin()*a+2,this.numVerticesTotal=r.vertices.length*this.numExtrusionProfiles,this.numNormalsTotal=this.numVerticesTotal,this.startCap.vertexBufferStart=this.numVerticesTotal;const l=this.startCap.getNumVertices();this.numVerticesTotal+=l,this.numNormalsTotal+=l,this.endCap.vertexBufferStart=this.numVerticesTotal;const c=this.endCap.getNumVertices();this.numVerticesTotal+=c,this.numNormalsTotal+=c,this.pathVertexData=new Float32Array(1*this.numVerticesTotal),this.profileRightAxisData=new Float32Array(4*this.numVerticesTotal),this.profileUpAxisData=new Float32Array(4*this.numVerticesTotal),this.profileVertexAndNormalData=new Float32Array(4*this.numVerticesTotal),this.profile.hasUV()&&this.options.generateUV&&(this.numUVTotal=this.profile.uvs.length,this.uvData=new Float32Array(2*this.numUVTotal)),this.originData=new Float32Array(3*this.path.vertices.length),this._rebuildGeometry(),this.buildTopology()}emitVertex(t,r,i,s,n){if(this.profileRightAxisData[4*this._extrusionVertexCount+0]=r.right[0],this.profileRightAxisData[4*this._extrusionVertexCount+1]=r.right[1],this.profileRightAxisData[4*this._extrusionVertexCount+2]=r.right[2],this.profileUpAxisData[4*this._extrusionVertexCount+0]=r.up[0],this.profileUpAxisData[4*this._extrusionVertexCount+1]=r.up[1],this.profileUpAxisData[4*this._extrusionVertexCount+2]=r.up[2],this.profileVertexAndNormalData[4*this._extrusionVertexCount+0]=i[0],this.profileVertexAndNormalData[4*this._extrusionVertexCount+1]=i[1],this.profileVertexAndNormalData[4*this._extrusionVertexCount+2]=s[0],this.profileVertexAndNormalData[4*this._extrusionVertexCount+3]=s[1],this.pathVertexData[this._extrusionVertexCount]=t,n){const o=this.path.vertices[t];this.profileRightAxisData[4*this._extrusionVertexCount+3]=o.rotationRight[0]*o.maxStretchDistance,this.profileUpAxisData[4*this._extrusionVertexCount+3]=o.rotationRight[1]*o.maxStretchDistance}else this.profileRightAxisData[4*this._extrusionVertexCount+3]=0,this.profileUpAxisData[4*this._extrusionVertexCount+3]=0;++this._extrusionVertexCount}emitCapVertex(t,r,i,s,n,o){this.profileRightAxisData[4*this._extrusionVertexCount+0]=r.right[0],this.profileRightAxisData[4*this._extrusionVertexCount+1]=r.right[1],this.profileRightAxisData[4*this._extrusionVertexCount+2]=r.right[2],this.profileUpAxisData[4*this._extrusionVertexCount+0]=r.up[0],this.profileUpAxisData[4*this._extrusionVertexCount+1]=r.up[1],this.profileUpAxisData[4*this._extrusionVertexCount+2]=r.up[2],this.profileVertexAndNormalData[4*this._extrusionVertexCount+0]=i[0],this.profileVertexAndNormalData[4*this._extrusionVertexCount+1]=i[1],this.profileVertexAndNormalData[4*this._extrusionVertexCount+2]=s[0],this.profileVertexAndNormalData[4*this._extrusionVertexCount+3]=s[1],this.pathVertexData[this._extrusionVertexCount]=t,this.profileRightAxisData[4*this._extrusionVertexCount+3]=n,this.profileUpAxisData[4*this._extrusionVertexCount+3]=o,++this._extrusionVertexCount}emitTriangle(t,r,i){this.vertexIndices[3*this._triangleCount+0]=t,this.vertexIndices[3*this._triangleCount+1]=r,this.vertexIndices[3*this._triangleCount+2]=i,this.pathVertexIndices[3*this._triangleCount+0]=this.pathVertexData[t],this.pathVertexIndices[3*this._triangleCount+1]=this.pathVertexData[r],this.pathVertexIndices[3*this._triangleCount+2]=this.pathVertexData[i],this.normalIndices[3*this._triangleCount+0]=t,this.normalIndices[3*this._triangleCount+1]=r,this.normalIndices[3*this._triangleCount+2]=i,++this._triangleCount}_rebuildGeometry(){const t=(i,s,n,o,a)=>this.emitVertex(i,s,n,o,a),r=(i,s,n,o,a,l)=>this.emitCapVertex(i,s,n,o,a,l);this._extrusionVertexCount=0;for(const i of this.path.vertices)this.originData[3*i.index+0]=i.pos[0],this.originData[3*i.index+1]=i.pos[1],this.originData[3*i.index+2]=i.pos[2];this.startCap.rebuildConnectingProfileGeometry(this.path.vertices[0],this.profile,r);for(let i=1;i<this.path.vertices.length-1;++i)this.extruder.extrude(this.path.vertices[i],this.profile,t);if(this.endCap.rebuildConnectingProfileGeometry(this.path.vertices[this.path.vertices.length-1],this.profile,r),this.startCap.rebuildCapGeometry(this.path.vertices[0],r),this.endCap.rebuildCapGeometry(this.path.vertices[this.path.vertices.length-1],r),this.profile.hasUV()&&this.options.generateUV)for(let i=0;i<this.profile.uvs.length;++i)this.uvData[2*i+0]=this.profile.uvs[i],this.uvData[2*i+1]=0}buildTopology(){const t=(o,a,l)=>this.emitTriangle(o,a,l);this._triangleCount=0;const r=this.profile.vertices.length,i=this.profile.numSegments,s=this.numExtrusionProfiles-1;let n=3*(2*(i*s));this.startCap.indexBufferStart=n,this.startCap.firstProfileVertexIndex=0,n+=this.startCap.getNumIndices(),this.endCap.indexBufferStart=n,this.endCap.firstProfileVertexIndex=r*(this.numExtrusionProfiles-1),n+=this.endCap.getNumIndices(),this.vertexIndices=new Uint32Array(n),this.normalIndices=new Uint32Array(n),this.pathVertexIndices=new Uint32Array(n),this.profile.hasUV()&&this.options.generateUV&&(this.uvIndices=new Uint32Array(n));for(let o=0;o<i;++o){const a=this.profile.vertexIndices[2*o],l=this.profile.vertexIndices[2*o+1];for(let c=0;c<s;++c){const h=c*r+a,p=(c+1)*r+l,f=c*r+l;t(h,(c+1)*r+a,p),t(h,p,f)}}this.startCap.buildTopology(this.path.vertices[0],t),this.endCap.buildTopology(this.path.vertices[this.path.vertices.length-1],t)}onPathChanged(){this._rebuildGeometry()}}class HIe{constructor(t){this.builder=t}get xform(){return this.builder.path.xform}onPathChanged(){this.builder.onPathChanged()}}class qIe extends HIe{constructor(t){super(t),this.vertexAttributePosition=null,this.vertexAttributeNormal=null,this.vertexAttributeColor=null,this.vertexAttributePosition=new Float32Array(3*this.builder.numVerticesTotal),this.vertexAttributeNormal=new Float32Array(3*this.builder.numNormalsTotal),this.vertexAttributeColor=new Uint8Array(4),this.vertexAttributeColor[0]=255,this.vertexAttributeColor[1]=255,this.vertexAttributeColor[2]=255,this.vertexAttributeColor[3]=255}bakeVertexColors(t){this.vertexAttributeColor[0]=255*t[0],this.vertexAttributeColor[1]=255*t[1],this.vertexAttributeColor[2]=255*t[2],this.vertexAttributeColor[3]=255*(t.length>3?t[3]:1)}bake(t){this.size=t;for(let r=0;r<this.builder.numVerticesTotal;++r){let i=this.builder.pathVertexData[r];const s=i===0||i===this.builder.path.vertices.length-1;i*=3;const n=_1t;se(n,this.builder.originData[i++],this.builder.originData[i++],this.builder.originData[i]);const o=4*r,a=Op,l=Rx,c=ed,h=HQ,p=w1t;let f=0,m=0;if(se(h,this.builder.profileRightAxisData[o],this.builder.profileRightAxisData[o+1],this.builder.profileRightAxisData[o+2]),se(p,this.builder.profileUpAxisData[o],this.builder.profileUpAxisData[o+1],this.builder.profileUpAxisData[o+2]),vr(l,this.builder.profileVertexAndNormalData[o]*t[0],this.builder.profileVertexAndNormalData[o+1]*t[1]),s)ut(c,p,h),f=this.builder.profileRightAxisData[o+3]*t[0],m=this.builder.profileUpAxisData[o+3];else{const v=Nse,w=b1t;vr(v,this.builder.profileRightAxisData[o+3],this.builder.profileUpAxisData[o+3]);const _=iie(v);$I(v,v);const T=un(l,v);if(Math.abs(T)>_){vr(w,-v[1],v[0]);const x=un(l,w);Bc(v,v,_*Math.sign(T)),Bc(w,w,x),Bp(l,v,w)}se(c,0,0,0)}se(a,h[0]*l[0]+p[0]*l[1],h[1]*l[0]+p[1]*l[1],h[2]*l[0]+p[2]*l[1]),this.vertexAttributePosition[3*r+0]=n[0]+a[0]+c[0]*f,this.vertexAttributePosition[3*r+1]=n[1]+a[1]+c[1]*f,this.vertexAttributePosition[3*r+2]=n[2]+a[2]+c[2]*f;const g=Rx;vr(g,this.builder.profileVertexAndNormalData[o+2],this.builder.profileVertexAndNormalData[o+3]),this.vertexAttributeNormal[3*r+0]=h[0]*g[0]+p[0]*g[1]+c[0]*m,this.vertexAttributeNormal[3*r+1]=h[1]*g[0]+p[1]*g[1]+c[1]*m,this.vertexAttributeNormal[3*r+2]=h[2]*g[0]+p[2]*g[1]+c[2]*m}}createGeometryData(){const t=[[O.POSITION,this.builder.vertexIndices],[O.NORMAL,this.builder.normalIndices]],r=[[O.POSITION,{size:3,data:this.vertexAttributePosition,exclusive:!0}],[O.NORMAL,{size:3,data:this.vertexAttributeNormal,exclusive:!0}]];if(this.vertexAttributeColor){const i=this.builder.vertexIndices.length;t.push([O.COLOR,new Uint32Array(i)]),r.push([O.COLOR,{size:4,data:this.vertexAttributeColor}])}return{vertexAttributes:r,indices:t}}onPathChanged(){super.onPathChanged(),this.bake(this.size)}intersect(t,r,i){const s=this.builder.vertexIndices,n={size:3,data:this.vertexAttributePosition},o=s.length/3;xL(t,r,0,o,s,n,void 0,void 0,i)}}class v1t extends HIe{constructor(t,r,i,s){super(t),this.sizeAttributeValue=r,this.colorAttributeValue=i,this.opacityAttributeValue=s,this.vvData=null,this.baked=new qIe(t),this.vvData=new Float32Array(4*this.builder.path.vertices.length);for(let n=0;n<this.builder.path.vertices.length;++n){this.vvData[4*n+0]=r,this.vvData[4*n+1]=i,this.vvData[4*n+2]=s;const o=n===0||n===this.builder.path.vertices.length-1;this.vvData[4*n+3]=o?1:0}}createGeometryData(){return{vertexAttributes:[[O.POSITION,{size:3,data:this.builder.originData,exclusive:!0}],[O.PROFILERIGHT,{size:4,data:this.builder.profileRightAxisData,exclusive:!0}],[O.PROFILEUP,{size:4,data:this.builder.profileUpAxisData,exclusive:!0}],[O.PROFILEVERTEXANDNORMAL,{size:4,data:this.builder.profileVertexAndNormalData,exclusive:!0}],[O.FEATUREVALUE,{size:4,data:this.vvData,exclusive:!0}]],indices:[[O.POSITION,this.builder.pathVertexIndices],[O.PROFILERIGHT,this.builder.vertexIndices],[O.PROFILEUP,this.builder.vertexIndices],[O.PROFILEVERTEXANDNORMAL,this.builder.vertexIndices],[O.FEATUREVALUE,this.builder.pathVertexIndices]]}}}const _1t=M(),Rx=rt(),Nse=rt(),b1t=rt(),Op=M(),ed=M(),HQ=M(),w1t=M(),_F=M(),x1t=jQ(),Cme=Ce(),Cj=8;function T1t(e,t){e.attributes.add(O.FEATUREVALUE,"vec4");const r=e.vertex;r.code.add(S`bool isCapVertex() {
return featureValue.w == 1.0;
}`),r.uniforms.add(new _r("size",i=>i.size)),t.vvSize?(r.uniforms.add(new St("vvSizeMinSize",i=>i.vvSizeMinSize)),r.uniforms.add(new St("vvSizeMaxSize",i=>i.vvSizeMaxSize)),r.uniforms.add(new St("vvSizeOffset",i=>i.vvSizeOffset)),r.uniforms.add(new St("vvSizeFactor",i=>i.vvSizeFactor)),r.code.add(S`vec2 getSize() {
return size * clamp(vvSizeOffset + featureValue.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).xz;
}`)):r.code.add(S`vec2 getSize(){
return size;
}`),t.vvOpacity?(r.constants.add("vvOpacityNumber","int",Cj),r.uniforms.add([new Ea("vvOpacityValues",i=>i.vvOpacityValues,Cj),new Ea("vvOpacityOpacities",i=>i.vvOpacityOpacities,Cj)]),r.code.add(S`vec4 applyOpacity(vec4 color) {
float value = featureValue.z;
if (value <= vvOpacityValues[0]) {
return vec4( color.xyz, vvOpacityOpacities[0]);
}
for (int i = 1; i < vvOpacityNumber; ++i) {
if (vvOpacityValues[i] >= value) {
float f = (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);
return vec4( color.xyz, mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f));
}
}
return vec4( color.xyz, vvOpacityOpacities[vvOpacityNumber - 1]);
}`)):r.code.add(S`vec4 applyOpacity(vec4 color){
return color;
}`),t.vvColor?(r.constants.add("vvColorNumber","int",mf),r.uniforms.add([new Ea("vvColorValues",i=>i.vvColorValues,mf),new LB("vvColorColors",i=>i.vvColorColors,mf)]),r.code.add(S`vec4 getColor() {
float value = featureValue.y;
if (value <= vvColorValues[0]) {
return applyOpacity(vvColorColors[0]);
}
for (int i = 1; i < vvColorNumber; ++i) {
if (vvColorValues[i] >= value) {
float f = (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);
return applyOpacity(mix(vvColorColors[i-1], vvColorColors[i], f));
}
}
return applyOpacity(vvColorColors[vvColorNumber - 1]);
}`)):r.code.add(S`vec4 getColor(){
return applyOpacity(vec4(1, 1, 1, 1));
}`),e.include(XB),e.attributes.add(O.PROFILERIGHT,"vec4"),e.attributes.add(O.PROFILEUP,"vec4"),e.attributes.add(O.PROFILEVERTEXANDNORMAL,"vec4"),r.code.add(S`vec3 calculateVPos() {
vec2 size = getSize();
vec3 origin = position;
vec3 right = profileRight.xyz;
vec3 up = profileUp.xyz;
vec3 forward = cross(up, right);
vec2 profileVertex = profileVertexAndNormal.xy * size;
vec2 profileNormal = profileVertexAndNormal.zw;
float positionOffsetAlongProfilePlaneNormal = 0.0;
float normalOffsetAlongProfilePlaneNormal = 0.0;`),r.code.add(S`if(!isCapVertex()) {
vec2 rotationRight = vec2(profileRight.w, profileUp.w);
float maxDistance = length(rotationRight);`),r.code.add(S`rotationRight = maxDistance > 0.0 ? normalize(rotationRight) : vec2(0, 0);
float rx = dot(profileVertex, rotationRight);
if (abs(rx) > maxDistance) {
vec2 rotationUp = vec2(-rotationRight.y, rotationRight.x);
float ry = dot(profileVertex, rotationUp);
profileVertex = rotationRight * maxDistance * sign(rx) + rotationUp * ry;
}
}else{
positionOffsetAlongProfilePlaneNormal = profileRight.w * size[0];
normalOffsetAlongProfilePlaneNormal = profileUp.w;
}
vec3 offset = right * profileVertex.x + up * profileVertex.y + forward * positionOffsetAlongProfilePlaneNormal;
return origin + offset;
}`),r.code.add(S`vec3 localNormal() {
vec3 right = profileRight.xyz;
vec3 up = profileUp.xyz;
vec3 forward = cross(up, right);
vec2 profileNormal = profileVertexAndNormal.zw;
vec3 normal = right * profileNormal.x + up * profileNormal.y;
if(isCapVertex()) {
normal += forward * profileUp.w;
}
return normal;
}`)}class S1t extends use{constructor(){super(...arguments),this.size=Fr(1,1)}}function E1t(e){const t=new Yr,r=ph(t,e),{vertex:i,fragment:s}=t;return t.varyings.add("vpos","vec3"),t.include(T1t,e),e.output!==K.Color&&e.output!==K.Alpha||(t.include(ra),t.include($T,e),t.include(PL,e),t.varyings.add("vnormal","vec3"),t.varyings.add("vcolor","vec4"),e.hasMultipassTerrain&&t.varyings.add("depth","float"),i.code.add(S`
      void main() {
        vpos = calculateVPos();
        vnormal = normalize(localNormal());

        ${e.hasMultipassTerrain?"depth = (view * vec4(vpos, 1.0)).z;":""}
        gl_Position = transformPosition(proj, view, vpos);

        ${e.output===K.Color?"forwardLinearDepth();":""}

        vcolor = getColor();
      }
    `)),t.include(Th,e),e.output===K.Alpha&&(t.include(Ss,e),s.uniforms.add(new qe("opacity",n=>n.opacity)),s.code.add(S`
      void main() {
        discardBySlice(vpos);
        ${e.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}
        float combinedOpacity = vcolor.a * opacity;
        gl_FragColor = vec4(combinedOpacity);
      }
    `)),e.output===K.Color&&(t.include(Ss,e),t.include(LT,e),t.include(LL,e),t.include($T,e),t.include(YPe,e),ag(s,e),s.uniforms.add([r,new St("ambient",n=>n.ambient),new St("diffuse",n=>n.diffuse),new St("specular",n=>n.specular),new qe("opacity",n=>n.opacity),new qe("lightingGlobalFactor",(n,o)=>o.lighting.globalFactor),new St("lightingMainIntensity",(n,o)=>o.lighting.mainLight.intensity)]),s.constants.add("ambientBoostFactor","float",AR),s.include(wg),s.code.add(S`
      void main() {
        discardBySlice(vpos);
        ${e.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}

        shadingParams.viewDirection = normalize(vpos - cameraPosition);
        shadingParams.normalView = vnormal;
        vec3 normal = shadingNormal(shadingParams);
        float ssao = evaluateAmbientOcclusionInverse();

        float additionalAmbientScale = additionalDirectedAmbientLight(vpos + localOrigin);
        vec3 additionalLight = ssao * lightingMainIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;
        ${e.receiveShadows?"float shadow = readShadowMap(vpos, linearDepth);":e.spherical?"float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);":"float shadow = 0.0;"}
        vec3 albedo = vcolor.rgb * max(ambient, diffuse); // combine the old material parameters into a single one
        float combinedOpacity = vcolor.a * opacity;
        albedo += 0.25 * specular; // don't completely ignore specular for now

        vec3 shadedColor = evaluateSceneLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight);
        gl_FragColor = vec4(shadedColor, combinedOpacity);
        gl_FragColor = highlightSlice(gl_FragColor, vpos);
        ${e.transparencyPassType===yt.Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}
      }
    `)),e.output!==K.Depth&&e.output!==K.Shadow||(t.include(ra,{hasModelTransformation:!1,linearDepth:!0}),i.uniforms.add(new _r("nearFar",(n,o)=>o.camera.nearFar)),t.varyings.add("depth","float"),i.code.add(S`void main() {
vpos = calculateVPos();
gl_Position = transformPositionWithDepth(proj, view, vpos, nearFar, depth);
}`),t.include(Ss,e),t.include(tb,e),s.code.add(S`void main() {
discardBySlice(vpos);
outputDepth(depth);
}`)),e.output===K.Normal&&(t.include(ra),t.include(Z_,e),i.uniforms.add(new Ei("viewNormal",(n,o)=>o.camera.viewInverseTransposeMatrix)),t.varyings.add("vnormal","vec3"),i.code.add(S`void main(void) {
vpos = calculateVPos();
vnormal = normalize((viewNormal * vec4(localNormal(), 1.0)).xyz);
gl_Position = transformPosition(proj, view, vpos);
}`),t.include(Ss,e),s.uniforms.add(new hl("waterColor")),s.code.add(S`void main() {
discardBySlice(vpos);
vec3 normal = normalize(vnormal);
if (gl_FrontFacing == false) normal = -normal;
gl_FragColor = vec4(vec3(0.5) + 0.5 * normal, 1.0);
}`)),e.output===K.Highlight&&(t.include(ra),t.include(Z_,e),t.varyings.add("vnormal","vec3"),i.code.add(S`void main(void) {
vpos = calculateVPos();
gl_Position = transformPosition(proj, view, vpos);
}`),t.include(Ss,e),t.include(D0),s.code.add(S`void main() {
discardBySlice(vpos);
outputHighlight();
}`)),t}const C1t=Object.freeze(Object.defineProperty({__proto__:null,build:E1t},Symbol.toStringTag,{value:"Module"})),WIe=new Map([[O.POSITION,0],[O.PROFILERIGHT,1],[O.PROFILEUP,2],[O.PROFILEVERTEXANDNORMAL,3],[O.FEATUREVALUE,4]]);class A1t extends S1t{constructor(){super(...arguments),this.ambient=Ue(.2,.2,.2),this.diffuse=Ue(.8,.8,.8),this.specular=Ue(0,0,0),this.opacity=1}}class h8 extends gi{initializeConfiguration(t,r){r.spherical=t.viewingMode===Be.Global,r.doublePrecisionRequiresObfuscation=ML(t.rctx)}initializeProgram(t){const r=h8.shader.get().build(this.configuration);return new oi(t.rctx,r,WIe)}_setPipelineState(t){const r=this.configuration,i=t===yt.NONE,s=t===yt.FrontFace,n=o=>!o.hasSlicePlane&&!(o.transparent||o.doubleSidedMode===Zi.None);return Gt({blending:r.output!==K.Color&&r.output!==K.Alpha||!r.transparent?null:i?fh:N0(t),culling:n(r)&&HRe,depthTest:{func:eb(t)},depthWrite:i||s?cc:null,colorWrite:or,stencilWrite:r.hasOccludees?cg:null,stencilTest:r.hasOccludees?rb:null,polygonOffset:i||s?null:FB})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}}h8.shader=new ni(C1t,()=>ie(()=>import("./Path.glsl.b8c649d1.js"),[],import.meta.url));class Hn extends Ca{constructor(){super(...arguments),this.output=K.Color,this.doubleSidedMode=Zi.None,this.transparencyPassType=yt.NONE,this.spherical=!1,this.receiveShadows=!1,this.receiveAmbientOcclusion=!1,this.vvSize=!1,this.vvColor=!1,this.vvOpacity=!1,this.hasSlicePlane=!1,this.transparent=!1,this.hasOccludees=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1,this.doublePrecisionRequiresObfuscation=!1}}u([q({count:K.COUNT})],Hn.prototype,"output",void 0),u([q({count:Zi.COUNT})],Hn.prototype,"doubleSidedMode",void 0),u([q({count:yt.COUNT})],Hn.prototype,"transparencyPassType",void 0),u([q()],Hn.prototype,"spherical",void 0),u([q()],Hn.prototype,"receiveShadows",void 0),u([q()],Hn.prototype,"receiveAmbientOcclusion",void 0),u([q()],Hn.prototype,"vvSize",void 0),u([q()],Hn.prototype,"vvColor",void 0),u([q()],Hn.prototype,"vvOpacity",void 0),u([q()],Hn.prototype,"hasSlicePlane",void 0),u([q()],Hn.prototype,"transparent",void 0),u([q()],Hn.prototype,"hasOccludees",void 0),u([q()],Hn.prototype,"hasMultipassTerrain",void 0),u([q()],Hn.prototype,"cullAboveGround",void 0),u([q()],Hn.prototype,"doublePrecisionRequiresObfuscation",void 0),u([q({constValue:Pt.Disabled})],Hn.prototype,"pbrMode",void 0),u([q({constValue:!0})],Hn.prototype,"hasVvInstancing",void 0),u([q({constValue:!1})],Hn.prototype,"useCustomDTRExponentForWater",void 0),u([q({constValue:!1})],Hn.prototype,"useFillLights",void 0);class Fse extends Tg{constructor(t){super(t,new O1t),this.supportsEdges=!0,this._vertexAttributeLocations=WIe,this._configuration=new Hn,this.vertexBufferLayout=Fse.getVertexBufferLayout(this.parameters)}getConfiguration(t,r){return this._configuration.output=t,this._configuration.vvSize=this.parameters.vvSizeEnabled,this._configuration.vvColor=this.parameters.vvColorEnabled,this._configuration.vvOpacity=this.parameters.vvOpacityEnabled,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this.parameters.transparent,this._configuration.hasOccludees=this.parameters.hasOccludees,t!==K.Color&&t!==K.Alpha||(this._configuration.doubleSidedMode=this.parameters.doubleSided&&this.parameters.doubleSidedType==="normal"?Zi.View:this.parameters.doubleSided&&this.parameters.doubleSidedType==="winding-order"?Zi.WindingOrder:Zi.None,this._configuration.receiveShadows=this.parameters.receiveShadows,this._configuration.receiveAmbientOcclusion=!!r.ssaoHelper.ready&&this.parameters.receiveSSAO),this._configuration.transparencyPassType=r.transparencyPassType,this._configuration.hasMultipassTerrain=r.multipassTerrain.enabled,this._configuration.cullAboveGround=r.multipassTerrain.cullAboveGround,this._configuration}isVisibleInPass(t){return t!==je.MATERIAL_DEPTH_SHADOWMAP_ALL&&t!==je.MATERIAL_DEPTH_SHADOWMAP_DEFAULT&&t!==je.MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT||this.parameters.castShadows}isVisible(){const t=this.parameters;return!!super.isVisible()&&t.opacity>0}intersect(t,r,i,s,n,o,a){const l=t;if(!GIe(l))return;const c=l.path,h=[this.parameters.size[0],this.parameters.size[1]];if(this.parameters.vvSizeEnabled){const _=this.parameters.vvSizeOffset,T=this.parameters.vvSizeFactor,x=this.parameters.vvSizeMinSize,E=this.parameters.vvSizeMaxSize,C=c.sizeAttributeValue;h[0]*=Le(_[0]+C*T[0],x[0],E[0]),h[1]*=Le(_[2]+C*T[2],x[2],E[2])}const p=Math.max(h[0],h[1]),f=t.boundingInfo;if(R(f))return void this._intersectTriangles(c,h,n,o,a);const m=uT(f.bbMin[0]-p,f.bbMin[1]-p,f.bbMin[2]-p,f.bbMax[0]+p,f.bbMax[1]+p,f.bbMax[2]+p),g=[o[0]-n[0],o[1]-n[1],o[2]-n[2]],v=Math.sqrt(g[0]*g[0]+g[1]*g[1]+g[2]*g[2]),w=[v/g[0],v/g[1],v/g[2]];sse(m,n,w,s.tolerance)&&this._intersectTriangles(c,h,n,o,a)}_intersectTriangles(t,r,i,s,n){t.baked.size&&t.baked.size[0]===r[0]&&t.baked.size[1]===r[1]||t.baked.bake(r),t.baked.intersect(i,s,n)}computeAttachmentOrigin(t,r){const i=t.vertexAttributes;if(!i)return null;const s=i.get(O.POSITION);return Mie(s,null,!1,r)}createBufferWriter(){return new M1t(this.vertexBufferLayout)}requiresSlot(t){return t===(this.parameters.transparent?Se.TRANSPARENT_MATERIAL:Se.OPAQUE_MATERIAL)||t===Se.DRAPED_MATERIAL}createGLMaterial(t){return t.output===K.Color||t.output===K.Alpha||t.output===K.Depth||t.output===K.Normal||t.output===K.Highlight||t.output===K.Shadow&&this.parameters.castShadows?new R1t(t):null}static getVertexBufferLayout(t){let r=ps().vec3f(O.POSITION).vec4f(O.PROFILERIGHT).vec4f(O.PROFILEUP).vec4f(O.PROFILEVERTEXANDNORMAL);return(t.vvColorEnabled||t.vvSizeEnabled||t.vvOpacityEnabled)&&(r=r.vec4f(O.FEATUREVALUE)),r}}class R1t extends J1{_updateOccludeeState(t){t.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:t.hasOccludees})}_updateShadowState(t){(R(this.technique)||t.shadowMap.enabled!==this.technique.configuration.receiveShadows)&&this._material.setParameters({receiveShadows:t.shadowMap.enabled})}beginSlot(t){return this._output!==K.Color&&this._output!==K.Alpha||(this._updateShadowState(t),this._updateOccludeeState(t)),this.ensureTechnique(h8,t)}}class O1t extends A1t{constructor(){super(...arguments),this.doubleSided=!1,this.doubleSidedType="normal",this.receiveSSAO=!0,this.receiveShadows=!1,this.castShadows=!0,this.hasSlicePlane=!1,this.transparent=!1,this.hasOccludees=!1}}class M1t{constructor(t){this.vertexBufferLayout=t}allocate(t){return this.vertexBufferLayout.createBuffer(t)}elementCount(t){return t.indices.get(O.POSITION).length}write(t,r,i,s){const n=o=>{if(r.vertexAttributes.has(o)){const a=r.vertexAttributes.get(o),l=r.indices.get(o);ft(a.size===4);const c=i.getField(o,oo);if(!c)throw new Error("unable to acquire view for "+o);UA(l,a.data,c,s)}};n(O.PROFILERIGHT),n(O.PROFILEUP),n(O.PROFILEVERTEXANDNORMAL),this.vertexBufferLayout.hasField(O.FEATUREVALUE)&&n(O.FEATUREVALUE),$B(r,this.vertexBufferLayout,t.transformation,t.invTranspTransformation,i,s)}}const P1t=["polyline"];class I1t extends Eg{constructor(t,r,i,s){super(t,r,i,s),this._intrinsicSize=Fr(1,1),this.upVectorAlignment="path",this.stencilWidth=.1,this.ensureDrapedStatus(!1)}async doLoad(){const t=b(this.symbolLayer.width)?this.symbolLayer.width:this.symbolLayer.height,r=b(this.symbolLayer.height)?this.symbolLayer.height:t;this._vvConvertOptions={modelSize:[1,1,1],symbolSize:[t,1,r],unitInMeters:this._context.renderCoordsHelper.unitInMeters,transformation:{anchor:[0,0,0],scale:[1,1,1],rotation:[0,0,0]},supportedTypes:{size:!0,color:!0,opacity:!0,rotation:!1}},this._context.renderer&&this._context.renderer.visualVariables&&this._context.renderer.visualVariables.length>0?this._fastUpdates=p$(this._context.renderer,this._vvConvertOptions):this._fastUpdates={enabled:!1};const i=this.symbolLayer.anchor||"center";this.upVectorAlignment="path",this.symbolLayer.profileRotation==="heading"&&(this.upVectorAlignment="world");const s=this.symbolLayer.profile||"circle";switch(s){case"circle":default:this._profile=g$.circle(F1t);break;case"quad":this._profile=g$.rect()}let n=[0,0];switch(i!=="center"&&(n={left:[.5,0],right:[-.5,0],top:[0,-.5],bottom:[0,.5]}[i],this._profile.translate(n[0],n[1])),this.symbolLayer.join||"simple"){case"round":this._extruder=new Ej(0,N1t);break;case"bevel":this._extruder=new Ej(0,1);break;case"miter":this._extruder=new Ej(.8*Math.PI,1);break;default:this._extruder=new m1t}const o=this.symbolLayer.cap||"butt";switch(o){case"none":this._startCap=new Sme,this._endCap=new Sme;break;case"butt":default:this._startCap=new vF(this._profile,0),this._endCap=new vF(this._profile,0,!0);break;case"square":this._startCap=new vF(this._profile,-.5),this._endCap=new vF(this._profile,.5,!0);break;case"round":{const m=s==="quad";this._startCap=new Eme({profile:this._profile,flip:!1,breakNormals:m,subdivisions:Ome}),this._endCap=new Eme({profile:this._profile,flip:!0,breakNormals:m,subdivisions:Ome});break}}const a=ki(this.symbolLayer,"material","color"),l=this._getCombinedOpacityAndColor(a),c=Bl(l),h=l[3],p=h<1||this.needsDrivenTransparentPass,f={diffuse:c,ambient:c,opacity:h,transparent:p,hasVertexColors:!1,hasSlicePlane:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows,cullFace:p||o==="none"?fi.None:fi.Back,offsetTransparentBackfaces:!0};if(!this._drivenProperties.size&&(vr(this._intrinsicSize,t,r),!YV(this._intrinsicSize[0])||!YV(this._intrinsicSize[1])))throw new j("graphics3dpathsymbollayer:invalid-size","Symbol sizes may not be negative values");if(this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size||Bc(this._intrinsicSize,this._intrinsicSize,1/this._context.renderCoordsHelper.unitInMeters),this._fastUpdates.enabled){const m={...f,...this._fastUpdates.materialParameters,size:ETe(this._intrinsicSize)};this._material=new Fse(m)}else f.hasVertexColors=this._drivenProperties.color||this._drivenProperties.opacity,this._material=new DT(f);this._material.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}),this._context.stage.add(this._material)}destroy(){super.destroy(),this._context.stage.remove(this._material),this._material=null}createGraphics3DGraphic(t){const r=t.graphic;if(!this._validateGeometry(r.geometry,P1t,this.symbolLayer.type))return null;const i=this.setGraphicElevationContext(r,new Ah),s=t.renderingInfo;return this._createAs3DShape(r,s,i,r.uid)}layerOpacityChanged(){const t=ki(this.symbolLayer,"material","color"),r=this._getCombinedOpacity(t),i=r<1||this.needsDrivenTransparentPass;return this._material.setParameters({opacity:r,transparent:i}),!0}layerElevationInfoChanged(t,r){return this.updateGraphics3DGraphicElevationInfo(t,r,B1)}slicePlaneEnabledChanged(){return this._material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),!0}physicalBasedRenderingChanged(){return this._material.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}),!0}pixelRatioChanged(){return!0}applyRendererDiff(t,r){for(const i in t.diff){if(i!=="visualVariables"||!f$(this._fastUpdates,r,this._vvConvertOptions))return bn.Recreate_Symbol;this._material.setParameters(this._fastUpdates.materialParameters)}return bn.Fast_Update}getVertexData(t){let r=0;const i=t.paths,s=[],n=t.spatialReference,o=this._context.elevationProvider.spatialReference,a=this._context.renderCoordsHelper.spatialReference;for(const m of i)r+=m.length;const l=new Float64Array(3*r),c=new Float64Array(3*r),h=new Float64Array(3*r);let p=0;for(const m of i){s.push({index:p,numVertices:m.length});for(const g of m)l[p++]=g[0],l[p++]=g[1],l[p++]=t.hasZ?g[2]:0}let f=!0;return n.equals(o)?this._copyVertices(l,0,c,0,r):f=mi(l,n,0,c,o,0,r),o.equals(a)?this._copyVertices(c,0,h,0,r):mi(c,o,0,h,a,0,r),{pathVertexDataInfos:s,vertexDataGS:l,vertexDataES:c,vertexDataRS:h,projectionSuccess:f,terrainElevation:0}}_copyVertices(t,r,i,s,n){r*=3,s*=3;for(let o=0;o<n;++o)i[s++]=t[r++],i[s++]=t[r++],i[s++]=t[r++]}_createAs3DShape(t,r,i,s){const n=t.geometry,o=new Array,a=new Array,l=new Array,c=n.spatialReference,h=tn(),p=this._context.renderCoordsHelper;ZIe.spatialReference=c;const f=this.getVertexData(n);if(!f.projectionSuccess)return this.logger.warn("PathSymbol3DLayer geometry failed to be created (failed to project geometry to view spatial reference)"),null;if(f.pathVertexDataInfos.length>0){for(let m=0;m<f.pathVertexDataInfos.length;++m){const g=f.pathVertexDataInfos[m],v=g.index,w=g.numVertices;if(w<2||b(this._context.clippingExtent)&&(vi(h),nh(h,f.vertexDataES,3*v,w),!rf(h,this._context.clippingExtent)))continue;const _=[];for(let I=v;I<v+3*w;){const L=I++,k=I++,G=I++,z=new d1t;se(z.posGS,f.vertexDataGS[L],f.vertexDataGS[k],f.vertexDataGS[G]),se(z.posES,f.vertexDataES[L],f.vertexDataES[k],f.vertexDataES[G]);const X=Aft(z.posES,this._context.elevationProvider,i,p);se(Ed,f.vertexDataRS[L],f.vertexDataRS[k],f.vertexDataRS[G]),p.setAltitude(Ed,X),se(z.pos,Ed[0],Ed[1],Ed[2]),_.push(z)}const T=new p1t(_);XIe(T,this.upVectorAlignment,this._context.renderCoordsHelper);const x=new y1t(T,this._profile,this._extruder,this._startCap,this._endCap);let E=null;if(this._fastUpdates.enabled){const I=this._fastUpdates.visualVariables,L=I.size?Qy(I.size.field,t):0,k=I.color?Qy(I.color.field,t):0,G=I.opacity?Qy(I.opacity.field,t):0;E=new v1t(x,L,k,G)}else{const I=[this._intrinsicSize[0],this._intrinsicSize[1]];this._drivenProperties.size&&(I[0]*=Ame(r.size[0],r.size[2]==="symbol-value"?this.symbolLayer.height||0:r.size[2],this.symbolLayer.width||0),I[1]*=Ame(r.size[2],r.size[0]==="symbol-value"?this.symbolLayer.width||0:r.size[0],this.symbolLayer.height||0));let L=null;this._drivenProperties.color&&(L=r.color),this._drivenProperties.opacity&&r.opacity!=null&&(L=L?[L[0],L[1],L[2],r.opacity]:[1,1,1,r.opacity]);const k=new qIe(x);k.bake(I),L&&k.bakeVertexColors(L),E=k}const{vertexAttributes:C,indices:A}=E.createGeometryData(),P=new o1t(C,A,E,c,this.upVectorAlignment,this.stencilWidth);o.push(P),a.push(this._material),l.push(E.xform)}if(o.length>0){const m={layerUid:this._context.layer.uid,graphicUid:s},g=new k0({geometries:o,materials:a,transformations:l,metadata:m}),v=new Sg(this,g,o,null,null,L1t,i);return v.alignedSampledElevation=f.terrainElevation,v.needsElevationUpdates=B1(i.mode),v}}else n.paths.length!==0&&n.paths.some(m=>m.length>0)||this.logger.warn("PathSymbol3DLayer geometry failed to be created (no paths were defined)");return null}}function XIe(e,t,r){switch(t){case"world":for(const i of e.vertices)de(Hf,i.pos,e.offset),r.worldUpAtPosition(Hf,Ed),i.setFrameFromUpVector(Ed),i.computeRotationAxisAndAngleFromUpVector();break;case"path":de(Hf,e.vertices[0].pos,e.offset),r.worldUpAtPosition(Hf,Ed),f1t(e,Ed);for(const i of e.vertices){const s=Math.sign(Te(i.frame.right,i.vRight));ut(i.rotationFrame.up,i.vRight,i.vLeft),le(i.rotationFrame.up,i.rotationFrame.up,s),we(i.rotationFrame.up,i.rotationFrame.up);const n=Te(i.rotationFrame.up,i.frame.up),o=Te(i.rotationFrame.up,i.frame.right);if(le(Hf,i.frame.up,-o),le(Rme,i.frame.right,n),de(Hf,Hf,Rme),we(i.rotationFrame.right,Hf),h1t(i.rotationRight,i.frame,i.rotationFrame.right),Ra(Hf,i.vLeft),i.rotationAngle=-s*(Math.PI-Cn(Te(Hf,i.vRight))),Math.abs(i.rotationAngle)>0){const l=Kq(Math.cos(.5*i.rotationAngle));Lse(i.miterStretch,1+(l-1)*i.rotationRight[0]*i.rotationRight[0],(l-1)*i.rotationRight[0]*i.rotationRight[1],(l-1)*i.rotationRight[0]*i.rotationRight[1],1+(l-1)*i.rotationRight[1]*i.rotationRight[1])}const a=Math.PI-i.rotationAngle;i.maxStretchDistance=Math.abs(Math.min(i.vLeftLength,i.vRightLength)*Kq(Math.cos(.5*a)))}}}function Ame(e,t,r){switch(e){case"symbol-value":return r;case"proportional":return t;default:return e}}function $1t(e,t,r,i){let s=0;for(const n of e.vertices)x0(n.posES,r,t,i,Aj),s+=Aj.sampledElevation,de(Ed,n.pos,e.offset),i.setAltitude(Ed,Aj.z),pe(n.pos,Ed,e.offset);return e.updatePathVertexInformation(),s/e.vertices.length}function L1t(e,t,r,i){const s=e.stageObject,n=s.geometryRecords;let o=0;D1t.spatialReference=i.spatialReference;for(const a of n){const l=a.geometry;if(!GIe(l))continue;const c=l.path,h=c.builder.path,p=l.geometrySR;ZIe.spatialReference=p,o+=$1t(h,t,r,i),l.upVectorAlignment!=="world"&&XIe(h,l.upVectorAlignment,i),c.onPathChanged(),l.invalidateBoundingInfo(),s.geometryVertexAttrsUpdated(a)}return o/n.length}const D1t=F0(0,0,0,null),ZIe=F0(0,0,0,null),Ed=M(),Hf=Mr(),Rme=Mr(),Aj=new AL,N1t=3,Ome=3,F1t=10;function k1t(e,t,r,i,s=1){if(r.isGeographic&&i===Be.Global){const a=new Float64Array(t.typedBuffer.length),l=3*t.count,c=Ar(r);for(let h=0;h<l;h+=3)nte(t.typedBuffer,h,a,h,c);t=Ns.fromTypedArray(a)}vr(dn,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY);for(let a=0;a<t.count;a++)t.getVec(a,Vc),dn[0]=Math.min(dn[0],Vc[0]),dn[1]=Math.min(dn[1],Vc[1]);const n=dn[0]%s,o=dn[1]%s;bd[0]=dn[0]-n,bd[1]=dn[1]-o;for(let a=0;a<t.count;a++)t.getVec(a,Vc),e.setValues(a,(Vc[0]-bd[0])/s,(Vc[1]-bd[1])/s,bd[0]/s,bd[1]/s)}function YIe(e,t,r,i,s=1){se(Ib,1,0,0),se($b,0,1,0),se(qS,0,0,1),z1t(Rj,t),U1t(t,Mme)&&V1t(Mme,Ib,$b,qS,r,Rj),vr(dn,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),vr(Lb,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(let l=0;l<t.count;l++){t.getVec(l,Vc);const c=Te(Ib,Vc),h=Te($b,Vc);dn[0]=Math.min(dn[0],c),dn[1]=Math.min(dn[1],h),Lb[0]=Math.max(Lb[0],c),Lb[1]=Math.max(Lb[1],h)}const n=Te(qS,Rj);Mj(ov,dn[0],dn[1],n,Ib,$b,qS),Mj(Db,Lb[0],dn[1],n,Ib,$b,qS),Mj(Nb,dn[0],Lb[1],n,Ib,$b,qS),pe(Db,Db,ov),le(Db,Db,.5),pe(Nb,Nb,ov),le(Nb,Nb,.5),de(ov,ov,Db),de(ov,ov,Nb);const o=dn[0]%s,a=dn[1]%s;bd[0]=dn[0]-o,bd[1]=dn[1]-a;for(let l=0;l<t.count;l++){t.getVec(l,Vc),e.setValues(l,(Te(Ib,Vc)-bd[0])/s,(Te($b,Vc)-bd[1])/s,bd[0]/s,bd[1]/s);for(let c=0;c<3;c++)i.set(l,c,ov[c]),i.set(l,c+3,Db[c]),i.set(l,c+6,Nb[c])}}const Rj=M(),Vc=M(),Mme=Er(),Ib=M(),$b=M(),qS=M(),dn=rt(),Lb=rt(),bd=rt(),ov=M(),Db=M(),Nb=M();function U1t(e,t){const r=e.count-1;return QTe(e,t,0,Math.floor(r/3),Math.floor(r*(2/3)))}function V1t(e,t,r,i,s,n){b(s)?(s.basisMatrixAtPosition(n,qf),se(bF,qf[0],qf[1],qf[2]),se(wF,qf[4],qf[5],qf[6]),se(Oj,qf[8],qf[9],qf[10])):(se(bF,1,0,0),se(wF,0,1,0),se(Oj,0,0,1));const o=e;Te(o,Oj)<0&&le(o,o,-1),ae(i,o);const a=Te(o,wF),l=Te(o,bF);Math.abs(a)<Math.abs(l)?(fx(t,bF,o,-l),we(t,t),ut(r,t,o),we(r,r),le(r,r,-1)):(fx(r,wF,o,-a),we(r,r),ut(t,r,o),we(t,t))}const qf=Ce(),bF=M(),wF=M(),Oj=M();function z1t(e,t){se(xF,0,0,0);for(let r=0;r<t.count-1;r++)t.getVec(r,Vc),de(xF,xF,Vc);le(e,xF,1/(t.count-1))}const xF=M();function Mj(e,t,r,i,s,n,o){se(e,t*s[0]+r*n[0]+i*o[0],t*s[1]+r*n[1]+i*o[1],t*s[2]+r*n[2]+i*o[2])}function B1t(e){const t=new Yr,r=e.output===K.Depth,i=e.hasMultipassTerrain&&(e.output===K.Color||e.output===K.Alpha);ph(t,e),t.include(ra,{hasModelTransformation:!1,linearDepth:r}),t.include(oS,e),t.attributes.add(O.POSITION,"vec3"),t.varyings.add("vpos","vec3"),i&&t.varyings.add("depth","float");const{vertex:s,fragment:n}=t;return r&&(t.include(tb,e),s.uniforms.add(new _r("nearFar",(o,a)=>a.camera.nearFar)),t.varyings.add("linearDepth","float")),s.code.add(S`
    void main(void) {
      vpos = position;
      forwardNormalizedVertexColor();
      ${i?"depth = (view * vec4(vpos, 1.0)).z;":""}
      gl_Position = ${r?S`transformPositionWithDepth(proj, view, vpos, nearFar, linearDepth);`:S`transformPosition(proj, view, vpos);`}
    }
  `),t.include(Ss,e),i&&t.include(Th,e),n.include(wg),n.uniforms.add(new lr("eColor",o=>o.color)),e.output===K.Highlight&&t.include(D0),n.code.add(S`
  void main() {
    discardBySlice(vpos);
    ${i?"terrainDepthTest(gl_FragCoord, depth);":""}
    vec4 fColor = ${e.hasVertexColors?"vColor * eColor;":"eColor;"}

    if (fColor.a < ${S.float(sa)}) {
      discard;
    }

    ${e.output===K.Alpha?S`gl_FragColor = vec4(fColor.a);`:""}

    ${e.output===K.Color?S`gl_FragColor = highlightSlice(fColor, vpos); ${e.transparencyPassType===yt.Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}`:""}
    ${e.output===K.Highlight?S`outputHighlight();`:""};
    ${e.output===K.Depth?S`outputDepth(linearDepth);`:""};
  }
  `),t}const G1t=Object.freeze(Object.defineProperty({__proto__:null,build:B1t},Symbol.toStringTag,{value:"Module"}));class d8 extends gi{initializeProgram(t){const r=d8.shader.get().build(this.configuration);return new oi(t.rctx,r,zr)}_createPipeline(t,r){const i=this.configuration,s=t===yt.NONE,n=t===yt.FrontFace;return Gt({blending:i.output!==K.Color&&i.output!==K.Alpha||!i.transparent?null:s?fh:N0(t),culling:dB(i.cullFace),depthTest:{func:eb(t)},depthWrite:s||n?i.writeDepth&&cc:null,colorWrite:or,stencilWrite:i.hasOccludees?cg:null,stencilTest:i.hasOccludees?r?j1:rb:null,polygonOffset:s||n?i.polygonOffset&&j1t:kB(i.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this._createPipeline(this.configuration.transparencyPassType,!0),this._createPipeline(this.configuration.transparencyPassType,!1)}getPipelineState(t,r){return r?this._occludeePipelineState:super.getPipelineState(t,r)}}d8.shader=new ni(G1t,()=>ie(()=>import("./ColorMaterial.glsl.3ff5415f.js"),[],import.meta.url));const j1t={factor:1,units:1};class Pu extends Ca{constructor(){super(...arguments),this.output=K.Color,this.cullFace=fi.None,this.hasSlicePlane=!1,this.hasVertexColors=!1,this.transparent=!1,this.polygonOffset=!1,this.enableOffset=!0,this.writeDepth=!0,this.hasOccludees=!1,this.transparencyPassType=yt.NONE,this.hasMultipassTerrain=!1,this.cullAboveGround=!1}}u([q({count:K.COUNT})],Pu.prototype,"output",void 0),u([q({count:fi.COUNT})],Pu.prototype,"cullFace",void 0),u([q()],Pu.prototype,"hasSlicePlane",void 0),u([q()],Pu.prototype,"hasVertexColors",void 0),u([q()],Pu.prototype,"transparent",void 0),u([q()],Pu.prototype,"polygonOffset",void 0),u([q()],Pu.prototype,"enableOffset",void 0),u([q()],Pu.prototype,"writeDepth",void 0),u([q()],Pu.prototype,"hasOccludees",void 0),u([q({count:yt.COUNT})],Pu.prototype,"transparencyPassType",void 0),u([q()],Pu.prototype,"hasMultipassTerrain",void 0),u([q()],Pu.prototype,"cullAboveGround",void 0);class Pme extends Tg{constructor(t){super(t,new q1t),this.supportsEdges=!0,this._configuration=new Pu}getConfiguration(t,r){return this._configuration.output=t,this._configuration.cullFace=this.parameters.cullFace,this._configuration.hasVertexColors=this.parameters.hasVertexColors,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this.parameters.transparent,this._configuration.polygonOffset=this.parameters.polygonOffset,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.transparencyPassType=r.transparencyPassType,this._configuration.enableOffset=r.camera.relativeElevation<NB,this._configuration.hasMultipassTerrain=r.multipassTerrain.enabled,this._configuration.cullAboveGround=r.multipassTerrain.cullAboveGround,this._configuration}intersect(t,r,i,s,n,o,a){PB(t,r,s,n,o,void 0,a)}requiresSlot(t,r){return t===Se.DRAPED_MATERIAL?!0:IT(r)===K.Highlight?t===Se.OPAQUE_MATERIAL:t===(this.parameters.transparent?this.parameters.writeDepth?Se.TRANSPARENT_MATERIAL:Se.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL:Se.OPAQUE_MATERIAL)}createGLMaterial(t){return t.output===K.Color||t.output===K.Alpha||t.output===K.Highlight||t.output===K.Depth&&this.parameters.writeLinearDepth?new H1t(t):null}createBufferWriter(){return new KB(UPe)}}class H1t extends J1{_updateOccludeeState(t){t.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:t.hasOccludees})}beginSlot(t){return this._output!==K.Color&&this._output!==K.Alpha||this._updateOccludeeState(t),this.ensureTechnique(d8,t)}}class q1t extends IR{constructor(){super(...arguments),this.color=jm,this.transparent=!1,this.writeDepth=!0,this.writeLinearDepth=!1,this.hasVertexColors=!1,this.polygonOffset=!1,this.hasSlicePlane=!1,this.cullFace=fi.None,this.hasOccludees=!1}}var Ao;(function(e){e[e.Horizontal=0]="Horizontal",e[e.Vertical=1]="Vertical",e[e.Cross=2]="Cross",e[e.ForwardDiagonal=3]="ForwardDiagonal",e[e.BackwardDiagonal=4]="BackwardDiagonal",e[e.DiagonalCross=5]="DiagonalCross",e[e.COUNT=6]="COUNT"})(Ao||(Ao={}));const qQ=.70710678118,Ime=qQ,W1t=.08715574274;function X1t(e){const t=new Yr,r=e.hasMultipassTerrain&&(e.output===K.Color||e.output===K.Alpha);e.draped||t.extensions.add("GL_OES_standard_derivatives");const i=e.output===K.Depth,{vertex:s,fragment:n}=t;ph(t,e),t.include(ra,{hasModelTransformation:!1,linearDepth:i}),t.include(oS,e),i&&(t.include(tb,e),s.uniforms.add(new _r("nearFar",(a,l)=>l.camera.nearFar)),t.varyings.add("linearDepth","float")),e.draped?s.uniforms.add(new qe("worldToScreenRatio",(a,l)=>1/l.screenToPCSRatio)):t.attributes.add(O.BOUNDINGRECT,"mat3"),t.attributes.add(O.POSITION,"vec3"),t.attributes.add(O.UVMAPSPACE,"vec4"),t.varyings.add("vpos","vec3"),t.varyings.add("vuv","vec2"),r&&t.varyings.add("depth","float");const o=e.style===Ao.ForwardDiagonal||e.style===Ao.BackwardDiagonal||e.style===Ao.DiagonalCross;return o&&s.code.add(S`
      const mat2 rotate45 = mat2(${S.float(qQ)}, ${S.float(-Ime)},
                                 ${S.float(Ime)}, ${S.float(qQ)});
    `),e.draped||(ag(s,e),s.uniforms.add(new qe("worldToScreenPerDistanceRatio",(a,l)=>1/l.camera.perScreenPixelRatio)),s.code.add(S`vec3 projectPointToLineSegment(vec3 center, vec3 halfVector, vec3 point) {
float projectedLength = dot(halfVector, point - center) / dot(halfVector, halfVector);
return center + halfVector * clamp(projectedLength, -1.0, 1.0);
}`),s.code.add(S`vec3 intersectRayPlane(vec3 rayDir, vec3 rayOrigin, vec3 planeNormal, vec3 planePoint) {
float d = dot(planeNormal, planePoint);
float t = (d - dot(planeNormal, rayOrigin)) / dot(planeNormal, rayDir);
return rayOrigin + t * rayDir;
}`),s.code.add(S`
      float boundingRectDistanceToCamera() {
        vec3 center = vec3(boundingRect[0][0], boundingRect[0][1], boundingRect[0][2]);
        vec3 halfU = vec3(boundingRect[1][0], boundingRect[1][1], boundingRect[1][2]);
        vec3 halfV = vec3(boundingRect[2][0], boundingRect[2][1], boundingRect[2][2]);
        vec3 n = normalize(cross(halfU, halfV));

        vec3 viewDir = - vec3(view[0][2], view[1][2], view[2][2]);

        float viewAngle = dot(viewDir, n);
        float minViewAngle = ${S.float(W1t)};

        if (abs(viewAngle) < minViewAngle) {
          // view direction is (almost) parallel to plane -> clamp it to min angle
          float normalComponent = sign(viewAngle) * minViewAngle - viewAngle;
          viewDir = normalize(viewDir + normalComponent * n);
        }

        // intersect view direction with infinite plane that contains bounding rect
        vec3 planeProjected = intersectRayPlane(viewDir, cameraPosition, n, center);

        // clip to bounds by projecting to u and v line segments individually
        vec3 uProjected = projectPointToLineSegment(center, halfU, planeProjected);
        vec3 vProjected = projectPointToLineSegment(center, halfV, planeProjected);

        // use to calculate the closest point to camera on bounding rect
        vec3 closestPoint = uProjected + vProjected - center;

        return length(closestPoint - cameraPosition);
      }
    `)),s.code.add(S`
    vec2 scaledUV() {
      vec2 uv = uvMapSpace.xy ${o?" * rotate45":""};
      vec2 uvCellOrigin = uvMapSpace.zw ${o?" * rotate45":""};

      ${e.draped?"":S`
            float distanceToCamera = boundingRectDistanceToCamera();
            float worldToScreenRatio = worldToScreenPerDistanceRatio / distanceToCamera;
          `}

      // Logarithmically discretize ratio to avoid jittering
      float step = 0.1;
      float discreteWorldToScreenRatio = log(worldToScreenRatio);
      discreteWorldToScreenRatio = ceil(discreteWorldToScreenRatio / step) * step;
      discreteWorldToScreenRatio = exp(discreteWorldToScreenRatio);

      vec2 uvOffset = mod(uvCellOrigin * discreteWorldToScreenRatio, ${S.float(e.patternSpacing)});
      return uvOffset + (uv * discreteWorldToScreenRatio);
    }
  `),s.code.add(S`
    void main(void) {
      vuv = scaledUV();
      vpos = position;
      ${r?"depth = (view * vec4(vpos, 1.0)).z;":""}
      forwardNormalizedVertexColor();
      gl_Position = ${i?S`transformPositionWithDepth(proj, view, vpos, nearFar, linearDepth);`:S`transformPosition(proj, view, vpos);`}
    }
  `),t.include(Ss,e),n.include(wg),e.draped&&n.uniforms.add(new qe("texelSize",(a,l)=>1/l.camera.pixelRatio)),e.output===K.Highlight&&t.include(D0),r&&t.include(Th,e),e.output!==K.Highlight&&(n.code.add(S`
      const float lineWidth = ${S.float(e.lineWidth)};
      const float spacing = ${S.float(e.patternSpacing)};
      const float spacingINV = ${S.float(1/e.patternSpacing)};

      float coverage(float p, float txlSize) {
        p = mod(p, spacing);

        float halfTxlSize = txlSize / 2.0;

        float start = p - halfTxlSize;
        float end = p + halfTxlSize;

        float coverage = (ceil(end * spacingINV) - floor(start * spacingINV)) * lineWidth;
        coverage -= min(lineWidth, mod(start, spacing));
        coverage -= max(lineWidth - mod(end, spacing), 0.0);

        return coverage / txlSize;
      }
    `),e.draped||n.code.add(S`const int maxSamples = 5;
float sample(float p) {
vec2 dxdy = abs(vec2(dFdx(p), dFdy(p)));
float fwidth = dxdy.x + dxdy.y;
ivec2 samples = 1 + ivec2(clamp(dxdy, 0.0, float(maxSamples - 1)));
vec2 invSamples = 1.0 / vec2(samples);
float accumulator = 0.0;
for (int j = 0; j < maxSamples; j++) {
if(j >= samples.y) {
break;
}
for (int i = 0; i < maxSamples; i++) {
if(i >= samples.x) {
break;
}
vec2 step = vec2(i,j) * invSamples - 0.5;
accumulator += coverage(p + step.x * dxdy.x + step.y * dxdy.y, fwidth);
}
}
accumulator /= float(samples.x * samples.y);
return accumulator;
}`)),n.uniforms.add(new lr("uColor",a=>a.color)),n.code.add(S`
    void main() {
      discardBySlice(vpos);
      ${r?"terrainDepthTest(gl_FragCoord, depth);":""}
      vec4 color = ${e.hasVertexColors?"vColor * uColor;":"uColor;"}
      color = highlightSlice(color, vpos);

      ${e.output!==K.Highlight?S`color.a *= ${Z1t(e)};`:""}

      if (color.a < ${S.float(sa)}) {
        discard;
      }

      ${e.output===K.Alpha?S`gl_FragColor = vec4(color.a);`:""}

      ${e.output===K.Color?S`gl_FragColor = color; ${e.transparencyPassType===yt.Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}`:""}
      ${e.output===K.Highlight?S`outputHighlight();`:""}
      ${e.output===K.Depth?S`outputDepth(linearDepth);`:""};
    }
  `),t}function Z1t(e){function t(r){return e.draped?S`coverage(vuv.${r}, texelSize)`:S`sample(vuv.${r})`}switch(e.style){case Ao.ForwardDiagonal:case Ao.Horizontal:return t("y");case Ao.BackwardDiagonal:case Ao.Vertical:return t("x");case Ao.DiagonalCross:case Ao.Cross:return S`
        1.0 - (1.0 - ${t("x")}) * (1.0 - ${t("y")})
      `;default:return"0.0"}}const Y1t=Object.freeze(Object.defineProperty({__proto__:null,build:X1t},Symbol.toStringTag,{value:"Module"}));class p8 extends gi{initializeProgram(t){const r=p8.shader.get().build(this.configuration);return new oi(t.rctx,r,QIe)}_setPipelineState(t,r){const i=this.configuration,s=t===yt.NONE,n=t===yt.FrontFace;return Gt({blending:i.output===K.Color||i.output===K.Alpha?s?fh:N0(t):null,culling:dB(i.cullFace),depthTest:{func:eb(t)},depthWrite:s?i.writeDepth&&cc:DB(t),colorWrite:or,stencilWrite:i.hasOccludees?cg:null,stencilTest:i.hasOccludees?r?j1:rb:null,polygonOffset:s||n?i.polygonOffset&&Q1t:kB(i.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this._setPipelineState(this.configuration.transparencyPassType,!0),this._setPipelineState(this.configuration.transparencyPassType,!1)}getPipelineState(t,r){return r?this._occludeePipelineState:super.getPipelineState(t,r)}}p8.shader=new ni(Y1t,()=>ie(()=>import("./Pattern.glsl.9a9edaae.js"),[],import.meta.url));const Q1t={factor:1,units:1};class Ka extends Ca{constructor(){super(...arguments),this.output=K.Color,this.cullFace=fi.None,this.transparencyPassType=yt.NONE,this.hasSlicePlane=!1,this.hasVertexColors=!1,this.polygonOffset=!1,this.writeDepth=!0,this.hasOccludees=!1,this.enableOffset=!0,this.hasMultipassTerrain=!1,this.cullAboveGround=!1}}u([q({count:K.COUNT})],Ka.prototype,"output",void 0),u([q({count:fi.COUNT})],Ka.prototype,"cullFace",void 0),u([q({count:Ao.COUNT})],Ka.prototype,"style",void 0),u([q({count:yt.COUNT})],Ka.prototype,"transparencyPassType",void 0),u([q()],Ka.prototype,"hasSlicePlane",void 0),u([q()],Ka.prototype,"hasVertexColors",void 0),u([q()],Ka.prototype,"polygonOffset",void 0),u([q()],Ka.prototype,"writeDepth",void 0),u([q()],Ka.prototype,"hasOccludees",void 0),u([q()],Ka.prototype,"patternSpacing",void 0),u([q()],Ka.prototype,"lineWidth",void 0),u([q()],Ka.prototype,"enableOffset",void 0),u([q()],Ka.prototype,"draped",void 0),u([q()],Ka.prototype,"hasMultipassTerrain",void 0),u([q()],Ka.prototype,"cullAboveGround",void 0);const QIe=new Map([[O.POSITION,0],[O.COLOR,3],[O.UVMAPSPACE,4],[O.BOUNDINGRECT,5]]);class kse extends Tg{constructor(t){super(t,new ebt),this.supportsEdges=!0,this._vertexAttributeLocations=QIe,this.techniqueConfig=new Ka}getConfiguration(t,r){return this.techniqueConfig.output=t,this.techniqueConfig.cullFace=this.parameters.cullFace,this.techniqueConfig.hasVertexColors=this.parameters.hasVertexColors,this.techniqueConfig.hasSlicePlane=this.parameters.hasSlicePlane,this.techniqueConfig.polygonOffset=this.parameters.polygonOffset,this.techniqueConfig.writeDepth=this.parameters.writeDepth,this.techniqueConfig.style=this.parameters.style,this.techniqueConfig.patternSpacing=this.parameters.patternSpacing,this.techniqueConfig.lineWidth=this.parameters.lineWidth,this.techniqueConfig.draped=this.parameters.draped,this.techniqueConfig.transparencyPassType=r.transparencyPassType,this.techniqueConfig.enableOffset=r.camera.relativeElevation<NB,this.techniqueConfig.hasMultipassTerrain=r.multipassTerrain.enabled,this.techniqueConfig.cullAboveGround=r.multipassTerrain.cullAboveGround,this.techniqueConfig}intersect(t,r,i,s,n,o,a){PB(t,r,s,n,o,void 0,a)}requiresSlot(t,r){return t===Se.DRAPED_MATERIAL?!0:IT(r)===K.Highlight?t===Se.OPAQUE_MATERIAL:t===(this.parameters.writeDepth?Se.TRANSPARENT_MATERIAL:Se.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL)}createGLMaterial(t){return t.output===K.Color||t.output===K.Alpha||t.output===K.Highlight||t.output===K.Depth&&this.parameters.writeLinearDepth?new J1t(t):null}createBufferWriter(){const t=ps().vec3f(O.POSITION).vec4u8(O.COLOR).vec4f(O.UVMAPSPACE);return this.parameters.draped||t.mat3f(O.BOUNDINGRECT),new K1t(t)}}class J1t extends J1{_updateParameters(t){return this.ensureTechnique(p8,t)}_updateOccludeeState(t){t.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:t.hasOccludees})}beginSlot(t){return this._output!==K.Color&&this._output!==K.Alpha||this._updateOccludeeState(t),this._updateParameters(t)}}class K1t extends KB{write(t,r,i,s){for(const n of this.vertexBufferLayout.fieldNames){const o=r.vertexAttributes.get(n),a=r.indices.get(n);if(o&&a)switch(n){case O.POSITION:{ft(o.size===3);const l=i.getField(n,Zr);l&&IB(a,o.data,t.transformation,l,s);break}case O.COLOR:{ft(o.size===3||o.size===4);const l=i.getField(n,uc);l&&HV(a,o.data,o.size,l,s);break}case O.UVMAPSPACE:{ft(o.size===4);const l=i.getField(n,oo);l&&UA(a,o.data,l,s);break}case O.BOUNDINGRECT:{ft(o.size===9);const l=i.getField(n,Ef);l&&this.writeBoundingRect(a,o.data,t.transformation,l,s);break}}}}writeBoundingRect(t,r,i,s,n){const o=i,a=s.typedBuffer,l=s.typedBufferStride,c=t.length;n*=l;for(let h=0;h<c;++h){const p=9*t[h],f=r[p],m=r[p+1],g=r[p+2];a[n]=o[0]*f+o[4]*m+o[8]*g+o[12],a[n+1]=o[1]*f+o[5]*m+o[9]*g+o[13],a[n+2]=o[2]*f+o[6]*m+o[10]*g+o[14];for(let v=3;v<9;++v)a[n+v]=r[p+v];n+=l}}}class ebt extends IR{constructor(){super(...arguments),this.color=xr(1,1,1,1),this.writeDepth=!0,this.writeLinearDepth=!1,this.hasVertexColors=!1,this.polygonOffset=!1,this.hasSlicePlane=!1,this.cullFace=fi.None,this.hasOccludees=!1,this.style=Ao.Cross,this.patternSpacing=10,this.lineWidth=1,this.draped=!0}}function tbt(e,t,r){return ibt(rbt(e),t,r)}function rbt(e){return e&&e.pattern||null}function ibt(e,t,r){return b(e)?e.style==="none"||e.style==="solid"?(e.style==="none"&&(t.color=xr(0,0,0,0),t.transparent=!0),new Pme(t)):(t.style=sbt(e.style),t.draped=r.isDraped,new kse(t)):new Pme(t)}function sbt(e){switch(e){case"horizontal":return Ao.Horizontal;case"vertical":return Ao.Vertical;case"cross":return Ao.Cross;case"forward-diagonal":return Ao.ForwardDiagonal;case"backward-diagonal":return Ao.BackwardDiagonal;case"diagonal-cross":return Ao.DiagonalCross;default:return}}function nbt(e){return e.material instanceof kse&&!e.material.parameters.draped}function obt(e,t){if(nbt(e)){const r=e.geometry.vertexAttributes,i=r.get(O.POSITION).data,s=r.get(O.UVMAPSPACE).data,n=r.get(O.BOUNDINGRECT).data;YIe(oo.fromTypedArray(s),Ns.fromTypedArray(i),t,$1.fromTypedArray(n))}}function abt(e,t,r,i){const s=K3e(e,t,r,i),n=e.stageObject.geometryRecords;for(let o=0;o<n.length;o++)obt(n[o],i);return s}const lbt=["polyline","polygon","extent"];class f8 extends Eg{constructor(t,r,i,s){super(t,r,i,s),this._needsUV=!1,this._hasOutline=!1}async doLoad(){}_ensureMaterials(){this._ensureFillMaterial(),this._ensureOutlineMaterial()}_ensureFillMaterial(){if(b(this._material))return;const t=ki(this.symbolLayer,"material","color"),r=this._getCombinedOpacityAndColor(t);this._material=tbt(this.symbolLayer,{color:r,transparent:r[3]<1||this.needsDrivenTransparentPass,polygonOffset:!1,hasVertexColors:!0,writeLinearDepth:!0,hasSlicePlane:this._context.slicePlaneEnabled},{isDraped:this.draped}),this._needsUV=this._material instanceof kse,this._context.stage.add(this._material)}_ensureOutlineMaterial(){const t=this.symbolLayer.outline;if(b(this._outlineMaterial)||!this._isValidOutline(t))return;this._hasOutline=!0;const r=i=>{const s=vIe(t.pattern);return new jE({width:i,color:this._getOutlineColor(),hasPolygonOffset:!0,hasSlicePlane:this._context.slicePlaneEnabled,isClosed:!0,stipplePattern:s,stippleScaleWithLineWidth:!0,cap:UQ(t.patternCap||"butt")})};this._outlineMaterial=r(yr(t.size)),this._context.stage.add(this._outlineMaterial)}_isValidOutline(t){return b(t)&&t.size&&t.size>0&&b(t.color)&&(R(t.pattern)||t.pattern.type!=="style"||t.pattern.style!=="none")}destroy(){super.destroy(),this._context.stage.remove(this._material),this._material=null,this._context.stage.remove(this._outlineMaterial),this._outlineMaterial=null}createGraphics3DGraphic(t){const r=t.graphic;if(!this._validateGeometry(r.geometry,lbt,this.symbolLayer.type))return null;const i=this._getVertexOpacityAndColor(t.renderingInfo,255),s=this.setGraphicElevationContext(r,new Ah);return this.ensureDrapedStatus(s.mode==="on-the-ground"),this._ensureMaterials(),this.draped?this._createAsOverlay(r,i):this._createAs3DShape(r,i,s)}layerOpacityChanged(){if(b(this._material)){const t=this._material.parameters.color,r=ki(this.symbolLayer,"material","color"),i=this._getCombinedOpacity(r);this._material.setParameters({color:[t[0],t[1],t[2],i],transparent:i<1||this.needsDrivenTransparentPass})}if(b(this._outlineMaterial)){const t=this._outlineMaterial.parameters.color;this._outlineMaterial.setParameters({color:[t[0],t[1],t[2],this._getOutlineOpacity()]})}return!0}layerElevationInfoChanged(t,r,i){const s=this._elevationContext.mode,n=CL(f8.elevationModeChangeTypes,i,s);if(n!==is.UPDATE)return n;const o=Wd(s);return this.updateGraphics3DGraphicElevationInfo(t,r,()=>o)}slicePlaneEnabledChanged(){if(b(this._material)&&this._material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),b(this._outlineMaterial)){const t={hasSlicePlane:this._context.slicePlaneEnabled};this._outlineMaterial.setParameters(t)}return!0}physicalBasedRenderingChanged(){return!0}pixelRatioChanged(){return!0}_createAs3DShape(t,r,i){const s=h$(t.geometry);if(R(s))return null;Rn.renderData=Ose(s,this._context.elevationProvider,this._context.renderCoordsHelper,i),Rn.color=r;const n=Rn.renderData.position.length/3;if(this._needsUV&&(Rn.uvMapSpace=new Float32Array(4*n),Rn.boundingRect=new Float64Array(9*n)),Rn.outNum=0,Rn.outGeometries=[],Rn.outTransforms=[],Rn.outMaterials=[],this._createAs3DShapeFill(Rn),this._hasOutline&&this._createAs3DShapeOutline(Rn),this._logGeometryCreationWarnings(Rn.renderData,s.rings,"rings","FillSymbol3DLayer"),Rn.outNum===0)return null;this._needsUV&&YIe(oo.fromTypedArray(Rn.uvMapSpace),Ns.fromTypedArray(Rn.renderData.position),this._context.renderCoordsHelper,$1.fromTypedArray(Rn.boundingRect));const o=new k0({geometries:Rn.outGeometries,materials:Rn.outMaterials,transformations:Rn.outTransforms,castShadow:!1,metadata:{layerUid:this._context.layer.uid,graphicUid:t.uid}}),a=new Sg(this,o,Rn.outGeometries,null,null,abt,i);return a.alignedSampledElevation=Rn.renderData.sampledElevation,a.needsElevationUpdates=Wd(i.mode),a}_createAs3DShapeFill(t){const r=t.renderData.polygons;for(const{position:i,mapPosition:s,holeIndices:n,index:o,count:a}of r){if(b(this._context.clippingExtent)&&(vi(Ba),nh(Ba,s),!rf(Ba,this._context.clippingExtent)))continue;const l=BA(s,n,3);if(l.length===0)continue;const c=new Uint32Array(l),h=Vfe({indices:c,attributeData:{position:i,color:t.color,mapPosition:s,uvMapSpace:this._needsUV?new Float32Array(t.uvMapSpace.buffer,4*o*t.uvMapSpace.BYTES_PER_ELEMENT,4*a):null,boundingRect:this._needsUV?new Float64Array(t.boundingRect.buffer,9*o*t.boundingRect.BYTES_PER_ELEMENT,9*a):null}});t.outGeometries.push(h),t.outMaterials.push(this._material),t.outTransforms.push(Tn),t.outNum++}}_createAs3DShapeOutline(t){if(!this._hasOutline)return;const r=t.renderData.outlines;for(let i=0;i<r.length;++i){const{mapPosition:s,position:n}=r[i];if(b(this._context.clippingExtent)&&(vi(Ba),nh(Ba,s),!rf(Ba,this._context.clippingExtent)))continue;const o=kQ({overlayInfo:null,removeDuplicateStartEnd:NT.REMOVE,attributeData:{position:n,mapPosition:s}}),a=o.vertexAttributes.get(O.POSITION);a.data===n&&(a.data=new Float64Array(n)),t.outGeometries.push(o),t.outMaterials.push(this._outlineMaterial),t.outTransforms.push(Tn),t.outNum++}}_createAsOverlay(t,r){const i=h$(t.geometry);if(R(i))return null;this._material.renderPriority=this._renderPriority+this._renderPriorityStep/2,b(this._outlineMaterial)&&(this._outlineMaterial.renderPriority=this._renderPriority),Bo.renderData=WPe(i,this._context.overlaySR),Bo.color=r;const s=Bo.renderData.position.length/3;return this._needsUV&&(Bo.uvMapSpace=new Float32Array(4*s)),Bo.outNum=0,Bo.outGeometries=[],Bo.outBoundingBox=vi(),Bo.layerUid=this._context.layer.uid,Bo.graphicsUid=t.uid,this._createAsOverlayFill(Bo),this._hasOutline&&this._createAsOverlayOutline(Bo),this._logGeometryCreationWarnings(Bo.renderData,i.rings,"rings","FillSymbol3DLayer"),Bo.outNum===0?null:(this._needsUV&&k1t(oo.fromTypedArray(Bo.uvMapSpace),Ns.fromTypedArray(Bo.renderData.position),this._context.overlaySR,this._context.graphicsCoreOwner.view.state.viewingMode),Bo.outNum>0?new r8(this,Bo.outGeometries,Bo.outBoundingBox,this._context.drapeSourceRenderer):null)}_createAsOverlayFill(t){const r=t.renderData.polygons;for(const{position:i,holeIndices:s,index:n,count:o}of r){if(vi(Ba),nh(Ba,i),!rf(Ba,this._context.clippingExtent))continue;const a=BA(i,s,3);if(a.length===0)continue;nA(t.outBoundingBox,Ba);const l=new Uint32Array(a),c=Vfe({indices:l,attributeData:{position:i,color:t.color,uvMapSpace:this._needsUV?new Float32Array(t.uvMapSpace.buffer,4*n*t.uvMapSpace.BYTES_PER_ELEMENT,4*o):null}}),h=new qA(c,this._material,{layerUid:t.layerUid,graphicUid:t.graphicsUid}),p=Ba;Kr(h.boundingSphere,.5*(p[0]+p[3]),.5*(p[1]+p[4]),0,.5*Math.sqrt((p[3]-p[0])*(p[3]-p[0])+(p[4]-p[1])*(p[4]-p[1]))),t.outGeometries.push(h),t.outNum++}}_createAsOverlayOutline(t){if(!this._hasOutline)return;const r=t.renderData.outlines;for(let i=0;i<r.length;++i){const{position:s}=r[i];if(vi(Ba),nh(Ba,s),!rf(Ba,this._context.clippingExtent))continue;nA(t.outBoundingBox,Ba);const n=kQ({overlayInfo:{spatialReference:this._context.overlaySR,renderCoordsHelper:this._context.renderCoordsHelper},removeDuplicateStartEnd:NT.REMOVE,attributeData:{position:s}}),o=new qA(n,this._outlineMaterial,{layerUid:t.layerUid,graphicUid:t.graphicsUid}),a=Ba;Kr(o.boundingSphere,.5*(a[0]+a[3]),.5*(a[1]+a[4]),0,.5*Math.sqrt((a[3]-a[0])*(a[3]-a[0])+(a[4]-a[1])*(a[4]-a[1]))),t.outGeometries.push(o),t.outNum++}}_getOutlineOpacity(){const t=ki(this.symbolLayer,"outline","color");return(this.draped?1:this._getLayerOpacity())*(b(t)?t.a:0)}_getOutlineColor(){const t=ki(this.symbolLayer,"outline","color"),r=this._getOutlineOpacity();return vP(b(t)?Me.toUnitRGB(t):null,r)}test(){return{...super.test(),createAsOverlay:(t,r)=>this._createAsOverlay(t,r),createAs3DShape:(t,r,i)=>this._createAs3DShape(t,r,i)}}}f8.elevationModeChangeTypes={definedChanged:is.RECREATE,staysOnTheGround:is.NONE,onTheGroundChanged:is.RECREATE};const Ba=tn(),Rn={renderData:null,color:null,uvMapSpace:null,boundingRect:null,outNum:0,outBoundingBox:null,outGeometries:null,outMaterials:null,outTransforms:null},Bo={renderData:null,color:null,uvMapSpace:null,outNum:0,outBoundingBox:null,outGeometries:null,outMaterials:null,outTransforms:null},cbt=fe.getLogger("esri.views.3d.webgl-engine.lib.TextRenderParameters");class m8{constructor(t){this.definition=t,this.key=JSON.stringify(t),this.haloSize=Math.round(t.halo.size),this.textStyle=this._colorToRGBA(t.color),this.haloStyle=this._colorToRGB(t.halo.color),this.backgroundStyle=t.background.color[3]!==0?this._colorToRGBA(t.background.color):null}fontString(t){const r=this.definition.font;return`${r.style} ${r.weight} ${t}px ${r.family}, sans-serif`}_colorToRGB(t){return`rgb(${t.slice(0,3).map(r=>Math.floor(255*r)).toString()})`}_colorToRGBA(t){return`rgba(${t.slice(0,3).map(r=>Math.floor(255*r)).toString()},${t[3]})`}static async fromSymbol(t,r=1){const i=ki(t,"material","color"),s=Xu(i,jm,Me.toUnitRGBA),n=Xu(t.size,12,yr),o=t.lineHeight,a=b(t.background)?Me.toUnitRGBA(t.background.color):jm,l={family:Xu(t.font,"sans-serif",m=>m.family),decoration:Xu(t.font,"none",m=>m.decoration),weight:Xu(t.font,"normal",m=>m.weight),style:Xu(t.font,"normal",m=>m.style)},c=t.halo,h=b(c)&&b(c.color)&&c.size>0?{size:yr(c.size),color:Me.toUnitRGBA(c.color)}:{size:0,color:jm},p=new m8({color:s,size:n,background:{color:a,padding:b(t.background)?[.65*n,.5*n]:[0,0],borderRadius:b(t.background)?n*(6/16):0},lineSpacingFactor:o,font:l,halo:h,pixelRatio:r}),f=p.fontString(n);try{await document.fonts.load(f)}catch{cbt.warnOnce(`Failed to preload font '${f}'. Some text symbology may be rendered using the default browser font.`)}return p}}class ubt{constructor(t,r,i){this._renderer=new cIe(t,r,i)}get key(){return this._renderer.key}get baselineAnchorY(){return 1-this._renderer.firstRenderedBaselinePosition/this._renderer.renderedHeight}get displayWidth(){return this._renderer.displayWidth}get displayHeight(){return this._renderer.displayHeight}create(){const t=sk(hbt,this._renderer.renderedWidth,this._renderer.renderedHeight),r=t.getContext("2d");return r.save(),this._renderer.render(r,0,0),r.restore(),new Hs(t,{wrap:{s:xt.CLAMP_TO_EDGE,t:xt.CLAMP_TO_EDGE},noUnpackFlip:!1,mipmap:!0,preMultiplyAlpha:!0,powerOfTwoResizeMode:f1.PAD})}}const hbt={canvas:null},dbt=[0,0,1];class pbt extends Eg{constructor(t,r,i,s){super(t,r,i,s),this._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!1},this.ensureDrapedStatus(!1)}async doLoad(){if(!this._drivenProperties.size){const t=UB(this.symbolLayer.size);if(t)throw new j("graphics3dtextsymbollayer:invalid-size",t)}await this._createTextRenderParameters()}async _createTextRenderParameters(){const t=this._context.graphicsCoreOwner.view.state.pixelRatio;this._textRenderParameters=await m8.fromSymbol(this.symbolLayer,t)}destroy(){super.destroy()}createGraphics3DGraphic(t){const r=t.graphic,i=c$(r.geometry);if(R(i))return this.logger.warn(`unsupported geometry type for text symbol: ${r.geometry.type}`),null;const s=this.symbolLayer.text;if(R(s)||s==="")return null;const n=Zee(this.symbol)&&this.symbol.hasVisibleVerticalOffset()?this.symbol.verticalOffset:null;if(b(n)&&!gxe(this.symbolLayer))return this.logger.errorOncePerTick(`Callouts and vertical offset on text symbols are currently only supported with 'center' horizontal alignment (not with '${this.symbolLayer.horizontalAlignment}' alignment)`),null;const o={...gbt,verticalOffset:n,horizontalPlacement:this.symbolLayer.horizontalAlignment,verticalPlacement:Fyt(this.symbolLayer.verticalAlignment)};return this._createAs3DShape(r,i,s,o)}createLabel(t,r,i,s){const n=t.graphic,o=c$(n.geometry);if(R(o))return this.logger.warn(`unsupported geometry type for label: ${n.geometry.type}`),null;const a=r.text;return!a||/^\s+$/.test(a)?null:this._createAs3DShape(n,o,a,r,i,s)}setGraphicElevationContext(t,r,i=0){const s=super.setGraphicElevationContext(t,r);return s.addOffsetRenderUnits(i),s}layerOpacityChanged(){return this.logger.warn("layer opacity change not yet implemented in Graphics3DTextSymbolLayer"),!1}layerElevationInfoChanged(t,r){return $me(t,r,(i,s)=>{this.updateGraphicElevationContext(s,i)}),is.UPDATE}slicePlaneEnabledChanged(t,r){return $me(t,r,i=>{for(const s of i.stageObject.geometryRecords)s.material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled})}),!0}physicalBasedRenderingChanged(){return!0}pixelRatioChanged(){return!1}updateGraphicElevationContext(t,r){this.setGraphicElevationContext(t,r.elevationContext,r.metadata.elevationOffset),r.needsElevationUpdates=Wd(r.elevationContext.mode)||r.elevationContext.mode==="absolute-height"}_defaultElevationInfoNoZ(){return mbt}_createAs3DShape(t,r,i,s,n,o){const a=this.setGraphicElevationContext(t,new Ah,s.elevationOffset),l=ki(t.geometry,"type")==="polyline",c=t.uid;let h=null,p=null;if(R(o)){const z=hIe(s.horizontalPlacement);h=new ubt(i,z,this._textRenderParameters);let X=null;p=this._context.sharedResources.textures.fromData(h.key,()=>h.create(),()=>{b(X)&&X.release()});const Z=this._context.stage.renderView.textureRepository.acquire(p.texture.id);if(R(Z)||Ch(Z))return p.release(),null;X=Z}const f=fbt(h,s),m={occlusionTest:!0,screenOffset:s.screenOffset,anchorPosition:f,polygonOffset:!0,color:[1,1,1,1],centerOffsetUnits:s.centerOffsetUnits,debugDrawLabelBorder:s.debugDrawLabelBorder,drawInSecondSlot:!0};if(b(p)&&(m.textureId=p.texture.id),b(o)&&(m.textureId=o.id),b(s.verticalOffset)){const{screenLength:z,minWorldLength:X,maxWorldLength:Z}=s.verticalOffset;m.verticalOffset={screenLength:yr(z),minWorldLength:X||0,maxWorldLength:Z!=null?Z:1/0}}if(this._context.screenSizePerspectiveEnabled){const{screenSizePerspectiveSettings:z,screenSizePerspectiveSettingsLabels:X}=this._context.sharedResources;m.screenSizePerspective=X.overridePadding(this._textRenderParameters.haloSize+this._textRenderParameters.definition.background.padding[0]),m.screenSizePerspectiveAlignment=z}let g;if(l&&(m.shaderPolygonOffset=1e-4),m.hasSlicePlane=this._context.slicePlaneEnabled,b(n)){const z=JSON.stringify(m);g=n.get(z),R(g)&&(g=new VA(m),n.add(z,g))}else g=new VA(m);const v=[g],w=s.translation,_=b(h)?[h.displayWidth,h.displayHeight]:[0,0],T=s.centerOffset,x=dbt,E=[0,0],C=[$c.createPointGeometry(x,w,null,_,T,E,null)],A=this._context.layer.uid,P=wse(this._context,r,C,v,a,A,c);if(P===null)return null;const I=new Sg(this,P.object,C,R(n)?v:null,p,a$,a);I.alignedSampledElevation=P.sampledElevation,I.needsElevationUpdates=Wd(a.mode)||a.mode==="absolute-height";const{displayWidth:L,displayHeight:k}=b(h)?h:s;I.getScreenSize=(z=rt())=>(z[0]=L,z[1]=k,z);const G={labelText:i,elevationOffset:s.elevationOffset};return I.metadata=G,l$(I,r,this._context.elevationProvider),I}}function $me(e,t,r){e&&e.forEach(i=>{const s=t(i);b(s)&&r(s,i.graphic)})}function fbt(e,t){if(t.verticalPlacement==="baseline"){const i=Lyt[t.horizontalPlacement],s=b(e)?e.baselineAnchorY:0;return Fr(i,s)}const r=Nyt(t.horizontalPlacement,t.verticalPlacement);return nk[r]}const mbt={mode:"relative-to-ground",offset:0},gbt={text:null,translation:[0,0,0],elevationOffset:0,centerOffset:[0,0,0,1],screenOffset:[0,0],horizontalPlacement:"center",verticalPlacement:"center",verticalOffset:null,centerOffsetUnits:null,debugDrawLabelBorder:!1,displayWidth:0,displayHeight:0},ybt={"calm-small":{waveStrength:.005,perturbationStrength:.02,textureRepeat:12,waveVelocity:.01},"rippled-small":{waveStrength:.02,perturbationStrength:.09,textureRepeat:32,waveVelocity:.07},"slight-small":{waveStrength:.05,perturbationStrength:.07,textureRepeat:28,waveVelocity:.1},"moderate-small":{waveStrength:.075,perturbationStrength:.07,textureRepeat:24,waveVelocity:.1},"calm-medium":{waveStrength:.003125,perturbationStrength:.01,textureRepeat:8,waveVelocity:.02},"rippled-medium":{waveStrength:.035,perturbationStrength:.015,textureRepeat:12,waveVelocity:.07},"slight-medium":{waveStrength:.06,perturbationStrength:.015,textureRepeat:8,waveVelocity:.12},"moderate-medium":{waveStrength:.09,perturbationStrength:.03,textureRepeat:4,waveVelocity:.12},"calm-large":{waveStrength:.01,perturbationStrength:0,textureRepeat:4,waveVelocity:.05},"rippled-large":{waveStrength:.025,perturbationStrength:.01,textureRepeat:8,waveVelocity:.11},"slight-large":{waveStrength:.06,perturbationStrength:.02,textureRepeat:3,waveVelocity:.13},"moderate-large":{waveStrength:.14,perturbationStrength:.03,textureRepeat:2,waveVelocity:.15}},vbt=["polyline","polygon","extent"];class Rm extends Eg{constructor(t,r,i,s){super(t,r,i,s)}async doLoad(){}destroy(){super.destroy(),this._context.stage.remove(this._material),this._material=null}createGraphics3DGraphic(t){const r=t.graphic;if(!this._validateGeometry(r.geometry,vbt,this.symbolLayer.type))return null;const i=this.setGraphicElevationContext(r,new Ah);return this.ensureDrapedStatus(i.mode==="on-the-ground"),this.ensureMaterial(),this.draped?this._createAsOverlay(r):this._createAs3DShape(r,i,r.uid)}ensureMaterial(){if(b(this._material))return;const t=new zPe,r=this.symbolLayer.color;b(r)&&(t.color=Me.toUnitRGBA(r));const i=this._getCombinedOpacity(r,{hasIntrinsicColor:!0});t.color=[t.color[0],t.color[1],t.color[2],i],t.transparent=i<1||this.needsDrivenTransparentPass,t.waveDirection=b(this.symbolLayer.waveDirection)?Rm.headingVectorFromAngle(this.symbolLayer.waveDirection):Fr(0,0);const s=this.symbolLayer.waveStrength+"-"+this.symbolLayer.waterbodySize,n=ybt[s];t.waveStrength=n.waveStrength,t.waveTextureRepeat=n.textureRepeat,t.waveVelocity=n.waveVelocity,t.flowStrength=n.perturbationStrength,t.hasSlicePlane=this._context.slicePlaneEnabled,t.isDraped=this.draped,this._material=new VPe(t),this._context.stage.add(this._material)}layerOpacityChanged(){if(R(this._material))return!0;const t=this._material.parameters.color,r=this._getCombinedOpacity(this.symbolLayer.color,{hasIntrinsicColor:!0}),i=r<1||this.needsDrivenTransparentPass;return this._material.setParameters({color:[t[0],t[1],t[2],r],transparent:i}),!0}layerElevationInfoChanged(t,r,i){const s=this._elevationContext.mode,n=CL(Rm.elevationModeChangeTypes,i,s);if(n!==is.UPDATE)return n;const o=Wd(s);return this.updateGraphics3DGraphicElevationInfo(t,r,()=>o)}slicePlaneEnabledChanged(){return b(this._material)&&this._material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),!0}physicalBasedRenderingChanged(){return!0}pixelRatioChanged(){return!0}_createAs3DShape(t,r,i){const s=h$(t.geometry);if(R(s))return null;ma.renderData=Ose(s,this._context.elevationProvider,this._context.renderCoordsHelper,r);const n=ma.renderData.position.length/3;if(ma.uvCoords=new Float64Array(2*n),ma.outNum=0,ma.outGeometries=[],ma.outTransforms=[],ma.outMaterials=[],this._create3DShapeGeometries(ma),this._logGeometryCreationWarnings(ma.renderData,s.rings,"rings","WaterSymbol3DLayer"),ma.outNum===0)return null;this._createUVCoordsFromVertices(ma.uvCoords,ma.renderData.mapPosition,n,this._context.elevationProvider.spatialReference);const o=new k0({geometries:ma.outGeometries,materials:ma.outMaterials,transformations:ma.outTransforms,castShadow:!1,metadata:{layerUid:this._context.layer.uid,graphicUid:i}}),a=new Sg(this,o,ma.outGeometries,null,null,K3e,r);return a.alignedSampledElevation=ma.renderData.sampledElevation,a.needsElevationUpdates=Wd(r.mode),a}_createUVCoordsFromVertices(t,r,i,s){const n=uu(s);vh(av);for(let l=0;l<i;l++)vr(Lme,r[3*l+0],r[3*l+1]),cC(av,Lme);H$(av,av,n);const o=av[0]%Rm.unitSizeOfTexture,a=av[1]%Rm.unitSizeOfTexture;TF[0]=av[0]-o,TF[1]=av[1]-a;for(let l=0;l<i;l++)t[2*l+0]=(r[3*l+0]*n-TF[0])/Rm.unitSizeOfTexture,t[2*l+1]=(r[3*l+1]*n-TF[1])/Rm.unitSizeOfTexture}_create3DShapeGeometries(t){const r=t.renderData.polygons,i=t.uvCoords;for(const{count:s,index:n,position:o,mapPosition:a,holeIndices:l}of r){if(b(this._context.clippingExtent)&&(vi(lv),nh(lv,a),!rf(lv,this._context.clippingExtent)))continue;const c=BA(a,l,3);if(c.length===0)continue;const h=new Uint32Array(c),p=new Float64Array(i.buffer,2*n*i.BYTES_PER_ELEMENT,2*s),f=zfe({indices:h,attributeData:{position:o,uv0:p,mapPosition:a}});t.outGeometries.push(f),t.outMaterials.push(this._material),t.outTransforms.push(Tn),t.outNum++}}_createAsOverlay(t){const r=h$(t.geometry);if(R(r))return null;this._material.renderPriority=this._renderPriority,Ga.renderData=WPe(r,this._context.overlaySR);const i=Ga.renderData.position.length/3;return Ga.uvCoords=new Float64Array(2*i),Ga.outNum=0,Ga.outGeometries=[],Ga.outBoundingBox=vi(),Ga.layerUid=this._context.layer.uid,Ga.graphicsUid=t.uid,this._createAsOverlayWater(Ga),this._logGeometryCreationWarnings(Ga.renderData,r.rings,"rings","WaterSymbol3DLayer"),Ga.outNum===0?null:(this._createUVCoordsFromVertices(Ga.uvCoords,Ga.renderData.position,i,this._context.overlaySR),Ga.outNum>0?new r8(this,Ga.outGeometries,Ga.outBoundingBox,this._context.drapeSourceRenderer):null)}_createAsOverlayWater(t){const r=t.uvCoords,i=t.renderData.polygons;for(const{position:s,holeIndices:n,index:o,count:a}of i){if(vi(lv),nh(lv,s),!rf(lv,this._context.clippingExtent))continue;nA(t.outBoundingBox,lv);const l=BA(s,n,3);if(l.length===0)continue;const c=new Uint32Array(l),h=new Float64Array(r.buffer,2*o*r.BYTES_PER_ELEMENT,2*a),p=zfe({indices:c,attributeData:{position:s,uv0:h}}),f=new qA(p,this._material,{layerUid:t.layerUid,graphicUid:t.graphicsUid}),m=lv;Kr(f.boundingSphere,.5*(m[0]+m[3]),.5*(m[1]+m[4]),0,.5*Math.sqrt((m[3]-m[0])*(m[3]-m[0])+(m[4]-m[1])*(m[4]-m[1]))),t.outGeometries.push(f),t.outNum++}}static headingVectorFromAngle(t){const r=rt(),i=Qz(t);return r[0]=Math.sin(i),r[1]=Math.cos(i),r}test(){return{...super.test(),create3DShape:t=>this._createAs3DShape(t.graphic,t.elevationContext,t.graphicUid),ensureMaterial:()=>this.ensureMaterial()}}}Rm.unitSizeOfTexture=100,Rm.elevationModeChangeTypes={definedChanged:is.RECREATE,staysOnTheGround:is.NONE,onTheGroundChanged:is.RECREATE};const TF=rt(),av=Ut(),Lme=rt(),lv=tn(),ma={renderData:null,uvCoords:null,outNum:0,outBoundingBox:null,outGeometries:null,outMaterials:null,outTransforms:null},Ga={renderData:null,uvCoords:null,outNum:0,outBoundingBox:null,outGeometries:null,outMaterials:null,outTransforms:null},_bt=fe.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayerFactory");function bbt(e,t,r,i){const s=Dme[e.type]&&Dme[e.type][t.type]||wbt[t.type];return s?new s(e,t,r,i):(_bt.error("GraphicsLayerFactory#make",`unknown symbol type ${t.type}`),null)}const wbt={icon:m$,object:U_t,line:n8,path:I1t,fill:f8,extrude:wyt,text:pbt,water:Rm},Dme={"mesh-3d":{fill:vvt}};class xbt extends yse{constructor(t,r,i){super(r.schedule),this._symbol=t,this._context=r,this._backgroundLayers=i,this._destroyed=!1,this.symbolLayers=new Array,this.referenced=0,this._extentPadding=0}set symbol(t){this._symbol=t;for(let r=0;r<t.symbolLayers.length;r++){const i=this.symbolLayers[r];R(i)||(i.symbol=t,i.symbolLayer=t.symbolLayers.items[r])}}get symbol(){return this._symbol}async doLoad(t){let r=this._symbol.symbolLayers;this._extentPadding=0,this._backgroundLayers&&(r=this._backgroundLayers.concat(r));const i=r.length;for(;this.symbolLayers.length<r.length;)this.symbolLayers.push(null);this.symbolLayers.length=r.length;const s=[];for(let n=0;n<i;n++){const o=r.getItemAt(n);if(o.enabled===!1)continue;SF.renderPriority=1-(1+n)/i,SF.renderPriorityStep=1/i,SF.ignoreDrivers=o._ignoreDrivers;const a=bbt(this.symbol,o,this._context,SF);s.push(FK(t,()=>{this.symbolLayers[n]=null,a.destroy()})),this.symbolLayers[n]=a}await Xz(this.symbolLayers,async(n,o)=>{if(b(n))try{await n.load(),this._extentPadding+=Math.max(this._extentPadding,n.extentPadding)}catch{this.symbolLayers[o]=null}});for(const n of s)n==null||n.remove();if(s.length=0,Jt(t),this.symbolLayers.length&&!this.symbolLayers.some(n=>!!n))throw new Error}getSymbolLayerSize(t){const r=this.symbolLayers[t];return b(r)?r.getCachedSize():null}get extentPadding(){return this._extentPadding}createGraphics3DGraphic(t,r){const i=t.graphic,s=new Array(this.symbolLayers.length);for(let o=0;o<this.symbolLayers.length;o++){const a=this.symbolLayers[o];s[o]=b(a)?a.createGraphics3DGraphic(t):null}const n=this._context.arcade||this._context.featureExpressionInfoContext&&this._context.featureExpressionInfoContext.arcade&&this._context.featureExpressionInfoContext.arcade.modules||null;return new vmt(i,r||this,s,t.layer,n)}get complexity(){return bse(this.symbolLayers.map(t=>ki(t,"complexity")))}globalPropertyChanged(t,r){const i=this.symbolLayers.length;for(let s=0;s<i;s++){const n=this.symbolLayers[s],o=a=>{const l=a.graphics[s];return l instanceof Sg?l:null};if(b(n)&&!n.globalPropertyChanged(t,r,o))return!1}return!0}applyRendererDiff(t,r){return this.loadStatus!==Wu.LOADED?bn.Recreate_Symbol:this.symbolLayers.reduce((i,s)=>i!==bn.Recreate_Symbol&&b(s)?Math.min(i,s.applyRendererDiff(t,r)):i,bn.Fast_Update)}prepareSymbolPatch(t){if(this.loadStatus===Wu.FAILED||t.diff.type!=="partial")return;const r=t.diff.diff;if(!r.symbolLayers||r.symbolLayers.type!=="partial")return;const i=r.symbolLayers.diff;this.symbolLayers.forEach((s,n)=>{if(R(s))return;const o=i[n];if(o){const a={diff:o,graphics3DGraphicPatches:[],symbolLayerStatePatches:[]};s.prepareSymbolLayerPatch(a),t.symbolStatePatches.push(...a.symbolLayerStatePatches),a.graphics3DGraphicPatches.length&&t.graphics3DGraphicPatches.push((l,c)=>{const h=l.graphics[n];b(h)&&a.graphics3DGraphicPatches.forEach(p=>p(h,c))})}})}updateGeometry(t,r){for(let i=0;i<this.symbolLayers.length;i++){const s=this.symbolLayers[i];if(R(s))continue;const n=t.graphics[i];if(R(n)||!s.updateGeometry(n,r))return!1}return!0}onRemoveGraphic(t){for(let r=0;r<this.symbolLayers.length;r++){const i=this.symbolLayers[r];if(R(i))continue;const s=t.graphics[r];b(s)&&i.onRemoveGraphic(s)}}getFastUpdateStatus(){let t=0,r=0,i=0;return this.symbolLayers.forEach(s=>{R(s)||(s.loadStatus===Wu.LOADING?t++:s.isFastUpdatesEnabled()?i++:r++)}),{loading:t,slow:r,fast:i}}destroy(){if(this.destroyed)console.error("Graphics3DSymbol.destroy called when already destroyed!");else{super.destroy();for(const t of this.symbolLayers)b(t)&&t.destroy();this.symbolLayers.length=0,this._destroyed=!0}}get destroyed(){return this._destroyed}}const SF={renderPriority:0,renderPriorityStep:1,ignoreDrivers:!1};class Tbt extends yse{constructor(t,r,i){super(r),this.symbol=t,this.convert=i,this.graphics3DSymbol=null,this.referenced=0}getSymbolLayerSize(t){return b(this.graphics3DSymbol)?this.graphics3DSymbol.getSymbolLayerSize(t):null}get symbolLayers(){return b(this.graphics3DSymbol)?this.graphics3DSymbol.symbolLayers:[]}get extentPadding(){return b(this.graphics3DSymbol)?this.graphics3DSymbol.extentPadding:0}async doLoad(t){const r=await this.symbol.fetchSymbol({signal:t});r.id=this.symbol.id,this.graphics3DSymbol=this.convert(r),b(this.graphics3DSymbol)&&await this.graphics3DSymbol.load()}createGraphics3DGraphic(t){return b(this.graphics3DSymbol)?this.graphics3DSymbol.createGraphics3DGraphic(t,this):null}get complexity(){return b(this.graphics3DSymbol)?this.graphics3DSymbol.complexity:_se}globalPropertyChanged(t,r){return!!b(this.graphics3DSymbol)&&this.graphics3DSymbol.globalPropertyChanged(t,r)}applyRendererDiff(t,r){return b(this.graphics3DSymbol)?this.graphics3DSymbol.applyRendererDiff(t,r):bn.Recreate_Symbol}prepareSymbolPatch(t){b(this.graphics3DSymbol)&&this.graphics3DSymbol.prepareSymbolPatch(t)}updateGeometry(t,r){return!!b(this.graphics3DSymbol)&&this.graphics3DSymbol.updateGeometry(t,r)}onRemoveGraphic(){}getFastUpdateStatus(){return b(this.graphics3DSymbol)?this.graphics3DSymbol.getFastUpdateStatus():{loading:1,fast:0,slow:0}}destroy(){b(this.graphics3DSymbol)&&this.graphics3DSymbol.destroy(),this.graphics3DSymbol=void 0,super.destroy()}get destroyed(){return this.graphics3DSymbol===void 0}}function Use(e){return e instanceof Tbt?e.graphics3DSymbol:e instanceof xbt?e:null}const y$=fe.getLogger("esri.views.3d.layers.graphics.labelPlacement");function Sbt(e){const t=$bt(e);if(R(t))return null;const r=Ebt(e,t);if(R(r))return null;const i=r.anchor,s=!!t.hasLabelVerticalOffset;return Abt({anchor:i,verticalOffset:t.verticalOffset,screenOffset:rt(),centerOffset:xr(0,0,0,-1),centerOffsetUnits:"world",translation:M(),elevationOffset:0,hasLabelVerticalOffset:s},r,e)}function Ebt(e,t){if(t.anchor)return t;const r=e.labelClass.labelPlacement,i=cf[r],s=i||lz(e);return r&&!i&&y$.warnOncePerTick(`the requested label placement '${r}' is currently unsupported in SceneView.`),Cbt(s,e)}function Vse(e){const t=e.graphics3DGraphic.graphics3DSymbol,r=Use(t);return b(r)?r.symbol.symbolLayers.getItemAt(0):null}function Cbt(e,t){const r=t.graphics3DGraphic.graphic.geometry;if(R(r))return null;if(b(t.disablePlacement))return t.labelClass.labelPlacement?(y$.warnOncePerTick(Nme(e.placement,t.disablePlacement.logEntityDescription)),lz(t)):e;const i=r.type;switch(i){case"polyline":case"polygon":case"extent":case"multipoint":if(t.labelClass.labelPlacement)return y$.warnOncePerTick(Nme(e.placement,`'${i}' geometries`)),lz(t);break;case"point":case"mesh":return e}return e}function Nme(e,t){return`the requested label placement '${e}' is currently unsupported for ${t} in SceneView.`}function lz(e){const t=e.graphics3DGraphic.graphic.geometry;if(R(t))return null;switch(t.type){case"polyline":case"extent":case"multipoint":return{placement:"center-center",normalizedOffset:null,anchor:"center"};case"polygon":{const r=Vse(e);return b(r)&&r.type==="extrude"?cf["above-center"]:{placement:"center-center",normalizedOffset:null,anchor:"center"}}case"point":case"mesh":return cf["above-center"];default:return}}function Abt(e,t,r){const i=r.graphics3DGraphic.graphic.geometry;if(R(i))return null;switch(i.type){case"point":Obt(e,t,r);break;case"polygon":Rbt(e,t,r);break;case"mesh":zse(e,t,r.graphics3DGraphic.graphics[0])}return e}function Rbt(e,t,r){const i=Vse(r);if(!R(i))switch(i.type){case"extrude":{const s=r.graphics3DGraphic.graphics[0];b(s)?(s.getBoundingBoxObjectSpace(EP),tf(EP,e.translation),e.translation[2]=Z1(EP)/2):se(e.translation,0,0,0),zse(e,t,s);break}}}function Obt(e,t,r){const i=Vse(r);if(R(i))return;const s=r.graphics3DGraphic.graphics[0];switch(b(s)?s.getCenterObjectSpace(e.translation):se(e.translation,0,0,0),i.type){case"icon":case"text":Mbt(e,t,r,s);break;case"object":zse(e,t,s)}}function Mbt(e,t,r,i){const{graphics3DGraphic:s}=r,n=b(i)?i.getScreenSize():null;if(!s.isDraped&&b(n)){const o=Pbt(r);FO[0]=n[0]/2*(t.normalizedOffset[0]-o[0]),FO[1]=n[1]/2*(t.normalizedOffset[1]-o[1]),e.screenOffset[0]=FO[0],e.hasLabelVerticalOffset?(e.centerOffset[1]=FO[1],e.centerOffsetUnits="screen"):e.screenOffset[1]=FO[1]}else e.hasLabelVerticalOffset||e.anchor==="center"||(cf[r.labelClass.labelPlacement]&&y$.warnOncePerTick(`the requested placement '${t.placement}' is currently unsupported for draped graphics`),e.anchor="center")}function Pbt(e,t=Lbt){const{graphics3DGraphic:r}=e,i=r.graphics[0],s=b(i)?i.stageObject.geometryRecords[0].material:null;if(s&&s instanceof VA){const n=s.parameters.anchorPosition;t[0]=2*(n[0]-.5),t[1]=2*(n[1]-.5)}else t[0]=0,t[1]=0;return t}function zse(e,t,r){const i=b(r)?r.getBoundingBoxObjectSpace(EP):EP,s=Ue(i[3]-i[0],i[4]-i[1],i[5]-i[2]),n=Math.sqrt(s[0]*s[0]+s[1]*s[1]);e.centerOffset[0]=n/2*t.normalizedOffset[0];const o=e.translation[2],a=s[2]/2*t.normalizedOffset[1];e.translation[2]=0,e.elevationOffset=o+a;const l=Re(s);e.centerOffset[2]=l/2*t.normalizedOffset[2]}function Ibt(e){return e==="above-center"}function $bt(e){const t=e.labelClass.labelPlacement,{labelSymbol:r,graphics3DGraphic:i}=e,s=Use(i.graphics3DSymbol),n=mn(s,a=>a.symbol.type==="point-3d"?a.symbol:null),o=cf[t]||lz(e);return b(n)&&n.supportsCallout()&&n.hasVisibleVerticalOffset()&&!i.isDraped?{placement:null,hasLabelVerticalOffset:!1,verticalOffset:Fme(n.verticalOffset),anchor:null,normalizedOffset:null}:r&&r.hasVisibleVerticalOffset()&&(R(n)||!n.supportsCallout()||!n.verticalOffset||i.isDraped)?Ibt(o.placement)?{placement:"above-center",verticalOffset:Fme(r.verticalOffset),anchor:"bottom",normalizedOffset:[0,o.normalizedOffset[1],0],hasLabelVerticalOffset:!0}:(y$.errorOncePerTick("Callouts and vertical offset on labels are currently only supported with 'above-center' label placement (not with "+t+" placement)"),null):{placement:null,verticalOffset:null,anchor:null,normalizedOffset:null,hasLabelVerticalOffset:!1}}function Fme(e){const{screenLength:t,minWorldLength:r,maxWorldLength:i}=e;return{screenLength:t,minWorldLength:r,maxWorldLength:i}}const cf={"above-center":{placement:"above-center",normalizedOffset:[0,1,0],anchor:"bottom"},"above-left":{placement:"above-left",normalizedOffset:[-1,1,0],anchor:"bottom-right"},"above-right":{placement:"above-right",normalizedOffset:[1,1,0],anchor:"bottom-left"},"below-center":{placement:"below-center",normalizedOffset:[0,-1,2],anchor:"top"},"below-left":{placement:"below-left",normalizedOffset:[-1,-1,0],anchor:"top-right"},"below-right":{placement:"below-right",normalizedOffset:[1,-1,0],anchor:"top-left"},"center-center":{placement:"center-center",normalizedOffset:[0,0,1],anchor:"center"},"center-left":{placement:"center-left",normalizedOffset:[-1,0,0],anchor:"right"},"center-right":{placement:"center-right",normalizedOffset:[1,0,0],anchor:"left"}},kme={"above-center":["default","esriServerPointLabelPlacementAboveCenter"],"above-left":["esriServerPointLabelPlacementAboveLeft"],"above-right":["esriServerPointLabelPlacementAboveRight"],"below-center":["esriServerPointLabelPlacementBelowCenter"],"below-left":["esriServerPointLabelPlacementBelowLeft"],"below-right":["esriServerPointLabelPlacementBelowRight"],"center-center":["esriServerPointLabelPlacementCenterCenter"],"center-left":["esriServerPointLabelPlacementCenterLeft"],"center-right":["esriServerPointLabelPlacementCenterRight"]};for(const e in kme){const t=kme[e],r=cf[e];t.forEach(i=>{cf[i]=r})}Object.freeze&&(Object.freeze(cf),Object.keys(cf).forEach(e=>{Object.freeze(cf[e]),Object.freeze(cf[e].normalizedOffset)}));const FO=[0,0],Lbt=[0,0],EP=tn();class Ume{constructor(t){this._stage=t,this._materials=new Map}get(t){return this._materials.get(t)}add(t,r){this._materials.set(t,r),this._stage.add(r)}dispose(){this._stage.removeMany(Array.from(this._materials.values())),this._materials.clear()}}const Pj=512,Ij=4096,Dbt=.85,Nbt=.95;let m3=class extends xe{constructor(e){super(e),this.type=Cf.Texture,this.id=Jl(),this.events=new ds,this._glTexture=null,this.needsClear=!1,this.elementsToAddOrUpdate=new Map,this.elementsToRemove=new Map,this.elementsToRender=new Map,this.elements=new Map,this.stageObjects=new Map,this.updating=!1}initialize(){this.stage=this.view._stage,this.canvas=this._create2DCanvas(),this.ctx=this.canvas.getContext("2d"),this.stage.add(this);const e=this._computeAtlasResolution(this.view.width,this.view.height);this._createAtlasRegion(e),this._update2DCanvasSize(),this._resetAtlasCursor()}unload(){this._glTexture=Ye(this._glTexture),this.updating=!1,this.events.emit("unloaded")}get width(){return this.atlas.size.width}get height(){return this.atlas.size.height}get requiresFrameUpdates(){return!1}_createDescriptor(e){return{target:mt.TEXTURE_2D,pixelFormat:ze.RGBA,dataType:Ct.UNSIGNED_BYTE,wrapMode:xt.CLAMP_TO_EDGE,flipped:!0,samplingMode:et.LINEAR_MIPMAP_LINEAR,hasMipmap:!0,preMultiplyAlpha:!0,maxAnisotropy:e.parameters.maxMaxAnisotropy}}get glTexture(){return this._glTexture}load(e){return b(this._glTexture)||(this._glTexture=new nt(e,this._createDescriptor(e),this.canvas),this.frameWorker=this.view.resourceController.scheduler.registerTask(vt.TEXT_TEXTURE_ATLAS,this),this.setDirty()),this._glTexture}dispose(){this.elements=null,this.elementsToAddOrUpdate=null,this.elementsToRemove=null,this.elementsToRender=null,this.frameWorker=wn(this.frameWorker),this._glTexture&&(this.stage.remove(this),this._glTexture=Ye(this._glTexture)),this.canvas.width=0,this.canvas.height=0,this.canvas=null,this.ctx=null}_create2DCanvas(){const e=document.createElement("canvas");return e.setAttribute("id","canvas2d"),e.setAttribute("style","display:none"),e.setAttribute("width",Pj.toString()),e.setAttribute("height",Pj.toString()),e}_update2DCanvasSize(){this.canvas.setAttribute("width",this.atlas.size.width.toString()),this.canvas.setAttribute("height",this.atlas.size.height.toString())}_createAtlasRegion(e=Pj){this.atlas={size:{width:e,height:e},cursor:{x:0,y:0},lineHeight:0}}_computeAtlasResolution(e,t){let r=Math.max(e,t);return r+=256,r=qC(r),r=Math.min(r,Ij),r}_resizeAtlas(e,t){t=t||e;const r=this.atlas;r.size.width=e,r.size.height=t,b(this._glTexture)&&this._glTexture.resize(e,t),this._update2DCanvasSize()}_resetAtlasCursor(){const e=this.atlas;e.cursor.x=kO,e.cursor.y=kO+Vme,e.lineHeight=0,this.needsClear=!0}_getAtlasUsage(){const e=this.atlas;return(e.cursor.x+e.cursor.y*e.size.width)/(e.size.width*e.size.height)}_getExpectedAtlasUsage(){const e=this.elementsToRemove.size,t=this.elementsToAddOrUpdate.size,r=this.elements.size;return this._getAtlasUsage()/r*(r+t-e)}_addAtlasElement(e,t,r,i){const s=this.atlas,{renderedWidth:n,renderedHeight:o,displayWidth:a,displayHeight:l}=e.textRenderer;e.placement.offset.x=s.cursor.x,e.placement.offset.y=s.cursor.y,e.placement.size.width=n,e.placement.size.height=o,e.placement.size.displayWidth=a,e.placement.size.displayHeight=l,e.placement.uvMinMax=[e.placement.offset.x/s.size.width,1-(e.placement.offset.y+o)/s.size.height,(e.placement.offset.x+n)/s.size.width,1-e.placement.offset.y/s.size.height],s.cursor.x+=r,s.lineHeight=Math.max(s.lineHeight,i),this.elements.set(t,e)}_removeAtlasElement(e){if(e&&this.elements.has(e.textId)){const t=e.placement.offset,r=e.placement.size;this.ctx.clearRect(t.x,t.y,r.width,r.height),this.elements.delete(e.textId)}}_ensureStageObjects(e){const t=this.stageObjects.get(e);if(t)return t;const r=new Set;return this.stageObjects.set(e,r),r}_addStageObject(e,t){this._ensureStageObjects(e).add(t)}_removeStageObject(e,t){const r=this.stageObjects.get(e);r&&r.delete(t)&&(t.geometries[0].vertexAttributes.get(O.SIZE).data=[0,0],t.geometryVertexAttrsUpdated(t.geometryRecords[0]))}_processAddition(e,t){const r=this.atlas,i=e.textId,s=e.textRenderer.renderedWidth,n=e.textRenderer.renderedHeight,o=s+kO,a=n+kO+Vme;if(r.cursor.x+o<r.size.width&&r.cursor.y+a<r.size.height)this._addAtlasElement(e,i,o,a),this.elementsToRender.set(i,e),this.elementsToAddOrUpdate.delete(i);else{if(!(r.cursor.y+a+r.lineHeight<r.size.height)){const l=this._getExpectedAtlasUsage(),c=l>Dbt&&r.size.width<Ij;return c&&this._resizeAtlas(2*r.size.width,2*r.size.height),!t||!c&&l>Nbt&&r.size.width===Ij?(this._processRemovals(),HE.OK):(this._repack(),HE.REPACK)}r.cursor.x=kO,r.cursor.y+=r.lineHeight,r.lineHeight=0,this._addAtlasElement(e,i,o,a),this.elementsToRender.set(i,e),this.elementsToAddOrUpdate.delete(i)}return HE.OK}_processRemovals(){this.elementsToRemove.forEach((e,t)=>{const r=this.stageObjects.get(t);r&&r.size!==0||this._removeAtlasElement(e),r&&r.size===0&&this.stageObjects.delete(t)}),this.elementsToRemove.clear()}_repack(){this._processRemovals(),this.elements.forEach((e,t)=>{e.rendered=!1,this.elementsToAddOrUpdate.set(t,e)}),this.elements.clear(),this._resetAtlasCursor(),this.elementsToRender.clear()}_processRenderingRequest(e){this.ctx.clearRect(e.placement.offset.x,e.placement.offset.y,e.placement.size.width,e.placement.size.height),e.textRenderer.render(this.ctx,e.placement.offset.x,e.placement.offset.y);const t=this.stageObjects.get(e.textId);t&&t.forEach(r=>{r.geometries[0].vertexAttributes.get(O.UV0).data=new Float32Array(e.placement.uvMinMax),r.geometries[0].vertexAttributes.get(O.SIZE).data=[e.placement.size.displayWidth,e.placement.size.displayHeight],r.geometryVertexAttrsUpdated(r.geometryRecords[0])}),e.rendered=!0}get running(){return this.updating}runTask(e,t=!0){if(!this._glTexture)return;let r=!1;if(yn(this.elementsToAddOrUpdate,(s,n)=>{const o=this.elements.get(n);if(o&&o.rendered){const a=this.stageObjects.get(n);return a&&a.forEach(l=>{const c=l.geometries[0].vertexAttributes,h=this.elements.get(n);c.get(O.UV0).data=new Float32Array(h.placement.uvMinMax),c.get(O.SIZE).data=new Float32Array([h.placement.size.displayWidth,h.placement.size.displayHeight]),l.geometryVertexAttrsUpdated(l.geometryRecords[0])}),this.elementsToAddOrUpdate.delete(n),!1}return this._processAddition(this.elementsToAddOrUpdate.get(n),t)===HE.REPACK&&(r=!0,!0)}),r)return void this.runTask(ER,!1);let i=!1;this.elementsToRender.size>0&&this.needsClear&&(this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.needsClear=!1),yn(this.elementsToRender,(s,n)=>(this._processRenderingRequest(s),this.elementsToRender.delete(n),i=!0,e.madeProgress(),e.done)),i&&b(this._glTexture)&&this._glTexture.setData(this.canvas),this.updating=this.elementsToRender.size>0,!this.updating&&kmt.orderedRepackingEnabled&&this.repackOrdered()}addTextTexture(e,t){const r=e.key;this.elementsToAddOrUpdate.has(r)||this.elementsToAddOrUpdate.set(r,{textId:r,placement:{offset:{x:0,y:0},size:{width:0,height:0,displayWidth:0,displayHeight:0},uvMinMax:[]},textRenderer:e,rendered:!1}),this._addStageObject(r,t),this.elementsToRemove.delete(r),this.setDirty()}removeTextTexture(e,t){const r=e.key;this.elementsToRemove.set(r,this.elements.get(r)),this._removeStageObject(r,t)}setDirty(){this._glTexture&&(this.updating=!0)}repackOrdered(){if(this.elements.size===0)return;const e=[];this.elements.forEach((r,i)=>e.push({element:r,key:i}));let t=!0;for(let r=0;r<e.length-1;r++)if(e[r].key.localeCompare(e[r+1].key)>0){t=!1;break}if(!t||this.elementsToRemove.size){e.sort((r,i)=>r.key.localeCompare(i.key)),this.elements.clear();for(const{element:r,key:i}of e)this.elements.set(i,r);this._repack(),this.setDirty()}}get test(){const{elements:e,stageObjects:t,elementsToRemove:r,atlas:i}=this,s=this;return{elements:e,stageObjects:t,elementsToRemove:r,atlas:i,_resizeAtlas:(n,o)=>s._resizeAtlas(n,o),run:(n,o)=>s.runTask(n,o)}}};u([d({constructOnly:!0})],m3.prototype,"view",void 0),u([d({type:Boolean})],m3.prototype,"updating",void 0),m3=u([$("esri.views.3d.webgl-engine.lib.TextTextureAtlas")],m3);const kO=2,Vme=2;var HE;(function(e){e[e.OK=0]="OK",e[e.REPACK=1]="REPACK"})(HE||(HE={}));const zme=fe.getLogger("esri.views.3d.layers.graphics.Labeler");let Iw=class extends xe{constructor(){super(...arguments),this._dirty=!1,this._labels=new Map,this._labelsToAdd=new Map,this._labelsToRemove=new Map,this._labelingContexts=new Array}setup(){this.dispose(),this._handles=new Dt,this._handles.add([te(()=>{var e;return(e=this.view.state)==null?void 0:e.camera},()=>this.setDirty()),te(()=>{var e;return(e=this.view.state)==null?void 0:e.pixelRatio},()=>this._resetAllLabels()),this.view.resourceController.scheduler.registerTask(vt.LABELER,this)]),this._textTextureAtlas=new m3({view:this.view}),this._hudMaterialCollection=new Ume(this.view._stage),this._calloutMaterialCollection=new Ume(this.view._stage)}dispose(){this._handles=ct(this._handles),this._textTextureAtlas=Ye(this._textTextureAtlas),this._hudMaterialCollection=Ye(this._hudMaterialCollection),this._calloutMaterialCollection=Ye(this._calloutMaterialCollection),this._labelingContexts.length=0,this._labels.clear(),this._labelsToAdd.clear(),this._labelsToRemove.clear()}_activateLabelingContext(e){e.labels.forEach((t,r)=>{this._labels.set(r,t),t.graphics3DGraphic.setVisibilityFlag(eh.USER_SETTING,!0,Co.LABEL)}),e.active=!0}_deactivateLabelingContext(e){e.labels.forEach((t,r)=>{t.graphics3DGraphic.setVisibilityFlag(eh.USER_SETTING,!1,Co.LABEL),this.setLabelGraphicVisibility(t.graphics3DGraphic,!1),this._labels.delete(r)}),e.active=!1}_addLabelTextureToAtlas(e){for(const t of e.graphics3DGraphic.labelGraphics){if(!t._labelClass)continue;const r=e.textTextureResources.textRenderers[t._labelIndex];b(r)&&this._textTextureAtlas.addTextTexture(r,t.stageObject)}e.rendered=!0}_removeLabelTextureFromAtlas(e){for(const t of e.graphics3DGraphic.labelGraphics){if(!t._labelClass)continue;const r=e.textTextureResources.textRenderers[t._labelIndex];b(r)&&this._textTextureAtlas.removeTextTexture(r,t.stageObject)}e.rendered=!1}get running(){var e;return this.view.ready&&(this._dirty||((e=this._textTextureAtlas)==null?void 0:e.updating)||this.deconflictor.running)}runTask(e){this._updateLabels(e),!this._dirty&&this.deconflictor.running&&this.deconflictor.runTask(e)}_updateLabels(e){if(this._dirty){this._dirty=!1;for(const t of this._labelingContexts)if(Fbt(t)){if(!Bme(t)){if(kbt(t)){this._deactivateLabelingContext(t);continue}if(this._createLabelClassContext(t),$j(t)){this._dirty=!0;continue}if(!Bme(t))continue}yn(t.labelsToInitialize,(r,i)=>(this._ensureGraphics3DResources(r)&&(this._labels.set(i,r),this.deconflictor.setDirty(),e.madeProgress()),(r.visible&&r.textTextureResources.initialized||!r.visible&&r.hasGraphics3DResources)&&(t.labelsToInitialize.delete(i),e.madeProgress()),e.done))&&(this._dirty=!0)}this._labelsToRemove.forEach(t=>this._removeLabelTextureFromAtlas(t)),this._labelsToAdd.forEach(t=>this._addLabelTextureToAtlas(t)),this._labelsToRemove.clear(),this._labelsToAdd.clear(),this._dirty||this.notifyChange("updating")}}async _createLabelClassContextAsync(e){const t=e.labelClassAbortController.signal;await e.layer.when(),Jt(t),e.scaleVisibility&&e.scaleVisibility.updateScaleRangeActive();const r=e.graphics3DCore,i=r.layer,s=i.labelingInfo&&i.labelingInfo.filter(a=>!!a.symbol);if(!s||s.length===0)return;const n=new Array(s.length);let o=!1;await Xz(s,async(a,l)=>{const c=a.symbol,h=Use(r.getOrCreateGraphics3DSymbol(c));if(R(h))return void zme.error("Failed to create Graphics3DSymbol for label");await h.load(),Jt(t);let p=null;Zee(c)&&c.hasVisibleCallout()&&(p=fmt(c,r.symbolCreationContext),await p.load(),Jt(t));const f=await yh(Z3e(a,e.layer.fieldsIndex,this.view.spatialReference));if(Jt(t),f.ok===!0){const m=await this._createTextRenderParameters(h.symbol);Jt(t),n[l]={labelClass:a,labelFunction:f.value,graphics3DSymbol:h,graphics3DCalloutSymbolLayer:p,calloutSymbolLayerIndex:0,textRenderParameters:m}}else zme.error(`Label expression failed to evaluate: ${f.error}`),o=!0}),Jt(t),o||(e.labelClassContexts=n)}async _createLabelClassContext(e){return e.labelClassPromise||(e.labelClassPromise=this._createLabelClassContextAsync(e).catch(t=>{if(Vi(t))throw t;e.labelClassContexts=null}).then(()=>{e.labelClassAbortController=null,this.notifyChange("updating")}).catch(()=>{}),this.notifyChange("updating")),e.labelClassPromise}async _createTextRenderParameters(e){const t=e.symbolLayers.getItemAt(0);return t&&t.type==="text"?m8.fromSymbol(t,this.view.state.pixelRatio):null}_destroyLabelClassContext(e){for(const r of e.labelClassContexts)--r.graphics3DSymbol.referenced,r.graphics3DSymbol=null;const t=e.labelClassAbortController;e.labelClassAbortController=new AbortController,t&&t.abort(),e.labelClassContexts=[],e.labelClassPromise=null,this.notifyChange("updating")}_createTextSymbolGraphic(e,t,r,i,s){const n={text:e.text,centerOffset:r.centerOffset,translation:r.translation,elevationOffset:r.elevationOffset,screenOffset:r.screenOffset,centerOffsetUnits:r.centerOffsetUnits,horizontalPlacement:Kfe(r.anchor),verticalPlacement:Dyt(r.anchor),verticalOffset:r.verticalOffset,debugDrawLabelBorder:Xr.LABELS_SHOW_BORDER,displayWidth:e.displayWidth,displayHeight:e.displayHeight};return cv.graphic=t,cv.renderingInfo=null,cv.layer=i,s.createLabel(cv,n,this._hudMaterialCollection,this._textTextureAtlas)}_createLineCalloutGraphic(e,t,r,i,s){const n={symbol:t,translation:i.translation,elevationOffset:i.elevationOffset,screenOffset:i.screenOffset,centerOffset:i.centerOffset,centerOffsetUnits:i.centerOffsetUnits,materialCollection:this._calloutMaterialCollection};return cv.graphic=e,cv.renderingInfo=n,cv.layer=s,r.createGraphics3DGraphic(cv)}_ensureGraphics3DResources(e){if(e.hasGraphics3DResources)return!1;const t=e.graphics3DGraphic;if(t.destroyed)return!1;this._ensureTextTextureResources(e);const{textTextureResources:r}=e,i=e.labelingContext,s=i.labelClassContexts;if(!s||s.length===0||!i.emptySymbolLabelSupported&&t.graphics.length===0)return!1;let n=!1;const o=t.graphic,a=i.layer,l=Yq(i.layer),c=this.view._stage;for(let h=0;h<s.length;h++){const p=r.textRenderers[h],f=r.labelPlacements[h];if(R(p)||R(f))continue;const m=s[h],g=m.graphics3DSymbol,v=g.symbol&&g.symbol.type==="label-3d"?g.symbol:null,w=g.symbolLayers[0];if(!w)continue;w.setElevationInfoOverride(i.elevationInfoOverride);const _=this._createTextSymbolGraphic(p,o,f,a,w);if(!_)return!1;_._labelClass=m.labelClass,_._labelIndex=h,t.addLabelGraphic(_,c,i.stageLayer),t.setVisibilityFlag(eh.USER_SETTING,l,Co.LABEL),t.clearVisibilityFlag(eh.SCALE_RANGE,Co.LABEL),t.setVisibilityFlag(eh.DECONFLICTION,!1,Co.LABEL),n=!0;const T=m.graphics3DCalloutSymbolLayer;if(T&&f.hasLabelVerticalOffset){T.setElevationInfoOverride(i.elevationInfoOverride);const x=this._createLineCalloutGraphic(o,v,T,f,a);b(x)&&(m.calloutSymbolLayerIndex=t.labelGraphics.length,t.addLabelGraphic(x,c,i.stageLayer))}break}return i.scaleVisibility&&n&&i.scaleVisibility.updateGraphicLabelScaleVisibility(t),e.hasGraphics3DResources=!0,!0}_destroyGraphics3DResources(e){const t=e.labelingContext.labelClassContexts;for(const r of e.graphics3DGraphic.labelGraphics){if(r._labelClass==null)continue;const i=t[r._labelIndex].graphics3DSymbol.symbolLayers[0];i!=null&&i.onRemoveGraphic(r)}e.graphics3DGraphic.clearLabelGraphics(),e.hasGraphics3DResources=!1}_ensureTextTextureResources(e){const{textTextureResources:t}=e;if(t.initialized)return;const r=e.labelingContext,i=r.labelClassContexts;if(!i||i.length===0)return;const s=e.graphics3DGraphic.graphic;for(let n=0;n<i.length;n++){const o=i[n];if(t.textRenderers[n]=null,t.labelPlacements[n]=null,!o.textRenderParameters)continue;const a=o.labelFunction;let l;if(a.type==="arcade")try{const _=a.needsHydrationToEvaluate()?vft(s,r.layer):s;l=a.evaluate(_)}catch{l=null}else l=a.evaluate(s);if(R(l)||l===""||/^\s+$/.test(l))continue;const c=o.graphics3DSymbol,h=c.symbol&&c.symbol.type==="label-3d"?c.symbol:null;if(!c.symbolLayers[0])continue;const p=e.graphics3DGraphic,f=o.labelClass,m=r.disablePlacement,g=Sbt({graphics3DGraphic:p,labelSymbol:h,labelClass:f,disablePlacement:m});if(R(g))continue;const v=Kfe(g.anchor),w=hIe(v);t.textRenderers[n]=new cIe(l,w,o.textRenderParameters),t.labelPlacements[n]=g}t.initialized=!0}_destroyTextTextureResources(e){const{textTextureResources:t}=e;t.initialized=!1,t.textRenderers=[],t.labelPlacements=[]}_addGraphic(e,t){const r={hasGraphics3DResources:!1,visible:!1,rendered:!1,labelingContext:e,graphics3DGraphic:t,textTextureResources:{initialized:!1,textRenderers:[],labelPlacements:[]}},i=t.graphic.uid;e.labels.set(i,r),e.labelsToInitialize.set(i,r),this.setDirty(),this.deconflictor.setDirty()}_removeGraphic(e,t){const r=t.graphic.uid,i=e.labels.get(r);i&&(this._destroyGraphic(i,r),e.labels.delete(r),e.labelsToInitialize.delete(r),this.setDirty(),this.deconflictor.setDirty())}_destroyGraphic(e,t){this._labels.has(t)&&(this._labels.delete(t),this._labelsToAdd.delete(t),this._labelsToRemove.delete(t)),e.textTextureResources.initialized&&(this._removeLabelTextureFromAtlas(e),this._destroyTextTextureResources(e)),e.hasGraphics3DResources&&this._destroyGraphics3DResources(e)}async _labelingInfoChange(e,t){if(!t)return this._visibilityInfoChange(e),this._resetLabels(e),this._createLabelClassContext(e);for(const r of t){const i=e.labels.get(r);i&&(this._removeGraphic(e,i.graphics3DGraphic),this._addGraphic(e,i.graphics3DGraphic))}}_globalPropertyChanged(e,t){for(const r of t.labelClassContexts){const i=new Map;t.labels.forEach(n=>{const o=n.graphics3DGraphic;i.set(o.graphic.uid,o)});const s=n=>n.labelGraphics[0];if(r.graphics3DSymbol.symbolLayers[0].globalPropertyChanged(e,i,s),r.graphics3DCalloutSymbolLayer){const n=o=>o.labelGraphics[r.calloutSymbolLayerIndex];r.graphics3DCalloutSymbolLayer.globalPropertyChanged(e,i,n)}}}_visibilityInfoChange(e){const t=e.layer.labelsVisible;t&&!e.active&&this._activateLabelingContext(e),!t&&e.active&&this._deactivateLabelingContext(e),this.setDirty()}_resetAllLabels(){for(const e of this._labelingContexts)this._resetLabels(e)}_resetLabels(e){e.labels.forEach((t,r)=>{this._destroyGraphic(t,r),t.visible=!1,t.rendered=!1,e.labelsToInitialize.set(r,t)}),this._destroyLabelClassContext(e),this.setDirty(),this.deconflictor.setDirty()}_findLabelingContext(e){for(const t of this._labelingContexts)if(t.graphics3DCore===e)return t;return null}addGraphicsOwner(e,t,r){const i=r&&r.emptySymbolLabelSupported||!1,s=r&&r.elevationInfoOverride||null,n=r&&r.disablePlacement||null;if(this._findLabelingContext(e))return;const o=e.layer,a={graphics3DCore:e,layer:o,scaleVisibility:t,emptySymbolLabelSupported:i,elevationInfoOverride:s,disablePlacement:n,active:o.labelsVisible,labelClassPromise:null,labelClassAbortController:new AbortController,labelClassContexts:[],labels:new Map,labelsToInitialize:new Map,stageLayer:new _Pe({isPickable:!0},o.uid)};return this.view._stage.add(a.stageLayer),this._labelingContexts.push(a),this.setDirty(),{addGraphic:l=>this._addGraphic(a,l),removeGraphic:l=>this._removeGraphic(a,l),featureReductionChange:()=>{},layerLabelsEnabled:()=>Yq(a.layer),labelingInfoChange:l=>this._labelingInfoChange(a,l),elevationInfoChange:()=>this._globalPropertyChanged("elevationInfo",a),slicePlaneEnabledChange:()=>this._globalPropertyChanged("slicePlaneEnabled",a),visibilityInfoChange:()=>this._visibilityInfoChange(a),reset:()=>this._resetLabels(a),clear:()=>{}}}removeGraphicsOwner(e){const t=this._findLabelingContext(e);if(!t)return;const r=this._labelingContexts.indexOf(t);this._labelingContexts.splice(r,1),t.labels.forEach(i=>this._removeGraphic(t,i.graphics3DGraphic)),this.view._stage.remove(t.stageLayer),t.stageLayer=null,this.setDirty()}setLabelGraphicVisibility(e,t){const r=e.graphic.uid,i=this._labels.get(r);i&&i.visible!==t&&(t&&!i.rendered?(this._labelsToAdd.set(r,i),this._labelsToRemove.delete(r),i.textTextureResources.initialized||i.labelingContext.labelsToInitialize.set(r,i)):!t&&i.rendered&&(this._labelsToRemove.set(r,i),this._labelsToAdd.delete(r)),i.visible=t,this.setDirty())}setDirty(){!this._dirty&&this._labelingContexts.length>0&&(this._dirty=!0,this.notifyChange("updating"))}get updating(){var e;return this._dirty||((e=this._textTextureAtlas)==null?void 0:e.updating)||this.deconflictor.updating||this._labelingContexts.some(t=>$j(t))}get updatingProgress(){if(!this.updating||!this._textTextureAtlas)return 1;const e=this._labelingContexts.length>0?this._labelingContexts.reduce((t,r)=>t+($j(r)?0:1),0)/this._labelingContexts.length:1;return(this._dirty?0:.3)+(this._textTextureAtlas.updating?0:.1)+.1*e+.5*this.deconflictor.updatingProgress}get test(){return{textTextureAtlas:this._textTextureAtlas,resetAllLabels:()=>this._resetAllLabels()}}};function Fbt(e){return e.active&&Yq(e.layer)}function $j(e){return e.labelClassPromise&&!!e.labelClassAbortController}function Bme(e){return e.labelClassContexts&&e.labelClassContexts.length}function kbt(e){return e.labelClassContexts===null}u([d({constructOnly:!0})],Iw.prototype,"view",void 0),u([d({constructOnly:!0})],Iw.prototype,"deconflictor",void 0),u([d()],Iw.prototype,"_textTextureAtlas",void 0),u([d({type:Boolean,readOnly:!0})],Iw.prototype,"updating",null),Iw=u([$("esri.views.3d.layers.graphics.Labeler")],Iw);const cv=new gmt(null,null,null);class Ubt{constructor(){this.gltfCache=new Map,this.wosrCache=new Map,this.evictHandles=new Dt}loadGLTF(t,r,i){const s=i?`gltfPBR:${t}`:`gltf:${t}`;return this._fromCache(this.gltfCache,s,n=>DIe(new $Ie(n.streamDataRequester),t,n,i),r)}loadWOSR(t,r){const i=`wosr:${t}:${r.disableTextures}`;return this._fromCache(this.wosrCache,i,s=>NIe(t,s),r)}destroy(){this.evictHandles.destroy(),this.gltfCache.clear(),this.wosrCache.clear()}get size(){return this.wosrCache.size+this.gltfCache.size}_fromCache(t,r,i,s){return new Promise((n,o)=>{if(gn(s))return void o(gr());const a=Ia(s,()=>{this._remove(t,r),o(gr())}),l=t.get(r);if(l)return this.evictHandles.remove(r),l.refCount++,void l.item.then(n,o);const c=new AbortController,h={...s,signal:c.signal},p={refCount:1,abortController:c,item:i(h).then(f=>(p.abortController=null,f.remove=()=>this._remove(t,r),f))};t.set(r,p),p.item.then(f=>{b(a)&&a.remove(),n(f)},f=>{b(a)&&a.remove(),o(f)})})}_remove(t,r){const i=t.get(r);i&&(i.refCount--,i.refCount===0&&this.evictHandles.add(U4e(()=>{t.delete(r),b(i.abortController)&&i.abortController.abort()},zbt),r))}}const Vbt=1e4;let zbt=Vbt;class Qp{constructor(t,r,i,s=null){this.lij=[0,0,0],this.extent=Ut(),this.resolution=0,this.loadPriority=0,this.measures={visibility:ba.VISIBLE_ON_SURFACE,screenRect:Ut(),distance:0,shouldSplit:!1},this.used=!1,s&&this.acquire(t,r,i,s)}acquire(t,r,i,s){this.tilingScheme=s,this.id=Qp.id(t,r,i),this.lij[0]=t,this.lij[1]=r,this.lij[2]=i,s.getExtent(t,r,i,this.extent),this.resolution=s.resolutionAtLevel(t)}release(){this.tilingScheme=null}getChildren(t){const r=this.lij[0]+1,i=2*this.lij[1],s=2*this.lij[2];return t?(t[0].acquire(r,i,s,this.tilingScheme),t[1].acquire(r,i+1,s,this.tilingScheme),t[2].acquire(r,i,s+1,this.tilingScheme),t[3].acquire(r,i+1,s+1,this.tilingScheme),t):[new Qp(r,i,s,this.tilingScheme),new Qp(r,i+1,s,this.tilingScheme),new Qp(r,i,s+1,this.tilingScheme),new Qp(r,i+1,s+1,this.tilingScheme)]}copyMeasurementsFrom(t){this.measures.visibility=t.measures.visibility,this.measures.shouldSplit=t.measures.shouldSplit,this.measures.distance=t.measures.distance,h0(t.measures.screenRect,this.measures.screenRect)}static id(t,r,i){return`${t}/${r}/${i}`}}var ba;(function(e){e[e.INVISIBLE=0]="INVISIBLE",e[e.VISIBLE_WHEN_EXTENDED=1]="VISIBLE_WHEN_EXTENDED",e[e.VISIBLE_ON_SURFACE=2]="VISIBLE_ON_SURFACE"})(ba||(ba={}));class A_{constructor(t){this.renderCoordsHelper=t,this.frustum=e$(),this._points=iMe(),this.lines=new Array(12),this._origin=M(),this._direction=M(),this._altitude=null;for(let r=0;r<12;r++)this.lines[r]={origin:null,direction:M(),endpoint:null}}get planes(){return this.frustum}get points(){return this._points}get mutablePoints(){return this._points}get direction(){return this._direction}update(t){sMe(t.viewMatrix,t.projectionMatrix,this.frustum,this._points),ae(this._origin,t.eye),ae(this._direction,t.viewForward),this._altitude=this.renderCoordsHelper.getAltitude(this._origin),this._updateLines()}updatePoints(t){for(let r=0;r<this._points.length;r++)ae(this._points[r],t[r]);nMe(this.frustum,this._points),this._updateLines()}get altitude(){return this._altitude}intersectsSphere(t){return q_(this.frustum,t)}intersectsRay(t){return rut(this.frustum,t)}intersectsLineSegment(t,r){return iut(this.frustum,t,r)}intersectsPoint(t){return oMe(this.frustum,t)}_updateLines(){const t=this._points;for(let r=0;r<4;r++){const i=r+4;Lj(this.lines[r],t[r],t[i]),Lj(this.lines[r+4],t[r],r===3?t[0]:t[r+1]),Lj(this.lines[r+8],t[i],r===3?t[4]:t[i+1])}}}function Lj(e,t,r){e.origin=t,e.endpoint=r,S0(e.direction,t,r)}A_.planePointIndices=nut,A_.nearFarLineIndices=[[Ke.NEAR_BOTTOM_LEFT,Ke.FAR_BOTTOM_LEFT],[Ke.NEAR_BOTTOM_RIGHT,Ke.FAR_BOTTOM_RIGHT],[Ke.NEAR_TOP_RIGHT,Ke.FAR_TOP_RIGHT],[Ke.NEAR_TOP_LEFT,Ke.FAR_TOP_LEFT]];const JIe=.5*Math.PI,Bbt=JIe/Math.PI*180;class Gbt{constructor(t){this.renderCoordsHelper=t.renderCoordsHelper,this.extent=new Array(4),this.planes=new Array(6),this.maxSpan=0,this.center={origin:M(),direction:M()};for(let r=0;r<4;r++)this.extent[r]={origin:M(),direction:M(),cap:{next:null,direction:M()}},this.planes[r]=Er();this.planes[ci.NEAR]=Er(),this.planes[ci.FAR]=Er(),this.planesWithoutFar=this.planes.slice(0,5)}update(t,r,i,s=!0){const n=this.extent;this._toRenderBoundingExtent(t,r,i),de(this.center.origin,n[0].origin,n[2].origin),le(this.center.origin,this.center.origin,.5),this.renderCoordsHelper.worldUpAtPosition(this.center.origin,this.center.direction),s||le(this.center.direction,this.center.direction,-1);for(let o=0;o<4;o++){const a=n[o];this.renderCoordsHelper.worldUpAtPosition(a.origin,a.direction);const l=n[o===3?0:o+1];a.cap.next=l.origin,S0(a.cap.direction,a.origin,l.origin),gI(a.direction,a.cap.direction,a.origin,this.planes[o]),s||le(a.direction,a.direction,-1)}gI(n[0].cap.direction,n[1].cap.direction,n[0].origin,this.planes[ci.NEAR]),s?FX(this.planes[ci.NEAR],this.planes[ci.FAR]):(R6(this.planes[ci.FAR],this.planes[ci.NEAR]),FX(this.planes[ci.NEAR],this.planes[ci.NEAR])),this.maxSpan=Math.max(Math.abs(t[0]-t[2]),Math.abs(t[1]-t[3])),this.maxSpanSpatialReference=r,this.minGlobalAltitude=.9*Ar(this.maxSpanSpatialReference).radius}isVisibleInFrustum(t,r,i=!1){if(t==null)return!1;if(this.renderCoordsHelper.viewingMode===Be.Global){const n=this.maxSpanSpatialReference.isGeographic?Bbt:JIe*r;if(this.maxSpan>n)return!0;if(t.altitude>=this.minGlobalAltitude)return this._isVisibleInFrustumGlobal(t)}if(this.maxSpan===0){const n=this.extent[0];return!(i||!t.intersectsRay(wh(n.origin,n.direction)))}for(let n=0;n<this.extent.length;n++){const o=this.extent[n];if(!i&&t.intersectsRay(wh(o.origin,o.direction))||t.intersectsLineSegment(Bx(o.origin,o.cap.next,Hbt),o.cap.direction))return!0}const s=i?this.planes:this.planesWithoutFar;for(let n=0;n<t.lines.length;n++){const o=t.lines[n];if($lt(s,o.origin,o.endpoint,o.direction))return!0}return!1}_toRenderBoundingExtentGlobal(t,r,i){Vee(t,lp),lp[2]=i,bh(r,lp,Dj,this.renderCoordsHelper.spatialReference),Cs(Gme,Dj),vi(yc);for(const{x0:n,x1:o,y0:a,y1:l}of jbt)for(let c=0;c<5;c++){const h=c/4;lp[0]=Yt(t[n],t[o],h),lp[1]=Yt(t[a],t[l],h),lp[2]=i,xn(lp,r,lp,this.renderCoordsHelper.spatialReference),Ve(lp,lp,Gme),eg(yc,lp)}se(this.extent[0].origin,yc[0],yc[1],yc[2]),se(this.extent[1].origin,yc[3],yc[1],yc[2]),se(this.extent[2].origin,yc[3],yc[4],yc[2]),se(this.extent[3].origin,yc[0],yc[4],yc[2]);for(let n=0;n<4;++n)Ve(this.extent[n].origin,this.extent[n].origin,Dj)}_toRenderBoundingExtentLocal(t,r,i){T6(t,r,Ng,this.renderCoordsHelper.spatialReference),se(this.extent[0].origin,Ng[0],Ng[1],i),se(this.extent[1].origin,Ng[2],Ng[1],i),se(this.extent[2].origin,Ng[2],Ng[3],i),se(this.extent[3].origin,Ng[0],Ng[3],i)}_toRenderBoundingExtent(t,r,i){switch(this.renderCoordsHelper.viewingMode){case Be.Global:this._toRenderBoundingExtentGlobal(t,r,i);break;case Be.Local:this._toRenderBoundingExtentLocal(t,r,i);break;default:this.renderCoordsHelper.viewingMode}}_isVisibleInFrustumGlobal(t){if(ui(t.planes[ci.NEAR],this.center.origin)<0&&Te(this.center.direction,t.direction)<0)return!0;for(let r=0;r<4;r++){const i=this.extent[r];if(ui(t.planes[ci.NEAR],i.origin)<0&&Te(i.direction,t.direction)<0)return!0}return!1}}const jbt=[{x0:0,y0:1,x1:2,y1:1},{x0:0,y0:3,x1:2,y1:3},{x0:0,y0:1,x1:0,y1:3},{x0:2,y0:1,x1:2,y1:3}],lp=M(),Dj=Ce(),Gme=Ce(),yc=tn(),Ng=Ut(),Hbt=yg();class qbt{constructor(t){this.renderCoordsHelper=t,this.surfaceElevation=0,this.cache=new Map,this.frustum=new A_(t),this.extendedFrustum=new A_(t),this.intersector=new Gbt({renderCoordsHelper:t}),this.renderCoordsHelper=t}begin(t,r){this.surfaceElevation=r,this.aboveGround=this.renderCoordsHelper.getAltitude(t.eye)>r,this.frustum.update(t),this._shortenFrustumFarPlane(this.frustum),this._updateExtendedFrustum(t)}end(){this.cache.clear()}calculate(t){if(this.allTilesInvisible)return ba.INVISIBLE;const r=this.renderCoordsHelper.viewingMode===Be.Global&&t.lij[0]>=Wbt&&t.lij[0]<Xbt,i=this._getOrCalculateSingleTileVisibility(t,!r);return i!==ba.INVISIBLE&&r?this._calculateAggregatedChildrenVisibility(t):i}_shortenFrustumFarPlane(t){const r=A_.nearFarLineIndices,i=t.mutablePoints;for(const s of r){const[n,o]=s,a=i[n],l=i[o];pe(_u,l,a),le(_u,_u,Ybt),de(i[o],a,_u)}t.updatePoints(i)}_calculateAggregatedChildrenVisibility(t){let r=ba.INVISIBLE;const i=this.cache.get(t.id);if(i!=null)return i;const s=Wme.acquire();t.getChildren(s);for(const n of s){const o=this.calculate(n);if(o!==ba.INVISIBLE&&(r=o,o===ba.VISIBLE_ON_SURFACE))break}return Wme.release(s),this.cache.set(t.id,r),r}_getOrCalculateSingleTileVisibility(t,r){const i=this.cache.get(t.id);if(i!=null)return i;const s=this._calculateSingleTileVisibility(t);return r&&this.cache.set(t.id,s),s}_calculateSingleTileVisibility(t){return!this.aboveGround&&this.renderCoordsHelper.viewingMode===Be.Global&&t.lij[0]<Zbt?this._calculateSingleTileVisibilitySided(t,!1)===ba.INVISIBLE?this._calculateSingleTileVisibilitySided(t,!0):void 0:this._calculateSingleTileVisibilitySided(t,this.aboveGround)}_calculateSingleTileVisibilitySided(t,r){this.intersector.update(t.extent,t.tilingScheme.spatialReference,this.surfaceElevation,r);const i=Ar(t.tilingScheme.spatialReference).radius;return this.intersector.isVisibleInFrustum(this.extendedFrustum,i)?this.intersector.isVisibleInFrustum(this.frustum,i,!0)?ba.VISIBLE_ON_SURFACE:ba.VISIBLE_WHEN_EXTENDED:ba.INVISIBLE}_updateExtendedFrustum(t){this.extendedFrustum.update(t),this._shortenFrustumFarPlane(this.extendedFrustum);const r=this.renderCoordsHelper.worldUpAtPosition(t.eye,_u);this.aboveGround||Ra(r,r);const i=Cn(-Te(r,t.viewForward));if(this.allTilesInvisible=i>(Math.PI+t.fovY)/2,this.allTilesInvisible||(this.hasExtendedFrustum=i>t.fovY/2,!this.hasExtendedFrustum))return;const s=this._extendedFrustumParameters(),n=this.extendedFrustum.mutablePoints;for(let o=0;o<4;o++){const a=s.pointIndices[o],l=n[a],c=this.renderCoordsHelper.getAltitude(l);if(s.needsAltitudeAdjustment(c)){switch(this.renderCoordsHelper.worldUpAtPosition(l,_u),a){case Ke.FAR_BOTTOM_LEFT:case Ke.FAR_TOP_LEFT:case Ke.NEAR_BOTTOM_LEFT:case Ke.NEAR_TOP_LEFT:kX(this.extendedFrustum.planes[ci.LEFT],_u,_u);break;case Ke.FAR_BOTTOM_RIGHT:case Ke.FAR_TOP_RIGHT:case Ke.NEAR_BOTTOM_RIGHT:case Ke.NEAR_TOP_RIGHT:kX(this.extendedFrustum.planes[ci.RIGHT],_u,_u)}le(_u,_u,s.direction),this.renderCoordsHelper.intersectInfiniteManifold(wh(l,_u),s.zWithMargin,l)}}if(this.extendedFrustum.updatePoints(n),xa(n[Ke.NEAR_BOTTOM_LEFT],n[Ke.NEAR_BOTTOM_RIGHT],n[Ke.NEAR_TOP_RIGHT],Hme),xa(n[Ke.NEAR_BOTTOM_RIGHT],n[Ke.NEAR_TOP_RIGHT],n[Ke.NEAR_TOP_LEFT],qme),Te(Hme,qme)<0){const o=this.extendedFrustum.mutablePoints;this.aboveGround?[o[Ke.NEAR_BOTTOM_LEFT],o[Ke.NEAR_BOTTOM_RIGHT]]=[o[Ke.NEAR_BOTTOM_RIGHT],o[Ke.NEAR_BOTTOM_LEFT]]:[o[Ke.NEAR_TOP_LEFT],o[Ke.NEAR_TOP_RIGHT]]=[o[Ke.NEAR_TOP_RIGHT],o[Ke.NEAR_TOP_LEFT]],this.extendedFrustum.updatePoints(o)}}_extendedFrustumParameters(){return this.aboveGround?this._extendedFrustumParametersAboveSurface():this._extendedFrustumParametersBelowSurface()}_extendedFrustumParametersAboveSurface(){const t=this.surfaceElevation-jme;return{zWithMargin:t,pointIndices:A_.planePointIndices.bottom,direction:-1,needsAltitudeAdjustment:r=>r>t}}_extendedFrustumParametersBelowSurface(){const t=this.surfaceElevation+jme;return{zWithMargin:t,pointIndices:A_.planePointIndices.top,direction:1,needsAltitudeAdjustment:r=>r<t}}}const Wbt=2,Xbt=6,Zbt=12,Ybt=.95,jme=1,_u=M(),Hme=Er(),qme=Er(),Wme=new Ls(Array,e=>{e.length!==4&&(e[0]=new Qp,e[1]=new Qp,e[2]=new Qp,e[3]=new Qp)},e=>{e[0].release(),e[1].release(),e[2].release(),e[3].release()});class Qbt{constructor(t){this.camera=new ii,this.focusOnMap=[0,0],this.screenRect=Ut(),this.tileSize=t.tileSize,this.renderCoordsHelper=t.renderCoordsHelper,this.tilingScheme=t.tilingScheme,this.visibility=new qbt(t.renderCoordsHelper)}begin(t,r,i){this.camera.copyFrom(t),this.surfaceElevation=i,this.focusOnMap[0]=r.x,this.focusOnMap[1]=r.y,Uee(0,0,t.fullWidth,t.fullHeight,this.screenRect),this.visibility.begin(this.camera,i)}end(){this.visibility.end()}updateTile(t){t.measures.visibility=this.visibility.calculate(t),t.measures.distance=gBe(t.extent,this.focusOnMap),t.measures.visibility!==ba.INVISIBLE&&this._updateScreenMeasure(t)}_updateScreenMeasure(t){const r=Jbt,i=1<<r,s=t.measures.screenRect;vh(s);let n=0;const o=t.lij[0]+r,a=t.lij[1]<<r,l=t.lij[2]<<r,c=this._tileSizeWithBias(t),h=c*c;for(let p=0;p<i;p++)for(let f=0;f<i;f++)if(n+=this._computeScreenArea(t,o,a+p,l+f,s),n>h)return void(t.measures.shouldSplit=!0);t.measures.shouldSplit=!1}_tileSizeWithBias(t){return t.measures.visibility===ba.VISIBLE_WHEN_EXTENDED?this.tileSize*Kbt:this.tileSize}_computeScreenArea(t,r,i,s,n){const o=t.measures.visibility===ba.VISIBLE_WHEN_EXTENDED;this._projectToScreen(r,i,s,o,uv),vh(Nj);for(let a=0;a<4;a++)cC(Nj,uv[a]);return Dx(n,Nj,n),Cde(uv[0],uv[1],uv[2])+Cde(uv[0],uv[2],uv[3])}_projectToScreen(t,r,i,s,n){this.tilingScheme.ensureMaxLod(t),this.tilingScheme.getExtent(t,r,i,UO),this._toRenderCoords(UO,0,3,hv[0]),this._toRenderCoords(UO,2,3,hv[1]),this._toRenderCoords(UO,2,1,hv[2]),this._toRenderCoords(UO,0,1,hv[3]),s&&(this._projectToPlane(hv,this.camera.frustum[ci.NEAR]),this._projectToPlane(hv,this.camera.frustum[ci.TOP]),this._projectToPlane(hv,this.camera.frustum[ci.BOTTOM]));for(let o=0;o<4;o++)this.camera.projectToRenderScreen(hv[o],Xme),this.camera.renderToScreen(Xme,n[o])}_projectToPlane(t,r){for(let s=0;s<4;s++)zO[s]=ui(r,t[s]);const i=Math.max(zO[0],zO[1],zO[2],zO[3]);if(i>0){const s=le(VO,r,-i);for(let n=0;n<4;n++)de(t[n],t[n],s)}}_toRenderCoords(t,r,i,s){return VO[0]=t[r],VO[1]=t[i],VO[2]=this.surfaceElevation,this.renderCoordsHelper.toRenderCoords(VO,this.tilingScheme.spatialReference,s),s}}const Nj=Ut(),Jbt=2,Kbt=5,uv=[ts(),ts(),ts(),ts()],UO=Ut(),VO=M(),hv=[M(),M(),M(),M()],zO=[0,0,0,0],Xme=ea();function CDt(e,t,r){if(R(e)||R(r))return!1;let i=!0;return hn[0]=e.xmin!=null?e.xmin:0,hn[1]=e.ymin!=null?e.ymin:0,hn[2]=e.zmin!=null?e.zmin:0,i=i&&mi(hn,e.spatialReference,0,t,r,0,1),hn[0]=e.xmax!=null?e.xmax:0,hn[1]=e.ymax!=null?e.ymax:0,hn[2]=e.zmax!=null?e.zmax:0,i=i&&mi(hn,e.spatialReference,0,t,r,3,1),e.xmin==null&&(t[0]=-1/0),e.ymin==null&&(t[1]=-1/0),e.zmin==null&&(t[2]=-1/0),e.xmax==null&&(t[3]=1/0),e.ymax==null&&(t[4]=1/0),e.zmax==null&&(t[5]=1/0),i}function KIe(e,t,r){if(R(e)||R(r))return!1;let i=!0;return hn[0]=e.xmin!=null?e.xmin:0,hn[1]=e.ymin!=null?e.ymin:0,hn[2]=e.zmin!=null?e.zmin:0,i=i&&mi(hn,e.spatialReference,0,hn,r,0,1),t[0]=hn[0],t[1]=hn[1],hn[0]=e.xmax!=null?e.xmax:0,hn[1]=e.ymax!=null?e.ymax:0,hn[2]=e.zmax!=null?e.zmax:0,i=i&&mi(hn,e.spatialReference,0,hn,r,0,1),t[2]=hn[0],t[3]=hn[1],e.xmin==null&&(t[0]=-1/0),e.ymin==null&&(t[1]=-1/0),e.xmax==null&&(t[2]=1/0),e.ymax==null&&(t[3]=1/0),i}const hn=M(),ewt=fe.getLogger("esri.views.3d.layers.support.FeatureTileTree3D");let _o=class extends xe{constructor(e){super(e),this.tiles=new ot,this.tileSize=512,this._idToTile=new Map,this._handles=new Dt,this._clients=new Set,this._dirty=!1,this._newTiles=new Xt}get tilingScheme(){const e=this.tilingSchemeOwner.tilingScheme;return e?e.clone():null}set filterExtent(e){if(b(e)&&!e.spatialReference.equals(this.viewState.spatialReference))return void ewt.error("#extent","extent spatial reference needs to be in the same spatial reference as the view");const t=this._get("filterExtent");if(t===e||b(t)&&e&&t.equals(e))return;const r=b(e)?e.clone():null;this._set("filterExtent",r),this._setDirty()}get filterExtentRect(){if(R(this.filterExtent)||!this.tilingScheme)return null;const e=Ut();return KIe(this.filterExtent,e,this.tilingScheme.spatialReference),e}get rootTileIds(){return this.filterExtentRect?this.tilingScheme.rootTilesInExtent(this.filterExtentRect):[[0,0,0]]}set suspended(e){e!==this._get("suspended")&&(this._set("suspended",e),this._setDirty())}get updating(){return this._dirty||!!this._pendingTiles}initialize(){this._handles.add([te(()=>[this.tilingScheme,this.tileSize],()=>this._reset(),ei),te(()=>{var e,t,r;return[this.tileSize,(e=this.cameraOnSurface)==null?void 0:e.location,this.tilingScheme,(t=this.viewState)==null?void 0:t.contentCamera,(r=this.focus)==null?void 0:r.location]},()=>this._setDirty(),Xs)]),this.scheduler&&(this._frameWorker=this.scheduler.registerTask(vt.FEATURE_TILE_TREE,this))}destroy(){this._frameWorker=wn(this._frameWorker),this._handles=ct(this._handles)}addClient(){const e=rwt();return this._clients.add(e),this._clients.size===1&&this._setDirty(),{remove:()=>this._removeClient(e)}}_removeClient(e){this._clients.delete(e),this._hasClients||this._clear()}get _hasClients(){return this._clients.size>0}_setDirty(){!this._hasClients||this.suspended||this._dirty||(this._frameWorker?(this._dirty=!0,this.notifyChange("updating")):this.runTask(ER))}_clear(){this.tiles.removeAll(),this._idToTile.clear(),this._reset(),this._dirty=!1,this.notifyChange("updating")}get running(){return this.updating}runTask(e){this._dirty=!1,this._pendingTiles||(this._startUpdate(),b(this._frameWorker)&&(this._frameWorker.priority=vt.FEATURE_TILE_TREE_ACTIVE)),this._subdivideTilesForView(e),!this._pendingTiles&&b(this._frameWorker)&&(this._frameWorker.priority=vt.FEATURE_TILE_TREE),this.notifyChange("updating")}_startUpdate(){if(this.suspended)return;if(!this.tilingScheme)return void this._clear();this._tileMeasurements||(this._tileMeasurements=new Qbt({renderCoordsHelper:this.renderCoordsHelper,tilingScheme:this.tilingScheme,tileSize:this.tileSize}));const e=this.viewState.contentCamera;this._tileMeasurements.begin(e,this.focus.location,this.cameraOnSurface.location.z),this._pendingTiles=this._getRootTiles()}_reset(){this._newTiles.clear(),this._tileMeasurements=null,this._pendingTiles=null,this._setDirty()}_getRootTiles(){return this.rootTileIds.map(e=>new Qp(e[0],e[1],e[2],this.tilingScheme))}_purgeHorizonTiles(e){e.sort((t,r)=>{const i=t.measures.screenRect,s=r.measures.screenRect;return i[1]+i[3]-(s[1]+s[3])}),vh(EF);for(let t=0;t<e.length;t++)if(Dx(EF,e.data[t].measures.screenRect,EF),xf(EF)>iwt)return e.data.slice(t,e.length);return[]}_subdivideTilesForView(e){if(this._pendingTiles){for(;this._pendingTiles.length>0&&!e.done;){const t=this._pendingTiles.pop();e.madeProgress(),this.filterExtentRect&&!X$(this.filterExtentRect,t.extent)||(this._tileMeasurements.updateTile(t),t.measures.visibility!==ba.INVISIBLE&&(t.measures.shouldSplit?(this.tilingScheme.ensureMaxLod(t.lij[0]+1),this._pendingTiles.push(...t.getChildren())):this._newTiles.push(t)))}this._pendingTiles.length===0&&(this._updateTiles(this._purgeHorizonTiles(this._newTiles)),this._newTiles.clear(),this._tileMeasurements.end(),this._pendingTiles=null)}}_updateTiles(e){for(const i of this.tiles.items)i.used=!1;const t=e.filter(i=>{const s=this._idToTile.get(i.id);return s?(s.copyMeasurementsFrom(i),s.used=!0):this._idToTile.set(i.id,i),!s}),r=this.tiles.items.filter(i=>!i.used&&(this._idToTile.delete(i.id),!0));this.tiles.removeMany(r),this.tiles.addMany(t),this._sortTiles()}_sortTiles(){this.viewState.fixedContentCamera||this.tiles.sort((e,t)=>e.measures.visibility!==t.measures.visibility?e.measures.visibility===ba.VISIBLE_ON_SURFACE?-1:1:e.measures.distance-t.measures.distance),this.tiles.forEach((e,t)=>e.loadPriority=t)}};u([d({constructOnly:!0})],_o.prototype,"scheduler",void 0),u([d({constructOnly:!0})],_o.prototype,"renderCoordsHelper",void 0),u([d({constructOnly:!0})],_o.prototype,"tilingSchemeOwner",void 0),u([d({constructOnly:!0})],_o.prototype,"cameraOnSurface",void 0),u([d({constructOnly:!0})],_o.prototype,"focus",void 0),u([d({constructOnly:!0})],_o.prototype,"viewState",void 0),u([d({constructOnly:!0})],_o.prototype,"terrain",void 0),u([d()],_o.prototype,"tiles",void 0),u([d()],_o.prototype,"tileSize",void 0),u([d({readOnly:!0})],_o.prototype,"tilingScheme",null),u([d()],_o.prototype,"filterExtent",null),u([d({readOnly:!0})],_o.prototype,"filterExtentRect",null),u([d({readOnly:!0})],_o.prototype,"rootTileIds",null),u([d({value:!1})],_o.prototype,"suspended",null),u([d({readOnly:!0})],_o.prototype,"updating",null),_o=u([$("esri.views.3d.layers.support.FeatureTileTree3D")],_o);let twt=0;function rwt(){return twt++}const EF=Ut(),iwt=10;let vo=class extends xe{constructor(){super(...arguments),this._propertiesPool=new g0({camera:ii},this),this._lastSeenCameraProjectionValues=new ii,this.events=new ds,this.viewingMode=Be.Global,this._cameraChanged=!1,this.updateQueue=new Array,this.processingUpdates=!1}init(e,t){this._set("viewingMode",e),this._set("spatialReference",t),this._set("constraints",new sy({mode:this.viewingMode}))}exit(){this.cameraController=null,this._propertiesPool.destroy(),this._propertiesPool=new g0({camera:ii},this)}createInitialCamera(){if(this.viewingMode===Be.Global){const e=Ar(this.spatialReference).radius;this.camera=new ii(Ue(4*e,0,0),Ue(e,0,0),Ue(0,0,1))}else this.camera=new ii(Ue(0,0,100),Ue(0,0,0),Ue(0,1,0))}get animation(){return this.cameraController instanceof t$&&b(this.cameraController.viewAnimation)?this.cameraController.viewAnimation:null}get camera(){return this._get("camera")}set camera(e){e!==Fh&&Fh.copyFrom(e),Fh.computeUp(this.viewingMode),Zme.camera=Fh,this.events.emit("before-camera-change",Zme);const t=this._get("camera");if(this._cameraProjectionChanged(this._lastSeenCameraProjectionValues,Fh)&&(this._lastSeenCameraProjectionValues.copyFrom(Fh),Yme.camera=this._lastSeenCameraProjectionValues,this.events.emit("camera-projection-changed",Yme)),(!t||!t.equals(Fh))&&(this._set("camera",this._propertiesPool.get("camera").copyFrom(Fh)),this._cameraChanged=!t||!t.almostEquals(Fh),this._cameraChanged)){const r=O1e(()=>{this._cameraChanged=!1,r.remove()})}}get pixelRatio(){return this.camera.pixelRatio}get contentCamera(){return b(this._contentCamera)?this._contentCamera:this.camera}set contentCamera(e){this._contentCamera=b(e)?e.clone():null}get fixedContentCamera(){return b(this._contentCamera)}get isGlobal(){return this.viewingMode===Be.Global}get isLocal(){return this.viewingMode===Be.Local}get navigating(){return!(!this.cameraController||!this.cameraController.isInteractive)}get stationary(){return!this._cameraChanged&&!this.navigating}get cameraController(){return this._get("cameraController")}set cameraController(e){this.stopActiveCameraController()?(e&&(this.own(te(()=>e.state,t=>{t!==ji.Finished&&t!==ji.Stopped||(this._set("cameraController",null),this.updateCamera(r=>e.onControllerEnd(r)))},ei)),e.onControllerStart(this.camera)),this._set("cameraController",e)):e&&(e.state=ji.Rejected)}switchCameraController(e){return this.cameraController=e,e.state!==ji.Rejected}stopActiveCameraController(){return!(this.cameraController&&!this.cameraController.stopController())}updateCamera(e){this.updateQueue.push(e),this._processUpdateQueue()}_processUpdateQueue(){if(this.updateQueue.length===0||this.processingUpdates)return;this.processingUpdates=!0;const e=this.updateQueue.shift();Fh.copyFrom(this._get("camera")),e(Fh),this.camera=Fh,this.processingUpdates=!1,this._processUpdateQueue()}_cameraProjectionChanged(e,t){return e.fov!==t.fov||e.fullViewport[0]!==t.fullViewport[0]||e.fullViewport[1]!==t.fullViewport[1]||e.fullViewport[2]!==t.fullViewport[2]||e.fullViewport[3]!==t.fullViewport[3]||e.padding[Ot.TOP]!==t.padding[Ot.TOP]||e.padding[Ot.RIGHT]!==t.padding[Ot.RIGHT]||e.padding[Ot.BOTTOM]!==t.padding[Ot.BOTTOM]||e.padding[Ot.LEFT]!==t.padding[Ot.LEFT]}};u([d({readOnly:!0,type:xA})],vo.prototype,"animation",null),u([d({type:ii})],vo.prototype,"camera",null),u([d()],vo.prototype,"pixelRatio",null),u([d({})],vo.prototype,"_contentCamera",void 0),u([d({type:ii})],vo.prototype,"contentCamera",null),u([d({readOnly:!0})],vo.prototype,"fixedContentCamera",null),u([d({readOnly:!0})],vo.prototype,"constraints",void 0),u([d({readOnly:!0})],vo.prototype,"events",void 0),u([d({readOnly:!0})],vo.prototype,"isGlobal",null),u([d({readOnly:!0})],vo.prototype,"isLocal",null),u([d({readOnly:!0})],vo.prototype,"viewingMode",void 0),u([d({readOnly:!0})],vo.prototype,"spatialReference",void 0),u([d({readOnly:!0})],vo.prototype,"navigating",null),u([d({readOnly:!0})],vo.prototype,"stationary",null),u([d()],vo.prototype,"_cameraChanged",void 0),u([d()],vo.prototype,"cameraController",null),vo=u([$("esri.views.3d.state.ViewState")],vo);const swt=vo,Fh=new ii,Zme={camera:null},Yme={camera:null};function nwt(e,t,r){return e===Be.Global?new awt(r):new owt(t,r)}class owt{constructor(t,r){this.elevationProvider=t,this._referenceEllipsoid=Ar(r),this.unitInMeters=uu(r,this._referenceEllipsoid.metersPerDegree)}compute(t,r,i,s,n){n||(n={near:0,far:0});let o=t[2]*this.unitInMeters;const a=o,l=o-s,c=this.elevationProvider?this.elevationProvider.elevationBounds:null;c&&(o=l>=0?a-this.unitInMeters*c.min:this.unitInMeters*c.max-a);const h={x:(i=b(i)?i:new Kt({xmin:0,ymin:0,zmin:0,xmax:0,ymax:0,zmax:0})).xmax-i.xmin,y:i.ymax-i.ymin,z:4*Math.max(i.xmax-i.xmin,i.ymax-i.ymin)},p=Math.max(h.x,h.y,h.z);pe(Fb,r,t),WS[0]=Fb[0]>0?i.xmax:i.xmin,WS[1]=Fb[1]>0?i.ymax:i.ymin,WS[2]=Fb[2]>0?p/2:-p/2,pe(WS,WS,t),we(Fb,Fb);const f=1.1*Te(WS,Fb)*this.unitInMeters,m=Math.sqrt(o*(o+2*this._referenceEllipsoid.radius)),g=Math.max(i.xmax-i.xmin,i.ymax-i.ymin),v=g*uwt*this.unitInMeters,w=g*hwt*this.unitInMeters;let _=Le((o-w)/(v-w),0,1);_*=_*_;let T=Yt(m,f,_);return T*=Math.max(Math.log(Math.abs(l)),1),T=Math.min(T,Math.max(34064e4,p)),T/=this.unitInMeters,e$e(T,lwt,this.unitInMeters,n)}}class awt{constructor(t){this._referenceEllipsoid=Ar(t)}compute(t,r,i,s,n){n||(n={near:0,far:0});const o=Re(t)-this._referenceEllipsoid.radius,a=this._referenceEllipsoid.radius+Math.min(0,s),l=Math.abs(o-s),c=Math.max(l,Math.abs(o));return e$e(1.2*Math.sqrt(c*(c+2*a)),Le(2e4-(Math.log(c)-7.983)/9.011*19e3,1e3,2e4),1,n)}}function e$e(e,t,r,i){const s=cwt/r;return e/t>s?(i.far=e,i.near=i.far/t):(i.near=s,i.far=i.near*t),i}const lwt=2e4,cwt=2,uwt=.001,hwt=1e-4,WS=M(),Fb=M();let uk=class extends xe{constructor(e){super(e),this.handles=new Dt}initialize(){this.handles.add(this.view.basemapTerrain.on("elevation-change",e=>this._handleElevationChangeEvent(e)))}destroy(){this.handles&&(this.handles.destroy(),this.handles=null)}_handleElevationChangeEvent(e){if(this.view.state.cameraController)return;const t=this.view.state.camera;qOe(this.view,t,e.extent,e.spatialReference)&&this._applyToCurrentCamera()}_applyToCurrentCamera(){this.view.state.updateCamera(e=>{RR(this.view,e,Md.EYE_AND_CENTER)})}};u([d({constructOnly:!0})],uk.prototype,"view",void 0),uk=u([$("esri.views.3d.state.ElevationCollisionConstraint")],uk);let g3=class extends xe{constructor(e){super(e),this._handles=new Dt,this.nearFarHeuristic=nwt(e.view.state.viewingMode,e.view.basemapTerrain,e.view.renderCoordsHelper.spatialReference)}initialize(){this._handles.add([te(()=>{var e,t,r,i;return[(t=(e=this.view.constraints)==null?void 0:e.clipDistance)==null?void 0:t.near,(i=(r=this.view.constraints)==null?void 0:r.clipDistance)==null?void 0:i.far]},()=>this._clipDistanceNearFarChanged()),te(()=>{var e,t;return(t=(e=this.view.constraints)==null?void 0:e.clipDistance)==null?void 0:t.mode},()=>this._updateNearFar()),this.view.state.events.on("before-camera-change",e=>this._updateCameraNearFar(e.camera)),te(()=>this.view.renderDataExtent,()=>this._updateNearFar(),ei),te(()=>{var e,t,r,i;return[(t=(e=this.view.constraints)==null?void 0:e.altitude)==null?void 0:t.min,(i=(r=this.view.constraints)==null?void 0:r.altitude)==null?void 0:i.max]},()=>this._updateAltitude(),ei),te(()=>{var e,t;return(t=(e=this.view.constraints)==null?void 0:e.tilt)==null?void 0:t.max},()=>this._updateTiltMax(),ei),te(()=>{var e,t;return(t=(e=this.view.constraints)==null?void 0:e.tilt)==null?void 0:t.mode},()=>this._updateTilt(),ei),te(()=>{var e;return(e=this.view.state)==null?void 0:e.camera},()=>this._updateTiltAutoMax(),ei),te(()=>{var e,t,r,i,s,n;return[(r=(t=(e=this.view.map)==null?void 0:e.ground)==null?void 0:t.navigationConstraint)==null?void 0:r.type,(n=(s=(i=this.view.state)==null?void 0:i.constraints)==null?void 0:s.collision)==null?void 0:n.enabled]},()=>this._updateCollision(),ei)]),this.view.state.isLocal&&this._handles.add(te(()=>this.view.renderDataExtent,e=>this._updateLocalSurfaceDistance(e),Rt)),this._updateNearFar(),this.view.state.viewingMode!==Be.Local&&this._updateAltitude(),this._updateTilt(),this._updateCollision(),this._set("surfaceCollisionConstraint",new uk({view:this.view}))}destroy(){this._handles=ct(this._handles),this.surfaceCollisionConstraint&&(this.surfaceCollisionConstraint.destroy(),this._set("surfaceCollisionConstraint",null))}_clipDistanceNearFarChanged(){var t;const e=(t=this.view.constraints)==null?void 0:t.clipDistance;e&&e.mode!=="auto"&&this.view.state.updateCamera(r=>(this._updateCameraNearFarManual(r,e),!0))}_updateNearFar(){this.view.state.updateCamera(e=>(this._updateCameraNearFar(e),!0))}_updateCameraNearFar(e){const t=this.view.constraints&&this.view.constraints.clipDistance;(t?t.mode:"auto")==="manual"?this._updateCameraNearFarManual(e,t):this._updateCameraNearFarAuto(e,t)}_updateCameraNearFarAuto(e,t){this.nearFarHeuristic.compute(e.eye,e.center,this.view.renderDataExtent,TB(this.view,e.eye),e),t&&t.autoUpdate(e.near,e.far)}_updateCameraNearFarManual(e,t){t&&(e.near=t.near,e.far=t.far)}_updateCollision(){var i,s,n;const e=(n=(s=(i=this.view.map)==null?void 0:i.ground)==null?void 0:s.navigationConstraint)==null?void 0:n.type,t=!e||e==="stay-above",r=this.view.state.constraints.collision;if(t!==r.enabled){r.enabled=t,t&&this._reapplyConstraints(Ti.COLLISION);const o=this.view.constraints&&this.view.constraints.tilt;o&&o.mode!=="auto"||this._updateTiltAuto()}}_updateAltitude(){const e=this.view.constraints&&this.view.constraints.altitude;e&&this.view.state.viewingMode!==Be.Local?this.view.state.constraints.altitude={min:e.min,max:e.max}:this.view.state.constraints.altitude=null,this._reapplyConstraints()}_updateTiltMax(){const e=this.view.constraints&&this.view.constraints.tilt;e&&e.mode!=="auto"&&(this._updateTiltManual(e),this._reapplyConstraints())}_updateTilt(){const e=this.view.constraints&&this.view.constraints.tilt;(e?e.mode:"auto")==="manual"?this._updateTiltManual(e):this._updateTiltAuto(),this._reapplyConstraints()}_updateTiltManual(e){const t=this.view.state.constraints;t.tilt=t.createConstantMaxTilt(Ft(e.max))}_updateTiltAuto(){const e=this.view.state.constraints;e.tilt=e.createDefaultTilt(),this._updateTiltAutoMax()}_updateTiltAutoMax(){const e=this.view.constraints&&this.view.constraints.tilt;if(!e||e.mode!=="auto")return;const t=this.view.state.constraints;if(t.tilt){const r=t.tilt(this.view.state.camera.distance).max;e.autoUpdate(nu(r))}}_updateLocalSurfaceDistance(e){if(R(e))return;let t=Math.max(e.width,e.height);if(t<=0)return;e.hasZ&&(t=Math.max(t,e.zmax-e.zmin));const r=this.view.state,i=3*t/Math.atan(r.camera.fov/2);i!==r.constraints.distance&&(r.constraints.distance=i)}_reapplyConstraints(e=Ti.ALL){this.view.state.updateCamera(t=>Ts(this.view,t,{selection:e,interactionType:jt.NONE,interactionFactor:null,interactionStartCamera:null,interactionDirection:null,tiltMode:io.TUMBLE}))}};u([d({constructOnly:!0})],g3.prototype,"view",void 0),u([d({readOnly:!0})],g3.prototype,"surfaceCollisionConstraint",void 0),g3=u([$("esri.views.3d.state.ConstraintsManager")],g3);let qE=class extends Sx{constructor(e){super(e),this.handles=new Dt}set desiredCamera(e){this._set("desiredCamera",e.clone())}get canStop(){return!0}get constraintEnabled(){return this.view.state.constraints.collision.enabled}onControllerStart(){this.state=ji.Running,this.handles.add(this.view.basemapTerrain.on("elevation-change",e=>this._handleElevationChangeEvent(e))),this._applyCorrection()}onControllerEnd(){this.handles.removeAll()}stepController(){}_handleElevationChangeEvent(e){qOe(this.view,this.desiredCamera,e.extent,e.spatialReference)&&this._applyCorrection()}_applyCorrection(){this.view.state.updateCamera(e=>{e.copyViewFrom(this.desiredCamera),RR(this.view,e,Md.EYE_AND_CENTER)||this.constraintEnabled||(this.state=ji.Stopped)})}};u([d({constructOnly:!0})],qE.prototype,"view",void 0),u([d({constructOnly:!0})],qE.prototype,"desiredCamera",null),qE=u([$("esri.views.3d.state.controllers.SurfaceCollisionCorrectionController")],qE);const dwt=.66;function t$e(e){return 360-Pee.normalize(e)}function g8(e){return Pee.normalize(360-e)}function CF(e){return b(e)&&e.resolver&&e.resolver.reject(),null}function pwt(e,t){return b(e)&&e.resolver&&e.resolver.resolve(t),t}function r$e(e,t,r,i=null){if(!t)return CF(i);const s=e.spatialReference||Ze.WGS84;if(b(t.camera)){const c=BT(t.camera.position,s);if(R(c))return CF(i);const h=t.camera.clone();return h.position=c,pwt(i,h)}if(R(t.targetGeometry))return CF(i);const n=t.get("targetGeometry.spatialReference");if(n&&!l1(n,s))return CF(i);const o=kA(e,e.state.camera);let a=ia.ADJUST;if(t.rotation!=null&&(o.heading=t$e(t.rotation),a=ia.LOCKED),r!=null&&(o.tilt=r),t.targetGeometry.type==="point"){const c=t.targetGeometry;let h;const p=t.targetGeometry.clone();return h=t.scale!=null?Kie(e,t.scale,c.latitude):e.state.camera.distance,kMe(e,p,h,o,a,i)}const l=t.targetGeometry.extent;return fP(e,l,o.heading,o.tilt,a,i)}function fwt(e,t,r=null){return R(r)&&(r=new Vd),jse(e,null,t.clone(),r)}async function mwt(e,t,r){const i=Ewt(e,t);if(!i)throw new j("viewpointutils-create:no-target","Missing target for creating viewpoint");const s=new ou({fov:e.camera.fov}),n=new Vd({camera:s});if(i.target instanceof Vd)return kb(await vwt(e,i.target,i,r,n));if(i.target instanceof ou)return kb(s$e(e,i.target,n));const o=i.scale!=null||i.zoom!=null;if(i.target instanceof Kt){const c=i.target.xmin===i.target.xmax||i.target.ymin===i.target.ymax;return kb(o||c?await WQ(e,i,i.target.center,s,r,n):await xwt(e,i,i.target,s,r,n))}const a={boundingBox:vi(),hasZ:!1,screenSpaceObjects:[]},l=o?gwt(e,i):void 0;if(await i$e(e,i.target,l,a),isFinite(a.boundingBox[0])){let c;if(tf(a.boundingBox,ws),Hu.x=ws[0],Hu.y=ws[1],Hu.z=ws[2],Hu.spatialReference=e.spatialReference,isFinite(Hu.z)&&a.hasZ?c=c6(a.boundingBox):(Hu.z=void 0,c=yBe(Gee(a.boundingBox,Awt))),o||c)return kb(await WQ(e,i,Hu,s,r,n));const h=Cwt(e,a.screenSpaceObjects);return kb(await Swt(e,i,Hu,a.boundingBox,h,s,r,n))}return i.position?kb(bwt(e,i,s,n)):kb(await wwt(e,i,s,r,n))}function Bse(e,t){return t.scale==null&&t.zoom!=null?zMe(e,t.zoom):t.scale}function gwt(e,t){return Iht(e,Bse(e,t))}function Gse(e,t){let r=!1;return t.heading!=null?(e.heading=t.heading,r=!0):t.rotation!=null&&(e.heading=t$e(t.rotation),r=!0),t.tilt!=null&&(e.tilt=t.tilt,r=!0),t.fov!=null&&(e.fov=t.fov),r}function jse(e,t,r,i){const s=e.spatialReference||Ze.WGS84;return t=b(t)?t:wy(e,r),R(t)||(i.targetGeometry=O1(t.center,e.renderSpatialReference,s),i.scale=BMe(e,t),i.rotation=g8(r.heading),i.camera=r),i}function cz(e,t,r){if(!t)return;if(!l1(t.spatialReference,e.spatialReference))throw new j("viewpointutils:incompatible-spatialreference",`Spatial reference (${t.spatialReference?t.spatialReference.wkid:"unknown"}) is incompatible with the view (${e.spatialReference.wkid})`,{geometry:t});const i=[];if(!t.hasZ&&e.basemapTerrain){let o;switch(t.type){case"point":o=t;break;case"multipoint":case"polyline":o=t.extent.center;break;case"mesh":o=t.origin;break;case"extent":o=t.center;break;case"polygon":o=t.centroid}o&&l1(o,e.basemapTerrain.spatialReference)?ws[2]=_t(km(e.elevationProvider,o),0):ws[2]=0}(0,Rwt[t.type])(t,o=>{i.push(o[0],o[1],o[2])},ws);const s=i.length/3;if(s===0)return;const n=new Array(i.length);if(mi(i,t.spatialReference,0,n,e.spatialReference,0,s)){t.hasZ&&(r.hasZ=!0);for(let o=0;o<n.length;o+=3)t.hasZ?(ws[0]=n[o+0],ws[1]=n[o+1],ws[2]=n[o+2]):(ws[0]=n[o+0],ws[1]=n[o+1]),eg(r.boundingBox,ws)}}async function ywt(e,t,r,i){const s=await yh(e.whenViewForGraphic(t));if(s.ok===!1||R(s.value)||!("whenGraphicBounds"in s.value))return void cz(e,t.geometry,i);const n=s.value,o=await yh(n.whenGraphicBounds(t,{minDemResolution:r}));if(o.ok===!1)return void cz(e,t.geometry,i);const{screenSpaceObjects:a,boundingBox:l}=o.value;nA(i.boundingBox,l),a&&a.forEach(c=>{i.screenSpaceObjects.push(c)}),isFinite(l[2])&&(i.hasZ=!0)}async function i$e(e,t,r,i){if(Array.isArray(t)&&t.length===2){const s=t[0],n=t[1];if(typeof s=="number"&&typeof n=="number")return Hu.x=s,Hu.y=n,Hu.z=void 0,Hu.spatialReference=e.spatialReference.isGeographic?e.spatialReference:Ze.WGS84,void cz(e,Hu,i)}t&&typeof t.map=="function"?await xs(t.map(s=>i$e(e,s,r,i))):t instanceof iu?cz(e,t,i):t instanceof gl&&await ywt(e,t,r,i)}async function vwt(e,t,r,i,s){if(b(t.camera))return s$e(e,t.camera,s);s.scale=t.scale,s.rotation=t.rotation,s.targetGeometry=b(t.targetGeometry)?t.targetGeometry.clone():null,s.camera=null,r.heading!=null?s.rotation=g8(r.heading):r.rotation!=null&&(s.rotation=r.rotation);const n=Bse(e,r);n!=null&&(s.scale=n);const o=new PR(i);return r$e(e,s,r.tilt,o),s.camera=await o.resolver.promise,s}function s$e(e,t,r){const i=e.spatialReference,s=BT(t.position,i);return R(s)?null:((t=t.clone()).fov=e.camera.fov,t.position=s,jse(e,null,t,r))}function _wt(e,t,r,i,s,n){const o=e.renderSpatialReference;return so(r.position,RF,o),so(t,Fj,o),n.targetGeometry=new at(t),s.position=new at(r.position),pe(uz,Fj,RF),CB(e,RF,uz,i.up,s),n.scale=MT(e,pi(RF,Fj),n.targetGeometry.latitude),n.rotation=g8(s.heading),n.camera=s,n}async function WQ(e,t,r,i,s,n){if(R(r))throw new j("createfromcenter","invalid point");n.targetGeometry=r.clone();const o=nS(e);if(t.position)return _wt(e,n.targetGeometry,t,o,i,n);if(t.zoomFactor){const l=o.distance/t.zoomFactor,c=le(ws,o.viewForward,-l);o.eye=de(ws,o.center,c),n.scale=MT(e,l,r.latitude)}kA(e,o,i);const a=Gse(i,t)?ia.LOCKED:ia.ADJUST;if(!t.zoomFactor){n.scale=Bse(e,t),n.scale==null&&(so(r,ws,e.renderSpatialReference),oMe(o.frustum,ws)?n.scale=MT(e,pi(o.eye,ws),r.latitude):n.scale=BMe(e,o));const l=new PR(s);FMe(e,n.targetGeometry,n.scale,i,a,l),n.camera=await l.resolver.promise}return n}function bwt(e,t,r,i){const s=nS(e);return ae(uz,s.viewForward),CB(e,s.eye,uz,s.up,kj),r.position=new at(t.position),r.heading=t.heading!=null?t.heading:kj.heading,r.tilt=t.tilt!=null?t.tilt:kj.tilt,jse(e,null,r,i)}async function wwt(e,t,r,i,s){const n=nS(e);return WQ(e,t,O1(n.center,e.renderSpatialReference,e.spatialReference),r,i,s)}async function xwt(e,t,r,i,s,n){n.targetGeometry=r.clone();const o=nS(e);kA(e,o,i);const a=Gse(i,t)?ia.LOCKED:ia.ADJUST,l=new PR(s);return fP(e,r,i.heading,i.tilt,a,l),n.camera=await l.resolver.promise,n}function Twt(e,t,r,i,s){let n=0;r.hasZ?n=r.z:e.basemapTerrain&&(n=km(e.elevationProvider,r)),se(ws,r.x,r.y,n),bh(e.spatialReference,ws,Qme,e.renderSpatialReference),Gd(AF,Qme),jd(AF,AF),vi(BO);const o=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]];for(let g=0;g<o.length;g++){const v=o[g];let w=i[v[2]];isFinite(w)||(w=n),se(ws,i[v[0]],i[v[1]],w),xn(ws,e.spatialReference,ws,e.renderSpatialReference),eg(BO,Hc(ws,ws,AF))}const a=WT(BO),l=Z1(BO),c=XT(BO),h=1/Math.tan(t.fovX/2),p=1/Math.tan(t.fovY/2),f=.5*Math.sqrt(a*a+c*c)*Math.max(p,h)+.5*l,m=.5*l*p+.5*Math.max(a,c);return Math.max(f,m)/s}async function Swt(e,t,r,i,s,n,o,a){a.targetGeometry=r.clone();const l=nS(e),c=Twt(e,l,r,i,s);kA(e,l,n);const h=Gse(n,t)?ia.LOCKED:ia.ADJUST;a.scale=MT(e,c,a.targetGeometry.latitude);const p=new PR(o);return FMe(e,a.targetGeometry,a.scale,n,h,p),a.camera=await p.resolver.promise,a}function Ewt(e,t){if(!t||!e.spatialReference)return null;const r={target:null};if("declaredClass"in t||Array.isArray(t))r.target=t;else{for(const i in t)r[i]=t[i];t.center&&!r.target&&(r.target=t.center)}return r}function kb(e){return e&&b(e.camera)&&(e.rotation=g8(e.camera.heading)),e}function Cwt(e,t){const r=dwt;if(!t.length)return r;let i=Number.NEGATIVE_INFINITY;for(let s=0;s<t.length;s++){const n=t[s].screenSpaceBoundingRect;i=Math.max(i,Math.abs(n[0]),Math.abs(n[1]),Math.abs(n[2]),Math.abs(n[3]))}return r-i/Math.min(e.width,e.height)*2}const ws=M(),Qme=Ce(),AF=$i(),BO=tn(),Awt=Ut(),uz=M(),RF=M(),Fj=M(),kj={heading:0,tilt:0},Hu=new at,Rwt={point(e,t,r){r[0]=e.x,r[1]=e.y,e.hasZ&&(r[2]=e.z),t(r)},polygon(e,t,r){const i=e.hasZ;for(let s=0;s<e.rings.length;s++){const n=e.rings[s];for(let o=0;o<n.length;o++)r[0]=n[o][0],r[1]=n[o][1],i&&(r[2]=n[o][2]),t(r)}},polyline(e,t,r){const i=e.hasZ;for(let s=0;s<e.paths.length;s++){const n=e.paths[s];for(let o=0;o<n.length;o++)r[0]=n[o][0],r[1]=n[o][1],i&&(r[2]=n[o][2]),t(r)}},multipoint(e,t,r){const i=e.points,s=e.hasZ;for(let n=0;n<i.length;n++)r[0]=i[n][0],r[1]=i[n][1],s&&(r[2]=i[n][2]),t(r)},extent(e,t,r){e.hasZ?(t(se(r,e.xmin,e.ymin,e.zmin)),t(se(r,e.xmax,e.ymin,e.zmin)),t(se(r,e.xmin,e.ymax,e.zmin)),t(se(r,e.xmax,e.ymax,e.zmin)),t(se(r,e.xmin,e.ymin,e.zmax)),t(se(r,e.xmax,e.ymin,e.zmax)),t(se(r,e.xmin,e.ymax,e.zmax)),t(se(r,e.xmax,e.ymax,e.zmax))):(t(se(r,e.xmin,e.ymin,r[2])),t(se(r,e.xmax,e.ymin,r[2])),t(se(r,e.xmin,e.ymax,r[2])),t(se(r,e.xmax,e.ymax,r[2])))},mesh(e,t,r){const i=e.vertexAttributes&&e.vertexAttributes.position;if(i)for(let s=0;s<i.length;s+=3)t(se(r,i[s+0],i[s+1],i[s+2]))}};class Owt{constructor(t,r,i){this.target=t,this.options=r,this.view=i,this.state="pending",this.abortController=null,this.animationController=null,this.promise=new Promise((s,n)=>{this.resolveCallback=s,this.rejectCallback=n;const o=new AbortController;b(this.options.signal)&&Ia(this.options.signal,()=>{this.abort()}),this.abortController=o,this.waitForReady()})}then(t,r){return this.promise.then(t,r)}catch(t){return this.promise.catch(t)}resolve(t){return this.state="finished",this.resolveCallback(t)}reject(t){return this.state="finished",this.rejectCallback(t)}abort(t=!1){switch(this.state){case"pending":case"wait-for-ready":case"wait-for-viewpoint":this.reject(gr());break;case"wait-for-animation-finish":!t&&b(this.animationController)&&this.view.state.cameraController===this.animationController&&this.animationController.active&&this.animationController.stopController(),this.reject(gr())}}async waitForReady(){if(this.state="wait-for-ready",!this.view.ready)try{await E1(()=>this.view.ready,this.abortController.signal)}catch(t){return this.reject(t)}this.createViewPoint()}createViewPoint(){this.state!=="finished"&&(this.state="wait-for-viewpoint",this.animationController=this.options.animate?this._getAnimationController():null,mwt(this.view,this.target,this.abortController.signal).then(t=>{if(this.state==="finished")return;const r=this._getCameraFromViewpoint(t);if(!R(r))if(this.options.animate){if(R(this.animationController))return;this.startAnimation(r,this.animationController)}else this.view.stateManager.setStateCamera(r.camera,{applyConstraints:!r.isFullySpecified,positionAndOrientationOnly:!0,doNotCancelGoToOperation:!0}),this.resolve()},t=>{this.reject(t)}))}_getCameraFromViewpoint(t){const r=!!(this.target instanceof Vd&&this.target.camera||this.target instanceof ou),i=t.camera;if(R(i))return null;if(!this.view.stateManager.isCompatible(i)){const n=i.position,o=n&&n.spatialReference,a=o?o.wkid:"none",l=this.view.spatialReference.wkid;return this.reject(new j("GotoAnimation:incompatible-spatialreference",`Resulting camera has an incompatible spatial reference (camera: ${a}, view: ${l})`,{camera:i})),null}const s=wy(this.view,i);return R(s)?(this.reject(new j("GotoAnimation:invalid-camera","Resulting camera is invalid")),null):{viewpoint:t,camera:s,isFullySpecified:r}}startAnimation(t,r){this.state="wait-for-animation-finish";const i=r.viewAnimation;if(R(i))return void this.reject(new j("GotoAnimation:missing-animation","Unreachable code in view.stateManager"));if(i.update(t.viewpoint,"running"),!r.active||R(r.viewAnimation)||r.viewAnimation.target!==t.viewpoint||this.view.state.cameraController!==r)return this.abort();let s;t.isFullySpecified?(s=new qE({view:this.view,desiredCamera:t.camera}),RR(this.view,t.camera,Md.EYE_AND_CENTER)):Ts(this.view,t.camera),r.begin(t.camera,this.options);const n=()=>{const a=this.view.state.cameraController;s&&(a&&a.active?a instanceof Uy&&b(a.viewAnimation)&&a.viewAnimation.target===t.viewpoint&&(this.view.state.cameraController=s):b(r.viewAnimation)&&r.viewAnimation.target===t.viewpoint&&r.state==="finished"&&(this.view.state.cameraController=s))},o=a=>{if(!R(this.view.state))switch(r.state){case ji.Finished:switch(this.state){case"pending":case"wait-for-ready":case"wait-for-viewpoint":case"wait-for-animation-finish":this.resolve()}break;case ji.Ready:case ji.Rejected:case ji.Running:case ji.Stopped:switch(this.state){case"pending":case"wait-for-ready":case"wait-for-viewpoint":case"wait-for-animation-finish":this.reject(a)}}};i.when(n,a=>o(a)),r.asyncResult={resolve:()=>o(),reject:a=>o(a)}}_getAnimationController(){let t,r=null;const i=this.view.state.cameraController;return i instanceof Uy&&(i.updateStateFromViewAnimation(),i.active&&(t=i,r=t.viewAnimation)),t!=null||(t=new Uy({view:this.view,mode:"animation"}),r=t.viewAnimation,this.view.state.switchCameraController(t))?t:(b(r)&&r.stop(),this.reject(new j("GotoAnimation:goto-cannot-interrupt","Cannot start an animation while interacting")),null)}}const kh=fe.getLogger("esri.views.3d.state.ViewStateManager");let Mn=class extends xe{constructor(e){super(e),this.propertiesPool=new g0({frustum:A_},this),this.handles=new Dt,this.cameraSetByUser=!1,this.gotoOperation=null,this.ready=!1,this._windowDevicePixelRatio=1,this._devicePixelRatioOverride=null,this._maximumPixelRatioOverride=null,this.test={contentCameraResetState:new Map,setDevicePixelRatio:t=>this._devicePixelRatioOverride=t,setMaximumPixelRatio:t=>this._maximumPixelRatioOverride=t}}get camera(){const e=this._get("camera");if(!this.ready)return e;const t=kA(this.view,this.view.state.camera);return t&&e&&t.equals(e)?e:t}set camera(e){this._updatePropertyBeforeReady("camera",e)||(this.view.elevationProvider.enableElevationCache(!0),this.setStateCamera(wy(this.view,e),{applyConstraints:!1})||kh.error("#camera=","Invalid camera",e),this.view.elevationProvider.enableElevationCache(!1))}get contentCamera(){const e=this._get("contentCamera");if(!this.ready)return e;const t=kA(this.view,this.view.state.contentCamera);return t&&e&&t.equals(e)?e:t}set contentCamera(e){if(this._updatePropertyBeforeReady("contentCamera",e))return;const t=wy(this.view,e);R(t)?this.view.state.contentCamera=null:(this._updateElevation(t),this.view.state.contentCamera=t)}installContentCameraReset(e){if(this.handles.remove("contentCameraReset"),this.test.contentCameraResetState.clear(),!this.view.state.fixedContentCamera)return!1;const t=this.zoom,r=this.view.state.camera.distance**2,i=Bl(this.view.state.camera.center),s=e.sticky?this.contentCamera.clone():null;return this.handles.add([te(()=>this.contentCamera,()=>{e.sticky||(this.handles.remove("contentCameraReset"),this.test.contentCameraResetState.clear())}),te(()=>this.zoom,n=>{this.test.contentCameraResetState.set("view.zoom",Math.abs(n-t)/2),Math.abs(n-t)>2?this.contentCamera=null:this.view.state.fixedContentCamera||(this.contentCamera=s)}),te(()=>this.view.state.camera,n=>{const o=Fn(i,n.center);this.test.contentCameraResetState.set("camera.center",o/r),o>r?this.contentCamera=null:this.view.state.fixedContentCamera||(this.contentCamera=s)})],"contentCameraReset"),!0}get center(){return this.ready?this.view.pointsOfInterest.centerOnContent.location:this._get("center")}set center(e){this._updatePropertyBeforeReady("center",e)||(e?this.isCompatible(e)?this.setStateCamera(this._centerToCamera(e),{applyConstraints:!0})?this.view.pointsOfInterest.centerOnContent.runTask():kh.error("#center=","Invalid center",e):kh.error("#center=","Center has an incompatible spatial reference (center: "+(e.spatialReference?e.spatialReference.wkid:"none")+", view: "+this.view.spatialReference.wkid+")",e):kh.error("#center=","Center may not be null or undefined"))}get extent(){if(!this.ready)return this._get("extent");const e=this.view,t=Aht(e,e.state.camera,e.pointsOfInterest.centerOnContent.renderLocation);return b(t)?t:this._get("extent")}set extent(e){this._updatePropertyBeforeReady("extent",e)||(e?this.isCompatible(e)?this.setStateCamera(this._extentToCamera(e),{applyConstraints:!0})||kh.error("#extent=","Invalid extent",e):kh.error("#extent=","Extent has an incompatible spatial reference (extent: "+(e.spatialReference?e.spatialReference.wkid:"none")+", view: "+this.view.spatialReference.wkid+")",e):kh.error("#extent=","Extent may not be null or undefined"))}get frustum(){const e=this.propertiesPool.get("frustum");return e.renderCoordsHelper=this.view.renderCoordsHelper,e.update(this.view.state.camera),e}get hasInitialView(){return!!this.view.get("map.initialViewProperties.viewpoint")}get scale(){if(this.ready){const e=this.view.pointsOfInterest.centerOnContent;return MT(this.view,e.distance,e.location.latitude)}return this._get("scale")}set scale(e){this._updatePropertyBeforeReady("scale",e)||this.setStateCamera(this._scaleToCamera(e),{applyConstraints:!0})||kh.error("#scale=","Invalid scale",e)}get padding(){if(!this.ready)return this._get("padding");const e=this.view.state.camera,t=e.padding,r=e.pixelRatio,i=this._get("padding"),s=Math.round(t[Ot.TOP]/r),n=Math.round(t[Ot.RIGHT]/r),o=Math.round(t[Ot.BOTTOM]/r),a=Math.round(t[Ot.LEFT]/r);return i!=null&&i.top===s&&i.right===n&&i.bottom===o&&i.left===a?i:{top:s,right:n,bottom:o,left:a}}set padding(e){this._updatePropertyBeforeReady("padding",e)||(this._paddingToArray(e,this.view.state.camera.pixelRatio,OF),this.view.state.updateCamera(t=>t.padding=OF))}_paddingToArray(e,t,r){e?Kr(r,e.top||0,e.right||0,e.bottom||0,e.left||0):Kr(r,0,0,0,0);for(let i=0;i<4;i++)r[i]=Math.round(r[i]*t)}get screenCenter(){const e=this.padding;return wf((this.view.width-(e.left+e.right))/2+e.left,(this.view.height-(e.top+e.bottom))/2+e.top)}get viewpoint(){return this.ready?fwt(this.view,this.camera):this._get("viewpoint")}set viewpoint(e){if(!this._updatePropertyBeforeReady("viewpoint",e))if(e)if(this.isCompatible(e))this.setStateCamera(this._viewpointToCamera(e),{applyConstraints:!e.camera})||kh.error("#viewpoint=","Invalid viewpoint",e);else{const t=b(e.camera)?e.camera.position:e.targetGeometry,r=b(t)&&t.spatialReference;kh.error("#viewpoint=","Viewpoint has an incompatible spatial reference (viewpoint: "+(r?r.wkid:"none")+", view: "+this.view.spatialReference.wkid+")",e)}else kh.error("#viewpoint=","Viewpoint may not be null or undefined")}get zoom(){return this.ready?VMe(this.view,this.scale):this._get("zoom")}set zoom(e){this._updatePropertyBeforeReady("zoom",e)||this.setStateCamera(this._zoomToCamera(e),{applyConstraints:!0})||kh.error("#zoom=","Invalid zoom",e)}get maximumPixelRatio(){if(b(this._maximumPixelRatioOverride))return this._maximumPixelRatioOverride;let e=1/0;const{maximumPixelRatio:t,maximumRenderResolution:r}=this.view.qualitySettings;if(t!=null&&(e=Math.min(e,t)),r!=null){const i=r/Math.max(this.view.width,this.view.height);e=Math.min(e,i)}return e}get _devicePixelRatio(){return R(this._devicePixelRatioOverride)?Math.min(this._windowDevicePixelRatio,this.maximumPixelRatio):this._devicePixelRatioOverride}initialize(){this.handles.add([rs(()=>this.view.state.events,"before-camera-change",e=>this._updateElevation(e.camera))]),te(()=>this.view.state.camera,e=>this._updateElevation(e),{once:!0,sync:!0}),this.handles.add(rT({prepare:()=>this._prepareFrame()})),this.handles.add(te(()=>this.view.state.cameraController,()=>{this.cameraSetByUser=!0,this.handles.remove(MF)})),this.handles.add(rs(()=>this.view.state.events,"camera-projection-changed",()=>this.notifyChange("scale")))}destroy(){this.deinit(),this.handles&&(this.handles.destroy(),this.handles=null),this.propertiesPool&&(this.propertiesPool.destroy(),this.propertiesPool=null)}init(){this.constraintsManager=new g3({view:this.view}),this._prepareFrame();const e=this._getInitialProperties();this.cameraSetByUser=!1,this._set("ready",!0);for(const t of e)this.set(t.name,t.value);if(!this.cameraSetByUser){const t=this.view.get("map.initialViewProperties.viewpoint")||this.view.initialExtent;t&&this.isCompatible(t)?this._setInitialView(t):this.view.state.viewingMode===Be.Local&&this.handles.add(Lo(()=>this.view.basemapTerrain.ready,()=>{this.handles.remove(MF),this._setInitialView(this.view.dataExtent)},{once:!0,initial:!0}),MF)}}deinit(){this._cancelGoToOperation(),this.ready&&(this._override("padding",this.padding),this._set("ready",!1),this._clearOverride("hasInitialView"),this.cameraSetByUser=!1,this.handles.remove(MF),this.constraintsManager&&(this.constraintsManager.destroy(),this.constraintsManager=null))}async goTo(e,t){const r={animate:!0,...t};return b(this.gotoOperation)&&this.gotoOperation.abort(r.animate),this.gotoOperation=new Owt(e,r,this.view),this.view.resourceController.scheduler.stopFrame(),this.gotoOperation}debugSetCameraOnContent(){this.setStateCamera(nS(this.view),{applyConstraints:!1})}step(e){const t=this.view.state,r=t&&this.view.state.cameraController;r&&(t.updateCamera(i=>{r.stepController(e,i)}),r.steppingFinished&&r.finishController())}_cancelGoToOperation(){b(this.gotoOperation)&&(this.gotoOperation.abort(),this.gotoOperation=null)}_getInitialProperties(){const e=new Set,t=[];for(const{propertyName:r,overrides:i}of Iwt){const s=e.has(r),n=this._isOverridden(r);!s&&n&&t.push({name:r,value:this._get(r)}),this._clearOverride(r),(s||n)&&i.forEach(o=>e.add(o))}return t}_setInitialView(e){if(R(e)||this.cameraSetByUser)return;if(e instanceof ou)return void this.setStateCamera(wy(this.view,e),{applyConstraints:!1});if(e instanceof Vd){if(e.targetGeometry instanceof Kt){const s=fP(this.view,e.targetGeometry,0,.5,ia.LOCKED);return void(b(s)&&this.setStateCamera(wy(this.view,s),{applyConstraints:!0}))}const r={applyConstraints:!e.camera},i=this._viewpointToCamera(e);return void this.setStateCamera(i,r)}const t=fP(this.view,e,0,.5,ia.LOCKED);b(t)&&this.setStateCamera(wy(this.view,t),{applyConstraints:!0})}_updatePropertyBeforeReady(e,t){return!this.ready&&(this._override(e,t),t&&Pwt.includes(e)&&this._override("hasInitialView",!0),!0)}isCompatible(e){return!R(e)&&(e instanceof Vd?e.camera?this.isCompatible(e.camera):this.isCompatible(e.targetGeometry):e instanceof ou?this.isCompatible(e.position):e.spatialReference&&l1(e.spatialReference,this.view.spatialReference))}_getPreservingHeadingTilt(e=$wt){return this.cameraSetByUser?(e.heading=this.camera.heading,e.tilt=this.camera.tilt):(e.heading=0,e.tilt=.5),e}_centerPointAtDistanceToCamera(e,t,r=dv){const{heading:i,tilt:s}=this._getPreservingHeadingTilt(),n=s$(this.view,i,s,e,t,ia.ADJUST);return R(n)?null:(r.copyFrom(this.view.state.camera),r.eye=n.eye,r.center=n.center,r.up=n.up,r)}_centerToCamera(e){const t=this.view.pointsOfInterest.centerOnContent;t.runTask();const r=t.distance;return this._centerPointAtDistanceToCamera(e,r)}_extentToCamera(e){const{heading:t,tilt:r}=this._getPreservingHeadingTilt(),i=fP(this.view,e,t,r,ia.ADJUST,Lwt);return b(i)?wy(this.view,i):null}_scaleToCamera(e){if(e==null)return null;const t=this.view.pointsOfInterest.centerOnContent;t.runTask();const r=t.renderLocation,i=t.location.latitude,s=Kie(this.view,e,i);return this._centerPointAtDistanceToCamera(r,s)}_zoomToCamera(e){return this._scaleToCamera(zMe(this.view,e))}_viewpointToCamera(e){return wy(this.view,r$e(this.view,e))}setStateCamera(e,t){return!(R(e)||!this.view.state.stopActiveCameraController())&&(this.cameraSetByUser=!0,t.doNotCancelGoToOperation||this._cancelGoToOperation(),this.view.state.updateCamera(r=>{t.positionAndOrientationOnly?(r.eye=e.eye,r.center=e.center,r.up=e.up):r.copyFrom(e),t.applyConstraints&&Ts(this.view,r)}),t.applyConstraints||(this.view.state.cameraController=new qE({view:this.view,desiredCamera:e})),!0)}_prepareFrame(){const{surface:e,canvas:t}=this.view;if(!e||!t)return;this._windowDevicePixelRatio=window.devicePixelRatio;const r=this._devicePixelRatio,i=Math.round(e.clientWidth*r),s=Math.round(e.clientHeight*r);if(i!==0&&s!==0&&(t.width===i&&t.height===s||(t.width=i,t.height=s),this.view.state)){const n=this.view.state.camera;n.fullWidth===i&&n.fullHeight===s&&n.pixelRatio===r||(dv.copyFrom(n),dv.pixelRatio!==r&&(this._paddingToArray(this.padding,r,OF),dv.padding=OF),dv.fullWidth=i,dv.fullHeight=s,dv.pixelRatio=r,this.view.state.camera=dv)}}_updateElevation(e){const t=this.view.basemapTerrain&&this.view.basemapTerrain.spatialReference,r=this.view.renderCoordsHelper.getAltitude(e.eye),i=t?TB(this.view,e.eye):0;e.relativeElevation=r-i}};u([d({type:ou,dependsOn:["view.state.camera","ready"]})],Mn.prototype,"camera",null),u([d({type:ou,dependsOn:["view.state.contentCamera","ready"]})],Mn.prototype,"contentCamera",null),u([d({type:at})],Mn.prototype,"center",null),u([d({type:Kt})],Mn.prototype,"extent",null),u([d({readOnly:!0})],Mn.prototype,"frustum",null),u([d({readOnly:!0})],Mn.prototype,"hasInitialView",null),u([d({readOnly:!0,type:Boolean})],Mn.prototype,"ready",void 0),u([d({type:Number})],Mn.prototype,"scale",null),u([d()],Mn.prototype,"padding",null),u([d({readOnly:!0})],Mn.prototype,"screenCenter",null),u([d({constructOnly:!0})],Mn.prototype,"view",void 0),u([d({type:Vd})],Mn.prototype,"viewpoint",null),u([d({type:Number})],Mn.prototype,"zoom",null),u([d()],Mn.prototype,"maximumPixelRatio",null),u([d()],Mn.prototype,"_devicePixelRatio",null),u([d()],Mn.prototype,"_windowDevicePixelRatio",void 0),u([d()],Mn.prototype,"_devicePixelRatioOverride",void 0),u([d()],Mn.prototype,"_maximumPixelRatioOverride",void 0),Mn=u([$("esri.views.3d.state.ViewStateManager")],Mn);const Mwt=Mn,Pwt=["camera","viewpoint","extent","scale","center","zoom"],Iwt=[{propertyName:"camera",overrides:["viewpoint"]},{propertyName:"viewpoint",overrides:["extent"]},{propertyName:"extent",overrides:["center","scale"]},{propertyName:"center",overrides:[]},{propertyName:"scale",overrides:["zoom"]},{propertyName:"zoom",overrides:[]},{propertyName:"padding",overrides:[]}],$wt={heading:0,tilt:0},Lwt=new ou,dv=new ii,OF=Zt(),MF="pending-initial-view";class Dwt{constructor(t,r,i){this.viewingMode=t,this._forEachLayer=r,this.view=i,this.externalIntersectionHandlers=new Xt,this.tolerance=NA,this.tmpRay=Ro(),this.tmpRegion=Ut(),this.validateHUDIntersector=qd(this.viewingMode),this.validateHUDIntersector.options.hud=!1}intersectScreen(t,r,i){return this.intersectRay(this._getPickRay(t,this.tmpRay),Jme(this.viewingMode),r,i)}intersectScreenFreePointFallback(t,r,i){return this.intersectRayFreePointFallback(this._getPickRay(t,this.tmpRay),r,i)}intersectRayFreePointFallback(t,r,i){return this.intersectRay(t,Jme(this.viewingMode),r,i)||this._intersectRayFreePointLocal(t,r)}intersectRay(t,r,i,s){return r.options.selectionMode=!1,r.options.store=$o.MIN,this.computeIntersection(t,r,s),!!r.results.min&&r.results.min.getIntersectionPoint(i)}getCenterRayWithSubpixelOffset(t,r,i=.5,s=.5){return t.getRenderCenter($F,i,s),$F[0]+=.0466,$F[1]-=.0123,qie(t,$F,r)}intersectIntersectorScreen(t,r,i){this.computeIntersection(this._getPickRay(t,this.tmpRay),r,i)}intersectToolIntersectorScreen(t,r,i){const s=this._getPickRay(t,this.tmpRay);this.intersectToolIntersectorRay(s,r,i)}intersectToolIntersectorRay(t,r,i){r.options.selectionMode=!0,this.computeIntersection(t,r,i);const s=r.results.min;!!this.view.basemapTerrain&&this.view.basemapTerrain.opaque||xg(s)&&s.intersector!==qi.TERRAIN||(r.options.selectionMode=!1,this.computeIntersection(t,r,i))}setTolerance(t=NA){this.tolerance=t}addIntersectionHandler(t){this.externalIntersectionHandlers.push(t),this.externalIntersectionHandlers.sort((r,i)=>r.type===qi.TERRAIN?1:i.type===qi.TERRAIN?-1:0)}removeIntersectionHandler(t){this.externalIntersectionHandlers.removeUnordered(t)!=null&&this.externalIntersectionHandlers.sort((r,i)=>r.type===qi.TERRAIN?1:i.type===qi.TERRAIN?-1:0)}_getPickRay(t,r){const i=this.view.state.camera;return cMe(i,t,r)}_intersectRayFreePointLocal(t,r){if(this.viewingMode!==Be.Local||R(t))return!1;const i=this.view.renderDataExtent;if(R(i))return de(r,t.origin,we(He.get(),t.direction)),!0;const s={x:i.xmax-i.xmin,y:i.ymax-i.ymin,z:8*Math.max(i.xmax-i.xmin,i.ymax-i.ymin)},n=Math.max(s.x,s.y,s.z);if(n===0)return de(r,t.origin,we(He.get(),t.direction)),!0;const o=this.view.state.camera,a=Math.max(0,i.xmin-o.eye[0],o.eye[0]-i.xmax),l=Math.max(0,i.ymin-o.eye[1],o.eye[1]-i.ymax),c=Math.sqrt(a*a+l*l),h=Math.abs(o.relativeElevation)+Number.MIN_VALUE,p=Math.max(0,Math.log(n/h))**2;let f=n/Math.max(1,p);f=Math.max(f,Math.min(c,n));const m=le(He.get(),t.direction,f/Re(t.direction));return de(r,t.origin,m),!0}intersectElevationFromScreen(t,r,i=0,s=null){return this._intersectElevation(this._getPickRay(t,this.tmpRay),r,i,s)}_intersectElevation(t,r,i=0,s=null){if(R(t))return null;const n=b(r)?r.mode:"absolute-height",o=b(r)?_t(r.offset,0):0,a=n!=="on-the-ground"?o+i:0,l=a/this.view.renderCoordsHelper.unitInMeters;if(n==="absolute-height"){if(this.view.renderCoordsHelper.intersectInfiniteManifold(t,a,IF)){const T=this.view.computeMapPointFromVec3d(IF);return T.z-=o,T}return null}const c=this.view.state.camera,h=He.get();c.projectToRenderScreen(t.origin,h);const p=new Kme(null,this._forEachLayer),f=this.view.slicePlane,m=b(f)?Wde(f):null,g=qd(this.viewingMode);g.options.store=$o.MIN,g.options.verticalOffset=l;const v=t.origin,w=de(He.get(),v,t.direction);g.reset(v,w,c),g.point=h;const _=b(s)?"type"in s&&s.type==="graphics"?T=>T.metadata.layerUid!==s.uid:T=>T.metadata.graphicUid!==s.uid:null;switch(n){case"relative-to-scene":{const T=x=>(R(_)||_(x))&&x.metadata&&x.metadata.isElevationSource;g.intersect(p.layers,h,this.tolerance,null,T),this.externalIntersectionHandlers.forAll(x=>{if(x.type===qi.I3S||x.type===qi.TERRAIN){const E=x.slicePlaneEnabled?m:null;x.intersect(g,E,g.rayBegin,g.rayEnd,h)}})}break;case"on-the-ground":case"relative-to-ground":this.externalIntersectionHandlers.forAll(T=>{if(T.isGround){const x=T.slicePlaneEnabled?m:null;T.intersect(g,x,g.rayBegin,g.rayEnd,h)}})}if(g.results.min.getIntersectionPoint(IF)){const T=this.view.computeMapPointFromVec3d(IF);return T.z=i,T}return null}computeIntersection(t,r,i){if(R(t))return;const s=this.view.state.camera,n=He.get();s.projectToRenderScreen(t.origin,n);const o=new Kme(i,this._forEachLayer);r.options.selectOpaqueTerrainOnly=!i||!("include"in i||"exclude"in i);const a=t.origin,l=de(He.get(),t.origin,t.direction);r.reset(a,l,s),r.intersect(o.layers,n,this.tolerance);const c=this.view.slicePlane,h=b(c)?Wde(c):null;r.intersect(o.sliceableLayers,n,this.tolerance,h);const p=i&&(i.requiresGroundFeedback||i.enableDraped);this.externalIntersectionHandlers.forAll(m=>{if(r.options.isFiltered=!o.filterLayerUid(m.layerUid),m.isGround&&p||!r.options.isFiltered){const g=m.slicePlaneEnabled?h:null;m.intersect(r,g,a,l,n)}});const f=He.get();if(i&&i.enableDraped&&r.results.ground.getIntersectionPoint(f)){const m=this.view.basemapTerrain,g=m.overlayManager.renderer,v=this.view.renderCoordsHelper.spatialReference,w=He.get();this.view.renderCoordsHelper.fromRenderCoords(f,w,m.spatialReference),w[2]=_t(this.view.elevationProvider.getElevation(f[0],f[1],f[2],v,"ground"),0),g.intersect(r,w,r.results.ground,_=>o.filterRenderGeometry(_))}r.sortResults(),this._processHUDResults(r)}_processHUDResults(t){const r=t.results.hud;h0(this.tmpRegion,jW);const i=this.view.state.camera,s=[],n=this.tmpRegion,o=_=>{const T=new Fwt(_);i.projectToRenderScreen(_.target.center,T.screenPoint),T.screenPoint[0]=Math.floor(T.screenPoint[0]),T.screenPoint[1]=Math.floor(T.screenPoint[1]),s.push(T),cC(n,T.screenPoint)};t.sortResults(r.all),b(r.min.dist)&&o(r.min);for(const _ of r.all)r.min.target.object!==_.target.object&&r.max.target.object!==_.target.object&&o(_);if(b(r.max.dist)&&r.max.target.object!==r.min.target.object&&o(r.max),!s.length)return;n[0]===n[2]&&(n[2]+=1),n[1]===n[3]&&(n[3]+=1);const a=i.fullWidth,l=i.fullHeight,c=Math.max(0,n[0]-y3),h=Math.max(0,n[1]-y3),p=Math.min(Ju(n)+2*y3,a-c),f=Math.min(xf(n)+2*y3,l-h),m=new Uint8Array(p*f*4);this.view._stage.renderView.readHUDVisibility(c,h,p,f,m);let g=!0;const v=R(t.results.max.dist);let w=0;for(const _ of s)for(const T of Nwt)if(m[4*(Math.min(_.screenPoint[0]+T[0],a)-n[0]+(Math.min(_.screenPoint[1]+T[1],l)-n[1])*p)]){g&&(t.results.min.copy(_.result),g=!1),v&&t.results.max.copy(_.result),t.options.store===$o.ALL&&t.results.all.splice(w++,0,_.result);break}}}const y3=1,Nwt=(()=>{const e=[],t=y3;for(let r=-t;r<=t;r++)for(let i=-t;i<=t;i++)e.push([i+t,r+t]);return e})();class Fwt{constructor(t){this.result=t,this.screenPoint=ea()}}let PF;function Jme(e){return PF&&PF.viewingMode===e||(PF=qd(e)),PF}class Kme{constructor(t,r){this.layers=new Array,this.sliceableLayers=new Array,this.include=t==null?void 0:t.include,this.exclude=t==null?void 0:t.exclude,r(i=>{i.isPickable&&this.filterLayerUid(i.apiLayerUid)&&(i.isSliceable?this.sliceableLayers:this.layers).push(i)})}filterLayerUid(t){const{include:r,exclude:i}=this;return R(t)?r==null&&i==null:(r==null||r.has(t))&&(i==null||!i.has(t))}filterRenderGeometry(t){return this.filterLayerUid(t.layerUid)}}function ege(e){return typeof e=="object"&&"intersect"in e}const IF=M(),$F=ea();class ADt{constructor(t,r){this.spatialReference=t,this.view=r}getElevation(t,r,i){return this.view.elevationProvider.getElevation(t,r,0,this.spatialReference,i)}async queryElevation(t,r,i,s,n){return this.view.elevationProvider.queryElevation(t,r,0,this.spatialReference,n,i,s)}}class kwt{constructor(t,r,i,s){this.spatialReference=r,this._getElevationQueryProvider=i,this._queries=new Array,this._queryOptions={...s,ignoreInvisibleLayers:!0},this._frameTask=t.registerTask(vt.ELEVATION_QUERY,this)}destroy(){this._frameTask.remove()}queryElevation(t,r,i,s=0){return new Promise((n,o)=>{const a={x:t,y:r,minDemResolution:s,result:{resolve:n,reject:o},signal:i};this._queries.push(a),Ia(i,()=>{MK(this._queries,a),o(gr())})})}get running(){return this._queries.length>0}runTask(){const t=this._queries;this._queries=[];const r=this._getElevationQueryProvider();if(!r)return void t.forEach(c=>c.result.reject());const i=t.map(c=>[c.x,c.y]),s=t.reduce((c,h)=>Math.min(c,h.minDemResolution),1/0),n=new GT({points:i,spatialReference:this.spatialReference}),o=t.length>1&&t.some(c=>!!c.signal)?new AbortController:null,a=b(o)?o.signal:t[0].signal;if(b(o)){let c=0;t.forEach(h=>Ia(h.signal,()=>{c++,h.result.reject(gr()),c===t.length&&o.abort()}))}const l={...this._queryOptions,minDemResolution:s,signal:a};r.queryElevation(n,l).then(c=>{t.forEach((h,p)=>{b(h.signal)&&h.signal.aborted?h.result.reject(gr()):h.result.resolve(c.geometry.points[p][2])})}).catch(c=>{t.forEach(h=>h.result.reject(c))})}get test(){const t=this;return{update:()=>t._queries.length>0&&t.runTask()}}}let v3=class extends ds.EventedMixin(xe){constructor(e){super(e),this.im=new Array,this.ground=new Array,this.scene=new Array,this.handles=new Map,this.lastElevationQuery=null,this.elevationCacheEnabled=!1}destroy(){this._elevationQuery=ct(this._elevationQuery)}get elevationQuery(){return R(this._elevationQuery)&&(this._elevationQuery=new kwt(this.view.resourceController.scheduler,this.view.spatialReference,()=>this.view.map&&this.view.map.ground,{maximumAutoTileRequests:4})),this._elevationQuery}enableElevationCache(e){e||(this.lastElevationQuery=null),this.elevationCacheEnabled=e}getElevation(e,t,r,i,s){if(this.elevationCacheEnabled&&this.lastElevationQuery!=null){const o=this.lastElevationQuery;if(e===o.x&&t===o.y&&r===o.z&&i.equals(o.spatialReference)&&s===o.queryContext)return o.result}let n=null;return n=LF(n,this.im,e,t,r,i,s),R(n)&&(n=LF(n,this.ground,e,t,r,i,s)),s==="scene"&&(n=LF(n,this.scene,e,t,r,i,s)),this.elevationCacheEnabled&&(this.lastElevationQuery={x:e,y:t,z:r,spatialReference:i,queryContext:s,result:n}),n}queryElevation(e,t,r,i,s,n=null,o=0){const a=vf();return this.elevationQuery.queryElevation(e,t,n,o).then(l=>{s==="scene"&&(l=LF(l,this.scene,e,t,r,i,s)),a.resolve(l)}).catch(l=>{Vi(l)?a.reject(l):a.resolve(this.getElevation(e,t,r,i,s))}),a.promise}register(e,t){this.handles.set(t,t.on("elevation-change",r=>this.emit("elevation-change",r))),this[e].push(t)}unregister(e){this.handles.has(e)&&(this.handles.get(e).remove(),this.handles.delete(e));for(const t of[this.im,this.ground,this.scene]){const r=t.indexOf(e);r>-1&&t.splice(r,1)}}};function LF(e,t,r,i,s,n,o){for(const a of t){const l=a.getElevation(r,i,s,n,o);b(l)&&(e=b(e)?Math.max(l,e):l)}return e}u([d({constructOnly:!0})],v3.prototype,"view",void 0),u([d({readOnly:!0,aliasOf:"view.basemapTerrain.spatialReference"})],v3.prototype,"spatialReference",void 0),v3=u([$("esri.views.3d.support.CombinedElevationProvider")],v3);class Y_{static isValidProfile(t){return t in Y_.profiles}static getDefaultProfile(){return he("trident")||he("esri-iPhone")?"low":"medium"}static apply(t,r){const i=Y_.profiles[t];r.graphics3D.maxTotalNumberOfFeatures=i.graphics3D.maxTotalNumberOfFeatures,r.graphics3D.maxTotalNumberOfPrimitives=i.graphics3D.maxTotalNumberOfPrimitives,r.graphics3D.polygonLodFactor=i.graphics3D.polygonLodFactor,r.graphics3D.polylineLodFactor=i.graphics3D.polylineLodFactor,r.graphics3D.snapshotAvailable=i.graphics3D.snapshotAvailable;{const s=r.sceneService["3dObject"],n=i.sceneService["3dObject"];s.lodFactor=n.lodFactor,s.lodCrossfadeinDuration=n.lodCrossfadeinDuration,s.lodCrossfadeoutDuration=n.lodCrossfadeoutDuration,s.lodCrossfadeUncoveredDuration=n.lodCrossfadeUncoveredDuration}r.sceneService.point.lodFactor=i.sceneService.point.lodFactor,r.sceneService.integratedMesh.lodFactor=i.sceneService.integratedMesh.lodFactor,r.sceneService.pointCloud.lodFactor=i.sceneService.pointCloud.lodFactor,r.sceneService.uncompressedTextureDownsamplingEnabled=i.sceneService.uncompressedTextureDownsamplingEnabled,r.tiledSurface.lodBias=i.tiledSurface.lodBias,r.tiledSurface.angledSplitBias=i.tiledSurface.angledSplitBias,r.tiledSurface.reduceTileLevelDifferences=i.tiledSurface.reduceTileLevelDifferences,r.tiledSurface.textureFadeDuration=i.tiledSurface.textureFadeDuration,r.heatmap.pixelRatio=i.heatmap.pixelRatio,r.heatmap.maxTotalNumberOfFeatures=i.heatmap.maxTotalNumberOfFeatures,r.antialiasingEnabled=i.antialiasingEnabled,r.physicallyBasedRenderingEnabled=i.physicalBasedRenderingEnabled,r.highQualityTransparency=i.highQualityTransparency,r.memoryLimit=i.memoryLimit,r.additionalCacheMemory=i.additionalCacheMemory,r.frameRate=i.frameRate,r.maximumRenderResolution=i.maximumRenderResolution,r.maximumPixelRatio=i.maximumPixelRatio}}function tge(){const e=!!he("esri-mobile"),t=!!he("ios");return{low:{graphics3D:{maxTotalNumberOfFeatures:25e3,maxTotalNumberOfPrimitives:85e4,polygonLodFactor:.5,polylineLodFactor:1,snapshotAvailable:!1},heatmap:{pixelRatio:.125,maxTotalNumberOfFeatures:25e3},sceneService:{"3dObject":{lodFactor:.2,lodCrossfadeinDuration:0,lodCrossfadeoutDuration:0,lodCrossfadeUncoveredDuration:0},point:{lodFactor:1},integratedMesh:{lodFactor:.6},pointCloud:{lodFactor:.5},uncompressedTextureDownsamplingEnabled:!0},tiledSurface:{lodBias:-1,angledSplitBias:.5,reduceTileLevelDifferences:!1,textureFadeDuration:0},antialiasingEnabled:!1,physicalBasedRenderingEnabled:!1,highQualityTransparency:!1,memoryLimit:200,additionalCacheMemory:0,frameRate:0,maximumRenderResolution:null,maximumPixelRatio:1},medium:{graphics3D:{maxTotalNumberOfFeatures:5e4,maxTotalNumberOfPrimitives:17e5,polygonLodFactor:e?.8:1,polylineLodFactor:e?1.2:1.5,snapshotAvailable:!t},heatmap:{pixelRatio:.25,maxTotalNumberOfFeatures:5e4},sceneService:{"3dObject":{lodFactor:1,lodCrossfadeinDuration:0,lodCrossfadeoutDuration:0,lodCrossfadeUncoveredDuration:400},point:{lodFactor:1},integratedMesh:{lodFactor:1},pointCloud:{lodFactor:1},uncompressedTextureDownsamplingEnabled:e},tiledSurface:{lodBias:0,angledSplitBias:1,reduceTileLevelDifferences:!he("disable-feature:reduce-map-tile-levels"),textureFadeDuration:400},antialiasingEnabled:!0,physicalBasedRenderingEnabled:!0,highQualityTransparency:!0,memoryLimit:e?600:750,additionalCacheMemory:e?0:150,frameRate:0,maximumRenderResolution:null,maximumPixelRatio:1},high:{graphics3D:{maxTotalNumberOfFeatures:5e4,maxTotalNumberOfPrimitives:17e5,polygonLodFactor:e?1.2:2,polylineLodFactor:e?1.2:2,snapshotAvailable:!t},heatmap:{pixelRatio:.5,maxTotalNumberOfFeatures:5e4},sceneService:{"3dObject":{lodFactor:1,lodCrossfadeinDuration:0,lodCrossfadeoutDuration:0,lodCrossfadeUncoveredDuration:400},point:{lodFactor:1},integratedMesh:{lodFactor:1},pointCloud:{lodFactor:1},uncompressedTextureDownsamplingEnabled:!1},tiledSurface:{lodBias:0,angledSplitBias:1,reduceTileLevelDifferences:!he("disable-feature:reduce-map-tile-levels"),textureFadeDuration:400},antialiasingEnabled:!0,physicalBasedRenderingEnabled:!0,highQualityTransparency:!0,memoryLimit:e?900:1500,additionalCacheMemory:0,frameRate:0,maximumRenderResolution:e?null:4096,maximumPixelRatio:e?1:null}}}Y_.debug={reset(){const e=tge();for(const t in e)Y_.profiles[t]=e[t]}},function(e){e.profiles=tge()}(Y_||(Y_={}));const hk=Y_;function Hse(){return new Float32Array(4)}function Uwt(e){const t=new Float32Array(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function Xd(e,t,r,i){const s=new Float32Array(4);return s[0]=e,s[1]=t,s[2]=r,s[3]=i,s}function Vwt(e,t){return new Float32Array(e,t,4)}function n$e(){return Hse()}function o$e(){return Xd(1,1,1,1)}function a$e(){return Xd(1,0,0,0)}function l$e(){return Xd(0,1,0,0)}function c$e(){return Xd(0,0,1,0)}function u$e(){return Xd(0,0,0,1)}const zwt=n$e(),Bwt=o$e(),Gwt=a$e(),jwt=l$e(),Hwt=c$e(),qwt=u$e();Object.freeze(Object.defineProperty({__proto__:null,create:Hse,clone:Uwt,fromValues:Xd,createView:Vwt,zeros:n$e,ones:o$e,unitX:a$e,unitY:l$e,unitZ:c$e,unitW:u$e,ZEROS:zwt,ONES:Bwt,UNIT_X:Gwt,UNIT_Y:jwt,UNIT_Z:Hwt,UNIT_W:qwt},Symbol.toStringTag,{value:"Module"}));let dm=class extends xe{constructor(){super(...arguments),this.color=new Me([0,255,255]),this.haloColor=null,this.haloOpacity=1,this.fillOpacity=.25,this.shadowOpacity=.4,this.shadowColor=new Me([0,0,0]),this.shadowDifference=.2}static toEngineOptions(e){const t=Me.toUnitRGBA(e.color),r=b(e.haloColor)?Me.toUnitRGBA(e.haloColor):t,i=Me.toUnitRGBA(e.shadowColor);return{color:Xd(t[0],t[1],t[2],t[3]),haloColor:Xd(r[0],r[1],r[2],r[3]),haloOpacity:e.haloOpacity,haloOpacityOccluded:.25*e.haloOpacity,fillOpacity:e.fillOpacity,fillOpacityOccluded:.25*e.fillOpacity,shadowOpacity:e.shadowOpacity,shadowColor:xr(i[0],i[1],i[2],i[3]),occludedShadowOpacity:e.shadowOpacity*(1-e.shadowDifference)}}};u([d({type:Me})],dm.prototype,"color",void 0),u([d({type:Me})],dm.prototype,"haloColor",void 0),u([d()],dm.prototype,"haloOpacity",void 0),u([d()],dm.prototype,"fillOpacity",void 0),u([d()],dm.prototype,"shadowOpacity",void 0),u([d({type:Me})],dm.prototype,"shadowColor",void 0),u([d()],dm.prototype,"shadowDifference",void 0),dm=u([$("esri.views.3d.support.HighlightOptions")],dm);const XQ=dm;function Wwt(e,t,r){const i=gwe(t);return e.map(s=>{const n=i.fromJSON(s);return n.spatialReference=r,n})}let $w=class extends ye{constructor(e){super(e),this.geometries=null,this.outSpatialReference=null,this.transformation=null,this.transformForward=null}toJSON(){const e=this.geometries.map(i=>i.toJSON()),t=this.geometries[0],r={};return r.outSR=this.outSpatialReference.wkid||JSON.stringify(this.outSpatialReference.toJSON()),r.inSR=t.spatialReference.wkid||JSON.stringify(t.spatialReference.toJSON()),r.geometries=JSON.stringify({geometryType:aR(t),geometries:e}),this.transformation&&(r.transformation=this.transformation.wkid||JSON.stringify(this.transformation)),this.transformForward!=null&&(r.transformForward=this.transformForward),r}};u([d()],$w.prototype,"geometries",void 0),u([d({json:{read:{source:"outSR"}}})],$w.prototype,"outSpatialReference",void 0),u([d()],$w.prototype,"transformation",void 0),u([d()],$w.prototype,"transformForward",void 0),$w=u([$("esri.rest.support.ProjectParameters")],$w);const qse=$w,Xwt=en(qse);async function h$e(e,t,r){t=Xwt(t);const i=Y2e(e),s={...i.query,f:"json",...t.toJSON()},n=t.outSpatialReference,o=aR(t.geometries[0]),a=TXe(s,r);return er(i.path+"/project",a).then(({data:{geometries:l}})=>Wwt(l,o,n))}async function Wse(e=null,t){var s,n;if(Ur.geometryServiceUrl)return Ur.geometryServiceUrl;if(!e)throw new j("internal:geometry-service-url-not-configured");let r;r="portal"in e?e.portal||Sn.getDefault():e,await r.load({signal:t});const i=(n=(s=r.helperServices)==null?void 0:s.geometry)==null?void 0:n.url;if(!i)throw new j("internal:geometry-service-url-not-configured");return i}async function Zwt(e,t,r=null,i){const s=await Wse(r,i),n=new qse;n.geometries=[e],n.outSpatialReference=t;const o=await h$e(s,n,{signal:i});if(o&&Array.isArray(o)&&o.length===1)return o[0];throw new j("internal:geometry-service-projection-failed")}const Ywt=Object.freeze(Object.defineProperty({__proto__:null,getGeometryServiceURL:Wse,projectGeometry:Zwt},Symbol.toStringTag,{value:"Module"}));class Qwt{constructor(t,r){this.spatialReference=r,this.unitInMeters=uu(this.spatialReference,Ar(this.spatialReference).metersPerDegree),this._geometryServiceURLPromise=Wse(t&&t.get("portalItem")).catch(()=>{throw new j("mapcoordshelper:missing-geometry-service","Must specify geometryService in esri/config")})}async toGeographic(t){const r=await this._geometryServiceURLPromise;let i,s=!0;Array.isArray(t[0])&&typeof t[0]!="number"?i=t:(i=[t],s=!1);const n=i.map(l=>l instanceof at?l:new at(l,this.spatialReference)),o=new qse({geometries:n,outSpatialReference:Ze.WGS84}),a=(await h$e(r,o)).map(l=>l.type==="point"?[l.x,l.y]:void 0);return s?a:a[0]}}let Tm=class extends xe{constructor(){super(...arguments),this.minTotalNumberOfFeatures=2e3,this.maxTotalNumberOfFeatures=5e4,this.maxTotalNumberOfPrimitives=17e5,this.snapshotAvailable=!0,this.polygonLodFactor=1,this.polylineLodFactor=1}};u([d()],Tm.prototype,"minTotalNumberOfFeatures",void 0),u([d()],Tm.prototype,"maxTotalNumberOfFeatures",void 0),u([d()],Tm.prototype,"maxTotalNumberOfPrimitives",void 0),u([d()],Tm.prototype,"snapshotAvailable",void 0),u([d()],Tm.prototype,"polygonLodFactor",void 0),u([d()],Tm.prototype,"polylineLodFactor",void 0),Tm=u([$("esri.views.3d.support.QualitySettings.Graphics3DSettings")],Tm);let qm=class extends xe{constructor(){super(...arguments),this.lodFactor=1}};u([d()],qm.prototype,"lodFactor",void 0),qm=u([$("esri.views.3d.support.QualitySettings.LoDFactorSettings")],qm);let hz=class extends qm{constructor(){super(...arguments),this.lodCrossfadeinDuration=0,this.lodCrossfadeoutDuration=0,this.lodCrossfadeUncoveredDuration=0}};hz=u([$("esri.views.3d.support.QualitySettings.LoDFactor3DObjectSettings")],hz);let Ty=class extends xe{constructor(){super(...arguments),this["3dObject"]=new hz,this.point=new qm,this.integratedMesh=new qm,this.pointCloud=new qm,this.uncompressedTextureDownsamplingEnabled=!1}};u([d({type:hz})],Ty.prototype,"3dObject",void 0),u([d({type:qm})],Ty.prototype,"point",void 0),u([d({type:qm})],Ty.prototype,"integratedMesh",void 0),u([d({type:qm})],Ty.prototype,"pointCloud",void 0),u([d()],Ty.prototype,"uncompressedTextureDownsamplingEnabled",void 0),Ty=u([$("esri.views.3d.support.QualitySettings.SceneServiceSettings")],Ty);let __=class extends xe{constructor(){super(...arguments),this.lodBias=0,this.angledSplitBias=1,this.reduceTileLevelDifferences=!0,this.textureFadeDuration=500}};u([d()],__.prototype,"lodBias",void 0),u([d()],__.prototype,"angledSplitBias",void 0),u([d()],__.prototype,"reduceTileLevelDifferences",void 0),u([d()],__.prototype,"textureFadeDuration",void 0),__=u([$("esri.views.3d.support.QualitySettings.TiledSurfaceSettings")],__);let WE=class extends xe{constructor(){super(...arguments),this.pixelRatio=1,this.maxTotalNumberOfFeatures=5e4}};u([d()],WE.prototype,"pixelRatio",void 0),u([d()],WE.prototype,"maxTotalNumberOfFeatures",void 0),WE=u([$("esri.views.3d.support.QualitySettings.HeatmapSettings")],WE);let $l=class extends xe{constructor(){super(...arguments),this.graphics3D=new Tm,this.sceneService=new Ty,this.tiledSurface=new __,this.heatmap=new WE,this.antialiasingEnabled=!0,this.physicallyBasedRenderingEnabled=!1,this.highQualityTransparency=!0}};u([d({type:Tm})],$l.prototype,"graphics3D",void 0),u([d({type:Ty})],$l.prototype,"sceneService",void 0),u([d({type:__})],$l.prototype,"tiledSurface",void 0),u([d({type:WE})],$l.prototype,"heatmap",void 0),u([d()],$l.prototype,"antialiasingEnabled",void 0),u([d()],$l.prototype,"physicallyBasedRenderingEnabled",void 0),u([d()],$l.prototype,"highQualityTransparency",void 0),u([d()],$l.prototype,"memoryLimit",void 0),u([d()],$l.prototype,"additionalCacheMemory",void 0),u([d()],$l.prototype,"frameRate",void 0),u([d()],$l.prototype,"maximumRenderResolution",void 0),u([d()],$l.prototype,"maximumPixelRatio",void 0),$l=u([$("esri.views.3d.support.QualitySettings.QualitySettings")],$l);const rge=$l;class dz{constructor(t,r,i,s){this.viewingMode=t,this.spatialReference=r,this.unitInMeters=i,this.coordinateSystem=s,this._coordinateSystem=e7e(s)}set extent(t){t&&t7e(this.coordinateSystem,t,this.coordinateSystem)}getAltitude(t){return c7e(this.coordinateSystem,t)}setAltitude(t,r,i=t){return dSe(this.coordinateSystem,i,r,t)}setAltitudeOfTransformation(t,r){u7e(this.coordinateSystem,r,t,r)}worldUpAtPosition(t,r){return n7e(this.coordinateSystem,t,r)}worldBasisAtPosition(t,r,i){return o7e(this.coordinateSystem,t,r,i)}basisMatrixAtPosition(t,r){const i=this.worldBasisAtPosition(t,hh.X,He.get()),s=this.worldBasisAtPosition(t,hh.Y,He.get()),n=this.worldBasisAtPosition(t,hh.Z,He.get());return gg(r,i[0],i[1],i[2],0,s[0],s[1],s[2],0,n[0],n[1],n[2],0,0,0,0,1),r}intersectManifoldClosestSilhouette(t,r,i){return tG(this.coordinateSystem,r,this._coordinateSystem),l7e(this._coordinateSystem,t,i),i}intersectManifold(t,r,i){tG(this.coordinateSystem,r,this._coordinateSystem);const s=He.get();return a7e(this._coordinateSystem,t,s)?ae(i,s):null}intersectInfiniteManifold(t,r,i){if(this.viewingMode===Be.Global)return this.intersectManifold(t,r,i);tG(this.coordinateSystem,r,this._coordinateSystem);const s=this._coordinateSystem.value,n=He.get();return JT(s.plane,t,n)?ae(i,n):null}toRenderCoords(t,r,i){return zV(t)?so(t,r,this.spatialReference):xn(t,r,i,this.spatialReference)}fromRenderCoords(t,r,i=null){return zV(r)?(b(i)&&(r.spatialReference=i),cTe(t,this.spatialReference,r)):r instanceof Ze?O1(t,this.spatialReference,r):xn(t,this.spatialReference,r,i)?r:null}static create(t,r){switch(t){case Be.Local:return new dz(Be.Local,r,uu(r),s7e());case Be.Global:return new dz(Be.Global,r,1,i7e(r))}}static renderUnitScaleFactor(t,r){return ige(t)/ige(r)}}function ige(e){if(i$(e,Be.Global))return 1;const t=pSe(!1,e);return uu(t)}var Lm;(function(e){e[e.ELEVATION=0]="ELEVATION",e[e.BASEMAP=1]="BASEMAP",e[e.I3S_INDEX=2]="I3S_INDEX",e[e.I3S_DATA=3]="I3S_DATA",e[e.SYMBOLOGY=4]="SYMBOLOGY"})(Lm||(Lm={}));const Jwt=(()=>{const e=new Array;return e[Lm.ELEVATION]=10,e[Lm.BASEMAP]=10,e[Lm.I3S_INDEX]=10,e[Lm.I3S_DATA]=10,e[Lm.SYMBOLOGY]=5,e})(),Kwt=30;function d$e(e){return typeof e.getUsedMemory=="function"}const ext=fe.getLogger("esri.views.3d.support.MemoryController");function txt(e){return new Ll({view:e})}const DF=1,Uj=1,rxt=.75,ixt=.6,sge=1.3;let Ll=class extends xe{constructor(e){super(e),this._quality=1,this._memoryUsed=0,this._updating=!1,this.minQuality=.1,this._stableQuality=0,this._downscaleMemoryUsed=0,this._canFastRecover=!1,this._memoryPredicted=0,this._cacheStorage=new Wte,this._numQualityChanges=0,this._maxMemory=500,this._additionalCacheMemory=100}destroy(){this._cacheStorage.destroy()}set maxMemory(e){e==null||e<=0||(this._stableQuality=0,this._canFastRecover=!1,this._maxMemory<e&&this._updateQuality(DF),this._maxMemory=e)}get maxMemory(){return this._maxMemory}set additionalCacheMemory(e){e!=null&&e>=0&&(this._additionalCacheMemory=e)}get additionalCacheMemory(){return this._additionalCacheMemory}get memoryFactor(){return this._quality}get updating(){return this._updating}get usedMemory(){return this._memoryUsed}newCache(e,t){return new PWe(e,this._cacheStorage,t)}resetStableQuality(){this._stableQuality=0}disableMemCache(){this.additionalCacheMemory=-4096}update(){if(this._updateMemory(),this._memoryPredicted<=0&&!this._updating)return;let e=this._layersUpdating();if(this._memoryPredicted<ixt&&this._canFastRecover)this._downscaleMemoryUsed=0,this._stableQuality=0,this._canFastRecover=!1,this._updateQuality(DF);else if(e)(this._memoryPredicted>1.1*Uj||this._memoryUsed>Uj)&&(this._stableQuality>0?(this._downscaleMemoryUsed=0,this._updateQuality(this._stableQuality)):this._quality>this.minQuality&&this._downscaleMemoryUsed<this._memoryUsed&&(this._updateQuality(this._quality/sge),this._downscaleMemoryUsed=this._memoryUsed,this._canFastRecover=!1));else if(this._downscaleMemoryUsed=0,this._memoryUsed>Uj)this._stableQuality=0,this._canFastRecover=!1,e=this._updateQuality(this._quality/sge),this._downscaleMemoryUsed=this._memoryPredicted;else if(this._stableQuality!==this._quality)if(this._memoryUsed<rxt&&this._quality<DF){this._stableQuality=this._quality;const t=.05;e=this._updateQuality(this._quality+t)}else this._quality<1&&(this._canFastRecover=!0);this._updating=e}_updateQuality(e){return(e=Math.min(Math.max(e,this.minQuality),DF))!==this._quality&&(this._quality=e,++this._numQualityChanges,!0)}_layersUpdating(){return this.view.allLayerViews.some(e=>!!e.updating)}_updateMemory(){let e=0,t=0;this.view.basemapTerrain&&this.view.basemapTerrain.getUsedMemory&&(e+=this.view.basemapTerrain.getUsedMemory());const r=this.view._stage&&this.view._stage.renderView&&this.view._stage.renderView.edgeView;b(r)&&(e+=r.usedMemory),this.view.allLayerViews&&this.view.allLayerViews.forEach(o=>{if(d$e(o)){const a=o.ignoresMemoryFactor()?this._quality:1;e+=o.getUsedMemory()*a,t+=o.getUnloadedMemory()*a}});const i=this._warnMemoryUsage==null||Math.round(10*e)!==Math.round(10*this._warnMemoryUsage),s=1048576*this.maxMemory;if(e>s&&i){this._warnMemoryUsage=e;const o=l=>(l/1048576).toLocaleString(void 0,{maximumFractionDigits:1})+" MB",a=Math.round(100*this._quality);ext.warn(`Memory Limit exceeded! Limit: ${o(s)} Current: ${o(e)} Projected: ${o(e+t)} Quality: ${a}%`)}this._memoryUsed=e/s,this._memoryPredicted=(e+t)/s;const n=s-e;this._cacheStorage.maxSize=Math.max(0,n+1048576*this.additionalCacheMemory)}get test(){const e=this;return{cacheStorage:this._cacheStorage,resetQualityChanges:()=>{const t=e._numQualityChanges;return e._numQualityChanges=0,t}}}};u([d({constructOnly:!0})],Ll.prototype,"view",void 0),u([d()],Ll.prototype,"maxMemory",null),u([d()],Ll.prototype,"additionalCacheMemory",null),u([d()],Ll.prototype,"memoryFactor",null),u([d()],Ll.prototype,"updating",null),u([d()],Ll.prototype,"usedMemory",null),u([d()],Ll.prototype,"_quality",void 0),u([d()],Ll.prototype,"_memoryUsed",void 0),u([d()],Ll.prototype,"_updating",void 0),u([d()],Ll.prototype,"_stableQuality",void 0),u([d()],Ll.prototype,"_maxMemory",void 0),u([d()],Ll.prototype,"_additionalCacheMemory",void 0),Ll=u([$("esri.views.3d.support.MemoryController")],Ll);class sxt{constructor(t){this.client=t,this._cancelled=!1,this.size=0,this.duration=0}}class nxt{constructor(t){this.typeWorkerQuota=t,this.tasks=new Array,this.numWorkers=0,this.statistics=new oxt}}class oxt{constructor(){this.requests=0,this.size=0,this.duration=0,this.speed=0}}class axt{constructor(t,r,i,s){this._workerFunc=t,this._callbackFunc=r,this._maxTotalNumWorkers=i,this._totalNumWorkers=0,this._clients=s.map(n=>new nxt(n))}hasQuota(t){const r=this._clients[t];return!!r&&(this._totalNumWorkers<this._maxTotalNumWorkers||r.numWorkers+r.tasks.length<r.typeWorkerQuota)}push(t){const r=this._clients[t.client];r&&(this._totalNumWorkers<this._maxTotalNumWorkers?(r.numWorkers++,this._totalNumWorkers++,this._workerFunc(t,(i,s)=>this._taskCallback(i,s))):r.tasks.push(t))}cancel(t){this._taskFinished(t),t._cancelled=!0}destroy(){this._clients.length=0}_taskFinished(t){const r=this._clients[t.client];this._totalNumWorkers--,r.numWorkers--,r.statistics.requests++,r.statistics.size+=t.size||0,r.statistics.duration+=t.duration||0,r.statistics.speed=r.statistics.duration>0?r.statistics.size/r.statistics.duration:0,ft(r.numWorkers>=0),this._next()}_next(){for(const t of this._clients)if(t&&t.numWorkers<t.typeWorkerQuota&&this._processQueue(t))return;for(const t of this._clients)if(t&&this._processQueue(t))return}_processQueue(t){for(;t.tasks.length>0;)if(this._workerFunc(t.tasks.shift(),(r,i)=>this._taskCallback(r,i)))return t.numWorkers++,this._totalNumWorkers++,!0;return!1}_taskCallback(t,r){t._cancelled||(this._callbackFunc(t,r),this._taskFinished(t))}getStatsForType(t){const r=this._clients[t];return r?{quota:r.typeWorkerQuota,workers:r.numWorkers,queueSize:r.tasks.length,requestStats:r.statistics}:null}get test(){const t=this;return{set workerFunc(r){t._workerFunc=r}}}}let dk=class extends xe{constructor(){super(...arguments),this._tasks=new Map,this._onLoadQueue=new Array,this._doneQueue=new Array,this.updating=!1}setup(e,t,r){this._loadQueue=new axt((i,s)=>this._startLoading(i,s),(i,s)=>this._doneLoadingCB(i,s),e,t),r&&(this._frameTask=r.registerTask(vt.STREAM_DATA_LOADER,this))}destroy(){this._frameTask=wn(this._frameTask),this._tasks.forEach(e=>Fd(e.abortController)),this._loadQueue=ct(this._loadQueue),this._onLoadQueue=null,this._doneQueue=null,this._tasks=null}hasDownloadSlots(e){return this._loadQueue.hasQuota(e)}request(e,t,r,i={}){const s=vf();s.__signal=b(i)?i.signal:null;const n=this._createOrUpdateTask(e,t,r,i,s);return Ia(i,()=>this._cancelRequest(n,s)),s.promise}_createTask(e,t,r,i,s,n){const o=new uxt(e,t,r,i,s);return this._updateTask(o,n),this._tasks.set(s,o),this._tasks.size===1&&this._set("updating",!0),this._loadQueue.push(o),o}_cancelRequest(e,t){zz(e.resolvers,t),t.reject(gr()),e.resolvers.length===0&&(e.status===sd.DOWNLOADING&&(e.status=sd.CANCELLED,this._loadQueue.cancel(e),e.abortController.abort(),e.request=null,e.abortController=null),e.status=sd.CANCELLED,this._tasks.delete(e.key),this._tasks.size===0&&this._set("updating",!1))}_updateTask(e,t){e.resolvers.push(t)}_createOrUpdateTask(e,t,r,i,s){const n=hxt(b(i)&&i.uid||e,t,r),o=this._tasks.get(n);return o?(this._updateTask(o,s),o):this._createTask(e,i,t,r,n,s)}_doneLoadingCB(e,t){this._loadQueue&&(ft(e.status===sd.DOWNLOADING),e.status=sd.DOWNLOADED,this._frameTask?this._doneQueue.push({task:e,err:t}):this._doneLoading(e,t))}get running(){return this._doneQueue.length>0||this._onLoadQueue.length>0}runTask(e){for(;!e.done&&this._onLoadQueue.length>0;){const t=this._onLoadQueue.shift();Jt(t.task.abortController),t.task.abortController=null,t.callback(t.task),e.madeProgress()}for(;!e.done&&this._doneQueue.length>0;){const t=this._doneQueue.shift();t.task.status!==sd.DOWNLOADED&&(t.err=t.err||gr()),this._doneLoading(t.task,t.err),e.madeProgress()}}_doneLoading(e,t){if(t&&!Vi(t)&&e.numRetries>0)return--e.numRetries,void this._loadQueue.push(e);let r=e.result instanceof HTMLImageElement?0:e.resolvers.length;for(const i of e.resolvers)if(t)Vi(t)?i.reject(t):i.reject(new j("stream-data-loader:request-error",`Failed to request resource at '${e.url}'. ${t}`,{url:e.url,error:t}));else{--r;const s=r<=0?e.result:re(e.result);i.resolve(s)}this._tasks.delete(e.key),this._tasks.size===0&&this._set("updating",!1)}_startLoading(e,t){if(e.status===sd.CANCELLED)return!1;let r,i;switch(e.startTime=performance.now(),e.status=sd.DOWNLOADING,e.docType){case"binary":i="array-buffer",r=0;break;case"image":i="image";break;case"image+type":i="array-buffer";break;default:i="json"}e.abortController=new AbortController;const s=e.abortController.signal;e.request=er(e.url,{...e.options,responseType:i,timeout:r,signal:s});let n=()=>{};const o=l=>{e.duration=performance.now()-e.startTime,e.size=l instanceof ArrayBuffer?l.byteLength:e.size||0,e.result=l,this._frameTask?this._onLoadQueue.push({callback:t,task:e}):(e.abortController=null,t(e))},a=l=>{e.status===sd.DOWNLOADING&&t(e,l),n()};return e.docType!=="image+type"?(e.request.then(l=>o(l.data),a),!0):(e.request.then(l=>{const c=l.data,h=cxt(c);if(i="image",e.size=c.byteLength,h==="unknown")return e.request=er(e.url,{responseType:i,timeout:r,signal:s}),void e.request.then(m=>o(m.data),a);const p=new Blob([c],{type:h}),f=window.URL.createObjectURL(p);n=()=>window.URL.revokeObjectURL(f),e.request=er(f,{responseType:i,timeout:r,signal:s}),e.request.then(m=>o(new y8(m.data,h,n)),a)},a),!0)}get test(){return{loadQueue:this._loadQueue}}};u([d({readOnly:!0})],dk.prototype,"updating",void 0),dk=u([$("esri.views.3d.support.StreamDataLoader")],dk);const lxt={numRetries:0};function cxt(e){if(e.byteLength<2)return"unknown";const t=new Uint8Array(e,0,e.byteLength);return t[0]===137&&t[1]===80?"image/png":t[0]===71&&t[1]===73?"image/gif":t[0]===66&&t[1]===77?"image/bmp":t[0]===255&&t[1]===216?"image/jpeg":"unknown"}class y8{constructor(t,r,i){this.image=t,this.type=r,this.release=i}get isOpaque(){return this.type==="image/jpeg"}}class uxt extends sxt{constructor(t,r,i,s,n){super(s),this.url=t,this.options=r,this.docType=i,this.key=n,this.result=null,this.status=sd.QUEUED,this.request=null,this.abortController=null,this.resolvers=new Array,this.startTime=0,this.numRetries=lxt.numRetries}}function hxt(e,t,r){return`${e}:${t}:${r}`}var sd;(function(e){e[e.QUEUED=1]="QUEUED",e[e.DOWNLOADING=2]="DOWNLOADING",e[e.DOWNLOADED=3]="DOWNLOADED",e[e.CANCELLED=4]="CANCELLED"})(sd||(sd={}));let NF=class extends xe{constructor(){super(...arguments),this.updating=!1}};function dxt(e){return new ZQ.ResourceController({view:e})}var ZQ;u([d({readOnly:!0})],NF.prototype,"updating",void 0),NF=u([$("esri.views.3d.support.ResourceController")],NF),function(e){let t=class extends NF{constructor(){super(...arguments),this._scheduler=null,this._memoryController=null,this._streamDataLoader=null,this._scheduleTask=wA,this._cameraChangeTime=0,this._handles=new Dt,this._frameTask=null,this._state=Yn.IDLE}initialize(){this._cameraChangeTime=performance.now(),this._scheduler=kit(),this._memoryController=txt(this.view),this._streamDataLoader=new dk,this._streamDataLoader.setup(Kwt,Jwt,this._scheduler),this._handles.add([te(()=>{var i;return(i=this.view.state)==null?void 0:i.camera},(i,s)=>this._cameraChangedHandler(i,s),ei),te(()=>this.view.stationary,()=>this._stationaryChangedHandler())]),this._frameTask=rT({update:i=>this._frame(i)}),this._scheduleTask=this._scheduler.registerTask(vt.RESOURCE_CONTROLLER)}destroy(){this._handles=ct(this._handles),this._scheduleTask.remove(),this._frameTask=wn(this._frameTask),this._streamDataLoader=ct(this._streamDataLoader),this._memoryController=ct(this._memoryController),this._scheduler=ct(this._scheduler)}get updating(){var i,s,n;return!!(((i=this._memoryController)==null?void 0:i.updating)||((s=this._streamDataLoader)==null?void 0:s.updating)||((n=this._scheduleTask)==null?void 0:n.updating))}get scheduler(){return this._scheduler}get memoryController(){return this._memoryController}schedule(i,s,n){return this._scheduleTask.schedule(i,s,n)}createStreamDataRequester(i){const s=this._streamDataLoader;return{request:(n,o,a)=>s.request(n,o,i,a),get busy(){return!s.hasDownloadSlots(i)}}}_frame(i){this.view.suspended||this.view.stateManager&&(this.view.stateManager.step(kK(i.deltaTime)),!this._scheduler)||(this._updateState(),this._scheduler.state=this._state,this._scheduler.updateBudget(i)?(this._memoryController.update(),this._scheduler.frame()):this._memoryController.updating&&this._memoryController.update())}_cameraChangedHandler(i,s){i&&s&&i.almostEquals(s)||(this._cameraChangeTime=performance.now(),this._updateState(),this._scheduler.state=this._state)}_stationaryChangedHandler(){this.memoryController.resetStableQuality()}_updateState(){this.view.animation?this._state=Yn.ANIMATING:this.view.interacting?this._state=Yn.INTERACTING:(this._state===Yn.ANIMATING&&(this._cameraChangeTime=0),performance.now()-this._cameraChangeTime<=r?this._state=Yn.INTERACTING:this._state=Yn.IDLE)}get test(){return{getQueueStats:i=>this._streamDataLoader.test.loadQueue.getStatsForType(i),state:this._state}}};u([d({constructOnly:!0})],t.prototype,"view",void 0),u([d()],t.prototype,"_scheduler",void 0),u([d()],t.prototype,"_memoryController",void 0),u([d()],t.prototype,"_streamDataLoader",void 0),u([d()],t.prototype,"_scheduleTask",void 0),u([d({readOnly:!0})],t.prototype,"updating",null),t=u([$("esri.views.3d.support.ResourceController")],t),e.ResourceController=t;const r=300}(ZQ||(ZQ={}));function pxt(e){return"performanceInfo"in e}const XS=M(),fxt=M(),Fg=M(),kg=M();function mxt(e,t,r=0){const i=e.extent;if(R(i))return!1;if(r===0)return Jwe(i,t);const s=Math.min(i[2]-i[0],i[3]-i[1]);return mBe(i,t,r*s)}function FF(e,t,r,i){ae(XS,r),XS[i]=t[i];const s=pe(XS,XS,t),n=pe(fxt,e,t),o=Te(n,s),a=Te(s,s);let l;l=o<=0?t:a<=o?r:de(XS,t,le(s,s,o/a));const c=pe(XS,e,l);return Math.PI/2-Math.atan(c[2]/Math.sqrt(c[0]*c[0]+c[1]*c[1]))}function gxt(e,t,r){const i=e.extent;if(R(i))return 0;Fg[0]=i[0],Fg[1]=i[1],Fg[2]=r,kg[0]=i[2],kg[1]=i[3],kg[2]=r;let s=1/0,n=1/0;return t[0]<Fg[0]?s=FF(t,Fg,kg,0):t[0]>kg[0]&&(s=FF(t,kg,Fg,0)),t[1]<Fg[1]?n=FF(t,Fg,kg,1):t[1]>kg[1]&&(n=FF(t,kg,Fg,1)),Math.min(s,n)}function yxt(e,t,r){if(R(e))return eie();if(e.spatialReference.isGeographic&&!dT(e.spatialReference))return new j("tilingscheme:local-unsupported-spatial-reference","The tiling scheme spatial reference is not supported in local scenes");const i=Mi.checkUnsupported(e);if(b(i))return i;if(R(r))return new j("tilingscheme:extent-not-exist","The layer does not provide a layer extent.");const s=vxt(e,r);if(s)return s;const n=e.spatialReference;return b(t)&&!(n.equals(t)||t.isWGS84&&n.isWebMercator)?new j("tilingscheme:spatial-reference-mismatch","The tiling scheme does not match the spatial reference of the local scene"):null}function vxt(e,t){const r=e.lods,i=r[0].resolution*2**r[0].level,s=[i*e.size[0],i*e.size[1]],n=[e.origin.x,e.origin.y],o=Ywe(t),a=Ut();Mi.computeRowColExtent(o,s,n,a);const l=(a[2]-a[0])*(a[3]-a[1]);if(l>LE){const c=r[0].scale*2**r[0].level;let h=Math.max((o[3]-o[1])/e.size[1],(o[2]-o[0])/e.size[0])*c/i;const p=Math.floor(Math.log(h)/Math.log(10));return h=Math.ceil(h/10**p)*10**p,new j("tilingscheme:too-many-root-tiles","Scale of level 0 of the tiling scheme (1:"+Math.floor(c).toLocaleString()+") is too large for the layer's extent. Suggested scale: 1:"+h.toLocaleString()+".",{level0Scale:c,suggestedLevel0Scale:h,requiredNumRootTiles:l,allowedNumRootTiles:LE})}return null}const _xt=Object.freeze(Object.defineProperty({__proto__:null,isInsideExtent:mxt,tiltToExtentEdge:gxt,checkIfTileInfoSupportedForViewSR:yxt},Symbol.toStringTag,{value:"Module"}));function bxt(){return!0}function wxt(){return 0}function xxt(e,t){if(R(e))return eie();const r=e.lods.length-1,i=e.spatialReference,s=dT(i)||hg(i)||dg(i);if(i.isWebMercator){if(!Mi.makeWebMercatorAuxiliarySphere(r).compatibleWith(e))return new j("tilingscheme:incompatible-global-web-mercator","The tiling scheme is not compatible with the ArcGIS Online Web Mercator tiling scheme")}else{if(!s)return new j("tilingscheme:global-unsupported-spatial-reference","The tiling scheme spatial reference is not supported in global scenes");if(!Mi.makeGCSWithTileSize(e.spatialReference,e.size[0],r).compatibleWith(e))return e.spatialReference.isWGS84?new j("tilingscheme:incompatible-global-wgs84","The tiling scheme is not compatible with the ArcGIS Online WGS84 tiling scheme"):new j("tilingscheme:incompatible-global","The tiling scheme is not compatible with the ArcGIS Online tiling scheme")}return b(t)&&!e.spatialReference.equals(t)?new j("tilingscheme:spatial-reference-mismatch","The tiling scheme does not match the spatial reference of the global scene"):void 0}const Txt=Object.freeze(Object.defineProperty({__proto__:null,isInsideExtent:bxt,tiltToExtentEdge:wxt,checkIfTileInfoSupportedForViewSR:xxt},Symbol.toStringTag,{value:"Module"})),Sxt={[Be.Global]:Txt,[Be.Local]:_xt};function Am(e,t){e||console.warn("Terrain: "+t)}function YQ(e){return v8(e)?{fullExtent:e.fullExtent,minScale:e.layer.minScale,maxScale:e.layer.maxScale,tilemapCache:null}:e.layer}function pz(e){return(e==null?void 0:e.type)==="imagery-tile"||(e==null?void 0:e.type)==="wcs"}function v8(e){return(e==null?void 0:e.type)==="imagery-tile-3d"}function Xse(e){return(e==null?void 0:e.type)==="tile-3d"}function v$(e){return(e==null?void 0:e.type)==="vector-tile-3d"}function p$e(e){return(e==null?void 0:e.type)==="wmts-3d"}function QQ(e){return(e==null?void 0:e.type)==="elevation-3d"}function f$e(e){return(e==null?void 0:e.type)==="group"}function fz(e){return e&&(Xse(e)||p$e(e)||v8(e)||v$(e))}function JQ(e){return e&&(Xse(e)||v8(e)||v$(e)||p$e(e))}function _$(e){return JQ(e)||QQ(e)}function RDt(e){switch(e.type){case"building-scene":case"csv":case"feature":case"geo-rss":case"geojson":case"graphics":case"group":case"integrated-mesh":case"kml":case"line-of-sight":case"map-notes":case"ogc-feature":case"point-cloud":case"route":case"scene":case"stream":case"voxel":case"subtype-group":case"unknown":case"unsupported":case"wfs":case null:return!1;case"base-dynamic":case"base-elevation":case"base-tile":case"bing-maps":case"elevation":case"imagery":case"imagery-tile":case"map-image":case"media":case"open-street-map":case"tile":case"vector-tile":case"wcs":case"web-tile":case"wms":case"wmts":return!0;default:return e.type,!1}}function Ext(e){var r;const t=(r=e==null?void 0:e.sourceLayerInfo)==null?void 0:r.data;return b(t)&&"type"in t&&t.type==="raster-tile"}function Cxt(e){var r;const t=(r=e==null?void 0:e.sourceLayerInfo)==null?void 0:r.data;return b(t)&&"type"in t&&t.type==="vector-tile"}function Axt(e){var r;const t=(r=e==null?void 0:e.sourceLayerInfo)==null?void 0:r.data;return b(t)&&"type"in t&&t.type==="tile-texture"}function Rxt(e){var r;const t=(r=e==null?void 0:e.sourceLayerInfo)==null?void 0:r.data;return t instanceof HTMLImageElement||t instanceof y8||t instanceof HTMLCanvasElement||t instanceof ImageData}function wC(e){return b(e)&&"release"in e&&e.release(),null}function nge(e){return e.fetchTile&&e.hasOverriddenFetchTile!==!1}function b$(e,t,r,i){return Sxt[i].checkIfTileInfoSupportedForViewSR(e,r,t)}function _8(e,t,r){let i=null,s=null;if((e==null?void 0:e.type)==="wmts"){const n=m$e(e,t,r);i=n.tileInfo,s=n.fullExtent}else{s=pz(e)?e.getCompatibleFullExtent(t):e.fullExtent;const n=r===Be.Local;if(pz(e))i=e.getCompatibleTileInfo(t,s,n);else if((e==null?void 0:e.type)==="vector-tile"){const o=n&&!Oxt(t)||Mxt.force512VTL,a=e.tileInfo.spatialReference.isGeographic;i=o?e.tileInfo:e.tileInfo.getOrCreateCompatible(256,a?1:2)}else i=e.tileInfo}return b(i)&&b(s)&&b$(i,s,t,r)==null?{tileInfo:i,fullExtent:s}:null}function m$e(e,t,r){const i=RVe(e);if(b(i)){if(!ot.isCollection(i))return{tileInfo:i.tileInfo,fullExtent:i.fullExtent};{const s=i.find(n=>b$(n.tileInfo,n.fullExtent,t,r)==null);if(s)return{tileInfo:s.tileInfo,fullExtent:s.fullExtent}}}return{tileInfo:null,fullExtent:null}}function Oxt(e){return e.isWGS84||e.isWebMercator||pbe(e)||!iI(e)}const Mxt={force512VTL:!1};function mz(e){return e===zt.NORTH_EAST?zt.SOUTH_WEST:e===zt.NORTH_WEST?zt.SOUTH_EAST:e===zt.SOUTH_WEST?zt.NORTH_EAST:zt.NORTH_WEST}function pk(e){return e===zt.NORTH?zt.SOUTH:e===zt.EAST?zt.WEST:e===zt.SOUTH?zt.NORTH:zt.EAST}function Pxt(e){return e===zt.NORTH_WEST||e===zt.SOUTH_WEST}function Ixt(e){return e===zt.NORTH_WEST||e===zt.NORTH_EAST}function oge(e){return e===zt.NORTH_WEST||e===zt.WEST||e===zt.SOUTH_WEST}function age(e){return e===zt.NORTH_EAST||e===zt.EAST||e===zt.SOUTH_EAST}function lge(e){return e===zt.SOUTH_EAST||e===zt.SOUTH||e===zt.SOUTH_WEST}function cge(e){return e===zt.NORTH_EAST||e===zt.NORTH||e===zt.NORTH_WEST}const R_=[zt.NORTH,zt.EAST,zt.SOUTH,zt.WEST],gz=[zt.NORTH_EAST,zt.SOUTH_EAST,zt.SOUTH_WEST,zt.NORTH_WEST];class $xt{constructor(t,r){if(this.layer=null,this.memory=0,this.displayedNumberOfFeatures=0,this.maximumNumberOfFeatures=null,this.totalNumberOfFeatures=null,this.layer=t.layer,this.memory=_$(t)?r.basemapTerrain.getUsedMemoryForLayerView(t):t.getUsedMemory(),pxt(t)){const i=t.performanceInfo;this.displayedNumberOfFeatures=i.displayedNumberOfFeatures,this.maximumNumberOfFeatures=i.maximumNumberOfFeatures,this.totalNumberOfFeatures=i.totalNumberOfFeatures}}}class Lxt{constructor(t){this.totalMemory=0,this.usedMemory=0,this.quality=1,this.load=0,this.terrainMemory=0,this.edgesMemory=0,this.layerPerformanceInfos=new Array;const r=t.resourceController.memoryController;this.totalMemory=r.maxMemory*hA.MEGABYTES,this.usedMemory=Math.round(r.usedMemory*this.totalMemory),this.quality=r.memoryFactor,this.load=t.resourceController.scheduler.load,this.terrainMemory=t.basemapTerrain?t.basemapTerrain.getUsedMemory():0;const i=t._stage&&t._stage.renderView&&t._stage.renderView.edgeView;this.edgesMemory=b(i)?i.usedMemory:0,t.allLayerViews.items.forEach(s=>{(d$e(s)||_$(s))&&this.layerPerformanceInfos.push(new $xt(s,t))}),this.layerPerformanceInfos.sort((s,n)=>n.memory-s.memory)}}class Dxt extends DE{constructor(t,r,i,s){super(r,s),this._streamDataRequester=t,this._parameters=i}async fromUrl(t,r,i){Jt(i);const s=b(i)&&i.signal,n=this.makeUid(t,r);let o=this._textureRequests.get(n);if(!o){const a=new AbortController,l=this._streamDataRequester.request(t,"image",{uid:n,signal:a.signal});o={referenceCount:0,texture:null,textureAsync:null,abortController:a},this._textureRequests.set(n,o),o.textureAsync=l.then(async c=>{const h=this._createTexture(t,c,r);return o.texture=h,o.abortController=null,this._stage.add(h),await this._stage.load(h),{uid:n,texture:h,release:()=>this._release(n)}},c=>{throw o.abortController=null,c})}return o.referenceCount++,new Promise((a,l)=>{Ia(s,()=>{l(gr())}),o.textureAsync.then(a,l)}).catch(a=>{throw this._release(n),a})}_createTexture(t,r,i){const s={...this._parameters,powerOfTwoResizeMode:f1.PAD};if(tee(t)){if(i||r.width===0&&r.height===0){const n=r.width?r.height/r.width:1;i=i||64,n>1?(r.width=Math.round(i/n),r.height=i):(r.width=i,r.height=Math.round(i*n))}this._stage.renderView&&this._stage.renderView.renderingContext.driverTest.svgAlwaysPremultipliesAlpha&&(s.preMultiplyAlpha=!1)}return s.width=r.width,s.height=r.height,new Hs(r,s)}}class Nxt{constructor(t){this.textures=null,this.streamDataRequester=null,this.graphicsOwners=[],this.screenSizePerspectiveHandles=null,this.cimSymbolRasterizer=null,this.viewState=t.viewState,this.view=t.view,this.pointsOfInterest=t.pointsOfInterest,this.objectResourceCache=t.objectResourceCache,this.streamDataRequester=t.resourceController.createStreamDataRequester(Lm.SYMBOLOGY),this.textures=new Dxt(this.streamDataRequester,t.view._stage,{preMultiplyAlpha:!0,wrap:{s:xt.CLAMP_TO_EDGE,t:xt.CLAMP_TO_EDGE}},t.resourceController.scheduler);const r=Ar(this.view.spatialReference).radius;this.screenSizePerspectiveSettings=KMe(t.viewingMode,r),this.screenSizePerspectiveSettingsLabels=xdt(t.viewingMode,r)}destroy(){this.textures.destroy(),this.textures=null,this.streamDataRequester=null}addGraphicsOwner(t){if(!t)return kd();this.graphicsOwners.push(t);const r=te(()=>{var i;return(i=t.layer)==null?void 0:i.screenSizePerspectiveEnabled},()=>this._updateScreenSizePerspectiveEnabled());return this._updateScreenSizePerspectiveEnabled(),kd(()=>{r.remove(),zz(this.graphicsOwners,t),this._updateScreenSizePerspectiveEnabled()})}_updateScreenSizePerspectiveEnabled(){const t=this.graphicsOwners.some(r=>{var i;return((i=r.layer)==null?void 0:i.screenSizePerspectiveEnabled)===!0});if(t&&!this.screenSizePerspectiveHandles){this.screenSizePerspectiveHandles=new Dt;const r=()=>this._updateScreenSizePerspectiveSettings();this.screenSizePerspectiveHandles.add([te(()=>this.pointsOfInterest.centerOnSurfaceInfrequent.distance,r,ei),this.viewState.events.on("camera-projection-changed",r)]),this._updateScreenSizePerspectiveSettings()}else!t&&this.screenSizePerspectiveHandles&&(this.screenSizePerspectiveHandles.destroy(),this.screenSizePerspectiveHandles=null)}_updateScreenSizePerspectiveSettings(){const t=this.pointsOfInterest;kF.distance=t.centerOnSurfaceInfrequent.distance,kF.fovY=this.viewState.camera.fovY,this.screenSizePerspectiveSettings.update(kF),this.screenSizePerspectiveSettingsLabels.update(kF),this.view._stage.renderView.requestRender()}get test(){return{screenSizePerspectiveHandles:this.screenSizePerspectiveHandles}}}const kF={distance:0,fovY:0};class e_{constructor(t,r,i=""){this.graphics=t,this._symbol=new F_({symbolLayers:[new N_({material:{color:r},outline:{color:[255,255,255],size:1},resource:{primitive:"circle"}}),new ZT({text:i,halo:{color:"white",size:1/.75},material:{color:r},size:12})]})}show(t,r){if(R(r))return;this.hide();const i=new at({x:t[0],y:t[1],z:t[2],spatialReference:r});this._graphic=new gl({geometry:i,symbol:this._symbol}),this.graphics.add(this._graphic)}hide(){b(this._graphic)&&(this.graphics.remove(this._graphic),this._graphic=null)}}let O_=class extends xe{constructor(e){super(e),this.handles=new Dt}destroy(){this.handles.destroy()}};u([d({constructOnly:!0})],O_.prototype,"renderCoordsHelper",void 0),u([d({constructOnly:!0})],O_.prototype,"surface",void 0),u([d({constructOnly:!0})],O_.prototype,"state",void 0),O_=u([$("esri.views.3d.support.PointOfInterest")],O_);const Fxt=Array;let Fu=class extends O_{constructor(e){super(e),this._dirty=!1,this._propertiesPool=new g0({location:at,renderLocation:Fxt},this),this._estimatedSurfaceAltitude=0,this._pendingElevationQueryController=null,this.cameraName="camera",this.renderLocation=M(),this.tmpPoint=new at}initialize(){if(this.scheduler&&this.handles.add(this.scheduler.registerTask(this.task,this)),this.runTask(),this.map){const e=()=>this._setDirty();this.handles.add(rs(()=>{var t,r;return(r=(t=this.map)==null?void 0:t.ground)==null?void 0:r.layers},"change",e,{onListenerAdd:e,onListenerRemove:e}))}this._updateRenderLocation()}destroy(){this._cancelPendingRequest(),this._propertiesPool.destroy(),this._propertiesPool=null}get _camera(){return this.state[this.cameraName]}get location(){const e=this._propertiesPool.get("location");return this.renderCoordsHelper.fromRenderCoords(this.renderLocation,e,this.state.spatialReference),e}get scale(){const e=this._camera,t=pi(e.eye,this.renderLocation),r={renderCoordsHelper:this.renderCoordsHelper,state:{camera:e}};return MT(r,t,0)}get updating(){return this._dirty||this._pendingElevationQueryController!=null}updateRenderLocation(){this._setDirty(),this._updateRenderLocation()}_setDirty(){this._dirty||(this._dirty=!0,this.notifyChange("updating"))}_cancelPendingRequest(){const e=this._pendingElevationQueryController;e&&(this._pendingElevationQueryController=null,e.abort(),this.notifyChange("updating"))}get running(){return!this._pendingElevationQueryController&&this._dirty}runTask(){if(this._cancelPendingRequest(),this._dirty=!1,this.notifyChange("updating"),!this.map||!this.map.ground)return void this._updateSurfaceAltitude(0);this.renderCoordsHelper.fromRenderCoords(this._camera.eye,this.tmpPoint,this.state.spatialReference);let e=new AbortController;this.map.ground.queryElevation(this.tmpPoint,{signal:e.signal,cache:this.cache}).then(t=>this._updateSurfaceAltitude(t.geometry.z)).catch(t=>{Vi(t)||this._updateSurfaceAltitude(0)}).catch(()=>{}).then(()=>{this._pendingElevationQueryController===e&&(this._pendingElevationQueryController=null,this.notifyChange("updating")),e=null}),this._pendingElevationQueryController=e}_updateSurfaceAltitude(e){this._estimatedSurfaceAltitude!==e&&(this._estimatedSurfaceAltitude=e,this._updateRenderLocation())}_updateRenderLocation(){this.renderCoordsHelper.setAltitude(Vj,this._estimatedSurfaceAltitude,this._camera.eye),Xl(this._get("renderLocation"),Vj)||this._set("renderLocation",ae(this._propertiesPool.get("renderLocation"),Vj))}};u([d({constructOnly:!0})],Fu.prototype,"scheduler",void 0),u([d({constructOnly:!0})],Fu.prototype,"cache",void 0),u([d({constructOnly:!0})],Fu.prototype,"task",void 0),u([d({constructOnly:!0})],Fu.prototype,"cameraName",void 0),u([d({readOnly:!0})],Fu.prototype,"location",null),u([d({constructOnly:!0})],Fu.prototype,"map",void 0),u([d({readOnly:!0})],Fu.prototype,"renderLocation",void 0),u([d({readOnly:!0})],Fu.prototype,"scale",null),u([d({readOnly:!0})],Fu.prototype,"updating",null),Fu=u([$("esri.views.3d.support.CameraOnSurface")],Fu);const Vj=M(),kxt=Array;let Pc=class extends O_{constructor(e){super(e),this._propertiesPool=new g0({location:at,renderLocation:kxt},this),this._currentSurfaceAltitude=0,this._latestSurfaceAltitude=0,this.cameraName="camera",this.distance=0,this.renderLocation=M(),this.updating=!1}initialize(){this._frameWorker=this.scheduler.registerTask(this.task,this),this.runTask()}destroy(){this._frameWorker=wn(this._frameWorker),this._propertiesPool=ct(this._propertiesPool)}get _camera(){return this.state[this.cameraName]}get location(){const e=this._propertiesPool.get("location");return this.renderCoordsHelper.fromRenderCoords(this.renderLocation,e,this.state.spatialReference),e}updateRenderLocation(){this.updating=!0,this._updateRenderLocation()}get estimatedSurfaceAltitude(){return this._latestSurfaceAltitude}get running(){return this.updating}runTask(){this._latestSurfaceAltitude=this.estimateSurfaceAltitudeAtCenter(),this._updateRenderLocation(),this.updating=!1}_updateRenderLocation(){const e=Vxt;let t=this._calculateSurfaceIntersection(this._currentSurfaceAltitude,e);const r=this._currentSurfaceAltitude!==this._latestSurfaceAltitude;!t&&r&&(t=this._calculateSurfaceIntersection(this._latestSurfaceAltitude,e),t&&(this._currentSurfaceAltitude=this._latestSurfaceAltitude));const i=zxt;t&&this._latestSurfaceAltitudeChangesDistanceSignificantly(e,i)&&(ae(e,i),this._currentSurfaceAltitude=this._latestSurfaceAltitude),t?this.distance=pi(this._camera.eye,e):(le(e,this._camera.viewForward,this._get("distance")),de(e,e,this._camera.eye)),Xl(this._get("renderLocation"),e)||this._set("renderLocation",ae(this._propertiesPool.get("renderLocation"),e))}_calculateSurfaceIntersection(e,t){const r=this._camera;if(!this.renderCoordsHelper.intersectManifold(r.ray,e,t))return!1;if(this.state.isGlobal){const i=Ar(this.renderCoordsHelper.spatialReference).radius,s=i+e,n=ul(r.eye),o=n<s*s,a=pi(r.eye,t);if(o&&a>i/4){const l=s-Math.sqrt(n);return le(t,r.viewForward,l),de(t,t,r.eye),!0}}else{const i=this.surface.ready?this.surface.extent:null;b(i)&&T6(i,this.surface.spatialReference,GO,this.renderCoordsHelper.spatialReference)&&(t[0]=Le(t[0],GO[0],GO[2]),t[1]=Le(t[1],GO[1],GO[3]))}return!0}_latestSurfaceAltitudeChangesDistanceSignificantly(e,t){if(this._latestSurfaceAltitude===this._currentSurfaceAltitude||e==null)return!1;if(this._calculateSurfaceIntersection(this._latestSurfaceAltitude,t)){if(Xr.TESTS_DISABLE_OPTIMIZATIONS)return!0;const r=this._camera.eye,i=pi(r,e),s=pi(r,t);if(Math.abs(s-i)/i>Uxt)return!0}return!1}};u([d({constructOnly:!0})],Pc.prototype,"scheduler",void 0),u([d({constructOnly:!0})],Pc.prototype,"task",void 0),u([d({constructOnly:!0})],Pc.prototype,"cameraName",void 0),u([d()],Pc.prototype,"distance",void 0),u([d({constructOnly:!0})],Pc.prototype,"estimateSurfaceAltitudeAtCenter",void 0),u([d({readOnly:!0})],Pc.prototype,"location",null),u([d({readOnly:!0})],Pc.prototype,"renderLocation",void 0),u([d()],Pc.prototype,"updating",void 0),Pc=u([$("esri.views.3d.support.CenterOnSurface")],Pc);const Uxt=.05,Vxt=M(),zxt=M(),GO=Ut();class Bxt{constructor(t){this.handles=new Dt,this.events=new ds,this.contentLayerViews=t.contentLayerViews,this.handles.add(this.contentLayerViews.on("change",r=>this._layerViewsChanged(r))),this._layerViewsChanged({added:this.contentLayerViews.toArray(),removed:[],moved:[],target:this.contentLayerViews})}destroy(){this.handles&&(this.handles.destroy(),this.handles=null)}_layerViewsChanged(t){t.added.forEach(r=>{r.declaredClass==="esri.views.3d.layers.SceneLayerView3D"&&this.handles.add(r.on("visible-geometry-changed",()=>this._contentChanged()),r.uid)}),t.removed.forEach(r=>this.handles.remove(r.uid))}_contentChanged(){this.events.emit("request-update",Gxt)}}const Gxt={},jxt=Array;let pm=class extends O_{constructor(e){super(e),this._propertiesPool=new g0({location:at,renderLocation:jxt},this),this._dirty=!0,this.renderLocation=this._propertiesPool.get("renderLocation")}initialize(){this.handles.add([te(()=>this.centerOnSurface.renderLocation,()=>this.updateRenderLocation()),te(()=>this.state.contentCamera,()=>this.updateRenderLocation())]),this.scheduler&&this.handles.add(this.scheduler.registerTask(vt.POINT_OF_INTEREST_FREQUENT,this))}destroy(){this._propertiesPool.destroy(),this._propertiesPool=null}get updating(){return this._dirty||this.centerOnSurface.updating}get location(){const e=this._propertiesPool.get("location");return this.renderCoordsHelper.fromRenderCoords(this.renderLocation,e,this.state.spatialReference),e}get running(){return this._dirty}runTask(){const e=this._get("renderLocation"),t=this.centerOnSurface.renderLocation,r=this.renderCoordsHelper,i=this.state.contentCamera;this._dirty=!1,r.worldUpAtPosition(t,uge);const s=Math.max(0,(Math.acos(Te(uge,i.viewForward))-.5*Math.PI)*(i.aboveGround?1:-1));if(Number.isNaN(s)){if(!e||!cT(e,t)){const l=this._propertiesPool.get("renderLocation");ae(l,t),this._set("renderLocation",l)}return}const n=1-Le(s/(.5*Math.PI),0,1),o=n*n*n;this._calculateScreenHorizontalEdgeOnSurface(hge);const a=this._propertiesPool.get("renderLocation");En(a,t,hge,o),e&&cT(e,a)||this._set("renderLocation",a)}_calculateScreenHorizontalEdgeOnSurface(e){const t=this.state.contentCamera,r=t.getRenderCenter(ea());if(r[1]=t.aboveGround?t.padding[Ot.BOTTOM]:t.fullHeight-t.padding[Ot.TOP],this.estimateSurfaceIntersectionAtRenderPoint(r,e))return e;const i=this.renderCoordsHelper.getAltitude(this.centerOnSurface.renderLocation);if(t.unprojectFromRenderScreen(r,jO)){pe(jO,jO,t.eye);const s=we(jO,jO);if(this.renderCoordsHelper.intersectManifold(wh(t.eye,s),i,e))return e}return this.renderCoordsHelper.setAltitude(e,i,t.eye)}updateRenderLocation(){this._dirty=!0}};u([d()],pm.prototype,"_dirty",void 0),u([d({constructOnly:!0})],pm.prototype,"scheduler",void 0),u([d({constructOnly:!0})],pm.prototype,"centerOnSurface",void 0),u([d({constructOnly:!0})],pm.prototype,"estimateSurfaceIntersectionAtRenderPoint",void 0),u([d({readOnly:!0})],pm.prototype,"updating",null),u([d({readOnly:!0})],pm.prototype,"location",null),u([d({readOnly:!0})],pm.prototype,"renderLocation",void 0),pm=u([$("esri.views.3d.support.CenterOnSurface")],pm);const uge=M(),jO=M(),hge=M();let uy=class extends xe{constructor(e){super(e),this.location=null,this._updateController=null,this._handles=new Dt}get renderLocation(){if(!this.location)return null;const e=M();return this.view.renderCoordsHelper.toRenderCoords(this.location,e),e}initialize(){this.view.state.isLocal&&(this._handles.add([te(()=>{var e,t;return[(e=this.surfaceView)==null?void 0:e.spatialReference,(t=this.surfaceView)==null?void 0:t.extent]},()=>this._update()),rs(()=>{var e;return(e=this.surface)==null?void 0:e.layers},"change",()=>this._update())]),this._update())}destroy(){this._handles.destroy()}_update(){if(this._updateController&&(this._updateController.abort(),this._updateController=null),!this.surfaceView||R(this.surfaceView.extent)||!this.surfaceView.spatialReference)return void this._set("location",null);const e=Vee(this.surfaceView.extent),t=new at({x:e[0],y:e[1],z:0,spatialReference:this.surfaceView.spatialReference});this.surface&&this.surface.layers.length>0?(this._set("location",null),this._updateController=new AbortController,this.surface.queryElevation(t,{noDataValue:0,signal:this._updateController.signal,cache:this.cache}).then(r=>{this._updateController=null,this._set("location",r.geometry)}).catch(r=>{Vi(r)||r&&r.name==="elevation-query:invalid-layer"||console.error("StableSurfaceCenter failed to update: ",r)})):this._set("location",t)}};u([d({constructOnly:!0})],uy.prototype,"view",void 0),u([d({constructOnly:!0})],uy.prototype,"cache",void 0),u([d({readOnly:!0,aliasOf:"view.map.ground"})],uy.prototype,"surface",void 0),u([d({readOnly:!0,aliasOf:"view.basemapTerrain"})],uy.prototype,"surfaceView",void 0),u([d({readOnly:!0})],uy.prototype,"location",void 0),u([d({readOnly:!0})],uy.prototype,"renderLocation",null),uy=u([$("esri.views.3d.terrain.StableSurfaceCenter")],uy);let hy=class extends xe{constructor(){super(...arguments),this.handles=new Dt,this._tileGeometryUpdateExtent=vh(),this._tileGeometryUpdateSpatialReference=null,this.events=new ds,this.updating=!1}initialize(){this.handles.add([this.surface.on("elevation-change",e=>this._tileGeometryChanged(e)),this.scheduler.registerTask(vt.SURFACE_GEOMETRY_UPDATES,this)])}destroy(){this.handles=ct(this.handles)}get running(){return this.updating}runTask(){this.updating&&(this._centerIntersectsExtent(this._tileGeometryUpdateExtent,this._tileGeometryUpdateSpatialReference)&&this.events.emit("request-update",Hxt),vh(this._tileGeometryUpdateExtent),this._set("updating",!1))}_tileGeometryChanged(e){this._tileGeometryUpdateSpatialReference=e.spatialReference,Dx(this._tileGeometryUpdateExtent,e.tile.extent,this._tileGeometryUpdateExtent),this._set("updating",!0)}_furthestCenterOnSurface(){let e=this.centerOnSurfaces[0];for(let t=1;t<this.centerOnSurfaces.length;t++){const r=this.centerOnSurfaces[t];r.distance>e.distance&&(e=r)}return e}_centerIntersectsExtent(e,t){const r=this.state.camera.eye,i=qxt,s=this._furthestCenterOnSurface();return this.renderCoordsHelper.fromRenderCoords(r,Ub,t),this.renderCoordsHelper.fromRenderCoords(s.renderLocation,Vb,t),Ub[0]<Vb[0]?(i[0]=Ub[0],i[2]=Vb[0]):(i[0]=Vb[0],i[2]=Ub[0]),Ub[1]<Vb[1]?(i[1]=Ub[1],i[3]=Vb[1]):(i[1]=Vb[1],i[3]=Ub[1]),X$(i,e)}};u([d({constructOnly:!0})],hy.prototype,"state",void 0),u([d({constructOnly:!0})],hy.prototype,"centerOnSurfaces",void 0),u([d({constructOnly:!0})],hy.prototype,"renderCoordsHelper",void 0),u([d({constructOnly:!0})],hy.prototype,"scheduler",void 0),u([d({constructOnly:!0})],hy.prototype,"surface",void 0),u([d({readOnly:!0})],hy.prototype,"updating",void 0),hy=u([$("esri.views.3d.support.SurfaceGeometryUpdates")],hy);const Hxt={},Ub=M(),Vb=M(),qxt=vh();let va=class extends xe{constructor(e){super(e),this._handles=new Dt,this._tmpRay=Ro(),this._centerRayDirty=!0,this._surfaceAltitudeAtCenter=0,this._surfaceAltitudeAtCenterDirty=!0,this._contentAltitudeAtCenter=0,this._contentAltitudeAtCenterDirty=!0,this._propertiesPool=new g0({renderPointOfView:Wxt},this),this.renderPointOfView=M(),this._pois=new Array,this._debugCenters=new Map}initialize(){var c;const{state:e,basemapTerrain:t,renderCoordsHelper:r,map:i}=this.view;this._surfaceIntersector=qd(e.viewingMode),e.isGlobal?this._surfaceIntersector.options.backfacesTerrain=!1:this._surfaceIntersector.options.backfacesTerrain=!0,this._surfaceIntersector.options.invisibleTerrain=!1,this._surfaceIntersector.options.store=$o.MIN,this._contentIntersector=qd(e.viewingMode);const s=()=>this._estimateSurfaceAltitudeAtCenter(),n=this.view.resourceController.scheduler,o=(c=this.view.basemapTerrain)==null?void 0:c.elevationQueryCache,a={state:e,scheduler:n,surface:t,renderCoordsHelper:r};this._set("centerOnSurfaceInfrequent",new Pc({...a,task:vt.POINT_OF_INTEREST_INFREQUENT,estimateSurfaceAltitudeAtCenter:s})),this._set("centerOnSurfaceFrequent",new Pc({...a,task:vt.POINT_OF_INTEREST_FREQUENT,estimateSurfaceAltitudeAtCenter:s})),this._set("contentCenterOnSurface",new Pc({...a,task:vt.POINT_OF_INTEREST_INFREQUENT,estimateSurfaceAltitudeAtCenter:s,cameraName:"contentCamera"})),this._set("centerOnContent",new Pc({...a,task:vt.POINT_OF_INTEREST_FREQUENT,estimateSurfaceAltitudeAtCenter:()=>this._estimateContentAltitudeAtCenter()})),this._set("cameraOnSurface",new Fu({...a,cache:o,task:vt.POINT_OF_INTEREST_INFREQUENT,map:i})),this._set("contentCameraOnSurface",new Fu({...a,cache:o,task:vt.POINT_OF_INTEREST_INFREQUENT,map:i,cameraName:"contentCamera"})),this._set("surfaceGeometryUpdates",new hy({...a,centerOnSurfaces:[this.centerOnSurfaceFrequent,this.centerOnContent,this.centerOnSurfaceInfrequent]})),this._set("contentGeometryUpdates",new Bxt({contentLayerViews:this.view.allLayerViews,renderCoordsHelper:r})),this._set("surfaceOrigin",new uy({cache:o,view:this.view})),this._set("focus",new pm({state:e,scheduler:n,surface:t,renderCoordsHelper:r,centerOnSurface:this.contentCenterOnSurface,estimateSurfaceIntersectionAtRenderPoint:(h,p)=>this._estimateSurfaceIntersectionAtRenderPoint(h,this.view.state.contentCamera,p)})),this._pois.push(this.centerOnContent,this.centerOnSurfaceFrequent,this.centerOnSurfaceInfrequent,this.contentCenterOnSurface,this.cameraOnSurface,this.contentCameraOnSurface,this.focus);const l=this.view.graphics;this._debugCenters.set(this.centerOnContent,new e_(l,"red","CenterOnContent")),this._debugCenters.set(this.centerOnSurfaceFrequent,new e_(l,"red","CenterOnSurface")),this._debugCenters.set(this.centerOnSurfaceInfrequent,new e_(l,"red","CenterOnSurface")),this._debugCenters.set(this.contentCenterOnSurface,new e_(l,"red","ContentCenterOnSurface")),this._debugCenters.set(this.cameraOnSurface,new e_(l,"blue","CameraOnSurface")),this._debugCenters.set(this.contentCameraOnSurface,new e_(l,"blue","ContentCameraOnSurface")),this._debugCenters.set(this.focus,new e_(l,"green","Focus")),this._handles.add([te(()=>e.camera,h=>this._cameraChanged(h),ei),te(()=>t.extent,()=>this._updateCenterPointsOfInterest()),Lo(()=>!t.updating,()=>this._updateCenterPointsOfInterest(),ei),rs(()=>this.surfaceGeometryUpdates.events,"request-update",()=>this._updateCenterPointsOfInterest()),rs(()=>this.contentGeometryUpdates.events,"request-update",()=>this._updateCenterOnContent()),Lo(()=>Xr.SHOW_POI,h=>this._setDebug(h),Rt)]),this._cameraChanged(this.view.state.camera);for(const h of this._pois)h.runTask()}destroy(){this._setDebug(!1),this._handles.destroy(),this._propertiesPool.destroy();for(const e of this._pois)e.destroy();this.surfaceOrigin.destroy()}get updating(){var e;return!(!((e=this.surfaceGeometryUpdates)!=null&&e.updating)&&!this._pois.some(t=>t.updating))}get centerRay(){return this._centerRayDirty&&(this._centerRay=this.view.sceneIntersectionHelper.getCenterRayWithSubpixelOffset(this.view.state.camera,this._tmpRay),this._centerRayDirty=!1),this._centerRay}_estimateContentAltitudeAtCenter(){if(!this._contentAltitudeAtCenterDirty)return this._contentAltitudeAtCenter;this._contentAltitudeAtCenterDirty=!1;const e=this.centerRay;return R(e)||(this.view.sceneIntersectionHelper.intersectRay(e,this._contentIntersector,ZS,Zxt)?this._contentAltitudeAtCenter=this.view.renderCoordsHelper.getAltitude(ZS):this._contentAltitudeAtCenter=this._estimateSurfaceAltitudeAtCenter()),this._contentAltitudeAtCenter}_estimateSurfaceAltitudeAtCenter(){if(!this.view.basemapTerrain)return 0;if(!this._surfaceAltitudeAtCenterDirty)return this._surfaceAltitudeAtCenter;this._surfaceAltitudeAtCenterDirty=!1;const e=this.centerRay;if(R(e))return this._surfaceAltitudeAtCenter;const t=e.origin,r=de(ZS,e.origin,e.direction);return this._surfaceIntersector.resetWithRay(e,this.view.state.camera),this.view.basemapTerrain.intersect(this._surfaceIntersector,null,t,r),this._surfaceIntersector.results.min.getIntersectionPoint(ZS)&&(this._surfaceAltitudeAtCenter=this.view.renderCoordsHelper.getAltitude(ZS)),this._surfaceAltitudeAtCenter}_estimateSurfaceIntersectionAtRenderPoint(e,t,r){const i=qie(t,e,Xxt);if(R(i))return null;const s=i.origin,n=de(ZS,i.origin,i.direction);return this._surfaceIntersector.resetWithRay(i,t),this.view.basemapTerrain.intersect(this._surfaceIntersector,null,s,n),this._surfaceIntersector.results.min.getIntersectionPoint(r)?r:null}_cameraChanged(e){this._updateCenterPointsOfInterest();const t=e.eye;Xl(this.renderPointOfView,t)||this._set("renderPointOfView",ae(this._propertiesPool.get("renderPointOfView"),t))}_updateCenterPointsOfInterest(){this._centerRayDirty=!0,this._surfaceAltitudeAtCenterDirty=!0,this._contentAltitudeAtCenterDirty=!0;for(const e of this._pois)e.updateRenderLocation()}_updateCenterOnContent(){this._contentAltitudeAtCenterDirty=!0,this.centerOnContent.updateRenderLocation()}_setDebug(e){if(!e)return this._debugCenters.forEach(t=>t.hide()),void this._handles.remove("debug");for(const t of this._pois)this._handles.add(te(()=>t.renderLocation,r=>this._debugCenters.get(t).show(r,t.renderCoordsHelper.spatialReference),Rt),"debug")}get test(){return{update:()=>{this.surfaceGeometryUpdates.runTask();for(const e of this._pois)e.runTask()},surfaceGeometryUpdates:this.surfaceGeometryUpdates}}};u([d({readOnly:!0})],va.prototype,"centerOnContent",void 0),u([d({readOnly:!0})],va.prototype,"centerOnSurfaceFrequent",void 0),u([d({readOnly:!0})],va.prototype,"centerOnSurfaceInfrequent",void 0),u([d({readOnly:!0})],va.prototype,"contentCenterOnSurface",void 0),u([d({readOnly:!0})],va.prototype,"cameraOnSurface",void 0),u([d({readOnly:!0})],va.prototype,"contentCameraOnSurface",void 0),u([d({readOnly:!0})],va.prototype,"focus",void 0),u([d({readOnly:!0})],va.prototype,"renderPointOfView",void 0),u([d({readOnly:!0})],va.prototype,"surfaceOrigin",void 0),u([d({readOnly:!0})],va.prototype,"contentGeometryUpdates",void 0),u([d({readOnly:!0})],va.prototype,"surfaceGeometryUpdates",void 0),u([d({constructOnly:!0})],va.prototype,"view",void 0),u([d({readOnly:!0})],va.prototype,"updating",null),va=u([$("esri.views.3d.support.PointsOfInterest")],va);const Wxt=Array,ZS=M(),Xxt=Ro(),Zxt={exclude:new Set([Yp])};class Yxt{constructor(t){this.store=t}destroy(){this.store.destroy()}get(t){return this.store.get(t)}put(t,r){this.store.put(t,r,r.values.byteLength+256)}}const Qxt=fe.getLogger("esri.core.workers.WorkerHandle");class g$e{constructor(t,r,i,s,n={}){this._mainMethod=r,this._transferLists=i,this._listeners=[],this._promise=Kee(t,{...n,schedule:s}).then(o=>{if(this._thread===void 0){this._thread=o,this._promise=null,n.hasInitialize&&this.broadcast({},"initialize");for(const a of this._listeners)this._connectListener(a)}else o.close()}),this._promise.catch(o=>Qxt.error(`Failed to initialize ${t} worker: ${o}`))}on(t,r){const i={removed:!1,eventName:t,callback:r,threadHandle:null};return this._listeners.push(i),this._connectListener(i),kd(()=>{i.removed=!0,MK(this._listeners,i),this._thread&&b(i.threadHandle)&&i.threadHandle.remove()})}destroy(){this._thread&&(this._thread.close(),this._thread=null),this._promise=null}invoke(t,r){return this.invokeMethod(this._mainMethod,t,r)}invokeMethod(t,r,i){if(this._thread){const s=this._transferLists[t],n=s?s(r):[];return this._thread.invoke(t,r,{transferList:n,signal:i})}return this._promise?this._promise.then(()=>(Jt(i),this.invokeMethod(t,r,i))):Promise.reject(null)}broadcast(t,r){return this._thread?Promise.all(this._thread.broadcast(r,t)).then(()=>{}):this._promise?this._promise.then(()=>this.broadcast(t,r)):Promise.reject()}get promise(){return this._promise}_connectListener(t){this._thread&&this._thread.on(t.eventName,t.callback).then(r=>{t.removed||(t.threadHandle=r)})}}class dge extends g$e{constructor(t=null){super("LercWorker","_decode",{_decode:r=>[r.buffer]},t,{strategy:"dedicated"}),this.schedule=t,this.ref=0}decode(t,r,i){return t&&t.byteLength!==0?this.invoke({buffer:t,options:r},i):Promise.resolve(null)}release(){--this.ref<=0&&(CP.forEach((t,r)=>{t===this&&CP.delete(r)}),this.destroy())}}const CP=new Map;function Jxt(e=null){let t=CP.get(e);return t||(b(e)?(t=new dge(r=>e.schedule(r)),CP.set(e,t)):(t=new dge,CP.set(null,t))),++t.ref,t}function Ky(){const e=new Float32Array(9);return e[0]=1,e[4]=1,e[8]=1,e}function y$e(e){const t=new Float32Array(9);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function Kxt(e,t,r,i,s,n,o,a,l){const c=new Float32Array(9);return c[0]=e,c[1]=t,c[2]=r,c[3]=i,c[4]=s,c[5]=n,c[6]=o,c[7]=a,c[8]=l,c}function eTt(e,t){return new Float32Array(e,t,9)}Object.freeze(Object.defineProperty({__proto__:null,create:Ky,clone:y$e,fromValues:Kxt,createView:eTt},Symbol.toStringTag,{value:"Module"}));var pge,Fc,fge,mge,gge;(function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.FILL_VERTEX=1]="FILL_VERTEX",e[e.FILL_DD_VERTEX=2]="FILL_DD_VERTEX",e[e.FILL_INDEX=3]="FILL_INDEX",e[e.OUTLINE_VERTEX=4]="OUTLINE_VERTEX",e[e.OUTLINE_DD_VERTEX=5]="OUTLINE_DD_VERTEX",e[e.OUTLINE_INDEX=6]="OUTLINE_INDEX",e[e.LINE_VERTEX=7]="LINE_VERTEX",e[e.LINE_DD_VERTEX=8]="LINE_DD_VERTEX",e[e.LINE_INDEX=9]="LINE_INDEX",e[e.ICON_VERTEX=10]="ICON_VERTEX",e[e.ICON_DD_VERTEX=11]="ICON_DD_VERTEX",e[e.ICON_INDEX=12]="ICON_INDEX",e[e.TEXT_VERTEX=13]="TEXT_VERTEX",e[e.TEXT_DD_VERTEX=14]="TEXT_DD_VERTEX",e[e.TEXT_INDEX=15]="TEXT_INDEX",e[e.CIRCLE_VERTEX=16]="CIRCLE_VERTEX",e[e.CIRCLE_INDEX=17]="CIRCLE_INDEX"})(pge||(pge={})),function(e){e[e.FILL=1]="FILL",e[e.LINE=2]="LINE",e[e.SYMBOL=3]="SYMBOL",e[e.CIRCLE=4]="CIRCLE"}(Fc||(Fc={})),function(e){e[e.BACKGROUND=0]="BACKGROUND",e[e.OPAQUE=1]="OPAQUE",e[e.TRANSLUCENT=2]="TRANSLUCENT",e[e.SYMBOLS=3]="SYMBOLS",e[e.HITTEST=4]="HITTEST"}(fge||(fge={})),function(e){e[e.BACKGROUND=0]="BACKGROUND",e[e.FILL=1]="FILL",e[e.OUTLINE=2]="OUTLINE",e[e.LINE=3]="LINE",e[e.ICON=4]="ICON",e[e.CIRCLE=5]="CIRCLE",e[e.TEXT=6]="TEXT",e[e.TILEINFO=7]="TILEINFO"}(mge||(mge={})),function(e){e[e.PAINTER_CHANGED=0]="PAINTER_CHANGED",e[e.LAYOUT_CHANGED=1]="LAYOUT_CHANGED",e[e.LAYER_CHANGED=2]="LAYER_CHANGED",e[e.LAYER_REMOVED=3]="LAYER_REMOVED",e[e.SPRITES_CHANGED=4]="SPRITES_CHANGED"}(gge||(gge={}));class tTt{constructor(t){this.xTile=0,this.yTile=0,this.hash=0,this.priority=1,this.colliders=[],this.textVertexRanges=[],this.iconVertexRanges=[],this.tile=t}}class ODt{constructor(){this.tileSymbols=[],this.parts=[{startTime:0,startOpacity:0,targetOpacity:0,show:!1},{startTime:0,startOpacity:0,targetOpacity:0,show:!1}],this.show=!1}}function MDt(e,t,r,i,s,n){const o=r-s;if(o>=0)return(t>>o)+(i-(n<<o))*(e>>o);const a=-o;return t-(n-(i<<a))*(e>>a)<<a}class PDt{constructor(t,r,i){this._rows=Math.ceil(r/i),this._columns=Math.ceil(t/i),this._cellSize=i,this.cells=new Array(this._rows);for(let s=0;s<this._rows;s++){this.cells[s]=new Array(this._columns);for(let n=0;n<this._columns;n++)this.cells[s][n]=[]}}getCell(t,r){const i=Math.min(Math.max(Math.floor(r/this._cellSize),0),this._rows-1),s=Math.min(Math.max(Math.floor(t/this._cellSize),0),this._columns-1);return this.cells[i]&&this.cells[i][s]||null}getCellSpan(t,r,i,s){return[Math.min(Math.max(Math.floor(t/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(r/this._cellSize),0),this.rows-1),Math.min(Math.max(Math.floor(i/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(s/this._cellSize),0),this.rows-1)]}get cellSize(){return this._cellSize}get columns(){return this._columns}get rows(){return this._rows}}function rTt(e,t,r,i,s,n){const o=t[i++];for(let a=0;a<o;a++){const l=new tTt(n);l.xTile=t[i++],l.yTile=t[i++],l.hash=t[i++],l.priority=t[i++];const c=t[i++];for(let f=0;f<c;f++){const m=t[i++],g=t[i++],v=t[i++],w=t[i++],_=!!t[i++],T=t[i++],x=r[i++],E=r[i++],C=t[i++],A=t[i++];l.colliders.push({xTile:m,yTile:g,dxPixels:v,dyPixels:w,hard:_,partIndex:T,width:C,height:A,minLod:x,maxLod:E})}const h=e[i++];for(let f=0;f<h;f++)l.textVertexRanges.push([e[i++],e[i++]]);const p=e[i++];for(let f=0;f<p;f++)l.iconVertexRanges.push([e[i++],e[i++]]);s.push(l)}return i}function IDt(e,t,r){for(const[i,s]of e.symbols)iTt(e,t,r,s,i)}function iTt(e,t,r,i,s){const n=e.layerData.get(s);if(n.type===Fc.SYMBOL){for(const o of i){const a=o.unique;let l;if(o.selectedForRendering){const c=a.parts[0],h=c.startOpacity,p=c.targetOpacity;e.allSymbolsFadingOut=e.allSymbolsFadingOut&&p===0;const f=r?Math.floor(127*h)|p<<7:p?255:0;l=f<<24|f<<16|f<<8|f}else l=0;for(const[c,h]of o.iconVertexRanges)for(let p=c;p<c+h;p+=4)n.iconOpacity[p/4]=l;if(o.selectedForRendering){const c=a.parts[1],h=c.startOpacity,p=c.targetOpacity;e.allSymbolsFadingOut=e.allSymbolsFadingOut&&p===0;const f=r?Math.floor(127*h)|p<<7:p?255:0;l=f<<24|f<<16|f<<8|f}else l=0;for(const[c,h]of o.textVertexRanges)for(let p=c;p<c+h;p+=4)n.textOpacity[p/4]=l}n.lastOpacityUpdate=t,n.opacityChanged=!0}}class b8{constructor(t,r){this.layerUIDs=[],this.isDestroyed=!1,this.data=t,this.memoryUsed=t.byteLength;let i=1;const s=new Uint32Array(t);this.layerUIDs=[];const n=s[i++];for(let o=0;o<n;o++)this.layerUIDs[o]=s[i++];this.bufferDataOffset=i,r&&(this.layer=r.getStyleLayerByUID(this.layerUIDs[0]))}get isPreparedForRendering(){return R(this.data)}get offset(){return this.bufferDataOffset}destroy(){this.isDestroyed||(this.doDestroy(),this.isDestroyed=!0)}prepareForRendering(t){R(this.data)||(this.doPrepareForRendering(t,this.data,this.bufferDataOffset),this.data=null)}}class sTt extends b8{constructor(t,r){super(t,r),this.type=Fc.LINE,this.lineIndexStart=0,this.lineIndexCount=0;const i=new Uint32Array(t);let s=this.bufferDataOffset;this.lineIndexStart=i[s++],this.lineIndexCount=i[s++];const n=i[s++];if(n>0){const o=new Map;for(let a=0;a<n;a++){const l=i[s++],c=i[s++],h=i[s++];o.set(l,[c,h])}this.patternMap=o}this.bufferDataOffset=s}hasData(){return this.lineIndexCount>0}triangleCount(){return this.lineIndexCount/3}doDestroy(){b(this.lineVertexArrayObject)&&this.lineVertexArrayObject.dispose(),b(this.lineVertexBuffer)&&this.lineVertexBuffer.dispose(),b(this.lineIndexBuffer)&&this.lineIndexBuffer.dispose(),this.lineVertexArrayObject=null,this.lineVertexBuffer=null,this.lineIndexBuffer=null,this.memoryUsed=0}doPrepareForRendering(t,r,i){const s=new Uint32Array(r),n=new Int32Array(s.buffer),o=s[i++];this.lineVertexBuffer=cr.createVertex(t,Cr.STATIC_DRAW,new Int32Array(n.buffer,4*i,o)),i+=o;const a=s[i++];this.lineIndexBuffer=cr.createIndex(t,Cr.STATIC_DRAW,new Uint32Array(s.buffer,4*i,a)),i+=a;const l=this.layer.lineMaterial;this.lineVertexArrayObject=new rn(t,l.getAttributeLocations(),l.getLayoutInfo(),{geometry:this.lineVertexBuffer},this.lineIndexBuffer)}}class nTt extends b8{constructor(t,r){super(t,r),this.type=Fc.FILL,this.fillIndexStart=0,this.fillIndexCount=0,this.outlineIndexStart=0,this.outlineIndexCount=0;const i=new Uint32Array(t);let s=this.bufferDataOffset;this.fillIndexStart=i[s++],this.fillIndexCount=i[s++],this.outlineIndexStart=i[s++],this.outlineIndexCount=i[s++];const n=i[s++];if(n>0){const o=new Map;for(let a=0;a<n;a++){const l=i[s++],c=i[s++],h=i[s++];o.set(l,[c,h])}this.patternMap=o}this.bufferDataOffset=s}hasData(){return this.fillIndexCount>0||this.outlineIndexCount>0}triangleCount(){return(this.fillIndexCount+this.outlineIndexCount)/3}doDestroy(){b(this.fillVertexArrayObject)&&this.fillVertexArrayObject.dispose(),b(this.fillVertexBuffer)&&this.fillVertexBuffer.dispose(),b(this.fillIndexBuffer)&&this.fillIndexBuffer.dispose(),this.fillVertexArrayObject=null,this.fillVertexBuffer=null,this.fillIndexBuffer=null,b(this.outlineVertexArrayObject)&&this.outlineVertexArrayObject.dispose(),b(this.outlineVertexBuffer)&&this.outlineVertexBuffer.dispose(),b(this.outlineIndexBuffer)&&this.outlineIndexBuffer.dispose(),this.outlineVertexArrayObject=null,this.outlineVertexBuffer=null,this.outlineIndexBuffer=null,this.memoryUsed=0}doPrepareForRendering(t,r,i){const s=new Uint32Array(r),n=new Int32Array(s.buffer),o=s[i++];this.fillVertexBuffer=cr.createVertex(t,Cr.STATIC_DRAW,new Int32Array(n.buffer,4*i,o)),i+=o;const a=s[i++];this.fillIndexBuffer=cr.createIndex(t,Cr.STATIC_DRAW,new Uint32Array(s.buffer,4*i,a)),i+=a;const l=s[i++];this.outlineVertexBuffer=cr.createVertex(t,Cr.STATIC_DRAW,new Int32Array(n.buffer,4*i,l)),i+=l;const c=s[i++];this.outlineIndexBuffer=cr.createIndex(t,Cr.STATIC_DRAW,new Uint32Array(s.buffer,4*i,c)),i+=c;const h=this.layer,p=h.fillMaterial,f=h.outlineMaterial;this.fillVertexArrayObject=new rn(t,p.getAttributeLocations(),p.getLayoutInfo(),{geometry:this.fillVertexBuffer},this.fillIndexBuffer),this.outlineVertexArrayObject=new rn(t,f.getAttributeLocations(),f.getLayoutInfo(),{geometry:this.outlineVertexBuffer},this.outlineIndexBuffer)}}class oTt extends b8{constructor(t,r,i){super(t,r),this.type=Fc.SYMBOL,this.iconPerPageElementsMap=new Map,this.glyphPerPageElementsMap=new Map,this.symbolInstances=[],this.isIconSDF=!1,this.opacityChanged=!1,this.lastOpacityUpdate=0,this.symbols=[];const s=new Uint32Array(t),n=new Int32Array(t),o=new Float32Array(t);let a=this.bufferDataOffset;this.isIconSDF=!!s[a++];const l=s[a++];for(let f=0;f<l;f++){const m=s[a++],g=s[a++],v=s[a++];this.iconPerPageElementsMap.set(m,[g,v])}const c=s[a++];for(let f=0;f<c;f++){const m=s[a++],g=s[a++],v=s[a++];this.glyphPerPageElementsMap.set(m,[g,v])}const h=s[a++],p=s[a++];this.iconOpacity=new Int32Array(h),this.textOpacity=new Int32Array(p),a=rTt(s,n,o,a,this.symbols,i),this.bufferDataOffset=a}hasData(){return this.iconPerPageElementsMap.size>0||this.glyphPerPageElementsMap.size>0}triangleCount(){let t=0;for(const[r,i]of this.iconPerPageElementsMap)t+=i[1];for(const[r,i]of this.glyphPerPageElementsMap)t+=i[1];return t/3}doDestroy(){b(this.iconVertexArrayObject)&&this.iconVertexArrayObject.dispose(),b(this.iconVertexBuffer)&&this.iconVertexBuffer.dispose(),b(this.iconOpacityBuffer)&&this.iconOpacityBuffer.dispose(),b(this.iconIndexBuffer)&&this.iconIndexBuffer.dispose(),this.iconVertexArrayObject=null,this.iconVertexBuffer=null,this.iconOpacityBuffer=null,this.iconIndexBuffer=null,b(this.textVertexArrayObject)&&this.textVertexArrayObject.dispose(),b(this.textVertexBuffer)&&this.textVertexBuffer.dispose(),b(this.textOpacityBuffer)&&this.textOpacityBuffer.dispose(),b(this.textIndexBuffer)&&this.textIndexBuffer.dispose(),this.textVertexArrayObject=null,this.textVertexBuffer=null,this.textOpacityBuffer=null,this.textIndexBuffer=null,this.memoryUsed=0}updateOpacityInfo(){if(!this.opacityChanged)return;this.opacityChanged=!1;const t=this.iconOpacity,r=this.iconOpacityBuffer;t.length>0&&t.byteLength===r.size&&r.setSubData(t);const i=this.textOpacity,s=this.textOpacityBuffer;i.length>0&&i.byteLength===s.size&&s.setSubData(i)}doPrepareForRendering(t,r,i){const s=new Uint32Array(r),n=new Int32Array(s.buffer),o=s[i++];this.iconVertexBuffer=cr.createVertex(t,Cr.STATIC_DRAW,new Int32Array(n.buffer,4*i,o)),i+=o;const a=s[i++];this.iconIndexBuffer=cr.createIndex(t,Cr.STATIC_DRAW,new Uint32Array(s.buffer,4*i,a)),i+=a;const l=s[i++];this.textVertexBuffer=cr.createVertex(t,Cr.STATIC_DRAW,new Int32Array(n.buffer,4*i,l)),i+=l;const c=s[i++];this.textIndexBuffer=cr.createIndex(t,Cr.STATIC_DRAW,new Uint32Array(s.buffer,4*i,c)),i+=c,this.iconOpacityBuffer=cr.createVertex(t,Cr.STATIC_DRAW,this.iconOpacity.buffer),this.textOpacityBuffer=cr.createVertex(t,Cr.STATIC_DRAW,this.textOpacity.buffer);const h=this.layer,p=h.iconMaterial,f=h.textMaterial;this.iconVertexArrayObject=new rn(t,p.getAttributeLocations(),p.getLayoutInfo(),{geometry:this.iconVertexBuffer,opacity:this.iconOpacityBuffer},this.iconIndexBuffer),this.textVertexArrayObject=new rn(t,f.getAttributeLocations(),f.getLayoutInfo(),{geometry:this.textVertexBuffer,opacity:this.textOpacityBuffer},this.textIndexBuffer)}}class aTt extends b8{constructor(t,r){super(t,r),this.type=Fc.CIRCLE,this.circleIndexStart=0,this.circleIndexCount=0;const i=new Uint32Array(t);let s=this.bufferDataOffset;this.circleIndexStart=i[s++],this.circleIndexCount=i[s++],this.bufferDataOffset=s}hasData(){return this.circleIndexCount>0}triangleCount(){return this.circleIndexCount/3}doDestroy(){b(this.circleVertexArrayObject)&&this.circleVertexArrayObject.dispose(),b(this.circleVertexBuffer)&&this.circleVertexBuffer.dispose(),b(this.circleIndexBuffer)&&this.circleIndexBuffer.dispose(),this.circleVertexArrayObject=null,this.circleVertexBuffer=null,this.circleIndexBuffer=null,this.memoryUsed=0}doPrepareForRendering(t,r,i){const s=new Uint32Array(r),n=new Int32Array(s.buffer),o=s[i++];this.circleVertexBuffer=cr.createVertex(t,Cr.STATIC_DRAW,new Int32Array(n.buffer,4*i,o)),i+=o;const a=s[i++];this.circleIndexBuffer=cr.createIndex(t,Cr.STATIC_DRAW,new Uint32Array(s.buffer,4*i,a)),i+=a;const l=this.layer.circleMaterial;this.circleVertexArrayObject=new rn(t,l.getAttributeLocations(),l.getLayoutInfo(),{geometry:this.circleVertexBuffer},this.circleIndexBuffer)}}const $Dt=!0,LDt=32,yge=200,lTt=1/he("mapview-transitions-duration");class cTt extends ds{constructor(){super(...arguments),this._fadeOutResolver=null,this._fadeInResolver=null,this._clips=null,this.computedVisible=!0,this.computedOpacity=1,this.fadeTransitionEnabled=!1,this.inFadeTransition=!1,this._isReady=!1,this._opacity=1,this._stage=null,this._visible=!0}get clips(){return this._clips}set clips(t){this._clips=t,this.requestRender()}get isReady(){return this._isReady}get opacity(){return this._opacity}set opacity(t){this._opacity!==t&&(this._opacity=Math.min(1,Math.max(t,0)),this.requestRender())}get stage(){return this._stage}set stage(t){if(this._stage===t)return;const r=this._stage;this._stage=t,t?this._stage.untrashDisplayObject(this)||(this.onAttach(),this.emit("attach")):r.trashDisplayObject(this)}get transforms(){return this._getTransforms()}_getTransforms(){return R(this._transforms)&&(this._transforms=this._createTransforms()),this._transforms}get visible(){return this._visible}set visible(t){this._visible!==t&&(this._visible=t,this.requestRender())}fadeIn(){return this._fadeInResolver||(this._fadeOutResolver&&(this._fadeOutResolver(),this._fadeOutResolver=null),this.computedOpacity=0,this.fadeTransitionEnabled=!0,this._fadeInResolver=vf(),this.requestRender()),this._fadeInResolver.promise}fadeOut(){return this._fadeOutResolver||(this._fadeInResolver&&(this._fadeInResolver(),this._fadeInResolver=null),this.fadeTransitionEnabled=!0,this._fadeOutResolver=vf(),this.requestRender()),this._fadeOutResolver.promise}beforeRender(t){this.updateTransitionProperties(t.deltaTime,t.state.scale)}afterRender(t){this._fadeInResolver&&this.computedOpacity===this.opacity?(this._fadeInResolver(),this._fadeInResolver=null):this._fadeOutResolver&&this.computedOpacity===0&&(this._fadeOutResolver(),this._fadeOutResolver=null)}remove(){var t;(t=this.parent)==null||t.removeChild(this)}setTransform(t){}processRender(t){this.stage&&this.computedVisible&&this.doRender(t)}requestRender(){this.stage&&this.stage.requestRender()}processDetach(){this._fadeInResolver&&(this._fadeInResolver(),this._fadeInResolver=null),this._fadeOutResolver&&(this._fadeOutResolver(),this._fadeOutResolver=null),this.onDetach(),this.emit("detach")}updateTransitionProperties(t,r){if(this.fadeTransitionEnabled){const i=this._fadeOutResolver||!this.visible?0:this.opacity,s=this.computedOpacity;if(s===i)this.computedVisible=this.visible;else{const n=t*lTt;this.computedOpacity=s>i?Math.max(i,s-n):Math.min(i,s+n),this.computedVisible=this.computedOpacity>0;const o=i===this.computedOpacity;this.inFadeTransition=!o,o||this.requestRender()}}else this.computedOpacity=this.opacity,this.computedVisible=this.visible}onAttach(){}onDetach(){}doRender(t){}ready(){this._isReady||(this._isReady=!0,this.emit("isReady"),this.requestRender())}}class Om{constructor(t,r,i,s){this.set(t,r,i,s)}static getId(t,r,i,s){return typeof t=="object"?`${t.level}/${t.row}/${t.col}/${t.world}`:`${t}/${r}/${i}/${s}`}get key(){return this}get id(){return this.toString()}set id(t){this.set(t)}get hash(){const t=4095&this.row,r=4095&this.col,i=63&this.level;return(3&this.world)<<30|r<<22|t<<8|i}acquire(t,r,i,s){this.set(t,r,i,s)}contains(t){const r=t.level-this.level;return this.row===t.row>>r&&this.col===t.col>>r&&this.world===t.world}equals(t){return this.level===t.level&&this.row===t.row&&this.col===t.col&&this.world===t.world}clone(){return new Om(this)}release(){this.level=0,this.row=0,this.col=0,this.world=0}set(t,r,i,s){if(t==null)this.level=0,this.row=0,this.col=0,this.world=0;else if(typeof t=="object")this.level=t.level||0,this.row=t.row||0,this.col=t.col||0,this.world=t.world||0;else if(typeof t=="string"){const[n,o,a,l]=t.split("/");this.level=parseFloat(n),this.row=parseFloat(o),this.col=parseFloat(a),this.world=parseFloat(l)}else this.level=+t,this.row=+r,this.col=+i,this.world=+s||0;return this}toString(){return`${this.level}/${this.row}/${this.col}/${this.world}`}getParentKey(){return this.level<=0?null:new Om(this.level-1,this.row>>1,this.col>>1,this.world)}getChildKeys(){const t=this.level+1,r=this.row<<1,i=this.col<<1,s=this.world;return[new Om(t,r,i,s),new Om(t,r,i+1,s),new Om(t,r+1,i,s),new Om(t,r+1,i+1,s)]}compareRowMajor(t){return this.row<t.row?-1:this.row>t.row?1:this.col<t.col?-1:this.col>t.col?1:0}}Om.pool=new Ls(Om,null,null,25,50);class uTt extends cTt{constructor(t,r,i,s,n,o=s,a=n){super(),this.triangleCountReportedInDebug=0,this.triangleCount=0,this.texture=null,this.key=new Om(t),this.x=r,this.y=i,this.width=s,this.height=n,this.rangeX=o,this.rangeY=a}destroy(){this.texture&&(this.texture.dispose(),this.texture=null)}setTransform(t,r){const i=r/(t.resolution*t.pixelRatio),s=this.transforms.tileMat3,[n,o]=t.toScreenNoRotation([0,0],[this.x,this.y]),a=this.width/this.rangeX*i,l=this.height/this.rangeY*i;_ie(s,a,0,0,0,l,0,n,o,1),mB(this.transforms.dvs,t.displayViewMat3,s)}}class AP extends uTt{constructor(t,r,i,s,n,o,a=null){super(t,r,i,s,n,4096,4096),this._memCache=a,this.type="vector-tile",this._referenced=0,this._hasSymbolBuckets=!1,this._memoryUsedByLayerData=0,this.layerData=new Map,this.layerCount=0,this.status="loading",this.allSymbolsFadingOut=!1,this.lastOpacityUpdate=0,this.symbols=new Map,this.isCoverage=!1,this.neededForCoverage=!1,this.decluttered=!1,this.invalidating=!1,this.parentTile=null,this.childrenTiles=new Set,this._processed=!1,this._referenced=1,this.styleRepository=o,this.id=t.id}get hasSymbolBuckets(){return this._hasSymbolBuckets}get isFading(){return this._hasSymbolBuckets&&performance.now()-this.lastOpacityUpdate<yge}get isHoldingForFade(){return this._hasSymbolBuckets&&(!this.allSymbolsFadingOut||performance.now()-this.lastOpacityUpdate<yge)}get wasRequested(){return this.status==="errored"||this.status==="loaded"||this.status==="reloading"}setData(t){this.changeDataImpl(t),this.requestRender(),this.ready(),this.invalidating=!1,this._processed=!0}deleteLayerData(t){let r=!1;for(const i of t)if(this.layerData.has(i)){const s=this.layerData.get(i);this._memoryUsedByLayerData-=s.memoryUsed,s.type===Fc.SYMBOL&&this.symbols.has(i)&&(this.symbols.delete(i),r=!0),s.destroy(),this.layerData.delete(i),this.layerCount--}b(this._memCache)&&this._memCache.updateSize(this.key.id,this,this._memoryUsedByLayerData),r&&this.emit("symbols-changed"),this.requestRender()}processed(){return this._processed}hasData(){return this.layerCount>0}dispose(){this.status!=="unloaded"&&(v$e.delete(this),AP._destroyRenderBuckets(this.layerData),this.layerData=null,this.layerCount=0,this._memoryUsedByLayerData=0,this.destroy(),this.status="unloaded")}release(){return--this._referenced==0&&(this.dispose(),this.stage=null,!0)}retain(){++this._referenced}get referenced(){return this._referenced}get memoryUsage(){return(this._memoryUsedByLayerData+256)/(this._referenced||1)}changeDataImpl(t){let r=!1;if(t){const{bucketsWithData:i,emptyBuckets:s}=t,n=this._createRenderBuckets(i);if(s&&s.byteLength>0){const o=new Uint32Array(s);for(const a of o)this._deleteLayerData(a)}for(const[o,a]of n)this._deleteLayerData(o),a.type===Fc.SYMBOL&&(this.symbols.set(o,a.symbols),r=!0),this._memoryUsedByLayerData+=a.memoryUsed,this.layerData.set(o,a),this.layerCount++;b(this._memCache)&&this._memCache.updateSize(this.key.id,this,this._memoryUsedByLayerData)}this._hasSymbolBuckets=!1;for(const[i,s]of this.layerData)s.type===Fc.SYMBOL&&(this._hasSymbolBuckets=!0);r&&this.emit("symbols-changed")}attachWithContext(t){this.stage={context:t,trashDisplayObject(r){r.processDetach()},untrashDisplayObject:()=>!1}}setTransform(t,r){super.setTransform(t,r);const i=r/(t.resolution*t.pixelRatio),s=this.width/this.rangeX*i,n=this.height/this.rangeY*i,o=[0,0];t.toScreen(o,[this.x,this.y]);const a=this.transforms.tileUnitsToPixels;bie(a),AV(a,a,o),wie(a,a,Math.PI*t.rotation/180),xie(a,a,[s,n,1])}_createTransforms(){return{dvs:Ky(),tileMat3:Ky(),tileUnitsToPixels:Ky()}}static _destroyRenderBuckets(t){if(!t)return;const r=new Set;t.forEach(i=>{r.has(i)||(i.destroy(),r.add(i))}),t.clear()}_createRenderBuckets(t){const r=new Map,i=new Map;for(const s of t){const n=this._deserializeBucket(s,i);for(const o of n.layerUIDs)r.set(o,n)}return r}_deserializeBucket(t,r){let i=r.get(t);if(i)return i;switch(new Uint32Array(t)[0]){case Fc.FILL:i=new nTt(t,this.styleRepository);break;case Fc.LINE:i=new sTt(t,this.styleRepository);break;case Fc.SYMBOL:i=new oTt(t,this.styleRepository,this);break;case Fc.CIRCLE:i=new aTt(t,this.styleRepository)}return r.set(t,i),i}_deleteLayerData(t){if(!this.layerData.has(t))return;const r=this.layerData.get(t);this._memoryUsedByLayerData-=r.memoryUsed,r.destroy(),this.layerData.delete(t),this.layerCount--}}const v$e=new Map;function hTt(){v$e.forEach((e,t)=>{console.log(`
${t.key}:`),e[0].forEach(r=>console.log(r)),console.log("========"),e[1].forEach(r=>console.log(r))})}const DDt={value:.5,readOnly:!0},dTt={readOnly:!0,value:.5,get(){return this.updating?this.updatingProgressValue:1}};class Zse{constructor(t=0,r=0){this.min=t,this.max=r,this.level=0,this.hasNoDataValues=!1}copyFrom(t){this.min=t.min,this.max=t.max,this.level=t.level,this.hasNoDataValues=t.hasNoDataValues}}class pTt{constructor(t,r,i){this.type="elevation",this.samplerData=null,this.level=t[0],this.i=t[1],this.j=t[2],this.extent=r;const s=i.noDataValue,n=i.values;let o=1/0,a=-1/0,l=!0,c=!1;for(let h=0;h<n.length;h++){const p=n[h];p!==s?(o=p<o?p:o,a=p>a?p:a,l=!1):c=!0}l&&(o=0,a=0),a=a>-3e38?a:0,this.samplerData={pixelData:i.values,width:i.width,height:i.height,noDataValue:s,safeWidth:.99999999*(i.width-1),dx:(i.width-1)/(r[2]-r[0]),dy:(i.width-1)/(r[3]-r[1]),x0:r[0],y1:r[3]},this.bounds=[o,a],this.hasNoDataValues=c}release(){this.samplerData=null,this.bounds=null}computeMinMaxValue(t,r,i,s){s.min=1/0,s.max=-1/0,s.hasNoDataValues=!1;const n=t-this.level;if(n<=0)return s;const o=2**n;if(!(Math.floor(r/o)===this.i&&Math.floor(i/o)===this.j))return s;let a=1/0,l=-1/0;const c=this.samplerData.width,h=this.samplerData.pixelData,p=.5*MI;let f=(c-1)/o,m=(i-this.j*o)*f,g=(r-this.i*o)*f;if(f<1){const v=Math.floor(m),w=Math.floor(g),_=v+w*c,T=h[_],x=h[_+1],E=h[_+c],C=h[_+c+1];if(T+x+E+C<p){const A=m-v,P=g-w,I=FD(T,x,E,C,A,P),L=FD(T,x,E,C,A+f,P),k=FD(T,x,E,C,A,P+f),G=FD(T,x,E,C,A+f,P+f);return s.min=Math.min(I,L,k,G),s.max=Math.max(I,L,k,G),s}m=v,g=w,f=1}else m=Math.floor(m),g=Math.floor(g),f=Math.ceil(f);for(let v=m;v<=m+f;v++)for(let w=g;w<=g+f;w++){const _=h[v+w*c];_<p?(a=Math.min(a,_),l=Math.max(l,_)):s.hasNoDataValues=!0}return s.min=a,s.max=l,s}}function _$e(e,t,r){if(R(r))return null;for(const i of r){if(!i)continue;const s=i.safeWidth;let n=Le(i.dy*(i.y1-t),0,s),o=Le(i.dx*(e-i.x0),0,s);const a=Math.floor(n),l=Math.floor(o),c=i.width,h=a*c+l,p=i.pixelData,f=p[h],m=p[h+1],g=h+c,v=p[g],w=p[g+1];if(f+v+m+w<.5*MI){n-=a,o-=l;const _=f+(m-f)*o;return _+(v+(w-v)*o-_)*n}}return null}function Si(e,t,r){const i=_$e(e,t,r);return b(i)?i:0}let id=class extends xe{constructor(e){super(e),this._handles=new Dt}initialize(){this._handles.add([this.layerViews.on("change",()=>this.notifyChange("stencilEnabledExtents"))])}destroy(){this._handles.destroy(),this._handles=null}get layerViewsExtent(){return this._computeLayerViewsExtent()}get tiledLayersExtent(){return this._computeTiledLayersExtent()}get stencilEnabledExtents(){return this._computeStencilEnabledExtents()}_computeStencilEnabledExtents(){const e=[];return this.layerViews.forEach(t=>{const r=t.layer;if(r.operationalLayerType==="IntegratedMeshLayer"&&this.viewSpatialReference!=null){const i=b$e(r.fullExtent,this.viewSpatialReference);b(i)&&e.push(Ywe(i))}}),e}};function fTt(e,t){return e===Be.Global?new KQ(t):new eJ(t)}u([d({readOnly:!0})],id.prototype,"layerViewsExtent",null),u([d({readOnly:!0})],id.prototype,"tiledLayersExtent",null),u([d({readOnly:!0})],id.prototype,"stencilEnabledExtents",null),u([d()],id.prototype,"viewSpatialReference",void 0),u([d()],id.prototype,"tilingScheme",void 0),u([d()],id.prototype,"defaultTiledLayersExtent",void 0),u([d({constructOnly:!0})],id.prototype,"layers",void 0),u([d({constructOnly:!0})],id.prototype,"layerViews",void 0),id=u([$("esri.views.3d.terrain.ExtentHelper")],id);let KQ=class extends id{_computeLayerViewsExtent(){return this._globalExtent}_computeTiledLayersExtent(){return this._globalExtent}get _globalExtent(){return this.viewSpatialReference.isWebMercator?_Re:Cit}};KQ=u([$("esri.views.3d.terrain.ExtentHelperGlobal")],KQ);let eJ=class extends id{_computeLayerViewsExtent(){const e=vh(),t=this.viewSpatialReference;this.layerViews.forEach(s=>{const n=s.layer;if(s.isResolved()&&(n.type!=="graphics"||!n.internal)){const o=b$e("fullExtentInLocalViewSpatialReference"in s&&s.fullExtentInLocalViewSpatialReference||s.layer.fullExtent,t);Dx(e,o,e)}});const r=BW(e)?e:null,i=this._get("layerViewsExtent");return Nx(r,i)?i:r}_computeTiledLayersExtent(){const e=this.tilingScheme;if(!e)return null;const t=this.viewSpatialReference,r=vh();this.layers.forEach(n=>{if(n.loaded&&aC(n)){const o=_8(n,t,Be.Local);if(R(o))return;const{tileInfo:a,fullExtent:l}=o;b(a)&&b(l)&&(pz(n)||e.compatibleWith(a)&&l.spatialReference.equals(e.spatialReference))&&Dx(r,l,r)}}),Dx(r,this.defaultTiledLayersExtent,r);const i=BW(r)?r:null,s=this._get("tiledLayersExtent");return Nx(i,s)?s:i}};function b$e(e,t){return b(e)&&!e.spatialReference.equals(t)?oTe(e,e.spatialReference,t):e}eJ=u([$("esri.views.3d.terrain.ExtentHelperLocal")],eJ);var Qt;(function(e){e[e.ELEVATION=0]="ELEVATION",e[e.MAP=1]="MAP"})(Qt||(Qt={}));const Lw=[Qt.ELEVATION,Qt.MAP];function w$e(){var t;const e=(t=globalThis.require)==null?void 0:t.modules;if(e){const r=Object.keys(e);for(const i of r)i.search(".glsl")!==-1&&delete e[i]}}const mTt=[[-.1,-2,3.9,2],[-.1,-3.9,3.9,.1],[-2,-3.9,2,.1],[-3.9,-3.9,.1,.1],[-3.9,-2,.1,2],[-3.9,-.1,.1,3.9],[-2,-.1,2,3.9],[-.1,-.1,3.9,3.9]];let pv,Dl=class extends xe{constructor(e){super(e),this._handles=new Dt,this._spatialReference=null,this._renderSR=null,this._overlaySREqualsRenderSR=!0,this._drapeSources=new Set,this._drapeTargets=new Set,this._placementDirty=!1,this._contentUpdated=!1,this._drawTexturesDirty=!1,this._drawTexturesAnimateDirty=!1,this._hasUnusedRenderTargets=!1,this._longitudeCyclical=null,this._latestOriginId=0,this._maxResolution=he("esri-mobile")?2048:4096,this._animationTimeLast=0}get running(){return this._placementDirty&&(this._drapeSources.size>0||this.view.graphics.length>0||Xr.OVERLAY_DRAW_DEBUG_TEXTURE)&&!!this._spatialReference&&!this.suspended&&this.surface.ready}get _isSpherical(){return this.view.state.isGlobal}get _worldToPCSRatio(){return b(this._spatialReference)&&this._spatialReference.isGeographic&&!this.view.state.isLocal?Ar(this._spatialReference).metersPerDegree:1}get view(){return this.surface.view}get updating(){return this.running||this.renderer.updating||this._contentUpdated}get hasHighlights(){return this.renderer.hasHighlights}get rendersOccluded(){return this.renderer.rendersOccluded}initialize(){const e=this.view;this.renderer=new Rp({view:e,worldToPCSRatio:this._worldToPCSRatio,spatialReference:this._spatialReference}),this._groundIntersector=qd(this.view.state.viewingMode),this._groundIntersector.options.backfacesTerrain=!0,this._groundIntersector.options.invisibleTerrain=!0,this._groundIntersector.options.hud=!1,this._handles.add([this.renderer.events.on("has-highlights",()=>{this.setDrawTexturesDirty(),this.notifyChange("hasHighlights")}),this.renderer.events.on("has-water",t=>{var r;return(r=e._stage)==null?void 0:r.renderView.setRenderParameters({hasOverlayWater:t})}),this.renderer.events.on("renders-occluded",()=>{this.setDrawTexturesDirty(),this.notifyChange("rendersOccluded")}),this.renderer.events.on("content-changed",()=>this.setDrawTexturesDirty()),this.renderer.events.on("textures-disposed",()=>this.updateOverlayResult()),te(()=>{var t,r,i;return[(t=e.pointsOfInterest)==null?void 0:t.renderPointOfView,(i=(r=e.pointsOfInterest)==null?void 0:r.centerOnSurfaceFrequent)==null?void 0:i.location]},()=>this.setPlacementDirty()),te(()=>{var t;return(t=e.state)==null?void 0:t.pixelRatio},()=>this.setPlacementDirty(),ei),this.surface.on("elevation-change",()=>this.setPlacementDirty()),e.on("resize",()=>this.setPlacementDirty()),rT({preRender:t=>{this._contentUpdated=!1,this.renderer.processSyncDrapeSources(),this.renderer.hasOverlays&&(this._dispatchAnimationUpdate(t),this._drawOverlayTextures(this.renderer.overlays,Ws.UPDATE)),this._hasUnusedRenderTargets&&this._collectUnusedRenderTargetMemory()}}),e.resourceController.scheduler.registerTask(vt.OVERLAY,this),e._stage.renderView.events.on("force-camera-for-screenshot",t=>{this._updateOverlays(t,Ws.BACKGROUND),this.renderer.hasOverlays&&this._drawOverlayTextures(this.renderer.overlays,Ws.BACKGROUND,t)})])}destroy(){this.renderer.dispose(),this._handles&&(this._handles.destroy(),this._handles=null),b(pv)&&(pv.hide(),pv=null)}get hasOverlays(){return this.renderer.hasOverlays}setSpatialReference(e){this._spatialReference=e,this.renderer.spatialReference=e,this._longitudeCyclical=null;const t=this.view.renderSpatialReference;b(e)&&b(t)?(this._renderSR=t,this._overlaySREqualsRenderSR=e.equals(this._renderSR),this._isSpherical&&(this._longitudeCyclical=e.isWebMercator?new C1(-20037508342787e-6,20037508342787e-6):new C1(-180,180),this.renderer.longitudeCyclical=this._longitudeCyclical),this.renderer&&(this.renderer.worldToPCSRatio=this._worldToPCSRatio)):this.renderer.disposeOverlays()}get gpuMemoryUsage(){return this.renderer.gpuMemoryUsage}registerDrapeSource(e,t,r){this._drapeSources.add(e),this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources);const i=this.renderer.createDrapeSourceRenderer(e,t,r);return this._updateDrapeSourceExtent(e),this._setContentDirty(),this.notifyChange("running"),i}registerGeometryDrapeSource(e){return this.registerDrapeSource(e,xm)}_updateDrapeSourceExtent(e){this.renderer.overlays.length===2&&b(e.setDrapingExtent)&&b(this._spatialReference)&&e.setDrapingExtent(this.renderer.overlays,this._spatialReference)}unregisterDrapeSource(e){this._drapeSources.has(e)&&(this._drapeSources.delete(e),this.renderer.removeDrapeSourceRenderer(e),this.renderer.ensureDrapeSources(this._drapeSources),this._setContentDirty(),this.notifyChange("running"))}registerDrapeTarget(e){this._drapeTargets.add(e),this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources)}updateOverlayResult(){var e;(e=this.view._stage)==null||e.renderView.setRenderParameters({overlays:this.renderer.overlays})}unregisterDrapeTarget(e){this._drapeTargets.delete(e),this.renderer.ensureDrapeTargets(this._drapeTargets)}_setContentDirty(){this.setPlacementDirty(),this.setDrawTexturesDirty()}setPlacementDirty(){this._placementDirty=!0}runTask(){this._updateOverlays(this.view.state.camera,Ws.UPDATE)}_updateOverlays(e,t){if(!this._spatialReference)return;const r=Pmt(e.fullWidth,e.fullHeight,this._maxResolution);this._computeOverlayExtents(e,r,Ug);const i=Ju(Ug.inner)/Ju(Ug.outer);this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources);const s=this._updateOverlay(Gi.INNER,Ug.inner,r,1*Ug.pixelRatioAdjustment,Ug.mapUnitsPerPixel),n=this._updateOverlay(Gi.OUTER,Ug.outer,r,i*Ug.pixelRatioAdjustment,Ug.mapUnitsPerPixel);s!==Sm.EXTENT&&n!==Sm.EXTENT||(this._drapeSources.forEach(o=>this._updateDrapeSourceExtent(o)),this.surface.updateTileOverlayParams(t)),s===Sm.NONE&&n===Sm.NONE||this.setDrawTexturesDirty(),this._placementDirty=!1}_updateOverlay(e,t,r,i,s){if(this.renderer.overlays.length===0)return Sm.NONE;const n=this.renderer.overlays[e],o=n.mapUnitsPerPixel;if(n.mapUnitsPerPixel=s,n.pixelRatio=i,gTt(t,n.extent)&&r===n.resolution)return o===s?Sm.NONE:Sm.RERENDER_ONLY;h0(n.extent,t),n.resolution=r;const a=Vee(n.extent);return n.renderLocalOrigin=bP(a[0],a[1],0,"OV_"+this._latestOriginId++),Sm.EXTENT}setTileParameters(e){const t=e.renderData.overlay;if(this.renderer.overlays.length>0){const r=this.renderer.overlays[Gi.INNER],i=this.renderer.overlays[Gi.OUTER],s=J4(e.extent,this.surface.extent,vge);this._rectInsideRect(r.extent,s)||this._rectanglesOverlap(s,r.extent)||this._rectanglesOverlap(s,i.extent)?(this._setTileOverlayData(s,Gi.INNER,t),this._setTileOverlayData(s,Gi.OUTER,t)):(this._clearTileOverlayData(Gi.INNER,t),this._clearTileOverlayData(Gi.OUTER,t))}else this._clearTileOverlayData(Gi.INNER,t),this._clearTileOverlayData(Gi.OUTER,t)}overlayPixelSizeInMapUnits(e){if(this.renderer.overlays.length===0)return 0;const t=this.renderer.overlays[Gi.INNER],r=this.renderer.overlays[Gi.OUTER],i=this._pointIsInExtent(e,t.extent)?t:r;return(i.extent[2]-i.extent[0])/i.resolution}_setTileOverlayData(e,t,r){if(this.renderer.overlays.length===0)return;const i=this.renderer.overlays[t].extent,s=Ju(i),n=xf(i);let o=e[0];if(this._longitudeCyclical){o=this._longitudeCyclical.minimalMonotonic(i[0],o);const a=this._longitudeCyclical.minimalMonotonic(i[0],e[2]);o>a&&(o=a-(e[2]-e[0]))}r.setScale(t,Ju(e)/s,xf(e)/n),r.setOffset(t,(o-i[0])/s,(e[1]-i[1])/n)}_clearTileOverlayData(e,t){t.setScale(e,-1,-1),t.setOffset(e,-1,-1)}async reloadShaders(){w$e(),await this.renderer.reloadShaders(),this.setDrawTexturesDirty(),this.runTask()}_dispatchAnimationUpdate(e){const t=e.time-this._animationTimeLast;(t>=this.surface.view._stage.renderView.animationTimestep||b(this.forcedAnimationTime)||this._drawTexturesDirty||this._drawTexturesAnimateDirty)&&(this.renderer.updateAnimation({dt:t,forcedTime:this.forcedAnimationTime,camera:this.view.state.camera})&&(this._drawTexturesAnimateDirty=!0),this._animationTimeLast=e.time)}setDrawTexturesDirty(){this.renderer.hasOverlays?(this._contentUpdated=!0,this._drawTexturesDirty=!0):this.setPlacementDirty()}_intersectGroundFromView(e,t,r,i){const s=this.view.sceneIntersectionHelper.getCenterRayWithSubpixelOffset(e,vTt,t,r);if(R(s))return!1;const n=s.origin,o=de(UF,s.origin,s.direction);return this._groundIntersector.reset(n,o,e),this._groundIntersector.intersect([],null),this.view.basemapTerrain.intersect(this._groundIntersector,null,n,o),this._groundIntersector.results.min.getIntersectionPoint(i)}_findHorizonBasedPointOfInterest(e,t){let r=.5;const i=.55,s=this.view.renderCoordsHelper.getAltitude(e.eye),n=this.view.pointsOfInterest.centerOnSurfaceFrequent,o=1e-5,a=Le(n.estimatedSurfaceAltitude,e.aboveGround?-1/0:s+o,e.aboveGround?s-o:1/0),l=e.aboveGround;if(this.view.viewingMode==="global"){const c=UF;dR(C6(A6,Ar(this.view.spatialReference).radius+a),wh(e.eye,e.viewForward),c),pe(c,c,e.eye);const h=A1.normalize(mGe(e.viewForward,c,e.viewRight))/e.fovY+.5,p=h<=0||h>=1?.5:i;r=l?p*h:h+p*(1-h)}else{const c=.5*Math.PI-Math.acos(-e.viewForward[2]),h=Math.tan(c),p=xr(0,h,1,0),f=ih(p,p,e.projectionMatrix)[1],m=Le(.5+.5*f,0,1);r=m===1||m===0?.5:l?m*i:1-(1-m)*i}return!!this._intersectGroundFromView(e,.5,r,t)&&mee(t,e.eye)<n.distance*n.distance}_computeOverlayExtents(e,t,r){const i=this.view.pointsOfInterest.centerOnSurfaceFrequent.renderLocation,s=M();this._findHorizonBasedPointOfInterest(e,s)||ae(s,i);const n=Math.max(.1,pi(e.eye,s)),o=U1(this.view.renderCoordsHelper,i,e.eye),a=Math.PI/2-Math.abs(o-Math.PI/2);Xr.OVERLAY_SHOW_CENTER?(R(pv)&&(pv=new e_(this.view.graphics,"red")),pv.show(s,this._renderSR)):b(pv)&&pv.hide(),this._overlaySREqualsRenderSR||xn(s,this._renderSR,s,this._spatialReference);const l=this.surface.extent,c=!this._isSpherical&&b(this._spatialReference)&&this._spatialReference.isGeographic,h=c&&b(this._spatialReference)?1/Ar(this._spatialReference).metersPerDegree:1,p=e.perRenderPixelRatio*n*h;r.mapUnitsPerPixel=p/this._worldToPCSRatio;let f=t*p/2,m=!1,g=c?90:1/0;this._isSpherical&&b(l)&&b(this._spatialReference)&&(this._spatialReference.isWebMercator?(f/=Math.cos(xU(s[1])),g=l[3]):(m=!0,f/=Ar(this._spatialReference).metersPerDegree,g=90),f>=g&&(f=g,s[1]=0,this._spatialReference.isWebMercator&&(s[0]=0)));let v=1;m&&(v=1/Math.max(.2,Math.cos(Math.abs(Ft(s[1])))),f*v>180&&(v=180/f),r.mapUnitsPerPixel*=v);const w=Math.log(2)/12;f=Math.exp(Math.round(Math.log(f)/w)*w);const _=f*v,T=32,x=.5*t/(T*_),E=.5*t/(T*f);s[0]=Math.round(s[0]*x)/x,s[1]=Math.round(s[1]*E)/E;const C=r.inner;C[0]=s[0]-_,C[1]=s[1]-f,C[2]=s[0]+_,C[3]=s[1]+f,this._isSpherical&&this._shiftExtentToFitBounds(C,1/0,g);const A=r.outer;if(6*_>Ju(l))h0(A,l);else if(a<=.25*Math.PI)A[0]=C[0]-_,A[1]=C[1]-f,A[2]=C[2]+_,A[3]=C[3]+f;else{xn(e.eye,this._renderSR,UF,this._spatialReference),$m(zb,s,UF);let I=-Math.atan2(zb[1],zb[0])+.125*Math.PI;I<0&&(I+=2*Math.PI);const L=Math.floor(I/(.25*Math.PI));H$(zb,mTt[L],2*f),zb[0]*=v,zb[2]*=v,yee(A,C,zb)}if(this._isSpherical)A[0]=this._longitudeCyclical.clamp(A[0]),A[2]=this._longitudeCyclical.clamp(A[2]),A[1]=Math.max(A[1],-g),A[3]=Math.min(A[3],g);else{const I=J4(C,l,vge),L=J4(A,l,yTt);Jae(I,L)&&(A[2]=A[0],A[3]=A[1])}const P=Math.abs(C[2]-C[0])/t;r.mapUnitsPerPixel=Math.max(r.mapUnitsPerPixel,P),r.pixelRatioAdjustment=r.mapUnitsPerPixel/P}_drawOverlayTextures(e,t,r=this.view.state.camera){if(e.length===0||!this._drawTexturesDirty&&!this._drawTexturesAnimateDirty)return;const i=this._drawTexturesDirty;this._drawTexturesDirty=!1,this._drawTexturesAnimateDirty=!1;const s=this._drawOverlay(e[Gi.INNER],r),n=this._drawOverlay(e[Gi.OUTER],r);s!==CA.CHANGED&&n!==CA.CHANGED||this.surface.updateTileOverlayParams(Ws.UPDATE),this._collectUnusedRenderTargetMemory(),this.updateOverlayResult(),i?(this.surface.requestRender(t),t===Ws.UPDATE&&this.surface.requestUpdate()):this.surface.requestRender(Ws.BACKGROUND)}_drawOverlay(e,t){return this._longitudeCyclical?e.setupGeometryViewsCyclical(this._longitudeCyclical):e.setupGeometryViewsDirect(),e.draw(this.renderer,t.pixelRatio)}_collectUnusedRenderTargetMemory(){if(this._hasUnusedRenderTargets=!1,this.renderer.hasOverlays){const e=performance.now();this._hasUnusedRenderTargets=this.renderer.collectUnusedRenderTargetMemory(e)}}_rectanglesOverlap(e,t){return!R(e)&&(this._longitudeCyclical?(this._longitudeCyclical.contains(t[0],t[2],e[0])||this._longitudeCyclical.contains(t[0],t[2],e[2])||this._longitudeCyclical.contains(e[0],e[2],t[0]))&&!(e[1]>t[3]||e[3]<t[1]):X$(e,t))}_rectInsideRect(e,t){return!R(t)&&(this._longitudeCyclical?this._longitudeCyclical.contains(e[0],e[2],t[0])&&this._longitudeCyclical.contains(e[0],e[2],t[2])&&t[1]>e[1]&&t[3]<e[3]:Jae(e,t))}_pointIsInExtent(e,t){if(this._longitudeCyclical)return this._longitudeCyclical.contains(t[0],t[2],e.x)&&e.y>=t[1]&&e.y<=t[3];const r=e.x,i=e.y;return r>t[0]&&r<t[2]&&i>t[1]&&i<t[3]}_shiftExtentToFitBounds(e,t,r){let i=0,s=0;e[0]<-t?i=e[0]+t:e[2]>t&&(i=t-e[2]),e[1]<-r?s=e[1]+r:e[3]>r&&(s=r-e[3]),MU(e,i,s)}get test(){return{renderer:this.renderer,update:()=>this.runTask()}}};function gTt(e,t){const i=Xr.TESTS_DISABLE_OPTIMIZATIONS?0:1e-5*Math.max(e[2]-e[0],e[3]-e[1],t[2]-t[0],t[3]-t[1]);return Math.abs(t[0]-e[0])<=i&&Math.abs(t[1]-e[1])<=i&&Math.abs(t[2]-e[2])<=i&&Math.abs(t[3]-e[3])<=i}u([d()],Dl.prototype,"_spatialReference",void 0),u([d({readOnly:!0})],Dl.prototype,"running",null),u([d()],Dl.prototype,"_placementDirty",void 0),u([d()],Dl.prototype,"_contentUpdated",void 0),u([d()],Dl.prototype,"_isSpherical",null),u([d()],Dl.prototype,"_worldToPCSRatio",null),u([d()],Dl.prototype,"renderer",void 0),u([d({constructOnly:!0})],Dl.prototype,"surface",void 0),u([d({readOnly:!0,aliasOf:"surface.suspended"})],Dl.prototype,"suspended",void 0),u([d({readOnly:!0})],Dl.prototype,"updating",null),u([d({type:Boolean})],Dl.prototype,"hasHighlights",null),u([d({type:Boolean})],Dl.prototype,"rendersOccluded",null),Dl=u([$("esri.views.3d.terrain.OverlayManager")],Dl);const zb=Zt(),UF=M(),Ug={inner:Ut(),outer:Ut(),mapUnitsPerPixel:0,pixelRatioAdjustment:1},vge=Ut(),yTt=Ut(),vTt=Ro();var Sm;(function(e){e[e.NONE=0]="NONE",e[e.EXTENT=1]="EXTENT",e[e.RERENDER_ONLY=2]="RERENDER_ONLY"})(Sm||(Sm={}));class w${constructor(t,r){this._factoryCallback=t,this._lengthCallback=r,this._pool=new Map}acquire(t){if(!w$.test.disabled){const r=this._pool.get(t);if(r&&r.length!==0)return r.pop()}try{return this._factoryCallback(t)}catch(r){const i=window.performance&&window.performance.memory;let s="";throw i&&(s=`
  totalJSHeapSize: ${i.totalJSHeapSize}, usedJSHeapSize: ${i.usedJSHeapSize}, jsHeapSizeLimit: ${i.jsHeapSizeLimit}`),console.log("Array allocation of size "+t+" failed: "+r+s),r}}release(t){if(w$.test.disabled)return;const r=this._lengthCallback(t);let i=this._pool.get(r);i||(i=new Xt({shrink:!0}),this._pool.set(r,i)),i.push(t)}clear(){this._pool.clear()}get test(){return{size:this._pool.size}}}w$.test={disabled:!1};class _Tt{constructor(){this.indices=null,this.vertexAttributes=null,this.boundingBox=vi(),this.indexCount=0,this.numVerticesPerSide=0,this.uvOffsetAndScale=Zt(),this.outerEdges=[null,null,null,null],this.innerEdges=[null,null,null,null]}}class _ge{constructor(t,r,i,s,n){this._buf=t,this._localOrigin=r,this.offset0=i,this.stride=s,this.count=n}getVertexOffset(t){return 0<=t&&t<this.count,this.offset0+this.stride*t}getVertex(t,r){const i=this.getVertexOffset(r)*od;t[0]=this._buf[i+0]+this._localOrigin[0],t[1]=this._buf[i+1]+this._localOrigin[1],t[2]=this._buf[i+2]+this._localOrigin[2]}getVertexZ(t){const r=this.getVertexOffset(t)*od;return this._buf[r+2]+this._localOrigin[2]}setVertex(t,r,i,s){const n=this.getVertexOffset(t)*od;this._buf[n+0]=r[0]-this._localOrigin[0],this._buf[n+1]=r[1]-this._localOrigin[1],this._buf[n+2]=r[2]-this._localOrigin[2],this._buf[n+3]=i,this._buf[n+4]=s}getNormal(t,r){const i=this.getVertexOffset(r)*od;t[0]=this._buf[i+5],t[1]=this._buf[i+6],t[2]=this._buf[i+7]}setVertexRawXYZUV(t,r,i,s,n,o){const a=this.getVertexOffset(t)*od;this._buf[a+0]=r,this._buf[a+1]=i,this._buf[a+2]=s,this._buf[a+3]=n,this._buf[a+4]=o}setVertexRawXYZUVN(t,r,i,s,n,o,a,l,c){const h=this.getVertexOffset(t)*od;this._buf[h+0]=r,this._buf[h+1]=i,this._buf[h+2]=s,this._buf[h+3]=n,this._buf[h+4]=o,this._buf[h+5]=a,this._buf[h+6]=l,this._buf[h+7]=c}setVertexRawNormal(t,r,i,s){const n=this.getVertexOffset(t)*od;this._buf[n+5]=r,this._buf[n+6]=i,this._buf[n+7]=s}getVertexRawNormal(t,r){const i=this.getVertexOffset(r)*od;t[0]=this._buf[i+5],t[1]=this._buf[i+6],t[2]=this._buf[i+7]}}const bTt=ps().vec3f(O.POSITION).vec2f(O.UV0).vec3f(O.NORMAL),Yse=new w$(e=>bTt.createBuffer(e),e=>e.count);function wTt(){Yse.clear()}function x$e(e){return Yse.acquire(e)}function xTt(e){Yse.release(e.vertexAttributes),e.vertexAttributes=null,e.indices=null}class TTt{constructor(){this.sinLonLUT=new Array(GY+1),this.cosLonLUT=new Array(GY+1)}update(t,r){const i=r[0],s=r[2];for(let n=0;n<=t;n++){const o=n/t,a=i*(1-o)+s*o;this.sinLonLUT[n]=Math.sin(a),this.cosLonLUT[n]=Math.cos(a)}}}class VF{constructor(){this.elevation=0,this.normal=[0,0,1],this.cornerTiles=[null,null,null,null]}}class STt{constructor(){this.edgeNeighbours=[null,null,null,null],this.cornerNeighborData=[new VF,new VF,new VF,new VF],this.edgeResolutions=[1,1,1,1],this.modifiedEdgeResolutions=[!1,!1,!1,!1]}}class ETt{constructor(){this.numVerticesPerSide=0,this.samplerData=null,this.clippingArea=null,this.wireframe=!1,this.samplerDataVersion=0,this.neighborData=new STt}}class xC{constructor(t){this._getFadeDuration=t,this._fadeStart=0,this._delayedTime=0}clear(){this._current=ct(this._current),this._next=ct(this._next),this._waiting=ct(this._waiting),this._delayed=ct(this._delayed)}get current(){if(R(this._current))return null;if(!this._isFadingEnabled){const r=this._delayed||this._waiting||this._next||this._current;r!==this._current&&(this._current=null,this.clear(),this._current=r)}let t=xC.test.fadeMoment;if(b(this._delayed)&&(t=t||performance.now(),t>=this._delayedTime&&(this._push(this._delayed,e0.Immediate),this._delayed=null)),b(this._next)){t=t||performance.now();const r=this._fadeDuration,i=b(this._current)&&this._next.texture===this._current.texture,s=this._next.type!==ro.FADING,n=t-this._fadeStart>=r;(i||s||n)&&(ct(this._current),this._current=this._next,this._next=this._waiting,this._waiting=null,this._fadeStart=this._alignFadeStart(t))}return this._current}get next(){return this._next}get fadeFactor(){if(R(this._next))return 1;const t=xC.test.fadeMoment||performance.now(),r=Math.max(0,t-this._fadeStart),i=this._fadeDuration;return r>i?0:1-r/i}get isFading(){return b(this._next)||b(this._delayed)}push(t,r=e0.Immediate){this._delayed=ct(this._delayed),this._push(t,r)}_push(t,r){if(this._isFadingEnabled||this.clear(),R(this._current))return void(this._current=t);const i=xC.test.fadeMoment||performance.now();return r!==e0.Immediate?(this._delayed=t,void(this._delayedTime=i+r)):R(this._next)?(this._next=t,void(this._fadeStart=this._alignFadeStart(i))):void(R(t)||(ct(this._waiting),this._waiting=t))}get _fadeDuration(){return R(this._waiting)?this._getFadeDuration():.5*this._getFadeDuration()}_alignFadeStart(t){const r=this._getFadeDuration();return t+r-t%r}get _isFadingEnabled(){return this._getFadeDuration()>0}}var e0;xC.test={fadeMoment:0},function(e){e[e.Immediate=0]="Immediate",e[e.Delayed=5e3]="Delayed"}(e0||(e0={}));class T$e{constructor(){this._queue=new Xt,this._last=null,this.remove=()=>{}}get done(){return this._queue.length===0&&(!this._last||this._last.isLeaf)}resetOne(t){this._queue.clear(),this._queue.push(t),this._last=null}reset(t=null){this._queue.clear(),b(t)&&this._queue.pushArray(t),this._last=null}skipSubtree(){this._last=null}next(){return this._last&&!this._last.isLeaf&&this._queue.pushArray(this._last.children),this._last=this._queue.pop(),this._last}}class CTt{constructor(){this.q=new Xt}get done(){return this.q.length===0}reset(t){if(this.q.clear(),!R(t)){this.q.pushArray(t);for(let r=0;r<this.q.length;++r){const i=this.q.data[r];i.isLeaf||this.q.pushArray(i.children)}}}next(){return this.q.pop()}}function RP(e,t,r){if(R(t)||R(t.fullExtent))return!1;const i=t.fullExtent,s=e.extent;if(r){if(s[0]<i.xmin||s[1]<i.ymin||s[2]>i.xmax||s[3]>i.ymax)return!1}else if(i.xmin>s[2]||i.ymin>s[3]||i.xmax<s[0]||i.ymax<s[1])return!1;const n=e.surface.tilingScheme.levels[e.level].scale;return!(t.minScale>0&&n>1.00000001*t.minScale)&&!(t.maxScale>0&&n<.99999999*t.maxScale)}function S$e(e,t){return e.lij[0]-t.lij[0]||e.lij[1]-t.lij[1]||e.lij[2]-t.lij[2]}function E$e(e,t){t.sort((r,i)=>C$e(r,i,e))}function C$e(e,t,r){const i=e.screenDepth,s=t.screenDepth;return i<s?-r:i>s?r:S$e(e,t)}function ATt(e,t){const r=new Map;e.forAll(i=>r.set(i.lij,i.distanceToSquared(t))),e.sort((i,s)=>r.get(i.lij)-r.get(s.lij)||S$e(i,s))}function RTt(e,t,r){let i=1,s=0,n=0;for(;e!==t;)if(i*=.5,s*=.5,n*=.5,1&e.lij[2]&&(s+=.5),(1&e.lij[1])==0&&(n+=.5),(e=e.parent)==null)throw new Error("tile was not a descendant of upsampleTile");r.init(t,s,n,i)}function OTt(e){for(let t=0;t<e.length;t++){const r=e[t],i=r.parent;if(i)for(let s=0;s<4;s++){const n=i.children[s];if(n&&n!==r&&n.loadable)return!0}}return!1}function NDt(e,t){if(!e||!t||e[0]===t[0])return!1;const r=e[0]<t[0],i=r?e:t,s=r?t:e,n=1<<s[0]-i[0];return Math.floor(s[1]/n)===i[1]&&Math.floor(s[2]/n)===i[2]}class Qse{get updating(){return!!this._tileRequested}init(t,r,i,s){this.tile=t,this._layerIdx=r,this._layerClass=i,this._suspended=s,this._tileLayerInfo=t.getLayerInfo(r,i),this._tileRequested=null;const n=this._findAncestorWithData();this._setUpsampleTile(n)}startLoading(){return this._requestNext()}dispose(){this._tileRequested&&(this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null),this.tile=null,this._tileLayerInfo=null}setSuspension(t){t!==this._suspended&&(this._suspended=t,t?this._tileRequested&&(this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null):this._tileLayerInfo.data||this.update())}update(){const t=this._findAncestorWithData();return this._setUpsampleTile(t),this._requestNext()}dataArrived(t){this._setUpsampleTile(t),this._tileRequested=null,t===this.tile?this.tile.updateRenderData(this._layerClass,ro.FADING):this._requestNext()}dataMissing(){this._tileRequested=null,this._tileLayerInfo.data=null,this._requestNext()}_agentDone(){this.tile.agentDone(this._layerIdx,this._layerClass),this.dispose()}_requestNext(){if(this._suspended)return!0;const t=this._findNextDownload();if(this._tileRequested){if(t===this._tileRequested)return!0;this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null}return b(t)?t.requestLayerData(this._layerIdx,this._layerClass,this)&&(this._tileRequested=t):this._agentDone(),!!this._tileRequested}_findNextDownload(){const t=this._layerIdx,r=this._layerClass,i=this.tile.surface.layerViewByIndex(t,r),s=YQ(i),{minLevel:n,maxLevel:o}=i.dataLevelRange,a=this._desiredMinLevelDelta,l=this._progressiveLevelModulo+a,c=this._scaleRangeEnabled?RP:()=>!0;let h=this.tile;const p=h.level;let f;const m=this._tileLayerInfo.upsampleInfo,g=b(m)?m.tile.level:-1,v=!!b(m)&&g-p>=a,w=ki(s,"tilemapCache");for(;h&&c(h,s,!1)&&h.level>=n;){const _=h.level,T=p-_,x=h.layerInfo[r][t];if(x.data&&T>=a){(!v||_>g)&&this._setUpsampleTile(h),x.dataInvalidated&&(f=h);break}if((R(w)||w.getAvailability(h.lij[0],h.lij[1],h.lij[2])!=="unavailable")&&_<=o&&!x.data&&!x.dataMissing&&((R(f)||h.level===n||_%vRe==0||p-f.level<a)&&(f=h),T>=l))break;h=h.parent}return b(f)&&p-f.level<a&&this._tileLayerInfo.upsampleInfo&&(f=null),f}_findAncestorWithData(){const t=this.tile.vlevel,r=this._desiredMinLevelDelta;let i;for(let s=this.tile;s;s=s.parent)if(s.hasLayerData(this._layerIdx,this._layerClass)){if(t-s.level>=r)return s;i=s}return i}_setUpsampleTile(t){this._tileLayerInfo.setUpsampleInfo(this.tile,t),this.tile.updateRenderData(this._layerClass,ro.FADING)}get test(){return{findNextDownload:()=>this._findNextDownload(),tileLayerInfo:this._tileLayerInfo}}}class MTt extends Qse{get _desiredMinLevelDelta(){throw bge}get _progressiveLevelModulo(){throw bge}dispose(){}}const bge=new Error("Abstract method called on TileAgent"),vc=new MTt;class A$e extends Qse{constructor(){super(...arguments),this._scaleRangeEnabled=!1}get _desiredMinLevelDelta(){return k5(this.tile.level)-(this.tile.vlevel-this.tile.level)}get _progressiveLevelModulo(){return 0}}class R$e extends Qse{constructor(){super(),this._scaleRangeEnabled=!0}get _desiredMinLevelDelta(){return 0}get _progressiveLevelModulo(){return vRe}}var Zx,kT;(function(e){e[e.Stretch=0]="Stretch",e[e.Lut=1]="Lut",e[e.Hillshade=2]="Hillshade",e[e.COUNT=3]="COUNT"})(Zx||(Zx={})),function(e){e[e.Noop=0]="Noop",e[e.PerBand=1]="PerBand",e[e.COUNT=2]="COUNT"}(kT||(kT={}));var wge,Ne;(function(e){e[e.OneMinusSourceAlpha=0]="OneMinusSourceAlpha",e[e.SourceAlpha=1]="SourceAlpha",e[e.COUNT=2]="COUNT"})(wge||(wge={})),function(e){e[e.Normal=0]="Normal",e[e.Average=1]="Average",e[e.Lighten=2]="Lighten",e[e.Lighter=3]="Lighter",e[e.Plus=4]="Plus",e[e.Screen=5]="Screen",e[e.ColorDodge=6]="ColorDodge",e[e.Darken=7]="Darken",e[e.Multiply=8]="Multiply",e[e.ColorBurn=9]="ColorBurn",e[e.Overlay=10]="Overlay",e[e.SoftLight=11]="SoftLight",e[e.HardLight=12]="HardLight",e[e.VividLight=13]="VividLight",e[e.Hue=14]="Hue",e[e.Saturation=15]="Saturation",e[e.Luminosity=16]="Luminosity",e[e.Color=17]="Color",e[e.DestinationOver=18]="DestinationOver",e[e.DestinationAtop=19]="DestinationAtop",e[e.DestinationIn=20]="DestinationIn",e[e.DestinationOut=21]="DestinationOut",e[e.SourceAtop=22]="SourceAtop",e[e.SourceIn=23]="SourceIn",e[e.SourceOut=24]="SourceOut",e[e.Xor=25]="Xor",e[e.Difference=26]="Difference",e[e.Exclusion=27]="Exclusion",e[e.Minus=28]="Minus",e[e.Invert=29]="Invert",e[e.Reflect=30]="Reflect",e[e.COUNT=31]="COUNT"}(Ne||(Ne={}));const fk={normal:Ne.Normal,average:Ne.Average,lighten:Ne.Lighten,lighter:Ne.Lighter,screen:Ne.Screen,plus:Ne.Plus,"color-dodge":Ne.ColorDodge,darken:Ne.Darken,multiply:Ne.Multiply,"color-burn":Ne.ColorBurn,overlay:Ne.Overlay,"soft-light":Ne.SoftLight,"hard-light":Ne.HardLight,"vivid-light":Ne.VividLight,hue:Ne.Hue,saturation:Ne.Saturation,luminosity:Ne.Luminosity,color:Ne.Color,difference:Ne.Difference,exclusion:Ne.Exclusion,minus:Ne.Minus,invert:Ne.Invert,reflect:Ne.Reflect,"destination-over":Ne.DestinationOver,"destination-atop":Ne.DestinationAtop,"destination-in":Ne.DestinationIn,"destination-out":Ne.DestinationOut,"source-atop":Ne.SourceAtop,"source-in":Ne.SourceIn,"source-out":Ne.SourceOut,xor:Ne.Xor};function PTt(e){return e===Ne.DestinationOver||e===Ne.DestinationAtop||e===Ne.DestinationIn||e===Ne.DestinationOut||e===Ne.SourceAtop||e===Ne.SourceIn||e===Ne.SourceOut||e===Ne.Xor}function ITt(e){e.fragment.uniforms.add([new Ht("u_colormap",t=>t.u_colormap),new qe("u_colormapOffset",t=>t.colormap.u_colormapOffset),new qe("u_colormapMaxIndex",t=>t.colormap.u_colormapMaxIndex),new qe("u_opacity",t=>t.common.u_opacity)]),e.fragment.code.add(S`vec4 colormap(vec4 currentPixel, bool isFloat) {
float clrIndex = isFloat ? currentPixel.r - u_colormapOffset : currentPixel.r * 255.0 - u_colormapOffset;
vec4 result;
if (currentPixel.a == 0.0 || clrIndex > u_colormapMaxIndex) {
result = vec4(0.0, 0.0, 0.0, 0.0);
} else {
vec2 clrPosition = vec2((clrIndex + 0.5) / (u_colormapMaxIndex + 1.0), 0.0);
result = texture2D(u_colormap, clrPosition);
}
return result;
}`)}function $Tt(e){e.fragment.uniforms.add(new Ht("u_transformGrid",t=>t.u_transformGrid)),e.fragment.uniforms.add(new _r("u_transformSpacing",t=>t.common.u_transformSpacing)),e.fragment.uniforms.add(new _r("u_transformGridSize",t=>t.common.u_transformGridSize)),e.fragment.uniforms.add(new _r("u_targetImageSize",t=>t.common.u_targetImageSize)),e.fragment.code.add(S`vec2 projectPixelLocation(vec2 coords) {
vec2 index_image = floor(coords * u_targetImageSize);
vec2 oneTransformPixel = vec2(0.25 / u_transformGridSize.s, 1.0 / u_transformGridSize.t);
vec2 index_transform = floor(index_image / u_transformSpacing) / u_transformGridSize;
vec2 pos = fract((index_image + vec2(0.5, 0.5)) / u_transformSpacing);
vec2 srcLocation;
vec2 transform_location = index_transform + oneTransformPixel * 0.5;
if (pos.s <= pos.t) {
vec4 ll_abc = texture2D(u_transformGrid, vec2(transform_location.s, transform_location.t));
vec4 ll_def = texture2D(u_transformGrid, vec2(transform_location.s + oneTransformPixel.s, transform_location.t));
srcLocation.s = dot(ll_abc.rgb, vec3(pos, 1.0));
srcLocation.t = dot(ll_def.rgb, vec3(pos, 1.0));
} else {
vec4 ur_abc = texture2D(u_transformGrid, vec2(transform_location.s + 2.0 * oneTransformPixel.s, transform_location.t));
vec4 ur_def = texture2D(u_transformGrid, vec2(transform_location.s + 3.0 * oneTransformPixel.s, transform_location.t));
srcLocation.s = dot(ur_abc.rgb, vec3(pos, 1.0));
srcLocation.t = dot(ur_def.rgb, vec3(pos, 1.0));
}
return srcLocation;;
}`)}class O$e extends nn{constructor(){super(...arguments),this.scale=1,this.offset=zd}}function M$e(e){e.attributes.add(O.POSITION,"vec2"),e.attributes.add(O.UV0,"vec2"),e.vertex.uniforms.add(new qe("scale",t=>t.scale)),e.vertex.uniforms.add(new _r("offset",t=>t.offset)),e.varyings.add("uv","vec2"),e.varyings.add("vuv","vec2"),e.vertex.code.add(S`void main(void) {
gl_Position = vec4(position, 0.0, 1.0);
uv = uv0 * scale + offset;
vuv = uv0;
}`)}class LTt extends O$e{constructor(t,r,i){super(),this.common=t,this.u_image=r,this.u_transformGrid=i}}function DTt(e){e.include($Tt),e.fragment.uniforms.add([new Ht("u_image",t=>t.u_image),new wT("u_flipY",t=>t.common.u_flipY),new wT("u_applyTransform",t=>t.common.u_applyTransform)]),e.fragment.code.add(S`vec2 getPixelLocation(vec2 coords) {
vec2 targetLocation = u_flipY ? vec2(coords.s, 1.0 - coords.t) : coords;
if (!u_applyTransform) {
return targetLocation;
}
return projectPixelLocation(targetLocation);
}
bool isOutside(vec2 coords){
if (coords.t>1.00001 ||coords.t<-0.00001 || coords.s>1.00001 ||coords.s<-0.00001) {
return true;
} else {
return false;
}
}
vec4 getPixel(vec2 pixelLocation) {
return texture2D(u_image, pixelLocation);
}`)}function Jse(e){e.code.add(S`
    float lineFactorAtPosition(float value) {
      float pos = value * ${S.float(257)};
      if(pos < 0.5 || pos > ${S.float(257-.5)}) {
        return 1.0;
      }

      pos = pos + 0.5;
      float modulo = mod(pos, 16.0);
      return modulo <= 2.0 ?  1.0 - abs(modulo - 1.0) : 0.0;
    }

    float lineFactorAtUV(vec2 uv) {
      return max(lineFactorAtPosition(uv.x), lineFactorAtPosition(uv.y));
    }

    float lineFactor(vec2 uv) {
      vec2 offset = fwidth(uv) * 0.25;
      return (lineFactorAtUV(vec2(uv.x + offset.x, uv.y + offset.y)) +
              lineFactorAtUV(vec2(uv.x - offset.x, uv.y + offset.y)) +
              lineFactorAtUV(vec2(uv.x + offset.x, uv.y - offset.y)) +
              lineFactorAtUV(vec2(uv.x - offset.x, uv.y - offset.y))) / 4.0;
    }

    vec4 gridColor(vec2 uv) {
      float line = lineFactor(uv) * 0.1 + 0.9;
      return vec4(vec3(1.0, 0.972, 0.918) * line, 1.0);
    }`)}var na;(function(e){e[e.LayerOnly=0]="LayerOnly",e[e.ColorComposite=1]="ColorComposite",e[e.GridComposite=2]="GridComposite",e[e.COUNT=3]="COUNT"})(na||(na={}));function P$e(e,t){const r=t.blendMode;r!==Ne.Normal&&(r===Ne.Reflect&&e.code.add(S`float reflectBlend(in float cb, in float cl) {
return (cl == 1.0) ? cl : min(cb * cb / (1.0 - cl), 1.0);
}`),r!==Ne.ColorDodge&&r!==Ne.VividLight||e.code.add(S`float colorDodge(in float cb, in float cl) {
return (cb == 0.0) ? 0.0 : (cl == 1.0) ? 1.0 : min(1.0, cb / (1.0 - cl));
}`),r!==Ne.ColorBurn&&r!==Ne.VividLight||e.code.add(S`float colorBurn(in float cb, in float cl) {
return (cb == 1.0) ? 1.0 : (cl == 0.0) ? 0.0 : 1.0 - min(1.0, (1.0 - cb) / cl);
}`),r===Ne.Overlay&&e.code.add(S`float overlay(in float cb, in float cl) {
return (1.0 - step(0.5, cl)) * (1.0 - 2.0 * (1.0 - cl ) * (1.0 - cb)) + step(0.5, cl) * (2.0 * cl * cb);
}`),r===Ne.HardLight&&e.code.add(S`float hardLight(in float cb, in float cl) {
return (1.0 - step(0.5, cl)) * (2.0 * cl * cb) + step(0.5, cl) * (1.0 - 2.0 * (1.0 - cl) * (1.0 - cb));
}`),r===Ne.SoftLight&&e.code.add(S`float softLight(in float cb, in float cl) {
if (cl <= 0.5) {
return cb - (1.0 - 2.0 * cl) * cb * (1.0 - cb);
}
if (cb <= 0.25) {
return cb + (2.0 * cl - 1.0) * cb * ((16.0 * cb - 12.0) * cb + 3.0);
}
return cb + (2.0 * cl - 1.0) * (sqrt(cb) - cb);
}`),r===Ne.VividLight&&e.code.add(S`float vividLight(in float cb, in float cl) {
return (1.0 - step(0.5, cl)) * colorBurn(cb, 2.0 * cl) + step(0.5, cl) * colorDodge(cb, (2.0 * (cl - 0.5)));
}`),r!==Ne.Hue&&r!==Ne.Saturation&&r!==Ne.Color&&r!==Ne.Luminosity||(e.code.add(S`float minv3(in vec3 c) {
return min(min(c.r, c.g), c.b);
}
float maxv3(in vec3 c) {
return max(max(c.r, c.g), c.b);
}
float lumv3(in vec3 c) {
return dot(c, vec3(0.3, 0.59, 0.11));
}
vec3 clipColor(vec3 color) {
float lum = lumv3(color);
float mincol = minv3(color);
float maxcol = maxv3(color);
if (mincol < 0.0) {
color = lum + ((color - lum) * lum) / (lum - mincol);
}
if (maxcol > 1.0) {
color = lum + ((color - lum) * (1.0 - lum)) / (maxcol - lum);
}
return color;
}
vec3 setLum(vec3 cbase, vec3 clum) {
return clipColor(cbase + vec3(lumv3(clum) - lumv3(cbase)));
}`),r!==Ne.Hue&&r!==Ne.Saturation||e.code.add(S`float satv3(vec3 c) {
return maxv3(c) - minv3(c);
}
vec3 setLumSat(vec3 cbase, vec3 csat, vec3 clum)
{
float minbase = minv3(cbase);
float sbase = satv3(cbase);
float ssat = satv3(csat);
return setLum(sbase > 0.0 ? (cbase - minbase) * ssat / sbase : vec3(0.0), clum);
}`)),e.code.add(S`
    vec4 applyBlendMode(vec3 cl, float ol, vec3 cb, float ob) {
      ${r===Ne.Multiply?S`return vec4(cl * ol * cb * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Ne.Average?S`return vec4((cb + cl) * 0.5 * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Ne.Lighten?S`return vec4(max(cb, cl) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Ne.Darken?S`return vec4(min(cl, cb) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Ne.Lighter?S`return vec4(cl * ol + cb * ob, ol + ob);`:r===Ne.Plus?S`return clamp(vec4(cl.rgb + cb.rgb, ol + ob), 0.0, 1.0);`:r===Ne.Minus?S`return vec4(clamp(vec3(cb.rgb - cl.rgb), 0.0, 1.0), ob * ol);`:r===Ne.Screen?S`return vec4((cl + cb - cl * cb) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Ne.Difference?S`return vec4(abs(cb - cl) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Ne.Invert?S`return vec4((1.0 - cb) * ol * ob + cb * ob * (1.0 - ol), ob);`:r===Ne.DestinationOver?S`return vec4(cl * ol * (1.0 - ob) + cb * ob, ol + ob - ol * ob);`:r===Ne.DestinationAtop?S`return vec4(cl * ol * (1.0 - ob) + cb * ob * ol, ol);`:r===Ne.DestinationOut?S`return vec4(cb * ob * (1.0 - ol), ob * (1.0 - ol));`:r===Ne.SourceAtop?S`return vec4(cl * ol * ob + cb * ob * (1.0 - ol), ob);`:r===Ne.SourceOut?S`return vec4(cl * ol * (1.0 - ob), ol * (1.0 - ob));`:r===Ne.Xor?S`return vec4(cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), ol * (1.0 - ob) + ob * (1.0 - ol));`:r===Ne.DestinationIn?S`return vec4(cb * ob * ol, ol * ob);`:r===Ne.SourceIn?S`return vec4(cl * ol * ob, ol * ob);`:r===Ne.Hue?S`
          vec3 f = setLumSat(cl, cb, cb);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Ne.Saturation?S`
          vec3 f = setLumSat(cb, cl, cb);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Ne.Color?S`
          vec3 f = setLum(cl, cb);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Ne.Luminosity?S`
          vec3 f = setLum(cb, cl);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Ne.Exclusion?S`
          vec3 f = cl + cb - 2.0 * cl * cb;
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Ne.Reflect?S`
          vec3 f = vec3(reflectBlend(cb.r, cl.r), reflectBlend(cb.g, cl.g), reflectBlend(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Ne.ColorDodge?S`
          vec3 f = vec3(colorDodge(cb.r, cl.r), colorDodge(cb.g, cl.g), colorDodge(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Ne.ColorBurn?S`
          vec3 f = vec3(colorBurn(cb.r, cl.r), colorBurn(cb.g, cl.g), colorBurn(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Ne.Overlay?S`
          vec3 f = vec3(overlay(cb.r, cl.r), overlay(cb.g, cl.g), overlay(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Ne.SoftLight?S`
          vec3 f = vec3(softLight(cb.r, cl.r), softLight(cb.g, cl.g), softLight(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Ne.HardLight?S`
          vec3 f = vec3(hardLight(cb.r, cl.r), hardLight(cb.g, cl.g), hardLight(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Ne.VividLight?S`
          vec3 f = vec3(vividLight(cb.r, cl.r), vividLight(cb.g, cl.g), vividLight(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:S``}
    }
  `))}var Mo,Dn;function NTt(e){const t=new Yr,r=e.output===Mo.GridOnly,i=e.output===Mo.GridComposite,s=i||r,n=e.output===Mo.ColorOnly,o=e.output===Mo.ColorComposite,a=o||n,l=i||o;if(t.include(M$e),a&&t.fragment.uniforms.add(new St("backgroundColor",m=>m.backgroundColor)),e.baseOpacityMode!==Dn.One&&t.fragment.uniforms.add(new qe("baseOpacity",m=>m.baseOpacity)),s&&(t.extensions.add("GL_OES_standard_derivatives"),t.fragment.include(Jse)),r||n)return t.fragment.code.add(S`
    void main() {
      gl_FragColor = ${n?S`vec4(backgroundColor, 1.0)`:S`gridColor(uv)`};
    }
  `),t;const c=e.blendMode!==Ne.Normal,h=e.baseOpacityMode===Dn.OnBaseLayer,p=e.baseOpacityMode===Dn.OnBackground||e.baseOpacityMode===Dn.OnBaseLayer,f=e.premultipliedSource;return t.fragment.uniforms.add(new Ht("tex",m=>m.texture)),t.fragment.uniforms.add(new qe("opacity",m=>m.opacity)),(c||h||f)&&(t.fragment.uniforms.add(new Ht("fboColor",m=>m.fboTexture)),t.fragment.uniforms.add(new qe("tileSize",m=>b(m.fboTexture)?m.fboTexture.descriptor.width:1))),t.fragment.include(P$e,e),t.fragment.code.add(S`
    void main() {
      ${l||h||f?S`
      vec4 bgColor = ${o?S`vec4(backgroundColor, 1.0)`:i?S`gridColor(uv)`:S`texture2D(fboColor, gl_FragCoord.xy / tileSize)`};
      ${p?S`bgColor *= baseOpacity;`:""}`:""}
      vec4 colorLayer = texture2D(tex, uv);
      ${c?S`
          vec4 fboTex = ${l?S`bgColor;`:S`texture2D(fboColor, gl_FragCoord.xy / tileSize) ${h?" * baseOpacity":""};`}
          vec3 Cb = fboTex.a == 0.0 ? fboTex.rgb : vec3(fboTex.rgb * fboTex.a);
          gl_FragColor = applyBlendMode(colorLayer.rgb, colorLayer.a * opacity, Cb, fboTex.a);`:S`
          vec4 pmColorLayer = vec4(colorLayer.xyz, 1.0);
          float composeAlpha = colorLayer.a * opacity;
          gl_FragColor = ${f?S`bgColor * (1.0 - composeAlpha) + colorLayer * opacity;`:l||h?S`mix(bgColor, pmColorLayer, composeAlpha);`:S`pmColorLayer * composeAlpha;`}`}
    }
  `),t}(function(e){e[e.Composite=0]="Composite",e[e.ColorOnly=1]="ColorOnly",e[e.GridOnly=2]="GridOnly",e[e.ColorComposite=3]="ColorComposite",e[e.GridComposite=4]="GridComposite",e[e.COUNT=5]="COUNT"})(Mo||(Mo={})),function(e){e[e.One=0]="One",e[e.OnBackground=1]="OnBackground",e[e.OnBaseLayer=2]="OnBaseLayer",e[e.COUNT=3]="COUNT"}(Dn||(Dn={}));const FTt=Object.freeze(Object.defineProperty({__proto__:null,get BlendLayersOutput(){return Mo},get BaseOpacityMode(){return Dn},build:NTt},Symbol.toStringTag,{value:"Module"}));class w8 extends LTt{constructor(t,r,i,s,n,o){super(t,s,n),this.colormap=r,this.symbolizer=i,this.u_colormap=o,this.backgroundColor=dl,this.fboTexture=null,this.baseOpacity=1}}class kTt extends w8{}class UTt extends w8{}function VTt(e){const t=new Yr;t.include(M$e),t.include(DTt),t.include(ITt),e.tileBlendInput===na.GridComposite&&(t.extensions.add("GL_OES_standard_derivatives"),t.fragment.include(Jse));const r=e.tileBlendInput===na.ColorComposite;r&&t.fragment.uniforms.add(new St("backgroundColor",a=>a.backgroundColor)),e.baseOpacityMode!==Dn.One&&t.fragment.uniforms.add(new qe("baseOpacity",a=>a.baseOpacity));const i=e.baseOpacityMode===Dn.OnBaseLayer,s=e.baseOpacityMode===Dn.OnBackground||e.baseOpacityMode===Dn.OnBaseLayer,n=e.blendMode!==Ne.Normal;t.fragment.include(P$e,e);const o=e.tileBlendInput!==na.LayerOnly;return(n&&!o||i)&&(t.fragment.uniforms.add(new Ht("fboColor",a=>a.fboTexture)),t.fragment.uniforms.add(new qe("tileSize",a=>b(a.fboTexture)?a.fboTexture.descriptor.width:1))),t.fragment.code.add(S`
    vec4 applyBackgroundBlend(vec4 layerColor) {
      ${o||i?S`
          vec4 bgColor = ${i?S`texture2D(fboColor, gl_FragCoord.xy / tileSize)`:r?S`vec4(backgroundColor, 1.0)`:S`gridColor(vuv)`};
          ${s?S`bgColor *= baseOpacity;`:""}`:""}
      ${n?S`
            vec3 pmColorLayer = layerColor.rgb * layerColor.a;
            vec4 fboTex = ${o?S`bgColor;`:S`texture2D(fboColor, gl_FragCoord.xy / tileSize) ${i?" * baseOpacity":""};`}
            vec3 Cb = fboTex.a == 0.0 ? fboTex.rgb : vec3(fboTex.rgb * fboTex.a);
            return applyBlendMode(pmColorLayer.rgb, layerColor.a * u_opacity, Cb, fboTex.a);`:o||i?S`
            float composeAlpha = layerColor.a * u_opacity;
            vec4 pmColorLayer = vec4(layerColor.rgb, 1.0);
            return mix(bgColor, pmColorLayer, composeAlpha);`:S`
            return layerColor * layerColor.a * u_opacity;`}
    }
  `),e.colorizerType===Zx.Stretch?BTt(t,e):e.colorizerType===Zx.Lut?zTt(t):e.colorizerType===Zx.Hillshade&&GTt(t,e),t}function zTt(e){e.fragment.code.add(S`void main() {
vec2 pixelLocation = getPixelLocation(uv);
if (isOutside(pixelLocation)) {
gl_FragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
return;
}
vec4 currentPixel = getPixel(pixelLocation);
gl_FragColor = applyBackgroundBlend(colormap(currentPixel, true));
}`)}function BTt(e,t){e.fragment.uniforms.add([new IL("u_bandCount",i=>i.symbolizer.u_bandCount),new Ea("u_minCutOff",i=>i.symbolizer.u_minCutOff,3),new Ea("u_maxCutOff",i=>i.symbolizer.u_maxCutOff,3),new Ea("u_factor",i=>i.symbolizer.u_factor,3),new qe("u_minOutput",i=>i.symbolizer.u_minOutput),new qe("u_maxOutput",i=>i.symbolizer.u_maxOutput),new wT("u_useGamma",i=>i.symbolizer.u_useGamma),new Ea("u_gamma",i=>i.symbolizer.u_gamma,3),new Ea("u_gammaCorrection",i=>i.symbolizer.u_gammaCorrection,3),new qe("u_opacity",i=>i.common.u_opacity)]),e.fragment.code.add(S`float stretchOneValue(float val, float minCutOff, float maxCutOff, float minOutput, float maxOutput, float factor, bool useGamma, float gamma, float gammaCorrection) {
if (val >= maxCutOff) {
return maxOutput;
} else if (val <= minCutOff) {
return minOutput;
}
float stretchedVal;
if (useGamma) {
float tempf = 1.0;
float outRange = maxOutput - minOutput;
float relativeVal = (val - minCutOff) / (maxCutOff - minCutOff);
if (gamma > 1.0) {
tempf -= pow(1.0 / outRange, relativeVal * gammaCorrection);
}
stretchedVal = (tempf * outRange * pow(relativeVal, 1.0 / gamma) + minOutput) / 255.0;
} else {
stretchedVal = minOutput + (val - minCutOff) * factor;
}
return stretchedVal;
}`);const r=t.applyColormap?S`gl_FragColor = applyBackgroundBlend(colormap(vec4(grayVal, grayVal, grayVal, currentPixel.a), !u_useGamma));`:S`gl_FragColor = applyBackgroundBlend(vec4(grayVal, grayVal, grayVal, currentPixel.a));`;e.fragment.code.add(S`
      void main() {
        vec2 pixelLocation = getPixelLocation(uv);
        if (isOutside(pixelLocation)) {
          gl_FragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
          return;
        }

        vec4 currentPixel = getPixel(pixelLocation);
        ${t.stretchType===kT.Noop?S`
        gl_FragColor = applyBackgroundBlend(currentPixel);`:S`
        if (currentPixel.a == 0.0) {
          gl_FragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
          return;
        }
        if (u_bandCount == 1) {
          float grayVal = stretchOneValue(currentPixel.r, u_minCutOff[0], u_maxCutOff[0], u_minOutput, u_maxOutput, u_factor[0], u_useGamma, u_gamma[0], u_gammaCorrection[0]);
          ${r}
        } else {
          float redVal = stretchOneValue(currentPixel.r, u_minCutOff[0], u_maxCutOff[0], u_minOutput, u_maxOutput, u_factor[0], u_useGamma, u_gamma[0], u_gammaCorrection[0]);
          float greenVal = stretchOneValue(currentPixel.g, u_minCutOff[1], u_maxCutOff[1], u_minOutput, u_maxOutput, u_factor[1], u_useGamma, u_gamma[1], u_gammaCorrection[1]);
          float blueVal = stretchOneValue(currentPixel.b, u_minCutOff[2], u_maxCutOff[2], u_minOutput, u_maxOutput, u_factor[2], u_useGamma, u_gamma[2], u_gammaCorrection[2]);
          gl_FragColor = applyBackgroundBlend(vec4(redVal, greenVal, blueVal, currentPixel.a));
        }`}
      }`)}function GTt(e,t){const r=e.fragment;r.uniforms.add([new Ht("u_image",s=>s.u_image),new IL("u_hillshadeType",s=>s.symbolizer.u_hillshadeType),new Ea("u_sinZcosAs",s=>s.symbolizer.u_sinZcosAs,6),new Ea("u_sinZsinAs",s=>s.symbolizer.u_sinZsinAs,6),new Ea("u_cosZs",s=>s.symbolizer.u_cosZs,6),new Ea("u_weights",s=>s.symbolizer.u_weights,6),new _r("u_factor",s=>s.symbolizer.u_factor),new qe("u_minValue",s=>s.symbolizer.u_minValue),new qe("u_maxValue",s=>s.symbolizer.u_maxValue),new _r("u_srcImageSize",s=>s.common.u_srcImageSize)]),r.include(wg),r.code.add(S`vec4 overlay(float val, float minValue, float maxValue, float hillshade, float alpha) {
val = clamp((val - minValue) / (maxValue - minValue), 0.0, 1.0);
vec3 hsv = rgb2hsv(colormap(vec4(val, val, val, 1.0), false).rgb);
hsv.z = hillshade;
return vec4(hsv2rgb(hsv) * alpha, alpha);
}`),r.code.add(S`float getNeighborHoodAlpha(float a, float b, float c, float d, float e, float f, float g, float h, float i){
if (a == 0.0 || a == 0.0 || a==0.0 || a == 0.0 || a == 0.0 || a==0.0 || a == 0.0 || a == 0.0 || a==0.0) {
return 0.0;
}  else {
return e;
}
}`);const i=t.applyColormap?S`gl_FragColor = applyBackgroundBlend(overlay(ve.r, u_minValue, u_maxValue, hillshade, alpha));`:S`hillshade *= alpha;
gl_FragColor = applyBackgroundBlend(vec4(hillshade, hillshade, hillshade, alpha));`;r.code.add(S`
    void main() {
      vec2 pixelLocation = getPixelLocation(uv);
      if (isOutside(pixelLocation)) {
        gl_FragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
        return;
      }

      vec4 currentPixel = getPixel(pixelLocation);
      if (currentPixel.a == 0.0) {
        gl_FragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
        return;
      }

      //mirror edge pixels
      vec2 axy = vec2(-1.0, -1.0);
      vec2 bxy = vec2(0.0, -1.0);
      vec2 cxy = vec2(1.0, -1.0);
      vec2 dxy = vec2(-1.0, 0.0);
      vec2 fxy = vec2(1.0, 0.0);
      vec2 gxy = vec2(-1.0, 1.0);
      vec2 hxy = vec2(0.0, 1.0);
      vec2 ixy = vec2(1.0, 1.0);
      vec2 onePixel = 1.0 / u_srcImageSize;
      if (pixelLocation.s < onePixel.s) {
        axy[0] = 1.0;
        dxy[0] = 1.0;
        gxy[0] = 1.0;
      }
      if (pixelLocation.t < onePixel.t) {
        axy[1] = 1.0;
        bxy[1] = 1.0;
        cxy[1] = 1.0;
      }
      if (pixelLocation.s > 1.0 - onePixel.s) {
        cxy[0] = -1.0;
        fxy[0] = -1.0;
        ixy[0] = -1.0;
      }
      if (pixelLocation.t > 1.0 - onePixel.t) {
        gxy[1] = -1.0;
        hxy[1] = -1.0;
        ixy[1] = -1.0;
      }

      // calculate hillshade
      vec4 va = texture2D(u_image, pixelLocation + onePixel * axy);
      vec4 vb = texture2D(u_image, pixelLocation + onePixel * bxy);
      vec4 vc = texture2D(u_image, pixelLocation + onePixel * cxy);
      vec4 vd = texture2D(u_image, pixelLocation + onePixel * dxy);
      vec4 ve = texture2D(u_image, pixelLocation);
      vec4 vf = texture2D(u_image, pixelLocation + onePixel * fxy);
      vec4 vg = texture2D(u_image, pixelLocation + onePixel * gxy);
      vec4 vh = texture2D(u_image, pixelLocation + onePixel * hxy);
      vec4 vi = texture2D(u_image, pixelLocation + onePixel * ixy);

      // calculate the rate of z change along the x, y, and diagonal direction
      float dzx = (vc + 2.0 * vf + vi - va - 2.0 * vd - vg).r * u_factor.s;
      float dzy = (vg + 2.0 * vh + vi - va - 2.0 * vb - vc).r * u_factor.t;
      float dzd = sqrt(1.0 + dzx * dzx + dzy * dzy);
      float hillshade = 0.0;

      // traditional single light source
      if (u_hillshadeType == 0){
        float cosDelta = u_sinZsinAs[0] * dzy - u_sinZcosAs[0] * dzx;
        float z = (u_cosZs[0] + cosDelta) / dzd;
        if (z < 0.0)  z = 0.0;
        hillshade = z;
      } else {
        // multi-directional with 6 light sources
        for (int k = 0; k < 6; k++) {
        float cosDelta = u_sinZsinAs[k] * dzy - u_sinZcosAs[k] * dzx;
        float z = (u_cosZs[k] + cosDelta) / dzd;
        if (z < 0.0) z = 0.0;
        hillshade = hillshade + z * u_weights[k];
        if (k == 5) break;
        }
      }

      // set color
      float alpha = getNeighborHoodAlpha(va.a, vb.a, vc.a, vd.a, ve.a, vf.a, vg.a, vh.a, vi.a);
      alpha *= u_opacity;
      ${i}
    }
  `)}const jTt=Object.freeze(Object.defineProperty({__proto__:null,ColorizerUniforms:w8,ColorizerStretchUniforms:kTt,ColorizerHillshadeUniforms:UTt,build:VTt},Symbol.toStringTag,{value:"Module"}));function HTt(e,t,r="nearest",i=!1){var c;const s=!(i&&t.pixelType==="u8"),n=s?Ct.FLOAT:Ct.UNSIGNED_BYTE,o=t.pixels==null||t.pixels.length===0?null:s?t.getAsRGBAFloat():t.getAsRGBA(),a=(c=e.capabilities.textureFloat)==null?void 0:c.textureFloatLinear,l={width:t.width,height:t.height,target:mt.TEXTURE_2D,pixelFormat:ze.RGBA,internalFormat:e.type===mr.WEBGL2&&s?gt.RGBA32F:ze.RGBA,samplingMode:!a||r!=="bilinear"&&r!=="cubic"?et.NEAREST:et.LINEAR,dataType:n,wrapMode:xt.CLAMP_TO_EDGE,flipped:!1};return new nt(e,l,o)}function qTt(e,t){const{spacing:r,offsets:i,coefficients:s,size:[n,o]}=t,a=r[0]>1,l={width:a?4*n:n,height:o,target:mt.TEXTURE_2D,pixelFormat:ze.RGBA,internalFormat:e.type===mr.WEBGL2?gt.RGBA32F:ze.RGBA,dataType:Ct.FLOAT,samplingMode:et.NEAREST,wrapMode:xt.CLAMP_TO_EDGE,flipped:!1},c=new Float32Array(a?n*o*16:2*i.length);if(a)for(let h=0,p=0;h<s.length;h++)c[p++]=s[h],h%3==2&&(c[p++]=1);else for(let h=0;h<o;h++)for(let p=0;p<n;p++){const f=4*(h*n+p),m=2*(p*o+h);c[f]=i[m],c[f+1]=i[m+1],c[f+3]=i[m]===-1?0:1}return new nt(e,l,c)}function xge(e,t){const r={width:t.length/4,height:1,target:mt.TEXTURE_2D,pixelFormat:ze.RGBA,internalFormat:ze.RGBA,dataType:Ct.UNSIGNED_BYTE,samplingMode:et.NEAREST,wrapMode:xt.CLAMP_TO_EDGE,flipped:!1};return new nt(e,r,t)}function WTt(e,t,r,i=1,s=!0){return{u_flipY:s,u_applyTransform:!!e,u_opacity:i,u_transformSpacing:e?e.spacing:zd,u_transformGridSize:e?e.size:zd,u_targetImageSize:t,u_srcImageSize:r}}function XTt(e,t){return{u_colormapOffset:t||0,u_colormapMaxIndex:e?e.length/4-1:0}}function ZTt(e){return{u_bandCount:e.bandCount,u_minOutput:e.outMin,u_maxOutput:e.outMax,u_minCutOff:e.minCutOff,u_maxCutOff:e.maxCutOff,u_factor:e.factor,u_useGamma:e.useGamma,u_gamma:e.gamma,u_gammaCorrection:e.gammaCorrection}}function YTt(e){return{u_hillshadeType:e.hillshadeType,u_sinZcosAs:e.sinZcosAs,u_sinZsinAs:e.sinZsinAs,u_cosZs:e.cosZs,u_weights:e.weights,u_factor:e.factor,u_minValue:e.minValue,u_maxValue:e.maxValue}}const Tge={bandCount:3,outMin:0,outMax:1,minCutOff:[0,0,0],maxCutOff:[255,255,255],factor:[1/255,1/255,1/255],useGamma:!1,gamma:[1,1,1],gammaCorrection:[1,1,1],colormap:null,colormapOffset:null,stretchType:"none",type:"stretch"};class QTt{constructor(t,r,i=null,s=null){this.type="raster-tile",this._memoryUsed=null,this._source=null,this._symbolizerParameters=null,this._bandIds=null,this._interpolation=null,this._dirty=!1,this._transformGrid=null,this.isRendereredSource=!1,this.symbolizerRenderer=null,this.rawPixelData=null,this.lij=null,this.opacity=1,this.lij=t,this.source=r,this.width=i||r.width,this.height=s||r.height}get source(){return this._source}set source(t){this._source=t,this._rasterTexture=Ye(this._rasterTexture),this._memoryUsed=null}get symbolizerParameters(){return this.isRendereredSource?{...Tge,maxCutOff:[1,1,1],factor:[1,1,1]}:this._symbolizerParameters||Tge}set symbolizerParameters(t){this._symbolizerParameters=t}get bandIds(){return this._bandIds}set bandIds(t){b(t)&&t.length>0?this._bandIds&&t.every((r,i)=>!!this._bandIds[i]&&r===this._bandIds[i])||(this._bandIds=t,this._dirty=!0):this._bandIds=null}get interpolation(){return this._interpolation||"nearest"}set interpolation(t){if(this._interpolation=t,b(this._rasterTexture)){const r=this._getRasterTextureInterpolation(t);this._rasterTexture.setSamplingMode(r==="bilinear"?et.LINEAR:et.NEAREST)}}get transformGrid(){return this._transformGrid}set transformGrid(t){this._transformGrid=t,this._transformGridTexture=Ye(this._transformGridTexture),this._memoryUsed=null}bind(t){return!!(this.source&&this.source.pixels&&this.source.pixels.length>0)&&((R(this._rasterTexture)||this._dirty)&&this._updateRasterTexture(t,this.bandIds),b(this._rasterTexture)&&(this._updateColormapTexture(t),this.transformGrid&&R(this._transformGridTexture)&&(this._transformGridTexture=qTt(t,this.transformGrid))),!0)}getUniforms(){const{symbolizerParameters:t,transformGrid:r,width:i,height:s,opacity:n}=this,o=WTt(r,[i,s],[this.source.width,this.source.height],n),a=XTt(t.colormap,t.colormapOffset),l=this.symbolizerParameters.type==="stretch"?ZTt(this.symbolizerParameters):null,c=this.symbolizerParameters.type==="hillshade"?YTt(this.symbolizerParameters):null;return new w8(o,a,l||c,this._rasterTexture,this._transformGridTexture,this._colormapTexture)}get memoryUsage(){if(R(this._memoryUsed)){const t=[this._rasterTexture,this._transformGridTexture,this._colormapTexture];this._memoryUsed=t.map(r=>b(r)?r.descriptor.width*r.descriptor.height*4:0).reduce((r,i)=>r+i,0)}return this._memoryUsed}release(){return this._rasterTexture=Ye(this._rasterTexture),this._transformGridTexture=Ye(this._transformGridTexture),this._colormapTexture=Ye(this._colormapTexture),this.source=null,this.transformGrid=null,this.rawPixelData=null,!0}_updateRasterTexture(t,r){const i=this.source?this.source.extractBands(r):null;if(!(i&&i.pixels&&i.pixels.length>0))return void(this._rasterTexture=Ye(this._rasterTexture));const s=R(r)&&R(this.bandIds)||b(r)&&b(this.bandIds)&&r.join("")===this.bandIds.join("");if(b(this._rasterTexture)&&s)return;this._rasterTexture=Ye(this._rasterTexture);const n=this._getRasterTextureInterpolation(this.interpolation);this._rasterTexture=HTt(t,i,n,this.isRendereredSource||this.hasStretchTypeNone())}hasStretchTypeNone(){return"stretchType"in this.symbolizerParameters&&this.symbolizerParameters.stretchType==="none"&&!this.symbolizerParameters.useGamma&&this.source.pixelType==="u8"}_getRasterTextureInterpolation(t){return this.symbolizerParameters.type==="lut"||t==="nearest"||t==="majority"?"nearest":"bilinear"}_updateColormapTexture(t){const r=this._colormap,i=this.symbolizerParameters.colormap;return i?r?i.length!==r.length||i.some((s,n)=>s!==r[n])?(this._colormapTexture=Ye(this._colormapTexture),this._colormapTexture=xge(t,i),void(this._colormap=i)):void 0:(this._colormapTexture=xge(t,i),void(this._colormap=i)):(this._colormapTexture=Ye(this._colormapTexture),void(this._colormap=null))}}class mk{constructor(){this.waitingAgents=new Xt,this._upsampleInfo=null,this.loadingAgent=null,this.requestPromise=null,this.requestAbort=null,this.pendingUpdates=0}static acquire(t){const r=zj.acquire();return r._init(t),r}release(){this.dispose(),gk.delete(this),zj.release(this)}dispose(){this.loadingAgent=Ye(this.loadingAgent),this.abortRequest(),this._unsetUpsampleInfo(),this.pendingUpdates=0,this._data=wC(this._data)}static prune(){zj.prune(0)}_init(t){this.waitingAgents.clear(),this._data=wC(this._data),this.dataMissing=!1,this.dataInvalidated=!1,this._unsetUpsampleInfo(),this.abortRequest(),this.loadingAgent=null,this.pendingUpdates=0,this._pool=t,this.elevationBounds=null}invalidateSourceData(){this.dataInvalidated=!0,this.dataMissing=!1,this._unsetUpsampleInfo()}abortRequest(){this.requestAbort=Fd(this.requestAbort),this.requestPromise=null}get upsampleInfo(){return this._upsampleInfo}_unsetUpsampleInfo(){b(this._upsampleInfo)&&(this._upsampleInfo.tile.unrefMapData(),this._pool.release(this._upsampleInfo),this._upsampleInfo=null)}setUpsampleInfo(t,r){if(t===r||R(r))this._unsetUpsampleInfo();else{if(R(this._upsampleInfo))this._upsampleInfo=this._pool.acquire();else{if(this._upsampleInfo.tile===r)return;this._upsampleInfo.tile.unrefMapData()}r.refMapData(),RTt(t,r,this._upsampleInfo)}}get data(){return this._data}set data(t){wC(this._data),this._data=t}}const zj=new Ls(mk,null,()=>{}),gk=new Map;function JTt(){gk.size>0&&(console.log(`${gk.size} live TilePerLayerInfo allocations:`),gk.forEach(e=>console.log(e,`
`)))}class eE{constructor(t){this._texture=t,this.type="tile-texture",this._refCount=1}retain(){++this._refCount}release(){--this._refCount,this._refCount===0&&this._texture.dispose()}get texture(){return this._texture}generateMipmap(){this._texture.generateMipmap()}get descriptor(){return this._texture.descriptor}}var wt;(function(e){e[e.NONE=0]="NONE",e[e.NONE_HIT_MAXLOD=1]="NONE_HIT_MAXLOD",e[e.SPLIT=2]="SPLIT",e[e.VSPLITMERGE=4]="VSPLITMERGE",e[e.MERGE=8]="MERGE",e[e.RENDERDATA=16]="RENDERDATA",e[e.GEOMETRY=32]="GEOMETRY",e[e.TEXTURE_NOFADING=64]="TEXTURE_NOFADING",e[e.TEXTURE_FADING=128]="TEXTURE_FADING"})(wt||(wt={}));const Bj=M(),YS=M(),co=M(),KTt=.1;class eSt{constructor(){this.fovX=0,this.fovY=0,this.relativeWidthLimit=0,this.relativeHeightLimit=0,this.maxLod=0,this.angledSplitBias=0,this.aboveGround=!0}}class Kse{constructor(){this.lij=[0,0,0],this._children=[null,null,null,null],this._pendingUpdates=0,this._dirty=!0,this._previouslyRendered=!1,this.extent=Ut(),this._elevationBounds=rt(),this.layerInfo=[[],[]],this.extentInRadians=Ut(),this.centerAtSeaLevel=M(),this._center=[M(),kn(),M()],this.up=pee(),this._isWithinClippingArea=!0,this._intersectsClippingArea=!0,this._maxTesselation=0,this._usedMemory=null,this._mapTileMemory=0,this._mapDataRefCount=0,this._screenDepth=0,this.renderOrder=0,this._edgeLen=0,this._edgeLen2=0,this._curvatureHeight=0}static prune(){ene.prune(0),tne.prune(0),mk.prune()}get isCached(){return!this.shouldLoad&&this._mapDataRefCount<=0}get maxTesselation(){return this._maxTesselation}get isWithinClippingArea(){return this._isWithinClippingArea}get intersectsClippingArea(){return this._intersectsClippingArea}get clippingArea(){return this._clippingArea}get parent(){return this._parent}get children(){return this._children}get surface(){return this._surface}get elevationBounds(){return this._elevationBounds}get level(){return this.lij[0]}get key(){return`${this.lij[0]}/${this.lij[1]}/${this.lij[2]}`}get edgeLen(){return this._edgeLen}get radius(){return this._center[tl.MIDDLE][3]}get screenDepth(){return this._screenDepth}get visible(){return this._dirty&&this.computeVisibility(),this._visible}computeVisibility(){this._dirty=!1;const t=this._intersectsClippingArea&&this._isVisible(this.surface.frustum);return t!==this._visible&&(this._visible=t,this._surface.emit("tiles-visibility-changed"),this._surface.renderer.setNeedsRender(),this.updateAgentSuspension()),this._visible}get loadable(){return this.visible||this._surface.view.state.fixedContentCamera}get rendered(){const t=!!this.renderData;return t!==this._previouslyRendered&&(this._surface.emit("tiles-visibility-changed"),this._previouslyRendered=t,this._surface.renderer.setNeedsRender()),t}get shouldLoad(){if(!this.loadable)return!1;if(this._surface.lodSnapping===GA.ON){const t=this.level-this._surface.snapLevel;if(t===0)return!0;if(t===1)return!1}return this.isLeaf}init(t,r,i){this.lij[0]=t[0],this.lij[1]=t[1],this.lij[2]=t[2],this.ellipsoid=Ar(i.tilingScheme.spatialReference),i.tilingScheme.getExtent(t[0],t[1],t[2],this.extent),i.tilingScheme.convertExtentToRadians(this.extent,this.extentInRadians),this._isWithinClippingArea=!0,this._intersectsClippingArea=!0,this._clippingArea=null,this._mapDataRefCount=0,i.upsampleMapCache.pop(this.key),this._edgeLen=0,this._edgeLen2=0,this._center[tl.MIDDLE][3]=0,this.vlevel=t?t[0]:0,r&&r.elevationBounds?Do(this._elevationBounds,r.elevationBounds):vr(this._elevationBounds,0,0),this._pendingUpdates=0,this.renderData=null,this._screenDepth=0,this._visible=!1,this._previouslyRendered=!1,this._parent=r,this.unsetChildren(),this._surface=i,this.updateVisibility();for(const s of Lw){const n=i.numLayers(s),o=this.layerInfo[s];for(const a of o)a.release();o.length=n;for(let a=0;a<n;a++)o[a]=mk.acquire(this._surface.upsampleInfoPool),s===Qt.ELEVATION&&this.findElevationBoundsForLayer(a,-1)}this.computeElevationBounds(),this._maxTesselation=Math.min(i.tilingScheme.pixelSize,GY)}release(){Am(!this.renderData,"tile.renderData was not unloaded"),this._surface.upsampleMapCache.pop(this.key);for(const t of Lw){for(const r of this.layerInfo[t])r.release();this.layerInfo[t].length=0}this._parent=null,this._surface=null,this.setMemoryDirty()}refMapData(){++this._mapDataRefCount,this.isCached||this._surface.upsampleMapCache.pop(this.key)}unrefMapData(){if(--this._mapDataRefCount,this.isCached){this.setMemoryDirty();const t=this.cachedMemory;t>0&&this._surface.upsampleMapCache.put(this.key,this,t)}}setMemoryDirty(){this._usedMemory=null}get usedMemory(){return this._ensureUsedMemory()+(this.isCached?0:this._mapTileMemory)}get cachedMemory(){return this.isCached?this.mapTileMemory:0}get mapTileMemory(){return this._ensureUsedMemory(),this.layerInfo[Qt.MAP].reduce((t,r)=>t+(r instanceof AP?r.memoryUsage:0),this._mapTileMemory)}get cpuImageMemorySize(){const r=this._surface.tilingScheme.pixelSize;return r*r*4}_ensureUsedMemory(){if(b(this._usedMemory))return this._usedMemory;this._usedMemory=0,this._mapTileMemory=0;let t=0;for(const{data:i}of this.layerInfo[Qt.MAP])i instanceof AP?t+=this._getTerrainDataMemory(i):this._mapTileMemory+=this._getTerrainDataMemory(i);const r=this.cpuImageMemorySize;for(const i of this.layerInfo[Qt.ELEVATION])this._usedMemory+=i.data?r:0;return this.renderData&&(this._usedMemory+=this.renderData.estimatedGeometryMemoryUsage,this._mapTileMemory+=bT(this.renderData.textureDescriptor)),this.isCached&&this._surface.upsampleMapCache.updateSize(this.key,this,this._mapTileMemory+t),this._usedMemory}getUsedMemoryForLayer(t,r){const i=this.layerInfo[t][r];return i!=null&&i.data?t===Qt.MAP?this.isCached?0:this._getTerrainDataMemory(i.data):t===Qt.ELEVATION?this.cpuImageMemorySize:0:0}_getTerrainDataMemory(t){return t instanceof eE?bT(t.texture):t instanceof HTMLImageElement||t instanceof y8?this.cpuImageMemorySize:t instanceof AP||t instanceof QTt?t.memoryUsage:0}updateScreenDepth(t){const r=this._center[tl.MIDDLE],i=t,s=r[0],n=r[1],o=r[2],a=i[2]*s+i[6]*n+i[10]*o+i[14];this._screenDepth=a<0?0:a/(i[3]*s+i[7]*n+i[11]*o+i[15])}shouldSplit(t,r,i){if(b(t.frustum)&&(!this._intersectsClippingArea||!this._isVisible(t.frustum)))return wt.NONE;const s=this.level;pe(Bj,this._center[tl.MIDDLE],r);let n=ul(Bj),o=tl.MIDDLE;pe(YS,this._center[tl.TOP],r);const a=ul(YS);a<n&&(n=a,o=tl.TOP),pe(YS,this._center[tl.BOTTOM],r);const l=ul(YS);if(l<n&&(n=l,o=tl.BOTTOM),this._edgeLen2>n&&s<t.maxLod)return wt.SPLIT;const c=Math.sqrt(n),h=t.fovX*c*2,p=this._edgeLen/h,f=()=>{const w=s+Math.ceil(-Math.log2(t.relativeWidthLimit/p));return w!==this.vlevel?(this.vlevel=w,wt.VSPLITMERGE):wt.NONE_HIT_MAXLOD};if(i===GA.ON&&this._surface.snapLevel-s===1)return s>=t.maxLod?f():wt.SPLIT;const m=Te(this.up,Bj),g=this._elevationBounds[1]-this._elevationBounds[0],v=g/this.edgeLen;if(t.aboveGround&&m>0&&v<.001&&m/c-Math.sin(this._curvatureHeight/(this.edgeLen*Math.SQRT1_2)*Math.PI)-v>0)return wt.NONE;if(p<t.relativeWidthLimit)return this.vlevel!==this.level?(this.vlevel=this.level,wt.VSPLITMERGE):wt.NONE;if(s>=t.maxLod)return f();if(s>6){pe(YS,this._center[o],r),le(co,this.up,m),pe(co,co,YS);const w=ul(co);if(w>this.radius*this.radius){le(co,co,this.radius/Math.sqrt(w)),de(co,co,this._center[o]),pe(co,r,co);const _=Math.min(1,(Math.abs(Te(co,this.up))+.5*g+this._curvatureHeight)/Re(co)),T=KTt/t.angledSplitBias,x=t.fovY*c*2;if(_*(this._edgeLen/x)<T*t.relativeHeightLimit)return wt.NONE}}return wt.SPLIT}setChildren(t,r,i,s){Am(!!(t&&r&&i&&s),"Null child passed"),this._children[0]=t,this._children[1]=r,this._children[2]=i,this._children[3]=s}unsetChildren(){this._children[0]=null,this._children[1]=null,this._children[2]=null,this._children[3]=null}get isLoaded(){var t,r;return(r=(t=this.renderData)==null?void 0:t.hasGeometry)!=null?r:!1}prepareToLoad(t){this.refMapData();for(const r of Lw)this._createOrUpdateAgents(0,r);t.updateTileGeometryState(this)}load(t){this.prepareToLoad(t),this.loadPrepared(t)}loadPrepared(t){t.loadTile(this)}unload(t){t.unloadTile(this);for(const r of Lw){const i=this.layerInfo[r];for(const s of i)s.loadingAgent&&s.loadingAgent!==vc&&(zF(s.loadingAgent),s.loadingAgent=null),s.pendingUpdates=0}this.resetPendingUpdate(wt.GEOMETRY),this.resetPendingUpdate(wt.TEXTURE_NOFADING),this.resetPendingUpdate(wt.TEXTURE_FADING),this.unrefMapData()}unloadMapData(){const t=this.layerInfo[Qt.MAP];for(const r of t)r.loadingAgent&&r.loadingAgent!==vc&&(zF(r.loadingAgent),r.loadingAgent=null),r.pendingUpdates=0;this.renderData&&this.renderData.releaseTexture(),this.setMemoryDirty()}updateClippingStatus(t){if(Nx(t,this._clippingArea))return!1;const r=this._intersectsClippingArea,i=this._isWithinClippingArea;b(t)?(this._intersectsClippingArea=this.intersectsExtent(t),this._isWithinClippingArea=this._isWithinExtent(t)):(this._intersectsClippingArea=!0,this._isWithinClippingArea=!0),this._clippingArea=t,this.updateVisibility();const s=i&&this._isWithinClippingArea,n=!(i||r||this._isWithinClippingArea||this._intersectsClippingArea);return!this.renderData||s||n||this.setPendingUpdate(wt.GEOMETRY),!0}updateVisibility(){this._dirty=!0,this._surface.setTileTreeDirty()}getLayerInfo(t,r){return this.layerInfo[r][t]}hasLayerData(t,r){const i=this.layerInfo[r][t];return!(!i||!i.data||i.dataInvalidated)}get updating(){if(this.hasPendingUpdates)return!0;for(const t of Lw){const r=this.layerInfo[t];for(const i of r)if(i.loadingAgent&&i.loadingAgent!==vc&&i.loadingAgent.updating)return!0}return!1}_isSuspended(t){return!!this.hasPendingUpdate(wt.SPLIT)||t!==Qt.ELEVATION&&!this.loadable}get hasPendingUpdates(){return this._pendingUpdates!==0}hasPendingUpdate(t){return(this._pendingUpdates&t)===t}setPendingUpdate(t){this._pendingUpdates|=t,t===wt.SPLIT||t===wt.MERGE?this._surface.setTileTreeDirty():this._surface.requestUpdate()}resetPendingUpdate(t){return!!this.hasPendingUpdate(t)&&(this._pendingUpdates&=~t,!0)}requestLayerData(t,r,i){const s=this.layerInfo[r][t];if(s.waitingAgents.has(i))return console.warn("agent already requested this piece of map data (tile %s, agent tile %s, layer: %d/%d)",this.lij.toString(),i.tile.lij.toString(),r,t),!0;if(s.waitingAgents.push(i),s.data&&!s.dataInvalidated)return console.warn("agent requested existing data (tile %s, agent tile %s, layer: %d/%d)",this.lij.toString(),i.tile.lij.toString(),r,t),i.dataArrived(this),!0;if(s.requestPromise)return!0;Fd(s.requestAbort),s.requestAbort=new AbortController;const n=this._surface.requestTileData(this,t,r,s.requestAbort);if(!n)return s.requestAbort=null,!1;const o=()=>{s.requestPromise===n&&(s.requestPromise=null,s.requestAbort=null)};return s.requestPromise=n,n.then(o,o),!0}get isLeaf(){return this._children[0]==null}hasLij(t){return this.lij[0]===t[0]&&this.lij[1]===t[1]&&this.lij[2]===t[2]}findByLij(t){return this.hasLij(t)?this:this.isLeaf?null:this._children[0].findByLij(t)||this._children[1].findByLij(t)||this._children[2].findByLij(t)||this._children[3].findByLij(t)||null}distanceToSquared(t){return ul(pe(co,this._center[tl.MIDDLE],t))}containsPoint(t){const r=this.extent;return t[0]>=r[0]&&t[1]>=r[1]&&t[0]<=r[2]&&t[1]<=r[3]}unrequestLayerData(t,r,i){const s=this.layerInfo[r][t],n=s.waitingAgents,o=n.removeUnordered(i)!=null;Am(o,"agent has not requested this piece of map data"),n.length<1&&(s.abortRequest(),this.setMemoryDirty())}dataArrived(t,r,i){const s=this.layerInfo[r][t];s.data=i,s.dataInvalidated=!1,s.waitingAgents.forAll(n=>n.dataArrived(this)),s.waitingAgents.clear(),this.setMemoryDirty()}dataMissing(t,r,i){i.notInTilemap||console.error(`Tile ${this.lij.toString()} layer ${r}/${t} error ${i}`);const s=this.layerInfo[r][t];s.dataMissing=!0,s.waitingAgents.forAll(n=>n.dataMissing()),s.waitingAgents.clear(),this.setMemoryDirty()}updateRenderData(t,r){switch(t){case Qt.MAP:return this._updateTexture(r);case Qt.ELEVATION:return this._updateGeometry()}}_updateTexture(t){this.renderData&&(this.resetPendingUpdate(t===ro.FADING?wt.TEXTURE_NOFADING:wt.TEXTURE_FADING),this.setPendingUpdate(t===ro.FADING?wt.TEXTURE_FADING:wt.TEXTURE_NOFADING))}_updateGeometry(){this.setPendingUpdate(wt.GEOMETRY);for(const t of this.layerInfo[Qt.ELEVATION])t.pendingUpdates|=wt.GEOMETRY}invalidateLayerData(t,r){this.layerInfo[r][t].invalidateSourceData(),this.restartAgents(r)}computeElevationBounds(){const t=this._elevationBounds;vr(t,Number.MAX_VALUE,-Number.MAX_VALUE);const r=this.layerInfo[Qt.ELEVATION];let i=!0;for(const s of r)b(s.elevationBounds)&&(t[0]=Math.min(t[0],s.elevationBounds.min),t[1]=Math.max(t[1],s.elevationBounds.max),s.elevationBounds.hasNoDataValues||(i=!1));i&&(t[0]=Math.min(t[0],0),t[1]=Math.max(t[1],0)),this.updateRadiusAndCenter(),this._surface.setTileTreeDirty()}_updateCenter(){const t=this._elevationBounds,r=.5*(t[0]+t[1]);le(co,this.up,r),de(this._center[tl.MIDDLE],this.centerAtSeaLevel,co),le(co,this.up,t[0]),de(this._center[tl.TOP],this.centerAtSeaLevel,co),le(co,this.up,t[1]),de(this._center[tl.BOTTOM],this.centerAtSeaLevel,co)}findElevationBoundsForLayer(t,r){const i=this.layerInfo[Qt.ELEVATION][t];if(b(i.elevationBounds)&&i.elevationBounds.level>=r)return;const s=this._surface.layerViewByIndex(t,Qt.ELEVATION),n=YQ(s);if(!RP(this,n,!1))return;const o=rSt;let a=!1;if(i.data){const l=i.data;o.min=l.bounds[0],o.max=l.bounds[1],o.hasNoDataValues=l.hasNoDataValues,o.level=this.level,a=!0}else{let l,c,h=0;for(let p=this._parent;p&&(!c||h<k5(this.level))&&(h=this.vlevel-p.level,l=c||l,c=p.layerInfo[Qt.ELEVATION][t].data,!(!c&&l&&h>=k5(this.level)));p=p.parent);c=c||l,c&&(c.computeMinMaxValue(this.lij[0],this.lij[1],this.lij[2],o),o.min!==1/0&&(o.level=c.level,a=!0))}a&&(R(i.elevationBounds)&&(i.elevationBounds=new Zse),i.elevationBounds.copyFrom(o))}modifyLayers(t,r,i){const s=this.layerInfo[i];for(const a of s)a.loadingAgent&&a.loadingAgent!==vc&&(zF(a.loadingAgent),a.loadingAgent=null),a.waitingAgents.clear();for(let a=0;a<s.length;++a)t[a]===void 0&&s[a].release();const n=new Array(...s),o=r.length;s.length=o;for(let a=0;a<o;a++){const l=r[a];s[a]=l>-1?n[l]:mk.acquire(this._surface.upsampleInfoPool)}this.setMemoryDirty()}restartAgents(t){this.renderData&&(this._createOrUpdateAgents(0,t),this.updateRenderData(t,ro.FADING))}updateAgents(t){if(this.renderData){const r=this.layerInfo[t];for(const i of r)i.loadingAgent===vc&&(i.loadingAgent=null);this._createOrUpdateAgents(0,t)}}updateAgentSuspension(){for(const t of Lw){const r=this._isSuspended(t);for(const i of this.layerInfo[t])i.loadingAgent&&i.loadingAgent!==vc&&(i.loadingAgent.setSuspension(r),i.loadingAgent===vc&&this.updateRenderData(t,ro.FADING))}}removeLayerAgent(t,r){const i=this.layerInfo[r][t];i.loadingAgent&&i.loadingAgent!==vc&&i.loadingAgent.dispose(),i.loadingAgent=null}agentDone(t,r){const i=this.layerInfo[r][t];i.loadingAgent=vc,!i.data&&R(i.upsampleInfo)&&this._createOrUpdateAgents(t+1,r)}_createOrUpdateAgents(t,r){const i=this.layerInfo[r];if(i.length===0)return;const s=(()=>{for(let o=t;o<i.length;++o){const a=this._surface.layerViewByIndex(o,r);if(fz(a)&&a.layer.blendMode!=="normal")return!0}return!1})(),n=this._isSuspended(r);for(let o=t;o<i.length;++o){const a=i[o];let l=!1;const c=this._surface.layerViewByIndex(o,r),h=YQ(c);if(a.loadingAgent?RP(this,h,!1)?(a.loadingAgent!==vc&&a.loadingAgent.setSuspension(n),a.loadingAgent!==vc&&(l=a.loadingAgent.update())):a.dispose():RP(this,h,!1)&&(a.loadingAgent=tSt(this,o,r,n),l=a.loadingAgent.startLoading(),l?a.loadingAgent===vc&&this.setPendingUpdate(wt.GEOMETRY):(zF(a.loadingAgent),a.loadingAgent=vc)),a.loadingAgent===vc&&this.updateRenderData(r,ro.FADING),!s&&l&&c.isOpaque)return}}_isWithinExtent(t){const r=this.extent;return r[0]>=t[0]&&t[2]>=r[2]&&r[1]>=t[1]&&t[3]>=r[3]}intersectsExtent(t){const r=this.extent;return r[2]>=t[0]&&t[2]>=r[0]&&r[3]>=t[1]&&t[3]>=r[1]}getElevationBasedVerticesPerSide(t){const r=this.vlevel-this.level,i=Math.max(this.level-t,k5(this.level)-r);return Le(1+(this.maxTesselation>>i),2,this.maxTesselation+1)}get test(){return{cachedMemory:this.cachedMemory}}_findLIJ(t,r){if(!t)return null;const i=this.surface.rootTiles;if(b(i)){for(const s of i)if(iSt(s,t)){let n=s,o=t[0]-n.level-1;for(;o>=0&&!n.isLeaf&&!r(n);){const a=t[1]>>o&1,l=t[2]>>o&1;n=n.children[2*a+l],o--}return r(n)?n:null}}return null}findNeighborTile(t,r){const i=this.lij,s=this.getNeighborLIJ(i,t);return s?sSt(i,s)?r(this)?this:null:this._findLIJ(s,r):null}findCorner(t,r){const i=t===zt.NORTH_EAST?1:t===zt.NORTH_WEST?0:t===zt.SOUTH_WEST?2:3;let s=this;for(;!(s.isLeaf||r&&r(s));)s=s.children[i];return s}findNeighborCornerTileExact(t,r){var i;return(i=this.findNeighborTile(t,s=>r(s)||s.level===this.level))==null?void 0:i.findCorner(mz(t),r)}forAllSubtreeOnSide(t,r){const i=t===zt.NORTH?[0,1]:t===zt.NORTH_EAST?[1]:t===zt.EAST?[1,3]:t===zt.SOUTH_EAST?[3]:t===zt.SOUTH?[2,3]:t===zt.SOUTH_WEST?[2]:t===zt.WEST?[0,2]:[0],s=n=>{r(n)||n.isLeaf||i.forEach(o=>s(n.children[o]))};s(this)}forallNeighbors(t){gz.forEach(r=>this.findNeighborCornerTileExact(r,t)),R_.forEach(r=>{var i;return(i=this.findNeighborTile(r,s=>s.level===this.level||t(s)))==null?void 0:i.forAllSubtreeOnSide(pk(r),t)})}getNeighborEdgeStartVertexIndex(t,r){const i=r!=null?r:this.findNeighborTile(R_[t],h=>h.isLoaded);if(!i||!this.isLoaded||!i.isLoaded)return 0;const s=this.level-i.level;if(s===0)return 0;const n=2**s,o=(1&t)==1,a=o?0:1,l=i.lij[a+1]*n,c=this.lij[a+1]-l;return o?n-1-c:c}_updateNeighborsWithChangedEdgeResolution(){for(let t=0;t<4;++t)if(this.renderData.geometryState.neighborData.modifiedEdgeResolutions[t]){const r=R_[t],i=this.findNeighborTile(r,s=>s.isLoaded||s.level===this.level);if(!i)continue;if(!i.isLoaded){i.isLeaf;const s=(t+2)%4,n=pk(r);i.forAllSubtreeOnSide(n,o=>o.isLoaded?(o.updateEdgeAfterResolutionChange(s),!0):(o.isLeaf,!1))}this.renderData.geometryState.neighborData.modifiedEdgeResolutions[t]=!1}}updateNeighborDataAndGeometryIfNeeded(){this.isLoaded&&this.renderData.updateNeighborDataAndGeometryIfNeeded()}updateNeighborsAfterGeometryChange(t=this.level){this.forEachLoadedNeighbor(r=>this._updateNeighbor(r)),R_.forEach(r=>{var i;(i=this.findNeighborTile(r,s=>s.isLoaded&&s.level<t))==null||i.updateNeighborsWithChangedEdgeResolution()})}updateNeighborsWithChangedEdgeResolution(){this.isLoaded&&this._updateNeighborsWithChangedEdgeResolution()}updateEdgeAfterResolutionChange(t){this.renderData.updateEdgeAfterResolutionChange(t)}forEachLoadedNeighbor(t){const r=this.level,i=s=>s.level===r||s.isLoaded;R_.forEach((s,n)=>{var l,c;const o=this.findNeighborTile(s,i);o!=null&&o!==this&&o.forAllSubtreeOnSide(pk(s),h=>!!h.isLoaded&&(t(h),!0));const a=(c=(l=this.renderData)==null?void 0:l.geometryState)==null?void 0:c.neighborData;a&&(a.modifiedEdgeResolutions[n]=!1)}),gz.forEach(s=>{var o;const n=(o=this.findNeighborTile(s,i))==null?void 0:o.findCorner(mz(s),a=>a.isLoaded);!n||nSt(this,n,s),n!=null&&n.isLoaded&&t(n)})}_updateNeighbor(t){t!=null&&t.isLoaded&&t.updateNeighborDataAndGeometryIfNeeded()}getNeighborLIJ(t,r){const i=cge(r)?-1:lge(r)?1:0,s=oge(r)?-1:age(r)?1:0,n=[t[0],t[1]+i,t[2]+s];return n[1]<0?null:this.surface.isGlobal?this.wrapLIJ(n):n[2]<0?null:n}wrapLIJ(t){return!t||t[1]<0||t[1]>=2**t[0]?null:this.surface.wrapEastWest(t)}get westNeighborWestExtent(){return this.extent[0]*(this.isWestEnd?-1:1)}get eastNeighborEastExtent(){return this.extent[2]*(this.isEastEnd?-1:1)}get isEastEnd(){return this.lij[2]===this.surface.lijEastEnd(this.level)-1}get isWestEnd(){return this.lij[2]===0}get isNorthEnd(){return this.lij[1]===0}get isSouthEnd(){return this.extent[1]+At>=this.surface.extent[1]}compareLIJs(t){const r=this.lij,i=r[0],s=t[0];if(i===s)return[r,t];const n=i-s;if(n<0){const o=2**-n;return[[s,r[1]*o,r[2]*o],t]}{const o=2**n;return[r,[i,t[1]*o,t[2]*o]]}}checkGeometryWaterproofness(){}shouldHaveNeighbor(t){const r=this.extent,i=this.surface.rootTilesExtent,s=.25*(r[2]-r[0]);if(cge(t)&&r[3]+s>=i[3]||lge(t)&&r[1]-s<=i[1])return!1;const n=this.surface.isGlobal;return!(!n&&oge(t)&&r[0]-s<=i[0])&&!(!n&&age(t)&&r[2]+s>=i[2])}}function tSt(e,t,r,i){const s=r===Qt.ELEVATION?tne.acquire():ene.acquire();return s.init(e,t,r,i),s}function zF(e){e.dispose(),e instanceof A$e?tne.release(e):e instanceof R$e&&ene.release(e)}const ene=new Ls(R$e),tne=new Ls(A$e),rSt=new Zse;var tl;function iSt(e,t){const r=e.level,i=t[0];if(r>i)return!1;const s=i-r,n=Math.floor(t[1]/2**s),o=Math.floor(t[2]/2**s);return n===e.lij[1]&&o===e.lij[2]}function sSt(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]}function Gj(e,t,r){return Math.abs(e-t)<=r}function nSt(e,t,r){return!R(e)&&!R(t)&&t!==e&&(e.level>=t.level?Sge(e,t,r):Sge(t,e,mz(r)))}function Sge(e,t,r){e.level>=t.level;const i=Pxt(r),s=Ixt(r),n=e.extent,o=t.extent,a=[i?n[0]:n[2],s?n[3]:n[1]],l=[i?o[2]:o[0],s?o[1]:o[3]],c=1e-5*(n[2]-n[0]),h=Gj(a[0],l[0],c)||e.surface.isGlobal&&Gj(a[0],-l[0],c),p=Gj(a[1],l[1],c);return h&&p?!0:e.level===t.level||!h&&!p?!1:h?Ege(o[1],o[3],n[1],n[3],c):Ege(o[0],o[2],n[0],n[2],c)}function Ege(e,t,r,i,s=At){return e-s<=r&&r<=i&&i<=t+s}(function(e){e[e.TOP=0]="TOP",e[e.MIDDLE=1]="MIDDLE",e[e.BOTTOM=2]="BOTTOM"})(tl||(tl={}));class oSt{constructor(){this._scales=[-1,-1,-1,-1],this._offsets=[-1,-1,-1,-1]}clear(){this._scales[0]=this._scales[1]=this._scales[2]=this._scales[3]=-1,this._offsets[0]=this._offsets[1]=this._offsets[2]=this._offsets[3]=-1}setScale(t,r,i){this._scales[2*t]=r,this._scales[2*t+1]=i}setOffset(t,r,i){this._offsets[2*t]=r,this._offsets[2*t+1]=i}get scales(){return this._scales}get offsets(){return this._offsets}}class Vy{constructor(){this.geometryInfo=new _Tt,this.intersectionData=null,this.geometryState=null,this._textureRef=new xC(()=>this.tile.surface.textureFadeDuration),this.overlay=new oSt,this._geometryStateChangedSinceLastUpdate=!0,this._hasGeometry=!1,this._numVerticesPerSideChanged=!1,this._samplerDataChanged=!1,this._edgeResolutionChanged=!1,this._edgeNeighborChanged=!1,this._cornerElevationChanged=!1,this._clippingAreaChanged=!1,this._wireframeChanged=!1}get tile(){return this._tile}init(t){this._tile=t,this.clear();const r=this.geometryInfo;r.indices=null,r.vertexAttributes=null,vi(r.boundingBox),r.indexCount=0,r.numVerticesPerSide=0,this.intersectionData=null,this.geometryState=new ETt,this.localOrigin=null,this.overlay.clear()}clear(){this._releaseGeometry(),this.releaseTexture(),this._textureRef.clear()}updateGeometryIfChanged(t,r){const i=this.updateGeometryStateAndPrepareForGeometryGeneration(r);return this._hasGeometry=!0,this.updateNeighborDataAndGeometryIfNeeded(i,t)}updateNeighborDataAndGeometryIfNeeded(t=!1,r=this.vao.context){const i=this._updateNeighborData(),s=t||this._geometryStateChangedSinceLastUpdate||i;return s&&(this._updateGeometry(r),this._geometryStateChangedSinceLastUpdate=!1),s}_calculateEdgeResolution(t,r){var c;const i=this.tile,s=this.geometryState.numVerticesPerSide-1;if(!i.surface.isGlobal){const h=i.surface.extent;if(b(h)&&(t===0&&i.extent[3]>h[3]||t===1&&i.extent[2]>h[2]||t===2&&i.extent[1]<h[1]||t===3&&i.extent[0]<h[0]))return s}const n=i.level,o=R_[t],a=r||i.findNeighborTile(o,h=>h.isLoaded||h.level===n);if(!a||a.isLeaf&&!a.isLoaded)return R((c=i.surface)==null?void 0:c.rootTiles)||i.surface.updatingRootTiles||i.shouldHaveNeighbor(o),s;if(a.isLoaded){const h=a,p=h.renderData.geometryState,f=n-h.level;if(f===0){const v=p.numVerticesPerSide-1;return Math.max(v,s)}const m=2**f,g=p.neighborData.edgeResolutions[(t+2)%4]/m;return Math.max(1,g)}a.isLeaf;let l=s;return a.forAllSubtreeOnSide(pk(o),h=>h===i||(h.isLoaded?(l=Math.max(l,2**(h.level-n)),!0):(h.isLeaf,!1))),l}_updateNeighborData(){const t=this.tile,r=c=>c.isLoaded||c.level===t.level,i=c=>c.isLoaded,s=[null,null,null,null],n=[null,null,null,null];(()=>{for(let c=0;c<4;++c){const h=t.findNeighborTile(R_[c],r);s[c]=h,n[c]=h!=null&&h.isLoaded?h:null}})();const o=[null,null,null,null];(()=>{for(let c=0;c<4;++c)o[c]=t.findNeighborTile(gz[c],i)})();const a=this.geometryState.neighborData;let l=!1;return(()=>{for(let c=0;c<4;++c){const h=a.edgeResolutions[c],p=s[c],f=this._calculateEdgeResolution(c,p);a.edgeResolutions[c]=f,h!==f&&(l=!0,this._edgeResolutionChanged=!0,p&&p!==t&&!p.isLoaded&&p.level===t.level&&(a.modifiedEdgeResolutions[c]=!0))}})(),(()=>{const c=(f,m)=>{var _,T;const g=f.reduce((x,E)=>{var C;return Math.min(x,(C=E==null?void 0:E.level)!=null?C:1/0)},1/0);for(let x=0;x<4;++x){const E=f[(x+3)%4],C=f[x];if(E&&E.level<t.level&&E===C){const A=E,P=(1&x)==1,I=(t.getNeighborEdgeStartVertexIndex(x,A)+(m===0||m===1&&!P||m===3&&P?1:0))/2**(t.level-A.level),L=P?m===0||m===1?A.extent[0]:A.extent[2]:Yt(A.extent[0],A.extent[2],I),k=P?Yt(A.extent[1],A.extent[3],I):m===0||m===3?A.extent[1]:A.extent[3];return Si(L,k,A.renderData.geometryState.samplerData)}}let v=0,w=0;for(let x=0;x<4;++x){const E=f[x];if(E&&E.level===g){const C=x===0||x===1,A=x===0||x===3,P=E.extent;w+=Si(P[C?0:2],P[A?1:3],(T=(_=E.renderData)==null?void 0:_.geometryState)==null?void 0:T.samplerData),v++}}return v?w/v:0},h=a.cornerNeighborData,p=(f,m)=>{var _;const g=h[f],v=g.cornerTiles;for(let T=0;T<4;++T){const x=gz[T],E=(_=m[T])==null?void 0:_.findCorner(mz(x),C=>(C==null?void 0:C.isLoaded)||C===t);v[T]=E}const w=c(v,f);return g.elevation!==w&&(g.elevation=w,!0)};for(let f=0;f<4;++f){const m=o[f],g=n[f],v=[m,n[(f+1)%4],t,g],w=v.map((_,T)=>v[(T+4-f)%4]);p(f,w)&&(this._cornerElevationChanged=!0,l=!0)}})(),(()=>{var p;const c=(f,m)=>{if(!(f!=null&&f.isLoaded)||f.lij[0]>t.lij[0])return null;const g=f.renderData.geometryState;return{neighborSamplerData:g.samplerData,neighborEdgeOverlapResolution:g.neighborData.edgeResolutions[m+2],version:g.samplerDataVersion,neighborVerticesPerSide:g.numVerticesPerSide,neighborTile:f}},h=a.edgeNeighbours;for(let f=0;f<4;++f){const m=n[f];m&&(m==null||m.isLoaded,(m==null?void 0:m.lij[0])<=t.lij[0],void 0);const g=h[f],v=g==null?void 0:g.version,w=c(m,f),_=(p=w==null?void 0:w.version)!=null?p:null,T=g!=null!=(w!=null),x=g&&w&&v!==_,E=g&&w&&(g==null?void 0:g.neighborTile)!==(w==null?void 0:w.neighborTile),C=T||x||E;this._edgeNeighborChanged||(this._edgeNeighborChanged=C),l||(l=C),!C&&v||(h[f]=w)}})(),l}updateEdgeAfterResolutionChange(t){var n,o;const r=this._calculateEdgeResolution(t),i=this.geometryState.neighborData.edgeResolutions,s=i[t];((o=(n=this.geometryState.neighborData.edgeNeighbours[t])==null?void 0:n.neighborTile.level)!=null?o:0)<=this.tile.level,r!==s&&(i[t]=r,this._edgeResolutionChanged=!0,Vy.deferTileNeighborUpdate?Vy.neighborTilesToUpdate.add(this.tile):this._updateGeometry(this.vao.context))}_updateGeometry(t){this.intersectionData=null;const r=this.tile,i=r.lij,s=Vy.updatedGeometryTiles.get(i)||0;Vy.updatedGeometryTiles.set(i,s+1);const n=this._vao,o=this.geometryInfo.vertexAttributes,a=!n||!o||this._wireframeChanged||this._numVerticesPerSideChanged||this._samplerDataChanged||this._clippingAreaChanged||this._edgeResolutionChanged,l=!a&&this._edgeNeighborChanged,c=!l&&this._cornerElevationChanged;this._numVerticesPerSideChanged=!1,this._samplerDataChanged=!1,this._edgeResolutionChanged=!1,this._edgeNeighborChanged=!1,this._cornerElevationChanged=!1,this._clippingAreaChanged=!1,this._wireframeChanged=!1,a?(this._releaseGeometry(),this._createGeometry(t)):l?r.updateEdgeElevations():c?r.updateCornerElevations():console.warn("Update for no reason?")}releaseGeometry(){return this._releaseGeometry()}get hasGeometry(){return this._hasGeometry}ensureTexture(t,r){return b(this._texture)&&this._texture.descriptor.width!==t&&this.releaseTexture(),R(this._texture)&&(this._texture=r(),this.tile.setMemoryDirty()),this._texture}releaseTexture(){b(this._texture)&&(this._texture.release(),this._texture=null,this.tile.setMemoryDirty())}updateGeometryStateAndPrepareForGeometryGeneration(t){const r=this._getElevationInfo(),i=r.samplerData?this.tile.getElevationBasedVerticesPerSide(r.maxTileLevel):this.tile.getDefaultVerticesPerRowOnLevel(),s=Math.max(i,5);let n=this.tile.clippingArea;this.tile.intersectsClippingArea&&!this.tile.isWithinClippingArea||(n=null);const o=this.geometryState;let a=!1;return o.numVerticesPerSide!==s&&(this._numVerticesPerSideChanged=!0,o.numVerticesPerSide=s,o.samplerDataVersion++,a=!0),r.changed&&(this._samplerDataChanged=!0,o.samplerData=r.samplerData,o.samplerDataVersion++,a=!0),x1(o.clippingArea,n)||(this._clippingAreaChanged=!0,o.clippingArea=n,a=!0),o.wireframe!==t&&(this._wireframeChanged=!0,o.wireframe=t,a=!0),this._geometryStateChangedSinceLastUpdate||(this._geometryStateChangedSinceLastUpdate=a),this._hasGeometry=!0,a}_createGeometry(t){this.tile.createGeometry();const r=this.geometryInfo.vertexAttributes,i=this.geometryInfo.indices,s=t.gl;this._vao=new rn(t,zr,{geometry:du(r.layout)},{geometry:cr.createVertex(t,s.STATIC_DRAW,r.buffer)},cr.createIndex(t,s.STATIC_DRAW,i)),this._hasGeometry=!0}_releaseGeometry(){return this._hasGeometry=!1,!!this._vao&&(this._vao.dispose(),this._vao=null,xTt(this.geometryInfo),!0)}get vao(){return this._vao}setTextureReference(t,r=e0.Immediate){b(t)&&t.texture!==this._texture&&this.releaseTexture(),this._textureRef.push(t,r)}get textureReference(){return this._textureRef.current}get nextTextureReference(){return this._textureRef.next}get textureFadeFactor(){return this._textureRef.fadeFactor}get textureIsFading(){return this._textureRef.isFading}_getElevationInfo(){const t=this.geometryState.samplerData,r=this.tile.layerInfo[Qt.ELEVATION],i=r.length;let s=new Array(i),n=0,o=0,a=!1;for(let l=0;l<i;l++){const c=r[l];if(b(c.upsampleInfo)){const h=c.upsampleInfo.tile,p=h.layerInfo[Qt.ELEVATION][l].data,f=p&&p.samplerData;t&&t[n]===f||(a=!0),s[n++]=f,o=Math.max(o,h.lij[0])}else if(c.data){const h=this.tile.surface.layerViewByIndex(l,Qt.ELEVATION);if(RP(this.tile,h.layer,!1)){const p=c.data;t&&t[n]===p.samplerData||(a=!0),s[n++]=p.samplerData,o=this.tile.level}}}return b(t)&&t.length!==n&&(a=!0),n>0?s.length=n:s=null,{changed:a,samplerData:s,maxTileLevel:o}}get estimatedGeometryMemoryUsage(){const t=Xu(this.intersectionData,0,r=>r.estimatedMemoryUsage);return this.geometryInfo.indices.byteLength+this.geometryInfo.vertexAttributes.byteLength+t}get textureDescriptor(){return b(this._texture)?this._texture.descriptor:null}get test(){return{hasTexture:this._texture!=null}}checkGeometryWaterproofness(){}}Vy.updatedGeometryTiles=new Map,Vy.deferTileNeighborUpdate=!1,Vy.neighborTilesToUpdate=new Set;const aSt=65536;function lSt(e,t){const r=e.tile,{extent:i,extentInRadians:s,surface:n}=r,o=e.localOrigin,a=e.geometryState,l=n.isWebMercator,c=n.shadingEnabled,h=a.numVerticesPerSide,p=h-1,f=(h-2)**2,m=l&&(t===_d.HAS_SOUTH_POLE||t===_d.HAS_BOTH_POLES),g=l&&(t===_d.HAS_NORTH_POLE||t===_d.HAS_BOTH_POLES),v=6,w=((m?1:0)+(g?1:0))*v*(p+1),_=a.neighborData,T=_.edgeResolutions.reduce((Y,H)=>Y+H+1,0),x=x$e(f+w+T),E=e.geometryInfo;E.numVerticesPerSide=a.numVerticesPerSide,E.vertexAttributes=x,Kr(E.uvOffsetAndScale,0,0,1,1);const C=x.position.typedBuffer,A=x.uv0.typedBuffer,P=x.normal.typedBuffer,I=E.boundingBox;vi(I);const L=o[0],k=o[1],G=o[2];Bb.update(p,s);let z=0;const X=a.samplerData,Z=r.ellipsoid.radius,ce=ine(e),ne=h-2,D=i[0],N=i[2],V=i[1],B=i[3];(()=>{for(let Y=1;Y<=ne;Y++){const H=Y/p,ee=V*(1-H)+B*H,me=ce(H),be=Math.cos(me),De=Math.sin(me);for(let ve=1;ve<=ne;ve++){const ge=ve/p,Ee=D*(1-ge)+N*ge,Fe=Bb.sinLonLUT[ve],Nr=Bb.cosLonLUT[ve],Br=Z+Si(Ee,ee,X),ur=Nr*be*Br-L,Gr=Fe*be*Br-k,pr=De*Br-G;t0(ur,Gr,pr,I);const jr=od*z;C[jr+0]=ur,C[jr+1]=Gr,C[jr+2]=pr,A[jr+0]=ge,A[jr+1]=H,++z}}})(),c&&(()=>{const Y=ve=>(pe(r0,ve,jj),ut(WA,r0,_1),ut(XA,WA,r0),XA),H=x.position,ee=x.normal;z=0;const me=ve=>{H.getVec(ve,Xc),de(bs,bs,Y(Xc))},be=(ve,ge)=>{{const Ee=ve/p,Fe=D*(1-Ee)+N*Ee,Nr=Bb.sinLonLUT[ve],Br=Bb.cosLonLUT[ve],ur=ge/p,Gr=V*(1-ur)+B*ur,pr=ce(ur),jr=Math.cos(pr),Qi=Math.sin(pr),fs=Z+Si(Fe,Gr,X);se(Xc,Br*jr*fs-L,Nr*jr*fs-k,Qi*fs-G)}de(bs,bs,Y(Xc))},De=(ve,ge,Ee)=>{ve>1&&ge>1&&ve<ne&&ge<ne?me(z+Ee):be(ve,ge)};for(let ve=1;ve<=ne;ve++)for(let ge=1;ge<=ne;ge++)H.getVec(z,jj),de(Dm,jj,e.localOrigin),we(_1,Dm),se(bs,0,0,0),De(ge-1,ve,-1),De(ge+1,ve,1),De(ge,ve-1,-ne),De(ge,ve+1,+ne),we(bs,bs),ee.setVec(z,bs),++z})(),z=f,$$e(e,f),U$e(e),z=f+T;const W=[];(()=>{const Y=(H,ee)=>{const me=ee*h;t0(-L,-k,H*Z-G,I),W.push({connectedRowOffset:me,connectedOuterEdgeOffset:H===1?0:2,rowOffset:z,latitudeResolution:v});const be=z$e(H===-1?V:B,Z),De=H*Math.PI/2-be,ve=.99*(H===1?1:-1),ge=Z+0;for(let Ee=1;Ee<=v;++Ee){const Fe=be+De*(Ee/v),Nr=Math.cos(Fe),Br=Math.sin(Fe);for(let ur=0;ur<=p;ur++){const Gr=ur/p,pr=Bb.sinLonLUT[ur],jr=Bb.cosLonLUT[ur]*Nr*ge-L,Qi=pr*Nr*ge-k,fs=Br*ge-G;t0(jr,Qi,fs,I);const st=od*z;if(C[st+0]=jr,C[st+1]=Qi,C[st+2]=fs,A[st+0]=Gr,A[st+1]=ve,c){const Li=1/Math.sqrt(jr*jr+Qi*Qi+fs*fs);P[st+0]=Li*jr,P[st+1]=Li*Qi,P[st+2]=Li*fs}++z}}};m&&Y(-1,0),g&&Y(1,p)})(),I$e(E,a.numVerticesPerSide,W,[0,h-1],[0,h-1],a.wireframe),e.intersectionData=null;for(let Y=0;Y<4;++Y)E.outerEdges[Y].count,_.edgeResolutions[Y]+1}function cSt(e,t){const r=e.tile,i=r.extent,s=e.localOrigin,n=e.geometryState,o=r.surface,a=o.isWebMercatorOnPlateeCarree,l=o.shadingEnabled,c=i[0],h=i[1],p=i[2]-c,f=i[3]-h,m=n.clippingArea,g=b(m)?Math.max(0,(m[0]-i[0])/p):0,v=b(m)?Math.max(0,(m[1]-i[1])/f):0,w=b(m)?Math.min(1,(m[2]-i[0])/p):1,_=b(m)?Math.min(1,(m[3]-i[1])/f):1,T=w-g,x=_-v,E=T>0?1/T:1,C=x>0?1/x:1,A=-g*E,P=-v*C,I=n.numVerticesPerSide,L=I-1,k=(I-2)**2+n.neighborData.edgeResolutions.reduce((be,De)=>be+De+1,0),G=x$e(k),z=G.position.typedBuffer,X=G.uv0.typedBuffer,Z=G.normal.typedBuffer,ce=e.geometryInfo,ne=ce.boundingBox;vi(ne);let D=0;const N=r.ellipsoid.radius,V=n.samplerData,B=b(m)?m:H$e,W=Uee(Math.max(i[0],B[0]),Math.max(i[1],B[1]),Math.min(i[2],B[2]),Math.min(i[3],B[3])),Y=s[0],H=s[1],ee=s[2],me=NL(a,N,t);(()=>{for(let be=1;be<=L-1;be++){const De=be/L,ve=P+De*C,ge=Le(h+De*f,W[1],W[3]),Ee=Le(ve,0,1),Fe=me(ge)-H,Nr=p/L;for(let Br=1;Br<=L-1;Br++){const ur=Br/L,Gr=A+ur*E,pr=Le(c+ur*p,W[0],W[2]),jr=Le(Gr,0,1),Qi=Si(pr,ge,V),fs=pr*t-Y,st=Qi-ee;t0(fs,Fe,st,ne);const Li=od*D;if(z[Li+0]=fs,z[Li+1]=Fe,z[Li+2]=st,X[Li+0]=jr,X[Li+1]=Ee,l){const ao=Si(pr+Nr,ge,V),bl=Si(pr-Nr,ge,V),Na=Si(pr,ge+Nr,V),Qd=.25*(bl-ao),Jd=.25*(Si(pr,ge-Nr,V)-Na),Fa=Nr,ib=Math.sqrt(Qd*Qd+Jd*Jd+Fa*Fa);Z[Li+0]=Qd/ib,Z[Li+1]=Jd/ib,Z[Li+2]=Fa/ib}++D}}})(),ce.numVerticesPerSide=n.numVerticesPerSide,ce.vertexAttributes=G,Kr(e.geometryInfo.uvOffsetAndScale,g,v,w-g,_-v),$$e(e,D),L$e(e,t),D=k,I$e(ce,n.numVerticesPerSide,[],[0,I-1],[0,I-1],n.wireframe),e.intersectionData=null}function I$e(e,t,r,i,s,n){const o=t-1,a=e.vertexAttributes.count,l=2*(Math.min(t-2,i[1])-Math.max(1,i[0]))*(Math.min(t-2,s[1])-Math.max(1,s[0])),c=R_.map((_,T)=>T===0&&s[1]<t-2||T===1&&i[1]<t-2||T===2&&s[0]>1||T===3&&i[0]>1),h=3*(l+e.outerEdges.reduce((_,T,x)=>_+(c[x]?0:o-2+T.count-1),0)+r.reduce((_,T)=>_+o*(2*(T.latitudeResolution-1)+1),0))*(n?2:1),p=new(a>aSt?Uint32Array:Uint16Array)(h);let f=0;const m=n?(_,T,x)=>{p[f++]=_,p[f++]=T,p[f++]=T,p[f++]=x,p[f++]=x,p[f++]=_}:(_,T,x)=>{p[f++]=_,p[f++]=T,p[f++]=x},g=t-2,v=o-2;(()=>{for(let _=Math.max(s[0],1)-1;_<Math.min(s[1],t-2)-1;++_)for(let T=Math.max(i[0],1)-1;T<Math.min(i[1],t-2)-1;++T){const x=_*g+T,E=x+1,C=E+g,A=C-1;m(x,E,C),m(C,A,x)}})(),(()=>{for(let _=0;_<4;++_){if(c[_])continue;const T=e.outerEdges[_],x=e.innerEdges[_];let E=0,C=0;const A=T.count,P=x.count;T.count;const I=_===1||_===2?(L,k,G)=>m(L,k,G):(L,k,G)=>m(L,G,k);for(;E<A-1||C<P-1;){const L=x.getVertexOffset(C),k=T.getVertexOffset(E),G=E<A-1,z=C<P-1,X=G?0+o*(E+.5)/(A-1):0,Z=z?1+v*(C+.5)/(P-1):0;G&&(!z||X<=Z)?(++E,I(L,k,T.getVertexOffset(E))):(++C,I(L,k,x.getVertexOffset(C)))}}})();const w=_=>{let T=e.outerEdges[_.connectedOuterEdgeOffset].offset0;for(let x=0;x<_.latitudeResolution;++x){const E=x===0?_.rowOffset:T+t;for(let C=0;C<o;C++)m(T,T+1,E+C),x<_.latitudeResolution-1&&m(T+1,E+C+1,E+C),++T;T=E}};r.forEach(w),e.indices=p,e.indexCount=h}function $$e(e,t){const r=e.localOrigin,i=e.geometryInfo,s=e.geometryState.neighborData.edgeResolutions,n=i.numVerticesPerSide-2,o=i.vertexAttributes.position.typedBuffer;let a=t;for(let l=0;l<4;++l){{const c=l===0||l===2,h=(l===0?n-1:0)*n+(l===1?n-1:0),p=(c?0:1)*n+(c?1:0);i.innerEdges[l]=new _ge(o,r,h,p,n)}{const c=a,h=s[l]+1;i.outerEdges[l]=new _ge(o,r,c,1,h),a+=h}}}function uSt(e){var i,s;N$e(e),B$e(e);const t=e.vao,r=e.geometryInfo.vertexAttributes;(s=(i=t==null?void 0:t.vertexBuffers)==null?void 0:i.geometry)==null||s.setSubData(r.position.typedBuffer)}function hSt(e){U$e(e),rne(e)}function dSt(e,t){F$e(e,t),G$e(e,t),rne(e)}function pSt(e,t){L$e(e,t),rne(e)}function L$e(e,t){F$e(e,t),bSt(e,t),G$e(e,t)}function D$e(e,t,r,i,s){const n=Math.cos(r),o=Math.sin(r),a=Math.sin(t),l=Math.cos(t),c=s+i;e[0]=l*n*c,e[1]=a*n*c,e[2]=o*c}function fSt(e,t,r,i,s,n){const o=s[r===0?1:3];D$e(e,s[t===0?0:2],o,i,n)}function mSt(e,t){return(Math.PI/2-2*Math.atan(Math.exp(-e/t)))*t}function gSt(e,t){return e*t}function NL(e,t,r){return e?i=>mSt(i,t):i=>gSt(i,r)}function ySt(e,t,r,i,s,n,o){const a=t===0?s[0]:s[2],l=r===0?s[1]:s[3],c=i;e[0]=a*n,e[1]=o(l),e[2]=c}function vSt(e,t){const r=e.geometryState,i=e.tile,s=i.extent,n=_t(r.clippingArea,s),o=e.geometryInfo,a=o.boundingBox,l=o.outerEdges,c=r.neighborData.cornerNeighborData,h=o.uvOffsetAndScale[0],p=o.uvOffsetAndScale[1],f=o.uvOffsetAndScale[2],m=o.uvOffsetAndScale[3],g=f>0?1/f:1,v=m>0?1/m:1,w=-h*g,_=-p*v,T=i.surface.isWebMercatorOnPlateeCarree,x=NL(T,T?i.ellipsoid.radius:0,t),E=r.samplerData,C=r.neighborData.edgeNeighbours,A=e.localOrigin,P=(I,L,k,G,z)=>{const X=s[0]*(1-G)+s[2]*G,Z=s[1]*(1-z)+s[3]*z,ce=Le(X,n[0],n[2]),ne=Le(Z,n[1],n[3]),D=[ne===s[3],ce===s[2],ne===s[1],ce===s[0]],N=!D[3]&&!D[1]||!D[0]&&!D[2],V=N?D[0]&&b(C[0])?C[0]:D[1]&&b(C[1])?C[1]:D[2]&&b(C[2])?C[2]:D[3]&&b(C[3])?C[3]:null:null,B=N?V?V.neighborTile.level===i.level?.5*(Si(ce,ne,E)+Si(ce,ne,V.neighborSamplerData)):Si(ce,ne,V.neighborSamplerData):Si(ce,ne,E):c[k].elevation,W=ce*t-A[0],Y=x(ne)-A[1],H=B-A[2];t0(W,Y,H,a);const ee=Le(w+G*g,0,1),me=Le(_+z*v,0,1);I.setVertexRawXYZUV(L,W,Y,H,ee,me)};for(let I=0;I<4;++I){const L=l[I];P(L,0,I===0?3:I===1?1:2,I===1?1:0,I===0?1:0);const k=I===2?1:I===3?3:0,G=I===3?0:1,z=I===2?0:1;P(L,L.count-1,k,G,z)}}function N$e(e){k$e(e,(t,r,i,s)=>fSt(t,r,i,s,e.tile.extentInRadians,e.tile.ellipsoid.radius))}function F$e(e,t){const r=e.tile;b(r.renderData.geometryState.clippingArea)?vSt(e,t):k$e(e,(i,s,n,o)=>ySt(i,s,n,o,e.tile.extent,t,NL(r.surface.isWebMercatorOnPlateeCarree,r.ellipsoid.radius,t)))}function k$e(e,t){const r=e.geometryInfo,i=r.outerEdges,s=e.geometryState.neighborData.cornerNeighborData,n=r.boundingBox,o=e.localOrigin,a=(l,c,h,p,f)=>{t(fv,h,p,s[c].elevation);for(let m=0;m<3;++m)fv[m]-=o[m];t0(fv[0],fv[1],fv[2],n),l.setVertexRawXYZUV(f,fv[0],fv[1],fv[2],h,p)};for(let l=0;l<4;++l){const c=i[l];a(c,l===0?3:l===1?1:2,l===1?1:0,l===0?1:0,0),a(c,l===2?1:l===3?3:0,l===3?0:1,l===2?0:1,c.count-1)}}function rne(e){var i,s;const t=e.vao,r=e.geometryInfo.vertexAttributes;(s=(i=t==null?void 0:t.vertexBuffers)==null?void 0:i.geometry)==null||s.setSubData(r.position.typedBuffer)}function U$e(e){N$e(e);for(let t=0;t<4;++t)_St(e,t);B$e(e)}function _St(e,t){var BL,GL,jL;const r=e.geometryState,i=r.neighborData,s=e.tile;s.level;const n=s.extent,o=n[2]-n[0],a=n[3]-n[1],l=s.extentInRadians,c=l[0];l[1];const h=l[2];l[3];const p=s.ellipsoid.radius,f=ine(e),m=Lr=>{if(!Lr)return 0;const la=v,Fo=w?0:1,pc=Lr.lij[Fo+1]*L,sb=s.lij[Fo+1]-pc;return(w?L-1-sb:sb)*la},g=i.edgeNeighbours[t],v=i.edgeResolutions[t],w=t===1||t===3,_=t===1?1:0,T=t===0?1:0,x=n[0]+_*o,E=n[1]+T*a,C=c*(1-_)+h*_,A=f(T),P=g==null?void 0:g.neighborTile,I=s.level-((BL=P==null?void 0:P.level)!=null?BL:s.level),L=2**I,k=v*L,G=m(P),z=P==null?void 0:P.extent,X=(t+2)%4,Z=r.samplerData,ce=(jL=(GL=P==null?void 0:P.renderData)==null?void 0:GL.geometryState)==null?void 0:jL.samplerData,ne=P&&I===0,D=(Lr,la,Fo,pc)=>.5*(Si(Lr,la,ce)+Si(Fo,pc,Z)),N=(Lr,la)=>Si(Lr,la,ce),V=ne?D:N;let B=z?X===1?z[2]:z[0]:x,W=z?X===0?z[3]:z[1]:E;const Y=(Lr,la,Fo)=>{const pc=(G+Lr)/k;return W=z[1]*(1-pc)+z[3]*pc,V(B,W,la,Fo)},H=(Lr,la,Fo)=>{const pc=(G+Lr)/k;return B=z[0]*(1-pc)+z[2]*pc,V(B,W,la,Fo)},ee=P?w?Y:H:(Lr,la,Fo)=>Si(la,Fo,Z),me=(Lr,la,Fo)=>ee(Lr,la,Fo);let be=_,De=x,ve=C,ge=T,Ee=E,Fe=A,Nr=Math.sin(ve),Br=Math.cos(ve),ur=Math.cos(Fe),Gr=Math.sin(Fe);const pr=w?()=>f(ge):()=>A,jr=w?Lr=>{ge=Lr,Ee=n[1]*(1-Lr)+n[3]*Lr,Fe=pr(),ur=Math.cos(Fe),Gr=Math.sin(Fe)}:Lr=>{be=Lr,De=n[0]*(1-Lr)+n[2]*Lr,ve=c*(1-be)+h*be,Nr=Math.sin(ve),Br=Math.cos(ve)},Qi=e.geometryInfo,fs=Qi.boundingBox,st=Qi.vertexAttributes,Li=st.position.typedBuffer,ao=st.uv0.typedBuffer,bl=st.normal.typedBuffer,Na=Qi.outerEdges[t];let Qd=Na.getVertexOffset(1);const Jd=v+1,Fa=e.localOrigin,ib=Fa[0],G8=Fa[1],j8=Fa[2],kL=s.surface.shadingEnabled,UL=t===1?-1:t===3?1:0,VL=t===0?-1:t===2?1:0,zL=o/v,H8=UL*zL,q8=VL*zL,W8=UL*(1/v),X8=VL*(1/v),$R=Lr=>{su(r0,Lr,Dm),ut(WA,r0,_1),ut(XA,WA,r0),de(bs,bs,XA)};for(let Lr=1;Lr<Jd-1;++Lr){jr(Lr/v);const la=me(Lr,De,Ee),Fo=p+la,pc=Br*ur*Fo,sb=Nr*ur*Fo,HL=Gr*Fo,qL=pc-ib,WL=sb-G8,XL=HL-j8;t0(qL,WL,XL,fs);const Af=od*Qd;if(Li[Af+0]=qL,Li[Af+1]=WL,Li[Af+2]=XL,ao[Af+0]=be,ao[Af+1]=ge,kL){se(bs,0,0,0),se(Dm,pc,sb,HL),we(_1,Dm);const ue=(Di,aS)=>{const Rh=Si(De+Di*H8,Ee+Di*q8,aS),nb=p+Rh,dt=be+Di*W8,ob=c*(1-dt)+h*dt,Vn=Math.sin(ob),ab=Math.cos(ob),ZL=f(ge+Di*X8),Kd=Math.sin(ZL),LR=Math.cos(ZL),YL=Ue(ab*LR*nb,Vn*LR*nb,Kd*nb);$R(YL)};P&&ue(-1,ce),P&&!ne||ue(1,Z),bl[Af+0]=bs[0],bl[Af+1]=bs[1],bl[Af+2]=bs[2]}++Qd}if(kL)for(let Lr=1;Lr<Jd-1;++Lr)Na.getVertexRawNormal(bs,Lr),Na.getVertex(Dm,Lr),we(_1,Dm),Na.getVertex(Xc,Lr-1),$R(Xc),Na.getVertex(Xc,Lr+1),$R(Xc),we(bs,bs),Na.setVertexRawNormal(Lr,bs[0],bs[1],bs[2])}function bSt(e,t){const r=e.geometryState.clippingArea,i=e.tile.extent,s=b(r)&&(i[0]<r[0]||i[2]>r[2]||i[1]<r[1]||i[3]>r[3])?xSt:wSt;for(let n=0;n<4;++n)s(e,n,t)}function V$e(e,t,r,i,s,n,o){return o===s?!e||t?(a,l)=>Si(a,l,r):null:o===n&&e?(a,l)=>Si(a,l,i):null}function yz(e,t,r,i){if(t!==e)return()=>0;const s=t?3:2,n=t?1:0,o=i(s,n),a=i(n,s),l=(o!=null?1:0)+(a!=null?1:0),c=t?r:0,h=t?0:r;return(p,f,m)=>((o!=null?-(o(p+c,f+h)-m):0)+(a!=null?+(a(p-c,f-h)-m):0))/l}function wSt(e,t,r){const i=e.geometryState.neighborData,s=i.edgeNeighbours,n=e.tile,o=n.level,a=n.surface,l=a.shadingEnabled,c=s[t],h=i.edgeResolutions[t],p=h,f=n.extent,m=e.geometryState,g=p+1,v=c,w=e.localOrigin,_=m.samplerData,T=(H,ee)=>Si(H,ee,_),x=(H,ee)=>.5*(Si(H,ee,v.neighborSamplerData)+Si(H,ee,_)),E=(H,ee)=>Si(H,ee,v.neighborSamplerData),C=(v==null?void 0:v.neighborTile.level)===o,A=C?x:E,P=b(v)?A:T,I=e.geometryInfo,L=I.outerEdges[t],k=NL(a.isWebMercatorOnPlateeCarree,n.ellipsoid.radius,r),G=I.boundingBox,z=t===1||t===3,X=t===1?f[2]:f[0],Z=t===0?f[3]:f[1],ce=t===1?1:0,ne=t===0?1:0,D=(f[2]-f[0])/h,N=v==null?void 0:v.neighborSamplerData,V=b(v),B=(H,ee)=>V$e(V,C,_,N,H,ee,t),W=yz(z,!0,D,B),Y=yz(z,!1,D,B);for(let H=1;H<g-1;++H){const ee=H/p,me=z?X:f[0]*(1-ee)+f[2]*ee,be=z?f[1]*(1-ee)+f[3]*ee:Z,De=z?ce:ee,ve=z?ee:ne,ge=P(me,be),Ee=me*r-w[0],Fe=k(be)-w[1],Nr=ge-w[2];if(t0(Ee,Fe,Nr,G),l){const Br=W(me,be,ge),ur=Y(me,be,ge),Gr=D;L.setVertexRawXYZUVN(H,Ee,Fe,Nr,De,ve,Br,ur,Gr)}else L.setVertexRawXYZUV(H,Ee,Fe,Nr,De,ve)}if(l){const H=z?0:1,ee=z?1:0;for(let me=1;me<g-1;++me){L.getNormal(TC,me);const be=L.getVertexZ(me-1)-L.getVertexZ(me+1),De=TC[0]+.5*H*be,ve=TC[1]+.5*ee*be,ge=2*D,Ee=1/Math.sqrt(De*De+ve*ve+ge*ge);L.setVertexRawNormal(me,Ee*De,Ee*ve,Ee*ge)}}}function xSt(e,t,r){const i=e.geometryState.neighborData,s=i.edgeNeighbours,n=e.tile,o=n.level,a=n.surface,l=a.shadingEnabled,c=s[t],h=i.edgeResolutions[t],p=h,f=n.extent,m=e.geometryState,g=_t(m.clippingArea,H$e),v=e.geometryInfo,w=v.uvOffsetAndScale[0],_=v.uvOffsetAndScale[1],T=w+v.uvOffsetAndScale[2],x=_+v.uvOffsetAndScale[3],E=T>w?1/(T-w):1,C=x>_?1/(x-_):1,A=-w*E,P=-_*C,I=p+1,L=[f[3]>g[3],f[2]>g[2],f[1]<g[1],f[0]<g[0]],k=c,G=m.samplerData,z=(ur,Gr)=>Si(ur,Gr,G),X=(k==null?void 0:k.neighborTile.level)===o,Z=(ur,Gr)=>{const pr=Si(ur,Gr,k.neighborSamplerData);return X?.5*(pr+Si(ur,Gr,G)):pr},ce=z,ne=b(k)?Z:z,D=L[t]?ce:ne,N=v.outerEdges[t],V=v.boundingBox,B=t===1||t===3,W=Le(t===1?f[2]:f[0],g[0],g[2]),Y=Le(t===0?f[3]:f[1],g[1],g[3]),H=t===1?1:0,ee=t===0?1:0,me=e.localOrigin,be=NL(a.isWebMercatorOnPlateeCarree,n.ellipsoid.radius,r),De=(f[2]-f[0])/h,ve=k==null?void 0:k.neighborSamplerData,ge=b(k),Ee=(k==null?void 0:k.neighborTile.level)===o,Fe=(ur,Gr)=>V$e(ge,Ee,G,ve,ur,Gr,t),Nr=yz(B,!0,De,Fe),Br=yz(B,!1,De,Fe);for(let ur=1;ur<I-1;++ur){const Gr=ur/p,pr=B?W:Le(f[0]*(1-Gr)+f[2]*Gr,g[0],g[2]),jr=B?Le(f[1]*(1-Gr)+f[3]*Gr,g[1],g[3]):Y,Qi=B?H:Le(A+Gr*E,0,1),fs=B?Le(P+Gr*C,0,1):ee,st=D(pr,jr),Li=pr*r-me[0],ao=be(jr)-me[1],bl=st-me[2];if(t0(Li,ao,bl,V),l){const Na=Nr(pr,jr,st),Qd=Br(pr,jr,st),Jd=De;N.setVertexRawXYZUVN(ur,Li,ao,bl,Qi,fs,Na,Qd,Jd)}else N.setVertexRawXYZUV(ur,Li,ao,bl,Qi,fs)}if(l){const ur=B?0:1,Gr=B?1:0;for(let pr=1;pr<I-1;++pr){N.getNormal(TC,pr);const jr=N.getVertexZ(pr-1)-N.getVertexZ(pr+1),Qi=TC[0]+.5*ur*jr,fs=TC[1]+.5*Gr*jr,st=2*De,Li=1/Math.sqrt(Qi*Qi+fs*fs+st*st);N.setVertexRawNormal(pr,Li*Qi,Li*fs,Li*st)}}}function z$e(e,t){return Math.PI/2-2*Math.atan(Math.exp(-e/t))}function TSt(e,t,r,i){return z$e(e+i*(t-e),r)}function SSt(e,t,r){return e*(1-r)+t*r}function ine(e){const t=e.tile;if(t.surface.isWebMercator){const i=t.extent,s=t.ellipsoid.radius;return n=>TSt(i[1],i[3],s,n)}const r=t.extentInRadians;return i=>SSt(r[1],r[3],i)}function B$e(e){e.tile.surface.shadingEnabled&&j$e(e,(t,r,i,s,n,o,a)=>ESt(r,t,i,s,n,o,a))}function G$e(e,t){e.tile.surface.shadingEnabled&&j$e(e,(r,i,s,n,o,a,l)=>CSt(RSt(e,t),r,s,o,a,l))}function ESt(e,t,r,i,s,n,o){ASt(e,Xc,s,n,o),su(r0,Xc,r),ut(WA,r0,i),ut(t,WA,r0)}function CSt(e,t,r,i,s,n){e(Xc,i,s,n);const o=Xc[0]-r[0],a=Xc[1]-r[1],l=Xc[2]-r[2];t[0]=-o*l,t[1]=-a*l,t[2]=o*o+a*a}function ASt(e,t,r,i,s){const n=ine(e),o=e.tile,a=o.extent;RM(a,r,i,1);const l=(r-a[0])/(a[2]-a[0]),c=(i-a[1])/(a[3]-a[1]),h=o.extentInRadians;D$e(t,h[0]*(1-l)+h[2]*l,n(c),s,o.ellipsoid.radius)}function RSt(e,t){return e.tile.surface.isWebMercatorOnPlateeCarree?(r,i,s,n)=>MSt(t,e.tile.ellipsoid.radius,r,i,s,n):(r,i,s,n)=>OSt(t,r,i,s,n)}function OSt(e,t,r,i,s){t[0]=r*e,t[1]=i*e,t[2]=s}function MSt(e,t,r,i,s,n){r[0]=i*e,r[1]=(Math.PI/2-2*Math.atan(Math.exp(-s/t)))*t,r[2]=n}function j$e(e,t){var o;if(!e.tile.surface.shadingEnabled)return;const r=e.geometryState.neighborData.cornerNeighborData,i=e.tile,s=i.extent,n=((o=e.tile.surface.view)==null?void 0:o.viewingMode)==="local";n&&se(_1,0,0,1);{const a=(v,w,_,T)=>{t(XA,v.renderData,Dm,_1,w,_,T),de(bs,bs,XA)},c=(v,w,_,T,x,E)=>{const C=E===1?x.extent[0]:E===3?x.extent[2]:v,A=E===0?x.extent[1]:E===2?x.extent[3]:w,P=C+QS[_][0]*T,I=A+QS[_][1]*T;RM(x.extent,P,I,1);const L=Si(P,I,x.renderData.geometryState.samplerData);a(x,P,I,L)},h=(v,w,_)=>v.extent[w===0||w===1?2:0]+_,p=(v,w,_)=>v.extent[w===0||w===3?3:1]+_,f=(v,w,_,T)=>{const x=h(_,T,QS[v][0]*w),E=p(_,T,QS[v][1]*w);RM(_.extent,x,E,1);const C=Si(x,E,_.renderData.geometryState.samplerData);a(_,x,E,C)},m=(v,w,_,T,x,E)=>{const C=QS[v][0]*w,A=QS[v][1]*w,P=h(_,T,C),I=p(_,T,A),L=h(x,E,C),k=p(x,E,A);RM(_.extent,P,I,1),RM(x.extent,L,k,1);const G=Si(P,I,_.renderData.geometryState.samplerData),z=Si(L,k,x.renderData.geometryState.samplerData);a(_,P,I,.5*(G+z))},g=v=>{const w=v===0||v===1?s[2]:s[0],_=v===0||v===3?s[3]:s[1],T=r[v].cornerTiles,x=T.reduce((E,C)=>{var A;return Math.min(E,(A=C==null?void 0:C.level)!=null?A:1/0)},1/0);for(let E=0;E<4;++E){const C=T[E];mv[E]=(C==null?void 0:C.level)===x?C:null}for(let E=0;E<4;++E){const C=mv[(E+3)%4],A=mv[E];if(C!=null&&C!==i&&C===A){const P=C,I=(E+2)%4,L=P.renderData.geometryState.neighborData.edgeResolutions[I],k=Math.max(L,2**(i.level-P.level)),G=(P.extent[2]-P.extent[0])/k,z=(E+0)%4,X=(E+1)%4;return c(w,_,(E+3)%4,G,P,E),c(w,_,z,G,P,E),c(w,_,X,G,P,E),bs}}{mv.some(C=>(C==null?void 0:C.isLoaded)||C===i);const E=mv.reduce((C,A)=>A?A.extent[2]-A.extent[0]:C,0)/mv.reduce((C,A)=>{var P;return Math.max(C,(P=A==null?void 0:A.renderData.geometryState.numVerticesPerSide)!=null?P:1)},1);for(let C=0;C<4;++C){const A=mv[(C+3)%4],P=mv[(C+0)%4];if(!A&&!P)continue;const I=C===0?1:C===1?2:C===2?3:0,L=C===0?2:C===1?3:C===2?0:1;A&&P?m(C,E,A,I,P,L):f(C,E,A!=null?A:P,A?I:L)}}return bs};for(let v=0;v<4;++v){const w=e.geometryInfo.outerEdges[v],_=v===1||v===2?0:w.count-1;w.getVertex(Dm,_),n||we(_1,Dm),se(bs,0,0,0);const T=g(v);we(Hj[v],T)}}{const a=(c,h,p,f,m)=>{c.setVertexRawNormal(m,h,p,f)},l=e.geometryInfo.outerEdges;for(let c=0;c<4;++c){const h=l[c];{const p=Hj[c===0?3:c===1?1:2];a(h,p[0],p[1],p[2],0)}{const p=Hj[c===2?1:c===3?3:0];a(h,p[0],p[1],p[2],h.count-1)}}}}function t0(e,t,r,i){e<i[0]?i[0]=e:e>i[3]&&(i[3]=e),t<i[1]?i[1]=t:t>i[4]&&(i[4]=t),r<i[2]?i[2]=r:r>i[5]&&(i[5]=r)}const QS=[[0,1],[1,0],[0,-1],[-1,0]],Bb=new TTt,H$e=Uee(-1/0,-1/0,1/0,1/0),fv=M(),Xc=M(),r0=M(),WA=M(),XA=M(),Dm=M(),jj=M(),_1=M(),bs=M(),TC=M(),Hj=[M(),M(),M(),M()],mv=[null,null,null,null];class PSt extends Kse{constructor(t,r,i){super(),this.horizontalScaleFactor=1,this.extentInRenderSR=Ut(),t!==void 0&&this.init(t,r,i)}init(t,r,i){super.init(t,r,i);const s=i.view.renderSpatialReference,n=i.spatialReference,o=b(s)&&nI(s)&&n.isGeographic?this.ellipsoid.radius*Math.PI/180:1;this.horizontalScaleFactor=o;const a=this.surface.isWebMercatorOnPlateeCarree,l=this.extentInRenderSR,c=this.extent;if(a){const h=Ue(c[0],c[1],0);xn(h,Ze.WebMercator,h,Ze.PlateCarree);const p=Ue(c[2],c[3],0);xn(p,Ze.WebMercator,p,Ze.PlateCarree),l[0]=h[0],l[1]=h[1],l[2]=p[0],l[3]=p[1]}else for(let h=0;h<4;++h)l[h]=c[h]*o;this.centerAtSeaLevel[0]=.5*(l[0]+l[2]),this.centerAtSeaLevel[1]=.5*(l[1]+l[3]),this.centerAtSeaLevel[2]=0,this._edgeLen=Math.max(l[2]-l[0],l[3]-l[1]),this._edgeLen2=this._edgeLen*this._edgeLen,this.updateRadiusAndCenter()}updateRadiusAndCenter(){this._updateCenter();const t=this.extentInRenderSR,r=.5*(t[2]-t[0]),i=.5*(t[3]-t[1]),s=Math.sqrt(r*r+i*i),n=.5*(this.elevationBounds[0]-this.elevationBounds[1]),o=Math.max(s,n);this._center[tl.MIDDLE][3]=o}_isVisible(t){return sut(t,this._aabb())}_aabb(){const t=this.extentInRenderSR;return TBe(t[0],t[1],this.elevationBounds[0],t[2],t[3],this.elevationBounds[1])}intersectsRay(t,r,i,s){return BF[0]=1/r[0],BF[1]=1/r[1],BF[2]=1/r[2],nse(this._aabb(),t,BF,i,s)}createGeometry(){cSt(this.renderData,this.horizontalScaleFactor),this.setMemoryDirty()}getDefaultVerticesPerRowOnLevel(){return this.level<9?3:2}updateCornerElevations(){dSt(this.renderData,this.horizontalScaleFactor)}updateEdgeElevations(){pSt(this.renderData,this.horizontalScaleFactor)}}const BF=M();var x$;(function(e){e[e.BACK_TO_FRONT=-1]="BACK_TO_FRONT",e[e.NONE=0]="NONE",e[e.FRONT_TO_BACK=1]="FRONT_TO_BACK"})(x$||(x$={}));class ISt extends Kse{constructor(t,r,i){super(),this.obb=new Array(8);for(let s=0;s<8;s++)this.obb[s]=M();t!==void 0&&this.init(t,r,i)}init(t,r,i){super.init(t,r,i);const s=this.ellipsoid.radius,n=this.extentInRadians[0],o=this.extentInRadians[1],a=this.extentInRadians[2],l=this.extentInRadians[3],c=t[0],h=Yt(o,l,.5),p=Yt(n,a,.5),f=c===0?0:Math.min(Math.abs(o),Math.abs(l));this._edgeLen=(a-n)*Math.cos(f)*s,this._edgeLen2=this._edgeLen*this._edgeLen,this._curvatureHeight=s-Math.sqrt(s*s-this._edgeLen2/4),JR(this.centerAtSeaLevel,p,h,this.ellipsoid.radius);const m=Bl(this.centerAtSeaLevel);we(m,m),this.up=m,this._updateOBB(),this.updateRadiusAndCenter()}updateRadiusAndCenter(){if(this.lij[0]===0)se(this._center[Lp.MIDDLE],0,0,0),se(this._center[Lp.TOP],0,0,0),se(this._center[Lp.BOTTOM],0,0,0),this.ellipsoid||(this.ellipsoid=Ar(this.surface.spatialReference)),this._center[Lp.MIDDLE][3]=this.ellipsoid.radius+this.elevationBounds[1];else{this._updateCenter();const t=Math.max(Fn(this._center[Lp.MIDDLE],this.obb[0]),Fn(this._center[Lp.MIDDLE],this.obb[1]));this._center[Lp.MIDDLE][3]=Math.sqrt(t)}}_isVisible(t){if(!q_(t,this._center[Lp.MIDDLE]))return!1;if(this.lij[0]<10)return!0;const r=this.obb;for(let i=0;i<w0.NUM;i++){const s=i===ci.NEAR,n=t[i];s&&(HO[0]=n[0],HO[1]=n[1],HO[2]=n[2],HO[3]=n[3]-this.surface.view.state.camera.near);const o=s?HO:n;let a;for(a=0;a<8;a++){const l=r[a];if(o[0]*l[0]+o[1]*l[1]+o[2]*l[2]+o[3]<0)break}if(a===8)return!1}return!0}computeElevationBounds(){super.computeElevationBounds(),this._updateOBB()}createGeometry(){const t=this._getPatchType(this.lij[1],this.lij[0]);lSt(this.renderData,t),this.setMemoryDirty()}_updateOBB(){const t=this.extentInRadians,r=this.obb;for(let i=0;i<2;i++){const s=this.elevationBounds[i];let n=4*i;JR(r[n++],t[0],t[1],this.ellipsoid.radius+s),JR(r[n++],t[0],t[3],this.ellipsoid.radius+s),JR(r[n++],t[2],t[3],this.ellipsoid.radius+s),JR(r[n++],t[2],t[1],this.ellipsoid.radius+s)}if(this.surface.isWebMercator)switch(this._getPatchType(this.lij[1],this.lij[0])){case _d.HAS_NORTH_POLE:se(r[1],0,0,this.ellipsoid.radius),se(r[2],0,0,this.ellipsoid.radius),se(r[5],0,0,this.ellipsoid.radius),se(r[6],0,0,this.ellipsoid.radius);break;case _d.HAS_SOUTH_POLE:se(r[0],0,0,-this.ellipsoid.radius),se(r[3],0,0,-this.ellipsoid.radius),se(r[4],0,0,-this.ellipsoid.radius),se(r[7],0,0,-this.ellipsoid.radius)}}_getPatchType(t,r){return t===(1<<r)-1?t===0?_d.HAS_BOTH_POLES:_d.HAS_SOUTH_POLE:t===0?_d.HAS_NORTH_POLE:_d.REGULAR}intersectsRay(t,r,i,s){const n=this._center[Lp.MIDDLE],o=n[3]+i,a=r[0]*r[0]+r[1]*r[1]+r[2]*r[2],l=n[0]-t[0],c=n[1]-t[1],h=n[2]-t[2],p=(l*r[0]+c*r[1]+h*r[2])/a,f=r[0]*p-l,m=r[1]*p-c,g=r[2]*p-h;return f*f+m*m+g*g<o*o}getDefaultVerticesPerRowOnLevel(){return this.level<Cge.length?Cge[this.level]+1:2}updateCornerElevations(){uSt(this.renderData)}updateEdgeElevations(){hSt(this.renderData)}}const Cge=[128,64,32,16,16,8,8,4],HO=Er();var Lp;(function(e){e[e.TOP=0]="TOP",e[e.MIDDLE=1]="MIDDLE",e[e.BOTTOM=2]="BOTTOM"})(Lp||(Lp={}));class $St{constructor(){this.extent=Zt(),this.minLevel=0,this.maxLevel=0,this.callback=null}}class LSt{constructor(){this._queries=new Xt({initialSize:10}),this._queriesInvPtr=0,this._queryQueue=new Xt({initialSize:30}),this._queryPool=new Ls($St)}queryVisibleLevelRange(t,r,i,s){const n=this._queryPool.acquire();ef(n.extent,t),n.minLevel=r||-Number.MAX_VALUE,n.maxLevel=i!=null?i:Number.MAX_VALUE,n.callback=s,this._queryQueue.push(n)}hasPendingQueries(){return this._queryQueue.length!==0}prepareQueries(){for(;this._queries.length<this._queries.data.length&&this._queryQueue.length>0;){const t=this._queryQueue.pop();this._queries.push(t)}this._queriesInvPtr=this._queries.length}processQueries(){for(let t=0;t<this._queries.length;t++){const r=this._queries.data[t];this._queryPool.release(r),r.callback(t>=this._queriesInvPtr),r.callback=null}this._queries.clear()}scaleQueriesForTile(t){const r=t.level;let i=0;for(;i<this._queriesInvPtr;){const s=this._queries.data[i],n=s.extent;r>=s.minLevel&&r<=s.maxLevel&&n[0]<=t.extent[2]&&n[2]>=t.extent[0]&&n[1]<=t.extent[3]&&n[3]>=t.extent[1]?(this._queries.swapElements(i,this._queriesInvPtr-1),this._queriesInvPtr--):i++}}}class sne extends vl{constructor(){super(...arguments),this.blendMode=Ne.Normal}}u([q({count:Ne.COUNT})],sne.prototype,"blendMode",void 0);class DSt extends O$e{constructor(){super(...arguments),this.opacity=1,this.baseOpacity=1,this.texture=null,this.fboTexture=null,this.blendMode=Ne.Normal,this.backgroundColor=dl}}class x8 extends gi{initializeProgram(t){const r=x8.shader.get().build(this.configuration);return new oi(t.rctx,r,zr)}initializePipeline(){return Gt({blending:bg(Ae.ONE,Ae.ONE_MINUS_SRC_ALPHA),colorWrite:or})}}x8.shader=new ni(FTt,()=>ie(()=>import("./BlendLayers.glsl.41df4594.js"),[],import.meta.url));class yk extends sne{constructor(){super(...arguments),this.output=Mo.Composite,this.baseOpacityMode=Dn.One,this.premultipliedSource=!1}}u([q({count:Mo.COUNT})],yk.prototype,"output",void 0),u([q({count:Dn.COUNT})],yk.prototype,"baseOpacityMode",void 0),u([q()],yk.prototype,"premultipliedSource",void 0);class qj{constructor(t,r,i,s,n,o){this.texture=t,this.type=r,t.retain(),this.offsetAndScale=xr(i.offset[0],i.offset[1],i.scale,i.scale),this.opacities=Ue(s,o,n)}destroy(){this.texture.release()}}function vk(){return[1,0,0,1,0,0]}function NSt(e){return[e[0],e[1],e[2],e[3],e[4],e[5]]}function FSt(e,t,r,i,s,n){return[e,t,r,i,s,n]}function kSt(e,t){return new Float64Array(e,t,6)}Object.freeze(Object.defineProperty({__proto__:null,create:vk,clone:NSt,fromValues:FSt,createView:kSt},Symbol.toStringTag,{value:"Module"}));function USt(e){return e instanceof Float32Array&&e.length>=2}function VSt(e){return Array.isArray(e)&&e.length>=2}function Wj(e){return USt(e)||VSt(e)}const zSt=96,BSt=39.37;function nne(e,t){return t.type?vr(e,t.x,t.y):Do(e,t)}function GSt(e){return uu(e)}function jSt(e,t){const r=e.targetGeometry,i=t.targetGeometry;return r.x=i.x,r.y=i.y,r.spatialReference=i.spatialReference,e.scale=t.scale,e.rotation=t.rotation,e}const HSt=function(){const e=rt();return function(t,r,i){const s=r.targetGeometry;nne(e,s);const n=.5*T8(r);return t.xmin=e[0]-n*i[0],t.ymin=e[1]-n*i[1],t.xmax=e[0]+n*i[0],t.ymax=e[1]+n*i[1],t.spatialReference=s.spatialReference,t}}();function T8(e){return e.scale*qSt(e.targetGeometry)}function qSt(e){return b(e)&&nc(e.spatialReference)?1/(GSt(e.spatialReference)*BSt*zSt):1}function WSt(e){return Qz(e.rotation)||0}const one=function(){const e=rt(),t=rt(),r=rt();return function(i,s,n,o,a,l){return sie(e,s),Bc(t,n,.5*l),vr(r,1/o*l,-1/o*l),Xre(i,t),a&&oB(i,i,a),Wre(i,i,r),aB(i,i,e),i}}(),XSt=function(){const e=rt();return function(t,r,i,s){const n=T8(r),o=WSt(r);return nne(e,r.targetGeometry),one(t,e,i,n,o,s)}}(),ZSt=function(){const e=rt();return function(t,r,i,s){const n=T8(r);return nne(e,r.targetGeometry),one(t,e,i,n,0,s)}}();function YSt(e){const t=a1(e);return t?t.valid[1]-t.valid[0]:0}function QSt(e,t){return Math.round(YSt(e)/t)}var tJ;const Vg=[0,0];let t_=tJ=class extends ye{constructor(e){super(e),this._viewpoint2D={center:rt(),rotation:0,scale:0,spatialReference:null},this.center=[0,0],this.extent=new Kt,this.id=0,this.inverseTransform=vk(),this.resolution=0,this.rotation=0,this.scale=0,this.transform=vk(),this.transformNoRotation=vk(),this.displayMat3=Ky(),this.displayViewMat3=Ky(),this.viewMat3=Ky(),this.viewMat2d=_V(),this.worldScreenWidth=0,this.size=[0,0]}set pixelRatio(e){this._set("pixelRatio",e),this._update()}set size(e){this._set("size",e),this._update()}set viewpoint(e){if(e){const t=this._viewpoint2D,r=e.targetGeometry;t.center[0]=r.x,t.center[1]=r.y,t.rotation=e.rotation,t.scale=e.scale,t.spatialReference=r.spatialReference}this._update()}copy(e){const t=this.size,r=this.viewpoint;return r&&t?(this.viewpoint=jSt(r,e.viewpoint),this._set("size",Do(t,e.size))):(this.viewpoint=e.viewpoint.clone(),this._set("size",[e.size[0],e.size[1]])),this._set("pixelRatio",e.pixelRatio),this}clone(){return new tJ({size:this.size,viewpoint:this.viewpoint.clone(),pixelRatio:this.pixelRatio})}toMap(e,t,r){return Wj(t)?Aw(e,t,this.inverseTransform):(Vg[0]=t,Vg[1]=r,Aw(e,Vg,this.inverseTransform))}toScreen(e,t,r){return Wj(t)?Aw(e,t,this.transform):(Vg[0]=t,Vg[1]=r,Aw(e,Vg,this.transform))}toScreenNoRotation(e,t,r){return Wj(t)?Aw(e,t,this.transformNoRotation):(Vg[0]=t,Vg[1]=r,Aw(e,Vg,this.transformNoRotation))}getScreenTransform(e,t){const{center:r}=this._viewpoint2D,i=this._get("pixelRatio")||1,s=this._get("size");return one(e,r,s,t,0,i),e}_update(){const{center:e,spatialReference:t,scale:r,rotation:i}=this._viewpoint2D,s=this._get("pixelRatio")||1,n=this._get("size"),o=new Vd({targetGeometry:new at(e[0],e[1],t),scale:r,rotation:i});if(this._set("viewpoint",o),!n||!t||!r)return;this.resolution=T8(o),this.rotation=i,this.scale=r,this.spatialReference=t,Do(this.center,e);const a=n[0]!==0?2/n[0]:0,l=n[1]!==0?-2/n[1]:0;_ie(this.displayMat3,a,0,0,0,l,0,-1,1,1);const c=bie(this.viewMat3),h=ll(n[0]/2,n[1]/2),p=ll(-n[0]/2,-n[1]/2),f=Qz(i);AV(c,c,h),wie(c,c,f),AV(c,c,p),mB(this.displayViewMat3,this.displayMat3,c);const m=Xre(this.viewMat2d,h);return oB(m,m,f),aB(m,m,p),HSt(this.extent,o,n),XSt(this.transform,o,n,s),eRe(this.inverseTransform,this.transform),ZSt(this.transformNoRotation,o,n,s),this.worldScreenWidth=QSt(this.spatialReference,this.resolution),this._set("id",this.id+1),this}};u([d({readOnly:!0})],t_.prototype,"id",void 0),u([d({value:1,json:{write:!0}})],t_.prototype,"pixelRatio",null),u([d({json:{write:!0}})],t_.prototype,"size",null),u([d()],t_.prototype,"spatialReference",void 0),u([d({type:Vd,json:{write:!0}})],t_.prototype,"viewpoint",null),t_=tJ=u([$("esri.views.2d.ViewState")],t_);const JSt=t_,KSt=.125;class e2t{constructor(){this._renderParams={context:null,drawPhase:1,state:new JSt({viewpoint:new Vd({targetGeometry:new at(0,0),scale:1,rotation:0}),size:[256,256]}),stationary:!0,pixelRatio:1,displayLevel:-1,requiredLevel:-1,globalOpacity:1,renderPass:"background",styleLayer:null,styleLayerUID:-1,painter:null,glyphMosaic:null,spriteMosaic:null,profiler:null,renderingOptions:null,requestRender:null,deltaTime:-1,timeline:null,time:0,hasClipping:!1,blendMode:null,dataUploadCounter:0,effects:null,inFadeTransition:!1,requireFBO:!1}}dispose(){this._renderParams=null}render(t,r,i,s,n,o,a,l,c,h){const p=o.adjustLevel(r[0]),f=this._renderParams;f.context=t,f.painter=s,f.glyphMosaic=s.glyphMosaic,f.spriteMosaic=s.spriteMosaic,f.pixelRatio=h,f.displayLevel=p,f.requiredLevel=p;const m=o.getScale(r[0]),[g,v]=o.getShift(r,a*m),w=KSt*a*m/c,_=i.transforms.dvs;_[0]=w,_[4]=-w,_[6]=-1-g-l[0]*a*2,_[7]=1+v+(1-l[1])*a*2-2,f.state.size[0]=c,f.state.size[1]=c,i.stage||i.attachWithContext(t),i.triangleCount=0,s.drawTile(f,i,n)}}class S8 extends gi{initializeProgram(t){const r=S8.shader.get().build(this.configuration);return new oi(t.rctx,r,zr)}initializePipeline(){return Gt({blending:bg(Ae.ONE,Ae.ONE_MINUS_SRC_ALPHA),colorWrite:or})}}S8.shader=new ni(jTt,()=>ie(()=>import("./RasterColorizer.glsl.30c4956f.js"),[],import.meta.url));class tE extends sne{constructor(){super(...arguments),this.colorizerType=Zx.Stretch,this.stretchType=kT.Noop,this.tileBlendInput=na.LayerOnly,this.baseOpacityMode=Dn.One,this.applyColormap=!0}}u([q({count:Zx.COUNT})],tE.prototype,"colorizerType",void 0),u([q({count:kT.COUNT})],tE.prototype,"stretchType",void 0),u([q({count:na.COUNT})],tE.prototype,"tileBlendInput",void 0),u([q({count:Dn.COUNT})],tE.prototype,"baseOpacityMode",void 0),u([q()],tE.prototype,"applyColormap",void 0);class Age{constructor(t){this._rctx=t,this._pools=new Map}acquire(t){return this._getPool(t).acquire()}clear(){this._pools.forEach(t=>t.destroy()),this._pools.clear()}_getPool(t){let r=this._pools.get(t);if(!r){const i=Rge.bind(Rge,this._rctx,{colorTarget:us.TEXTURE,depthStencilTarget:Pr.DEPTH_RENDER_BUFFER,width:t,height:t},s=>this._getPool(s.width).release(s));r=new Ls(i,null,()=>{}),this._pools.set(t,r)}return r}}class Rge extends Pi{constructor(t,r,i){super(t,r),this.release=()=>i(this)}}const t2t=fe.getLogger("esri.views.3d.terrain");class r2t{constructor(t,r){this._rctx=t,this._techniqueRepository=r,this._fboPools=[],this._doubleBufferFbo=[],this._vectorTileHelper=new e2t,this._bindParameters=new vB(null,null,null),this._blendLayersTechniqueConfig=new yk,this._poolToWrite=0,this._vaoQuad=_l(this._rctx,mL),this._fboPools.push(new Age(this._rctx)),this._fboPools.push(new Age(this._rctx))}dispose(){this._fboPools.forEach(t=>{t.clear(),t=null}),this._fboPools=null,this._doubleBufferFbo.forEach(t=>Ye(t)),this._vaoQuad=Ye(this._vaoQuad),this._vectorTileHelper=Ye(this._vectorTileHelper),this._backgroundTechnique=ti(this._backgroundTechnique),this._applyOpacityTechnique=ti(this._applyOpacityTechnique),this._blendLayersTechnique=ti(this._blendLayersTechnique)}_getBlendLayersTechnique(t,r,i,s=!1){return this._blendLayersTechniqueConfig.output=r,this._blendLayersTechniqueConfig.blendMode=t,this._blendLayersTechniqueConfig.baseOpacityMode=i?r===Mo.Composite?Dn.OnBaseLayer:Dn.OnBackground:Dn.One,this._blendLayersTechniqueConfig.premultipliedSource=s,this._blendLayersTechnique=this._techniqueRepository.releaseAndAcquire(x8,this._blendLayersTechniqueConfig,this._blendLayersTechnique),this._blendLayersTechnique}drawBackground(t,r){const i=this._getBlendLayersTechnique(Ne.Normal,r,!1),s=this._rctx.bindTechnique(i,t,this._bindParameters);this._render(s)}_render(t){this._rctx.bindVAO(this._vaoQuad),t.assertCompatibleVertexAttributeLocations(this._vaoQuad),this._rctx.drawArrays(Lt.TRIANGLE_STRIP,0,ta(this._vaoQuad,"geometry"))}drawRasterData(t,r,i=!1){if(R(r.texture))return;const s=r.baseOpacity<1;r.blendMode!==Ne.Normal||s||i?(r.fboTexture=this._currentFBO.colorTexture,this._switchPool(this._currentFBO.width)):r.fboTexture=null;const n=this._getBlendLayersTechnique(r.blendMode,t,s,i),o=this._rctx.bindTechnique(n,r,this._bindParameters);this._render(o)}drawImageryTileData(t,r,i){const s=t.sourceLayerInfo.data;if(!s.source)return;t.tile.surface.layerViewByIndex(t.layerIndex,Qt.MAP).ensureSymbolizerParameters(s);const n=i.baseOpacity<1;i.blendMode!==Ne.Normal||n?(i.fboTexture=this._currentFBO.colorTexture,this._switchPool(this._currentFBO.width)):i.fboTexture=null;const o=this._getRasterColorizerTechnique(s,r,i.blendMode,n),a=this._rctx.bindTechnique(o);if(!s.bind(this._rctx))return;s.opacity=i.opacity;const l=s.getUniforms();l.scale=t.scale,l.offset=t.offset,l.backgroundColor=i.backgroundColor,l.fboTexture=i.fboTexture,l.baseOpacity=i.baseOpacity,o.bindPass(l,null),this._render(a)}_getRasterColorizerTechnique(t,r,i,s){const n=t.symbolizerParameters,o=["stretch","lut","hillshade"].indexOf(n.type);return R(this._rasterColorizerConfig)&&(this._rasterColorizerConfig=new tE,this._rctx.gl.getExtension("WEBGL_color_buffer_float"),this._rctx.gl.getExtension("OES_texture_float")),this._rasterColorizerConfig.tileBlendInput=r===Mo.ColorComposite?na.ColorComposite:r===Mo.GridComposite?na.GridComposite:na.LayerOnly,this._rasterColorizerConfig.blendMode=i,this._rasterColorizerConfig.baseOpacityMode=s?r===Mo.Composite?Dn.OnBaseLayer:Dn.OnBackground:Dn.One,this._rasterColorizerConfig.colorizerType=o,this._rasterColorizerConfig.applyColormap=!!n.colormap,this._rasterColorizerConfig.stretchType=t.hasStretchTypeNone()?kT.Noop:kT.PerBand,this._rasterColorizerTechnique=this._techniqueRepository.releaseAndAcquire(S8,this._rasterColorizerConfig,this._rasterColorizerTechnique),this._rasterColorizerTechnique}drawVectorData(t,r,i,s,n,o,a){const l=this._rctx,c=r.sourceLayerInfo.data,h=r.tile.surface.layerViewByIndex(r.layerIndex,Qt.MAP),p=t.baseOpacity<1||t.opacity<1||t.blendMode!==Ne.Normal||a!==Mo.Composite;let f;this._getBlendLayersTechnique(t.blendMode,a,t.baseOpacity<1,p).bindPipelineState(l),p?(f=this._acquire(n),l.bindFramebuffer(f),l.setClearColor(0,0,0,0),l.clearSafe(ri.COLOR_BUFFER_BIT|ri.DEPTH_BUFFER_BIT)):o&&l.clearSafe(ri.DEPTH_BUFFER_BIT);try{this._vectorTileHelper.render(l,r.sourceLod,c,h.painter,h.layer.styleRepository,h.schemaHelper,Math.round(1/r.scale),r.offset,s,i)}catch(m){t2t.warnOnce("A render call containing vector tiles did not resolve correctly.",m)}return!b(f)||(l.bindFramebuffer(this._currentFBO),t.texture=f.colorTexture,t.offset=zd,t.scale=1,this.drawRasterData(a,t,p),f.release(),o)}copyFBOToTexture(t){const r=this._rctx,i=r.bindTexture(t.texture,nt.TEXTURE_UNIT_FOR_UPDATES),s=t.descriptor;r.gl.copyTexImage2D(mt.TEXTURE_2D,0,s.pixelFormat,0,0,s.width,s.height,0),t.generateMipmap(),r.bindTexture(i,nt.TEXTURE_UNIT_FOR_UPDATES)}_initFBO(t,r){this._rctx.bindFramebuffer(t),this._rctx.setViewport(0,0,r,r),this._rctx.setClearColor(0,0,0,0),this._rctx.setClearDepth(1),this._rctx.clearSafe(ri.COLOR_BUFFER_BIT|ri.DEPTH_BUFFER_BIT)}_acquire(t){return this._fboPools[this._poolToWrite].acquire(t)}bindPool(t,r){this._poolToWrite=t,this._doubleBufferFbo[t]==null&&(this._doubleBufferFbo[t]=this._acquire(r),this._initFBO(this._doubleBufferFbo[t],r))}_switchPool(t){this._releaseCurrentFBO(),this._doubleBufferFbo[this._poolToWrite]=null,this._poolToWrite=this._poolToWrite===0?1:0,this.bindPool(this._poolToWrite,t)}get _currentFBO(){return this._doubleBufferFbo[this._poolToWrite]}_releaseCurrentFBO(){this._doubleBufferFbo[this._poolToWrite].release(),this._doubleBufferFbo[this._poolToWrite]=null}releasePool(){this._rctx.bindFramebuffer(null),this._releaseCurrentFBO()}cleanupFBOPool(t,r){t===this._lastPixelRatio&&r===this._lastNumLayers||(this._fboPools.forEach(i=>i.clear()),this._lastPixelRatio=t,this._lastNumLayers=r)}}class i2t{constructor(t,r,i){this._rctx=t,this.tileSize=r,this._techniqueRepository=i,this._passParameters=new DSt,this._backgroundTexture=null,this._backgroundColor=null,this._backgroundDirty=!1,this._blackTex=null,this._numTexturedLayer=0,this._maxAnisotropy=this._rctx.parameters.maxMaxAnisotropy,this._composition=new r2t(this._rctx,this._techniqueRepository),this._blackTex=new eE(Lnt(this._rctx,[0,0,0,1])),this._ensureBackgroundTexture(this.tileSize)}dispose(){this._composition=Ye(this._composition),this._backgroundTexture=ti(this._backgroundTexture),this._blackTex=ti(this._blackTex)}get backgroundIsGrid(){return R(this._backgroundColor)}get backgroundColor(){return this._backgroundColor}updateTileTexture(t,r){if(!t.renderData)return;const i=t.surface,s=i.baseOpacity;this._numTexturedLayer=0;let n=0,o=this.tileSize,a=!1;const l=i.view.state.pixelRatio;let c=!1;const h=t.layerInfo[Qt.MAP];let p=h.length,f=0;for(;f<h.length;f++){const v=i.layerViewByIndex(f,Qt.MAP),w=v.fullOpacity;if(Zj[f]=w,Mbe(v.layer)&&p>=h.length&&(p=f),w===0){h[f].pendingUpdates&=~(wt.TEXTURE_NOFADING&wt.TEXTURE_FADING);continue}++n;const _=Xj(t,f);if(_){if(h[f].pendingUpdates&=~(wt.TEXTURE_NOFADING&wt.TEXTURE_FADING),fz(v)){const T=f$e(v.layer.parent)?"normal":v.layer.blendMode;Oge[f]=T;const x=T!=="normal";x&&(c=x,a=!1)}v$(v)?o=Math.max(o,this.tileSize*l):s===1&&w===1&&(v.isOpaque||this._dataToTexture(_)&&_.sourceLayerInfo.data.descriptor.isOpaque)&&(a=!0),++this._numTexturedLayer}}this._composition.cleanupFBOPool(l,h.length),o=s2t(o);const m=o/this.tileSize,g=f-1;this._ensureBackgroundTexture(this.tileSize),this._numTexturedLayer!==0?this._numTexturedLayer===1&&!c&&this._useLayerTexture(t,g,p,Zj[g])||this._composeMapLayers(t,r,g,p,Zj,Oge,o,m,!a||c):this._useBackgroundTexture(t,n)}_ensureBackgroundTexture(t){R(this._backgroundTexture)&&(this._backgroundTexture=this._buildTexture(t),this._backgroundDirty=!0),this._backgroundDirty&&(this._composition.bindPool(0,t),this._passParameters.offset=zd,this._passParameters.scale=1,this._passParameters.opacity=1,this._passParameters.blendMode=Ne.Normal,b(this.backgroundColor)&&(this._passParameters.backgroundColor=this.backgroundColor),this._composition.drawBackground(this._passParameters,b(this.backgroundColor)?Mo.ColorOnly:Mo.GridOnly),this._composition.copyFBOToTexture(this._backgroundTexture),this._composition.releasePool(),this._backgroundDirty=!1)}_useBackgroundTexture(t,r){let i=e0.Immediate;(t.surface.view.layerViewManager.updating||r>0)&&(i=e0.Delayed),this._backgroundTexture&&R(t.renderData.textureReference)&&(i=e0.Immediate),t.renderData.setTextureReference(b(this._backgroundTexture)?new qj(this._backgroundTexture,ro.FADING,Mge,t.surface.baseOpacity,1,0):null,i)}_useLayerTexture(t,r,i,s){const n=r<i,o=n?1:t.surface.baseOpacity,a=n?t.surface.baseOpacity:1,l=Xj(t,r);return!!this._dataToTexture(l)&&(t.renderData.setTextureReference(new qj(l.sourceLayerInfo.data,ro.FADING,l,o,s,a)),!0)}_composeMapLayers(t,r,i,s,n,o,a,l,c){this._composition.bindPool(0,a);const h=t.surface.baseOpacity;let p=!1,f=et.LINEAR_MIPMAP_LINEAR,m=!1,g=0;for(let w=i;w>=0;w--){const _=Xj(t,w);if(!_||n[w]===0)continue;const T=w<s&&h<1&&!p;this._passParameters.baseOpacity=T?h:1,T&&(p=!0);const x=g===0,E=c&&x?this.backgroundIsGrid?Mo.GridComposite:Mo.ColorComposite:Mo.Composite;Cxt(_)?(this._passParameters.opacity=n[w],this._passParameters.blendMode=fk[o[w]],m=this._composition.drawVectorData(this._passParameters,_,l,this.tileSize,a,m,E)):Ext(_)?(this._passParameters.opacity=n[w],this._passParameters.blendMode=fk[o[w]],this._composition.drawImageryTileData(_,E,this._passParameters),this._hasNearestInterpolation(_)&&(f=et.NEAREST)):this._dataToTexture(_)&&(this._passParameters.texture=_.sourceLayerInfo.data.texture,this._passParameters.offset=_.offset,this._passParameters.scale=_.scale,this._passParameters.opacity=n[w],this._passParameters.blendMode=fk[o[w]],this._composition.drawRasterData(E,this._passParameters)),g++}const v=t.renderData.ensureTexture(a,()=>this._buildTexture(a,f));this._composition.copyFBOToTexture(v),this._composition.releasePool(),t.renderData.setTextureReference(new qj(v,r,Mge,p?1:h,1,0))}_hasNearestInterpolation(t){const r=t.sourceLayerInfo.data;return!!r.source&&r.interpolation==="nearest"}_dataToTexture(t){return Rxt(t)&&this._rasterDataToTexture(t),Axt(t)}_rasterDataToTexture(t){const r=t.sourceLayerInfo;r.data=this._buildTexture(r.data),t.tile.setMemoryDirty()}setBackground(t){this._backgroundColor!==t&&(this._backgroundColor=t,this._backgroundDirty=!0)}_buildTexture(t,r=et.LINEAR_MIPMAP_LINEAR){if(R(t))return null;const i={target:mt.TEXTURE_2D,pixelFormat:ze.RGBA,dataType:Ct.UNSIGNED_BYTE,wrapMode:xt.CLAMP_TO_EDGE,samplingMode:r,maxAnisotropy:this._maxAnisotropy,flipped:!0,hasMipmap:!0},s=this._rctx;let n;if(typeof t=="number")i.width=i.height=t,n=new eE(new nt(s,i));else if(t instanceof y8)i.isOpaque=t.isOpaque,n=new eE(new nt(s,i,t.image)),t.release();else try{n=new eE(new nt(s,i,t))}catch{n=new eE(sOe(s)),console.warn("TileRenderer: failed to execute 'texImage2D', cross-origin image may not be loaded.")}const o=s.bindTexture(n.texture,nt.TEXTURE_UNIT_FOR_UPDATES);return n.generateMipmap(),s.bindTexture(o,nt.TEXTURE_UNIT_FOR_UPDATES),n}get test(){return{backgroundTexture:this._backgroundTexture}}}function s2t(e){const t=qC(e),r=t*t,i=e*e;if(r===i)return e;const s=t/2;return r-i<i-s*s?t:s}function Xj(e,t){bu.layerIndex=t;const r=e.layerInfo[Qt.MAP][t];if(b(r.data))return vr(bu.offset,0,0),bu.tile=e,bu.scale=1,bu.sourceLod=e.lij,bu.sourceLayerInfo=r,bu;const i=r.upsampleInfo;if(b(i)){const s=i.tile.layerInfo[Qt.MAP][t];return bu.tile=i.tile,Do(bu.offset,i.offset),bu.scale=i.scale,bu.sourceLod=i.tile.lij,bu.sourceLayerInfo=s,bu}return null}const Zj=new Array,Oge=new Array,bu={tile:null,sourceLayerInfo:null,sourceLod:null,offset:[0,0],scale:1,layerIndex:0},Mge={offset:[0,0],scale:1},q$e=200,Yj=40,n2t=.8,o2t=10,_3=1e-6;function a2t(e,t,r){const i=t,s=r;let n=0,o=1/0;for(let a=0;a<3;++a){{const l=e[a];if(i[a]<l){if(s[a]<=_3)return!1;const c=(l-i[a])/s[a];n=Math.max(n,c)}else if(s[a]<=-_3){const c=(l-i[a])/s[a];o=Math.min(o,c)}if(n>o)return!1}{const l=e[a+3];if(i[a]>l){if(s[a]>=-_3)return!1;const c=(l-i[a])/s[a];n=Math.max(n,c)}else if(s[a]>=_3){const c=(l-i[a])/s[a];o=Math.min(o,c)}if(n>o)return!1}}return!0}class Pge{constructor(t,r,i,s,n){this.aabb=t,this.axis=r,this.d=i,this.midStartIndex=s,this.rightStartIndex=n}}class ZA{constructor(t,r,i,s){this.globalTriangleVertexIndices=t,this.firstTriangleIndex=r,this.positionAttribute=s,this.rayDirection=M(),this.bspNodeTree=new Array,this.vertexPositionBuffer=s.data,this.vertexPositionStride=s.stride;const n=i-r,o=n<=W$e?new Uint16Array(n):new Uint32Array(n);this.indices=o;for(let a=0;a<n;++a)o[a]=a;{const a=d2t(t,r,i,s.data,s.stride),l=Le(Math.log2(n/Yj),2,o2t),c=(h,p,f)=>{const m=u2t(o,a,h,p),g=p-h;if(g<=Yj){const E=new Pge(m,void 0,0,h,p);return this.bspNodeTree.push(E),E}const{axis:v,midValue:w}=h2t(m),_=c2t(o,a,h,p,v,w),T=(E,C)=>{if(f>l)return;const A=C-E;return A<Yj||A>=n2t*g?void 0:c(E,C,f+1)},x=new Pge(m,v,w,_.next,_.mid);return this.bspNodeTree.push(x),x.leftNode=T(h,_.next),x.rightNode=T(_.mid,p),x};c(0,n,0),this.triangleVertexIndices=p2t(o,t,r,i)}}intersectRayTriangleRange(t,r){{if(t>=r)return;const i=this.triangleVertexIndices,s=this.positionAttribute.data,n=this.positionAttribute.stride,o=this.rayOrigin,a=o[0],l=o[1],c=o[2],h=this.rayDirection,p=h[0],f=h[1],m=h[2];for(let g=t,v=3*t;g<r;++g){const w=i[v]*n,_=s[w],T=s[w+1],x=s[w+2],E=i[v+1]*n,C=s[E],A=s[E+1],P=s[E+2],I=i[v+2]*n,L=s[I],k=s[I+1],G=s[I+2];v+=3;const z=C-_,X=A-T,Z=P-x,ce=L-_,ne=k-T,D=G-x,N=f*D-ne*m,V=m*ce-D*p,B=p*ne-ce*f,W=z*N+X*V+Z*B;if(Math.abs(W)<=Number.EPSILON)continue;const Y=a-_,H=l-T,ee=c-x,me=Y*N+H*V+ee*B;if(W>0){if(me<0||me>W)continue}else if(me>0||me<W)continue;const be=H*Z-X*ee,De=ee*z-Z*Y,ve=Y*X-z*H,ge=p*be+f*De+m*ve;if(W>0){if(ge<0||me+ge>W)continue}else if(ge>0||me+ge<W)continue;const Ee=(ce*be+ne*De+D*ve)/W;if(Ee>=0){const Fe=this.indices[g]+this.firstTriangleIndex,Nr=ise(z,X,Z,ce,ne,D,l2t);this.callback(Ee,Nr,Fe,!1)}}}ZA.numFacesTested+=r-t}intersectRay(t,r){ZA.numFacesTested=0;const i=Ue(t.r0[0],t.r0[1],t.r0[2]),s=Ue(t.r1[0],t.r1[1],t.r1[2]),n=s[0]-i[0],o=s[1]-i[1],a=s[2]-i[2];if(n*n+o*o+a*a<_3)return;this.rayOrigin=i;const l=this.rayDirection;l[0]=n,l[1]=o,l[2]=a;const c=this.triangleVertexIndices.length/3;this.callback=r;const h=this.bspNodeTree[0];this.intersectRayBSP(h,0,c)}intersectRayBSP(t,r,i){const s=this.rayOrigin,n=this.rayDirection;if(!a2t(t.aabb,s,n))return;const o=t.axis,a=t.d;if(s[o]<a||n[o]<0){const l=r,c=t.midStartIndex;if(l<c){const h=t.leftNode;h!==void 0?this.intersectRayBSP(h,l,c):this.intersectRayTriangleRange(l,c)}}if(this.intersectRayTriangleRange(t.midStartIndex,t.rightStartIndex),s[o]>a||n[o]>0){const l=t.rightStartIndex,c=i;if(l<c){const h=t.rightNode;h!==void 0?this.intersectRayBSP(h,l,c):this.intersectRayTriangleRange(l,c)}}}get estimatedMemoryUsage(){return this.triangleVertexIndices.byteLength+this.indices.byteLength}}ZA.numFacesTested=0;const l2t=M(),JS=[1/0,1/0,1/0],KS=[-1/0,-1/0,-1/0];function c2t(e,t,r,i,s,n){let o=r,a=i;for(;o<a;){const c=e[o];t[6*c+s+3]<=n?++o:(--a,e[o]=e[a],e[a]=c)}let l=o;for(a=i;l<a;){const c=e[a-1];t[6*c+s]>=n?--a:(e[a-1]=e[l],e[l]=c,++l)}return{next:o,mid:l}}function u2t(e,t,r,i){if(i<=r)return uT(NaN,NaN,NaN,NaN,NaN,NaN);{const s=6*e[r];for(let n=0;n<3;++n)JS[n]=t[s+0+n],KS[n]=t[s+3+n]}for(let s=r+1;s<i;++s){const n=6*e[s];for(let o=0;o<3;++o)JS[o]=Math.min(JS[o],t[n+0+o]),KS[o]=Math.max(KS[o],t[n+3+o])}return uT(JS[0],JS[1],JS[2],KS[0],KS[1],KS[2])}function h2t(e){const t=e[3]-e[0],r=e[4]-e[1],i=e[5]-e[2],s=t>r?t>i?0:r>i?1:2:r>i?1:i>t?2:0;return{axis:s,midValue:(e[s]+e[s+3])/2}}function d2t(e,t,r,i,s){const n=r-t,o=new Float32Array(6*n);for(let a=0;a<n;++a){const l=3*(a+t),c=e[l+0]*s,h=e[l+1]*s,p=e[l+2]*s;for(let f=0;f<3;++f){const m=i[c+f],g=i[h+f],v=i[p+f];o[6*a+f]=Math.min(m,g,v),o[6*a+3+f]=Math.max(m,g,v)}}return o}function p2t(e,t,r,i){const s=i-r;let n=0;for(let a=r;a<i;++a)for(let l=0;l<3;++l)n=Math.max(t[3*a+l],n);const o=n<=W$e?new Uint16Array(3*s):new Uint32Array(3*s);for(let a=0;a<s;++a){const l=3*(e[a]+r);for(let c=0;c<3;++c){const h=t[l+c];o[3*a+c]=h}}return o}const W$e=65535;class ane extends $Pe{constructor(){super(...arguments),this.slicePlaneLocalOrigin=M(),this.origin=this.slicePlaneLocalOrigin}}var th,To;(function(e){e[e.Material=0]="Material",e[e.ShadowMap=1]="ShadowMap",e[e.Highlight=2]="Highlight"})(th||(th={})),function(e){e[e.Color=0]="Color",e[e.Alpha=1]="Alpha",e[e.Depth=2]="Depth",e[e.Normal=3]="Normal"}(To||(To={}));class f2t extends ane{constructor(){super(...arguments),this.identifier=th.Material,this.transparent=!1,this.integratedMesh=!1}}class m2t extends ane{constructor(){super(...arguments),this.identifier=th.ShadowMap}}class g2t extends ane{constructor(){super(...arguments),this.identifier=th.Highlight}}class vz extends ss{constructor(t,r){super(t,"vec4",Vr.Draw,(i,s,n)=>i.setUniform4fv(t,r(s,n)))}}var i0;(function(e){e[e.Disabled=0]="Disabled",e[e.Enabled=1]="Enabled",e[e.EnabledWithWater=2]="EnabledWithWater",e[e.COUNT=3]="COUNT"})(i0||(i0={}));class y2t extends nn{constructor(){super(...arguments),this.overlayOpacity=1}}function Ige(e,t){e.vertex.uniforms.add([new hl("overlayTexOffset"),new hl("overlayTexScale")]),e.fragment.uniforms.add([new qe("overlayOpacity",r=>r.overlayOpacity),new Ht("ovColorTex",(r,i)=>i.overlays.length===0?null:i.overlays[Gi.INNER].getColorTexture(r.overlaySource))]),X$e(e,t)}function v2t(e,t){const{vertex:r,fragment:i}=e;r.uniforms.add([new vz("overlayTexOffset",(s,n)=>_2t(s,n)),new vz("overlayTexScale",(s,n)=>b2t(s,n))]),i.constants.add("overlayOpacity","float",1),i.uniforms.add(new Ht("ovColorTex",(s,n)=>rJ(s,n))),X$e(e,t)}function X$e(e,t){e.extensions.add("GL_OES_standard_derivatives"),t.pbrMode!==Pt.Water&&t.pbrMode!==Pt.WaterOnIntegratedMesh||e.include(kPe,t);const{vertex:r,fragment:i}=e;e.varyings.add("vtcOverlay","vec4"),r.code.add(S`void setOverlayVTC(in vec2 uv) {
vtcOverlay = vec4(uv, uv) * overlayTexScale + overlayTexOffset;
}`),i.code.add(S`bool isValid(vec2 uv, vec2 dxdy) {
return (uv.x >= 0.0 + dxdy.x) && (uv.x <= 1.0 - dxdy.x) && (uv.y >= 0.0 + dxdy.y) && (uv.y <= 1.0 - dxdy.y);
}
vec4 getOverlayColor(sampler2D ov0Tex, vec4 texCoords) {
vec4 color0 = texture2D(ov0Tex, vec2(texCoords.x * 0.5, texCoords.y));
vec4 color1 = texture2D(ov0Tex, vec2(texCoords.z * 0.5 + 0.5, texCoords.w));
bool isValid0 = isValid(texCoords.xy, fwidth(texCoords.xy));
bool isValid1 = isValid(texCoords.zw, vec2(0.0, 0.0));
return mix(color1 * float(isValid1), color0, float(isValid0));
}`),i.code.add(S`vec4 getCombinedOverlayColor() {
return overlayOpacity * getOverlayColor(ovColorTex, vtcOverlay);
}`),t.pbrMode!==Pt.Water&&t.pbrMode!==Pt.WaterOnIntegratedMesh||(i.uniforms.add([new St("lightingMainDirection",(s,n)=>n.lighting.lightingMainDirection),new St("lightingMainIntensity",(s,n)=>n.lighting.mainLight.intensity)]),i.code.add(S`vec4 getOverlayWaterColor(vec4 maskInput, vec4 colorInput, vec3 vposEyeDir,
float shadow, vec3 localUp, mat3 tbn, vec3 position, vec3 positionWorld) {
vec3 n = normalize(tbn *  (2.0 * maskInput.rgb - vec3(1.0)));
vec3 v = vposEyeDir;
vec3 final = getSeaColor(n, v, lightingMainDirection, colorInput.rgb, lightingMainIntensity, localUp, 1.0 - shadow, maskInput.w, position, positionWorld);
return vec4(final, colorInput.w);
}`))}function rJ(e,t){return t.overlays.length===0?null:e.identifier===th.Material&&e.subPass===To.Color?t.overlays[Gi.INNER].getColorTextureNoRasterImage():e.identifier===th.Highlight?t.overlays[Gi.INNER].getValidTexture(Ms.Highlight):null}function _2t(e,t){for(const r of t.overlays){const{index:i,extent:s}=r;Qwe(s)>0&&(SC[2*i]=e.toMapSpace[0]/Ju(s)-s[0]/Ju(s),SC[2*i+1]=e.toMapSpace[1]/xf(s)-s[1]/xf(s))}return SC}function b2t(e,t){for(const r of t.overlays){const{index:i,extent:s}=r;Qwe(s)>0&&(SC[2*i]=e.toMapSpace[2]/Ju(s),SC[2*i+1]=e.toMapSpace[3]/xf(s))}return SC}const SC=Zt();function w2t(e,t){e.varyings.add("tbnTangent","vec3"),e.varyings.add("tbnBiTangent","vec3"),t.spherical?e.vertex.code.add(S`void forwardVertexTangent(vec3 n) {
tbnTangent = normalize(cross(vec3(0.0, 0.0, 1.0), n));
tbnBiTangent = normalize(cross(n, tbnTangent));
}`):e.vertex.code.add(S`void forwardVertexTangent(vec3 n) {
tbnTangent = vec3(1.0, 0.0, 0.0);
tbnBiTangent = normalize(cross(n, tbnTangent));
}`),e.fragment.code.add(S`mat3 getTBNMatrix(vec3 n) {
return mat3(tbnTangent, tbnBiTangent, n);
}`)}function x2t(e,t){e.varyings.add("vtc","vec2"),e.vertex.uniforms.add(new hl("texOffsetAndScale")),e.fragment.uniforms.add(new Hi("tex")),e.fragment.uniforms.add(new Yl("textureOpacities"));const r=t.textureFadingEnabled&&!t.renderOccluded;r&&(e.vertex.uniforms.add(new hl("nextTexOffsetAndScale")),e.varyings.add("nvtc","vec2"),e.fragment.uniforms.add(new Hi("texNext")),e.fragment.uniforms.add(new Yl("nextTexOpacities")),e.fragment.uniforms.add(new kr("fadeFactor")));const i=t.tileBlendInput===na.ColorComposite,s=t.tileBlendInput===na.GridComposite;s&&e.fragment.include(Jse),i&&e.fragment.uniforms.add(new Yl("backgroundColor")),e.vertex.code.add(S`
  void forwardTextureCoordinates(in vec2 uv) {
    vtc = uv * texOffsetAndScale.zw + texOffsetAndScale.xy;
    ${r?S`nvtc = uv * nextTexOffsetAndScale.zw + nextTexOffsetAndScale.xy;`:S``}
  }`),e.fragment.code.add(S`
    vec4 applyBaseOpacity(vec4 _color, vec3 _opacities) {
      return _opacities.z <= 0.0 ? _color : _color * _opacities.x;
    }

    vec4 getColor(vec4 color, vec2 uv, vec3 opacities) {
      ${s||i?S`
              if (opacities.y <= 0.0) {
                return color * opacities.z * opacities.x;
              }
              vec4 bg = ${i?S`vec4(backgroundColor, 1.0)`:S`gridColor(uv)`} * opacities.y;
              float alpha = opacities.z * color.a;
              return mix(bg, color, alpha) * opacities.x;`:S`return color;`}
    }`),r?e.fragment.code.add(S`vec4 getTileColor() {
vec4 color = getColor(texture2D(tex, vtc), vtc, textureOpacities);
if (fadeFactor >= 1.0) {
return color;
}
vec4 nextColor = getColor(texture2D(texNext, nvtc), nvtc, nextTexOpacities);
return mix(nextColor, color, fadeFactor);
}`):e.fragment.code.add(S`vec4 getTileColor() {
return getColor(texture2D(tex, vtc), vtc, textureOpacities);
}`)}class Z$e extends y2t{}function T2t(e){const t=new Yr;t.include(aIe,{name:"Terrain Shader",output:e.output}),t.attributes.add(O.POSITION,"vec3"),t.attributes.add(O.UV0,"vec2"),t.attributes.add(O.NORMAL,"vec3");const{vertex:r,fragment:i}=t;if(r.uniforms.add([new Ei("proj",(s,n)=>n.camera.projectionMatrix),new OQ("view",(s,n)=>yl($ge,n.camera.viewMatrix,s.origin)),new pl("origin",s=>s.origin)]),i.uniforms.add(new pl("origin",s=>s.origin)),e.output===K.Color){t.include(ra),t.include(Z_,e),t.include(x2t,e),t.include(LT,e);const s=e.overlayMode!==i0.Disabled,n=e.overlayMode===i0.EnabledWithWater;s&&t.include(Ige,{...e,pbrMode:Pt.Water}),n&&t.include(w2t,e),t.varyings.add("vnormal","vec3"),t.varyings.add("vpos","vec3"),(e.atmosphere||e.screenSizePerspective)&&r.uniforms.add(new Ei("viewNormal",(a,l)=>l.camera.viewInverseTransposeMatrix));const o=e.receiveShadows&&!e.renderOccluded;o&&t.varyings.add("linearDepth","float"),e.tileBorders&&t.varyings.add("vuv","vec2"),e.atmosphere&&(r.uniforms.add(new St("lightingMainDirection",(a,l)=>l.lighting.lightingMainDirection)),t.varyings.add("wnormal","vec3"),t.varyings.add("wlight","vec3")),e.screenSizePerspective&&(t.varyings.add("screenSizeDistanceToCamera","float"),t.varyings.add("screenSizeCosAngle","float")),r.code.add(S`
      void main(void) {
        vpos = position;
        vnormal = ${e.shading?S`normal`:S`getLocalUp(vpos, origin)`};
        vec2 uv = uv0;
        ${e.atmosphere?S`
        wnormal = normalize((viewNormal * vec4(normalize(vpos + origin), 1.0)).xyz);
        wlight = normalize((view  * vec4(lightingMainDirection, 1.0)).xyz);`:""}
        ${e.tileBorders?S`vuv = uv;`:""}
        ${e.screenSizePerspective?S`
        vec3 viewPos = (view * vec4(vpos, 1.0)).xyz;
        screenSizeDistanceToCamera = length(viewPos);
        vec3 viewSpaceNormal = (viewNormal * vec4(normalize(vpos + origin), 1.0)).xyz;
        screenSizeCosAngle = abs(viewSpaceNormal.z);`:""}
        gl_Position = transformPosition(proj, view, vpos);
        ${o?S`linearDepth = gl_Position.w;`:""}
        forwardTextureCoordinates(uv);
        ${s?S`setOverlayVTC(uv);`:""}
        ${n?S`forwardVertexTangent(vnormal);`:S``}
      }
    `),t.extensions.add("GL_OES_standard_derivatives"),t.extensions.add("GL_EXT_shader_texture_lod"),t.include(Ss,e),t.include(LT,e),t.include(LL,e),t.include($T,e),i.uniforms.add([new pl("cameraPosition",(a,l)=>pe(Qj,l.camera.eye,a.origin)),new St("viewDirection",(a,l)=>we(Qj,se(Qj,l.camera.viewMatrix[12],l.camera.viewMatrix[13],l.camera.viewMatrix[14]))),new qe("lightingGlobalFactor",(a,l)=>l.lighting.globalFactor),new St("lightingMainDirection",(a,l)=>l.lighting.lightingMainDirection),new St("lightingMainIntensity",(a,l)=>l.lighting.mainLight.intensity)]),i.constants.add("ambientBoostFactor","float",AR),n&&i.uniforms.add([new Ht("ovWaterTex",(a,l)=>l.overlays.length===0?null:l.overlays[Gi.INNER].getNormalTexture(a.overlaySource)),new OQ("view",(a,l)=>yl($ge,l.camera.viewMatrix,a.origin))]),i.code.add(S`const float sliceOpacity = 0.2;
float lum(vec3 c) {
return (min(min(c.r, c.g), c.b) + max(max(c.r, c.g), c.b)) * 0.5;
}`),i.code.add(S`
      void main() {
        ${o?S`float shadow = readShadowMap(vpos, linearDepth);`:S`float shadow = 0.0;`}
        vec3 normal = normalize(vnormal);
        float vndl = dot(normal, lightingMainDirection);
        float ssao = evaluateAmbientOcclusionInverse();
        vec4 tileColor = getTileColor();
        ${s?S`
            vec4 overlayColorOpaque = getOverlayColor(ovColorTex, vtcOverlay);
            vec4 overlayColor = overlayOpacity * overlayColorOpaque;
            vec4 groundColor = tileColor;
            tileColor = tileColor * (1.0 - overlayColor.a) + overlayColor;`:""}
        if (rejectBySlice(vpos)) {
          tileColor *= sliceOpacity;
        }
        ${e.atmosphere?S`
            float ndotl = clamp(vndl, 0.0, 1.0);
            vec3 atm = vec3(clamp(1.0 - dot(-viewDirection, wnormal), 0.0, 1.0));
            atm *= clamp(1.0 - lum(tileColor.rgb) * 1.5, 0.0, 1.0); //avoid atmosphere on bright base maps
            atm *= clamp(ndotl * 2.0, 0.0, 1.0); // avoid atmosphere on dark side of the globe
            atm *= tileColor.a; // premultiply with tile alpha`:""}

        vec3 albedo = ${e.atmosphere?S`atm + tileColor.rgb;`:S`tileColor.rgb;`}

        // heuristic shading function used in the old terrain, now used to add ambient lighting
        float additionalAmbientScale = smoothstep(0.0, 1.0, clamp(vndl${e.shading?"":S`*2.5`}, 0.0, 1.0));

        vec3 additionalLight = ssao * lightingMainIntensity * additionalAmbientScale * ambientBoostFactor ${e.shading?"":S`* lightingGlobalFactor`};

        gl_FragColor = vec4(evaluateSceneLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight), tileColor.a);
        ${n?S`
            vec4 overlayWaterMask = getOverlayColor(ovWaterTex, vtcOverlay);
            float waterNormalLength = length(overlayWaterMask);
            if (waterNormalLength > 0.95) {
              mat3 tbnMatrix = mat3(tbnTangent, tbnBiTangent, vnormal);
              vec4 waterOverlayColor = vec4(overlayColor.w > 0.0 ? overlayColorOpaque.xyz/overlayColor.w : vec3(1.0), overlayColor.w);
              vec4 viewPosition = view*vec4(vpos, 1.0);
              vec4 waterColorLinear = getOverlayWaterColor(overlayWaterMask, waterOverlayColor, -normalize(vpos - cameraPosition), shadow, vnormal, tbnMatrix, viewPosition.xyz,  vpos + origin);
              vec4 waterColorNonLinear = delinearizeGamma(vec4(waterColorLinear.xyz, 1.0));
              // un-gamma the ground color to mix in linear space
              gl_FragColor = mix(groundColor, waterColorNonLinear, waterColorLinear.w);
            }`:""}
        ${e.screenSizePerspective?S`
          float perspectiveScale = screenSizePerspectiveScaleFloat(1.0, screenSizeCosAngle, screenSizeDistanceToCamera, vec4(0.0, 0.0, 0.0, 0.0));
          if (perspectiveScale <= 0.25) {
            gl_FragColor = mix(gl_FragColor, vec4(1.0, 0.0, 0.0, 1.0), perspectiveScale * 4.0);
          }
          else if (perspectiveScale <= 0.5) {
            gl_FragColor = mix(gl_FragColor, vec4(0.0, 0.0, 1.0, 1.0), (perspectiveScale - 0.25) * 4.0);
          }
          else if (perspectiveScale >= 0.99) {
            gl_FragColor = mix(gl_FragColor, vec4(0.0, 1.0, 0.0, 1.0), 0.2);
          }
          else {
            gl_FragColor = mix(gl_FragColor, vec4(1.0, 0.0, 1.0, 1.0), (perspectiveScale - 0.5) * 2.0);
          }`:""}
        ${e.tileBorders?S`
            vec2 dVuv = fwidth(vuv);
            vec2 edgeFactors = smoothstep(vec2(0.0), 1.5 * dVuv, min(vuv, 1.0 - vuv));
            float edgeFactor = 1.0 - min(edgeFactors.x, edgeFactors.y);
            gl_FragColor = mix(gl_FragColor, vec4(1.0, 0.0, 0.0, 1.0), edgeFactor);`:""}
        gl_FragColor = highlightSlice(gl_FragColor, vpos);
      }
    `)}return e.output!==K.Depth&&e.output!==K.Shadow||(t.include(ra,{hasModelTransformation:!1,linearDepth:!0}),t.include(tb,{output:e.output}),t.include(Z_,e),t.varyings.add("linearDepth","float"),r.uniforms.add(new _r("nearFar",(s,n)=>n.camera.nearFar)),r.code.add(S`void main(void) {
gl_Position = transformPositionWithDepth(proj, view, position, nearFar, linearDepth);
}`),i.code.add(S`void main() {
outputDepth(linearDepth);
}`)),e.output===K.Normal&&(t.include(ra),t.include(Z_,e),t.varyings.add("vnormal","vec3"),t.varyings.add("vpos","vec3"),r.uniforms.add(new Ei("viewNormal",(s,n)=>n.camera.viewInverseTransposeMatrix)),r.code.add(S`
        void main(void) {
          vec3 normal = ${e.shading?S`normal`:S`getLocalUp(position, origin)`};
          vpos = position;

          gl_Position = transformPosition(proj, view, vpos);
          vnormal = normalize((viewNormal * vec4(normal, 1.0)).xyz);
        }
    `),i.code.add(S`void main() {
vec3 normal = normalize(vnormal);
if (gl_FrontFacing == false) {
normal = -normal;
}
gl_FragColor = vec4(vec3(0.5) + 0.5 * normal, 0.0);
}`)),e.output===K.Highlight&&(t.include(ra),t.include(Z_,e),t.include(Ige,e),r.code.add(S`void main() {
setOverlayVTC(uv0);
gl_Position = transformPosition(proj, view, position);
}`),t.include(D0),i.code.add(S`void main() {
vec4 overlayColor = getCombinedOverlayColor();
if (overlayColor.a == 0.0) {
gl_FragColor = vec4(0.0);
return;
}
outputHighlight();
}`)),t}const $ge=Ce(),Qj=M(),S2t=Object.freeze(Object.defineProperty({__proto__:null,TerrainPassParameters:Z$e,build:T2t},Symbol.toStringTag,{value:"Module"}));class E8 extends gi{constructor(){super(...arguments),this.useStencil=!1}initializeConfiguration(t,r){r.spherical=t.viewingMode===Be.Global}initializeProgram(t){const r=E8.shader.get().build(this.configuration);return new oi(t.rctx,r,zr)}initializePipeline(){return this._stencilPipelineState=this._createPipeline(!0),this._createPipeline(!1)}_createPipeline(t){const r=this.configuration,i=r.backfaceCullingEnabled&&!r.renderOccluded;return Gt({blending:r.renderOccluded?bg(Ae.ONE,Ae.ONE_MINUS_SRC_ALPHA):null,culling:i&&nie,depthTest:!r.renderOccluded&&{func:_i.LESS},depthWrite:!r.renderOccluded&&cc,colorWrite:or,stencilTest:t?Kmt(tc.IntegratedMeshMaskExcluded):null})}getPipelineState(t,r){return this.useStencil?this._stencilPipelineState:super.getPipelineState(t,r)}}E8.shader=new ni(S2t,()=>ie(()=>import("./Terrain.glsl.9baac524.js"),[],import.meta.url));class zs extends Ca{constructor(){super(...arguments),this.output=K.Color,this.overlayMode=i0.Disabled,this.tileBlendInput=na.LayerOnly,this.spherical=!1,this.atmosphere=!1,this.receiveShadows=!1,this.hasSlicePlane=!1,this.backfaceCullingEnabled=!1,this.stencilEnabled=!1,this.textureFadingEnabled=!1,this.renderOccluded=!1,this.hasScreenSpaceReflections=!1,this.hasCloudsReflections=!1,this.tileBorders=!1,this.screenSizePerspective=!1,this.receiveAmbientOcclusion=!1,this.shading=he("enable-feature:terrain-shading")}}u([q({count:K.COUNT})],zs.prototype,"output",void 0),u([q({count:i0.COUNT})],zs.prototype,"overlayMode",void 0),u([q({count:na.COUNT})],zs.prototype,"tileBlendInput",void 0),u([q()],zs.prototype,"spherical",void 0),u([q()],zs.prototype,"atmosphere",void 0),u([q()],zs.prototype,"receiveShadows",void 0),u([q()],zs.prototype,"hasSlicePlane",void 0),u([q()],zs.prototype,"backfaceCullingEnabled",void 0),u([q()],zs.prototype,"stencilEnabled",void 0),u([q()],zs.prototype,"textureFadingEnabled",void 0),u([q()],zs.prototype,"renderOccluded",void 0),u([q()],zs.prototype,"hasScreenSpaceReflections",void 0),u([q()],zs.prototype,"hasCloudsReflections",void 0),u([q()],zs.prototype,"tileBorders",void 0),u([q()],zs.prototype,"screenSizePerspective",void 0),u([q()],zs.prototype,"receiveAmbientOcclusion",void 0),u([q()],zs.prototype,"shading",void 0),u([q({constValue:!0})],zs.prototype,"isGround",void 0),u([q({constValue:Pt.Disabled})],zs.prototype,"pbrMode",void 0),u([q({constValue:!1})],zs.prototype,"highStepCount",void 0),u([q({constValue:!1})],zs.prototype,"useCustomDTRExponentForWater",void 0),u([q({constValue:!1})],zs.prototype,"useFillLights",void 0);const Jj=7,E2t=10,Kj=tn(),GF=Zt();let Iu=class extends xe{constructor(e){super(e),this.type=qi.TERRAIN,this.isGround=!0,this.tileSize=256,this._techniqueConfiguration=new zs,this._passParameters=new Z$e,this.rctx=null,this._isTransparent=!1,this._scaleRangeQueries=new LSt,this.renderDataPool=new Ls(Vy),this._patchGroups=new Map,this.patchGroupsDirty=!0,this.tileIterator=new T$e,this.highestVisibleLODTile=null,this.visible=!0,this._opaque=!0,this._velvetOverground=!0,this._castShadows=!0,this.emptyTex=null,this.tileRenderer=null,this.stencilEnabledLayerExtents=[],this.numTilesRendered=0,this.numTilesCulled=0,this.numOriginsRendered=0,this.needsHighlight=!1,this.renderOccludedFlags=Fi.Occlude}get isGlobal(){return this.stage.viewingMode===Be.Global}get shadingEnabled(){var e;return(e=this._techniqueConfiguration)==null?void 0:e.shading}initialize(){const e=[Se.OPAQUE_TERRAIN,Se.TRANSPARENT_TERRAIN,Se.OCCLUDED_TERRAIN];this.stage.addRenderPlugin(e,this)}destroy(){this.stage.removeRenderPlugin(this),wTt()}get canRender(){return this.visible&&!!this._rootTiles&&!this.renderingDisabled}set renderingDisabled(e){this._set("renderingDisabled",!!e),this.setNeedsRender()}set opaque(e){this._opaque!==e&&(this._opaque=e,this.setNeedsRender())}get opaque(){return this._opaque&&!this._techniqueConfiguration.hasSlicePlane}get needsLinearDepth(){return this.overlayRenderer.hasWater}set isTransparent(e){this._isTransparent!==e&&(this._isTransparent=e,this.setNeedsRender())}get isTransparent(){return this._isTransparent}get renderPatchBorders(){return!!this._techniqueConfiguration.tileBorders}set renderPatchBorders(e){this._techniqueConfiguration.tileBorders!==e&&(this._techniqueConfiguration.tileBorders=e,this.setNeedsRender(),this.notifyChange("renderPatchBorders"))}get cullBackFaces(){return this._techniqueConfiguration.backfaceCullingEnabled}set cullBackFaces(e){this._techniqueConfiguration.backfaceCullingEnabled!==e&&(this._techniqueConfiguration.backfaceCullingEnabled=e,this.notifyChange("cullBackFaces"),this.setNeedsRender())}set renderOrder(e){this._set("renderOrder",e),this.setNeedsRender()}set velvetOverground(e){this._velvetOverground!==e&&(this._velvetOverground=e,this.setNeedsRender())}get layerUid(){return Yp}get slicePlaneEnabled(){return this._techniqueConfiguration.hasSlicePlane}set slicePlaneEnabled(e){this._techniqueConfiguration.hasSlicePlane!==e&&(this._techniqueConfiguration.hasSlicePlane=e,this.setNeedsRender())}set textureFadingEnabled(e){this._techniqueConfiguration.textureFadingEnabled!==e&&(this._techniqueConfiguration.textureFadingEnabled=e,this.setNeedsRender())}setDebugScreenSizePerspective(e){this._techniqueConfiguration.screenSizePerspective!==e&&(this._techniqueConfiguration.screenSizePerspective=e,this.setNeedsRender())}toggleShading(){this._techniqueConfiguration.shading=!this._techniqueConfiguration.shading,this.setNeedsRender()}setRootTiles(e){this._rootTiles=e,this.setNeedsRender()}setNeedsHighlight(e){this.needsHighlight=e,this.setNeedsRender()}setRenderOccludedOverlay(e){this.renderOccludedFlags=e?rz:Fi.Occlude,this.setNeedsRender()}setStencilEnabledLayerExtents(e){this.stencilEnabledLayerExtents=e,this.setNeedsRender()}setTileSize(e){this.tileSize=e,b(this.tileRenderer)&&(this.tileRenderer.tileSize=e),this.setNeedsRender()}_prepareTileForLoading(e){e.renderData||(e.renderData=this.renderDataPool.acquire(),e.renderData.init(e),e.renderData.localOrigin=this._getLocalOriginOfTile(e))}loadTile(e){this._prepareTileForLoading(e),this.updateTileGeometry(e),this.updateTileTexture(e,wt.TEXTURE_FADING)}queryVisibleLevelRange(e,t,r,i){this._scaleRangeQueries.queryVisibleLevelRange(e,t,r,i),this.setNeedsRender()}updateTileTexture(e,t){b(this.tileRenderer)&&(this.tileRenderer.updateTileTexture(e,t===wt.TEXTURE_FADING?ro.FADING:ro.UNFADED),this.setNeedsRender(),e.resetPendingUpdate(t))}updateTileGeometryState(e){this._prepareTileForLoading(e),e.renderData.updateGeometryStateAndPrepareForGeometryGeneration(this.wireframe)}updateTileGeometry(e){for(const t of e.layerInfo[Qt.ELEVATION])t.pendingUpdates&=~wt.GEOMETRY;e.resetPendingUpdate(wt.GEOMETRY),e.renderData.updateGeometryIfChanged(this.rctx,this.wireframe)&&this.setNeedsRender()}unloadTile(e){const t=e.renderData;t&&(t.releaseGeometry(),this.renderDataPool.release(t),t.clear(),e.renderData=null,e.setMemoryDirty(),this.setNeedsRender())}_getLocalOriginOfTile(e){const t=E2t-Jj,r=Math.max(0,Math.floor((e.level-t)/Jj)*Jj);if(this.isGlobal&&r===0)return dl;for(;e.parent&&e.level>r;)e=e.parent;return e.centerAtSeaLevel}setVisibility(e){this.visible=e,this.setNeedsRender()}getStats(){return{numTilesRendered:this.numTilesRendered,numTilesCulled:this.numTilesCulled,numOriginsRendered:this.numOriginsRendered}}set wireframe(e){this._get("wireframe")!==e&&(this._set("wireframe",e),this.allTiles.forAll(t=>{t.isLoaded&&(this.updateTileGeometry(t),t.updateNeighborsAfterGeometryChange())}),this.setNeedsRender())}setNeedsRender(e=Ws.UPDATE){this.patchGroupsDirty=!0,this._context.requestRender(e)}initializeRenderContext(e){this._context=e,this.rctx=e.renderContext.rctx,this._techniqueRepository=e.shaderTechniqueRepository,this.tileRenderer=new i2t(this.rctx,this.tileSize,this._techniqueRepository),this.updateTileBackground(),this.emptyTex=sOe(this.rctx)}uninitializeRenderContext(){this.emptyTex=Ye(this.emptyTex),this.tileRenderer=Ye(this.tileRenderer)}intersect(e,t,r,i){if(!this._rootTiles||e.options.selectOpaqueTerrainOnly&&e.options.selectionMode&&!this._opaque)return;const s=A2t,n=R2t;pe(s,i,r),se(n,1/s[0],1/s[1],1/s[2]);const o=e.results.min,a=e.results.max,l=e.results.ground,c=e.options.store===$o.MIN,h=!!e.results.ground.target,p=act(e.verticalOffset),f=e.tolerance;let m,g=c&&b(o.dist)?o.dist:1/0;const v=_=>{const T=_.renderData;if(!(T!=null&&T.vao))return;const x=T.geometryInfo;l6(Kj,x.boundingBox);const E=T.localOrigin;b(p)&&(p.localOrigin=E,p.applyToAabb(Kj));const C=Kj;if(e2[0]=r[0]-E[0],e2[1]=r[1]-E[1],e2[2]=r[2]-E[2],!nse(C,e2,n,f,g))return;const A=(X,Z,ce)=>{X.set(this.type,_,Z,ce,Tn),g=c&&b(o.dist)?o.dist:1/0},P=(X,Z)=>{if(b(Z)&&X>=0&&(e.options.backfacesTerrain||Te(Z,s)<0)&&(e.options.invisibleTerrain||!e.options.selectionMode||t==null||t(r,i,X))){if((l.dist==null||X<l.dist)&&A(l,X,Z),e.options.isFiltered)return;e.options.store===$o.ALL&&(R(m)?(m=Die(e.ray),A(m,X,Z),e.results.all.push(m)):X<m.dist&&A(m,X,Z)),(o.dist==null||X<o.dist)&&A(o,X,Z),e.options.store!==$o.MIN&&(a.dist==null||X>a.dist)&&A(a,X,Z)}},I=O2t;pe(I,i,E);const L=x.indices,k=x.vertexAttributes,G={data:k.getField(O.POSITION,Zr).typedBuffer,size:3,stride:k.stride/4},z=x.indexCount/3;if(R(p)&&z>q$e){const X=_.renderData;R(X.intersectionData)&&(X.intersectionData=new ZA(L,0,z,G)),X.intersectionData.intersectRay({r0:e2,r1:I},P)}else xL(e2,I,0,z,L,G,null,p,P)},w=this._rootTiles;b(w)&&(()=>{const _=this.tileIterator;_.reset(w);const T=e.options.invisibleTerrain;for(;!_.done;){const x=_.next();!(x.visible||T&&x.intersectsClippingArea)||!b(p)&&!x.intersectsRay(r,s,f,g)||h&&this._useStencilForTile(x)?_.skipSubtree():v(x)}})()}prepareTechnique(e){if(e.bindParameters.slot===Se.OCCLUDED_TERRAIN){if((e.renderOccludedMask&rz)==0)return null}else{const t=this.opaque?Se.OPAQUE_TERRAIN:Se.TRANSPARENT_TERRAIN;if(e.bindParameters.slot!==t)return null}switch(e.pass){case je.MATERIAL:{this._techniqueConfiguration.hasScreenSpaceReflections=e.bindParameters.ssr.enabled,this._techniqueConfiguration.hasCloudsReflections=b(e.bindParameters.clouds.data),this._techniqueConfiguration.receiveShadows=e.bindParameters.shadowMap.ready,this._techniqueConfiguration.receiveAmbientOcclusion=e.bindParameters.ssaoHelper.ready,this._techniqueConfiguration.overlayMode=this.overlayRenderer.isEmpty()?i0.Disabled:this.overlayRenderer.hasWater?i0.EnabledWithWater:i0.Enabled;const t=e.bindParameters.slot===Se.OCCLUDED_TERRAIN?il.Occluded:il.ColorAndWater;return this._updateTechnique(K.Color,t===il.Occluded)}case je.MATERIAL_DEPTH_SHADOWMAP_ALL:case je.MATERIAL_DEPTH_SHADOWMAP_DEFAULT:return this._castShadows&&e.bindParameters.lighting.globalFactor===1?(this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(K.Shadow,!1)):null;case je.MATERIAL_DEPTH:return this.isTransparent&&this.overlayRenderer.isEmpty()?null:(this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(K.Depth,!1));case je.MATERIAL_NORMAL:return this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(K.Normal,!1);case je.MATERIAL_HIGHLIGHT:return this.needsHighlight?(this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(K.Highlight,!1)):null}return null}render(e,t){const r=e.pass,i=e.bindParameters.lighting.globalFactor===1;switch(this._updatePatchGroups(),t.useStencil=!1,r){case je.MATERIAL:{const s=e.bindParameters.slot===Se.OCCLUDED_TERRAIN?il.Occluded:il.ColorAndWater;this._renderMaterialPass(e,t,s);break}case je.MATERIAL_DEPTH_SHADOWMAP_ALL:case je.MATERIAL_DEPTH_SHADOWMAP_DEFAULT:this._castShadows&&i&&this._renderAuxiliaryPass(e,t,il.None);break;case je.MATERIAL_DEPTH:this.isTransparent&&this.overlayRenderer.isEmpty()||this._renderAuxiliaryPass(e,t,il.None);break;case je.MATERIAL_NORMAL:this._renderAuxiliaryPass(e,t,il.None);break;case je.MATERIAL_HIGHLIGHT:this.needsHighlight&&(this._renderAuxiliaryPass(e,t,il.Highlight),e.rctx.clearSafe(ri.DEPTH_BUFFER_BIT))}this._scaleRangeQueries.hasPendingQueries()&&this.setNeedsRender()}_renderMaterialPass(e,t,r){const{rctx:i}=e;this._passParameters.overlaySource=r,i.bindTechnique(t,this._passParameters,e.bindParameters),this.numTilesRendered=0,this.numTilesCulled=0,this.numOriginsRendered=0,this._scaleRangeQueries.prepareQueries(),this.opaque?this._renderPatchGroups(e,t,r):e.offscreenRenderingHelper.renderToTargets(()=>this._renderPatchGroups(e,t,r),e.offscreenRenderingHelper.tmpColor,e.offscreenRenderingHelper.mainDepth,[0,0,0,0]),this._scaleRangeQueries.processQueries()}_renderAuxiliaryPass(e,t,r){const i=e.rctx;this._passParameters.overlaySource=r,i.bindTechnique(t,this._passParameters,e.bindParameters),this._renderPatchGroupsAuxiliary(e,t,r)}updateTileBackground(e=null){if(R(this.tileRenderer))return;const t=this.tileRenderer;let r=null;if(b(e)){const i=Me.toUnitRGBA(e);r=Ue(i[0]||0,i[1]||0,i[2]||0)}t.setBackground(r),this.allTiles.forAll(i=>t.updateTileTexture(i,ro.FADING)),this._techniqueConfiguration.tileBlendInput=t.backgroundIsGrid?na.GridComposite:b(t.backgroundColor)?na.ColorComposite:na.LayerOnly,this.setNeedsRender()}_updatePatchGroups(){if(this.patchGroupsDirty){if(this.highestVisibleLODTile=null,this._rebuildPatchGroups(),this.renderOrder!==x$.NONE){const e=Array.from(this._patchGroups.values());e.forEach(t=>E$e(this.renderOrder,t)),e.sort((t,r)=>C$e(t[0],r[0],this.renderOrder)),this._patchGroups=new Map(e.map(t=>[t[0].renderData.localOrigin,t]))}this.patchGroupsDirty=!1}}_rebuildPatchGroups(){var t;const e=this._rootTiles;if(!R(e)){(t=e[0])==null||t.surface.checkAllTileWaterproofness(),this._patchGroups.clear();for(const r of e)this._rebuildPatchGroupsForRootTile(r)}}_rebuildPatchGroupsForRootTile(e){const t=this.tileIterator;for(t.resetOne(e);!t.done;){const r=t.next(),i=r.renderData;if(!i||r.visible)if(r.rendered){if(i){const s=this._patchGroups.get(i.localOrigin)||new Array;this._patchGroups.set(i.localOrigin,s),s.push(r),(!this.highestVisibleLODTile||r.vlevel>this.highestVisibleLODTile.vlevel)&&(this.highestVisibleLODTile=r),t.skipSubtree()}}else this.numTilesCulled++;else this.numTilesCulled++,t.skipSubtree()}}_useStencilForTile(e){for(const t of this.stencilEnabledLayerExtents)if(e.intersectsExtent(t))return!0;return!1}_renderPatchGroupsAuxiliary(e,t,r){const i=this.stencilEnabledLayerExtents.length>0;this._patchGroups.forEach(s=>{const n=s[0].renderData.localOrigin;t.program.bindDraw(new DQ(n),e.bindParameters);for(let o=0;o<s.length;o++)this._renderPatch(e,t,s[o],Lt.TRIANGLES,i,r)}),e.rctx.bindVAO(null)}_renderPatchGroups(e,t,r){const i=e.rctx,s=e.bindParameters.camera,n=t.program;if(this._techniqueConfiguration.screenSizePerspective&&this.pointsOfInterest){const h=KMe(this.stage.viewingMode,this.ellipsoidRadius),p=this.pointsOfInterest.centerOnSurfaceFrequent.distance;h.update({distance:p,fovY:s.fovY})}const o=this.stencilEnabledLayerExtents.length>0,a=r===il.Occluded;a&&(n.bindTexture("tex",this.emptyTex),n.setUniform1f("blend",1),n.setUniform4fv("texOffsetAndScale",jm));const l=b(this.tileRenderer)&&b(this.tileRenderer.backgroundColor)?this.tileRenderer.backgroundColor:dl;this._techniqueConfiguration.tileBlendInput===na.ColorComposite&&n.setUniform3fv("backgroundColor",l);const c=this.wireframe?Lt.LINES:Lt.TRIANGLES;this._techniqueConfiguration.textureFadingEnabled&&n.bindTexture("texNext",this.emptyTex),this._patchGroups.forEach(h=>{const p=h[0].renderData.localOrigin;t.program.bindDraw(new DQ(p),e.bindParameters),this.numOriginsRendered++;for(let f=0;f<h.length;f++){const m=h[f],g=m.renderData.textureReference;if(!R(g)){if(!a){this._scaleRangeQueries.scaleQueriesForTile(m),Lge(m.renderData.geometryInfo.uvOffsetAndScale,g.offsetAndScale,GF),n.setUniform4fv("texOffsetAndScale",GF),n.bindTexture("tex",g.texture.texture);const v=m.renderData.textureFadeFactor,w=v<1?m.renderData.nextTextureReference:null;this._techniqueConfiguration.textureFadingEnabled&&b(w)&&v<1?(Lge(m.renderData.geometryInfo.uvOffsetAndScale,w.offsetAndScale,GF),n.setUniform1f("fadeFactor",v),n.setUniform4fv("nextTexOffsetAndScale",GF),n.setUniform3fv("nextTexOpacities",w.opacities),n.bindTexture("texNext",w.texture.texture)):n.setUniform1f("fadeFactor",1),m.renderData.textureIsFading&&this.setNeedsRender(),n.setUniform3fv("textureOpacities",g.opacities)}this._renderPatch(e,t,m,c,o,r),m.renderOrder=this.numTilesRendered,this.numTilesRendered++}}}),i.bindVAO(null)}_renderPatch(e,t,r,i,s,n){const o=r.renderData,a=o.vao,l=a.indexBuffer;if(R(l))return;const c=t.program;n!==il.None&&this._bindOverlayPatchData(c,o.overlay),s&&(t.useStencil=this._useStencilForTile(r),t.bindPipelineState(e.rctx,e.bindParameters.slot));const h=o.geometryInfo.indexCount;e.rctx.bindVAO(a),c.assertCompatibleVertexAttributeLocations(a),e.rctx.drawElements(i,h,l.indexType,0)}_bindOverlayPatchData(e,t){e.setUniform4fv("overlayTexOffset",t.offsets),e.setUniform4fv("overlayTexScale",t.scales)}_updateTechnique(e,t){return this._techniqueConfiguration.output=e,e===K.Color&&(this._techniqueConfiguration.atmosphere=this.isGlobal&&this._velvetOverground),this._techniqueConfiguration.renderOccluded=t,this._techniqueConfiguration.stencilEnabled=!1,this._shaderTechnique=this._techniqueRepository.releaseAndAcquire(E8,this._techniqueConfiguration,this._shaderTechnique),this._shaderTechnique}get test(){return{tileRenderer:this.tileRenderer}}};u([d({constructOnly:!0})],Iu.prototype,"overlayRenderer",void 0),u([d({constructOnly:!0})],Iu.prototype,"stage",void 0),u([d({readOnly:!0})],Iu.prototype,"isGlobal",null),u([d({constructOnly:!0})],Iu.prototype,"allTiles",void 0),u([d({constructOnly:!0})],Iu.prototype,"ellipsoidRadius",void 0),u([d({value:!1})],Iu.prototype,"renderingDisabled",null),u([d()],Iu.prototype,"renderPatchBorders",null),u([d()],Iu.prototype,"cullBackFaces",null),u([d({value:x$.FRONT_TO_BACK})],Iu.prototype,"renderOrder",null),u([d()],Iu.prototype,"wireframe",null),Iu=u([$("esri.views.3d.terrain.TerrainRenderer")],Iu);const C2t=Iu;function Lge(e,t,r){r[0]=e[0]*t[2]+t[0],r[1]=e[1]*t[3]+t[1],r[2]=e[2]*t[2],r[3]=e[3]*t[3]}const A2t=M(),R2t=M(),e2=M(),O2t=M();class M2t{constructor(){this.numNodes=0,this.numLeaves=0,this.numVisible=0,this.numRendered=0,this.numSplit=0,this.numMerged=0,this.numRenderedPerLevel=new Array,this.numLoadedPerLevel=new Array}}let fm=class extends xe{constructor(e){super(e),this._handles=new Dt}initialize(){this._handles.add(this.layers.on("change",()=>this._update())),this._handles.add(te(()=>this.extentHelper.layerViewsExtent,()=>this._setAdHocTilingScheme())),this._update(),this.tilingSchemeLocked||this._setAdHocTilingScheme()}destroy(){this._handles=ct(this._handles),this._waitTask=null}_update(){if(this._waitTask=null,this.tilingSchemeLocked)return;let e;if(this.layers.some(t=>!(!aC(t)||t.isRejected())&&!(t.isFulfilled()&&!P2t(t,this.viewSpatialReference,this.viewingMode))&&(e=t,!((t==null?void 0:t.type)==="vector-tile"||pz(t)))),e)if(e.isResolved()){const t=_8(e,this.viewSpatialReference,this.viewingMode);if(b(t)){const r=new Mi(t.tileInfo);this._lockTilingScheme(r)}}else this._updateWhen(e)}_updateWhen(e){const t=e.when().catch(()=>{}).then(()=>{t!==this._waitTask||this.destroyed||this._update()});this._waitTask=t}_lockTilingScheme(e){if(this.viewingMode===Be.Global){const t=e.levels.length-1;e.spatialReference.isWebMercator?e=Mi.makeWebMercatorAuxiliarySphere(t):dT(e.spatialReference)&&(e=Mi.makeGCSWithTileSize(e.spatialReference,e.pixelSize,t))}this.tilingSchemeLocked=!0,this.tilingScheme=e,this.extentHelper.tilingScheme=this.tilingScheme,this._updateTiledLayerExtent(),this._handles.removeAll(),this._handles.add(te(()=>this.extentHelper.tiledLayersExtent,()=>this._updateTiledLayerExtent()))}_updateTiledLayerExtent(){this._set("extent",this.extentHelper.tiledLayersExtent)}_setAdHocTilingScheme(){if(this.viewingMode===Be.Global){const e=this.extentHelper.viewSpatialReference,t=dT(e)||hg(e)||dg(e);e.isWebMercator?this.tilingScheme=Mi.WebMercatorAuxiliarySphere:t&&(this.tilingScheme=Mi.makeGCSWithTileSize(e,256)),this._set("extent",this.extentHelper.layerViewsExtent)}else{const e=this.extentHelper.layerViewsExtent;b(e)&&!Nx(e,this.extent)&&(this.tilingScheme=Mi.fromExtent(e,this.extentHelper.viewSpatialReference),this._set("extent",e))}}get test(){return{lockTilingScheme:e=>this._lockTilingScheme(e),done:!this._waitTask}}};function P2t(e,t,r){return b(_8(e,t,r))}u([d()],fm.prototype,"tilingScheme",void 0),u([d({readOnly:!0})],fm.prototype,"extent",void 0),u([d({value:!1})],fm.prototype,"tilingSchemeLocked",void 0),u([d({constructOnly:!0})],fm.prototype,"viewSpatialReference",void 0),u([d({constructOnly:!0})],fm.prototype,"layers",void 0),u([d({constructOnly:!0})],fm.prototype,"extentHelper",void 0),u([d({constructOnly:!0})],fm.prototype,"viewingMode",void 0),fm=u([$("esri.views.3d.terrain.TilingSchemeLogic")],fm);class I2t{constructor(){this.offset=rt(),this.scale=0,this.tile=null}init(t,r,i,s){this.tile=t,this.offset[0]=r,this.offset[1]=i,this.scale=s}dispose(){this.tile=null,this.offset[0]=0,this.offset[1]=0,this.scale=0}}const cp=fe.getLogger("esri.views.3d.terrain.TerrainSurface"),$2t=.25;let ar=class extends ds.EventedMixin(xe){constructor(e){var t,r;super(e),this._elevationBounds=new Zse,this._iteratorPool=new Ls(T$e,i=>i.remove=()=>this._iteratorPool.release(i)),this._postorderIterator=new CTt,this._hasPendingUpdates=!1,this._pendingUpdates=0,this._asyncWorkItems=0,this._allTilesDirty=!0,this._allTilesSorted=!0,this._visible=!1,this._usedMemory=null,this._performanceInfo=new M2t,this._viewChanged=!1,this._inFrameTask=!1,this._viewChangeUpdateDirty=!1,this._eyePosRenderSR=M(),this._eyePosSurfaceSR=M(),this._splitLimits=new eSt,this._snapLevel=1/0,this._frustum=e$(),this._viewProjectionMatrix=Ce(),this._layerViews=[new Array,new Array],this._layerIndexByUid=[new Map,new Map],this._basemapLayerViewHandles=new Map,this._handles=new Dt,this._watchUpdatingTracking=new Gm,this._frameTask=wA,this._allTiles=new Xt,this._upsampleInfoPool=new Ls(I2t),this._rootTilesExtent=Ut(),this._maxNumUpdating=1,this.maxTextureScale=1.2,this.backgroundColor=null,this._updatingRootTiles=!1,this.deferTileNeighborUpdate=!1,this.neighborTilesToUpdate=new Set,this.totalGeometryUpdates=0,this.totalTileUpdates=0,this._layerViewsDirty=!1,this._isGlobal=!((r=(t=e.view)==null?void 0:t.state)!=null&&r.isLocal)}initialize(){this._lercDecoder=Jxt(this.view.resourceController),this._tilePool=this.view.state.isLocal?new Ls(PSt):new Ls(ISt);const e=this.view.resourceController.memoryController;this._upsampleMapCache=e.newCache("esri.views.3d.terrain.upsample",s=>s.unloadMapData()),this._elevationQueryCache=new Yxt(e.newCache("elevation-query")),this._set("overlayManager",new Dl({surface:this})),this._handles.add([te(()=>this.overlayManager.hasHighlights,s=>this._renderer.setNeedsHighlight(s)),te(()=>this.overlayManager.rendersOccluded,s=>this._renderer.setRenderOccludedOverlay(s))],"overlayManager"),this._renderer=new C2t({overlayRenderer:this.overlayManager.renderer,ellipsoidRadius:Ar(this.view.spatialReference).radius,stage:this.view._stage,allTiles:this._allTiles}),this._handles.add([te(()=>this.baseOpacity,s=>{this._handleLayerViewChanges(),this._updateBaseOpacity(s)},Xs),te(()=>this.hasCompositeBlendMode,()=>{this._updateBaseOpacity(this.baseOpacity)},Xs),te(()=>this.renderingDisabled,()=>this._updateTransparentTerrain(),ei),te(()=>this.backgroundColor,s=>{this._handleLayerViewChanges(),this._renderer.updateTileBackground(s)},Xs),te(()=>this.view.pointsOfInterest,s=>{this._renderer.pointsOfInterest=s,this._watchUpdatingTracking.removeAll(),s&&this._watchUpdatingTracking.add(()=>s.focus.renderLocation,()=>()=>this._allTilesSorted=!1)}),te(()=>Xr.TERRAIN_TILE_TREE_SHOW_TILES,s=>{s&&!this._treeDebugger?ie(()=>import("./TerrainTileTree3DDebugger.8f4fd3b6.js"),["TerrainTileTree3DDebugger.8f4fd3b6.js","TileTreeDebugger.d9a3080b.js"],import.meta.url).then(({TerrainTileTree3DDebugger:n})=>{!this._treeDebugger&&Xr.TERRAIN_TILE_TREE_SHOW_TILES&&(this._treeDebugger=new n({view:this.view}))}):s||(this._treeDebugger=ct(this._treeDebugger))},Rt)]),this._extentHelper=fTt(this.viewingMode,{layers:this.view.map.allLayers,layerViews:this.view.allLayerViews,viewSpatialReference:this.view.spatialReference});const t=this.view.defaultsFromMap?new QC({getCollections:()=>{var s,n,o;return(o=(n=(s=this.view)==null?void 0:s.defaultsFromMap)==null?void 0:n.mapCollections)==null?void 0:o.map(({layers:a})=>a)},getChildrenFunction:s=>s&&"layers"in s?s.layers:null}):this.view.map.allLayers,r=new fm({layers:t,extentHelper:this._extentHelper,viewingMode:this.viewingMode,viewSpatialReference:this.view.spatialReference});this._set("tilingSchemeLogic",r),this._updateTilingScheme(),this._elevationDataRequester=this.view.resourceController.createStreamDataRequester(Lm.ELEVATION),this._mapDataRequester=this.view.resourceController.createStreamDataRequester(Lm.BASEMAP);const i=this.view.resourceController.scheduler;this._frameTask=i.registerTask(vt.TERRAIN_SURFACE,this),this._handles.add([te(()=>this._extentHelper.stencilEnabledExtents,s=>this._renderer.setStencilEnabledLayerExtents(s),Rt),te(()=>this.tilingSchemeLogic.tilingScheme,()=>this._updateTilingScheme(),ei),te(()=>this.extent,()=>this._updateRootTiles(),Rt),this.view.on("resize",()=>this._viewChangeUpdate()),te(()=>{var o,a;const s=this.view,n=s.state;return[this.lodBias,this.lodSnapping,(a=(o=s.resourceController)==null?void 0:o.memoryController)==null?void 0:a.memoryFactor,n.camera,n.contentCamera,n.fixedContentCamera]},()=>this._viewChangeUpdate(),Xs),te(()=>{var s,n;return(n=(s=this.view.qualitySettings)==null?void 0:s.tiledSurface)==null?void 0:n.textureFadeDuration},s=>this._renderer.textureFadingEnabled=s>0,Rt),te(()=>this._userClippingExtent,()=>this._updateClippingExtent(),ei)]),this._handles.add(this.view.allLayerViews.on("after-changes",()=>this._layerViewsDirty=!0)),this._layerViewsDirty=!0,this._handleLayerViewChanges()}destroy(){this._frameTask.remove(),this._handles.destroy(),this._watchUpdatingTracking.destroy(),this._lercDecoder=ti(this._lercDecoder),this._removeAllTiles(),this._upsampleMapCache=ct(this._upsampleMapCache),this._elevationQueryCache=ct(this._elevationQueryCache),this._set("tilingSchemeLogic",ct(this.tilingSchemeLogic)),this._extentHelper=ct(this._extentHelper),this._basemapLayerViewHandles.forEach((e,t)=>this._unregisterTiledLayerView(t)),this._elevationDataRequester=null,this._mapDataRequester=null,this._set("overlayManager",ct(this.overlayManager)),this._tilePool=ct(this._tilePool),Kse.prune(),this._treeDebugger&&(this._treeDebugger.destroy(),this._treeDebugger=null),this._renderer=ct(this._renderer),this._iteratorPool=ct(this._iteratorPool),this._set("view",null),this._upsampleInfoPool=ct(this._upsampleInfoPool),hTt(),JTt()}get renderer(){return this._renderer}get frustum(){return this._frustum}get snapLevel(){var t,r;const e=(r=(t=this.view.pointsOfInterest)==null?void 0:t.contentCameraOnSurface)==null?void 0:r.scale;if(e){const i=this.view.state.contentCamera;let s=CB(this.view,i.eye,i.viewForward,i.up).tilt;s>90&&(s=180-s);const n=2*(s/90)**2,o=VMe(this.view,e)-n;Math.abs(this._snapLevel-o)>$2t&&(Math.round(o)!==Math.round(this._snapLevel)&&(this._viewChanged=!0),this._snapLevel=o)}return Math.round(this._snapLevel)}get lodSnapping(){return this.view.qualitySettings.tiledSurface.reduceTileLevelDifferences?GA.ON:GA.OFF}get upsampleInfoPool(){return this._upsampleInfoPool}get upsampleMapCache(){return this._upsampleMapCache}get elevationQueryCache(){return this._elevationQueryCache}get mapTileRequester(){return this._mapDataRequester}get _userClippingExtent(){const{spatialReference:e}=this,{clippingArea:t}=this.view;if(R(t)||R(e))return null;const r=Ut(),i=KIe(t,r,e)?r:null,s=this._get("extent");return Nx(i,s)?s:i}get rootTilesExtent(){return this._rootTilesExtent}get extent(){const e=J4(this.groundExtent,this._userClippingExtent,Ut()),t=this._get("extent");return Nx(e,t)?t:e}get groundExtent(){return b(this._tilingSchemeExtent)?this._tilingSchemeExtent:this._rootTilesExtent}get _tilingSchemeExtent(){var e;return(e=this.tilingSchemeLogic)==null?void 0:e.extent}get updating(){return this._hasPendingUpdates||(this._maxNumUpdating=1),!!((this._watchUpdatingTracking.updating||this._hasPendingUpdates||this._viewChanged||this._allTilesDirty||this._asyncWorkItems>0||!this._allTilesSorted||this._layerViewsDirty)&&this.ready&&!this.suspended||this.overlayManager.updating||this._frameTask.updating)}get updatingProgressValue(){return this._maxNumUpdating=Math.max(this._pendingUpdates,this._maxNumUpdating),1-this._pendingUpdates/this._maxNumUpdating}get viewingMode(){return this.view.state.viewingMode}get ready(){return b(this.rootTiles)}set renderOrder(e){this._renderer.renderOrder=e,this._set("renderOrder",e)}get spatialReference(){var e,t;return(t=(e=this.tilingScheme)==null?void 0:e.spatialReference)!=null?t:null}set slicePlaneEnabled(e){this._renderer.slicePlaneEnabled=e,this._set("slicePlaneEnabled",e),this._updateTransparentTerrain()}_updateTransparentTerrain(){var t,r;const e=!this.renderingDisabled&&!this.opaque;(r=(t=this.view)==null?void 0:t._stage)==null||r.renderView.setRenderParameters({transparentTerrain:e})}set velvetOverground(e){e!==this.velvetOverground&&(this._renderer.velvetOverground=e),this._set("velvetOverground",e)}set visible(e){e!==this._visible&&(this._visible=e,this._renderer.setVisibility(e),this.suspended=!e)}get opaque(){return this._renderer.opaque}set suspended(e){this._set("suspended",e),this._viewChangeUpdate()}intersect(e,t,r,i){this._renderer.intersect(e,t,r,i)}getElevation(e,t,r,i){const s=this.getTileWithElevation(e,t,r,i,Go);return R(s)?null:_$e(Go[0],Go[1],s.renderData.geometryState.samplerData)}getTileWithElevation(e,t,r,i,s=Go){var o;const n=this.rootTiles;if(R(n)||!n.length||n[0].layerInfo[Qt.ELEVATION].length===0)return null;if(s[0]=e,s[1]=t,s[2]=r,!xn(s,i,s,(o=this.tilingScheme)==null?void 0:o.spatialReference))return cp.error("TerrainSurface.getElevation(): could not project given point to tiling scheme coordinate system"),null;for(let a of n){if(!a.containsPoint(s))continue;for(;a&&!a.rendered&&!a.isLeaf;){let c=0;s[0]>.5*(a.extent[0]+a.extent[2])&&(c+=1),s[1]<.5*(a.extent[1]+a.extent[3])&&(c+=2),a=a.children[c]}const l=a.renderData;return l&&l.geometryState.samplerData?a:null}return null}get elevationBounds(){return this._elevationBounds}getScale(e){if(this.tilingScheme){if(!so(e,Go,this.spatialReference))return cp.error("TerrainSurface.getScale(): could not project given point to tiling scheme coordinate system"),null;const t=this.rootTiles;if(b(t)){for(let r of t)if(r!=null&&r.containsPoint(Go)){for(;!r.isLeaf&&!r.rendered;){let i=0;Go[0]>r.children[0].extent[2]&&(i+=1),Go[1]<r.children[0].extent[1]&&(i+=2),r=r.children[i]}return this._getLodBiasCorrectedScale(r.level)}}}return 1e100}getSphereElevationBounds(e,t,r,i,s){var c;if(Go[0]=e,Go[1]=t,Go[2]=r,Go[3]=i,!xn(Go,s,Go,(c=this.tilingScheme)==null?void 0:c.spatialReference))return cp.error("TerrainSurface.getSphereElevationBounds(): could not project given point to tiling scheme coordinate system"),null;let n=1/0,o=-1/0;const a=h=>{if(h&&Qae(h.extent,Go))if(h.isLeaf||h.rendered)n=Math.min(n,h.elevationBounds[0]),o=Math.max(o,h.elevationBounds[1]);else for(const p of h.children)a(p)},l=this.rootTiles;if(b(l))for(const h of l)a(h);return{min:n,max:o}}getSphereScale(e,t){if(!this.tilingScheme)return null;if(!so(e,Go,this.spatialReference))return cp.error("TerrainSurface.getSphereScale(): could not project given point to tiling scheme coordinate system"),null;Go[3]=t;let r=null;const i=n=>{if(n&&Qae(n.extent,Go))if(n.isLeaf||n.rendered){const o=this._getLodBiasCorrectedScale(n.level);r=r==null?o:Math.min(r,o)}else for(const o of n.children)i(o)},s=this.rootTiles;if(b(s))for(const n of s)i(n);return r}queryVisibleScaleRange(e,t,r,i){const s=t?this.tilingScheme.levelAtScale(t):0,n=r?this.tilingScheme.levelAtScale(r):1/0,o=this.lodBias;this._renderer.queryVisibleLevelRange(e,s+o,n+o,i)}_updateBaseOpacity(e){const t=this._renderer.opaque;this._renderer.opaque=e>=1&&!this.hasCompositeBlendMode,this._renderer.isTransparent=this._allSurfaceLayersTransparent();const r=t!==this._renderer.opaque;r&&this._updateTransparentTerrain(),this._updateTileTextures(r?ro.UNFADED:ro.IMMEDIATE)}_updateTilingScheme(){var t,r;const e=this.tilingSchemeLogic.tilingScheme;e!==this.tilingScheme&&(Am(!!e,"tiling scheme cannot be reset to undefined"),this._isGlobal=!((r=(t=this.view)==null?void 0:t.state)!=null&&r.isLocal),this.tilingScheme&&this._removeAllTiles(),this._set("tilingScheme",e),this._updateClippingExtent(),e&&(this._updateTiledLayers(),this._renderer.setTileSize(e.pixelSize),this.overlayManager.setSpatialReference(e.spatialReference),this._updateRootTiles()))}_acquireTile(e,t,r,i){const s=this._tilePool.acquire();return jF[0]=e,jF[1]=t,jF[2]=r,s.init(jF,i,this),s}get updatingRootTiles(){return this._updatingRootTiles}_updateRootTiles(){const{extent:e,tilingScheme:t}=this;if(!t)return;const r=N2t;let i=t.rootTilesInExtent(e,r,5*LE);if(b(this.rootTiles)){if(i.length>LE)return void cp.warn(Ait);const s=this.rootTiles.map(o=>o.lij),n=V4e(s,i,Dge);if(this._updatingRootTiles=!0,n.removed.length>0||n.added.length>0){const o=this.rootTiles.filter(a=>!(n.removed.findIndex(l=>Dge(l,a.lij))>-1)||(this._purgeTile(a,!0),!1));n.added.forEach(a=>o.push(this._newRootTile(a))),this._setRootTiles(o)}}else this._updatingRootTiles=!0,i.length>LE&&(cp.warn(Rit),i=t.rootTilesInExtent(e,r,LE)),this._setRootTiles(i.map(s=>this._newRootTile(s)));Nx(r,this._rootTilesExtent)||(this._rootTilesExtent=Ut(r)),this.visible=!0,this._viewChangeUpdate(),this.overlayManager.setPlacementDirty(),this.notifyChange("ready"),this._allTiles.forEach(s=>{s.isLoaded&&this._prepareToLoadTile(s)}),this._allTiles.forAll(s=>{s.isLoaded&&(this._updateTileGeometry(s),this._updateTileNeighborsAfterGeometryChange(s))}),this._updatingRootTiles=!1,this.checkAllTileWaterproofness()}_newRootTile(e){const t=this._acquireTile(0,e[1],e[2],null);return t.shouldSplit(this._splitLimits,this._eyePosRenderSR,this.lodSnapping)===wt.SPLIT&&t.setPendingUpdate(wt.SPLIT),this._loadTile(t),this.deferTileNeighborUpdate||t.checkGeometryWaterproofness(),t}_setRootTiles(e){if(this._set("rootTiles",e),this._allTiles.clear(),b(e)){const t=this._iteratorPool.acquire();for(t.reset(e);!t.done;)this._allTiles.push(t.next());t.remove()}this._renderer.setRootTiles(this.rootTiles),this._updateTilesVisibility(e)}_runViewChangeUpdateIfDirty(){this._viewChangeUpdateDirty&&(this._viewChangeUpdateDirty=!1,this._viewChangeUpdate())}_viewChangeUpdate(){this.view&&!this.suspended&&this.tilingScheme&&this._visible&&(this._inFrameTask?this._viewChangeUpdateDirty=!0:(this._viewChangeUpdateDirty=!1,this._updateViewDependentParameters(),this._updateTilesVisibility(this.rootTiles)))}_updateClippingStatus(e){e.updateClippingStatus(this.extent)&&e.resetPendingUpdate(wt.GEOMETRY)&&this._updateTileGeometry(e)}_updateTilesVisibility(e){if(R(e))return;const t=OTt(e);let r=t?this._elevationBounds.min:1/0,i=t?this._elevationBounds.max:-1/0;const s=this.view.state.fixedContentCamera,n=this.extent,o=this._viewProjectionMatrix;this.setTileTreeDirty();const a=this._iteratorPool.acquire();for(a.reset(e);!a.done;){const l=a.next();l.updateClippingStatus(n)&&l.resetPendingUpdate(wt.GEOMETRY)&&this._updateTileGeometry(l),l.setPendingUpdate(wt.RENDERDATA);const c=l.computeVisibility();s||c?(l.updateScreenDepth(o),l.renderData&&(r=Math.min(l.elevationBounds[0],r),i=Math.max(l.elevationBounds[1],i))):a.skipSubtree()}a.remove(),this._viewChanged=!0,this._allTilesDirty=!0,isFinite(r)&&isFinite(i)&&(this._elevationBounds.min===r&&this._elevationBounds.max===i||(this._elevationBounds.min=r,this._elevationBounds.max=i,this.emit("elevation-bounds-change",null)))}_updateViewDependentParameters(){const e=this.view.state.camera,t=this.view.state.contentCamera,r=Math.tan(.5*t.fovX),i=Math.tan(.5*t.fovY),s=this.tilingScheme.pixelSize,n=2**-this.lodBias*e.pixelRatio;this._splitLimits.aboveGround=e.aboveGround,this._splitLimits.fovX=r,this._splitLimits.fovY=i,this._splitLimits.relativeWidthLimit=s/e.width*this.maxTextureScale*n,this._splitLimits.relativeHeightLimit=s/e.height*this.maxTextureScale*n,this._splitLimits.maxLod=this.tilingScheme.getMaxLod(),this._splitLimits.angledSplitBias=this.view.qualitySettings.tiledSurface.angledSplitBias,this.view.state.fixedContentCamera?(R(this._splitLimits.frustum)&&(this._splitLimits.frustum=e$()),$V(this._splitLimits.frustum,t.frustum)):this._splitLimits.frustum=null,$V(this._frustum,e.frustum),Yi(this._viewProjectionMatrix,t.projectionMatrix,t.viewMatrix),ae(this._eyePosRenderSR,t.eye),xn(e.eye,this.view.renderSpatialReference,this._eyePosSurfaceSR,this.spatialReference)}_updateRenderData(e){e.rendered&&!e.shouldLoad&&(Y$e(e)?(this._loadChildren(e),this.deferTileNeighborUpdate||(this._checkTileNeighborsWaterproofness(e),e.children.forEach(t=>t.checkGeometryWaterproofness()))):D2t(e)&&this._loadParent(e))}_updateTileGeometry(e){e.updateVisibility(),this._renderer.updateTileGeometry(e),this._updateTileNeighborsAfterGeometryChange(e),this._elevationUpdate(e),this._usedMemory=null,this.deferTileNeighborUpdate&&this.neighborTilesToUpdate.delete(e)}_updateTileNeighborsAfterGeometryChange(e,t){if(this.deferTileNeighborUpdate){const r=this.neighborTilesToUpdate;e.forEachLoadedNeighbor(i=>{r.add(i)})}else e.updateNeighborsAfterGeometryChange(t)}_updateTileTexture(e,t){const r=e.resetPendingUpdate(wt.TEXTURE_FADING)?wt.TEXTURE_FADING:!!e.resetPendingUpdate(wt.TEXTURE_NOFADING)&&wt.TEXTURE_NOFADING;r&&(this._renderer.updateTileTexture(e,r),this._usedMemory=null,t.madeProgress())}_elevationUpdate(e){HF.spatialReference=this.spatialReference,HF.tile=e,HF.extent=e.extent,this.emit("elevation-change",HF)}get running(){return this.updating&&this.ready&&!this.suspended}runTask(e){this._handleLayerViewChanges(e),this._frameTask.processQueue(e),this._inFrameTask=!0,this._pendingUpdates=0,this._hasPendingUpdates=!1,this._updateTileStatus(e),this._sortTiles(e);const t=!this.view.state.fixedContentCamera;this._mergeAndSplit(e,t),e.run(()=>this._updateElevation(e)),e.run(()=>this._updateTextures(e)),t||this._mergeAndSplit(e,!0),this._inFrameTask=!1,this._runViewChangeUpdateIfDirty(),e.done?this.requestUpdate():this._usedMemory=this._recalculateUsedMemory(),this.notifyChange("updatingProgressValue")}_updateTileStatus(e){if(!this._viewChanged||!this.rootTiles||e.done)return;this._viewChanged=!1;const t=this._iteratorPool.acquire();for(t.reset(this.rootTiles);!t.done;){const r=t.next();if(r.loadable){const i=r.shouldSplit(this._splitLimits,this._eyePosRenderSR,this.lodSnapping);if(i===wt.SPLIT){r.resetPendingUpdate(wt.MERGE),r.isLeaf&&(r.setPendingUpdate(wt.SPLIT),t.skipSubtree());continue}r.resetPendingUpdate(wt.SPLIT)&&r.updateAgentSuspension(),i===wt.VSPLITMERGE&&r.updateAgents(Qt.ELEVATION)}if(t.skipSubtree(),!r.isLeaf){r.setPendingUpdate(wt.MERGE),r.resetPendingUpdate(wt.SPLIT);const i=this._iteratorPool.acquire();i.resetOne(r);for(let s=i.next();!i.done;s=i.next())this._updateClippingStatus(s),s.updateVisibility(),s.loadable&&s.updateScreenDepth(this._viewProjectionMatrix);i.remove()}}t.remove(),this.requestUpdate(),e.madeProgress()}_sortTiles(e){e.done||this._allTilesSorted||(ATt(this._allTiles,this.view.pointsOfInterest.focus.renderLocation),this._allTilesSorted=!0,this._treeDebugger&&this._treeDebugger.update(),e.madeProgress())}_prepareBatchTileGeometryUpdate(){this.neighborTilesToUpdate.size,this.deferTileNeighborUpdate=!0}_batchUpdateUpdatedTileNeighbors(){this.deferTileNeighborUpdate=!1;const e=this.neighborTilesToUpdate;(()=>{const t=()=>{for(const r of e)r.updateNeighborsWithChangedEdgeResolution()};(()=>{for(const r of e)r.updateNeighborDataAndGeometryIfNeeded()})(),t(),e.clear()})()}_mergeAndSplit(e,t){if(this.suspended||e.done||!this._allTilesDirty)return;this._allTilesDirty=!1,this.requestUpdate(),this._prepareBatchTileGeometryUpdate();let r=!1;for(;!e.done;){r=!0;let i=!1;const s=!this._allTiles.some(n=>{if(n.resetPendingUpdate(wt.MERGE)){if(!t)return n.setPendingUpdate(wt.MERGE),e.done;this._mergeTile(n),i=!0,e.madeProgress()}else n.resetPendingUpdate(wt.SPLIT)&&(this._splitTile(n),i=!0,e.madeProgress());return!e.done&&n.resetPendingUpdate(wt.RENDERDATA)&&(this._updateRenderData(n),e.madeProgress()),e.done});if(i&&(this._allTilesSorted=!1,this._allTilesDirty=!0),s){if(!i)break;this._updateTilesVisibility(this.rootTiles)}else this._allTilesDirty=!0}r||(this._allTilesDirty=!0),this._batchUpdateUpdatedTileNeighbors(),this._sortTiles(e)}_updateElevation(e){return this._prepareBatchTileGeometryUpdate(),this._allTiles.some(t=>(t.resetPendingUpdate(wt.GEOMETRY)&&(this._updateTileGeometry(t),this._updateTileTexture(t,e),e.madeProgress()),e.done)),this._batchUpdateUpdatedTileNeighbors(),e.hasProgressed}_updateTextures(e){return this._allTiles.some(t=>(this._updateTileTexture(t,e),e.done)),e.hasProgressed}_updateClippingExtent(){this.spatialReference&&(this.updateTileOverlayParams(Ws.UPDATE),this.overlayManager.setPlacementDirty(),this._updateRootTiles())}get lodBias(){const e=this.view.resourceController.memoryController.memoryFactor;return this.view.qualitySettings.tiledSurface.lodBias-(1-e)*Sit}_getLodBiasCorrectedScale(e){const t=this.tilingScheme.levels,r=Le(e-this.lodBias,0,t.length-1),i=r-Math.floor(r);return t[Math.floor(r)].scale*(1-i)+t[Math.ceil(r)].scale*i}_removeAllTiles(){b(this.rootTiles)&&(this.rootTiles.forEach(e=>this._purgeTile(e,!1)),this._setRootTiles(null),this.notifyChange("ready")),this._allTiles.clear(),this.visible=!1}_purgeDescendantTiles(e){if(e.isLeaf)return!1;let t=!1;for(let r=0;r<4;++r)t=this._purgeTile(e.children[r],!1)||t;return e.unsetChildren(),t}_purgeTile(e,t){const r=this._purgeDescendantTiles(e)||e.rendered;return this._allTiles.removeUnordered(e),this._unloadTile(e),t&&this._updateTileNeighborsAfterGeometryChange(e),this._tilePool.release(e),r}_unloadTile(e){this.deferTileNeighborUpdate&&this.neighborTilesToUpdate.delete(e),e.unload(this._renderer)}_splitTile(e){Am(e.isLeaf,"tile that is already split should not be split again!");const t=e.level+1,r=2*e.lij[1],i=2*e.lij[2];e.setChildren(this._createTile(t,r,i,e),this._createTile(t,r,i+1,e),this._createTile(t,r+1,i,e),this._createTile(t,r+1,i+1,e)),e.setPendingUpdate(wt.RENDERDATA),e.updateAgentSuspension(),this._allTiles.pushArray(e.children),this._allTilesDirty=!0,this._emitTileScaleChange(e,t),++this._performanceInfo.numSplit}_emitTileScaleChange(e,t=e.level){qF.spatialReference=this.spatialReference,qF.extent=e.extent,qF.scale=this._getLodBiasCorrectedScale(t),this.emit("scale-change",qF)}_createTile(e,t,r,i){Am(!!i,"_createTile sanity check");const s=this._acquireTile(e,t,r,i);return s.updateClippingStatus(this.extent),s.loadable&&(s.updateScreenDepth(this._viewProjectionMatrix),s.shouldSplit(this._splitLimits,this._eyePosRenderSR,this.lodSnapping)===wt.SPLIT&&s.setPendingUpdate(wt.SPLIT)),s}_mergeTile(e){Am(!e.hasPendingUpdate(wt.SPLIT),"_mergeTile sanity check"),this._purgeDescendantTiles(e)&&(Am(!e.renderData,"_mergeTile sanity check"),this._loadTile(e),this._updateTileNeighborsAfterGeometryChange(e),this.deferTileNeighborUpdate||this._checkTileAndNeighborsWaterproofness(e)),this._allTilesDirty=!0,++this._performanceInfo.numMerged,this._emitTileScaleChange(e)}_checkTileAndNeighborsWaterproofness(e){e.checkGeometryWaterproofness(),this._checkTileNeighborsWaterproofness(e)}_checkTileNeighborsWaterproofness(e){}_loadChildren(e){this.deferTileNeighborUpdate||this._checkTileAndNeighborsWaterproofness(e),Am(e.rendered,"parent should be rendered"),this._unloadTile(e);const t=e.children;t.forEach(r=>this._prepareToLoadTile(r)),t.forEach(r=>this._loadTilePrepared(r)),this._updateTileNeighborsAfterGeometryChange(e,e.level+1),this.deferTileNeighborUpdate||(t.forEach(r=>r.updateNeighborsWithChangedEdgeResolution()),t.forEach(r=>r.checkGeometryWaterproofness()),this._checkTileNeighborsWaterproofness(e))}_loadParent(e){this.deferTileNeighborUpdate||this._checkTileAndNeighborsWaterproofness(e);const t=e.parent;this._unloadChildren(t),this._loadTile(t),this._updateTileNeighborsAfterGeometryChange(t),this.deferTileNeighborUpdate||this._checkTileAndNeighborsWaterproofness(t)}_unloadChildren(e){if(!e.isLeaf)for(let t=0;t<4;++t){const r=e.children[t];this._unloadChildren(r),this._unloadTile(r)}}_postLoadTile(e){e.setPendingUpdate(wt.RENDERDATA),this.requestUpdate(),this._allTilesDirty=!0,this.overlayManager&&this.overlayManager.hasOverlays&&this.overlayManager.setTileParameters(e),this._elevationUpdate(e)}_loadTile(e){e.load(this._renderer),this._postLoadTile(e)}_loadTilePrepared(e){e.loadPrepared(this._renderer),this._postLoadTile(e)}_prepareToLoadTile(e){e.prepareToLoad(this._renderer)}_elevationDataArrived(e,t,r){const i=new pTt(e.lij,e.extent,r);e.dataArrived(t,Qt.ELEVATION,i);const s=[e],n=e.level,o=this._iteratorPool.acquire();for(o.reset(s);!o.done;){const a=o.next();a.findElevationBoundsForLayer(t,n),a.computeElevationBounds()}o.remove(),this._updateTilesVisibility(s)}_handleLayerViewChanges(e=ER){if(!this._layerViewsDirty)return;this._layerViewsDirty=!1;let t=!1;const r=new Set;let i=-1;for(const s of this.view.allLayerViews.items)if(r.add(s.uid),_$(s))if(this._basemapLayerViewHandles.has(s.uid)){const n=this._layerClassFromLayerView(s),o=this._getLayerIdxByUID(n,s.uid);b(o)&&((o<i||R(i))&&(t=!0),i=o)}else this._registerTiledLayerView(s),s.layer.loaded&&(t=!0);this._basemapLayerViewHandles.forEach((s,n)=>{r.has(n)||(this._unregisterTiledLayerView(n),t=!0)}),t&&this._updateTiledLayers(),this._renderer.isTransparent=this._allSurfaceLayersTransparent(),this.hasCompositeBlendMode=this._hasCompositeBlendMode(),e.madeProgress()}_allSurfaceLayersTransparent(){var t,r;let e=((r=(t=this.view.map)==null?void 0:t.ground)==null?void 0:r.opacity)===0;for(const i of this.view.allLayerViews.items)if(JQ(i)&&!Mbe(i.layer)&&i.fullOpacity!==0)return e=!1,e;return e}_hasCompositeBlendMode(){for(const e of this.view.allLayerViews.items)if(fz(e)){const t=f$e(e.layer.parent)?"normal":e.layer.blendMode;if(PTt(fk[t]))return!0}return!1}_layerClassFromLayerView(e){return QQ(e)?Qt.ELEVATION:Qt.MAP}_registerTiledLayerView(e){const t=[],r=this._layerClassFromLayerView(e);t.push(te(()=>e.suspended,()=>this._updateTiledLayers())),t.push(te(()=>e.fullOpacity,()=>this._updateTileTextures(ro.UNFADED))),t.push(te(()=>"effectiveScaleRange"in e.layer?e.layer.effectiveScaleRange:null,()=>this._restartAllAgents(r))),fz(e)&&t.push(te(()=>e.layer.blendMode,()=>{this.hasCompositeBlendMode=this._hasCompositeBlendMode(),this._updateTileTextures(ro.UNFADED)})),e.on("data-changed",()=>{const i=this._getLayerIdxByUID(r,e.uid);b(i)&&this._invalidateLayerData(i,r)}),this._basemapLayerViewHandles.set(e.uid,t)}_unregisterTiledLayerView(e){const t=this._basemapLayerViewHandles.get(e);if(t){for(let r=0;r<t.length;r++)t[r].remove();this._basemapLayerViewHandles.delete(e)}}_updateTiledLayers(){if(!this.tilingScheme||this.view.suspended)return;const e=this.view.allLayerViews,t=[[],[]];let r=null;e.forEach(i=>{if(!i.layer||i.suspended||!_$(i)||!i.fullExtent)return;const s=this._layerClassFromLayerView(i);if(s===Qt.MAP){const n=i.displayLevelRange.maxLevel;n!==1/0&&(r===null||n>r)&&(r=n)}t[s].push(i)});for(const i of Lw){const s=this._layerViews[i],n=t[i];n.reverse();const o=n.length;let a=s.length!==o;const l=new Array(o),c=new Array(s.length);this._layerIndexByUid[i].clear();for(let h=0;h<o;h++){const p=n[h].uid;this._layerIndexByUid[i].set(p,h);const f=s.indexOf(n[h]);l[h]=f,h!==f&&(a=!0),f>-1&&(c[f]=h)}if(a){const h=this._postorderIterator;for(h.reset(this.rootTiles);!h.done;)h.next().modifyLayers(c,l,i);this._layerViews[i]=n,this._restartAllAgents(i),this._updateTilesVisibility(this.rootTiles)}}this.tilingScheme.ensureMaxLod(r)&&this._viewChangeUpdate()}_restartAllAgents(e){const t=this._postorderIterator;for(t.reset(this.rootTiles);!t.done;){const r=t.next();r.restartAgents(e),e===Qt.ELEVATION&&r.computeElevationBounds()}}layerViewByIndex(e,t){return this._layerViews[t][e]}numLayers(e){return this._layerViews[e].length}_updateTileTextures(e){this._allTiles.forAll(t=>{t.updateAgents(Qt.MAP),e===ro.IMMEDIATE?this.renderer.updateTileTexture(t,wt.TEXTURE_NOFADING):t.updateRenderData(Qt.MAP,e)}),this._renderer.isTransparent=this._allSurfaceLayersTransparent()}_invalidateLayerData(e,t){this._allTiles.forAll(r=>r.removeLayerAgent(e,t)),this._allTiles.forAll(r=>r.invalidateLayerData(e,t))}setTileTreeDirty(){this._allTilesDirty=!0}requestRender(e=Ws.UPDATE){this.renderer.setNeedsRender(e)}requestUpdate(){++this._pendingUpdates==1&&(this._hasPendingUpdates=!0)}requestTileData(e,t,r,i){const s=this.layerViewByIndex(t,r),n=s.layer;return!n.tilemapCache||v$(s)?this._requestTileData(e,r,s,i):(++this._asyncWorkItems,n.tilemapCache.fetchAvailability(e.lij[0],e.lij[1],e.lij[2],{...i,timeout:6e3}).then(()=>--this._asyncWorkItems).catch(o=>{throw--this._asyncWorkItems,Vi(o)||this._dataMissing(e,r,s,{notInTilemap:!0}),o}).then(()=>this._frameTask.schedule(()=>this._requestTileData(e,r,s,i),i.signal)))}_requestTileData(e,t,r,i){return t===Qt.ELEVATION?QQ(r)?this._requestElevationTileData(e,r,i):Promise.reject():JQ(r)?this._requestMapTileData(e,r,i):Promise.reject()}_requestElevationTileData(e,t,r){++this._asyncWorkItems;const i=o=>{if(gn(r))return;const a=this._layerIndexByUid[Qt.ELEVATION].get(t.uid);a!=null?(this._usedMemory=null,this.requestUpdate(),this._elevationDataArrived(e,a,o)):cp.warn("TerrainSurface: received data from unknown layer %d %s",Qt.ELEVATION,e.lij.toString())},s=o=>{Vi(o)||(this._dataMissing(e,Qt.ELEVATION,t,o),this.requestUpdate())};if(nge(t.layer))return t.layer.fetchTile(e.lij[0],e.lij[1],e.lij[2],{noDataValue:MI,signal:r.signal}).then(o=>{if(!gn(r))return this._frameTask.schedule(()=>i(o),r.signal,s);cp.warnOnce("A call to fetchTile resolved even though the request was aborted. fetchTile should not resolve if options.signal.aborted is true.")},s).finally(()=>{--this._asyncWorkItems});const n=t.getTileUrl(e.lij[0],e.lij[1],e.lij[2]);return this._elevationDataRequester.request(n,"binary",r).then(o=>this._lercDecoder.decode(o,{noDataValue:MI},r.signal)).then(o=>{o?i({values:o.pixelData,width:o.width,height:o.height,noDataValue:o.noDataValue,minValue:o.minValue,maxValue:o.maxValue}):s(new Error("LERC decoding failed"))},s).finally(()=>{--this._asyncWorkItems})}_requestMapTileData(e,t,r){++this._asyncWorkItems;const i=(c,h)=>{--this._asyncWorkItems,wC(h),gn(r)||(this._dataMissing(e,Qt.MAP,t,c),this.requestUpdate())},s=c=>h=>i(h,c),n=c=>this._frameTask.schedule(()=>{--this._asyncWorkItems,this.requestUpdate(),gn(r)?wC(c):this._mapTileDataArrived(e,t,c)},r.signal,s(c)).catch(s(c)),o=(c,h=null)=>this._frameTask.schedule(()=>i(c,h));if(v$(t)){const c=t.schemaHelper.getLevelRowColumn(e.lij);return t.fetchTile(c[0],c[1],c[2],r).then(n,o)}if(v8(t))return t.fetchTile(e.lij[0],e.lij[1],e.lij[2],r).then(n,o);if(Xse(t)&&nge(t.layer))return t.layer.fetchTile(e.lij[0],e.lij[1],e.lij[2],r).then(c=>{if(gn(r))return cp.warnOnce("A call to fetchTile resolved even though the request was aborted. fetchTile should not resolve if options.signal.aborted is true."),void o(gr());n(c)},o);let a=t.getTileUrl(e.lij[0],e.lij[1],e.lij[2]);Met(t.layer)&&t.layer.refreshTimestamp&&(a+=`${a.includes("?")?"&":"?"}_ts=${t.layer.refreshTimestamp}`);const l=t.hasMixedImageFormats?"image+type":"image";return this._mapDataRequester.request(a,l,r).then(n,o)}_mapTileDataArrived(e,t,r){const i=this._getLayerIdxByUID(Qt.MAP,t.uid);b(i)?e.dataArrived(i,Qt.MAP,r):(wC(r),cp.warn("TerrainSurface: received data from unknown layer"))}_getLayerIdxByUID(e,t){return this._layerIndexByUid[e].get(t)}_dataMissing(e,t,r,i){const s=this._getLayerIdxByUID(t,r.uid);b(s)?e.dataMissing(s,t,i):cp.warn("TerrainSurface: received data from unknown layer")}updateTileOverlayParams(e){this.rootTiles&&this.overlayManager&&(this._allTiles.forAll(t=>{t.renderData&&this.overlayManager.setTileParameters(t)}),this._renderer.setNeedsRender(e))}get performanceInfo(){const e=this._performanceInfo;return e.numNodes=this._allTiles.length,e.numLeaves=e.numVisible=e.numRendered=e.numLoadedPerLevel.length=e.numRenderedPerLevel.length=0,this._allTiles.forAll(t=>{t.isLeaf&&e.numLeaves++;const r=t.level;t.renderData&&(e.numLoadedPerLevel[r]=(e.numLoadedPerLevel[r]||0)+1),t.visible&&(e.numVisible++,t.rendered&&(e.numRenderedPerLevel[r]=(e.numRenderedPerLevel[r]||0)+1,e.numRendered++))}),e}getUsedMemory(){return this.tilingScheme?(R(this._usedMemory)&&(this._usedMemory=this._recalculateUsedMemory()),b(this._usedMemory)?this._usedMemory:0):0}_recalculateUsedMemory(){return this.tilingScheme?this._allTiles.reduce((e,t)=>e+t.usedMemory,0):null}getUsedMemoryForLayerView(e){let t=0;const r=this._layerClassFromLayerView(e),i=this._getLayerIdxByUID(r,e.uid);return b(i)&&this._allTiles.forAll(s=>t+=s.getUsedMemoryForLayer(r,i)),t}getTile(e){if(R(e)||R(this.rootTiles))return null;const t=e.split("/").map(o=>+o);if(t[0]===0)return this.rootTiles.find(o=>o.lij[1]===t[1]&&o.lij[2]===t[2]);const r=2**t[0],i=Math.floor(t[1]/r),s=Math.floor(t[2]/r);let n;if(this.rootTiles.some(o=>o.lij[1]===i&&o.lij[2]===s&&(n=o,!0)),n){let o=1<<t[0]-1;for(;n.lij[0]<t[0];){let a=t[1]&o?2:0;if((t[2]&o)>0&&a++,!n.children[a])return null;n=n.children[a],o>>=1}return Am(n.lij[0]===t[0]&&n.lij[1]===t[1]&&n.lij[2]===t[2],"not the right tile?"),n}return null}get test(){const e=this;return{renderer:e._renderer,lercDecoder:e._lercDecoder,forceReload:()=>{b(e.rootTiles)&&(e._mergeTile(e.rootTiles[0]),e._viewChangeUpdate())},getTiles:()=>e._allTiles.toArray(),getRenderedTiles(){eH.clear(),e._allTiles.forAll(r=>{r.visible&&r.rendered&&eH.push(r)});const t=eH.toArray();return E$e(e.renderOrder,t),t},lockTilingScheme(t,r){e._extentHelper.defaultTiledLayersExtent=r,e.tilingSchemeLogic.test.lockTilingScheme(t)}}}checkAllTileWaterproofness(){}get isGlobal(){return this._isGlobal}get shadingEnabled(){return this._renderer.shadingEnabled}get isWebMercator(){var e;return!!((e=this.tilingScheme)!=null&&e.spatialReference.isWebMercator)}get isWebMercatorOnPlateeCarree(){var e;return this.isWebMercator&&nI((e=this.view)==null?void 0:e.renderSpatialReference)}isEastEndWrap(e){return this.isGlobal&&e[2]===this.lijEastEnd(e[0])-1}isWestEndWrap(e){return this.isGlobal&&e[2]===0}lijEastEnd(e){return 2**(e+(this.spatialReference.isGeographic?1:0))}wrapEastWest(e){const t=this.lijEastEnd(e[0]),r=e[2];if(0<=r&&r<t)return e;if(!this.isGlobal)return null;const i=(r+(r<0?t:0))%t;return[e[0],e[1],i]}};u([d()],ar.prototype,"_renderer",void 0),u([d()],ar.prototype,"_hasPendingUpdates",void 0),u([d()],ar.prototype,"_asyncWorkItems",void 0),u([d()],ar.prototype,"_allTilesDirty",void 0),u([d()],ar.prototype,"_allTilesSorted",void 0),u([d()],ar.prototype,"_viewChanged",void 0),u([d({readOnly:!0})],ar.prototype,"_watchUpdatingTracking",void 0),u([d()],ar.prototype,"_frameTask",void 0),u([d({readOnly:!0})],ar.prototype,"snapLevel",null),u([d({readOnly:!0})],ar.prototype,"lodSnapping",null),u([d({constructOnly:!0})],ar.prototype,"view",void 0),u([d()],ar.prototype,"_userClippingExtent",null),u([d()],ar.prototype,"_rootTilesExtent",void 0),u([d({readOnly:!0})],ar.prototype,"extent",null),u([d({readOnly:!0})],ar.prototype,"groundExtent",null),u([d({readOnly:!0})],ar.prototype,"_tilingSchemeExtent",null),u([d({readOnly:!0})],ar.prototype,"updating",null),u([d(dTt)],ar.prototype,"updatingProgress",void 0),u([d({readOnly:!0})],ar.prototype,"updatingProgressValue",null),u([d()],ar.prototype,"_maxNumUpdating",void 0),u([d({aliasOf:"view.map.ground.opacity"})],ar.prototype,"baseOpacity",void 0),u([d()],ar.prototype,"hasCompositeBlendMode",void 0),u([d({readOnly:!0})],ar.prototype,"overlayManager",void 0),u([d({readOnly:!0})],ar.prototype,"viewingMode",null),u([d()],ar.prototype,"maxTextureScale",void 0),u([d({readOnly:!0})],ar.prototype,"ready",null),u([d({value:x$.FRONT_TO_BACK})],ar.prototype,"renderOrder",null),u([d({readOnly:!0})],ar.prototype,"rootTiles",void 0),u([d({readOnly:!0})],ar.prototype,"spatialReference",null),u([d({type:Me,aliasOf:"view.map.ground.surfaceColor"})],ar.prototype,"backgroundColor",void 0),u([d({value:!1})],ar.prototype,"slicePlaneEnabled",null),u([d({readOnly:!0})],ar.prototype,"tilingScheme",void 0),u([d({readOnly:!0,aliasOf:"tilingSchemeLogic.tilingSchemeLocked"})],ar.prototype,"tilingSchemeLocked",void 0),u([d({readOnly:!0})],ar.prototype,"tilingSchemeLogic",void 0),u([d({value:!0})],ar.prototype,"velvetOverground",null),u([We("_renderer.wireframe")],ar.prototype,"wireframe",void 0),u([d({value:!1})],ar.prototype,"suspended",null),u([d({readOnly:!0,aliasOf:"view.qualitySettings.tiledSurface.textureFadeDuration"})],ar.prototype,"textureFadeDuration",void 0),u([d()],ar.prototype,"_layerViewsDirty",void 0),u([We("_renderer.renderPatchBorders")],ar.prototype,"renderPatchBorders",void 0),u([We("_renderer.renderingDisabled")],ar.prototype,"renderingDisabled",void 0),ar=u([$("esri.views.3d.terrain.TerrainSurface")],ar);const L2t=ar;function Dge(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]}function Y$e(e){return!e.isLeaf&&(e.children.some(t=>t.shouldLoad)||e.children.some(t=>Y$e(t)))}function D2t(e){return e.isLeaf&&e.parent&&e.parent.shouldLoad}const Go=Zt(),N2t=Ut(),jF=[0,0,0],eH=new Xt,HF={spatialReference:null,tile:null,extent:null,context:"ground"},qF={spatialReference:null,extent:null,scale:0};let b3=class extends xe{constructor(e){super(e),this._residentGeomRecords=new Map,this._dirtyGeomRecords=new Map,this.dirty=!1}commit(e){this.dirty=!1,this._dirtyGeomRecords.forEach((t,r)=>this.commitLayer(r,e))}commitLayer(e,t){const r=this._dirtyGeomRecords.get(e);r&&(r.forEach((i,s)=>{const n=this._ensureGeomRecord(e,s);i.forEach((o,a)=>{const l=o[0],c=o[1],h=o[2];let p=!1;if(c&sr.Geometry.UPDATE){const f=n.get(a);if(f){const m=f[1];if(h&sr.State.TRANSFORMATION){const g=this.model.getObject(s);this.model.updateRenderGeometryTransformation(g,l,m)&&(p=!0)}p||t.updates.push({renderGeometry:m,updateType:h})}else ft(!1,"ModelDirtySet.getAddRemoveListFilteredByLayers: invalid update")}if(c&sr.Geometry.REMOVE||p){const f=n.get(a);f?(t.removes.push(f[1]),n.delete(a),f[0].disposed&&PT.pool.release(f[0])):c===sr.Geometry.REMOVE&&ft(!1,"ModelDirtySet.getAddRemoveListFilteredByLayers: invalid remove")}if(c&sr.Geometry.ADD||p){const f=this.model.getObject(s);if(b(f)){const m=this.model.getRenderGeometry(f,l),g=[l,m];t.adds.push(m),n.set(a,g)}}}),n.size===0&&this._residentGeomRecords.get(e).delete(s)}),this._residentGeomRecords.get(e).size===0&&this._residentGeomRecords.delete(e),this._dirtyGeomRecords.delete(e))}getResidentRenderGeometries(e,t){const r=this._residentGeomRecords.get(e);r&&r.forEach(i=>i.forEach(s=>t.push(s[1])))}_objectStateChanged(e,t){for(const r of t.geometryRecords)this._updateOrCreateDirtyRecord(t,r,null,sr.Geometry.UPDATE,0,0,sr.Geometry.UPDATE,sr.Geometry.ADD|sr.Geometry.REMOVE,e)}visibilityChanged(e){this._objectStateChanged(sr.State.VISIBILITIES,e)}highlightChanged(e){this._objectStateChanged(sr.State.HIGHLIGHTS,e)}occlusionChanged(e){this._objectStateChanged(sr.State.OCCLUDEES,e)}vertexAttrsUpdated(e){this._updateOrCreateDirtyRecord(e.object,e.record,null,sr.Geometry.UPDATE,0,0,sr.Geometry.UPDATE,sr.Geometry.ADD|sr.Geometry.REMOVE,sr.State.VERTEXATTRS)}layerAdded(e){e.objects.forAll(t=>this._layerObjectAdded(e,t))}layerRemoved(e){e.objects.forAll(t=>this._layerObjectRemoved(e,t))}layerObjectAdded(e){this._layerObjectAdded(e.layer,e.object)}_layerObjectAdded(e,t){const r=e.id;for(const i of t.geometryRecords)this._objectGeometryAdded(t,i,r)}layerObjectRemoved(e){this._layerObjectRemoved(e.layer,e.object)}layerObjectsAdded(e){for(const t of e.objects)this._layerObjectAdded(e.layer,t)}layerObjectsRemoved(e){for(const t of e.objects)this._layerObjectRemoved(e.layer,t)}_layerObjectRemoved(e,t){const r=e.id;for(const i of t.geometryRecords)this._objectGeometryRemoved(t,i,r)}shaderTransformationChanged(e){const t=this._residentGeomRecords.get(e.id);t&&t.forEach((r,i)=>{const s=this.model.getObject(i);s&&s.hasVolativeTransformation()&&r.forEach(n=>{n[1].shaderTransformationChanged()})})}objectTransformation(e){const t=this._getParentLayerId(e),r=e.id;this._ensureGeomRecord(t,r).forEach(i=>{this._updateOrCreateDirtyRecord(e,i[0],t,sr.Geometry.UPDATE,0,0,sr.Geometry.UPDATE,sr.Geometry.ADD|sr.Geometry.REMOVE,sr.State.TRANSFORMATION)})}objectGeometryAdded(e){this._objectGeometryAdded(e.object,e.record)}_objectGeometryAdded(e,t,r=null){this._updateOrCreateDirtyRecord(e,t,r,sr.Geometry.ADD,sr.Geometry.REMOVE,0,0,0)}objectGeometryRemoved(e){this._objectGeometryRemoved(e.object,e.record)}_objectGeometryRemoved(e,t,r=null){this._updateOrCreateDirtyRecord(e,t,r,sr.Geometry.REMOVE,sr.Geometry.ADD,sr.Geometry.UPDATE,0,0)}_updateOrCreateDirtyRecord(e,t,r,i,s,n,o,a,l){r=_t(r,this._getParentLayerId(e));const c=e.id,h=t.id,p=this._ensureDirtyRecord(r,c),f=p.get(h);if(f){const m=f[1];m&s?(p.delete(h),f[0].disposed&&PT.pool.release(f[0])):m&n?(f[1]=i,f[2]=l):m&o?f[2]|=l:m&a||ft(!1,"ModelDirtySet.objectGeometryAdded: inconsistent state")}else p.set(h,[t,i,l]);this.dirty=this._hasDirtyGeometryRecords}_ensureGeomRecord(e,t){let r=this._residentGeomRecords.get(e);r||(r=new Map,this._residentGeomRecords.set(e,r));let i=r.get(t);return i||(i=new Map,r.set(t,i)),i}get _hasDirtyGeometryRecords(){return yn(this._dirtyGeomRecords,e=>yn(e,t=>t&&t.size>0))}_ensureDirtyRecord(e,t){let r=this._dirtyGeomRecords.get(e);r||(r=new Map,this._dirtyGeomRecords.set(e,r));let i=r.get(t);return i||(i=new Map,r.set(t,i)),i}_getParentLayerId(e){return b(e.parentLayer)?e.parentLayer.id:F5e}formatDebugInfo(){const e=["ADD","UPD",void 0,"REM"];let t="";return this._dirtyGeomRecords.forEach((r,i)=>{r.forEach((s,n)=>{t.length>0&&(t+=`
`),t+=i+"."+n;const o=[];s.forEach(a=>{const l=a[1];o[l]||(o[l]=[]),o[l].push(a[0].geometry.id)});for(let a=0;a<o.length;a++)if(o[a]){t+=" "+e[a-1]+": ";for(let l=0;l<o[a].length;l++)t+=o[a][l]+", "}})}),t}get test(){const e=this;return{get residentLayerCount(){return e._residentGeomRecords.size},get residentObjectCount(){return Array.from(e._residentGeomRecords.values()).reduce((t,r)=>t+r.size,0)}}}};u([d({constructOnly:!0})],b3.prototype,"model",void 0),u([d()],b3.prototype,"dirty",void 0),b3=u([$("esri.views.3d.webgl-engine.lib.ModelDirtySet")],b3);const F2t=b3;let _k=class extends xe{constructor(){super(...arguments),this.dirtySet=new F2t({model:this}),this._content=new Map,this._originFactory=new Ese(null,75e4)}getObject(e){return this._content.get(e)}add(e){const t=e.id;ft(!this._content.has(t),"Model/Stage already contains object to be added"),this._content.set(t,e),JV(e)&&this.dirtySet.layerAdded(e)}remove(e){ft(this._content.has(e.id),"Model/Stage doesn't contain object to be removed"),this._content.delete(e.id),e.unload(),JV(e)&&this.dirtySet.layerRemoved(e)}addMany(e){for(const t of e)b(t)&&(ft(!this._content.has(t.id),"Model/Stage already contains object to be added"),this._content.set(t.id,t))}removeMany(e){for(const t of e)ft(this._content.has(t.id),"Model/Stage doesn't contain object to be removed"),this._content.delete(t.id),t.unload()}has(e){return this._content.has(e.id)}forEachOfType(e,t){this._content.forEach(r=>{r.type===e&&t(r)})}getRenderGeometry(e,t){const{geometry:r,material:i,id:s,shaderTransformation:n,origin:o,instanceParameters:a}=t,l=new qA(r,i,{id:s,boundingInfo:r.boundingInfo,calculateShaderTransformation:n,castShadow:e.castShadow});return l.updateTransformation(c=>e.getCombinedStaticTransformation(t,c)),l.origin=o||this._originFactory.getOrigin(l.boundingSphere),l.instanceParameters=a,l}updateRenderGeometryTransformation(e,t,r){if(R(e))return!1;r.updateTransformation(s=>e.getCombinedStaticTransformation(t,s));const i=this._originFactory.getOrigin(r.boundingSphere);return r.origin!==i}getStats(){const e={},t=Array.from(this._content.values());for(let r=0;r<Cf.COUNT;++r)e[r]=t.filter(i=>i.type===r).length;return{contentTypes:e,dirtySet:this.dirtySet.formatDebugInfo()}}get test(){return{content:Array.from(this._content.values())}}};u([d({constructOnly:!0})],_k.prototype,"dirtySet",void 0),_k=u([$("esri.views.3d.webgl-engine.parts.Model")],_k);function Q$e(){const e=new Float32Array(4);return e[3]=1,e}function J$e(e){const t=new Float32Array(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function k2t(e,t,r,i){const s=new Float32Array(4);return s[0]=e,s[1]=t,s[2]=r,s[3]=i,s}function K$e(e,t){return new Float32Array(e,t,4)}Object.freeze(Object.defineProperty({__proto__:null,create:Q$e,clone:J$e,fromValues:k2t,createView:K$e},Symbol.toStringTag,{value:"Module"}));const _s=!0,Ox={identifierOffset:0,identifierLength:10,versionOffset:10,checksumOffset:12,byteCount:16};function lne(e,t,r){return{identifier:String.fromCharCode.apply(null,new Uint8Array(e,r+Ox.identifierOffset,Ox.identifierLength)),version:t.getUint16(r+Ox.versionOffset,_s),checksum:t.getUint32(r+Ox.checksumOffset,_s)}}const Ac={sizeLo:0,sizeHi:4,minX:8,minY:16,minZ:24,maxX:32,maxY:40,maxZ:48,errorX:56,errorY:64,errorZ:72,count:80,reserved:84,byteCount:88};function U2t(e,t){return{sizeLo:e.getUint32(t+Ac.sizeLo,_s),sizeHi:e.getUint32(t+Ac.sizeHi,_s),minX:e.getFloat64(t+Ac.minX,_s),minY:e.getFloat64(t+Ac.minY,_s),minZ:e.getFloat64(t+Ac.minZ,_s),maxX:e.getFloat64(t+Ac.maxX,_s),maxY:e.getFloat64(t+Ac.maxY,_s),maxZ:e.getFloat64(t+Ac.maxZ,_s),errorX:e.getFloat64(t+Ac.errorX,_s),errorY:e.getFloat64(t+Ac.errorY,_s),errorZ:e.getFloat64(t+Ac.errorZ,_s),count:e.getUint32(t+Ac.count,_s),reserved:e.getUint32(t+Ac.reserved,_s)}}function FDt(e){const t=new DataView(e,0);let r=0;const{identifier:i,version:s}=lne(e,t,r);if(r+=Ox.byteCount,i!=="LEPCC     ")throw new j("lepcc-decode-error","Bad identifier");if(s>1)throw new j("lepcc-decode-error","Unknown version");const n=U2t(t,r);if(r+=Ac.byteCount,n.sizeHi*2**32+n.sizeLo!==e.byteLength)throw new j("lepcc-decode-error","Bad size");const o=new Float64Array(3*n.count),a=[],l=[],c=[],h=[];if(r=WF(e,r,a),r=WF(e,r,l),r=WF(e,r,c),r=WF(e,r,h),r!==e.byteLength)throw new j("lepcc-decode-error","Bad length");let p=0,f=0;for(let m=0;m<a.length;m++){f+=a[m];let g=0;for(let v=0;v<l[m];v++){g+=c[p];const w=h[p];o[3*p]=Math.min(n.maxX,n.minX+2*n.errorX*g),o[3*p+1]=Math.min(n.maxY,n.minY+2*n.errorY*f),o[3*p+2]=Math.min(n.maxZ,n.minZ+2*n.errorZ*w),p++}}return{errorX:n.errorX,errorY:n.errorY,errorZ:n.errorZ,result:o}}function WF(e,t,r){const i=[];t=iJ(e,t,i);const s=[];for(let n=0;n<i.length;n++){s.length=0,t=iJ(e,t,s);for(let o=0;o<s.length;o++)r.push(s[o]+i[n])}return t}function iJ(e,t,r){const i=new DataView(e,t),s=i.getUint8(0),n=31&s,o=!!(32&s),a=(192&s)>>6;let l=0;if(a===0)l=i.getUint32(1,_s),t+=5;else if(a===1)l=i.getUint16(1,_s),t+=3;else{if(a!==2)throw new j("lepcc-decode-error","Bad count type");l=i.getUint8(1),t+=2}if(o)throw new j("lepcc-decode-error","LUT not implemented");const c=Math.ceil(l*n/8),h=new Uint8Array(e,t,c);let p=0,f=0,m=0;const g=-1>>>32-n;for(let v=0;v<l;v++){for(;f<n;)p|=h[m]<<f,f+=8,m+=1;r[v]=p&g,p>>>=n,f-=n,f+n>32&&(p|=h[m-1]>>8-f)}return t+m}const Dw={sizeLo:0,sizeHi:4,count:8,colorMapCount:12,lookupMethod:14,compressionMethod:15,byteCount:16};function V2t(e,t){return{sizeLo:e.getUint32(t+Dw.sizeLo,_s),sizeHi:e.getUint32(t+Dw.sizeHi,_s),count:e.getUint32(t+Dw.count,_s),colorMapCount:e.getUint16(t+Dw.colorMapCount,_s),lookupMethod:e.getUint8(t+Dw.lookupMethod),compressionMethod:e.getUint8(t+Dw.compressionMethod)}}function z2t(e){const t=new DataView(e,0);let r=0;const{identifier:i,version:s}=lne(e,t,r);if(r+=Ox.byteCount,i!=="ClusterRGB")throw new j("lepcc-decode-error","Bad identifier");if(s>1)throw new j("lepcc-decode-error","Unknown version");const n=V2t(t,r);if(r+=Dw.byteCount,n.sizeHi*2**32+n.sizeLo!==e.byteLength)throw new j("lepcc-decode-error","Bad size");if((n.lookupMethod===2||n.lookupMethod===1)&&n.compressionMethod===0){if(3*n.colorMapCount+n.count+r!==e.byteLength||n.colorMapCount>256)throw new j("lepcc-decode-error","Bad count");const o=new Uint8Array(e,r,3*n.colorMapCount),a=new Uint8Array(e,r+3*n.colorMapCount,n.count),l=new Uint8Array(3*n.count);for(let c=0;c<n.count;c++){const h=a[c];l[3*c]=o[3*h],l[3*c+1]=o[3*h+1],l[3*c+2]=o[3*h+2]}return l}if(n.lookupMethod===0&&n.compressionMethod===0){if(3*n.count+r!==e.byteLength||n.colorMapCount!==0)throw new j("lepcc-decode-error","Bad count");return new Uint8Array(e,r).slice()}if(n.lookupMethod<=2&&n.compressionMethod===1){if(r+3!==e.byteLength||n.colorMapCount!==1)throw new j("lepcc-decode-error","Bad count");const o=t.getUint8(r),a=t.getUint8(r+1),l=t.getUint8(r+2),c=new Uint8Array(3*n.count);for(let h=0;h<n.count;h++)c[3*h]=o,c[3*h+1]=a,c[3*h+2]=l;return c}throw new j("lepcc-decode-error","Bad method "+n.lookupMethod+","+n.compressionMethod)}const Nw={sizeLo:0,sizeHi:4,count:8,scaleFactor:12,bitsPerPoint:14,reserved:15,byteCount:16};function B2t(e,t){return{sizeLo:e.getUint32(t+Nw.sizeLo,_s),sizeHi:e.getUint32(t+Nw.sizeHi,_s),count:e.getUint32(t+Nw.count,_s),scaleFactor:e.getUint16(t+Nw.scaleFactor,_s),bitsPerPoint:e.getUint8(t+Nw.bitsPerPoint),reserved:e.getUint8(t+Nw.reserved)}}function G2t(e){const t=new DataView(e,0);let r=0;const{identifier:i,version:s}=lne(e,t,r);if(r+=Ox.byteCount,i!=="Intensity ")throw new j("lepcc-decode-error","Bad identifier");if(s>1)throw new j("lepcc-decode-error","Unknown version");const n=B2t(t,r);if(r+=Nw.byteCount,n.sizeHi*2**32+n.sizeLo!==e.byteLength)throw new j("lepcc-decode-error","Bad size");const o=new Uint16Array(n.count);if(n.bitsPerPoint===8){if(n.count+r!==e.byteLength)throw new j("lepcc-decode-error","Bad size");const a=new Uint8Array(e,r,n.count);for(let l=0;l<n.count;l++)o[l]=a[l]*n.scaleFactor}else if(n.bitsPerPoint===16){if(2*n.count+r!==e.byteLength)throw new j("lepcc-decode-error","Bad size");const a=new Uint16Array(e,r,n.count);for(let l=0;l<n.count;l++)o[l]=a[l]*n.scaleFactor}else{const a=[];if(iJ(e,r,a)!==e.byteLength)throw new j("lepcc-decode-error","Bad size");for(let l=0;l<n.count;l++)o[l]=a[l]*n.scaleFactor}return o}const sJ=fe.getLogger("esri.views.3d.layers.i3s.I3SBinaryReader");function j2t(e,t,r){let i="",s=0;for(;s<r;){const n=e[t+s];if(n<128)i+=String.fromCharCode(n),s++;else if(n>=192&&n<224){if(s+1>=r)throw new j("utf8-decode-error","UTF-8 Decode failed. Two byte character was truncated.");const o=(31&n)<<6|63&e[t+s+1];i+=String.fromCharCode(o),s+=2}else if(n>=224&&n<240){if(s+2>=r)throw new j("utf8-decode-error","UTF-8 Decode failed. Multi byte character was truncated.");const o=(15&n)<<12|(63&e[t+s+1])<<6|63&e[t+s+2];i+=String.fromCharCode(o),s+=3}else{if(!(n>=240&&n<248))throw new j("utf8-decode-error","UTF-8 Decode failed. Invalid multi byte sequence.");{if(s+3>=r)throw new j("utf8-decode-error","UTF-8 Decode failed. Multi byte character was truncated.");const o=(7&n)<<18|(63&e[t+s+1])<<12|(63&e[t+s+2])<<6|63&e[t+s+3];if(o>=65536){const a=55296+(o-65536>>10),l=56320+(1023&o);i+=String.fromCharCode(a,l)}else i+=String.fromCharCode(o);s+=4}}}return i}function eLe(e,t){const r={byteOffset:0,byteCount:0,fields:Object.create(null)};let i=0;for(let s=0;s<t.length;s++){const n=t[s],o=n.valueType||n.type,a=J2t[o];r.fields[n.property]=a(e,i),i+=C8[o].BYTES_PER_ELEMENT}return r.byteCount=i,r}function H2t(e,t,r){const i=[];let s,n,o=0;for(n=0;n<e;n+=1){if(s=t[n],s>0){if(i.push(j2t(r,o,s-1)),r[o+s-1]!==0)throw new j("string-array-error","Invalid string array: missing null termination.")}else i.push(null);o+=s}return i}function Nge(e,t){return new C8[t.valueType](e,t.byteOffset,t.count*t.valuesPerElement)}function q2t(e,t){return new Uint8Array(e,t.byteOffset,t.byteCount)}function W2t(e,t,r){const i=t.header!=null?eLe(e,t.header):{byteOffset:0,byteCount:0,fields:{count:r}},s={header:i,byteOffset:i.byteCount,byteCount:0,entries:Object.create(null)};let n=i.byteCount;for(let o=0;o<t.ordering.length;o++){const a=t.ordering[o],l=re(t[a]);if(l.count=i.fields.count,l.valueType==="String"){if(l.byteOffset=n,l.byteCount=i.fields[a+"ByteCount"],l.encoding!=="UTF-8")throw new j("unsupported-encoding","Unsupported String encoding.",{encoding:l.encoding})}else{if(!rLe(l.valueType))throw new j("unsupported-value-type","Unsupported binary valueType",{valueType:l.valueType});{const c=bk(l.valueType);n+=n%c!=0?c-n%c:0,l.byteOffset=n,l.byteCount=c*l.valuesPerElement*l.count}}n+=l.byteCount,s.entries[a]=l}return s.byteCount=n-s.byteOffset,s}function tLe(e,t,r){if(t!==e&&sJ.error(`Invalid ${r} buffer size
 expected: ${e}, actual: ${t})`),t<e)throw new j("buffer-too-small","Binary buffer is too small",{expectedSize:e,actualSize:t})}function X2t(e){return{isDraco:!1,isLegacy:!1,color:e.color!=null,normal:e.normal!=null,uv0:e.uv0!=null,uvRegion:e.uvRegion!=null,featureIndex:e.faceRange!=null&&e.featureId!=null}}function kDt(e,t){const r=eLe(e,t&&t.header);let i=r.byteCount;const s={isDraco:!1,header:r,byteOffset:r.byteCount,byteCount:0,vertexAttributes:{}},n=r.fields,o=n.vertexCount!=null?n.vertexCount:n.count;for(const c of t.ordering){if(!t.vertexAttributes[c])continue;const h={...t.vertexAttributes[c],byteOffset:i,count:o},p=Fge[c]?Fge[c]:"_"+c;s.vertexAttributes[p]=h,i+=bk(h.valueType)*h.valuesPerElement*o}const a=n.faceCount;if(t.faces&&a){s.faces={};for(const c of t.ordering){if(!t.faces[c])continue;const h={...t.faces[c],byteOffset:i,count:a};s.faces[c]=h,i+=bk(h.valueType)*h.valuesPerElement*a}}const l=n.featureCount;if(t.featureAttributes&&t.featureAttributeOrder&&l){s.featureAttributes={};for(const c of t.featureAttributeOrder){if(!t.featureAttributes[c])continue;const h={...t.featureAttributes[c],byteOffset:i,count:l};s.featureAttributes[c]=h,i+=(h.valueType==="UInt64"?8:bk(h.valueType))*h.valuesPerElement*l}}return tLe(i,e.byteLength,"geometry"),s.byteCount=i-s.byteOffset,s}function UDt(e,t){return!e||!e.compressedAttributes||e.compressedAttributes.encoding!=="draco"?e?X2t(e):Z2t(t):Y2t(e.compressedAttributes.attributes)}function Z2t(e){const t={isDraco:!1,isLegacy:!0,color:!1,normal:!1,uv0:!1,uvRegion:!1,featureIndex:!1};for(const r of e.ordering)if(e.vertexAttributes[r])switch(r){case"position":break;case"normal":t.normal=!0;break;case"color":t.color=!0;break;case"uv0":t.uv0=!0;break;case"region":t.uvRegion=!0}return e.featureAttributes&&e.featureAttributeOrder&&(t.featureIndex=!0),t}function Y2t(e){const t={isDraco:!0,isLegacy:!1,color:!1,normal:!1,uv0:!1,uvRegion:!1,featureIndex:!1};for(const r of e)switch(r){case"position":break;case"normal":t.normal=!0;break;case"uv0":t.uv0=!0;break;case"color":t.color=!0;break;case"uv-region":t.uvRegion=!0;break;case"feature-index":t.featureIndex=!0}return t}const Fge={position:O.POSITION,normal:O.NORMAL,color:O.COLOR,uv0:O.UV0,region:O.UVREGION};function Q2t(e,t,r){if(e.encoding==="lepcc-rgb")return z2t(t);if(e.encoding==="lepcc-intensity")return G2t(t);if(e.encoding!=null&&e.encoding!=="")throw new j("unknown-attribute-storage-info-encoding","Unknown Attribute Storage Info Encoding");e["attributeByteCounts "]&&!e.attributeByteCounts&&(sJ.warn("Warning: Trailing space in 'attributeByteCounts '."),e.attributeByteCounts=e["attributeByteCounts "]),e.ordering[0]==="ObjectIds"&&e.hasOwnProperty("objectIds")&&(sJ.warn("Warning: Case error in objectIds"),e.ordering[0]="objectIds");const i=W2t(t,e,r);tLe(i.byteOffset+i.byteCount,t.byteLength,"attribute");const s=i.entries.attributeValues||i.entries.objectIds;if(s){if(s.valueType==="String"){const n=i.entries.attributeByteCounts,o=Nge(t,n),a=q2t(t,s);return H2t(n.count,o,a)}return Nge(t,s)}throw new j("bad-attribute-storage-info","Bad attributeStorageInfo specification.")}const C8={Float32:Float32Array,Float64:Float64Array,UInt8:Uint8Array,Int8:Int8Array,UInt16:Uint16Array,Int16:Int16Array,UInt32:Uint32Array,Int32:Int32Array},J2t={Float32:(e,t)=>new DataView(e,0).getFloat32(t,!0),Float64:(e,t)=>new DataView(e,0).getFloat64(t,!0),UInt8:(e,t)=>new DataView(e,0).getUint8(t),Int8:(e,t)=>new DataView(e,0).getInt8(t),UInt16:(e,t)=>new DataView(e,0).getUint16(t,!0),Int16:(e,t)=>new DataView(e,0).getInt16(t,!0),UInt32:(e,t)=>new DataView(e,0).getUint32(t,!0),Int32:(e,t)=>new DataView(e,0).getInt32(t,!0)};function rLe(e){return C8.hasOwnProperty(e)}function bk(e){return rLe(e)?C8[e].BYTES_PER_ELEMENT:0}function K2t(e,t,r,i){const s=eEt(e,t,r),n=Ce();return bh(r,s,n,i),n}const iLe=1,kge=5-iLe;function eEt(e,t,r){const i=M(),s=e[3],n=2**(Math.ceil(Math.log(s)*Math.LOG2E/kge)*kge+iLe);if(r.isGeographic){const l=n/Ar(r).radius*180/Math.PI,c=Math.round(e[1]/l),h=Math.max(-90,Math.min(90,c*l)),p=l/Math.cos((Math.abs(h)-l/2)/180*Math.PI),f=Math.round(e[0]/p)*p;i[0]=f,i[1]=h}else{const l=Math.round(e[0]/n),c=Math.round(e[1]/n);i[0]=l*n,i[1]=c*n}const o=e[2]+t,a=Math.round(o/n);return i[2]=a*n,i}const YA=1e-6,qO=[0,0,0],XF=[0,0,0];function tEt(e,t){const{data:r,size:i}=e,s=r.length/i;if(s<=0)return;const n=new uEt(e);wk(qO,n.minProj,n.maxProj),lx(qO,qO,.5),wd(XF,n.maxProj,n.minProj);const o=nJ(XF),a=new hEt;a.quality=o,s<14&&(e={data:new Float64Array(n.buffer,112,42),size:3});const l=[0,0,0],c=[0,0,0],h=[0,0,0],p=[0,0,0],f=[0,0,0],m=[0,0,0],g=[0,0,0];switch(rEt(n,e,g,l,c,h,p,f,m,a)){case 1:return void Bge(qO,XF,t);case 2:return void cEt(e,p,t)}iEt(e,g,l,c,h,p,f,m,a),sLe(e,a.b0,a.b1,a.b2,CC,AC);const v=[0,0,0];wd(v,AC,CC),a.quality=nJ(v),a.quality<o?nLe(a.b0,a.b1,a.b2,CC,AC,v,t):Bge(qO,XF,t)}function rEt(e,t,r,i,s,n,o,a,l,c){return sEt(e,i,s),oJ(i,s)<YA?1:(wd(o,i,s),Zo(o,o),nEt(t,i,o,n)<YA?2:(wd(a,s,n),Zo(a,a),wd(l,n,i),Zo(l,l),xd(r,a,o),Zo(r,r),Fw(t,r,o,a,l,c),0))}const WO=[0,0,0],XO=[0,0,0],Uh=[0,0,0],Vh=[0,0,0],zh=[0,0,0],gv=[0,0,0],yv=[0,0,0],vv=[0,0,0];function iEt(e,t,r,i,s,n,o,a,l){oEt(e,t,r,WO,XO),WO[0]!==void 0&&(wd(Uh,WO,r),Zo(Uh,Uh),wd(Vh,WO,i),Zo(Vh,Vh),wd(zh,WO,s),Zo(zh,zh),xd(gv,Vh,n),Zo(gv,gv),xd(yv,zh,o),Zo(yv,yv),xd(vv,Uh,a),Zo(vv,vv),Fw(e,gv,n,Vh,Uh,l),Fw(e,yv,o,zh,Vh,l),Fw(e,vv,a,Uh,zh,l)),XO[0]!==void 0&&(wd(Uh,XO,r),Zo(Uh,Uh),wd(Vh,XO,i),Zo(Vh,Vh),wd(zh,XO,s),Zo(zh,zh),xd(gv,Vh,n),Zo(gv,gv),xd(yv,zh,o),Zo(yv,yv),xd(vv,Uh,a),Zo(vv,vv),Fw(e,gv,n,Vh,Uh,l),Fw(e,yv,o,zh,Vh,l),Fw(e,vv,a,Uh,zh,l))}function sEt(e,t,r){let i=oJ(e.maxVert[0],e.minVert[0]),s=0;for(let n=1;n<7;++n){const o=oJ(e.maxVert[n],e.minVert[n]);o>i&&(i=o,s=n)}Zc(t,e.minVert[s]),Zc(r,e.maxVert[s])}const Bh=[0,0,0];function nEt(e,t,r,i){const{data:s,size:n}=e;let o=Number.NEGATIVE_INFINITY,a=0;for(let l=0;l<s.length;l+=n){Bh[0]=s[l]-t[0],Bh[1]=s[l+1]-t[1],Bh[2]=s[l+2]-t[2];const c=r[0]*Bh[0]+r[1]*Bh[1]+r[2]*Bh[2],h=r[0]*r[0]+r[1]*r[1]+r[2]*r[2],p=Bh[0]*Bh[0]+Bh[1]*Bh[1]+Bh[2]*Bh[2]-c*c/h;p>o&&(o=p,a=l)}return Zc(i,s,a),o}const In=[0,0];function oEt(e,t,r,i,s){lEt(e,t,In,s,i);const n=aLe(r,t);In[1]-YA<=n&&(i[0]=void 0),In[0]+YA>=n&&(s[0]=void 0)}const Uge=[0,0,0],Vge=[0,0,0],zge=[0,0,0],t2=[0,0,0],r2=[0,0,0],ZF=[0,0,0];function Fw(e,t,r,i,s,n){if(oLe(t)<YA)return;xd(Uge,r,t),xd(Vge,i,t),xd(zge,s,t),EC(e,t,In),r2[1]=In[0],t2[1]=In[1],ZF[1]=t2[1]-r2[1];const o=[r,i,s],a=[Uge,Vge,zge];for(let l=0;l<3;++l){EC(e,o[l],In),r2[0]=In[0],t2[0]=In[1],EC(e,a[l],In),r2[2]=In[0],t2[2]=In[1],ZF[0]=t2[0]-r2[0],ZF[2]=t2[2]-r2[2];const c=nJ(ZF);c<n.quality&&(Zc(n.b0,o[l]),Zc(n.b1,t),Zc(n.b2,a[l]),n.quality=c)}}const aEt=[0,0,0];function EC(e,t,r){const{data:i,size:s}=e;r[0]=Number.POSITIVE_INFINITY,r[1]=Number.NEGATIVE_INFINITY;for(let n=0;n<i.length;n+=s){const o=i[n]*t[0]+i[n+1]*t[1]+i[n+2]*t[2];r[0]=Math.min(r[0],o),r[1]=Math.max(r[1],o)}}function lEt(e,t,r,i,s){const{data:n,size:o}=e;Zc(i,n),Zc(s,i),r[0]=aLe(aEt,t),r[1]=r[0];for(let a=o;a<n.length;a+=o){const l=n[a]*t[0]+n[a+1]*t[1]+n[a+2]*t[2];l<r[0]&&(r[0]=l,Zc(i,n,a)),l>r[1]&&(r[1]=l,Zc(s,n,a))}}function Bge(e,t,r){Zc(r.center,e),lx(r.halfSize,t,.5),r.quaternion[0]=0,r.quaternion[1]=0,r.quaternion[2]=0,r.quaternion[3]=1}const zg=[0,0,0],i2=[0,0,0],ZO=[0,0,0],CC=[0,0,0],AC=[0,0,0],Gge=[0,0,0];function cEt(e,t,r){Zc(zg,t),Math.abs(t[0])>Math.abs(t[1])&&Math.abs(t[0])>Math.abs(t[2])?zg[0]=0:Math.abs(t[1])>Math.abs(t[2])?zg[1]=0:zg[2]=0,oLe(zg)<YA&&(zg[0]=zg[1]=zg[2]=1),xd(i2,t,zg),Zo(i2,i2),xd(ZO,t,i2),Zo(ZO,ZO),sLe(e,t,i2,ZO,CC,AC),wd(Gge,AC,CC),nLe(t,i2,ZO,CC,AC,Gge,r)}function sLe(e,t,r,i,s,n){EC(e,t,In),s[0]=In[0],n[0]=In[1],EC(e,r,In),s[1]=In[0],n[1]=In[1],EC(e,i,In),s[2]=In[0],n[2]=In[1]}const YF=[0,0,0],Wf=[1,0,0,0,1,0,0,0,1],s2=[0,0,0];function nLe(e,t,r,i,s,n,o){Wf[0]=e[0],Wf[1]=e[1],Wf[2]=e[2],Wf[3]=t[0],Wf[4]=t[1],Wf[5]=t[2],Wf[6]=r[0],Wf[7]=r[1],Wf[8]=r[2],dEt(o.quaternion,Wf),wk(s2,i,s),lx(s2,s2,.5),lx(o.center,e,s2[0]),lx(YF,t,s2[1]),wk(o.center,o.center,YF),lx(YF,r,s2[2]),wk(o.center,o.center,YF),lx(o.halfSize,n,.5)}const wu=7;class uEt{constructor(t){this.minVert=new Array(wu),this.maxVert=new Array(wu);const r=64*wu;this.buffer=new ArrayBuffer(r);let i=0;this.minProj=new Float64Array(this.buffer,i,wu),i+=8*wu,this.maxProj=new Float64Array(this.buffer,i,wu),i+=8*wu;for(let l=0;l<wu;++l)this.minVert[l]=new Float64Array(this.buffer,i,3),i+=24;for(let l=0;l<wu;++l)this.maxVert[l]=new Float64Array(this.buffer,i,3),i+=24;for(let l=0;l<wu;++l)this.minProj[l]=Number.POSITIVE_INFINITY,this.maxProj[l]=Number.NEGATIVE_INFINITY;const s=new Array(wu),n=new Array(wu),{data:o,size:a}=t;for(let l=0;l<o.length;l+=a){let c=o[l];c<this.minProj[0]&&(this.minProj[0]=c,s[0]=l),c>this.maxProj[0]&&(this.maxProj[0]=c,n[0]=l),c=o[l+1],c<this.minProj[1]&&(this.minProj[1]=c,s[1]=l),c>this.maxProj[1]&&(this.maxProj[1]=c,n[1]=l),c=o[l+2],c<this.minProj[2]&&(this.minProj[2]=c,s[2]=l),c>this.maxProj[2]&&(this.maxProj[2]=c,n[2]=l),c=o[l]+o[l+1]+o[l+2],c<this.minProj[3]&&(this.minProj[3]=c,s[3]=l),c>this.maxProj[3]&&(this.maxProj[3]=c,n[3]=l),c=o[l]+o[l+1]-o[l+2],c<this.minProj[4]&&(this.minProj[4]=c,s[4]=l),c>this.maxProj[4]&&(this.maxProj[4]=c,n[4]=l),c=o[l]-o[l+1]+o[l+2],c<this.minProj[5]&&(this.minProj[5]=c,s[5]=l),c>this.maxProj[5]&&(this.maxProj[5]=c,n[5]=l),c=o[l]-o[l+1]-o[l+2],c<this.minProj[6]&&(this.minProj[6]=c,s[6]=l),c>this.maxProj[6]&&(this.maxProj[6]=c,n[6]=l)}for(let l=0;l<wu;++l){let c=s[l];Zc(this.minVert[l],o,c),c=n[l],Zc(this.maxVert[l],o,c)}}}class hEt{constructor(){this.b0=[1,0,0],this.b1=[0,1,0],this.b2=[0,0,1],this.quality=0}}function nJ(e){return e[0]*e[1]+e[0]*e[2]+e[1]*e[2]}function wk(e,t,r){e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2]}function wd(e,t,r){e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2]}function lx(e,t,r){e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r}function Zc(e,t,r=0){e[0]=t[r+0],e[1]=t[r+1],e[2]=t[r+2]}function xd(e,t,r){const i=t[0],s=t[1],n=t[2],o=r[0],a=r[1],l=r[2];e[0]=s*l-n*a,e[1]=n*o-i*l,e[2]=i*a-s*o}function Zo(e,t){const r=t[0]*t[0]+t[1]*t[1]+t[2]*t[2];if(r>0){const i=1/Math.sqrt(r);e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i}}function oLe(e){return e[0]*e[0]+e[1]*e[1]+e[2]*e[2]}function oJ(e,t){const r=t[0]-e[0],i=t[1]-e[1],s=t[2]-e[2];return r*r+i*i+s*s}function aLe(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function dEt(e,t){const r=t[0]+t[4]+t[8];if(r>0){let i=Math.sqrt(r+1);e[3]=.5*i,i=.5/i,e[0]=(t[5]-t[7])*i,e[1]=(t[6]-t[2])*i,e[2]=(t[1]-t[3])*i}else{let i=0;t[4]>t[0]&&(i=1),t[8]>t[3*i+i]&&(i=2);const s=(i+1)%3,n=(i+2)%3;let o=Math.sqrt(t[3*i+i]-t[3*s+s]-t[3*n+n]+1);e[i]=.5*o,o=.5/o,e[3]=(t[3*s+n]-t[3*n+s])*o,e[s]=(t[3*s+i]+t[3*i+s])*o,e[n]=(t[3*n+i]+t[3*i+n])*o}}const OP=A0(),Mx=M(),pEt=M(),fEt=$i();class VDt{constructor(t){const o=t*56;this.buffer=new ArrayBuffer(o),this.obbs=new Array(t);for(let a=0;a<t;a++)this.obbs[a]={center:dee(this.buffer,56*a+0),halfSize:hOe(this.buffer,56*a+24),quaternion:K$e(this.buffer,56*a+36)}}}function cne(e=[0,0,0],t=[-1,-1,-1],r=[0,0,0,1]){return{center:Qs(e),halfSize:CV(t),quaternion:J$e(r)}}function jge(e){return cne(e.center,e.halfSize,e.quaternion)}function zDt(e,t){ae(t.center,e.center),ae(t.halfSize,e.halfSize),gL(t.quaternion,e.quaternion)}function lLe(e,t){return t=t||cne(),tEt(e,t),t}function kw(e,t){const r=ui(t,e.center),i=A8(e,t);return r>i?1:r<-i?-1:0}function BDt(e,t){t||(t=tn());const r=gB(fEt,e.quaternion),i=e.halfSize[0]*Math.abs(r[0])+e.halfSize[1]*Math.abs(r[3])+e.halfSize[2]*Math.abs(r[6]),s=e.halfSize[0]*Math.abs(r[1])+e.halfSize[1]*Math.abs(r[4])+e.halfSize[2]*Math.abs(r[7]),n=e.halfSize[0]*Math.abs(r[2])+e.halfSize[1]*Math.abs(r[5])+e.halfSize[2]*Math.abs(r[8]);return t[0]=e.center[0]-i,t[1]=e.center[1]-s,t[2]=e.center[2]-n,t[3]=e.center[0]+i,t[4]=e.center[1]+s,t[5]=e.center[2]+n,t}function GDt(e,t){return ui(t,e.center)-A8(e,t)}function jDt(e,t){return ui(t,e.center)+A8(e,t)}function HDt(e,t){return kw(e,t[0])<=0&&kw(e,t[1])<=0&&kw(e,t[2])<=0&&kw(e,t[3])<=0&&kw(e,t[4])<=0&&kw(e,t[5])<=0}function qDt(e,t,r,i=0){_0(OP,e.quaternion),pe(Mx,t,e.center);const s=ch(Mx,Mx,OP),n=ch(pEt,r,OP);let o=-1/0,a=1/0;for(let l=0;l<3;l++)if(Math.abs(n[l])>1e-6){const c=(i+e.halfSize[l]-s[l])/n[l],h=(-i-e.halfSize[l]-s[l])/n[l];o=Math.max(o,Math.min(c,h)),a=Math.min(a,Math.max(c,h))}else if(s[l]>e.halfSize[l]+i||s[l]<-e.halfSize[l]-i)return!1;return o<=a}(()=>{const e=new Int8Array(162);let t=0;const r=i=>{for(let s=0;s<i.length;s++)e[t+s]=i[s];t+=6};return r([6,2,3,1,5,4]),r([0,2,3,1,5,4]),r([0,2,3,7,5,4]),r([0,1,3,2,6,4]),r([0,1,3,2,0,0]),r([0,1,5,7,3,2]),r([0,1,3,7,6,4]),r([0,1,3,7,6,2]),r([0,1,5,7,6,2]),r([0,1,5,4,6,2]),r([0,1,5,4,0,0]),r([0,1,3,7,5,4]),r([0,2,6,4,0,0]),r([0,0,0,0,0,0]),r([1,3,7,5,0,0]),r([2,3,7,6,4,0]),r([2,3,7,6,0,0]),r([2,3,1,5,7,6]),r([0,1,5,7,6,2]),r([0,1,5,7,6,4]),r([0,1,3,7,6,4]),r([4,5,7,6,2,0]),r([4,5,7,6,0,0]),r([4,5,1,3,7,6]),r([0,2,3,7,5,4]),r([6,2,3,7,5,4]),r([6,2,3,1,5,4]),e})();function A8(e,t){_0(OP,e.quaternion),ch(Mx,t,OP);const r=e.halfSize;return Math.abs(Mx[0]*r[0])+Math.abs(Mx[1]*r[1])+Math.abs(Mx[2]*r[2])}function cLe(e,t){for(let r=0;r<8;++r){const i=t[r];i[0]=1&r?-e.halfSize[0]:e.halfSize[0],i[1]=2&r?-e.halfSize[1]:e.halfSize[1],i[2]=4&r?-e.halfSize[2]:e.halfSize[2],ch(i,i,e.quaternion),de(i,i,e.center)}}function mEt(e){return gee(e.halfSize)}function uLe(e){return e&&parseInt(e.substring(e.lastIndexOf("/")+1,e.length),10)}function WDt(e){var t;if(he("disable-feature:i3s-draco")||!e)return!1;for(const r of e)for(const i of r.geometryBuffers)if(((t=i.compressedAttributes)==null?void 0:t.encoding)==="draco")return!0;return!1}function XDt(e,t,r,i,s,n){const o=t!==i;s.traverse(r,a=>{let l=a.mbs;return o&&(l=gEt,U9e(a.mbs,i,l,t)),yEt(e,l)!==Px.OUTSIDE&&(n(a),!0)})}function ZDt(e,t,r){let i=0,s=0;for(let n=0;n<t.length&&i<e.length;n++)e[i]===t[n]&&(r(n)&&(e[s]=e[i],s++),i++);e.length=s}function YDt(e,t,r){let i=0,s=0;for(;i<r.length;)j_e(e,r[i])>=0===t&&(r[s]=r[i],s++),i++;r.length=s}const YO=Ut();function QDt(e,t){if(t.rotationScale[1]===0&&t.rotationScale[2]===0&&t.rotationScale[3]===0&&t.rotationScale[5]===0&&t.rotationScale[6]===0&&t.rotationScale[7]===0)return YO[0]=(e[0]-t.position[0])/t.rotationScale[0],YO[1]=(e[1]-t.position[1])/t.rotationScale[4],YO[2]=(e[2]-t.position[0])/t.rotationScale[0],YO[3]=(e[3]-t.position[1])/t.rotationScale[4],YO}const gEt=Zt();var Px;function yEt(e,t){const r=t[0],i=t[1],s=t[3],n=e[0]-r,o=r-e[2],a=e[1]-i,l=i-e[3],c=Math.max(n,o,0),h=Math.max(a,l,0),p=c*c+h*h;return p>s*s?Px.OUTSIDE:p>0?Px.INTERSECTS_CENTER_OUTSIDE:-Math.max(n,o,a,l)>s?Px.INSIDE:Px.INTERSECTS_CENTER_INSIDE}function vEt(e,t,r){const i=[],s=r&&r.missingFields,n=r&&r.originalFields;for(const o of e){const a=o.toLowerCase();let l=!1;for(const c of t)if(a===c.name.toLowerCase()){i.push(c.name),l=!0,n&&n.push(o);break}!l&&s&&s.push(o)}return i}async function JDt(e,t,r,i,s){if(t.length===0)return[];const n=e.attributeStorageInfo;if(b(e.associatedLayer))try{return await bEt(e.associatedLayer,t,r,i)}catch(o){if(e.associatedLayer.loaded)throw o}if(n){const o=_Et(t,r,s);if(R(o))throw new j("scenelayer:features-not-loaded","Tried to query attributes for unloaded features");const a=e.parsedUrl.path,l=await Promise.all(o.map(c=>wEt(a,n,c.node,c.indices,i).then(h=>{for(let p=0;p<c.graphics.length;p++){const f=c.graphics[p],m=h[p];if(f.attributes)for(const g in f.attributes)g in m||(m[g]=f.attributes[g]);f.attributes=m}return c.graphics})));return H_e(l)}throw new j("scenelayer:no-attribute-source","This scene layer does not have a source for attributes available")}function _Et(e,t,r){const i=new Map,s=[],n=r();for(const o of e){const a=o.attributes[t];for(let l=0;l<n.length;l++){const c=n[l],h=c.featureIds.indexOf(a);if(h>=0){let p=i.get(c.node);p||(p={node:c.node,indices:[],graphics:[]},s.push(p),i.set(c.node,p)),p.indices.push(h),p.graphics.push(o);for(let f=l;f>0;f--)n[f]=n[f-1];n[0]=c;break}}}return s}async function bEt(e,t,r,i){t.sort((l,c)=>l.attributes[r]-c.attributes[r]);const s=t.map(l=>l.attributes[r]),n=[],o=vEt(i,e.fields,{originalFields:n}),a=await hLe(e,s,o);for(let l=0;l<t.length;l++){const c=t[l],h=a[l],p={};if(c.attributes)for(const f in c.attributes)p[f]=c.attributes[f];for(let f=0;f<n.length;f++)p[n[f]]=h[o[f]];c.attributes=p}return t}function hLe(e,t,r){const i=e.capabilities.query.maxRecordCount;if(i!=null&&t.length>i){const n=B4e(t,i);return Promise.all(n.map(o=>hLe(e,o,r))).then(H_e)}const s=new Sa({objectIds:t,outFields:r,orderByFields:[e.objectIdField]});return e.queryFeatures(s).then(n=>{if(n&&n.features&&n.features.length===t.length)return n.features.map(o=>o.attributes);throw new j("scenelayer:feature-not-in-associated-layer","Feature not found in associated feature layer")})}function wEt(e,t,r,i,s){const n=[];for(const o of t)if(o&&s.includes(o.name)){const a=`${e}/nodes/${r.resources.attributes}/attributes/${o.key}/0`;n.push({url:a,storageInfo:o})}return xs(n.map(o=>er(o.url,{responseType:"array-buffer"}).then(a=>Q2t(o.storageInfo,a.data)))).then(o=>{const a=[];for(const l of i){const c={};for(let h=0;h<o.length;h++)o[h].value!=null&&(c[n[h].storageInfo.name]=SEt(o[h].value,l));a.push(c)}return a})}(function(e){e[e.OUTSIDE=0]="OUTSIDE",e[e.INTERSECTS_CENTER_OUTSIDE=1]="INTERSECTS_CENTER_OUTSIDE",e[e.INTERSECTS_CENTER_INSIDE=2]="INTERSECTS_CENTER_INSIDE",e[e.INSIDE=3]="INSIDE"})(Px||(Px={}));const xEt=-32768,TEt=-(2**31);function SEt(e,t){if(!e)return null;const r=e[t];return Z_e(e)?r===xEt?null:r:Y_e(e)?r===TEt?null:r:r!=r?null:r}function EEt(e){const t=e.store.indexCRS||e.store.geographicCRS,r=t===void 0?e.store.indexWKT:void 0;if(r){if(!e.spatialReference)throw new j("layerview:no-store-spatial-reference-wkt-index-and-no-layer-spatial-reference","Found indeWKT in the scene layer store but no layer spatial reference",{});if(r!==e.spatialReference.wkt)throw new j("layerview:store-spatial-reference-wkt-index-incompatible","The indeWKT of the scene layer store does not match the WKT of the layer spatial reference",{})}const i=t?new Ze(uLe(t)):e.spatialReference;return i.equals(e.spatialReference)?e.spatialReference:i}function CEt(e){const t=e.store.vertexCRS||e.store.projectedCRS,r=t===void 0?e.store.vertexWKT:void 0;if(r){if(!e.spatialReference)throw new j("layerview:no-store-spatial-reference-wkt-vertex-and-no-layer-spatial-reference","Found vertexWKT in the scene layer store but no layer spatial reference",{});if(r!==e.spatialReference.wkt)throw new j("layerview:store-spatial-reference-wkt-vertex-incompatible","The vertexWKT of the scene layer store does not match the WKT of the layer spatial reference",{})}const i=t?new Ze(uLe(t)):e.spatialReference;return i.equals(e.spatialReference)?e.spatialReference:i}function KDt(e,t){return R(t)?"@null":t===rg(t)?"@ECEF":e.equals(t)?"":t.wkid!=null?"@"+t.wkid:null}function aJ(e,t,r){if(!sg(e,t))throw new j("layerview:spatial-reference-incompatible","The spatial reference of this scene layer is incompatible with the spatial reference of the view",{});if(r==="local"&&!AEt(e,t))throw new j("layerview:spatial-reference-incompatible","The spatial reference of this scene layer is incompatible with the spatial reference of the view",{})}function AEt(e,t){return e.equals(t)||e.isWGS84&&t.isWebMercator||e.isWebMercator&&t.isWGS84}function REt(e,t,r){const i=EEt(e),s=CEt(e);aJ(i,t,r),aJ(s,t,r)}function OEt(e){return(e.geometryType==null||e.geometryType==="triangles")&&(e.topology==null||e.topology==="PerAttributeArray")&&e.vertexAttributes!=null&&e.vertexAttributes.position!=null}function eNt(e){if(e.store==null||e.store.defaultGeometrySchema==null||!OEt(e.store.defaultGeometrySchema))throw new j("scenelayer:unsupported-geometry-schema","The geometry schema of this scene layer is not supported.",{url:e.parsedUrl.path})}function tNt(e,t){REt(e,t.spatialReference,t.viewingMode)}function MEt(e){return e.geometryType!=null&&e.geometryType==="points"&&(e.topology==null||e.topology==="PerAttributeArray")&&(e.encoding==null||e.encoding===""||e.encoding==="lepcc-xyz")&&e.vertexAttributes!=null&&e.vertexAttributes.position!=null}function rNt(e){if(e.store==null||e.store.defaultGeometrySchema==null||!MEt(e.store.defaultGeometrySchema))throw new j("pointcloud:unsupported-geometry-schema","The geometry schema of this point cloud scene layer is not supported.",{})}function iNt(e,t){aJ(e.spatialReference,t.spatialReference,t.viewingMode)}function PEt(e){return e.type==="simple"||e.type==="class-breaks"||e.type==="unique-value"}function IEt(e){return e.type==="mesh-3d"}function sNt(e){if(e==null||!PEt(e)||(e.type==="unique-value"||e.type==="class-breaks")&&e.defaultSymbol==null)return!0;const t=e.getSymbols();if(t.length===0)return!0;for(const r of t){if(!IEt(r)||r.symbolLayers.length===0)return!0;for(const i of r.symbolLayers.items)if(i.type!=="fill"||R(i.material)||R(i.material.color)||i.material.colorMixMode!=="replace")return!0}return!1}const nNt=lPe({color:[0,0,0,0],opacity:0});class $Et{constructor(){this.edgeMaterial=null,this.material=null,this.castShadows=!0}}function oNt(e){const t=new $Et;let r=!1,i=!1;for(const s of e.symbolLayers.items)if(s.type==="fill"&&s.enabled){const n=s.material,o=s.edges;if(b(n)&&!r){const a=n.color,l=KPe(n.colorMixMode);b(a)?t.material={color:[a.r/255,a.g/255,a.b/255],alpha:a.a,colorMixMode:l}:t.material={color:[1,1,1],alpha:1,colorMixMode:$s.Multiply},t.castShadows=s.castShadows,r=!0}b(o)&&!i&&(t.edgeMaterial=aPe(o,{}),i=!0)}return t.material||(t.material={color:[1,1,1],alpha:1,colorMixMode:$s.Multiply}),t}function aNt(e,t){return(0|e)+(0|t)|0}function LEt(e,t,r,i,s=0){i===rg(i)?t.isGeographic?zEt(e,r,t,s):VEt(e,r,t,s):t.isWGS84&&(i.isWebMercator||nI(i))?NEt(t,e,i,r,s):t.isWebMercator&&nI(i)?UEt(t,e,i,r,s):e===r?(r.center[2]+=s,mi(r.center,t,0,r.center,i,0,1)):(se(r.center,e.center[0],e.center[1],e.center[2]+s),mi(r.center,t,0,r.center,i,0,1),gL(r.quaternion,e.quaternion),ae(r.halfSize,e.halfSize))}function DEt(e,t,r,i,s){if(gL(s.quaternion,e.quaternion),i===Be.Global){_0(QF,e.quaternion),ch(_v,e.center,QF),Qq(n2,_v),Ube(o2,n2,e.halfSize),su(o2,n2,o2);const n=Re(o2);de(o2,n2,e.halfSize);const o=Re(o2);if(n<r)ae(s.center,e.center),se(_v,r,r,r),de(s.halfSize,e.halfSize,_v);else{const a=o>0?1+t/o:1,l=n>0?1+r/n:1,c=(l+a)/2,h=(l-a)/2;le(s.halfSize,n2,h),fx(s.halfSize,s.halfSize,e.halfSize,c),le(s.center,n2,c),fx(s.center,s.center,e.halfSize,h),kbe(_v,_v),Jz(s.center,s.center,_v),ch(s.center,s.center,s.quaternion)}}else{const n=se(_v,0,0,1);fx(s.center,e.center,n,(r+t)/2),_0(QF,e.quaternion),ch(n,n,QF),Qq(n,n),fx(s.halfSize,e.halfSize,n,(r-t)/2)}return s}const _v=M(),n2=M(),o2=M(),QF=A0();function NEt(e,t,r,i,s){ae(M_,t.center),M_[2]+=s;const n=rg(r);mi(M_,e,0,M_,n,0,1),dLe(n,t,M_,r,i)}const xk=new Float64Array(24),FEt={data:xk,size:3},Hge=M(),M_=M(),kEt=$i();function UEt(e,t,r,i,s){ae(M_,t.center),M_[2]+=s,dLe(e,t,M_,r,i)}function dLe(e,t,r,i,s){const n=gB(kEt,t.quaternion);for(let o=0;o<8;++o){for(let a=0;a<3;++a)Hge[a]=t.halfSize[a]*((o&1<<a)!=0?-1:1);for(let a=0;a<3;++a){let l=r[a];for(let c=0;c<3;++c)l+=Hge[c]*n[3*c+a];xk[3*o+a]=l}}mi(xk,e,0,xk,i,0,8),lLe(FEt,s)}function VEt(e,t,r,i){cLe(e,lJ),se(t.center,e.center[0],e.center[1],e.center[2]+i),bh(r,t.center,xu,rg(r)),se(t.center,xu[12],xu[13],xu[14]);const s=2*Math.sqrt(1+xu[0]+xu[5]+xu[10]);Sy[0]=(xu[6]-xu[9])/s,Sy[1]=(xu[8]-xu[2])/s,Sy[2]=(xu[1]-xu[4])/s,Sy[3]=.25*s,cie(t.quaternion,Sy,e.quaternion),_0(Sy,t.quaternion);let n=0,o=0,a=0;for(const l of lJ)l[2]+=i,mi(l,r,0,l,rg(r),0,1),su(Sr,l,t.center),ch(Sr,Sr,Sy),n=Math.max(n,Math.abs(Sr[0])),o=Math.max(o,Math.abs(Sr[1])),a=Math.max(a,Math.abs(Sr[2]));se(t.halfSize,n,o,a)}function zEt(e,t,r,i){const s=Ar(r),n=1+Math.max(0,i)/(s.radius+e.center[2]);se(t.center,e.center[0],e.center[1],e.center[2]+i),mi(t.center,r,0,t.center,rg(r),0,1),gL(t.quaternion,e.quaternion),_0(Sy,e.quaternion),se(Sr,0,0,1),ch(Sr,Sr,Sy),se(Sr,e.halfSize[0]*Math.abs(Sr[0]),e.halfSize[1]*Math.abs(Sr[1]),e.halfSize[2]*Math.abs(Sr[2])),le(Sr,Sr,s.inverseFlattening),de(t.halfSize,e.halfSize,Sr),le(t.halfSize,t.halfSize,n)}function lNt(e,t,r,i,s,n){if(!n||n.length===0||R(t))return null;const o=K2t(e.mbs,s,r,t);let a;Cs(KF,o);const l=()=>{if(!a)if(a=lJ,vh(JF),b(e.serviceObb)){LEt(e.serviceObb,r,qge,t,s),cLe(qge,a);for(const m of a)Ve(m,m,KF),cC(JF,m)}else{const m=e.mbs,g=m[3];xn(m,r,Sr,t),Ve(Sr,Sr,KF),Sr[2]+=s;for(let v=0;v<8;++v){const w=1&v?g:-g,_=2&v?g:-g,T=4&v?g:-g,x=a[v];ae(x,[Sr[0]+w,Sr[1]+_,Sr[2]+T]),cC(JF,x)}}};let c=1/0,h=-1/0;const p=m=>{if(m.type!=="replace")return;const g=m.geometry;if(!g.hasZ)return;vh(tH);const v=g.spatialReference||i,w=g.rings.reduce((_,T)=>T.reduce((x,E)=>(xn(E,v,Sr,t),Ve(Sr,Sr,KF),cC(tH,Sr),Math.min(Sr[2],x)),_),1/0);l(),X$(JF,tH)&&(c=Math.min(c,w),h=Math.max(h,w))};if(n.forEach(m=>p(m)),c===1/0)return null;const f=(m,g,v)=>{Ve(Sr,v,o),m[g+0]=Sr[0],m[g+1]=Sr[1],m[g+2]=Sr[2],g+=24,v[2]=c,Ve(Sr,v,o),m[g+0]=Sr[0],m[g+1]=Sr[1],m[g+2]=Sr[2],g+=24,v[2]=h,Ve(Sr,v,o),m[g+0]=Sr[0],m[g+1]=Sr[1],m[g+2]=Sr[2]};for(let m=0;m<8;++m)f(Wge.data,3*m,a[m]);return lLe(Wge)}function cNt(e){return b(e)&&e.halfSize[0]>=0}function uNt(e){return e[3]>=0}function hNt(e){b(e)&&(e.halfSize[0]=-1)}function dNt(e){b(e)&&(e[3]=-1)}const xu=Ce(),Sy=Q$e(),lJ=[[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0]],tH=Ut(),JF=Ut(),qge=cne(),Sr=[0,0,0],Wge={data:new Array(72),size:3},KF=Ce();class BEt{constructor(t){this._totalCount=t,this._indexRanges=[0,t]}allVisible(){return this.componentCount()===this._totalCount}allInvisible(){return this._indexRanges.length===0}componentCount(){const t=this._indexRanges;let r=0;for(let i=0;i<t.length;i+=2)r+=t[i+1];return r}reset(t){t==="all"||t.length===this._totalCount?this._indexRanges=[0,this._totalCount]:this._indexRanges=GEt(t)}forEachComponent(t){const r=this._indexRanges;for(let i=0;i<r.length;i+=2){const s=r[i],n=s+r[i+1];for(let o=s;o<n;o++)if(!t(o))return!1}return!0}forEachComponentRange(t){const r=this._indexRanges;for(let i=0;i<r.length;i+=2){const s=r[i];if(!t(s,s+r[i+1]))return!1}return!0}computeOffsetRanges(t){const r=new Array(this._indexRanges.length),i=this._indexRanges;for(let s=0;s<i.length;s+=2){const n=i[s],o=n+i[s+1],a=t[n],l=t[o];r[s]=a,r[s+1]=l-a}return r}}function GEt(e){const t=new Array;if(e.length===0)return t;let r=e[0],i=1;for(let s=1;s<e.length;s++){const n=e[s];r+i===n?i+=1:(t.push(r),t.push(i),r=n,i=1)}return t.push(r),t.push(i),t}class jEt extends HB{constructor(t,r){super(),this.pickability=null,this.highlightCounts=null,this.verticalOffsets=null,this.cachedGeometryRanges=null,this.cachedHighlightRanges=null,this.cachedDefaultRanges=null,this.offsets=PK(r);const i=this.count;this.visibility=new BEt(i),this.materialDataBuffer=t.getBuffer(i),this.materialDataIndices=new Uint16Array(i);for(let s=0;s<i;s++)this.materialDataIndices[s]=this.materialDataBuffer.acquireIndex()}dispose(){super.dispose();for(let t=0;t<this.count;t++)this.materialDataBuffer.releaseIndex(this.materialDataIndices[t])}get count(){return this.offsets.length-1}get geometryRanges(){return R(this.cachedGeometryRanges)&&(this.cachedGeometryRanges=this.visibility.computeOffsetRanges(this.offsets)),this.cachedGeometryRanges}get highlightRanges(){return R(this.highlightCounts)?null:(this._updateCachedHighlightRanges(),this.cachedHighlightRanges)}get defaultShadowMapRanges(){return R(this.highlightCounts)?this.geometryRanges:(this._updateCachedHighlightRanges(),this.cachedDefaultRanges)}highlightsDirty(){this.cachedHighlightRanges=null,this.cachedDefaultRanges=null}visibilityDirty(){this.cachedGeometryRanges=null,this.highlightsDirty()}_updateCachedHighlightRanges(){if((R(this.cachedHighlightRanges)||R(this.cachedDefaultRanges))&&b(this.highlightCounts)){const{highlightRanges:t,defaultRanges:r}=HEt(this.highlightCounts,this.visibility,this.offsets);this.cachedHighlightRanges=t,this.cachedDefaultRanges=r}}}function HEt(e,t,r){const i=[],s=[];let n=r.length,o=r.length;return t.forEachComponent(a=>(e[a]>0?(n!==a-1&&(i.length&&i.push(r[n+1]-i[i.length-1]),i.push(r[a])),n=a):(o!==a-1&&(s.length&&s.push(r[o+1]-s[s.length-1]),s.push(r[a])),o=a),!0)),i.length&&i.push(r[n+1]-i[i.length-1]),s.length&&s.push(r[o+1]-s[s.length-1]),{highlightRanges:i,defaultRanges:s}}class cJ extends HB{constructor(){super(...arguments),this.visible=RC.Hidden}}var RC;u([Xo()],cJ.prototype,"renderable",void 0),u([Xo()],cJ.prototype,"components",void 0),function(e){e[e.Hidden=0]="Hidden",e[e.Visible=1]="Visible"}(RC||(RC={}));function qEt(e,t,r,i){if(r>=t)return e;e==null&&(e=WEt());const s=e.isVisibleBit;let n=e.data;const o=fLe(n),a=r/o|0,l=r-o*a,c=(t-1)/o|0,h=n,p=i===s;if(!(r<h.length*o)&&p){const m=a+1,g=Math.ceil(h.length*1.5),v=c+1;let w=Math.max(m,g);w=Math.min(w,v),n=new Uint32Array(w),n.set(h)}return a<n.length&&(n[a]=ZEt(n[a],l,p)),e.data=n,e}function pLe(e,t){if(e==null)return!0;const{isVisibleBit:r,data:i}=e,s=fLe(i);return t<i.length*s?XEt(r,i,t,s):!e.isVisibleBit}function WEt(e=!0){return{isVisibleBit:!e,data:new Uint32Array(0)}}function XEt(e,t,r,i){const s=r/i|0,n=r-s*i;return YEt(t[s],n)===e}function fLe(e){return e.BYTES_PER_ELEMENT*8}function ZEt(e,t,r){return e&~(1<<t)|(r?1:0)<<t}function YEt(e,t){return(e&1<<t)!=0}class QEt{constructor(t,r){this._indices=b(t.indices)?t.indices:DA(t.positions.length/3),this._positions=new Zr(t.positions),this._components=r,this._componentIntersectionData=new Array(r.count)}getComponentAabb(t,r){if(b(this._perComponentAabbs)){for(let i=0;i<6;i++)r[i]=this._perComponentAabbs[6*t+i];return r}return this._computePerComponentAabbs(),this.getComponentAabb(t,r)}getComponentPositions(t,r){r.indices=this._indices,r.data=this._positions.typedBuffer,r.stride=this._positions.typedBufferStride,r.startIndex=this._components.offsets[t],r.endIndex=this._components.offsets[t+1]}intersect(t,r,i,s,n,o,a){const l={data:this._positions.typedBuffer,stride:this._positions.typedBufferStride,size:3},c=this._indices,h=this._components.offsets,p=h3e(t,r,JEt),f=t[2],m=r[2];this._components.visibility.forEachComponent(g=>{if(!pLe(this._components.pickability,g))return!0;const v=this.getComponentAabb(g,KEt);if(b(o)){const E=o[g];b(n)?n.componentOffset=E:(t[2]=f-E,r[2]=m-E)}if(b(n)&&n.applyToAabb(v),!sse(v,t,p,i))return!0;const w=h[g]/3,_=h[g+1]/3,T=(E,C,A)=>{a(g,E,Hc(C,C,s),A)},x=_-w;return R(n)&&x>q$e?(this._componentIntersectionData[g]==null&&(this._componentIntersectionData[g]=new ZA(this._indices,w,_,l)),this._componentIntersectionData[g].intersectRay({r0:t,r1:r},T)):xL(t,r,w,_,c,l,void 0,n,T),!0})}_computePerComponentAabbs(){const t=this._components.count;this._perComponentAabbs=new Float32Array(6*t);const r=this._indices,i=this._positions.typedBuffer,s=this._positions.typedBufferStride,n=this._components.offsets;let o=0;for(let a=0;a<t;a++){const l=n[a],c=n[a+1];let h=1/0,p=1/0,f=1/0,m=-1/0,g=-1/0,v=-1/0;for(let w=l;w<c;w++){const _=r[w]*s,T=i[_],x=i[_+1],E=i[_+2];h=Math.min(h,T),p=Math.min(p,x),f=Math.min(f,E),m=Math.max(m,T),g=Math.max(g,x),v=Math.max(v,E)}this._perComponentAabbs[o++]=h,this._perComponentAabbs[o++]=p,this._perComponentAabbs[o++]=f,this._perComponentAabbs[o++]=m,this._perComponentAabbs[o++]=g,this._perComponentAabbs[o++]=v}}get positions(){return this._positions}get indices(){return this._indices}}const JEt=M(),KEt=tn();class eCt{constructor(t,r,i){this.material=t,this.geometry=r,this.meta=i}dispose(){this.material.dispose(),this.geometry.dispose()}}class mLe extends HB{constructor(t,r,i,s){super(),this.primitiveType=r,this.parameters=i,this.indexed=s,this.vao=t}}u([Xo()],mLe.prototype,"vao",void 0);function tCt(e,t){return{near:e,far:t}}function FL(e){return e?T$(e,1/0,-1/0):tCt(1/0,-1/0)}function T$(e,t,r){return e.near=t,e.far=r,e}function QA(e,t,r=e){return r.near=Math.min(e.near,t.near),r.far=Math.max(e.far,t.far),r}function e4(e,t){return e.near<=t&&t<=e.far}const uJ={near:0,far:0};function rCt(e,t){const r=FL(),{eye:i,frustum:s,viewForward:n}=e;t.forAll(o=>{const a=b(o.offsetObb)?o.offsetObb:o.obb,l=Te(su($u,a.center,i),n),c=A8(a,n);if(e4(r,l-c)&&e4(r,l+c))return;const h=aCt(a,s);if(h===-1)return;if(h===0)return Bg.far=l+c,Bg.near=l-c,void QA(r,Bg);const p=t4.pushNew();p.near=l-c,p.far=l+c,p.mask=h,p.object=o});for(let o=0;o<t4.length;o++){const a=t4.data[o];if(e4(r,a.near)&&e4(r,a.far))continue;Bg.far=a.far,Bg.near=1/0,oCt(b(a.object.offsetObb)?a.object.offsetObb:a.object.obb,i,iCt,c=>{let h=sCt;for(let p=0;p<gLe&&c.length>0;p++){if((a.mask&1<<p)==0)continue;nCt(s[p],c,h);const f=c;c=h,h=f}for(let p=0;p<c.length;p+=3){se(Ul,c.data[p+0],c.data[p+1],c.data[p+2]);const f=Te(su(Ul,Ul,i),n);Bg.near=Math.min(Bg.near,f)}})===0&&(Bg.near=0),QA(r,Bg)}return t4.length=0,r}const t4=new Xt({allocator:e=>e||{near:1/0,far:-1/0,mask:0,object:null},deallocator:e=>(e.object=null,e)}),Bg=FL(),Ul=M(),Gb=M(),iCt=new Xt({deallocator:null}),sCt=new Xt({deallocator:null});function nCt(e,t,r){r.length=0;const i=t.length-3;rH(Ul,t,i);const s=ui(e,Ul);s<=0&&(r.push(Ul[0]),r.push(Ul[1]),r.push(Ul[2]));let n=0,o=s;for(;n<i;n+=3){rH(Gb,t,n);const a=ui(e,Gb);o*a<0&&(En(Ul,Gb,Ul,a/(a-o)),Vl(r,Ul)),a<=0&&Vl(r,Gb),o=a,ae(Ul,Gb)}o*s<0&&(rH(Gb,t,i),En(Ul,Gb,Ul,s/(s-o)),Vl(r,Ul))}function rH(e,t,r){return se(e,t.data[r+0],t.data[r+1],t.data[r+2])}function Vl(e,t){e.push(t[0]),e.push(t[1]),e.push(t[2])}function oCt(e,t,r,i){_0(Zge,e.quaternion),su($u,t,e.center),ch($u,$u,Zge);const s=8*(($u[0]<-e.halfSize[0]?-1:$u[0]>e.halfSize[0]?1:0)+3*($u[1]<-e.halfSize[1]?-1:$u[1]>e.halfSize[1]?1:0)+9*($u[2]<-e.halfSize[2]?-1:$u[2]>e.halfSize[2]?1:0)+13),n=Xge[s];if(n===0)return n;gB(r4,e.quaternion),xie(r4,r4,e.halfSize);const o=(a,l)=>{const c=Xge[s+l+1];return se(a,((1&c)<<1)-1,(2&c)-1,((4&c)>>1)-1),Hc(a,a,r4),de(a,e.center,a)};return r.length=0,Vl(r,o(iH,0)),Vl(r,o(Yge,1)),Vl(r,o($u,2)),Vl(r,o(Qge,3)),i(r),n===1||(r.length=0,Vl(r,iH),Vl(r,Qge),Vl(r,o($u,4)),Vl(r,o(Jge,5)),i(r),n===2||(r.length=0,Vl(r,iH),Vl(r,Jge),Vl(r,o($u,6)),Vl(r,Yge),i(r))),n}const Xge=(()=>{const e=new Int8Array(216);let t=0;const r=i=>{for(let s=0;s<i.length;s++)e[t+s]=i[s];t+=8};return r([3,0,6,2,3,1,5,4]),r([2,0,2,3,1,5,4,0]),r([3,1,0,2,3,7,5,4]),r([2,0,1,3,2,6,4,0]),r([1,0,1,3,2,0,0,0]),r([2,1,5,7,3,2,0,0]),r([3,2,0,1,3,7,6,4]),r([2,2,0,1,3,7,6,0]),r([3,3,0,1,5,7,6,2]),r([2,0,1,5,4,6,2,0]),r([1,0,1,5,4,0,0,0]),r([2,1,3,7,5,4,0,0]),r([1,0,2,6,4,0,0,0]),r([0,0,0,0,0,0,0,0]),r([1,1,3,7,5,0,0,0]),r([2,2,3,7,6,4,0,0]),r([1,2,3,7,6,0,0,0]),r([2,3,1,5,7,6,2,0]),r([3,4,0,1,5,7,6,2]),r([2,5,7,6,4,0,1,0]),r([3,5,0,1,3,7,6,4]),r([2,4,5,7,6,2,0,0]),r([1,4,5,7,6,0,0,0]),r([2,5,1,3,7,6,4,0]),r([3,6,0,2,3,7,5,4]),r([2,6,2,3,7,5,4,0]),r([3,7,6,2,3,1,5,4]),e})(),gLe=4;function aCt(e,t){let r=0;for(let i=0;i<gLe;i++){const s=kw(e,t[i]);if(s>0)return-1;s===0&&(r|=1<<i)}return r}const r4=$i(),Zge=A0(),$u=M(),iH=M(),Yge=M(),Qge=M(),Jge=M();class lCt{constructor(t){this._objects=t}submit(t,r){this._objects.preSubmit(r),this._objects.visibleObjects.forAll(i=>i.renderable.material.submit(t,r,i))}queryShadowCasterDepthRange(t){return this._objects.visibleObjects.length?rCt(t,this._objects.visibleObjects):null}}function cCt(e){const t=ps().vec3f(O.POSITION);return e.normals&&t.vec2i16(O.NORMALCOMPRESSED,{glNormalized:!0}),e.textureCoordinates===_n.Default?t.vec2f(O.UV0):e.textureCoordinates===_n.Atlas&&(t.vec2f(O.UV0),t.vec4u16(O.UVREGION,{glNormalized:!0})),e.colors&&t.vec4u8(O.COLOR,{glNormalized:!0}),t.alignTo(4)}class uCt extends ss{constructor(t,r){super(t,"int",Vr.Draw,(i,s,n)=>i.setUniform1i(t,r(s,n)))}}var gf;(function(e){e[e.Uniform=0]="Uniform",e[e.Varying=1]="Varying",e[e.COUNT=2]="COUNT"})(gf||(gf={}));const une=429496.7296;function yLe(e,t){n$(e/une*.5+.5,t)}function hCt(e,t){switch(t.componentData){case gf.Varying:return dCt(e);case gf.Uniform:return pCt(e);case gf.COUNT:return;default:t.componentData}}function dCt(e){const{vertex:t,fragment:r}=e;t.include(hu),t.uniforms.add([new Hi("componentColorTex"),new Zy("componentColorTexInvDim")]),e.attributes.add(O.COMPONENTINDEX,"float"),e.varyings.add("vExternalColorMixMode","mediump float"),e.varyings.add("vExternalColor","vec4"),e.include(tIe),t.constants.add("elevationScale","float",2*une),t.code.add(S`vec4 _readComponentColor() {
float normalizedIndex = (componentIndex * 2.0 + 0.5) * componentColorTexInvDim.x;
vec2 indexCoord = vec2(
mod(normalizedIndex, 1.0),
(floor(normalizedIndex) + 0.5) * componentColorTexInvDim.y
);
return texture2D(componentColorTex, indexCoord);
}
float readElevationOffset() {
float normalizedIndex = (componentIndex * 2.0 + 1.5) * componentColorTexInvDim.x;
vec2 indexCoord = vec2(
mod(normalizedIndex, 1.0),
(floor(normalizedIndex) + 0.5) * componentColorTexInvDim.y
);
return (rgba2float(texture2D(componentColorTex, indexCoord)) - 0.5) * elevationScale;
}
vec4 forwardExternalColor(out bool castShadows) {
vec4 componentColor = _readComponentColor() * 255.0;
float shadowFlag = mod(componentColor.b * 255.0, 2.0);
componentColor.b -= shadowFlag;
castShadows = shadowFlag >= 1.0;
int decodedColorMixMode;
vExternalColor = decodeSymbolColor(componentColor, decodedColorMixMode) * 0.003921568627451;
vExternalColorMixMode = float(decodedColorMixMode) + 0.5;
return vExternalColor;
}`),r.code.add(S`void readExternalColor(out vec4 externalColor, out int externalColorMixMode) {
externalColor = vExternalColor;
externalColorMixMode = int(vExternalColorMixMode);
}`)}function pCt(e){const{vertex:t,fragment:r}=e;t.uniforms.add(new vz("externalColor",i=>i.componentParameters.externalColor)),r.uniforms.add(new uCt("externalColorMixMode",i=>i.componentParameters.externalColorMixMode)),e.varyings.add("vExternalColor","vec4"),t.code.add(S`float readElevationOffset() {
return 0.0;
}
vec4 forwardExternalColor(out bool castShadows) {
vExternalColor = externalColor;
castShadows = true;
return externalColor;
}`),r.code.add(S`void readExternalColor(out vec4 color, out int colorMixMode) {
color = vExternalColor;
colorMixMode = externalColorMixMode;
}`)}var Cd;function fCt(e,t){const r=e.vertex;switch(r.code.add(S`#define VERTEX_DISCARD_CUTOFF (1.0 - 1.0 / 255.0)`),t.vertexDiscardMode){case Cd.None:r.code.add(S`#define vertexDiscardByOpacity(_opacity_) {}`);break;case Cd.Opaque:r.code.add(S`#define vertexDiscardByOpacity(_opacity_) { if (_opacity_ >  VERTEX_DISCARD_CUTOFF) {  gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }`);break;case Cd.Transparent:r.code.add(S`#define vertexDiscardByOpacity(_opacity_) { if (_opacity_ <= VERTEX_DISCARD_CUTOFF) {  gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }`)}}(function(e){e[e.None=0]="None",e[e.Transparent=1]="Transparent",e[e.Opaque=2]="Opaque",e[e.COUNT=3]="COUNT"})(Cd||(Cd={}));var Wm;function pNt(e){return e&&hg(e)?Wm.Mars:e&&dg(e)?Wm.Moon:Wm.Earth}(function(e){e[e.Earth=1]="Earth",e[e.Mars=2]="Mars",e[e.Moon=3]="Moon",e[e.COUNT=4]="COUNT"})(Wm||(Wm={}));var Kge,Qu;(function(e){e[e.None=0]="None",e[e.Transparent=1]="Transparent",e[e.Opaque=2]="Opaque",e[e.COUNT=3]="COUNT"})(Kge||(Kge={})),function(e){e[e.None=0]="None",e[e.NoOverlay=1]="NoOverlay",e[e.ColorOverlay=2]="ColorOverlay",e[e.ColorOverlayWithWater=3]="ColorOverlayWithWater",e[e.COUNT=4]="COUNT"}(Qu||(Qu={}));class dr extends vl{constructor(){super(...arguments),this.output=K.Color,this.textureCoordinateType=_n.None,this.componentData=gf.Uniform,this.cullFace=fi.Back,this.vertexDiscardMode=Cd.None,this.doubleSidedMode=Zi.WindingOrder,this.alphaDiscardMode=hi.Opaque,this.integratedMeshMode=Qu.None,this.transparencyPassType=yt.NONE,this.ellipsoidMode=Wm.Earth,this.pbrMode=Pt.Disabled,this.normalType=Ii.Attribute,this.spherical=!1,this.doublePrecisionRequiresObfuscation=!1,this.hasVertexColors=!1,this.hasNormals=!1,this.hasSlicePlane=!1,this.hasBaseColorTexture=!1,this.receiveAmbientOcclusion=!0,this.receiveShadows=!0,this.blendingEnabled=!0,this.hasScreenSpaceReflections=!1,this.hasPolygonOffset=!1,this.hasMetalnessAndRoughnessTexture=!1,this.hasEmissionTexture=!1,this.hasOcclusionTexture=!1,this.hasNormalTexture=!1,this.hasOccludees=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1,this.isGround=!1,this.hasCloudsReflections=!0,this.snowCover=!1}}u([q({count:K.COUNT})],dr.prototype,"output",void 0),u([q({count:_n.COUNT})],dr.prototype,"textureCoordinateType",void 0),u([q({count:gf.COUNT})],dr.prototype,"componentData",void 0),u([q({count:fi.COUNT})],dr.prototype,"cullFace",void 0),u([q({count:Cd.COUNT})],dr.prototype,"vertexDiscardMode",void 0),u([q({count:Zi.COUNT})],dr.prototype,"doubleSidedMode",void 0),u([q({count:hi.COUNT})],dr.prototype,"alphaDiscardMode",void 0),u([q({count:Qu.COUNT})],dr.prototype,"integratedMeshMode",void 0),u([q({count:yt.COUNT})],dr.prototype,"transparencyPassType",void 0),u([q({count:Wm.COUNT})],dr.prototype,"ellipsoidMode",void 0),u([q({count:Pt.COUNT})],dr.prototype,"pbrMode",void 0),u([q({count:Ii.COUNT})],dr.prototype,"normalType",void 0),u([q()],dr.prototype,"spherical",void 0),u([q()],dr.prototype,"doublePrecisionRequiresObfuscation",void 0),u([q()],dr.prototype,"hasVertexColors",void 0),u([q()],dr.prototype,"hasNormals",void 0),u([q()],dr.prototype,"hasSlicePlane",void 0),u([q()],dr.prototype,"hasBaseColorTexture",void 0),u([q()],dr.prototype,"receiveAmbientOcclusion",void 0),u([q()],dr.prototype,"receiveShadows",void 0),u([q()],dr.prototype,"blendingEnabled",void 0),u([q()],dr.prototype,"hasScreenSpaceReflections",void 0),u([q()],dr.prototype,"hasPolygonOffset",void 0),u([q()],dr.prototype,"hasMetalnessAndRoughnessTexture",void 0),u([q()],dr.prototype,"hasEmissionTexture",void 0),u([q()],dr.prototype,"hasOcclusionTexture",void 0),u([q()],dr.prototype,"hasNormalTexture",void 0),u([q()],dr.prototype,"hasOccludees",void 0),u([q()],dr.prototype,"hasMultipassTerrain",void 0),u([q()],dr.prototype,"cullAboveGround",void 0),u([q()],dr.prototype,"isGround",void 0),u([q()],dr.prototype,"hasCloudsReflections",void 0),u([q()],dr.prototype,"snowCover",void 0),u([q({constValue:Vr.Draw})],dr.prototype,"pbrTextureBindType",void 0),u([q({constValue:!0})],dr.prototype,"hasSliceHighlight",void 0),u([q({constValue:!1})],dr.prototype,"hasSliceInVertexProgram",void 0),u([q({constValue:!1})],dr.prototype,"useCustomDTRExponentForWater",void 0),u([q({constValue:!1})],dr.prototype,"hasVertexTangents",void 0),u([q({constValue:!0})],dr.prototype,"supportsTextureAtlas",void 0),u([q({constValue:!1})],dr.prototype,"highStepCount",void 0),u([q({constValue:!1})],dr.prototype,"instancedDoublePrecision",void 0),u([q({constValue:!0})],dr.prototype,"useFillLights",void 0);function eye(e,t){e.include(oS,t),e.fragment.include(d$);const r=e.fragment;r.uniforms.add(new vz("baseColor",i=>i.baseColor)),r.uniforms.add(new iIe("objectOpacity",i=>i.objectOpacity)),t.hasVertexColors?r.code.add(S`vec3 _baseColor() {
return baseColor.rgb * vColor.rgb;
}
float _baseOpacity() {
return baseColor.a * vColor.a;
}`):r.code.add(S`vec3 _baseColor() {
return baseColor.rgb;
}
float _baseOpacity() {
return baseColor.a;
}`),r.code.add(S`vec4 computeMaterialColor(vec4 textureColor, vec4 externalColor, int externalColorMixMode) {
vec3 baseColor = _baseColor();
float baseOpacity = _baseOpacity();
vec3 color = mixExternalColor(
baseColor,
textureColor.rgb,
externalColor.rgb,
externalColorMixMode
);
float opacity = objectOpacity * mixExternalOpacity(
baseOpacity,
textureColor.a,
externalColor.a,
externalColorMixMode
);
return vec4(color, opacity);
}`)}function tye(e,t){const r=e.fragment;switch(t.doubleSidedMode){case Zi.None:r.code.add(S`vec3 _adjustDoublesided(vec3 normal) {
return normal;
}`);break;case Zi.View:e.include(bC,t),r.code.add(S`vec3 _adjustDoublesided(vec3 normal) {
return dot(normal, vPositionWorldCameraRelative) > 0.0 ? -normal : normal;
}`);break;case Zi.WindingOrder:r.code.add(S`vec3 _adjustDoublesided(vec3 normal) {
return gl_FrontFacing ? normal : -normal;
}`);break;default:t.doubleSidedMode;case Zi.COUNT:}switch(t.normalType){case Ii.Attribute:case Ii.CompressedAttribute:e.include(ZB,t),r.code.add(S`vec3 shadingNormalWorld() {
return _adjustDoublesided(normalize(vNormalWorld));
}
vec3 shadingNormal_view() {
vec3 normal = normalize(vNormalView);
return gl_FrontFacing ? normal : -normal;
}`);break;case Ii.ScreenDerivative:e.extensions.add("GL_OES_standard_derivatives"),e.include(bC,t),r.code.add(S`vec3 shadingNormalWorld() {
return normalize(cross(
dFdx(vPositionWorldCameraRelative),
dFdy(vPositionWorldCameraRelative)
));
}
vec3 shadingNormal_view() {
return normalize(cross(dFdx(vPosition_view),dFdy(vPosition_view)));
}`);break;case Ii.Ground:t.spherical?(e.include(bC,t),r.code.add(S`vec3 shadingNormalWorld() {
return normalize(positionWorld());
}`)):r.code.add(S`vec3 shadingNormalWorld() {
return vec3(0.0, 0.0, 1.0);
}`),e.extensions.add("GL_OES_standard_derivatives"),r.code.add(S`vec3 shadingNormal_view() {
return normalize(cross(dFdx(vPosition_view),dFdy(vPosition_view))).xyz;
}`);break;default:t.normalType;case Ii.COUNT:}}function mCt(e,t){const r=e.fragment;if(t.hasBaseColorTexture){e.include(die,t);const i=t.textureCoordinateType===_n.Atlas;r.uniforms.add(dP("baseColorTexture",s=>s.texture,i)),i?(e.include(gOe),r.code.add(S`vec4 readBaseColorTexture() {
return textureAtlasLookup(baseColorTexture, baseColorTextureSize, vuv0, vuvRegion);
}`)):r.code.add(S`vec4 readBaseColorTexture() {
return texture2D(baseColorTexture, vuv0);
}`)}else r.code.add(S`vec4 readBaseColorTexture() { return vec4(1.0); }`)}const vLe=new Map([[O.POSITION,0],[O.NORMAL,1],[O.NORMALCOMPRESSED,1],[O.COLOR,2],[O.UV0,3],[O.UVREGION,4],[O.COMPONENTINDEX,5]]);function gCt(e){const t=new Yr;t.include(bC,e),t.include(ZB,e),t.include(oS,e),t.include(Xy,e),t.include(PL,e),t.include(hCt,e),t.include(ryt,e),t.include(xpt,e),t.include(mCt,e),t.include(fCt,e);const{vertex:r,fragment:i}=t;i.uniforms.add(new I1("view")),e.pbrMode!==Pt.Normal&&e.pbrMode!==Pt.Schematic||(t.include(gie,e),e.hasNormalTexture&&t.include(oIe,e)),e.output===K.Shadow&&e.componentData===gf.Varying?r.code.add(S`#define discardShadows(castShadows) { if(!castShadows) { gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }`):r.code.add(S`#define discardShadows(castShadows) {}`);const s=e.integratedMeshMode===Qu.ColorOverlay||e.integratedMeshMode===Qu.ColorOverlayWithWater,n=s&&e.output===K.Color&&e.pbrMode===Pt.WaterOnIntegratedMesh;return s&&(t.include(LT,e),t.include(v2t,e),e.spherical?r.code.add(S`
      const float invEllipsoidRadius = ${S.float(1/(e.ellipsoidMode===Wm.Earth?$r.radius:e.ellipsoidMode===Wm.Mars?zm.radius:c0.radius))};
      vec2 projectOverlay(vec3 pos) {
        return pos.xy / (1.0 + invEllipsoidRadius * pos.z);
      }
      `):r.code.add(S`vec2 projectOverlay(vec3 pos) { return pos.xy; }`)),n&&(t.varyings.add("tbnTangent","vec3"),t.varyings.add("tbnBiTangent","vec3"),t.varyings.add("groundNormal","vec3")),r.code.add(S`
    void main() {
      bool castShadows;
      vec4 externalColor = forwardExternalColor(castShadows);
      discardShadows(castShadows);

      vertexDiscardByOpacity(externalColor.a);

      if (externalColor.a < ${S.float(sa)}) {
        // Discard this vertex
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }

      forwardPosition(readElevationOffset());
      forwardNormal();
      forwardTextureCoordinates();
      forwardVertexColor();
      forwardLinearDepth();
      ${n?e.spherical?S`
                groundNormal = normalize(positionWorld());
                tbnTangent = normalize(cross(vec3(0.0, 0.0, 1.0), groundNormal));
                tbnBiTangent = normalize(cross(groundNormal, tbnTangent));`:S`
                groundNormal = vec3(0.0, 0.0, 1.0);
                tbnTangent = vec3(1.0, 0.0, 0.0);
                tbnBiTangent = vec3(0.0, 1.0, 0.0);`:""}
      ${s?S`setOverlayVTC(projectOverlay(position));`:""}
    }
  `),e.output===K.Alpha&&(i.include(xh),t.include(Th,e),t.include(eye,e),s&&i.uniforms.add(new Ht("ovColorTex",(o,a)=>rJ(o,a))),i.code.add(S`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);
        ${e.hasMultipassTerrain?S`terrainDepthTest(gl_FragCoord, vPosition_view.z);`:""}

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        vec4 externalColor;
        int externalColorMixMode;
        readExternalColor(externalColor, externalColorMixMode);

        vec4 materialColor = computeMaterialColor(
          textureColor,
          externalColor,
          externalColorMixMode
        );
        ${s?S`
                vec4 overlayColor = getOverlayColor(ovColorTex, vtcOverlay);
                materialColor = materialColor * (1.0 - overlayColor.a) + overlayColor;`:""}

        gl_FragColor = vec4(materialColor.a);
      }
    `)),e.output===K.Color&&(i.include(xh),t.include(Th,e),t.include(eye,e),t.include(tye,e),t.include(LT,e),e.receiveShadows?(t.include(YB,e),i.code.add(S`float evaluateShadow() {
return readShadowMap(vPositionWorldCameraRelative, linearDepth);
}`)):i.code.add(S`float evaluateShadow() { return 0.0; }`),s&&i.uniforms.add(new Ht("ovColorTex",(o,a)=>rJ(o,a))),i.code.add(S`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);
        ${e.hasMultipassTerrain?S`terrainDepthTest(gl_FragCoord, vPosition_view.z);`:""}

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        vec4 externalColor;
        int externalColorMixMode;
        readExternalColor(externalColor, externalColorMixMode);

        vec4 materialColor = computeMaterialColor(
          textureColor,
          externalColor,
          externalColorMixMode
        );
        ${s?S`vec4 overlayColor = getOverlayColor(ovColorTex, vtcOverlay);`:""}
    `),e.pbrMode===Pt.Normal||e.pbrMode===Pt.Schematic?(i.uniforms.add(new St("lightingMainIntensity",(o,a)=>a.lighting.mainLight.intensity)),i.code.add(S`
        ${e.pbrMode===Pt.Normal?S`
                applyPBRFactors();
                if (int(externalColorMixMode) == 3) {
                  mrr = vec3(0.0, 0.6, 0.2);
                }`:""}
        vec3 normalVertex = shadingNormalWorld();
        float additionalIrradiance = 0.02 * lightingMainIntensity[2];
      `),e.hasNormalTexture?i.code.add(S`mat3 tangentSpace = computeTangentSpace(normalVertex, vPositionWorldCameraRelative, vuv0);
vec3 shadingNormal = computeTextureNormal(tangentSpace, vuv0);`):i.code.add(S`vec3 shadingNormal = normalVertex;`),i.code.add(S`${e.spherical?S`vec3 normalGround = normalize(positionWorld());`:S`vec3 normalGround = vec3(0.0, 0.0, 1.0);`}
      `),i.code.add(S`
        vec3 viewDir = normalize(vPositionWorldCameraRelative);
        float ssao = 1.0 - occlusion * (1.0 - evaluateAmbientOcclusion());

        ${e.snowCover?S`
                vec3 surfaceNormal = normalize(shadingNormalWorld());
                float snow = smoothstep(0.5, 0.55, dot(surfaceNormal, normalize(positionWorld())));
                materialColor.rgb = mix(materialColor.rgb, vec3(1), snow);

                shadingNormal = mix(shadingNormal, surfaceNormal, snow);
                ssao = mix(ssao, 0.0, snow);
                mrr = mix(mrr, vec3(0.0, 1.0, 0.04), snow);
                emission = mix(emission, vec3(0.0), snow);`:""}

        ${s?S` materialColor = materialColor * (1.0 - overlayColor.a) + overlayColor;`:""}

        vec3 additionalLight = evaluateAdditionalLighting(ssao, positionWorld());
        vec4 shadedColor = vec4(evaluateSceneLightingPBR(shadingNormal, materialColor.rgb, evaluateShadow(), ssao, additionalLight, viewDir, normalGround, mrr, emission, additionalIrradiance), materialColor.a);
        `)):(e.receiveShadows?i.code.add(S`float shadow = evaluateShadow();`):e.spherical?(i.uniforms.add(new qe("lightingGlobalFactor",(o,a)=>a.lighting.globalFactor)),i.code.add(S`float additionalAmbientScale = additionalDirectedAmbientLight(positionWorld());
float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);`)):i.code.add(S`float shadow = 0.0;`),n&&i.uniforms.add(new Ht("ovNormalTex",(o,a)=>hne(a))),e.snowCover&&(t.extensions.add("GL_OES_standard_derivatives"),i.code.add(S`vec3 surfaceNormal = normalize(cross(dFdx(vPositionWorldCameraRelative), dFdy(vPositionWorldCameraRelative)));
float snow = smoothstep(0.5, 0.55, dot(surfaceNormal, normalize(positionWorld())));
materialColor.rgb = mix(materialColor.rgb, vec3(1), snow);`)),i.code.add(S`
        float ambientOcclusion = evaluateAmbientOcclusion();
        vec3 additionalLight = evaluateAdditionalLighting(ambientOcclusion, positionWorld());

        ${s?S` materialColor = materialColor * (1.0 - overlayColor.a) + overlayColor;`:""}

        vec4 shadedColor = vec4(evaluateSceneLighting(shadingNormalWorld(), materialColor.rgb, shadow, ambientOcclusion, additionalLight), materialColor.a);
      ${n?S`
              vec4 overlayWaterMask = getOverlayColor(ovNormalTex, vtcOverlay);
              float waterNormalLength = length(overlayWaterMask);
              if (waterNormalLength > 0.95) {
                mat3 tbnMatrix = mat3(tbnTangent, tbnBiTangent, groundNormal);
                vec4 waterColorLinear = getOverlayWaterColor(overlayWaterMask, overlayColor, -normalize(vPositionWorldCameraRelative), shadow, groundNormal, tbnMatrix, vPosition_view, positionWorld());
                vec4 waterColorNonLinear = delinearizeGamma(vec4(waterColorLinear.xyz, 1.0));
                // un-gamma the ground color to mix in linear space
                shadedColor = mix(shadedColor, waterColorNonLinear, waterColorLinear.w);
              }`:""}
      `)),i.code.add(S`
        gl_FragColor = highlightSlice(shadedColor, vPositionWorldCameraRelative);
        ${e.transparencyPassType===yt.Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}
      }
    `)),e.output!==K.Depth&&e.output!==K.Shadow||(t.include(tb,e),i.code.add(S`void main() {
discardBySlice(vPositionWorldCameraRelative);
vec4 textureColor = readBaseColorTexture();
discardOrAdjustAlpha(textureColor);
outputDepth(linearDepth);
}`)),e.output===K.Normal&&(t.include(tye,e),i.code.add(S`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        // note: the alpha component needs to be 1.0 in order for this material
        // to influence ambient occlusion, see the ssao fragment shader
        float alpha = ${e.normalType===Ii.Ground?"0.0":"1.0"};
        gl_FragColor = vec4(vec3(.5) + .5 * shadingNormal_view(), alpha);
      }
    `)),e.output===K.Highlight&&(t.include(D0),i.code.add(S`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        ${s?S`
                vec4 overlayColor = getCombinedOverlayColor();
                if (overlayColor.a == 0.0) {
                  gl_FragColor = vec4(0.0);
                  return;
                }`:""}

        outputHighlight();
      }
    `)),t}function hne(e){return e.overlays.length===0?null:e.overlays[Gi.INNER].getValidTexture(Ms.Water)}const yCt=Object.freeze(Object.defineProperty({__proto__:null,attributeLocations:vLe,build:gCt,getOverlayNormalTexture:hne},Symbol.toStringTag,{value:"Module"}));class R8 extends gi{bindDraw(t,r){const i=this.program;i.bindDraw(t,r),i.rebindTextures(),t.componentParameters.type===gf.Varying&&t.componentParameters.texture.bind(i,"componentColorTex","componentColorTexInvDim")}initializeConfiguration(t,r){r.spherical=t.viewingMode===Be.Global,r.doublePrecisionRequiresObfuscation=ML(t.rctx)}initializeProgram(t){const r=R8.shader.get(),i=r.build(this.configuration);return new oi(t.rctx,i,r.attributeLocations)}_setPipelineState(t){const r=this.configuration,i=r.integratedMeshMode!==Qu.None,s=t===yt.NONE,n=t===yt.FrontFace;return Gt({blending:r.output!==K.Color&&r.output!==K.Alpha||!r.blendingEnabled?null:s?fh:N0(t),culling:dB(r.cullFace),depthTest:{func:eb(t)},depthWrite:s||n?cc:null,colorWrite:or,stencilWrite:i||r.hasOccludees?cg:null,stencilTest:i?egt(tc.IntegratedMeshMaskExcluded):r.hasOccludees?rb:null,polygonOffset:s||n?r.hasPolygonOffset?{factor:2,units:2}:null:FB})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}}R8.shader=new ni(yCt,()=>ie(()=>import("./ComponentShader.glsl.c3edf39b.js"),[],import.meta.url));class vCt extends nn{constructor(){super(...arguments),this._dirty=!0}_setDirty(){this._dirty=!0}_setClean(){if(this._dirty=!1,this._parameterBlocks!=null)for(const t of this._parameterBlocks)this[t]._setClean()}get dirty(){return this._dirty||this._checkParameterBlocksDirty()}_checkParameterBlocksDirty(){if(this._parameterBlocks==null)return!1;for(const t of this._parameterBlocks)if(this[t].dirty)return!0;return!1}}class dne{constructor(){this._dirty=!0}_setDirty(){this._dirty=!0}_setClean(){this._dirty=!1}get dirty(){return this._dirty}}function Ki(e={}){return(t,r)=>{var s;const i=(s=t._parameterCount)!=null?s:0;if(t._parameterCount=i+1,e.vectorOps){const n=e.vectorOps;Object.defineProperty(t,r,{get(){return this[i]},set(o){const a=this[i];if(a==null)this[i]=o;else{if(n.equals(a,o))return;n.copy(a,o)}this._setDirty()}})}else Object.defineProperty(t,r,{get(){return this[i]},set(n){this[i]!==n&&(e.dispose&&this[i]&&this[i].dispose(),this[i]=n,this._setDirty())}})}}function rye(){return(e,t)=>{var i;const r=(i=e._parameterCount)!=null?i:0;e._parameterCount=r+1,e._parameterBlocks=e._parameterBlocks||[],e._parameterBlocks.push(r),Object.defineProperty(e,t,{get(){return this[r]},set(s){this[r]!==s&&(this[r]=s,this._setDirty())}})}}class O8{constructor(t){this._low=Mr(),this._high=Mr(),t&&this.set(t)}get low(){return this._low}get high(){return this._high}set(t){const r=this._low,i=this._high;ae(r,t),su(i,t,r)}setElements(t,r,i){se(iye,t,r,i),this.set(iye)}get(t){return de(t,this._low,this._high)}getLowScaled(t){return le(t,this._low,1)}}const iye=M();class qn extends vCt{constructor(t,r){super(),this.toMapSpace=r,this.baseColor=Xd(1,1,1,1),this.usePBR=!1,this.hasParametersFromSource=!1,this.mrrFactors=Dr(1,1,.5),this.emissiveFactor=Dr(0,0,0),this.baseColorTexture=null,this.metallicRoughnessTexture=null,this.emissionTexture=null,this.occlusionTexture=null,this.normalTexture=null,this.objectOpacity=1,this.commonMaterialParameters=new Tk,this.componentParameters=new MP,this.textureAlphaCutoff=XV,this.alphaDiscardMode=hi.Opaque,this.isIntegratedMesh=!1,this.polygonOffsetEnabled=!1,this.ellipsoidMode=Wm.Earth,this.hasOccludees=!1,this._techniqueConfiguration=new dr;const i=new O8(t.position),s=y$e(t.rotationScale);sS(s,s),this.transformNormalGlobalFromModel=jd(s,s),this.transformWorldFromModelTL=i.low,this.transformWorldFromModelTH=i.high,this.transformWorldFromModelRS=t.rotationScale}dispose(){this._technique=ti(this._technique),this.baseColorTexture=null,this.metallicRoughnessTexture=null,this.emissionTexture=null,this.occlusionTexture=null,this.normalTexture=null}get texture(){return b(this.baseColorTexture)?this.baseColorTexture.glTexture:null}get textureMetallicRoughness(){return b(this.metallicRoughnessTexture)?this.metallicRoughnessTexture.glTexture:null}get textureEmissive(){return b(this.emissionTexture)?this.emissionTexture.glTexture:null}get textureOcclusion(){return b(this.occlusionTexture)?this.occlusionTexture.glTexture:null}get textureNormal(){return b(this.normalTexture)?this.normalTexture.glTexture:null}prepareTechnique(t,r,i,s){const n=this._techniqueConfiguration;n.hasVertexColors=s.colors,n.hasNormals=s.normals,n.textureCoordinateType=s.textureCoordinates,n.hasMetalnessAndRoughnessTexture=b(this.metallicRoughnessTexture),n.hasEmissionTexture=b(this.emissionTexture),n.hasOcclusionTexture=b(this.occlusionTexture),n.hasNormalTexture=b(this.normalTexture),n.transparencyPassType=r.identifier===th.Material&&i.transparencyPassType!=null?i.transparencyPassType:yt.NONE,n.hasMultipassTerrain=r.identifier===th.Material&&i.multipassTerrain!=null&&i.multipassTerrain.enabled,n.cullAboveGround=r.identifier===th.Material&&i.multipassTerrain!=null&&i.multipassTerrain.cullAboveGround,n.ellipsoidMode=this.ellipsoidMode,n.componentData=this.componentParameters.type,n.cullFace=this.commonMaterialParameters.cullFace,n.doubleSidedMode=this.commonMaterialParameters.doubleSided?Zi.View:Zi.None,n.hasBaseColorTexture=b(this.baseColorTexture);const o=this._computeWhichMaterialPass();n.blendingEnabled=o===el.Transparent||o===el.OpaqueAndTransparent,n.alphaDiscardMode=this.alphaDiscardMode,n.integratedMeshMode=this.isIntegratedMesh?wCt(i)?hne(i)?Qu.ColorOverlayWithWater:Qu.ColorOverlay:Qu.NoOverlay:Qu.None,n.isGround=this.isIntegratedMesh,n.hasPolygonOffset=this.polygonOffsetEnabled;const a=this.hasParametersFromSource&&R(this.baseColorTexture);return n.pbrMode=n.integratedMeshMode===Qu.ColorOverlayWithWater?Pt.WaterOnIntegratedMesh:this.usePBR?a?Pt.Schematic:Pt.Normal:Pt.Disabled,n.normalType=n.integratedMeshMode===Qu.None?n.hasNormals?Ii.CompressedAttribute:Ii.ScreenDerivative:Ii.Ground,n.hasSlicePlane=b(i.slicePlane)&&this.commonMaterialParameters.hasSlicePlane,r.identifier===th.ShadowMap?(n.output=K.Shadow,n.vertexDiscardMode=Cd.None):r.identifier===th.Highlight?(n.output=K.Highlight,n.vertexDiscardMode=Cd.None):(this._computeWhichMaterialPass()===el.OpaqueAndTransparent?n.vertexDiscardMode=r.transparent?Cd.Opaque:Cd.Transparent:n.vertexDiscardMode=Cd.None,n.output=_Ct(r.subPass),r.subPass===To.Alpha&&(n.hasOccludees=i.hasOccludees),r.subPass===To.Color?(n.receiveAmbientOcclusion=i.ssaoHelper.ready,n.hasOccludees=i.hasOccludees,n.receiveShadows=i.shadowMap.ready,n.hasScreenSpaceReflections=i.ssr.enabled,n.hasCloudsReflections=b(i.clouds.data)):(n.receiveAmbientOcclusion=!1,n.receiveShadows=!1),n.snowCover=this.hasSnowCover(i)),this._technique=t.releaseAndAcquire(R8,n,this._technique),this._setClean(),this._technique}hasSnowCover(t){return b(t.weather)&&t.weatherVisible&&t.weather.type==="snowy"&&t.weather.snowCover==="enabled"}submit(t,r,i){if(this.objectOpacity===0)return;const s=i.renderable.geometry,n=i.components,o=i.renderable.meta.cameraDepthSquared,a=n.geometryRanges,l=n.highlightRanges,c=n.defaultShadowMapRanges;switch(this._computeWhichMaterialPass()){case el.Opaque:t.materialOpaque.submitDraw(this,s,a,o);break;case el.Transparent:t.materialTransparent.submitDraw(this,s,a,o);break;case el.OpaqueAndTransparent:t.materialOpaque.submitDraw(this,s,a,o),t.materialTransparent.submitDraw(this,s,a,o);break;case el.IntegratedMesh:t.materialIntegratedMesh.submitDraw(this,s,a,o),bCt(r)&&t.highlightIntegratedMesh.submitDraw(this,s,a,o)}const h=this.componentParameters.castShadows!==$n.None;h&&t.shadowMap.submitDraw(this,s,a,o),b(l)&&(t.highlight.submitDraw(this,s,l,o),h&&t.highlightShadowMap.submitDraw(this,s,l,o)),h&&b(c)&&t.defaultShadowMap.submitDraw(this,s,c,o)}get attributeLocations(){return vLe}_computeWhichMaterialPass(){return this.isIntegratedMesh?el.IntegratedMesh:this.objectOpacity<1?el.Transparent:this.componentParameters.opaqueOverride===$n.All?el.Opaque:this.baseColor[3]<1||this.alphaDiscardMode===hi.Blend||this.alphaDiscardMode===hi.MaskBlend?el.Transparent:this.componentParameters.transparent===$n.None?el.Opaque:this.componentParameters.transparent===$n.All?el.Transparent:el.OpaqueAndTransparent}}var sye,el,$n;u([Ki({vectorOps:Wbe})],qn.prototype,"baseColor",void 0),u([Ki()],qn.prototype,"usePBR",void 0),u([Ki()],qn.prototype,"hasParametersFromSource",void 0),u([Ki({vectorOps:Pae})],qn.prototype,"mrrFactors",void 0),u([Ki({vectorOps:Pae})],qn.prototype,"emissiveFactor",void 0),u([Ki({dispose:!0})],qn.prototype,"baseColorTexture",void 0),u([Ki({dispose:!0})],qn.prototype,"metallicRoughnessTexture",void 0),u([Ki({dispose:!0})],qn.prototype,"emissionTexture",void 0),u([Ki({dispose:!0})],qn.prototype,"occlusionTexture",void 0),u([Ki({dispose:!0})],qn.prototype,"normalTexture",void 0),u([Ki()],qn.prototype,"objectOpacity",void 0),u([rye()],qn.prototype,"commonMaterialParameters",void 0),u([rye()],qn.prototype,"componentParameters",void 0),u([Ki()],qn.prototype,"textureAlphaCutoff",void 0),u([Ki()],qn.prototype,"alphaDiscardMode",void 0),u([Ki()],qn.prototype,"isIntegratedMesh",void 0),u([Ki()],qn.prototype,"polygonOffsetEnabled",void 0),u([Ki()],qn.prototype,"ellipsoidMode",void 0),u([Ki()],qn.prototype,"hasOccludees",void 0),function(e){e[e.VERTEX=0]="VERTEX",e[e.GROUND=1]="GROUND",e[e.SCREEN_DERIVATIVE=2]="SCREEN_DERIVATIVE"}(sye||(sye={})),function(e){e[e.Opaque=0]="Opaque",e[e.Transparent=1]="Transparent",e[e.OpaqueAndTransparent=2]="OpaqueAndTransparent",e[e.IntegratedMesh=3]="IntegratedMesh"}(el||(el={}));class Tk extends dne{constructor(){super(...arguments),this.doubleSided=!1,this.cullFace=fi.Back,this.hasSlicePlane=!0}}u([Ki()],Tk.prototype,"doubleSided",void 0),u([Ki()],Tk.prototype,"cullFace",void 0),u([Ki()],Tk.prototype,"hasSlicePlane",void 0);class MP extends dne{constructor(){super(...arguments),this.externalColor=Xd(1,1,1,1),this.externalColorMixMode=$s.Multiply,this.castShadows=$n.All}get transparent(){return this.externalColor[3]<1?$n.All:$n.None}get opaqueOverride(){return this.externalColorMixMode===$s.Replace&&this.externalColor[3]===1?$n.All:$n.None}get visible(){return this.externalColor[3]>0?$n.All:$n.None}get type(){return gf.Uniform}}u([Ki({vectorOps:Wbe})],MP.prototype,"externalColor",void 0),u([Ki()],MP.prototype,"externalColorMixMode",void 0),u([Ki()],MP.prototype,"castShadows",void 0),function(e){e[e.All=0]="All",e[e.Some=1]="Some",e[e.None=2]="None"}($n||($n={}));class w3 extends dne{constructor(){super(...arguments),this.texture=null,this.transparent=$n.None,this.opaqueOverride=$n.None,this.castShadows=$n.None}get type(){return gf.Varying}}function _Ct(e){switch(e){case To.Color:return K.Color;case To.Alpha:return K.Alpha;case To.Depth:return K.Depth;case To.Normal:return K.Normal}}function bCt(e){return e.overlays.length!==0&&b(e.overlays[Gi.INNER].getValidTexture(Ms.Highlight))}function wCt(e){return e.overlays.length!==0&&b(e.overlays[Gi.INNER].getColorTextureNoRasterImage())}u([Ki()],w3.prototype,"texture",void 0),u([Ki()],w3.prototype,"transparent",void 0),u([Ki()],w3.prototype,"opaqueOverride",void 0),u([Ki()],w3.prototype,"castShadows",void 0);const S$=ps().vec3f(O.POSITION).u16(O.COMPONENTINDEX).u16(O.U16PADDING),_Le=ps().vec2u8(O.SIDENESS),nye=du(_Le),bLe=ps().vec3f(O.POSITION0).vec3f(O.POSITION1).u16(O.COMPONENTINDEX).u8(O.VARIANTOFFSET,{glNormalized:!0}).u8(O.VARIANTSTROKE).u8(O.VARIANTEXTENSION,{glNormalized:!0}).u8(O.U8PADDING,{glPadding:!0}).u16(O.U16PADDING,{glPadding:!0}),hJ=bLe.clone().vec3f(O.NORMAL),dJ=bLe.clone().vec3f(O.NORMALA).vec3f(O.NORMALB),pJ=new Map([[O.POSITION0,0],[O.POSITION1,1],[O.COMPONENTINDEX,2],[O.VARIANTOFFSET,3],[O.VARIANTSTROKE,4],[O.VARIANTEXTENSION,5],[O.NORMAL,6],[O.NORMALA,6],[O.NORMALB,7],[O.SIDENESS,8]]);function oye(e,t,r){const i=t/3,s=new Uint32Array(r+1),n=new Uint32Array(r+1),o=(_,T)=>{_<T?s[_+1]++:n[T+1]++};for(let _=0;_<i;_++){const T=e[3*_],x=e[3*_+1],E=e[3*_+2];o(T,x),o(x,E),o(E,T)}let a=0,l=0;for(let _=0;_<r;_++){const T=s[_+1],x=n[_+1];s[_+1]=a,n[_+1]=l,a+=T,l+=x}const c=new Uint32Array(6*i),h=s[r],p=(_,T,x)=>{if(_<T){const E=s[_+1]++;c[2*E]=T,c[2*E+1]=x}else{const E=n[T+1]++;c[2*h+2*E]=_,c[2*h+2*E+1]=x}};for(let _=0;_<i;_++){const T=e[3*_],x=e[3*_+1],E=e[3*_+2];p(T,x,_),p(x,E,_),p(E,T,_)}const f=(_,T)=>{const x=2*_,E=T-_;for(let C=1;C<E;C++){const A=c[x+2*C],P=c[x+2*C+1];let I=C-1;for(;I>=0&&c[x+2*I]>A;I--)c[x+2*I+2]=c[x+2*I],c[x+2*I+3]=c[x+2*I+1];c[x+2*I+2]=A,c[x+2*I+3]=P}};for(let _=0;_<r;_++)f(s[_],s[_+1]),f(h+n[_],h+n[_+1]);const m=new Int32Array(3*i),g=(_,T)=>_===e[3*T]?0:_===e[3*T+1]?1:_===e[3*T+2]?2:-1,v=(_,T)=>{const x=g(_,T);m[3*T+x]=-1},w=(_,T,x,E)=>{const C=g(_,T);m[3*T+C]=E;const A=g(x,E);m[3*E+A]=T};for(let _=0;_<r;_++){let T=s[_];const x=s[_+1];let E=n[_];const C=n[_+1];for(;T<x&&E<C;){const A=c[2*T],P=c[2*h+2*E];A===P?(w(_,c[2*T+1],P,c[2*h+2*E+1]),T++,E++):A<P?(v(_,c[2*T+1]),T++):(v(P,c[2*h+2*E+1]),E++)}for(;T<x;)v(_,c[2*T+1]),T++;for(;E<C;)v(c[2*h+2*E],c[2*h+2*E+1]),E++}return m}function _z(e,t){return t.push(e.buffer),{buffer:e.buffer,layout:xCt(e.layout)}}function i4(e){return TCt(e.layout).createView(e.buffer)}function xCt(e){const t=new Array;return e.fields.forEach((r,i)=>{const s={...r,constructor:wLe(r.constructor)};t.push([i,s])}),{stride:e.stride,fields:t,fieldNames:e.fieldNames}}function TCt(e){const t=ps();return t.stride=e.stride,t.fieldNames=e.fieldNames,e.fields.forEach(r=>t.fields.set(r[0],{...r[1],constructor:ECt(r[1].constructor)})),t}const SCt=[yL,Hd,Zr,oo,Ef,OA,MA,PA,Ns,xT,$1,L1,b0,TT,D1,uc,ST,IA,ET,N1,CT,$A,zI,BI,LA,AT,GI,jI,HI,RT,qI,WI,XI,ZI,YI,QI];function wLe(e){return`${e.ElementType}_${e.ElementCount}`}function ECt(e){return xLe.get(e)}const xLe=new Map;SCt.forEach(e=>xLe.set(wLe(e),e));class TLe{updateSettings(t){this.settings=t,this.edgeHashFunction=t.reducedPrecision?ACt:CCt}write(t,r,i){const s=this.edgeHashFunction(i);n4.seed=s;const n=n4.getIntRange(0,255),o=n4.getIntRange(0,this.settings.variants-1),a=.7,l=n4.getFloat(),c=255*(.5*RCt(-(1-Math.min(l/a,1))+Math.max(0,l-a)/(1-a),1.2)+.5);t.position0.setVec(r,i.position0),t.position1.setVec(r,i.position1),t.componentIndex.set(r,i.componentIndex),t.variantOffset.set(r,n),t.variantStroke.set(r,o),t.variantExtension.set(r,c)}trim(t,r){return t.slice(0,r)}}const pne=new Float32Array(6),bz=new Uint32Array(pne.buffer),Q_=new Uint32Array(1);function CCt(e){const t=pne;t[0]=e.position0[0],t[1]=e.position0[1],t[2]=e.position0[2],t[3]=e.position1[0],t[4]=e.position1[1],t[5]=e.position1[2],Q_[0]=5381;for(let r=0;r<bz.length;r++)Q_[0]=31*Q_[0]+bz[r];return Q_[0]}function ACt(e){const t=pne;t[0]=a2(e.position0[0]),t[1]=a2(e.position0[1]),t[2]=a2(e.position0[2]),t[3]=a2(e.position1[0]),t[4]=a2(e.position1[1]),t[5]=a2(e.position1[2]),Q_[0]=5381;for(let r=0;r<bz.length;r++)Q_[0]=31*Q_[0]+bz[r];return Q_[0]}const aye=1e4;function a2(e){return Math.round(e*aye)/aye}function RCt(e,t){const r=e<0?-1:1;return Math.abs(e)**t*r}class wz{constructor(){this.commonWriter=new TLe}updateSettings(t){this.commonWriter.updateSettings(t)}allocate(t){return hJ.createBuffer(t)}write(t,r,i){this.commonWriter.write(t,r,i),de(s4,i.faceNormal0,i.faceNormal1),we(s4,s4),t.normal.setVec(r,s4)}trim(t,r){return this.commonWriter.trim(t,r)}}wz.Layout=hJ,wz.glLayout=du(hJ,1);class xz{constructor(){this.commonWriter=new TLe}updateSettings(t){this.commonWriter.updateSettings(t)}allocate(t){return dJ.createBuffer(t)}write(t,r,i){this.commonWriter.write(t,r,i),t.normalA.setVec(r,i.faceNormal0),t.normalB.setVec(r,i.faceNormal1)}trim(t,r){return this.commonWriter.trim(t,r)}}xz.Layout=dJ,xz.glLayout=du(dJ,1);const s4=M(),n4=new gd,Uw=-1;var Tz;function fJ(e,t,r,i=LCt){const s=e.vertices.position,n=e.vertices.componentIndex,o=Ft(i.anglePlanar),a=Ft(i.angleSignificantEdge),l=Math.cos(a),c=Math.cos(o),h=mJ.edge,p=h.position0,f=h.position1,m=h.faceNormal0,g=h.faceNormal1,v=$Ct(e),w=ICt(e),_=w.length/4,T=t.allocate(_);let x=0;const E=_,C=r.allocate(E);let A=0,P=0,I=0;const L=j4e(0,_),k=new Float32Array(_);W4e(k,(ce,ne,D)=>{s.getVec(w[4*ne+0],p),s.getVec(w[4*ne+1],f),D[ne]=pi(p,f)}),L.sort((ce,ne)=>k[ne]-k[ce]);const G=new Array,z=new Array;for(let ce=0;ce<_;ce++){const ne=L[ce],D=k[ne],N=w[4*ne+0],V=w[4*ne+1],B=w[4*ne+2],W=w[4*ne+3],Y=W===Uw;if(s.getVec(N,p),s.getVec(V,f),Y)se(m,v[3*B+0],v[3*B+1],v[3*B+2]),ae(g,m),h.componentIndex=n.get(N),h.cosAngle=Te(m,g);else{if(se(m,v[3*B+0],v[3*B+1],v[3*B+2]),se(g,v[3*W+0],v[3*W+1],v[3*W+2]),h.componentIndex=n.get(N),h.cosAngle=Te(m,g),MCt(h,c))continue;h.cosAngle<-.9999&&ae(g,m)}P+=D,I++,Y||OCt(h,l)?(t.write(T,x++,h),G.push(D)):PCt(h,o)&&(r.write(C,A++,h),z.push(D))}const X=new Float32Array(G.reverse()),Z=new Float32Array(z.reverse());return{regular:{instancesData:t.trim(T,x),lodInfo:{lengths:X}},silhouette:{instancesData:r.trim(C,A),lodInfo:{lengths:Z}},averageEdgeLength:P/I}}function OCt(e,t){return e.cosAngle<t}function MCt(e,t){return e.cosAngle>t}function PCt(e,t){const r=Cn(e.cosAngle),i=mJ.fwd,s=mJ.ortho;return S0(i,e.position1,e.position0),r*(Te(ut(s,e.faceNormal0,e.faceNormal1),i)>0?-1:1)>t}function ICt(e){const t=e.faces.length/3,r=e.faces,i=e.neighbors;let s=0;for(let a=0;a<t;a++){const l=i[3*a+0],c=i[3*a+1],h=i[3*a+2],p=r[3*a+0],f=r[3*a+1],m=r[3*a+2];s+=l===Uw||p<f?1:0,s+=c===Uw||f<m?1:0,s+=h===Uw||m<p?1:0}const n=new Int32Array(4*s);let o=0;for(let a=0;a<t;a++){const l=i[3*a+0],c=i[3*a+1],h=i[3*a+2],p=r[3*a+0],f=r[3*a+1],m=r[3*a+2];(l===Uw||p<f)&&(n[o++]=p,n[o++]=f,n[o++]=a,n[o++]=l),(c===Uw||f<m)&&(n[o++]=f,n[o++]=m,n[o++]=a,n[o++]=c),(h===Uw||m<p)&&(n[o++]=m,n[o++]=p,n[o++]=a,n[o++]=h)}return n}function $Ct(e){const t=e.faces.length/3,r=e.vertices.position,i=e.faces,s=sH.v0,n=sH.v1,o=sH.v2,a=new Float32Array(3*t);for(let l=0;l<t;l++){const c=i[3*l+0],h=i[3*l+1],p=i[3*l+2];r.getVec(c,s),r.getVec(h,n),r.getVec(p,o),pe(n,n,s),pe(o,o,s),ut(s,n,o),we(s,s),a[3*l+0]=s[0],a[3*l+1]=s[1],a[3*l+2]=s[2]}return a}(function(e){e[e.SOLID=0]="SOLID",e[e.SKETCH=1]="SKETCH"})(Tz||(Tz={}));const mJ={edge:{position0:M(),position1:M(),faceNormal0:M(),faceNormal1:M(),componentIndex:0,cosAngle:0},ortho:M(),fwd:M()},sH={v0:M(),v1:M(),v2:M()},LCt={anglePlanar:4,angleSignificantEdge:35};class SLe{async extract(t){const r=nH(t),i=fne(r),s=[r.data.buffer];return{result:DCt(i,s),transferList:s}}async extractComponentsEdgeLocations(t){const r=nH(t),i=gJ(r.data,r.skipDeduplicate,r.indices,r.indicesLength),s=fJ(i,UCt,uye),n=[];return{result:_z(s.regular.instancesData,n),transferList:n}}async extractEdgeLocations(t){const r=nH(t),i=gJ(r.data,r.skipDeduplicate,r.indices,r.indicesLength),s=fJ(i,kCt,uye),n=[];return{result:_z(s.regular.instancesData,n),transferList:n}}}function fne(e){const t=gJ(e.data,e.skipDeduplicate,e.indices,e.indicesLength);return lye.updateSettings(e.writerSettings),cye.updateSettings(e.writerSettings),fJ(t,lye,cye)}function nH(e){return{data:S$.createView(e.dataBuffer),indices:e.indicesType==="Uint32Array"?new Uint32Array(e.indicesBuffer):e.indicesType==="Uint16Array"?new Uint16Array(e.indicesBuffer):void 0,indicesLength:e.indicesLength,writerSettings:e.writerSettings,skipDeduplicate:e.skipDeduplicate}}function DCt(e,t){return t.push(e.regular.lodInfo.lengths.buffer),t.push(e.silhouette.lodInfo.lengths.buffer),{regular:{instancesData:_z(e.regular.instancesData,t),lodInfo:{lengths:e.regular.lodInfo.lengths.buffer}},silhouette:{instancesData:_z(e.silhouette.instancesData,t),lodInfo:{lengths:e.silhouette.lodInfo.lengths.buffer}},averageEdgeLength:e.averageEdgeLength}}function gJ(e,t,r,i){if(t)return{faces:r,facesLength:i,neighbors:oye(r,i,e.count),vertices:e};const s=pPe(e.buffer,e.stride/4,{originalIndices:r,originalIndicesLength:i}),n=oye(s.indices,i,s.uniqueCount);return{faces:s.indices,facesLength:s.indices.length,neighbors:n,vertices:S$.createView(s.buffer)}}const lye=new wz,cye=new xz;class NCt{allocate(t){return ELe.createBuffer(t)}trim(t,r){return t.slice(0,r)}write(t,r,i){t.position0.setVec(r,i.position0),t.position1.setVec(r,i.position1)}}class FCt{allocate(t){return mne.createBuffer(t)}trim(t,r){return t.slice(0,r)}write(t,r,i){t.position0.setVec(r,i.position0),t.position1.setVec(r,i.position1),t.componentIndex.set(r,i.componentIndex)}}const kCt=new NCt,UCt=new FCt,uye={allocate:()=>null,write:()=>{},trim:()=>null},ELe=ps().vec3f(O.POSITION0).vec3f(O.POSITION1),mne=ps().vec3f(O.POSITION0).vec3f(O.POSITION1).u16(O.COMPONENTINDEX).u16(O.U16PADDING,{glPadding:!0});function VCt(){return new SLe}const zCt=Object.freeze(Object.defineProperty({__proto__:null,EdgeProcessingWorker:SLe,default:VCt,extract:fne,extractComponentsEdgeLocationsLayout:mne,extractEdgeLocationsLayout:ELe},Symbol.toStringTag,{value:"Module"}));class BCt{constructor(t){this.maxCount=t,this._nextIndex=0,this.recycledIndices=[]}get activeCount(){return this._nextIndex-this.recycledIndices.length}get availableCount(){return this.recycledIndices.length+this.maxCount-this._nextIndex}acquire(){return this.recycledIndices.length>0?this.recycledIndices.pop():this.availableCount?this._nextIndex++:void 0}release(t){this.recycledIndices.push(t)}}class GCt{constructor(t,r=1){this.rctx=t,this.fieldCount=r,this.textureWidth=4096,this.dirty=!0,this.texture=new nt(this.rctx,{target:mt.TEXTURE_2D,pixelFormat:ze.RGBA,dataType:Ct.UNSIGNED_BYTE,samplingMode:et.NEAREST,wrapMode:xt.CLAMP_TO_EDGE,width:this.textureWidth,height:1,flipped:!1}),this.data=new uc(new ArrayBuffer(4*this.textureWidth))}dispose(){this.texture.dispose(),this.texture=void 0,this.data=void 0}setData(t,r,i,s,n,o){const a=t*this.fieldCount+r;this.dirty=!0,this.data.set(a,0,i),this.data.set(a,1,s),this.data.set(a,2,n),this.data.set(a,3,o)}setDataElement(t,r,i,s){const n=t*this.fieldCount+r;this.dirty=!0,this.data.set(n,i,s)}resizeToFit(t){const r=t*this.fieldCount;if(r>=this.data.count){const i=Math.ceil((r+1)/this.textureWidth)*this.textureWidth,s=new uc(new ArrayBuffer(4*i));s.typedBuffer.set(this.data.typedBuffer),this.data=s}}updateTexture(){if(!this.dirty)return;const t=this.texture.descriptor.width,r=this.texture.descriptor.height;this.data.count>t*r&&this.texture.resize(t,this.data.count/t),this.texture.setData(this.data.typedBuffer),this.dirty=!1}bind(t,r,i){t.bindTexture(r,this.texture),t.setUniform2f(i,1/this.texture.descriptor.width,1/this.texture.descriptor.height)}}const CLe=65536;class jCt{constructor(t,r=1){this.textureBuffer=new GCt(t,r),this.indexManager=new BCt(CLe)}dispose(){this.textureBuffer.dispose(),this.textureBuffer=void 0}get availableCount(){return this.indexManager.availableCount}get activeCount(){return this.indexManager.activeCount}acquireIndex(){const t=this.indexManager.acquire();return this.textureBuffer.resizeToFit(t),t}releaseIndex(t){this.indexManager.release(t)}}class ALe{constructor(t,r=1){this.rctx=t,this.fieldCount=r,this.buffers=[]}garbageCollect(){this.buffers=this.buffers.filter(t=>t.activeCount!==0||(t.dispose(),!1))}destroy(){this.buffers.forEach(t=>t.dispose()),this.buffers=[]}getBuffer(t){for(const i of this.buffers)if(i.availableCount>=t)return i;if(t>CLe)return null;const r=new jCt(this.rctx,this.fieldCount);return this.buffers.push(r),r}updateTextures(){for(const t of this.buffers)t.textureBuffer.updateTexture()}}const hye=fe.getLogger("esri.views.3d.webgl-engine.collections.Component.ComponentObjectCollection");class HCt{constructor(t,r){this._renderManager=t,this._viewingMode=r,this._objects=[new Xt,new Xt],this._renderSubmit=new lCt(this),this._renderManager.register(this._renderSubmit),this._componentBufferManager=new ALe(t.rctx,2)}dispose(){ft(this._objects[RC.Hidden].length===0&&this._objects[RC.Visible].length===0,"ObjectCollection should be empty upon disposal"),this._componentBufferManager.destroy()}createObject(t){const r=new cJ;return r.toMapSpace=t.toMapSpace,r.transform=t.transform,r.obb=jge(t.obb),r.components=new jEt(this._componentBufferManager,t.geometry.componentOffsets),r.renderable=this._createRenderable(t,r.components),r.intersectionGeometry=new QEt(t.geometry.positionData,r.components),this._objects[r.visible].push(r),r}destroyObject(t){const r=t;this._objects[r.visible].removeUnordered(r),r.dispose(),this._notifyDirty()}setObjectVisibility(t,r){const i=t;r!==i.visible&&(this._objects[i.visible].removeUnordered(i),this._objects[r].push(i),i.visible=r,this._notifyDirty())}preSubmit(t){const r=t.camera.eye;this.visibleObjects.forAll(i=>i.renderable.meta.cameraDepthSquared=Fn(r,i.obb.center))}getMaterial(t){return t.renderable.material}updateMaterial(t,r){const i=t.renderable.material;r(i),i.dirty&&this._notifyDirty()}setAllComponentVisibilities(t,r){const i=t;i.components.visibility.reset(r),i.components.visibilityDirty(),this._notifyDirty()}forEachVisibleComponent(t,r){return t.components.visibility.forEachComponent(r)}getComponentCount(t){const r=t,i=r.components.visibility.componentCount();return{visible:i,invisible:r.components.count-i}}setComponentData(t,r){const i=t,s=i.renderable.material,n=i.components,o=n.materialDataBuffer,a=n.materialDataIndices,l={castShadows:!0,pickable:!0,externalColor:Hse(),externalColorMixMode:$s.Multiply,elevationOffset:0},c=o.textureBuffer,h=new Uint8Array(4),p=new Uint32Array(h.buffer);let f=0,m=0,g=0,v=n.verticalOffsets,w=1/0,_=-1/0,T=!1,x=!1,E=0;for(let C=0;C<n.count;C++)r(C,l),f+=+(l.externalColor[3]<1),m+=+(l.externalColorMixMode===$s.Replace&&l.externalColor[3]===1),g+=+l.castShadows,eIe(l.externalColor,l.externalColorMixMode,h),h[2]=254&h[2]|+l.castShadows,c.setData(a[C],0,h[0],h[1],h[2],h[3]),T||(T=C>0&&E!==p[0]),E=p[0],x||(x=l.elevationOffset!==0),x&&R(v)&&(v=new Array(C).fill(0)),b(v)&&(v[C]=l.elevationOffset),w=Math.min(w,l.elevationOffset),_=Math.max(_,l.elevationOffset),yLe(l.elevationOffset,h),c.setData(a[C],1,h[0],h[1],h[2],h[3]),l.pickable!==pLe(n.pickability,C)&&(n.pickability=qEt(n.pickability,n.count,C,l.pickable));n.verticalOffsets=x?v:null,i.offsetObb=x?DEt(i.obb,w,_,this._viewingMode,b(i.offsetObb)?i.offsetObb:jge(i.obb)):null,T||x?(s.componentParameters=new w3,s.componentParameters.castShadows=oH(g,n.count),s.componentParameters.transparent=oH(f,n.count),s.componentParameters.opaqueOverride=oH(m,n.count),s.componentParameters.texture=c,c.updateTexture()):(s.componentParameters=new MP,s.componentParameters.castShadows=l.castShadows?$n.All:$n.None,s.componentParameters.externalColor=l.externalColor,s.componentParameters.externalColorMixMode=l.externalColorMixMode),this._notifyDirty()}getComponentAabb(t,r,i,s=!1){t.intersectionGeometry.getComponentAabb(r,i);const n=t,o=n.components.verticalOffsets;if(s||R(o))return i;const a=o[r];if(this._viewingMode===Be.Local||a===0)return i[2]+=a,i[5]+=a,i;const l=oct(a);return l.localOrigin=n.transform.position,l.applyToAabb(i)}getComponentObb(t){return t.obb}getObjectTransform(t){return t.transform}getComponentPositions(t,r,i){return t.intersectionGeometry.getComponentPositions(r,i)}intersect(t,r,i,s,n,o){const a=t;b(n)&&(n.localOrigin=a.transform.position);const l=sS(dye,a.transform.rotationScale);su(o4,r,a.transform.position),su(a4,i,a.transform.position),Hc(o4,o4,l),Hc(a4,a4,l);const c=jd(dye,l);return a.intersectionGeometry.intersect(o4,a4,s,c,n,a.components.verticalOffsets,o)}addEdges(t,r,i,s){const n=t,{indices:o,positions:a}=n.intersectionGeometry,l=n.components.offsets;return r.addComponentObject(t,n.transform,{center:n.obb.center,radius:mEt(n.obb)},a,o,l,i,s)}async extractEdgeInformation(t,r,i){const s=t,n=s.components.visibility;if(n.allInvisible())return{buffer:mne.createBuffer(0),origin:[0,0,0]};const{indices:o,positions:a}=s.intersectionGeometry,l=s.components.offsets,c=S$.createBuffer(a.count);u8(c.position,a),G1(c.position,c.position,s.transform.rotationScale),this._setComponentIndices(c.componentIndex,o,l);const h=c.count,p=this._computeVisibilityIndices(o,n,l,h);return{origin:Qs(s.transform.position),buffer:await r.extractComponentsEdgeLocations({indices:p,indicesLength:p.length,skipDeduplicate:!0,data:c,writerSettings:{reducedPrecision:!1,variants:0}},i)}}_setComponentIndices(t,r,i){let s=0;for(let n=0;n<i.length-1;n++){const o=i[n],a=i[n+1];for(let l=o;l<a;l++){const c=r?r[l]:l;t.set(c,s)}s++}}_computeVisibilityIndices(t,r,i,s){if(t&&r.allVisible())return t;let n=0;r.forEachComponentRange((l,c)=>(n+=i[c]-i[l],!0));const o=(t==null?void 0:t.BYTES_PER_ELEMENT)===2||s<=65536?new Uint16Array(n):new Uint32Array(n);let a=0;return r.forEachComponentRange((l,c)=>{const h=i[l],p=i[c];for(let f=h;f<p;f++)o[a++]=t?t[f]:f;return!0}),o}addComponentHighlight(t,r){const i=t.components;R(i.highlightCounts)&&(i.highlightCounts=new Uint32Array(i.count+1)),i.highlightCounts[r]++===0&&(i.highlightsDirty(),this._notifyDirty()),i.highlightCounts[i.count]++}removeComponentHighlight(t,r){const i=t.components;if(R(i.highlightCounts))return void hye.warn("Removing non-existing highlight.");const s=i.highlightCounts[r],n=i.highlightCounts[i.count];if(s!==0){if(s>1)return i.highlightCounts[r]=s-1,void(i.highlightCounts[i.count]=n-1);i.highlightCounts[r]=0,i.highlightsDirty(),this._notifyDirty(),n===1?i.highlightCounts=null:i.highlightCounts[i.count]=n-1}else hye.warn("Removing non-existing highlight.")}clearHighlights(t){const r=t.components;b(r.highlightCounts)&&(r.highlightCounts=null,r.highlightsDirty(),this._notifyDirty())}getObjectGPUMemoryUsage(t){return t.renderable.meta.gpuMemoryEstimate}get visibleObjects(){return this._objects[RC.Visible]}_createRenderable(t,r){const i=this._renderManager.rctx,s=t.geometry,n=s.vertices.layoutParameters,o=cr.createVertex(i,Cr.STATIC_DRAW,s.vertices.data),a=mn(s.indices,v=>cr.createIndex(i,Cr.STATIC_DRAW,v)),l=du(cCt(n)),c=new Uint16Array(s.vertices.count);for(let v=0;v<r.count;v++){const w=r.offsets[v],_=r.offsets[v+1],T=r.materialDataIndices[v];if(b(s.indices))for(let x=w;x<_;x++)c[s.indices[x]]=T;else for(let x=w;x<_;x++)c[x]=T}const h=cr.createVertex(i,Cr.STATIC_DRAW,c.buffer),p=new qn(t.transform,t.toMapSpace),f=new rn(i,p.attributeLocations,{data:l,componentIndices:qCt},{data:o,componentIndices:h},a),m=new mLe(f,Lt.TRIANGLES,n,b(a)),g={cameraDepthSquared:.5,gpuMemoryEstimate:o.byteSize+h.byteSize+(b(a)?a.byteSize:0)};return new eCt(p,m,g)}_notifyDirty(){this._renderManager.notifyDirty()}}const qCt=du(ps().u16(O.COMPONENTINDEX));function oH(e,t){return e===t?$n.All:e===0?$n.None:$n.Some}const dye=Ky(),o4=M(),a4=M();class RLe extends nn{constructor(){super(...arguments),this.overlayIndex=0,this.opacity=1}}function WCt(e){const t=new Yr;t.include(K1);const r=t.fragment;switch(e.function){case Gc.Standard:r.uniforms.add(new Ht("tex",i=>i.texture)),e.hasOpacityFactor?(r.uniforms.add(new qe("opacity",i=>i.opacity)),r.code.add(S`void main() {
gl_FragColor = texture2D(tex, uv) * opacity;
}`)):r.code.add(S`void main() {
gl_FragColor = texture2D(tex, uv);
}`);break;case Gc.OverlayWithTransparency:r.uniforms.add(new Ht("tex",i=>i.texture)),r.uniforms.add(new IL("overlayIdx",i=>i.overlayIndex)),e.hasOpacityFactor&&r.uniforms.add(new qe("opacity",i=>i.opacity)),r.code.add(S`
        void main() {
          vec2 overlayUV = overlayIdx == 0 ? vec2(uv.x * 0.5, uv.y) : vec2(uv.x * 0.5 + 0.5, uv.y);
          gl_FragColor = texture2D(tex, overlayUV) ${e.hasOpacityFactor?"* opacity":""};
        }`);break;case Gc.TransparentToHUDVisibility:r.uniforms.add(new Ht("tex",i=>i.texture)),r.code.add(S`void main() {
gl_FragColor = vec4(1.0 - texture2D(tex, uv).a);
}`);break;case Gc.Transparency:r.uniforms.add([new Ht("colorTexture",i=>i.colorTexture),new Ht("alphaTexture",i=>i.alphaTexture),new Ht("frontFaceTexture",i=>i.frontFaceTexture)]),r.code.add(S`void main() {
vec4 srcColor = texture2D(colorTexture, uv);
if(srcColor.a <= 1e-5){
discard;
}
float srcAlpha = texture2D(alphaTexture, uv).r;
vec4 frontFace = texture2D(frontFaceTexture, uv);
gl_FragColor = vec4(mix(srcColor.rgb/srcColor.a, frontFace.rgb, frontFace.a), 1.0 - srcAlpha);
}`);break;case Gc.COUNT:break;default:e.function}return t}const XCt=Object.freeze(Object.defineProperty({__proto__:null,CompositingPassParameters:RLe,build:WCt},Symbol.toStringTag,{value:"Module"}));class E$ extends gi{initializeProgram(t){const r=E$.shader.get().build(this.configuration);return new oi(t.rctx,r,zr)}initializePipeline(){if(this.configuration.function===Gc.TransparentToHUDVisibility)return Gt({colorWrite:{r:!1,g:!0,b:!1,a:!1}});switch(this.configuration.alphaMode){case Ko.None:return Gt({colorWrite:or});case Ko.Alpha:return Gt({blending:No(Ae.SRC_ALPHA,Ae.ONE,Ae.ONE_MINUS_SRC_ALPHA,Ae.ONE_MINUS_SRC_ALPHA),colorWrite:or});default:return Gt({blending:bg(Ae.ONE,Ae.ONE_MINUS_SRC_ALPHA),colorWrite:or})}}}E$.shader=new ni(XCt,()=>ie(()=>import("./Compositing.glsl.91e0c8fd.js"),[],import.meta.url));class ZCt{constructor(t,r){this._rctx=t,this._techniqueRepository=r,this._configuration=new ik,this._passParameters=new RLe}dispose(){this._vao=Ye(this._vao)}compositeTransparent(t,r,i,s,n=1){this._configuration.alphaMode=Ko.Alpha,this._configuration.function=Gc.Transparency,this._configuration.hasOpacityFactor=n!==1,this._passParameters.colorTexture=r,this._passParameters.alphaTexture=i,this._passParameters.frontFaceTexture=s;const o=this._rctx,a=this._techniqueRepository.acquire(E$,this._configuration);o.bindTechnique(a,this._passParameters,t);const l=this._ensureVAO();o.bindVAO(l),o.drawArrays(Lt.TRIANGLE_STRIP,0,ta(l,"geometry")),a.release()}composite(t,r,i=Ko.None,s=1,n=Gc.Standard,o=Gi.INNER){const a=this._rctx;this._configuration.alphaMode=i,this._configuration.function=n,this._configuration.hasOpacityFactor=s!==1,this._passParameters.overlayIndex=o,this._passParameters.texture=r,this._passParameters.opacity=s;const l=this._techniqueRepository.acquire(E$,this._configuration);a.bindTechnique(l,this._passParameters,t);const c=this._ensureVAO();a.bindVAO(c),a.drawArrays(Lt.TRIANGLE_STRIP,0,ta(c,"geometry")),l.release()}_ensureVAO(){return R(this._vao)&&(this._vao=_l(this._rctx)),this._vao}}const YCt=1e4,yJ=100,QCt=500,JCt=500,KCt=.1;function eAt(e,t,r){return ase(t,e)*(r[1]-r[0])+r[0]}function tAt(e,t,r){if(t.size<YCt)return cAt.compute(e,t);const i=FL();return r.forAll(s=>{s.isVisible&&QA(i,rAt(e,s))}),i}function rAt(e,t){if(!t.isVisible)return;const r=FL(),i=t.getSpatialQueryAccelerator();return b(i)?iAt(r,e,i):sAt(r,e,t.objects),r}function iAt(e,t,r){const i=t.eye,s=t.viewForward,n=t.frustum,o=l=>l.isVisible,a=r.objectCount;if(a<QCt)T$(hd,t.near,Math.min(e.near,t.far)),r.forEachInDepthRange(i,s,lf.DepthOrder.FRONT_TO_BACK,hd,(l,c)=>{vJ(e,t,l),hd.far=e.near,c.setRange(hd)},n,o),T$(hd,Math.max(e.far,t.near),t.far),r.forEachInDepthRange(i,s,lf.DepthOrder.BACK_TO_FRONT,hd,(l,c)=>{vJ(e,t,l),hd.near=e.far,c.setRange(hd)},n,o);else{const l=Math.max(Math.min(a,JCt),Math.ceil(a*KCt)),c=r.findClosest(s,lf.DepthOrder.FRONT_TO_BACK,n,o,l),h=r.findClosest(s,lf.DepthOrder.BACK_TO_FRONT,n,o,l);c&&h&&(pye(e,t,c.boundingVolumeWorldSpace.bounds),pye(e,t,h.boundingVolumeWorldSpace.bounds))}}function sAt(e,t,r){l2.clear(),r.forAll(i=>{i.isVisible&&i.geometryRecords.length!==0&&l2.add(i)}),l2.empty||(l2.sort(t),T$(hd,t.near,Math.min(e.near,t.far)),l2.forEachInDepthRange(hd,lf.DepthOrder.FRONT_TO_BACK,(i,s)=>{s<e.near&&vJ(e,t,i)}),T$(hd,Math.max(e.far,t.near),t.far),l2.forEachInDepthRange(hd,lf.DepthOrder.BACK_TO_FRONT,(i,s,n)=>{e.far=Math.max(e.far,n)}))}function vJ(e,t,r){if(!r.isVisible||!q_(t.frustum,r.boundingVolumeWorldSpace.bounds))return;const i=r.transformation,s=lAt;r.geometryRecords.forEach(n=>{Yi(s,i,n.getShaderTransformation());const o=pT(s);OLe(e,t,n.geometry.boundingInfo,s,o)})}function OLe(e,t,r,i,s){if(R(r))return;const n=t.eye,o=t.viewForward;Ve(Yo,r.center,i);const a=o[0]*(Yo[0]-n[0])+o[1]*(Yo[1]-n[1])+o[2]*(Yo[2]-n[2]);if(Yo[3]=r.radius*s,!(a-Yo[3]>e.near&&a+Yo[3]<e.far)&&q_(t.frustum,Yo))if(r.radius>yJ&&r.getChildren()){const l=r.getChildren();for(let c=0;c<8;++c)l[c]&&OLe(e,t,l[c],i,s)}else _J.unionDepthRangeWithAABB(e,t.viewProjectionMatrix,i,r.bbMin,r.bbMax)}function pye(e,t,r){const i=t.eye,s=t.viewForward,n=(r[0]-i[0])*s[0]+(r[1]-i[1])*s[1]+(r[2]-i[2])*s[2];e.near=Math.min(e.near,n-r[3]),e.far=Math.max(e.far,n+r[3])}class nAt{constructor(){this._items=new Xt({allocator:t=>t||{obj:null,distance:0,near:0,far:0},deallocator:t=>(t.obj=null,t.distance=0,t.near=0,t.far=0,t)})}get length(){return this._items.length}get empty(){return this._items.length===0}clear(){this._items.clear()}add(t){this._items.pushNew().obj=t}sort(t){const r=t.eye,i=t.viewForward;this._items.forAll(s=>{const n=s.obj.boundingVolumeWorldSpace.bounds,o=(n[0]-r[0])*i[0]+(n[1]-r[1])*i[1]+(n[2]-r[2])*i[2];s.distance=o,s.near=o-n[3],s.far=o+n[3]}),this._items.sort((s,n)=>s.distance-n.distance)}forEachInDepthRange(t,r,i){if(r===lf.DepthOrder.FRONT_TO_BACK)for(let s=0;s<this._items.length;++s){const n=this._items.data[s];n.far<t.near||n.near>t.far||i(n.obj,n.near,n.far)}else for(let s=this._items.length-1;s>=0;--s){const n=this._items.data[s];n.far<t.near||n.near>t.far||i(n.obj,n.near,n.far)}}}class oAt{constructor(){this.view=Ce(),this.viewProj=Ce(),this.frustum=e$(),this.geometries=[],this.near=[],this.far=[],this.nearCandidates=[],this.farCandidates=[],this.range={near:0,far:0},this.looseRange={near:0,far:0}}compute(t,r){this._reset(),Is(this.view,t.viewMatrix),Yi(this.viewProj,t.projectionMatrix,this.view),$V(this.frustum,t.frustum);const i=this.view,s=i[2],n=i[6],o=i[10],a=i[14],l=this.range;let c=0;if(r.forEach(m=>{if(!m.instanceParameters.visible||!m.castShadow)return;let g;m.hasShaderTransformation?(m.computeBoundingSphere(m.getShaderTransformation(),Yo,1),g=Yo):g=m.boundingSphere;const v=s*g[0]+n*g[1]+o*g[2]+a,w=v-g[3],_=v+g[3];this.geometries[c]=m,this.near[c]=-_,this.far[c]=-w,++c}),this.geometries.length===0)return l;for(let m=0;m<this.geometries.length;++m)this.near[m]>l.far&&(l.far=this.near[m]),this.near[m]>2&&this.far[m]<l.near&&(l.near=this.far[m]);const h=this.looseRange;h.near=Math.max(.5*l.near,2),h.far=2*l.far;let p=0,f=0;for(let m=0;m<this.geometries.length;++m)this.near[m]<l.near&&(this.near[m]>=h.near?l.near=this.near[m]:this.nearCandidates[p++]=m),this.far[m]>l.far&&(this.far[m]<=h.far?l.far=this.far[m]:this.farCandidates[f++]=m);if(this.nearCandidates.length===0&&this.farCandidates.length===0)return l;this.nearCandidates.sort((m,g)=>this.near[m]<this.near[g]?-1:this.near[m]>this.near[g]?1:0),this.farCandidates.sort((m,g)=>this.far[m]<this.far[g]?1:this.far[m]>this.far[g]?-1:0);for(let m=0;m<this.nearCandidates.length;++m){const g=this.nearCandidates[m];if(this.near[g]<l.near){const v=this.geometries[g],w=v.boundingInfo;this._includeNearBoundingInfoRec(w,v.getShaderTransformation())}}for(let m=0;m<this.farCandidates.length;++m){const g=this.farCandidates[m];if(this.far[g]>l.far){const v=this.geometries[g],w=v.boundingInfo;this._includeFarBoundingInfoRec(w,v.getShaderTransformation())}}return l}_reset(){this.geometries.length=0,this.near.length=0,this.far.length=0,this.nearCandidates.length=0,this.farCandidates.length=0,this.range.near=Number.MAX_VALUE,this.range.far=-Number.MAX_VALUE}_includeNearBoundingInfoRec(t,r){if(R(t))return;const i=t.getCenter();Ve(Yo,i,r);const s=pT(r),n=Yo[0],o=Yo[1],a=Yo[2],l=t.getBSRadius()*s,c=this.frustum;if(c[0][0]*n+c[0][1]*o+c[0][2]*a+c[0][3]>l||c[1][0]*n+c[1][1]*o+c[1][2]*a+c[1][3]>l||c[2][0]*n+c[2][1]*o+c[2][2]*a+c[2][3]>l||c[3][0]*n+c[3][1]*o+c[3][2]*a+c[3][3]>l)return;const h=this.view[2]*n+this.view[6]*o+this.view[10]*a+this.view[14],p=h+l;if(!(-(h-l)<2||-p>=this.range.near))if(-p>this.looseRange.near)this.range.near=-p;else{if(l>yJ){const f=t.getChildren();if(f!==void 0){for(let m=0;m<8;++m)f[m]!==void 0&&this._includeNearBoundingInfoRec(f[m],r);return}}_J.unionDepthRangeWithAABB(this.range,this.viewProj,r,t.getBBMin(),t.getBBMax())}}_includeFarBoundingInfoRec(t,r){if(R(t))return;let i=t.getBSRadius();const s=t.getCenter();Ve(Yo,s,r);const n=pT(r),o=Yo[0],a=Yo[1],l=Yo[2];i*=n;const c=this.frustum;if(c[0][0]*o+c[0][1]*a+c[0][2]*l+c[0][3]>i||c[1][0]*o+c[1][1]*a+c[1][2]*l+c[1][3]>i||c[2][0]*o+c[2][1]*a+c[2][2]*l+c[2][3]>i||c[3][0]*o+c[3][1]*a+c[3][2]*l+c[3][3]>i)return;const h=this.view[2]*o+this.view[6]*a+this.view[10]*l+this.view[14]-i;if(!(-h<=this.range.far))if(-h<this.looseRange.far)this.range.far=-h;else{if(i>yJ){const p=t.getChildren();if(p!==void 0){for(let f=0;f<8;++f)p[f]!==void 0&&this._includeFarBoundingInfoRec(p[f],r);return}}_J.unionDepthRangeWithAABB(this.range,this.viewProj,r,t.getBBMin(),t.getBBMax())}}}class aAt{constructor(){this.modelViewProj=Ce(),this.clipPosition=[Zt(),Zt(),Zt(),Zt(),Zt(),Zt(),Zt(),Zt()]}unionDepthRangeWithAABB(t,r,i,s,n){const o=this.modelViewProj;Yi(o,r,i);let a=!1;for(let l=0;l<8;++l){const c=this.clipPosition[l],h=l===0||l===3||l===4||l===7?s[0]:n[0],p=l===0||l===1||l===4||l===5?s[1]:n[1],f=l<4?s[2]:n[2];c[0]=o[0]*h+o[4]*p+o[8]*f+o[12],c[1]=o[1]*h+o[5]*p+o[9]*f+o[13],c[2]=o[2]*h+o[6]*p+o[10]*f+o[14],c[3]=o[3]*h+o[7]*p+o[11]*f+o[15]}for(let l=0;l<12;++l){const c=this.clipPosition[aH[l][0]],h=this.clipPosition[aH[l][1]],p=this.clipPosition[aH[l][2]],f=this._clipTriangle(c,h,p);let m=!0;for(let g=0;g<f.length;++g)if(f[g][3]>=2){m=!1;break}if(!m){a=!0;for(let g=0;g<f.length;++g){const v=f[g][3];v<t.near&&(t.near=v),v>t.far&&(t.far=v)}}}return a}_inside(t,r){return r===0?t[0]>=-t[3]:r===1?t[1]>=-t[3]:r===2?t[0]<=t[3]:r===3?t[1]<=t[3]:void ft(!1)}_intersect(t,r,i){let s=0;return i===0?s=(-t[3]-t[0])/(r[0]-t[0]+r[3]-t[3]):i===1?s=(-t[3]-t[1])/(r[1]-t[1]+r[3]-t[3]):i===2?s=(t[3]-t[0])/(r[0]-t[0]-r[3]+t[3]):i===3&&(s=(t[3]-t[1])/(r[1]-t[1]-r[3]+t[3])),Kz(Zt(),t,r,s)}_clipTriangle(t,r,i){let s=[t,r,i];for(let n=0;n<4;++n){const o=s;s=[];for(let a=0;a<o.length;++a){const l=o[a],c=o[(a+1)%o.length];this._inside(c,n)?(this._inside(l,n)||s.push(this._intersect(l,c,n)),s.push(c)):this._inside(l,n)&&s.push(this._intersect(l,c,n))}}return s}}const aH=[[0,1,3],[2,3,1],[1,5,2],[6,2,5],[5,4,6],[7,6,4],[4,0,7],[3,7,0],[3,2,7],[6,7,2],[4,5,0],[1,0,5]],Yo=kn(),lAt=Ce(),hd=FL(),l2=new nAt,cAt=new oAt,_J=new aAt;class uAt extends nn{constructor(){super(...arguments),this.maskEnabled=!1,this.overlayEnabled=!1}}function hAt(){const e=new Yr;return e.attributes.add(O.POSITION,"vec2"),e.vertex.uniforms.add(new hl("drawPosition")),e.varyings.add("vUV","vec2"),e.vertex.code.add(S`void main(void) {
vUV = position;
gl_Position = vec4(drawPosition.xy + vec2(position - 0.5) * drawPosition.zw, 0.0, 1.0);
}`),e.fragment.uniforms.add(new Hi("textureInput")),e.fragment.uniforms.add(new Hi("textureMask")),e.fragment.uniforms.add(new Hi("textureOverlay")),e.fragment.uniforms.add(new wT("maskEnabled",t=>t.maskEnabled)),e.fragment.uniforms.add(new wT("overlayEnabled",t=>t.overlayEnabled)),e.fragment.code.add(S`const float barrelFactor = 1.1;
vec2 barrel(vec2 uv) {
vec2 uvn = uv * 2.0 - 1.0;
if (uvn.x == 0.0 && uvn.y == 0.0) {
return vec2(0.5, 0.5);
}
float theta = atan(uvn.y, uvn.x);
float r = pow(length(uvn), barrelFactor);
return r * vec2(cos(theta), sin(theta)) * 0.5 + 0.5;
}
void main() {
float mask = maskEnabled ? texture2D(textureMask, vUV).a : 1.0;
vec4 inputColor = texture2D(textureInput, barrel(vUV)) * mask;
vec4 overlayColor = overlayEnabled ? texture2D(textureOverlay, vUV) : vec4(0);
gl_FragColor = overlayColor + (1.0 - overlayColor.a) * inputColor;
}`),e}async function dAt(e){const t=ie(()=>import("./mask-svg.6e459ce6.js"),[],import.meta.url),r=ie(()=>import("./overlay-svg.3a82a35c.js"),[],import.meta.url),i=Sf((await t).default,{signal:e}),s=Sf((await r).default,{signal:e}),n={mask:await i,overlay:await s};return Jt(e),n}let rE=class extends xe{constructor(){super(...arguments),this._handles=new Dt,this._magnifier=null,this._imageSources=null,this._imageLoadTask=null,this._resources=null,this._passParameters=new uAt,this.events=new ds,this.attributeLocations=new Map([[O.POSITION,0]]),this.tmpScreenPoint=ts(),this.tmpRenderPoint=tBe()}get updating(){return R(this._imageSources)&&b(this._imageLoadTask)&&!this._imageLoadTask.task.finished}get magnifier(){return this._magnifier}set magnifier(e){if(e===this._magnifier)return;this._handles.removeAll(),this._magnifier=e;const t=()=>{this._updateResourceLoading(),this.events.emit("request-render")};b(this._magnifier)&&this._handles.add(te(()=>mn(this._magnifier,r=>r.version),t)),t()}get enabled(){return b(this._validMagnifier)}get _validMagnifier(){return b(this._magnifier)&&this._magnifier.visible&&b(this._magnifier.position)&&this._magnifier.size>0?this._magnifier:null}get factor(){return b(this._magnifier)&&this._magnifier.factor||1}dispose(){this._magnifier=null,this._handles.destroy(),b(this._imageLoadTask)&&(this._imageLoadTask.task.abort(),this._imageLoadTask=null),this._disposeResources()}render(e,t){const r=this._validMagnifier;if(R(r))return;const i=t.camera.pixelRatio,s=Math.ceil(i*r.size);if(this._updateResources(e,s),R(this._resources))return;this._passParameters.maskEnabled=r.maskEnabled,this._passParameters.overlayEnabled=r.overlayEnabled;const n=this._resources.program;e.useProgram(n),n.bindPass(this._passParameters,t);const o=this._resources.textures,a=Math.ceil(1/this.factor*s);o.input.resize(a,a);const l=t.camera.fullWidth,c=t.camera.fullHeight;My(r.position,this.tmpScreenPoint);const h=t.camera.screenToRender(this.tmpScreenPoint,this.tmpRenderPoint),p=.5*a,f=.5*a;h[0]=Le(h[0],p,l-p-1),h[1]=Le(h[1],f,c-f-1);const m=Math.floor(h[0]-p),g=Math.floor(h[1]-f);n.bindTexture("textureInput",o.input),e.gl.copyTexImage2D(o.input.descriptor.target,0,o.input.descriptor.pixelFormat,m,g,a,a,0);const v=r.offset.x*i,w=r.offset.y*i,_=(h[0]+v)/l*2-1,T=(h[1]-w)/c*2-1,x=s/l*2,E=s/c*2;e.bindVAO(this._resources.vao),n.bindTexture("textureOverlay",o.overlay),n.bindTexture("textureMask",o.mask),n.setUniform4f("drawPosition",_,T,x,E),e.setPipelineState(this._resources.pipelineState),e.drawArrays(Lt.TRIANGLE_STRIP,0,4)}_updateResourceLoading(){const e=this._validMagnifier;if(R(e))return;const t=e.maskUrl,r=e.overlayUrl;!b(this._imageLoadTask)||this._imageLoadTask.maskUrl===t&&this._imageLoadTask.overlayUrl===r||(this._imageLoadTask.task.abort(),this._imageLoadTask=null,this._imageSources=null),b(this._imageSources)||b(this._imageLoadTask)||(this._imageLoadTask={maskUrl:t,overlayUrl:r,task:B$(async i=>{const s=R(t)||R(r)?dAt(i):null,n=b(t)?Sf(t,{signal:i}):s.then(a=>a.mask),o=b(r)?Sf(r,{signal:i}):s.then(a=>a.overlay);this._imageSources={mask:await n,overlay:await o},this._disposeResources(),this.events.emit("request-render")})},this._imageLoadTask.task.promise.then(()=>this.notifyChange("updating"),()=>this.notifyChange("updating")))}_updateResources(e,t){if(!this.enabled)return void this._disposeResources();if(b(this._resources)){if(this._resources.textures.size!==t){const i=this._createTextureResources(e,t);if(R(i))return void this._disposeResources();this._disposeTextureResources(this._resources.textures),this._resources.textures=i}return}const r=this._createTextureResources(e,t);R(r)||(this._resources={textures:r,program:this._createProgram(e),vao:_l(e,oie,this.attributeLocations,0,1),pipelineState:Gt({blending:bg(Ae.ONE,Ae.ONE_MINUS_SRC_ALPHA),depthTest:null,depthWrite:null,colorWrite:or})})}_disposeResources(){R(this._resources)||(this._disposeTextureResources(this._resources.textures),this._resources.program.dispose(),this._resources.vao.dispose(),this._resources=null)}_disposeTextureResources(e){e.mask.dispose(),e.overlay.dispose(),e.input.dispose()}_createTextureResources(e,t){if(R(this._imageSources))return null;this._imageSources.overlay.width=t,this._imageSources.overlay.height=t,this._imageSources.mask.width=t,this._imageSources.mask.height=t;const r=new nt(e,{target:mt.TEXTURE_2D,pixelFormat:ze.RGBA,internalFormat:ze.RGBA,dataType:Ct.UNSIGNED_BYTE,wrapMode:xt.CLAMP_TO_EDGE,samplingMode:et.LINEAR,flipped:!0,preMultiplyAlpha:!tee(this._imageSources.overlay.src)||!e.driverTest.svgAlwaysPremultipliesAlpha},this._imageSources.overlay),i=new nt(e,{target:mt.TEXTURE_2D,pixelFormat:ze.ALPHA,internalFormat:ze.ALPHA,dataType:Ct.UNSIGNED_BYTE,wrapMode:xt.CLAMP_TO_EDGE,samplingMode:et.LINEAR,flipped:!0},this._imageSources.mask);return{input:new nt(e,{target:mt.TEXTURE_2D,pixelFormat:ze.RGBA,internalFormat:ze.RGBA,dataType:Ct.UNSIGNED_BYTE,wrapMode:xt.CLAMP_TO_EDGE,samplingMode:et.LINEAR,flipped:!1}),mask:i,overlay:r,size:t}}_createProgram(e){return new oi(e,hAt(),this.attributeLocations)}};u([d()],rE.prototype,"_imageSources",void 0),u([d()],rE.prototype,"_imageLoadTask",void 0),u([d({readOnly:!0})],rE.prototype,"updating",null),rE=u([$("esri/views/3d/webgl-engine/lib/MagnifierHelper")],rE);const pAt=.5,fAt=1e3/30;var C$;(function(e){e[e.FrontToBack=0]="FrontToBack",e[e.BackToFront=1]="BackToFront"})(C$||(C$={}));class bv{constructor(t,r,i=C$.FrontToBack){this._rctx=t,this._techniqueRepository=r,this._sorting=i,this._draws=new Xt({initialSize:32,allocator:s=>s||{material:null,geometry:null,geometryRanges:null,bindDrawParams:null,depthSquaredHint:0,indexType:0}}),this._previouslyBoundDraw=new Map}submitDraw(t,r,i,s){const n=this._draws.pushNew();n.geometry=r,n.geometryRanges=i,n.material=t,n.depthSquaredHint=s,n.indexType=r.indexed?r.vao.indexBuffer.indexType:0}dispatch(t,r){const i=this._rctx;this._previouslyBoundDraw.clear();let s=null;const n=this._draws.map(a=>a.material.prepareTechnique(this._techniqueRepository,t,r,a.geometry.parameters)),o=this._draws.length;for(let a=0;a<o;a++){const l=n[a];l===s&&l.configuration.transparencyPassType===yt.NONE||(i.bindTechnique(l,t,r),s=l);const c=this._draws.data[a],h=c.geometry;i.bindVAO(h.vao),this._previouslyBoundDraw.get(l)!==c.material&&(l.bindDraw(c.material,r),this._previouslyBoundDraw.set(l,c.material));const p=c.geometryRanges,f=p.length;if(c.indexType!==0){const m=Sk.get(c.indexType);for(let g=0;g<f;g+=2){const v=p[g],w=p[g+1];i.drawElements(h.primitiveType,w,c.indexType,v*m)}}else for(let m=0;m<f;m+=2){const g=p[m],v=p[m+1];i.drawArrays(h.primitiveType,g,v)}}}prepareSubmit(){this._draws.clear()}finishSubmit(){const t=this._sorting===C$.FrontToBack?1:-1;this._draws.sort((r,i)=>{const s=t*(r.depthSquaredHint-i.depthSquaredHint);return s!==0?s:r.geometry.vao.size-i.geometry.vao.size})}get count(){return this._draws.length}}const Sk=new Map;Sk.set(pt.UNSIGNED_BYTE,1),Sk.set(pt.UNSIGNED_SHORT,2),Sk.set(pt.UNSIGNED_INT,4);class mAt{constructor(t,r){this.rctx=t,this.shaderTechniqueRepository=r,this.canRender=!0,this._materialPassParameters=new f2t,this._shadowPassParameters=new m2t,this._highlightPassParameters=new g2t,this._systems=new Set,this._passes={materialOpaque:new bv(t,r),materialTransparent:new bv(t,r,C$.BackToFront),materialIntegratedMesh:new bv(t,r),shadowMap:new bv(t,r),highlight:new bv(t,r),highlightIntegratedMesh:new bv(t,r),highlightShadowMap:new bv(t,r),defaultShadowMap:new bv(t,r)}}register(t){this._systems.add(t)}prepareRender(t){if(this._systems.size!==0){for(const r of Object.values(this._passes))r.prepareSubmit();this._systems.forEach(r=>r.submit(this._passes,t.bindParameters));for(const r of Object.values(this._passes))r.finishSubmit();this.shaderTechniqueRepository.frameUpdate()}}render(t){if(this._systems.size!==0)switch(this._configure(t),t.bindParameters.slot){case Se.OPAQUE_MATERIAL:switch(t.pass){case je.MATERIAL:return this._materialPassParameters.subPass=To.Color,this._passes.materialOpaque.dispatch(this._materialPassParameters,t.bindParameters);case je.MATERIAL_DEPTH:return this._materialPassParameters.subPass=To.Depth,this._passes.materialOpaque.dispatch(this._materialPassParameters,t.bindParameters);case je.MATERIAL_NORMAL:return this._materialPassParameters.subPass=To.Normal,this._passes.materialOpaque.dispatch(this._materialPassParameters,t.bindParameters);case je.MATERIAL_HIGHLIGHT:return this._passes.highlight.dispatch(this._highlightPassParameters,t.bindParameters);case je.MATERIAL_DEPTH_SHADOWMAP_ALL:return this._passes.shadowMap.dispatch(this._shadowPassParameters,t.bindParameters);case je.MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT:return this._passes.highlightShadowMap.dispatch(this._shadowPassParameters,t.bindParameters);case je.MATERIAL_DEPTH_SHADOWMAP_DEFAULT:return this._passes.defaultShadowMap.dispatch(this._shadowPassParameters,t.bindParameters)}return;case Se.TRANSPARENT_MATERIAL:switch(t.pass){case je.MATERIAL:return this._materialPassParameters.subPass=To.Color,this._passes.materialTransparent.dispatch(this._materialPassParameters,t.bindParameters);case je.MATERIAL_ALPHA:return this._materialPassParameters.subPass=To.Alpha,this._passes.materialTransparent.dispatch(this._materialPassParameters,t.bindParameters);case je.MATERIAL_DEPTH:return this._materialPassParameters.subPass=To.Depth,this._passes.materialTransparent.dispatch(this._materialPassParameters,t.bindParameters);case je.MATERIAL_NORMAL:return this._materialPassParameters.subPass=To.Normal,this._passes.materialTransparent.dispatch(this._materialPassParameters,t.bindParameters)}return;case Se.INTEGRATED_MESH:switch(t.pass){case je.MATERIAL:return this._materialPassParameters.subPass=To.Color,this._passes.materialIntegratedMesh.dispatch(this._materialPassParameters,t.bindParameters);case je.MATERIAL_DEPTH:return this._materialPassParameters.subPass=To.Depth,this._passes.materialIntegratedMesh.dispatch(this._materialPassParameters,t.bindParameters);case je.MATERIAL_NORMAL:return this._materialPassParameters.subPass=To.Normal,this._passes.materialIntegratedMesh.dispatch(this._materialPassParameters,t.bindParameters);case je.MATERIAL_HIGHLIGHT:return this._passes.highlightIntegratedMesh.dispatch(this._highlightPassParameters,t.bindParameters)}return}}notifyDirty(){this._context.requestRender()}slots(){return[Se.OPAQUE_MATERIAL,Se.TRANSPARENT_MATERIAL,Se.INTEGRATED_MESH]}initializeRenderContext(t){this._context=t}uninitializeRenderContext(){}queryDepthRange(t){const r={near:1/0,far:-1/0};return this._systems.forEach(i=>{const s=i.queryShadowCasterDepthRange(t);b(s)&&QA(r,s,r)}),r}_configure(t){const r=t.pass===je.MATERIAL_DEPTH_SHADOWMAP_ALL||t.pass===je.MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT||t.pass===je.MATERIAL_DEPTH_SHADOWMAP_DEFAULT?this._shadowPassParameters:t.pass===je.MATERIAL_HIGHLIGHT?this._highlightPassParameters:this._materialPassParameters;this._updateParameters(t,r)}_updateParameters(t,r){const i=t.bindParameters.camera,s=i.viewInverseTransposeMatrix;se(lH,s[3],s[7],s[11]),cH.set(lH),ae(r.transformWorldFromViewTH,cH.high),ae(r.transformWorldFromViewTL,cH.low),ae(r.slicePlaneLocalOrigin,lH),Gd(r.transformViewFromCameraRelativeRS,i.viewMatrix),Is(r.transformProjFromView,i.projectionMatrix),r.identifier===th.Material&&(this._materialPassParameters.transparent=t.bindParameters.slot===Se.TRANSPARENT_MATERIAL,this._materialPassParameters.integratedMesh=t.bindParameters.slot===Se.INTEGRATED_MESH,jd(fye,r.transformViewFromCameraRelativeRS),sS(r.transformNormalViewFromGlobal,fye))}get needsHighlight(){return this._passes.highlight.count>0||this._passes.highlightIntegratedMesh.count>0}get needsTransparentPass(){return this._passes.materialTransparent.count>0}}const lH=M(),fye=$i(),cH=new O8,gAt=8.6,yAt=.4;function vAt(){const e=new Yr,{vertex:t,fragment:r}=e,i=t.code,s=r.code;return e.attributes.add(O.POSITION,"vec2"),e.varyings.add("uv","vec2"),e.attributes.add(O.UV0,"vec2"),t.uniforms.add(new Ht("coverageTex",n=>n.coverageTexture)),i.add(S`void main() {
vec4 cov = texture2D(coverageTex, uv0);
if (cov.r == 0.0) {
gl_Position = vec4(0.0);
return;
}
gl_Position = vec4(position, 0.0, 1.0);
uv = position.xy * 0.5 + vec2(0.5);
}`),r.uniforms.add(new Ht("tex",n=>n.blurColorTexture)),r.uniforms.add(new Ht("origin",n=>n.highlightColorTexture)),r.uniforms.add(new lr("uColor",n=>n.color)),r.uniforms.add(new lr("haloColor",n=>n.haloColor)),r.uniforms.add(new lr("opacities",n=>Kr(_At,n.haloOpacity,n.haloOpacityOccluded,n.fillOpacity,n.fillOpacityOccluded))),r.constants.add("outlineSize","float",gAt),r.constants.add("blurSize","float",yAt),s.add(S`void main() {
vec4 blurredHighlightValue = texture2D(tex, uv);
float highlightIntensity = blurredHighlightValue.a;
if (highlightIntensity == 0.0) {
discard;
}
vec4 origin_color = texture2D(origin, uv);
float outlineIntensity;
float fillIntensity;
if (blurredHighlightValue.g > blurredHighlightValue.b) {
outlineIntensity = haloColor.w * opacities[1];
fillIntensity = uColor.w * opacities[3];
}
else {
outlineIntensity = haloColor.w * opacities[0];
fillIntensity = uColor.w * opacities[2];
}
float inner = 1.0 - outlineSize / 9.0;
float outer = 1.0 - (outlineSize + blurSize) / 9.0;
float outlineFactor = smoothstep(outer, inner, highlightIntensity);
float fillFactor = any(notEqual(origin_color, vec4(0.0, 0.0, 0.0, 0.0))) ? 1.0 : 0.0;
float intensity = outlineIntensity * outlineFactor * (1.0 - fillFactor) + fillIntensity * fillFactor;
gl_FragColor = vec4(mix(haloColor.rgb, uColor.rgb, fillFactor), intensity);
}`),e}const _At=Zt(),bAt=Object.freeze(Object.defineProperty({__proto__:null,build:vAt},Symbol.toStringTag,{value:"Module"}));class M8 extends gi{initializeProgram(t){const r=M8.shader.get().build();return new oi(t.rctx,r,zr)}initializePipeline(){return Gt({blending:No(Ae.SRC_ALPHA,Ae.ONE,Ae.ONE_MINUS_SRC_ALPHA,Ae.ONE_MINUS_SRC_ALPHA),colorWrite:or})}}M8.shader=new ni(bAt,()=>ie(()=>import("./HighlightApply.glsl.d4d8ff57.js"),[],import.meta.url));class MLe extends nn{constructor(){super(...arguments),this.blurSize=rt()}}function wAt(){const e=new Yr,{vertex:t,fragment:r}=e,i=t.code,s=r.code;return e.attributes.add(O.POSITION,"vec2"),e.attributes.add(O.UV0,"vec2"),e.varyings.add("blurCoordinate","vec3"),t.uniforms.add(new Ht("coverageTex",n=>n.coverageTexture)),r.uniforms.add(new pie("blurSize",n=>n.blurSize)),i.add(S`void main() {
gl_Position = vec4(position, 0.0, 1.0);
vec4 cov = texture2D(coverageTex, uv0);
if (cov.r == 0.0) {
gl_Position = vec4(0.0);
}
blurCoordinate = vec3(gl_Position.xy * 0.5 + vec2(0.5), max(cov.g, cov.b));
}`),r.uniforms.add(new fie("tex",n=>n.blurInputTexture)),s.add(S`void main() {
vec2 uv = blurCoordinate.xy;
vec4 center = texture2D(tex, uv);
if (blurCoordinate.z == 1.0) {
gl_FragColor = center;
} else {
vec4 sum = vec4(0.0);
sum += center * 0.204164;
sum += texture2D(tex, uv + blurSize * 1.407333) * 0.304005;
sum += texture2D(tex, uv - blurSize * 1.407333) * 0.304005;
sum += texture2D(tex, uv + blurSize * 3.294215) * 0.093913;
sum += texture2D(tex, uv - blurSize * 3.294215) * 0.093913;
gl_FragColor = sum;
}
}`),e}const xAt=Object.freeze(Object.defineProperty({__proto__:null,HighlightBlurDrawParameters:MLe,build:wAt},Symbol.toStringTag,{value:"Module"}));class P8 extends gi{initializeProgram(t){const r=P8.shader.get().build();return new oi(t.rctx,r,zr)}initializePipeline(){return Gt({colorWrite:or})}}P8.shader=new ni(xAt,()=>ie(()=>import("./HighlightBlur.glsl.e0ae93c3.js"),[],import.meta.url));class PLe extends nn{constructor(){super(...arguments),this.invFramebufferDim=rt()}}function TAt(){const e=new Yr,{vertex:t,fragment:r}=e,i=t.code,s=r.code;return e.attributes.add(O.POSITION,"vec2"),i.add(S`void main() {
gl_Position = vec4(vec2(1.0) - position * 2.0, 0.0, 1.0);
}`),r.uniforms.add(new fie("tex",n=>n.inputTexture)),r.uniforms.add(new pie("invFramebufferDim",n=>n.invFramebufferDim)),s.add(S`void main() {
vec2 coord = gl_FragCoord.xy * invFramebufferDim;
vec4 value = texture2D(tex, coord);
float mx = floor(max(value.g, value.b));
gl_FragColor = vec4(ceil(value.r), mx, mx, 1.0);
}`),e}const SAt=Object.freeze(Object.defineProperty({__proto__:null,HighlightDownsampleDrawParameters:PLe,build:TAt},Symbol.toStringTag,{value:"Module"}));class I8 extends gi{initializeProgram(t){const r=I8.shader.get().build();return new oi(t.rctx,r,zr)}initializePipeline(){return Gt({colorWrite:or})}}I8.shader=new ni(SAt,()=>ie(()=>import("./HighlightDownsample.glsl.a85a9dd5.js"),[],import.meta.url));class mye extends nn{constructor(){super(...arguments),this.color=Xd(1,0,1,1),this.haloColor=Xd(1,0,1,1),this.haloOpacity=1,this.haloOpacityOccluded=.25,this.fillOpacity=.2,this.fillOpacityOccluded=.05,this.shadowColor=xr(1,0,1,1),this.shadowOpacity=.15,this.occludedShadowOpacity=.075}}const EAt=32;class CAt{constructor(t,r){this._techniqueRep=t,this._rctx=r,this.viewportToRestore=Zt(),this._passParameters=new mye,this._downsampleDrawParameters=new PLe,this._blurDrawParameters=new MLe,this._grid={coverageMipmap:null,vao:null,verticalCellCount:0,horizontalCellCount:0,cellPixelSize:0,mipmapLevels:0,viewportWidth:0,viewportHeight:0}}_assertResources(){if(this.quadVAO)return;this.quadVAO=_l(this._rctx);const t={colorTarget:us.TEXTURE,depthStencilTarget:Pr.NONE,width:0,height:0},r={target:mt.TEXTURE_2D,pixelFormat:ze.RGBA,dataType:Ct.UNSIGNED_BYTE,samplingMode:et.LINEAR,wrapMode:xt.CLAMP_TO_EDGE,width:0,height:0};this.blur0Fbo=new Pi(this._rctx,t,r),this.blur1Fbo=new Pi(this._rctx,t,r);const i=new vl;this._blurTechnique=this._techniqueRep.acquire(P8,i),this._downsampleTechnique=this._techniqueRep.acquire(I8,i),this._applyTechnique=this._techniqueRep.acquire(M8,i)}dispose(){if(this._blurTechnique=ti(this._blurTechnique),this._downsampleTechnique=ti(this._downsampleTechnique),this._applyTechnique=ti(this._applyTechnique),this._grid.coverageMipmap)for(let t=1;t<this._grid.coverageMipmap.length;t++)this._grid.coverageMipmap[t].dispose();this._grid.vao&&this._grid.vao.dispose(!0),this.quadVAO&&(this.quadVAO.dispose(!0),this.quadVAO=null),this.blur0Fbo=Ye(this.blur0Fbo),this.blur1Fbo=Ye(this.blur1Fbo)}setDefaultOptions(t){this._passParameters={...new mye,...t}}render(t,r,i){this._passParameters.highlightColorTexture=r.colorTexture,this._assertResources();const s=t.camera;ef(this.viewportToRestore,s.fullViewport);const n=s.fullWidth,o=s.fullHeight,a=s.pixelRatio,l=Math.ceil(n/a),c=Math.ceil(o/a);this.blur0Fbo.resize(l,c),this.blur1Fbo.resize(l,c);const h=this._rctx;h.bindVAO(this.quadVAO);let p=null;this._gridUpdateResources(r,EAt),this._gridComputeMipmap(t),this._passParameters.coverageTexture=this._grid.coverageMipmap[this._grid.mipmapLevels].colorTexture,p=this._grid.vao;const f=h.bindTechnique(this._blurTechnique,this._passParameters,t);h.bindVAO(p),h.bindFramebuffer(this.blur0Fbo),h.setViewport(0,0,l,c),h.setClearColor(0,0,0,0),h.clear(ri.COLOR_BUFFER_BIT),this._blurDrawParameters.blurInputTexture=r.colorTexture,vr(this._blurDrawParameters.blurSize,1/l,0),f.bindDraw(this._blurDrawParameters,t),h.drawArrays(this._blurTechnique.primitiveType,0,ta(p,"geometry")),h.bindFramebuffer(this.blur1Fbo),h.clear(ri.COLOR_BUFFER_BIT),this._blurDrawParameters.blurInputTexture=this.blur0Fbo.colorTexture,vr(this._blurDrawParameters.blurSize,0,1/c),f.bindDraw(this._blurDrawParameters,t),h.drawArrays(this._blurTechnique.primitiveType,0,ta(p,"geometry")),h.bindFramebuffer(i),h.setViewport(this.viewportToRestore[0],this.viewportToRestore[1],this.viewportToRestore[2],this.viewportToRestore[3]),this._passParameters.blurColorTexture=this.blur1Fbo.colorTexture,h.bindTechnique(this._applyTechnique,this._passParameters,t),h.drawArrays(this._applyTechnique.primitiveType,0,ta(p,"geometry")),h.bindVAO(null)}_gridUpdateResources(t,r){const i=this._rctx,s=this._grid;let n=!1;if(s.coverageMipmap===null&&(s.coverageMipmap=[t],n=!0),s.viewportWidth===t.width&&s.viewportHeight===t.height||(n=!0,s.viewportWidth=t.width,s.viewportHeight=t.height),s.coverageMipmap[0]=t,s.cellPixelSize!==r&&(s.cellPixelSize=r,n=!0),n){for(let l=1;l<s.coverageMipmap.length;l++)s.coverageMipmap[l].dispose();s.mipmapLevels=Math.ceil(Math.log(s.cellPixelSize)*Math.LOG2E),s.coverageMipmap.length=s.mipmapLevels+1;for(let l=0;l<s.mipmapLevels;l++){const c=s.coverageMipmap[l],h={target:mt.TEXTURE_2D,pixelFormat:ze.RGB,dataType:Ct.UNSIGNED_SHORT_5_6_5,samplingMode:et.LINEAR,wrapMode:xt.CLAMP_TO_EDGE,width:Math.ceil(c.width/2),height:Math.ceil(c.height/2)},p={colorTarget:us.TEXTURE,depthStencilTarget:Pr.NONE,width:Math.ceil(c.width/2),height:Math.ceil(c.height/2)};s.coverageMipmap[l+1]=new Pi(i,p,h)}}const o=Math.ceil(t.height/s.cellPixelSize),a=Math.ceil(t.width/s.cellPixelSize);if(!s.vao||s.verticalCellCount!==o||s.horizontalCellCount!==a){s.verticalCellCount=o,s.horizontalCellCount=a;const l=o+1,c=a+1,h=1/o,p=1/a,f=6,m=4,g=new Float32Array(f*m*l*c);let v=0;for(let w=0;w<l;w++)for(let _=0;_<c;_++)g[v+0]=(_-.5)*p*2-1,g[v+1]=(w-.5)*h*2-1,g[v+2]=_*p,g[v+3]=w*h,g[v+4]=(_+.5)*p*2-1,g[v+5]=(w-.5)*h*2-1,g[v+6]=_*p,g[v+7]=w*h,g[v+8]=(_-.5)*p*2-1,g[v+9]=(w+.5)*h*2-1,g[v+10]=_*p,g[v+11]=w*h,g[v+12]=(_-.5)*p*2-1,g[v+13]=(w+.5)*h*2-1,g[v+14]=_*p,g[v+15]=w*h,g[v+16]=(_+.5)*p*2-1,g[v+17]=(w-.5)*h*2-1,g[v+18]=_*p,g[v+19]=w*h,g[v+20]=(_+.5)*p*2-1,g[v+21]=(w+.5)*h*2-1,g[v+22]=_*p,g[v+23]=w*h,v+=f*m;s.vao&&s.vao.dispose(!0),s.vao=new rn(i,zr,{geometry:mL},{geometry:cr.createVertex(i,Cr.STATIC_DRAW,g)})}}_gridComputeMipmap(t){const r=this._rctx,i=this._grid,s=r.bindTechnique(this._downsampleTechnique,this._passParameters,t);r.bindVAO(this.quadVAO);for(let n=0;n<i.mipmapLevels;n++){r.bindFramebuffer(i.coverageMipmap[n+1]);const o=i.coverageMipmap[n+1].width,a=i.coverageMipmap[n+1].height;this._downsampleDrawParameters.inputTexture=i.coverageMipmap[n].colorTexture,vr(this._downsampleDrawParameters.invFramebufferDim,1/o,1/a),s.bindDraw(this._downsampleDrawParameters,t),r.setViewport(0,0,o,a),r.drawArrays(Lt.TRIANGLE_STRIP,0,ta(this.quadVAO,"geometry"))}}get gpuMemoryUsage(){let t=(b(this.blur0Fbo)?this.blur0Fbo.gpuMemoryUsage:0)+(b(this.blur1Fbo)?this.blur1Fbo.gpuMemoryUsage:0);if(this._grid.coverageMipmap)for(const r of this._grid.coverageMipmap)t+=r.gpuMemoryUsage;return t}get test(){return{coverage:this._grid.coverageMipmap,blur:[this.blur0Fbo,this.blur1Fbo]}}}const AAt={dataType:Ct.UNSIGNED_BYTE,internalFormat:ze.RGBA},RAt={};class OAt{constructor(t){this.rctx=t,this._activeTargets=new Set,this._depthTextures=new Map,this._depthBuffers=new Map,this._colorTextures=new Map,this._framebuffers=new Map,this.depthTextureSupported=t.capabilities.depthTexture}dispose(){this._depthBuffers.forEach(t=>t.dispose()),this._depthBuffers.clear(),this._depthTextures.forEach(t=>t.dispose()),this._depthTextures.clear(),this._colorTextures.forEach(t=>t.dispose()),this._colorTextures.clear(),this._framebuffers.forEach(t=>t.dispose()),this._framebuffers.clear(),this._activeTargets.clear()}disposeTargetResource(t){const r=t.id;this._activeTargets.has(r)&&(this._activeTargets.delete(r),this._disposeWithFramebuffers(this._depthTextures,r),this._disposeWithFramebuffers(this._depthBuffers,r),this._disposeWithFramebuffers(this._colorTextures,r))}_disposeWithFramebuffers(t,r){const i=t.get(r);i&&(this._framebuffers.forEach((s,n)=>{s.colorAttachment!==i&&s.depthStencilAttachment!==i||(s.detachAll(),s.dispose(),this._framebuffers.delete(n))}),i.dispose(),t.delete(r))}getDepthTexture(t,r){if(!this.depthTextureSupported)return null;let i=this._depthTextures.get(t.id);return!i||i.descriptor.width===r.width&&i.descriptor.height===r.height||(i.dispose(),i=null),i||(i=new nt(this.rctx,{target:mt.TEXTURE_2D,pixelFormat:ze.DEPTH_STENCIL,dataType:Ct.UNSIGNED_INT_24_8,samplingMode:et.NEAREST,wrapMode:xt.CLAMP_TO_EDGE,width:r.width,height:r.height}),this._depthTextures.set(t.id,i),this._activeTargets.add(t.id)),i}getAllocatedDepthTexture(t){return this._depthTextures.get(t.id)}getDepthBuffer(t,r){if(this.depthTextureSupported)return null;let i=this._depthBuffers.get(t.id);return i?i.descriptor.width===r.width&&i.descriptor.height===r.height||i.resize(r.width,r.height):(i=new Y2(this.rctx,{internalFormat:ol.DEPTH_STENCIL,...r}),this._depthBuffers.set(t.id,i),this._activeTargets.add(t.id)),i}getColorTexture(t,r){let i=this._colorTextures.get(t.id);return i&&(i.descriptor.width===r.width&&i.descriptor.height===r.height||(i.dispose(),i=null)),i||(i=new nt(this.rctx,{target:mt.TEXTURE_2D,pixelFormat:ze.RGBA,internalFormat:t.internalFormat,dataType:t.dataType,samplingMode:t.samplingMode!=null?t.samplingMode:et.LINEAR,wrapMode:xt.CLAMP_TO_EDGE,width:r.width,height:r.height}),this._colorTextures.set(t.id,i),this._activeTargets.add(t.id)),i}getAllocatedColorTexture(t){return this._colorTextures.get(t.id)}registerDepthTarget(t={}){return{id:Jl(),...RAt,...t}}registerColorTarget(t={}){return{id:Jl(),...AAt,...t}}getFramebuffer(t,r,i){const s=this._getKey(r,i);let n=this._framebuffers.get(s);const o=this.getColorTexture(r,t);if(this.depthTextureSupported){const l=i?this.getDepthTexture(i,t):void 0;return n?((n.width!==t.width||n.height!==t.height||n.colorTexture!==o||n.depthStencilTexture!==l)&&(n.detachAll(),n.resize(t.width,t.height),n.attachColorTexture(o),n.attachDepthStencilTexture(l)),n):(n=b(i)?new Pi(this.rctx,{colorTarget:us.TEXTURE,depthStencilTarget:Pr.DEPTH_STENCIL_TEXTURE},o,l):new Pi(this.rctx,{colorTarget:us.TEXTURE,depthStencilTarget:Pr.NONE},o),this._framebuffers.set(s,n),n)}const a=i?this.getDepthBuffer(i,t):void 0;return n?((n.width!==t.width||n.height!==t.height||n.colorTexture!==o)&&(n.detachAll(),n.resize(t.width,t.height),n.attachColorTexture(o),n.attachDepthStencilBuffer(a)),n):(n=new Pi(this.rctx,{colorTarget:us.TEXTURE,depthStencilTarget:i?Pr.DEPTH_STENCIL_RENDER_BUFFER:Pr.NONE},o,a),this._framebuffers.set(s,n),n)}_getKey(t,r){return`${t.id}_${r?r.id:"X"}_${t.name}${r?"_"+r.name:""}`}get gpuMemoryUsage(){let t=0;const r=new Set,i=s=>{r.has(s)||(r.add(s),t+=bT(s))};return this._depthTextures.forEach(i),this._colorTextures.forEach(i),this._depthBuffers.forEach(i),t}}class MAt{constructor(t,r){this._rctx=t,this._compositingHelper=r,this._mainColorTarget=0,this._dimensions={width:4,height:4},this._needLastFrameColorTexture=!1,this._background={type:"color",color:[0,0,0,1]};const i=t.type===mr.WEBGL2;this._renderTargetHelper=new OAt(t);const s=this._renderTargetHelper;this.mainColorTargets=[s.registerColorTarget({name:"mainColorTarget0"}),s.registerColorTarget({name:"mainColorTarget1"})],this.frontFaceTarget=s.registerColorTarget({name:"frontFaceTarget"});const n=o=>s.registerColorTarget({name:o,dataType:Ct.FLOAT,internalFormat:i?gt.RGBA32F:ze.RGBA,samplingMode:et.NEAREST});this.colorFloatTarget=n("colorFloatTarget"),this.alphaFloatTarget=n("alphaFloatTarget"),this.mainDepth=s.registerDepthTarget({name:"mainDepth"}),this.linearDepth=s.registerColorTarget({name:"linearDepth",samplingMode:et.NEAREST}),this.terrainLinearDepth=s.registerColorTarget({name:"terrainLinearDepth"}),this.geometryLinearDepth=s.registerColorTarget({name:"geometryLinearDepth"}),this.normal=s.registerColorTarget({name:"normal"}),this.highlight=s.registerColorTarget({name:"highlight",internalFormat:i?gt.RGBA4:ze.RGBA,dataType:Ct.UNSIGNED_SHORT_4_4_4_4}),this.hudVisibility=s.registerColorTarget({name:"hudVisibility",internalFormat:i?gt.RGBA4:ze.RGBA,dataType:Ct.UNSIGNED_SHORT_4_4_4_4}),this.tmpColor=s.registerColorTarget({name:"tmpColor"}),this.tmpDepth=s.registerDepthTarget({name:"tmpDepth"}),this.hudColor=s.registerColorTarget({name:"hudColor"})}dispose(){this._renderTargetHelper.dispose()}get width(){return this._dimensions.width}get height(){return this._dimensions.height}set background(t){this._background=t}get background(){return this._background}get currentColorTarget(){return this.mainColorTargets[this._mainColorTarget]}get previousColorTarget(){return this.mainColorTargets[1-this._mainColorTarget]}get framebuffer(){return this.getFramebuffer(this.currentColorTarget,this.mainDepth)}getFramebuffer(t,r){return this._renderTargetHelper.getFramebuffer(this._dimensions,t,r)}get colorTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.currentColorTarget)}get depthTexture(){return this._renderTargetHelper.getAllocatedDepthTexture(this.mainDepth)}get linearDepthTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.linearDepth)}get terrainLinearDepthTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.terrainLinearDepth)}get geometryLinearDepthTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.geometryLinearDepth)}get lastFrameColorTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.previousColorTarget)}get normalTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.normal)}get highlightTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.highlight)}get hudVisibilityTexture(){return this._getColorTexture(this.hudVisibility)}get tmpColorTexture(){return this._getColorTexture(this.tmpColor)}get hudColorTexture(){return this._getColorTexture(this.hudColor)}get mainColorTexture(){return this._getColorTexture(this.currentColorTarget)}advanceCurrentRenderTarget(){this._mainColorTarget=this._mainColorTarget===0&&this._needLastFrameColorTexture?1:0}initializeFrame(t){const r=this._rctx;this._dimensions.width=t.fullWidth,this._dimensions.height=t.fullHeight,this.bindTarget(this.currentColorTarget,this.mainDepth),r.setClearStencil(0);const i=this._background.color;r.setClearColor(i[0]*i[3],i[1]*i[3],i[2]*i[3],i[3]),r.clearSafe(ri.COLOR_BUFFER_BIT|ri.DEPTH_BUFFER_BIT|ri.STENCIL_BUFFER_BIT)}composite(t){b(this.colorTexture)&&this._compositingHelper.composite(t,this.colorTexture,Ko.None)}renderTmpAndCompositeToMain(t,r,i,s=!1){this.renderToTargets(t,this.tmpColor,s?this.tmpDepth:this.mainDepth,PAt),this._compositingHelper.composite(r,this._getColorTexture(this.tmpColor),i)}renderHUDVisibility(t,r=!1){this.renderToTargets(t,this.hudVisibility,r?this.tmpDepth:this.mainDepth,IAt)}compositeTransparentTerrainOntoHUDVisibility(t){this.renderToTargets(()=>this._compositingHelper.composite(t,this._getColorTexture(this.tmpColor),Ko.None,1,Gc.TransparentToHUDVisibility),this.hudVisibility,this.tmpDepth)}renderOITPass(t,r,i){let s,n;switch(r){case yt.Color:s=this.colorFloatTarget,n=[0,0,0,0];break;case yt.Alpha:s=this.alphaFloatTarget,n=[1,1,1,1];break;case yt.FrontFace:s=this.frontFaceTarget,n=[0,0,0,0]}i?this.renderToTargets(t,s,this.tmpDepth,n,!0,!0):this.renderToTargets(t,s,this.mainDepth,n,!1)}compositeTransparentTerrainOntoMain(t){this.bindFramebuffer(),this._compositingHelper.composite(t,this._getColorTexture(this.tmpColor),Ko.PremultipliedAlpha)}compositeOccludedOntoMain(t,r){this.bindFramebuffer(),this._compositingHelper.composite(t,this._getColorTexture(this.tmpColor),Ko.PremultipliedAlpha,r)}compositeTransparentOntoOpaque(t,r){r?(this.bindTarget(this.hudColor,this.tmpDepth),this._rctx.setClearColor(0,0,0,1e-13),this._rctx.clearSafe(ri.COLOR_BUFFER_BIT)):this.bindFramebuffer(),this._compositingHelper.compositeTransparent(t,this._getColorTexture(this.colorFloatTarget),this._getColorTexture(this.alphaFloatTarget),this._getColorTexture(this.frontFaceTarget))}bindFramebuffer(){this._rctx.bindFramebuffer(this.framebuffer)}renderDepthDetached(t){this.bindTarget(this.currentColorTarget),t(),this.bindTarget(this.currentColorTarget,this.mainDepth)}disposeTarget(t){this._renderTargetHelper.disposeTargetResource(t)}set needLastFrameColorTexture(t){!t&&this._needLastFrameColorTexture&&(this._mainColorTarget=0,this.disposeTarget(this.mainColorTargets[1])),this._needLastFrameColorTexture=t}get needLastFrameColorTexture(){return this._needLastFrameColorTexture}renderToTargets(t,r,i,s,n=!1,o=!1){const a=this._rctx,l=this.bindTarget(r,i);let c=0;if(s){const p=Math.max(1e-13,s[3]);a.setClearColor(s[0],s[1],s[2],p),c|=ri.COLOR_BUFFER_BIT}return n&&(c|=ri.DEPTH_BUFFER_BIT),o===!1?o=0:(o===!0&&(o=255),c|=ri.STENCIL_BUFFER_BIT),c&&a.clearSafe(c,o),t(),a.gl.flush(),this.bindTarget(this.currentColorTarget,this.mainDepth),l}bindTarget(t,r){const i=this._renderTargetHelper.getFramebuffer(this._dimensions,t,r);return this._rctx.bindFramebuffer(i),i}_getColorTexture(t){return this._renderTargetHelper.getColorTexture(t,this._dimensions)}get gpuMemoryUsage(){let t=0;return this._renderTargetHelper&&(t+=this._renderTargetHelper.gpuMemoryUsage),t}}const PAt=[0,0,0,0],IAt=[0,1,0,1];class $At{constructor(t){this.context=t,this._renderPlugins=new Xt,this.slots=[];for(let r=0;r<Se.MAX_SLOTS;++r)this.slots[r]=[]}add(t,r,i){const s=()=>{if(i!=null&&i.aborted)throw r.uninitializeRenderContext(),gr();this._renderPlugins.push(r);for(const o of t)this.slots[o].push(r);this.context.requestRender()},n=r.initializeRenderContext(this.context,i);if(Ch(n))return n.then(s);s()}remove(t){if(this._renderPlugins.removeUnordered(t)!=null){for(let r=0;r<this.slots.length;++r)this.slots[r]=this.slots[r].filter(i=>i!==t);t.uninitializeRenderContext(),this.context.requestRender()}}prepareRender(){this._renderPlugins.forAll(t=>{t.prepareRender&&t.prepareRender(this.context.renderContext)})}updateAnimation(t){let r=!1;return this._renderPlugins.forAll(i=>{i.updateAnimation&&(r=i.updateAnimation(t)||r)}),r}render(){const t=this.slots[this.context.renderContext.bindParameters.slot],r=new Array;t.filter(i=>{if(!i.canRender)return!1;if(LAt(i)){const s=i.prepareTechnique(this.context.renderContext);return!!s&&(r.push(s),!0)}return r.push(null),!0}).forEach((i,s)=>i.render(this.context.renderContext,r[s]))}queryDepthRange(t){const r=DAt;return r.near=1/0,r.far=-1/0,this._renderPlugins.forAll(i=>{if(i.queryDepthRange){const s=i.queryDepthRange(t);s&&QA(r,s,r)}}),r}get needsTransparentPass(){return this._renderPlugins.some(t=>t.needsTransparentPass)}get needsHighlight(){return this._renderPlugins.some(t=>t.needsHighlight)}get needsLinearDepth(){return this._renderPlugins.some(t=>t.needsLinearDepth)}get needsLaserlineWithContrastControl(){const t=this.slots[Se.LASERLINES_CONTRAST_CONTROL];return!!t&&t.length>0}get renderOccludedFlags(){return this._renderPlugins.reduce((t,r)=>t|r.renderOccludedFlags,0)}}function LAt(e){return"prepareTechnique"in e}const DAt={near:0,far:0};class ILe extends NPe{}const $8=255,NAt=1/$8;function FAt(){const e=new Yr,t=e.fragment;return t.include(hu),t.include(xh),e.include(e8),e.include(K1),e.include(YB,{receiveShadows:!0}),t.uniforms.add([new Ht("depthMap",r=>r.linearDepthTexture),new Ei("inverseViewMatrix",(r,i)=>Cs(gye,yl(gye,i.camera.viewMatrix,i.camera.center))),new _r("nearFar",(r,i)=>i.camera.nearFar)]),t.constants.add("sampleValue","float",NAt),t.code.add(S`void main(void) {
float depth = rgba2float(texture2D(depthMap, uv));
if (depth == 0.0) {
discard;
}
float currentPixelDepth = linearDepthFromFloat(depth, nearFar);
if (-currentPixelDepth > nearFar.y || -currentPixelDepth < nearFar.x) {
discard;
}
vec4 currentPixelPos = vec4(reconstructPosition(gl_FragCoord.xy, currentPixelDepth), 1.0);
vec4 worldSpacePos = inverseViewMatrix * currentPixelPos;
mat4 shadowMatrix;
float linearDepth = -currentPixelDepth;
int i = chooseCascade(linearDepth, shadowMatrix);
if (i >= numCascades) {
discard;
}
vec3 lvpos = lightSpacePosition(worldSpacePos.xyz, shadowMatrix);
if (lvpos.z >= 1.0 || lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) {
discard;
}
vec2 uvShadow = cascadeCoordinates(i, lvpos);
float depthShadow = readShadowMapDepth(uvShadow, shadowMapTex);
bool shadow = depthShadow < lvpos.z;
if (!shadow) {
discard;
}
gl_FragColor = vec4(sampleValue);
}`),e}const gye=Ce(),kAt=Object.freeze(Object.defineProperty({__proto__:null,ShadowCastAccumulatePassParameters:ILe,shadowCastMaxSamples:$8,build:FAt},Symbol.toStringTag,{value:"Module"}));var UT;(function(e){e[e.Gradient=0]="Gradient",e[e.Threshold=1]="Threshold",e[e.COUNT=2]="COUNT"})(UT||(UT={}));class bJ extends vl{constructor(){super(...arguments),this.visualization=UT.Gradient,this.bandsEnabled=!1}}u([q({count:UT.COUNT})],bJ.prototype,"visualization",void 0),u([q()],bJ.prototype,"bandsEnabled",void 0);function UAt(e){const t=new Yr,r=t.fragment;r.include(hu),r.include(xh),t.include(e8),t.include(K1);const{visualization:i,bandsEnabled:s}=e;r.constants.add("inverseSampleValue","float",$8),r.uniforms.add([new Ht("shadowCastMap",a=>a.shadowCastMap),new qe("sampleScale",a=>a.sampleScale),new qe("opacityFromElevation",a=>a.opacityFromElevation),new lr("uColor",a=>a.color)]);const n=i===UT.Gradient,o=i===UT.Threshold;return n&&s?r.uniforms.add(new qe("bandSize",a=>a.bandSize)):o&&r.uniforms.add(new qe("threshold",a=>a.threshold)),r.code.add(S`
      void main(void) {
        vec4 record = texture2D(shadowCastMap, uv);
        float pixelSamples = record.r * inverseSampleValue;
        if (pixelSamples < 1.0) {
          discard;
        }

        float strength = pixelSamples * sampleScale;

        ${o?S`
            if (strength <= threshold) {
              discard;
            }`:""}

        ${n&&s?S`strength = ceil(strength / bandSize) * bandSize;`:""}

        gl_FragColor = vec4(uColor.xyz, uColor.a * opacityFromElevation ${n?S`* strength`:""});
      }
    `),t}const VAt=Object.freeze(Object.defineProperty({__proto__:null,build:UAt},Symbol.toStringTag,{value:"Module"}));class L8 extends gi{constructor(t,r){super(t,r,()=>this.destroy())}initializeProgram(t){const r=L8.shader.get().build(this.configuration);return new oi(t.rctx,r,zr)}initializePipeline(){return Gt({blending:fh,colorWrite:or,depthTest:null,depthWrite:null})}get primitiveType(){return Lt.TRIANGLE_STRIP}}L8.shader=new ni(VAt,()=>ie(()=>import("./ShadowCastVisualize.glsl.ec57e8fe.js"),[],import.meta.url));const zAt=xr(.01,0,.25,1),BAt=4e4,GAt=5e4,$Le=1/512;let Ek=class extends xe{constructor(e,t,r,i){super({}),this._techniqueRepository=e,this._rctx=t,this._shadowAccumulator=r,this._requestRender=i,this._passParameters={shadowCastMap:this._shadowCastTexture,sampleScale:0,color:zAt,threshold:.5,bandSize:.1,opacityFromElevation:1,__tagStrict:"NoParameters"},this._techniqueConfig=new bJ,this._enabled=!1,this._vao=_l(t),this._techniqueConfig.visualization=UT.Gradient}normalizeCtorArgs(){return{}}dispose(){this._stop(),this._vao=Ye(this._vao),this._techniqueRepository.release(this._technique),this._technique=null,this._shadowAccumulator=null}get visualizeShadowCastTechnique(){return this._technique=this._techniqueRepository.releaseAndAcquire(L8,this._techniqueConfig,this._technique),this._technique}render(e){if(!this._isRenderingVisualization)return;this._passParameters.sampleScale=1/this._computedSamples;const t=this.visualizeShadowCastTechnique;this._rctx.bindVAO(this._vao),this._rctx.bindTechnique(t,this._passParameters,e),this._rctx.drawArrays(t.primitiveType,0,ta(this._vao,"geometry"))}setOptions(e){e.enabled!==void 0&&this._setEnabled(e.enabled),e.color!==void 0&&this._setColor(e.color),e.threshold!==void 0&&(this._threshold=e.threshold),e.visualization!==void 0&&(this._visualization=e.visualization),e.bandSize!==void 0&&(this._bandSize=e.bandSize),e.bandsEnabled!==void 0&&(this._bandsEnabled=e.bandsEnabled)}get opacityFromElevation(){return this._passParameters.opacityFromElevation}set opacityFromElevation(e){this._passParameters.opacityFromElevation!==e&&(this._passParameters.opacityFromElevation=e,this.notifyChange("opacityFromElevation"))}get _isRenderingVisualization(){return this._enabled&&this._computedSamples>0&&this.opacityFromElevation>$Le}get _computedSamples(){return this._shadowAccumulator.computedSamples}get _shadowCastTexture(){return this._shadowAccumulator.shadowCastTexture}get _threshold(){return this._passParameters.threshold}set _threshold(e){this._threshold!==e&&(this._passParameters.threshold=e,this._requestRenderIfRunning())}get _visualization(){return this._techniqueConfig.visualization}set _visualization(e){e!==this._visualization&&(this._techniqueConfig.visualization=e,this._techniqueRepository.release(this._technique),this._technique=null,this._requestRenderIfRunning())}get _bandSize(){return this._passParameters.bandSize}set _bandSize(e){e!==this._bandSize&&(this._passParameters.bandSize=e,this._requestRenderIfRunning())}get _bandsEnabled(){return this._techniqueConfig.bandsEnabled}set _bandsEnabled(e){e!==this._bandsEnabled&&(this._techniqueConfig.bandsEnabled=e,this._techniqueRepository.release(this._technique),this._technique=null,this._requestRenderIfRunning())}_setColor(e){const t=this._passParameters.color;oI(e,t)||(ef(this._passParameters.color,e),this._requestRenderIfRunning())}_setEnabled(e){e!==this._enabled&&(e?this._start():this._stop())}_requestRenderIfRunning(){this._enabled&&this._requestRender()}_start(){this._enabled=!0,this._requestRender()}_stop(){this._enabled=!1,this._requestRender()}};u([d()],Ek.prototype,"opacityFromElevation",null),Ek=u([$("esri.views.3d.webgl-engine.lib.ShadowCastRenderer")],Ek);class D8 extends gi{constructor(t,r){super(t,r,()=>this.destroy())}initializeProgram(t){const r=D8.shader.get().build();return new oi(t.rctx,r,zr)}initializePipeline(){return Gt({blending:No(Ae.ONE,Ae.ONE,Ae.ONE,Ae.ONE),colorWrite:or,depthTest:null,depthWrite:null})}get primitiveType(){return Lt.TRIANGLE_STRIP}}D8.shader=new ni(kAt,()=>ie(()=>import("./ShadowCastAccumulate.glsl.5644e086.js"),[],import.meta.url));var x3;let ya=x3=class extends xe{constructor(e,t,r,i,s,n){super({}),this._rctx=e,this._stage=r,this._prepareForShadowMapPass=i,this._renderToShadowMap=s,this._requestRender=n,this._progress=0,this._sampleCount=0,this._passParameters=new ILe,this._enabled=!1,this._cachedLightDirections=[],this._depthRange=uJ,this._previewing=!1,this._handles=new Dt,this._cameraForcedForScreenshot=!1,this._bindParameters=new vB(new Cse(e,r.viewingMode),null,null),this._bindParameters.shadowMap.enabled=!0,this._bindParameters.camera=new ii,this._vao=_l(e);const o={colorTarget:us.TEXTURE,depthStencilTarget:Pr.NONE,width:0,height:0},a={target:mt.TEXTURE_2D,pixelFormat:ze.RGBA,dataType:Ct.UNSIGNED_BYTE,samplingMode:et.LINEAR,wrapMode:xt.CLAMP_TO_EDGE,width:0,height:0};this._fbo=new Pi(e,o,a),this._accumulationRenderer=new Ek(t,e,this,n);const l=this._stage.resourceController.scheduler;this._handles.add(l.registerTask(vt.SHADOW_ACCUMULATOR,this)),this._handles.add(te(()=>r.renderView,c=>{this._handles.remove(x3.renderViewHandleKey),R(c)||this._handles.add(c.events.on("force-camera-for-screenshot",()=>this._cameraForcedForScreenshot=!0),x3.renderViewHandleKey)},Xs))}normalizeCtorArgs(){return{}}get computedSamples(){return this._progress}get shadowCastTexture(){return this._fbo.colorTexture}get isAccumulating(){return this._isPreviewing||this._isRefining}get accumulationTechnique(){if(R(this._accumulationTechnique)){const e={rctx:this._rctx,viewingMode:this._stage.viewingMode};this._accumulationTechnique=new D8(e,new vl)}return this._accumulationTechnique}get _isRefining(){return this._isActive&&!this._isDoneAccumulating&&!this._previewing}get _isPreviewing(){return this._isActive&&this._previewing}get _isActive(){return this._enabled&&this._sampleCount>0}get canAccumulate(){return this._passParameters.linearDepthTexture!==null&&this._depthRange!==uJ&&this._opacityFromElevation>$Le}get _isDoneAccumulating(){return this._progress>=this._sampleCount}get _lightDirections(){return this._cachedLightDirections}set _lightDirections(e){const t=this._cachedLightDirections;if(x1(t,e,cT))return;const r=e.length;t.length=r,this._sampleCount=Math.min($8,r);for(let i=0;i<r;++i){const s=e[i],n=t[i]||M();ae(n,s),t[i]=n}this._invalidate()}get _opacityFromElevation(){return this._accumulationRenderer.opacityFromElevation}set _opacityFromElevation(e){this._accumulationRenderer.opacityFromElevation=e}get running(){return this._isRefining&&this.canAccumulate&&this._progress>0}runTask(e){for(this._prepareForShadowMapPass(this._bindParameters);!e.done&&!this._isDoneAccumulating;)this._accumulateShadow(),e.madeProgress();this._requestRender()}renderAccumulation(e,t,r,i){if(this._passParameters.linearDepthTexture=e,this._depthRange=t,this._updateCamera(r),this._bindParameters.contentCamera=i,this.notifyChange("canAccumulate"),!this.isAccumulating||!this.canAccumulate)return;(this._previewing||this._progress===0||this._cameraForcedForScreenshot)&&this._clear();const s=this._cameraForcedForScreenshot?this._sampleCount:Math.min(x3.previewSamples,this._sampleCount-this._progress);for(let n=0;n<s;++n)this._accumulateShadow();this._cameraForcedForScreenshot=!1}render(e){this._accumulationRenderer.render(e)}dispose(){this._stop(),this._handles.destroy(),this._accumulationRenderer=Ye(this._accumulationRenderer),this._bindParameters.shadowMap.dispose(),this._fbo=Ye(this._fbo),this._vao=Ye(this._vao),this._accumulationTechnique=ti(this._accumulationTechnique),this._cachedLightDirections.length=0,this._sampleCount=0}setOptions(e){e.enabled!==void 0&&(this.enabled=e.enabled),e.previewing!==void 0&&(this.previewing=e.previewing),e.lightDirections!==void 0&&(this.lightDirections=e.lightDirections),this._accumulationRenderer.setOptions(e)}set previewing(e){this._previewing!==e&&(this._previewing=e,this._requestRenderIfEnabled())}set lightDirections(e){this._lightDirections=e}readAccumulatedShadow(e,t){if(!this._isActive||this._progress<1||e<0||e>this._fbo.width||t<0||t>this._fbo.height)return 0;const r=jAt;return this._fbo.readPixels(e,t,1,1,ze.RGBA,Ct.UNSIGNED_BYTE,r),r[0]/this._progress}_start(){this._progress=0,this._enabled=!0}_stop(){this._enabled=!1}_invalidate(){this._progress=0,this._requestRenderIfEnabled()}_clear(){this._rctx.bindFramebuffer(this._fbo),this._rctx.setClearColor(0,0,0,0),this._rctx.clearSafe(ri.COLOR_BUFFER_BIT),this._progress=0}_accumulateShadow(){const e=this._lightDirections[this._progress];this._renderToShadowMap(this._bindParameters,e,this._depthRange),this._passParameters.origin=this._bindParameters.camera.center,this._rctx.bindFramebuffer(this._fbo);const t=this.accumulationTechnique;this._rctx.bindTechnique(t,this._passParameters,this._bindParameters),this._rctx.bindVAO(this._vao),this._rctx.drawArrays(t.primitiveType,0,ta(this._vao,"geometry")),this._progress++}_updateCamera(e){e.equals(this._bindParameters.camera)||(this._bindParameters.camera.copyFrom(e),this._fbo.resize(e.fullWidth,e.fullHeight),this._opacityFromElevation=1-XC(BAt,GAt,e.relativeElevation))}set enabled(e){e!==this._enabled&&(e?this._start():this._stop())}_requestRenderIfEnabled(){this._enabled&&this._requestRender()}get test(){const e=this;return{lightDirections:this._lightDirections,get isDone(){return e._isDoneAccumulating},get isActive(){return e._isActive}}}};ya.previewSamples=6,ya.renderViewHandleKey="renderView",u([d()],ya.prototype,"_progress",void 0),u([d()],ya.prototype,"_sampleCount",void 0),u([d()],ya.prototype,"_enabled",void 0),u([d()],ya.prototype,"_depthRange",void 0),u([d()],ya.prototype,"_previewing",void 0),u([d()],ya.prototype,"_accumulationRenderer",void 0),u([d()],ya.prototype,"_isRefining",null),u([d()],ya.prototype,"_isActive",null),u([d()],ya.prototype,"canAccumulate",null),u([d()],ya.prototype,"_isDoneAccumulating",null),u([d()],ya.prototype,"_opacityFromElevation",null),u([d()],ya.prototype,"running",null),ya=x3=u([$("esri.views.3d.webgl-engine.lib.ShadowAccumulator")],ya);const jAt=new Uint8Array(4),yye={highlightedThreshold:.99999,selfShadowThreshold:.025};function HAt(){const e=new Yr;e.include($T,{receiveShadows:!0});const t=e.fragment;return t.include(hu),t.include(xh),e.include(e8),e.include(K1),t.uniforms.add([new Ht("defaultDepthTex",(r,i)=>i.shadowMap.getSnapshot(HA.Default)),new Ht("highlightDepthTex",(r,i)=>i.shadowMap.getSnapshot(HA.Highlight)),new Ht("depthMap",(r,i)=>i.linearDepthTexture),new Ht("highlightMap",(r,i)=>i.highlightColorTexture),new lr("uColor",r=>r.shadowColor),new _r("nearFar",(r,i)=>i.camera.nearFar),new qe("opacity",r=>r.shadowOpacity),new qe("occludedOpacity",r=>r.occludedShadowOpacity),new qe("terminationFactor",r=>r.opacityElevation*r.dayNightTerminator),new St("lightingMainDirectionView",(r,i)=>we(_ye,Ve(_ye,i.lighting.lightingMainDirection,i.camera.viewInverseTransposeMatrix))),new _r("texelSize",(r,i)=>b(i.linearDepthTexture)?vr(qAt,1/i.linearDepthTexture.descriptor.width,1/i.linearDepthTexture.descriptor.height):zd),new Ei("inverseViewMatrix",(r,i)=>Cs(vye,yl(vye,i.camera.viewMatrix,i.camera.center)))]),t.constants.add("unoccludedHighlightFlag","vec4",P3e).add("highlightedThreshold","float",yye.highlightedThreshold).add("selfShadowThreshold","float",yye.selfShadowThreshold),t.code.add(S`vec3 normalFromDepth(vec3 pixelPos, vec2 fragCoord, vec2 uv, vec2 texelSize, sampler2D depthMap, vec2 nearFar) {
float leftPixelDepth = linearDepthFromTexture(depthMap, uv + vec2(-1.0, 0.0) * texelSize, nearFar);
float rightPixelDepth = linearDepthFromTexture(depthMap, uv + vec2(1.0, 0.0) * texelSize, nearFar);
float bottomPixelDepth = linearDepthFromTexture(depthMap, uv + vec2(0.0, -1.0) * texelSize, nearFar);
float topPixelDepth = linearDepthFromTexture(depthMap, uv + vec2(0.0, 1.0) * texelSize, nearFar);
bool pickLeft = abs(pixelPos.z - leftPixelDepth) < abs(pixelPos.z - rightPixelDepth);
bool pickBottom = abs(pixelPos.z - bottomPixelDepth) < abs(pixelPos.z - topPixelDepth);
vec3 fragCoordHorizontal = pickLeft
? vec3(fragCoord + vec2(-1.0, 0.0), leftPixelDepth)
: vec3(fragCoord + vec2(1.0, 0.0), rightPixelDepth);
vec3 fragCoordVertical = pickBottom
? vec3(fragCoord + vec2(0.0, -1.0), bottomPixelDepth)
: vec3(fragCoord + vec2(0.0, 1.0), topPixelDepth);
vec3 verticalPixelPos = reconstructPosition(fragCoordHorizontal.xy, fragCoordHorizontal.z);
vec3 horizontalPixelPos = reconstructPosition(fragCoordVertical.xy, fragCoordVertical.z);
vec3 normal = normalize(cross(verticalPixelPos - pixelPos, horizontalPixelPos - pixelPos));
return pickLeft == pickBottom ? normal : -normal;
}`),t.code.add(S`void main(void) {
vec4 highlightInfo = texture2D(highlightMap, uv);
float visiblyHighlighted = (1.0 - clamp(distance(unoccludedHighlightFlag, highlightInfo), 0.0, 1.0)) * highlightInfo.a;
if (visiblyHighlighted > highlightedThreshold) {
discard;
}
float depth = rgba2float(texture2D(depthMap, uv));
if (depth == 0.0) {
discard;
}
float currentPixelDepth = linearDepthFromFloat(depth, nearFar);
if (-currentPixelDepth>nearFar.y || -currentPixelDepth<nearFar.x) {
discard;
}
vec4 currentPixelPos = vec4(reconstructPosition(gl_FragCoord.xy, currentPixelDepth), 1.0);
vec4 worldSpacePos = inverseViewMatrix * currentPixelPos;
mat4 shadowMatrix;
float linearDepth = -currentPixelDepth;
int i = chooseCascade(linearDepth, shadowMatrix);
if (i >= numCascades) {
discard;
}
vec3 lvpos = lightSpacePosition(worldSpacePos.xyz, shadowMatrix);
if (lvpos.z >= 1.0 || lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) {
discard;
}
vec2 uvShadow = cascadeCoordinates(i, lvpos);
float depthHighlight = readShadowMapDepth(uvShadow, highlightDepthTex);
bool shadowHighlight = depthHighlight < lvpos.z;
if (!shadowHighlight) {
discard;
}
float depthDefault = readShadowMapDepth(uvShadow, defaultDepthTex);
bool shadowDefault = depthDefault < lvpos.z;
vec3 normal = normalFromDepth(currentPixelPos.xyz, gl_FragCoord.xy, uv, texelSize, depthMap, nearFar);
bool shaded = dot(normal, lightingMainDirectionView) < selfShadowThreshold;
float fragOpacity = (shadowDefault || shaded) ? occludedOpacity : opacity;
gl_FragColor = vec4(uColor.rgb, uColor.a * fragOpacity * terminationFactor);
}`),e}const vye=Ce(),_ye=M(),qAt=rt(),WAt=Object.freeze(Object.defineProperty({__proto__:null,build:HAt},Symbol.toStringTag,{value:"Module"}));class XAt extends nn{constructor(){super(...arguments),this.shadowColor=xr(1,0,1,1),this.shadowOpacity=.2,this.occludedShadowOpacity=.1,this.opacityElevation=1,this.dayNightTerminator=1}}class N8 extends gi{constructor(t){super(t,null,()=>this.destroy())}initializeProgram(t){const r=N8.shader.get().build();return new oi(t.rctx,r,zr)}initializePipeline(){return Gt({blending:No(Ae.SRC_ALPHA,Ae.ONE,Ae.ONE_MINUS_SRC_ALPHA,Ae.ONE_MINUS_SRC_ALPHA),colorWrite:or,depthTest:null,depthWrite:null})}get primitiveType(){return Lt.TRIANGLE_STRIP}}N8.shader=new ni(WAt,()=>ie(()=>import("./ShadowHighlight.glsl.1d4beb66.js"),[],import.meta.url));const ZAt=.001953125,YAt=4e4,QAt=5e4;class JAt{constructor(t,r){this._rctx=t,this._viewingMode=r,this._maxOpacity=1,this._passParameters=new XAt,this._drawParameters=new NPe,this._vao=_l(this._rctx)}get technique(){return R(this._technique)&&(this._technique=new N8({rctx:this._rctx,viewingMode:this._viewingMode})),this._technique}render(t,r){if(!t.shadowMap.enabled||!t.linearDepthTexture||!this.isVisible)return;const i=this.technique;this._drawParameters.origin=t.camera.center,this._rctx.bindFramebuffer(r),this._rctx.bindTechnique(i,this._passParameters,t).bindDraw(this._drawParameters,t),this._rctx.bindVAO(this._vao),this._rctx.drawArrays(i.primitiveType,0,ta(this._vao,"geometry"))}get gpuMemoryUsage(){var t,r;return(r=(t=this._vao)==null?void 0:t.size)!=null?r:0}setDefaultOptions(t){this._passParameters={...this._passParameters,...t},this._updateMaxOpacity()}updateParameters(t,r){this._passParameters.opacityElevation=1-XC(YAt,QAt,t.relativeElevation);const i=this._viewingMode===Be.Global?we(bye,t.center):se(bye,0,0,1),s=Te(i,r);this._passParameters.dayNightTerminator=XC(0,1,Le(30*s,0,1))}dispose(){this._vao=Ye(this._vao),this._technique=ti(this._technique)}get isVisible(){const{opacityElevation:t,dayNightTerminator:r}=this._passParameters;return this._maxOpacity*t*r>=ZAt}_updateMaxOpacity(){const t=Math.max(this._passParameters.shadowOpacity,this._passParameters.occludedShadowOpacity);this._maxOpacity=t*this._passParameters.shadowColor[3]}}const bye=M(),wye=Q1();class KAt{constructor(){this._plane=Q1()}get isEnabled(){return!oSe(this.plane,wye)}get plane(){return this._plane}set plane(t){KT(t||wye,this._plane)}}var Xm;(function(e){e[e.EdgeDetector=0]="EdgeDetector",e[e.BlendWeight=1]="BlendWeight",e[e.Blur=2]="Blur",e[e.COUNT=3]="COUNT"})(Xm||(Xm={}));class LLe extends vl{constructor(){super(...arguments),this.output=Xm.EdgeDetector}}u([q({count:Xm.COUNT})],LLe.prototype,"output",void 0);const wv={threshold:.05,localConstrastAdaption:2,maxSearchSteps:8,maxDistanceAreaTex:16};function eRt(e){const t=new Yr;return e.output===Xm.EdgeDetector&&(t.attributes.add(O.POSITION,"vec2"),t.vertex.uniforms.add(new hl("resolution")),t.varyings.add("fTexCoord","vec2"),t.varyings.add("fOffset[3]","vec4"),t.vertex.code.add(S`void SMAAEdgeDetectionVS( vec2 texcoord ) {
fOffset[0] = texcoord.xyxy + resolution.xyxy * vec4( -1.0, 0.0, 0.0,  1.0 );
fOffset[1] = texcoord.xyxy + resolution.xyxy * vec4(  1.0, 0.0, 0.0, -1.0 );
fOffset[2] = texcoord.xyxy + resolution.xyxy * vec4( -2.0, 0.0, 0.0,  2.0 );
}
void main() {
fTexCoord = (position + 1.0 ) * 0.5;
gl_Position = vec4(position, 0, 1);
SMAAEdgeDetectionVS( fTexCoord );
}`),t.fragment.uniforms.add(new Hi("tColor")),t.fragment.code.add(S`
      vec4 SMAAColorEdgeDetectionPS( vec2 texcoord, vec4 offset[3], sampler2D colorTex ) {
        vec2 threshold = vec2( ${S.float(wv.threshold)} );

        // Calculate color deltas:
        vec4 delta;
        vec3 C = texture2D( colorTex, texcoord ).rgb;

        vec3 Cleft = texture2D( colorTex, offset[0].xy ).rgb;
        vec3 t = abs( C - Cleft );
        delta.x = max( max( t.r, t.g ), t.b );

        vec3 Ctop = texture2D( colorTex, offset[0].zw ).rgb;
        t = abs( C - Ctop );
        delta.y = max( max( t.r, t.g ), t.b );

        // We do the usual threshold:
        vec2 edges = step( threshold, delta.xy );

        // Then discard if there is no edge:
        if ( dot( edges, vec2( 1.0, 1.0 ) ) == 0.0 )
            discard;

        // Calculate right and bottom deltas:
        vec3 Cright = texture2D( colorTex, offset[1].xy ).rgb;
        t = abs( C - Cright );
        delta.z = max( max( t.r, t.g ), t.b );

        vec3 Cbottom  = texture2D( colorTex, offset[1].zw ).rgb;
        t = abs( C - Cbottom );
        delta.w = max( max( t.r, t.g ), t.b );

        // Calculate the maximum delta in the direct neighborhood:
        float maxDelta = max( max( max( delta.x, delta.y ), delta.z ), delta.w );

        // Calculate left-left and top-top deltas:
        vec3 Cleftleft  = texture2D( colorTex, offset[2].xy ).rgb;
        t = abs( C - Cleftleft );
        delta.z = max( max( t.r, t.g ), t.b );

        vec3 Ctoptop = texture2D( colorTex, offset[2].zw ).rgb;
        t = abs( C - Ctoptop );
        delta.w = max( max( t.r, t.g ), t.b );

        // Calculate the final maximum delta:
        maxDelta = max( max( maxDelta, delta.z ), delta.w );

        // Local contrast adaptation in action:
        edges.xy *= step( maxDelta, float(${S.float(wv.localConstrastAdaption)}) * delta.xy );

        return vec4( edges, 0.0, 0.0 );
      }

      void main() {
        gl_FragColor = SMAAColorEdgeDetectionPS( fTexCoord, fOffset, tColor );
      }
    `)),e.output===Xm.BlendWeight&&(t.attributes.add(O.POSITION,"vec2"),t.vertex.uniforms.add(new hl("resolution")),t.varyings.add("fTexCoord","vec2"),t.varyings.add("fOffset[3]","vec4"),t.varyings.add("fPixCoord","vec2"),t.vertex.code.add(S`
      void SMAABlendingWeightCalculationVS( vec2 texcoord ) {
        fPixCoord = texcoord * resolution.zw;
        fOffset[0] = texcoord.xyxy + resolution.xyxy * vec4( -0.25, 0.125, 1.25, 0.125 );
        fOffset[1] = texcoord.xyxy + resolution.xyxy * vec4( -0.125, 0.25, -0.125, -1.25 );
        fOffset[2] = vec4( fOffset[0].xz, fOffset[1].yw ) + vec4( -2.0, 2.0, -2.0, 2.0 ) * resolution.xxyy * float( ${S.int(wv.maxSearchSteps)} );
      }

      void main() {
        fTexCoord = (position + 1.0 ) * 0.5;
        gl_Position = vec4(position, 0, 1);
        SMAABlendingWeightCalculationVS( fTexCoord );
      }
    `),t.fragment.uniforms.add(new Hi("tEdges")),t.fragment.uniforms.add(new Hi("tArea")),t.fragment.uniforms.add(new Hi("tSearch")),t.fragment.uniforms.add(new Hi("tColor")),t.fragment.uniforms.add(new hl("resolution")),t.fragment.code.add(S`
      #define SMAA_AREATEX_PIXEL_SIZE ( 1.0 / vec2( 160.0, 560.0 ) )
      #define SMAA_AREATEX_SUBTEX_SIZE ( 1.0 / 7.0 )

      vec4 SMAASampleLevelZeroOffset(sampler2D texture, vec2 coord, vec2 offset) {
        return texture2D(texture, coord + offset.x * resolution.xy, 0.0);
      }

      vec2 round( vec2 x ) {
        return sign( x ) * floor( abs( x ) + 0.5 );
      }

      float SMAASearchLength( sampler2D searchTex, vec2 e, float bias, float scale ) {
        e.r = bias + e.r * scale;
        return 255.0 * texture2D( searchTex, e, 0.0 ).r;
      }

      float SMAASearchXLeft( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {
        vec2 e = vec2( 0.0, 1.0 );
        for ( int i = 0; i < ${S.int(wv.maxSearchSteps)}; i ++ ) {
          e = texture2D( edgesTex, texcoord, 0.0 ).rg;
          texcoord -= vec2( 2.0, 0.0 ) * resolution.xy;
          if ( ! ( texcoord.x > end && e.g > 0.8281 && e.r == 0.0 ) ) break;
        }
        texcoord.x += 0.25 * resolution.x;
        texcoord.x += resolution.x;
        texcoord.x += 2.0 * resolution.x;
        texcoord.x -= resolution.x * SMAASearchLength(searchTex, e, 0.0, 0.5);
        return texcoord.x;
      }

      float SMAASearchXRight( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {
        vec2 e = vec2( 0.0, 1.0 );
        for ( int i = 0; i < ${S.int(wv.maxSearchSteps)}; i ++ ) {
          e = texture2D( edgesTex, texcoord, 0.0 ).rg;
          texcoord += vec2( 2.0, 0.0 ) * resolution.xy;
          if ( ! ( texcoord.x < end && e.g > 0.8281 && e.r == 0.0 ) ) break;
        }
        texcoord.x -= 0.25 * resolution.x;
        texcoord.x -= resolution.x;
        texcoord.x -= 2.0 * resolution.x;
        texcoord.x += resolution.x * SMAASearchLength( searchTex, e, 0.5, 0.5 );
        return texcoord.x;
      }

      float SMAASearchYUp( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {
        vec2 e = vec2( 1.0, 0.0 );
        for ( int i = 0; i < ${S.int(wv.maxSearchSteps)}; i ++ ) {
          e = texture2D( edgesTex, texcoord, 0.0 ).rg;
          texcoord += vec2( 0.0, 2.0 ) * resolution.xy;
          if ( ! ( texcoord.y > end && e.r > 0.8281 && e.g == 0.0 ) ) break;
        }
        texcoord.y -= 0.25 * resolution.y;
        texcoord.y -= resolution.y;
        texcoord.y -= 2.0 * resolution.y;
        texcoord.y += resolution.y * SMAASearchLength( searchTex, e.gr, 0.0, 0.5 );
        return texcoord.y;
      }

      float SMAASearchYDown( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {
        vec2 e = vec2( 1.0, 0.0 );
        for ( int i = 0; i < ${S.int(wv.maxSearchSteps)}; i ++ ) {
          e = texture2D( edgesTex, texcoord, 0.0 ).rg;
          texcoord -= vec2( 0.0, 2.0 ) * resolution.xy;
          if ( ! ( texcoord.y < end && e.r > 0.8281 && e.g == 0.0 ) ) break;
        }
        texcoord.y += 0.25 * resolution.y;
        texcoord.y += resolution.y;
        texcoord.y += 2.0 * resolution.y;
        texcoord.y -= resolution.y * SMAASearchLength( searchTex, e.gr, 0.5, 0.5 );
        return texcoord.y;
      }

      vec2 SMAAArea( sampler2D areaTex, vec2 dist, float e1, float e2, float offset ) {
        vec2 texcoord = float( ${S.int(wv.maxDistanceAreaTex)} ) * round( 4.0 * vec2( e1, e2 ) ) + dist;
        texcoord = SMAA_AREATEX_PIXEL_SIZE * texcoord + ( 0.5 * SMAA_AREATEX_PIXEL_SIZE );
        texcoord.y += SMAA_AREATEX_SUBTEX_SIZE * offset;
        return texture2D( areaTex, texcoord, 0.0 ).rg;
      }

      vec4 SMAABlendingWeightCalculationPS( vec2 texcoord, vec2 pixcoord, vec4 offset[ 3 ], sampler2D edgesTex, sampler2D areaTex, sampler2D searchTex, ivec4 subsampleIndices ) {
        vec4 weights = vec4( 0.0, 0.0, 0.0, 0.0 );
        vec2 e = texture2D( edgesTex, texcoord ).rg;
        if ( e.g > 0.0 ) {
          vec2 d;
          vec2 coords;
          coords.x = SMAASearchXLeft( edgesTex, searchTex, offset[ 0 ].xy, offset[ 2 ].x );
          coords.y = offset[ 1 ].y;
          d.x = coords.x;
          float e1 = texture2D( edgesTex, coords, 0.0 ).r;
          coords.x = SMAASearchXRight( edgesTex, searchTex, offset[ 0 ].zw, offset[ 2 ].y );
          d.y = coords.x;
          d = d * resolution.z - pixcoord.x;
          vec2 sqrt_d = sqrt( abs( d ) );
          coords.y -= 1.0 * resolution.y;
          float e2 = SMAASampleLevelZeroOffset( edgesTex, coords, vec2( 1.0, 0.0 ) ).r;
          weights.rg = SMAAArea( areaTex, sqrt_d, e1, e2, float( subsampleIndices.y ) );
        }

        if ( e.r > 0.0 ) {
          vec2 d;
          vec2 coords;
          coords.y = SMAASearchYUp( edgesTex, searchTex, offset[ 1 ].xy, offset[ 2 ].z );
          coords.x = offset[ 0 ].x;
          d.x = coords.y;
          float e1 = texture2D( edgesTex, coords, 0.0 ).g;
          coords.y = SMAASearchYDown( edgesTex, searchTex, offset[ 1 ].zw, offset[ 2 ].w );
          d.y = coords.y;
          d = d * resolution.w - pixcoord.y;
          vec2 sqrt_d = sqrt( abs( d ) );
          coords.y -= 1.0 * resolution.y;
          float e2 = SMAASampleLevelZeroOffset( edgesTex, coords, vec2( 0.0, 1.0 ) ).g;
          weights.ba = SMAAArea( areaTex, sqrt_d, e1, e2, float( subsampleIndices.x ) );

          // for some reason the following lines are necessary to prevent
          // texture lookup precision issues on some Intel integrated graphics chips
          vec4 dbg = (offset[ 0 ]+offset[ 1 ]+offset[ 2 ] + coords.xyyx);
          weights.r += 0.00000001 * dot(vec4(0,1,0,1),dbg);
        }
        return weights;
      }

      void main() {
        gl_FragColor = SMAABlendingWeightCalculationPS( fTexCoord, fPixCoord, fOffset, tEdges, tArea, tSearch, ivec4( 0.0 ) );
      }
    `)),e.output===Xm.Blur&&(t.attributes.add(O.POSITION,"vec2"),t.vertex.uniforms.add(new hl("resolution")),t.varyings.add("fTexCoord","vec2"),t.varyings.add("fOffset[2]","vec4"),t.vertex.code.add(S`void SMAANeighborhoodBlendingVS( vec2 texcoord ) {
fOffset[0] = texcoord.xyxy + resolution.xyxy * vec4( -1.0, 0.0, 0.0, 1.0 );
fOffset[1] = texcoord.xyxy + resolution.xyxy * vec4( 1.0, 0.0, 0.0, -1.0 );
}
void main() {
fTexCoord = (position + 1.0 ) * 0.5;
gl_Position = vec4(position, 0, 1);
SMAANeighborhoodBlendingVS(fTexCoord);
}`),t.fragment.uniforms.add(new Hi("tBlendWeights")),t.fragment.uniforms.add(new Hi("tColor")),t.fragment.uniforms.add(new hl("resolution")),t.fragment.code.add(S`vec4 SMAANeighborhoodBlendingPS( vec2 texcoord, vec4 offset[ 2 ], sampler2D colorTex, sampler2D blendTex ) {
vec4 a;
a.xz = texture2D( blendTex, texcoord ).xz;
a.y = texture2D( blendTex, offset[ 1 ].zw ).g;
a.w = texture2D( blendTex, offset[ 1 ].xy ).a;
if ( dot(a, vec4( 1.0, 1.0, 1.0, 1.0 )) < 1e-5 ) {
return texture2D( colorTex, texcoord, 0.0 );
} else {
vec2 offset;
offset.x = a.a > a.b ? a.a : -a.b;
offset.y = a.g > a.r ? -a.g : a.r;
if ( abs( offset.x ) > abs( offset.y )) {
offset.y = 0.0;
} else {
offset.x = 0.0;
}
vec4 C = texture2D( colorTex, texcoord, 0.0 );
texcoord += sign( offset ) * resolution.xy;
vec4 Cop = texture2D( colorTex, texcoord, 0.0 );
float s = abs( offset.x ) > abs( offset.y ) ? abs( offset.x ) : abs( offset.y );
vec4 mixed = mix(C, Cop, s);
return mixed;
}
}
void main() {
gl_FragColor = SMAANeighborhoodBlendingPS( fTexCoord, fOffset, tColor, tBlendWeights );
}`)),t}const tRt=Object.freeze(Object.defineProperty({__proto__:null,build:eRt},Symbol.toStringTag,{value:"Module"}));class F8 extends gi{initializeProgram(t){const r=F8.shader.get().build(this.configuration);return new oi(t.rctx,r,zr)}initializePipeline(){return Gt({colorWrite:or})}}F8.shader=new ni(tRt,()=>ie(()=>import("./SMAA.glsl.623c2151.js"),[],import.meta.url));let T3=class extends xe{constructor(e,t){super({}),this.rctx=e,this._techniqueRep=t,this._isEnabled=!1}normalizeCtorArgs(){return{}}dispose(){this._abortController=Fd(this._abortController),this.disable()}_loadResources(e){if(b(this._abortController))return!1;if(b(this._searchTexture))return!0;this._abortController=new AbortController;const t=this._abortController.signal;return ie(()=>import("./SmaaRenderPassData.ee8f84d8.js"),[],import.meta.url).then(r=>this._loadTextures(r,t)).then(()=>e()).finally(()=>this._abortController=null),!1}_loadTextures(e,t){return Jt(t),Promise.all([this._loadTextureFromBase64(e.areaTexture,et.LINEAR,ze.RGB),this._loadTextureFromBase64(e.searchTexure,et.NEAREST,ze.LUMINANCE)]).then(([r,i])=>{gn(t)?(r.dispose(),i.dispose(),Jt(t)):(this._areaTexture=r,this._searchTexture=i)})}get updating(){return b(this._abortController)}enable(e){if(this._isEnabled)return!0;if(!this._edgeDetectTechnique||!this._blendWeightsTechnique||!this._blurTechnique){const t=new LLe,r=(i,s)=>this._techniqueRep.releaseAndAcquire(F8,i,s);t.output=Xm.EdgeDetector,this._edgeDetectTechnique=r(t,this._edgeDetectTechnique),t.output=Xm.BlendWeight,this._blendWeightsTechnique=r(t,this._blendWeightsTechnique),t.output=Xm.Blur,this._blurTechnique=r(t,this._blurTechnique)}return!!this._loadResources(e)&&(this._vao=$nt(this.rctx),this._edges=new Pi(this.rctx,{colorTarget:us.TEXTURE,depthStencilTarget:Pr.NONE},{target:mt.TEXTURE_2D,pixelFormat:ze.RGB,dataType:Ct.UNSIGNED_BYTE,samplingMode:et.LINEAR,wrapMode:xt.CLAMP_TO_EDGE,width:4,height:4}),this._blend=new Pi(this.rctx,{colorTarget:us.TEXTURE,depthStencilTarget:Pr.NONE},{target:mt.TEXTURE_2D,pixelFormat:ze.RGBA,dataType:Ct.UNSIGNED_BYTE,samplingMode:et.LINEAR,wrapMode:xt.CLAMP_TO_EDGE,width:4,height:4}),this._isEnabled=!0,!0)}disable(){this._isEnabled&&(this._vao=Ye(this._vao),this._areaTexture=Ye(this._areaTexture),this._searchTexture=Ye(this._searchTexture),this._blend=Ye(this._blend),this._edges=Ye(this._edges),this._isEnabled=!1)}render(e){if(!this._isEnabled)return;const t=this.rctx,r=t.getBoundFramebufferObject(),i={x:0,y:0,width:e.descriptor.width,height:e.descriptor.height};t.bindVAO(this._vao),t.setViewport(i.x,i.y,i.width,i.height),this._edges.resize(i.width,i.height),t.bindFramebuffer(this._edges),t.setClearColor(0,0,0,1),t.clear(ri.COLOR_BUFFER_BIT);const s=t.bindTechnique(this._edgeDetectTechnique);s.bindTexture("tColor",e),s.setUniform4f("resolution",1/i.width,1/i.height,i.width,i.height),t.drawArrays(Lt.TRIANGLES,0,3),this._blend.resize(i.width,i.height),t.bindFramebuffer(this._blend),t.setClearColor(0,0,1,1),t.clear(ri.COLOR_BUFFER_BIT);const n=t.bindTechnique(this._blendWeightsTechnique);n.setUniform4f("resolution",1/i.width,1/i.height,i.width,i.height),n.bindTexture("tSearch",this._searchTexture),n.bindTexture("tArea",this._areaTexture),n.bindTexture("tEdges",this._edges.colorTexture),t.drawArrays(Lt.TRIANGLES,0,3),t.bindFramebuffer(r),t.setClearColor(0,1,0,1),t.clear(ri.COLOR_BUFFER_BIT);const o=t.bindTechnique(this._blurTechnique);o.setUniform4f("resolution",1/i.width,1/i.height,i.width,i.height),o.bindTexture("tColor",e),o.bindTexture("tBlendWeights",this._blend.colorTexture),t.drawArrays(Lt.TRIANGLES,0,3)}_loadTextureFromBase64(e,t,r){return Sf(e).then(i=>new nt(this.rctx,{pixelFormat:r,dataType:Ct.UNSIGNED_BYTE,wrapMode:xt.CLAMP_TO_EDGE,width:i.width,height:i.height,samplingMode:t},i))}};u([d()],T3.prototype,"_abortController",void 0),u([d({readOnly:!0})],T3.prototype,"updating",null),T3=u([$("esri.views.3d.webgl-engine.lib.SmaaRenderPass")],T3);function rRt(e,t){const r=t,i=-e[0],s=-e[1],n=-e[2],o=r[3],a=r[7],l=r[11],c=r[15];r[0]+=o*i,r[1]+=o*s,r[2]+=o*n,r[4]+=a*i,r[5]+=a*s,r[6]+=a*n,r[8]+=l*i,r[9]+=l*s,r[10]+=l*n,r[12]+=c*i,r[13]+=c*s,r[14]+=c*n}function iRt(e,t){const r=t,i=e[0],s=e[1],n=e[2];r[12]+=i*r[0]+s*r[4]+n*r[8],r[13]+=i*r[1]+s*r[5]+n*r[9],r[14]+=i*r[2]+s*r[6]+n*r[10],r[14]+=i*r[3]+s*r[7]+n*r[11]}class sRt{constructor(t){this.factory=t,this.originData=new Map}acquire(t){return this.register(this.factory.getOrigin(t))}register(t){const r=this.originData.get(t.id);return r?(r.refCount++,r.origin):(this.originData.set(t.id,{refCount:1,viewMatrix:Ce(),origin:t}),t)}release(t){const r=this.originData.get(t.id);r&&(r.refCount--,r.refCount===0&&this.originData.delete(t.id))}updateViewMatrices(t){this.originData.forEach(r=>{Is(r.viewMatrix,t),iRt(r.origin.vec3,r.viewMatrix)})}getViewMatrix(t){return this.originData.get(t.id).viewMatrix}}class nRt extends PPe{constructor(t,r,i){super(),this.distanceFalloffFactor=t,this.minimumEdgeLength=r,this.transparency=i,this.transformNormalViewFromGlobal=$i()}}class oRt extends IPe{constructor(){super(...arguments),this.transformNormalViewFromGlobal=$i(),this.slicePlaneLocalOrigin=M(),this.transformNormalGlobalFromModel=$i()}}function aRt(e){const t=S`bool isNaN( float val )
{
return ( val < 0.0 || 0.0 < val || val == 0.0 ) ? false : true;
}`;e.code.add(t)}const lRt=Fr(.5,-4e-4);function cRt(e,t){const r=e.vertex;r.include(aRt),r.constants.add("depthBias","vec2",lRt),r.uniforms.add(new _r("inverseViewport",(i,s)=>s.inverseViewport)),t.legacy?(r.uniforms.add(new I1("localView")),r.uniforms.add(new Ei("proj",(i,s)=>s.camera.projectionMatrix)),r.code.add(S`vec2 calculateProjectedBiasXY(vec4 projPos, vec3 globalNormal) {
float offsetXY = depthBias.x;
vec4 projNormal = proj * localView * vec4(globalNormal, 0.0);
return offsetXY * projPos.w * 2.0 * inverseViewport * normalize(projNormal.xyz).xy;
}`)):(r.uniforms.add(new SL("transformNormalViewFromGlobal",i=>i.transformNormalViewFromGlobal)),r.uniforms.add(new Ei("transformProjFromView",i=>i.transformProjFromView)),r.code.add(S`vec2 calculateProjectedBiasXY(vec4 projPos, vec3 globalNormal) {
float offsetXY = depthBias.x;
vec4 projNormal = transformProjFromView * vec4(transformNormalViewFromGlobal * globalNormal, 0.0);
return offsetXY * projPos.w * 2.0 * inverseViewport * normalize(projNormal.xyz).xy;
}`)),r.code.add(S`float _calculateProjectedBiasZ(vec4 projPos) {
float offsetZ = depthBias.y;
return sqrt(max(projPos.z,0.0)) * offsetZ;
}
vec4 adjustProjectedPosition(vec4 projPos, vec3 worldNormal, float lineWidth) {
vec2 offsetXY = calculateProjectedBiasXY(projPos, worldNormal);
if (!isNaN(offsetXY.x) && !isNaN(offsetXY.y)) {
projPos.xy += offsetXY;
}
projPos.z += _calculateProjectedBiasZ(projPos);
return projPos;
}`)}function uRt(e,t){const r=e.fragment;r.constants.add("coverageTestThreshold","float",.01),t.antialiasing?r.code.add(S`#define discardByCoverage(radius, coverage) { if (coverage < coverageTestThreshold) discard; }`):r.code.add(S`#define discardByCoverage(radius, coverage) { float coverageLimit = radius <= 0.5 ? coverageTestThreshold : 0.75; if (coverage < coverageLimit) discard; }`)}function hRt(e,t){const r=e.vertex;t.silhouette?(r.code.add(S`bool isSilhouetteEdge(vec3 viewDir, vec3 normalA, vec3 normalB) {
float faceAVisible = dot(viewDir, normalA);
float faceBVisible = dot(viewDir, normalB);
return faceAVisible * faceBVisible < 0.0;
}`),t.legacy?r.code.add(S`bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos) {
vec3 viewNormalA = _modelToViewNormal(normalA);
vec3 viewNormalB = _modelToViewNormal(normalB);
vec3 viewDir = -viewPos;
if (isSilhouetteEdge(viewDir, viewNormalA, viewNormalB)) {
return false;
}
gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
return true;
}`):r.code.add(S`bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos) {
vec3 worldNormalA = _modelToWorldNormal(normalA);
vec3 worldNormalB = _modelToWorldNormal(normalB);
vec3 viewDir = -worldPos;
if (isSilhouetteEdge(viewDir, worldNormalA, worldNormalB)) {
return false;
}
gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
return true;
}`)):r.code.add(S`bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos) {
return false;
}`)}function dRt(e,t){const r=e.vertex;r.include(hu),r.uniforms.add(new qe("distanceFalloffFactor",i=>i.distanceFalloffFactor)),r.code.add(S`float distanceBasedPerspectiveFactor(float distance) {
return clamp(sqrt(distanceFalloffFactor / distance), 0.0, 1.0);
}`),r.uniforms.add(new Hi("componentDataTex")),r.uniforms.add(new Zy("componentDataTexInvDim")),e.attributes.add(O.COMPONENTINDEX,"float"),r.constants.add("componentColorFieldOffset","float",0),r.constants.add("componentOtherFieldOffset","float",1),r.constants.add("componentVerticalOffsetFieldOffset","float",2),r.constants.add("componentFieldCount","float",3),r.constants.add("lineWidthFractionFactor","float",8),r.constants.add("extensionLengthOffset","float",128),r.constants.add("componentTexWidth","float",4096),r.constants.add("verticalOffsetScale","float",2*une),r.code.add(S`vec2 _componentTextureCoords(float componentIndex, float fieldOffset) {
float fieldIndex = componentFieldCount * componentIndex + fieldOffset;
float rowIndex = floor(fieldIndex / componentTexWidth);
float colIndex = mod(fieldIndex, componentTexWidth);
vec2 linearIndex = vec2(
(colIndex + 0.5) / componentTexWidth,
(rowIndex + 0.5) * componentDataTexInvDim.y
);
return linearIndex;
}
struct ComponentData {
vec4 color;
float lineWidth;
float extensionLength;
float type;
float verticalOffset;
};
ComponentData readComponentData() {
vec2 colorIndex = _componentTextureCoords(componentIndex, componentColorFieldOffset);
vec2 otherIndex = _componentTextureCoords(componentIndex, componentOtherFieldOffset);
vec2 verticalOffsetIndex = _componentTextureCoords(componentIndex, componentVerticalOffsetFieldOffset);
vec4 colorValue = texture2D(componentDataTex, colorIndex);
vec4 otherValue = texture2D(componentDataTex, otherIndex);
float verticalOffset = (rgba2float(texture2D(componentDataTex, verticalOffsetIndex)) - 0.5) * verticalOffsetScale;
return ComponentData(
vec4(colorValue.rgb, colorValue.a * otherValue.w),
otherValue.x * (255.0 / lineWidthFractionFactor),
otherValue.y * 255.0 - extensionLengthOffset,
-(otherValue.z * 255.0) + 0.5,
verticalOffset
);
}`),t.legacy?r.code.add(S`vec3 _modelToWorldNormal(vec3 normal) {
return (model * vec4(normal, 0.0)).xyz;
}
vec3 _modelToViewNormal(vec3 normal) {
return (localView * model * vec4(normal, 0.0)).xyz;
}`):(r.uniforms.add(new kI("transformNormalGlobalFromModel",i=>i.transformNormalGlobalFromModel)),r.code.add(S`vec3 _modelToWorldNormal(vec3 normal) {
return transformNormalGlobalFromModel * normal;
}`)),t.silhouette?(e.attributes.add(O.NORMALA,"vec3"),e.attributes.add(O.NORMALB,"vec3"),r.code.add(S`vec3 worldNormal() {
return _modelToWorldNormal(normalize(normalA + normalB));
}`)):(e.attributes.add(O.NORMAL,"vec3"),r.code.add(S`vec3 worldNormal() {
return _modelToWorldNormal(normal);
}`)),t.legacy?r.code.add(S`void worldAndViewFromModelPosition(vec3 modelPos, float verticalOffset, out vec3 worldPos, out vec3 viewPos) {
worldPos = (model * vec4(modelPos, 1.0)).xyz;
viewPos = (localView * vec4(worldPos, 1.0)).xyz;
}`):(r.include(tz,t),r.include(tz,t),r.uniforms.add([new SL("transformViewFromCameraRelativeRS",i=>i.transformViewFromCameraRelativeRS),new kI("transformWorldFromModelRS",i=>i.transformWorldFromModelRS),new pl("transformWorldFromModelTL",i=>i.transformWorldFromModelTL),new pl("transformWorldFromModelTH",i=>i.transformWorldFromModelTH),new St("transformWorldFromViewTL",i=>i.transformWorldFromViewTL),new St("transformWorldFromViewTH",i=>i.transformWorldFromViewTH)]),r.code.add(S`
      void worldAndViewFromModelPosition(vec3 modelPos, float verticalOffset, out vec3 worldPos, out vec3 viewPos) {
        vec3 rotatedModelPosition = transformWorldFromModelRS * modelPos;

        vec3 transformCameraRelativeFromModel = dpAdd(
          transformWorldFromModelTL,
          transformWorldFromModelTH,
          -transformWorldFromViewTL,
          -transformWorldFromViewTH
        );

        worldPos = transformCameraRelativeFromModel + rotatedModelPosition;

        if (verticalOffset != 0.0) {
          vec3 vUp = ${t.spherical?S`normalize(transformWorldFromModelTL + rotatedModelPosition);`:S`vec3(0.0, 0.0, 1.0);`}
          worldPos += verticalOffset * vUp;
        }

        viewPos = transformViewFromCameraRelativeRS * worldPos;
      }
    `)),r.uniforms.add(new Ei("transformProjFromView",(i,s)=>s.camera.projectionMatrix)),r.code.add(S`vec4 projFromViewPosition(vec3 position) {
return transformProjFromView * vec4(position, 1.0);
}`),r.code.add(S`float calculateExtensionLength(float extensionLength, float lineLength) {
return extensionLength / (log2(max(1.0, 256.0 / lineLength)) * 0.2 + 1.0);
}`)}function DLe(e){return e.mode===Zs.SKETCH||e.mode===Zs.MIXED}var Zs;(function(e){e[e.SOLID=0]="SOLID",e[e.SKETCH=1]="SKETCH",e[e.MIXED=2]="MIXED",e[e.COUNT=3]="COUNT"})(Zs||(Zs={}));function pRt(e,t){const r=e.vertex;switch(t.mode){case Zs.SKETCH:r.code.add(S`#define discardShortEdges(unpackedAttributes, lineLengthPixels) { if (lineLengthPixels <= 3.0) { gl_Position = vec4(10.0, 10.0, 10.0, 1.0); return; }}`);break;case Zs.MIXED:r.code.add(S`#define discardShortEdges(unpackedAttributes, lineLengthPixels) { if (unpackedAttributes.type <= 0.0 && lineLengthPixels <= 3.0) { gl_Position = vec4(10.0, 10.0, 10.0, 1.0); return; }}`);break;case Zs.SOLID:r.code.add(S`#define discardShortEdges(unpackedAttributes, lineLengthPixels) {}`)}}function gne(e,t){const r=e.vertex;switch(e.attributes.add(O.SIDENESS,"vec2"),t.mode===Zs.MIXED?r.code.add(S`struct UnpackedAttributes {
vec2 sideness;
vec2 sidenessNorm;
float lineWidthPixels;
float extensionLengthPixels;
float type;
};`):r.code.add(S`struct UnpackedAttributes {
vec2 sideness;
vec2 sidenessNorm;
float lineWidthPixels;
float extensionLengthPixels;
};`),t.mode){case Zs.MIXED:r.code.add(S`UnpackedAttributes unpackAttributes(ComponentData component) {
vec2 sidenessNorm = sideness;
vec2 sideness = sidenessNorm * 2.0 - 1.0;
float fType = component.type;
float extensionLengthPixels = component.extensionLength;
float lineWidth = component.lineWidth;
if (fType <= 0.0) {
extensionLengthPixels *= variantExtension * 2.0 - 1.0;
}
return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels, fType);
}`);break;case Zs.SKETCH:r.code.add(S`UnpackedAttributes unpackAttributes(ComponentData component) {
vec2 sidenessNorm = sideness;
vec2 sideness = sidenessNorm * 2.0 - 1.0;
float extensionLengthPixels = component.extensionLength;
extensionLengthPixels *= variantExtension * 2.0 - 1.0;
float lineWidth = component.lineWidth;
return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels);
}`);break;case Zs.SOLID:r.code.add(S`UnpackedAttributes unpackAttributes(ComponentData component) {
vec2 sidenessNorm = sideness;
vec2 sideness = sidenessNorm * 2.0 - 1.0;
float extensionLengthPixels = component.extensionLength;
float lineWidth = component.lineWidth;
return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels);
}`);break;case Zs.COUNT:break;default:t.mode}}function fRt(e,t){const r=e.vertex;switch(e.include(gne,t),DLe(t)&&r.uniforms.add(new kr("strokesAmplitude")),t.mode){case Zs.SOLID:r.code.add(S`float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {
return 0.0;
}`);break;case Zs.SKETCH:r.code.add(S`float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {
return strokesAmplitude;
}`);break;case Zs.MIXED:r.code.add(S`float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {
float type = unpackedAttributes.type;
if (type <= 0.0) {
return strokesAmplitude;
}
else {
return 0.0;
}
}`)}}function mRt(e,t){const r=e.vertex;e.include(gne,t);const i=e.fragment;switch(DLe(t)&&(r.uniforms.add(new Zy("strokesTextureScale")),r.uniforms.add(new kr("strokesLog2Resolution")),r.uniforms.add(new kr("strokeVariants")),e.varyings.add("vStrokeUV","vec2"),i.uniforms.add(new Hi("strokesTexture")),i.uniforms.add(new kr("strokesNormalizationScale")),r.code.add(S`void calculateStyleOutputsSketch(float lineLength, UnpackedAttributes unpackedAttributes) {
vec2 sidenessNorm = unpackedAttributes.sidenessNorm;
float lineIndex = clamp(ceil(log2(lineLength)), 0.0, strokesLog2Resolution);
vStrokeUV = vec2(exp2(lineIndex) * sidenessNorm.y, lineIndex * strokeVariants + variantStroke + 0.5) * strokesTextureScale;
vStrokeUV.x += variantOffset;
}`),e.fragment.include(hu),i.code.add(S`float calculateLineOffsetSketch() {
float offsetNorm = rgba2float(texture2D(strokesTexture, vStrokeUV));
return (offsetNorm - 0.5) * strokesNormalizationScale;
}
float calculateLinePressureSketch() {
return rgba2float(texture2D(strokesTexture, vStrokeUV + vec2(0.0, 0.5)));
}`)),t.mode){case Zs.SOLID:r.code.add(S`void calculateStyleOutputs(UnpackedAttributes unpackedAttributes) {}`),i.code.add(S`float calculateLineOffset() {
return 0.0;
}
float calculateLinePressure() {
return 1.0;
}`);break;case Zs.SKETCH:r.code.add(S`void calculateStyleOutputs(UnpackedAttributes unpackedAttributes)
{
calculateStyleOutputsSketch(vLineLengthPixels, unpackedAttributes);
}`),i.code.add(S`float calculateLineOffset() {
return calculateLineOffsetSketch();
}
float calculateLinePressure() {
return calculateLinePressureSketch();
}`);break;case Zs.MIXED:e.varyings.add("vType","float"),r.code.add(S`void calculateStyleOutputs(UnpackedAttributes unpackedAttributes)
{
vType = unpackedAttributes.type;
if (unpackedAttributes.type <= 0.0) {
calculateStyleOutputsSketch(vLineLengthPixels, unpackedAttributes);
}
}`),i.code.add(S`float calculateLineOffset() {
if (vType <= 0.0) {
return calculateLineOffsetSketch();
}
else {
return 0.0;
}
}
float calculateLinePressure() {
if (vType <= 0.0) {
return calculateLinePressureSketch();
}
else {
return 1.0;
}
}`)}}function gRt(e){const t=new Yr,r=t.vertex,i=t.fragment;return e.legacy&&r.uniforms.add(new I1("model")),e.antialiasing&&(r.code.add(S`#define ANTIALIASING 1`),i.code.add(S`#define ANTIALIASING 1`)),t.include(cRt,e),t.include(dRt,e),t.include(fRt,e),t.include(gne,e),t.include(mRt,e),t.include(Ss,e),t.include(hRt,e),t.include(uRt,e),t.include(pRt,e),t.include(Th,e),t.varyings.add("vColor","vec4"),t.varyings.add("vRadius","float"),t.varyings.add("vPosition","vec3"),t.varyings.add("vWorldPosition","vec3"),t.varyings.add("vViewPos","vec3"),t.varyings.add("vLineLengthPixels","float"),t.varyings.add("vSizeFalloffFactor","float"),r.uniforms.add(new _r("pixelToNDC",(s,n)=>vr(yRt,2/n.camera.fullViewport[2],2/n.camera.fullViewport[3]))),r.uniforms.add(new lr("viewport",(s,n)=>n.camera.fullViewport)),r.uniforms.add(new qe("pixelRatio",(s,n)=>n.camera.pixelRatio)),t.attributes.add(O.POSITION0,"vec3"),t.attributes.add(O.POSITION1,"vec3"),t.attributes.add(O.VARIANTOFFSET,"float"),t.attributes.add(O.VARIANTSTROKE,"float"),t.attributes.add(O.VARIANTEXTENSION,"float"),r.code.add(S`const float opaqueCutoff = 1.0 / 255.0;
void calculateGeometricOutputs(vec3 viewPosV0, vec3 viewPosV1, vec3 worldPosV0, vec3 worldPosV1, vec3 worldNormal, UnpackedAttributes unpackedAttributes) {
vec2 sideness = unpackedAttributes.sideness;
vec2 sidenessNorm = unpackedAttributes.sidenessNorm;
vWorldPosition = mix(worldPosV0, worldPosV1, sidenessNorm.y).xyz;
vec3 viewPos = mix(viewPosV0, viewPosV1, sidenessNorm.y);
vViewPos = viewPos;
vec4 projPosV0 = projFromViewPosition(viewPosV0);
vec4 projPosV1 = projFromViewPosition(viewPosV1);
vec4 projPos = projFromViewPosition(viewPos);
vec3 screenSpaceLineNDC = (projPosV1.xyz / projPosV1.w - projPosV0.xyz / projPosV0.w);
vec2 ndcToPixel = viewport.zw * 0.5;
vec2 screenSpaceLinePixels = screenSpaceLineNDC.xy * ndcToPixel;
float lineLengthPixels = length(screenSpaceLinePixels);
float dzPerPixel = screenSpaceLineNDC.z / lineLengthPixels;
vec2 screenSpaceDirection = screenSpaceLinePixels / lineLengthPixels;
vec2 perpendicularScreenSpaceDirection = vec2(screenSpaceDirection.y, -screenSpaceDirection.x) * sideness.x;
float falloffFactor = distanceBasedPerspectiveFactor(-viewPos.z) * pixelRatio;
float lineWidthPixels = unpackedAttributes.lineWidthPixels * falloffFactor;
float extensionLengthPixels = calculateExtensionLength(unpackedAttributes.extensionLengthPixels, lineLengthPixels) * falloffFactor;
float lineAmplitudePixels = calculateLineAmplitude(unpackedAttributes) * pixelRatio;
vSizeFalloffFactor = falloffFactor;
float lineWidthAndAmplitudePixels = lineWidthPixels + lineAmplitudePixels + lineAmplitudePixels;
float extendedLineLengthPixels = lineLengthPixels + extensionLengthPixels + extensionLengthPixels;
#ifdef ANTIALIASING
const float aaPaddingPixels = 1.0;
float halfAAPaddedLineWidthAndAmplitudePixels = lineWidthAndAmplitudePixels * 0.5 + aaPaddingPixels;
float aaPaddedRoundedCapSizePixels = lineWidthPixels * 0.5 + aaPaddingPixels;
#else
float halfAAPaddedLineWidthAndAmplitudePixels = max(lineWidthAndAmplitudePixels, 1.0) * 0.5;
float aaPaddedRoundedCapSizePixels = max(lineWidthPixels, 1.0) * 0.5;
#endif
vec2 halfAAPaddedLineWidthAndAmplitudeNDC = halfAAPaddedLineWidthAndAmplitudePixels * pixelToNDC;
vec2 aaPaddedRoundedCapSizeNDC = aaPaddedRoundedCapSizePixels * pixelToNDC;
vec2 extensionLengthNDC = extensionLengthPixels * pixelToNDC;
vec2 ndcOffset = (
screenSpaceDirection * sideness.y * (aaPaddedRoundedCapSizeNDC + extensionLengthNDC)
+ perpendicularScreenSpaceDirection * halfAAPaddedLineWidthAndAmplitudeNDC
);
projPos.xy += ndcOffset * projPos.w;
projPos.z += (dzPerPixel * (aaPaddedRoundedCapSizePixels + extensionLengthPixels)) * sideness.y * projPos.w;
projPos = adjustProjectedPosition(projPos, worldNormal, 1.0 + max((lineWidthAndAmplitudePixels - 1.0) * 0.5, 0.0));
float aaPaddedLineWithCapsLengthPixels = extendedLineLengthPixels + aaPaddedRoundedCapSizePixels + aaPaddedRoundedCapSizePixels;
float pixelPositionAlongLine = aaPaddedLineWithCapsLengthPixels * sidenessNorm.y - aaPaddedRoundedCapSizePixels;
vPosition = vec3(
halfAAPaddedLineWidthAndAmplitudePixels * sideness.x,
pixelPositionAlongLine,
pixelPositionAlongLine / extendedLineLengthPixels
);
vRadius = lineWidthPixels * 0.5;
vLineLengthPixels = extendedLineLengthPixels;
discardShortEdges(unpackedAttributes, lineLengthPixels);
gl_Position = projPos;
}
void main() {
ComponentData component = readComponentData();
UnpackedAttributes unpackedAttributes = unpackAttributes(component);
vec3 worldPosV0, worldPosV1, viewPosV0, viewPosV1;
worldAndViewFromModelPosition(position0, component.verticalOffset, worldPosV0, viewPosV0);
worldAndViewFromModelPosition(position1, component.verticalOffset, worldPosV1, viewPosV1);
vColor = component.color;
if (vColor.a < opaqueCutoff) {
gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
return;
}
if (discardNonSilhouetteEdges(viewPosV0, worldPosV0)) {
return;
}
calculateGeometricOutputs(viewPosV0, viewPosV1, worldPosV0, worldPosV1, worldNormal(), unpackedAttributes);
calculateStyleOutputs(unpackedAttributes);
}`),t.fragment.code.add(S`
    vec2 lineWithCapsDistance(float radius, vec2 position, float lineLength) {
      float lineOffset = calculateLineOffset();
      float positionX = position.x - lineOffset;

      if (radius < 1.0) {
        // Handle this specifically for subpixel sizes:
        // 1. Compute correct coverage (note coverage is computed by
        //    0.5 - dist, so we make sure that that will lead to correct
        //    subpixel coverage
        // 2. Ignore rounded caps
        float coverageX = clamp(min(radius, positionX + 0.5) - max(-radius, positionX - 0.5), 0.0, 1.0);
        float coverageY = clamp(min(lineLength, position.y + 0.5) - max(0.0, position.y - 0.5), 0.0, 1.0);

        float coverage = min(coverageX, coverageY);

        return vec2(0.5 - coverage, 0.0);
      }
      else {
        // Between -radius -> 0 for start cap, 0 for line, 0 -> radius
        float positionOnCap = position.y - clamp(position.y, 0.0, lineLength);

        vec2 lineToPosition = vec2(positionX, positionOnCap);
        return vec2(length(lineToPosition) - radius, positionOnCap / radius);
      }
    }

    void main() {
      ${e.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, vViewPos.z);":""}
      float radius = vRadius * calculateLinePressure();

      vec2 distance = lineWithCapsDistance(radius, vPosition.xy, vLineLengthPixels);
      float coverage = clamp(0.5 - distance.x, 0.0, 1.0);

      discardByCoverage(radius, coverage);
      discardBySlice(vWorldPosition);

      float alpha = vColor.a * coverage;

      gl_FragColor = vec4(vColor.rgb, alpha);

    }
  `),t}const yRt=rt(),vRt=Object.freeze(Object.defineProperty({__proto__:null,build:gRt},Symbol.toStringTag,{value:"Module"}));class k8 extends gi{initializeProgram(t){const r=k8.shader.get().build(this.configuration);return new oi(t.rctx,r,pJ)}initializePipeline(t){return t.blendMinMax?Gt({blending:No(Ae.ONE,Ae.ONE,Ae.ZERO,Ae.ONE,y0.ADD,t.blendMinMax.MAX),depthTest:{func:_i.LEQUAL},colorWrite:or}):Gt({depthTest:{func:_i.LEQUAL},depthWrite:cc,colorWrite:or})}}k8.shader=new ni(vRt,()=>ie(()=>import("./EdgeShader.glsl.2dd48af2.js"),[],import.meta.url));class mm extends Ca{constructor(){super(...arguments),this.mode=Zs.SOLID,this.hasSlicePlane=!1,this.silhouette=!1,this.legacy=!1,this.antialiasing=!1,this.doublePrecisionRequiresObfuscation=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1,this.spherical=!1}}u([q({count:Zs.COUNT})],mm.prototype,"mode",void 0),u([q()],mm.prototype,"hasSlicePlane",void 0),u([q()],mm.prototype,"silhouette",void 0),u([q()],mm.prototype,"legacy",void 0),u([q()],mm.prototype,"antialiasing",void 0),u([q()],mm.prototype,"doublePrecisionRequiresObfuscation",void 0),u([q()],mm.prototype,"hasMultipassTerrain",void 0),u([q()],mm.prototype,"cullAboveGround",void 0),u([q()],mm.prototype,"spherical",void 0);const _Rt=8,uH=128,bRt={type:"uber",hasSlicePlane:!1,strokesTexture:null,legacy:!0,spherical:!0};class wRt{constructor(){this._value=0}get value(){return this._value}increment(){this._value++}decrement(){this._value--}}const xRt={solid:Zs.SOLID,sketch:Zs.SKETCH,uber:Zs.MIXED};class PP{constructor(t,r,i){this.rctx=t,this.shaderTechniqueRepository=r,this._configuration=new mm,this.refCount=new wRt,this.renderables=new Set,this.sortedRenderables={[Nt.TRANSPARENT]:{[Nt.TRANSPARENT]:new Xt,[Nt.OPAQUE]:new Xt},[Nt.OPAQUE]:{[Nt.TRANSPARENT]:new Xt,[Nt.OPAQUE]:new Xt}},this._renderablesDirty=!1,this._drawParameters=new oRt,this._settings={...bRt,...i},this.key=PP.getKey(this._settings.type,this._settings.hasSlicePlane,this._settings.legacy);const s=this._settings.strokesTexture.variants;this.writerSettings={variants:s,reducedPrecision:Xr.TESTS_DISABLE_OPTIMIZATIONS},this._configuration.legacy=this._settings.legacy,this._configuration.mode=xRt[this._settings.type],this._configuration.silhouette=!1,this._configuration.antialiasing=!!this.rctx.capabilities.blendMinMax,this._configuration.hasSlicePlane=this._settings.hasSlicePlane,this._configuration.doublePrecisionRequiresObfuscation=ML(t),this._configuration.spherical=i.spherical}dispose(){this._technique=ti(this._technique)}addRenderable(t){this.renderables.add(t),this._renderablesDirty=!0}removeRenderable(t){this.renderables.delete(t),this._renderablesDirty=!0}setRenderablesDirty(){this._renderablesDirty=!0}forEachRenderable(t,r){this._renderablesDirty&&this._sortRenderables(),this.sortedRenderables[r][Nt.TRANSPARENT].forAll(t),this.sortedRenderables[r][Nt.OPAQUE].forAll(t)}updateTechnique(t,r){return this._configuration.hasMultipassTerrain=!!t.multipassTerrain.enabled,this._configuration.cullAboveGround=!!t.multipassTerrain.cullAboveGround,this._configuration.silhouette=r,this._technique=this.shaderTechniqueRepository.releaseAndAcquire(k8,this._configuration,this._technique),this._technique}bindRegularEdges(t,r){return this.rctx.bindTechnique(this.updateTechnique(r,!1),t,r)}bindSilhouetteEdges(t,r){return this.rctx.bindTechnique(this.updateTechnique(r,!0),t,r)}renderRegularEdges(t,r,i,s,n){this._render(t,r,r.regular.vao,i,s,n)}renderSilhouetteEdges(t,r,i,s,n){this._render(t,r,r.silhouette.vao,i,s,n)}_render(t,r,i,s,n,o){this._bindDraw(t,r,s,o),this.rctx.bindVAO(i),this.rctx.capabilities.instancing.drawArraysInstanced(Lt.TRIANGLE_FAN,0,4,n)}_bindDraw(t,r,i,s){if(r.components.buffer.textureBuffer.bind(t,TRt,SRt),"origin"in r.transform)t.setUniformMatrix4fv("localView",s),t.setUniformMatrix4fv("model",r.transform.modelMatrix),ae(this._drawParameters.slicePlaneLocalOrigin,r.transform.origin.vec3);else{const n=new O8(r.transform.position),o=jd(xye,sS(xye,r.transform.rotationScale));this._drawParameters.transformWorldFromModelTL=n.low,this._drawParameters.transformWorldFromModelTH=n.high,this._drawParameters.transformWorldFromModelRS=r.transform.rotationScale,this._drawParameters.transformNormalGlobalFromModel=o;const a=i.camera.viewInverseTransposeMatrix;se(this._drawParameters.slicePlaneLocalOrigin,a[3],a[7],a[11])}t.bindDraw(this._drawParameters,i),this._settings.type!=="uber"&&this._settings.type!=="sketch"||this._setSketchUniforms(t)}_setSketchUniforms(t){const r=this._settings.strokesTexture,i=r.texture;R(i)||(t.bindTexture("strokesTexture",i),t.setUniform2f("strokesTextureScale",1/i.descriptor.width,1/i.descriptor.height),t.setUniform1f("strokesLog2Resolution",Math.log2(r.resolution)),t.setUniform1f("strokesNormalizationScale",r.normalizationScale),t.setUniform1f("strokesAmplitude",r.amplitude),t.setUniform1f("strokeVariants",r.variants))}_sortRenderables(){this._renderablesDirty=!1,this.sortedRenderables[Nt.TRANSPARENT][Nt.TRANSPARENT].clear(),this.sortedRenderables[Nt.TRANSPARENT][Nt.OPAQUE].clear(),this.sortedRenderables[Nt.OPAQUE][Nt.TRANSPARENT].clear(),this.sortedRenderables[Nt.OPAQUE][Nt.OPAQUE].clear(),this.renderables.forEach(r=>{r.objectTransparency!==Nt.INVISIBLE&&r.edgeTransparency!==Nt.INVISIBLE&&this.sortedRenderables[r.objectTransparency][r.edgeTransparency].push(r)});const t=(r,i)=>"origin"in r.transform&&"origin"in i.transform?r.transform.origin.id<i.transform.origin.id?-1:r.transform.origin.id>i.transform.origin.id?1:0:0;this.sortedRenderables[Nt.TRANSPARENT][Nt.TRANSPARENT].sort(t),this.sortedRenderables[Nt.TRANSPARENT][Nt.OPAQUE].sort(t),this.sortedRenderables[Nt.OPAQUE][Nt.TRANSPARENT].sort(t),this.sortedRenderables[Nt.OPAQUE][Nt.OPAQUE].sort(t)}static getKey(t,r,i){return`edges-t:${t}:${r}:${i}`}}const TRt="componentDataTex",SRt="componentDataTexInvDim",xye=Ky();class ERt extends g$e{constructor(t){super("EdgeProcessingWorker","extract",{extract:r=>[r.dataBuffer],extractComponentsEdgeLocations:r=>[r.dataBuffer],extractEdgeLocations:r=>[r.dataBuffer]},t)}async process(t,r,i){if(i)return fne(t);const s=this._packInput(t),n=await this.invoke(s,r);return this._unpackOutput(n)}async extractEdgeLocations(t,r){const i=this._packInput(t),s=await this.invokeMethod("extractEdgeLocations",i,r);return i4(s)}async extractComponentsEdgeLocations(t,r){const i=this._packInput(t),s=await this.invokeMethod("extractComponentsEdgeLocations",i,r);return i4(s)}_packInput(t){return{dataBuffer:t.data.buffer,writerSettings:t.writerSettings,skipDeduplicate:t.skipDeduplicate,indicesBuffer:t.indices.buffer,indicesType:sU(t.indices)?"Uint32Array":"Uint16Array",indicesLength:t.indicesLength}}_unpackOutput(t){return{regular:{instancesData:i4(t.regular.instancesData),lodInfo:{lengths:new Float32Array(t.regular.lodInfo.lengths)}},silhouette:{instancesData:i4(t.silhouette.instancesData),lodInfo:{lengths:new Float32Array(t.silhouette.lodInfo.lengths)}},averageEdgeLength:t.averageEdgeLength}}}function CRt(e){const r=QO.resolution,i=r/2,s=new Uint8Array(4*r*r),n=4*r*i,o=QO.amplitude,a=2*o,l=4*r,c=Math.log2(r)+1,h=QO.strokes.length;let p=(c-1)*h*l;for(const{distance:m,pressure:g}of QO.strokes){let v=m,w=g,_=p;for(let T=0;T<c;T++){T!==0&&(v=Tye(v,A$.DISTANCE),w=Tye(w,A$.PRESSURE));for(let x=0;x<QO.resolution;x++){const E=.5+(v?v[x%v.length]/a:0),C=w?w[x%w.length]:1;n$(E,s,_),n$(C,s,_+n),_+=4}_-=l*(h+1)}p+=l}const f=new nt(e,{pixelFormat:ze.RGBA,dataType:Ct.UNSIGNED_BYTE,hasMipmap:!1,samplingMode:et.LINEAR,width:r,height:r,wrapMode:xt.REPEAT},s);return new RRt(r,a,o,h,f)}function Tye(e,t){if(!e)return null;const r=e.length/2,i=ARt*r,s=new Array(r);let n=0;const o=t===A$.PRESSURE;for(let a=0;a<e.length;a+=2){const l=(e[a]+e[a+1])/2;s[n++]=o?Math.min(i,1-(1-l)*Sye):Math.min(i,l*Sye)}return s}var A$;(function(e){e[e.DISTANCE=0]="DISTANCE",e[e.PRESSURE=1]="PRESSURE"})(A$||(A$={}));const ARt=.1,Sye=.5;class RRt{constructor(t,r,i,s,n){this.resolution=t,this.normalizationScale=r,this.amplitude=i,this.variants=s,this.texture=n}dispose(){this.texture=Ye(this.texture)}}const QO={amplitude:8,resolution:256,strokes:[{distance:[-1.59027,-1.59426,-1.59674,-1.59766,-1.59702,-1.59479,-1.59095,-1.5855,-1.57843,-1.56973,-1.55942,-1.5475,-1.53398,-1.5189,-1.50226,-1.4841,-1.46446,-1.44337,-1.42088,-1.39703,-1.37188,-1.34547,-1.31786,-1.28912,-1.2593,-1.22847,-1.19668,-1.16402,-1.13053,-1.09629,-1.06137,-1.02582,-.98972,-.95313,-.91611,-.87872,-.84102,-.80306,-.76488,-.72654,-.68807,-.64952,-.61092,-.57232,-.53375,-.49527,-.45692,-.41874,-.38078,-.34309,-.3057,-.26867,-.23204,-.19585,-.16015,-.12497,-.09036,-.05634,-.02296,.00977,.04183,.07321,.10389,.13386,.16313,.19169,.21956,.24672,.27321,.299,.32413,.34858,.37237,.3955,.41798,.43981,.461,.48154,.50145,.52073,.53939,.55744,.57488,.5917,.6079,.62347,.63837,.65259,.66609,.67885,.69083,.70201,.71235,.72183,.73042,.73812,.7449,.75076,.7557,.75973,.76284,.76507,.76642,.76692,.76659,.76545,.76352,.76083,.7574,.75324,.74837,.74279,.73652,.72959,.72199,.71377,.70493,.69553,.68558,.67515,.66426,.65298,.64135,.62944,.6173,.60499,.59257,.58008,.56759,.55513,.54275,.5305,.51842,.50654,.4949,.48353,.47246,.4617,.45128,.44121,.43149,.42213,.41313,.40448,.39617,.38818,.3805,.37309,.36594,.35902,.35229,.34572,.33927,.33292,.32663,.32035,.31407,.30774,.30135,.29486,.28824,.28148,.27454,.26739,.26002,.25241,.24454,.23639,.22796,.21922,.21016,.20076,.19098,.18082,.17023,.1592,.14768,.13566,.1231,.10996,.09624,.08188,.06688,.05121,.03485,.01778,0,-.0185,-.03771,-.05763,-.07824,-.09952,-.12144,-.14396,-.16706,-.19069,-.21481,-.23938,-.26436,-.28971,-.31539,-.34136,-.36759,-.39404,-.42067,-.44746,-.47437,-.50136,-.52839,-.55544,-.58248,-.60948,-.63642,-.66329,-.6901,-.71684,-.74352,-.77015,-.79675,-.82332,-.84988,-.87644,-.90301,-.92958,-.95615,-.98272,-1.00926,-1.03575,-1.06217,-1.08847,-1.11463,-1.1406,-1.16633,-1.19178,-1.2169,-1.24164,-1.26595,-1.28979,-1.31312,-1.3359,-1.35809,-1.37963,-1.4005,-1.42064,-1.44,-1.45853,-1.47616,-1.49285,-1.50853,-1.52313,-1.53659,-1.54886,-1.55986,-1.56955,-1.57788,-1.5848],pressure:[-.01365,-.00206,.01025,.02327,.03696,.05129,.06619,.08163,.09755,.11393,.1307,.14784,.16531,.18308,.20111,.21938,.23786,.25651,.2753,.29419,.31315,.33215,.35115,.37015,.38913,.40806,.42694,.44576,.46449,.48313,.50167,.5201,.53839,.55653,.57448,.59222,.60971,.62692,.6438,.66033,.67648,.69221,.70753,.72242,.73688,.75093,.76456,.77779,.79063,.80309,.81517,.82686,.83817,.84911,.85967,.86987,.87972,.88924,.89845,.90734,.91594,.92425,.93229,.94005,.94754,.95475,.96166,.96826,.97451,.9804,.98588,.99092,.99549,.99957,.99685,.99381,.99131,.98936,.98796,.98711,.98681,.98706,.98787,.98923,.99113,.99357,.99654,1,.99607,.99171,.98695,.98181,.97634,.97057,.96452,.95824,.95175,.94506,.93818,.93113,.92389,.91647,.90887,.90109,.89314,.88501,.87672,.86831,.85978,.85119,.84256,.83393,.82533,.8168,.80836,.80002,.79181,.78374,.77582,.7681,.76059,.75331,.74629,.73955,.73311,.72697,.72116,.71568,.71054,.70572,.70121,.697,.69304,.68931,.68576,.68236,.67905,.67582,.67262,.66941,.66619,.66291,.65957,.65613,.65259,.64892,.6451,.6411,.6369,.63248,.62783,.62295,.61783,.61247,.60688,.60104,.59498,.58868,.58216,.57542,.56845,.56125,.5538,.5461,.53813,.52986,.52129,.51239,.50316,.49359,.4837,.47349,.46299,.45223,.44124,.43005,.41869,.40719,.39557,.38386,.37207,.36023,.34836,.33648,.32464,.31287,.30119,.28963,.27822,.26698,.25594,.2451,.23448,.22409,.21391,.20394,.19415,.18452,.17503,.16565,.15636,.14713,.13794,.1288,.11968,.11058,.10151,.09247,.08346,.07447,.06552,.05659,.0477,.03885,.03007,.02137,.01278,.00433,-.00393,-.012,-.01983,-.02738,-.03463,-.04155,-.0481,-.05429,-.0601,-.06553,-.07057,-.07524,-.07954,-.08347,-.08703,-.09022,-.09303,-.09544,-.09744,-.09898,-.10004,-.10059,-.1006,-.10005,-.09892,-.0972,-.09487,-.09192,-.08833,-.08409,-.07918,-.07357,-.06724,-.06019,-.0524,-.04386,-.03455,-.02448]},{distance:[-3.46259,-3.47131,-3.47668,-3.47863,-3.47712,-3.4721,-3.46352,-3.45138,-3.43566,-3.41635,-3.39347,-3.36704,-3.33709,-3.30368,-3.26684,-3.22667,-3.18322,-3.1366,-3.08689,-3.0342,-2.97865,-2.92036,-2.85946,-2.79607,-2.73034,-2.66241,-2.59242,-2.52052,-2.44686,-2.37159,-2.29485,-2.2168,-2.13757,-2.05731,-1.97616,-1.89426,-1.81174,-1.72875,-1.64543,-1.56191,-1.47833,-1.39483,-1.3115,-1.22847,-1.14581,-1.06361,-.98193,-.90083,-.82036,-.74054,-.66141,-.583,-.50532,-.4284,-.35228,-.277,-.20261,-.12916,-.05672,.01463,.08485,.15384,.22153,.28784,.35269,.41602,.47776,.53787,.59629,.653,.70799,.76123,.81274,.86253,.9106,.95698,1.0017,1.04477,1.0862,1.126,1.16415,1.20065,1.23546,1.26857,1.29994,1.32953,1.35731,1.38321,1.40719,1.42921,1.44922,1.46719,1.48309,1.49691,1.50862,1.51825,1.52581,1.53133,1.53486,1.53644,1.53616,1.53409,1.53031,1.52493,1.51803,1.50972,1.50009,1.48924,1.47725,1.46421,1.45019,1.43527,1.4195,1.40295,1.38568,1.36778,1.34929,1.3303,1.31087,1.29108,1.27099,1.25066,1.23018,1.2096,1.18898,1.16838,1.14785,1.12745,1.10721,1.08719,1.06741,1.04791,1.02871,1.00986,.99136,.97324,.95551,.93819,.92127,.90476,.88866,.87296,.85767,.84277,.82823,.81406,.80022,.7867,.77346,.76049,.74774,.73519,.72278,.71049,.69827,.68606,.67381,.66145,.64893,.63618,.62313,.60973,.5959,.5816,.56675,.5513,.53516,.51826,.50053,.4819,.46231,.44169,.42002,.39725,.37336,.34834,.32219,.2949,.2665,.23698,.20638,.17469,.14193,.10809,.07316,.03714,0,-.03827,-.07772,-.11836,-.16022,-.20332,-.24768,-.29332,-.34024,-.38844,-.43788,-.48854,-.54036,-.59329,-.64724,-.70211,-.75782,-.81425,-.87128,-.92881,-.98674,-1.04498,-1.10346,-1.1621,-1.22086,-1.27969,-1.33854,-1.3974,-1.45625,-1.51511,-1.57396,-1.63283,-1.69173,-1.75067,-1.80968,-1.86875,-1.9279,-1.98712,-2.04639,-2.10568,-2.16495,-2.22416,-2.28322,-2.34208,-2.40063,-2.4588,-2.51647,-2.57354,-2.62989,-2.68543,-2.74002,-2.79357,-2.84597,-2.89711,-2.94689,-2.99521,-3.04195,-3.087,-3.13023,-3.17152,-3.21075,-3.24779,-3.28252,-3.3148,-3.34451,-3.37154,-3.39577,-3.41709,-3.43539,-3.45059],pressure:[.87183,.87151,.87129,.87118,.87117,.87128,.87149,.87182,.87225,.8728,.87347,.87424,.87513,.87613,.87723,.87845,.87978,.88122,.88276,.88441,.88616,.88801,.88996,.892,.89414,.89637,.89868,.90108,.90356,.90611,.90874,.91144,.91421,.91704,.91993,.92287,.92587,.92892,.93201,.93514,.93831,.94151,.94474,.94799,.95126,.95456,.95786,.96118,.9645,.96783,.97116,.97448,.9778,.98111,.98441,.9877,.99096,.99421,.99742,.99938,.99622,.9931,.99001,.98697,.98397,.98101,.97811,.97526,.97246,.96972,.96703,.96441,.96185,.95935,.95691,.95455,.95225,.95002,.94786,.94577,.94376,.94182,.93995,.93817,.93646,.93483,.93328,.93181,.93042,.92911,.92788,.92673,.92566,.92467,.92376,.92293,.92217,.92149,.92088,.92034,.91987,.91947,.91913,.91886,.91864,.91849,.91838,.91833,.91834,.91839,.91849,.91863,.91883,.91907,.91935,.91968,.92005,.92046,.92092,.92142,.92195,.92253,.92314,.9238,.92449,.92521,.92598,.92677,.9276,.92847,.92936,.93029,.93125,.93224,.93325,.9343,.93537,.93646,.93758,.93872,.93988,.94106,.94225,.94346,.94469,.94593,.94718,.94844,.94971,.95098,.95226,.95354,.95482,.9561,.95738,.95867,.95995,.96122,.9625,.96377,.96504,.9663,.96757,.96883,.97009,.97135,.97261,.97387,.97513,.9764,.97767,.97895,.98023,.98153,.98284,.98416,.98549,.98684,.98821,.9896,.99101,.99244,.99389,.99537,.99688,.99842,1,.99839,.99675,.99508,.99336,.99161,.98982,.98799,.98613,.98422,.98228,.98029,.97827,.97622,.97414,.97202,.96987,.9677,.96551,.9633,.96107,.95882,.95656,.9543,.95202,.94975,.94747,.94519,.94292,.94065,.93838,.93613,.93388,.93164,.92941,.9272,.92499,.9228,.92062,.91846,.91631,.91418,.91207,.90998,.90792,.90588,.90387,.90189,.89995,.89804,.89617,.89434,.89256,.89083,.88914,.88752,.88595,.88443,.88299,.88161,.8803,.87907,.87791,.87683,.87584,.87494,.87412,.8734,.87278,.87225]},{distance:[.39335,.43437,.47737,.52234,.56923,.61801,.66864,.72109,.7753,.83123,.88882,.94801,1.00875,1.07097,1.13461,1.1996,1.26586,1.33333,1.40193,1.47158,1.54221,1.61373,1.68607,1.75913,1.83284,1.90711,1.98186,2.05699,2.13243,2.20809,2.28387,2.35971,2.4355,2.51117,2.58663,2.66179,2.73658,2.81092,2.88473,2.95792,3.03043,3.10217,3.17308,3.24309,3.31211,3.3801,3.44697,3.51267,3.57712,3.64028,3.70208,3.76247,3.8214,3.87881,3.93467,3.98892,4.04152,4.09244,4.14164,4.18908,4.23474,4.27859,4.32061,4.36077,4.39905,4.43544,4.46992,4.50249,4.53314,4.56185,4.58864,4.61349,4.63642,4.65745,4.67657,4.69381,4.7092,4.72274,4.73447,4.74441,4.75259,4.75903,4.76376,4.76682,4.76822,4.768,4.76618,4.76279,4.75786,4.75142,4.74348,4.73409,4.72326,4.71102,4.69739,4.68241,4.6661,4.64849,4.6296,4.60948,4.58816,4.56567,4.54204,4.51732,4.49154,4.46473,4.43694,4.4082,4.37854,4.348,4.31662,4.28443,4.25145,4.21773,4.1833,4.14819,4.11243,4.07606,4.03912,4.00162,3.96361,3.92512,3.88618,3.84683,3.80708,3.76697,3.72653,3.68579,3.64478,3.60351,3.56202,3.52033,3.47845,3.43642,3.39425,3.35196,3.30957,3.2671,3.22455,3.18196,3.13933,3.09668,3.05402,3.01136,2.96873,2.92613,2.88357,2.84108,2.79865,2.75631,2.71407,2.67195,2.62994,2.58807,2.54634,2.50477,2.46338,2.42216,2.38114,2.34032,2.29971,2.25933,2.21916,2.17923,2.13954,2.10008,2.06087,2.02189,1.98316,1.94468,1.90644,1.86845,1.83069,1.79316,1.75586,1.71877,1.68189,1.6452,1.60868,1.57232,1.53611,1.50004,1.46407,1.4282,1.39241,1.35668,1.321,1.28535,1.24972,1.2141,1.17849,1.14286,1.10723,1.07158,1.03593,1.00028,.96464,.92902,.89344,.85793,.8225,.78719,.75203,.71705,.68231,.64784,.61369,.57991,.54656,.51368,.48134,.44959,.41849,.3881,.35848,.32967,.30174,.27474,.24872,.22373,.19982,.17702,.15539,.13497,.11579,.09791,.08137,.06621,.05248,.04022,.02948,.02029,.01271,.00677,.00252,0,-76e-5,27e-5,.00314,.00788,.01451,.02307,.03357,.04604,.0605,.07697,.09546,.11599,.13858,.16322,.18992,.21869,.24952,.28241,.31735,.35434],pressure:[.95248,.95236,.95228,.95223,.95222,.95224,.95231,.95241,.95256,.95274,.95296,.95322,.95352,.95385,.95423,.95465,.9551,.9556,.95613,.9567,.95731,.95796,.95864,.95936,.96012,.96091,.96173,.96259,.96348,.9644,.96535,.96633,.96734,.96838,.96944,.97053,.97164,.97277,.97393,.9751,.97629,.9775,.97873,.97997,.98122,.98249,.98376,.98505,.98634,.98763,.98893,.99023,.99154,.99284,.99414,.99544,.99673,.99802,.9993,.99942,.99816,.99691,.99568,.99445,.99324,.99205,.99087,.98972,.98858,.98746,.98636,.98528,.98423,.9832,.98219,.98121,.98025,.97931,.9784,.97752,.97666,.97582,.97501,.97423,.97347,.97274,.97203,.97135,.9707,.97007,.96948,.9689,.96836,.96784,.96735,.96689,.96646,.96605,.96567,.96533,.965,.96471,.96445,.96421,.964,.96382,.96367,.96355,.96346,.96339,.96335,.96334,.96336,.9634,.96348,.96358,.9637,.96385,.96403,.96423,.96446,.96471,.96499,.96529,.96561,.96595,.96631,.96669,.96709,.96751,.96795,.9684,.96887,.96935,.96984,.97035,.97087,.9714,.97194,.97249,.97304,.97361,.97418,.97476,.97534,.97592,.97651,.97711,.9777,.9783,.9789,.9795,.9801,.9807,.9813,.9819,.9825,.98309,.98369,.98428,.98486,.98545,.98603,.98661,.98718,.98775,.98832,.98888,.98944,.99,.99056,.99112,.99167,.99223,.99279,.99335,.99392,.99449,.99507,.99565,.99624,.99684,.99745,.99807,.9987,.99934,1,.99933,.99866,.99797,.99727,.99656,.99583,.9951,.99435,.99359,.99283,.99205,.99126,.99046,.98966,.98885,.98803,.9872,.98637,.98554,.9847,.98387,.98303,.98219,.98134,.9805,.97967,.97883,.978,.97717,.97634,.97552,.97471,.97389,.97309,.97229,.9715,.97071,.96993,.96915,.96838,.96762,.96687,.96612,.96539,.96466,.96395,.96324,.96255,.96187,.9612,.96055,.95991,.95929,.95869,.95811,.95754,.957,.95648,.95599,.95552,.95508,.95467,.95428,.95393,.9536,.95331,.95305,.95283,.95264]},{distance:[2.85606,2.86149,2.86432,2.8645,2.862,2.85686,2.84912,2.83886,2.82618,2.81117,2.79393,2.77456,2.75314,2.72975,2.70447,2.67734,2.64844,2.61784,2.58564,2.55196,2.5169,2.48057,2.44305,2.40438,2.36462,2.32383,2.28208,2.23943,2.19591,2.15153,2.10628,2.06016,2.01321,1.96548,1.91702,1.86793,1.8183,1.76829,1.71803,1.66767,1.61737,1.56726,1.51746,1.46803,1.41902,1.37044,1.32228,1.27452,1.22716,1.18023,1.13376,1.08781,1.04244,.99769,.95357,.91003,.86701,.82447,.78238,.74069,.69938,.65836,.61758,.57699,.53656,.49627,.45611,.41611,.37632,.33683,.29776,.25924,.22141,.18441,.14839,.11346,.07972,.04727,.01619,-.01348,-.0417,-.0684,-.09351,-.11698,-.13875,-.1588,-.17713,-.19381,-.20889,-.22242,-.23444,-.24501,-.25421,-.26216,-.26897,-.27473,-.27951,-.28336,-.28631,-.28836,-.28948,-.28963,-.28873,-.28673,-.28355,-.27916,-.27354,-.26673,-.25878,-.2498,-.23992,-.22929,-.21802,-.20623,-.19398,-.18134,-.16836,-.1551,-.14163,-.12809,-.11461,-.1013,-.08826,-.07557,-.06335,-.0517,-.04077,-.03065,-.02143,-.01321,-.00606,0,.00496,.00888,.01181,.01385,.01511,.0157,.01574,.01533,.01458,.01358,.0124,.01112,.00979,.00851,.00738,.0065,.006,.00596,.00646,.00754,.00924,.01161,.01471,.01858,.02323,.02865,.03481,.04169,.0493,.05765,.06677,.07671,.08754,.09934,.11222,.12628,.14159,.15823,.17624,.19561,.21632,.23828,.26142,.28563,.31083,.33696,.36397,.39185,.42057,.4501,.48036,.51125,.54264,.5744,.60646,.63871,.67105,.70337,.73556,.76751,.79918,.83048,.86139,.8919,.92202,.95184,.98144,1.01094,1.04045,1.0701,1.10002,1.13029,1.16103,1.1923,1.22416,1.25664,1.28979,1.32364,1.35824,1.39363,1.42985,1.4669,1.50475,1.54332,1.58252,1.62227,1.6625,1.70312,1.744,1.78501,1.82598,1.8668,1.90734,1.94754,1.98732,2.02666,2.06555,2.10402,2.1421,2.17985,2.2173,2.25448,2.29139,2.328,2.36424,2.4,2.43515,2.46955,2.50309,2.53565,2.56717,2.59761,2.62692,2.65505,2.68191,2.7074,2.73138,2.75375,2.7744,2.79324,2.81017,2.82504,2.83772,2.8481],pressure:[.22758,.23641,.24578,.25568,.26609,.27699,.28835,.30016,.31237,.32495,.33789,.35113,.36466,.37843,.39241,.40658,.4209,.43535,.44989,.4645,.47916,.49385,.50853,.5232,.53784,.55243,.56696,.58141,.59578,.61004,.62419,.63821,.65209,.6658,.67934,.69268,.70582,.71873,.73139,.7438,.75594,.76779,.77935,.79061,.80156,.81221,.82254,.83258,.84231,.85176,.86091,.86978,.87837,.88669,.89473,.9025,.91,.91725,.92425,.931,.93752,.9438,.94985,.95566,.96124,.96658,.97168,.97652,.98109,.98539,.98939,.99309,.99646,.99949,.99783,.99552,.99361,.99209,.99098,.99029,.99003,.99019,.99079,.99181,.99324,.9951,.99735,1,.99698,.99361,.98992,.98592,.98163,.97709,.97231,.96731,.96212,.95676,.95122,.94554,.93973,.93378,.92773,.92157,.91532,.90899,.90258,.89612,.88961,.88308,.87653,.87,.8635,.85705,.85068,.8444,.83823,.83219,.82628,.82052,.81493,.80952,.8043,.79929,.7945,.78994,.78561,.78151,.77765,.77402,.77062,.76742,.76443,.76161,.75896,.75645,.75406,.75175,.74951,.7473,.74511,.74289,.74064,.73833,.73592,.73341,.73078,.728,.72507,.72197,.71869,.71522,.71156,.70769,.70363,.69936,.69489,.69021,.68533,.68023,.67492,.66939,.66363,.65765,.65145,.64501,.63833,.63143,.62428,.61691,.60931,.60148,.59344,.58521,.57679,.5682,.55948,.55063,.54167,.53264,.52354,.51439,.50522,.49603,.48686,.47773,.46865,.45964,.45072,.44192,.43324,.42469,.41629,.40804,.39994,.392,.3842,.37655,.36903,.36164,.35437,.3472,.34012,.33312,.3262,.31933,.31251,.30574,.299,.2923,.28563,.27899,.27239,.26583,.25933,.25288,.24652,.24025,.2341,.22808,.22221,.21653,.21104,.20576,.20072,.19592,.19138,.18712,.18313,.17943,.17602,.17292,.17013,.16766,.16551,.16369,.16222,.1611,.16036,.16001,.16007,.16055,.16148,.16286,.16471,.16705,.16988,.17321,.17706,.18144,.18636,.19182,.19785,.20443,.21158,.2193]},{distance:[-2.31317,-2.3191,-2.32189,-2.32154,-2.31811,-2.31174,-2.30254,-2.29062,-2.27609,-2.25904,-2.23954,-2.21767,-2.19355,-2.16732,-2.13907,-2.10885,-2.07672,-2.04268,-2.00677,-1.96911,-1.92985,-1.88914,-1.84713,-1.80397,-1.75979,-1.71467,-1.66864,-1.62171,-1.57395,-1.52546,-1.47625,-1.42628,-1.3755,-1.32384,-1.27131,-1.218,-1.16408,-1.10972,-1.05508,-1.00031,-.94551,-.89077,-.83615,-.7817,-.72757,-.6739,-.62076,-.56821,-.51625,-.46484,-.41397,-.36366,-.314,-.26506,-.21689,-.16957,-.12316,-.07766,-.03301,.01085,.05399,.09643,.13827,.17967,.22079,.26176,.30265,.34342,.38397,.42414,.46381,.50285,.54115,.57863,.61524,.65093,.6856,.71914,.75153,.78275,.81283,.84182,.86972,.89651,.92208,.94634,.96919,.99052,1.01025,1.02835,1.04484,1.05976,1.07309,1.08479,1.09492,1.1036,1.11096,1.11714,1.12224,1.12627,1.12916,1.13083,1.13125,1.13036,1.12816,1.12466,1.11992,1.11397,1.10677,1.09827,1.08849,1.07746,1.06527,1.05203,1.03786,1.02283,1.00695,.99025,.97279,.9546,.93573,.9163,.8965,.8765,.85647,.83652,.81687,.79775,.77939,.76199,.74568,.73049,.71635,.70316,.69082,.67925,.66834,.65804,.64831,.63911,.63032,.62184,.61363,.60564,.59788,.59036,.58308,.57597,.5689,.56177,.55447,.5469,.53896,.53062,.5219,.51283,.5034,.49355,.48335,.47287,.46223,.45154,.44085,.43012,.41923,.40805,.39648,.38441,.37176,.35849,.34458,.32999,.31461,.29833,.28109,.26288,.2437,.22361,.20265,.18082,.15807,.13434,.1096,.0838,.0569,.02894,0,-.0298,-.0604,-.09173,-.12364,-.15594,-.18843,-.22092,-.25331,-.28559,-.31781,-.35006,-.38244,-.41502,-.44785,-.48098,-.5144,-.54811,-.58218,-.61666,-.65153,-.68677,-.72232,-.75807,-.79397,-.83002,-.86628,-.90281,-.93968,-.97693,-1.01465,-1.05282,-1.09139,-1.13031,-1.16956,-1.20917,-1.24905,-1.28907,-1.32908,-1.36891,-1.40844,-1.44765,-1.48658,-1.52527,-1.56376,-1.60206,-1.64016,-1.67801,-1.71552,-1.75264,-1.78936,-1.8257,-1.86161,-1.89702,-1.93182,-1.96584,-1.99894,-2.03102,-2.06203,-2.0919,-2.12056,-2.14794,-2.17397,-2.19852,-2.22138,-2.24235,-2.26129,-2.27805,-2.29243,-2.30422],pressure:[.9681,.97424,.98046,.98674,.99309,.9995,.99404,.98754,.981,.97444,.96785,.96124,.95462,.94801,.94139,.93479,.92822,.92167,.91515,.90868,.90225,.89589,.88959,.88336,.87722,.87115,.86519,.85932,.85356,.84792,.84239,.83699,.83173,.8266,.82162,.81679,.81211,.80759,.80324,.79906,.79505,.79121,.78756,.78409,.78081,.77771,.77481,.77211,.76959,.76728,.76516,.76324,.76153,.76001,.75869,.75757,.75665,.75593,.7554,.75507,.75493,.75498,.75523,.75565,.75627,.75706,.75803,.75917,.76049,.76197,.76361,.76541,.76737,.76947,.77172,.77409,.7766,.77923,.78198,.78484,.7878,.79086,.79401,.79724,.80055,.80394,.8074,.81092,.8145,.81813,.82182,.82556,.82934,.83317,.83703,.84093,.84487,.84884,.85284,.85687,.86094,.86503,.86915,.87329,.87746,.88166,.88587,.89011,.89436,.89863,.90291,.9072,.91149,.91579,.92009,.92438,.92867,.93295,.9372,.94144,.94566,.94985,.954,.95812,.96219,.96623,.97021,.97415,.97802,.98184,.9856,.9893,.99293,.9965,1,.99657,.9932,.98991,.98668,.98352,.98042,.97738,.9744,.97148,.9686,.96577,.96298,.96023,.95751,.95482,.95214,.94949,.94684,.9442,.94156,.93892,.93627,.93361,.93094,.92825,.92555,.92284,.9201,.91735,.91458,.91179,.90899,.90616,.90332,.90047,.8976,.89472,.89183,.88893,.88603,.88314,.88024,.87735,.87448,.87162,.86878,.86597,.86319,.86044,.85774,.85508,.85247,.84993,.84744,.84503,.84269,.84042,.83825,.83616,.83417,.83227,.83048,.8288,.82724,.82578,.82445,.82324,.82215,.82119,.82037,.81967,.81911,.81868,.81839,.81824,.81823,.81835,.81862,.81903,.81957,.82026,.82109,.82206,.82317,.82443,.82583,.82737,.82906,.83089,.83287,.83499,.83726,.83968,.84223,.84494,.84778,.85077,.8539,.85717,.86058,.86412,.86781,.87163,.87559,.87968,.88391,.88826,.89275,.89737,.90211,.90698,.91198,.91709,.92233,.92768,.93315,.93873,.94441,.95019,.95607,.96205]},{distance:[4.72925,4.81721,4.9037,4.98859,5.07177,5.15311,5.23249,5.3098,5.38491,5.45772,5.52811,5.59598,5.66122,5.72375,5.78346,5.84028,5.8941,5.94486,5.99248,6.03689,6.07803,6.11584,6.15028,6.18128,6.20882,6.23285,6.25336,6.27031,6.28369,6.29348,6.29969,6.3023,6.30133,6.29678,6.28867,6.27703,6.26187,6.24324,6.22116,6.19567,6.16683,6.13468,6.09928,6.06068,6.01896,5.97417,5.92639,5.87569,5.82217,5.76589,5.70696,5.64545,5.58147,5.5151,5.44644,5.37559,5.30265,5.2277,5.15085,5.0722,4.99184,4.90987,4.82639,4.74151,4.65533,4.56794,4.47945,4.38996,4.29959,4.20843,4.11658,4.02416,3.93125,3.83796,3.74437,3.65057,3.55666,3.46272,3.36884,3.27509,3.18155,3.08831,2.99545,2.90303,2.81114,2.71984,2.62922,2.53933,2.45026,2.36207,2.27484,2.18862,2.10349,2.01951,1.93675,1.85528,1.77515,1.69644,1.61919,1.54348,1.46935,1.39685,1.32605,1.25698,1.18967,1.12417,1.06049,.99863,.93862,.88044,.82408,.76953,.71676,.66574,.61644,.56882,.52282,.47841,.43553,.39413,.35414,.31551,.27817,.24206,.20712,.17328,.14048,.10866,.07776,.04772,.01848,-.00999,-.03776,-.06487,-.09134,-.11721,-.14251,-.16725,-.19144,-.21509,-.2382,-.26076,-.28275,-.30416,-.32496,-.34511,-.36459,-.38334,-.40134,-.41852,-.43485,-.45026,-.46471,-.47815,-.49052,-.50179,-.51189,-.52081,-.52849,-.5349,-.54003,-.54383,-.54627,-.54734,-.54702,-.54528,-.54211,-.53752,-.53149,-.52403,-.51515,-.50487,-.4932,-.48015,-.46575,-.45001,-.43297,-.41463,-.39503,-.37419,-.35213,-.32887,-.30443,-.27885,-.25214,-.22432,-.19541,-.16544,-.13442,-.10235,-.06926,-.03514,0,.03616,.07336,.11159,.15088,.19125,.23272,.27531,.31906,.36401,.41019,.45764,.5064,.55651,.60802,.66096,.71538,.77129,.82874,.88776,.94836,1.01056,1.07438,1.13982,1.20687,1.27554,1.34581,1.41766,1.49107,1.56599,1.64239,1.72025,1.79951,1.88013,1.96209,2.04532,2.12979,2.21546,2.30226,2.39017,2.47911,2.56905,2.65991,2.75164,2.84416,2.93742,3.03133,3.12582,3.2208,3.31619,3.41191,3.50785,3.60393,3.70006,3.79612,3.89202,3.98765,4.08291,4.17767,4.27182,4.36525,4.45783,4.54944,4.63995],pressure:[.30942,.30838,.30765,.30724,.30715,.30738,.30795,.30884,.31007,.31164,.31354,.31578,.31837,.32129,.32455,.32815,.33209,.33636,.34097,.34591,.35117,.35675,.36265,.36887,.37539,.38221,.38933,.39674,.40442,.41238,.4206,.42907,.43779,.44675,.45593,.46533,.47493,.48473,.49471,.50486,.51517,.52563,.53623,.54694,.55777,.5687,.57971,.59079,.60194,.61313,.62435,.6356,.64686,.65811,.66935,.68056,.69174,.70286,.71391,.72489,.73579,.74659,.75728,.76785,.7783,.7886,.79876,.80877,.81861,.82827,.83776,.84706,.85617,.86507,.87378,.88227,.89056,.89863,.90649,.91412,.92153,.92872,.93568,.94241,.94892,.95519,.96122,.96702,.97258,.97791,.98299,.98783,.99242,.99677,.99911,.99525,.99164,.98827,.98515,.98228,.97966,.97728,.97514,.97324,.97159,.97017,.96898,.96801,.96727,.96674,.96641,.96629,.96635,.96661,.96703,.96762,.96838,.96928,.97032,.97149,.97279,.9742,.97572,.97734,.97905,.98085,.98273,.98468,.98669,.98877,.99091,.99311,.99535,.99765,1,.9976,.99516,.99267,.99014,.98755,.98491,.98222,.97947,.97666,.97378,.97083,.96781,.96471,.96153,.95826,.9549,.95144,.94787,.9442,.94042,.93651,.93249,.92834,.92407,.91966,.91512,.91045,.90564,.90069,.8956,.89037,.885,.87949,.87384,.86806,.86214,.85608,.84988,.84356,.83711,.83053,.82383,.81702,.81009,.80306,.79594,.78872,.78141,.77403,.76657,.75905,.75148,.74385,.73619,.72849,.72076,.71302,.70526,.69749,.68972,.68195,.67419,.66644,.65871,.65099,.64329,.63561,.62795,.62032,.61271,.60512,.59755,.59001,.58248,.57497,.56749,.56002,.55256,.54512,.5377,.5303,.52291,.51554,.50819,.50087,.49358,.48632,.4791,.47192,.4648,.45773,.45072,.44378,.43692,.43015,.42346,.41687,.41039,.40403,.39779,.39168,.38571,.37989,.37423,.36873,.36342,.35828,.35335,.34862,.34409,.3398,.33573,.3319,.32831,.32498,.32192,.31912,.3166,.31436,.31242,.31077]}]};function Eye(e){let t=null;for(const r of e){const i=r.type;if(ORt(r)){if(R(t))t=i;else if(t!==i)return"uber"}}return b(t)?t:"uber"}function hH(e){let t=Nt.INVISIBLE;for(const{material:r}of e)if(NLe(r)){if(r.color[3]*r.opacity<1)return Nt.TRANSPARENT;t=Nt.OPAQUE}return t}function dH(e){let t=Nt.INVISIBLE;for(const{material:r}of e)if(NLe(r)){switch(r.objectTransparency){case Nt.TRANSPARENT:case Nt.INVISIBLE:return Nt.TRANSPARENT;case Nt.OPAQUE:if(r.opacity<1)return Nt.TRANSPARENT}t=Nt.OPAQUE}return t}function NLe(e){return e.size*e.color[3]*e.opacity>0}function ORt(e){return e.size*e.color[3]>0}function MRt(e,t){const r=j_e(e,t,!0);return r===-1?t<e[0]?0:e.length:r}function Cye(e,t,r){return e.length-MRt(e,t*r.minimumEdgeLength)}function Aye(e,t,r,i){for(let s=0;s<e.length;s++){const n=e[s].index,o=t[s],a=t[s+1];if(i)for(let l=o;l<a;l++){const c=i[l];r.set(c,n)}else for(let l=o;l<a;l++)r.set(l,n)}}const PRt=fe.getLogger("esri.views.3d.webgl-engine.lib.edgeRendering.EdgeView");let Mp=class extends xe{constructor(e){super(e),this.updatingHandles=new Gm,this.perObjectData=new Map,this.perObjectDataEvictionCache=new Set,this.renderers=new Map,this.numberOfRenderedEdges={[Nt.TRANSPARENT]:0,[Nt.OPAQUE]:0},this.gpuMemoryUsage=0,this.workerAbort=new AbortController,this.tmpModelPosition=M(),this.localOrigins=new sRt(new Ese(e.renderSR))}initialize(){this.worker=new ERt(this.schedule),this.componentColorManager=new ALe(this.rctx,3);const e=_Le.createBuffer(4);for(let t=0;t<4;t++)e.sideness.set(t,0,t===0||t===3?0:1),e.sideness.set(t,1,t===0||t===1?0:1);this.verticesBufferObject=cr.createVertex(this.rctx,Cr.STATIC_DRAW,e.buffer)}destroy(){this.destroyed||(this.perObjectData.forEach(e=>this._discardObjectEntry(e)),this.perObjectData.clear(),this.strokesTexture=Ye(this.strokesTexture),this.componentColorManager=ct(this.componentColorManager),this.workerAbort.abort(),this.worker.destroy(),this.verticesBufferObject=Ye(this.verticesBufferObject),this.renderers.clear(),this.updatingHandles.destroy())}get updating(){return this.updatingHandles.updating}get usedMemory(){return this.gpuMemoryUsage}get numberOfRenderedPrimitives(){return this.numberOfRenderedEdges[Nt.TRANSPARENT]+this.numberOfRenderedEdges[Nt.OPAQUE]}shouldRender(){return this.renderers.size>0}async addComponentObject(e,t,r,i,s,n,o,a){if(this.hasObject(e))return this.getObjectMemoryUsage(e);let l;const c=new Rye(new Promise(p=>l=p),r.center,r.radius);this.perObjectData.set(e,c);const h=await this.updatingHandles.addPromise(this._addComponentGeometry(t,c,i,s,n,o,a));return this.setNeedsRender(),l(),h}async addOrUpdateObject3D(e,t,r,i){if(this.destroyed)return void PRt.warn("Attempt to add an object to a destroyed instance");const s=this.perObjectData.get(e);let n;(s==null?void 0:s.renderables.length)>0&&this.perObjectDataEvictionCache.add(s);const o=e.boundingVolumeWorldSpace.bounds,a=new Rye(new Promise(c=>n=c),o,Hy(o));this.perObjectData.set(e,a);const l=new Array;if(r.mergeGeometries&&e.geometries.length>1&&$Rt(e))l.push(this._addObjectMergedGeometries(e,a,t,r,i));else for(let c=0;c<e.geometries.length;c++){const h=e.geometryRecords[c];if(!h.material.supportsEdges)continue;const p=e.geometries[c];l.push(this._addGeometry(e,a,p,h,t[0],r,i))}await this.updatingHandles.addPromise(Promise.all(l)),this.perObjectDataEvictionCache.delete(a),this._discardObjectEntry(s),this.setNeedsRender(),n()}_discardObjectEntry(e){e&&(e.renderables.length&&(e.renderables.forEach(t=>this._removeRenderable(t)),this.setNeedsRender()),e.loaded=null)}hasObject(e){return this.perObjectData.has(e)}async updateAllComponentOpacities(e,t){const r=t instanceof Array?i=>t[i]:()=>t;(await this.updatingHandles.addPromise(this._getObjectEntry(e))).renderables.forEach(i=>{const s=i.components.meta.length;for(let n=0;n<s;n++){const o=r(n),a=i.components.meta[n],l=a.index;a.material.opacity=o,i.components.buffer.textureBuffer.setDataElement(l,1,3,255*o)}this._updateTransparency(i)}),this.setNeedsRender()}async getObjectMemoryUsage(e){return(await this._getObjectEntry(e)).renderables.reduce((t,r)=>t+r.statistics.gpuMemoryUsage,0)}async updateAllComponentMaterials(e,t,r,i){const s=e instanceof k0,n=!!r.hasSlicePlane,o=Eye(t),a=PP.getKey(o,n,s);(await this.updatingHandles.addPromise(this._getObjectEntry(e))).renderables.forEach(l=>{if(a!==l.rendererKey){const c=this.renderers.get(l.rendererKey),h=this._acquireRenderer(o,n,s);c.removeRenderable(l),c.refCount.decrement(),l.rendererKey=a,h.addRenderable(l)}for(let c=0;c<t.length;c++)l.components.meta[c].material=t[c];i&&this._updateComponentBuffer(l.components),this._updateTransparency(l)}),this.setNeedsRender()}async updateAllVerticalOffsets(e,t){(await this.updatingHandles.addPromise(this._getObjectEntry(e))).renderables.forEach(r=>{var s;const i=r.components.meta;for(let n=0;n<i.length;n++)r.components.meta[n].verticalOffset=(s=t==null?void 0:t[n])!=null?s:0;this._updateComponentBuffer(r.components)}),this.setNeedsRender()}async updateObjectVisibility(e,t){(await this.updatingHandles.addPromise(this._getObjectEntry(e))).renderables.forEach(r=>r.visible=t),this.setNeedsRender()}removeObject(e){const t=this.perObjectData.get(e);t&&(this.perObjectData.delete(e),this._discardObjectEntry(t))}async _getObjectEntry(e){const t=this.perObjectData.get(e);if(!t)throw"no object";if(await t.loaded,t.loaded==null)throw gr();return t}removeAll(){this.perObjectData.forEach((e,t)=>this.removeObject(t))}render(e,t){if(this.numberOfRenderedEdges[t]=0,R(this.componentColorManager))return;this.localOrigins.updateViewMatrices(e.camera.viewMatrix);const r=e.camera.viewInverseTransposeMatrix,i=M(),s=new O8;let n=0,o=0;if(this.renderers.forEach(h=>{h.refCount.value===0?(this.renderers.delete(h.key),h.dispose()):h.forEachRenderable(p=>{p.visible&&(n+=p.statistics.averageEdgeLength,o++,p.regular&&h.updateTechnique(e,!1),p.silhouette&&h.updateTechnique(e,!0))},t)}),this.componentColorManager.garbageCollect(),this.componentColorManager.updateTextures(),o===0)return;const a=40*n/o,l=e.camera.perScreenPixelRatio,c=new nRt(a,l,t);se(i,r[3],r[7],r[11]),s.set(i),ae(c.transformWorldFromViewTH,s.high),ae(c.transformWorldFromViewTL,s.low),Gd(c.transformViewFromCameraRelativeRS,e.camera.viewMatrix),jd(Oye,c.transformViewFromCameraRelativeRS),sS(c.transformNormalViewFromGlobal,Oye),c.transformProjFromView=e.camera.projectionMatrix,this._updateObjectCameraDistances(e),this.renderers.forEach(h=>{this._renderRegularEdges(h,e,c),this._renderSilhouetteEdges(h,e,c)})}_updateTransparency(e){const t=hH(e.components.meta),r=dH(e.components.meta);t===e.edgeTransparency&&r===e.objectTransparency||(e.edgeTransparency=t,e.objectTransparency=r,this.renderers.get(e.rendererKey).setRenderablesDirty())}_computeModelTransformWithLocalOrigin(e,t,r){if(e.getCombinedStaticTransformation(t,r),b(t.origin))this.localOrigins.register(t.origin);else{const i=se(this.tmpModelPosition,r[12],r[13],r[14]);t.origin=this.localOrigins.acquire(i)}return rRt(t.origin.vec3,r),t.origin}_updateComponentBuffer(e){const{meta:t,buffer:r}=e,i=new Uint8Array(4);for(let s=0;s<t.length;s++){const n=t[s].material,o=t[s].index,a=Le(Math.round(n.size*_Rt),0,255),l=Le(n.extensionLength,-uH,255-uH)+uH,c=n.type==="solid"?Tz.SOLID:Tz.SKETCH,h=255*n.opacity,p=n.color,f=255*p[0],m=255*p[1],g=255*p[2],v=255*p[3];r.textureBuffer.setData(o,0,f,m,g,v),r.textureBuffer.setData(o,1,a,l,c,h),yLe(t[s].verticalOffset,i),r.textureBuffer.setData(o,2,i[0],i[1],i[2],i[3])}}_createComponentBuffers(e){if(R(this.componentColorManager))return null;const t=new Array,r=this.componentColorManager.getBuffer(e.length);for(let s=0;s<e.length;s++){const n=e[s],o=r.acquireIndex();t.push({index:o,verticalOffset:0,material:n})}const i={meta:t,buffer:r};return this._updateComponentBuffer(i),i}_extractEdges(e,t,r,i,s,n=s.length){return this.worker.process({data:t,indices:s,indicesLength:n,writerSettings:e,skipDeduplicate:r},this.workerAbort.signal,i)}_createEdgeResources(e){const t={};if(R(this.verticesBufferObject))return t;if(e.regular.lodInfo.lengths.length>0){const r=new rn(this.rctx,pJ,{vertices:nye,instances:wz.glLayout},{vertices:this.verticesBufferObject,instances:cr.createVertex(this.rctx,Cr.STATIC_DRAW,e.regular.instancesData.buffer)});t.regular={vao:r,lod:e.regular.lodInfo}}if(e.silhouette.lodInfo.lengths.length>0){const r=new rn(this.rctx,pJ,{vertices:nye,instances:xz.glLayout},{vertices:this.verticesBufferObject,instances:cr.createVertex(this.rctx,Cr.STATIC_DRAW,e.silhouette.instancesData.buffer)});t.silhouette={vao:r,lod:e.silhouette.lodInfo}}return t}async _addGeometry(e,t,r,i,s,n,o){const a=r.vertexAttributes.get(O.POSITION),l=r.indices.get(O.POSITION),c=Ce(),h={position:a,indices:l,modelTransform:c,origin:this._computeModelTransformWithLocalOrigin(e,i,c)};return this._addPositionData(t,h,r.edgeIndicesLength,s,n,o)}async _addPositionData(e,t,r,i,s,n=!1){if(e.loaded==null)return;const o=this._createComponentBuffers([i]);if(R(o)||r<=0)return;const a=this._acquireRenderer(i.type,!!s.hasSlicePlane,!0),{modelTransform:l,origin:c}=t,h=t.indices,p=t.position,f=p.data.length/p.size,m=S$.createBuffer(f);for(let x=0;x<f;x++)m.position.set(x,0,p.data[x*p.size+0]),m.position.set(x,1,p.data[x*p.size+1]),m.position.set(x,2,p.data[x*p.size+2]);Aye(o.meta,[0,m.componentIndex.count],m.componentIndex);const g=await this.updatingHandles.addPromise(this._extractEdges(a.writerSettings,m,!1,n,h,r));if(e.loaded==null)return;const{regular:v,silhouette:w}=this._createEdgeResources(g),_=(v?v.vao.size:0)+(w?w.vao.size:0),T={regular:v,silhouette:w,transform:{modelMatrix:l,origin:c},statistics:{gpuMemoryUsage:_,externalMemoryUsage:!1,averageEdgeLength:g.averageEdgeLength},components:o,visible:!0,edgeTransparency:hH(o.meta),objectTransparency:dH(o.meta),distanceToCamera:0,rendererKey:a.key};e.renderables.push(T),a.addRenderable(T),this.gpuMemoryUsage+=_}async _addComponentGeometry(e,t,r,i,s,n,o){if(t.loaded==null)return 0;const a=this._createComponentBuffers(n);if(R(a))return 0;const l=Eye(n),c=this._acquireRenderer(l,o.hasSlicePlane||!1,!1),h=S$.createBuffer(r.count);u8(h.position,r),Aye(a.meta,s,h.componentIndex,i);const p=!0,f=c.writerSettings,m=await this.updatingHandles.addPromise(this._extractEdges(f,h,p,!1,i));if(t.loaded==null)return 0;const{regular:g,silhouette:v}=this._createEdgeResources(m),w=(g?g.vao.size:0)+(v?v.vao.size:0),_={regular:g,silhouette:v,transform:e,statistics:{gpuMemoryUsage:w,externalMemoryUsage:!0,averageEdgeLength:m.averageEdgeLength},components:a,visible:!0,edgeTransparency:hH(a.meta),objectTransparency:dH(a.meta),distanceToCamera:0,rendererKey:c.key};return t.renderables.push(_),c.addRenderable(_),w}async _addObjectMergedGeometries(e,t,r,i,s){const n=new Map;let o=0,a=null,l=0;for(let _=0;_<e.geometries.length;_++){const T=e.geometries[_],x=e.geometryRecords[_];if(!x.material.supportsEdges)continue;!a&&x.origin&&(a=x);const E=T.vertexAttributes.get(O.POSITION);l+=E.data.length/E.size,o+=T.edgeIndicesLength}const c=l>=65536?Uint32Array:Uint16Array,h=o?new c(o):null,p=[];let f=0;for(let _=0;_<e.geometries.length;_++){const T=e.geometries[_];if(!e.geometryRecords[_].material.supportsEdges)continue;const x=T.vertexAttributes.get(O.POSITION),E=T.indices.get(O.POSITION);let C=n.get(x.data);if(C==null){C=p.length/3;for(let A=0;A<x.data.length;A+=x.size)p.push(x.data[A+0]),p.push(x.data[A+1]),p.push(x.data[A+2]);n.set(x.data,C)}if(E)for(let A=0;A<T.edgeIndicesLength;A++)h[f++]=C+E[A]}const m=a||e.geometryRecords[0],g=Ce(),v=this._computeModelTransformWithLocalOrigin(e,m,g);for(let _=0;_<e.geometryRecords.length;_++)e.geometryRecords[_].origin=v;const w={position:{data:p,size:3},indices:h,modelTransform:g,origin:v};await this.updatingHandles.addPromise(this._addPositionData(t,w,h.length,r[0],i,s))}_acquireRenderer(e,t,r){const i=PP.getKey(e,t,r);let s=this.renderers.get(i);return R(this.strokesTexture)&&(this.strokesTexture=CRt(this.rctx)),s||(s=new PP(this.rctx,this.techniqueRepository,{type:e,hasSlicePlane:t,strokesTexture:this.strokesTexture,legacy:r,spherical:this.viewingMode===Be.Global}),this.renderers.set(i,s)),s.refCount.increment(),s}_removeRenderable(e){IRt(e);const t=this.renderers.get(e.rendererKey);if(t){t.removeRenderable(e),t.refCount.decrement(),"origin"in e.transform&&this.localOrigins.release(e.transform.origin),this.gpuMemoryUsage-=e.statistics.externalMemoryUsage?0:e.statistics.gpuMemoryUsage;for(const r of e.components.meta)e.components.buffer.releaseIndex(r.index)}}_updateObjectCameraDistances(e){const t=e.camera.eye,r=e.camera.viewForward,i=M(),s=n=>{const{center:o,radius:a}=n;su(i,o,t);const l=Te(i,r),c=l<-a?1/0:l<a?0:l-a;n.renderables.forEach(h=>h.distanceToCamera=c)};this.perObjectData.forEach(s),this.perObjectDataEvictionCache.forEach(s)}_renderRegularEdges(e,t,r){const i=e.bindRegularEdges(r,t),s=r.transparency;e.forEachRenderable(n=>{if(!n.visible||!n.regular)return;const o=Cye(n.regular.lod.lengths,n.distanceToCamera,r),a="origin"in n.transform?this.localOrigins.getViewMatrix(n.transform.origin):Tn;e.renderRegularEdges(i,n,t,o,a),this.numberOfRenderedEdges[s]+=o},s)}_renderSilhouetteEdges(e,t,r){const i=e.bindSilhouetteEdges(r,t),s=r.transparency;e.forEachRenderable(n=>{if(!n.visible||!n.silhouette)return;const o=Cye(n.silhouette.lod.lengths,n.distanceToCamera,r),a="origin"in n.transform?this.localOrigins.getViewMatrix(n.transform.origin):Tn;e.renderSilhouetteEdges(i,n,t,o,a),this.numberOfRenderedEdges[s]+=o},s)}};function IRt(e){e.regular&&(e.regular.vao.vertexBuffers.instances.dispose(),e.regular.vao.dispose(!1),e.regular.vao=null),e.silhouette&&(e.silhouette.vao.vertexBuffers.instances.dispose(),e.silhouette.vao.dispose(!1),e.silhouette.vao=null)}function $Rt(e){let t=null,r=null;for(let i=0;i<e.geometries.length;i++){const s=e.geometryRecords[i];if(s.material.supportsEdges){if(t){if(!x1(t,s.transformation))return!1}else t=s.transformation;if(!r&&b(s.origin))r=s;else if(b(r==null?void 0:r.origin)&&b(s.origin)&&r.origin.id!==s.origin.id)return!1}}return!0}u([d({constructOnly:!0})],Mp.prototype,"rctx",void 0),u([d({constructOnly:!0})],Mp.prototype,"renderSR",void 0),u([d({constructOnly:!0})],Mp.prototype,"viewingMode",void 0),u([d({constructOnly:!0})],Mp.prototype,"techniqueRepository",void 0),u([d({constructOnly:!0})],Mp.prototype,"setNeedsRender",void 0),u([d({constructOnly:!0})],Mp.prototype,"schedule",void 0),u([d({readOnly:!0})],Mp.prototype,"updatingHandles",void 0),u([d({readOnly:!0})],Mp.prototype,"updating",null),Mp=u([$("esri.views.3d.webgl-engine.lib.edgeRendering.EdgeView")],Mp);class Rye{constructor(t,r,i){this.center=r,this.radius=i,this.renderables=new Array,this.loaded=t,this.loaded.then(()=>{this.loaded!=null&&(this.loaded=!0)})}}const Oye=$i();function LRt(e){const t=e.capabilities.disjointTimerQuery;return R(t)?null:t.timestampBits()>0?new DRt(t):wJ?null:new NRt(t)}class DRt{constructor(t){this.timer=t,this.start=t.createQuery(),t.createTimestamp(this.start)}stop(t,r=50){this.end=this.timer.createQuery(),this.timer.createTimestamp(this.end),this._checkQueryResult(t,r)}_checkQueryResult(t,r){if(!this.timer.resultAvailable(this.end))return void setTimeout(()=>this._checkQueryResult(t,r),r);if(this.timer.disjoint())return void t(null);const i=this.timer.getResult(this.start),s=this.timer.getResult(this.end);t((s-i)/1e6)}}class NRt{constructor(t){this.timer=t,this.query=t.createQuery(),wJ=!0,this.timer.beginTimeElapsed(this.query)}stop(t,r=50){this.timer.endTimeElapsed(),wJ=!1,this._checkQueryResult(t,r)}_checkQueryResult(t,r){const i=this.timer.resultAvailable(this.query),s=this.timer.disjoint();if(!i||s)s?t(null):setTimeout(()=>this._checkQueryResult(t,r),r);else{const n=this.timer.getResult(this.query);t(n/1e6)}}}let wJ=!1;var Bs;(function(e){e[e.Prepare=0]="Prepare",e[e.Shadowmap=1]="Shadowmap",e[e.Lineardepth=2]="Lineardepth",e[e.Normals=3]="Normals",e[e.SSAO=4]="SSAO",e[e.Opaque=5]="Opaque",e[e.OpaqueEdges=6]="OpaqueEdges",e[e.Transparent=7]="Transparent",e[e.TransparentEdges=8]="TransparentEdges",e[e.Hudvisibility=9]="Hudvisibility",e[e.TransparentTerrain=10]="TransparentTerrain",e[e.Atmosphere=11]="Atmosphere",e[e.Laserline=12]="Laserline",e[e.Occluded=13]="Occluded",e[e.Antialiasing=14]="Antialiasing",e[e.Highlights=15]="Highlights",e[e.HudOccluded=16]="HudOccluded",e[e.HudNotoccluded=17]="HudNotoccluded"})(Bs||(Bs={}));const FRt=["prepare","shadowmap","lineardepth","normals","ssao","opaque","opaque edges","transparent","transparent edges","hudvisibility","transparent terrain","atmosphere","laserline","occluded","antialiasing","highlights","hudOccluded","hudNotoccluded"];class kRt extends o1{constructor(){super("total"),this.total=0,this.frameCount=0}}class URt{constructor(){this._startTime=0,this._lastSample=0,this._enableGPUTimer=0,this.totalTime=new kRt,this.gpuTime=new o1("gpu",9),this.renderPassTimings=FRt.map(t=>new o1(t))}get elapsedTime(){return performance.now()-this._startTime}enableGPUTimer(){return++this._enableGPUTimer,{remove:$K(()=>--this._enableGPUTimer)}}prerender(t){this._startTime=this._lastSample=performance.now(),this._enableGPUTimer&&(this._gpuTimer=LRt(t))}advance(t){const r=performance.now();this.renderPassTimings[t].record(r-this._lastSample),this._lastSample=r}postrender(){b(this._gpuTimer)&&(this._gpuTimer.stop(r=>b(r)&&this.gpuTime.record(r),16),this._gpuTimer=null);const t=performance.now()-this._startTime;this.totalTime.record(t),this.totalTime.total+=t,this.totalTime.frameCount++}}const Mye=.9;let dy=class extends xe{constructor(e,t,r,i,s,n,o,a,l){super({}),this._materialRepository=e,this._shaderTechniqueRepository=r,this._rctx=i,this._compositingHelper=s,this._magnifierHelper=n,this._requestRender=o,this._stage=l,this._materialRenderers=new Map,this._needsTransparentPass=!1,this._hasHUDElements=!1,this._hasHighlights=!1,this._hasWater=!1,this._hasOverlayWater=!1,this._content=new Map,this._isRendering=!1,this._fallbackDepthStencilTexture=null,this.performanceInfo=new URt,this._antialiasing=sx.SMAA,this._oitEnabled=!1,this._multipassTerrain=!0,this._transparentTerrain=!1,this._hasAnimations=!1,this._animationTimestep=0,this._handles=new Dt,this._renderHiddenTransparentEdges=()=>{},this._oitUsed=!1,this._smaaPass=new T3(this._rctx,r),this._oitEnabled=this._hasOITSupport,this._requestRender(),this._offscreenRendering=new MAt(this._rctx,this._compositingHelper),this._sliceHelper=new KAt,this._shadowMap=new Cse(this._rctx,l.viewingMode,2),this._ssaoHelper=new HPe(r,this._rctx,()=>this._requestRender()),this._highlight=new CAt(r,this._rctx),this._shadowHighlight=new JAt(this._rctx,l.viewingMode),this._shadowAccumulator=new ya(this._rctx,r,l,c=>{const h=this.shadowsEnabled;this._shadowMap.enabled=!0,this._ensureCameraBindParameters(c.camera,c.contentCamera),this._renderPlugins.prepareRender(),this._shadowMap.enabled=h},(c,h,p)=>{c.shadowMap.start(c.camera,h,p),this._renderShadowCascades(je.MATERIAL_DEPTH_SHADOWMAP_ALL,c.shadowMap),c.camera.setGLViewport(this._rctx),this._ensureCameraBindParameters(c.camera,c.contentCamera)},()=>this._requestRender()),this._renderContext=new ugt(this._rctx,this._offscreenRendering,this._shadowMap,this._ssaoHelper,this._sliceHelper),this._renderPlugins=new $At({renderContext:this._renderContext,shaderTechniqueRepository:r,textureRep:t,materialRep:this._materialRepository,requestRender:this._requestRender,schedule:a}),this.renderPassManager=new mAt(this._rctx,this._shaderTechniqueRepository),this._renderPlugins.add(this.renderPassManager.slots(),this.renderPassManager),this._handles.add([te(()=>this._stage.state.camera,()=>this._requestRender(),Xs),te(()=>Xr.EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES,c=>{this._renderHiddenTransparentEdges=c?()=>this._renderEdges(Nt.TRANSPARENT):()=>{},this._requestRender()},Rt)])}get _bindParameters(){return this._renderContext.bindParameters}get hasWater(){return this._hasWater||this._hasOverlayWater}get hasWaterReflection(){return this.hasWater&&this._waterReflectionEnabled}normalizeCtorArgs(){return{}}dispose(){this._handles.destroy(),this._smaaPass.dispose(),this._materialRenderers.forEach(e=>e.dispose()),this._materialRenderers.clear(),this._edgeView=ct(this._edgeView),this._offscreenRendering.dispose(),this._fallbackDepthStencilTexture=Ye(this._fallbackDepthStencilTexture),this._shadowMap.enabled=!1,this._shadowMap.dispose(),this._ssaoHelper.enabled=!1,this._ssaoHelper.dispose(),this._highlight.dispose(),this._shadowHighlight.dispose(),this._shadowAccumulator.dispose(),_B.prune(),this._content.clear()}disposeOffscreenBuffers(){this._offscreenRendering.dispose(),this._shadowMap.dispose(),this._smaaPass.disable(),this._ssaoHelper.disposeOffscreenBuffers()}get updating(){return this._antialiasing===sx.SMAA&&this._smaaPass.updating||b(this._edgeView)&&this._edgeView.updating||this._shadowAccumulator.running||!this.isCameraFinal}ensureEdgeView(){return R(this._edgeView)&&(this._edgeView=new Mp({rctx:this._rctx,renderSR:this._stage.renderSR,viewingMode:this._stage.viewingMode,techniqueRepository:this._shaderTechniqueRepository,setNeedsRender:()=>this._requestRender(),schedule:e=>this._stage.resourceController.schedule(e)}),this._handles.add(te(()=>mn(this._edgeView,e=>e.updating),()=>this._requestRender(),ei)),this._requestRender()),this._edgeView}get edgeView(){return this._edgeView}get isCameraFinal(){return Kxe(this._bindParameters.ssr.reprojectionMatrix,Tn)}set _reprojectionMatrix(e){OK(this._bindParameters.ssr.reprojectionMatrix,e)&&this.notifyChange("isCameraFinal")}get shadowsEnabled(){var e;return!!((e=this._shadowMap)!=null&&e.enabled)}setRenderParameters(e){const{_shadowMap:t,_ssaoHelper:r,_bindParameters:i}=this;if(e.screenSpaceReflectionsEnabled!==void 0&&i.ssr.enabled!==e.screenSpaceReflectionsEnabled&&(i.ssr.enabled=e.screenSpaceReflectionsEnabled,this._requestRender()),e.shadowMap!==void 0&&t.enabled!==e.shadowMap&&(t.enabled=e.shadowMap,this._requestRender()),e.shadowMapMaxCascades!==void 0&&t.maxCascades!==e.shadowMapMaxCascades&&(t.maxCascades=e.shadowMapMaxCascades,this._requestRender()),b(e.environment)){b(e.environment.weather)&&(this._bindParameters.weather=e.environment.weather,this._bindParameters.weatherVisible=e.weatherVisible,this._renderContext.bindParameters.weather=e.environment.weather,this._renderContext.bindParameters.weatherVisible=e.weatherVisible),e.environment.lighting.ambientOcclusionEnabled!==void 0&&r.enabled!==e.environment.lighting.ambientOcclusionEnabled&&(r.enabled=e.environment.lighting.ambientOcclusionEnabled,this._requestRender()),e.environment.lighting.waterReflectionEnabled!==void 0&&this._waterReflectionEnabled!==e.environment.lighting.waterReflectionEnabled&&(this._waterReflectionEnabled=e.environment.lighting.waterReflectionEnabled,this._requestRender());const n=e.environment.lighting.type==="sun";i.enableFillLights!==n&&(i.enableFillLights=n,this._requestRender())}e.background&&this._offscreenRendering.background!==e.background&&(this._offscreenRendering.background=e.background,this._requestRender());const s=e.antialiasingEnabled?sx.SMAA:sx.NONE;e.antialiasingEnabled!==void 0&&this._antialiasing!==s&&(this._antialiasing=s,this._requestRender()),e.highQualityTransparency!==void 0&&this._multipassTerrain!==e.highQualityTransparency&&(this._multipassTerrain=e.highQualityTransparency,this._oitEnabled=e.highQualityTransparency&&this._hasOITSupport,this._requestRender()),e.defaultHighlightOptions!==void 0&&(this._highlight.setDefaultOptions(e.defaultHighlightOptions),this._shadowHighlight.setDefaultOptions(e.defaultHighlightOptions),this._requestRender()),e.overlays!==void 0&&this._bindParameters.overlays!==e.overlays&&(this._bindParameters.overlays=e.overlays,this._requestRender()),e.slicePlane!==void 0&&this._sliceHelper.plane!==e.slicePlane&&(this._sliceHelper.plane=e.slicePlane,this._requestRender()),e.transparentTerrain!==void 0&&this._transparentTerrain!==e.transparentTerrain&&(this._transparentTerrain=e.transparentTerrain,this._requestRender()),e.hasOverlayWater!==void 0&&this._hasOverlayWater!==e.hasOverlayWater&&(this._hasOverlayWater=e.hasOverlayWater,this._requestRender()),e.shadowCastOptions!==void 0&&this._shadowAccumulator.setOptions(e.shadowCastOptions)}get hasSlicePlane(){return!!this._sliceHelper.plane}get renderPlugins(){return this._renderPlugins}get _hasOITSupport(){return this._rctx.driverTest.floatBufferBlendWorking}modify(e){this._isRendering&&console.warn("Renderer.modify called while rendering");const{adds:t,removes:r,updates:i}=e;if(t.length===0&&r.length===0&&i.length===0)return;r.forAll(({id:o})=>this._content.delete(o)),t.forAll(o=>this._content.set(o.id,o));const s=MPe(e);let n=!1;s.forEach((o,a)=>{let l=this._materialRenderers.get(a);if(!l){if(!(o.adds.length>0))return;l=new BPe(this._rctx,this._materialRepository,a),this._materialRenderers.set(a,l)}l.modify(o),l.isEmpty&&(n=!0)}),n&&this._materialRenderers.forEach((o,a)=>{o.isEmpty&&(this._materialRenderers.delete(a),o.dispose())}),this._hasHighlights=yn(this._materialRenderers,o=>o.hasHighlights),this._bindParameters.hasOccludees=yn(this._materialRenderers,o=>o.hasOccludees),this._hasWater=yn(this._materialRenderers,o=>o.hasWater),this._needsTransparentPass=yn(this._materialRenderers,o=>o.requiresSlot(Se.TRANSPARENT_MATERIAL,je.MATERIAL)),this._hasHUDElements=yn(this._materialRenderers,o=>o.requiresSlot(Se.LINE_CALLOUTS_HUD_DEPTH,je.MATERIAL)||o.requiresSlot(Se.HUD_MATERIAL,je.MATERIAL)||o.requiresSlot(Se.LABEL_MATERIAL,je.MATERIAL)),this._requestRender()}updateAnimation(e){return this._hasAnimations=!1,this._materialRenderers.forEach(t=>this._hasAnimations=t.updateAnimation(e)||this._hasAnimations),this._hasAnimations=this._renderPlugins.updateAnimation(e)||this._hasAnimations,this._hasAnimations}get animationTimestep(){return this._animationTimestep}updateLightSources(e,t,r){this._bindParameters.lighting.groundLightingFactor=t,this._bindParameters.lighting.globalFactor=r,this._bindParameters.lighting.set(e)}render(e,t,r,i){this._isRendering=!0,this.performanceInfo.prerender(this._rctx),this._bindParameters.transparencyPassType=yt.NONE;const s=this._offscreenRendering;s.needLastFrameColorTexture=this.hasWaterReflection,s.advanceCurrentRenderTarget();const n=Q1(this._sliceHelper.plane);i===_T.OFF&&(this._sliceHelper.plane=null),this._rctx.bindFramebuffer(e),t.setGLViewport(this._rctx),this._ensureCameraBindParameters(t,r),this._renderPlugins.prepareRender(),this.performanceInfo.advance(Bs.Prepare);const o=this._computeDepthRange(t);this._renderShadowMap(e,t,this._bindParameters.lighting.lightingMainDirection,o),this.performanceInfo.advance(Bs.Shadowmap),s.initializeFrame(t),this._ensureBindParameters(t,r),this._renderLinearDepth(),this.performanceInfo.advance(Bs.Lineardepth),this._accumulateShadows(o,t,r),this._renderNormal(),this.performanceInfo.advance(Bs.Normals),this._ensureBindParametersSSR(),this._ssaoHelper.computeSSAO(this._bindParameters,s.linearDepthTexture,s.normalTexture),this.performanceInfo.advance(Bs.SSAO),this._renderContext.pass=je.MATERIAL,s.bindFramebuffer(),this._renderOpaqueGeometry(),this.performanceInfo.advance(Bs.Opaque);const a=this._multipassTerrain&&this._transparentTerrain;this._renderTerrainLinearDepth(a),this._setMultipassEnabled(a),this._setTerrainCulling(a),this._renderEdges(Nt.OPAQUE),this.performanceInfo.advance(Bs.OpaqueEdges),this._offscreenRendering.bindTarget(this._offscreenRendering.currentColorTarget,this._offscreenRendering.mainDepth),this._renderSlot(Se.VOXEL),this._renderHiddenTransparentEdges();const l=this._needsTransparentPass||this._renderPlugins.needsTransparentPass;l&&(this._oitEnabled?this._renderOrderIndependentTransparency(()=>this._renderTransparentGeometry(),!1):this._renderTransparentGeometry()),this.performanceInfo.advance(Bs.Transparent),this._renderGeometryLinearDepth(a);const c=this._renderHUDVisibility();a||this._renderInternalSlot(Se.LINE_CALLOUTS),this.performanceInfo.advance(Bs.Hudvisibility),this._renderEdges(Nt.TRANSPARENT,a),this.performanceInfo.advance(Bs.TransparentEdges),this._renderTransparentTerrain(),this._transparentTerrain&&c&&(a?this._renderLineCallouts(ud.Occluded):s.compositeTransparentTerrainOntoHUDVisibility(this._bindParameters),this._renderHUD(ud.Occluded,s.framebuffer),this.performanceInfo.advance(Bs.HudOccluded)),this.performanceInfo.advance(Bs.TransparentTerrain),this._setTerrainCulling(!1),this._transparentTerrain&&(s.compositeTransparentTerrainOntoMain(this._bindParameters),a&&(this._renderEdges(Nt.OPAQUE),this.performanceInfo.advance(Bs.OpaqueEdges),l&&(this._oitEnabled?this._renderOrderIndependentTransparency(()=>this._renderTransparentGeometry(),!1):this._renderTransparentGeometry()),this.performanceInfo.advance(Bs.Transparent),this._renderEdges(Nt.TRANSPARENT),this.performanceInfo.advance(Bs.TransparentEdges))),a&&this._renderLineCallouts(ud.NotOccluded),this._setMultipassEnabled(!1),this._shadowAccumulator.render(this._bindParameters),s.renderToTargets(()=>{this._renderInternalSlot(Se.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL),this._renderSlot(Se.POSTPROCESSING_ENVIRONMENT_TRANSPARENT),this._renderSlot(Se.LASERLINES)},s.currentColorTarget,s.mainDepth),this.performanceInfo.advance(Bs.Atmosphere),this._renderPlugins.needsLaserlineWithContrastControl&&s.renderTmpAndCompositeToMain(()=>this._renderSlot(Se.LASERLINES_CONTRAST_CONTROL),this._bindParameters,Ko.PremultipliedAlpha),this.performanceInfo.advance(Bs.Laserline),this._renderOccluded(),this.performanceInfo.advance(Bs.Occluded);const h=i===_T.ON&&this._magnifierHelper.enabled,p=h&&R(e)?this._offscreenRendering.getFramebuffer(this._offscreenRendering.tmpColor,this._offscreenRendering.tmpDepth):e;this._rctx.bindFramebuffer(p);const f=this._offscreenRendering.colorTexture;!this._renderAntiAliasing(this._antialiasing,f)&&b(f)&&this._compositingHelper.composite(this._bindParameters,f,Ko.None),this.performanceInfo.advance(Bs.Antialiasing),this._renderHUD(ud.NotOccluded,p),this.performanceInfo.advance(Bs.HudNotoccluded),this._renderHighlights(p,this._bindParameters),this.performanceInfo.advance(Bs.Highlights),h&&this._magnifierHelper.render(this._rctx,this._bindParameters),p!==e&&(this._rctx.bindFramebuffer(e),this._compositingHelper.composite(this._bindParameters,this._offscreenRendering.tmpColorTexture,Ko.None)),this._disposeOITBuffers(),this._renderContext.lastFrameCamera.copyFrom(this._bindParameters.camera),this._sliceHelper.plane=n,this._isRendering=!1,this.onPostRender&&this.onPostRender(),this.performanceInfo.postrender()}finish(e){if(this._hasAnimations||(this._animationTimestep=0),e===Ws.BACKGROUND){this._rctx.gl.getError();const t=this.performanceInfo.elapsedTime/pAt;this._animationTimestep=Math.max(this._animationTimestep*Mye+t*(1-Mye),fAt)}}readDepthPixels(e,t,r){const i=this._offscreenRendering.bindTarget(this._offscreenRendering.linearDepth,this._offscreenRendering.tmpDepth);if(!this._needsLinearDepth){this._ensureBindParameters(e,e),this._bindParameters.camera.setGLViewport(this._rctx),this._rctx.setClearColor(0,0,0,0);const s=ri.COLOR_BUFFER_BIT|ri.DEPTH_BUFFER_BIT|ri.STENCIL_BUFFER_BIT;this._rctx.clearSafe(s),this._renderGeometryAndTransparentTerrainPass(je.MATERIAL_DEPTH)}i.readPixels(t[0],t[1],t[2],t[3],ze.RGBA,Ct.UNSIGNED_BYTE,r)}readHUDVisibility(e,t,r,i,s){this._offscreenRendering.bindTarget(this._offscreenRendering.hudVisibility).readPixels(e,t,r,i,ze.RGBA,Ct.UNSIGNED_BYTE,s)}readAccumulatedShadow(e,t){return this._shadowAccumulator.readAccumulatedShadow(e,t)}_setMultipassEnabled(e){this._bindParameters.multipassTerrain.enabled=this._bindParameters.multipassGeometry.enabled=e}_setTerrainCulling(e){this._bindParameters.multipassTerrain.cullAboveGround=e}_renderSlot(e){this._bindParameters.slot=e,this._renderPlugins.render()}_renderEdges(e,t=!1){const r=this._edgeView;b(r)&&r.shouldRender()&&this._offscreenRendering.renderTmpAndCompositeToMain(()=>r.render(this._bindParameters,e),this._bindParameters,Ko.Alpha,t)}_renderShadowMap(e,t,r,i){const s=this._shadowMap;s.enabled&&(s.start(t,r,i),this._shadowHighlight.updateParameters(t,r),this.needsShadowHighlight?(this._renderShadowCascades(je.MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT,this._shadowMap,n=>s.takeCascadeSnapshotTo(n,HA.Highlight)),s.clear(),this._renderShadowCascades(je.MATERIAL_DEPTH_SHADOWMAP_DEFAULT,this._shadowMap,n=>{s.takeCascadeSnapshotTo(n,HA.Default),this._renderGeometryAndTransparentTerrainPass(je.MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT)})):this._renderShadowCascades(je.MATERIAL_DEPTH_SHADOWMAP_ALL),s.finish(e),t.setGLViewport(this._rctx))}_renderShadowCascades(e,t=this._shadowMap,r=i=>{}){for(const i of t.getCascades())i.camera.setGLViewport(this._rctx),this._ensureCameraBindParameters(i.camera,i.camera),this._renderGeometryAndTransparentTerrainPass(e),r(i)}get _needsLinearDepth(){return this._ssaoHelper.enabled||this._renderPlugins.needsLinearDepth||this._hasWater&&this._waterReflectionEnabled||this.needsShadowHighlight||this.needsShadowCast}_renderLinearDepth(){this._needsLinearDepth?this._offscreenRendering.renderToTargets(()=>this._renderGeometryAndTransparentTerrainPass(je.MATERIAL_DEPTH),this._offscreenRendering.linearDepth,this._offscreenRendering.tmpDepth,[0,0,0,0],!0,!0):this._offscreenRendering.disposeTarget(this._offscreenRendering.linearDepth),this._bindParameters.linearDepthTexture=this._offscreenRendering.linearDepthTexture}_renderTerrainLinearDepth(e){if(e){const t=this._renderContext.pass;this._renderContext.pass=je.MATERIAL_DEPTH,this._offscreenRendering.renderToTargets(()=>this._renderTransparentTerrain(),this._offscreenRendering.terrainLinearDepth,this._offscreenRendering.tmpDepth,[-1e10,-1e10,-1e10,1],!0,!0),this._renderContext.pass=t}else this._offscreenRendering.disposeTarget(this._offscreenRendering.terrainLinearDepth);this._bindParameters.multipassTerrain.linearDepthTexture=this._offscreenRendering.terrainLinearDepthTexture}_renderGeometryLinearDepth(e){if(e){const t=this._renderContext.pass;this._offscreenRendering.renderToTargets(()=>this._renderGeometryPass(je.MATERIAL_DEPTH),this._offscreenRendering.geometryLinearDepth,this._offscreenRendering.tmpDepth,[1,1,1,1],!0,!0),this._renderContext.pass=t}else this._offscreenRendering.disposeTarget(this._offscreenRendering.geometryLinearDepth);this._bindParameters.multipassGeometry.linearDepthTexture=this._offscreenRendering.geometryLinearDepthTexture}get needsNormal(){return this._ssaoHelper.enabled}_renderNormal(){this.needsNormal?this._offscreenRendering.renderToTargets(()=>{this._renderGeometryAndTransparentTerrainPass(je.MATERIAL_NORMAL)},this._offscreenRendering.normal,this._offscreenRendering.tmpDepth,[0,0,0,0],!0,!0):this._offscreenRendering.disposeTarget(this._offscreenRendering.normal)}get needsDepthRange(){return this._shadowMap.enabled||this.needsShadowCast}_computeDepthRange(e){if(!this.needsDepthRange)return uJ;const t=tAt(e,this._content,this._stage.layers);return QA(t,this.renderPlugins.queryDepthRange(e)),t.near=Math.max(e.near,t.near),t.far=Math.min(e.far,t.far),t}_renderGeometryAndTransparentTerrainPass(e){this._renderContext.pass=e,this._renderGeometryPass(e),this._renderTransparentTerrain()}_renderGeometryPass(e){this._renderContext.pass=e,this._renderOpaqueGeometry(),this._renderTransparentGeometry()}_renderOpaqueGeometry(){this._renderSlot(Se.INTEGRATED_MESH),this._renderSlot(Se.OPAQUE_TERRAIN),this._renderInternalSlot(Se.OPAQUE_MATERIAL),this._renderSlot(Se.OPAQUE_MATERIAL),this._renderSlot(Se.POSTPROCESSING_ENVIRONMENT_OPAQUE)}_renderTransparentGeometry(){this._renderInternalSlot(Se.TRANSPARENT_MATERIAL),this._renderSlot(Se.TRANSPARENT_MATERIAL)}_renderTransparentTerrain(){this._renderSlot(Se.TRANSPARENT_TERRAIN)}_renderHUDVisibility(){let e=!1;return this._renderContext.offscreenRenderingHelper&&this._renderContext.offscreenRenderingHelper.renderHUDVisibility(()=>{this._bindParameters.hudVisibilityTexture=this._renderContext.offscreenRenderingHelper.hudVisibilityTexture,e=this._renderInternalSlot(Se.OCCLUSION_PIXELS)},this._multipassTerrain&&this._transparentTerrain),e}_renderLineCallouts(e){this._bindParameters.renderTransparentlyOccludedHUD=e,e===ud.Occluded?this._offscreenRendering.renderToTargets(()=>this._renderInternalSlot(Se.LINE_CALLOUTS),this._offscreenRendering.currentColorTarget,this._offscreenRendering.tmpDepth,void 0,!0,!0):this._renderInternalSlot(Se.LINE_CALLOUTS)}_renderHUD(e,t){this._hasHUDElements&&(this._oitEnabled?(this._renderOrderIndependentTransparency(()=>this._renderHUDElements(e),!0),this._rctx.bindFramebuffer(t),this._compositingHelper.composite(this._bindParameters,this._offscreenRendering.hudColorTexture,Ko.PremultipliedAlpha)):e===ud.Occluded?this._offscreenRendering.renderToTargets(()=>this._renderHUDElements(ud.Occluded),this._offscreenRendering.currentColorTarget,this._offscreenRendering.tmpDepth,void 0,!0,!0):this._renderHUDElements(e))}_renderHUDElements(e){this._bindParameters.renderTransparentlyOccludedHUD=e,this._renderInternalSlot(Se.LINE_CALLOUTS_HUD_DEPTH),this._renderInternalSlot(Se.HUD_MATERIAL),this._renderInternalSlot(Se.LABEL_MATERIAL)}get needsHighlight(){return this._hasHighlights||this._renderPlugins.needsHighlight}get needsShadowHighlight(){return this._shadowMap.enabled&&this._shadowHighlight.isVisible&&this.needsHighlight}_renderHighlights(e,t){if(!this.needsHighlight)return void this._offscreenRendering.disposeTarget(this._offscreenRendering.highlight);const r=this._highlight,i=this._offscreenRendering.renderToTargets(()=>{this._renderGeometryAndTransparentTerrainPass(je.MATERIAL_HIGHLIGHT),this._rctx.clearSafe(ri.DEPTH_BUFFER_BIT),this._renderHUDElements(ud.Both)},this._offscreenRendering.highlight,this._offscreenRendering.tmpDepth,[0,0,0,0],!0,!0);this._bindParameters.highlightColorTexture=i.colorTexture,this.needsShadowHighlight&&this._shadowHighlight.render(t,e),r.render(this._bindParameters,i,e)}get needsShadowCast(){return this._shadowAccumulator.isAccumulating}_accumulateShadows(e,t,r){this.needsShadowCast&&this._shadowAccumulator.renderAccumulation(this._offscreenRendering.linearDepthTexture,e,t,r)}_renderOrderIndependentTransparency(e,t){const r=s=>{this._bindParameters.transparencyPassType=s,this._offscreenRendering.renderOITPass(()=>e(),s,t)},i=this._renderContext.pass;this._renderContext.pass=je.MATERIAL_ALPHA,r(yt.Alpha),this._renderContext.pass=je.MATERIAL,r(yt.Color),r(yt.FrontFace),this._offscreenRendering.compositeTransparentOntoOpaque(this._bindParameters,t),this._bindParameters.transparencyPassType=yt.NONE,this._renderContext.pass=i,this._oitUsed=!0}_disposeOITBuffers(){this._oitUsed||(this._offscreenRendering.disposeTarget(this._offscreenRendering.alphaFloatTarget),this._offscreenRendering.disposeTarget(this._offscreenRendering.colorFloatTarget),this._offscreenRendering.disposeTarget(this._offscreenRendering.frontFaceTarget)),this._oitUsed=!1}_renderOccluded(){let e=0;this._materialRenderers.forEach((n,o)=>{o&&o.isVisible()&&o.renderOccluded===Fi.OccludeAndTransparentStencil&&(e|=o.renderOccluded,KO.push(o))});const t=this._offscreenRendering,r=(n,o,a,l,c)=>{(e&o)!=0&&(t.renderToTargets(a,t.tmpColor,t.mainDepth,[0,0,0,0],l,c),t.compositeOccludedOntoMain(this._bindParameters,n))};KO.length!==0&&(this._renderInternalSlot(Se.OCCLUDER_MATERIAL,KO),r(.5,Fi.OccludeAndTransparentStencil,()=>this._renderInternalSlot(Se.TRANSPARENT_OCCLUDER_MATERIAL,KO),!1,!1),KO.length=0),this._materialRenderers.forEach((n,o)=>{o&&o.isVisible()&&(o.renderOccluded===Fi.OccludeAndTransparent||o.renderOccluded===Fi.Transparent||o.renderOccluded===Fi.Opaque)&&(e|=o.renderOccluded,JO.push(o))});const i=this._renderPlugins.renderOccludedFlags;if(e|=i,!e)return;const s=n=>{this._renderContext.renderOccludedMask=n,i>Fi.Occlude&&this._renderSlot(Se.OCCLUDED_TERRAIN),this._renderInternalSlot(Se.OPAQUE_MATERIAL,JO),this._renderInternalSlot(Se.TRANSPARENT_MATERIAL,JO),this._renderInternalSlot(Se.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL,JO),this._renderContext.resetRenderOccludedMask()};this._renderContext.pass=je.MATERIAL,r(.5,Fi.OccludeAndTransparent,()=>s(Fi.OccludeAndTransparent),!0,tc.OutlineVisualElementMask),r(.5,Fi.Transparent,()=>s(Fi.Transparent),!0,tc.OutlineVisualElementMask),r(1,Fi.Opaque,()=>s(Fi.Opaque),!0,tc.OutlineVisualElementMask),JO.length=0}_renderAntiAliasing(e,t){if(e===sx.SMAA){if(this._smaaPass.enable(()=>this._requestRender())&&b(t))return this._smaaPass.render(t),!0}else this._smaaPass.disable();return!1}_ensureCameraBindParameters(e,t){this._bindParameters.camera=e,this._bindParameters.contentCamera=t}_ensureBindParameters(e,t){var i;this._ensureCameraBindParameters(e,t);const r=this._renderContext.offscreenRenderingHelper;this._bindParameters.hudVisibilityTexture=r.hudVisibilityTexture,this._bindParameters.highlightDepthTexture=(i=r.depthTexture)!=null?i:this._getFallbackDepthTexture()}_ensureBindParametersSSR(){this.hasWaterReflection?(this._renderContext.lastFrameCamera.equals(this._bindParameters.camera)?this._reprojectionMatrix=Tn:(Cs(Iye,this._bindParameters.camera.viewMatrix),Cs(Pye,this._bindParameters.camera.projectionMatrix),Yi(c2,Iye,Pye),Yi(c2,this._renderContext.lastFrameCamera.viewMatrix,c2),Yi(c2,this._renderContext.lastFrameCamera.projectionMatrix,c2),this._reprojectionMatrix=c2),this._bindParameters.ssr.lastFrameColorTexture=this._offscreenRendering.lastFrameColorTexture):this._bindParameters.ssr.lastFrameColorTexture=null,this._bindParameters.ssr.enabled=this.hasWaterReflection}_renderInternalSlot(e,t){let r=!1;return this._bindParameters.slot=e,b(t)?t.forEach(i=>{if(!i.shouldRender(this._renderContext))return;const s=this._materialRenderers.get(i);b(s)&&(r=s.render(this._renderContext.pass,this._bindParameters)||r)}):this._materialRenderers.forEach((i,s)=>{s.shouldRender(this._renderContext)&&i.render(this._renderContext.pass,this._bindParameters)&&(r=!0)}),r}_getFallbackDepthTexture(){return this._fallbackDepthStencilTexture||(this._fallbackDepthStencilTexture=nOe(this._rctx)),this._fallbackDepthStencilTexture}get gpuMemoryUsage(){var e,t,r,i,s,n,o,a,l,c;return{offscreen:(t=(e=this._offscreenRendering)==null?void 0:e.gpuMemoryUsage)!=null?t:0,highlights:((i=(r=this._highlight)==null?void 0:r.gpuMemoryUsage)!=null?i:0)+((n=(s=this._shadowHighlight)==null?void 0:s.gpuMemoryUsage)!=null?n:0),shadows:(a=(o=this._shadowMap)==null?void 0:o.gpuMemoryUsage)!=null?a:0,ssao:(c=(l=this._ssaoHelper)==null?void 0:l.gpuMemoryUsage)!=null?c:0}}get test(){const e=this;return{offscreen:this._offscreenRendering,shadowMap:this._shadowMap,ssao:this._ssaoHelper,highlight:this._highlight,lighting:this._bindParameters.lighting,materialRenderers:this._materialRenderers,shadowAccumulator:this._shadowAccumulator,getFramebufferTexture:t=>{switch(t){case b_.Color:return e._offscreenRendering.colorTexture;case b_.LinearDepth:return e._offscreenRendering.linearDepthTexture;case b_.Normals:return e._offscreenRendering.normalTexture;case b_.ShadowMap:return e._shadowMap.depthTexture;case b_.HudVisibility:return e._offscreenRendering.hudVisibilityTexture;case b_.Highlight:return e._offscreenRendering.highlightTexture}}}}};var b_;u([d()],dy.prototype,"_shadowAccumulator",void 0),u([d()],dy.prototype,"_smaaPass",void 0),u([d()],dy.prototype,"_antialiasing",void 0),u([d()],dy.prototype,"_edgeView",void 0),u([d()],dy.prototype,"updating",null),u([d()],dy.prototype,"isCameraFinal",null),dy=u([$("esri.views.3d.webgl-engine.lib.Renderer")],dy),function(e){e[e.Color=0]="Color",e[e.LinearDepth=1]="LinearDepth",e[e.Normals=2]="Normals",e[e.ShadowMap=3]="ShadowMap",e[e.HudVisibility=4]="HudVisibility",e[e.Highlight=5]="Highlight"}(b_||(b_={}));const JO=[],KO=[],Pye=Ce(),Iye=Ce(),c2=Ce();class $ye{constructor(){this.blend=!1,this.blendColor={r:0,g:0,b:0,a:0},this.blendFunction={srcRGB:Ae.ONE,dstRGB:Ae.ZERO,srcAlpha:Ae.ONE,dstAlpha:Ae.ZERO},this.blendEquation={mode:y0.ADD,modeAlpha:y0.ADD},this.colorMask={r:!0,g:!0,b:!0,a:!0},this.faceCulling=!1,this.cullFace=af.BACK,this.frontFace=SA.CCW,this.scissorTest=!1,this.scissorRect={x:0,y:0,width:0,height:0},this.depthTest=!1,this.depthFunction=_i.LESS,this.clearDepth=1,this.depthWrite=!0,this.depthRange={zNear:0,zFar:1},this.viewport=null,this.stencilTest=!1,this.polygonOffsetFill=!1,this.polygonOffset=[0,0],this.stencilFunction={face:af.FRONT_AND_BACK,func:_i.ALWAYS,ref:0,mask:1},this.clearStencil=0,this.stencilWriteMask=1,this.stencilOperation={face:af.FRONT_AND_BACK,fail:hs.KEEP,zFail:hs.KEEP,zPass:hs.KEEP},this.clearColor={r:0,g:0,b:0,a:0},this.program=null,this.vertexBuffer=null,this.indexBuffer=null,this.uniformBuffer=null,this.pixelPackBuffer=null,this.pixelUnpackBuffer=null,this.copyReadBuffer=null,this.copyWriteBuffer=null,this.uniformBufferBindingPoints=new Array,this.readFramebuffer=null,this.drawFramebuffer=null,this.renderbuffer=null,this.activeTexture=0,this.textureUnitMap=new Array}}class VRt{constructor(t){this._allocations=new Map,t?Error.stackTraceLimit=1/0:(this.add=()=>{},this.remove=()=>{})}add(t){this._allocations.set(t,new Error().stack)}remove(t){this._allocations.delete(t)}print(){if(this._allocations.size>0){console.log(`${this._allocations.size} live object allocations:`);const t=new Map;this._allocations.forEach(r=>{var i;t.set(r,((i=t.get(r))!=null?i:0)+1)}),t.forEach((r,i)=>{const s=i.split(`
`);s.shift(),s.shift(),console.log(`${r}: ${s.shift()}`),s.forEach(n=>console.log("   ",n))})}}}const zRt={RECORD_ALLOCATIONS:!1};class BRt{constructor(){for(this._current=new Array,this._max=new Array,this._allocations=new VRt(zRt.RECORD_ALLOCATIONS);this._current.length<Nn.COUNT;)this._current.push(0),this._max.push(0)}resetMax(){for(this._max.length=0;this._max.length<this._current.length;)this._max.push(0)}increment(t,r){const i=++this._current[t];this._max[t]=Math.max(i,this._max[t]),this._allocations.add(r)}decrement(t,r){--this._current[t],this._allocations.remove(r)}get max(){return this._max}get current(){return this._current}get total(){return this.current.reduce((t,r)=>t+r,0)}printResourceCount(){if(this.total>0){console.log("Live objects:");for(let t=0;t<Nn.COUNT;++t){const r=this._current[t];r>0&&console.log(`${Nn[t]}: ${r}`)}}this._allocations.print()}}const GRt=["layout","centroid","smooth","case","mat2x2","mat2x3","mat2x4","mat3x2","mat3x3","mat3x4","mat4x2","mat4x3","mat4x4","uint","uvec2","uvec3","uvec4","samplerCubeShadow","sampler2DArray","sampler2DArrayShadow","isampler2D","isampler3D","isamplerCube","isampler2DArray","usampler2D","usampler3D","usamplerCube","usampler2DArray","coherent","restrict","readonly","writeonly","resource","atomic_uint","noperspective","patch","sample","subroutine","common","partition","active","filter","image1D","image2D","image3D","imageCube","iimage1D","iimage2D","iimage3D","iimageCube","uimage1D","uimage2D","uimage3D","uimageCube","image1DArray","image2DArray","iimage1DArray","iimage2DArray","uimage1DArray","uimage2DArray","image1DShadow","image2DShadow","image1DArrayShadow","image2DArrayShadow","imageBuffer","iimageBuffer","uimageBuffer","sampler1DArray","sampler1DArrayShadow","isampler1D","isampler1DArray","usampler1D","usampler1DArray","isampler2DRect","usampler2DRect","samplerBuffer","isamplerBuffer","usamplerBuffer","sampler2DMS","isampler2DMS","usampler2DMS","sampler2DMSArray","isampler2DMSArray","usampler2DMSArray","trunc","round","roundEven","isnan","isinf","floatBitsToInt","floatBitsToUint","intBitsToFloat","uintBitsToFloat","packSnorm2x16","unpackSnorm2x16","packUnorm2x16","unpackUnorm2x16","packHalf2x16","unpackHalf2x16","outerProduct","transpose","determinant","inverse","texture","textureSize","textureProj","textureLod","textureOffset","texelFetch","texelFetchOffset","textureProjOffset","textureLodOffset","textureProjLod","textureProjLodOffset","textureGrad","textureGradOffset","textureProjGrad","textureProjGradOffset"];var Lye,FLe={exports:{}};(Lye=["precision","highp","mediump","lowp","attribute","const","uniform","varying","break","continue","do","for","while","if","else","in","out","inout","float","int","void","bool","true","false","discard","return","mat2","mat3","mat4","vec2","vec3","vec4","ivec2","ivec3","ivec4","bvec2","bvec3","bvec4","sampler1D","sampler2D","sampler3D","samplerCube","sampler1DShadow","sampler2DShadow","struct","asm","class","union","enum","typedef","template","this","packed","goto","switch","default","inline","noinline","volatile","public","static","extern","external","interface","long","short","double","half","fixed","unsigned","input","output","hvec2","hvec3","hvec4","dvec2","dvec3","dvec4","fvec2","fvec3","fvec4","sampler2DRect","sampler3DRect","sampler2DRectShadow","sizeof","cast","namespace","using"])!==void 0&&(FLe.exports=Lye);const jRt=FLe.exports;var Dye,kLe={exports:{}};Dye=kLe,function(e){var t=["<<=",">>=","++","--","<<",">>","<=",">=","==","!=","&&","||","+=","-=","*=","/=","%=","&=","^^","^=","|=","(",")","[","]",".","!","~","*","/","%","+","-","<",">","&","^","|","?",":","=",",",";","{","}"];t!==void 0&&(Dye.exports=t)}();const Nye=kLe.exports;var ULe={exports:{}};(function(e){(function(t){var r=function(){return["abs","acos","all","any","asin","atan","ceil","clamp","cos","cross","dFdx","dFdy","degrees","distance","dot","equal","exp","exp2","faceforward","floor","fract","gl_BackColor","gl_BackLightModelProduct","gl_BackLightProduct","gl_BackMaterial","gl_BackSecondaryColor","gl_ClipPlane","gl_ClipVertex","gl_Color","gl_DepthRange","gl_DepthRangeParameters","gl_EyePlaneQ","gl_EyePlaneR","gl_EyePlaneS","gl_EyePlaneT","gl_Fog","gl_FogCoord","gl_FogFragCoord","gl_FogParameters","gl_FragColor","gl_FragCoord","gl_FragData","gl_FragDepth","gl_FragDepthEXT","gl_FrontColor","gl_FrontFacing","gl_FrontLightModelProduct","gl_FrontLightProduct","gl_FrontMaterial","gl_FrontSecondaryColor","gl_LightModel","gl_LightModelParameters","gl_LightModelProducts","gl_LightProducts","gl_LightSource","gl_LightSourceParameters","gl_MaterialParameters","gl_MaxClipPlanes","gl_MaxCombinedTextureImageUnits","gl_MaxDrawBuffers","gl_MaxFragmentUniformComponents","gl_MaxLights","gl_MaxTextureCoords","gl_MaxTextureImageUnits","gl_MaxTextureUnits","gl_MaxVaryingFloats","gl_MaxVertexAttribs","gl_MaxVertexTextureImageUnits","gl_MaxVertexUniformComponents","gl_ModelViewMatrix","gl_ModelViewMatrixInverse","gl_ModelViewMatrixInverseTranspose","gl_ModelViewMatrixTranspose","gl_ModelViewProjectionMatrix","gl_ModelViewProjectionMatrixInverse","gl_ModelViewProjectionMatrixInverseTranspose","gl_ModelViewProjectionMatrixTranspose","gl_MultiTexCoord0","gl_MultiTexCoord1","gl_MultiTexCoord2","gl_MultiTexCoord3","gl_MultiTexCoord4","gl_MultiTexCoord5","gl_MultiTexCoord6","gl_MultiTexCoord7","gl_Normal","gl_NormalMatrix","gl_NormalScale","gl_ObjectPlaneQ","gl_ObjectPlaneR","gl_ObjectPlaneS","gl_ObjectPlaneT","gl_Point","gl_PointCoord","gl_PointParameters","gl_PointSize","gl_Position","gl_ProjectionMatrix","gl_ProjectionMatrixInverse","gl_ProjectionMatrixInverseTranspose","gl_ProjectionMatrixTranspose","gl_SecondaryColor","gl_TexCoord","gl_TextureEnvColor","gl_TextureMatrix","gl_TextureMatrixInverse","gl_TextureMatrixInverseTranspose","gl_TextureMatrixTranspose","gl_Vertex","greaterThan","greaterThanEqual","inversesqrt","length","lessThan","lessThanEqual","log","log2","matrixCompMult","max","min","mix","mod","normalize","not","notEqual","pow","radians","reflect","refract","sign","sin","smoothstep","sqrt","step","tan","texture2D","texture2DLod","texture2DProj","texture2DProjLod","textureCube","textureCubeLod","texture2DLodEXT","texture2DProjLodEXT","textureCubeLodEXT","texture2DGradEXT","texture2DProjGradEXT","textureCubeGradEXT"]}();r!==void 0&&(e.exports=r)})()})(ULe);const HRt=ULe.exports;var up=999,Fye=9999,pH=0,fH=1,kye=2,Uye=3,Vye=4,l4=5,qRt=6,WRt=7,XRt=8,zye=9,ZRt=10,Bye=11,YRt=["block-comment","line-comment","preprocessor","operator","integer","float","ident","builtin","keyword","whitespace","eof","integer"];function QRt(){var e,t,r,i=0,s=0,n=up,o=[],a=[],l=1,c=0,h=0,p=!1,f=!1,m="";return function(z){return a=[],z!==null?v(z.replace?z.replace(/\r\n/g,`
`):z):w()};function g(z){z.length&&a.push({type:YRt[n],data:z,position:h,line:l,column:c})}function v(z){var X;for(i=0,r=(m+=z).length;e=m[i],i<r;){switch(X=i,n){case pH:i=C();break;case fH:i=E();break;case kye:i=x();break;case Uye:i=A();break;case Vye:i=L();break;case Bye:i=I();break;case l4:i=k();break;case Fye:i=G();break;case zye:i=T();break;case up:i=_()}X!==i&&(m[X]===`
`?(c=0,++l):++c)}return s+=i,m=m.slice(i),a}function w(z){return o.length&&g(o.join("")),n=ZRt,g("(eof)"),a}function _(){return o=o.length?[]:o,t==="/"&&e==="*"?(h=s+i-1,n=pH,t=e,i+1):t==="/"&&e==="/"?(h=s+i-1,n=fH,t=e,i+1):e==="#"?(n=kye,h=s+i,i):/\s/.test(e)?(n=zye,h=s+i,i):(p=/\d/.test(e),f=/[^\w_]/.test(e),h=s+i,n=p?Vye:f?Uye:Fye,i)}function T(){return/[^\s]/g.test(e)?(g(o.join("")),n=up,i):(o.push(e),t=e,i+1)}function x(){return e!=="\r"&&e!==`
`||t==="\\"?(o.push(e),t=e,i+1):(g(o.join("")),n=up,i)}function E(){return x()}function C(){return e==="/"&&t==="*"?(o.push(e),g(o.join("")),n=up,i+1):(o.push(e),t=e,i+1)}function A(){if(t==="."&&/\d/.test(e))return n=l4,i;if(t==="/"&&e==="*")return n=pH,i;if(t==="/"&&e==="/")return n=fH,i;if(e==="."&&o.length){for(;P(o););return n=l4,i}if(e===";"||e===")"||e==="("){if(o.length)for(;P(o););return g(e),n=up,i+1}var z=o.length===2&&e!=="=";if(/[\w_\d\s]/.test(e)||z){for(;P(o););return n=up,i}return o.push(e),t=e,i+1}function P(z){for(var X,Z,ce=0;;){if(X=Nye.indexOf(z.slice(0,z.length+ce).join("")),Z=Nye[X],X===-1){if(ce--+z.length>0)continue;Z=z.slice(0,1).join("")}return g(Z),h+=Z.length,(o=o.slice(Z.length)).length}}function I(){return/[^a-fA-F0-9]/.test(e)?(g(o.join("")),n=up,i):(o.push(e),t=e,i+1)}function L(){return e==="."||/[eE]/.test(e)?(o.push(e),n=l4,t=e,i+1):e==="x"&&o.length===1&&o[0]==="0"?(n=Bye,o.push(e),t=e,i+1):/[^\d]/.test(e)?(g(o.join("")),n=up,i):(o.push(e),t=e,i+1)}function k(){return e==="f"&&(o.push(e),t=e,i+=1),/[eE]/.test(e)||e==="-"&&/[eE]/.test(t)?(o.push(e),t=e,i+1):/[^\d]/.test(e)?(g(o.join("")),n=up,i):(o.push(e),t=e,i+1)}function G(){if(/[^\d\w_]/.test(e)){var z=o.join("");return n=jRt.indexOf(z)>-1?XRt:HRt.indexOf(z)>-1?WRt:qRt,g(o.join("")),n=up,i}return o.push(e),t=e,i+1}}function JRt(e){var t=QRt(),r=[];return r=(r=r.concat(t(e))).concat(t(null))}function KRt(e){return JRt(e)}function eOt(e){return e.map(t=>t.type!=="eof"?t.data:"").join("")}const mH=["GL_OES_standard_derivatives","GL_EXT_frag_depth","GL_EXT_draw_buffers","GL_EXT_shader_texture_lod"];function tOt(e,t="100",r="300 es"){const i=/^\s*\#version\s+([0-9]+(\s+[a-zA-Z]+)?)\s*/;for(const s of e)if(s.type==="preprocessor"){const n=i.exec(s.data);if(n){const o=n[1].replace(/\s\s+/g," ");if(o===r)return o;if(o===t)return s.data="#version "+r,t;throw new Error("unknown glsl version: "+o)}}return e.splice(0,0,{type:"preprocessor",data:"#version "+r},{type:"whitespace",data:`
`}),null}function rOt(e,t){for(let r=t-1;r>=0;r--){const i=e[r];if(i.type!=="whitespace"&&i.type!=="block-comment"){if(i.type!=="keyword")break;if(i.data==="attribute"||i.data==="in")return!0}}return!1}function S3(e,t,r,i){i=i||r;for(const s of e)if(s.type==="ident"&&s.data===r)return i in t?t[i]++:t[i]=0,S3(e,t,i+"_"+t[i],i);return r}function VLe(e,t,r="afterVersion"){function i(l,c){for(let h=c;h<l.length;h++){const p=l[h];if(p.type==="operator"&&p.data===";")return h}return null}function s(l){let c=-1,h=0,p=-1;for(let f=0;f<l.length;f++){const m=l[f];if(m.type==="preprocessor"&&(m.data.match(/\#(if|ifdef|ifndef)\s+.+/)?++h:m.data.match(/\#endif\s*.*/)&&--h),r!=="afterVersion"&&r!=="afterPrecision"||m.type==="preprocessor"&&/^#version/.test(m.data)&&(p=Math.max(p,f)),r==="afterPrecision"&&m.type==="keyword"&&m.data==="precision"){const g=i(l,f);if(g===null)throw new Error("precision statement not followed by any semicolons!");p=Math.max(p,g)}c<p&&h===0&&(c=f)}return c+1}const n={data:`
`,type:"whitespace"},o=l=>l<e.length&&/[^\r\n]$/.test(e[l].data);let a=s(e);o(a-1)&&e.splice(a++,0,n);for(const l of t)e.splice(a++,0,l);o(a-1)&&o(a)&&e.splice(a,0,n)}function iOt(e,t,r,i="lowp"){VLe(e,[{type:"keyword",data:"out"},{type:"whitespace",data:" "},{type:"keyword",data:i},{type:"whitespace",data:" "},{type:"keyword",data:r},{type:"whitespace",data:" "},{type:"ident",data:t},{type:"operator",data:";"}],"afterPrecision")}function sOt(e,t,r,i,s="lowp"){VLe(e,[{type:"keyword",data:"layout"},{type:"operator",data:"("},{type:"keyword",data:"location"},{type:"whitespace",data:" "},{type:"operator",data:"="},{type:"whitespace",data:" "},{type:"integer",data:i.toString()},{type:"operator",data:")"},{type:"whitespace",data:" "},{type:"keyword",data:"out"},{type:"whitespace",data:" "},{type:"keyword",data:s},{type:"whitespace",data:" "},{type:"keyword",data:r},{type:"whitespace",data:" "},{type:"ident",data:t},{type:"operator",data:";"}],"afterPrecision")}function nOt(e,t){let r,i,s=-1;for(let n=t;n<e.length;n++){const o=e[n];if(o.type==="operator"&&(o.data==="["&&(r=n),o.data==="]")){i=n;break}o.type==="integer"&&(s=parseInt(o.data,10))}return r&&i&&e.splice(r,i-r+1),s}function Gye(e,t){const r=oOt();if(b(r))return r;const i=KRt(e);if(tOt(i,"100","300 es")==="300 es")return e;let s=null,n=null;const o={},a={};for(let l=0;l<i.length;++l){const c=i[l];switch(c.type){case"keyword":t===Yu.VERTEX_SHADER&&c.data==="attribute"?c.data="in":c.data==="varying"&&(c.data=t===Yu.VERTEX_SHADER?"out":"in");break;case"builtin":if(/^texture(2D|Cube)(Proj)?(Lod|Grad)?(EXT)?$/.test(c.data.trim())&&(c.data=c.data.replace(/(2D|Cube|EXT)/g,"")),t===Yu.FRAGMENT_SHADER&&c.data==="gl_FragColor"&&(s||(s=S3(i,o,"fragColor"),iOt(i,s,"vec4")),c.data=s),t===Yu.FRAGMENT_SHADER&&c.data==="gl_FragData"){const h=nOt(i,l+1),p=S3(i,o,"fragData");sOt(i,p,"vec4",h,"mediump"),c.data=p}else t===Yu.FRAGMENT_SHADER&&c.data==="gl_FragDepthEXT"&&(n||(n=S3(i,o,"gl_FragDepth")),c.data=n);break;case"ident":if(GRt.includes(c.data)){if(t===Yu.VERTEX_SHADER&&rOt(i,l))throw new Error("attribute in vertex shader uses a name that is a reserved word in glsl 300 es");c.data in a||(a[c.data]=S3(i,o,c.data)),c.data=a[c.data]}}}for(let l=i.length-1;l>=0;--l){const c=i[l];if(c.type==="preprocessor"){const h=c.data.match(/\#extension\s+(.*)\:/);if(h&&h[1]&&mH.includes(h[1].trim())){const m=i[l+1];i.splice(l,m&&m.type==="whitespace"?2:1)}const p=c.data.match(/\#ifdef\s+(.*)/);p&&p[1]&&mH.includes(p[1].trim())&&(c.data="#if 1");const f=c.data.match(/\#ifndef\s+(.*)/);f&&f[1]&&mH.includes(f[1].trim())&&(c.data="#if 0")}}return aOt(e,eOt(i))}function oOt(e){return null}function aOt(e,t){return t}const lOt=4294967295;class cOt{constructor(t,r,i,s,n=new Map){this._context=t,this._locations=s,this._uniformBlockBindings=n,this._refCount=1,this._compiled=!1,this._nameToUniformLocation={},this._nameToUniform1={},this._nameToUniform1v=new Map,this._nameToUniform2=new Map,this._nameToUniform3=new Map,this._nameToUniform4=new Map,this._nameToUniformMatrix3=new Map,this._nameToUniformMatrix4=new Map,t||console.error("RenderingContext isn't initialized!"),r.length===0&&console.error("Shaders source should not be empty!"),this._context.type===mr.WEBGL2&&(r=Gye(r,Yu.VERTEX_SHADER),i=Gye(i,Yu.FRAGMENT_SHADER)),this._vShader=jye(this._context,Yu.VERTEX_SHADER,r),this._fShader=jye(this._context,Yu.FRAGMENT_SHADER,i),this._vShader&&this._fShader||console.error("Error loading shaders!"),this._context.instanceCounter.increment(Nn.Shader,this),LI()&&(this.vertexShader=r,this.fragmentShader=i)}get glName(){if(b(this._glName))return this._glName;if(R(this._vShader))return null;const t=this._context.gl,r=t.createProgram();if(t.attachShader(r,this._vShader),t.attachShader(r,this._fShader),this._locations.forEach((i,s)=>t.bindAttribLocation(r,i,s)),t.linkProgram(r),LI()&&!t.getProgramParameter(r,t.LINK_STATUS)&&console.error(`Could not link shader
validated: ${t.getProgramParameter(r,t.VALIDATE_STATUS)}, gl error ${t.getError()}, vertex: ${t.getShaderParameter(this._vShader,t.COMPILE_STATUS)}, fragment: ${t.getShaderParameter(this._fShader,t.COMPILE_STATUS)}, info log: ${t.getProgramInfoLog(r)}, vertex source: ${this.vertexShader}, fragment source: ${this.fragmentShader}`),this._context.type===mr.WEBGL2){const i=t;for(const[s,n]of this._uniformBlockBindings){const o=i.getUniformBlockIndex(r,s);o<lOt&&i.uniformBlockBinding(r,o,n)}}return this._glName=r,this._context.instanceCounter.increment(Nn.Program,this),r}get hasGLName(){return b(this._glName)}get isCompiled(){if(this._compiled)return!0;const t=this._context.gl.getExtension("KHR_parallel_shader_compile");return t==null?(this._compiled=!0,!0):(this._compiled=!!this._context.gl.getProgramParameter(this.glName,t.COMPLETION_STATUS_KHR),this._compiled)}dispose(){if(--this._refCount>0)return;const t=this._context.gl;this._vShader&&(t.deleteShader(this._vShader),this._vShader=null,this._context.instanceCounter.decrement(Nn.Shader,this)),this._fShader&&(t.deleteShader(this._fShader),this._fShader=null),this._glName&&(t.deleteProgram(this._glName),this._glName=null,this._context.instanceCounter.decrement(Nn.Program,this))}ref(){++this._refCount}_getUniformLocation(t){return this._nameToUniformLocation[t]===void 0&&(this._nameToUniformLocation[t]=this._context.gl.getUniformLocation(this.glName,t)),this._nameToUniformLocation[t]}hasUniform(t){return this._getUniformLocation(t)!==null}setUniform1i(t,r){const i=this._nameToUniform1[t];i!==void 0&&r===i||(this._context.gl.uniform1i(this._getUniformLocation(t),r),this._nameToUniform1[t]=r)}setUniform1iv(t,r){Xf(this._nameToUniform1v,t,r)&&this._context.gl.uniform1iv(this._getUniformLocation(t),r)}setUniform2iv(t,r){Xf(this._nameToUniform2,t,r)&&this._context.gl.uniform2iv(this._getUniformLocation(t),r)}setUniform3iv(t,r){Xf(this._nameToUniform3,t,r)&&this._context.gl.uniform3iv(this._getUniformLocation(t),r)}setUniform4iv(t,r){Xf(this._nameToUniform4,t,r)&&this._context.gl.uniform4iv(this._getUniformLocation(t),r)}setUniform1f(t,r){const i=this._nameToUniform1[t];i!==void 0&&r===i||(this._context.gl.uniform1f(this._getUniformLocation(t),r),this._nameToUniform1[t]=r)}setUniform1fv(t,r){Xf(this._nameToUniform1v,t,r)&&this._context.gl.uniform1fv(this._getUniformLocation(t),r)}setUniform2f(t,r,i){const s=this._nameToUniform2.get(t);s===void 0?(this._context.gl.uniform2f(this._getUniformLocation(t),r,i),this._nameToUniform2.set(t,[r,i])):r===s[0]&&i===s[1]||(this._context.gl.uniform2f(this._getUniformLocation(t),r,i),s[0]=r,s[1]=i)}setUniform2fv(t,r){Xf(this._nameToUniform2,t,r)&&this._context.gl.uniform2fv(this._getUniformLocation(t),r)}setUniform3f(t,r,i,s){const n=this._nameToUniform3.get(t);n===void 0?(this._context.gl.uniform3f(this._getUniformLocation(t),r,i,s),this._nameToUniform3[t]=[r,i,s]):r===n[0]&&i===n[1]&&s===n[2]||(this._context.gl.uniform3f(this._getUniformLocation(t),r,i,s),n[0]=r,n[1]=i,n[2]=s)}setUniform3fv(t,r){Xf(this._nameToUniform3,t,r)&&this._context.gl.uniform3fv(this._getUniformLocation(t),r)}setUniform4f(t,r,i,s,n){const o=this._nameToUniform4.get(t);o===void 0?(this._context.gl.uniform4f(this._getUniformLocation(t),r,i,s,n),this._nameToUniform4.set(t,[r,i,s,n])):o!==void 0&&r===o[0]&&i===o[1]&&s===o[2]&&n===o[3]||(this._context.gl.uniform4f(this._getUniformLocation(t),r,i,s,n),o[0]=r,o[1]=i,o[2]=s,o[3]=n)}setUniform4fv(t,r){Xf(this._nameToUniform4,t,r)&&this._context.gl.uniform4fv(this._getUniformLocation(t),r)}setUniformMatrix3fv(t,r,i=!1){Xf(this._nameToUniformMatrix3,t,r)&&this._context.gl.uniformMatrix3fv(this._getUniformLocation(t),i,r)}setUniformMatrix4fv(t,r,i=!1){Xf(this._nameToUniformMatrix4,t,r)&&this._context.gl.uniformMatrix4fv(this._getUniformLocation(t),i,r)}stop(){}}function jye(e,t,r){const i=e.gl,s=i.createShader(t);return i.shaderSource(s,r),i.compileShader(s),LI()&&!i.getShaderParameter(s,i.COMPILE_STATUS)&&(console.error("Compile error in ".concat(t===Yu.VERTEX_SHADER?"vertex":"fragment"," shader")),console.error(i.getShaderInfoLog(s)),console.error(uOt(r))),s}function uOt(e){let t=2;return e.replace(/\n/g,()=>`
`+hOt(t++)+":")}function hOt(e){return e>=1e3?e.toString():("  "+e).slice(-3)}function Xf(e,t,r){const i=e.get(t);return i?OK(i,r):(e.set(t,Array.from(r)),!0)}class dOt{constructor(t){this._rctx=t,this._store=new Tse}dispose(){this._store.forEach(t=>t.forEach(r=>r.dispose())),this._store.clear()}acquire(t,r,i,s){const n=this._store.get(t,r);if(b(n))return n.ref(),n;const o=new cOt(this._rctx,t,r,i,s);return o.ref(),this._store.set(t,r,o),o}get test(){let t=0;return this._store.forEach(r=>r.forEach(i=>t+=i.hasGLName?2:1)),{cachedWebGLObjects:t}}}function Hye(e,t){const r=new Pi(e,{colorTarget:us.TEXTURE,depthStencilTarget:Pr.NONE},{target:mt.TEXTURE_2D,wrapMode:xt.CLAMP_TO_EDGE,pixelFormat:ze.RGBA,dataType:Ct.UNSIGNED_BYTE,samplingMode:et.NEAREST,width:1,height:1});function i(_,T){const x=`

  precision highp float;

  attribute vec2 position;

  uniform vec3 u_highA;
  uniform vec3 u_lowA;
  uniform vec3 u_highB;
  uniform vec3 u_lowB;

  varying vec4 v_color;

  ${t?"#define DOUBLE_PRECISION_REQUIRES_OBFUSCATION":""}

  #ifdef DOUBLE_PRECISION_REQUIRES_OBFUSCATION

  vec3 dpPlusFrc(vec3 a, vec3 b) {
    return mix(a, a + b, vec3(notEqual(b, vec3(0))));
  }

  vec3 dpMinusFrc(vec3 a, vec3 b) {
    return mix(vec3(0), a - b, vec3(notEqual(a, b)));
  }

  vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
    vec3 t1 = dpPlusFrc(hiA, hiB);
    vec3 e = dpMinusFrc(t1, hiA);
    vec3 t2 = dpMinusFrc(hiB, e) + dpMinusFrc(hiA, dpMinusFrc(t1, e)) + loA + loB;
    return t1 + t2;
  }

  #else

  vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
    vec3 t1 = hiA + hiB;
    vec3 e = t1 - hiA;
    vec3 t2 = ((hiB - e) + (hiA - (t1 - e))) + loA + loB;
    return t1 + t2;
  }

  #endif

  const float MAX_RGBA_FLOAT =
    255.0 / 256.0 +
    255.0 / 256.0 / 256.0 +
    255.0 / 256.0 / 256.0 / 256.0 +
    255.0 / 256.0 / 256.0 / 256.0 / 256.0;

  const vec4 FIXED_POINT_FACTORS = vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);

  vec4 float2rgba(const float value) {
    // Make sure value is in the domain we can represent
    float valueInValidDomain = clamp(value, 0.0, MAX_RGBA_FLOAT);

    // Decompose value in 32bit fixed point parts represented as
    // uint8 rgba components. Decomposition uses the fractional part after multiplying
    // by a power of 256 (this removes the bits that are represented in the previous
    // component) and then converts the fractional part to 8bits.
    vec4 fixedPointU8 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);

    // Convert uint8 values (from 0 to 255) to floating point representation for
    // the shader
    const float toU8AsFloat = 1.0 / 255.0;

    return fixedPointU8 * toU8AsFloat;
  }

  void main() {
    vec3 val = dpAdd(u_highA, u_lowA, -u_highB, -u_lowB);

    v_color = float2rgba(val.z / 25.0);

    gl_Position = vec4(position * 2.0 - 1.0, 0.0, 1.0);
  }
  `,E=`
  precision highp float;

  varying vec4 v_color;

  void main() {
    gl_FragColor = v_color;
  }
  `,C=e.programCache.acquire(x,E,new Map([["position",0]])),A=new Float32Array(6);fQ(_,A,3);const P=new Float32Array(6);return fQ(T,P,3),e.useProgram(C),C.setUniform3f("u_highA",A[0],A[2],A[4]),C.setUniform3f("u_lowA",A[1],A[3],A[5]),C.setUniform3f("u_highB",P[0],P[2],P[4]),C.setUniform3f("u_lowB",P[1],P[3],P[5]),C}const s=cr.createVertex(e,Cr.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),n=new rn(e,new Map([["position",0]]),{geometry:[new Io("position",2,pt.UNSIGNED_SHORT,0,4)]},{geometry:s}),o=Ue(5633261287538229e-9,2626832878767164e-9,1.4349880495278358e6),a=Ue(563327146742708e-8,2.6268736381334523e6,1434963231608387e-9),l=i(o,a),c=e.getBoundFramebufferObject(),{x:h,y:p,width:f,height:m}=e.getViewport();e.bindFramebuffer(r),e.setViewport(0,0,1,1),e.bindVAO(n),e.drawArrays(Lt.TRIANGLE_STRIP,0,4);const g=new Uint8Array(4);r.readPixels(0,0,1,1,ze.RGBA,Ct.UNSIGNED_BYTE,g),l.dispose(),n.dispose(!1),s.dispose(),r.dispose(),e.setViewport(h,p,f,m),e.bindFramebuffer(c);const v=(o[2]-a[2])/25,w=ase(g);return Math.abs(v-w)}var qye,Wye,Xye,zLe={exports:{}};function pOt(e){var g,v,w,_,T;if(!e.gl)return!1;if(e.type===mr.WEBGL1)return!(!((g=e.capabilities.textureFloat)!=null&&g.textureFloat)||!((v=e.capabilities.colorBufferFloat)!=null&&v.textureFloat));if(!(((w=e.capabilities.textureFloat)==null?void 0:w.textureFloat)&&((_=e.capabilities.colorBufferFloat)==null?void 0:_.textureFloat)&&((T=e.capabilities.colorBufferFloat)==null?void 0:T.floatBlend)))return!1;const t=new Pi(e,{colorTarget:us.TEXTURE,depthStencilTarget:Pr.NONE},{target:mt.TEXTURE_2D,wrapMode:xt.CLAMP_TO_EDGE,pixelFormat:ze.RGBA,dataType:Ct.FLOAT,internalFormat:gt.RGBA32F,samplingMode:et.NEAREST,width:1,height:1}),r=cr.createVertex(e,Cr.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),i=new rn(e,new Map([["a_pos",0]]),{geometry:[new Io("a_pos",2,pt.UNSIGNED_SHORT,0,4)]},{geometry:r}),s=`
  precision highp float;
  attribute vec2 a_pos;

  void main() {
    gl_Position = vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);
  }
  `,n=`
   precision highp float;

   void main() {
    gl_FragColor = vec4(0.5, 0.5, 0.5, 0.5);
   }
  `,o=e.programCache.acquire(s,n,new Map([["a_pos",0]]));e.useProgram(o);const a=e.getBoundFramebufferObject(),{x:l,y:c,width:h,height:p}=e.getViewport();e.bindFramebuffer(t),e.setViewport(0,0,1,1),e.bindVAO(i),e.drawArrays(Lt.TRIANGLE_STRIP,0,4);const f=Gt({blending:$3e});e.setPipelineState(f),e.drawArrays(Lt.TRIANGLE_STRIP,0,4),zLe.exports.init(e);const m=e.gl.getError();return e.setViewport(l,c,h,p),e.bindFramebuffer(a),o.dispose(),i.dispose(!1),r.dispose(),t.dispose(),m!==1282||(console.warn("Device claims support for WebGL extension EXT_float_blend but does not support it. Using fall back."),!1)}qye=zLe,Wye=function(){var e=function(v){window.console&&window.console.log&&window.console.log(v)},t=function(v){window.console&&window.console.error?window.console.error(v):e(v)},r={enable:{1:{0:!0}},disable:{1:{0:!0}},getParameter:{1:{0:!0}},drawArrays:{3:{0:!0}},drawElements:{4:{0:!0,2:!0}},createShader:{1:{0:!0}},getShaderParameter:{2:{1:!0}},getProgramParameter:{2:{1:!0}},getShaderPrecisionFormat:{2:{0:!0,1:!0}},getVertexAttrib:{2:{1:!0}},vertexAttribPointer:{6:{2:!0}},bindTexture:{2:{0:!0}},activeTexture:{1:{0:!0}},getTexParameter:{2:{0:!0,1:!0}},texParameterf:{3:{0:!0,1:!0}},texParameteri:{3:{0:!0,1:!0,2:!0}},texImage2D:{9:{0:!0,2:!0,6:!0,7:!0},6:{0:!0,2:!0,3:!0,4:!0}},texSubImage2D:{9:{0:!0,6:!0,7:!0},7:{0:!0,4:!0,5:!0}},copyTexImage2D:{8:{0:!0,2:!0}},copyTexSubImage2D:{8:{0:!0}},generateMipmap:{1:{0:!0}},compressedTexImage2D:{7:{0:!0,2:!0}},compressedTexSubImage2D:{8:{0:!0,6:!0}},bindBuffer:{2:{0:!0}},bufferData:{3:{0:!0,2:!0}},bufferSubData:{3:{0:!0}},getBufferParameter:{2:{0:!0,1:!0}},pixelStorei:{2:{0:!0,1:!0}},readPixels:{7:{4:!0,5:!0}},bindRenderbuffer:{2:{0:!0}},bindFramebuffer:{2:{0:!0}},checkFramebufferStatus:{1:{0:!0}},framebufferRenderbuffer:{4:{0:!0,1:!0,2:!0}},framebufferTexture2D:{5:{0:!0,1:!0,2:!0}},getFramebufferAttachmentParameter:{3:{0:!0,1:!0,2:!0}},getRenderbufferParameter:{2:{0:!0,1:!0}},renderbufferStorage:{4:{0:!0,1:!0}},clear:{1:{0:{enumBitwiseOr:["COLOR_BUFFER_BIT","DEPTH_BUFFER_BIT","STENCIL_BUFFER_BIT"]}}},depthFunc:{1:{0:!0}},blendFunc:{2:{0:!0,1:!0}},blendFuncSeparate:{4:{0:!0,1:!0,2:!0,3:!0}},blendEquation:{1:{0:!0}},blendEquationSeparate:{2:{0:!0,1:!0}},stencilFunc:{3:{0:!0}},stencilFuncSeparate:{4:{0:!0,1:!0}},stencilMaskSeparate:{2:{0:!0}},stencilOp:{3:{0:!0,1:!0,2:!0}},stencilOpSeparate:{4:{0:!0,1:!0,2:!0,3:!0}},cullFace:{1:{0:!0}},frontFace:{1:{0:!0}},drawArraysInstancedANGLE:{4:{0:!0}},drawElementsInstancedANGLE:{5:{0:!0,2:!0}},blendEquationEXT:{1:{0:!0}}},i=null,s=null;function n(v){if(i==null)for(var w in i={},s={},v)typeof v[w]=="number"&&(i[v[w]]=w,s[w]=v[w])}function o(){if(i==null)throw"WebGLDebugUtils.init(ctx) not called"}function a(v){return o(),i[v]!==void 0}function l(v){o();var w=i[v];return w!==void 0?"gl."+w:"/*UNKNOWN WebGL ENUM*/ 0x"+v.toString(16)}function c(v,w,_,T){var x;if((x=r[v])!==void 0&&(x=x[w])!==void 0&&x[_]){if(typeof x[_]=="object"&&x[_].enumBitwiseOr!==void 0){for(var E=x[_].enumBitwiseOr,C=0,A=[],P=0;P<E.length;++P){var I=s[E[P]];(T&I)!=0&&(C|=I,A.push(l(I)))}return C===T?A.join(" | "):l(T)}return l(T)}return T===null?"null":T===void 0?"undefined":T.toString()}function h(v,w){for(var _="",T=w.length,x=0;x<T;++x)_+=(x==0?"":", ")+c(v,T,x,w[x]);return _}function p(v,w,_){v.__defineGetter__(_,function(){return w[_]}),v.__defineSetter__(_,function(T){w[_]=T})}function f(v,w,_,T){T=T||v,n(v),w=w||function(I,L,k){for(var G="",z=k.length,X=0;X<z;++X)G+=(X==0?"":", ")+c(L,z,X,k[X]);t("WebGL error "+l(I)+" in "+L+"("+G+")")};var x={};function E(I,L){return function(){_&&_(L,arguments);var k=I[L].apply(I,arguments),G=T.getError();return G!=0&&(x[G]=!0,w(G,L,arguments)),k}}var C={};for(var A in v)if(typeof v[A]=="function")if(A!="getExtension")C[A]=E(v,A);else{var P=E(v,A);C[A]=function(){return f(P.apply(v,arguments),w,_,T)}}else p(C,v,A);return C.getError=function(){for(var I in x)if(x.hasOwnProperty(I)&&x[I])return x[I]=!1,I;return v.NO_ERROR},C}function m(v){var w=v.getParameter(v.MAX_VERTEX_ATTRIBS),_=v.createBuffer();v.bindBuffer(v.ARRAY_BUFFER,_);for(var T=0;T<w;++T)v.disableVertexAttribArray(T),v.vertexAttribPointer(T,4,v.FLOAT,!1,0,0),v.vertexAttrib1f(T,0);v.deleteBuffer(_);var x=v.getParameter(v.MAX_TEXTURE_IMAGE_UNITS);for(T=0;T<x;++T)v.activeTexture(v.TEXTURE0+T),v.bindTexture(v.TEXTURE_CUBE_MAP,null),v.bindTexture(v.TEXTURE_2D,null);for(v.activeTexture(v.TEXTURE0),v.useProgram(null),v.bindBuffer(v.ARRAY_BUFFER,null),v.bindBuffer(v.ELEMENT_ARRAY_BUFFER,null),v.bindFramebuffer(v.FRAMEBUFFER,null),v.bindRenderbuffer(v.RENDERBUFFER,null),v.disable(v.BLEND),v.disable(v.CULL_FACE),v.disable(v.DEPTH_TEST),v.disable(v.DITHER),v.disable(v.SCISSOR_TEST),v.blendColor(0,0,0,0),v.blendEquation(v.FUNC_ADD),v.blendFunc(v.ONE,v.ZERO),v.clearColor(0,0,0,0),v.clearDepth(1),v.clearStencil(-1),v.colorMask(!0,!0,!0,!0),v.cullFace(v.BACK),v.depthFunc(v.LESS),v.depthMask(!0),v.depthRange(0,1),v.frontFace(v.CCW),v.hint(v.GENERATE_MIPMAP_HINT,v.DONT_CARE),v.lineWidth(1),v.pixelStorei(v.PACK_ALIGNMENT,4),v.pixelStorei(v.UNPACK_ALIGNMENT,4),v.pixelStorei(v.UNPACK_FLIP_Y_WEBGL,!1),v.pixelStorei(v.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),v.UNPACK_COLORSPACE_CONVERSION_WEBGL&&v.pixelStorei(v.UNPACK_COLORSPACE_CONVERSION_WEBGL,v.BROWSER_DEFAULT_WEBGL),v.polygonOffset(0,0),v.sampleCoverage(1,!1),v.scissor(0,0,v.canvas.width,v.canvas.height),v.stencilFunc(v.ALWAYS,0,4294967295),v.stencilMask(4294967295),v.stencilOp(v.KEEP,v.KEEP,v.KEEP),v.viewport(0,0,v.canvas.width,v.canvas.height),v.clear(v.COLOR_BUFFER_BIT|v.DEPTH_BUFFER_BIT|v.STENCIL_BUFFER_BIT);v.getError(););}function g(v){var w,_,T=[],x=[],E={},C=1,A=!1,P=[],I=0,L=0,k=!1,G=0,z={};function X(H){return typeof H=="function"?H:function(ee){H.handleEvent(ee)}}v.getContext=(_=v.getContext,function(){var H=_.apply(v,arguments);if(H instanceof WebGLRenderingContext){if(H!=w){if(w)throw"got different context";E=Y(w=H)}return E}return H});var Z=function(H){T.push(X(H))},ce=function(H){x.push(X(H))};function ne(H){var ee=H.addEventListener;H.addEventListener=function(me,be,De){switch(me){case"webglcontextlost":Z(be);break;case"webglcontextrestored":ce(be);break;default:ee.apply(H,arguments)}}}function D(){for(var H=Object.keys(z),ee=0;ee<H.length;++ee)delete z[H]}function N(){++L,A||I==L&&v.loseContext()}function V(H,ee){var me=H[ee];return function(){if(N(),!A)return me.apply(H,arguments)}}function B(){for(var H=0;H<P.length;++H){var ee=P[H];ee instanceof WebGLBuffer?w.deleteBuffer(ee):ee instanceof WebGLFramebuffer?w.deleteFramebuffer(ee):ee instanceof WebGLProgram?w.deleteProgram(ee):ee instanceof WebGLRenderbuffer?w.deleteRenderbuffer(ee):ee instanceof WebGLShader?w.deleteShader(ee):ee instanceof WebGLTexture&&w.deleteTexture(ee)}}function W(H){return{statusMessage:H,preventDefault:function(){k=!0}}}return ne(v),v.loseContext=function(){if(!A){for(A=!0,I=0,++C;w.getError(););D(),z[w.CONTEXT_LOST_WEBGL]=!0;var H=W("context lost"),ee=T.slice();setTimeout(function(){for(var me=0;me<ee.length;++me)ee[me](H);G>=0&&setTimeout(function(){v.restoreContext()},G)},0)}},v.restoreContext=function(){A&&x.length&&setTimeout(function(){if(!k)throw"can not restore. webglcontestlost listener did not call event.preventDefault";B(),m(w),A=!1,L=0,k=!1;for(var H=x.slice(),ee=W("context restored"),me=0;me<H.length;++me)H[me](ee)},0)},v.loseContextInNCalls=function(H){if(A)throw"You can not ask a lost contet to be lost";I=L+H},v.getNumCalls=function(){return L},v.setRestoreTimeout=function(H){G=H},v;function Y(H){for(var ee in H)typeof H[ee]=="function"?E[ee]=V(H,ee):p(E,H,ee);E.getError=function(){if(N(),!A)for(;Ee=w.getError();)z[Ee]=!0;for(var Ee in z)if(z[Ee])return delete z[Ee],Ee;return E.NO_ERROR};for(var me=["createBuffer","createFramebuffer","createProgram","createRenderbuffer","createShader","createTexture"],be=0;be<me.length;++be){var De=me[be];E[De]=function(Ee){return function(){if(N(),A)return null;var Fe=Ee.apply(H,arguments);return Fe.__webglDebugContextLostId__=C,P.push(Fe),Fe}}(H[De])}var ve=["getActiveAttrib","getActiveUniform","getBufferParameter","getContextAttributes","getAttachedShaders","getFramebufferAttachmentParameter","getParameter","getProgramParameter","getProgramInfoLog","getRenderbufferParameter","getShaderParameter","getShaderInfoLog","getShaderSource","getTexParameter","getUniform","getUniformLocation","getVertexAttrib"];for(be=0;be<ve.length;++be)De=ve[be],E[De]=function(Ee){return function(){return N(),A?null:Ee.apply(H,arguments)}}(E[De]);var ge=["isBuffer","isEnabled","isFramebuffer","isProgram","isRenderbuffer","isShader","isTexture"];for(be=0;be<ge.length;++be)De=ge[be],E[De]=function(Ee){return function(){return N(),!A&&Ee.apply(H,arguments)}}(E[De]);return E.checkFramebufferStatus=function(Ee){return function(){return N(),A?E.FRAMEBUFFER_UNSUPPORTED:Ee.apply(H,arguments)}}(E.checkFramebufferStatus),E.getAttribLocation=function(Ee){return function(){return N(),A?-1:Ee.apply(H,arguments)}}(E.getAttribLocation),E.getVertexAttribOffset=function(Ee){return function(){return N(),A?0:Ee.apply(H,arguments)}}(E.getVertexAttribOffset),E.isContextLost=function(){return A},E}}return{init:n,mightBeEnum:a,glEnumToString:l,glFunctionArgToString:c,glFunctionArgsToString:h,makeDebugContext:f,makeLostContextSimulatingCanvas:g,resetToInitialState:m}},(Xye=Wye())!==void 0&&(qye.exports=Xye);const fOt=fe.getLogger("esri.views.WebGLDriverTest");function mOt(e){const t=new Pi(e,{colorTarget:us.TEXTURE,depthStencilTarget:Pr.NONE},{target:mt.TEXTURE_2D,wrapMode:xt.CLAMP_TO_EDGE,pixelFormat:ze.RGBA,dataType:Ct.UNSIGNED_BYTE,samplingMode:et.NEAREST,width:1,height:1}),r=`
precision highp float;
attribute vec2 a_pos;
uniform highp sampler2D u_texture;
varying vec4 v_color;

float getBit(in float bitset, in int bitIndex) {
  float offset = pow(2.0, float(bitIndex));
  return mod(floor(bitset / offset), 2.0);
}

void main() {
  vec4 value = texture2D(u_texture, vec2(0.0));
  float bit = getBit(value.x * 255.0, 1);

  v_color = bit * vec4(1.0);
  gl_Position = vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);
}
`,i=`
precision highp float;
varying vec4 v_color;

void main() {
  gl_FragColor = v_color;
}
`,s=new Uint8Array(4),n=cr.createVertex(e,Cr.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),o=new rn(e,new Map([["a_position",0]]),{geometry:[new Io("a_position",2,pt.SHORT,0,4)]},{geometry:n}),a=e.programCache.acquire(r,i,new Map([["a_pos",0]]));e.useProgram(a);const l=new nt(e,{target:mt.TEXTURE_2D,wrapMode:xt.CLAMP_TO_EDGE,pixelFormat:ze.RGBA,dataType:Ct.UNSIGNED_BYTE,samplingMode:et.NEAREST,width:1,height:1},new Uint8Array([2,255,0,0]));a.setUniform1i("u_texture",0),e.bindTexture(l,0);const c=e.getBoundFramebufferObject();e.bindFramebuffer(t),e.useProgram(a);const{x:h,y:p,width:f,height:m}=e.getViewport();e.setViewport(0,0,1,1),e.bindVAO(o),e.drawArrays(Lt.TRIANGLE_STRIP,0,4),e.setViewport(h,p,f,m),t.readPixels(0,0,1,1,ze.RGBA,Ct.UNSIGNED_BYTE,s),a.dispose(),o.dispose(!1),n.dispose(),t.dispose();const g=s[0]!==255||s[1]!==255||s[2]!==255||s[3]!==255;return g&&fOt.warn(`A problem was detected with your graphics driver. Your driver does not appear to honor sampler precision specifiers, which may result in rendering issues due to numerical instability. We recommend ensuring that your drivers have been updated to the latest version. Applying lowp sampler workaround. [${s[0]}.${s[1]}.${s[2]}.${s[3]}]`),e.bindFramebuffer(c),g}new Io("a_pos",2,pt.BYTE,0,2);new Io("a_pos",2,pt.BYTE,0,4),new Io("a_tex",2,pt.BYTE,2,4);const gOt={geometry:[new Io("a_pos",2,pt.UNSIGNED_SHORT,0,4)]};async function yOt(e){const t=new Image;if(t.src="data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8'%3F%3E%3Csvg width='5' height='5' version='1.1' viewBox='0 0 5 5' xmlns='http://www.w3.org/2000/svg'%3E%3Crect width='5' height='5' fill='%23f00' fill-opacity='.5'/%3E%3C/svg%3E%0A",t.width=5,t.height=5,await t.decode(),!e.gl)return!0;const r=new Pi(e,{colorTarget:us.TEXTURE,depthStencilTarget:Pr.NONE},{target:mt.TEXTURE_2D,wrapMode:xt.CLAMP_TO_EDGE,pixelFormat:ze.RGBA,dataType:Ct.UNSIGNED_BYTE,samplingMode:et.NEAREST,width:1,height:1}),i=cr.createVertex(e,Cr.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),s=new rn(e,new Map([["a_pos",0]]),gOt,{geometry:i}),n=`
  precision highp float;

  attribute vec2 a_pos;
  varying vec2 v_uv;

  void main() {
    v_uv = a_pos;
    gl_Position = vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);
  }
  `,o=`
  precision highp float;

  varying vec2 v_uv;
  uniform sampler2D u_texture;

  void main() {
    gl_FragColor = texture2D(u_texture, v_uv);
  }
  `,a=e.programCache.acquire(n,o,new Map([["a_pos",0]]));e.useProgram(a);const l=new nt(e,{dataType:Ct.UNSIGNED_BYTE,pixelFormat:ze.RGBA,preMultiplyAlpha:!1,wrapMode:xt.CLAMP_TO_EDGE,samplingMode:et.LINEAR},t);e.bindTexture(l,0),a.setUniform1i("u_texture",0);const c=e.getBoundFramebufferObject(),{x:h,y:p,width:f,height:m}=e.getViewport();e.bindFramebuffer(r),e.setViewport(0,0,1,1),e.setClearColor(0,0,0,0),e.setBlendingEnabled(!1),e.clearSafe(ri.COLOR_BUFFER_BIT),e.bindVAO(s),e.drawArrays(Lt.TRIANGLE_STRIP,0,4);const g=new Uint8Array(4);return r.readPixels(0,0,1,1,ze.RGBA,Ct.UNSIGNED_BYTE,g),a.dispose(),s.dispose(!1),i.dispose(),r.dispose(),l.dispose(),e.setViewport(h,p,f,m),e.bindFramebuffer(c),t.src="",g[0]===255}class vOt{constructor(t){this.context=t,this._floatBufferBlendWorking=pOt(t),yOt(t).then(r=>this._svgAlwaysPremultipliesAlpha=!r)}get floatBufferBlendWorking(){if(R(this._floatBufferBlendWorking))throw new Error("floatBufferBlendWorking test not yet available");return this._floatBufferBlendWorking}get svgAlwaysPremultipliesAlpha(){if(R(this._svgAlwaysPremultipliesAlpha))throw new Error("svgAlwaysPremultipliesAlpha test not yet available");return this._svgAlwaysPremultipliesAlpha}get doublePrecisionRequiresObfuscation(){if(R(this._doublePrecisionRequiresObfuscation)){const t=Hye(this.context,!1),r=Hye(this.context,!0);this._doublePrecisionRequiresObfuscation=t!==0&&(r===0||t/r>5)}return this._doublePrecisionRequiresObfuscation}get ignoresSamplerPrecision(){return R(this._ignoresSamplerPrecision)&&(this._ignoresSamplerPrecision=mOt(this.context)),this._ignoresSamplerPrecision}}class Zye{constructor(t,r,i,s,n,o,a,l){this.createQuery=t,this.resultAvailable=r,this.getResult=i,this.disjoint=s,this.beginTimeElapsed=n,this.endTimeElapsed=o,this.createTimestamp=a,this.timestampBits=l}}function _Ot(e,t){if(t.disjointTimerQuery)return null;let r=e.getExtension("EXT_disjoint_timer_query_webgl2");return r&&eo(e)?new Zye(()=>e.createQuery(),i=>e.getQueryParameter(i,e.QUERY_RESULT_AVAILABLE),i=>e.getQueryParameter(i,e.QUERY_RESULT),()=>e.getParameter(r.GPU_DISJOINT_EXT),i=>e.beginQuery(r.TIME_ELAPSED_EXT,i),()=>e.endQuery(r.TIME_ELAPSED_EXT),i=>r.queryCounterEXT(i,r.TIMESTAMP_EXT),()=>e.getQuery(r.TIMESTAMP_EXT,r.QUERY_COUNTER_BITS_EXT)):(r=e.getExtension("EXT_disjoint_timer_query"),r?new Zye(()=>r.createQueryEXT(),i=>r.getQueryObjectEXT(i,r.QUERY_RESULT_AVAILABLE_EXT),i=>r.getQueryObjectEXT(i,r.QUERY_RESULT_EXT),()=>e.getParameter(r.GPU_DISJOINT_EXT),i=>r.beginQueryEXT(r.TIME_ELAPSED_EXT,i),()=>r.endQueryEXT(r.TIME_ELAPSED_EXT),i=>r.queryCounterEXT(i,r.TIMESTAMP_EXT),()=>r.getQueryEXT(r.TIMESTAMP_EXT,r.QUERY_COUNTER_BITS_EXT)):null)}function bOt(e,t){if(t.disjointTimerQuery)return null;if(eo(e))return{drawBuffers:e.drawBuffers.bind(e),MAX_DRAW_BUFFERS:e.MAX_DRAW_BUFFERS,MAX_COLOR_ATTACHMENTS:e.MAX_COLOR_ATTACHMENTS};if(t.drawBuffers)return null;const r=e.getExtension("WEBGL_draw_buffers");return r?{drawBuffers:r.drawBuffersWEBGL.bind(r),MAX_DRAW_BUFFERS:r.MAX_DRAW_BUFFERS_WEBGL,MAX_COLOR_ATTACHMENTS:r.MAX_COLOR_ATTACHMENTS_WEBGL}:null}function wOt(e){if(eo(e))return{drawArraysInstanced:e.drawArraysInstanced.bind(e),drawElementsInstanced:e.drawElementsInstanced.bind(e),vertexAttribDivisor:e.vertexAttribDivisor.bind(e)};const t=e.getExtension("ANGLE_instanced_arrays");return t?{drawArraysInstanced:t.drawArraysInstancedANGLE.bind(t),drawElementsInstanced:t.drawElementsInstancedANGLE.bind(t),vertexAttribDivisor:t.vertexAttribDivisorANGLE.bind(t)}:null}function xOt(e,t){if(t.compressedTextureETC)return null;const r=e.getExtension("WEBGL_compressed_texture_etc");return r?{COMPRESSED_R11_EAC:r.COMPRESSED_R11_EAC,COMPRESSED_SIGNED_R11_EAC:r.COMPRESSED_SIGNED_R11_EAC,COMPRESSED_RG11_EAC:r.COMPRESSED_RG11_EAC,COMPRESSED_SIGNED_RG11_EAC:r.COMPRESSED_SIGNED_RG11_EAC,COMPRESSED_RGB8_ETC2:r.COMPRESSED_RGB8_ETC2,COMPRESSED_SRGB8_ETC2:r.COMPRESSED_SRGB8_ETC2,COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:r.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2,COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:r.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2,COMPRESSED_RGBA8_ETC2_EAC:r.COMPRESSED_RGBA8_ETC2_EAC,COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:r.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC}:null}function TOt(e,t){if(t.compressedTextureS3TC)return null;const r=e.getExtension("WEBGL_compressed_texture_s3tc");return r?{COMPRESSED_RGB_S3TC_DXT1:r.COMPRESSED_RGB_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT1:r.COMPRESSED_RGBA_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT3:r.COMPRESSED_RGBA_S3TC_DXT3_EXT,COMPRESSED_RGBA_S3TC_DXT5:r.COMPRESSED_RGBA_S3TC_DXT5_EXT}:null}function SOt(e,t){if(eo(e))return{MIN:e.MIN,MAX:e.MAX};if(t.blendMinMax)return null;{const r=e.getExtension("EXT_blend_minmax");return r?{MIN:r.MIN_EXT,MAX:r.MAX_EXT}:null}}function EOt(e,t){if(t.textureFilterAnisotropic)return null;const r=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");return r?{MAX_TEXTURE_MAX_ANISOTROPY:r.MAX_TEXTURE_MAX_ANISOTROPY_EXT,TEXTURE_MAX_ANISOTROPY:r.TEXTURE_MAX_ANISOTROPY_EXT}:null}function COt(e,t){if(eo(e))return{textureFloat:!0,textureFloatLinear:!t.textureFloatLinear&&!!e.getExtension("OES_texture_float_linear"),textureHalfFloat:!0,textureHalfFloatLinear:!0,HALF_FLOAT:e.HALF_FLOAT,R16F:e.R16F,RG16F:e.RG16F,RGBA16F:e.RGBA16F,R32F:e.R32F,RG32F:e.RG32F,RGBA32F:e.RGBA32F,R11F_G11F_B10F:e.R11F_G11F_B10F,RGB16F:e.RGB16F};if(e instanceof WebGLRenderingContext){const r=!t.textureHalfFloat&&e.getExtension("OES_texture_half_float");return{textureFloat:!t.textureFloat&&!!e.getExtension("OES_texture_float"),textureFloatLinear:!t.textureFloatLinear&&!!e.getExtension("OES_texture_float_linear"),textureHalfFloat:!!r,textureHalfFloatLinear:!t.textureHalfFloatLinear&&!!e.getExtension("OES_texture_half_float_linear"),HALF_FLOAT:r?r.HALF_FLOAT_OES:void 0}}return null}function AOt(e,t){if(eo(e)){const r=!t.colorBufferHalfFloat&&e.getExtension("EXT_color_buffer_half_float")||!t.colorBufferFloat&&e.getExtension("EXT_color_buffer_float"),i=!t.colorBufferFloat&&e.getExtension("EXT_color_buffer_float"),s=!t.floatBlend&&!t.colorBufferFloat&&e.getExtension("EXT_float_blend");return r||i||s?{textureFloat:!!i,textureHalfFloat:!!r,floatBlend:!!s,R16F:e.R16F,RG16F:e.RG16F,RGBA16F:e.RGBA16F,R32F:e.R32F,RG32F:e.RG32F,RGBA32F:e.RGBA32F,R11F_G11F_B10F:e.R11F_G11F_B10F,RGB16F:e.RGB16F}:null}if(e instanceof WebGLRenderingContext){const r=!t.colorBufferHalfFloat&&e.getExtension("EXT_color_buffer_half_float"),i=!t.colorBufferFloat&&e.getExtension("WEBGL_color_buffer_float"),s=!t.floatBlend&&!t.colorBufferFloat&&e.getExtension("EXT_float_blend");return r||i||s?{textureFloat:!!i,textureHalfFloat:!!r,floatBlend:!!s,RGBA16F:r?r.RGBA16F_EXT:void 0,RGB16F:r?r.RGB16F_EXT:void 0,RGBA32F:i?i.RGBA32F_EXT:void 0}:null}return null}function eM(e,t,r,i,s){if(i&&eo(e))return!0;if(t[r])return!1;for(const n of s)if(e.getExtension(n))return!0;return!1}function ROt(e,t){if(!eo(e)||t.textureNorm16)return null;const r=e.getExtension("EXT_texture_norm16");return r?{R16:r.R16_EXT,RG16:r.RG16_EXT,RGB16:r.RGB16_EXT,RGBA16:r.RGBA16_EXT,R16_SNORM:r.R16_SNORM_EXT,RG16_SNORM:r.RG16_SNORM_EXT,RGB16_SNORM:r.RGB16_SNORM_EXT,RGBA16_SNORM:r.RGBA16_SNORM_EXT}:null}function OOt(e,t){const r=t.loseContext&&e.getExtension("WEBGL_lose_context");return r?{loseRenderingContext:()=>r.loseContext()}:null}function MOt(e,t){if(eo(e))return{createVertexArray:e.createVertexArray.bind(e),deleteVertexArray:e.deleteVertexArray.bind(e),bindVertexArray:e.bindVertexArray.bind(e)};if(t.vao)return null;const r=e.getExtension("OES_vertex_array_object")||e.getExtension("MOZ_OES_vertex_array_object")||e.getExtension("WEBKIT_OES_vertex_array_object");return r?{createVertexArray:r.createVertexArrayOES.bind(r),deleteVertexArray:r.deleteVertexArrayOES.bind(r),bindVertexArray:r.bindVertexArrayOES.bind(r)}:null}class POt{constructor(t,r){this.gl=t,this._depthTexture=null,this._standardDerivatives=null,this._shaderTextureLOD=null,this._fragDepth=null,this._textureFloatLinear=null,this._disabledExtensions=r.disabledExtensions||{},this._debugWebGLExtensions=r.debugWebGLExtensions||{}}get drawBuffers(){return this._drawBuffers||(this._drawBuffers=bOt(this.gl,this._disabledExtensions)),this._drawBuffers}get instancing(){return this._instancing||(this._instancing=wOt(this.gl)),this._instancing}get vao(){return this._vertexArrayObject||(this._vertexArrayObject=MOt(this.gl,this._disabledExtensions)),this._vertexArrayObject}get compressedTextureETC(){return this._compressedTextureETC||(this._compressedTextureETC=xOt(this.gl,this._disabledExtensions)),this._compressedTextureETC}get compressedTextureS3TC(){return this._compressedTextureS3TC||(this._compressedTextureS3TC=TOt(this.gl,this._disabledExtensions)),this._compressedTextureS3TC}get textureFilterAnisotropic(){return this._textureFilterAnisotropic||(this._textureFilterAnisotropic=EOt(this.gl,this._disabledExtensions)),this._textureFilterAnisotropic}get disjointTimerQuery(){return this._disjointTimerQuery||(this._disjointTimerQuery=_Ot(this.gl,this._disabledExtensions)),this._disjointTimerQuery}get textureFloat(){return this._textureFloat||(this._textureFloat=COt(this.gl,this._disabledExtensions)),this._textureFloat}get colorBufferFloat(){return this._colorBufferFloat||(this._colorBufferFloat=AOt(this.gl,this._disabledExtensions)),this._colorBufferFloat}get blendMinMax(){return this._minMaxBlending||(this._minMaxBlending=SOt(this.gl,this._disabledExtensions)),this._minMaxBlending}get depthTexture(){return this._depthTexture===null&&(this._depthTexture=eM(this.gl,this._disabledExtensions,"depthTexture",!0,["WEBGL_depth_texture","MOZ_WEBGL_depth_texture","WEBKIT_WEBGL_depth_texture"])),this._depthTexture}get standardDerivatives(){return this._standardDerivatives===null&&(this._standardDerivatives=eM(this.gl,this._disabledExtensions,"standardDerivatives",!0,["OES_standard_derivatives"])),this._standardDerivatives}get shaderTextureLOD(){return this._shaderTextureLOD===null&&(this._shaderTextureLOD=eM(this.gl,this._disabledExtensions,"shaderTextureLOD",!0,["EXT_shader_texture_lod"])),this._shaderTextureLOD}get fragDepth(){return this._fragDepth===null&&(this._fragDepth=eM(this.gl,this._disabledExtensions,"fragDepth",!0,["EXT_frag_depth"])),this._fragDepth}get loseContext(){return this._loseContext||(this._loseContext=OOt(this.gl,this._debugWebGLExtensions)),this._loseContext}get textureNorm16(){return this._textureNorm16||(this._textureNorm16=ROt(this.gl,this._disabledExtensions)),this._textureNorm16}get textureFloatLinear(){return this._textureFloatLinear===null&&(this._textureFloatLinear=eM(this.gl,this._disabledExtensions,"textureFloatLinear",!1,["OES_texture_float_linear"])),this._textureFloatLinear}enable(t){return this[t]}}class IOt{constructor(t,r){this.gl=t,this.instanceCounter=new BRt,this.programCache=new dOt(this),this._state=new $ye,this._numOfDrawCalls=0,this._numOfTriangles=0,this.type=eo(t)?mr.WEBGL2:mr.WEBGL1,this._loadExtensions(),this.configure(r)}configure(t){this._capabilities=new POt(this.gl,t),this._parameters=this._loadParameters(t);const r=this.gl.getParameter(this.gl.VIEWPORT);this._state=new $ye,this._state.viewport={x:r[0],y:r[1],width:r[2],height:r[3]},this._stateTracker=new Tnt({setBlending:i=>{if(i){this.setBlendingEnabled(!0),this.setBlendEquationSeparate(i.opRgb,i.opAlpha),this.setBlendFunctionSeparate(i.srcRgb,i.dstRgb,i.srcAlpha,i.dstAlpha);const s=i.color;this.setBlendColor(s.r,s.g,s.b,s.a)}else this.setBlendingEnabled(!1)},setCulling:i=>{i?(this.setFaceCullingEnabled(!0),this.setCullFace(i.face),this.setFrontFace(i.mode)):this.setFaceCullingEnabled(!1)},setPolygonOffset:i=>{i?(this.setPolygonOffsetFillEnabled(!0),this.setPolygonOffset(i.factor,i.units)):this.setPolygonOffsetFillEnabled(!1)},setDepthTest:i=>{i?(this.setDepthTestEnabled(!0),this.setDepthFunction(i.func)):this.setDepthTestEnabled(!1)},setStencilTest:i=>{if(i){this.setStencilTestEnabled(!0);const s=i.function;this.setStencilFunction(s.func,s.ref,s.mask);const n=i.operation;this.setStencilOp(n.fail,n.zFail,n.zPass)}else this.setStencilTestEnabled(!1)},setDepthWrite:i=>{i?(this.setDepthWriteEnabled(!0),this.setDepthRange(i.zNear,i.zFar)):this.setDepthWriteEnabled(!1)},setColorWrite:i=>{i?this.setColorMask(i.r,i.g,i.b,i.a):this.setColorMask(!1,!1,!1,!1)},setStencilWrite:i=>{i?this.setStencilWriteMask(i.mask):this.setStencilWriteMask(0)}}),this.enforceState(),this._driverTest=new vOt(this)}get driverTest(){return this._driverTest}get contextAttributes(){return this.gl.getContextAttributes()}get parameters(){return this._parameters}dispose(){this.programCache.dispose(),this.bindVAO(null),this.unbindBuffer(Tt.ARRAY_BUFFER),this.unbindBuffer(Tt.ELEMENT_ARRAY_BUFFER),eo(this.gl)&&(this.unbindBuffer(Tt.UNIFORM_BUFFER),this._state.uniformBufferBindingPoints.length=0,this.unbindBuffer(Tt.PIXEL_PACK_BUFFER),this.unbindBuffer(Tt.PIXEL_UNPACK_BUFFER),this.unbindBuffer(Tt.COPY_READ_BUFFER),this.unbindBuffer(Tt.COPY_WRITE_BUFFER)),this._state.textureUnitMap.length=0,ad()&&this.instanceCounter.printResourceCount()}setPipelineState(t){this._stateTracker.setPipeline(t)}setBlendingEnabled(t){this._state.blend!==t&&(t===!0?this.gl.enable(this.gl.BLEND):this.gl.disable(this.gl.BLEND),this._state.blend=t,this._stateTracker.invalidateBlending())}externalProgramUpdate(){var t;(t=this._state.program)==null||t.stop(),this._state.program=null}externalTextureUnitUpdate(t,r){for(let i=0;i<t.length;++i)this._state.textureUnitMap[t[i]]=null;r>=0&&(this._state.activeTexture=r)}externalVertexArrayObjectUpdate(){const t=this.capabilities.vao;t&&(t.bindVertexArray(null),this._state.vertexArrayObject=null),this._state.vertexBuffer=null,this._state.indexBuffer=null}externalVertexBufferUpdate(){this._state.vertexBuffer=null}externalIndexBufferUpdate(){this._state.indexBuffer=null}setBlendColor(t,r,i,s){t===this._state.blendColor.r&&r===this._state.blendColor.g&&i===this._state.blendColor.b&&s===this._state.blendColor.a||(this.gl.blendColor(t,r,i,s),this._state.blendColor.r=t,this._state.blendColor.g=r,this._state.blendColor.b=i,this._state.blendColor.a=s,this._stateTracker.invalidateBlending())}setBlendFunction(t,r){t===this._state.blendFunction.srcRGB&&r===this._state.blendFunction.dstRGB||(this.gl.blendFunc(t,r),this._state.blendFunction.srcRGB=t,this._state.blendFunction.srcAlpha=t,this._state.blendFunction.dstRGB=r,this._state.blendFunction.dstAlpha=r,this._stateTracker.invalidateBlending())}setBlendFunctionSeparate(t,r,i,s){this._state.blendFunction.srcRGB===t&&this._state.blendFunction.srcAlpha===i&&this._state.blendFunction.dstRGB===r&&this._state.blendFunction.dstAlpha===s||(this.gl.blendFuncSeparate(t,r,i,s),this._state.blendFunction.srcRGB=t,this._state.blendFunction.srcAlpha=i,this._state.blendFunction.dstRGB=r,this._state.blendFunction.dstAlpha=s,this._stateTracker.invalidateBlending())}setBlendEquation(t){this._state.blendEquation.mode!==t&&(this.gl.blendEquation(t),this._state.blendEquation.mode=t,this._state.blendEquation.modeAlpha=t,this._stateTracker.invalidateBlending())}setBlendEquationSeparate(t,r){this._state.blendEquation.mode===t&&this._state.blendEquation.modeAlpha===r||(this.gl.blendEquationSeparate(t,r),this._state.blendEquation.mode=t,this._state.blendEquation.modeAlpha=r,this._stateTracker.invalidateBlending())}setColorMask(t,r,i,s){this._state.colorMask.r===t&&this._state.colorMask.g===r&&this._state.colorMask.b===i&&this._state.colorMask.a===s||(this.gl.colorMask(t,r,i,s),this._state.colorMask.r=t,this._state.colorMask.g=r,this._state.colorMask.b=i,this._state.colorMask.a=s,this._stateTracker.invalidateColorWrite())}setClearColor(t,r,i,s){this._state.clearColor.r===t&&this._state.clearColor.g===r&&this._state.clearColor.b===i&&this._state.clearColor.a===s||(this.gl.clearColor(t,r,i,s),this._state.clearColor.r=t,this._state.clearColor.g=r,this._state.clearColor.b=i,this._state.clearColor.a=s)}setFaceCullingEnabled(t){this._state.faceCulling!==t&&(t===!0?this.gl.enable(this.gl.CULL_FACE):this.gl.disable(this.gl.CULL_FACE),this._state.faceCulling=t,this._stateTracker.invalidateCulling())}setPolygonOffsetFillEnabled(t){this._state.polygonOffsetFill!==t&&(t===!0?this.gl.enable(this.gl.POLYGON_OFFSET_FILL):this.gl.disable(this.gl.POLYGON_OFFSET_FILL),this._state.polygonOffsetFill=t,this._stateTracker.invalidatePolygonOffset())}setPolygonOffset(t,r){this._state.polygonOffset[0]===t&&this._state.polygonOffset[1]===r||(this._state.polygonOffset[0]=t,this._state.polygonOffset[1]=r,this.gl.polygonOffset(t,r),this._stateTracker.invalidatePolygonOffset())}setCullFace(t){this._state.cullFace!==t&&(this.gl.cullFace(t),this._state.cullFace=t,this._stateTracker.invalidateCulling())}setFrontFace(t){this._state.frontFace!==t&&(this.gl.frontFace(t),this._state.frontFace=t,this._stateTracker.invalidateCulling())}setScissorTestEnabled(t){this._state.scissorTest!==t&&(t===!0?this.gl.enable(this.gl.SCISSOR_TEST):this.gl.disable(this.gl.SCISSOR_TEST),this._state.scissorTest=t)}setScissorRect(t,r,i,s){this._state.scissorRect.x===t&&this._state.scissorRect.y===r&&this._state.scissorRect.width===i&&this._state.scissorRect.height===s||(this.gl.scissor(t,r,i,s),this._state.scissorRect.x=t,this._state.scissorRect.y=r,this._state.scissorRect.width=i,this._state.scissorRect.height=s)}setDepthTestEnabled(t){this._state.depthTest!==t&&(t===!0?this.gl.enable(this.gl.DEPTH_TEST):this.gl.disable(this.gl.DEPTH_TEST),this._state.depthTest=t,this._stateTracker.invalidateDepthTest())}setClearDepth(t){this._state.clearDepth!==t&&(this.gl.clearDepth(t),this._state.clearDepth=t)}setDepthFunction(t){this._state.depthFunction!==t&&(this.gl.depthFunc(t),this._state.depthFunction=t,this._stateTracker.invalidateDepthTest())}setDepthWriteEnabled(t){this._state.depthWrite!==t&&(this.gl.depthMask(t),this._state.depthWrite=t,this._stateTracker.invalidateDepthWrite())}setDepthRange(t,r){this._state.depthRange.zNear===t&&this._state.depthRange.zFar===r||(this.gl.depthRange(t,r),this._state.depthRange.zNear=t,this._state.depthRange.zFar=r,this._stateTracker.invalidateDepthWrite())}setStencilTestEnabled(t){this._state.stencilTest!==t&&(t===!0?this.gl.enable(this.gl.STENCIL_TEST):this.gl.disable(this.gl.STENCIL_TEST),this._state.stencilTest=t,this._stateTracker.invalidateStencilTest())}setClearStencil(t){t!==this._state.clearStencil&&(this.gl.clearStencil(t),this._state.clearStencil=t)}setStencilFunction(t,r,i){this._state.stencilFunction.func===t&&this._state.stencilFunction.ref===r&&this._state.stencilFunction.mask===i||(this.gl.stencilFunc(t,r,i),this._state.stencilFunction.face=af.FRONT_AND_BACK,this._state.stencilFunction.func=t,this._state.stencilFunction.ref=r,this._state.stencilFunction.mask=i,this._stateTracker.invalidateStencilTest())}setStencilFunctionSeparate(t,r,i,s){this._state.stencilFunction.face===t&&this._state.stencilFunction.func===r&&this._state.stencilFunction.ref===i&&this._state.stencilFunction.mask===s||(this.gl.stencilFuncSeparate(t,r,i,s),this._state.stencilFunction.face=t,this._state.stencilFunction.func=r,this._state.stencilFunction.ref=i,this._state.stencilFunction.mask=s,this._stateTracker.invalidateStencilTest())}setStencilWriteMask(t){this._state.stencilWriteMask!==t&&(this.gl.stencilMask(t),this._state.stencilWriteMask=t,this._stateTracker.invalidateStencilWrite())}setStencilOp(t,r,i){this._state.stencilOperation.face===af.FRONT_AND_BACK&&this._state.stencilOperation.fail===t&&this._state.stencilOperation.zFail===r&&this._state.stencilOperation.zPass===i||(this.gl.stencilOp(t,r,i),this._state.stencilOperation.face=af.FRONT_AND_BACK,this._state.stencilOperation.fail=t,this._state.stencilOperation.zFail=r,this._state.stencilOperation.zPass=i,this._stateTracker.invalidateStencilTest())}setStencilOpSeparate(t,r,i,s){this._state.stencilOperation.face===t&&this._state.stencilOperation.fail===r&&this._state.stencilOperation.zFail===i&&this._state.stencilOperation.zPass===s||(this.gl.stencilOpSeparate(t,r,i,s),this._state.stencilOperation.face=t,this._state.stencilOperation.fail=r,this._state.stencilOperation.zFail=i,this._state.stencilOperation.zPass=s,this._stateTracker.invalidateStencilTest())}setActiveTexture(t,r=!1){const i=this._state.activeTexture;return t>=0&&(r||t!==this._state.activeTexture)&&(this.gl.activeTexture(r7+t),this._state.activeTexture=t),i}clear(t){t&&this.gl.clear(t)}clearSafe(t,r=255){t&&(t&ri.COLOR_BUFFER_BIT&&this.setColorMask(!0,!0,!0,!0),t&ri.DEPTH_BUFFER_BIT&&this.setDepthWriteEnabled(!0),t&ri.STENCIL_BUFFER_BIT&&this.setStencilWriteMask(r),this.gl.clear(t))}drawArrays(t,r,i){if(ad()&&(this._numOfDrawCalls++,this._numOfTriangles+=Yye(t,i)),this.gl.drawArrays(t,r,i),ad()){const s=dde(this);s&&console.error("drawArrays:",s)}}drawElements(t,r,i,s){var n;if(ad()&&(this._numOfDrawCalls++,this._numOfTriangles+=Yye(t,r)),this.gl.drawElements(t,r,i,s),ad()){const o=dde(this);if(o){const a=this.getBoundVAO(),l=a==null?void 0:a.indexBuffer,c=a==null?void 0:a.vertexBuffers,h={indexBuffer:l,vertexBuffers:c},p={mode:t,count:r,type:i,offset:s},f=(n=mn(l,v=>v.size))!=null?n:0,m=s+r,g=f<m?`. Buffer is too small. Attempted to draw index ${m} of ${f}`:"";console.error(`drawElements: ${o}${g}`,{args:p,vao:h})}}}logInfo(){ad()&&console.log(`DrawCalls: ${this._numOfDrawCalls}, Triangles: ${this._numOfTriangles}`)}resetInfo(){ad()&&(this._numOfDrawCalls=0,this._numOfTriangles=0)}get capabilities(){return this._capabilities}setViewport(t,r,i,s){i=Math.max(Math.round(i),1),s=Math.max(Math.round(s),1);const n=this._state.viewport;n.x===t&&n.y===r&&n.width===i&&n.height===s||(n.x=t,n.y=r,n.width=i,n.height=s,this.gl.viewport(t,r,i,s))}getViewport(){return{x:this._state.viewport.x,y:this._state.viewport.y,width:this._state.viewport.width,height:this._state.viewport.height}}useProgram(t){var r,i;this._state.program!==t&&((r=this._state.program)==null||r.stop(),this._state.program=t,this.gl.useProgram((i=t==null?void 0:t.glName)!=null?i:null))}bindTexture(t,r,i=!1){(r>=this.parameters.maxTextureImageUnits||r<0)&&console.error("Input texture unit is out of range of available units!");const s=this._state.textureUnitMap[r];return R(t)||t.glName==null?(b(s)&&(this.setActiveTexture(r,i),this.gl.bindTexture(s.descriptor.target,null)),this._state.textureUnitMap[r]=null,s):i||s!==t?(this.setActiveTexture(r,i),this.gl.bindTexture(t.descriptor.target,t.glName),t.applyChanges(),this._state.textureUnitMap[r]=t,s):(t.isDirty&&(this.setActiveTexture(r,i),t.applyChanges()),s)}unbindTexture(t){if(!R(t))for(let r=0;r<this.parameters.maxTextureImageUnits;r++)this._state.textureUnitMap[r]===t&&(this.bindTexture(null,r),this._state.textureUnitMap[r]=null)}bindFramebuffer(t,r=!1){if(r||this._state.readFramebuffer!==t||this._state.drawFramebuffer!==t){if(R(t))return this.gl.bindFramebuffer(Qn.FRAMEBUFFER,null),this._state.readFramebuffer=null,void(this._state.drawFramebuffer=null);t.initializeAndBind(Qn.FRAMEBUFFER),this._state.readFramebuffer=t,this._state.drawFramebuffer=t}}bindFramebufferSeparate(t,r,i=!1){const s=r===Qn.READ_FRAMEBUFFER,n=s?this._state.readFramebuffer:this._state.drawFramebuffer;(i||n!==t)&&(R(t)?this.gl.bindFramebuffer(r,null):t.initializeAndBind(r),s?this._state.readFramebuffer=_t(t,null):this._state.drawFramebuffer=_t(t,null))}blitFramebuffer(t,r,i=0,s=0,n=t.width,o=t.height,a=0,l=0,c=r.width,h=r.height,p=ri.COLOR_BUFFER_BIT,f=et.NEAREST){this.bindFramebufferSeparate(t,Qn.READ_FRAMEBUFFER),this.bindFramebufferSeparate(r,Qn.DRAW_FRAMEBUFFER),this.gl.blitFramebuffer(i,s,n,o,a,l,c,h,p,f)}bindBuffer(t,r){if(t)switch(r!=null||(r=t.bufferType),r){case Tt.ARRAY_BUFFER:this._state.vertexBuffer=_c(this.gl,t,r,this._state.vertexBuffer);break;case Tt.ELEMENT_ARRAY_BUFFER:this._state.indexBuffer=_c(this.gl,t,r,this._state.indexBuffer);break;case Tt.UNIFORM_BUFFER:this._state.uniformBuffer=_c(this.gl,t,r,this._state.uniformBuffer);break;case Tt.PIXEL_PACK_BUFFER:this._state.pixelPackBuffer=_c(this.gl,t,r,this._state.pixelPackBuffer);break;case Tt.PIXEL_UNPACK_BUFFER:this._state.pixelUnpackBuffer=_c(this.gl,t,r,this._state.pixelUnpackBuffer);break;case Tt.COPY_READ_BUFFER:this._state.copyReadBuffer=_c(this.gl,t,r,this._state.copyReadBuffer);break;case Tt.COPY_WRITE_BUFFER:this._state.copyWriteBuffer=_c(this.gl,t,r,this._state.copyWriteBuffer)}}bindRenderbuffer(t){const r=this.gl;t||(r.bindRenderbuffer(r.RENDERBUFFER,null),this._state.renderbuffer=null),this._state.renderbuffer!==t&&(r.bindRenderbuffer(r.RENDERBUFFER,t.glName),this._state.renderbuffer=t)}_getBufferBinding(t,r){if(r>=this.parameters.maxUniformBufferBindings||r<0)return console.error("Uniform buffer binding point is out of range!"),null;const i=this._state.uniformBufferBindingPoints;let s=i[r];return R(s)&&(s={buffer:null,offset:0,size:0},i[r]=s),s}bindBufferBase(t,r,i){const s=this._getBufferBinding(t,r);R(s)||s.buffer===i&&s.offset===0&&s.size===0||(this.gl.bindBufferBase(t,r,i?i.glName:null),s.buffer=i,s.offset=0,s.size=0)}bindBufferRange(t,r,i,s,n){const o=this._getBufferBinding(t,r);if(!R(o)&&!(o.buffer===i&&o.offset===s&&o.size===n)){if(s%this._parameters.uniformBufferOffsetAlignment!=0)return void console.error("Uniform buffer binding offset is not a multiple of the context offset alignment");this.gl.bindBufferRange(t,r,i.glName,s,n),o.buffer=i,o.offset=s,o.size=n}}bindUBO(t,r,i,s){R(r)?this.bindBufferBase(Tt.UNIFORM_BUFFER,t,null):(ad()&&(s!=null?s:r.byteLength)>this._parameters.maxUniformBlockSize&&console.error("Attempting to bind more data than the maximum uniform block size"),r.initialize(),i!==void 0&&s!==void 0?this.bindBufferRange(Tt.UNIFORM_BUFFER,t,r.buffer,i,s):this.bindBufferBase(Tt.UNIFORM_BUFFER,t,r.buffer))}unbindUBO(t){for(let r=0,i=this._state.uniformBufferBindingPoints.length;r<i;r++){const s=this._state.uniformBufferBindingPoints[r];b(s)&&s.buffer===t.buffer&&this.bindBufferBase(Tt.UNIFORM_BUFFER,r,null)}}unbindBuffer(t){switch(t){case Tt.ARRAY_BUFFER:this._state.vertexBuffer=_c(this.gl,null,t,this._state.vertexBuffer);break;case Tt.ELEMENT_ARRAY_BUFFER:this._state.indexBuffer=_c(this.gl,null,t,this._state.indexBuffer);break;case Tt.UNIFORM_BUFFER:this._state.uniformBuffer=_c(this.gl,null,t,this._state.uniformBuffer);break;case Tt.PIXEL_PACK_BUFFER:this._state.pixelPackBuffer=_c(this.gl,null,t,this._state.pixelPackBuffer);break;case Tt.PIXEL_UNPACK_BUFFER:this._state.pixelUnpackBuffer=_c(this.gl,null,t,this._state.pixelUnpackBuffer);break;case Tt.COPY_READ_BUFFER:this._state.copyReadBuffer=_c(this.gl,null,t,this._state.copyReadBuffer);break;case Tt.COPY_WRITE_BUFFER:this._state.copyWriteBuffer=_c(this.gl,null,t,this._state.copyWriteBuffer)}}bindVAO(t=null){R(t)?this._state.vertexArrayObject&&(this._state.vertexArrayObject.unbind(),this._state.vertexArrayObject=null):this._state.vertexArrayObject!==t&&(t.bind(),this._state.vertexArrayObject=t)}async clientWaitAsync(t=10){const r=this.gl,i=r.fenceSync(nQ.SYNC_GPU_COMMANDS_COMPLETE,0);let s;this.instanceCounter.increment(Nn.Sync,i),r.flush();do await BC(t),s=r.clientWaitSync(i,0,0);while(s===SV.TIMEOUT_EXPIRED);if(this.instanceCounter.decrement(Nn.Sync,i),r.deleteSync(i),s===SV.WAIT_FAILED)throw new Error("Client wait failed")}getBoundFramebufferObject(t=Qn.FRAMEBUFFER){return t===Qn.READ_FRAMEBUFFER?this._state.readFramebuffer:this._state.drawFramebuffer}getBoundVAO(){return this._state.vertexArrayObject}resetState(){this.useProgram(null),this.bindVAO(null),this.bindFramebuffer(null,!0),this.unbindBuffer(Tt.ARRAY_BUFFER),this.unbindBuffer(Tt.ELEMENT_ARRAY_BUFFER),eo(this.gl)&&(this.unbindBuffer(Tt.UNIFORM_BUFFER),this._state.uniformBufferBindingPoints.length=0,this.unbindBuffer(Tt.PIXEL_PACK_BUFFER),this.unbindBuffer(Tt.PIXEL_UNPACK_BUFFER),this.unbindBuffer(Tt.COPY_READ_BUFFER),this.unbindBuffer(Tt.COPY_WRITE_BUFFER));for(let t=0;t<this.parameters.maxTextureImageUnits;++t)this.bindTexture(null,t);this.setBlendingEnabled(!1),this.setBlendFunction(Ae.ONE,Ae.ZERO),this.setBlendEquation(y0.ADD),this.setBlendColor(0,0,0,0),this.setFaceCullingEnabled(!1),this.setCullFace(af.BACK),this.setFrontFace(SA.CCW),this.setPolygonOffsetFillEnabled(!1),this.setPolygonOffset(0,0),this.setScissorTestEnabled(!1),this.setScissorRect(0,0,this.gl.canvas.width,this.gl.canvas.height),this.setDepthTestEnabled(!1),this.setDepthFunction(_i.LESS),this.setDepthRange(0,1),this.setStencilTestEnabled(!1),this.setStencilFunction(_i.ALWAYS,0,0),this.setStencilOp(hs.KEEP,hs.KEEP,hs.KEEP),this.setClearColor(0,0,0,0),this.setClearDepth(1),this.setClearStencil(0),this.setColorMask(!0,!0,!0,!0),this.setStencilWriteMask(4294967295),this.setDepthWriteEnabled(!0),this.setViewport(0,0,this.gl.canvas.width,this.gl.canvas.height)}enforceState(){var i,s,n,o,a,l;const t=this.gl,r=this.capabilities.vao;r&&r.bindVertexArray(null);for(let c=0;c<this.parameters.maxVertexAttributes;c++)t.disableVertexAttribArray(c);if(this._state.vertexBuffer?t.bindBuffer(this._state.vertexBuffer.bufferType,this._state.vertexBuffer.glName):t.bindBuffer(Tt.ARRAY_BUFFER,null),this._state.indexBuffer?t.bindBuffer(this._state.indexBuffer.bufferType,this._state.indexBuffer.glName):t.bindBuffer(Tt.ELEMENT_ARRAY_BUFFER,null),eo(t)){this._state.uniformBuffer?t.bindBuffer(this._state.uniformBuffer.bufferType,this._state.uniformBuffer.glName):t.bindBuffer(Tt.UNIFORM_BUFFER,null);for(let c=0;c<this._parameters.maxUniformBufferBindings;c++){const h=this._state.uniformBufferBindingPoints[c];if(b(h)){const{buffer:p,offset:f,size:m}=h;p!==null?f===0&&m===0?t.bindBufferBase(Tt.UNIFORM_BUFFER,c,p.glName):t.bindBufferRange(Tt.UNIFORM_BUFFER,c,p.glName,f,m):t.bindBufferBase(Tt.UNIFORM_BUFFER,c,null)}}this._state.pixelPackBuffer?t.bindBuffer(this._state.pixelPackBuffer.bufferType,this._state.pixelPackBuffer.glName):t.bindBuffer(Tt.PIXEL_PACK_BUFFER,null),this._state.pixelUnpackBuffer?t.bindBuffer(this._state.pixelUnpackBuffer.bufferType,this._state.pixelUnpackBuffer.glName):t.bindBuffer(Tt.PIXEL_UNPACK_BUFFER,null),this._state.copyReadBuffer?t.bindBuffer(this._state.copyReadBuffer.bufferType,this._state.copyReadBuffer.glName):t.bindBuffer(Tt.COPY_READ_BUFFER,null),this._state.copyWriteBuffer?t.bindBuffer(this._state.copyWriteBuffer.bufferType,this._state.copyWriteBuffer.glName):t.bindBuffer(Tt.COPY_WRITE_BUFFER,null),t.bindFramebuffer(Qn.READ_FRAMEBUFFER,null),t.readBuffer(t.BACK),this._state.readFramebuffer&&(t.bindFramebuffer(Qn.READ_FRAMEBUFFER,this._state.readFramebuffer.glName),t.readBuffer(Uu.COLOR_ATTACHMENT0)),t.bindFramebuffer(Qn.DRAW_FRAMEBUFFER,(s=(i=this._state.drawFramebuffer)==null?void 0:i.glName)!=null?s:null)}else this._state.readFramebuffer=this._state.drawFramebuffer,t.bindFramebuffer(Qn.FRAMEBUFFER,(o=(n=this._state.drawFramebuffer)==null?void 0:n.glName)!=null?o:null);if(r&&this._state.vertexArrayObject){const c=this._state.vertexArrayObject;this._state.vertexArrayObject&&(this._state.vertexArrayObject.unbind(),this._state.vertexArrayObject=null),this.bindVAO(c)}t.useProgram((l=(a=this._state.program)==null?void 0:a.glName)!=null?l:null),t.blendColor(this._state.blendColor.r,this._state.blendColor.g,this._state.blendColor.b,this._state.blendColor.a),t.bindRenderbuffer(t.RENDERBUFFER,this._state.renderbuffer?this._state.renderbuffer.glName:null),this._state.blend===!0?t.enable(this.gl.BLEND):t.disable(this.gl.BLEND),t.blendEquationSeparate(this._state.blendEquation.mode,this._state.blendEquation.modeAlpha),t.blendFuncSeparate(this._state.blendFunction.srcRGB,this._state.blendFunction.dstRGB,this._state.blendFunction.srcAlpha,this._state.blendFunction.dstAlpha),t.clearColor(this._state.clearColor.r,this._state.clearColor.g,this._state.clearColor.b,this._state.clearColor.a),t.clearDepth(this._state.clearDepth),t.clearStencil(this._state.clearStencil),t.colorMask(this._state.colorMask.r,this._state.colorMask.g,this._state.colorMask.b,this._state.colorMask.a),t.cullFace(this._state.cullFace),t.depthFunc(this._state.depthFunction),t.depthRange(this._state.depthRange.zNear,this._state.depthRange.zFar),this._state.depthTest===!0?t.enable(t.DEPTH_TEST):t.disable(t.DEPTH_TEST),t.depthMask(this._state.depthWrite),t.frontFace(this._state.frontFace),t.lineWidth(1),this._state.faceCulling===!0?t.enable(t.CULL_FACE):t.disable(t.CULL_FACE),t.polygonOffset(this._state.polygonOffset[0],this._state.polygonOffset[1]),this._state.polygonOffsetFill===!0?t.enable(t.POLYGON_OFFSET_FILL):t.disable(t.POLYGON_OFFSET_FILL),t.scissor(this._state.scissorRect.x,this._state.scissorRect.y,this._state.scissorRect.width,this._state.scissorRect.height),this._state.scissorTest===!0?t.enable(t.SCISSOR_TEST):t.disable(t.SCISSOR_TEST),t.stencilFunc(this._state.stencilFunction.func,this._state.stencilFunction.ref,this._state.stencilFunction.mask),t.stencilOpSeparate(this._state.stencilOperation.face,this._state.stencilOperation.fail,this._state.stencilOperation.zFail,this._state.stencilOperation.zPass),this._state.stencilTest===!0?t.enable(t.STENCIL_TEST):t.disable(t.STENCIL_TEST),t.stencilMask(this._state.stencilWriteMask);for(let c=0;c<this.parameters.maxTextureImageUnits;c++){t.activeTexture(r7+c),t.bindTexture(mt.TEXTURE_2D,null),t.bindTexture(mt.TEXTURE_CUBE_MAP,null),eo(t)&&(t.bindTexture(mt.TEXTURE_3D,null),t.bindTexture(mt.TEXTURE_2D_ARRAY,null));const h=this._state.textureUnitMap[c];b(h)&&t.bindTexture(h.descriptor.target,h.glName)}t.activeTexture(r7+this._state.activeTexture),t.viewport(this._state.viewport.x,this._state.viewport.y,this._state.viewport.width,this._state.viewport.height),this.resetInfo()}_loadExtensions(){this.type===mr.WEBGL1&&this.gl.getExtension("OES_element_index_uint"),this.gl.getExtension("KHR_parallel_shader_compile")}_loadParameters(t){var a;const r=this.capabilities.textureFilterAnisotropic,i=(a=t.maxAnisotropy)!=null?a:1/0,s=eo(this.gl),n=this.gl,o={versionString:this.gl.getParameter(this.gl.VERSION),maxVertexTextureImageUnits:this.gl.getParameter(this.gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS),maxVertexAttributes:this.gl.getParameter(this.gl.MAX_VERTEX_ATTRIBS),maxMaxAnisotropy:r?Math.min(this.gl.getParameter(r.MAX_TEXTURE_MAX_ANISOTROPY),i):1,maxTextureImageUnits:this.gl.getParameter(this.gl.MAX_TEXTURE_IMAGE_UNITS),maxTextureSize:this.gl.getParameter(this.gl.MAX_TEXTURE_SIZE),maxUniformBufferBindings:s?n.getParameter(n.MAX_UNIFORM_BUFFER_BINDINGS):0,maxVertexUniformBlocks:s?n.getParameter(n.MAX_VERTEX_UNIFORM_BLOCKS):0,maxFragmentUniformBlocks:s?n.getParameter(n.MAX_FRAGMENT_UNIFORM_BLOCKS):0,maxUniformBlockSize:s?n.getParameter(n.MAX_UNIFORM_BLOCK_SIZE):0,uniformBufferOffsetAlignment:s?n.getParameter(n.UNIFORM_BUFFER_OFFSET_ALIGNMENT):1,maxArrayTextureLayers:s?n.getParameter(n.MAX_ARRAY_TEXTURE_LAYERS):1,maxSamples:s?n.getParameter(n.MAX_SAMPLES):1};return nt.TEXTURE_UNIT_FOR_UPDATES=o.maxTextureImageUnits-1,o}}function _c(e,t,r,i){return t?i!==t&&e.bindBuffer(r,t.glName):e.bindBuffer(r,null),t}function Yye(e,t){switch(e){case Lt.POINTS:return 2*t;case Lt.TRIANGLES:return t/3;case Lt.TRIANGLE_STRIP:case Lt.TRIANGLE_FAN:return t-2;default:return 0}}class $Ot extends IOt{constructor(t,r,i){super(t,r),this.newCache=i,this._refCount=1}dispose(){--this._refCount>0||super.dispose()}ref(){++this._refCount}bindTechnique(t,r,i,s){this.useProgram(t.program);const n=b(i)?i.slot:null;return t.bindPipelineState(this,n,s),b(r)&&b(i)&&t.bindPass(r,i),t.program}get test(){return this.programCache.test}}const BLe=fe.getLogger("esri.views.3d.webgl-engine.lib.TextureRepository");let iE=class extends xe{constructor(e,t,r){super({}),this._stage=e,this._techniqueRepository=t,this._rctx=r,this._textures=new Map,this._loadingCount=0,this._frameUpdates=new Map,this.events=new ds,this._frameTask=e.resourceController.scheduler.registerTask(vt.TEXTURE_UNLOAD)}normalizeCtorArgs(){return{}}dispose(){this._frameTask.remove(),this._stage.forEachOfType(Cf.Texture,e=>e.unload())}get updating(){return this._loadingCount>0||this._frameTask.updating}get textureTechnique(){return R(this._textureTechnique)&&(this._textureTechnique=this._techniqueRepository.acquire($L,new Ase)),this._textureTechnique}acquire(e){const t=this._textures.get(e);return t?(t.ref(),_t(t.loadingPromise,t)):this._createNewRef(e)}update(){let e=!1;this._frameUpdates.forEach(t=>{const r=t.texture.frameUpdate(this._rctx,this.textureTechnique,t.previousToken);r>=0&&r!==t.previousToken&&(t.previousToken=r,e=!0)}),e&&this.events.emit("changed",Ws.BACKGROUND)}_createNewRef(e){const t=this._stage.getObject(e);if(R(t))return ft(t!==void 0),null;const r=t.events.on("unloaded",()=>{r.remove(),this._onTextureUnloaded(e)}),i=new LOt(e,()=>{this._frameTask.schedule(()=>{i.isUnreferenced&&t.unload()})});return this._textures.set(e,i),i.ref(),b(t.glTexture)?(this._updateGLTexture(i,t.glTexture),t.requiresFrameUpdates&&this._frameUpdates.set(e,{texture:t,previousToken:-1}),i):(this._loadingCount++,i.loadingPromise=this._stage.schedule(()=>{const s=t.load(this._rctx,()=>this.textureTechnique),n=a=>(this._loadingCount--,i.loadingPromise=null,this._updateGLTexture(i,a),t.requiresFrameUpdates&&this._frameUpdates.set(e,{texture:t,previousToken:-1}),i),o=a=>(this._loadingCount--,i.loadingPromise=null,Vi(a)||BLe.error(a),null);return Ch(s)?s.then(n,o):n(s)}),i.loadingPromise)}_updateGLTexture(e,t){e.glTexture=t,this.events.emit("changed",Ws.UPDATE)}_onTextureUnloaded(e){this._textures.delete(e),this._frameUpdates.delete(e)}};u([d()],iE.prototype,"_loadingCount",void 0),u([d()],iE.prototype,"_frameTask",void 0),u([d()],iE.prototype,"updating",null),iE=u([$("esri.views.3d.webgl-engine.lib.TextureRepository")],iE);class LOt{constructor(t,r){this.id=t,this._release=r,this._refCount=0}get isUnreferenced(){return this._refCount===0}ref(){++this._refCount}release(){--this._refCount,this._refCount>0||(this._refCount!==0?(BLe.error("Cannot dereference texture that has no references!"),this._refCount=0):this._release())}}const DOt=fe.getLogger("esri.views.3d.webgl-engine.materials.internal.waterMaterialUtils");let E3=class extends xe{constructor(){super(...arguments),this._data=new Array,this._state=Nc.NOT_LOADED}dispose(){this._state=Nc.NOT_LOADED,this._data.forEach(e=>e.dispose()),this._data.length=0}get updating(){return this._state===Nc.LOADING}get resourceState(){return this._state}loadTextures(e){const t=[wr("esri/images/materials/water/normals.jpg"),wr("esri/images/materials/water/perturbation.jpg")];this._state=Nc.LOADING,Promise.all(t.map(r=>Sf(r))).then(r=>{r.forEach(i=>this._data.push(new nt(e,{target:mt.TEXTURE_2D,pixelFormat:ze.RGBA,dataType:Ct.UNSIGNED_BYTE,wrapMode:xt.REPEAT,samplingMode:et.LINEAR_MIPMAP_LINEAR,hasMipmap:!0,maxAnisotropy:8,width:i.width,height:i.height},i))),this._state=Nc.LOADED}).catch(r=>{DOt.error("Failed to load textures for water material.",r),this._state=Nc.NOT_LOADED})}bind(e){this._state===Nc.LOADED&&(e.bindTexture("texWaveNormal",this._data[0]),e.bindTexture("texWavePerturbation",this._data[1]))}};u([d()],E3.prototype,"_state",void 0),u([d({type:Boolean,readOnly:!0})],E3.prototype,"updating",null),E3=u([$("esri.views.3d.webgl-engine.materials.internal.WaterTextureRepository")],E3);class NOt extends HB{constructor(t,r,i,s,n,o){super(),this._rctx=t,this._renderScene=r,this._requestRenderScene=i,this._renderOverlay=s,this._forceCameraHook=n,this._disposeOffscreenBuffers=o,this.supersample=!0,this._screenshotQueue=new Array}dispose(){this._rctx=null}takeScreenshot(t){this._requestRenderScene(Ws.BACKGROUND);const r=vf();return this._screenshotQueue.push({settings:t,resolver:r}),r.promise}update(t){for(const r of this._screenshotQueue){if(this.isDisposed){r.resolver.reject();continue}const i={...r.settings,pixelRatio:r.settings.pixelRatio*t.viewCamera.pixelRatio},s=this._renderScreenshot(t,i);r.resolver(s)}this._screenshotQueue.length=0}_renderScreenshotOverlay(t,r,i){if(R(this._renderOverlay))return r;t.width=r.width,t.height=r.height;const s=t.getContext("2d"),n=i.pixelRatio;return s.save(),s.translate(0,r.height),s.scale(1,-1),i.region&&s.translate(-i.region.x,-i.region.y),s.scale(n,n),r=this._renderOverlay(t,r),s.restore(),r}_readbackScreenshot(t,r){return t.resample?this._readbackScreenshotResampled(t,r):this._readbackScreenshotImmediate(t,r)}_readbackScreenshotResampled(t,r){const{framebufferWidth:i,framebufferHeight:s,region:n,resample:o}=t,a=this._ensureScreenshotEncodeCanvas();let l=fj(i,s,a);this._rctx.gl.readPixels(0,0,i,s,ze.RGBA,pt.UNSIGNED_BYTE,new Uint8Array(l.data.buffer)),r(),l=this._renderScreenshotOverlay(a,l,{...t,region:null});const c=fj(n.width,n.height,a);return U0t(l,c,!0,o.region.x,s-(o.region.y+o.region.height),o.region.width,o.region.height)}_readbackScreenshotImmediate(t,r){const{framebufferHeight:i,region:s}=t,n=this._ensureScreenshotEncodeCanvas(),o=fj(s.width,s.height,n);return this._rctx.gl.readPixels(s.x,i-(s.y+s.height),s.width,s.height,ze.RGBA,pt.UNSIGNED_BYTE,new Uint8Array(o.data.buffer)),r(),this._renderScreenshotOverlay(n,o,t)}_renderScreenshot(t,r){let i=null;const s=t.viewCamera,{framebufferWidth:n,framebufferHeight:o}=r;let a=!1;const l=r.disableDecorations&&t.frameHasDecorations,c=n!==s.fullWidth||o!==s.fullHeight,h=r.ignorePadding&&s.pixelRatio!==r.pixelRatio,p=c||l||h;if(p){const g=s.clone();if(r.ignorePadding){const _=E6(g.padding);for(let T=0;T<4;T++)_[T]=Math.round(_[T]/g.pixelRatio*r.pixelRatio);g.padding=_}g.fullWidth=n,g.fullHeight=o,g.pixelRatio=r.pixelRatio;const v=s.fovX-g.fovX,w=s.fovY-g.fovY;v<0&&v<w?g.fovX=s.fovX:w<0&&w<v&&(g.fovY=s.fovY),this._forceCameraHook(g),a=!0,i=new Pi(this._rctx,{width:g.fullWidth,height:g.fullHeight,colorTarget:us.TEXTURE,depthStencilTarget:Pr.DEPTH_STENCIL_RENDER_BUFFER}),this._renderScene(i,g,r.disableDecorations?_T.OFF:_T.ON),this._disposeOffscreenBuffers()}const f=()=>{this._rctx.bindFramebuffer(null),Ye(i)},m=this._readbackScreenshot(r,f);if(f(),p&&!this._rctx.contextAttributes.alpha)for(let g=3;g<m.data.length;g+=4)m.data[g]=255;return a&&this._forceCameraHook(s),m}_ensureScreenshotEncodeCanvas(){return this._screenshotEncodeCanvas||(this._screenshotEncodeCanvas=document.createElement("canvas")),this._screenshotEncodeCanvas}}const Qye=fe.getLogger("esri.views.3d.webgl-engine.parts.View");let qo=class extends jB(xe){constructor(e){super({}),this.events=new ds,this.waterTextureRepository=new E3,this._magnifierHelper=new rE,this._needsUpdate=!0,this._needsRender=!0,this._idleSuspend=!0,this._needsWaterReflectionUpdate=!1,this._lastAnimationUpdate=0,this._container=e.container,this._viewingMode=e.viewingMode,this._initializeContext(e),te(()=>{var t;return(t=this.waterTextureRepository)==null?void 0:t.updating},()=>this.requestRender(),Rt),this._magnifierHelper.events.on("request-render",()=>this.requestRender()),this._stippleTextureRepository=new qPe(this._rctx),this._shaderTechniqueRepository=new mPe({rctx:this._rctx,viewingMode:e.viewingMode,stippleTextureRepository:this._stippleTextureRepository,waterTextureRepository:this.waterTextureRepository}),this._textureRepository=new iE(e,this._shaderTechniqueRepository,this._rctx),this._textureRepository.events.on("changed",t=>this.requestRender(t)),this._materialRepository=new gPe(this._textureRepository,this._shaderTechniqueRepository,()=>this.requestRender(),()=>this.requestRender()),this._compositingHelper=new ZCt(this._rctx,this._shaderTechniqueRepository),this._renderer=new dy(this._materialRepository,this._textureRepository,this._shaderTechniqueRepository,this._rctx,this._compositingHelper,this._magnifierHelper,t=>this.requestRender(t),(t,r)=>e.schedule(t,r),e),this._screenshotManager=new NOt(this._rctx,(t,r,i)=>this._renderer.render(t,r,r,i),t=>this.requestRender(t),e.options.screenshot.renderOverlay,t=>this.events.emit("force-camera-for-screenshot",t),()=>this._renderer.disposeOffscreenBuffers()),this._registerFrameTask(e)}normalizeCtorArgs(){return{}}dispose(){this._container.contains(this._canvas)&&this._container.removeChild(this._canvas),this._frameTask=wn(this._frameTask),this._shaderTechniqueRepository=Ye(this._shaderTechniqueRepository),super.dispose(),this._tmpDepthBuffer=null,this._rctx=null}get performanceInfo(){const e=this._rctx.gl;return{renderer:this._renderer.performanceInfo,textureMemory:e.getUsedTextureMemory!==void 0?e.getUsedTextureMemory():void 0,renderbufferMemory:e.getUsedRenderbufferMemory!==void 0?e.getUsedRenderbufferMemory():void 0,VBOMemory:e.getUsedVBOMemory!==void 0?e.getUsedVBOMemory():void 0}}requestRender(e=Ws.UPDATE){e===Ws.UPDATE?this._needsUpdate=!0:this._needsRender=!0}get updating(){return this._needsUpdate||this._needsWaterReflectionUpdate||this._renderer.updating||this._textureRepository.updating||this.waterTextureRepository.updating||this._magnifierHelper.updating}ensureEdgeView(){return this._renderer.ensureEdgeView()}get edgeView(){return this._renderer.edgeView}get textureRepository(){return this._textureRepository}get compositingHelper(){return this._compositingHelper}set magnifier(e){this._magnifierHelper.magnifier=e}updateLightSources(e,t,r){this._renderer.updateLightSources(e,t,r),this.requestRender()}setRenderParameters(e){e.idleSuspend!==void 0&&this._idleSuspend!==!!e.idleSuspend&&(this._idleSuspend=!!e.idleSuspend,this.requestRender()),this._renderer.setRenderParameters(e)}get renderingContext(){return this._rctx}get capabilities(){return this._rctx.capabilities}modify(e){this._renderer.modify(e),e.clear()}get canvas(){return this._canvas}takeScreenshot(e){return this._screenshotManager.takeScreenshot(e)}getAlpha(){return this._rctx.contextAttributes.alpha}get shadowsEnabled(){return this._renderer.shadowsEnabled}readAccumulatedShadow(e){return this._renderer.readAccumulatedShadow(e[0],e[1])}readHUDVisibility(e,t,r,i,s){this._renderer.readHUDVisibility(e,t,r,i,s)}getMinimalDepthForArea(e,t,r,i,s,n=s){const o=i.constrainWindowSize(t,r,s*i.pixelRatio,n*i.pixelRatio),a=this._ensureDepthBuffer(o);this._renderer.readDepthPixels(i,o,a);let l=Number.MAX_VALUE;for(let c=0;c<o[2]*o[3];c++){const h=eAt(4*c,a,i.nearFar);l>h&&h!==i.nearFar[0]&&h!==i.nearFar[1]&&(l=h)}if(b(e)){const c=e.pickDepth(t*i.pixelRatio,r*i.pixelRatio,i);b(c)&&l>c&&c!==i.nearFar[0]&&c!==i.nearFar[1]&&(l=c)}return l===Number.MAX_VALUE?void 0:l}_ensureDepthBuffer(e){const t=4*e[2]*e[3];return(R(this._tmpDepthBuffer)||this._tmpDepthBuffer.byteLength<t)&&(this._tmpDepthBuffer=new Uint8Array(t)),this._tmpDepthBuffer}get renderPlugins(){return this._renderer.renderPlugins}get test(){return{renderer:this._renderer}}get gpuMemoryUsage(){return this._renderer.gpuMemoryUsage}async reloadShaders(){w$e(),await this._shaderTechniqueRepository.reloadAll(),this.requestRender()}get animationTimestep(){return this._renderer.animationTimestep}_registerFrameTask(e){const t=e.state,r={viewCamera:t.camera,frameHasDecorations:!1};let i=!1,s=Ws.BACKGROUND,n=!1;const o={preRender:a=>{i=this.updating,s=this._needsUpdate?Ws.UPDATE:Ws.BACKGROUND,e.processSyncLayers();const l=a.time-this._lastAnimationUpdate;(l>this.animationTimestep||b(this.forcedAnimationTime)||i||this._needsRender)&&(this._renderer.updateAnimation({camera:t.camera,dt:l,forcedTime:this.forcedAnimationTime})&&this.requestRender(Ws.BACKGROUND),this._lastAnimationUpdate=a.time)},render:()=>{if((this._needsUpdate||this._needsRender||!this._idleSuspend||!this._renderer.isCameraFinal||this._needsWaterReflectionUpdate)&&t.camera.fullWidth>0&&t.camera.fullHeight>0){const a=this._needsUpdate&&this._idleSuspend&&this._renderer.isCameraFinal;this._needsRender=!1,this._needsUpdate=!1,this._needsWaterReflectionUpdate=!1,this._renderer.render(null,t.camera,t.contentCamera,_T.ON),n=!0,a&&this._renderer.hasWaterReflection&&(this.requestRender(Ws.BACKGROUND),this._needsWaterReflectionUpdate=!0)}},update:()=>{r.viewCamera=t.camera,r.frameHasDecorations=this._renderer.hasSlicePlane||this._magnifierHelper.enabled,this._textureRepository.update(),this._screenshotManager.update(r)},finish:()=>{n&&(this._renderer.finish(s),n=!1)}};this._frameTask=rT(o)}_initializeContext(e){var s;const t=e.options;this._canvas=t.canvas,this._canvas||(this._canvas=document.createElement("canvas")),this._canvas.setAttribute("style","width: 100%; height:100%; display:block;");const r={alpha:t.alpha||!1,premultipliedAlpha:!0,antialias:!1,depth:!0,stencil:t.stencil==null||t.stencil,powerPreference:"high-performance",preserveDrawingBuffer:(s=t.preserveDrawingBuffer)!=null?s:!1},i=Snt("3d",this._canvas,r);if(R(i)){const n=he("esri-force-webgl");Qye.error(n)}else this._rctx=this._newRenderingContext(i,e),this._loadShaderOnlyExtensions(),!t.alpha&&this._rctx.contextAttributes.alpha&&Qye.error("WebGL context has alpha channel even though no alpha channel was requested"),!this._rctx.contextAttributes.alpha&&he("safari")>=11&&(this._container.style.backgroundColor="black"),this._container.appendChild(this._canvas)}_newRenderingContext(e,t){const r={disabledExtensions:t.options.deactivatedWebGLExtensions||{},debugWebGLExtensions:t.options.debugWebGLExtensions||{},maxAnisotropy:8},i=(s,n)=>t.resourceController.memoryController.newCache(s,n);return new $Ot(e,r,i)}_loadShaderOnlyExtensions(){this._rctx.capabilities.enable("standardDerivatives"),this._rctx.capabilities.enable("shaderTextureLOD"),this._rctx.capabilities.enable("textureFloat")}get componentObjectCollection(){return R(this._componentObjectCollection)&&(this._componentObjectCollection=new HCt(this._renderer.renderPassManager,this._viewingMode)),this._componentObjectCollection}set componentObjectCollection(e){this._componentObjectCollection=e}};u([d({type:Boolean,readOnly:!0})],qo.prototype,"updating",null),u([Xo()],qo.prototype,"_rctx",void 0),u([Xo()],qo.prototype,"_container",void 0),u([Xo()],qo.prototype,"_canvas",void 0),u([Xo()],qo.prototype,"_stippleTextureRepository",void 0),u([Xo(),d()],qo.prototype,"waterTextureRepository",void 0),u([Xo(),d()],qo.prototype,"_magnifierHelper",void 0),u([Xo(),d()],qo.prototype,"_textureRepository",void 0),u([Xo()],qo.prototype,"_compositingHelper",void 0),u([Xo()],qo.prototype,"_renderer",void 0),u([Xo()],qo.prototype,"_screenshotManager",void 0),u([Xo()],qo.prototype,"componentObjectCollection",null),u([Xo()],qo.prototype,"_componentObjectCollection",void 0),u([d()],qo.prototype,"_needsUpdate",void 0),u([d()],qo.prototype,"_needsWaterReflectionUpdate",void 0),qo=u([$("esri.views.3d.webgl-engine.parts.RenderView")],qo);var Ck;let Nl=Ck=class extends jB(xe){constructor(e){super(e),this._handles=new Dt,this._model=new _k,this._layers=new Xt,this._changeSet=new OPe,this._layerSyncSet=new Set}initialize(){this._set("renderView",new qo(this)),this._frameTask=this.resourceController.scheduler.registerTask(vt.STAGE,this),this._handles.add(this._frameTask)}destroy(){PT.pool.prune(0),this._handles.destroy(),this.dispose()}get viewingMode(){return this.state.viewingMode}get updating(){return this._model.dirtySet.dirty||this.renderView.updating||this._frameTask.updating}add(e){this._model.add(e),JV(e)&&(e.attachStage(this),this._addLayer(e)),this.renderView.requestRender()}remove(e){R(e)||(this.renderView.requestRender(),this._model.remove(e),JV(e)&&(this._removeLayer(e),e.detachStage()))}addMany(e){b(e)&&(this._model.addMany(e),this.renderView.requestRender())}removeMany(e){b(e)&&(this._model.removeMany(e),this.renderView.requestRender())}async load(e){R(e)||(Array.isArray(e)||(e=[e]),await Promise.all(e.filter(t=>R(t.glTexture)).map(t=>this.schedule(()=>this._model.has(t)?t.load(this.renderView.renderingContext,()=>this.renderView.textureRepository.textureTechnique):null))))}loadImmediate(e){return e.load(this.renderView.renderingContext,()=>this.renderView.textureRepository.textureTechnique)}forEachOfType(e,t){this._model.forEachOfType(e,t)}handleEvent(e,t){this.destroyed||(this._model.dirtySet[e](t),this.renderView.requestRender())}get running(){return this._model.dirtySet.dirty}runTask(e){this._frameTask.processQueue(e),e.done||this._commit()}_commit(){const e=this._model.dirtySet;Ck.DebugSettings.logDirtySet&&console.log("Dirty set: "+e.formatDebugInfo()),e.commit(this._changeSet),Ck.DebugSettings.logDirtySet&&(console.log("RGs add: "+this._changeSet.adds.map(t=>t.id)),console.log("RGs remove: "+this._changeSet.removes.map(t=>t.id))),this._layerSyncSet.clear(),this.renderView.modify(this._changeSet),this.renderView.requestRender()}schedule(e,t){return this._frameTask.schedule(e,t)}syncLayer(e){this._layerSyncSet.add(e),this.renderView.requestRender()}processSyncLayers(){const e=this._model.dirtySet;this._layers.forAll(t=>{(this._layerSyncSet.has(t.id)||t.updatePolicy===EA.SYNC)&&(e.commitLayer(t.id,this._changeSet),this._layerSyncSet.delete(t.id))});for(const t of this._layerSyncSet)e.commitLayer(t,this._changeSet);this._layerSyncSet.clear(),this.renderView.modify(this._changeSet)}getObject(e){return this._model.getObject(e)}get layers(){return this._layers}_addLayer(e){this._layers.includes(e)||this._layers.push(e)}_removeLayer(e){this._commit(),this._layers.removeUnordered(e)!=null&&(this._model.dirtySet.getResidentRenderGeometries(e.id,this._changeSet.removes),this.renderView.modify(this._changeSet))}addRenderPlugin(e,t,r){const i=this.renderView.renderPlugins.add(e,t,r),s=()=>{ege(t)&&this.sceneIntersectionHelper.addIntersectionHandler(t)};if(Ch(i))return i.then(s);s()}removeRenderPlugin(e){ege(e)&&this.sceneIntersectionHelper.removeIntersectionHandler(e),this.renderView.renderPlugins.remove(e)}get performanceInfo(){return{renderView:this.renderView.performanceInfo,model:this._model.getStats()}}get test(){const e=this;return{getCount:t=>e._model.test.content.filter(r=>r.type===t).length,model:e._model}}};Nl.DebugSettings={endFrameContentValidation:!1,logDirtySet:!1},u([d({constructOnly:!0})],Nl.prototype,"resourceController",void 0),u([d({constructOnly:!0})],Nl.prototype,"options",void 0),u([d({constructOnly:!0})],Nl.prototype,"state",void 0),u([d({constructOnly:!0})],Nl.prototype,"sceneIntersectionHelper",void 0),u([d({readOnly:!0})],Nl.prototype,"viewingMode",null),u([d({constructOnly:!0})],Nl.prototype,"container",void 0),u([d({constructOnly:!0})],Nl.prototype,"renderSR",void 0),u([d({constructOnly:!0})],Nl.prototype,"_handles",void 0),u([d({readOnly:!0})],Nl.prototype,"updating",null),u([d({constructOnly:!0})],Nl.prototype,"_model",void 0),u([Xo(),d()],Nl.prototype,"renderView",void 0),Nl=Ck=u([$("esri.views.3d.webgl-engine.Stage")],Nl);function GLe(e){return xg(e)&&e.intersector===qi.PCL&&!!e.target}function U8(e){return xg(e)&&e.intersector===qi.I3S&&!!e.target}function FOt(e){return xg(e)&&e.intersector===qi.TERRAIN&&!!e.target}function jLe(e){return xg(e)&&e.intersector===qi.OVERLAY&&!!e.target}function yne(e){return xg(e)&&e.intersector===qi.LOD&&!!e.target}function Jye(e,t){var r;return wB(e)||xB(e)?R$(e.target.object.metadata,t):FOt(e)?(r=t.map)==null?void 0:r.ground:GLe(e)||U8(e)||jLe(e)?R$(e.target,t):null}function fNt(e,t){const r=xJ(e,t);return b(r)&&r.type==="graphic"?r.graphic:null}function xJ(e,t){if(R(e))return null;if(wB(e)||xB(e))return Kye(e.target.object.metadata,t);if(GLe(e)){const r=e.target.createGraphic();return{type:"graphic",graphic:r,layer:r.layer}}return jLe(e)||yne(e)?Kye(e.target,t):U8(e)?kOt(e.target,t):null}function Kye(e,t){if(R(e)||R(e.graphicUid))return null;const r=R$(e,t);if(R(r))return null;if(r===t.graphics)return R(t.graphicsView)||typeof e.graphicUid!="number"?null:t.graphicsView.getHit(e.graphicUid);const i=t.allLayerViews.find(s=>s.layer===r);return!i||i.suspended||R(e.graphicUid)?null:"getHit"in i?i.getHit(e.graphicUid):null}function kOt(e,t){const r=R$(e,t);if(R(r))return null;const i=t.allLayerViews.find(s=>s.layer===r);return i&&!i.suspended&&"getGraphicFromIntersectorTarget"in i?VOt(i.getGraphicFromIntersectorTarget(e)):null}function UOt(e,t){const r=R$(e,t);if(R(r))return null;const i=t.allLayerViews.find(s=>s.layer===r);return i&&!i.suspended&&"getAABBFromIntersectorTarget"in i?i.getAABBFromIntersectorTarget(e):null}function VOt(e){return b(e)?{type:"graphic",graphic:e,layer:e.layer}:null}function R$(e,t){return R(e.layerUid)?null:b(t.graphicsView)&&e.layerUid===t.graphicsView.processor.layer.id?t.graphics:t.map.findLayerByUid(e.layerUid)}function mNt(e,t){if(wB(e)||xB(e))return Hy(e.target.object.boundingVolumeWorldSpace.bounds);if(yne(e)){Zxe(c4,e.transformation);const r=Math.max(c4[0],c4[1],c4[2]);return e.target.baseBoundingSphere.radius*r}return U8(e)?mn(UOt(e.target,t),r=>.5*Kwe(r)):null}function gNt(e){return!wB(e)&&!xB(e)&&(yne(e)?e.target.numLodLevels>1:!!U8(e))}const c4=M();async function zOt(e,t){if(e.type==="2d")return e.hitTest(t);const r=await e.hitTest(t);if(r.results.length===0)return r;const i=r.results[0],s=b(i.distance)?i.distance*(1+BOt):i.distance,n=r.results.findIndex(o=>o.distance>s);return n!==-1&&(r.results=r.results.slice(0,n)),r}const BOt=.05;let gH,yH;function GOt(e){const t=tOe(e);for(;t.length>1;){const r=e0e(t.shift());if(r.available)return r}return e0e(t.shift())}function e0e(e){switch(e){case mr.WEBGL1:return jOt();case mr.WEBGL2:return HOt()}}function jOt(){return gH||(gH=XOt()),gH}function HOt(){return yH||(yH=ZOt()),yH}class HLe{constructor(){this.available=!1,this.majorPerformanceCaveat=!1,this.maxTextureSize=0,this.supportsVertexShaderSamplers=!1,this.supportsHighPrecisionFragment=!1,this.supportsElementIndexUint=!1,this.supportsStandardDerivatives=!1,this.supportsInstancedArrays=!1,this.supportsTextureFloat=!1,this.supportsTextureHalfFloat=!1,this.supportsColorBufferFloat=!1,this.supportsColorBufferFloatBlend=!1,this.supportsColorBufferHalfFloat=!1}}class qOt extends HLe{constructor(){super(...arguments),this.type=mr.WEBGL1}}class WOt extends HLe{constructor(){super(...arguments),this.type=mr.WEBGL2,this.supportsElementIndexUint=!0,this.supportsStandardDerivatives=!0,this.supportsInstancedArrays=!0,this.supportsTextureFloat=!0,this.supportsTextureHalfFloat=!0}}function qLe(e,t){var n;if(e===mr.WEBGL1&&typeof WebGLRenderingContext===void 0||e===mr.WEBGL2&&typeof WebGL2RenderingContext===void 0)return null;const r=document.createElement("canvas");if(!r)return null;let i=EV(r,e,{failIfMajorPerformanceCaveat:!0});if(R(i)&&(i=EV(r,e),b(i)&&(t.majorPerformanceCaveat=!0)),R(i))return i;if(e===mr.WEBGL1){const o=(n=i.getParameter(i.VERSION))==null?void 0:n.match(/^WebGL\s+([\d.]*)/);if(o){const a=parseFloat(o[1]);t.available=a>=.94}}else t.available=!0;t.maxTextureSize=i.getParameter(i.MAX_TEXTURE_SIZE),t.supportsVertexShaderSamplers=i.getParameter(i.MAX_VERTEX_TEXTURE_IMAGE_UNITS)>0;const s=i.getShaderPrecisionFormat(i.FRAGMENT_SHADER,i.HIGH_FLOAT);return s&&(t.supportsHighPrecisionFragment=s.precision>0),i}function XOt(){const e=new qOt,t=qLe(mr.WEBGL1,e);return R(t)||(e.supportsElementIndexUint=t.getExtension("OES_element_index_uint")!==null,e.supportsStandardDerivatives=t.getExtension("OES_standard_derivatives")!==null,e.supportsInstancedArrays=t.getExtension("ANGLE_instanced_arrays")!==null,e.supportsTextureFloat=t.getExtension("OES_texture_float")!==null,e.supportsTextureHalfFloat=t.getExtension("OES_texture_half_float")!==null,e.supportsColorBufferFloat=t.getExtension("WEBGL_color_buffer_float")!==null,e.supportsColorBufferFloatBlend=t.getExtension("EXT_float_blend")!==null,e.supportsColorBufferHalfFloat=t.getExtension("EXT_color_buffer_half_float")!==null),e}function ZOt(){const e=new WOt,t=qLe(mr.WEBGL2,e);return R(t)||(e.supportsColorBufferFloat=t.getExtension("EXT_color_buffer_float")!==null,e.supportsColorBufferFloatBlend=t.getExtension("EXT_float_blend")!==null,e.supportsColorBufferHalfFloat=e.supportsColorBufferFloat||t.getExtension("EXT_color_buffer_half_float")!==null),e}function YOt(e){const t=GOt(e);if(!t.available)return new j("webgl:required","WebGL is required but not supported.");if(e==="3d"&&t.majorPerformanceCaveat)return new j("webgl:major-performance-caveat-detected","Your WebGL implementation doesn't seem to support hardware accelerated rendering. Check your browser settings or if your GPU is in a blocklist.");if(!t.supportsHighPrecisionFragment)return new j("webgl:high-precision-fragment-required","WebGL support for high precision fragment shaders is required but not supported.");if(!t.supportsVertexShaderSamplers)return new j("webgl:vertex-shader-samplers-required","WebGL support for vertex shader samplers is required but not supported.");if(t.type===mr.WEBGL1){if(!t.supportsElementIndexUint)return new j("webgl:element-index-uint-required","WebGL support for uint vertex indices is required but not supported.");if(!t.supportsStandardDerivatives)return new j("webgl:standard-derivatives-required","WebGL support for standard derivatives is required but not supported.");if(!t.supportsInstancedArrays)return new j("webgl:instanced-arrays-required","WebGL support for instanced rendering is required but not supported.")}return null}function QOt(e){return e&&"nodeType"in e}function JOt(e){return e&&typeof e.render=="function"}const t0e={component:"esri-component"};let Vw=class extends xe{constructor(){super(...arguments),this.widget=null}destroy(){this.widget&&this.widget.destroy(),this.node=null}get id(){return this.get("widget.id")||this.get("node.id")}set node(e){const t=this._get("node");e!==t&&(e&&e.classList.add(t0e.component),t&&t.classList.remove(t0e.component),this._set("node",e))}castNode(e){return e?typeof e=="string"||QOt(e)?(this._set("widget",null),y6(e)):(JOt(e)&&!e.domNode&&(e.domNode=document.createElement("div")),this._set("widget",e),e.domNode):(this._set("widget",null),null)}};u([d({dependsOn:[]})],Vw.prototype,"id",null),u([d()],Vw.prototype,"node",null),u([qt("node")],Vw.prototype,"castNode",null),u([d({readOnly:!0})],Vw.prototype,"widget",void 0),Vw=u([$("esri.views.ui.Component")],Vw);const Ak=Vw,KOt={left:0,top:0,bottom:0,right:0},WLe={bottom:30,top:15,right:15,left:15},vH="manual",Ol={ui:"esri-ui",corner:"esri-ui-corner",innerContainer:"esri-ui-inner-container",manualContainer:"esri-ui-manual-container",cornerContainer:"esri-ui-corner-container",topLeft:"esri-ui-top-left",topRight:"esri-ui-top-right",bottomLeft:"esri-ui-bottom-left",bottomRight:"esri-ui-bottom-right"};function eMt(e){return e&&!e._started&&typeof e.postMixInProperties=="function"&&typeof e.buildRendering=="function"&&typeof e.postCreate=="function"&&typeof e.startup=="function"}function _H(e){const t=e,r=typeof t=="object"&&t!==null&&Object.getPrototypeOf(t);return(r===null||r===Object.prototype)&&("component"in t||"index"in t||"position"in t)?e:null}function bH(e,{top:t,bottom:r,left:i,right:s}){e.style.top=t,e.style.bottom=r,e.style.left=i,e.style.right=s}let py=class extends ds.EventedAccessor{constructor(e){super(e),this._cornerNameToContainerLookup={},this._positionNameToContainerLookup={},this._components=new Array,this._componentToKey=new Map,this._handles=new Dt,this.view=null,this._applyViewPadding=()=>{const t=this.container;t&&bH(t,this._toPxPosition(this._getViewPadding()))},this._applyUIPadding=()=>{const t=this._innerContainer;t&&bH(t,this._toPxPosition(this.padding))},this._initContainers()}initialize(){this._handles.add([te(()=>{var e;return[(e=this.view)==null?void 0:e.padding,this.container]},this._applyViewPadding,Rt),te(()=>this.padding,this._applyUIPadding,Rt)])}destroy(){this.container=null;for(const e of this._components)e.destroy();this._components.length=0,this._handles.destroy(),this._componentToKey.clear()}set container(e){const t=this._get("container");e!==t&&(e&&(e.classList.add(Ol.ui),Uqe(e),this._attachContainers(e)),t&&(t.classList.remove(Ol.ui),bH(t,{top:"",bottom:"",left:"",right:""}),Mxe(t)),this._set("container",e))}get height(){const e=this.get("view.height")||0;if(e===0)return e;const t=this._getViewPadding(),r=t.top+t.bottom;return Math.max(e-r,0)}get padding(){return this._get("padding")}set padding(e){e?this._override("padding",e):this._clearOverride("padding")}castPadding(e){return typeof e=="number"?{bottom:e,top:e,right:e,left:e}:{...WLe,...e}}get width(){const e=this.get("view.width")||0;if(e===0)return e;const t=this._getViewPadding(),r=t.left+t.right;return Math.max(e-r,0)}add(e,t){let r,i;if(Array.isArray(e))return void e.forEach(n=>this.add(n,t));const s=_H(e);s&&({index:r,position:t,component:e,key:i}=s),t&&typeof t=="object"&&({index:r,key:i,position:t}=t),!e||t&&!this._isValidPosition(t)||this._add(e,t,r,i)}remove(e,t){if(!e)return;if(Array.isArray(e))return e.map(i=>this.remove(i,t));const r=this._find(e);if(r){const i=this._componentToKey;if(i.has(e)&&i.get(e)!==t)return;const s=this._components.indexOf(r);return r.node.parentNode&&r.node.parentNode.removeChild(r.node),this._componentToKey.delete(e),this._components.splice(s,1)[0]}}empty(e){return Array.isArray(e)?e.map(t=>this.empty(t)).reduce((t,r)=>t.concat(r)):(e=e||vH)===vH?Array.prototype.slice.call(this._manualContainer.children).filter(t=>!t.classList.contains(Ol.corner)).map(t=>this.remove(t)):this._isValidPosition(e)?Array.prototype.slice.call(this._cornerNameToContainerLookup[e].children).map(this.remove,this):null}move(e,t){if(Array.isArray(e)&&e.forEach(n=>this.move(n,t)),!e)return;let r;const i=_H(e)||_H(t);if(i&&(r=i.index,t=i.position,e=i.component||e),t&&!this._isValidPosition(t))return;const s=this.remove(e);s&&this.add(s,{position:t,index:r})}find(e){if(!e)return null;const t=this._findById(e);return t&&(t.widget||t.node)}getPosition(e){for(const t in this._positionNameToContainerLookup)if(this._positionNameToContainerLookup[t].contains(e))return t;return null}_add(e,t,r,i){e instanceof Ak||(e=new Ak({node:e})),this._place({component:e,position:t,index:r}),this._components.push(e),i&&this._componentToKey.set(e,i)}_find(e){return e?e instanceof Ak?this._findByComponent(e):typeof e=="string"?this._findById(e):this._findByNode(e.domNode||e):null}_getViewPadding(){return this.get("view.padding")||KOt}_attachContainers(e){e.appendChild(this._innerContainer),e.appendChild(this._manualContainer)}_initContainers(){const e=document.createElement("div");e.classList.add(Ol.innerContainer),e.classList.add(Ol.cornerContainer);const t=document.createElement("div");t.classList.add(Ol.innerContainer),t.classList.add(Ol.manualContainer);const r=document.createElement("div");r.classList.add(Ol.topLeft),r.classList.add(Ol.corner),e.appendChild(r);const i=document.createElement("div");i.classList.add(Ol.topRight),i.classList.add(Ol.corner),e.appendChild(i);const s=document.createElement("div");s.classList.add(Ol.bottomLeft),s.classList.add(Ol.corner),e.appendChild(s);const n=document.createElement("div");n.classList.add(Ol.bottomRight),n.classList.add(Ol.corner),e.appendChild(n),this._innerContainer=e,this._manualContainer=t;const o=nf();this._cornerNameToContainerLookup={"top-left":r,"top-right":i,"bottom-left":s,"bottom-right":n,"top-leading":o?i:r,"top-trailing":o?r:i,"bottom-leading":o?n:s,"bottom-trailing":o?s:n},this._positionNameToContainerLookup={manual:t,...this._cornerNameToContainerLookup}}_isValidPosition(e){return!!this._positionNameToContainerLookup[e]}_place(e){const t=e.component,r=e.position||vH,i=e.index,s=this._positionNameToContainerLookup[r],n=i>-1;if(eMt(t.widget)&&t.widget.startup(),!n)return void s.appendChild(t.node);const o=Array.prototype.slice.call(s.children);if(i===0)return void(s.firstChild?sle(t.node,s.firstChild):s.appendChild(t.node));i>=o.length?s.appendChild(t.node):sle(t.node,o[i])}_toPxPosition(e){return{top:this._toPxUnit(e.top),left:this._toPxUnit(e.left),right:this._toPxUnit(e.right),bottom:this._toPxUnit(e.bottom)}}_toPxUnit(e){return e===0?"0":e+"px"}_findByComponent(e){let t,r=null;return this._components.some(i=>(t=i===e,t&&(r=i),t)),r}_findById(e){let t,r=null;return this._components.some(i=>(t=i.id===e,t&&(r=i),t)),r}_findByNode(e){let t,r=null;return this._components.some(i=>(t=i.node===e,t&&(r=i),t)),r}};u([d()],py.prototype,"container",null),u([d()],py.prototype,"height",null),u([d({value:WLe})],py.prototype,"padding",null),u([qt("padding")],py.prototype,"castPadding",null),u([d()],py.prototype,"view",void 0),u([d()],py.prototype,"width",null),py=u([$("esri.views.ui.UI")],py);const tMt=py;function r0e(e,t){return e&&"copyright"in e&&(!t||typeof e.originOf=="function"&&e.originOf("copyright")==="user")}function rMt(e,t){return e.length!==t.length||e.some((r,i)=>r.text!==t[i].text)}function u4(e,t,r){!r||!t||e.find(i=>i.layerView===t&&i.text===r)||e.push({text:r,layerView:t})}function iMt(e){return e.type==="bing-maps"}const xv=[];let sE=class extends YC{constructor(e){super(e),this._clear=()=>{this._fetchedAttributionData.clear(),this._pendingAttributions.clear(),this.handles.remove("suspension"),this.notifyChange("state")},this._pendingAttributions=new Set,this._fetchedAttributionData=new Map,this.items=new ot,this.view=null,this._allLayerViewsChange=t=>{this.handles.remove("suspension");const r=this.get("view.allLayerViews");r&&this.handles.add(r.map(i=>te(()=>{var s;return[i.suspended,(s=i.layer)==null?void 0:s.attributionVisible]},()=>this._updateAttributionItems())),"suspension"),t&&t.removed&&t.removed.forEach(i=>{this._pendingAttributions.delete(i),this._fetchedAttributionData.delete(i)}),this._updateAttributionItems()},this.handles.add([rs(()=>{var t;return(t=this.view)==null?void 0:t.allLayerViews},"change",t=>this._allLayerViewsChange(t),{onListenerAdd:()=>this._allLayerViewsChange(),onListenerRemove:this._clear}),Lo(()=>{var t;return((t=this.view)==null?void 0:t.stationary)===!0},()=>this._updateAttributionItems())])}destroy(){this.view=null,this._fetchedAttributionData.clear(),this._pendingAttributions.clear(),this.items.removeAll()}get state(){return this.get("view.ready")?this._pendingAttributions.size>0?"loading":"ready":"disabled"}_updateAttributionItems(){const e=this.get("view.allLayerViews");xv.length=0,e?(e.forEach(t=>{var s;if(t.suspended||!((s=t.layer)!=null&&s.attributionVisible))return;const r=t.layer;if(r0e(r,"user"))return void u4(xv,t,r.copyright);if(r.hasAttributionData){if(this._fetchedAttributionData.has(t)){const n=this._fetchedAttributionData.get(t);return void(n?u4(xv,t,this._getDynamicAttribution(n,this.view,r)):r0e(r)&&u4(xv,t,r.copyright))}return void this._fetchAttributionData(t)}const i=r.get("portalItem.accessInformation");u4(xv,t,i||r.copyright)}),rMt(this.items,xv)&&(this.items.removeAll(),this.items.addMany(xv)),xv.length=0,this.notifyChange("state")):this._clear()}async _fetchAttributionData(e){if(this._pendingAttributions.has(e))return;this._pendingAttributions.add(e);const t=await yh(e.layer.fetchAttributionData());if(this._pendingAttributions.has(e)){const r=t.ok?this._createContributionIndex(t.value,iMt(e.layer)):null;this._pendingAttributions.delete(e),this._fetchedAttributionData.set(e,r)}this._updateAttributionItems()}_createContributionIndex(e,t){const r=e.contributors,i={};if(!r)return i;for(let s=0;s<r.length;s++){const n=r[s],o=n.coverageAreas;if(!o)return;for(const a of o){const l=a.bbox,c=a.zoomMin-(t&&a.zoomMin?1:0),h=a.zoomMax-(t&&a.zoomMax?1:0),p={xmin:l[1],ymin:l[0],xmax:l[3],ymax:l[2],spatialReference:Ze.WGS84},f={extent:jy(p),attribution:n.attribution||"",score:a.score!=null?a.score:100,id:s};for(let m=c;m<=h;m++)i[m]=i[m]||[],i[m].push(f)}}return i.maxKey=Math.max.apply(null,Object.keys(i)),i}_getDynamicAttribution(e,t,r){const{extent:i,scale:s}=t;let n=r.tileInfo.scaleToZoom(s);if(n=Math.min(e.maxKey,Math.round(n)),!i||n==null||n<=-1)return"";const o=e[n],a=BT(i.center.clone().normalize(),t.spatialReference),l={};return o?o.filter(c=>{const h=!l[c.id]&&a&&aee(c.extent,a);return h&&(l[c.id]=!0),h}).sort((c,h)=>h.score-c.score||c.objectId-h.objectId).map(c=>c.attribution).join(", "):""}};u([d({readOnly:!0,type:ot})],sE.prototype,"items",void 0),u([d({readOnly:!0})],sE.prototype,"state",null),u([d()],sE.prototype,"view",void 0),sE=u([$("esri.widgets.Attribution.AttributionViewModel")],sE);const XLe=sE,Tv={base:"esri-attribution esri-widget",poweredBy:"esri-attribution__powered-by",sources:"esri-attribution__sources",open:"esri-attribution--open",sourcesOpen:"esri-attribution__sources--open",link:"esri-attribution__link",widgetIcon:"esri-icon-description",interactive:"esri-interactive"};let Fl=class extends Un{constructor(e,t){super(e,t),this._isOpen=!1,this._attributionTextOverflowed=!1,this._prevSourceNodeHeight=0,this._resizeObserver=new ResizeObserver(r=>r.forEach(({target:i})=>this._checkSourceTextOverflow(i))),this.iconClass=Tv.widgetIcon,this.itemDelimiter=" | ",this.label=void 0,this.messages=null,this.view=null,this.viewModel=new XLe}initialize(){this.own(rs(()=>{var e;return(e=this.viewModel)==null?void 0:e.items},"change",()=>this.scheduleRender()))}destroy(){var e;(e=this._resizeObserver)==null||e.disconnect()}get _isInteractive(){return this._isOpen||this._attributionTextOverflowed}get attributionText(){return this.viewModel.items.reduce((e,t)=>(e.includes(t.text)||e.push(t.text),e),[]).join(this.itemDelimiter)}render(){const e={[Tv.open]:this._isOpen};return U("div",{bind:this,class:this.classes(Tv.base,e),dir:"ltr",onclick:this._toggleState,onkeydown:this._toggleState},this.renderSourcesNode(),this.renderPoweredBy())}renderPoweredBy(){return U("div",{class:Tv.poweredBy},"Powered by"," ",U("a",{class:Tv.link,href:"http://www.esri.com/",target:"_blank",rel:"noreferrer"},"Esri"))}renderSourcesNode(){const e=this._isOpen,t=this._isInteractive,r=t?"0":"",{attributionText:i}=this,s={[Tv.sourcesOpen]:e,[Tv.interactive]:t};return U("div",{afterCreate:this._afterSourcesNodeCreate,bind:this,class:this.classes(Tv.sources,s),innerHTML:i,tabindex:r})}_afterSourcesNodeCreate(e){this._prevSourceNodeHeight=e.clientWidth,this._resizeObserver.observe(e)}_checkSourceTextOverflow(e){let t=!1;const{clientHeight:r,clientWidth:i,scrollWidth:s}=e,n=s>i,o=this._attributionTextOverflowed!==n;if(this._attributionTextOverflowed=n,o&&(t=!0),this._isOpen){const a=r<this._prevSourceNodeHeight;this._prevSourceNodeHeight=r,a&&(this._isOpen=!1,t=!0)}t&&this.scheduleRender()}_toggleState(){this._isInteractive&&(this._isOpen=!this._isOpen)}};u([d()],Fl.prototype,"_isOpen",void 0),u([d()],Fl.prototype,"_isInteractive",null),u([d()],Fl.prototype,"_attributionTextOverflowed",void 0),u([d()],Fl.prototype,"_prevSourceNodeHeight",void 0),u([d({readOnly:!0,dependsOn:["viewModel.items.length","itemDelimiter"]})],Fl.prototype,"attributionText",null),u([d()],Fl.prototype,"iconClass",void 0),u([d()],Fl.prototype,"itemDelimiter",void 0),u([d({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],Fl.prototype,"label",void 0),u([d(),Js("esri/widgets/Attribution/t9n/Attribution")],Fl.prototype,"messages",void 0),u([We("viewModel.view")],Fl.prototype,"view",void 0),u([d({type:XLe})],Fl.prototype,"viewModel",void 0),u([sl()],Fl.prototype,"_toggleState",null),Fl=u([$("esri.widgets.Attribution")],Fl);const sMt=Fl,nMt="esri.widgets.CompassViewModel";let zw=class extends Jre(xe){constructor(e){super(e),this._handles=new Dt,this.orientation={x:0,y:0,z:0},this.view=null,this._updateForCamera=this._updateForCamera.bind(this),this._updateForRotation=this._updateForRotation.bind(this),this._updateRotationWatcher=this._updateRotationWatcher.bind(this)}initialize(){this._handles.add(te(()=>this.view,this._updateRotationWatcher,Rt))}destroy(){this._handles=wn(this._handles),this.view=null}get canShowNorth(){const e=this.get("view.spatialReference");return!(!e||!e.isWebMercator&&!e.isGeographic)}get state(){return this.get("view.ready")?this.canShowNorth?"compass":"rotation":"disabled"}reset(){if(!this.get("view.ready"))return;const e={};this.view.type==="2d"?e.rotation=0:e.heading=0,this.callGoTo({target:e})}_updateForRotation(e){e!=null&&(this.orientation={z:e})}_updateForCamera(e){if(!e)return;const t=-e.heading;this.orientation={x:0,y:0,z:t}}_updateRotationWatcher(e){this._handles.removeAll(),e&&this._handles.add(e.type==="2d"?te(()=>e==null?void 0:e.rotation,this._updateForRotation,Rt):te(()=>e==null?void 0:e.camera,this._updateForCamera,Rt))}};u([d({readOnly:!0})],zw.prototype,"canShowNorth",null),u([d()],zw.prototype,"orientation",void 0),u([d({readOnly:!0})],zw.prototype,"state",null),u([d()],zw.prototype,"view",void 0),zw=u([$(nMt)],zw);const ZLe=zw,Sv={base:"esri-compass esri-widget--button esri-widget",text:"esri-icon-font-fallback-text",icon:"esri-compass__icon",rotationIcon:"esri-icon-dial",northIcon:"esri-icon-compass",widgetIcon:"esri-icon-locate-circled",interactive:"esri-interactive",disabled:"esri-disabled"};let gm=class extends Un{constructor(e,t){super(e,t),this.goToOverride=null,this.iconClass=Sv.widgetIcon,this.label=void 0,this.messages=null,this.view=null,this.viewModel=new ZLe}reset(){return this.viewModel.reset()}render(){const{orientation:e,state:t}=this.viewModel,r=t==="disabled",i=(t==="rotation"?"rotation":"compass")=="compass",s=r?-1:0,n={[Sv.disabled]:r,[Sv.interactive]:!r},o={[Sv.northIcon]:i,[Sv.rotationIcon]:!i},{messages:a}=this;return U("div",{bind:this,class:this.classes(Sv.base,n),onclick:this._reset,onkeydown:this._reset,role:"button",tabIndex:s,"aria-label":a.reset,title:a.reset},U("span",{"aria-hidden":"true",class:this.classes(Sv.icon,o),styles:this._toRotationTransform(e)}),U("span",{class:Sv.text},a.reset))}_reset(){this.viewModel.reset()}_toRotationTransform(e){return{transform:`rotateZ(${e.z}deg)`}}};u([We("viewModel.goToOverride")],gm.prototype,"goToOverride",void 0),u([d()],gm.prototype,"iconClass",void 0),u([d({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],gm.prototype,"label",void 0),u([d(),Js("esri/widgets/Compass/t9n/Compass")],gm.prototype,"messages",void 0),u([We("viewModel.view")],gm.prototype,"view",void 0),u([d({type:ZLe})],gm.prototype,"viewModel",void 0),u([sl()],gm.prototype,"_reset",null),gm=u([$("esri.widgets.Compass")],gm);const YLe=gm;let nE=class extends xe{constructor(e){super(e),this._handles=new Dt,this.navigationMode="pan",this.view=null}initialize(){this._handles.add(Lo(()=>{var e;return(e=this.view)==null?void 0:e.inputManager},()=>this._setNavigationMode()))}destroy(){this._handles.destroy(),this._handles=null,this.view=null}get state(){return this.get("view.ready")&&this.view.type==="3d"?"ready":"disabled"}toggle(){this.state!=="disabled"&&(this.navigationMode=this.navigationMode!=="pan"?"pan":"rotate",this._setNavigationMode())}_setNavigationMode(){this.get("view.inputManager").primaryDragAction=this.navigationMode==="pan"?"pan":"rotate"}};u([d({readOnly:!0})],nE.prototype,"state",null),u([d()],nE.prototype,"navigationMode",void 0),u([d()],nE.prototype,"view",void 0),nE=u([$("esri.widgets.NavigationToggleViewModel")],nE);const QLe=nE,Gh={base:"esri-navigation-toggle esri-widget",button:"esri-navigation-toggle__button esri-widget--button",activeButton:"esri-navigation-toggle__button--active",panButton:"esri-navigation-toggle__button--pan",rotateButton:"esri-navigation-toggle__button--rotate",isLayoutHorizontal:"esri-navigation-toggle--horizontal",rotationIcon:"esri-icon-rotate",panIcon:"esri-icon-pan",widgetIcon:"esri-icon-pan2",disabled:"esri-disabled"};let ym=class extends Un{constructor(e,t){super(e,t),this.iconClass=Gh.widgetIcon,this.label=void 0,this.messages=null,this.view=null,this.viewModel=new QLe}set layout(e){e!=="horizontal"&&(e="vertical"),this._set("layout",e)}toggle(){return this.viewModel.toggle()}render(){const e=this.get("viewModel.state")==="disabled",t=this.get("viewModel.navigationMode")==="pan",r={[Gh.disabled]:e,[Gh.isLayoutHorizontal]:this.layout==="horizontal"},i={[Gh.activeButton]:t},s={[Gh.activeButton]:!t},n=e?-1:0,o=this.messages.toggle;return U("div",{bind:this,class:this.classes(Gh.base,r),onclick:this._toggle,onkeydown:this._toggle,tabIndex:n,"aria-label":o,title:o},U("div",{class:this.classes(Gh.button,Gh.panButton,i)},U("span",{class:Gh.panIcon})),U("div",{class:this.classes(Gh.button,Gh.rotateButton,s)},U("span",{class:Gh.rotationIcon})))}_toggle(){this.toggle()}};u([d()],ym.prototype,"iconClass",void 0),u([d({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],ym.prototype,"label",void 0),u([d({value:"vertical"})],ym.prototype,"layout",null),u([d(),Js("esri/widgets/NavigationToggle/t9n/NavigationToggle")],ym.prototype,"messages",void 0),u([We("viewModel.view")],ym.prototype,"view",void 0),u([d({type:QLe})],ym.prototype,"viewModel",void 0),u([sl()],ym.prototype,"_toggle",null),ym=u([$("esri.widgets.NavigationToggle")],ym);const JLe=ym,tM={button:"esri-widget--button esri-widget",disabled:"esri-disabled",interactive:"esri-interactive",iconText:"esri-icon-font-fallback-text",icon:"esri-icon"};let r_=class extends Un{constructor(){super(...arguments),this.enabled=!0,this.iconClass="",this.title=""}render(){const e=this.enabled?0:-1,t={[tM.disabled]:!this.enabled,[tM.interactive]:this.enabled},r={[this.iconClass]:!!this.iconClass};return U("div",{bind:this,class:this.classes(tM.button,t),onclick:this._triggerAction,onkeydown:this._triggerAction,role:"button",tabIndex:e,title:this.title},U("span",{"aria-hidden":"true",role:"presentation",class:this.classes(tM.icon,r)}),U("span",{class:tM.iconText},this.title))}_triggerAction(){this.action.call(this)}};u([d()],r_.prototype,"action",void 0),u([d()],r_.prototype,"enabled",void 0),u([d()],r_.prototype,"iconClass",void 0),u([d()],r_.prototype,"title",void 0),u([sl()],r_.prototype,"_triggerAction",null),r_=u([$("esri.widgets.IconButton")],r_);const i0e=r_;let oE=class extends xe{get canZoomIn(){if(!this.get("view.ready"))return!1;const e=this.get("view.animation.target.scale")||this.get("view.scale"),t=this.get("view.constraints.effectiveMaxScale");return t===0||e>t}get canZoomOut(){if(!this.get("view.ready"))return!1;const e=this.get("view.animation.target.scale")||this.get("view.scale"),t=this.get("view.constraints.effectiveMinScale");return t===0||e<t}};u([d({readOnly:!0})],oE.prototype,"canZoomIn",null),u([d({readOnly:!0})],oE.prototype,"canZoomOut",null),u([d()],oE.prototype,"view",void 0),oE=u([$("esri.widgets.Zoom.ZoomConditions2D")],oE);const oMt=oE;let aE=class extends xe{get canZoomIn(){return!!this.get("view.ready")}get canZoomOut(){return!!this.get("view.ready")}};u([d({readOnly:!0})],aE.prototype,"canZoomIn",null),u([d({readOnly:!0})],aE.prototype,"canZoomOut",null),u([d()],aE.prototype,"view",void 0),aE=u([$("esri.widgets.Zoom.ZoomConditions3D")],aE);const aMt=aE;let i_=class extends xe{constructor(e){super(e),this.canZoomIn=!1,this.canZoomOut=!1}destroy(){this.view=null}get state(){return this.get("view.ready")?"ready":"disabled"}set view(e){e?e.type==="2d"?this._zoomConditions=new oMt({view:e}):e.type==="3d"&&(this._zoomConditions=new aMt({view:e})):this._zoomConditions=null,this._set("view",e)}zoomIn(){if(!this.canZoomIn)return;const e=this.view;e.type==="2d"?e.mapViewNavigation.zoomIn():Sq(e.goTo({zoomFactor:2}))}zoomOut(){if(!this.canZoomOut)return;const e=this.view;e.type==="2d"?e.mapViewNavigation.zoomOut():Sq(e.goTo({zoomFactor:.5}))}};u([d()],i_.prototype,"_zoomConditions",void 0),u([d({aliasOf:"_zoomConditions.canZoomIn",readOnly:!0})],i_.prototype,"canZoomIn",void 0),u([d({aliasOf:"_zoomConditions.canZoomOut",readOnly:!0})],i_.prototype,"canZoomOut",void 0),u([d({readOnly:!0})],i_.prototype,"state",null),u([d()],i_.prototype,"view",null),i_=u([$("esri.widgets.Zoom.ZoomViewModel")],i_);const KLe=i_,rM={base:"esri-zoom esri-widget",horizontalLayout:"esri-zoom--horizontal",zoomInIcon:"esri-icon-plus",zoomOutIcon:"esri-icon-minus",widgetIcon:"esri-icon-zoom-in-magnifying-glass"};let fy=class extends Un{constructor(e,t){super(e,t),this.iconClass=rM.widgetIcon,this.label=void 0,this.messages=null,this.view=null,this.viewModel=new KLe}initialize(){this._zoomInButton=new i0e({action:this.zoomIn.bind(this),iconClass:rM.zoomInIcon}),this._zoomOutButton=new i0e({action:this.zoomOut.bind(this),iconClass:rM.zoomOutIcon})}destroy(){this._zoomInButton.destroy(),this._zoomOutButton.destroy(),this._zoomInButton=null,this._zoomOutButton=null}set layout(e){e!=="horizontal"&&(e="vertical"),this._set("layout",e)}render(){const e=this.viewModel,t={[rM.horizontalLayout]:this.layout==="horizontal"};return this._zoomInButton.enabled=e.state==="ready"&&e.canZoomIn,this._zoomOutButton.enabled=e.state==="ready"&&e.canZoomOut,this._zoomInButton.title=this.messages.zoomIn,this._zoomOutButton.title=this.messages.zoomOut,U("div",{class:this.classes(rM.base,t)},this._zoomInButton.render(),this._zoomOutButton.render())}zoomIn(){return this.viewModel.zoomIn()}zoomOut(){return this.viewModel.zoomOut()}};u([d()],fy.prototype,"iconClass",void 0),u([d({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],fy.prototype,"label",void 0),u([d({value:"vertical"})],fy.prototype,"layout",null),u([d(),Js("esri/widgets/Zoom/t9n/Zoom")],fy.prototype,"messages",void 0),u([We("viewModel.view")],fy.prototype,"view",void 0),u([d({type:KLe})],fy.prototype,"viewModel",void 0),fy=u([$("esri.widgets.Zoom")],fy);const eDe=fy,tDe="esri.views.ui.DefaultUI";function lMt(e){return e&&e.view!==void 0}fe.getLogger(tDe);let Rk=class extends tMt{constructor(e){super(e),this._defaultPositionLookup={attribution:"manual",compass:"top-left","navigation-toggle":"top-left",zoom:"top-left"},this.components=[]}initialize(){this._handles.add([te(()=>this.components,this._componentsWatcher.bind(this),Rt),te(()=>this.view,this._updateViewAwareWidgets.bind(this),Rt)])}_add(e,t,r,i){if(typeof e=="string"&&this._defaultPositionLookup[e]){if(this._find(e))return;e=this._createComponent(e)}super._add(e,t,r,i)}_removeComponents(e){e.forEach(t=>{const r=this._find(t);r&&(this.remove(r),r.destroy())})}_updateViewAwareWidgets(e){this.components.forEach(t=>{const r=this._find(t),i=r&&r.widget;lMt(i)&&(i.view=e)})}_componentsWatcher(e,t){this._removeComponents(t),this._addComponents(e),this._adjustPadding(e)}_adjustPadding(e){if(!e.includes("attribution")&&!this._isOverridden("padding")){const{top:t}=this.padding;this.padding=t}}_addComponents(e){this.initialized&&e.forEach(t=>this.add(this._createComponent(t),this._defaultPositionLookup[t]))}_createComponent(e){const t=this._createWidget(e);if(t)return new Ak({id:e,node:t})}_createWidget(e){return e==="attribution"?this._createAttribution():e==="compass"?this._createCompass():e==="navigation-toggle"?this._createNavigationToggle():e==="zoom"?this._createZoom():void 0}_createAttribution(){return new sMt({view:this.view})}_createCompass(){return new YLe({view:this.view})}_createNavigationToggle(){return new JLe({view:this.view})}_createZoom(){return new eDe({view:this.view})}};u([d()],Rk.prototype,"components",void 0),Rk=u([$(tDe)],Rk);const cMt=Rk;let Ok=class extends cMt{constructor(e){super(e),this.components=["attribution","zoom","navigation-toggle","compass"]}};u([d()],Ok.prototype,"components",void 0),Ok=u([$("esri.views.ui.3d.DefaultUI3D")],Ok);const rDe=Ok,Tu=fe.getLogger("esri.views.SceneView");let it=class extends p7e(yit(Iit(nst))){constructor(e){super(e),this._userClippingArea=null,this._clippingArea=null,this._initialDefaultSpatialReference=null,this._defaults={},this._externallySet={environment:!1},this._createGraphicsViewController=null,this._resolveWhenReady=[],this.propertiesPool=new g0({slicePlane:KTe},this),this._resourceController=dxt(this),this._defaultToMapOptions={include:new Set},this._defaultHitTestOptions={exclude:new Set},this.deconflictor=new MQ({view:this}),this.labeler=new Iw({view:this,deconflictor:this.deconflictor.labels}),this.sharedSymbolResources=null,this.analyses=new fA,this.basemapTerrain=null,this.elevationProvider=null,this.camera=null,this.canvas=null,this.center=null,this.constraints=new ix,this.environmentManager=new Ap,this.extent=null,this.floors=new ot,this.fullOpacity=1,this.graphicsView=null,this.analysisViewManager=new lst({view:this}),this.groundView=null,this.navigating=!1,this.map=null,this.screenSizePerspectiveEnabled=!0,this.state=new swt,this.scale=null,this.spatialReference=null,this.alphaCompositingEnabled=!1,this.preserveDrawingBufferEnabled=!1,this.supersampleScreenshotsEnabled=!0,this.type="3d",this.ui=new rDe,this._numUpdating=0,this._lastUpdateTime=0,this.updatingProgress=.5,this.viewpoint=null,this.zoom=null,this.highlightOptions=new XQ,this.voxelWasm=null,this.voxelWasmPromise=null,I8e(),e&&e.environment||(this._defaults.environment=new X2,this.environment=this._defaults.environment);const t=(r=null)=>{b(r)&&r.type===Qr.MOVE||(this._updatingChanged(),this.map&&this.map.allLayers.forEach(async i=>{try{await i.when()}catch{}this._updatingChanged()}))};this.handles.add([rs(()=>{var r;return(r=this.map)==null?void 0:r.allLayers},"after-changes",r=>t(r),{onListenerAdd:()=>t(),onListenerRemove:()=>t(),sync:!0}),this.allLayerViews.on("after-changes",r=>this._updateUpdatingMonitors(r)),te(()=>this.map,r=>{r&&"load"in r&&r.load&&r.load().catch(()=>{})})]),this.inputManager=new ydt({view:this}),this.stateManager=new Mwt({view:this})}initialize(){this.groundView=new Pit({view:this}),this._updateUpdatingMonitors();const e=()=>this._updateDefaultToMapOptions();this.handles.add(rs(()=>{var t;return(t=this.map)==null?void 0:t.allLayers},"after-changes",e,{onListenerAdd:e,onListenerRemove:e})),this.updatingHandles.add(()=>this.qualitySettings.memoryLimit,t=>{this.resourceController&&(this.resourceController.memoryController.maxMemory=t)},Rt),this.updatingHandles.add(()=>this.qualitySettings.additionalCacheMemory,t=>{this.resourceController&&(this.resourceController.memoryController.additionalCacheMemory=t)},Rt),this.updatingHandles.add(()=>this.qualitySettings.frameRate,t=>I5e(t>0?1e3/Math.ceil(t):0),Rt),this.updatingHandles.add(()=>{var t;return(t=this.map)==null?void 0:t.ground},e,Xs),this.updatingHandles.add(()=>{var t,r;return(r=(t=this.map)==null?void 0:t.ground)==null?void 0:r.opacity},()=>this._updateDefaultHitTestOptions(),Xs),this.handles.add(te(()=>this.spatialReference,()=>this.notifyChange("clippingArea"),ei))}destroy(){this.destroyed||(this.invalidate(),this.activeTool=null,this.layerViewManager.clear(),this._exitSurface(),this._disposeGraphicsView(),this.sharedSymbolResources=ct(this.sharedSymbolResources),this.labeler.destroy(),this._set("labeler",null),this.deconflictor.destroy(),this._set("deconflictor",null),this._resourceController=ct(this._resourceController),this.stateManager.destroy(),this._set("stateManager",null),this.inputManager.destroy(),this._set("inputManager",null),this.propertiesPool.destroy(),this.handles.remove("updatingMonitors"),this.environmentManager.destroy(),this._set("environmentManager",null),this.groundView=ct(this.groundView))}get renderSpatialReference(){return this.renderCoordsHelper&&this.renderCoordsHelper.spatialReference}get basemapSpatialReference(){var e;return(e=this.basemapTerrain)==null?void 0:e.spatialReference}installContentCameraReset(e={sticky:!1}){return this.stateManager.installContentCameraReset(e)}get clippingArea(){if(this.viewingMode==="global")return null;let e=this._userClippingArea||this.get("map.clippingArea");return!(!!this._userClippingArea||this.get("map.clippingEnabled"))||R(e)?(this._clippingArea=null,null):e instanceof Kt?this.spatialReference&&(e=h4(e,this.spatialReference),R(e))?(Tu.error("#clippingArea","setting clippingArea with incompatible SpatialReference"),this._clippingArea):(e=e.clone(),R(e.intersection(this.groundAndLayersExtent))&&(e.xmin=e.xmax,e.ymin=e.ymax),e.zmin=void 0,e.zmax=void 0,e.equals(this._clippingArea)||(this._clippingArea=e),this._clippingArea):(Tu.error("#clippingArea","only clippingArea geometries of type Extent are supported"),this._clippingArea)}set clippingArea(e){this.ready&&this.viewingMode==="global"&&b(e)?Tu.error("#clippingArea=","Clipping area is only supported in local viewingMode"):this._userClippingArea=e}get renderDataExtent(){if(this.state.viewingMode===Be.Global)return null;const e=this.renderSpatialReference,t=this.dataExtent;return R(t)||R(e)||t.spatialReference.equals(e)?t:h4(t,e)}get dataExtent(){let e=this.groundAndLayersExtent;const t=this.spatialReference||Ze.WGS84,r=h4(this.clippingArea,t);b(r)&&(e=b(e)?e.intersection(r):r);const i=this._get("dataExtent");return b(e)&&e.equals(i)?i:e}get groundAndLayersExtent(){const e=this.spatialReference||Ze.WGS84;let t;const r=n=>{const o=h4(n,e);R(o)||(b(t)?t.union(o):t=o.clone())},i=this.basemapTerrain;if(i!=null&&i.spatialReference){const n=i.groundExtent;r(new Kt({xmin:n[0],ymin:n[1],zmin:0,xmax:n[2],ymax:n[3],zmax:0,spatialReference:i.spatialReference}))}if(this.map){const n=o=>{!b(o.fullExtent)||o.type==="graphics"&&o.internal||r(o.fullExtent)};this.map.allLayers.forEach(o=>n(o))}if(R(t))return null;t.hasZ?(t.zmin=Math.min(0,t.zmin),t.zmax=Math.max(0,t.zmax)):(t.zmin=0,t.zmax=0);const s=this._get("groundAndLayersExtent");return t.equals(s)?s:t}set environment(e){e!==this._defaults.environment&&(this._externallySet.environment=!0),this._set("environment",e)}castEnvironment(e){return e?e instanceof X2?e:e instanceof NRe?this.environment!=null?this.environment.cloneWithWebsceneEnvironment(e):X2.fromWebsceneEnvironment(e):en(X2,e):new X2}get initialExtentRequired(){return this.stateManager&&!this.stateManager.hasInitialView}get _defaultsFromMapSettings(){return{required:{tileInfo:!1,heightModelInfo:!0,extent:!1}}}get interacting(){return this.navigating||b(this.activeTool)}get stationary(){return!this.animation&&!this.resizing&&(R(this.state)||this.state.stationary)}set qualityProfile(e){hk.isValidProfile(e)&&(hk.apply(e,this.qualitySettings),this._set("qualityProfile",e))}get qualityProfile(){return this._get("qualityProfile")||hk.getDefaultProfile()}set slicePlane(e){if(b(this._stage)&&this._stage.renderView.setRenderParameters({slicePlane:e}),R(e))return void this._set("slicePlane",null);const t=this.propertiesPool.get("slicePlane");KT(e,t),this._set("slicePlane",t)}get typeSpecificPreconditionsReady(){return!!this.viewingMode}get resolution(){return this.spatialReference!=null?mSe(this.scale,this.spatialReference):0}get heightModelInfo(){const e=this.getDefaultHeightModelInfo();return e!=null?QT.deriveUnitFromSR(e,this.spatialReference):null}get updating(){var i,s,n;if(this.destroyed)return!1;let e=0,t=this.layerViewManager.updating,r=t?this.layerViewManager.updatingRemaining:0;this.allLayerViews.forEach(o=>{if(o.isFulfilled()){if(o.updating){if(t=!0,o.suspended||_$(o))return;++r,e+=o.updatingProgress}}else++r});for(const o of[this.graphicsView,this.basemapView,this._resourceController,this._stage,this.featureTiles,this.pointsOfInterest,this.environmentManager,this.overlay,this.featureTreeDebugger,this.toolViewManager,this.analysisViewManager])b(o)&&o.updating&&(r+=.1,e+=.5*.1);for(const o of[this.deconflictor,this.labeler,this.basemapTerrain])b(o)&&o.updating&&(++r,e+=o.updatingProgress);if(t=!!(t||r>0||this.updatingHandles.updating||!this.ready||!this.stationary||this._createGraphicsViewController||((i=this.inputManager)==null?void 0:i.hasPendingInputs)||((n=(s=this.map)==null?void 0:s.allLayers)==null?void 0:n.some(o=>!o.isFulfilled()))),t?(this._numUpdating=Math.max(r,this._numUpdating),e+=this._numUpdating-r):this._numUpdating=0,this._numUpdating>0?e/=this._numUpdating:e=t?0:1,this._get("updatingProgress")!==e){const o=performance.now();if(e<1){const a=Math.min((o-this._lastUpdateTime)/2e3,1);e=this.updatingProgress*(1-a)+e*a}this._set("updatingProgress",e),this._lastUpdateTime=t&&e<1?o:0}return t}get viewingMode(){var r;const e=this._predeterminedViewingMode;if(b(e))return uP(e);const t=this.spatialReference;return t?b((r=this.defaultsFromMap)==null?void 0:r.viewingMode)&&t.equals(this.defaultsFromMap.spatialReference)?uP(this.defaultsFromMap.viewingMode):i$(t,Be.Global)?"global":"local":"global"}set viewingMode(e){this.ready?Tu.error("#viewingMode","viewingMode cannot be set once view is ready"):e?this._override("viewingMode",e):e===void 0&&this._clearOverride("viewingMode")}get resourceController(){return this._resourceController}get performanceInfo(){return new Lxt(this)}forceAnimationTime(e){this._stage.renderView.forcedAnimationTime=this.basemapTerrain.overlayManager.forcedAnimationTime=e}on(e,t,r,i){return this.viewEvents.on(e,t,r,i)||super.on(e,t)}hasEventListener(e){return super.hasEventListener(e)||this.viewEvents.hasHandler(e)}toMap(e,t){if(!this.ready)return Tu.error("#toMap()","Scene view cannot be used before it is ready"),null;const r=t?this.externalToInternalIntersectOptions(t):this._defaultToMapOptions,i=b(r.graphics)&&(b(r.graphics.include)||b(r.graphics.exclude)),s=jhe(e)?Ghe(this,e):e,n=My(s);r.enableDraped=r.include&&!r.include.has(Yp)||r.exclude&&r.exclude.has(Yp);const o=this.sceneIntersectionHelper,a=qd(this.state.viewingMode);if(a.options.selectionMode=!0,a.options.store=i?$o.ALL:$o.MIN,o.intersectIntersectorScreen(n,a,r),i){for(const l of a.results.all){const c=xJ(l,this);if(R(c))return this._intersectResultToMapPoint(l);if(c.type!=="graphic"||this._testGraphicUidFilter(r.graphics,c.graphic))return this._intersectResultToMapPoint(l)}return null}return this._intersectResultToMapPoint(a.results.min)}toScreen(e){if(!this.ready)return Tu.error("#toScreen()","Scene view cannot be used before it is ready"),null;const t=_t(e.z==null&&km(this.elevationProvider,e),0);return so(e,u2,this.renderSpatialReference,t),this.state.camera.projectToScreen(u2,wH),wf(wH[0],wH[1])}pixelSizeAt(e){return this.ready?e?(so(e,u2,this.renderSpatialReference),this.state.camera.computeScreenPixelSizeAt(u2)):0:(Tu.error("#pixelSizeAt()","Scene view cannot be used before it is ready"),null)}overlayPixelSizeInMapUnits(e){const t=this.basemapTerrain.overlayManager;return t?t.overlayPixelSizeInMapUnits(e):1}hitTest(e,t){if(!this.ready)return Tu.error("#hitTest()","Scene view cannot be used before it is ready"),null;const r=jhe(e)?Ghe(this,e):e,i=ts(r.x,r.y),s=t?this.externalToInternalIntersectOptions(t):this._defaultHitTestOptions;s.requiresGroundFeedback=!0,s.enableDraped=!0;const n=qd(this.state.viewingMode);n.options.selectionMode=!0,n.options.store=$o.ALL,this.sceneIntersectionHelper.intersectIntersectorScreen(i,n,s);const o=this._intersectResultsToHits(n.results.all,s.graphics),a=n.results.ground,l=Jye(a,this),c=b(l)&&"type"in l&&l.type==="integrated-mesh"?l:null,h={screenPoint:r,results:o,ground:{mapPoint:this._intersectResultToMapPoint(a),distance:xg(a)?a.distanceInRenderSpace:0,layer:c}};return Xr.SCENEVIEW_HITTEST_RETURN_INTERSECTOR&&(h.intersector=n),Promise.resolve(h)}async popupHitTest(e){const{results:t,ground:r}=await zOt(this,e);let i=null;return!(t.length===0||Math.abs(_t(t[0].distance,0)-r.distance)<1e-5)||r.layer&&r.layer.type==="integrated-mesh"||(i=r.mapPoint),{results:t,screenPoint:e,mapPoint:i}}goTo(e,t){return this.updatingHandles.addPromise(this.stateManager.goTo(e,t))}async whenAnalysisView(e){if(R(e.parent))throw new j("view:no-analysisview-for-analysis","The analysis has not been added to view.analyses",{analysis:e});return e.parent.type==="line-of-sight"?(await this.whenLayerView(e.parent)).whenAnalysisView():this.analysisViewManager.whenAnalysisView(e)}whenLayerView(e){return super.whenLayerView(e)}async takeScreenshot(e){const t=this._completeSettings(e);await this.whenReady();const r=await this._stage.renderView.takeScreenshot(t);return L0t(r,t,this._pixelFormat())}async _takeScreenshot(e){const t=this._completeSettings(e);await this.whenReady();const r=await this._stage.renderView.takeScreenshot(t);return D0t(r,this._pixelFormat())}_completeSettings(e){const t=$0t(e,this);return t.pixelRatio/=this.state.pixelRatio,V0t(t,this.supersampleScreenshotsEnabled,this.padding)}_pixelFormat(){return{flipY:!0,premultipliedAlpha:this._stage.renderView.getAlpha()}}get test(){return{takeScreenshot:e=>this._takeScreenshot(e)}}addUpdatingPromise(e){return this.updatingHandles.addPromise(e)}importLayerView(e){return Jhe.importLayerView(e)}hasLayerViewModule(e){return Jhe.hasLayerViewModule(e)}forceDOMReadyCycle(){this.forceReadyCycle()}getDefaultSpatialReference(){var e,t,r,i;return this.map&&"initialViewProperties"in this.map&&((t=(e=this.map)==null?void 0:e.initialViewProperties)==null?void 0:t.spatialReference)||((r=this.defaultsFromMap)==null?void 0:r.spatialReference)||((i=this.defaultsFromMap)==null?void 0:i.ready)&&this._initialDefaultSpatialReference||null}async validate(){let e=YOt(this.type);if(he("safari")&&he("safari")<9&&(e=new j("sceneview:browser-not-supported","This browser is not supported by SceneView (Safari < 9)",{type:"safari",requiredVersion:9,detectedVersion:he("safari")})),b(e))throw Tu.warn("#validate()",e.message),e}get _predeterminedViewingMode(){var t,r;const e=this._isOverridden("viewingMode")?this._get("viewingMode"):(r=this.map&&"initialViewProperties"in this.map?(t=this.map.initialViewProperties)==null?void 0:t.viewingMode:null)!=null?r:null;return b(e)?Zhe(e):null}getSpatialReferenceSupport({spatialReference:e,layer:t}){const r=this._predeterminedViewingMode;if(b(r))return this._validateSpatialReferenceForViewingMode(e,t,r)?{constraints:this._makeSpatialReferenceConstraints(e,t,r)}:null;const i=this._validateSpatialReferenceForViewingMode(e,t,Be.Local),s=this._validateSpatialReferenceForViewingMode(e,t,Be.Global);return i||s?i&&s?{constraints:this._makeSpatialReferenceConstraints(e,t,null)}:i?{constraints:this._makeSpatialReferenceConstraints(e,t,Be.Local)}:{constraints:this._makeSpatialReferenceConstraints(e,t,Be.Global)}:null}_validateSpatialReferenceForViewingMode(e,t,r){return!!i$(e,r)&&(!!R(t)||!!Oae(t)||(!aC(t)||!R(_8(t,e,r)))&&(!Rae(t)||r!==Be.Global))}_makeSpatialReferenceConstraints(e,t,r){if(R(t))return[{spatialReference:e,viewingMode:r}];const i=e.isWebMercator,s=e.isWGS84;return Oae(t)&&(i||s)?!s||r===Be.Local||b$(t.tileInfo,t.fullExtent,e,Be.Global)===null?[{spatialReference:e,viewingMode:r},{spatialReference:Ze.WebMercator,viewingMode:r}]:[{spatialReference:i?Ze.WGS84:Ze.WebMercator,viewingMode:r}]:aC(t)||Rae(t)||!i&&!s?aC(t)&&i&&r!==Be.Global?[{spatialReference:e,viewingMode:r},{spatialReference:Ze.WGS84,viewingMode:Be.Local}]:[{spatialReference:e,viewingMode:r}]:[{spatialReference:e,viewingMode:r},{spatialReference:i?Ze.WGS84:Ze.WebMercator,viewingMode:r}]}_validateSpatialReference(e){const t=b(this.getSpatialReferenceSupport({spatialReference:e})),r=this._predeterminedViewingMode;return t||(b(r)?Tu.warnOnce(`Spatial reference defined on view not supported in ${uP(r)} viewing mode.`):e.isGeographic&&Tu.warnOnce("Spatial reference is geographic but not supported.")),t}whenReady(){return new Promise(e=>{this.ready?e(this):this._resolveWhenReady.push(e)})}computeMapPointFromVec3d(e,t){let r=this.spatialReference||Ze.WGS84;return xn(e,this.renderSpatialReference,e,r)||(r=Ze.WGS84,xn(e,this.renderSpatialReference,e,r)),t?(t.x=e[0],t.y=e[1],t.z=e[2],t.spatialReference=r):t=new at(e,r),t}trackGraphicState(e){if(!e.graphic)return Tu.error("trackGraphicState","GraphicState.graphic must not be null or undefined to start tracking"),null;const t=this.getViewForGraphic(e.graphic);let r=null,i=!1;const s=n=>{var o;!i&&b(n)&&"processor"in n&&((o=n.processor)==null?void 0:o.type)==="graphics-3d"&&n.processor.graphicsCore&&(r=n.processor.graphicsCore.trackGraphicState(e))};return b(t)?s(t):this.whenViewForGraphic(e.graphic,{waitForLayer:!0}).then(n=>s(n),()=>{}).catch(()=>{}),{remove:()=>{i=!0,b(r)&&(r.remove(),r=null)}}}highlight(e){if(Array.isArray(e))return VC(e.map(r=>this.highlight(r)));if(ot.isCollection(e))return VC(e.toArray().map(r=>this.highlight(r)));const t=this.getViewForGraphic(e);return t&&"highlight"in t?t.highlight(e):kd()}maskOccludee(e){if(!e)return Tu.error("maskOccludee","GraphicState.graphic must not be null or undefined to mask an occludee"),null;const t=this.getViewForGraphic(e);let r=null,i=!1;const s=n=>{!i&&b(n)&&tit(n)&&(r=n.maskOccludee(e))};return b(t)?s(t):this.whenViewForGraphic(e,{waitForLayer:!0}).then(n=>s(n),()=>{}).catch(()=>{}),{remove:()=>{i=!0,b(r)&&(r.remove(),r=null)}}}getViewForGraphic(e){return e.layer===this.graphics?this.graphicsView:e.layer?this.allLayerViews.find(t=>t.layer===e.layer):null}graphicChanged(e){b(this.graphicsView)&&this.graphicsView.graphicChanged(e)}async whenViewForGraphic(e,t){if(e.layer===this)return await E1(()=>this.graphicsView),this.graphicsView;if(!e.layer||!this.map)throw new j("no-view-for-graphic");return t&&t.waitForLayer&&!this.map.allLayers.includes(e.layer)?new Promise((r,i)=>{const s=this.map.allLayers.on("change",n=>{n.added.includes(e.layer)&&(s.remove(),this.whenLayerView(e.layer).then(r,i))})}):this.whenLayerView(e.layer)}externalToInternalIntersectOptions(e){const t=this._externalToInternalRenderItems(e.include,IP.INCLUDE),r=this._externalToInternalRenderItems(e.exclude,IP.EXCLUDE);return{include:t.layerUids,exclude:r.layerUids,graphics:{include:t.graphicUids,exclude:r.graphicUids}}}_intersectResultToMapPoint(e,t){return e.getIntersectionPoint(u2)?(t=this.computeMapPointFromVec3d(u2,t),e.intersector===qi.TERRAIN&&this.basemapTerrain&&(t.z=_t(km(this.basemapTerrain,t),0)),t):null}_intersectResultsToHits(e,t){const r=new Array;let i=null;for(let s=0;s<e.length;s++){const n=e[s],o=Jye(n,this);if(b(o)&&(o===this.map.ground||"type"in o&&o.type==="integrated-mesh"))break;const a=xJ(n,this);if(R(a))continue;if(a.type==="graphic"){if(R(i)&&s!==e.length-1&&(i=new Set),b(i)){const h=this._getGraphicFilterUid(a.graphic);if(i.has(h))continue;i.add(h)}if(!this._testGraphicUidFilter(t,a.graphic))continue}const l=this._intersectResultToMapPoint(n),c=n.distanceInRenderSpace;r.push({...a,mapPoint:l,distance:c})}return r}_getGraphicFilterUid(e){if(e.layer&&"objectIdField"in e.layer){const t=e.attributes[e.layer.objectIdField];if(t)return`o-${e.layer.id}-${t}`}return`u-${e.uid}`}_testGraphicUidFilter(e,t){const r=this._getGraphicFilterUid(t);return R(e)||(R(e.include)||e.include.has(r))&&(R(e.exclude)||!e.exclude.has(r))}_externalToInternalRenderItems(e,t,r={layerUids:null,graphicUids:null}){if(!e)return r;if(e instanceof gl)uMt(r,this._getGraphicFilterUid(e)),t===IP.INCLUDE&&(b(this.graphicsView)&&e.layer===this?iM(r,this.graphicsView.processor.layer.id):e.layer&&iM(r,e.layer.uid));else if(G_e(e))for(const i of e)i===this.graphics&&b(this.graphicsView)?iM(r,this.graphicsView.processor.layer.id):i===this.map.ground?iM(r,Yp):this._externalToInternalRenderItems(i,t,r);else"uid"in e&&iM(r,e.uid);return r}_initBasemapTerrain(){this._set("basemapTerrain",new L2t({view:this})),this._set("elevationProvider",new v3({view:this})),this.elevationProvider.register("ground",this.basemapTerrain)}_exitBasemapTerrain(){this.basemapTerrain&&(this.elevationProvider.unregister(this.basemapTerrain),this.elevationProvider.destroy(),this._set("elevationProvider",null),this.basemapTerrain.destroy(),this._set("basemapTerrain",null))}_initGlobe(){this._initCoordinateSystem(),this.state.createInitialCamera(),this._initBasemapTerrain(),this._set("pointsOfInterest",new va({view:this})),this._set("featureTiles",new _o({renderCoordsHelper:this.renderCoordsHelper,cameraOnSurface:this.pointsOfInterest.contentCameraOnSurface,focus:this.pointsOfInterest.focus,tilingSchemeOwner:this.basemapTerrain,viewState:this.state,scheduler:this._resourceController.scheduler,terrain:this.basemapTerrain}));const e=()=>{var r;const t=(r=this.basemapTerrain)==null?void 0:r.extent;if(this.clippingArea||t)if(t&&this.basemapTerrain.spatialReference){const i=b(this.basemapTerrain.extent)?Q$(a6(this.basemapTerrain.extent,this.basemapTerrain.spatialReference),this.spatialReference):null;b(this.clippingArea)?this.featureTiles.filterExtent=this.clippingArea.intersection(i):this.featureTiles.filterExtent=i}else this.featureTiles.filterExtent=this.clippingArea;else this.featureTiles.filterExtent=null};this.handles.add([this.updatingHandles.add(()=>Xr.FEATURE_TILE_TREE_SHOW_TILES,t=>{t&&this.featureTiles&&!this.featureTreeDebugger?this.updatingHandles.addPromise(ie(()=>import("./FeatureTileTree3DDebugger.1c979dad.js"),["FeatureTileTree3DDebugger.1c979dad.js","TileTreeDebugger.d9a3080b.js"],import.meta.url)).then(({FeatureTileTree3DDebugger:r})=>{!this.featureTreeDebugger&&Xr.FEATURE_TILE_TREE_SHOW_TILES&&(this.featureTreeDebugger=new r({view:this}))}):t||!this.featureTreeDebugger||Xr.FEATURE_TILE_TREE_SHOW_TILES||(this.featureTreeDebugger.destroy(),this.featureTreeDebugger=null)},Xs),this.updatingHandles.add(()=>this.clippingArea,e,Xs),this.updatingHandles.add(()=>this.basemapTerrain.extent,e,Xs)],"feature-tiles"),this.stateManager.init()}_exitGlobe(){this.state&&(this.stateManager.deinit(),this.handles.remove("render-coords-helper"),this.handles.remove("feature-tiles"),this.featureTiles.destroy(),this._set("featureTiles",null),this.pointsOfInterest.destroy(),this._set("pointsOfInterest",null),this._exitBasemapTerrain(),this.state.exit(),this._exitCoordinateSystem())}_initCoordinateSystem(){if(this.spatialReference){const e=this.spatialReference;this.mapCoordsHelper&&this.mapCoordsHelper.spatialReference.equals(e)||this._set("mapCoordsHelper",new Qwt(this.map,e));const t=this.state.isGlobal,r=pSe(t,e);r!==this.renderSpatialReference&&(this._set("renderCoordsHelper",dz.create(this.state.viewingMode,r)),t||this.handles.add(te(()=>{var i;return(i=this.basemapTerrain)==null?void 0:i.extent},i=>{const s=this.renderCoordsHelper.spatialReference;i&&(i[0]!==0||i[1]!==0||i[2]!==0||i[3]!==0)&&T6(i,this.basemapTerrain.spatialReference,s0e,s)&&(this.renderCoordsHelper.extent=s0e)},ei),"render-coords-helper"),this.sceneIntersectionHelper&&this.sceneIntersectionHelper.setTolerance(NA/this.renderCoordsHelper.unitInMeters))}else this._set("mapCoordsHelper",null),this._set("renderCoordsHelper",null)}_exitCoordinateSystem(){this.mapCoordsHelper&&(this.handles.remove("render-coords-helper"),this._set("renderCoordsHelper",null),this._set("mapCoordsHelper",null))}_updatingChanged(){this.notifyChange("updating")}_updateUpdatingMonitors(e=null){b(e)&&e.type===Qr.MOVE||(this.handles.remove("updatingMonitors"),this.allLayerViews.forEach(t=>{t.destroyed||(this.handles.add(te(()=>[t.updating,t.updatingProgress],()=>this._updatingChanged(),ei),"updatingMonitors"),t.when(()=>this._updatingChanged(),()=>this._updatingChanged()))}),this._updatingChanged())}_renderScreenshotOverlay(e,t){if(!this.overlay||!this.overlay.hasVisibleItems)return t;const r=e.getContext("2d");return r.putImageData(t,0,0),this.overlay.renderCanvas(e),r.getImageData(0,0,t.width,t.height)}_initStage(){const e={deactivatedWebGLExtensions:this.deactivatedWebGLExtensions,debugWebGLExtensions:this.debugWebGLExtensions,alpha:this.alphaCompositingEnabled,preserveDrawingBuffer:this.preserveDrawingBufferEnabled,canvas:this.renderCanvas,screenshot:{renderOverlay:(a,l)=>this._renderScreenshotOverlay(a,l)}},t=new Dwt(this.state.viewingMode,a=>this._stage.layers.forAll(a),this);this._set("sceneIntersectionHelper",t);const r=y6(this.surface),{resourceController:i,state:s,renderSpatialReference:n}=this;this._stage=new Nl({options:e,container:r,resourceController:i,state:s,sceneIntersectionHelper:t,renderSR:n}),this._stage.renderView.setRenderParameters({slicePlane:this.slicePlane}),this._lostWebGLContextHandle=V$(this._stage.renderView.canvas,"webglcontextlost",()=>this.fatalError=new j("webgl-context-lost")),this.handles.add([this.updatingHandles.add(()=>this.qualitySettings.antialiasingEnabled,()=>this._stage.renderView.setRenderParameters({antialiasingEnabled:this.qualitySettings.antialiasingEnabled}),Rt),this.updatingHandles.add(()=>this.qualitySettings.highQualityTransparency,()=>this._stage.renderView.setRenderParameters({highQualityTransparency:this.qualitySettings.highQualityTransparency}),Rt),te(()=>this.magnifier,a=>this._stage.renderView.magnifier=a,Xs)],"stage");const o=()=>{this._stage.renderView.setRenderParameters({defaultHighlightOptions:XQ.toEngineOptions(this.highlightOptions)})};this.handles.add(this.updatingHandles.add(()=>[this.highlightOptions.color,this.highlightOptions.haloColor,this.highlightOptions.haloOpacity,this.highlightOptions.fillOpacity,this.highlightOptions.shadowOpacity,this.highlightOptions.shadowColor,this.highlightOptions.shadowDifference],o),"stage"),o(),this.renderCoordsHelper&&this.sceneIntersectionHelper.setTolerance(NA/this.renderCoordsHelper.unitInMeters),this._set("canvas",this._stage.renderView.canvas)}_exitStage(){this._set("sceneIntersectionHelper",null),this._stage.destroy(),this._stage=null,this._lostWebGLContextHandle.remove(),this._lostWebGLContextHandle=null,this.handles.remove("stage"),this._set("canvas",null)}_initSurface(e){this._exitSurface(),this.state.init(e,this.spatialReference),this._initStage(),this._initGlobe(),this.sharedSymbolResources=new Nxt({view:this,viewingMode:e,resourceController:this._resourceController,pointsOfInterest:this.pointsOfInterest,viewState:this.state,objectResourceCache:new Ubt})}_exitSurface(){this.sharedSymbolResources&&(this.sharedSymbolResources.objectResourceCache.destroy(),this.sharedSymbolResources.destroy(),this.sharedSymbolResources=null,this._exitGlobe(),this._exitStage())}_createGraphicsViewIfNeeded(){if(this.graphicsView||this._createGraphicsViewController||this.graphics.length===0)return;this.handles.remove("graphics-view"),this._createGraphicsViewController=new AbortController;const e=()=>{this._createGraphicsViewController=null,this._updatingChanged()};this._createGraphicsViewAsync(this._createGraphicsViewController.signal).then(e,e),this._updatingChanged()}async _createGraphicsViewAsync(e){const t=(await ie(()=>import("./GraphicsView3D.5fdd529c.js"),["GraphicsView3D.5fdd529c.js","GraphicsProcessor.281b3aff.js","Graphics3DScaleVisibility.935d1efb.js","optimizedFeatureQueryEngineAdapter.ccd4095f.js","centroid.b6fe1cdb.js","PooledRBush.240e2876.js","quickselect.bb286034.js","Graphics3DObjectStates.f45b9ab1.js"],import.meta.url)).default;Jt(e),await E1(()=>{var r;return(r=this.basemapTerrain)==null?void 0:r.ready},e),this._set("graphicsView",new t({view:this}))}_disposeGraphicsView(){this._createGraphicsViewController&&(this._createGraphicsViewController.abort(),this._createGraphicsViewController=null),this.handles.remove("graphics-view"),b(this.graphicsView)&&(this.handles.remove(this.graphicsView.processor.layer.id),this.graphicsView.destroy(),this._set("graphicsView",null))}_startup(){const e=Zhe(this.viewingMode);if(e===Be.Global&&(this._clippingArea=null),this._initSurface(e),this._set("ready",!0),this.handles.add(rs(()=>this.graphics,"after-changes",()=>this._createGraphicsViewIfNeeded()),"graphics-view"),this._createGraphicsViewIfNeeded(),!this._externallySet.environment){const r=this.get("map.initialViewProperties.environment");r&&(this.environment=r)}this.labeler.setup(),this.environmentManager.connectView(this),this.inputManager.connect();const t=this._resolveWhenReady;this._resolveWhenReady=[],t.forEach(r=>r(this))}_teardown(){this._initialDefaultSpatialReference=null,this.inputManager.disconnect(),this.environmentManager.disconnectView(),this.labeler.dispose(),this._disposeGraphicsView(),this.handles.remove("graphics-view"),this._exitSurface(),this._set("ready",!1)}_updateDefaultToMapOptions(){if(this._defaultToMapOptions.include.clear(),this.map){this.map.ground&&this._defaultToMapOptions.include.add(Yp);for(const e of this.map.allLayers.items)e.type==="integrated-mesh"&&this._defaultToMapOptions.include.add(e.uid)}}_updateDefaultHitTestOptions(){if(this._defaultHitTestOptions.exclude.clear(),this.map){this.map.ground&&this.map.ground.opacity<1&&this._defaultHitTestOptions.exclude.add(Yp);for(const e of this.map.allLayers.items)e.type==="integrated-mesh"&&e.opacity<1&&this._defaultToMapOptions.exclude.add(e.uid)}}addVoxelLayerViewToWasm(e){return R(this.voxelWasm)?(R(this.voxelWasmPromise)&&(this.voxelWasmPromise=ie(()=>import("./VoxelWasmPerSceneView.d9f1434b.js"),[],import.meta.url).then(t=>(this.voxelWasm=new t.default(this),this.voxelWasm))),this.voxelWasmPromise.then(t=>t.addVoxelLayer(e))):this.voxelWasm.addVoxelLayer(e)}removeVoxelLayerViewFromWasm(e){b(this.voxelWasm)&&this.voxelWasm.removeVoxelLayer(e)<1&&(this.voxelWasm=null,this.voxelWasmPromise=null)}};function iM(e,t){e.layerUids||(e.layerUids=new Set),e.layerUids.add(t)}function uMt(e,t){e.graphicUids||(e.graphicUids=new Set),e.graphicUids.add(t)}function h4(e,t){return b(e)&&sg(e.spatialReference,t)?Q$(e,t):null}var IP;it.type="3d",u([d()],it.prototype,"_userClippingArea",void 0),u([d()],it.prototype,"_resourceController",void 0),u([d()],it.prototype,"_stage",void 0),u([d({readOnly:!0})],it.prototype,"deconflictor",void 0),u([d({readOnly:!0})],it.prototype,"labeler",void 0),u([d(bX(fA,"analyses"))],it.prototype,"analyses",void 0),u([d({type:xA,readOnly:!0,aliasOf:"state.animation"})],it.prototype,"animation",void 0),u([d({readOnly:!0})],it.prototype,"basemapTerrain",void 0),u([d({readOnly:!0})],it.prototype,"elevationProvider",void 0),u([d({type:ou,aliasOf:"stateManager.camera"})],it.prototype,"camera",void 0),u([d({type:ou,aliasOf:"stateManager.contentCamera"})],it.prototype,"contentCamera",void 0),u([d({readOnly:!0})],it.prototype,"canvas",void 0),u([d({type:at,aliasOf:"stateManager.center"})],it.prototype,"center",void 0),u([d({type:Kt})],it.prototype,"clippingArea",null),u([d({type:ix})],it.prototype,"constraints",void 0),u([d({type:Kt,readOnly:!0})],it.prototype,"renderDataExtent",null),u([d({type:Kt,readOnly:!0})],it.prototype,"dataExtent",null),u([d({type:Kt,readOnly:!0})],it.prototype,"groundAndLayersExtent",null),u([d({value:null,type:X2})],it.prototype,"environment",null),u([qt("environment")],it.prototype,"castEnvironment",null),u([d({readOnly:!0})],it.prototype,"environmentManager",void 0),u([d({type:Kt,aliasOf:"stateManager.extent"})],it.prototype,"extent",void 0),u([d()],it.prototype,"floors",void 0),u([d({readOnly:!0,aliasOf:"stateManager.screenCenter"})],it.prototype,"screenCenter",void 0),u([d({aliasOf:"stateManager.frustum"})],it.prototype,"frustum",void 0),u([d({type:Number,readOnly:!0})],it.prototype,"fullOpacity",void 0),u([d({readOnly:!0})],it.prototype,"graphicsView",void 0),u([d({readOnly:!0})],it.prototype,"analysisViewManager",void 0),u([d()],it.prototype,"groundView",void 0),u([d({type:Boolean})],it.prototype,"initialExtentRequired",null),u([d()],it.prototype,"_defaultsFromMapSettings",null),u([d({type:Boolean,readOnly:!0})],it.prototype,"interacting",null),u([d()],it.prototype,"stationary",null),u([d({aliasOf:"state.navigating"})],it.prototype,"navigating",void 0),u([d()],it.prototype,"map",void 0),u([d({readOnly:!0})],it.prototype,"mapCoordsHelper",void 0),u([d({aliasOf:"stateManager.padding"})],it.prototype,"padding",void 0),u([d({type:va,readOnly:!0})],it.prototype,"pointsOfInterest",void 0),u([d({type:_o,readOnly:!0})],it.prototype,"featureTiles",void 0),u([d()],it.prototype,"featureTreeDebugger",void 0),u([d({type:Boolean})],it.prototype,"screenSizePerspectiveEnabled",void 0),u([d({constructOnly:!0})],it.prototype,"deactivatedWebGLExtensions",void 0),u([d({constructOnly:!0})],it.prototype,"debugWebGLExtensions",void 0),u([d({constructOnly:!0})],it.prototype,"renderCanvas",void 0),u([d({constructOnly:!0})],it.prototype,"state",void 0),u([d({readOnly:!0})],it.prototype,"inputManager",void 0),u([d({readOnly:!0})],it.prototype,"stateManager",void 0),u([d({type:["low","medium","high"]})],it.prototype,"qualityProfile",null),u([d({type:rge,get(){let e=this._get("qualitySettings");return e||(e=new rge,hk.apply(this.qualityProfile,e)),e}})],it.prototype,"qualitySettings",void 0),u([d()],it.prototype,"slicePlane",null),u([d({readOnly:!0})],it.prototype,"typeSpecificPreconditionsReady",null),u([d({readOnly:!0})],it.prototype,"renderCoordsHelper",void 0),u([d({readOnly:!0})],it.prototype,"sceneIntersectionHelper",void 0),u([d({type:Number,dependsOn:["scale","spatialReference"],readOnly:!0})],it.prototype,"resolution",null),u([d({type:Number,aliasOf:"stateManager.scale"})],it.prototype,"scale",void 0),u([d()],it.prototype,"heightModelInfo",null),u([d()],it.prototype,"spatialReference",void 0),u([d({type:Boolean,constructOnly:!0})],it.prototype,"alphaCompositingEnabled",void 0),u([d({constructOnly:!0})],it.prototype,"preserveDrawingBufferEnabled",void 0),u([d({type:Boolean})],it.prototype,"supersampleScreenshotsEnabled",void 0),u([d({readOnly:!0})],it.prototype,"type",void 0),u([d({type:rDe})],it.prototype,"ui",void 0),u([d({type:Boolean,readOnly:!0,dependsOn:["graphicsView.updating","basemapView.updating","basemapTerrain.updating","layerViewManager.updating","layerViewManager.updatingRemaining","_resourceController.updating","_stage.updating","featureTiles.updating","pointsOfInterest.updating","environmentManager.updating","overlay.updating","updatingHandles.updating","featureTreeDebugger.updating","labeler.updating","deconflictor.updating","ready","stationary","inputManager.hasPendingInputs","toolViewManager.updating","analysisViewManager.updating"]})],it.prototype,"updating",null),u([d({type:Number,readOnly:!0,dependsOn:["updating"]})],it.prototype,"updatingProgress",void 0),u([d({type:["global","local"]})],it.prototype,"viewingMode",null),u([d({type:Vd,aliasOf:"stateManager.viewpoint"})],it.prototype,"viewpoint",void 0),u([d({type:Number,aliasOf:"stateManager.zoom"})],it.prototype,"zoom",void 0),u([d({type:XQ})],it.prototype,"highlightOptions",void 0),it=u([$("esri.views.SceneView")],it),function(e){e[e.INCLUDE=0]="INCLUDE",e[e.EXCLUDE=1]="EXCLUDE"}(IP||(IP={}));const u2=M(),wH=ts(),s0e=Ut(),hMt=it,O$=-1;let vm=class extends xe{constructor(e){super(e),this._from=null,this._to=null,this._final=null,this._current=[],this._time=0,this.duration=he("mapview-transitions-duration"),this.effects=[]}set effect(e){if(this._get("effect")!==(e=e||"")){this._set("effect",e);try{this._transitionTo(n0e(e))}catch(t){this._transitionTo([]),fe.getLogger(this.declaredClass).warn("Invalid Effect",{effect:e,error:t})}}}get hasEffects(){return this.transitioning||!!this.effects.length}set scale(e){this._updateForScale(e)}get transitioning(){return this._to!==null}canTransitionTo(e){try{return this.scale>0&&o0e(this._current,n0e(e),this.scale)}catch{return!1}}transitionStep(e,t){this._applyTimeTransition(e),this._updateForScale(t)}end(){this._applyTimeTransition(this.duration)}_transitionTo(e){this.scale>0&&o0e(this._current,e,this.scale)?(this._final=e,this._to=re(e),dMt(this._current,this._to,this.scale),this._from=re(this._current),this._time=0):(this._from=this._to=this._final=null,this._current=e),this._set("effects",this._current[0]?re(this._current[0].effects):[])}_applyTimeTransition(e){if(!(this._to&&this._from&&this._current&&this._final))return;this._time+=e;const t=Math.min(1,this._time/this.duration);for(let r=0;r<this._current.length;r++){const i=this._current[r],s=this._from[r],n=this._to[r];i.scale=pMt(s.scale,n.scale,t);for(let o=0;o<i.effects.length;o++){const a=i.effects[o],l=s.effects[o],c=n.effects[o];a.interpolate(l,c,t)}}t===1&&(this._current=this._final,this._set("effects",this._current[0]?re(this._current[0].effects):[]),this._from=this._to=this._final=null)}_updateForScale(e){if(this._set("scale",e),this._current.length===0)return;const t=this._current,r=this._current.length-1;let i,s,n=1;if(t.length===1||e>=t[0].scale)s=i=t[0].effects;else if(e<=t[r].scale)s=i=t[r].effects;else for(let o=0;o<r;o++){const a=t[o],l=t[o+1];if(a.scale>=e&&l.scale<=e){n=(e-a.scale)/(l.scale-a.scale),i=a.effects,s=l.effects;break}}for(let o=0;o<this.effects.length;o++)this.effects[o].interpolate(i[o],s[o],n)}};function n0e(e){const t=zte(e)||[];return fMt(t)?[{scale:O$,effects:t}]:t}function o0e(e,t,r){var i,s,n,o;return!((i=e[0])!=null&&i.effects)||!((s=t[0])!=null&&s.effects)?!0:!((((n=e[0])==null?void 0:n.scale)===O$||((o=t[0])==null?void 0:o.scale)===O$)&&(e.length>1||t.length>1)&&r<=0)&&A2e(e[0].effects,t[0].effects)}function dMt(e,t,r){var l,c;const i=e.length>t.length?e:t,s=e.length>t.length?t:e,n=s[s.length-1],o=(l=n==null?void 0:n.scale)!=null?l:r,a=(c=n==null?void 0:n.effects)!=null?c:[];for(let h=s.length;h<i.length;h++)s.push({scale:o,effects:[...a]});for(let h=0;h<i.length;h++)s[h].scale=s[h].scale===O$?r:s[h].scale,i[h].scale=i[h].scale===O$?r:i[h].scale,R2e(s[h].effects,i[h].effects)}function pMt(e,t,r){return e+(t-e)*r}function fMt(e){const t=e[0];return!!t&&"type"in t}u([d()],vm.prototype,"_to",void 0),u([d()],vm.prototype,"duration",void 0),u([d({value:""})],vm.prototype,"effect",null),u([d({readOnly:!0})],vm.prototype,"effects",void 0),u([d({readOnly:!0})],vm.prototype,"hasEffects",null),u([d({value:0})],vm.prototype,"scale",null),u([d({readOnly:!0})],vm.prototype,"transitioning",null),vm=u([$("esri.layers.effects.EffectView")],vm);function yNt(e){var r;const t=e.layer;return"floorInfo"in t&&((r=t.floorInfo)==null?void 0:r.floorField)&&"floors"in e.view?iDe(e.view.floors,t.floorInfo.floorField):null}function a0e(e,t){var r;return"floorInfo"in t&&((r=t.floorInfo)==null?void 0:r.floorField)?iDe(e,t.floorInfo.floorField):null}function iDe(e,t){if(!(e!=null&&e.length))return null;const r=e.filter(i=>i!=="").map(i=>`'${i}'`);return r.push("''"),`${t} IN (${r.join(",")}) OR ${t} IS NULL`}function vNt(e,t,r){return t.flatten(({sublayers:s})=>s).length!==e.length?!0:!!e.some(s=>s.originIdOf("minScale")>r||s.originIdOf("maxScale")>r||s.originIdOf("renderer")>r||s.originIdOf("labelingInfo")>r||s.originIdOf("opacity")>r||s.originIdOf("labelsVisible")>r||s.originIdOf("source")>r)||!sDe(e,t)}function mMt(e,t,r){return!!e.some(i=>{const s=i.source;return!(!s||s.type==="map-layer"&&s.mapLayerId===i.id&&(R(s.gdbVersion)||s.gdbVersion===r))||i.originIdOf("renderer")>Bt.SERVICE||i.originIdOf("labelingInfo")>Bt.SERVICE||i.originIdOf("opacity")>Bt.SERVICE||i.originIdOf("labelsVisible")>Bt.SERVICE})||!sDe(e,t)}function sDe(e,t){if(!e||!e.length||R(t))return!0;const r=t.slice().reverse().flatten(({sublayers:n})=>n&&n.toArray().reverse()).map(n=>n.id).toArray();if(e.length>r.length)return!1;let i=0;const s=r.length;for(const{id:n}of e){for(;i<s&&r[i]!==n;)i++;if(i>=s)return!1}return!0}function _Nt(e){return!!e&&e.some(t=>t.minScale!=null||t.layerDefinition&&t.layerDefinition.minScale!=null)}const gMt={visible:"visibleSublayers",definitionExpression:"layerDefs",labelingInfo:"hasDynamicLayers",labelsVisible:"hasDynamicLayers",opacity:"hasDynamicLayers",minScale:"visibleSublayers",maxScale:"visibleSublayers",renderer:"hasDynamicLayers",source:"hasDynamicLayers"};let Lu=class extends pg(xe){constructor(e){super(e),this.floors=null,this.scale=0}destroy(){this.layer=null}get dynamicLayers(){if(!this.hasDynamicLayers)return null;const e=this.visibleSublayers.map(t=>{const r=a0e(this.floors,t);return t.toExportImageJSON(r)});return e.length?JSON.stringify(e):null}get hasDynamicLayers(){return this.layer&&mMt(this.visibleSublayers,this.layer.serviceSublayers,this.layer.gdbVersion)}set layer(e){this._get("layer")!==e&&(this._set("layer",e),this.handles.remove("layer"),e&&this.handles.add([e.allSublayers.on("change",()=>this.notifyChange("visibleSublayers")),e.on("sublayer-update",t=>this.notifyChange(gMt[t.propertyName]))],"layer"))}get layers(){const e=this.visibleSublayers;return e?e.length?"show:"+e.map(t=>t.id).join(","):"show:-1":null}get layerDefs(){var r;const e=!!((r=this.floors)!=null&&r.length),t=this.visibleSublayers.filter(i=>i.definitionExpression!=null||e&&i.floorInfo!=null);return t.length?JSON.stringify(t.reduce((i,s)=>{const n=a0e(this.floors,s),o=KCe(n,s.definitionExpression);return b(o)&&(i[s.id]=o),i},{})):null}get version(){this.commitProperty("layers"),this.commitProperty("layerDefs"),this.commitProperty("dynamicLayers"),this.commitProperty("timeExtent");const e=this.layer;return e&&(e.commitProperty("dpi"),e.commitProperty("imageFormat"),e.commitProperty("imageTransparency"),e.commitProperty("gdbVersion")),(this._get("version")||0)+1}get visibleSublayers(){const e=[];if(!this.layer)return e;const t=this.layer.sublayers,r=s=>{const n=this.scale,o=n===0,a=s.minScale===0||n<=s.minScale,l=s.maxScale===0||n>=s.maxScale;s.visible&&(o||a&&l)&&(s.sublayers?s.sublayers.forEach(r):e.unshift(s))};t&&t.forEach(r);const i=this._get("visibleSublayers");return!i||i.length!==e.length||i.some((s,n)=>e[n]!==s)?e:i}toJSON(){const e=this.layer;let t={dpi:e.dpi,format:e.imageFormat,transparent:e.imageTransparency,gdbVersion:e.gdbVersion||null};return this.hasDynamicLayers&&this.dynamicLayers?t.dynamicLayers=this.dynamicLayers:t={...t,layers:this.layers,layerDefs:this.layerDefs},t}};u([d({readOnly:!0})],Lu.prototype,"dynamicLayers",null),u([d()],Lu.prototype,"floors",void 0),u([d({readOnly:!0})],Lu.prototype,"hasDynamicLayers",null),u([d()],Lu.prototype,"layer",null),u([d({readOnly:!0})],Lu.prototype,"layers",null),u([d({readOnly:!0})],Lu.prototype,"layerDefs",null),u([d({type:Number})],Lu.prototype,"scale",void 0),u([d(bet)],Lu.prototype,"timeExtent",void 0),u([d({readOnly:!0})],Lu.prototype,"version",null),u([d({readOnly:!0})],Lu.prototype,"visibleSublayers",null),Lu=u([$("esri.layers.mixins.ExportImageParameters")],Lu);function nDe(e){return R(e)||e.type==="simple"||e.type==="unique-value"||e.type==="class-breaks"||e.type==="dictionary"||e.type==="heatmap"}function bNt(e){if(R(e))return null;if(!nDe(e))return new j("renderer-conversion-3d:unsupported-renderer",`Unsupported renderer of type '${e.type||e.declaredClass}'`,{renderer:e});switch(e.type){case"simple":return yMt(e);case"unique-value":return vMt(e);case"class-breaks":return _Mt(e);case"dictionary":case"heatmap":return null}return null}function vne(e,t){if(!t)return null;let r;if(r=Array.isArray(t)?t:[t],r.length>0){const i=r.map(n=>n.details.symbol.type||n.details.symbol.declaredClass).filter(n=>!!n);i.sort();const s=[];return i.forEach((n,o)=>{o!==0&&n===i[o-1]||s.push(n)}),new j("renderer-conversion-3d:unsupported-symbols",`Renderer contains symbols (${s.join(", ")}) which are not supported in 3D`,{renderer:e,symbolErrors:r})}return null}function yMt(e){return vne(e,_A(e.symbol).error)}function vMt(e){const t=e.uniqueValueInfos.map(i=>_A(i.symbol).error).filter(i=>!!i),r=_A(e.defaultSymbol);return r.error&&t.unshift(r.error),vne(e,t)}function _Mt(e){const t=e.classBreakInfos.map(i=>_A(i.symbol).error).filter(i=>!!i),r=_A(e.defaultSymbol);return r.error&&t.unshift(r.error),vne(e,t)}const bMt=(e,t)=>{const r=e.featuresTilingScheme.getClosestInfoForScale(e.scale).level;return t!=null&&t.levels?t.levels[r]:null};function wMt(e,t){if(!e||!("visualVariables"in e)||!e.visualVariables)return null;const r=e.visualVariables.find(s=>s.type==="size"),i=bMt(t,r);return i?new wre({field:r.field,minSize:i[2].size,minDataValue:i[2].value,maxSize:i[3].size,maxDataValue:i[3].value}):null}function oDe(e,t,r,i){return e.name?e.styleName&&e.styleName==="Esri2DPointSymbolsStyle"?xMt(e,t,i):ZCe(e,t,i).then(s=>aDe(s,e.name,t,r,i)):Promise.reject(new j("symbolstyleutils:style-symbol-reference-name-missing","Missing name in style symbol reference"))}function aDe(e,t,r,i,s){const n=e.data,o=r&&b(r.portal)?r.portal:Sn.getDefault(),a={portal:o,url:Ds(e.baseUrl),origin:"portal-item"},l=n.items.find(m=>m.name===t);if(!l){const m=`The symbol name '${t}' could not be found`;return Promise.reject(new j("symbolstyleutils:symbol-name-not-found",m,{symbolName:t}))}let c=d0(DKe(l,i),a),h=l.thumbnail&&l.thumbnail.href;const p=l.thumbnail&&l.thumbnail.imageData;Avt()&&(c=BQ(c),h=BQ(h));const f={portal:o,url:Ds(eee(c)),origin:"portal-item"};return Ere(c,s).then(m=>{const g=i==="cimRef"?YCe(m.data):m.data,v=zCe(g,f);if(v&&tg(v)){if(h){const w=d0(h,a);v.thumbnail=new Fx({url:w})}else p&&(v.thumbnail=new Fx({url:`data:image/png;base64,${p}`}));e.styleUrl?v.styleOrigin=new dI({portal:r.portal,styleUrl:e.styleUrl,name:t}):e.styleName&&(v.styleOrigin=new dI({portal:r.portal,styleName:e.styleName,name:t}))}return v})}function xMt(e,t,r){const i=NKe.replace(/\{SymbolName\}/gi,e.name),s=b(t.portal)?t.portal:Sn.getDefault();return Ere(i,r).then(n=>{const o=YCe(n.data);return zCe(o,{portal:s,url:Ds(eee(i)),origin:"portal-item"})})}const TMt=Object.freeze(Object.defineProperty({__proto__:null,fetchSymbolFromStyle:aDe,resolveWebStyleSymbol:oDe},Symbol.toStringTag,{value:"Module"})),cx=no.size,Mk=no.maxSize,_ne=no.maxOutlineSize,l0e=no.lineWidth,TJ=no.tallSymbolWidth,SMt=fe.getLogger("esri.symbols.support.previewSymbol3D");function XE(e){const t=e.outline,r=b(e.material)?e.material.color:null,i=b(r)?r.toHex():null;if(R(t)||"pattern"in t&&b(t.pattern)&&t.pattern.type==="style"&&t.pattern.style==="none")return e.type==="fill"&&i==="#ffffff"?{color:"#bdc3c7",width:.75}:null;const s=yr(t.size)||0;return{color:"rgba("+(b(t.color)?t.color.toRgba():"255,255,255,1")+")",width:Math.min(s,_ne),style:"pattern"in t&&b(t.pattern)&&t.pattern.type==="style"?Zte(t.pattern.style):null,join:"butt",cap:"patternCap"in t?t.patternCap:"butt"}}function EMt(e,t){const r=t&&t.resource,i=r&&r.href;if(e.thumbnail&&e.thumbnail.url)return Promise.resolve(e.thumbnail.url);if(i&&t.type!=="object")return Promise.resolve(N2e(e,t));const s=wr("esri/images/Legend/legend3dsymboldefault.png");return e.styleOrigin&&(e.styleOrigin.styleName||e.styleOrigin.styleUrl)?oDe(e.styleOrigin,{portal:e.styleOrigin.portal},"webRef").catch(n=>n).then(n=>{var o;return((o=n==null?void 0:n.thumbnail)==null?void 0:o.url)||s}):Promise.resolve(s)}function xH(e,t=1){const r=e.a,i=qre(e),s=i.h,n=i.s/t,o=100-(100-i.v)/t,{r:a,g:l,b:c}=pL({h:s,s:n,v:o});return[a,l,c,r]}function Sz(e){return e.type==="water"?R(e.color)?null:e.color:R(e.material)||R(e.material.color)?null:e.material.color}function Ri(e,t=0){const r=Sz(e);if(!r){if(e.type==="fill")return null;const s=WWe.r,n=d1(s,t);return[n,n,n,100]}const i=r.toRgba();for(let s=0;s<3;s++)i[s]=d1(i[s],t);return i}async function lDe(e,t){const r=e.style;return r==="none"?null:{type:"pattern",x:0,y:0,src:await qWe(wr(`esri/symbols/patterns/${r}.png`),t.toCss(!0)),width:5,height:5}}function c0e(e){return e.outline?XE(e):{color:"rgba(0, 0, 0, 1)",width:1.5}}function cDe(e,t){const r=Sz(e);if(!r)return null;let i="rgba(";return i+=d1(r.r,t)+",",i+=d1(r.g,t)+",",i+=d1(r.b,t)+",",i+r.a+");"}function SJ(e,t){const r=cDe(e,t);return r?"pattern"in e&&b(e.pattern)&&e.pattern.type==="style"&&e.pattern.style==="none"?null:{color:r,width:Math.min(e.size?yr(e.size):.75,_ne),style:"pattern"in e&&b(e.pattern)&&e.pattern.type==="style"?Zte(e.pattern.style):null,cap:"cap"in e?e.cap:null,join:"join"in e?e.join==="miter"?yr(2):e.join:null}:{}}function d4(e,t,r){const i=.75*r;return{type:"linear",x1:i?.25*i:0,y1:i?.5*i:0,x2:i||4,y2:i?.5*i:4,colors:[{color:e,offset:0},{color:t,offset:1}]}}function CMt(e){const t=e.depth,r=e.height,i=e.width;return i&&t&&r&&i===t&&i<r}function AMt(e,t,r){const i=[];if(!e)return i;switch(e.type){case"icon":{const o=t,a=t;switch(e.resource&&e.resource.primitive||uxe){case"circle":i.push({shape:{type:"circle",cx:0,cy:0,r:.5*t},fill:Ri(e,0),stroke:XE(e)});break;case"square":i.push({shape:{type:"path",path:[{command:"M",values:[0,a]},{command:"L",values:[0,0]},{command:"L",values:[o,0]},{command:"L",values:[o,a]},{command:"Z",values:[]}]},fill:Ri(e,0),stroke:XE(e)});break;case"triangle":i.push({shape:{type:"path",path:[{command:"M",values:[0,a]},{command:"L",values:[.5*o,0]},{command:"L",values:[o,a]},{command:"Z",values:[]}]},fill:Ri(e,0),stroke:XE(e)});break;case"cross":i.push({shape:{type:"path",path:[{command:"M",values:[.5*o,0]},{command:"L",values:[.5*o,a]},{command:"M",values:[0,.5*a]},{command:"L",values:[o,.5*a]}]},stroke:c0e(e)});break;case"x":i.push({shape:{type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[o,a]},{command:"M",values:[o,0]},{command:"L",values:[0,a]}]},stroke:c0e(e)});break;case"kite":i.push({shape:{type:"path",path:[{command:"M",values:[0,.5*a]},{command:"L",values:[.5*o,0]},{command:"L",values:[o,.5*a]},{command:"L",values:[.5*o,a]},{command:"Z",values:[]}]},fill:Ri(e,0),stroke:XE(e)})}break}case"object":switch(e.resource&&e.resource.primitive||Hee){case"cone":{const s=d4(Ri(e,0),Ri(e,-.6),r?TJ:t),n=jtt(t,r);i.push({shape:n[0],fill:s}),i.push({shape:n[1],fill:s});break}case"inverted-cone":{const s=Ri(e,0),n=d4(s,Ri(e,-.6),t),o=Htt(t);i.push({shape:o[0],fill:n}),i.push({shape:o[1],fill:s});break}case"cube":{const s=Btt(t,r);i.push({shape:s[0],fill:Ri(e,0)}),i.push({shape:s[1],fill:Ri(e,-.3)}),i.push({shape:s[2],fill:Ri(e,-.5)});break}case"cylinder":{const s=d4(Ri(e,0),Ri(e,-.6),r?TJ:t),n=Gtt(t,r);i.push({shape:n[0],fill:s}),i.push({shape:n[1],fill:s}),i.push({shape:n[2],fill:Ri(e,0)});break}case"diamond":{const s=qtt(t);i.push({shape:s[0],fill:Ri(e,-.3)}),i.push({shape:s[1],fill:Ri(e,0)}),i.push({shape:s[2],fill:Ri(e,-.3)}),i.push({shape:s[3],fill:Ri(e,-.7)});break}case"sphere":{const s=d4(Ri(e,0),Ri(e,-.6));s.x1=0,s.y1=0,s.x2=.25*t,s.y2=.25*t,i.push({shape:{type:"circle",cx:0,cy:0,r:.5*t},fill:s});break}case"tetrahedron":{const s=Wtt(t);i.push({shape:s[0],fill:Ri(e,-.3)}),i.push({shape:s[1],fill:Ri(e,0)}),i.push({shape:s[2],fill:Ri(e,-.6)});break}}break}return i}function V8(e){const t=typeof(e==null?void 0:e.size)=="number"?e==null?void 0:e.size:null;return t?yr(t):null}function RMt(e){return e.type==="icon"?"multiply":"tint"}function OMt(e,t){const r=V8(t),i=t&&t.maxSize?yr(t.maxSize):null,s=t&&t.disableUpsampling,n=e.symbolLayers,o=[];let a=0,l=0;const c=n.getItemAt(n.length-1);let h;return c&&c.type==="icon"&&(h=c.size&&yr(c.size)),n.forEach(p=>{var g;if(p.type!=="icon"&&p.type!=="object")return;const f=p.type==="icon"?p.size&&yr(p.size):0,m=r||f?Math.ceil(Math.min(r||f,i||Mk)):cx;if(p&&p.resource&&p.resource.href){const v=EMt(e,p).then(w=>{const _=p.get("material.color"),T=RMt(p);return zrt(w,m,_,T,s)}).then(w=>{const _=w.width,T=w.height;return a=Math.max(a,_),l=Math.max(l,T),[{shape:{type:"image",x:0,y:0,width:_,height:T,src:w.url},fill:null,stroke:null}]});o.push(v)}else{let v=m;p.type==="icon"&&h&&r&&(v=m*(f/h));const w=(t==null?void 0:t.symbolConfig)==="tall"||((g=t==null?void 0:t.symbolConfig)==null?void 0:g.isTall)||p.type==="object"&&CMt(p);a=Math.max(a,w?TJ:v),l=Math.max(l,v),o.push(Promise.resolve(AMt(p,v,w)))}}),xs(o).then(p=>{const f=[];return p.forEach(m=>{m.value?f.push(m.value):m.error&&SMt.warn("error while building swatchInfo!",m.error)}),fL(f,[a,l],{node:t&&t.node,scale:!1,opacity:t&&t.opacity})})}function MMt(e,t){const r=e.symbolLayers,i=[],s=H6(e),n=V8(t),o=(t&&t.maxSize?yr(t.maxSize):null)||_ne;let a,l=0,c=0;return r.forEach((h,p)=>{if(!h||h.type!=="line"&&h.type!=="path")return;const f=[];switch(h.type){case"line":{const m=SJ(h,0);if(R(m))break;const g=m&&m.width||0;p===0&&(a=g);const v=Math.min(n||g,o),w=p===0?v:n?v*(g/a):v,_=w>l0e/2?2*w:l0e;c=Math.max(c,w),l=Math.max(l,_),m.width=w,f.push({shape:{type:"path",path:[{command:"M",values:[0,.5*c]},{command:"L",values:[l,.5*c]}]},stroke:m});break}case"path":{const m=Math.min(n||cx,o),g=Ri(h,0),v=Ri(h,-.2),w=cDe(h,-.4),_=w?{color:w,width:1}:{};if(h.profile==="quad"){const T=h.width,x=h.height,E=Utt(T&&x?T/x:1,x===0,T===0),C={..._,join:"bevel"};f.push({shape:E[0],fill:v,stroke:C}),f.push({shape:E[1],fill:v,stroke:C}),f.push({shape:E[2],fill:g,stroke:C})}else f.push({shape:VY.pathSymbol3DLayer[0],fill:v,stroke:_}),f.push({shape:VY.pathSymbol3DLayer[1],fill:g,stroke:_});c=Math.max(c,m),l=c}}i.push(f)}),Promise.resolve(fL(i,[l,c],{node:t&&t.node,scale:s,opacity:t&&t.opacity}))}async function PMt(e,t){const r=e.type==="mesh-3d",i=e.symbolLayers,s=V8(t),n=t&&t.maxSize?yr(t.maxSize):null,o=s||cx,a=[];let l=0,c=0,h=!1;for(let p=0;p<i.length;p++){const f=i.getItemAt(p),m=[];if(r&&f.type!=="fill")continue;const g=VY.fill[0];switch(f.type){case"fill":{const v=XE(f),w=Math.min(o,n||Mk);l=Math.max(l,w),c=Math.max(c,w),h=!0;let _=Ri(f,0);const T="pattern"in f&&f.pattern,x=Sz(f);!r&&b(T)&&T.type==="style"&&T.style!=="solid"&&x&&(_=await lDe(T,x)),m.push({shape:g,fill:_,stroke:v});break}case"line":{const v=SJ(f,0);if(R(v))break;const w={stroke:v,shape:g};l=Math.max(l,cx),c=Math.max(c,cx),m.push(w);break}case"extrude":{const v={join:"round",width:1,...SJ(f,-.4)},w=Ri(f,0),_=Ri(f,-.2),T=Math.min(o,n||Mk),x=Vtt(T);v.width=1,m.push({shape:x[0],fill:_,stroke:v}),m.push({shape:x[1],fill:_,stroke:v}),m.push({shape:x[2],fill:w,stroke:v});const E=cx,C=.7*cx+.5*T;l=Math.max(l,E),c=Math.max(c,C);break}case"water":{const v=Sz(f),w=xH(v),_=xH(v,2),T=xH(v,3),x=ztt();h=!0,m.push({shape:x[0],fill:w}),m.push({shape:x[1],fill:_}),m.push({shape:x[2],fill:T});const E=Math.min(o,n||Mk);l=Math.max(l,E),c=Math.max(c,E);break}}a.push(m)}return fL(a,[l,c],{node:t&&t.node,scale:h,opacity:t&&t.opacity})}function IMt(e,t){if(e.symbolLayers.length===0)return Promise.reject(new j("symbolPreview: renderPreviewHTML3D","No symbolLayers in the symbol."));switch(e.type){case"point-3d":return OMt(e,t);case"line-3d":return MMt(e,t);case"polygon-3d":case"mesh-3d":return PMt(e,t)}return Promise.reject(new j("symbolPreview: swatchInfo3D","symbol not supported."))}const $Mt=Object.freeze(Object.defineProperty({__proto__:null,getPatternDescriptor:lDe,getSizeFromOptions:V8,getSymbolLayerFill:Ri,previewSymbol3D:IMt},Symbol.toStringTag,{value:"Module"})),u0e={HH:315,HL:45,LL:135,LH:225},LMt={2:[["HL","HH"],["LL","LH"]],3:[["HL","HM","HH"],["ML","MM","MH"],["LL","LM","LH"]],4:[["HL","HM1","HM2","HH"],["M2L","M2M1","M2M2","M2H"],["M1L","M1M1","M1M2","M1H"],["LL","LM1","LM2","LH"]]};function DMt(e){if(!e)return;const{type:t}=e;if(t.includes("3d"))return Ri(e.symbolLayers.getItemAt(0));if(t==="simple-line"){const r=bI(e);return r&&r.color}if(e.type==="simple-marker"&&(e.style==="x"||e.style==="cross")){const r=bI(e);return r&&r.color}return HWe(e)}function NMt(e,t){const r=t.HH.label,i=t.LL.label,s=t.HL.label,n=t.LH.label;switch(e){case"HH":default:return{top:r,bottom:i,left:s,right:n};case"HL":return{top:s,bottom:n,left:i,right:r};case"LL":return{top:i,bottom:r,left:n,right:s};case"LH":return{top:n,bottom:s,left:r,right:i}}}function FMt(e){const{focus:t,infos:r,numClasses:i}=e,s=LMt[i],n={};r.forEach(a=>{n[a.value]={label:a.label,fill:DMt(a.symbol)}});const o=[];for(let a=0;a<i;a++){const l=[];for(let c=0;c<i;c++){const h=n[s[a][c]];l.push(h.fill)}o.push(l)}return{type:"relationship-ramp",numClasses:i,focus:t,colors:o,labels:NMt(t,n),rotation:uDe(t)}}function uDe(e){let t=u0e[e];return e&&t==null&&(t=u0e.HH),t||0}const EJ=30,CJ=12,hDe=[255,255,255],dDe=[200,200,200],ZE=[128,128,128],kMt=20,UMt=5;function VMt(e){return e.declaredClass==="esri.symbols.SimpleMarkerSymbol"}function zMt(e){return e.declaredClass==="esri.symbols.PictureMarkerSymbol"}function BMt(e){return e.declaredClass==="esri.symbols.SimpleLineSymbol"}function GMt(e){return e.declaredClass==="esri.symbols.TextSymbol"}function jMt(e,t){const r=e.length-1;return e.map((i,s)=>z2e(i,s,r,t))}async function HMt(e,t,r,i,s,n){const o=t.legendOptions,a=o&&o.customValues,l=await XMt(e,r),c=!!l,h=!!a,p=t.minSize!=null&&t.maxSize!=null,f=t.stops&&t.stops.length>1,m=!!t.target;if(!c||!h&&!(p||f&&!m))return;const g=H6(l);let v=null,w=null,_=null;w=g&&!f?iV([t.minDataValue,t.maxDataValue]):a||await YMt(t,l,i,s);const T=e==null?void 0:e.authoringInfo,x=(T==null?void 0:T.type)==="univariate-color-size",E=x&&(T==null?void 0:T.univariateTheme)==="above-and-below";if(!w&&f&&(w=t.stops.map(I=>I.value),v=t.stops.some(I=>!!I.label),e.type==="flow"&&(w=iV(w)),v&&(_=t.stops.map(I=>I.label))),g&&(w==null?void 0:w.length)>2&&!E&&(w=[w[0],w[w.length-1]]),!w)return null;x&&(w==null?void 0:w.length)!==5&&(w=mDe({minSize:w[0],maxSize:w[w.length-1]}));const C=g?qMt(e,w):null,A=YWe(l),P=v?null:jMt(w,n);return(await Promise.all(w.map(async(I,L)=>{const k=g?C[L]:await lE(t,l,I,i,s);return{value:I,symbol:KMt(E&&e.type==="class-breaks"?WMt(e,L):l,k),label:v?_[L]:P[L],size:k,outlineSize:A}}))).reverse()}function qMt(e,t){const r=e==null?void 0:e.authoringInfo,i=(r==null?void 0:r.type)==="univariate-color-size";let s=[CJ,EJ];if(i){const n=t[0],o=t[t.length-1],a=CJ,l=EJ;s=t.map(c=>a+(c-n)/(o-n)*(l-a))}return i&&(r==null?void 0:r.univariateTheme)==="below"&&s.reverse(),s}function WMt(e,t){const r=e.classBreakInfos,i=r.length,s=i<2||!(t>=2)?r[0].symbol.clone():r[i-1].symbol.clone();return e.visualVariables.some(n=>n.type==="color")&&(s.type.includes("3d")?pDe(s):fDe(s)),s}async function XMt(e,t){var s;if(e.type==="flow")return B2e(e,t);if(e.type==="pie-chart")return new eu({color:null,outline:(s=e.outline)!=null&&s.width?e.outline:new cu});let r=null,i=null;if(e.type==="simple")r=e.symbol;else if(e.type==="class-breaks"){const n=e.classBreakInfos;r=n&&n[0]&&n[0].symbol,i=n.length>1}else if(e.type==="unique-value"){const n=e.uniqueValueInfos;r=n&&n[0]&&n[0].symbol,i=n.length>1}return!r||ZMt(r)?null:(r=r.clone(),(t||i)&&(r.type.includes("3d")?pDe(r):fDe(r)),r)}function ZMt(e){return e?tg(e)?!!e.symbolLayers&&e.symbolLayers.some(t=>t&&t.type==="fill"):e.type.includes("fill"):!1}function pDe(e){e.type==="line-3d"?e.symbolLayers.forEach(t=>{t.material={color:ZE}}):e.symbolLayers.forEach(t=>{t.type!=="icon"||t.resource&&t.resource.href?t.material={color:dDe}:(t.material={color:hDe},t.outline={color:ZE,size:1.5})})}function fDe(e){var r,i;const t=Vte();e.type==="cim"?I2e(e,new Me(dDe)):e.type.includes("line")?e.color=ZE:(e.color=t?ZE:hDe,e.type==="simple-marker"&&(e.outline?((i=(r=e.outline)==null?void 0:r.color)==null?void 0:i.toHex())==="#ffffff"&&(e.outline.color=ZE):e.outline={color:ZE,width:1.5}))}async function YMt(e,t,r,i){const s=(await ie(()=>Promise.resolve().then(()=>iS),void 0,import.meta.url)).getSizeRangeAtScale(e,r,i),n=s&&mDe(s);if(!s&&!n)return;let o=n.map(a=>QMt(a,e,s));o=iV(o);for(let a=1;a<o.length-1;a++){const l=await JMt(e,t,o[a],o[a-1],r,i);l&&(o[a]=l[0],n[a]=l[1])}return o}function mDe(e){const t=e.minSize,r=e.maxSize,i=UMt,s=(r-t)/(i-1),n=[];for(let o=0;o<i;o++)n.push(t+s*o);return n}function QMt(e,t,r){const i=r.minSize,s=r.maxSize,n=t.minDataValue,o=t.maxDataValue;let a=null;return e<=i?a=n:e>=s?a=o:a=(e-i)/(s-i)*(o-n)+n,a}async function JMt(e,t,r,i,s,n){const o=await lE(e,t,r,s,n),a=await lE(e,t,i,s,n),l=rV(r),c=l.fractional,h=kMt;let p=l.integer,f=null,m=null;r>0&&r<1&&(f=10**c,p=rV(r*=f).integer);for(let g=p-1;g>=0;g--){const v=10**g;let w=Math.floor(r/v)*v,_=Math.ceil(r/v)*v;f!=null&&(w/=f,_/=f);let T=(w+_)/2;[,T]=iV([w,T,_],{indexes:[1]});const x=await lE(e,t,w,s,n),E=await lE(e,t,_,s,n),C=await lE(e,t,T,s,n),A=d5(o,x,a,null),P=d5(o,E,a,null),I=d5(o,C,a,null);let L=A.previous<=h,k=P.previous<=h;if(L&&k&&(A.previous<=P.previous?(L=!0,k=!1):(k=!0,L=!1)),L?m=[w,x]:k?m=[_,E]:I.previous<=h&&(m=[T,C]),m)break}return m}async function lE(e,t,r,i,s){const{getSize:n}=await ie(()=>Promise.resolve().then(()=>iS),void 0,import.meta.url);return n(e,r,{scale:i,view:s,shape:t.type==="simple-marker"?t.style:null})}function KMt(e,t){const r=e.clone();if(tg(r))H6(r)||r.symbolLayers.forEach(i=>{i.type!=="fill"&&(i.size=t)});else if(VMt(r))r.size=t;else if(zMt(r)){const i=r.width,s=r.height;r.height=t,r.width=t*(i/s)}else BMt(r)?r.width=t:GMt(r)&&r.font&&(r.font.size=t);return r}function e3t(e){const r=Math.floor(Math.log10(Math.abs(e)))+1,i=r<4||r>6?4:r,s=1e6,n=Math.abs(e)>=s?"compact":"standard";return Ud(e,{notation:n,minimumSignificantDigits:2,maximumSignificantDigits:i})}const Ev=fe.getLogger("esri.widgets.Legend.support.ActiveLayerInfo"),t3t="https://utility.arcgis.com/sharing/tools/legend",r3t="esri.layers.ImageryLayer",i3t="esri.layers.ImageryTileLayer",s3t="esri.layers.WCSLayer",p4=/^\s*(return\s+)?\$view\.scale\s*(;)?\s*$/i,n3t=new Tr({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryMultiPatch:"multipatch"}),h0e={u1:[0,1],u2:[0,3],u4:[0,15],u8:[0,255],s8:[-128,127],u16:[0,65535],s16:[-32768,32767],u32:[0,4294967295],s32:[-2147483648,2147483647],f32:[-34e38,34e38],f64:[-Number.MAX_VALUE,Number.MAX_VALUE]},f4=new eu({size:6,outline:{color:[128,128,128,.5],width:.5}}),o3t=new mg({style:"solid"});function AJ(e){return e.type==="flow"}function gDe(e){return e.type==="vector-field"}function yDe(e){return e.type==="raster-colormap"}function vDe(e){return e.type==="raster-stretch"}function _De(e){return e.type==="raster-shaded-relief"}function cE(e){return e.declaredClass==="esri.renderers.SimpleRenderer"}function uE(e){return e.declaredClass==="esri.renderers.ClassBreaksRenderer"}function RJ(e){return e.declaredClass==="esri.renderers.UniqueValueRenderer"}function bDe(e){return e.declaredClass==="esri.renderers.HeatmapRenderer"}function a3t(e){return bne(e)||wne(e)||xne(e)||l3t(e)}function l3t(e){return e.declaredClass==="esri.renderers.PointCloudRGBRenderer"}function bne(e){return e.declaredClass==="esri.renderers.PointCloudClassBreaksRenderer"}function wne(e){return e.declaredClass==="esri.renderers.PointCloudStretchRenderer"}function xne(e){return e.declaredClass==="esri.renderers.PointCloudUniqueValueRenderer"}function wDe(e){return e.declaredClass==="esri.renderers.DotDensityRenderer"}function xDe(e){return e.declaredClass==="esri.renderers.PieChartRenderer"}function c3t(e,t){return cE(e)||uE(e)||RJ(e)||bDe(e)||wDe(e)||xDe(e)?t.type==="2d"||nDe(e):vDe(e)||yDe(e)||_De(e)||bne(e)||wne(e)||xne(e)||gDe(e)||AJ(e)}function d0e(e){return e.declaredClass==="esri.layers.BuildingSceneLayer"}function u3t(e){return e.declaredClass==="esri.layers.VoxelLayer"}function h3t(e){return e.declaredClass==="esri.layers.WMSLayer"}function d3t(e){return e.declaredClass==="esri.layers.WMTSLayer"}function p0e(e){return e.declaredClass==="esri.layers.MapImageLayer"}function p3t(e){return e.declaredClass==="esri.layers.TileLayer"}function f3t(e){return e.declaredClass==="esri.layers.FeatureLayer"}function sM(e){return e.declaredClass===r3t}function TH(e){return e.declaredClass===i3t}function m3t(e){return e.declaredClass===s3t}function g3t(e){return e.type==="stretch-ramp"}function y3t(e){var t;return((t="authoringInfo"in e&&(e==null?void 0:e.authoringInfo))==null?void 0:t.type)==="univariate-color-size"}function v3t(e){const t="authoringInfo"in e&&(e==null?void 0:e.authoringInfo);return(t==null?void 0:t.type)==="univariate-color-size"&&(t==null?void 0:t.univariateTheme)==="above-and-below"}const _3t=new eu({style:"path",path:"M10,5 L5,0 0,5 M5,0 L5,15",size:15,outline:{width:1,color:[85,85,85,1]}});let h2={},Wn=class extends xe{constructor(e){super(e),this._handles=new Dt,this._hasColorRamp=!1,this._hasOpacityRamp=!1,this._hasSizeRamp=!1,this._webStyleSymbolCache=new Map,this._dotDensityUrlCache=new Map,this._scaleDrivenSizeVariable=null,this._hasClusterSizeVariable=!1,this.children=new ot,this.layerView=null,this.layer=null,this.legendElements=[],this.parent=null,this.hideLayersNotInCurrentView=!1,this.keepCacheOnDestroy=!1,this.respectLayerVisibility=!0,this.sublayerIds=[],this.title=null,this.view=null}initialize(){const e=()=>this.notifyChange("ready");this._handles.add([rs(()=>this.children,"change",t=>{const{added:r,removed:i}=t,s=this._handles;r.forEach(n=>{const o=`activeLayerInfo-ready-watcher-${n.layer.uid}`;s.add(te(()=>n.ready,e,Rt),o)}),i.forEach(n=>s.remove(n.layer.uid)),e()})]),this.keepCacheOnDestroy||(h2={})}destroy(){this._handles.destroy(),this._handles=null,this._webStyleSymbolCache=null,this._dotDensityUrlCache=null,this._scaleDrivenSizeVariable=null,this.keepCacheOnDestroy||(h2=null)}get effectList(){const e=this.layer;let t=null;return"effect"in e&&e.effect&&(t=new vm,t.effect=e.effect,t.end(),t.scale=this.scale),t}get opacity(){var s;const e=this.layer.opacity,t=(s=this.parent)==null?void 0:s.opacity,r=this.layer.parent,i=r&&"uid"in r?this._getParentLayerOpacity(r):null;return t!=null?t*e:i!=null?i*e:e}get ready(){return this.layer===null||(this.children.length>0?this._isGroupActive():this.legendElements.length>0)}get scale(){return this.view&&this.view.scale}get isScaleDriven(){const e=this.layer;if(e===null)return!1;if("effect"in e&&e.effect&&Array.isArray(e.effect))return!0;if("featureReduction"in e&&e.featureReduction){if(e.featureReduction.type==="cluster")return!0;if(e.featureReduction.type==="binning"&&"renderer"in e.featureReduction&&e.featureReduction.renderer)return this._isRendererScaleDriven(e.featureReduction.renderer)}return"renderer"in e&&e.renderer?this._isRendererScaleDriven(e.renderer):this._isLayerScaleDriven(this.layer)}get version(){return this._get("version")+1}async buildLegendElementsForFeatureCollections(e){if(!(!this.hideLayersNotInCurrentView||await this._isLayerInCurrentView()))return this.legendElements=[],void this.notifyChange("ready");const t=Array.from(e,r=>{if(f3t(r))return this._getRendererLegendElements(r.renderer,{title:r.title});if(r.featureSet&&r.featureSet.features.length){const i=r.layerDefinition,s=i&&i.drawingInfo,n=s&&kKe(s.renderer),o=n3t.read(i.geometryType);return n?this._getRendererLegendElements(n,{title:r.name,geometryType:o}):(Ev.warn("drawingInfo not available!"),null)}return null});try{const r=[];await xs(t).then(i=>{i.forEach(({value:s})=>s&&r.push(...s))}),this.legendElements=r,this.notifyChange("ready")}catch(r){Ev.warn("error while building legend for layer!",r)}}async buildLegendElementsForRenderer(e){try{const t=!this.hideLayersNotInCurrentView||await this._isLayerInCurrentView();this.legendElements=t?await this._getRendererLegendElements(e):[],this.notifyChange("ready")}catch(t){Ev.warn("error while building legend for layer!",t)}}async buildLegendElementsForTools(){var t,r;const e=this.layer;if(u3t(e))this._constructLegendElementsForVoxellayer();else if(d3t(e))this._constructLegendElementsForWMTSlayer();else if(h3t(e))await this._constructLegendElementsForWMSSublayers();else if(d0e(e))await this._constructLegendElementsForBuildingSceneLayer();else if(p0e(e)||p3t(e)||d0e(e))await this._constructLegendElementsForSublayers();else{this._handles.remove("imageryLayers-watcher");let i="default";sM(e)&&(i=(((t=e==null?void 0:e.renderingRule)==null?void 0:t.functionName)||"default")+"_"+((r=e.bandIds)!=null&&r.length?e.bandIds.join(""):"###")),await this._getLegendLayers(`${e.uid}-${i}`).then(async s=>{this.legendElements=[],this.notifyChange("ready");const n=s.map(async o=>{if(sM(e)||TH(e)){const l=te(()=>["renderingRule"in e&&e.renderingRule,e.bandIds],()=>z$(async()=>{h2.default=null,e.renderer?await this.buildLegendElementsForRenderer(e.renderer):await this.buildLegendElementsForTools()})());this._handles.add(l,"imageryLayers-watcher")}const a=this._generateSymbolTableElementForLegendLayer(o);a&&a.infos.length&&(sM(e)&&(a.title=e.title),this.legendElements.push(a)),this.notifyChange("ready")});await xs(n)}).catch(s=>{Ev.warn("Request to server for legend has failed!",s)})}}async _isLayerInCurrentView(){const e=this.layer,t=this.layerView,r=t&&"createQuery"in t&&"queryFeatureCount"in t;if(!r&&!(t&&"createQuery"in e&&"queryFeatureCount"in e))return!0;await E1(()=>!t.updating);const i=r?"createQuery"in t&&t.createQuery():"createQuery"in e&&e.createQuery();return i.geometry=this.view.extent,(r?"queryFeatureCount"in t&&await t.queryFeatureCount(i):"queryFeatureCount"in e&&await e.queryFeatureCount(i))!==0}_getParentLayerOpacity(e){let t=1;const r=e.parent;return r&&"uid"in r&&(t=this._getParentLayerOpacity(r)),e.opacity*t}_isGroupActive(){const e=this.children;return!!e.length&&e.some(t=>t.ready)}_isRendererScaleDriven(e){if(e.type==="dot-density")return!0;const t="valueExpression"in e&&e.valueExpression;if(p4.test(t))return!0;const r="visualVariables"in e&&e.visualVariables;return!!r&&r.some(i=>this._isScaleDrivenSizeVariable(i))}_isScaleDrivenSizeVariable(e){if(e&&e.type!=="size")return!1;const t=e,r=t.minSize,i=t.maxSize;return typeof r=="object"&&r?this._isScaleDrivenSizeVariable(r):typeof i=="object"&&i?this._isScaleDrivenSizeVariable(i):!!t.expression||p4.test(t.valueExpression)}_isLayerScaleDriven(e){if("minScale"in e&&e.minScale>0||"maxScale"in e&&e.maxScale>0)return!0;if("sublayers"in e&&e.sublayers)return e.sublayers.some(r=>this._isLayerScaleDriven(r));const t=e.parent;if(e.loaded===!1&&t&&p0e(t)&&"source"in e&&e.source&&e.source.type==="map-layer"){for(const r of t.sourceJSON.layers)if(r.id===e.source.mapLayerId&&(r.minScale>0||r.maxScale>0))return!0}return!1}async _constructLegendElementsForVoxellayer(){var n;this.legendElements=[],this._handles.remove("voxel-style-watcher");const e=this.layer;this._handles.add(te(()=>e.currentVariableId,()=>this._constructLegendElementsForVoxellayer()),"voxel-style-watcher");const t=e.getVariableStyle(null),r=[];if(t){if((n=t.uniqueValues)!=null&&n.length){const o=[];t.uniqueValues.forEach(a=>{a.enabled&&o.push({label:a.label||`${a.value}`,value:a.value,symbol:new mg({color:a.color,outline:null})})}),o.length&&r.push({type:"symbol-table",title:t.label,infos:o})}else if(t.transferFunction){const{colorStops:o,stretchRange:a}=t.transferFunction,l=o.toArray().reverse(),c=a.map((p,f)=>`${f===0?U2e:V2e} ${e3t(p)}`).reverse(),h=l.map(p=>({color:p.color,value:null,label:null}));h[0].label=c[0],h[h.length-1].label=c[1],r.push({type:"color-ramp",title:t.label,infos:h,preview:Tw(l.map(p=>p.color))})}}const i=e.opacity,s=r.reduce((o,a)=>o.concat(this._getAllInfos(a)),[]).filter(o=>!!(o!=null&&o.symbol)).map(o=>this._getSymbolPreview(o,i));await xs(s),this.legendElements=r,this.notifyChange("ready")}_constructLegendElementsForWMTSlayer(){this.legendElements=[],this._handles.remove("wmts-activeLayer-watcher");const e=this.layer.activeLayer;if(this._handles.add(te(()=>{const{layer:t}=this;return t&&"activeLayer"in t&&t.activeLayer},()=>this._constructLegendElementsForWMTSlayer()),"wmts-activeLayer-watcher"),e.styleId&&e.styles){let t=null;e.styles.some(r=>e.styleId===r.id&&(t=r.legendUrl,!0)),t&&(this.legendElements=[{type:"symbol-table",title:e.title,infos:[{src:t,opacity:this.opacity}]}])}this.notifyChange("ready")}async _constructLegendElementsForWMSSublayers(){this.legendElements=[],this._handles.remove("wms-sublayers-watcher");const e=this.layer;let t=null;(e.customParameters||e.customLayerParameters)&&(t={...e.customParameters,...e.customLayerParameters}),this._handles.add(te(()=>{const{layer:r}=this;return r&&"sublayers"in r&&r.sublayers},()=>this._constructLegendElementsForWMSSublayers()),"wms-sublayers-watcher"),this.legendElements=await this._generateLegendElementsForWMSSublayers(e.sublayers,t),this.notifyChange("ready")}async _generateLegendElementsForWMSSublayers(e,t){const r=[];this._handles.add(e.on("change",()=>this._constructLegendElementsForWMSSublayers()),"wms-sublayers-watcher");const i=e.toArray();for(const s of i){const n=te(()=>[s.title,s.visible,s.legendEnabled],()=>this._constructLegendElementsForWMSSublayers());if(this._handles.add(n,"wms-sublayers-watcher"),!this.respectLayerVisibility||s.visible&&s.legendEnabled){const o=await this._generateSymbolTableElementForWMSSublayer(s,t);o&&o.infos.length&&r.unshift(o)}}return r}async _generateSymbolTableElementForWMSSublayer(e,t){if(!e.legendUrl&&e.sublayers){const r=(await this._generateLegendElementsForWMSSublayers(e.sublayers,t)).filter(i=>i);return{type:"symbol-table",title:e.title,infos:r}}return this._generateSymbolTableElementForLegendUrl(e,t)}async _generateSymbolTableElementForLegendUrl(e,t){var o;let r=e.legendUrl;if(!r)return;const i={type:"symbol-table",title:e.title||e.name||e.id&&e.id+"",infos:[]};t&&(r=L4(r,t));let s=null;const n=(o=e.layer)==null?void 0:o.opacity;try{s=(await er(r,{responseType:"image"})).data,s&&(s.style.opacity=n)}catch{}return i.infos.push({src:r,preview:s,opacity:n}),i}_getLegendLayers(e,t){const r=h2&&h2[e];return r?Promise.resolve(r):this._legendRequest(t).then(i=>{const s=i.layers;return h2[e]=s,s})}_legendRequest(e){const t=this.layer;let r={f:"json",dynamicLayers:e};if(sM(t)){const s=t.exportImageServiceParameters.renderingRule;if(s&&(r.renderingRule=JSON.stringify(s.rasterFunctionDefinition||s.toJSON())),t.bandIds&&(r.bandIds=t.bandIds.join()),t.raster||t.viewId||t.customParameters){const{raster:n,viewId:o,customParameters:a}=t;r={raster:n,viewId:o,...r,...a}}}let i=t.url.replace(/(\/)+$/,"");if("version"in t&&t.version>=10.01){const s=i.indexOf("?");s>-1?i=i.substring(0,s)+"/legend"+i.substring(s):i+="/legend"}else{const s=i.toLowerCase().indexOf("/rest/"),n=i.substring(0,s)+i.substring(s+5,i.length);i=t3t+"?soapUrl="+encodeURI(n)+"&returnbytes=true"}return er(i,{query:r}).then(s=>s.data)}async _constructLegendElementsForBuildingSceneLayer(){this.legendElements=[],this._handles.remove("sublayers-watcher");const e=this.layer;this._handles.add(te(()=>e.sublayers,()=>this._constructLegendElementsForBuildingSceneLayer()),"sublayers-watcher");try{this.legendElements=await this._generateLegendElementsForBuildingSublayers(e.sublayers,this.opacity),this.notifyChange("ready")}catch(t){Ev.warn("Request to server for legend has failed!",t)}}async _generateLegendElementsForBuildingSublayers(e,t){let r=[];this._handles.add(e.on("change",()=>this._constructLegendElementsForBuildingSceneLayer()),"sublayers-watcher");const i=e.toArray();for(const s of i){const n=te(()=>["renderer"in s&&s.renderer,s.opacity,s.title,s.visible],()=>this._constructLegendElementsForBuildingSceneLayer());if(this._handles.add(n,"sublayers-watcher"),!this.respectLayerVisibility||s.visible){const o=s&&s.opacity!=null?s.opacity:null,a=o!=null?o*t:t;if(s.type==="building-group"){const l={type:"symbol-table",title:s.title,infos:[]},c=await this._generateLegendElementsForBuildingSublayers(s.sublayers,a);l.infos.push(...c),r=[l,...r]}else s.renderer&&(r=[...await this._getRendererLegendElements(s.renderer,{title:s.title,opacity:a,sublayer:s}),...r])}}return r.filter(s=>!!s&&(!("infos"in s)||s.infos.length>0))}async _constructLegendElementsForSublayers(){this.legendElements=[],this._handles.remove("sublayers-watcher");const e=this.layer;this._handles.add(te(()=>e.sublayers,()=>this._constructLegendElementsForSublayers),"sublayers-watcher");try{this.legendElements=await this._generateLegendElementsForSublayers(e.sublayers,this.opacity),this.notifyChange("ready")}catch(t){Ev.warn("Request to server for legend has failed!",t)}}async _generateLegendElementsForSublayers(e,t,r){const i=this.layer;let s=[];this._handles.add(e.on("change",()=>this._constructLegendElementsForSublayers()),"sublayers-watcher");let n=e.toArray();!r&&this.sublayerIds&&this.sublayerIds.length&&(n=this.sublayerIds.map(o=>i.findSublayerById(o)).filter(Boolean));for(const o of n){const a=te(()=>[o.renderer,o.opacity,o.title,o.visible,o.legendEnabled],()=>this._constructLegendElementsForSublayers());if(this._handles.add(a,"sublayers-watcher"),!this.respectLayerVisibility||o.visible&&o.legendEnabled&&this._isSublayerInScale(o)){const l=o&&o.opacity!=null?o.opacity:null,c=l!=null?l*t:t;if(o.renderer&&!o.sublayers&&o.originIdOf("renderer")>Bt.SERVICE)await o.load(),s=[...await this._getRendererLegendElements(o.renderer,{title:o.title,opacity:c,sublayer:o}),...s];else{const h=await this._generateSymbolTableElementForSublayer(o,c,r);h&&s.unshift(h)}}}return s.filter(o=>!!o&&(!("infos"in o)||o.infos.length>0))}async _generateSymbolTableElementForSublayer(e,t,r){if(!r){r=new Map;const s=this.layer,n=e.source;let o=null;if(!(!n||n.type==="map-layer"&&n.mapLayerId===e.id&&(!n.gdbVersion||n.gdbVersion===("gdbVersion"in s&&s.gdbVersion)))||e.originIdOf("renderer")>Bt.SERVICE||e.originIdOf("labelingInfo")>Bt.SERVICE||e.originIdOf("labelsVisible")>Bt.SERVICE){const l=new Lu({layer:this.layer});o=l.hasDynamicLayers?l.dynamicLayers:null,l.destroy()}const a=o||`${s.uid}-default`;(await this._getLegendLayers(a,o)).forEach(l=>r.set(l.layerId,l))}const i=r.get(e.id);if((!i||(i==null?void 0:i.subLayerIds)&&i.defaultVisibility)&&e.sublayers){const s=await this._generateLegendElementsForSublayers(e.sublayers,t,r);return{type:"symbol-table",title:e.title,infos:s}}return this._generateSymbolTableElementForLegendLayer(i,e,t)}_generateSymbolTableElementForLegendLayer(e,t,r){var a;if(!e||!e.legend||this.respectLayerVisibility&&!this._isLegendLayerInScale(e,t))return null;const i=t==null?void 0:t.renderer;let s=(t==null?void 0:t.title)||e.layerName;if(i&&(!t||(t==null?void 0:t.originIdOf("renderer"))>Bt.SERVICE)){const l=(t==null?void 0:t.title)||this._getRendererTitle(i,t);l&&(s&&typeof l!="string"&&"title"in l&&(l.title=s),s=l)}const n={type:"symbol-table",title:s,legendType:e.legendType?e.legendType:null,infos:[]},o=t?this._sanitizeLegendForSublayer(e.legend.slice(),t):e.legend;return((a=e.legendGroups)==null?void 0:a.length)>0?e.legendGroups.forEach(l=>{var h;const c={type:"symbol-table",title:l.heading,legendType:e.legendType?e.legendType:null,infos:this._generateSymbolTableElementInfosForLegendLayer(o.filter(p=>p.groupId===l.id),e.layerId,r)};((h=c.infos)==null?void 0:h.length)>0&&n.infos.push(c)}):n.infos=this._generateSymbolTableElementInfosForLegendLayer(o,e.layerId,r),n.infos.length>0?n:null}_generateSymbolTableElementInfosForLegendLayer(e,t,r){return e.map(i=>{let s=i.url;if(i.imageData&&i.imageData.length>0)s=`data:image/png;base64,${i.imageData}`;else{if(s.indexOf("http")===0)return null;s=AUe(`${this.layer.url}/${t}/images/${s}`)}return{label:i.label,src:s,opacity:r==null?this.opacity:r,width:i.width,height:i.height}}).filter(i=>!!i)}_isSublayerInScale(e){const t=e.minScale||0,r=e.maxScale||0;return!(t>0&&t<this.scale||r>this.scale)}_isLegendLayerInScale(e,t){const r=t||this.layer;let i=null,s=null,n=!0;return!r.minScale&&r.minScale!==0||!r.maxScale&&r.maxScale!==0?(e.minScale===0&&r.tileInfo&&(i=r.tileInfo.lods[0].scale),e.maxScale===0&&r.tileInfo&&(s=r.tileInfo.lods[r.tileInfo.lods.length-1].scale)):(i=Math.min(r.minScale,e.minScale)||r.minScale||e.minScale,s=Math.max(r.maxScale,e.maxScale)),(i>0&&i<this.scale||s>this.scale)&&(n=!1),n}_sanitizeLegendForSublayer(e,t){if("version"in this.layer&&this.layer.version<10.1||e.length===0)return e;const r=t.renderer,i=e.some(o=>o.values);let s=null,n=null;return i&&e.some((o,a)=>(o.values||(s=a,n=o,n.label||(n.label="others")),n!=null)),r?r.type==="unique-value"?n&&(e.splice(s,1),e.push(n)):r.type==="class-breaks"&&(n&&e.splice(s,1),e.reverse(),n&&e.push(n)):n&&(e.splice(s,1),e.push(n)),e}async _getRendererLegendElements(e,t={}){return c3t(e,this.view)?a3t(e)?this._constructPointCloudRendererLegendElements(e,t):wDe(e)?this._constructDotDensityRendererLegendElements(e):xDe(e)?this._constructPieChartRendererLegendElements(e):this._constructRendererLegendElements(e,t):(Ev.warn(`Renderer of type '${e.type}' not supported!`),[])}_getPointCloudRendererTitle(e){return e.legendOptions&&e.legendOptions.title||e.field}_constructPointCloudRendererLegendElements(e,t={}){const r=t.title,i=[];let s=null,n=null;if(bne(e))s={type:"symbol-table",title:r||this._getPointCloudRendererTitle(e),infos:[]},e.colorClassBreakInfos.forEach(a=>{s.infos.unshift({label:a.label||a.minValue+" - "+a.maxValue,value:[a.minValue,a.maxValue],symbol:this._getAppliedCloneSymbol(f4,a.color)})});else if(wne(e)){const a=e.stops;let l=null;if(a.length&&(a.length===1&&(l=a[0].color),!l)){const h=a[0].value,p=a[a.length-1].value;h!=null&&p!=null&&(l=j2e(h+(p-h)/2,a))}s={type:"symbol-table",title:null,infos:[{label:null,value:null,symbol:this._getAppliedCloneSymbol(f4,l||f4.color)}]};const c=fXe(e.stops);n={type:"color-ramp",title:r||this._getPointCloudRendererTitle(e),infos:c,preview:Tw(c.map(h=>h.color))}}else xne(e)&&(s={type:"symbol-table",title:r||this._getPointCloudRendererTitle(e),infos:[]},e.colorUniqueValueInfos.forEach(a=>{s.infos.push({label:a.label||a.values.join(", "),value:a.values.join(", "),symbol:this._getAppliedCloneSymbol(f4,a.color)})}));s&&s.infos.length&&i.push(s),n&&n.infos.length&&i.push(n);const o=i.reduce((a,l)=>a.concat(l.infos),[]).filter(a=>!!a.symbol).map(a=>this._getSymbolPreview(a,this.opacity,{symbolConfig:{applyColorModulation:!!e.colorModulation}}));return xs(o).then(()=>i)}_getElementInfoForDotDensity(e,t){var f;const{backgroundColor:r,outline:i,dotSize:s}=e,n=(f=this.effectList)==null?void 0:f.effects.map(m=>m.toJSON()),o=sV(n),a=s+"-"+t+"-"+r+"-"+(i&&JSON.stringify(i.toJSON()))+"-"+o,l=this._dotDensityUrlCache,c=l.has(a)?l.get(a):Brt(e,t);l.set(a,c);const h={shape:{type:"image",x:0,y:0,width:c.width,height:c.height,src:c.src},fill:null,stroke:null,offset:[0,0]},p=fL([[h]],[c.width,c.height],{effectView:this.effectList});return{opacity:1,src:c.src,preview:p,width:c.width,height:c.height}}_constructDotDensityRendererLegendElements(e){const t=e.calculateDotValue(this.view.scale),r=e.legendOptions&&e.legendOptions.unit,i={type:"symbol-table",title:{value:t&&Math.round(t),unit:r||""},infos:[]};return e.attributes.forEach(s=>{const n=this._getElementInfoForDotDensity(e,s.color);n.label=s.label||s.valueExpressionTitle||s.field,i.infos.push(n)}),Promise.resolve([i])}async _constructPieChartRendererLegendElements(e){var l,c,h,p;const t=this.layer.opacity,r=[],i="Others",s=e.outline;e.attributes.forEach(f=>{const m=new eu({color:f.color,outline:s}),g=f.label||f.valueExpressionTitle||f.field;r.push({label:g,symbol:m})});const n=r.length?[...r]:[];if(((l=e.othersCategory)==null?void 0:l.color)&&((c=e.othersCategory)==null?void 0:c.threshold)!==0){const f=new eu({color:e.othersCategory.color,outline:s});r.push({label:e.othersCategory.label||i,symbol:f})}if((h=e.defaultColor)!=null&&h.a){const f=new eu({color:e.defaultColor,outline:s});r.push({label:e.defaultLabel,symbol:f})}const o=await this._getVisualVariableLegendElements(e,this.layer)||[];if(r.length){o.unshift({type:"symbol-table",title:null,infos:r});const f=n.filter(g=>g.label!==i).map(g=>g.symbol.color).filter(Boolean),m=Grt(f,{holePercentage:e.holePercentage,backgroundColor:(p=e.backgroundFillSymbol)==null?void 0:p.color,effectList:this.effectList,outline:s});o.unshift({type:"pie-chart-ramp",title:this._getRendererTitle(e,this.layer),infos:r,preview:m})}const a=o.reduce((f,m)=>f.concat(this._getAllInfos(m)),[]).filter(f=>!!(f!=null&&f.symbol)&&!(f!=null&&f.preview)).map(f=>this._getSymbolPreview(f,t,{effectList:this.effectList}));return await xs(a),o}async _constructRendererLegendElements(e,t={}){var w;const{title:r,sublayer:i}=t,s=i||this.layer;let n=await this._loadRenderer(e);this._hasColorRamp=!1,this._hasOpacityRamp=!1,this._hasSizeRamp=!1,this._scaleDrivenSizeVariable=null;const o=await this._getVisualVariableLegendElements(n,s)||[],a={type:"symbol-table",title:r||this._getRendererTitle(n,s),infos:[]};let l=null,c=!1;const h=new Set;if(AJ(n)&&!this._hasSizeRamp){const _=await B2e(n);a.infos.push({label:null,symbol:_})}else if(y3t(n)){let _=r;const T=v3t(n)?"univariate-above-and-below-ramp":"univariate-color-size-ramp",x=o.findIndex(I=>I.type==="color-ramp"),E=x!==-1?o.splice(x,1)[0]:null,C=o.findIndex(I=>I.type==="size-ramp"),A=C!==-1?o.splice(C,1)[0]:null,P=[];E&&(_=E.title,P.push(E)),A&&(_=A.title,P.push(A)),P.length>0&&o.push({type:T,title:_,infos:P})}else if(bDe(n)){const _=H2e(n);o.push({type:"heatmap-ramp",title:r||((w=n.legendOptions)==null?void 0:w.title),infos:_,preview:Tw(_.map(T=>T.color),{effectList:this.effectList})})}else if(RJ(n)){const _=n&&n.authoringInfo;if(_&&_.type==="relationship"){const{focus:T,numClasses:x,field1:E,field2:C}=_;if(x&&E&&C){const A=[E,C];let P=uDe(T)||0;for(const L of A){const{field:k,normalizationField:G,label:z}=L,X=z||{field:this._getFieldAlias(k,s),normField:G&&this._getFieldAlias(G,s)},Z=_3t.clone();Z.angle=P,a.infos.push({label:X,symbol:Z}),h.add(Z),P+=90}const I=FMt({focus:T,numClasses:x,infos:n.uniqueValueInfos});o.unshift(I)}}else{const T=n.field;n.uniqueValueInfos.forEach(x=>{x.symbol&&a.infos.push({label:x.label||this._getDomainName(T,x.value,s)||x.value,value:x.value,symbol:x.symbol})})}n.defaultSymbol&&(a.infos.push({label:n.defaultLabel||"others",symbol:n.defaultSymbol}),c=!0)}else if(uE(n))l=this._isUnclassedRenderer(n),(!l||!this._hasSizeRamp)&&(n.classBreakInfos.forEach(_=>{_.symbol&&a.infos.unshift({label:_.label||(l?null:_.minValue+" - "+_.maxValue),value:[_.minValue,_.maxValue],symbol:_.symbol})}),l&&(a.title=null),this._updateInfosforClassedSizeRenderer(n,a.infos)),n.defaultSymbol&&!l&&(a.infos.push({label:n.defaultLabel||"others",symbol:n.defaultSymbol}),c=!0);else if(vDe(n))if(TH(this.layer)||m3t(this.layer)){const _=this._constructTileImageryStretchRendererElements(n);g3t(_)?o.push(_):a.infos=_}else{const _=this.layer;let T,x;n.statistics&&n.statistics.length&&(T=n.statistics[0].min!=null?n.statistics[0].min:n.statistics[0][0],x=n.statistics[0].max!=null?n.statistics[0].max:n.statistics[0][1]);let E=[];const C=_.renderingRule?await _.generateRasterInfo(_.renderingRule):_.serviceRasterInfo,A=C.keyProperties.BandProperties,P=h0e[_.rasterInfo.pixelType.toLowerCase()];C.bandCount===1||_.bandIds&&_.bandIds.length===1?(T=T!=null?T:C.statistics?C.statistics[_.bandIds[0]].min:P[0],x=x!=null?x:C.statistics?C.statistics[_.bandIds[0]].max:P[1],T||x?o.push(this._getStretchLegendElements(n,{min:T,max:x})):this._getServerSideLegend()):C.bandCount>=3?A&&A.length>=C.bandCount?_.bandIds&&_.bandIds.length===3?(E=_.bandIds.map(I=>A[I].BandName),a.infos=this._createSymbolTableElementMultiBand(E)):_.format==="lerc"?(E=[0,1,2].map(I=>A[I].BandName),a.infos=this._createSymbolTableElementMultiBand(E)):this._getServerSideLegend():_.format==="lerc"?(E=["band1","band2","band3"],a.infos=this._createSymbolTableElementMultiBand(E)):this._getServerSideLegend():this._getServerSideLegend()}else if(yDe(n))n.colormapInfos.forEach(_=>{a.infos.push({label:_.label,value:_.value,symbol:this._getAppliedCloneSymbol(o3t,_.color)})});else if(cE(n)){let _=n.symbol;switch(t.geometryType){case"point":_="pointSymbol"in s&&s.pointSymbol;break;case"polyline":_="lineSymbol"in s&&s.lineSymbol;break;case"polygon":_="polygonSymbol"in s&&s.polygonSymbol}n.symbol&&!this._hasSizeRamp&&a.infos.push({label:n.label,symbol:_})}else if(gDe(n)){n.outputUnit&&(this.title="("+n.toJSON().outputUnit+")"),a.title=n.attributeField;const _=n.getClassBreakInfos();_!=null&&_.length?_.forEach(T=>{a.infos.push({label:T.minValue+" - "+T.maxValue,symbol:T.symbol})}):a.infos.push({label:n.attributeField,symbol:n.getDefaultSymbol()})}else _De(n)&&o.push(this._getStretchLegendElements(n,{min:0,max:255}));const p=n.defaultSymbol;!p||c||cE(n)||l&&!this._hasColorRamp&&!this._hasSizeRamp&&!this._hasOpacityRamp||o.push({type:"symbol-table",infos:[{label:n.defaultLabel||"others",symbol:p}]}),a.infos.length&&o.unshift(a);const f=t.opacity==null?this.opacity:t.opacity,m=this._isTallSymbol("visualVariables"in n&&n.visualVariables),g=sM(this.layer)||TH(this.layer),v=o.reduce((_,T)=>_.concat(this._getAllInfos(T)),[]).filter(_=>!!(_!=null&&_.symbol)).map(_=>this._getSymbolPreview(_,f,{isDefault:_.symbol===p,applyScaleDrivenSize:!h.has(_.symbol),symbolConfig:{isTall:m,isSquareFill:g},effectList:h.has(_.symbol)?null:this.effectList}));return n=null,await xs(v),o}_getServerSideLegend(){setTimeout(()=>this.buildLegendElementsForTools(),0)}_getAllInfos(e){const t=e==null?void 0:e.infos;return t?t.reduce((r,i)=>r.concat(this._getAllInfos(i)),[]):[e]}_constructTileImageryStretchRendererElements(e){var h,p;const t=this.layer,r=t.rasterInfo,i=r.bandCount||e.statistics.length;let s,n,o=[];const a=r.keyProperties&&r.keyProperties.BandProperties,l=(h=e==null?void 0:e.statistics)!=null&&h.length?e.statistics:r==null?void 0:r.statistics;if(l)s=l[0].min!==void 0?l[0].min:l[0][0],n=l[0].max||l[0][1];else{const f=h0e[t.rasterInfo.pixelType.toLowerCase()];s=f[0],n=f[1]}if(t.hasStandardTime()&&(s=t.getStandardTimeValue(s),n=t.getStandardTimeValue(n)),r.bandCount===1||((p=t.bandIds)==null?void 0:p.length)===1)return this._getStretchLegendElements(e,{min:s,max:n});function c(f){var g;const m=((g=t==null?void 0:t.bandIds)!=null&&g.length?t.bandIds:Array.from(Array(Math.min(r.bandCount,3)).keys())).map(v=>f&&f[v]&&f[v].BandName||"band"+(v+1));return m.length<3?m.push(m[1]):m.length>3&&m.splice(3),m}return o=a&&a.length>=i?c(a):c(),this._createSymbolTableElementMultiBand(o)}_getStretchLegendElements(e,t){const r=e.colorRamp,i=gXe(r,t);return{type:"stretch-ramp",title:"",infos:i,preview:Tw(i.map(s=>s.color))}}async _getSizeLegendElement(e,t,r,i){return{type:"size-ramp",title:this._hasClusterSizeVariable?this._getClusterTitle(t):e,infos:await HMt(r,t,await tZ(r),this.scale,this.view.type,i)}}_createSymbolTableElementMultiBand(e){const t=[],r=["red","green","blue"];return e.forEach((i,s)=>{var n;t.push({label:{colorName:r[s],bandName:i},src:hXe[s],opacity:(n=this.opacity)!=null?n:1})}),t}_updateInfosforClassedSizeRenderer(e,t){const r=e.authoringInfo&&e.authoringInfo.type==="class-breaks-size",i=e.classBreakInfos.some(s=>H6(s.symbol));if(r&&i){const s=EJ,n=CJ,o=e.classBreakInfos.length,a=(s-n)/(o>1?o-1:o);t.forEach((l,c)=>{l.size=s-a*c})}}_isTallSymbol(e){let t=!1,r=!1;if(e)for(let i=0;i<e.length&&(!t||!r);i++){const s=e[i];s.type==="size"&&(s.axis==="height"&&(t=!0),s.axis==="width-and-depth"&&(r=!0))}return t&&r}async _getSymbolPreview(e,t,r){let i=!(r!=null&&r.isDefault)&&e.size==null&&this._hasSizeRamp?ac(no.size):e.size;if(this._scaleDrivenSizeVariable&&(r==null?void 0:r.applyScaleDrivenSize)){const{getSize:s}=await ie(()=>Promise.resolve().then(()=>iS),void 0,import.meta.url);i=s(this._scaleDrivenSizeVariable,null,{view:this.view.type,scale:this.scale,shape:e.symbol.type==="simple-marker"?e.symbol.style:null})}return lRe(e.symbol,{size:i,opacity:t,scale:!1,symbolConfig:r==null?void 0:r.symbolConfig,effectView:r==null?void 0:r.effectList}).then(s=>(e.preview=s,e)).catch(()=>(e.preview=null,e))}async _loadRenderer(e){var n,o;const t=[],r=this.layer;e=e.clone(),this._hasClusterSizeVariable=!1;const i="visualVariables"in e&&((n=e.visualVariables)==null?void 0:n.some(a=>a.type==="size"&&a.target!=="outline"&&!p4.test(a.valueExpression)));if(e&&"visualVariables"in e&&!i&&"featureReduction"in r&&((o=r.featureReduction)==null?void 0:o.type)==="cluster"){const a=this.layerView._effectiveRenderer,l=wMt(a,this.view);if(l){const c=r.featureReduction;if("clusterMinSize"in c&&"clusterMaxSize"in c){const{clusterMinSize:p,clusterMaxSize:f}=c;l.legendOptions=new ICe({showLegend:p!==f})}const h=e.visualVariables||[];e.visualVariables=h.concat([l]),this._hasClusterSizeVariable=!0}}const s=await tZ(e);if(uE(e)||RJ(e)){const a=(e.classBreakInfos||e.uniqueValueInfos).map(l=>this._fetchSymbol(l.symbol,s).then(c=>{l.symbol=c}).catch(()=>{l.symbol=null}));Array.prototype.push.apply(t,a)}return t.push(this._fetchSymbol(e.symbol||e.defaultSymbol,e.defaultSymbol?null:s).then(a=>{this._applySymbolToRenderer(e,a,cE(e))}).catch(()=>{this._applySymbolToRenderer(e,null,cE(e))})),xs(t).then(()=>e)}_applySymbolToRenderer(e,t,r){r?e.symbol=t:e.defaultSymbol=t}async _fetchSymbol(e,t){if(!e)throw new Error;if(e.type==="web-style"){const r=this._webStyleSymbolCache;try{const i=await(this.view.type==="2d"?e.fetchCIMSymbol({cache:r}):e.fetchSymbol({cache:r}));return this._getAppliedCloneSymbol(i,t)}catch{throw Ev.warn("Fetching web-style failed!"),new Error}}return this._getAppliedCloneSymbol(e,t)}_getAppliedCloneSymbol(e,t){if(!e||!t)return e;const r=e.clone(),i=t&&t.toRgba();return r.type.includes("3d")?this._applyColorTo3dSymbol(r,i):r.type==="cim"?I2e(r,t):r.color&&(r.color=new Me(i||r.color)),r}_applyColorTo3dSymbol(e,t){t&&e.symbolLayers.forEach(r=>{r&&(r.material||(r.material={}),r.material.color=new Me(t))})}async _getVisualVariableLegendElements(e,t){if(!("visualVariables"in e)||!e.visualVariables||e.type==="vector-field")return null;const r=e.visualVariables,i=[],s=[],n=[];for(const h of r)h.type==="color"?i.push(h):h.type==="size"?s.push(h):h.type==="opacity"&&n.push(h);const o=[...i,...s,...n];let a,l;if(i.length===0&&uE(e)&&e.classBreakInfos&&e.classBreakInfos.length===1){const h=e.classBreakInfos[0];a=h&&h.symbol}if(i.length===0&&cE(e)&&(a=e.symbol),a)if(a.type.includes("3d")){const h=a.symbolLayers.getItemAt(0);h.type==="water"?b(h.color)&&(l=h.color):b(h.material)&&b(h.material.color)&&(l=h.material.color)}else a.url||(l=a.color);const c=this.effectList;return(await Promise.all(o.map(async h=>{if(!h.legendOptions||h.legendOptions.showLegend!==!1){const p=AJ(e)?h.field:this._getRampTitle(h,t);let f=null;const m="getField"in t&&t.getField&&t.getField(h.field),g=m&&M6e(m);if(h.type==="color"){const v=await rZ(h,null,g);f={type:"color-ramp",title:p,infos:v,preview:Tw(v.map(w=>w.color),{effectList:c})},this._hasColorRamp||(this._hasColorRamp=!(f.infos==null||!f.infos.length))}else if(h.type==="size"&&h.target!=="outline")p4.test(h.valueExpression)?this._hasClusterSizeVariable||(this._scaleDrivenSizeVariable=h):(f=await this._getSizeLegendElement(p,h,e,g),this._hasSizeRamp||(this._hasSizeRamp=!(f.infos==null||!f.infos.length)));else if(h.type==="opacity"){const v=await rZ(h,l,g);f={type:"opacity-ramp",title:p,infos:v,preview:Tw(v.map(w=>w.color),{effectList:c})},this._hasOpacityRamp||(this._hasOpacityRamp=!(f.infos==null||!f.infos.length))}return f&&f.infos?f:null}}))).filter(h=>!!h)}_getDomainName(e,t,r){if(e&&typeof e!="function"){const i="getField"in r&&r.getField&&r.getField(e),s=i&&"getFieldDomain"in r&&r.getFieldDomain?r.getFieldDomain(i.name):null;return s&&s.type==="coded-value"?s.getName(t):null}return null}_getClusterTitle(e){const t=this.layer,r=e.field;if("featureReduction"in t&&t.featureReduction&&t.featureReduction.type==="cluster"){const i=t.featureReduction,s="popupTemplate"in i&&i.popupTemplate,n=s&&s.fieldInfos;if(n){for(const o of n)if(o.fieldName===r)return r==="cluster_count"?o.label||{showCount:!0}:o.label}}return{showCount:!0}}_getRampTitle(e,t){let r=e.field,i=e.normalizationField,s=!1,n=!1,o=!1,a=null;r=typeof r=="function"?null:r,i=typeof i=="function"?null:i;const l=e.legendOptions&&e.legendOptions.title;if(l!=null)a=l;else if(e.valueExpressionTitle)a=e.valueExpressionTitle;else{if("renderer"in t&&t.renderer&&"authoringInfo"in t.renderer&&t.renderer.authoringInfo&&t.renderer.authoringInfo.visualVariables){const c=t.renderer.authoringInfo.visualVariables;for(let h=0;h<c.length;h++){const p=c[h];if(p.type==="color"){if(p.style==="ratio"){s=!0;break}if(p.style==="percent"){n=!0;break}if(p.style==="percent-of-total"){o=!0;break}}}}a={field:r&&this._getFieldAlias(r,t),normField:i&&this._getFieldAlias(i,t),ratio:s,ratioPercent:n,ratioPercentTotal:o}}return a}_getRendererTitle(e,t){const r=e;if(r.legendOptions&&r.legendOptions.title)return r.legendOptions.title;if(r.valueExpressionTitle)return r.valueExpressionTitle;let i=r.field,s=null,n=null;uE(r)&&(s=r.normalizationField,n=r.normalizationType==="percent-of-total"),i=typeof i=="function"?null:i,s=typeof s=="function"?null:s;let o=null;return(i||s)&&(o={field:i&&this._getFieldAlias(i,t),normField:s&&this._getFieldAlias(s,t),normByPct:n}),o}_getFieldAlias(e,t){const r="popupTemplate"in t&&t.popupTemplate,i=r&&r.fieldInfos;let s=null;i&&i.some(l=>e===l.fieldName&&(s=l,!0));let n=null;"getField"in t&&t.getField?n=t.getField(e):"fieldsIndex"in t&&t.fieldsIndex&&(n=t.fieldsIndex.get(e));const o=s||n;let a=null;return o&&(a=s&&s.label||n&&n.alias||"name"in o&&o.name||"fieldName"in o&&o.fieldName),a}_isUnclassedRenderer(e){const t=e.visualVariables;let r=!1;return uE(e)&&e.classBreakInfos&&e.classBreakInfos.length===1&&t&&(r=e.field?t.some(i=>!(!i||e.field!==i.field||(e.normalizationField||i.normalizationField)&&e.normalizationField!==i.normalizationField)):!!t.length),r}};u([d()],Wn.prototype,"children",void 0),u([d({readOnly:!0})],Wn.prototype,"effectList",null),u([d()],Wn.prototype,"layerView",void 0),u([d()],Wn.prototype,"layer",void 0),u([d()],Wn.prototype,"legendElements",void 0),u([d({readOnly:!0})],Wn.prototype,"opacity",null),u([d()],Wn.prototype,"parent",void 0),u([d({readOnly:!0,dependsOn:[]})],Wn.prototype,"ready",null),u([d()],Wn.prototype,"hideLayersNotInCurrentView",void 0),u([d()],Wn.prototype,"keepCacheOnDestroy",void 0),u([d()],Wn.prototype,"respectLayerVisibility",void 0),u([d({readOnly:!0})],Wn.prototype,"scale",null),u([d()],Wn.prototype,"sublayerIds",void 0),u([d({readOnly:!0})],Wn.prototype,"isScaleDriven",null),u([d()],Wn.prototype,"title",void 0),u([d({readOnly:!0,dependsOn:["ready"],value:0})],Wn.prototype,"version",null),u([d()],Wn.prototype,"view",void 0),Wn=u([$("esri.widgets.Legend.support.ActiveLayerInfo")],Wn);const TDe=Wn,jb={state:"state",view:"view",allLayerViews:"all-layer-views",legendProperties:"legend-properties"},SDe=ot.ofType(TDe),b3t=["esri.layers.BuildingSceneLayer","esri.layers.CSVLayer","esri.layers.FeatureLayer","esri.layers.GeoJSONLayer","esri.layers.GeoRSSLayer","esri.layers.GroupLayer","esri.layers.HeatmapLayer","esri.layers.ImageryLayer","esri.layers.ImageryTileLayer","esri.layers.MapImageLayer","esri.layers.OGCFeatureLayer","esri.layers.PointCloudLayer","esri.layers.StreamLayer","esri.layers.SceneLayer","esri.layers.TileLayer","esri.layers.VoxelLayer","esri.layers.WFSLayer","esri.layers.WMSLayer","esri.layers.WMTSLayer","esri.layers.WCSLayer"],EDe="view.basemapView.baseLayerViews",CDe="view.groundView.layerViews",ADe="view.basemapView.referenceLayerViews",w3t=[EDe,CDe,"view.layerViews",ADe];let td=class extends xe{constructor(e){super(e),this._handles=new Dt,this._layerViewByLayerId={},this._layerInfosByLayerViewId={},this._activeLayerInfosByLayerViewId={},this._activeLayerInfosWithNoParent=new ot,this.activeLayerInfos=new SDe,this.basemapLegendVisible=!1,this.groundLegendVisible=!1,this.hideLayersNotInCurrentView=!1,this.keepCacheOnDestroy=!1,this.respectLayerVisibility=!0,this.layerInfos=[],this.view=null}initialize(){this._handles.add(te(()=>this.view,()=>this._viewHandles(),Rt),jb.view),this._handles.add(Cbe(()=>this._refresh()))}destroy(){this._destroyViewActiveLayerInfos(),this._handles.destroy(),this._handles=null,this.view=null}get state(){return this.get("view.ready")?"ready":"disabled"}_viewHandles(){this._handles.remove(jb.state),this.view&&this._handles.add(te(()=>this.state,()=>this._stateHandles(),Rt),jb.state)}_stateHandles(){this._resetAll(),this.state==="ready"&&this._watchPropertiesAndAllLayerViews()}_resetAll(){this._handles.remove([jb.allLayerViews,jb.legendProperties]),this._destroyViewActiveLayerInfos(),this.activeLayerInfos.removeAll()}_destroyViewActiveLayerInfos(){Object.keys(this._activeLayerInfosByLayerViewId).forEach(this._destroyViewActiveLayerInfo,this)}_destroyViewActiveLayerInfo(e){this._handles.remove(e);const t=this._activeLayerInfosByLayerViewId[e];delete this._activeLayerInfosByLayerViewId[e],t&&t.parent&&t.parent.children.remove(t)}_watchPropertiesAndAllLayerViews(){const{allLayerViews:e}=this.view;e.length&&this._refresh(),this._handles.add(e.on("change",t=>this._allLayerViewsChangeHandle(t)),jb.allLayerViews),this._handles.add(te(()=>[this.layerInfos,this.basemapLegendVisible,this.groundLegendVisible],()=>this._propertiesChangeHandle()),jb.legendProperties)}_allLayerViewsChangeHandle(e){e.removed.forEach(t=>this._destroyViewActiveLayerInfo(t.uid)),this._refresh()}_propertiesChangeHandle(){this._destroyViewActiveLayerInfos(),this._refresh()}_refresh(){this._layerInfosByLayerViewId={},this.activeLayerInfos.removeAll(),this._generateLayerViews().filter(this._filterLayerViewsByLayerInfos,this).filter(this._isLayerViewSupported,this).forEach(this._generateActiveLayerInfo,this),this._sortActiveLayerInfos(this.activeLayerInfos)}_sortActiveLayerInfos(e){if(e.length<2)return;const t=[];e.forEach(i=>{if(!i.parent){const s=i.layer.parent,n=s&&"uid"in s&&this._layerViewByLayerId[s.uid],o=n&&this._activeLayerInfosByLayerViewId[n.uid];o&&e.includes(o)&&(t.push(i),i.parent=o,o.children.add(i),this._sortActiveLayerInfos(o.children))}}),e.removeMany(t);const r={};this.view.allLayerViews.forEach((i,s)=>r[i.layer.uid]=s),e.sort((i,s)=>{const n=r[i.layer.uid]||0;return(r[s.layer.uid]||0)-n})}_generateLayerViews(){const e=[];return w3t.filter(this._filterLayerViews,this).map(this.get,this).filter(t=>t!=null).forEach(this._collectLayerViews("layerViews",e)),e}_filterLayerViews(e){const t=!this.basemapLegendVisible&&(e===EDe||e===ADe),r=!this.groundLegendVisible&&e===CDe;return!t&&!r}_collectLayerViews(e,t){const r=i=>(i&&i.forEach(s=>{t.push(s),r(s[e])}),t);return r}_filterLayerViewsByLayerInfos(e){const t=this.layerInfos;return!t||!t.length||t.some(r=>this._hasLayerInfo(r,e))}_hasLayerInfo(e,t){const r=this._isLayerUIDMatching(e.layer,t.layer.uid);return r&&(this._layerInfosByLayerViewId[t.uid]=e),r}_isLayerUIDMatching(e,t){return e&&(e.uid===t||this._hasLayerUID(e.layers,t))}_hasLayerUID(e,t){return e&&e.some(r=>this._isLayerUIDMatching(r,t))}_isLayerViewSupported(e){return!!b3t.includes(e.layer.declaredClass)&&(this._layerViewByLayerId[e.layer.uid]=e,!0)}_generateActiveLayerInfo(e){this._isLayerActive(e)?this._buildActiveLayerInfo(e):(this._handles.remove(e.uid),this._handles.add(te(()=>{var t;return[e.legendEnabled,(t=e.layer)==null?void 0:t.legendEnabled]},()=>this._layerActiveHandle(e)),e.uid))}_layerActiveHandle(e){this._isLayerActive(e)&&(this._handles.remove(e.uid),this._buildActiveLayerInfo(e))}_isLayerActive(e){return!this.respectLayerVisibility||e.legendEnabled&&e.get("layer.legendEnabled")}_buildActiveLayerInfo(e){var o;const t=e.layer,r=e.uid,i=this._layerInfosByLayerViewId[r];let s=this._activeLayerInfosByLayerViewId[r];if(!s){const a=i&&i.title!==void 0&&i.layer.uid===t.uid;s=new TDe({layer:t,layerView:e,title:a?i.title:t.title,view:this.view,respectLayerVisibility:this.respectLayerVisibility,hideLayersNotInCurrentView:this.hideLayersNotInCurrentView,keepCacheOnDestroy:this.keepCacheOnDestroy,sublayerIds:i&&i.sublayerIds||[]}),this._activeLayerInfosByLayerViewId[r]=s}const n=t.parent&&"uid"in t.parent&&this._layerViewByLayerId[(o=t.parent)==null?void 0:o.uid];if(s.parent=this._activeLayerInfosByLayerViewId[n==null?void 0:n.uid],!this._handles.has(r)){const a=[te(()=>t.title,l=>this._titleHandle(l,s)),te(()=>[t.opacity,"renderer"in t&&t.renderer,"pointSymbol"in t&&t.pointSymbol,"lineSymbol"in t&&t.lineSymbol,"polygonSymbol"in t&&t.polygonSymbol],()=>this._constructLegendElements(s)),Lo(()=>{var l;return((l=this.view)==null?void 0:l.stationary)===!0},()=>this._scaleHandle(s),Rt),te(()=>e._effectiveRenderer,()=>this._constructLegendElements(s)),te(()=>"effect"in t&&t.effect,()=>this._constructLegendElements(s))];if(this.respectLayerVisibility){const l=te(()=>e.legendEnabled,h=>this._legendEnabledHandle(h,s)),c=te(()=>t.legendEnabled,h=>this._legendEnabledHandle(h,s));a.push(l,c)}this._handles.add(a,r)}s.isScaleDriven||this._constructLegendElements(s),this._addActiveLayerInfo(s)}_titleHandle(e,t){t.title=e,this._constructLegendElements(t)}_legendEnabledHandle(e,t){e?this._addActiveLayerInfo(t):this._removeActiveLayerInfo(t)}_scaleHandle(e){(e.isScaleDriven||e.hideLayersNotInCurrentView)&&this._constructLegendElements(e)}_addActiveLayerInfo(e){var i;const{layerView:t,layer:r}=e;if(this._isLayerActive(t)&&!this.activeLayerInfos.includes(e)){const s=e.parent;if(s)s.children.includes(e)||s.children.push(e),this._sortActiveLayerInfos(s.children);else{const n=(i=this.layerInfos)==null?void 0:i.some(o=>o.layer.uid===r.uid);r.parent&&"uid"in r.parent&&!n?this._activeLayerInfosWithNoParent.add(e):(this.activeLayerInfos.add(e),this._sortActiveLayerInfos(this.activeLayerInfos))}if(this._activeLayerInfosWithNoParent.length){const n=[];this._activeLayerInfosWithNoParent.forEach(o=>{const a=o.layer.parent,l=a&&"uid"in a&&this._layerViewByLayerId[a==null?void 0:a.uid],c=this._activeLayerInfosByLayerViewId[l==null?void 0:l.uid];c&&(n.push(o),o.parent=c)}),n.length&&(this._activeLayerInfosWithNoParent.removeMany(n),n.forEach(o=>this._addActiveLayerInfo(o)))}}}_removeActiveLayerInfo(e){const t=e.parent;t?t.children.remove(e):this.activeLayerInfos.remove(e)}_constructLegendElements(e){var r;const t=e.layer;"featureCollections"in t&&t.featureCollections?e.buildLegendElementsForFeatureCollections(t.featureCollections):"featureReduction"in t&&((r=t.featureReduction)==null?void 0:r.type)==="binning"&&"renderer"in t.featureReduction?e.buildLegendElementsForRenderer(t.featureReduction.renderer):"renderer"in t&&t.renderer?e.buildLegendElementsForRenderer(t.renderer):"url"in t&&t.url?e.buildLegendElementsForTools():e.children.forEach(i=>this._constructLegendElements(i))}};u([d({type:SDe})],td.prototype,"activeLayerInfos",void 0),u([d()],td.prototype,"basemapLegendVisible",void 0),u([d()],td.prototype,"groundLegendVisible",void 0),u([d()],td.prototype,"hideLayersNotInCurrentView",void 0),u([d()],td.prototype,"keepCacheOnDestroy",void 0),u([d()],td.prototype,"respectLayerVisibility",void 0),u([d()],td.prototype,"layerInfos",void 0),u([d({readOnly:!0})],td.prototype,"state",null),u([d()],td.prototype,"view",void 0),td=u([$("esri.widgets.Legend.LegendViewModel")],td);const x3t=td,T3t="http://www.w3.org/2000/svg",zi={diamondContainer:"esri-relationship-ramp--diamond__container",diamondLeftCol:"esri-relationship-ramp--diamond__left-column",diamondRightCol:"esri-relationship-ramp--diamond__right-column",diamondMidCol:"esri-relationship-ramp--diamond__middle-column",diamondMidColLabel:"esri-relationship-ramp--diamond__middle-column--label",diamondMidColRamp:"esri-relationship-ramp--diamond__middle-column--ramp",squareTable:"esri-relationship-ramp--square__table",squareTableRow:"esri-relationship-ramp--square__table-row",squareTableCell:"esri-relationship-ramp--square__table-cell",squareTableLabel:"esri-relationship-ramp--square__table-label",squareTableLabelLeftBottom:"esri-relationship-ramp--square__table-label--left-bottom",squareTableLabelRightBottom:"esri-relationship-ramp--square__table-label--right-bottom",squareTableLabelLeftTop:"esri-relationship-ramp--square__table-label--left-top",squareTableLabelRightTop:"esri-relationship-ramp--square__table-label--right-top"};function RDe(e,t,r,i){const{focus:s,labels:n}=e,o=!!s,a=S3t(e,t,r,i),l={justifyContent:"center"},c=nf();return o?U("div",{class:zi.diamondContainer,styles:l},U("div",{class:zi.diamondLeftCol},c?n.right:n.left),U("div",{class:zi.diamondMidCol},U("div",{class:zi.diamondMidColLabel},n.top),a,U("div",{class:zi.diamondMidColLabel},n.bottom)),U("div",{class:zi.diamondRightCol},c?n.left:n.right)):U("div",{class:zi.squareTable},U("div",{class:zi.squareTableRow},U("div",{class:RE(zi.squareTableCell,zi.squareTableLabel,zi.squareTableLabelRightBottom)},c?n.top:n.left),U("div",{class:zi.squareTableCell}),U("div",{class:RE(zi.squareTableCell,zi.squareTableLabel,zi.squareTableLabelLeftBottom)},c?n.left:n.top)),U("div",{class:zi.squareTableRow},U("div",{class:zi.squareTableCell}),a,U("div",{class:zi.squareTableCell})),U("div",{class:zi.squareTableRow},U("div",{class:RE(zi.squareTableCell,zi.squareTableLabel,zi.squareTableLabelRightTop)},c?n.right:n.bottom),U("div",{class:zi.squareTableCell}),U("div",{class:RE(zi.squareTableCell,zi.squareTableLabel,zi.squareTableLabelLeftTop)},c?n.bottom:n.right)))}function f0e(e,t,r){const i=`${r}_arrowStart`,s=`${r}_arrowEnd`,n=e==="left",o={markerStart:null,markerEnd:null};switch(t){case"HL":n?o.markerStart=`url(#${s})`:o.markerEnd=`url(#${i})`;break;case"LL":o.markerStart=`url(#${s})`;break;case"LH":n?o.markerEnd=`url(#${i})`:o.markerStart=`url(#${s})`;break;default:o.markerEnd=`url(#${i})`}return o}function S3t(e,t,r,i,s=60){const{focus:n,numClasses:o,colors:a,rotation:l}=e,c=!!n,h=Math.sqrt(s**2+s**2)+(c?0:5),p=[],f=[],m=[],g=(s||75)/o;for(let k=0;k<o;k++){const G=k*g;for(let z=0;z<o;z++){const X=z*g,Z=Yre(a[k][z]),ce=Qre(null),ne={type:"rect",x:X,y:G,width:g,height:g};p.push(sRe(Z)),f.push(Zre(ne,Z.fill,ce,null)),m.push(nRe(ne))}}const v=10,w=15,_=15,T=10;let x=null;c||(x="margin: -15px -15px -18px -15px");const E=f0e("left",n,t),C=f0e("right",n,t),A=oRe(m),P=zY(A,h,h,0,!1,l,!1),I=zY(A,h,h,0,!1,c?-45:null,!1),L={filter:xI(i),opacity:r==null?null:`${r}`};return U("div",{styles:L,class:c?zi.diamondMidColRamp:zi.squareTableCell},U("svg",{xmlns:T3t,width:h,height:h,style:x},U("defs",null,U("marker",{id:`${t}_arrowStart`,markerWidth:"10",markerHeight:"10",refX:"5",refY:"5",markerUnits:"strokeWidth",orient:"auto"},U("polyline",{points:"0,0 5,5 0,10",fill:"none",stroke:"#555555","stroke-width":"1"})),U("marker",{id:`${t}_arrowEnd`,markerWidth:"10",markerHeight:"10",refX:"0",refY:"5",markerUnits:"strokeWidth",orient:"auto"},U("polyline",{points:"5,0 0,5 5,10",fill:"none",stroke:"#555555","stroke-width":"1"})),p),U("g",{transform:P},f),U("g",{transform:I},U("line",{fill:"none",stroke:"#555555","stroke-width":"1","marker-start":E.markerStart,"marker-end":E.markerEnd,x1:-v,y1:s-w,x2:-v,y2:w}),U("line",{fill:"none",stroke:"#555555","stroke-width":"1","marker-start":C.markerStart,"marker-end":C.markerEnd,x1:_,y1:s+T,x2:s-_,y2:s+T}))))}const E3t=HU(),ODe=10,Tne=20,z8=10,Sne=20,Ene={univariateAboveAndBelowSymbol:"esri-univariate-above-and-below-ramp__symbol",colorRamp:"esri-legend__color-ramp"};function C3t(e="vertical"){const t="stroke:rgb(200, 200, 200);stroke-width:1";return e==="vertical"?U("svg",{height:"4",width:"10"},U("line",{x1:"0",y1:"2",x2:"10",y2:"2",style:t})):U("svg",{height:"10",width:"10"},U("line",{x1:"5",y1:"0",x2:"5",y2:"10",style:t}))}function A3t(e,t="vertical"){const r=document.createElement("div");return r.style.height=`${Tne}px`,r.className=Ene.univariateAboveAndBelowSymbol,e!=null&&(r.style.opacity=e.toString()),E3t.append(r,C3t.bind(null,t)),r}function MDe(e,t,r="vertical",i){e.infos.forEach((s,n)=>{if(i&&n===2)s.preview=A3t(t,r);else{const o=yr(s.size)+(r==="horizontal"?Sne:z8),a=s.preview.tagName.toLowerCase()==="div",l=a?s.preview:document.createElement("div");l.className=Ene.univariateAboveAndBelowSymbol,r==="horizontal"?l.style.width=`${o}px`:l.style.height=`${o}px`,a||l.appendChild(s.preview),s.preview=l}})}function Ez(e,t="classic"){const r=e.infos;return t==="classic"?(yr(r[0].size)+z8)/2:(yr(r[0].size)-yr(r[r.length-1].size))/2}function OC(e,t){if(!e)return null;const r=e.infos.map(s=>s.color),i=Tw(t.type==="full"?r:t.type==="above"?r.slice(0,3):r.slice(2,5),{width:t.width,height:t.height,align:t.rampAlignment,effectList:t.effectList});return i.className=Ene.colorRamp,t.opacity!=null&&(i.style.opacity=t.opacity.toString()),i}function OJ(e,t,r,i="vertical"){let s=0;const n=e.infos,o=Math.floor(n.length/2),a=t==="full"||t==="above"?0:o,l=t==="full"||t==="below"?n.length-1:o;for(let c=a;c<=l;c++)r&&c===o?s+=i==="horizontal"?ODe:Tne:s+=yr(n[c].size)+(i==="horizontal"?Sne:z8);return Math.round(s)}function MC(e,t,r,i="vertical"){const s=OJ(e,t,r,i),n=e.infos,o=Math.floor(n.length/2),a=t==="full"||t==="above"?0:o,l=t==="full"||t==="below"?n.length-1:o,c=t==="full"?n[a].size+n[l].size:t==="above"?n[a].size:n[l].size,h=r?i==="vertical"?Tne:ODe:0,p=i==="vertical"?z8*(t==="full"?2:1):Sne*(t==="full"?2:1);return Math.round(s-(yr(c)/2+h/2+p/2))}function PDe(e,t,r="vertical"){const i=e.infos;let s=i.find(({type:o})=>o==="size-ramp"),n=i.find(({type:o})=>o==="color-ramp");return s&&(s={...s},s.infos=[...s.infos],MDe(s,t,r,!0)),n&&(n={...n},n.infos=[...n.infos]),r==="horizontal"&&(s==null||s.infos.reverse(),n==null||n.infos.reverse()),{sizeRampElement:s,colorRampElement:n}}function IDe(e,t="vertical"){const r=e.infos;let i=r.find(({type:n})=>n==="size-ramp"),s=r.find(({type:n})=>n==="color-ramp");return i&&(i={...i},i.infos=[...i.infos],MDe(i,null,t,!1)),s&&(s={...s},s.infos=[...s.infos]),t==="horizontal"&&(i==null||i.infos.reverse(),s==null||s.infos.reverse()),{sizeRampElement:i,colorRampElement:s}}function R3t(e,t){return t}function wo(e){const t=this;e.appendChild(t)}function PC(e,t,r){if(!t)return;if(typeof t=="string"||typeof t=="number")return t;if("value"in t||"unit"in t)return nd(e.dotValue,t);if("colorName"in t||"bandName"in t)return e[t.colorName]+": "+(e[t.bandName]||t.bandName);if("showCount"in t)return t.showCount?e.clusterCountTitle:null;let i=null;return R3t(t,r)?i=t.ratioPercentTotal?"showRatioPercentTotal":t.ratioPercent?"showRatioPercent":t.ratio?"showRatio":t.normField?"showNormField":t.field?"showField":null:$De(t,r)&&(i=t.normField?"showNormField":t.normByPct?"showNormPct":t.field?"showField":null),i?nd(i==="showField"?"{field}":e[i],{field:t.field,normField:t.normField}):null}function $De(e,t){return!t}function LDe(e,t){return!!(t&&t==="Stretched"&&e.version>=10.3&&e.declaredClass==="esri.layers.ImageryLayer")}const bt={activated:"esri-legend--card__carousel-indicator--activated",base:"esri-legend--card",stacked:"esri-legend--stacked",carouselTitle:"esri-legend--card__carousel-title",indicator:"esri-legend--card__carousel-indicator",intervalSeparator:"esri-legend--card__interval-separator",imageryLayerStretchedImage:"esri-legend--card__imagery-layer-image--stretched",imageLabel:"esri-legend--card__image-label",layerCaption:"esri-legend--card__layer-caption",labelElement:"esri-legend--card__label-element",layerRow:"esri-legend--card__layer-row",labelCell:"esri-legend--card__label-cell",message:"esri-legend--card__message",rampLabel:"esri-legend--card__ramp-label",section:"esri-legend--card__section",relationshipSection:"esri-legend--card__relationship-section",serviceCaptionText:"esri-legend--card__service-caption-text",serviceContent:"esri-legend--card__service-content",service:"esri-legend--card__service",groupLayer:"esri-legend--card__group-layer",groupLayerChild:"esri-legend--card__group-layer-child",symbol:"esri-legend--card__symbol",sizeRampRow:"esri-legend--card__size-ramp-row",symbolRow:"esri-legend--card__symbol-row",symbolCell:"esri-legend--card__symbol-cell",indicatorContainer:"esri-legend--card__carousel-indicator-container",intervalSeparatorsContainer:"esri-legend--card__interval-separators-container",relationshipLabelContainer:"esri-legend--card__relationship-label-container",labelContainer:"esri-legend--card__label-container",serviceCaptionContainer:"esri-legend--card__service-caption-container",symbolContainer:"esri-legend--card__symbol-container",sizeRampContainer:"esri-legend--card__size-ramp-container",sizeRampPreview:"esri-legend--card__size-ramp-preview",pieChartRampPreview:"esri-legend--card__pie-chart-ramp-preview",rampContainer:"esri-legend__ramps",sizeRampHorizontal:"esri-legend__size-ramp--horizontal",rampLabelsContainer:"esri-legend__ramp-labels",layerInfo:"esri-legend__layer-cell esri-legend__layer-cell--info",univariateAboveAndBelowColorRamp:"esri-univariate-above-and-below-ramp__color--card",hidden:"esri-hidden"},O3t=25,M3t=25,P3t=768,I3t=100;var $P;(function(e){e.Auto="auto",e.Stack="stack",e.SideBySide="side-by-side"})($P||($P={}));const $3t="#ddd",d2=window.devicePixelRatio;function L3t(e){if(e){if(e.type.includes("3d")){const t=e.symbolLayers&&e.symbolLayers.length;if(!t)return;const r=e.symbolLayers.getItemAt(t-1),i=r.resource&&r.resource.primitive;return i==="circle"||i==="cross"||i==="kite"||i==="sphere"||i==="cube"||i==="diamond"}{const t=e.style;return t==="circle"||t==="diamond"||t==="cross"}}}function D3t(e){if(e){if(e.type.includes("3d")){const t=e.symbolLayers&&e.symbolLayers.length;if(!t)return;const r=e.symbolLayers.getItemAt(t-1).get("resource.primitive");return r==="triangle"||r==="cone"||r==="tetrahedron"}return e.style==="triangle"}}let Pp=class extends Un{constructor(e,t){super(e,t),this._handles=new Dt,this._hasIndicators=!1,this._selectedSectionName=null,this._sectionNames=[],this._sectionMap=new Map,this.activeLayerInfos=null,this.headingLevel=3,this.layout=$P.Stack,this.messages=null,this.messagesCommon=null,this.type="card",this.view=null}initialize(){this.own(te(()=>this.activeLayerInfos,e=>{this._handles.removeAll(),this._watchForSectionChanges(e)}))}destroy(){this._handles.destroy(),this._handles=null}render(){this._hasIndicators=this.layout===$P.Auto&&this.view.container.clientWidth<=P3t||this.layout===$P.Stack;const e=this.activeLayerInfos,t=e&&e.toArray().map(a=>this._renderLegendForLayer(a)).filter(a=>!!a);this._hasIndicators?this._selectedSectionName&&this._sectionNames.includes(this._selectedSectionName)||(this._selectedSectionName=this._sectionNames&&this._sectionNames[0]):this._selectedSectionName=null;const r=this._sectionNames.length,i=this._sectionNames.map((a,l)=>{const c=nd(this.messagesCommon.pagination.pageText,{index:l+1,total:r});return U("div",{key:a,role:"tab",id:a,"aria-label":c,"aria-controls":`${a}-panel`,"aria-selected":(this._selectedSectionName===a).toString(),tabIndex:this._selectedSectionName===a?0:-1,title:c,onclick:this._selectSection,onkeydown:this._focusSection,bind:this,class:this.classes(bt.indicator,{[bt.activated]:this._selectedSectionName===a}),"data-section-name":a})}),s=this._hasIndicators&&r>1?U("div",{class:bt.indicatorContainer,key:"carousel-navigation",role:"tablist"},i):null,n=this._hasIndicators?this._sectionMap.get(this._selectedSectionName):t&&t.length?t:null,o={[bt.stacked]:this._hasIndicators};return U("div",{class:this.classes(bt.base,o)},n||U("div",{class:bt.message},this.messages.noLegend),s)}_selectSection(e){const t=e.target.getAttribute("data-section-name");t&&(this._selectedSectionName=t)}_focusSection(e){switch(e.key){case"ArrowLeft":case"ArrowRight":this._switchSectionOnArrowPress(e);break;case"Enter":case" ":this._selectSection(e)}}_switchSectionOnArrowPress(e){const t=e.key,r=t==="ArrowLeft"?-1:1,i=e.target.getAttribute("data-section-name"),s=this._sectionNames.indexOf(i),n=this._sectionNames;let o=null;s!==-1&&(n[s+r]?o=document.getElementById(n[s+r]):t==="ArrowLeft"?o=document.getElementById(n[n.length-1]):t==="ArrowRight"&&(o=document.getElementById(n[0])),o&&o.focus())}_watchForSectionChanges(e){if(this._generateSectionNames(),e){e.forEach(r=>{const i=`activeLayerInfo-${r.layer.uid}-version-change`;this._handles.remove(i),this._watchForSectionChanges(r.children),this._handles.add(te(()=>r.version,()=>this._generateSectionNames()),i)});const t="activeLayerInfos-collection-change";this._handles.remove(t),this._handles.add(e.on("change",()=>this._watchForSectionChanges(e)),t)}}_generateSectionNames(){this._sectionNames.length=0,this._selectedSectionName=null,this.activeLayerInfos&&this.activeLayerInfos.forEach(this._generateSectionNamesForActiveLayerInfo,this)}_getSectionName(e,t,r){return`${this.id}${e.uid}-type-${t.type}-${r}`}_generateSectionNamesForActiveLayerInfo(e){e.children.forEach(this._generateSectionNamesForActiveLayerInfo,this),e.legendElements&&e.legendElements.forEach((t,r)=>{this._sectionNames.push(this._getSectionName(e.layer,t,r))})}_renderLegendForLayer(e){if(!e.ready)return null;if(e.children.length){const t=e.children.map(r=>this._renderLegendForLayer(r)).toArray();return U("div",{key:e.layer.uid,class:this.classes(bt.service,bt.groupLayer)},U("div",{class:bt.serviceCaptionContainer},e.title),t)}{const t=e.legendElements;if(t&&!t.length)return null;const r=t.some(n=>n.type==="relationship-ramp"),i=t.map((n,o)=>this._renderLegendForElement(n,e,o,r)).filter(n=>!!n);if(!i.length)return null;const s={[bt.groupLayerChild]:!!e.parent};return U("div",{key:e.layer.uid,class:this.classes(bt.service,s)},U("div",{class:bt.serviceCaptionContainer},U("div",{class:bt.serviceCaptionText},e.title)),U("div",{class:bt.serviceContent},i))}}_renderLegendForElement(e,t,r,i=!1){const s=e.type==="color-ramp",n=e.type==="opacity-ramp",o=e.type==="size-ramp",a=t.layer;let l=null;if(typeof e.title=="string")l=e.title;else if(e.title){const g=e.title,v=PC(this.messages,g,s||n);l=g.title?`${g.title} (${v})`:v}const c=this._getSectionName(a,e,r),h=this._hasIndicators?U("div",null,U(u1,{level:this.headingLevel,class:bt.carouselTitle},t.title),U(u1,{level:Pqe(this.headingLevel),class:bt.layerCaption},l)):l?U(u1,{level:this.headingLevel,class:bt.layerCaption},l):null,p=t.effectList;let f=null;if(e.type==="symbol-table"){const g=e.infos.map((v,w)=>this._renderLegendForElementInfo(v,t,e.legendType,w)).filter(v=>!!v);if(g.length){const v=g[0].properties.classes&&g[0].properties.classes[bt.symbolRow],w={[bt.labelContainer]:!v&&!i,[bt.relationshipLabelContainer]:i};f=U("div",{class:this.classes(w)},g)}}else e.type==="color-ramp"||e.type==="opacity-ramp"||e.type==="heatmap-ramp"?f=this._renderLegendForRamp(e,a.opacity,p):o?f=this._renderSizeRamp(e,a.opacity):e.type==="pie-chart-ramp"?f=this._renderPieChartRamp(e):e.type==="relationship-ramp"?f=RDe(e,this.id,a.opacity,p):e.type==="univariate-above-and-below-ramp"?f=this._renderUnivariateAboveAndBelowRamp(e,a.opacity,p):e.type==="univariate-color-size-ramp"&&(f=this._renderUnivariateColorSizeRamp(e,a.opacity,p));if(!f)return null;const m=U("div",{key:c,class:bt.section,id:`${c}-panel`,role:"tabpanel","aria-labelledby":c,tabIndex:0},[h,f]);return this._sectionMap.set(c,m),m}_renderPieChartRamp(e){return U("div",{class:bt.pieChartRampPreview,bind:e.preview,afterCreate:wo})}_renderUnivariateAboveAndBelowRamp(e,t,r){const{sizeRampElement:i,colorRampElement:s}=PDe(e,t,"horizontal");if(!i)return null;const n=OJ(i,"full",!0,"horizontal"),o=MC(i,"above",!0,"horizontal"),a=MC(i,"below",!0,"horizontal"),l=12,c=OC(s,{width:o,height:l,rampAlignment:"horizontal",opacity:t,type:"above",effectList:r}),h=OC(s,{width:a,height:l,rampAlignment:"horizontal",opacity:t,type:"below",effectList:r}),p=Ez(i,"card"),f=i.infos.map(x=>x.label),m=f.length-1,g=f.map((x,E)=>E===0||E===m?U("div",{key:E},x):null),v={display:"flex",flexDirection:"column"},w={display:"flex",flexDirection:"row"},_={marginTop:"3px",display:"flex"};nf(this.container)?_.marginRight=`${p}px`:_.marginLeft=`${p}px`;const T={width:`${n}px`,display:"flex",flexDirection:"row",justifyContent:"space-between"};return U("div",{class:bt.layerRow,key:"size-ramp-preview",styles:v},U("div",{class:this.classes(bt.symbolContainer,bt.sizeRampHorizontal),styles:w},i.infos.map((x,E)=>U("div",{key:E,class:bt.symbol,bind:x.preview,afterCreate:wo}))),c?U("div",{class:bt.univariateAboveAndBelowColorRamp,styles:_,key:"color-ramp-preview"},U("div",{bind:c,afterCreate:wo}),U("div",{bind:h,afterCreate:wo})):null,U("div",{class:bt.layerInfo},U("div",{class:bt.rampLabelsContainer,styles:T},g)))}_renderUnivariateColorSizeRamp(e,t,r){const{sizeRampElement:i,colorRampElement:s}=IDe(e,"horizontal");if(!i)return null;const n=OJ(i,"full",!1,"horizontal"),o=MC(i,"full",!1,"horizontal"),a=OC(s,{width:o,height:12,rampAlignment:"horizontal",opacity:t,type:"full",effectList:r}),l=Ez(i,"card"),c=i.infos.length-1,h=i.infos.map((v,w)=>w===0||w===c?U("div",{key:w},v.label):null),p={display:"flex",flexDirection:"column"},f={display:"flex",flexDirection:"row"},m={marginTop:"3px",display:"flex"};nf(this.container)?m.marginRight=`${l}px`:m.marginLeft=`${l}px`;const g={width:`${n}px`,display:"flex",flexDirection:"row",justifyContent:"space-between"};return U("div",{class:bt.layerRow,key:"size-ramp-preview",styles:p},U("div",{class:this.classes(bt.symbolContainer,bt.sizeRampHorizontal),styles:f},i.infos.map((v,w)=>U("div",{key:w,class:bt.symbol,bind:v.preview,afterCreate:wo}))),U("div",{class:bt.univariateAboveAndBelowColorRamp,styles:m,key:"color-ramp-preview"},U("div",{bind:a,afterCreate:wo})),U("div",{class:bt.layerInfo},U("div",{class:bt.rampLabelsContainer,styles:g},h)))}_renderLegendForElementInfo(e,t,r,i){var o,a;const s=t.layer;if(e.type)return this._renderLegendForElement(e,t,i);const n=LDe(s,r);if(e.preview){if(!e.symbol||!e.symbol.type.includes("simple-fill")){if(!e.label)return U("div",{key:i,bind:e.preview,afterCreate:wo});const C={[bt.symbolCell]:this._hasIndicators};return U("div",{key:i,class:this.classes(bt.layerRow,{[bt.symbolRow]:this._hasIndicators})},U("div",{class:this.classes(C),bind:e.preview,afterCreate:wo}),U("div",{class:this.classes(bt.imageLabel,{[bt.labelCell]:this._hasIndicators})},PC(this.messages,e.label,!1)||""))}let l=255,c=255,h=255,p=0,f=255,m=255,g=255,v=0;const w=e.symbol.color&&e.symbol.color.a,_=e.symbol.outline&&e.symbol.outline.color&&e.symbol.outline.color.a;w&&(l=e.symbol.color.r,c=e.symbol.color.g,h=e.symbol.color.b,p=e.symbol.color.a*s.opacity),_&&(f=e.symbol.outline.color.r,m=e.symbol.outline.color.g,g=e.symbol.outline.color.b,v=e.symbol.outline.color.a*s.opacity);const T=(a=(o=e.symbol.color)==null?void 0:o.isBright)!=null?a:!0,x=T?"rgba(255, 255, 255, .6)":"rgba(0, 0, 0, .6)",E={background:w?`rgba(${l}, ${c}, ${h}, ${p})`:"none",color:T?"black":"white",textShadow:`-1px -1px 0 ${x},
                                              1px -1px 0 ${x},
                                              -1px 1px 0 ${x},
                                              1px 1px 0 ${x}`,border:_?`1px solid rgba(${f}, ${m}, ${g}, ${v})`:"none",filter:xI(t.effectList)};return U("div",{key:i,class:bt.layerRow},U("div",{class:bt.labelElement,styles:E}," ",e.label," "))}if(e.src){const l=this._renderImage(e,s,n);return U("div",{key:i,class:bt.layerRow},l,U("div",{class:bt.imageLabel},e.label||""))}}_renderImage(e,t,r){const{label:i,src:s,opacity:n}=e,o={[bt.imageryLayerStretchedImage]:r,[bt.symbol]:!r},a={opacity:`${n!=null?n:t.opacity}`};return U("img",{alt:PC(this.messages,i,!1),src:s,border:0,width:e.width,height:e.height,class:this.classes(o),styles:a})}_renderSizeRampLines(e){const t=e.infos,r=t[0],i=t[t.length-1],s=r.symbol,n=this._hasIndicators,o=yr(r.size+r.outlineSize)*d2,a=yr(i.size+i.outlineSize)*d2,l=n?o:o+50*d2,c=n?o/2+50*d2:o,h=D3t(s),p=L3t(s),f=document.createElement("canvas");f.width=l,f.height=c,f.style.width=f.width/d2+"px",f.style.height=f.height/d2+"px";const m=f.getContext("2d");if(n){m.beginPath();const g=0,v=0,w=l/2-a/2,_=c;m.moveTo(g,v),m.lineTo(w,_);const T=l,x=0,E=l/2+a/2,C=c;m.moveTo(T,x),m.lineTo(E,C)}else{m.beginPath();const g=0,v=c/2-a/2,w=l,_=0;m.moveTo(g,v),m.lineTo(w,_);const T=0,x=c/2+a/2,E=l,C=c;m.moveTo(T,x),m.lineTo(E,C)}return m.strokeStyle=$3t,m.stroke(),U("div",{bind:f,afterCreate:wo,styles:n?{display:"flex",marginTop:`-${h?0:p?o/2:0}px`,marginBottom:`-${h?a:p?a/2:0}px`}:{display:"flex",marginRight:`-${h?0:p?o/2:0}px`,marginLeft:`-${h?0:p?a/2:0}px`}})}_renderSizeRamp(e,t){const r=e.infos,i=r[0].label,s=r[r.length-1].label;let n=r[0].preview,o=r[r.length-1].preview;const a=this._hasIndicators,l={"flex-direction":a?"column":"row-reverse"};n&&(n=n.cloneNode(!0),n.style.display="flex"),o&&(o=o.cloneNode(!0),o.style.display="flex");const c={opacity:t!=null?`${t}`:""};return U("div",{class:this.classes(bt.layerRow,{[bt.sizeRampRow]:a})},U("div",{class:bt.rampLabel},a?i:s),U("div",{class:bt.sizeRampContainer,styles:l},U("div",{bind:n,afterCreate:wo,class:bt.sizeRampPreview,styles:c}),this._renderSizeRampLines(e),U("div",{bind:o,afterCreate:wo,class:bt.sizeRampContainer,styles:c})),U("div",{class:bt.rampLabel},a?s:i))}_renderLegendForRamp(e,t,r){const i=e.infos,s=e.type==="heatmap-ramp",n=i.length-1,o=M3t,a=n>2&&!s?O3t*n:I3t,l=a+20,c=10,h=i.slice(0).reverse();h.forEach((C,A)=>{C.offset=s?C.ratio:A/n});const p=h.length-1,f=h.length%2!=0&&h[h.length/2|0],m=f&&U("div",{class:bt.intervalSeparatorsContainer},U("div",{class:bt.intervalSeparator},"|"),U("div",{class:bt.rampLabel},f.label)),g=i[i.length-1].label,v=i[0].label,w=[[{shape:{type:"path",path:`M0 ${o/2} L${c} 0 L${c} ${o} Z`},fill:h[0].color,stroke:{width:0}},{shape:{type:"rect",x:c,y:0,width:a,height:o},fill:{type:"linear",x1:c,y1:0,x2:a+c,y2:0,colors:h},stroke:{width:0}},{shape:{type:"path",path:`M${a+c} 0 L${l} ${o/2} L${a+c} ${o} Z`},fill:h[p].color,stroke:{width:0}}]],_=aRe(w,l,o),{messages:T}=this,x={filter:xI(r),opacity:t==null?null:`${t}`},E={justifyContent:"center"};return U("div",{class:bt.layerRow,styles:E},U("div",{class:bt.rampLabel},s?T[g]:g),U("div",{class:bt.symbolContainer},U("div",{styles:x},_),m),U("div",{class:bt.rampLabel},s?T[v]:v))}};u([d()],Pp.prototype,"activeLayerInfos",void 0),u([d()],Pp.prototype,"headingLevel",void 0),u([d()],Pp.prototype,"layout",void 0),u([d(),Js("esri/widgets/Legend/t9n/Legend")],Pp.prototype,"messages",void 0),u([d(),Js("esri/t9n/common")],Pp.prototype,"messagesCommon",void 0),u([d({readOnly:!0})],Pp.prototype,"type",void 0),u([d()],Pp.prototype,"view",void 0),u([sl()],Pp.prototype,"_selectSection",null),Pp=u([$("esri.widgets.Legend.styles.Card")],Pp);const SH=Pp,kt={service:"esri-legend__service",label:"esri-legend__service-label",layer:"esri-legend__layer",groupLayer:"esri-legend__group-layer",groupLayerChild:"esri-legend__group-layer-child",layerTable:"esri-legend__layer-table",layerTableSizeRamp:"esri-legend__layer-table--size-ramp",layerChildTable:"esri-legend__layer-child-table",layerCaption:"esri-legend__layer-caption",layerBody:"esri-legend__layer-body",layerRow:"esri-legend__layer-row",layerCell:"esri-legend__layer-cell",layerInfo:"esri-legend__layer-cell esri-legend__layer-cell--info",imageryLayerStretchedImage:"esri-legend__imagery-layer-image--stretched",imageryLayerCellStretched:"esri-legend__imagery-layer-cell--stretched",imageryLayerInfoStretched:"esri-legend__imagery-layer-info--stretched",symbolContainer:"esri-legend__layer-cell esri-legend__layer-cell--symbols",symbol:"esri-legend__symbol",rampContainer:"esri-legend__ramps",sizeRamp:"esri-legend__size-ramp",colorRamp:"esri-legend__color-ramp",opacityRamp:"esri-legend__opacity-ramp",borderlessRamp:"esri-legend__borderless-ramp",rampTick:"esri-legend__ramp-tick",rampFirstTick:"esri-legend__ramp-tick-first",rampLastTick:"esri-legend__ramp-tick-last",rampLabelsContainer:"esri-legend__ramp-labels",rampLabel:"esri-legend__ramp-label",univariateAboveAndBelowSymbol:"esri-univariate-above-and-below-ramp__symbol",univariateAboveAndBelowLabel:"esri-univariate-above-and-below-ramp__label",message:"esri-legend__message",header:"esri-widget__heading",hidden:"esri-hidden"},N3t="esri-legend__",F3t=24,m0e={display:"flex",alignItems:"flex-start"},EH={marginLeft:"3px"},p2={display:"table-cell",verticalAlign:"middle"};let Bw=class extends Un{constructor(e,t){super(e,t),this.activeLayerInfos=null,this.headingLevel=3,this.messages=null,this.type="classic"}render(){const e=this.activeLayerInfos,t=e&&e.toArray().map(r=>this._renderLegendForLayer(r)).filter(r=>!!r);return U("div",null,t&&t.length?t:U("div",{class:kt.message},this.messages.noLegend))}_renderLegendForLayer(e){if(!e.ready)return null;const t=!!e.children.length,r=`${N3t}${e.layer.uid}-version-${e.version}`,i=e.title?u1({level:this.headingLevel,class:this.classes(kt.header,kt.label)},e.title):null;if(t){const s=e.children.map(n=>this._renderLegendForLayer(n)).toArray();return U("div",{key:r,class:this.classes(kt.service,kt.groupLayer)},i,s)}{const s=e.legendElements;if(s&&!s.length)return null;const n=s.map(a=>this._renderLegendForElement(a,e.layer,e.effectList)).filter(a=>!!a);if(!n.length)return null;const o={[kt.groupLayerChild]:!!e.parent};return U("div",{key:r,class:this.classes(kt.service,o),tabIndex:0},i,U("div",{class:kt.layer},n))}}_renderLegendForElement(e,t,r,i){const s=e.type==="color-ramp",n=e.type==="opacity-ramp",o=e.type==="size-ramp";let a=null;if(e.type==="symbol-table"||o){const m=e.infos.map(g=>this._renderLegendForElementInfo(g,t,r,o,e.legendType)).filter(g=>!!g);m.length&&(a=U("div",{class:kt.layerBody},m))}else e.type==="color-ramp"||e.type==="opacity-ramp"||e.type==="heatmap-ramp"||e.type==="stretch-ramp"?a=this._renderLegendForRamp(e,t.opacity):e.type==="relationship-ramp"?a=RDe(e,this.id,t.opacity,r):e.type==="pie-chart-ramp"?a=this._renderPieChartRamp(e):e.type==="univariate-above-and-below-ramp"?a=this._renderUnivariateAboveAndBelowRamp(e,t.opacity,r):e.type==="univariate-color-size-ramp"&&(a=this._renderUnivariateColorSizeRamp(e,t.opacity,r));if(!a)return null;const l=e.title;let c=null;if(typeof l=="string")c=l;else if(l){const m=PC(this.messages,l,s||n);c=$De(l,s||n)&&l.title?`${l.title} (${m})`:m}const h=i?kt.layerChildTable:kt.layerTable,p=c?U("div",{class:kt.layerCaption},c):null,f={[kt.layerTableSizeRamp]:o||!i};return U("div",{class:this.classes(h,f)},p,a)}_renderPieChartRamp(e){return U("div",{bind:e.preview,afterCreate:wo})}_renderUnivariateAboveAndBelowRamp(e,t,r){const{sizeRampElement:i,colorRampElement:s}=PDe(e,t);if(!i)return null;const n=MC(i,"above",!0),o=MC(i,"below",!0),a=12,l=OC(s,{width:a,height:n,rampAlignment:"vertical",opacity:t,type:"above",effectList:r}),c=OC(s,{width:a,height:o,rampAlignment:"vertical",opacity:t,type:"below",effectList:r}),h=Ez(i),p=i.infos.map(E=>E.label),f=p.map((E,C)=>C===0?U("div",{key:C,class:E?l?kt.univariateAboveAndBelowLabel:kt.rampLabel:null},E):C===2?U("div",null):null),m=p.length-1,g=Math.floor(p.length/2),v=p.map((E,C)=>C===g||C===m?U("div",{key:C,class:E?l?kt.univariateAboveAndBelowLabel:kt.rampLabel:null},E):null),w={display:"table-cell",verticalAlign:"middle"},_={marginTop:`${h}px`},T={height:`${n}px`},x={height:`${o}px`};return U("div",{key:"univariate-above-and-below-ramp-preview",styles:m0e},U("div",{class:kt.layerBody},i.infos.map((E,C)=>U("div",{class:this.classes(kt.layerRow,kt.sizeRamp)},U("div",{class:kt.symbol,styles:w,bind:E.preview,afterCreate:wo}),l||C%2!=0?null:U("div",{class:kt.layerInfo},p[C])))),l?U("div",{styles:_,key:"color-ramp-preview"},U("div",{styles:EH},U("div",{styles:p2},U("div",{class:kt.rampContainer,bind:l,afterCreate:wo})),U("div",{styles:p2},U("div",{class:kt.rampLabelsContainer,styles:T},f))),U("div",{styles:EH},U("div",{styles:p2},U("div",{class:kt.rampContainer,bind:c,afterCreate:wo})),U("div",{styles:p2},U("div",{class:kt.rampLabelsContainer,styles:x},v)))):null)}_renderUnivariateColorSizeRamp(e,t,r){const{sizeRampElement:i,colorRampElement:s}=IDe(e);if(!i)return null;const n=Ez(i),o=12,a=MC(i,"full",!1),l=OC(s,{width:o,height:a,rampAlignment:"vertical",opacity:t,type:"full",effectList:r}),c=i.infos.length-1,h=i.infos.map((g,v)=>v===0||v===c?U("div",{key:v,class:g.label?s?kt.univariateAboveAndBelowLabel:kt.rampLabel:null},g.label):null),p={display:"table-cell",verticalAlign:"middle"},f={marginTop:`${n}px`},m={height:`${a}px`};return U("div",{key:"univariate-above-and-below-ramp-preview",styles:m0e},U("div",{class:kt.layerBody},i.infos.map(g=>U("div",{class:this.classes(kt.layerRow,kt.sizeRamp)},U("div",{class:kt.symbol,styles:p,bind:g.preview,afterCreate:wo})))),U("div",{styles:f,key:"color-ramp-preview"},U("div",{styles:EH},U("div",{styles:p2},U("div",{class:kt.rampContainer,bind:l,afterCreate:wo})),U("div",{styles:p2},U("div",{class:kt.rampLabelsContainer,styles:m},h)))))}_renderLegendForRamp(e,t){const r=e.infos,i=e.type==="opacity-ramp",s=e.type==="heatmap-ramp",n=e.type==="stretch-ramp",o=e.preview,a=i?kt.opacityRamp:"";o.className=`${kt.colorRamp} ${a}`,t!=null&&(o.style.opacity=t.toString());const l=r.map(p=>U("div",{class:p.label?kt.rampLabel:null},s?this.messages[p.label]||p.label:n?this._getStretchStopLabel(p):p.label)),c={width:`${F3t}px`},h={height:o.style.height};return U("div",{class:kt.layerRow},U("div",{class:kt.symbolContainer,styles:c},U("div",{class:kt.rampContainer,bind:o,afterCreate:wo})),U("div",{class:kt.layerInfo},U("div",{class:kt.rampLabelsContainer,styles:h},l)))}_getStretchStopLabel(e){return e.label?this.messages[e.label]+": "+(typeof e.value=="string"?e.value:Ud(e.value,{style:"decimal",notation:e.value.toString().includes("e")?"scientific":"standard"})):""}_renderLegendForElementInfo(e,t,r,i,s){if(e.type)return this._renderLegendForElement(e,t,r,!0);let n=null;const o=LDe(t,s);if(e.preview?n=U("div",{class:kt.symbol,bind:e.preview,afterCreate:wo}):e.src&&(n=this._renderImage(e,t,o)),!n)return null;const a={[kt.imageryLayerInfoStretched]:o},l={[kt.imageryLayerInfoStretched]:o,[kt.sizeRamp]:!o&&i};return U("div",{class:kt.layerRow},U("div",{class:this.classes(kt.symbolContainer,l)},n),U("div",{class:this.classes(kt.layerInfo,a)},PC(this.messages,e.label,!1)||""))}_renderImage(e,t,r){const{label:i,src:s,opacity:n}=e,o={[kt.imageryLayerStretchedImage]:r,[kt.symbol]:!r},a={opacity:`${n!=null?n:t.opacity}`};return U("img",{alt:PC(this.messages,i,!1),src:s,border:0,width:e.width,height:e.height,class:this.classes(o),styles:a})}};u([d()],Bw.prototype,"activeLayerInfos",void 0),u([d()],Bw.prototype,"headingLevel",void 0),u([d(),Js("esri/widgets/Legend/t9n/Legend")],Bw.prototype,"messages",void 0),u([d({readOnly:!0})],Bw.prototype,"type",void 0),Bw=u([$("esri.widgets.Legend.styles.Classic")],Bw);const f2=Bw,m4={base:"esri-legend",widget:"esri-widget",panel:"esri-widget--panel",widgetIcon:"esri-icon-layer-list"};let Wo=class extends Un{constructor(e,t){super(e,t),this._handles=new Dt,this.activeLayerInfos=null,this.basemapLegendVisible=!1,this.groundLegendVisible=!1,this.headingLevel=3,this.hideLayersNotInCurrentView=!1,this.keepCacheOnDestroy=!1,this.respectLayerVisibility=!0,this.iconClass=m4.widgetIcon,this.label=void 0,this.layerInfos=null,this.messages=null,this.style=new f2,this.view=null,this.viewModel=new x3t}initialize(){this.own([rs(()=>this.view,"resize",()=>this.scheduleRender()),rs(()=>this.activeLayerInfos,"change",()=>this._refreshActiveLayerInfos(this.activeLayerInfos)),te(()=>this.headingLevel,e=>{const{style:t}=this;t&&(t.headingLevel=e)}),te(()=>this.style,(e,t)=>{t&&e!==t&&t.destroy(),e&&(e.activeLayerInfos=this.activeLayerInfos,e.type==="card"&&(e.view=this.view),e.headingLevel=this.headingLevel)},Rt)])}destroy(){this._handles=ct(this._handles)}castStyle(e){if(e instanceof SH||e instanceof f2)return e;if(typeof e=="string")return e==="card"?new SH:new f2;if(e&&typeof e.type=="string"){const t={...e};return delete t.type,new(e.type==="card"?SH:f2)(t)}return new f2}render(){return U("div",{class:this.classes(m4.base,m4.widget,this.style instanceof f2?m4.panel:null)},this.style.render())}_refreshActiveLayerInfos(e){this._handles.removeAll(),e.forEach(t=>this._renderOnActiveLayerInfoChange(t)),this.scheduleRender()}_renderOnActiveLayerInfoChange(e){const t=te(()=>e.version,()=>this.scheduleRender());this._handles.add(t,`version_${e.layer.uid}`);const r=rs(()=>e.children,"change",()=>e.children.forEach(i=>this._renderOnActiveLayerInfoChange(i)),Rt);this._handles.add(r,`children_${e.layer.uid}`),e.children.forEach(i=>this._renderOnActiveLayerInfoChange(i))}};u([We("viewModel.activeLayerInfos")],Wo.prototype,"activeLayerInfos",void 0),u([We("viewModel.basemapLegendVisible")],Wo.prototype,"basemapLegendVisible",void 0),u([We("viewModel.groundLegendVisible")],Wo.prototype,"groundLegendVisible",void 0),u([d()],Wo.prototype,"headingLevel",void 0),u([We("viewModel.hideLayersNotInCurrentView")],Wo.prototype,"hideLayersNotInCurrentView",void 0),u([We("viewModel.keepCacheOnDestroy")],Wo.prototype,"keepCacheOnDestroy",void 0),u([We("viewModel.respectLayerVisibility")],Wo.prototype,"respectLayerVisibility",void 0),u([d()],Wo.prototype,"iconClass",void 0),u([d({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],Wo.prototype,"label",void 0),u([We("viewModel.layerInfos")],Wo.prototype,"layerInfos",void 0),u([d(),Js("esri/widgets/Legend/t9n/Legend")],Wo.prototype,"messages",void 0),u([d()],Wo.prototype,"style",void 0),u([qt("style")],Wo.prototype,"castStyle",null),u([We("viewModel.view")],Wo.prototype,"view",void 0),u([d()],Wo.prototype,"viewModel",void 0),Wo=u([$("esri.widgets.Legend")],Wo);const k3t=Wo;var Cne={exports:{}},B8={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var U3t=IC.exports,V3t=Symbol.for("react.element"),z3t=Symbol.for("react.fragment"),B3t=Object.prototype.hasOwnProperty,G3t=U3t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,j3t={key:!0,ref:!0,__self:!0,__source:!0};function DDe(e,t,r){var i,s={},n=null,o=null;r!==void 0&&(n=""+r),t.key!==void 0&&(n=""+t.key),t.ref!==void 0&&(o=t.ref);for(i in t)B3t.call(t,i)&&!j3t.hasOwnProperty(i)&&(s[i]=t[i]);if(e&&e.defaultProps)for(i in t=e.defaultProps,t)s[i]===void 0&&(s[i]=t[i]);return{$$typeof:V3t,type:e,key:n,ref:o,props:s,_owner:G3t.current}}B8.Fragment=z3t;B8.jsx=DDe;B8.jsxs=DDe;(function(e){e.exports=B8})(Cne);const M$=Cne.exports.jsx,H3t=Cne.exports.jsxs,q3t=()=>M$("h1",{className:"App__title",children:"Falls Church - Affordable Housing"}),W3t={supportsStatistics:!0,supportsPercentileStatistics:!0,supportsSpatialAggregationStatistics:!1,supportedSpatialAggregationStatistics:{envelope:!1,centroid:!1,convexHull:!1},supportsCentroid:!0,supportsCacheHint:!1,supportsDistance:!0,supportsDistinct:!0,supportsExtent:!0,supportsGeometryProperties:!1,supportsHavingClause:!0,supportsOrderBy:!0,supportsPagination:!0,supportsQuantization:!0,supportsQuantizationEditMode:!1,supportsQueryGeometry:!0,supportsResultType:!1,supportsSqlExpression:!0,supportsMaxRecordCountFactor:!1,supportsStandardizedQueriesOnly:!0,supportsTopFeaturesQuery:!1,supportsQueryByOthers:!0,supportsHistoricMoment:!1,supportsFormatPBF:!1,supportsDisjointSpatialRelationship:!0,supportsDefaultSpatialReference:!1,supportsCompactGeometry:!1,maxRecordCountFactor:void 0,maxRecordCount:void 0,standardMaxRecordCount:void 0,tileMaxRecordCount:void 0};function wNt(e){return{renderer:{type:"simple",symbol:e==="esriGeometryPoint"||e==="esriGeometryMultipoint"?RAe:e==="esriGeometryPolyline"?OAe:MAe}}}const X3t=/^[_$a-zA-Z][_$a-zA-Z0-9]*$/;let Z3t=1;function xNt(e,t){if(he("esri-csp-restrictions"))return()=>({[t]:null,...e});try{let r=`this.${t} = null;`;for(const s in e)r+=`this${X3t.test(s)?`.${s}`:`["${s}"]`} = ${JSON.stringify(e[s])};`;const i=new Function(`
      return class AttributesClass$${Z3t++} {
        constructor() {
          ${r};
        }
      }
    `)();return()=>new i}catch{return()=>({[t]:null,...e})}}function TNt(e={}){return[{name:"New Feature",description:"",prototype:{attributes:re(e)}}]}function Y3t(e,t){return{analytics:{supportsCacheHint:!1},attachment:null,data:{isVersioned:!1,supportsAttachment:!1,supportsM:!1,supportsZ:e},metadata:{supportsAdvancedFieldProperties:!1},operations:{supportsCalculate:!1,supportsTruncate:!1,supportsValidateSql:!1,supportsAdd:t,supportsDelete:t,supportsEditing:t,supportsChangeTracking:!1,supportsQuery:!0,supportsQueryAnalytics:!1,supportsQueryAttachments:!1,supportsQueryTopFeatures:!1,supportsResizeAttachments:!1,supportsSync:!1,supportsUpdate:t,supportsExceedsLimitStatistics:!0},query:W3t,queryRelated:{supportsCount:!0,supportsOrderBy:!0,supportsPagination:!0,supportsCacheHint:!1},queryTopFeatures:{supportsCacheHint:!1},editing:{supportsGeometryUpdate:t,supportsGlobalId:!1,supportsReturnServiceEditsInSourceSpatialReference:!1,supportsRollbackOnFailure:!1,supportsUpdateWithoutM:!1,supportsUploadWithItemId:!1,supportsDeleteByAnonymous:!1,supportsDeleteByOthers:!1,supportsUpdateByAnonymous:!1,supportsUpdateByOthers:!1}}}const g0e=fe.getLogger("esri.layers.graphics.sources.GeoJSONSource");let Gw=class extends gh{constructor(){super(...arguments),this.type="geojson",this.refresh=z$(async e=>{await this.load();const{extent:t,timeExtent:r}=await this._connection.invoke("refresh",e);return this.sourceJSON.extent=t,r&&(this.sourceJSON.timeInfo.timeExtent=[r.start,r.end]),{dataChanged:!0,updates:{extent:this.sourceJSON.extent,timeInfo:this.sourceJSON.timeInfo}}})}load(e){const t=b(e)?e.signal:null;return this.addResolvingPromise(this._startWorker(t)),Promise.resolve(this)}destroy(){var e;(e=this._connection)==null||e.close(),this._connection=null}applyEdits(e){return this.load().then(()=>this._applyEdits(e))}openPorts(){return this.load().then(()=>this._connection.openPorts())}queryFeatures(e,t={}){return this.load(t).then(()=>this._connection.invoke("queryFeatures",e?e.toJSON():null,t)).then(r=>rL.fromJSON(r))}queryFeaturesJSON(e,t={}){return this.load(t).then(()=>this._connection.invoke("queryFeatures",e?e.toJSON():null,t))}queryFeatureCount(e,t={}){return this.load(t).then(()=>this._connection.invoke("queryFeatureCount",e?e.toJSON():null,t))}queryObjectIds(e,t={}){return this.load(t).then(()=>this._connection.invoke("queryObjectIds",e?e.toJSON():null,t))}queryExtent(e,t={}){return this.load(t).then(()=>this._connection.invoke("queryExtent",e?e.toJSON():null,t)).then(r=>({count:r.count,extent:Kt.fromJSON(r.extent)}))}querySnapping(e,t={}){return this.load(t).then(()=>this._connection.invoke("querySnapping",e,t))}_applyEdits(e){if(!this._connection)throw new j("geojson-layer-source:edit-failure","Memory source not loaded");const t=this.layer.objectIdField,r=[],i=[],s=[];if(e.addFeatures)for(const n of e.addFeatures)r.push(this._serializeFeature(n));if(e.deleteFeatures)for(const n of e.deleteFeatures)"objectId"in n&&n.objectId!=null?i.push(n.objectId):"attributes"in n&&n.attributes[t]!=null&&i.push(n.attributes[t]);if(e.updateFeatures)for(const n of e.updateFeatures)s.push(this._serializeFeature(n));return this._connection.invoke("applyEdits",{adds:r,updates:s,deletes:i}).then(({extent:n,timeExtent:o,featureEditResults:a})=>(this.sourceJSON.extent=n,o&&(this.sourceJSON.timeInfo.timeExtent=[o.start,o.end]),this._createEditsResult(a)))}_createEditsResult(e){return{addFeatureResults:e.addResults?e.addResults.map(this._createFeatureEditResult,this):[],updateFeatureResults:e.updateResults?e.updateResults.map(this._createFeatureEditResult,this):[],deleteFeatureResults:e.deleteResults?e.deleteResults.map(this._createFeatureEditResult,this):[],addAttachmentResults:[],updateAttachmentResults:[],deleteAttachmentResults:[]}}_createFeatureEditResult(e){const t=e.success===!0?null:e.error||{code:void 0,description:void 0};return{objectId:e.objectId,globalId:e.globalId,error:t?new j("geojson-layer-source:edit-failure",t.description,{code:t.code}):null}}_serializeFeature(e){const{attributes:t}=e,r=this._geometryForSerialization(e);return r?{geometry:r.toJSON(),attributes:t}:{attributes:t}}_geometryForSerialization(e){const{geometry:t}=e;return R(t)?null:t.type==="mesh"||t.type==="extent"?Oa.fromExtent(t.extent):t}async _startWorker(e){this._connection=await Kee("GeoJSONSourceWorker",{strategy:he("feature-layers-workers")?"dedicated":"local",signal:e});const{fields:t,spatialReference:r,hasZ:i,geometryType:s,objectIdField:n,url:o,timeInfo:a,customParameters:l}=this.layer,c=this.layer.originOf("spatialReference")==="defaults",h={url:o,customParameters:l,fields:t&&t.map(f=>f.toJSON()),geometryType:t6.toJSON(s),hasZ:i,objectIdField:n,timeInfo:a?a.toJSON():null,spatialReference:c?null:r&&r.toJSON()},p=await this._connection.invoke("load",h,{signal:e});for(const f of p.warnings)g0e.warn(f.message,{layer:this.layer,warning:f});p.featureErrors.length&&g0e.warn(`Encountered ${p.featureErrors.length} validation errors while loading features`,p.featureErrors),this.sourceJSON=p.layerDefinition,this.capabilities=Y3t(this.sourceJSON.hasZ,!0)}};u([d()],Gw.prototype,"capabilities",void 0),u([d()],Gw.prototype,"type",void 0),u([d({constructOnly:!0})],Gw.prototype,"layer",void 0),u([d()],Gw.prototype,"sourceJSON",void 0),Gw=u([$("esri.layers.graphics.sources.GeoJSONSource")],Gw);const Q3t=zre();let Or=class extends vAe(fAe(mAe(pAe(SAe(Nre(xAe(Dre(tB(eA))))))))){constructor(e){super(e),this.copyright=null,this.definitionExpression=null,this.displayField=null,this.editingEnabled=!1,this.elevationInfo=null,this.featureReduction=null,this.fields=null,this.fieldsIndex=null,this.fullExtent=null,this.geometryType=null,this.hasZ=void 0,this.labelsVisible=!0,this.labelingInfo=null,this.legendEnabled=!0,this.objectIdField=null,this.operationalLayerType="GeoJSON",this.popupEnabled=!0,this.popupTemplate=null,this.screenSizePerspectiveEnabled=!0,this.source=new Gw({layer:this}),this.spatialReference=Ze.WGS84,this.templates=null,this.title="GeoJSON",this.type="geojson",this.typeIdField=null,this.types=null}destroy(){var e;(e=this.source)==null||e.destroy()}load(e){return this.addResolvingPromise(this.source.load(e).then(()=>{this.read(this.source.sourceJSON,{origin:"service",url:this.parsedUrl}),this.revert(["objectIdField","fields","timeInfo"],"service"),rA(this.renderer,this.fieldsIndex),Iee(this.timeInfo,this.fieldsIndex)})),Promise.resolve(this)}get capabilities(){return this.source?this.source.capabilities:null}get createQueryVersion(){return this.commitProperty("definitionExpression"),this.commitProperty("timeExtent"),this.commitProperty("timeOffset"),this.commitProperty("geometryType"),this.commitProperty("capabilities"),(this._get("createQueryVersion")||0)+1}get defaultPopupTemplate(){return this.createPopupTemplate()}get isTable(){return this.loaded&&this.geometryType==null}get parsedUrl(){return this.url?Ds(this.url):null}set renderer(e){rA(e,this.fieldsIndex),this._set("renderer",e)}set url(e){if(!e)return void this._set("url",e);const t=Ds(e);this._set("url",t.path),t.query&&(this.customParameters={...this.customParameters,...t.query})}async applyEdits(e,t){const r=await ie(()=>import("./editingSupport.141ffbc0.js"),[],import.meta.url);await this.load();const i=await r.applyEdits(this,this.source,e,t);return this.read({extent:this.source.sourceJSON.extent,timeInfo:this.source.sourceJSON.timeInfo},{origin:"service",ignoreDefaults:!0}),i}on(e,t){return super.on(e,t)}createPopupTemplate(e){return Bre(this,e)}createQuery(){const e=new Sa,t=this.get("capabilities.data");e.returnGeometry=!0,t&&t.supportsZ&&(e.returnZ=!0),e.outFields=["*"],e.where=this.definitionExpression||"1=1";const{timeOffset:r,timeExtent:i}=this;return e.timeExtent=r!=null&&i!=null?i.offset(-r.value,r.unit):i||null,e}getFieldDomain(e,t){let r,i=!1;const s=t&&t.feature,n=s&&s.attributes,o=this.typeIdField&&n&&n[this.typeIdField];return o!=null&&this.types&&(i=this.types.some(a=>a.id==o&&(r=a.domains&&a.domains[e],r&&r.type==="inherited"&&(r=this._getLayerDomain(e)),!0))),i||r||(r=this._getLayerDomain(e)),r}getField(e){return this.fieldsIndex.get(e)}queryFeatures(e,t){return this.load().then(()=>this.source.queryFeatures(Sa.from(e)||this.createQuery(),t)).then(r=>{if(r!=null&&r.features)for(const i of r.features)i.layer=i.sourceLayer=this;return r})}queryObjectIds(e,t){return this.load().then(()=>this.source.queryObjectIds(Sa.from(e)||this.createQuery(),t))}queryFeatureCount(e,t){return this.load().then(()=>this.source.queryFeatureCount(Sa.from(e)||this.createQuery(),t))}queryExtent(e,t){return this.load().then(()=>this.source.queryExtent(Sa.from(e)||this.createQuery(),t))}async hasDataChanged(){try{const{dataChanged:e,updates:t}=await this.source.refresh(this.customParameters);return b(t)&&this.read(t,{origin:"service",url:this.parsedUrl,ignoreDefaults:!0}),e}catch{}return!1}_getLayerDomain(e){if(!this.fields)return null;let t=null;return this.fields.some(r=>(r.name===e&&(t=r.domain),!!t)),t}};u([d({readOnly:!0,json:{read:!1,write:!1}})],Or.prototype,"capabilities",null),u([d({type:String})],Or.prototype,"copyright",void 0),u([d({readOnly:!0})],Or.prototype,"createQueryVersion",null),u([d({readOnly:!0})],Or.prototype,"defaultPopupTemplate",null),u([d({type:String,json:{name:"layerDefinition.definitionExpression",write:{enabled:!0,allowNull:!0}}})],Or.prototype,"definitionExpression",void 0),u([d({type:String})],Or.prototype,"displayField",void 0),u([d({type:Boolean})],Or.prototype,"editingEnabled",void 0),u([d($re)],Or.prototype,"elevationInfo",void 0),u([d(LAe)],Or.prototype,"featureReduction",void 0),u([d({type:[gR],json:{name:"layerDefinition.fields",write:{ignoreOrigin:!0,isRequired:!0},origins:{service:{name:"fields"}}}})],Or.prototype,"fields",void 0),u([d(Q3t.fieldsIndex)],Or.prototype,"fieldsIndex",void 0),u([d({type:Kt,json:{name:"extent"}})],Or.prototype,"fullExtent",void 0),u([d({type:["point","polygon","polyline","multipoint"],json:{read:{reader:t6.read}}})],Or.prototype,"geometryType",void 0),u([d({type:Boolean})],Or.prototype,"hasZ",void 0),u([d(Lre)],Or.prototype,"id",void 0),u([d({type:Boolean,readOnly:!0})],Or.prototype,"isTable",null),u([d(dL)],Or.prototype,"labelsVisible",void 0),u([d({type:[SR],json:{name:"layerDefinition.drawingInfo.labelingInfo",read:{reader:OI},write:!0}})],Or.prototype,"labelingInfo",void 0),u([d(Ire)],Or.prototype,"legendEnabled",void 0),u([d({type:["show","hide"]})],Or.prototype,"listMode",void 0),u([d({type:String,json:{name:"layerDefinition.objectIdField",write:{ignoreOrigin:!0,isRequired:!0},origins:{service:{name:"objectIdField"}}}})],Or.prototype,"objectIdField",void 0),u([d(oP)],Or.prototype,"opacity",void 0),u([d({type:["GeoJSON"]})],Or.prototype,"operationalLayerType",void 0),u([d({readOnly:!0})],Or.prototype,"parsedUrl",null),u([d(hL)],Or.prototype,"popupEnabled",void 0),u([d({type:qT,json:{name:"popupInfo",write:!0}})],Or.prototype,"popupTemplate",void 0),u([d({types:uL,json:{name:"layerDefinition.drawingInfo.renderer",write:!0,origins:{service:{name:"drawingInfo.renderer"},"web-scene":{types:Are}}}})],Or.prototype,"renderer",null),u([d(Mre)],Or.prototype,"screenSizePerspectiveEnabled",void 0),u([d({readOnly:!0})],Or.prototype,"source",void 0),u([d({type:Ze})],Or.prototype,"spatialReference",void 0),u([d({type:[sB]})],Or.prototype,"templates",void 0),u([d()],Or.prototype,"title",void 0),u([d({json:{read:!1},readOnly:!0})],Or.prototype,"type",void 0),u([d({type:String,readOnly:!0})],Or.prototype,"typeIdField",void 0),u([d({type:[Vre]})],Or.prototype,"types",void 0),u([d(Pre)],Or.prototype,"url",null),Or=u([$("esri.layers.GeoJSONLayer")],Or);const NDe=Or,SNt=Object.freeze(Object.defineProperty({__proto__:null,default:NDe},Symbol.toStringTag,{value:"Module"})),J3t="#294f89",K3t="#8db9d4",ePt={FC_BRAND_BLUE_DARK:J3t,FC_BRAND_BLUE_LIGHT:K3t},{FC_BRAND_BLUE_LIGHT:ENt,FC_BRAND_BLUE_DARK:y0e}=ePt;function tPt(e){const t=new NDe({url:"./Jurisdictional_Boundary.json",title:"Falls Church - Jurisdictional Boundary",id:"Jurisdictional_Boundary",opacity:.4,renderer:{type:"simple",symbol:{type:"simple-fill",style:"solid",color:y0e,outline:{color:y0e,width:1}}}});e.add(t)}function FDe(e){return e&&"getAtOrigin"in e&&"originOf"in e}function v0e(e){e&&e.writtenProperties&&e.writtenProperties.forEach(({target:t,propName:r,newOrigin:i})=>{FDe(t)&&i&&t.originOf(r)!==i&&t.updateOrigin(r,i)})}async function rPt(e,t,r,i,s,n){let o=null;if(b(r)){const c=`${e}/nodepages/`,h=c+Math.floor(r.rootIndex/r.nodesPerPage);try{return{type:"page",rootPage:(await er(h,{query:{f:"json",token:i},responseType:"json",signal:n})).data,rootIndex:r.rootIndex,pageSize:r.nodesPerPage,lodMetric:r.lodSelectionMetricType,urlPrefix:c}}catch(p){b(s)&&s.warn("#fetchIndexInfo()","Failed to load root node page. Falling back to node documents.",h,p),o=p}}if(!t)return null;const a=`${e}/nodes/`,l=a+(t&&t.split("/").pop());try{return{type:"node",rootNode:(await er(l,{query:{f:"json",token:i},responseType:"json",signal:n})).data,urlPrefix:a}}catch(c){throw new j("sceneservice:root-node-missing","Root node missing.",{pageError:o,nodeError:c,url:l})}}async function iPt(e,t={},r){await e.load(r);const i=sc(e.itemUrl,"resources"),{start:s=1,num:n=10,sortOrder:o="asc",sortField:a="created"}=t,l={query:{start:s,num:n,sortOrder:o,sortField:a,token:e.apiKey},signal:ki(r,"signal")},c=await e.portal._request(i,l);return{total:c.total,nextStart:c.nextStart,resources:c.resources.map(({created:h,size:p,resource:f})=>({created:new Date(h),size:p,resource:e.resourceFromPath(f)}))}}async function sPt(e,t,r,i){if(!e.hasPath())throw new j(`portal-item-resource-${t}:invalid-path`,"Resource does not have a valid path");const s=e.portalItem;await s.load(i);const n=sc(s.userItemUrl,t==="add"?"addResources":"updateResources"),[o,a]=kDe(e.path),l=await UDe(r),c=new FormData;return o&&o!=="."&&c.append("resourcesPrefix",o),c.append("fileName",a),c.append("file",l,a),c.append("f","json"),b(i)&&i.access&&c.append("access",i.access),await s.portal._request(n,{method:"post",body:c,signal:ki(i,"signal")}),e}async function nPt(e,t,r){if(!t.hasPath())throw new j("portal-item-resources-remove:invalid-path","Resource does not have a valid path");await e.load(r);const i=sc(e.userItemUrl,"removeResources");await e.portal._request(i,{method:"post",query:{resource:t.path},signal:ki(r,"signal")}),t.portalItem=null}async function oPt(e,t){await e.load(t);const r=sc(e.userItemUrl,"removeResources");return e.portal._request(r,{method:"post",query:{deleteAll:!0},signal:ki(t,"signal")})}function kDe(e){const t=e.lastIndexOf("/");return t===-1?[".",e]:[e.slice(0,t),e.slice(t+1)]}function Ane(e){const[t,r]=aPt(e),[i,s]=kDe(t);return[i,s,r]}function aPt(e){const t=ree(e);return R(t)?[e,""]:[e.slice(0,e.length-t.length-1),`.${t}`]}async function UDe(e){return e instanceof Blob?e:(await er(e.url,{responseType:"blob"})).data}function lPt(e,t){if(!e.hasPath())return null;const[r,,i]=Ane(e.path);return e.portalItem.resourceFromPath(sc(r,t+i))}function VDe(e,t){if(!e.hasPath())return null;const[r,,i]=Ane(e.path);return e.portalItem.resourceFromPath(sc(r,t+i))}const C3=Object.freeze(Object.defineProperty({__proto__:null,addOrUpdateResource:sPt,contentToBlob:UDe,fetchResources:iPt,getSiblingOfSameType:lPt,getSiblingOfSameTypeI:VDe,removeAllResources:oPt,removeResource:nPt,splitPrefixFileNameAndExtension:Ane},Symbol.toStringTag,{value:"Module"}));async function _0e(e,t,r){if(!t||!t.resources)return;const i=t.portalItem===e.portalItem?new Set(e.paths):new Set;e.paths.length=0,e.portalItem=t.portalItem;const s=new Set(t.resources.toKeep.map(c=>c.resource.path)),n=new Set,o=[];s.forEach(c=>{i.delete(c),e.paths.push(c)});for(const c of t.resources.toUpdate)if(i.delete(c.resource.path),s.has(c.resource.path)||n.has(c.resource.path)){const{resource:h,content:p,finish:f,error:m}=c,g=VDe(h,Ote());e.paths.push(g.path),o.push(b0e({resource:g,content:p,finish:f,error:m},r))}else e.paths.push(c.resource.path),o.push(cPt(c,r)),n.add(c.resource.path);for(const c of t.resources.toAdd)o.push(b0e(c,r)),e.paths.push(c.resource.path);if(i.forEach(c=>{const h=t.portalItem.resourceFromPath(c);o.push(h.portalItem.removeResource(h).catch(()=>{}))}),o.length===0)return;const a=await xs(o);Jt(r);const l=a.filter(c=>"error"in c).map(c=>c.error);if(l.length>0)throw new j("save:resources","Failed to save one or more resources",{errors:l})}async function b0e(e,t){const r=await yh(e.resource.portalItem.addResource(e.resource,e.content,t));if(r.ok!==!0)throw e.error&&e.error(r.error),r.error;e.finish&&e.finish(e.resource)}async function cPt(e,t){const r=await yh(e.resource.update(e.content,t));if(r.ok!==!0)throw e.error(r.error),r.error;e.finish(e.resource)}const m2=fe.getLogger("esri.layers.mixins.SceneService"),uPt=e=>{let t=class extends e{constructor(){super(...arguments),this.spatialReference=null,this.fullExtent=null,this.heightModelInfo=null,this.minScale=0,this.maxScale=0,this.version={major:Number.NaN,minor:Number.NaN,versionString:""},this.copyright=null,this.sublayerTitleMode="item-title",this.title=null,this.layerId=null,this.indexInfo=null,this._debouncedSaveOperations=z$(async(r,i,s)=>{switch(r){case JA.SAVE:return this._save(i);case JA.SAVE_AS:return this._saveAs(s,i)}})}readSpatialReference(r,i){return this._readSpatialReference(i)}_readSpatialReference(r){if(r.spatialReference!=null)return Ze.fromJSON(r.spatialReference);{const i=r.store,s=i.indexCRS||i.geographicCRS,n=s&&parseInt(s.substring(s.lastIndexOf("/")+1,s.length),10);return n!=null?new Ze(n):null}}readFullExtent(r,i,s){if(r!=null&&typeof r=="object"){const a=r.spatialReference==null?{...r,spatialReference:this._readSpatialReference(i)}:r;return Kt.fromJSON(a,s)}const n=i.store,o=this._readSpatialReference(i);return o==null||n==null||n.extent==null||!Array.isArray(n.extent)||n.extent.some(a=>a<CH)?null:new Kt({xmin:n.extent[0],ymin:n.extent[1],xmax:n.extent[2],ymax:n.extent[3],spatialReference:o})}parseVersionString(r){const i={major:Number.NaN,minor:Number.NaN,versionString:r},s=r.split(".");return s.length>=2&&(i.major=parseInt(s[0],10),i.minor=parseInt(s[1],10)),i}readVersion(r,i){const s=i.store,n=s.version!=null?s.version.toString():"";return this.parseVersionString(n)}readTitlePortalItem(r){return this.sublayerTitleMode!=="item-title"?void 0:r}readTitleService(r,i){const s=this.portalItem&&this.portalItem.title;if(this.sublayerTitleMode==="item-title")return lAe(this.url,i.name);let n=i.name;if(!n&&this.url){const o=yT(this.url);b(o)&&(n=o.title)}return this.sublayerTitleMode==="item-title-and-service-name"&&s&&(n=s+" - "+n),rB(n)}set url(r){const i=uAe({layer:this,url:r,nonStandardUrlAllowed:!1,logger:m2});this._set("url",i.url),i.layerId!=null&&this._set("layerId",i.layerId)}writeUrl(r,i,s,n){hAe(this,r,"layers",i,n)}get parsedUrl(){const r=this._get("url");if(!r)return null;const i=Ds(r);return this.layerId!=null&&(i.path=`${i.path}/layers/${this.layerId}`),i}async _fetchIndexAndUpdateExtent(r,i){this.indexInfo=rPt(this.parsedUrl.path,this.rootNode,r,this.apiKey,m2,i),this.fullExtent==null||this.fullExtent.hasZ||this._updateExtent(await this.indexInfo)}_updateExtent(r){var i,s,n;if((r==null?void 0:r.type)==="page"){const o=r.rootIndex%r.pageSize,a=(s=(i=r.rootPage)==null?void 0:i.nodes)==null?void 0:s[o];if(a==null||a.obb==null||a.obb.center==null||a.obb.halfSize==null)throw new j("sceneservice:invalid-node-page","Invalid node page.");if(a.obb.center[0]<CH||this.fullExtent==null||this.fullExtent.hasZ)return;const l=a.obb.halfSize,c=a.obb.center[2],h=Math.sqrt(l[0]*l[0]+l[1]*l[1]+l[2]*l[2]);this.fullExtent.zmin=c-h,this.fullExtent.zmax=c+h}else if((r==null?void 0:r.type)==="node"){const o=(n=r.rootNode)==null?void 0:n.mbs;if(!Array.isArray(o)||o.length!==4||o[0]<CH)return;const a=o[2],l=o[3];this.fullExtent.zmin=a-l,this.fullExtent.zmax=a+l}}async _fetchService(r){if(this.url==null)throw new j("sceneservice:url-not-set","Scene service can not be loaded without valid portal item or url");if(this.layerId==null&&/SceneServer\/*$/i.test(this.url)){const i=await this._fetchFirstLayerId(r);i!=null&&(this.layerId=i)}return this._fetchServiceLayer(r)}async _fetchFirstLayerId(r){const i=await er(this.url,{query:{f:"json",token:this.apiKey},responseType:"json",signal:r});if(i.data&&Array.isArray(i.data.layers)&&i.data.layers.length>0)return i.data.layers[0].id}async _fetchServiceLayer(r){const i=await er(this.parsedUrl.path,{query:{f:"json",token:this.apiKey},responseType:"json",signal:r});i.ssl&&(this.url=this.url.replace(/^http:/i,"https:"));let s=!1;if(i.data.layerType&&i.data.layerType==="Voxel"&&(s=!0),s)return this._fetchVoxelServiceLayer();const n=i.data;this.read(n,{origin:"service",url:this.parsedUrl}),this.validateLayer(n)}async _fetchVoxelServiceLayer(r){const i=(await er(this.parsedUrl.path+"/layer",{query:{f:"json",token:this.apiKey},responseType:"json",signal:r})).data;this.read(i,{origin:"service",url:this.parsedUrl}),this.validateLayer(i)}async _ensureLoadBeforeSave(){await this.load(),"beforeSave"in this&&typeof this.beforeSave=="function"&&await this.beforeSave()}validateLayer(r){}_updateTypeKeywords(r,i,s){r.typeKeywords||(r.typeKeywords=[]);const n=i.getTypeKeywords();for(const o of n)r.typeKeywords.push(o);r.typeKeywords&&(r.typeKeywords=r.typeKeywords.filter((o,a,l)=>l.indexOf(o)===a),s===LP.newItem&&(r.typeKeywords=r.typeKeywords.filter(o=>o!=="Hosted Service")))}async _saveAs(r,i){const s={...w0e,...i};let n=HC.from(r);n||(m2.error("_saveAs(): requires a portal item parameter"),await Promise.reject(new j("sceneservice:portal-item-required","_saveAs() requires a portal item to save to"))),n.id&&(n=n.clone(),n.id=null);const o=n.portal||Sn.getDefault();await this._ensureLoadBeforeSave(),n.type=g4,n.portal=o;const a={origin:"portal-item",url:null,messages:[],portal:o,portalItem:n,writtenProperties:[],blockedRelativeUrls:[],resources:{toAdd:[],toUpdate:[],toKeep:[],pendingOperations:[]}},l={layers:[this.write({},a)]};return await Promise.all(a.resources.pendingOperations),await this._validateAgainstJSONSchema(l,a,s),n.url=this.url,n.title||(n.title=this.title),this._updateTypeKeywords(n,s,LP.newItem),await o._signIn(),await o.user.addItem({item:n,folder:s&&s.folder,data:l}),await _0e(this.resourceReferences,a,null),this.portalItem=n,v0e(a),a.portalItem=n,n}async _save(r){const i={...w0e,...r};this.portalItem||(m2.error("_save(): requires the .portalItem property to be set"),await Promise.reject(new j("sceneservice:portal-item-not-set","Portal item to save to has not been set on this SceneService"))),this.portalItem.type!==g4&&(m2.error("_save(): Non-matching portal item type. Got "+this.portalItem.type+", expected "+g4),await Promise.reject(new j("sceneservice:portal-item-wrong-type",`Portal item needs to have type "${g4}"`))),await this._ensureLoadBeforeSave();const s={origin:"portal-item",url:this.portalItem.itemUrl&&Ds(this.portalItem.itemUrl),messages:[],portal:this.portalItem.portal||Sn.getDefault(),portalItem:this.portalItem,writtenProperties:[],blockedRelativeUrls:[],resources:{toAdd:[],toUpdate:[],toKeep:[],pendingOperations:[]}},n={layers:[this.write({},s)]};return await Promise.all(s.resources.pendingOperations),await this._validateAgainstJSONSchema(n,s,i),this.portalItem.url=this.url,this.portalItem.title||(this.portalItem.title=this.title),this._updateTypeKeywords(this.portalItem,i,LP.existingItem),await this.portalItem.update({data:n}),await _0e(this.resourceReferences,s,null),v0e(s),this.portalItem}async _validateAgainstJSONSchema(r,i,s){let n=i.messages.filter(o=>o.type==="error").map(o=>new j(o.name,o.message,o.details));if(s&&s.validationOptions.ignoreUnsupported&&(n=n.filter(o=>o.name!=="layer:unsupported"&&o.name!=="symbol:unsupported"&&o.name!=="symbol-layer:unsupported"&&o.name!=="property:unsupported"&&o.name!=="url:unsupported"&&o.name!=="scenemodification:unsupported")),s.validationOptions.enabled||hPt){const o=(await ie(()=>import("./schemaValidator.1458b902.js"),["schemaValidator.1458b902.js","commonjsHelpers.ce2b5698.js"],import.meta.url)).validate(r,s.portalItemLayerType);if(o.length>0){const a=`Layer item did not validate:
${o.join(`
`)}`;if(m2.error(`_validateAgainstJSONSchema(): ${a}`),s.validationOptions.failPolicy==="throw"){const l=o.map(c=>new j("sceneservice:schema-validation",c)).concat(n);throw new j("sceneservice-validate:error","Failed to save layer item due to schema validation, see `details.errors`.",{combined:l})}}}if(n.length>0)throw new j("sceneservice:save","Failed to save SceneService due to unsupported or invalid content. See 'details.errors' for more detailed information",{errors:n})}};return u([d(Lre)],t.prototype,"id",void 0),u([d({type:Ze})],t.prototype,"spatialReference",void 0),u([$e("spatialReference",["spatialReference","store.indexCRS","store.geographicCRS"])],t.prototype,"readSpatialReference",null),u([d({type:Kt})],t.prototype,"fullExtent",void 0),u([$e("fullExtent",["fullExtent","store.extent","spatialReference","store.indexCRS","store.geographicCRS"])],t.prototype,"readFullExtent",null),u([d({readOnly:!0,type:QT})],t.prototype,"heightModelInfo",void 0),u([d({type:Number,json:{name:"layerDefinition.minScale",write:!0,origins:{service:{read:{source:"minScale"},write:!1}}}})],t.prototype,"minScale",void 0),u([d({type:Number,json:{name:"layerDefinition.maxScale",write:!0,origins:{service:{read:{source:"maxScale"},write:!1}}}})],t.prototype,"maxScale",void 0),u([d({readOnly:!0})],t.prototype,"version",void 0),u([$e("version",["store.version"])],t.prototype,"readVersion",null),u([d({type:String,json:{read:{source:"copyrightText"}}})],t.prototype,"copyright",void 0),u([d({type:String,json:{read:!1}})],t.prototype,"sublayerTitleMode",void 0),u([d({type:String})],t.prototype,"title",void 0),u([$e("portal-item","title")],t.prototype,"readTitlePortalItem",null),u([$e("service","title",["name"])],t.prototype,"readTitleService",null),u([d({type:Number,json:{origins:{service:{read:{source:"id"}},"portal-item":{write:{target:"id",isRequired:!0,ignoreOrigin:!0},read:!1}}}})],t.prototype,"layerId",void 0),u([d(Pre)],t.prototype,"url",null),u([Xe("url")],t.prototype,"writeUrl",null),u([d()],t.prototype,"parsedUrl",null),u([d({readOnly:!0})],t.prototype,"store",void 0),u([d({type:String,readOnly:!0,json:{read:{source:"store.rootNode"}}})],t.prototype,"rootNode",void 0),t=u([$("esri.layers.mixins.SceneService")],t),t},CH=-1e38,hPt=!1;var LP;(function(e){e[e.existingItem=0]="existingItem",e[e.newItem=1]="newItem"})(LP||(LP={}));const g4="Scene Service",w0e={getTypeKeywords:()=>[],portalItemLayerType:"unknown",validationOptions:{enabled:!0,ignoreUnsupported:!1,failPolicy:"throw"}};var JA;(function(e){e[e.SAVE=0]="SAVE",e[e.SAVE_AS=1]="SAVE_AS"})(JA||(JA={}));const dPt={analytics:{supportsCacheHint:!1},attachment:{supportsContentType:!1,supportsExifInfo:!1,supportsKeywords:!1,supportsName:!1,supportsSize:!1,supportsCacheHint:!1,supportsResize:!1},data:{isVersioned:!1,supportsAttachment:!1,supportsM:!1,supportsZ:!1},editing:{supportsDeleteByAnonymous:!1,supportsDeleteByOthers:!1,supportsGeometryUpdate:!1,supportsGlobalId:!1,supportsReturnServiceEditsInSourceSpatialReference:!1,supportsRollbackOnFailure:!1,supportsUpdateByAnonymous:!1,supportsUpdateByOthers:!1,supportsUpdateWithoutM:!1,supportsUploadWithItemId:!1},metadata:{supportsAdvancedFieldProperties:!1},operations:{supportsCalculate:!1,supportsTruncate:!1,supportsValidateSql:!1,supportsAdd:!1,supportsDelete:!1,supportsEditing:!1,supportsChangeTracking:!1,supportsQuery:!1,supportsQueryAnalytics:!1,supportsQueryAttachments:!1,supportsQueryTopFeatures:!1,supportsResizeAttachments:!1,supportsSync:!1,supportsUpdate:!1,supportsExceedsLimitStatistics:!1},queryRelated:{supportsCount:!1,supportsOrderBy:!1,supportsPagination:!1,supportsCacheHint:!1},queryTopFeatures:{supportsCacheHint:!1},query:{maxRecordCount:0,maxRecordCountFactor:0,standardMaxRecordCount:0,supportsCacheHint:!1,supportsCentroid:!1,supportsCompactGeometry:!1,supportsDefaultSpatialReference:!1,supportsDisjointSpatialRelationship:!1,supportsDistance:!1,supportsDistinct:!1,supportsExtent:!1,supportsFormatPBF:!1,supportsGeometryProperties:!1,supportsHavingClause:!1,supportsHistoricMoment:!1,supportsMaxRecordCountFactor:!1,supportsOrderBy:!1,supportsPagination:!1,supportsPercentileStatistics:!1,supportsQuantization:!1,supportsQuantizationEditMode:!1,supportsQueryByOthers:!1,supportsQueryGeometry:!1,supportsResultType:!1,supportsSqlExpression:!1,supportsStandardizedQueriesOnly:!1,supportsTopFeaturesQuery:!1,supportsSpatialAggregationStatistics:!1,supportedSpatialAggregationStatistics:{envelope:!1,centroid:!1,convexHull:!1},supportsStatistics:!1,tileMaxRecordCount:0}};class pPt{constructor(t,r,i,s){this.parsedUrl=t,this.portalItem=r,this.apiKey=i,this.signal=s,this.rootDocument=null;const n=this.parsedUrl.path.match(/^(.*)\/SceneServer\/layers\/([\d]*)\/?$/i);n&&(this.urlParts={root:n[1],layerId:parseInt(n[2],10)})}async fetch(){var i;if(!this.urlParts)return null;const t=(i=this.portalItem)!=null?i:await this._portalItemFromServiceItemId();if(R(t))return this._loadFromUrl();const r=await this._findAndLoadRelatedPortalItem(t);return R(r)?null:this._loadFeatureLayerFromPortalItem(r)}async fetchPortalItem(){var r;if(!this.urlParts)return null;const t=(r=this.portalItem)!=null?r:await this._portalItemFromServiceItemId();return R(t)?null:this._findAndLoadRelatedPortalItem(t)}async _fetchRootDocument(){if(b(this.rootDocument))return this.rootDocument;if(R(this.urlParts))return this.rootDocument={},{};const t={query:{f:"json",token:this.apiKey},responseType:"json",signal:this.signal},r=`${this.urlParts.root}/SceneServer`;try{const i=await er(r,t);this.rootDocument=i.data}catch{this.rootDocument={}}return this.rootDocument}async _fetchServiceOwningPortalUrl(){const t=Xi==null?void 0:Xi.findServerInfo(this.parsedUrl.path);if(t!=null&&t.owningSystemUrl)return t.owningSystemUrl;const r=this.parsedUrl.path.replace(/(.*\/rest)\/.*/i,"$1")+"/info";try{const i=(await er(r,{query:{f:"json"},responseType:"json",signal:this.signal})).data.owningSystemUrl;if(i)return i}catch(i){ah(i)}return null}async _findAndLoadRelatedPortalItem(t){try{return(await t.fetchRelatedItems({relationshipType:"Service2Service",direction:"reverse"},{signal:this.signal})).find(r=>r.type==="Feature Service")||null}catch(r){return ah(r),null}}async _loadFeatureLayerFromPortalItem(t){await t.load({signal:this.signal});const r=await this._findMatchingAssociatedSublayerUrl(t.url);return new vV({url:r,portalItem:t}).load({signal:this.signal})}async _loadFromUrl(){const t=await this._findMatchingAssociatedSublayerUrl(`${this.urlParts.root}/FeatureServer`);return new vV({url:t}).load({signal:this.signal})}async _findMatchingAssociatedSublayerUrl(t){const r=t.replace(/^(.*FeatureServer)(\/[\d]*\/?)?$/i,"$1"),i={query:{f:"json"},responseType:"json",authMode:"no-prompt",signal:this.signal},s=this.urlParts.layerId,n=this._fetchRootDocument(),o=er(r,i),[a,l]=await Promise.all([o,n]),c=l&&l.layers,h=a.data&&a.data.layers;if(!Array.isArray(h))throw new Error("expected layers array");if(Array.isArray(c)){for(let p=0;p<Math.min(c.length,h.length);p++)if(c[p].id===s)return`${r}/${h[p].id}`}else if(s<h.length)return`${r}/${h[s].id}`;throw new Error("could not find matching associated sublayer")}async _portalItemFromServiceItemId(){const t=(await this._fetchRootDocument()).serviceItemId;if(!t)return null;const r=new HC({id:t,apiKey:this.apiKey}),i=await this._fetchServiceOwningPortalUrl();b(i)&&(r.portal=new Sn({url:i}));try{return r.load({signal:this.signal})}catch(s){return ah(s),null}}}let ux=class extends ye{constructor(){super(...arguments),this.nodesPerPage=null,this.rootIndex=0,this.lodSelectionMetricType=null}};u([d({type:Number})],ux.prototype,"nodesPerPage",void 0),u([d({type:Number})],ux.prototype,"rootIndex",void 0),u([d({type:String})],ux.prototype,"lodSelectionMetricType",void 0),ux=u([$("esri.layer.support.I3SNodePageDefinition")],ux);let zy=class extends ye{constructor(){super(...arguments),this.factor=1}};u([d({type:Number,json:{read:{source:"textureSetDefinitionId"}}})],zy.prototype,"id",void 0),u([d({type:Number})],zy.prototype,"factor",void 0),zy=u([$("esri.layer.support.I3SMaterialTexture")],zy);let s_=class extends ye{constructor(){super(...arguments),this.baseColorFactor=[1,1,1,1],this.baseColorTexture=null,this.metallicRoughnessTexture=null,this.metallicFactor=1,this.roughnessFactor=1}};u([d({type:[Number]})],s_.prototype,"baseColorFactor",void 0),u([d({type:zy})],s_.prototype,"baseColorTexture",void 0),u([d({type:zy})],s_.prototype,"metallicRoughnessTexture",void 0),u([d({type:Number})],s_.prototype,"metallicFactor",void 0),u([d({type:Number})],s_.prototype,"roughnessFactor",void 0),s_=u([$("esri.layer.support.I3SMaterialPBRMetallicRoughness")],s_);let rd=class extends ye{constructor(){super(...arguments),this.alphaMode="opaque",this.alphaCutoff=.25,this.doubleSided=!1,this.cullFace="none",this.normalTexture=null,this.occlusionTexture=null,this.emissiveTexture=null,this.emissiveFactor=null,this.pbrMetallicRoughness=null}};u([lt({opaque:"opaque",mask:"mask",blend:"blend"})],rd.prototype,"alphaMode",void 0),u([d({type:Number})],rd.prototype,"alphaCutoff",void 0),u([d({type:Boolean})],rd.prototype,"doubleSided",void 0),u([lt({none:"none",back:"back",front:"front"})],rd.prototype,"cullFace",void 0),u([d({type:zy})],rd.prototype,"normalTexture",void 0),u([d({type:zy})],rd.prototype,"occlusionTexture",void 0),u([d({type:zy})],rd.prototype,"emissiveTexture",void 0),u([d({type:[Number]})],rd.prototype,"emissiveFactor",void 0),u([d({type:s_})],rd.prototype,"pbrMetallicRoughness",void 0),rd=u([$("esri.layer.support.I3SMaterialDefinition")],rd);let A3=class extends ye{};u([d({type:String,json:{read:{source:["name","index"],reader:(e,t)=>e!=null?e:`${t.index}`}}})],A3.prototype,"name",void 0),u([lt({jpg:"jpg",png:"png",dds:"dds","ktx-etc2":"ktx-etc2",ktx2:"ktx2",basis:"basis"})],A3.prototype,"format",void 0),A3=u([$("esri.layer.support.I3STextureFormat")],A3);let R3=class extends ye{constructor(){super(...arguments),this.atlas=!1}};u([d({type:[A3]})],R3.prototype,"formats",void 0),u([d({type:Boolean})],R3.prototype,"atlas",void 0),R3=u([$("esri.layer.support.I3STextureSetDefinition")],R3);let Gp=class extends ye{};u([lt({Float32:"Float32",UInt64:"UInt64",UInt32:"UInt32",UInt16:"UInt16",UInt8:"UInt8"})],Gp.prototype,"type",void 0),u([d({type:Number})],Gp.prototype,"component",void 0),Gp=u([$("esri.layer.support.I3SGeometryAttribute")],Gp);let O3=class extends ye{};u([lt({draco:"draco"})],O3.prototype,"encoding",void 0),u([d({type:[String]})],O3.prototype,"attributes",void 0),O3=u([$("esri.layer.support.I3SGeometryCompressedAttributes")],O3);let hp=class extends ye{constructor(){super(...arguments),this.offset=0}};u([d({type:Number})],hp.prototype,"offset",void 0),u([d({type:Gp})],hp.prototype,"position",void 0),u([d({type:Gp})],hp.prototype,"normal",void 0),u([d({type:Gp})],hp.prototype,"uv0",void 0),u([d({type:Gp})],hp.prototype,"color",void 0),u([d({type:Gp})],hp.prototype,"uvRegion",void 0),u([d({type:Gp})],hp.prototype,"featureId",void 0),u([d({type:Gp})],hp.prototype,"faceRange",void 0),u([d({type:O3})],hp.prototype,"compressedAttributes",void 0),hp=u([$("esri.layer.support.I3SGeometryBuffer")],hp);let M3=class extends ye{};u([lt({triangle:"triangle"})],M3.prototype,"topology",void 0),u([d()],M3.prototype,"geometryBuffers",void 0),M3=u([$("esri.layer.support.I3SGeometryDefinition")],M3);let n_=class extends ye{constructor(){super(...arguments),this.name=null,this.field=null,this.currentRangeExtent=null,this.fullRangeExtent=null,this.type="rangeInfo"}};u([d({type:String,json:{read:!0,write:!0}})],n_.prototype,"name",void 0),u([d({type:String,json:{read:!0,write:!0}})],n_.prototype,"field",void 0),u([d({type:[Number],json:{read:!0,write:!0}})],n_.prototype,"currentRangeExtent",void 0),u([d({type:[Number],json:{read:!0,write:!0}})],n_.prototype,"fullRangeExtent",void 0),u([d({type:["rangeInfo"],readOnly:!0,json:{read:!1,write:!0}})],n_.prototype,"type",void 0),n_=u([$("esri.layers.support.RangeInfo")],n_);function MJ(e){return Rne[fPt(e)]||gPt}function fPt(e){return e instanceof Blob?e.type:mPt(e.url)}function mPt(e){const t=ree(e);return PJ[t]||zDe}const Rne={},zDe="text/plain",gPt=Rne[zDe],PJ={png:"image/png",jpeg:"image/jpeg",jpg:"image/jpg",bmp:"image/bmp",gif:"image/gif",json:"application/json",txt:"text/plain",xml:"application/xml",svg:"image/svg+xml",zip:"application/zip",pbf:"application/vnd.mapbox-vector-tile",gz:"application/gzip"};for(const e in PJ)Rne[PJ[e]]=e;function yPt(e){const t=b(e)&&e.origins?e.origins:[void 0];return(r,i)=>{const s=vPt(e,r,i);for(const n of t){const o=zK(r,n,i);for(const a in s)o[a]=s[a]}}}function vPt(e,t,r){if(b(e)&&e.type==="resource")return _Pt(e,t,r);switch(b(e)&&e.type?e.type:"other"){case"other":return{read:!0,write:!0};case"url":{const{read:i,write:s}=FBe;return{read:i,write:s}}}}function _Pt(e,t,r){const i=U$(t,r);return{type:String,read:(s,n,o)=>{const a=d6(s,n,o);return i.type===String?a:typeof i.type=="function"?new i.type({url:a}):void 0},write:{writer(s,n,o,a){if(!a||!a.resources)return typeof s=="string"?void(n[o]=p0(s,a)):void(n[o]=s.write({},a));const l=TPt(s),c=l?p0(l,{...a,verifyItemRelativeUrls:a&&a.verifyItemRelativeUrls?{writtenUrls:a.verifyItemRelativeUrls.writtenUrls,rootPath:null}:null},oA.NO):null,h=i.type!==String&&(!FDe(this)||a&&a.origin&&this.originIdOf(r)>Dy(a.origin));a&&a.portalItem&&b(c)&&!Kc(c)?h?bPt(this,r,s,c,n,o,a,e):wPt(c,n,o,a):a&&a.portalItem&&(R(c)||b(lxe(c))||S1(c)||h)?BDe(this,r,s,c,n,o,a,e):n[o]=c}}}}function BDe(e,t,r,i,s,n,o,a){const l=Ote(),c=jDe(r,i,o),h=sc(ki(a,"prefix"),l),p=`${h}.${MJ(c)}`,f=o.portalItem.resourceFromPath(p);S1(i)&&o.resources.pendingOperations.push(xPt(i).then(m=>{f.path=`${h}.${MJ(m)}`,s[n]=f.itemRelativeUrl}).catch(()=>{})),GDe(e,t,f,c,o.resources.toAdd),s[n]=f.itemRelativeUrl}function bPt(e,t,r,i,s,n,o,a){const l=o.portalItem.resourceFromPath(i),c=jDe(r,i,o);MJ(c)===ree(l.path)?(GDe(e,t,l,c,o.resources.toUpdate),s[n]=i):BDe(e,t,r,i,s,n,o,a)}function wPt(e,t,r,i){i.resources.toKeep.push({resource:i.portalItem.resourceFromPath(e)}),t[r]=e}function GDe(e,t,r,i,s){s.push({resource:r,content:i,finish:n=>{SPt(e,t,n)}})}function jDe(e,t,r){return typeof e=="string"?{url:t}:new Blob([JSON.stringify(e.toJSON(r))],{type:"application/json"})}async function xPt(e){const t=(await ie(()=>Promise.resolve().then(()=>wbe),void 0,import.meta.url)).default,{data:r}=await t(e,{responseType:"blob"});return r}function TPt(e){return R(e)?null:typeof e=="string"?e:e.url}function SPt(e,t,r){typeof e[t]=="string"?e[t]=r.url:e[t].url=r.url}var Pk;let IJ=Pk=class extends nR(ot.ofType(Oa)){constructor(e){super(e)}clone(){return new Pk(this.items.map(e=>e.clone()))}write(e,t){return this.toJSON(t)}toJSON(e){var r;const t=(r=e==null?void 0:e.layer)==null?void 0:r.spatialReference;return t?this.toArray().map(i=>{if(!t.equals(i.spatialReference)){if(!sg(i.spatialReference,t))return e&&e.messages&&e.messages.push(new ic("scenefilter:unsupported","Scene filters with incompatible spatial references are not supported",{modification:this,spatialReference:e.layer.spatialReference,context:e})),null;const n=new Oa;L9e(i,n,t),i=n}const s=i.toJSON(e);return delete s.spatialReference,s}).filter(i=>i!=null):(e!=null&&e.messages&&e.messages.push(new ic("scenefilter:unsupported","Writing Scene filters without context layer is not supported",{modification:this,spatialReference:e.layer.spatialReference,context:e})),this.toArray().map(i=>i.toJSON(e)))}static fromJSON(e,t){const r=new Pk;return e.forEach(i=>r.add(Oa.fromJSON(i,t))),r}};IJ=Pk=u([$("esri.layers.support.PolygonCollection")],IJ);const $J=IJ;var LJ;let hE=LJ=class extends ye{constructor(e){super(e),this.spatialRelationship="disjoint",this.geometries=new $J,this._geometriesSource=null,this._handles=new Dt}initialize(){this._handles.add(rs(()=>this.geometries,"after-changes",()=>this.geometries=this.geometries,ei))}destroy(){this._handles.destroy()}readGeometries(e,t,r){this._geometriesSource={url:d0(e,r),context:r}}async loadGeometries(e,t){if(R(this._geometriesSource))return;const{url:r,context:i}=this._geometriesSource,s=await er(r,{responseType:"json",signal:ki(t,"signal")}),n=e.toJSON(),o=s.data.map(a=>({...a,spatialReference:n}));this.geometries=$J.fromJSON(o,i),this._geometriesSource=null}clone(){return new LJ({geometries:re(this.geometries),spatialRelationship:this.spatialRelationship})}};u([d({type:["disjoint","contains"],nonNullable:!0,json:{write:!0}})],hE.prototype,"spatialRelationship",void 0),u([d({type:$J,nonNullable:!0,json:{write:!0}}),yPt({origins:["web-scene","portal-item"],type:"resource",prefix:"geometries"})],hE.prototype,"geometries",void 0),u([$e(["web-scene","portal-item"],"geometries")],hE.prototype,"readGeometries",null),hE=LJ=u([$("esri.layers.support.SceneFilter")],hE);const EPt=hE,CPt=["3DObject","Point"],g2=fe.getLogger("esri.layers.SceneLayer"),x0e=zre();let $t=class extends uPt(dAe(Dre(_Ae(Nre(tB(sAe(eA))))))){constructor(...e){super(...e),this.featureReduction=null,this.rangeInfos=null,this.operationalLayerType="ArcGISSceneServiceLayer",this.type="scene",this.fields=null,this.floorInfo=null,this.outFields=null,this.nodePages=null,this.materialDefinitions=null,this.textureSetDefinitions=null,this.geometryDefinitions=null,this.serviceUpdateTimeStamp=null,this.excludeObjectIds=new ot,this.definitionExpression=null,this.filter=null,this.path=null,this.labelsVisible=!0,this.labelingInfo=null,this.legendEnabled=!0,this.priority=null,this.semantic=null,this.cachedDrawingInfo={color:!1},this.popupEnabled=!0,this.popupTemplate=null,this.objectIdField=null,this.globalIdField=null,this._fieldUsageInfo={},this.screenSizePerspectiveEnabled=!0}normalizeCtorArgs(e,t){return typeof e=="string"?{url:e,...t}:e}getField(e){return this.fieldsIndex.get(e)}getFieldDomain(e,t){var i,s,n,o;const r=(s=(i=this.getFeatureType(t==null?void 0:t.feature))==null?void 0:i.domains)==null?void 0:s[e];return r&&r.type!=="inherited"?r:(o=(n=this.getField(e))==null?void 0:n.domain)!=null?o:null}getFeatureType(e){return e&&b(this.associatedLayer)?this.associatedLayer.getFeatureType(e):null}get types(){return b(this.associatedLayer)?this.associatedLayer.types:[]}get typeIdField(){return b(this.associatedLayer)?this.associatedLayer.typeIdField:null}get formTemplate(){return b(this.associatedLayer)?this.associatedLayer.formTemplate:null}get fieldsIndex(){return new DAe(this.fields)}readNodePages(e,t,r){return t.layerType==="Point"&&(e=t.pointNodePages),e==null||typeof e!="object"?null:ux.fromJSON(e,r)}set elevationInfo(e){this._set("elevationInfo",e),this.loaded&&this._validateElevationInfo()}get geometryType(){return APt[this.profile]||"mesh"}set renderer(e){rA(e,this.fieldsIndex),this._set("renderer",e)}readCachedDrawingInfo(e){return e!=null&&typeof e=="object"||(e={}),e.color==null&&(e.color=!1),e}get capabilities(){const e=b(this.associatedLayer)&&this.associatedLayer.capabilities?this.associatedLayer.capabilities:dPt,{query:t,editing:{supportsGlobalId:r,supportsRollbackOnFailure:i,supportsUploadWithItemId:s,supportsReturnServiceEditsInSourceSpatialReference:n},data:{supportsZ:o,supportsM:a,isVersioned:l,supportsAttachment:c},operations:{supportsEditing:h,supportsUpdate:p,supportsQuery:f,supportsQueryAttachments:m}}=e,g=e.operations.supportsChangeTracking;return{query:t,editing:{supportsGlobalId:r,supportsReturnServiceEditsInSourceSpatialReference:n,supportsRollbackOnFailure:i,supportsGeometryUpdate:!1,supportsUploadWithItemId:s},data:{supportsAttachment:c,supportsZ:o,supportsM:a,isVersioned:l},operations:{supportsQuery:f,supportsQueryAttachments:m,supportsEditing:h&&g,supportsAdd:!1,supportsDelete:!1,supportsUpdate:p&&g}}}get editingEnabled(){return this._isOverridden("editingEnabled")?this._get("editingEnabled"):this.userHasEditingPrivileges}set editingEnabled(e){e!=null?this._override("editingEnabled",e):this._clearOverride("editingEnabled")}get defaultPopupTemplate(){return b(this.associatedLayer)||this.attributeStorageInfo?this.createPopupTemplate():null}readObjectIdField(e,t){return!e&&t.fields&&t.fields.some(r=>(r.type==="esriFieldTypeOID"&&(e=r.name),!!e)),e||void 0}readGlobalIdField(e,t){return!e&&t.fields&&t.fields.some(r=>(r.type==="esriFieldTypeGlobalID"&&(e=r.name),!!e)),e||void 0}get displayField(){return b(this.associatedLayer)?this.associatedLayer.displayField:null}readProfile(e,t){const r=t.store.profile;return r!=null&&T0e[r]?T0e[r]:(g2.error("Unknown or missing profile",{profile:r,layer:this}),"mesh-pyramids")}load(e){const t=b(e)?e.signal:null,r=this.loadFromPortal({supportedTypes:["Scene Service"]},e).catch(ah).then(()=>this._fetchService(t)).then(()=>Promise.all([this._fetchIndexAndUpdateExtent(this.nodePages,t),this._setAssociatedFeatureLayer(t),b(this.filter)?this.filter.loadGeometries(this.spatialReference):null])).then(()=>this._validateElevationInfo()).then(()=>this._applyAssociatedLayerOverrides()).then(()=>this._populateFieldUsageInfo()).then(()=>FAe(this,{origin:"service"},t)).then(()=>rA(this.renderer,this.fieldsIndex)).then(()=>this.finishLoadEditablePortalLayer(e));return this.addResolvingPromise(r),Promise.resolve(this)}async beforeSave(){b(this.filter)&&await this.load()}createQuery(){const e=new Sa;return this.geometryType!=="mesh"&&(e.returnGeometry=!0,e.returnZ=!0),e.where=this.definitionExpression||"1=1",e.sqlFormat="standard",e}queryExtent(e,t){return this._getAssociatedLayerForQuery().then(r=>r.queryExtent(e||this.createQuery(),t))}queryFeatureCount(e,t){return this._getAssociatedLayerForQuery().then(r=>r.queryFeatureCount(e||this.createQuery(),t))}queryFeatures(e,t){return this._getAssociatedLayerForQuery().then(r=>r.queryFeatures(e||this.createQuery(),t)).then(r=>{if(r!=null&&r.features)for(const i of r.features)i.layer=this,i.sourceLayer=this;return r})}queryObjectIds(e,t){return this._getAssociatedLayerForQuery().then(r=>r.queryObjectIds(e||this.createQuery(),t))}queryAttachments(e,t){return this._getAssociatedLayerForQuery().then(r=>r.queryAttachments(e,t))}getFieldUsageInfo(e){const t={supportsLabelingInfo:!1,supportsRenderer:!1,supportsPopupTemplate:!1,supportsLayerQuery:!1};return this.loaded?this._fieldUsageInfo[e]||t:(g2.error("#getFieldUsageInfo()","Unavailable until layer is loaded"),t)}createPopupTemplate(e){return Bre(this,e)}_getAssociatedLayerForQuery(){const e=this.associatedLayer;return b(e)&&e.loaded?Promise.resolve(e):this._loadAssociatedLayerForQuery()}async _loadAssociatedLayerForQuery(){if(await this.load(),R(this.associatedLayer))throw new j("scenelayer:query-not-available","SceneLayer queries are not available without an associated feature layer",{layer:this});try{await this.associatedLayer.load()}catch(e){throw new j("scenelayer:query-not-available","SceneLayer associated feature layer could not be loaded",{layer:this,error:e})}return this.associatedLayer}hasCachedStatistics(e){return this.statisticsInfo!=null&&this.statisticsInfo.some(t=>t.name===e)}async queryCachedStatistics(e,t){if(await this.load(t),!this.statisticsInfo)throw new j("scenelayer:no-cached-statistics","Cached statistics are not available for this layer");const r=this.fieldsIndex.get(e);if(!r)throw new j("scenelayer:field-unexisting",`Field '${e}' does not exist on the layer`);for(const i of this.statisticsInfo)if(i.name===r.name){const s=sc(this.parsedUrl.path,i.href);return er(s,{query:{f:"json",token:this.apiKey},responseType:"json",signal:t?t.signal:null}).then(n=>n.data)}throw new j("scenelayer:no-cached-statistics","Cached statistics for this attribute are not available")}async saveAs(e,t){return this._debouncedSaveOperations(JA.SAVE_AS,{...t,getTypeKeywords:()=>this._getTypeKeywords(),portalItemLayerType:"scene"},e)}async save(){const e={getTypeKeywords:()=>this._getTypeKeywords(),portalItemLayerType:"scene"};return this._debouncedSaveOperations(JA.SAVE,e)}async applyEdits(e,t){const r=await ie(()=>import("./editingSupport.141ffbc0.js"),[],import.meta.url);if(await this.load(),R(this.associatedLayer))throw new j(`${this.type}-layer:not-editable`,"Service is not editable");return await this.associatedLayer.load(),r.applyEdits(this,this.associatedLayer.source,e,t)}on(e,t){return super.on(e,t)}validateLayer(e){if(e.layerType&&!CPt.includes(e.layerType))throw new j("scenelayer:layer-type-not-supported","SceneLayer does not support this layer type",{layerType:e.layerType});if(isNaN(this.version.major)||isNaN(this.version.minor))throw new j("layer:service-version-not-supported","Service version is not supported.",{serviceVersion:this.version.versionString,supportedVersions:"1.x, 2.x"});if(this.version.major>2)throw new j("layer:service-version-too-new","Service version is too new.",{serviceVersion:this.version.versionString,supportedVersions:"1.x, 2.x"});function t(r,i){let s=!1,n=!1;if(r==null)s=!0,n=!0;else{const o=i&&i.isGeographic;switch(r){case"east-north-up":case"earth-centered":s=!0,n=o;break;case"vertex-reference-frame":s=!0,n=!o;break;default:s=!1}}if(!s)throw new j("scenelayer:unsupported-normal-reference-frame","Normal reference frame is invalid.");if(!n)throw new j("scenelayer:incompatible-normal-reference-frame","Normal reference frame is incompatible with layer spatial reference.")}t(this.normalReferenceFrame,this.spatialReference)}_getTypeKeywords(){const e=[];if(this.profile==="points")e.push("Point");else{if(this.profile!=="mesh-pyramids")throw new j("scenelayer:unknown-profile","SceneLayer:save() encountered an unknown SceneLayer profile: "+this.profile);e.push("3DObject")}return e}_populateFieldUsageInfo(){if(this._fieldUsageInfo={},this.fields)for(const e of this.fields){const t=!(!this.attributeStorageInfo||!this.attributeStorageInfo.some(s=>s.name===e.name)),r=!!(b(this.associatedLayer)&&this.associatedLayer.fields&&this.associatedLayer.fields.some(s=>s&&e.name===s.name)),i={supportsLabelingInfo:t,supportsRenderer:t,supportsPopupTemplate:t||r,supportsLayerQuery:r};this._fieldUsageInfo[e.name]=i}}_applyAssociatedLayerOverrides(){this._applyAssociatedLayerFieldsOverrides(),this._applyAssociatedLayerPopupOverrides()}_applyAssociatedLayerFieldsOverrides(){if(R(this.associatedLayer)||!this.associatedLayer.fields)return;let e=null;for(const t of this.associatedLayer.fields){const r=this.getField(t.name);r?(!r.domain&&t.domain&&(r.domain=t.domain.clone()),r.editable=t.editable,r.nullable=t.nullable,r.length=t.length):(e||(e=this.fields?this.fields.slice():[]),e.push(t.clone()))}e&&this._set("fields",e)}_applyAssociatedLayerPopupOverrides(){if(R(this.associatedLayer))return;const e=["popupTemplate","popupEnabled"],t=Pa(this);for(let r=0;r<e.length;r++){const i=e[r],s=this.originIdOf(i),n=this.associatedLayer.originIdOf(i);s<n&&(n===Bt.SERVICE||n===Bt.PORTAL_ITEM)&&t.setAtOrigin(i,this.associatedLayer[i],n)}}async _setAssociatedFeatureLayer(e){if(!["mesh-pyramids","points"].includes(this.profile))return;const t=new pPt(this.parsedUrl,this.portalItem,this.apiKey,e);try{this.associatedLayer=await t.fetch()}catch(r){Vi(r)||this._logWarningOnPopupEnabled()}}async _logWarningOnPopupEnabled(){await E1(()=>this.popupEnabled&&this.popupTemplate!=null);const e=`this SceneLayer: ${this.title}`;this.attributeStorageInfo==null?g2.warn(`Associated FeatureLayer could not be loaded and no binary attributes found. Popups will not work on ${e}`):g2.info(`Associated FeatureLayer could not be loaded. Falling back to binary attributes for Popups on ${e}`)}_validateElevationInfo(){const e=this.elevationInfo;e&&(this.profile==="mesh-pyramids"&&e.mode==="relative-to-scene"&&g2.warn(".elevationInfo=","Mesh scene layers don't support relative-to-scene elevation mode"),e.featureExpressionInfo&&e.featureExpressionInfo.expression!=="0"&&g2.warn(".elevationInfo=","Scene layers do not support featureExpressionInfo"))}};u([d({types:{key:"type",base:Wy,typeMap:{selection:kY}},json:{origins:{"web-scene":{name:"layerDefinition.featureReduction",write:!0},"portal-item":{name:"layerDefinition.featureReduction",write:!0}}}})],$t.prototype,"featureReduction",void 0),u([d({type:[n_],json:{read:!1,origins:{"web-scene":{name:"layerDefinition.rangeInfos",write:!0},"portal-item":{name:"layerDefinition.rangeInfos",write:!0}}}})],$t.prototype,"rangeInfos",void 0),u([d({json:{read:!1}})],$t.prototype,"associatedLayer",void 0),u([d({type:["show","hide"]})],$t.prototype,"listMode",void 0),u([d({type:["ArcGISSceneServiceLayer"]})],$t.prototype,"operationalLayerType",void 0),u([d({json:{read:!1},readOnly:!0})],$t.prototype,"type",void 0),u([d({...x0e.fields,readOnly:!0,json:{read:!1,origins:{service:{read:!0}}}})],$t.prototype,"fields",void 0),u([d()],$t.prototype,"types",null),u([d()],$t.prototype,"typeIdField",null),u([d()],$t.prototype,"formTemplate",null),u([d({readOnly:!0})],$t.prototype,"fieldsIndex",null),u([d({type:NAe,json:{read:{source:"layerDefinition.floorInfo"},write:{target:"layerDefinition.floorInfo"}}})],$t.prototype,"floorInfo",void 0),u([d(x0e.outFields)],$t.prototype,"outFields",void 0),u([d({type:ux,readOnly:!0,json:{read:!1}})],$t.prototype,"nodePages",void 0),u([$e("service","nodePages",["nodePages","pointNodePages"])],$t.prototype,"readNodePages",null),u([d({type:[rd],readOnly:!0})],$t.prototype,"materialDefinitions",void 0),u([d({type:[R3],readOnly:!0})],$t.prototype,"textureSetDefinitions",void 0),u([d({type:[M3],readOnly:!0})],$t.prototype,"geometryDefinitions",void 0),u([d({readOnly:!0})],$t.prototype,"serviceUpdateTimeStamp",void 0),u([d({readOnly:!0})],$t.prototype,"attributeStorageInfo",void 0),u([d({readOnly:!0})],$t.prototype,"statisticsInfo",void 0),u([d({type:ot.ofType(Number),nonNullable:!0,json:{origins:{service:{read:!1,write:!1}},name:"layerDefinition.excludeObjectIds",write:{enabled:!0}}})],$t.prototype,"excludeObjectIds",void 0),u([d({type:String,json:{origins:{service:{read:!1,write:!1}},name:"layerDefinition.definitionExpression",write:{enabled:!0,allowNull:!0}}})],$t.prototype,"definitionExpression",void 0),u([d({type:EPt,json:{name:"layerDefinition.polygonFilter",write:!0}})],$t.prototype,"filter",void 0),u([d({type:String,json:{origins:{"web-scene":{read:!0,write:!0}},read:!1}})],$t.prototype,"path",void 0),u([d($re)],$t.prototype,"elevationInfo",null),u([d({type:String})],$t.prototype,"geometryType",null),u([d(dL)],$t.prototype,"labelsVisible",void 0),u([d({type:[SR],json:{origins:{service:{name:"drawingInfo.labelingInfo",read:{reader:OI},write:!1}},name:"layerDefinition.drawingInfo.labelingInfo",read:{reader:OI},write:!0}})],$t.prototype,"labelingInfo",void 0),u([d(Ire)],$t.prototype,"legendEnabled",void 0),u([d({type:Number,json:{origins:{"web-document":{default:1,write:{enabled:!0,target:{opacity:{type:Number},"layerDefinition.drawingInfo.transparency":{type:Number}}},read:{source:["opacity","layerDefinition.drawingInfo.transparency"],reader(e,t){var i,s;if(typeof e=="number"&&e>=0&&e<=1)return e;const r=(s=(i=t.layerDefinition)==null?void 0:i.drawingInfo)==null?void 0:s.transparency;return r!==void 0?ZC(r):void 0}}},"portal-item":{write:!0},service:{read:!1}}}})],$t.prototype,"opacity",void 0),u([d({type:["Low","High"],readOnly:!0,json:{read:!1,origins:{service:{read:!0}}}})],$t.prototype,"priority",void 0),u([d({type:["Labels"],readOnly:!0,json:{read:!1,origins:{service:{read:!0}}}})],$t.prototype,"semantic",void 0),u([d({types:Are,json:{origins:{service:{read:{source:"drawingInfo.renderer"}}},name:"layerDefinition.drawingInfo.renderer",write:!0},value:null})],$t.prototype,"renderer",null),u([d({json:{read:!1}})],$t.prototype,"cachedDrawingInfo",void 0),u([$e("service","cachedDrawingInfo")],$t.prototype,"readCachedDrawingInfo",null),u([d({readOnly:!0,json:{read:!1}})],$t.prototype,"capabilities",null),u([d({type:Boolean,json:{read:!1}})],$t.prototype,"editingEnabled",null),u([d(hL)],$t.prototype,"popupEnabled",void 0),u([d({type:qT,json:{name:"popupInfo",write:!0}})],$t.prototype,"popupTemplate",void 0),u([d({readOnly:!0,json:{read:!1}})],$t.prototype,"defaultPopupTemplate",null),u([d({type:String,json:{read:!1}})],$t.prototype,"objectIdField",void 0),u([$e("service","objectIdField",["objectIdField","fields"])],$t.prototype,"readObjectIdField",null),u([d({type:String,json:{read:!1}})],$t.prototype,"globalIdField",void 0),u([$e("service","globalIdField",["globalIdField","fields"])],$t.prototype,"readGlobalIdField",null),u([d({readOnly:!0,type:String,json:{read:!1}})],$t.prototype,"displayField",null),u([d({type:String,json:{read:!1}})],$t.prototype,"profile",void 0),u([$e("service","profile",["store.profile"])],$t.prototype,"readProfile",null),u([d({readOnly:!0,type:String,json:{origins:{service:{read:{source:"store.normalReferenceFrame"}}},read:!1}})],$t.prototype,"normalReferenceFrame",void 0),u([d(Mre)],$t.prototype,"screenSizePerspectiveEnabled",void 0),$t=u([$("esri.layers.SceneLayer")],$t);const T0e={"mesh-pyramids":"mesh-pyramids",meshpyramids:"mesh-pyramids","features-meshes":"mesh-pyramids",points:"points","features-points":"points",lines:"lines","features-lines":"lines",polygons:"polygons","features-polygons":"polygons"},APt={"mesh-pyramids":"mesh",points:"point",lines:"polyline",polygons:"polygon"},HDe=$t,CNt=Object.freeze(Object.defineProperty({__proto__:null,default:HDe},Symbol.toStringTag,{value:"Module"}));function RPt(e){const t={title:"Falls Church - 3D Building Information",content:[{type:"fields",fieldInfos:[{fieldName:"name",label:"Name"},{fieldName:"building",label:"Building Type "},{fieldName:"building_levels",label:"Floors"}]}]},r=new HDe({url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",popupTemplate:t,title:"Buildings",id:"osm3D_BuildingsLayer"});e.add(r)}async function OPt(e,t={}){await PPt(e,t),Jt(t)}async function MPt(e,t={}){const{basemap:r,view:i}=e;if(Jt(t),"spatialReferenceLocked"in i&&!i.spatialReferenceLocked||(await r.load(t),Jt(t),r.baseLayers.length===0))return;const s=r.baseLayers.getItemAt(0);if(!aC(s))return;if(r.spatialReference){if(i.spatialReference.equals(r.spatialReference))return;S0e()}await s.load(t),Jt(t);const n=(("supportedSpatialReferences"in s?s.supportedSpatialReferences:null)||["tileInfo"in s?s.tileInfo.spatialReference:null]).filter(Boolean);n.length!==0&&n.every(o=>!i.spatialReference.equals(o))&&S0e()}function S0e(){throw new j("basemap-compatibility:incompatible-spatial-reference","Basemap spatial reference is not compatible with the view")}async function PPt(e,t){const{basemap:r,view:i}=e;if(await r.load(t),r.baseLayers.length===0)return;const s=r.baseLayers.concat(r.referenceLayers).toArray().filter(o=>!Aae(o)).map(o=>new j("basemap-compatibility:unsupported-basemap-layer-type","Unsupported basemap layer type ${operationalLayerType}",{layer:o,operationalLayerType:o.operationalLayerType||"unknown"}));if(s.length)throw s[0];const n=r.baseLayers.getItemAt(0);if(Aae(n)){try{await n.load(t)}catch(o){const a="basemap-compatibility:unknown-error",l="Unknown basemap compatibility error",{name:c=a,message:h=l,details:p}=o;throw new j(c,h,p)}IPt(n,i)}}function IPt(e,t){const r=t.state.viewingMode;if(!r)return;let i,s;if((e==null?void 0:e.type)==="wmts"){const l=m$e(e,t.spatialReference,r);if(R(l.tileInfo))throw new j("basemapgalleryitem:tiling-scheme-incompatible","Basemap tiling scheme is incompatible with the view");i=l.tileInfo,s=l.fullExtent}else i=e.tileInfo,s=e.fullExtent;if(R(i))return;if(!i$(i.spatialReference,r))throw new j(`basemapgalleryitem:spatial-reference-unsupported-${uP(r)}`,`Basemap spatial reference is unsupported in ${uP(r)} mode`);const n=i.spatialReference.isGeographic,o=(e==null?void 0:e.type)==="vector-tile"?i.getOrCreateCompatible(256,n?1:2):null;if(r===Be.Global){let l=b$(i,s,null,r);if(l&&(e==null?void 0:e.type)==="vector-tile"&&b(s)&&o&&!b$(o,s,null,r)&&(l=null),l){const c=i.spatialReference.isWebMercator?"web-mercator":"wgs84";throw new j(`basemapgalleryitem:tiling-scheme-unsupported-${c}-global`,"Basemap tiling scheme is unsupported in global mode",{error:l})}}else if(Mi.checkUnsupported(i))throw new j("basemapgalleryitem:tiling-scheme-unsupported-local","Basemap tiling scheme is unsupported in local mode");const a=t.get("basemapTerrain.tilingScheme");if(a&&!a.compatibleWith(i)&&((e==null?void 0:e.type)!=="vector-tile"||!o||!a.compatibleWith(o)))throw new j("basemapgalleryitem:tiling-scheme-incompatible","Basemap tiling scheme is incompatible with the view")}let _m=class extends pg(xe){constructor(e){super(e),this.compatibilityFunction=null,this.error=null,this.state="loading",this.view=null}initialize(){const e=()=>this.refresh();this.handles.add([te(()=>{var t;return(t=this.basemap)==null?void 0:t.loadStatus},e),te(()=>this.compatibilityFunction,e),te(()=>{var t;return this.view&&"basemapTerrain"in this.view&&((t=this.view.basemapTerrain)==null?void 0:t.tilingScheme)},e),te(()=>{var t;return(t=this.view)==null?void 0:t.ready},e),te(()=>{var t;return(t=this.view)==null?void 0:t.spatialReference},e)]),this.refresh()}destroy(){this._cancelRefresh(),this.basemap=null,this.compatibilityFunction=null,this.view=null}get _spatialReferenceTask(){return Dze(this.view,this.basemap)}set basemap(e){const t=this._get("basemap");t&&t.cancelLoad(),e&&e.load().catch(()=>{}),this._set("basemap",e)}get spatialReference(){return this._spatialReferenceTask.spatialReference}refresh(){var i;this._cancelRefresh(),this._set("state","loading");const e=(i=this.basemap)==null?void 0:i.loadStatus;if(e!=="loaded"&&e!=="failed")return;if(!this.compatibilityFunction)return void(e==="loaded"?(this._set("state","ready"),this._set("error",null)):(this._set("state","error"),this._set("error",this.basemap.loadError)));const t=new AbortController,{signal:r}=t;this.compatibilityFunction(this,{signal:r}).then(()=>E1(()=>!this._spatialReferenceTask.updating,r)).then(()=>{this._set("state","ready"),this._set("error",null)}).catch(s=>{Vi(s)||(this._set("state","error"),this._set("error",s))}),this._refreshController=t}_cancelRefresh(){this._refreshController&&(this._refreshController.abort(),this._refreshController=null)}};u([d({readOnly:!0})],_m.prototype,"_spatialReferenceTask",null),u([d()],_m.prototype,"basemap",null),u([d()],_m.prototype,"compatibilityFunction",void 0),u([d({readOnly:!0})],_m.prototype,"error",void 0),u([d({readOnly:!0})],_m.prototype,"spatialReference",null),u([d({readOnly:!0})],_m.prototype,"state",void 0),u([d()],_m.prototype,"view",void 0),_m=u([$("esri.widgets.BasemapGallery.support.BasemapGalleryItem")],_m);const qDe=_m,WDe=ot.ofType(Bm);let P3=class extends xe{constructor(e){super(e),this.basemaps=new WDe}get state(){return"ready"}refresh(){}};u([d({type:WDe})],P3.prototype,"basemaps",void 0),u([d({readOnly:!0})],P3.prototype,"state",null),P3=u([$("esri.widgets.BasemapGallery.support.LocalBasemapsSource")],P3);const XDe=P3,ZDe=ot.ofType(Bm),YDe="esri.widgets.BasemapGallery.support.PortalBasemapsSource",$Pt=fe.getLogger(YDe);let my=class extends gh.LoadableMixin(j$(XDe)){constructor(e){super(e),this._handles=new Dt,this.basemaps=new ZDe,this.filterFunction=null,this.portal=Sn.getDefault(),this.query=null,this.updateBasemapsCallback=null}initialize(){this._handles.add([te(()=>{var e,t;return[this.filterFunction,this.loadStatus,(e=this.portal)==null?void 0:e.basemapGalleryGroupQuery,(t=this.portal)==null?void 0:t.user,this.query,this.updateBasemapsCallback]},()=>this.refresh(),Rt)])}destroy(){this._handles.destroy(),this._handles=null,this.filterFunction=null,this.portal=null}get state(){return this.loadStatus==="not-loaded"?"not-loaded":this.loadStatus==="loading"||this._lastPortalBasemapFetchController?"loading":"ready"}load(e){return this.addResolvingPromise(this.portal.load(e)),this.notifyChange("state"),Promise.resolve(this)}async refresh(){if(this.state!=="ready")return;this._lastPortalBasemapFetchController&&(this._lastPortalBasemapFetchController.abort(),this._lastPortalBasemapFetchController=null);const e=this.portal,t=new AbortController;this._lastPortalBasemapFetchController=t,this.notifyChange("state");try{const r=await e.fetchBasemaps(this._toQueryString(this.query),t);this._updateBasemaps(r)}catch(r){if(Vi(r))throw r;$Pt.warn(new j("basemap-source:fetch-basemaps-error","Could not fetch basemaps from portal.",{error:r})),this._updateBasemaps()}this._lastPortalBasemapFetchController=null,this.notifyChange("state")}_toQueryString(e){return e&&typeof e!="string"?Object.keys(e).map(t=>`${t}:${e[t]}`).join(" AND "):e}_updateBasemaps(e=[]){let t=this.filterFunction?e.filter(this.filterFunction):e;t=this.updateBasemapsCallback?this.updateBasemapsCallback(t):t,this.basemaps.removeAll(),this.basemaps.addMany(t)}};u([d({readOnly:!0,type:ZDe})],my.prototype,"basemaps",void 0),u([d()],my.prototype,"filterFunction",void 0),u([d({type:Sn})],my.prototype,"portal",void 0),u([d()],my.prototype,"query",void 0),u([d({readOnly:!0})],my.prototype,"state",null),u([d()],my.prototype,"updateBasemapsCallback",void 0),my=u([$(YDe)],my);const Ik=my,QDe=ot.ofType(qDe);function LPt(e){return e&&e.declaredClass==="esri.portal.Portal"}function DPt(e){return e&&!(e instanceof Ik)&&(!!e.portal||!!e.query)}function NPt(e){return e&&"basemaps"in e&&"state"in e&&"refresh"in e}let Ip=class extends pg(gh){constructor(e){super(e),this._loadingProjectionEngine=!1,this.items=new QDe,this.source=new Ik,this.view=null}initialize(){const e=()=>this._recreateItems();this.handles.add([te(()=>this.state==="ready"?this.compatibilityFunction:null,()=>this._updateItems()),rs(()=>{var t;return(t=this.source)==null?void 0:t.basemaps},"change",e,{onListenerAdd:e})])}get activeBasemap(){var e,t,r;return(r=(t=(e=this.view)==null?void 0:e.map)==null?void 0:t.basemap)!=null?r:null}set activeBasemap(e){var i,s;if(!this.view.map)return;const t=typeof e=="string"?Bm.fromId(e):e;if(!t||!this.view.ready)return this.view.map.basemap=t,void this._clearOverride("activeBasemap");const r=t.spatialReference||((s=(i=this.items)==null?void 0:i.find(n=>this.basemapEquals(t,n.basemap)))==null?void 0:s.spatialReference);if(r&&"spatialReferenceLocked"in this.view&&!this.view.spatialReferenceLocked){const n=this.view.spatialReference;if(b(r)&&!ml(n,r)&&!sg(this.view.spatialReference,r)&&!x6())return this._override("activeBasemap",t),this._loadingProjectionEngine=!0,void mI().then(()=>{this._get("activeBasemap")===e&&(this.view.map.basemap=e,this.view.spatialReference=r,this._clearOverride("activeBasemap"))},()=>{}).then(()=>{this._loadingProjectionEngine=!1});this.view.map.basemap=t,this._clearOverride("activeBasemap"),b(r)&&!ml(this.view.spatialReference,r)&&(this.view.spatialReference=r)}else this.view.map.basemap=t,this._clearOverride("activeBasemap")}get compatibilityFunction(){var e;return((e=this.view)==null?void 0:e.type)==="3d"?OPt:MPt}set compatibilityFunction(e){b(e)?this._override("compatibilityFunction",e):this._clearOverride("compatibilityFunction")}castSource(e){return Array.isArray(e)||ot.isCollection(e)?new XDe({basemaps:e}):LPt(e)?new Ik({portal:e}):DPt(e)?new Ik(e):NPt(e)?e:null}get state(){var e;return((e=this.view)==null?void 0:e.ready)&&this.source?this._loadingProjectionEngine?"loading":"ready":"disabled"}basemapEquals(e,t){return Lze(e,t)}refresh(){this._recreateItems()}load(e){return this.addResolvingPromise(gh.isLoadable(this.source)?this.source.load(e):null),Promise.resolve(this)}_recreateItems(){var i;const e=(i=this.source)==null?void 0:i.basemaps,{view:t,compatibilityFunction:r}=this;this.items.removeAll().forEach(s=>s.destroy()),e&&this.items.addMany(e.map(s=>new qDe({basemap:s,compatibilityFunction:r,view:t})))}_updateItems(){for(const e of this.items)e.compatibilityFunction=this.compatibilityFunction,e.view=this.view}};u([d()],Ip.prototype,"_loadingProjectionEngine",void 0),u([d()],Ip.prototype,"activeBasemap",null),u([d()],Ip.prototype,"compatibilityFunction",null),u([d({readOnly:!0,type:QDe})],Ip.prototype,"items",void 0),u([d()],Ip.prototype,"source",void 0),u([qt("source")],Ip.prototype,"castSource",null),u([d({readOnly:!0})],Ip.prototype,"state",null),u([d()],Ip.prototype,"view",void 0),Ip=u([$("esri.widgets.BasemapGallery.BasemapGalleryViewModel")],Ip);const FPt=Ip,Su={base:"esri-basemap-gallery esri-widget esri-widget--panel-height-only",sourceLoading:"esri-basemap-gallery--source-loading",loader:"esri-basemap-gallery__loader",item:"esri-basemap-gallery__item",itemContainer:"esri-basemap-gallery__item-container",itemTitle:"esri-basemap-gallery__item-title",itemThumbnail:"esri-basemap-gallery__item-thumbnail",selectedItem:"esri-basemap-gallery__item--selected",itemError:"esri-basemap-gallery__item--error",emptyMessage:"esri-widget__content--empty",widgetIcon:"esri-icon-basemap",disabled:"esri-disabled",loaderAnimation:"esri-widget__loader-animation"};let Du=class extends Un{constructor(e,t){super(e,t),this._handles=new Dt,this.activeBasemap=null,this.disabled=!1,this.headingLevel=2,this.iconClass=Su.widgetIcon,this.label=void 0,this.messages=null,this.source=null,this.view=null,this.viewModel=new FPt}initialize(){const e=this._handles;this.own([rs(()=>this.viewModel.items,"change",t=>{const r="basemap-gallery-item-changes",{added:i,moved:s}=t;e.remove(r),e.add([...i,...s].map(n=>te(()=>n.state,()=>this.scheduleRender())),r),this.scheduleRender()}),e,Lo(()=>this.source,()=>this.viewModel.load(),{initial:!0,once:!0})])}destroy(){this._handles.destroy()}loadDependencies(){return ie(()=>import("./calcite-scrim.2ca13d57.js"),[],import.meta.url)}render(){const e=this.get("source.state")==="loading",t=this.disabled||this.get("viewModel.state")==="disabled",r=this.get("viewModel.items").toArray().map(this._renderBasemapGalleryItem,this),i={[Su.sourceLoading]:e,[Su.disabled]:t},s=e?U("div",{class:Su.loader,key:"esri-basemap-gallery__loader"}):null,n=e?null:r.length>0?U("ul",{class:Su.itemContainer,key:"esri-basemap-gallery__item-container",role:"menu"},r):U("div",{class:Su.emptyMessage,key:"esri-basemap-gallery__empty-message"},U(u1,{level:this.headingLevel},this.messages.noBasemaps));return U("div",{class:this.classes(Su.base,i)},s,n)}_handleClick(e){const t=e.currentTarget["data-item"];t.state==="ready"&&(this.viewModel.activeBasemap=t.basemap)}_renderBasemapGalleryItem(e){const t=e.get("basemap.thumbnailUrl")||wr("esri/themes/base/images/basemap-toggle-64.svg"),r=e.get("basemap.title"),i=e.get("basemap.portalItem.snippet"),s=e.get("error.message")||i||r,{viewModel:n}=this,o=!this.disabled&&n.state!=="disabled"&&e.state==="ready"?0:-1,a=n.basemapEquals(e.basemap,this.activeBasemap),l=n.state==="loading",c={[Su.selectedItem]:a,[Su.itemError]:e.state==="error"};return U("li",{"aria-selected":a.toString(),bind:this,class:this.classes(Su.item,c),"data-item":e,onkeydown:this._handleClick,onclick:this._handleClick,role:"menuitem",tabIndex:o,title:s},U("img",{alt:"",class:Su.itemThumbnail,src:t}),U("div",{class:Su.itemTitle},r),e.state==="loading"||a&&l?U("calcite-scrim",null,U("span",{"aria-hidden":"true",role:"presentation",class:Su.loaderAnimation})):null)}};u([We("viewModel.activeBasemap")],Du.prototype,"activeBasemap",void 0),u([d()],Du.prototype,"disabled",void 0),u([d()],Du.prototype,"headingLevel",void 0),u([d()],Du.prototype,"iconClass",void 0),u([d({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],Du.prototype,"label",void 0),u([d(),Js("esri/widgets/BasemapGallery/t9n/BasemapGallery")],Du.prototype,"messages",void 0),u([We("viewModel.source")],Du.prototype,"source",void 0),u([We("viewModel.view")],Du.prototype,"view",void 0),u([d()],Du.prototype,"viewModel",void 0),u([sl()],Du.prototype,"_handleClick",null),Du=u([$("esri.widgets.BasemapGallery")],Du);const kPt=Du;let gy=class extends Jre(ds.EventedAccessor){constructor(e){super(e),this._initialViewpoint=null,this._goingHomeController=null,this.go=this.go.bind(this)}destroy(){this._cancelGo(),this.view=null}get state(){return this.get("view.ready")?this._goingHomeController?"going-home":"ready":"disabled"}set view(e){this._initialViewpoint=null,this._set("view",e),e&&e.when().then(()=>{this.view===e&&(this._initialViewpoint=e.viewpoint.clone(),this.notifyChange("viewpoint"))})}get viewpoint(){return this._get("viewpoint")||this._initialViewpoint}set viewpoint(e){this._set("viewpoint",e)}async go(){if(!this.get("view.ready"))throw new j("home:disabled-state","Cannot go when disabled.");this._cancelGo(),this.emit("go");const e=new AbortController;this._goingHomeController=e;try{await this.view.when(),await this.callGoTo({target:this.viewpoint,options:{signal:e.signal}})}catch{}this._goingHomeController=null}cancelGo(){this._cancelGo()}_cancelGo(){const{_goingHomeController:e}=this;e&&e.abort(),this._goingHomeController=null}};u([d()],gy.prototype,"_goingHomeController",void 0),u([d({readOnly:!0})],gy.prototype,"state",null),u([d()],gy.prototype,"view",null),u([d({type:Vd})],gy.prototype,"viewpoint",null),u([d()],gy.prototype,"go",null),u([d()],gy.prototype,"cancelGo",null),gy=u([$("esri.widgets.Home.HomeViewModel")],gy);const JDe=gy,Hb={base:"esri-home esri-widget--button esri-widget",text:"esri-icon-font-fallback-text",homeIcon:"esri-icon esri-icon-home",loadingIcon:"esri-icon-loading-indicator",rotatingIcon:"esri-rotating",widgetIcon:"esri-icon-home",disabled:"esri-disabled"};let kl=class extends Un{constructor(e,t){super(e,t),this.goToOverride=null,this.iconClass=Hb.widgetIcon,this.label=void 0,this.messages=null,this.messagesCommon=null,this.view=null,this.viewModel=new JDe,this.viewpoint=null}get homeTitle(){var i;const e=(i=this.viewModel)==null?void 0:i.state,{messagesCommon:t,messages:r}=this;return e==="going-home"?t.cancel:r.title}cancelGo(){return null}go(){return null}render(){var i;const e=(i=this.viewModel)==null?void 0:i.state,{homeTitle:t}=this,r={[Hb.disabled]:e==="disabled"};return U("div",{bind:this,class:this.classes(Hb.base,r),role:"button",tabIndex:0,onclick:this._go,onkeydown:this._go,"aria-label":t,title:t},this.renderIcon(),this.renderText())}renderIcon(){var r;const e=(r=this.viewModel)==null?void 0:r.state,t={[Hb.loadingIcon]:e==="going-home",[Hb.rotatingIcon]:e==="going-home"};return U("span",{"aria-hidden":"true",class:this.classes(Hb.homeIcon,t)})}renderText(){const{messages:e}=this;return U("span",{class:Hb.text},e.button)}_go(){const{viewModel:e}=this;e.state==="going-home"?e.cancelGo():e.go()}};u([We("viewModel.goToOverride")],kl.prototype,"goToOverride",void 0),u([d({readOnly:!0})],kl.prototype,"homeTitle",null),u([d()],kl.prototype,"iconClass",void 0),u([d({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],kl.prototype,"label",void 0),u([d(),Js("esri/widgets/Home/t9n/Home")],kl.prototype,"messages",void 0),u([d(),Js("esri/t9n/common")],kl.prototype,"messagesCommon",void 0),u([We("viewModel.view")],kl.prototype,"view",void 0),u([d({type:JDe}),T2e("go")],kl.prototype,"viewModel",void 0),u([We("viewModel.viewpoint")],kl.prototype,"viewpoint",void 0),u([We("viewModel.cancelGo")],kl.prototype,"cancelGo",null),u([We("viewModel.go")],kl.prototype,"go",null),u([sl()],kl.prototype,"_go",null),kl=u([$("esri.widgets.Home")],kl);const UPt=kl;let o_=class extends xe{constructor(e){super(e),this._viewpointHandle=null,this._handles=new Dt,this.group=null}initialize(){this._handles.add(rs(()=>{var e;return(e=this.view)==null?void 0:e.ui},"expand",e=>{const{target:t}=e;t&&t!==this&&t.expanded&&t.group&&t.group===this.group&&this._collapse()}))}destroy(){this._viewpointHandle=null,this.view=null,this._handles.destroy(),this._handles=null}set autoCollapse(e){this._set("autoCollapse",e),this._watchViewpoint()}set expanded(e){const t=!!e;this._set("expanded",t);const r=this.get("view.ui");r&&r.emit("expand",{target:this}),this._viewpointHandleChange(t)}get state(){return this.get("view.ready")?"ready":"disabled"}set view(e){this._get("view")!==e&&(this._set("view",e),e&&Lo(()=>e.ready,()=>{this.view===e&&this._watchViewpoint()},{once:!0,initial:!0}))}_viewpointHandleChange(e){this._viewpointHandle&&(e?Lo(()=>this.view.stationary,()=>this._viewpointHandle.resume(),{once:!0,initial:!0}):this._viewpointHandle.pause())}_watchViewpoint(){const e="viewpoint";this._handles.remove(e),this._viewpointHandle=null;const{autoCollapse:t,view:r}=this;if(r&&t){const i=Oze(()=>r.type==="3d"?r.camera:r.viewpoint,()=>this._collapse());this._handles.add(i,e),this._viewpointHandle=i}}_collapse(){this.expanded=!1}};u([d({value:!1})],o_.prototype,"autoCollapse",null),u([d({value:!1})],o_.prototype,"expanded",null),u([d()],o_.prototype,"group",void 0),u([d({readOnly:!0})],o_.prototype,"state",null),u([d({value:null})],o_.prototype,"view",null),o_=u([$("esri.widgets.Expand.ExpandViewModel")],o_);const KDe=o_,zn={base:"esri-expand esri-widget",modeAuto:"esri-expand--auto",modeDrawer:"esri-expand--drawer",modeFloating:"esri-expand--floating",container:"esri-expand__container",containerExpanded:"esri-expand__container--expanded",panel:"esri-expand__panel",button:"esri-widget--button",text:"esri-icon-font-fallback-text",icon:"esri-collapse__icon",iconExpanded:"esri-expand__icon--expanded",iconNumber:"esri-expand__icon-number",iconNumberExpanded:"esri-expand__icon-number--expanded",expandIcon:"esri-icon-expand",collapseIcon:"esri-icon-collapse",content:"esri-expand__content",contentExpanded:"esri-expand__content--expanded",expandMask:"esri-expand__mask",expandMaskExpanded:"esri-expand__mask--expanded"};let ln=class extends Un{constructor(e,t){super(e,t),this.autoCollapse=null,this.closeOnEsc=!0,this.collapseTooltip="",this.content="",this.expanded=null,this.expandTooltip="",this.group=null,this.iconNumber=0,this.label=void 0,this.messages=null,this.messagesCommon=null,this.mode="auto",this.view=null,this.viewModel=new KDe,this._handleKeyDown=r=>{const{closeOnEsc:i,_toggleButtonEl:s,expanded:n}=this;!n||!i||r.target===s||r.key!=="Escape"||(typeof i=="function"?i(r):i)&&(this.expanded=!1,s==null||s.focus())}}get contentId(){return`${this.id}_controls_content`}get expandTitle(){const{expanded:e,messagesCommon:t,collapseTooltip:r,expandTooltip:i}=this;return e?r||t.collapse:i||t.expand}get collapseIconClass(){return zn.collapseIcon}set collapseIconClass(e){e?this._override("collapseIconClass",e):this._clearOverride("collapseIconClass")}get expandIconClass(){return tV(this.content)?this.content.iconClass:zn.expandIcon}set expandIconClass(e){e?this._override("expandIconClass",e):this._clearOverride("expandIconClass")}expand(){this.viewModel.expanded=!0}collapse(){this.viewModel.expanded=!1}toggle(){this.viewModel.expanded=!this.viewModel.expanded}render(){const{mode:e}=this,t={[zn.modeAuto]:e==="auto",[zn.modeDrawer]:e==="drawer",[zn.modeFloating]:e==="floating"};return U("div",{class:this.classes(zn.base,t),onkeydown:this._handleKeyDown},this.renderMask(),this.renderContainer())}renderContainer(){const{expanded:e}=this,t={[zn.containerExpanded]:e};return U("div",{class:this.classes(zn.container,t)},this.renderPanel(),this.renderContent())}renderMask(){const{expanded:e}=this,t={[zn.expandMaskExpanded]:e};return U("div",{bind:this,onclick:this._toggle,class:this.classes(zn.expandMask,t)})}renderBadgeNumber(){const{expanded:e,iconNumber:t}=this;return t&&!e?U("span",{key:"expand__icon-number",class:zn.iconNumber},t):null}renderPanelNumber(){const{iconNumber:e,expanded:t}=this;return e&&t?U("span",{key:"expand__expand-icon-number",class:this.classes(zn.iconNumber,zn.iconNumberExpanded)},e):null}renderIcon(){const{collapseIconClass:e,expandIconClass:t,expanded:r}=this,i={[zn.iconExpanded]:r,[e]:r,[t]:!r};return e===t&&(i[e]=!0),U("span",{"aria-hidden":"true",class:this.classes(zn.icon,i)})}renderTitle(){return U("span",{class:zn.text},this.expandTitle)}renderExpandButton(){const{expanded:e,expandTitle:t,contentId:r}=this;return U("div",{afterCreate:this._storeToggleButtonEl,"aria-controls":r,"aria-expanded":e?"true":"false",bind:this,class:zn.button,onclick:this._toggle,onkeydown:this._toggle,role:"button",tabindex:"0",title:t},this.renderBadgeNumber(),this.renderIcon(),this.renderTitle())}renderPanel(){return U("div",{class:zn.panel},this.renderExpandButton(),this.renderPanelNumber())}renderContent(){const{expanded:e,contentId:t,content:r}=this,i={[zn.contentExpanded]:e},s={id:t,role:"region",class:this.classes(zn.content,i)};return typeof r=="string"?U("div",{key:"content__string",innerHTML:r,...s}):tV(r)?U("div",{key:"content__widget",...s},r.render()):r instanceof HTMLElement?U("div",{key:"content__html-element",bind:r,afterCreate:this._attachToNode,...s}):E2e(r)?U("div",{key:"content__node",bind:r.domNode,afterCreate:this._attachToNode,...s}):null}_toggle(){this.toggle()}_attachToNode(e){const t=this;e.appendChild(t)}_storeToggleButtonEl(e){this._toggleButtonEl=e}};u([d({readOnly:!0})],ln.prototype,"contentId",null),u([d({readOnly:!0})],ln.prototype,"expandTitle",null),u([We("viewModel.autoCollapse")],ln.prototype,"autoCollapse",void 0),u([d()],ln.prototype,"closeOnEsc",void 0),u([d()],ln.prototype,"collapseIconClass",null),u([d()],ln.prototype,"collapseTooltip",void 0),u([d()],ln.prototype,"content",void 0),u([We("viewModel.expanded")],ln.prototype,"expanded",void 0),u([d()],ln.prototype,"expandIconClass",null),u([d()],ln.prototype,"expandTooltip",void 0),u([We("viewModel.group")],ln.prototype,"group",void 0),u([d()],ln.prototype,"iconNumber",void 0),u([d({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],ln.prototype,"label",void 0),u([d(),Js("esri/widgets/Expand/t9n/Expand")],ln.prototype,"messages",void 0),u([d(),Js("esri/t9n/common")],ln.prototype,"messagesCommon",void 0),u([d()],ln.prototype,"mode",void 0),u([We("viewModel.view")],ln.prototype,"view",void 0),u([d({type:KDe})],ln.prototype,"viewModel",void 0),u([sl()],ln.prototype,"_toggle",null),ln=u([$("esri.widgets.Expand")],ln);const VPt=ln,nM="top-right";function zPt(e){const t=new kPt({view:e,source:[Bm.fromId("topo-vector"),Bm.fromId("streets-vector"),Bm.fromId("satellite")]});e.ui.components=["attribution"],e.ui.add(new VPt({view:e,content:t,expandTooltip:"Basemap Gallery"}),nM),e.ui.add(new YLe({view:e}),nM),e.ui.add(new JLe({view:e}),nM),e.ui.add(new UPt({view:e}),nM),e.ui.add(new eDe({view:e}),nM)}function BPt(){const[e,t]=IC.exports.useState(!1);IC.exports.useEffect(()=>{r().then(()=>{t(!0)})},[]);const r=async()=>{try{const i=new vwe({basemap:"topo-vector"}),s=new hMt({map:i,container:"mapContainer",camera:{position:[-77.1701,38.8553,3750],tilt:40}});zPt(s),tPt(i),RPt(i);const n=new k3t({view:s,layerInfos:[{layer:i.findLayerById("Jurisdictional_Boundary")},{layer:i.findLayerById("osm3D_BuildingsLayer")}]});s.ui.add(n,"bottom-left")}catch(i){console.error(i)}};return H3t("div",{className:"App",children:[M$("main",{id:"mapContainer",className:"mapContainer"}),M$(q3t,{})]})}const GPt=document.getElementById("root");AH.createRoot(GPt).render(M$(RNe.StrictMode,{children:M$(BPt,{})}));export{xbt as $,yDt as A,eA as B,vft as C,v0 as D,Sa as E,ot as F,Xs as G,kd as H,cDt as I,_Dt as J,PLt as K,f6 as L,ILt as M,Y$ as N,$Lt as O,Yee as P,u6 as Q,AAe as R,mg as S,nBe as T,ei as U,MLt as V,ds as W,aDt as X,P9e as Y,ec as Z,ng as _,F_ as a,nDe as a$,fmt as a0,yh as a1,Jt as a2,MK as a3,he as a4,ZIt as a5,fe as a6,qd as a7,$o as a8,aA as a9,_Pe as aA,xs as aB,yn as aC,oIt as aD,eh as aE,Co as aF,T1 as aG,ki as aH,tf as aI,E1 as aJ,se as aK,xn as aL,de as aM,le as aN,at as aO,Wu as aP,nN as aQ,oDt as aR,xle as aS,tDt as aT,gmt as aU,p6 as aV,sg as aW,qPt as aX,YT as aY,Tbt as aZ,pse as a_,met as aa,_t as ab,vi as ac,Gee as ad,ae,eg as af,vh as ag,M as ah,tn as ai,g0 as aj,Kt as ak,wA as al,Xt as am,mDt as an,_A as ao,fDt as ap,ADt as aq,Ese as ar,pDt as as,dDt as at,Lo as au,rs as av,ER as aw,vt as ax,wn as ay,j as az,Oee as b,O as b$,Qm as b0,Cre as b1,bn as b2,iR as b3,Ut as b4,KIe as b5,YIt as b6,bNt as b7,mi as b8,T6 as b9,FAe as bA,HC as bB,Sn as bC,pM as bD,Ze as bE,a$t as bF,Q$ as bG,Ds as bH,BLt as bI,Ywe as bJ,uu as bK,C5e as bL,ah as bM,GT as bN,sh as bO,rst as bP,jLt as bQ,dTt as bR,DDt as bS,b$ as bT,pg as bU,j$ as bV,Ju as bW,xf as bX,$c as bY,X$ as bZ,Bi as b_,kLt as ba,h0 as bb,Qwe as bc,Dx as bd,Jae as be,Jwe as bf,Gbt as bg,Ar as bh,JPt as bi,X_e as bj,q_e as bk,ie as bl,wr as bm,je as bn,Se as bo,mr as bp,_i as bq,af as br,hs as bs,er as bt,Ke as bu,ci as bv,dz as bw,Be as bx,pSe as by,A_ as bz,Gm as c,_we as c$,z$ as c0,Nx as c1,Xz as c2,Xr as c3,Ia as c4,gn as c5,gr as c6,sr as c7,Hs as c8,xt as c9,oi as cA,zr as cB,Gt as cC,N0 as cD,dB as cE,eb as cF,cc as cG,DB as cH,or as cI,cg as cJ,j1 as cK,rb as cL,kB as cM,Ca as cN,Tg as cO,NB as cP,PB as cQ,IT as cR,KB as cS,Egt as cT,mie as cU,IR as cV,aPe as cW,$s as cX,E6 as cY,mn as cZ,vEt as c_,Gi as ca,qA as cb,ULt as cc,J4 as cd,BT as ce,Zwt as cf,Yr as cg,ph as ch,ra as ci,_r as cj,PTe as ck,S as cl,Ss as cm,Th as cn,Ht as co,qe as cp,K as cq,XV as cr,wg as cs,yt as ct,ni as cu,bg as cv,Ae as cw,q as cx,fi as cy,gi as cz,d,lNt as d$,RIt as d0,F6e as d1,EEt as d2,cet as d3,aJ as d4,VC as d5,ic as d6,Hke as d7,$e as d8,Wi as d9,F0 as dA,g$e as dB,zz as dC,rT as dD,u9e as dE,Ve as dF,Hy as dG,vGe as dH,Ce as dI,qi as dJ,oct as dK,cNt as dL,qDt as dM,uNt as dN,Die as dO,hA as dP,cne as dQ,sNt as dR,eNt as dS,tNt as dT,KDt as dU,Yq as dV,g3e as dW,du as dX,cCt as dY,JDt as dZ,K2t as d_,RLt as da,Nue as db,gh as dc,DAe as dd,vV as de,rPt as df,Bre as dg,dPt as dh,ux as di,rd as dj,R3 as dk,M3 as dl,vet as dm,Are as dn,hL as dp,qT as dq,lt as dr,Tr as ds,zre as dt,h1e as du,l6 as dv,ele as dw,nh as dx,ixe as dy,Hc as dz,u as e,LEt as e$,eEt as e0,l$t as e1,jge as e2,RC as e3,zx as e4,Yi as e5,o9e as e6,Gd as e7,Ky as e8,u$t as e9,rL as eA,Zt as eB,$It as eC,dte as eD,Re as eE,dNt as eF,hNt as eG,Ch as eH,ti as eI,HLt as eJ,WC as eK,hi as eL,pNt as eM,Q2t as eN,cIt as eO,UDt as eP,Rd as eQ,re as eR,FK as eS,sIt as eT,e$ as eU,nI as eV,Ah as eW,hDt as eX,sMe as eY,ef as eZ,Aft as e_,xr as ea,_n as eb,vf as ec,ZDt as ed,SEt as ee,U9e as ef,yEt as eg,Px as eh,aNt as ei,Kr as ej,uR as ek,oNt as el,Nt as em,DCe as en,NCe as eo,uDt as ep,nNt as eq,QDt as er,GR as es,YDt as et,tte as eu,mI as ev,Uee as ew,B9 as ex,Le as ey,$r as ez,ct as f,DIt as f$,DEt as f0,HDt as f1,q_ as f2,yGe as f3,Fn as f4,pi as f5,Te as f6,ul as f7,pe as f8,rg as f9,nc as fA,aR as fB,Wte as fC,W3t as fD,PWe as fE,nA as fF,ml as fG,K2e as fH,u0 as fI,EZe as fJ,EIt as fK,SE as fL,B3 as fM,l1 as fN,sT as fO,wle as fP,IWe as fQ,rLt as fR,$ce as fS,sLt as fT,AIt as fU,dbe as fV,TUe as fW,X$t as fX,pEe as fY,mEe as fZ,hEe as f_,U5 as fa,Lm as fb,CEt as fc,Zhe as fd,XDt as fe,Qae as ff,VLt as fg,Kwt as fh,B4e as fi,lIt as fj,Ud as fk,X9e as fl,Z9e as fm,yPt as fn,Xe as fo,ye as fp,L9e as fq,PK as fr,jTe as fs,iVe as ft,uVe as fu,Lx as fv,gEe as fw,mwe as fx,aee as fy,gIt as fz,gl as g,YLt as g$,JLt as g0,pwe as g1,qze as g2,SIt as g3,lu as g4,VJe as g5,zJe as g6,gR as g7,yR as g8,sEe as g9,K1 as gA,tyt as gB,fh as gC,Lt as gD,nn as gE,xm as gF,us as gG,Pr as gH,mt as gI,ze as gJ,gt as gK,Ct as gL,et as gM,Pi as gN,_l as gO,nt as gP,vl as gQ,Ye as gR,ri as gS,ta as gT,y0 as gU,ps as gV,Wj as gW,vr as gX,TV as gY,J1 as gZ,IB as g_,iDt as ga,uet as gb,bet as gc,S5e as gd,yNt as ge,LIt as gf,OIt as gg,PIt as gh,MIt as gi,IIt as gj,aI as gk,$d as gl,N6e as gm,q3e as gn,mft as go,sDt as gp,HIt as gq,tIt as gr,NDt as gs,BIt as gt,a6 as gu,lZe as gv,nDt as gw,Mi as gx,oEe as gy,cAe as gz,Rt as h,eL as h$,rt as h0,yr as h1,xTe as h2,h$t as h3,mSe as h4,wLt as h5,r6 as h6,Z$t as h7,XPt as h8,so as h9,o$t as hA,KPt as hB,f1 as hC,a1 as hD,HD as hE,Aee as hF,Cee as hG,Ree as hH,Q2e as hI,TIt as hJ,bx as hK,zDt as hL,BDt as hM,WIt as hN,xBe as hO,kw as hP,VDt as hQ,QV as hR,I1 as hS,Ei as hT,Zy as hU,Yl as hV,hu as hW,D0 as hX,Io as hY,pt as hZ,QIt as h_,Rse as ha,rc as hb,Qr as hc,I4 as hd,t6 as he,iIt as hf,xIt as hg,iLt as hh,ELt as hi,q1e as hj,iT as hk,IQ as hl,B$ as hm,Fd as hn,E$t as ho,mMt as hp,a0e as hq,KCe as hr,jT as hs,vg as ht,GC as hu,Hae as hv,Y2e as hw,SXe as hx,TXe as hy,Lu as hz,YC as i,AP as i$,Mr as i0,Er as i1,Ra as i2,exe as i3,GDt as i4,jDt as i5,Bee as i6,uGe as i7,b6 as i8,QLt as i9,REt as iA,sTe as iB,WDt as iC,JUe as iD,lLe as iE,Ue as iF,j_e as iG,L4 as iH,BC as iI,QTt as iJ,GOt as iK,TX as iL,vs as iM,xX as iN,EX as iO,kU as iP,O9e as iQ,Gx as iR,Kee as iS,Om as iT,PDt as iU,LDt as iV,y$e as iW,yge as iX,MDt as iY,IDt as iZ,ODt as i_,rn as ia,cr as ib,Cr as ic,CDt as id,rNt as ie,iNt as ig,q2e as ih,zM as ii,YTe as ij,A5e as ik,CV as il,mD as im,kDt as io,Nge as ip,FDt as iq,Da as ir,mC as is,Yqe as it,QC as iu,au as iv,kx as iw,qz as ix,l0 as iy,x6 as iz,ZT as j,L$t as j$,p5 as j0,Kxt as j1,Xd as j2,vIt as j3,Sie as j4,ll as j5,mge as j6,Oxt as j7,Mxt as j8,FLt as j9,Dxe as jA,$8e as jB,cC as jC,M9e as jD,lr as jE,No as jF,Fi as jG,oI as jH,bDt as jI,Cbe as jJ,_It as jK,pn as jL,e$t as jM,KIt as jN,G8e as jO,z8e as jP,Rbe as jQ,r$t as jR,i$t as jS,n$t as jT,s$t as jU,$m as jV,$I as jW,ea as jX,N6 as jY,I$t as jZ,$$t as j_,pL as ja,NLt as jb,qt as jc,Ls as jd,gd as je,V$t as jf,ac as jg,aV as jh,n$ as ji,RVe as jj,x$t as jk,N9e as jl,F9e as jm,we as jn,ut as jo,BA as jp,dT as jq,hh as jr,c$t as js,_$t as jt,b$t as ju,rie as jv,jq as jw,Cde as jx,Ft as jy,km as jz,_P as k,fx as k$,D$t as k0,Is as k1,k0 as k2,dl as k3,Hse as k4,Uwt as k5,jE as k6,kQ as k7,NT as k8,Fr as k9,wX as kA,wf as kB,ts as kC,sie as kD,tBe as kE,He as kF,Qs as kG,w$t as kH,RGe as kI,Pee as kJ,yd as kK,Xae as kL,jie as kM,yg as kN,Ro as kO,Xl as kP,Bx as kQ,eut as kR,ZLt as kS,WLt as kT,XLt as kU,g$t as kV,ERt as kW,zC as kX,Sq as kY,wft as kZ,GLt as k_,Z2 as ka,ETe as kb,Do as kc,En as kd,Bl as ke,Kz as kf,x1 as kg,Bp as kh,un as ki,URe as kj,Rst as kk,iie as kl,Bc as km,lC as kn,FM as ko,S0 as kp,gte as kq,pA as kr,ui as ks,Q3 as kt,R6 as ku,cT as kv,S$t as kw,T$t as kx,Lst as ky,kst as kz,Me as l,IK as l$,su as l0,t$t as l1,ii as l2,Bhe as l3,$K as l4,My as l5,cMe as l6,JT as l7,mte as l8,UIt as l9,Hi as lA,yl as lB,hl as lC,kr as lD,kn as lE,p3e as lF,f$t as lG,Ddt as lH,wh as lI,ih as lJ,lGe as lK,Cf as lL,w3e as lM,VA as lN,qC as lO,cse as lP,v6 as lQ,bIt as lR,F4e as lS,v$t as lT,U8 as lU,zU as lV,FOt as lW,fNt as lX,gNt as lY,mNt as lZ,fee as l_,y$t as la,jIt as lb,zhe as lc,gg as ld,ate as le,hTe as lf,ig as lg,$i as lh,ag as li,St as lj,sa as lk,FB as ll,$B as lm,ft as ln,Zr as lo,XIt as lp,fte as lq,Cs as lr,Pme as ls,PI as lt,zLt as lu,zIt as lv,d$t as lw,Yp as lx,xh as ly,e8 as lz,hR as m,RL as m$,GIt as m0,Xb as m1,Vhe as m2,lm as m3,nR as m4,gI as m5,vte as m6,cA as m7,VIt as m8,$ut as m9,tB as mA,Jxt as mB,tI as mC,QT as mD,Pre as mE,F5 as mF,eIt as mG,pKe as mH,nIt as mI,yT as mJ,oet as mK,fIt as mL,xUe as mM,KLt as mN,TLt as mO,TKe as mP,eJe as mQ,T6e as mR,xNt as mS,wNt as mT,oOe as mU,cie as mV,aOe as mW,A0 as mX,qc as mY,Ns as mZ,bh as m_,_te as ma,Wxe as mb,lA as mc,ome as md,nu as me,mGe as mf,Q1 as mg,XGe as mh,f0 as mi,M6 as mj,tot as mk,p$t as ml,RDt as mm,Gz as mn,KT as mo,_h as mp,r9e as mq,jm as mr,Yz as ms,O$t as mt,C$t as mu,HSe as mv,tHe as mw,dAe as mx,Dre as my,_Ae as mz,$ as n,ch as n$,Kxe as n0,Tn as n1,u8 as n2,v9e as n3,AA as n4,TDt as n5,G1 as n6,wDt as n7,SDt as n8,xDt as n9,KXe as nA,OKe as nB,f6e as nC,NXe as nD,nLt as nE,WXe as nF,xce as nG,nEe as nH,tLt as nI,p8e as nJ,SLt as nK,vX as nL,gG as nM,yG as nN,Tq as nO,N4e as nP,ZPt as nQ,YPt as nR,Xu as nS,j$t as nT,QPt as nU,Uc as nV,J$t as nW,W6 as nX,Q$e as nY,Dr as nZ,_0 as n_,ivt as na,avt as nb,svt as nc,nvt as nd,ovt as ne,iZe as nf,eZe as ng,H$t as nh,eLt as ni,K$t as nj,rZe as nk,TAe as nl,_Xe as nm,TNt as nn,CZe as no,yEe as np,Q$t as nq,Y$t as nr,FIt as ns,kIt as nt,NIt as nu,Eze as nv,rDt as nw,Lce as nx,eDt as ny,Jl as nz,qae as o,nr as o$,k_ as o0,qre as o1,lf as o2,mne as o3,m$t as o4,EGe as o5,jPt as o6,cUe as o7,rI as o8,KK as o9,R$t as oA,M$t as oB,A$t as oC,Gl as oD,jl as oE,wa as oF,iu as oG,_g as oH,y5 as oI,EI as oJ,gre as oK,dV as oL,Gs as oM,TJe as oN,h1 as oO,nl as oP,wJe as oQ,Bd as oR,gJe as oS,dJe as oT,hJe as oU,gT as oV,qu as oW,xCe as oX,QZe as oY,nJe as oZ,lJe as o_,HPt as oa,$Dt as ob,Fc as oc,LK as od,gge as oe,RD as of,j9 as og,RBe as oh,Js as oi,Un as oj,U as ok,nd as ol,VX as om,tV as on,Xi as oo,K_e as op,nC as oq,rbe as or,dIt as os,V$ as ot,Ur as ou,Id as ov,Zz as ow,rR as ox,mIt as oy,P$t as oz,EA as p,XX as p$,wCe as p0,lh as p1,xJe as p2,yJe as p3,tS as p4,xee as p5,SJe as p6,EJe as p7,CJe as p8,fre as p9,Z$e as pA,T2t as pB,no as pC,HWe as pD,bI as pE,VY as pF,DLt as pG,fL as pH,qWe as pI,NWe as pJ,G$t as pK,U$t as pL,k$t as pM,N$t as pN,CE as pO,kWe as pP,F$t as pQ,DWe as pR,LWe as pS,q$ as pT,Ayt as pU,z$t as pV,B$t as pW,hIt as pX,AUe as pY,qHe as pZ,eEe as p_,RJe as pa,AJe as pb,OJe as pc,gbe as pd,SI as pe,tJe as pf,bJe as pg,vJe as ph,pJe as pi,kJe as pj,DJe as pk,LJe as pl,gLt as pm,NJe as pn,FJe as po,fJe as pp,mJe as pq,_Je as pr,IJe as ps,ire as pt,_Lt as pu,aJe as pv,oJe as pw,cJe as px,uJe as py,ME as pz,MKe as q,Nre as q$,TZ as q0,gZ as q1,sc as q2,qD as q3,zp as q4,hZe as q5,eet as q6,ru as q7,tZe as q8,v0e as q9,kTt as qA,w8 as qB,VTt as qC,KV as qD,Qmt as qE,vLe as qF,gCt as qG,hne as qH,vAt as qI,MLe as qJ,wAt as qK,PLe as qL,TAt as qM,ILe as qN,FAt as qO,$8 as qP,HAt as qQ,eRt as qR,xgt as qS,UAt as qT,gRt as qU,y0t as qV,cvt as qW,E1t as qX,X1t as qY,B1t as qZ,pAe as q_,uee as qa,V4e as qb,yIt as qc,ent as qd,_ot as qe,COe as qf,rat as qg,Eat as qh,Cie as qi,Oat as qj,Xat as qk,slt as ql,Apt as qm,ZV as qn,syt as qo,cyt as qp,Xgt as qq,Dn as qr,Mo as qs,NTt as qt,RLe as qu,WCt as qv,sat as qw,nmt as qx,qgt as qy,UTt as qz,b as r,Vre as r$,xAe as r0,Bwe as r1,Ote as r2,uPt as r3,sAe as r4,K1e as r5,JA as r6,pPt as r7,OLt as r8,$re as r9,PCe as rA,lXe as rB,sKe as rC,cXe as rD,FCe as rE,jCe as rF,mV as rG,aIt as rH,CCe as rI,gV as rJ,aet as rK,d0 as rL,CIt as rM,en as rN,rIt as rO,uT as rP,qIt as rQ,Dy as rR,Bt as rS,vNt as rT,FT as rU,VK as rV,tg as rW,P2 as rX,NAe as rY,SR as rZ,uL as r_,d6 as ra,R1 as rb,Y3t as rc,u6e as rd,l6e as re,zze as rf,Mae as rg,Pa as rh,sI as ri,Lre as rj,Ire as rk,cu as rl,m6 as rm,eu as rn,wre as ro,We as rp,oP as rq,Eq as rr,mG as rs,ske as rt,SAe as ru,fAe as rv,att as rw,xR as rx,si as ry,ACe as rz,Yt as s,fue as s$,_Nt as s0,aU as s1,cP as s2,bX as s3,mAe as s4,vAe as s5,rA as s6,Iee as s7,LAe as s8,OI as s9,tSe as sA,jGe as sB,ba as sC,Nit as sD,xLt as sE,_V as sF,prt as sG,Kw as sH,crt as sI,Aw as sJ,aB as sK,oB as sL,oLt as sM,Xre as sN,ZCe as sO,NKe as sP,Ere as sQ,YCe as sR,DKe as sS,Avt as sT,BQ as sU,Xet as sV,Zet as sW,Yet as sX,mLt as sY,mue as sZ,aLt as s_,dL as sa,Mre as sb,yRe as sc,Ym as sd,Zm as se,Fwe as sf,lbe as sg,WPt as sh,QCe as si,Sre as sj,xet as sk,wet as sl,sR as sm,Rxe as sn,CLt as so,Kc as sp,df as sq,eee as sr,uIt as ss,cxe as st,_et as su,ALt as sv,kke as sw,eae as sx,F as sy,JIt as sz,R as t,EDt as t$,PJe as t0,fLt as t1,vLt as t2,yLt as t3,cLt as t4,lLt as t5,uLt as t6,hLt as t7,pLt as t8,sJe as t9,RIe as tA,Mvt as tB,IIe as tC,MIe as tD,Dvt as tE,oo as tF,GQ as tG,uc as tH,PIe as tI,N1 as tJ,Pvt as tK,D1 as tL,PQ as tM,ET as tN,bmt as tO,u_t as tP,c_t as tQ,l_t as tR,Hd as tS,qLt as tT,jS as tU,wbe as tV,q$t as tW,W$t as tX,bLt as tY,LLt as tZ,lDt as t_,yue as ta,dLt as tb,MJe as tc,K6 as td,SCe as te,ECe as tf,QK as tg,rvt as th,Dh as ti,vDt as tj,ug as tk,Knt as tl,eGe as tm,J9e as tn,Nm as to,xIe as tp,UK as tq,Gnt as tr,pIt as ts,$Ie as tt,DIe as tu,ax as tv,TP as tw,wIt as tx,xse as ty,Nvt as tz,Dt as u,SNt as u0,CNt as u1,Oa as v,Vi as w,te as x,xe as y,gDt as z};
